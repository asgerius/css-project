[{"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1479339227, "post_id": 40643850, "comment_id": 68520494, "body": "<a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/System-Timeout.html#v:timeout\" rel=\"nofollow noreferrer\">timeout</a>? Literally the first hit on Google for &quot;Haskell timeout&quot;. If you didn&#39;t do that minimum effort, shame on you; if you did, you should say in your question why that isn&#39;t going to work."}, {"owner": {"reputation": 528, "user_id": 3066608, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t0ZlK.png?s=128&g=1", "display_name": "creichert", "link": "https://stackoverflow.com/users/3066608/creichert"}, "edited": false, "score": 0, "creation_date": 1479339801, "post_id": 40643850, "comment_id": 68520658, "body": "FWIW, you would want to use <code>timeout</code> from <code>lifted-base</code> in order to use it in a yesod handler: <a href=\"https://hackage.haskell.org/package/lifted-base-0.2.3.8/docs/System-Timeout-Lifted.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/lifted-base-0.2.3.8/docs/&hellip;</a>."}, {"owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479339906, "post_id": 40643850, "comment_id": 68520686, "body": "@DanielWagner if I understand right the documentation about timeout function they dont make a delay, they just stop the execution of a function if it exceeds n miliseconds;"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479339999, "post_id": 40643850, "comment_id": 68520703, "body": "@oriaj Okay. Did you google for &quot;Haskell delay&quot;...?"}, {"owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479340281, "post_id": 40643850, "comment_id": 68520769, "body": "@DanielWagner yes and find <code>Control.Concurrent</code> I try to make and implantation but fail because the return have to be and IO, I edit my question with my code"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479341464, "post_id": 40643850, "comment_id": 68521159, "body": "@oriaj Excellent. <i>This</i> is a question I can upvote."}], "answers": [{"comments": [{"owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "edited": false, "score": 0, "creation_date": 1480946685, "post_id": 40856207, "comment_id": 69161252, "body": "I edit my answer with the example that work for me, is in the package that you reference Yesod.Core.Handler"}], "tags": [], "owner": {"reputation": 3931, "user_id": 382745, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/8794fd98ad2e727eb3f79ad29cfc033a?s=128&d=identicon&r=PG", "display_name": "angerman", "link": "https://stackoverflow.com/users/382745/angerman"}, "is_accepted": true, "score": 1, "last_activity_date": 1480381808, "creation_date": 1480381808, "answer_id": 40856207, "question_id": 40643850, "link": "https://stackoverflow.com/questions/40643850/timeout-function-in-yesod/40856207#40856207", "title": "timeout function in Yesod", "body": "<p>I assume you are looking for <a href=\"https://www.stackage.org/haddock/lts-7.9/yesod-core-1.4.26/Yesod-Core-Handler.html#v:forkHandler\" rel=\"nofollow noreferrer\"><code>forkHandler</code></a>.</p>\n"}], "owner": {"reputation": 716, "user_id": 4118267, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xIgkR.jpg?s=128&g=1", "display_name": "oriaj", "link": "https://stackoverflow.com/users/4118267/oriaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 40856207, "answer_count": 1, "score": 3, "last_activity_date": 1480946576, "creation_date": 1479337125, "last_edit_date": 1480946576, "question_id": 40643850, "link": "https://stackoverflow.com/questions/40643850/timeout-function-in-yesod", "title": "timeout function in Yesod", "body": "<p>I have a Yesod app, with a table in my database with a flag with three posible states (ToUse, Using, Used), bu default ToUse.</p>\n\n<p>when a user click a button the flag in database change to Using, the idea is that after 10 minutes if the flag was not change to Used (operation that make another user with another button) the flag go back to ToUSe, the problem is that searching i can't find a method to delay the operation to edit my database and I'm not sure if it is possible in Yesod</p>\n\n<p>Searching I find <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/System-Timeout.html#v:timeout\" rel=\"nofollow noreferrer\">timeout</a> library but if I understand right that library only stop the execution of a program don't delay his start</p>\n\n<p>I try to use <code>Control.Concurrent</code> but, get the following error</p>\n\n<pre><code>testTimeOut = do     \n  c1 &lt;- atomically $ newTQueue\n  C.forkIO $ do\n    C.threadDelay (2 * 1000000)\n    id &lt;- runDB $ insert $ SubForm \"ToUse\"  10 \n    atomically $ do \n      writeTQueue c1 \"result 1\" \n</code></pre>\n\n<blockquote>\n  <p>Couldn't match expected type \u2018IO t0\u2019\n                  with actual type \u2018HandlerT site0 IO (Key SubForm)\u2019</p>\n</blockquote>\n\n<p><strong>EDIT</strong></p>\n\n<p>This code work form me</p>\n\n<pre><code>getFooR :: Handler RepHtml\ngetFooR = do\n  runInnerHandler &lt;- handlerToIO\n  liftIO $ forkIO $ runInnerHandler $ do\n    Code here runs inside GHandler but on a new thread.\n    This is the inner GHandler.\n    ...\n  Code here runs inside the request's control flow.\n  This is the outer GHandler.\n  ...\n</code></pre>\n"}, {"tags": ["haskell", "typeclass", "email-verification"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1479333678, "post_id": 40642954, "comment_id": 68518322, "body": "You might consider using a smart constructor that normalizes case rather than using the raw <code>EmailAddress</code> constructor."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1479336234, "post_id": 40642954, "comment_id": 68519435, "body": "@chepner ...or a bidirectional pattern synonym. Then can even pattern match."}], "answers": [{"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 1, "creation_date": 1479367191, "post_id": 40643031, "comment_id": 68529052, "body": "I&#39;d add that you can use <code>GeneralizedNewtypeDeriving</code> to keep any instances from <code>EmailAddress</code> you want."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1479368504, "post_id": 40643031, "comment_id": 68529715, "body": "@AlexeyRomanov I actually heavily debated whether I wanted to add something about that too. I think I won&#39;t because the OP has provided the full data definition of <code>EmailAddress</code> and there isn&#39;t anything from there you would want to lift using GND."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 13, "last_activity_date": 1479334146, "last_edit_date": 1479334146, "creation_date": 1479333107, "answer_id": 40643031, "question_id": 40642954, "link": "https://stackoverflow.com/questions/40642954/how-to-override-the-derived-eq-instance/40643031#40643031", "title": "How to override the derived Eq instance?", "body": "<blockquote>\n  <p>So, is it reasonable to derive <code>Eq</code> instead of a self-made case-insensitive instance?</p>\n</blockquote>\n\n<p>That sort of depends on what you want. I'm sure that the author of the package has their reasons for that <code>Eq</code> instance.</p>\n\n<blockquote>\n  <p>Also, if i were to use this library, how could i provide my own <code>Eq</code> instance for <code>EmailAdress</code>?</p>\n</blockquote>\n\n<p>You can't \"override\" their instance. The usual solution to this sort of problem is a <code>newtype</code> wrapper on which you write your own instances:</p>\n\n<pre><code>newtype MyEmailAddress = MyEmailAddress EmailAddress\n</code></pre>\n\n<p>And then you are free to define your own version of equality, possibly as:</p>\n\n<pre><code>import Data.Char (toLower)\nimport qualified Data.ByteString.Char8 as DBC (map)\n\ninstance Eq MyEmailAddress where\n  MyEmailAddress (EmailAddress a1 d1) == MyEmailAddress (EmailAddress a2 d2) \n    = DBC.map toLower a1 == DBC.map toLower a2 &amp;&amp; DBC.map toLower d1 == DBC.map toLower d2\n</code></pre>\n\n<hr>\n\n<p>While I'm at it, allow me to mention you can even define a pattern synonym which makes everything much nicer:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\npattern Email address domain = MyEmailAddress (EmailAddress address domain)\n</code></pre>\n\n<p>Then, you can easily make one of your emails with <code>Email \"yourName\" \"yourDomain\"</code> as well as pattern match on that. The <code>Eq</code> instance looks a lot nicer with this:</p>\n\n<pre><code>instance Eq MyEmailAddress where\n  Email a1 d1 == Email a2 d2 \n    = DBC.map toLower a1 == DBC.map toLower a2 &amp;&amp; DBC.map toLower d1 == DBC.map toLower d2\n</code></pre>\n"}], "owner": {"reputation": 410, "user_id": 3927886, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/689a75ec29af93dcc938fdbd5f039b54?s=128&d=identicon&r=PG&f=1", "display_name": "RamiroPastor", "link": "https://stackoverflow.com/users/3927886/ramiropastor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 0, "accepted_answer_id": 40643031, "answer_count": 1, "score": 2, "last_activity_date": 1479368429, "creation_date": 1479332824, "last_edit_date": 1479368429, "question_id": 40642954, "link": "https://stackoverflow.com/questions/40642954/how-to-override-the-derived-eq-instance", "title": "How to override the derived Eq instance?", "body": "<p>I'm wondering why the <a href=\"https://hackage.haskell.org/package/email-validate\" rel=\"nofollow noreferrer\">email-validate</a> package derives Eq in the following code:</p>\n\n<pre><code>data EmailAddress = EmailAddress ByteString ByteString\n   deriving (Eq, Ord, Data, Typeable, Generic) \n</code></pre>\n\n<p>I mean, I was using <code>Text</code> for email addresses until I realised I need to make them case-insensitive (so i don't save <code>Example@ex.ample</code> and <code>example@ex.ample</code> as 2 different addresses), so i got to this library only to discover it derives <code>Eq</code>.</p>\n\n<p>So, is it reasonable to derive <code>Eq</code> instead of a self-made case-insensitive instance?.\nAlso, if I were to use this library, how could I provide my own <code>Eq</code> instance for <code>EmailAdress</code>?</p>\n"}, {"tags": ["haskell", "hspec"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479331039, "post_id": 40642116, "comment_id": 68517002, "body": "I&#39;m a bit at a loss about what you want to achieve. In the first place, you&#39;ve shown the actual output from ghci, but not what output you were hoping for; in the second place, you haven&#39;t said what it means for an exception and message to be correct."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479331511, "post_id": 40642116, "comment_id": 68517249, "body": "The <code>assert</code> package seems to throw exceptions of type <code>Arse</code> (aptly named...) so <code>??? = \\(_ :: Arse) -&gt; True</code> would pass for any error message produced by <code>byEq</code>. The second argument to <code>shouldThrow</code> is simply a function <code>e -&gt; Bool</code> for some <code>Exception e</code>."}, {"owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479332774, "post_id": 40642116, "comment_id": 68517883, "body": "@DanielWagner I added a clarification."}, {"owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479332839, "post_id": 40642116, "comment_id": 68517915, "body": "@user2407038 That will test that the exception type is correct, but not that the message is correct.   Plus, I tried it and it gave: <code>did not get expected exception: Arse</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479333110, "post_id": 40642116, "comment_id": 68518058, "body": "Rather than testing that <code>byEq assert &quot;Bool&quot; x y ()</code> produces the message <code>Assertion failed &quot;Bool&quot;, False \u2260 True</code>, wouldn&#39;t it be more sane to simply have <code>byEq assert &quot;foo&quot; (x,y) (False,True) ()</code> as the test?"}, {"owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479334541, "post_id": 40642116, "comment_id": 68518727, "body": "@DanielWagner I am not sure what you mean.   For the sake of the example I put the <code>byeq</code> directly in the test.  In my &quot;real&quot; code, this would be in some function in the library/application.  I would call that and then want to ensure I do indeed receive the expected exception and the expected message.  I think there is a layer of magic in Control.Exception.Assert I do not understand."}], "owner": {"reputation": 1421, "user_id": 814846, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/92d418d6934ed583bab89df95974b6bf?s=128&d=identicon&r=PG", "display_name": "haroldcarr", "link": "https://stackoverflow.com/users/814846/haroldcarr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 223, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1479332742, "creation_date": 1479329700, "last_edit_date": 1479332742, "question_id": 40642116, "link": "https://stackoverflow.com/questions/40642116/how-to-test-result-of-control-exception-assert-with-hspec", "title": "How to test result of Control.Exception.Assert with HSpec", "body": "<p>I want to use <a href=\"https://hackage.haskell.org/package/assert-0.0.1.2/docs/Control-Exception-Assert.html\" rel=\"nofollow noreferrer\">Control.Exception.Assert</a> to get custom error messages.</p>\n\n<p>And I want to test these with <a href=\"http://hspec.github.io/\" rel=\"nofollow noreferrer\">HSpec</a>.</p>\n\n<p>In the repl I can see:</p>\n\n<pre><code>\u03bb: import           Control.Exception\n\u03bb: import           Control.Exception.Assert\n\u03bb: (byEq assert \"Bool\" True  True ())\n()\n\u03bb: (byEq assert \"Bool\" False True ())\n*** Exception: &lt;interactive&gt;:6:7-12: Assertion failed \"Bool\", False \u2260 True\n</code></pre>\n\n<p>How does one test that the exception and message are correct?  In other word, for the case where <code>byEq</code> throws an exception I want to test both the exception type and the exception message are what are expected.</p>\n\n<p>Something like:</p>\n\n<pre><code>main = hspec $ do\n  describe \"Assertions\" $ do\n    it \"assert\" $ do\n      evaluate (byEq assert \"Bool\" False True ()) `shouldThrow` ????\n</code></pre>\n"}, {"tags": ["haskell", "lambda", "foldable"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1479331503, "post_id": 40642105, "comment_id": 68517245, "body": "This is pretty good structurally for the beginner you say you are, you have a knack for this"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1479376306, "post_id": 40642105, "comment_id": 68534516, "body": "As general advice in these situations, when you get a confusing error message, start adding type annotations stating what you think the types should be.  This will <i>significantly</i> improve the error messages.  In fact, it&#39;s usually good practice to provide type annotations for all top-level functions to catch these sorts of mistakes as soon as possible."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1479380893, "post_id": 40642105, "comment_id": 68537757, "body": "This is good for a beginner. A couple of notes: 1) consider <code>clean string = total &lt;= gr where ...</code> since using guards or if-then-else to return true/false looks more complex than it needs to be 2) your algorithm for combinations looks correct but suboptimal: you generate many candidates, and you need to filter them out later. Consider this: you can pick k elements from <code>x:xs</code> by either skipping <code>x</code> (and taking all k elements from <code>xs</code>) or choosing <code>x</code> (and then taking only k-1 elements from <code>xs</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479330808, "post_id": 40642190, "comment_id": 68516911, "body": "Proposal: the fix he actually wanted was to include <code>list</code> at the end of the mapped function (as in <code>map (\\chr -&gt; length $ filter (== chr) list) list</code>). Your code produces a list of functions; mine produces a list of numbers."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479331043, "post_id": 40642190, "comment_id": 68517005, "body": "@DanielWagner I think you are right. I&#39;ll amend the solution accordingly."}, {"owner": {"reputation": 63, "user_id": 7149760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/179a20996a30847901a96da8e219fe61?s=128&d=identicon&r=PG&f=1", "display_name": "iPizarro12", "link": "https://stackoverflow.com/users/7149760/ipizarro12"}, "edited": false, "score": 0, "creation_date": 1479392168, "post_id": 40642190, "comment_id": 68545468, "body": "wow such simple solution... thank you @Alec you&#39;ve helped me a lot!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 6, "last_activity_date": 1598118692, "last_edit_date": 1598118692, "creation_date": 1479329939, "answer_id": 40642190, "question_id": 40642105, "link": "https://stackoverflow.com/questions/40642105/no-instance-for-foldable-arising-from-length-inside-lambda/40642190#40642190", "title": "No instance for Foldable arising from length inside lambda", "body": "<p>You likely are intending to filter over <code>list</code>, so to make your code work, you need to also add <code>list</code> as an argument of <code>filter</code>:</p>\n<pre><code>rpt chr list = map (\\chr -&gt; length $ filter (== chr) list) list\n</code></pre>\n<p>For beginners, I recommend ignoring GHCi's suggestion of <code>FlexibleContexts</code>. It often ends up producing error messages like the one you had (or other confusing ones like <code>No instance for (Num (Int -&gt; Bool))</code>).</p>\n"}], "owner": {"reputation": 63, "user_id": 7149760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/179a20996a30847901a96da8e219fe61?s=128&d=identicon&r=PG&f=1", "display_name": "iPizarro12", "link": "https://stackoverflow.com/users/7149760/ipizarro12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 742, "favorite_count": 0, "accepted_answer_id": 40642190, "answer_count": 1, "score": 6, "last_activity_date": 1598118692, "creation_date": 1479329681, "last_edit_date": 1479338733, "question_id": 40642105, "link": "https://stackoverflow.com/questions/40642105/no-instance-for-foldable-arising-from-length-inside-lambda", "title": "No instance for Foldable arising from length inside lambda", "body": "<p>first question here and completely a noob on haskell, so please be kind with me :)</p>\n\n<p>I was playing with the question number 6 of <a href=\"https://wiki.haskell.org/99_questions/21_to_28\" rel=\"noreferrer\">this</a> haskell exercises</p>\n\n<p>and in the end came to the solution (or something similar I hope) with this code </p>\n\n<pre><code>combinations gr lis = filter clean $ sequence $ replicate gr lis\nwhere\n    clean string\n        | total &gt; gr = False\n        | otherwise = True\n        where total = sum [ rpt c string | c &lt;- string]\n    rpt chr list = length $ filter (== chr) list\n</code></pre>\n\n<p>the part that i like to be highlighted is the function 'rpt' which counts the number of times a character is repeated in a string, for example: \n\"aaba\" -> [3313] (the 3 comes from the letter a, which repeates 3 times)\n\"aaccva\" -> [332213]</p>\n\n<p>later on I tried to make the function with a lambda and a map resulting in this:</p>\n\n<pre><code>rpt chr list = map (\\chr -&gt; length $ filter (== chr)) list\n</code></pre>\n\n<p>and at first ghci told me to use FlexibleContext to allow this, but if I do then it yields:</p>\n\n<pre><code>&lt;interactive&gt;:7:1:\nNo instance for (Foldable ((-&gt;) [Char]))\n  arising from a use of \u2018rpt\u2019\nIn the expression: rpt 'a' string\nIn an equation for \u2018it\u2019: it = rpt 'a' string\n</code></pre>\n\n<p>and here I'am stuck, I have not been able to understand what's happening... what is needed to fix this function?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7169126, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b3d93cb0c59b2a69501c486e6fe030?s=128&d=identicon&r=PG&f=1", "display_name": "Mansur", "link": "https://stackoverflow.com/users/7169126/mansur"}, "edited": false, "score": 0, "creation_date": 1479341988, "post_id": 40642362, "comment_id": 68521311, "body": "I have done that and install utility-ht is now installed, but still cant&#39;t use in both WinHugs and GHC. Any more suggestions?"}], "tags": [], "owner": {"reputation": 410, "user_id": 3927886, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/689a75ec29af93dcc938fdbd5f039b54?s=128&d=identicon&r=PG&f=1", "display_name": "RamiroPastor", "link": "https://stackoverflow.com/users/3927886/ramiropastor"}, "is_accepted": false, "score": 1, "last_activity_date": 1479331799, "last_edit_date": 1479331799, "creation_date": 1479330561, "answer_id": 40642362, "question_id": 40641931, "link": "https://stackoverflow.com/questions/40641931/cant-find-imported-module-data-list-ht/40642362#40642362", "title": "Can&#39;t find imported module &quot;Data.List.HT", "body": "<p>open terminal and run:</p>\n\n<pre><code>cabal install utility-ht\n</code></pre>\n\n<p>or in linux (ubuntu)</p>\n\n<pre><code>sudo cabal install utility-ht\n</code></pre>\n\n<p>Also this might not work on Hugs, i only use GHC</p>\n"}], "owner": {"reputation": 11, "user_id": 7169126, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b3d93cb0c59b2a69501c486e6fe030?s=128&d=identicon&r=PG&f=1", "display_name": "Mansur", "link": "https://stackoverflow.com/users/7169126/mansur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1479331799, "creation_date": 1479328972, "question_id": 40641931, "link": "https://stackoverflow.com/questions/40641931/cant-find-imported-module-data-list-ht", "title": "Can&#39;t find imported module &quot;Data.List.HT", "body": "<p>Hello I am trying to use import Data.List.HT hiding (unzip) for my Haskell program and have gotten the source code for the modules from haskell.org</p>\n\n<p>But now, I don't know how to properly name it and the location to save it in WinHugs.</p>\n\n<p>I am now getting this error message: \"<strong>Can't find imported module \"Data.List.HT</strong>\"</p>\n\n<p>Kindly help me out.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1479328026, "post_id": 40641364, "comment_id": 68515333, "body": "Could you add a complete example? This is hard to answer without seeing the right hand sides."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1479328058, "post_id": 40641364, "comment_id": 68515350, "body": "This sort of problem is generally solved by using <code>mtl</code>. In your case, because you are using <code>MaybeT</code>, it is not as obvious how to do this. Slightly confusingly, the <code>MonadMaybe</code> constraint one might want is just <code>MonadPlus</code> (see <a href=\"https://github.com/ekmett/mtl/issues/6\" rel=\"nofollow noreferrer\">this pull request</a>). This would be easier to answer if your example was more complete (ie compileable)."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1479331674, "post_id": 40642293, "comment_id": 68517339, "body": "Clearly <code>Alternative</code> and <code>MonadPlus</code> are identical here. Are there conventions on when to use which as constraints? (I&#39;ve read <a href=\"http://stackoverflow.com/questions/10167879/distinction-between-typeclasses-monadplus-alternative-and-monoid\">this excellent answer by Edward Kmett</a>)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1479332683, "post_id": 40642293, "comment_id": 68517829, "body": "@Alec If you can give your operation an <code>Alternative</code>-polymorphic type, you probably should: as noted there, <code>MonadPlus</code> is a stronger claim, hence has fewer instances, is &quot;less polymorphic&quot; in a sense, and can not be used at as many different types by the caller. On the other hand, sometimes something you write assumes one of the <code>MonadPlus</code> laws, in which case you have no choice but to upgrade from <code>Alternative</code> to <code>MonadPlus</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1479330303, "creation_date": 1479330303, "answer_id": 40642293, "question_id": 40641364, "link": "https://stackoverflow.com/questions/40641364/cleaning-up-noise-in-maybet/40642293#40642293", "title": "Cleaning up noise in MaybeT", "body": "<pre><code>someFunc :: MaybeT IO ()\n</code></pre>\n\n<p>To be consistent with the advice below, rewrite <code>someFunc :: (Alternative m, MonadIO m) =&gt; m ()</code>. This is not needed for implementing <code>someFunc</code>, but is needed for using <code>someFunc</code> in other operations without explicit lifting when the other operations are not specifically in the <code>MaybeT IO</code> monad.</p>\n\n<pre><code>someFunc = do\n    foo1 &lt;- MaybeT $ ...\n</code></pre>\n\n<p>Rewrite <code>...</code> to use <code>return</code> and <code>empty</code> instead of <code>return . Just</code> and <code>return Nothing</code>.</p>\n\n<pre><code>    foo2 &lt;- MaybeT . return $ ...\n</code></pre>\n\n<p>Rewrite <code>...</code> to use <code>return</code> and <code>empty</code> instead of <code>Just</code> and <code>Nothing</code>.</p>\n\n<pre><code>    foo3 &lt;- lift $ ...\n</code></pre>\n\n<p>For <code>MaybeT IO</code>, the <code>lift</code> and <code>liftIO</code> operations are identical, so see the next suggestion. In the general case (rather than specific to <code>MaybeT IO</code>), rewrite <code>...</code> to be typeclass polymorphic for a class that your concrete monad inhabits.</p>\n\n<pre><code>    foo4 &lt;- liftIO $ ...\n</code></pre>\n\n<p>Can't do much about this. Sometimes it is possible to give <code>...</code> a <code>MonadIO</code> constraint rather than an <code>IO</code> type. Usually that just shifts the location of the <code>liftIO</code>, though; it has to appear somewhere.</p>\n"}], "owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 40642293, "answer_count": 1, "score": 1, "last_activity_date": 1479330303, "creation_date": 1479326921, "question_id": 40641364, "link": "https://stackoverflow.com/questions/40641364/cleaning-up-noise-in-maybet", "title": "Cleaning up noise in MaybeT", "body": "<p>I am sure many of you have seen code like this:</p>\n\n<pre><code>someFunc :: MaybeT IO ()\nsomeFunc = do\n    foo1 &lt;- MaybeT $ ...\n    foo2 &lt;- MaybeT . return $ ...\n    foo3 &lt;- lift $ ...\n    foo4 &lt;- liftIO $ ...\n    ...\n</code></pre>\n\n<p>I am talking about those <code>MaybeT</code>, <code>MaybeT . return</code>, <code>lift</code>, <code>liftIO</code>, etc.</p>\n\n<p>This type of noise clutters up my <code>MaybeT</code> code.</p>\n\n<p>I have the feeling there is a better way. Is there?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479329455, "post_id": 40641205, "comment_id": 68516186, "body": "Uh, &quot;interwiness&quot;?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1479329560, "post_id": 40641205, "comment_id": 68516241, "body": "It&#39;s not clear to me that it&#39;s sensible to try to abstract away from this. In the end, if your user wants to use their own type, they&#39;re going to have to write an instance for whichever backend you end up choosing. It will just be an extra level of indirection for them to understand: &quot;Oh, I need a <code>Storable (Encode MyFancyType)</code> instance, which means I need a <code>Serialize MyFancyType</code> instance... okay, I&#39;ll write a <code>Serialize MyFancyType</code> instance.&quot;. And now they&#39;re back to (having to) know which backend you chose."}, {"owner": {"reputation": 113, "user_id": 4493387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/774d4173a27dc62ea12c13c1b46f0b30?s=128&d=identicon&r=PG&f=1", "display_name": "aphorisme", "link": "https://stackoverflow.com/users/4493387/aphorisme"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479334221, "post_id": 40641205, "comment_id": 68518585, "body": "@DanielWagner Ah, I see. So you would just keep the dependency of <code>cereal</code> and probably re-exporting the type class definition?"}], "owner": {"reputation": 113, "user_id": 4493387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/774d4173a27dc62ea12c13c1b46f0b30?s=128&d=identicon&r=PG&f=1", "display_name": "aphorisme", "link": "https://stackoverflow.com/users/4493387/aphorisme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1479334373, "creation_date": 1479326326, "last_edit_date": 1479334373, "question_id": 40641205, "link": "https://stackoverflow.com/questions/40641205/encapsulate-serialization-type-class", "title": "Encapsulate (serialization) type class", "body": "<p>I give an example to demonstrate my question.</p>\n\n<p>Say I want to build a middle-level API for a key-value storage. The low-level API I base my API on consists of the following three basic functions:</p>\n\n<pre><code>put :: ByteString -&gt; ByteString -&gt; IO ()\nget :: ByteString -&gt;            -&gt; IO (Maybe ByteString)\ndel :: ByteString -&gt;            -&gt; IO ()\n</code></pre>\n\n<p>with obvious semantics. To make my API more convenient, I want to pass not only <code>ByteString</code>'s but serializable objects. So in a first attempt I define </p>\n\n<pre><code>putOp :: Serialize a =&gt; ByteString -&gt; a -&gt; IO ()\ngetOp :: Serialize a =&gt; ByteString -&gt;   -&gt; IO (Maybe a)\n</code></pre>\n\n<p>this works although that <code>cereal</code> is hard-wired into my API feels odd. In fact, after some time I come across <code>binary-serialise-cbor</code> which looks promising. But changing from <code>cereal</code> to it would lead to a breaking change in my API.</p>\n\n<h3>Question</h3>\n\n<p>Is there a good way to \"encapsulate\" which serialization library I use internally (avoiding <code>UndecidableInstances</code>)?</p>\n\n<p>Common sense might be writing an own class</p>\n\n<pre><code>class Storable a where\n   encode :: a -&gt; ByteString\n   decode :: ByteString -&gt; Either String a\n</code></pre>\n\n<p>and a newtype</p>\n\n<pre><code>newtype Encode a = Encode { unwrap :: a } deriving (Functor, Eq, Show)\n</code></pre>\n\n<p>and having it somewhat implicitly in <code>putOp</code> and <code>getOp</code>:</p>\n\n<pre><code>putOp :: Storable (Encode a) =&gt; ByteString -&gt; a -&gt; IO ()\nputOp k x = put k (encode $ Encode x)\n\ngetOp :: Storable (Encode a) =&gt; ByteString -&gt; IO (Maybe a)\ngetOp k = do\n   x &lt;- (get k) :: IO (Maybe (Encode a))\n   return (unwrap &lt;$&gt; x)\n</code></pre>\n\n<p>where we have</p>\n\n<pre><code>instance Serialize a =&gt; Storable (Encode a) where\n   encode = S.encode . unwrap\n   decode (Encode r) = Encode &lt;$&gt; S.decode r\n</code></pre>\n\n<p>This looks ok; although </p>\n\n<ol>\n<li>it adds overhead (or is it optimized away?) and </li>\n<li>from the outside, the API now has the weird <code>Storable (Encode a)</code> context on its put/get and writing own instances for <code>Storable a</code> becomes writing instances for <code>Storable (Encode a)</code>.</li>\n</ol>\n\n<p>Is there a more elegant solution?</p>\n"}, {"tags": ["haskell", "generic-programming"], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1479326136, "creation_date": 1479326136, "question_id": 40641141, "link": "https://stackoverflow.com/questions/40641141/ghc-generics-for-default-methods-of-sum-types", "title": "GHC.Generics for default methods of sum types", "body": "<p>I want to use <code>GHC.Generics</code> to create default implementations of a class for all objects of the form <code>data X s  = X0 s | X1 O1 (X s) | X2 O2 (X s) (X s) | ...</code>. </p>\n\n<p>Specifically I want the following:</p>\n\n<pre><code>class C (a :: * -&gt; *) where\n  cmap :: Applicative m =&gt;\n         (s -&gt; m (a s')) -&gt; ((a s) -&gt; m (a s')) -&gt; a s -&gt; m (a s')\n</code></pre>\n\n<p>So that for example in the <code>Expr</code> type that follows:</p>\n\n<pre><code>data BEOp = EAdd | ESub | EMul | EDiv deriving (Generic, Eq)\ndata UEOp = EId deriving (Generic, Eq)\ndata Expr s = BinExpr BEOp (Expr s) (Expr s)\n  | UnExpr UEOp (Expr s)\n  | NExpr s deriving (Eq, Generic)\n</code></pre>\n\n<p>GHC will derive a default implementation of typeclass <code>C</code> that is equivalent to:</p>\n\n<pre><code>instance C Expr where\n  cmap _ f (BinExpr o q q') = BinExpr o &lt;$&gt; f q &lt;*&gt; f q'\n  cmap _ f (UnExpr o q) = UnExpr o &lt;$&gt; f q\n  cmap f _ (NExpr s) = f s\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 3, "creation_date": 1479318617, "post_id": 40638659, "comment_id": 68510010, "body": "Relevant: <a href=\"http://stackoverflow.com/questions/5684049/is-there-some-way-to-define-an-enum-in-haskell-that-wraps-around\" title=\"is there some way to define an enum in haskell that wraps around\">stackoverflow.com/questions/5684049/&hellip;</a>. Maybe add Neil Brown&#39;s solution from that thread as <code>nextMonth</code>."}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": false, "score": 10, "last_activity_date": 1479318608, "last_edit_date": 1479318608, "creation_date": 1479317792, "answer_id": 40638659, "question_id": 40638605, "link": "https://stackoverflow.com/questions/40638605/access-the-next-element-of-data/40638659#40638659", "title": "Access the next element of &#39;data&#39;", "body": "<p>You asked the compiler to infer an <code>Enum</code> instance, so</p>\n\n<pre><code>&gt;&gt;&gt; :t succ \nsucc :: Enum a =&gt; a -&gt; a\n&gt;&gt;&gt; succ Jan\nFeb\n</code></pre>\n\n<p>Note however</p>\n\n<pre><code>&gt;&gt;&gt; succ Dec \n*** Exception: succ{MonthData}: tried to take `succ' of last tag in enumeration\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 974, "user_id": 3829232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?s=128&d=identicon&r=PG", "display_name": "soupi", "link": "https://stackoverflow.com/users/3829232/soupi"}, "is_accepted": false, "score": 1, "last_activity_date": 1479317995, "creation_date": 1479317995, "answer_id": 40638731, "question_id": 40638605, "link": "https://stackoverflow.com/questions/40638605/access-the-next-element-of-data/40638731#40638731", "title": "Access the next element of &#39;data&#39;", "body": "<p>You use the class function for <code>Enum</code>: <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:succ\" rel=\"nofollow noreferrer\">succ</a>.</p>\n"}], "owner": {"reputation": 1015, "user_id": 6391764, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae6eb3e43b8792b2ce6fa3743e01a750?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre P.", "link": "https://stackoverflow.com/users/6391764/pierre-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 435, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1479338787, "creation_date": 1479317604, "last_edit_date": 1479338787, "question_id": 40638605, "link": "https://stackoverflow.com/questions/40638605/access-the-next-element-of-data", "title": "Access the next element of &#39;data&#39;", "body": "<p>I have defined this data <code>data MonthData = Jan | Feb | Mar | Apr | May | Jun | Jul | Aug | Sep | Oct | Nov | Dec deriving ( Eq, Show, Enum, Ord )</code></p>\n\n<p><strong>How can I implicitly access an element given its previous one?</strong></p>\n\n<p>For instance, I have a <em>Jan</em> and I want to access to <em>Feb</em> without explicitly typing <em>Feb</em></p>\n\n<p>Cheers</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1479316962, "post_id": 40638337, "comment_id": 68509017, "body": "There is a typo in the formula (<code>b * 2</code> rather than <code>b ^ 2</code>)."}, {"owner": {"reputation": 631, "user_id": 3655314, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/pmVr3.jpg?s=128&g=1", "display_name": "HansMusterWhatElse", "link": "https://stackoverflow.com/users/3655314/hansmusterwhatelse"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479317050, "post_id": 40638337, "comment_id": 68509074, "body": "awesome! I could swear I was checking the formula at least 3 times but couldn&#39;t see the typo ..."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1479318257, "post_id": 40638337, "comment_id": 68509800, "body": "You are aware this won&#39;t work for equations like <code>x^2 + 1</code> (<code>quadformula 1 0 1</code>), right?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1479318516, "post_id": 40638337, "comment_id": 68509943, "body": "It&#39;s a good habit to always add a type signature for top-level functions, so to help the compiler produce better type error messages when inevitably we get them. Also <code>[x,y]</code> is more readable than <code>[x]++[y]</code>."}], "owner": {"reputation": 631, "user_id": 3655314, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/pmVr3.jpg?s=128&g=1", "display_name": "HansMusterWhatElse", "link": "https://stackoverflow.com/users/3655314/hansmusterwhatelse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 306, "favorite_count": 0, "closed_date": 1479320157, "answer_count": 0, "score": 2, "last_activity_date": 1479316966, "creation_date": 1479316708, "last_edit_date": 1479316966, "question_id": 40638337, "link": "https://stackoverflow.com/questions/40638337/haskell-quadratic-formula", "closed_reason": "Not suitable for this site", "title": "Haskell - Quadratic Formula", "body": "<p>Today I started reading a book regarding Haskell and told myself I give it a try to implemement something basic such as the \"quadratic formula\".</p>\n\n<pre><code>quadHelper a b c op = (-b `op` sqrt (b * 2 - 4 * a * c)) / (2 * a)\nquadFormula a b c = [quadHelper a b c (+)] ++ [quadHelper a b c (-)]  \n</code></pre>\n\n<p>Unfortunately, my first implementation doesn't work as expected and I get <code>[NaN, NaN]</code> as a result for <code>quadFormula 5 6 1</code></p>\n\n<p>Does anyone have an idea what I've missed?</p>\n"}, {"tags": ["haskell", "tree", "show"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 29, "user_id": 3343983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f953094309aef6da3eda35f7f22bf957?s=128&d=identicon&r=PG&f=1", "display_name": "Aeron", "link": "https://stackoverflow.com/users/3343983/aeron"}, "edited": false, "score": 1, "creation_date": 1479301841, "post_id": 40631797, "comment_id": 68498346, "body": "@Aeron GHCi often produces better errors -- Hugs is no longer developed while GHC is. Indeed, the GHCi error contains a probable cause: &quot;(maybe you haven&#39;t applied a function to enough arguments?)&quot;"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1479298006, "creation_date": 1479298006, "answer_id": 40631797, "question_id": 40631635, "link": "https://stackoverflow.com/questions/40631635/cannot-find-show-function-error-when-parameter-is-instance-of-show/40631797#40631797", "title": "&#39;Cannot find &quot;show&quot; function&#39; error when parameter is instance of Show", "body": "<p>Look at the type of <code>debugFunction</code>.</p>\n\n<pre><code>debugFunction :: Show a =&gt; a -&gt; Tree a -&gt; Bool\n</code></pre>\n\n<p><code>debugFunction</code> expects two arguments, the second of which is a <code>Tree a</code>. You're only passing it one. The type checker sees that you're passing a <code>Tree Int</code> as the first argument and infers <code>a ~ Tree Int</code>. So <code>debugFunction getDebugTree</code> is a <em>function</em> waiting for a second argument of type <code>Tree (Tree Int)</code>.</p>\n\n<pre><code>debugFunction getDebugTree :: Tree (Tree Int) -&gt; Bool\n</code></pre>\n\n<p>I suspect you intended to use <code>getDebugTree</code> as the second argument to <code>debugFunction</code>, which means you need to come up with an <code>Int</code> to use as the first one.</p>\n\n<pre><code>debugFunction 0 getDebugTree :: Bool\n</code></pre>\n\n<p>The error message about the missing <code>Show</code> instance comes from the REPL itself. It's attempting to print out the result of <code>debugFunction getDebugTree</code>, but it can't because functions can't be shown.</p>\n"}], "owner": {"reputation": 29, "user_id": 3343983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f953094309aef6da3eda35f7f22bf957?s=128&d=identicon&r=PG&f=1", "display_name": "Aeron", "link": "https://stackoverflow.com/users/3343983/aeron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 809, "favorite_count": 0, "accepted_answer_id": 40631797, "answer_count": 1, "score": 0, "last_activity_date": 1479298006, "creation_date": 1479297539, "question_id": 40631635, "link": "https://stackoverflow.com/questions/40631635/cannot-find-show-function-error-when-parameter-is-instance-of-show", "title": "&#39;Cannot find &quot;show&quot; function&#39; error when parameter is instance of Show", "body": "<p>The following error is triggered:</p>\n\n<pre><code>ERROR - Cannot find \"show\" function for:\n*** Expression : debugFunction getDebugTree\n*** Of type    : Tree (Tree Int) -&gt; Bool\n</code></pre>\n\n<p>when running <code>debugFunction getDebugTree</code></p>\n\n<pre><code>data Tree a = Empty | Node a (Tree a) (Tree a) deriving (Eq, Show)\n\ngetDebugTree :: Tree Int\ngetDebugTree = (Node 1 (Empty) (Node 2 Empty Empty))\n\ndebugFunction :: Show a =&gt; a -&gt; Tree a -&gt; Bool\ndebugFunction _ _ = True\n</code></pre>\n\n<p>I've read that</p>\n\n<blockquote>\n  <p>reverse []</p>\n  \n  <p>ERROR: Cannot find \"show\" function for: \n  <strong>* expression  : reverse [] \n  *</strong> of type     : [a]</p>\n  \n  <p>The top-level system for Hugs can only print values which belong to a\n  type which can be shown, that is a type which belongs to the Show\n  class. Now, the list type is an instance of Show, so what is wrong\n  with reverse [] (which evaluates to [])? The problem is that the type\n  of [] is polymorphic: [] :: [a] for all a. Not knowing a Hugs refuses\n  to print a value of type [a]. Note that this behaviour applies to all\n  polymorphic values. Given the definition</p>\n  \n  <p>data Tree a = Empty | Node (Tree a) a (Tree a)</p>\n  \n  <p>we have, on evaluating</p>\n  \n  <p>Empty</p>\n  \n  <p>the error message</p>\n  \n  <p>ERROR: Cannot find \"show\" function for: \n  <strong>* expression  : Empty \n  *</strong> of type     : Tree a</p>\n  \n  <p>Functions can be shown, but not very helpfully; printing any function\n  results in</p>\n  \n  <p>&lt;&lt; function>></p>\n</blockquote>\n\n<p>As far as I understand Hugs doesn't know a so it refuses to print it (even though I'm printing a Bool?) so I've tried to make a be an instance of Show, but it still doesn't work, what's the problem here?</p>\n"}, {"tags": ["parsing", "haskell"], "comments": [{"owner": {"reputation": 9, "user_id": 7165653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c5672043371f1c081b2fab757339220?s=128&d=identicon&r=PG&f=1", "display_name": "Kayanda", "link": "https://stackoverflow.com/users/7165653/kayanda"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1479275970, "post_id": 40624589, "comment_id": 68483624, "body": "Not sure how to address the problem. I&#39;m not sure how to apply priority to the first parser so that if it succeeds the program does not go onto check the second parser. And then upon failure have the code check the second parser. If i simply wanted to combine the two parsers I could use mplus or msum, but I&#39;m not sure how to then reduce that to only return 1 value. I&#39;m not sure how to approach this."}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 1, "creation_date": 1479276027, "post_id": 40624589, "comment_id": 68483651, "body": "Start by thinking about what a failed parse loos like."}, {"owner": {"reputation": 9, "user_id": 7165653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c5672043371f1c081b2fab757339220?s=128&d=identicon&r=PG&f=1", "display_name": "Kayanda", "link": "https://stackoverflow.com/users/7165653/kayanda"}, "edited": false, "score": 0, "creation_date": 1479276574, "post_id": 40624589, "comment_id": 68483866, "body": "an empty list correct, but the issue is that If both parsers succeed and are combined I get both results. In this case I only want the first parser if it succeeds. If the first or second one fails, then (&lt;++) is equivalent to <code>mplus</code>. If the both succeed then they are no longer equivalent. How should I address this case"}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 2, "creation_date": 1479277048, "post_id": 40624589, "comment_id": 68484053, "body": "Run one, check the result, conditionally run the next."}, {"owner": {"reputation": 9, "user_id": 7165653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c5672043371f1c081b2fab757339220?s=128&d=identicon&r=PG&f=1", "display_name": "Kayanda", "link": "https://stackoverflow.com/users/7165653/kayanda"}, "edited": false, "score": 0, "creation_date": 1479277231, "post_id": 40624589, "comment_id": 68484110, "body": "the definition of &lt;++ is that it takes two parser and returns a new parser. Because of this I can&#39;t runParser along with the initial state to see what i get. If you meant something different from this could you further explain it."}, {"owner": {"reputation": 9, "user_id": 7165653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c5672043371f1c081b2fab757339220?s=128&d=identicon&r=PG&f=1", "display_name": "Kayanda", "link": "https://stackoverflow.com/users/7165653/kayanda"}, "edited": false, "score": 0, "creation_date": 1479277274, "post_id": 40624589, "comment_id": 68484122, "body": "this site contains the source code for which I am trying to implement. <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Text-ParserCombinators-ReadP.html#v:-60--43--43-\" rel=\"nofollow noreferrer\">Document</a>"}, {"owner": {"reputation": 9, "user_id": 7165653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c5672043371f1c081b2fab757339220?s=128&d=identicon&r=PG&f=1", "display_name": "Kayanda", "link": "https://stackoverflow.com/users/7165653/kayanda"}, "edited": false, "score": 0, "creation_date": 1479279904, "post_id": 40624589, "comment_id": 68485244, "body": "(&lt;++) can be used for left-biased sum, where the second parser is used only if the first parser fails"}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 7165653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c5672043371f1c081b2fab757339220?s=128&d=identicon&r=PG&f=1", "display_name": "Kayanda", "link": "https://stackoverflow.com/users/7165653/kayanda"}, "edited": false, "score": 0, "creation_date": 1479314684, "post_id": 40630603, "comment_id": 68507450, "body": "Thank you, I tried a similar method, but forgot to wrap the lambda function  in parser so the type check failed. This makes total sense now."}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "reply_to_user": {"reputation": 9, "user_id": 7165653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c5672043371f1c081b2fab757339220?s=128&d=identicon&r=PG&f=1", "display_name": "Kayanda", "link": "https://stackoverflow.com/users/7165653/kayanda"}, "edited": false, "score": 0, "creation_date": 1479316597, "post_id": 40630603, "comment_id": 68508767, "body": "@Kayanda it is customary on Stackoverflow to mark an answer as accepted using the checkmark beside the score if that answer is sufficient."}], "tags": [], "owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "is_accepted": false, "score": 3, "last_activity_date": 1479294511, "creation_date": 1479294511, "answer_id": 40630603, "question_id": 40624589, "link": "https://stackoverflow.com/questions/40624589/implementing-within-a-haskell-parser/40630603#40630603", "title": "Implementing (&lt;++) within a Haskell Parser", "body": "<p>Your parser are functions <code>String -&gt; [(a,String)]</code> where the argument is the initial state. So lets construct such a function that tries the first parser, and if it fails tries the second parser:</p>\n\n<pre><code>(&lt;++) :: Parser a -&gt; Parser a -&gt; Parser a\np1 &lt;++ p2 =\n  parser $ \\s0 -&gt;            -- 1. captures initial state\n    case runParser p1 s0 of  -- 2. run first parser\n      (x:xs) -&gt; x : xs       -- 3. success\n      [] -&gt; runParser p2 s0  -- 4. otherwise run second parser\n</code></pre>\n\n<p>Some parsers to try this out</p>\n\n<pre><code>-- | Always fails\nfailP :: Parser a\nfailP = parser (const [])\n\n-- | Parses an Int\nintP :: Parser Int\nintP = parser reads\n</code></pre>\n\n<p>Output as expected? (Perhaps there are more enlightening test cases...)</p>\n\n<pre><code>\u03bb&gt; runParser (failP &lt;++ intP) \"2014\"\n[(2014,\"\")]\n\u03bb&gt; runParser (intP &lt;++ failP) \"2014\"\n[(2014,\"\")]\n\u03bb&gt; runParser (intP &lt;++ intP) \"2014\"\n[(2014,\"\")]\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 7165653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c5672043371f1c081b2fab757339220?s=128&d=identicon&r=PG&f=1", "display_name": "Kayanda", "link": "https://stackoverflow.com/users/7165653/kayanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 310, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1479294511, "creation_date": 1479273663, "question_id": 40624589, "link": "https://stackoverflow.com/questions/40624589/implementing-within-a-haskell-parser", "title": "Implementing (&lt;++) within a Haskell Parser", "body": "<p>The goal of this is to implement &lt;++ in Haskell using StateT to act as a parser</p>\n\n<pre><code>    import Control.Monad.State\n\n    type Parser = StateT String []\n\n    runParser :: Parser a -&gt; String -&gt; [(a,String)]\n    runParser = runStateT\n\n    parser :: (String -&gt; [(a,String)]) -&gt; Parser a\n    parser = StateT\n\n    (&lt;++) :: Parser a -&gt; Parser a -&gt; Parser a\n</code></pre>\n\n<p>From this base, how could I implement &lt;++ so that it mirrors the definition in Text.ParserCombinators.ReadP</p>\n\n<p>Local, exclusive, left-biased choice: If left parser locally produces any result at all, then right parser is not used.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1479274831, "post_id": 40624579, "comment_id": 68483191, "body": "You have only defined classes, not instances of them."}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1479275227, "post_id": 40624579, "comment_id": 68483335, "body": "Right, does a typeclass need an instance defined in order to compile?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 2, "creation_date": 1479276874, "post_id": 40624579, "comment_id": 68483973, "body": "You seen to confuse haskell typeclasses with classes from OOP world. Typeclasses can be approximated to interfaces, not classes. So yes, you need to have some datatypes to be part of your typeclass (like interface should have classes that implement it)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1479286239, "post_id": 40624579, "comment_id": 68488383, "body": "Yet another quantification problem: <code>tigerWeight :: (Ord o) =&gt; a -&gt; o</code> means that the type <code>o</code> is chosen by the <i>caller</i>, not by the function. This function is promising to convert a tiger (precisely, any type in the <code>Tiger</code> class) into any of these types <code>Bool, [String], [(Int,Char)], ...</code> -- indeed, any type which is ordered. This is not what you want."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 4, "last_activity_date": 1479280651, "creation_date": 1479280651, "answer_id": 40626157, "question_id": 40624579, "link": "https://stackoverflow.com/questions/40624579/could-not-deduce-ord-a0-arising-from-a-use-of/40626157#40626157", "title": "Could not deduce (Ord a0) arising from a use of \u2018&gt;\u2019", "body": "<blockquote>\n  <p>'x' and 'y' are in the Zoo typeclass, and therefore should support the 'tiger' method</p>\n</blockquote>\n\n<p>They do, but it's not known <em>which</em> inhabitant of the <code>Tiger</code> typeclass you want. If we look at the <code>tiger</code>'s complete type signature,</p>\n\n<pre><code>tiger :: (Zoo a, Tiger t) =&gt; a -&gt; t\n</code></pre>\n\n<p>we can see that <code>a</code> will be deduced by the argument you give <code>tiger</code>, but what will <code>t</code> be? There needs to be a specific instance (which you don't have), and it needs to be unambiguous.</p>\n\n<blockquote>\n  <p>(tiger x) is in the 'Tiger' typeclass, as marked by the 'tiger' method's signature.</p>\n</blockquote>\n\n<p>Again, there is no instance of <code>Tiger</code>. Or, to speak with OO terms, there is only the interface, but not something that implements that interface.</p>\n\n<blockquote>\n  <p>(tigerWeight (tiger x)) therefore should be able to be applied, and is known to be a member of the 'Ord' class, as marked by the 'tigerWeight' method's signature.</p>\n</blockquote>\n\n<p>The <code>Ord</code> typeclass is rather large. You have to specify <em>which</em> instance you want. It's not clear, which one you want, since all of them support <code>&gt;</code>.</p>\n\n<p>Compare that to <code>read :: (Read a) =&gt; String -&gt; a</code>. As long as you don't specify the <code>a</code>, it's not clear how the string should get parsed.</p>\n\n<pre><code>read \"1\" :: Int\n</code></pre>\n\n<p>will work, but</p>\n\n<pre><code>read \"1\" :: [Int]\n</code></pre>\n\n<p>should fail. That choice needs to be done.</p>\n\n<p>By the way, there is no sensilbe way to write <code>tiger :: Ord a =&gt; a -&gt; o</code> since you cannot create arbitrary <code>Ord</code> values.</p>\n\n<hr>\n\n<p>That being said, you're approaching that problem from the wrong side. A <code>Tiger</code> is a very specific animal. There is no need for a <code>typeclass</code>:</p>\n\n<pre><code>data Tiger = ...\n</code></pre>\n\n<p>Afterwards, you can write a completely normal function that returns the actual weight:</p>\n\n<pre><code>type Weight = Int\n\ntigerWeight :: Tiger -&gt; Weight\ntigerWeight t = ...\n\ndata Zoo = ...\n\ntiger :: Zoo -&gt; Tiger\n</code></pre>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 898, "favorite_count": 0, "accepted_answer_id": 40626157, "answer_count": 1, "score": 3, "last_activity_date": 1479280651, "creation_date": 1479273616, "question_id": 40624579, "link": "https://stackoverflow.com/questions/40624579/could-not-deduce-ord-a0-arising-from-a-use-of", "title": "Could not deduce (Ord a0) arising from a use of \u2018&gt;\u2019", "body": "<p>I am getting compile-time errors related to typeclasses that I'm trying to create.</p>\n\n<p>My program:</p>\n\n<pre><code>main = print \"here\"\n\n\nclass Tiger a where\n  tigerWeight :: (Ord o) =&gt; a -&gt; o\n\nclass Zoo a where\n  tiger :: (Tiger t) =&gt; a -&gt; t\n  tigerHeavier :: a -&gt; a -&gt; Bool\n  tigerHeavier x y =\n    (tigerWeight (tiger x)) &gt; (tigerWeight (tiger y))\n</code></pre>\n\n<p>gives compile errors:</p>\n\n<pre><code>$ ghc zoo\n[1 of 1] Compiling Main             ( zoo.hs, zoo.o )\n\nzoo.hs:14:5: error:\n    \u2022 Could not deduce (Ord a0) arising from a use of \u2018&gt;\u2019\n      from the context: Zoo a\n        bound by the class declaration for \u2018Zoo\u2019 at zoo.hs:(10,1)-(14,53)\n      The type variable \u2018a0\u2019 is ambiguous\n      These potential instances exist:\n        instance Ord Ordering -- Defined in \u2018GHC.Classes\u2019\n        instance Ord Integer\n          -- Defined in \u2018integer-gmp-1.0.0.1:GHC.Integer.Type\u2019\n        instance Ord a =&gt; Ord (Maybe a) -- Defined in \u2018GHC.Base\u2019\n        ...plus 22 others\n        ...plus two instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the expression:\n        (tigerWeight (tiger x)) &gt; (tigerWeight (tiger y))\n      In an equation for \u2018tigerHeavier\u2019:\n          tigerHeavier x y\n            = (tigerWeight (tiger x)) &gt; (tigerWeight (tiger y))\n\nzoo.hs:14:6: error:\n    \u2022 Could not deduce (Tiger a1) arising from a use of \u2018tigerWeight\u2019\n      from the context: Zoo a\n        bound by the class declaration for \u2018Zoo\u2019 at zoo.hs:(10,1)-(14,53)\n      The type variable \u2018a1\u2019 is ambiguous\n    \u2022 In the first argument of \u2018(&gt;)\u2019, namely \u2018(tigerWeight (tiger x))\u2019\n      In the expression:\n        (tigerWeight (tiger x)) &gt; (tigerWeight (tiger y))\n      In an equation for \u2018tigerHeavier\u2019:\n          tigerHeavier x y\n            = (tigerWeight (tiger x)) &gt; (tigerWeight (tiger y))\n\nzoo.hs:14:32: error:\n    \u2022 Could not deduce (Tiger a2) arising from a use of \u2018tigerWeight\u2019\n      from the context: Zoo a\n        bound by the class declaration for \u2018Zoo\u2019 at zoo.hs:(10,1)-(14,53)\n      The type variable \u2018a2\u2019 is ambiguous\n    \u2022 In the second argument of \u2018(&gt;)\u2019, namely \u2018(tigerWeight (tiger y))\u2019\n      In the expression:\n        (tigerWeight (tiger x)) &gt; (tigerWeight (tiger y))\n      In an equation for \u2018tigerHeavier\u2019:\n          tigerHeavier x y\n            = (tigerWeight (tiger x)) &gt; (tigerWeight (tiger y))\n</code></pre>\n\n<p>Why is this? It seems that all the types should be deducible. In particular:</p>\n\n<ul>\n<li><p>'x' and 'y' are in the Zoo typeclass, and therefore should support the 'tiger' method.</p></li>\n<li><p>(tiger x) is in the 'Tiger' typeclass, as marked by the 'tiger' method's signature.</p></li>\n<li><p>(tigerWeight (tiger x)) therefore should be able to be applied, and is known to be a member of the 'Ord' class, as marked by the 'tigerWeight' method's signature.</p></li>\n</ul>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1479274328, "post_id": 40623699, "comment_id": 68483033, "body": "you may want to read <a href=\"https://www.fpcomplete.com/blog/2016/10/static-compilation-with-stack\" rel=\"nofollow noreferrer\">fpcomplete.com/blog/2016/10/static-compilation-with-stack</a>"}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1479274338, "post_id": 40623699, "comment_id": 68483034, "body": "another tip: stack clean before you change your ghc-options"}, {"owner": {"reputation": 148, "user_id": 6765537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de81569281aa0cff6985a18e9e291168?s=128&d=identicon&r=PG&f=1", "display_name": "xuh", "link": "https://stackoverflow.com/users/6765537/xuh"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1479321218, "post_id": 40623699, "comment_id": 68511514, "body": "Thanks for the suggestions. I tried <code>stack clean</code> but it still only recompile local targets and dependencies specified in <code>extra-deps</code>."}], "owner": {"reputation": 148, "user_id": 6765537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de81569281aa0cff6985a18e9e291168?s=128&d=identicon&r=PG&f=1", "display_name": "xuh", "link": "https://stackoverflow.com/users/6765537/xuh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1479267900, "creation_date": 1479267900, "question_id": 40623699, "link": "https://stackoverflow.com/questions/40623699/how-to-build-dependencies-in-snapshot-with-fpic-using-haskell-stack", "title": "how to build dependencies in snapshot with -fPIC using Haskell stack", "body": "<p>I am trying to make stack 1.2.0, Ubuntu 16.04 system package, build dependencies from a snapshot with <code>-fPIC</code>.</p>\n\n<p>I tried adding the following in the <code>&lt;user&gt;/.stack/config.yaml</code> file.</p>\n\n<pre><code>ghc-options:\n  \"*\": -fPIC\n\nrebuild-ghc-options: true\n\napply-ghc-options: everything\n</code></pre>\n\n<p>But it seems that it only affects local targets and dependencies specified in <code>extra-deps</code>. The dependencies in the snapshot are still not built with <code>-fPIC</code>. </p>\n\n<p>I also tried <code>stack build --ghc-options='-fPIC'</code> from the command line, in addition to the modifications to the <code>config.yaml</code> file and it didn't work either.</p>\n\n<p>What is the correct way to enabling stack to build dependencies from a snapshot with <code>-fPIC</code>?</p>\n"}, {"tags": ["class", "haskell", "polymorphism", "instance"], "comments": [{"owner": {"reputation": 5384, "user_id": 736957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10421ea904bf36d23d1669a6b8c21648?s=128&d=identicon&r=PG", "display_name": "laughedelic", "link": "https://stackoverflow.com/users/736957/laughedelic"}, "edited": false, "score": 1, "creation_date": 1479265072, "post_id": 40623122, "comment_id": 68480593, "body": "Have you tried <a href=\"http://stackoverflow.com/a/3864801/736957\"><code>deriving</code></a>? See also <a href=\"https://wiki.haskell.org/GHC.Generics\" rel=\"nofollow noreferrer\">GHC.Generics wiki</a>."}, {"owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "reply_to_user": {"reputation": 5384, "user_id": 736957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10421ea904bf36d23d1669a6b8c21648?s=128&d=identicon&r=PG", "display_name": "laughedelic", "link": "https://stackoverflow.com/users/736957/laughedelic"}, "edited": false, "score": 0, "creation_date": 1479265379, "post_id": 40623122, "comment_id": 68480674, "body": "I just forget about it. Thanks. I&#39;ll try it."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479298928, "post_id": 40623122, "comment_id": 68496496, "body": "A <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#default-method-signatures\" rel=\"nofollow noreferrer\">default signature</a> on the functions inside <code>ForA</code> and <code>ForB</code> would allow you to simply write <code>instance ForA X</code> for an appropriately defined <code>X</code>."}], "owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1479264938, "creation_date": 1479263477, "last_edit_date": 1479264938, "question_id": 40623122, "link": "https://stackoverflow.com/questions/40623122/implement-short-hand-instance-for-haskell", "title": "Implement short-hand instance for Haskell", "body": "<p>When there are many data types which have almost same structure, how can I implement without almost-duplicated codes?</p>\n\n<p>Here is uncompilable code sample to explain the goal.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>{-# LANGUAGE DuplicateRecordFields #-}\n\nclass Category a where\n  method :: a -&gt; String\n\nclass ForB b where\n  ...\nclass ForC c where\n  ...\n\ndata A = A {someA :: String, ...}\n\ndata B1 = B1 {some :: Int, ...}\ndata B2 = B2 {some :: Int, ...}\n...\n\ndata C1 = C1 {some :: Int, ...}\ndata C2 = C2 {some :: Int, ...}\n...\n\ninstance Category A where\n  method (A x) = x\n\n-- Cannot be compiled, but I want to write like this.\ninstance Category a where\n  method = show . some\n\ninstance ForB B1 where\n  ....\n\ninstance ForC C1 where\n  ....\n\nmain = do\n  let a = A \"1\"\n      b = B1 2\n      c = C1 3\n  print . method $ a\n  print . method $ b\n  print . method $ c\n</code></pre>\n\n<p>I understand that <code>instance</code> does not take type variable <code>a</code> like <code>instance Something a</code> but takes only real data type; Is there no polymorphic instance?<br>\nI've tried to solve this by introducing new classes like <a href=\"http://lpaste.net/339868\" rel=\"nofollow noreferrer\">this</a>, but could not figure it out.\nI concerned phantom types or type families, but I could not find any solution.</p>\n\n<p>I do not want to implement almost same code for each data types.\nPlease refer better explanation and sample to the goal on the background.</p>\n\n<p><strong>Is there any way to short-hand to implement polymorphic(?) instances</strong> without reducing data type or Template Haskell (lens,record,extensive package).</p>\n\n<h1>Background</h1>\n\n<p>I'm preparing series of sample code for transition from OOP to a functional approach.</p>\n\n<p><a href=\"http://lpaste.net/339858\" rel=\"nofollow noreferrer\">Here</a> is the simplified base code of the explanation.\nAnd <a href=\"http://lpaste.net/339860\" rel=\"nofollow noreferrer\">here</a> is little improvement with <code>DuplicateRecordFields</code>.<br>\nYou can see there are massive instance implements.\n(Please do not ask me why do not combine <code>LifeInfo</code>, <code>AnimalInfo</code> and <code>Human</code> in a data type. This is one of the series to solve bunch of problems)<br>\nHowever, to implement <code>Human</code>, <code>Elf</code>, <code>Pine</code> and <code>Rose</code>, I write almost same instances for each. And there are some exceptions for <code>LifeInfo</code>, <code>AnimalInfo</code>, and <code>PlantInfo</code>.</p>\n\n<h1>Some points</h1>\n\n<ul>\n<li>Do not combine entry data types(<code>A</code>, <code>B</code>, and <code>C</code>) to a data type by using data constructor like <code>data ABC = A {..} | B {..} | C {..}</code>.<br>\nBut when you can introduce a method for distinguishing each of them by type-checking or implement class-method like things, it will be good.<br>\nPlease notice that there are classes <code>ForB</code> and <code>ForC</code>.</li>\n<li>I'm avoiding Template Haskell and libraries using TH to solve this problem.</li>\n</ul>\n"}, {"tags": ["python", "performance", "haskell", "factoring"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1479266110, "post_id": 40622907, "comment_id": 68480859, "body": "This has nothing to do with performance, but you should not use <code>read</code> to process user input. Import <code>Text.Read</code> and use <code>readMaybe</code>. This will allow you to handle errors properly."}, {"owner": {"reputation": 50347, "user_id": 1763356, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/zGWG9.png?s=128&g=1", "display_name": "Veedrac", "link": "https://stackoverflow.com/users/1763356/veedrac"}, "edited": false, "score": 2, "creation_date": 1479289746, "post_id": 40622907, "comment_id": 68490547, "body": "FWIW, that Python code would be a lot nicer if expressed imperatively. <a href=\"https://gist.github.com/Veedrac/e937a728b227c9dd576a8c26e4058536\" rel=\"nofollow noreferrer\">Aka. this code.</a> With PyPy it&#39;s 3x the speed of Cactus&#39; if Haskell uses big integers (like Python), and a reasonable 85% if Haskell gets to use fixed width ints."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1479294151, "post_id": 40622907, "comment_id": 68493541, "body": "Note that test cases like this with &lt; 1 s total program runtime are hardly useful to compare real-world performance. Haskell is reasonably quick to start, but it still needs some \u201cruntime warm-up\u201d."}, {"owner": {"reputation": 65, "user_id": 6389041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zSipv.jpg?s=128&g=1", "display_name": "jdw1996", "link": "https://stackoverflow.com/users/6389041/jdw1996"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1479326881, "post_id": 40622907, "comment_id": 68514688, "body": "@dfeuer -- I wasn&#39;t too worried about error-handling here, but that&#39;s good to keep in mind. Thanks!  @Veedrac -- Your Python program is a lot cleaner than mine. I haven&#39;t used <code>yield</code> before, but it seems really handy.  @leftaroundabout -- I know such small tests aren&#39;t generally reliable, but I haven&#39;t heard of the idea of this &quot;warm-up&quot; time before. That&#39;s really interesting; thank you."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 50347, "user_id": 1763356, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/zGWG9.png?s=128&g=1", "display_name": "Veedrac", "link": "https://stackoverflow.com/users/1763356/veedrac"}, "edited": false, "score": 0, "creation_date": 1479327217, "post_id": 40622907, "comment_id": 68514854, "body": "@Veedrac, I think there&#39;s some room for further optimization of the Haskell code; see my answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1479327503, "post_id": 40622907, "comment_id": 68515026, "body": "@jdw1996, yes, the Haskell runtime system takes a non-trivial amount of time to start itself up before beginning to run user code. It certainly has to set up some data structures to manage garbage collection, I imagine it likely loads a number of libraries, I believe it allocates Haskell handles for standard input/output/error, and it may have other &quot;administrative&quot; work as well."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 13, "last_activity_date": 1479262871, "creation_date": 1479262871, "answer_id": 40623043, "question_id": 40622907, "link": "https://stackoverflow.com/questions/40622907/haskell-slower-than-python-in-na%c3%afve-integer-factorization/40623043#40623043", "title": "Haskell slower than Python in na&#239;ve integer factorization?", "body": "<p>If you compute <code>limit = ceiling . sqrt . fromIntegral $ n</code> only once, instead of once per iteration, then I see the Haskell version being faster:</p>\n\n<pre><code>limit = ceiling . sqrt . fromIntegral $ n\nsmallestFactor = getSmallestFactor x\n\ngetSmallestFactor x\n    | n `rem` x == 0 = x\n    | x &gt; limit      = n\n    | otherwise      = getSmallestFactor (x+1)\n</code></pre>\n\n<p>using this version, I see:</p>\n\n<pre><code>$ time ./factorizePy.py 89273487253497\n[3, 723721, 41117819]\n\nreal    0m0.236s\nuser    0m0.171s\nsys     0m0.062s\n\n$ time ./factorizeHs  89273487253497\n[3,723721,41117819]\n\nreal    0m0.190s\nuser    0m0.000s\nsys     0m0.031s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1479338625, "last_edit_date": 1479338625, "creation_date": 1479327185, "answer_id": 40641447, "question_id": 40622907, "link": "https://stackoverflow.com/questions/40622907/haskell-slower-than-python-in-na%c3%afve-integer-factorization/40641447#40641447", "title": "Haskell slower than Python in na&#239;ve integer factorization?", "body": "<p>Beyond the critical point Cactus made, there is also some room here for some refactoring and strictness annotations to avoid creating unnecessary thunks. Note in particular that <code>factorize</code> is lazy:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>factorize' undefined undefined = undefined : undefined\n</code></pre>\n\n<p>This isn't really necessary, and forces GHC to allocate several thunks. Extra laziness elsewhere does the same. I expect you'll get somewhat better performance like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE BangPatterns #-}\n\nfactorize' :: Integral a =&gt; a -&gt; a -&gt; [a]\nfactorize' n x\n  | smallestFactor == n = [smallestFactor]\n  | otherwise = smallestFactor : factorize' (n `quot` smallestFactor) smallestFactor\n  where\n    smallestFactor = getSmallestFactor n (ceiling . sqrt . fromIntegral $ n) x\n    getSmallestFactor n !limit x\n       | n `rem` x == 0 = x\n       | x &gt; limit = n\n       | otherwise = getSmallestFactor n limit (x+1)\n\n-- Return a list representing the prime factorization of n.\nfactorize :: Integral a =&gt; a -&gt; [a]\nfactorize n = factorize' n 2\n</code></pre>\n\n<p>I made <code>getSmallestFactor</code> take both <code>n</code> and the limit as arguments. This prevents <code>getSmallestFactor</code> from being allocated as a closure on the heap. I'm not sure whether that's worth the extra argument shuffling; you can try that both ways.</p>\n"}], "owner": {"reputation": 65, "user_id": 6389041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zSipv.jpg?s=128&g=1", "display_name": "jdw1996", "link": "https://stackoverflow.com/users/6389041/jdw1996"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 40623043, "answer_count": 2, "score": 4, "last_activity_date": 1479338625, "creation_date": 1479261946, "last_edit_date": 1495540795, "question_id": 40622907, "link": "https://stackoverflow.com/questions/40622907/haskell-slower-than-python-in-na%c3%afve-integer-factorization", "title": "Haskell slower than Python in na&#239;ve integer factorization?", "body": "<p>I'm taking a math course where we had to do some integer factorizations as an intermediate step to a problem. I decided to write a Python program to do this for me (we weren't being tested on our ability to factor, so this is completely above board). The program is as follows:</p>\n\n<pre><code>#!/usr/bin/env python3\n\nimport math\nimport sys\n\n# Return a list representing the prime factorization of n. The factorization is\n#   found using trial division (highly inefficient).\ndef factorize(n):\n\n    def factorize_helper(n, min_poss_factor):\n        if n &lt;= 1:\n            return []\n        prime_factors = []\n        smallest_prime_factor = -1\n        for i in range(min_poss_factor, math.ceil(math.sqrt(n)) + 1):\n            if n % i == 0:\n                smallest_prime_factor = i\n                break\n        if smallest_prime_factor != -1:\n            return [smallest_prime_factor] \\\n                   + factorize_helper(n // smallest_prime_factor,\n                                      smallest_prime_factor)\n        else:\n            return [n]\n\n    if n &lt; 0:\n        print(\"Usage: \" + sys.argv[0] + \" n   # where n &gt;= 0\")\n        return []\n    elif n == 0 or n == 1:\n        return [n]\n    else:\n        return factorize_helper(n, 2)\n\nif __name__ == \"__main__\":\n    factorization = factorize(int(sys.argv[1]))\n    if len(factorization) &gt; 0:\n        print(factorization)\n</code></pre>\n\n<p>I've been teaching myself some Haskell as well, so I decided to try rewriting the program in Haskell. That program is as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import System.Environment\n\n-- Return a list containing all factors of n at least x.\nfactorize' :: (Integral a) =&gt; a -&gt; a -&gt; [a]\nfactorize' n x = smallestFactor\n                 : (if smallestFactor == n\n                    then []\n                    else factorize' (n `quot` smallestFactor) smallestFactor)\n    where\n        smallestFactor = getSmallestFactor n x\n        getSmallestFactor :: (Integral a) =&gt; a -&gt; a -&gt; a\n        getSmallestFactor n x\n            | n `rem` x == 0                          = x\n            | x &gt; (ceiling . sqrt . fromIntegral $ n) = n\n            | otherwise                               = getSmallestFactor n (x+1)\n\n-- Return a list representing the prime factorization of n.\nfactorize :: (Integral a) =&gt; a -&gt; [a]\nfactorize n = factorize' n 2\n\nmain = do\n    argv &lt;- getArgs\n    let n = read (argv !! 0) :: Int\n    let factorization = factorize n\n    putStrLn $ show (factorization)\n    return ()\n</code></pre>\n\n<p>(note: this requires a 64-bit environment. On 32-bit, import <code>Data.Int</code> and use <code>Int64</code> as the type annotation on <code>read (argv !! 0)</code>)</p>\n\n<p>After I'd written this, I decided to compare the performance of the two, recognizing that there are better algorithms, but that the two programs use essentially the same algorithm. I do, for example, the following:</p>\n\n<pre><code>$ ghc --make -O2 factorize.hs\n$ /usr/bin/time -f \"%Uu %Ss %E\" ./factorize 89273487253497\n[3,723721,41117819]\n0.18u 0.00s 0:00.23\n</code></pre>\n\n<p>Then, timing the Python program:</p>\n\n<pre><code>$ /usr/bin/time -f \"%Uu %Ss %E\" ./factorize.py 89273487253497\n[3, 723721, 41117819]\n0.09u 0.00s 0:00.09\n</code></pre>\n\n<p>Naturally, the times vary slightly each time I run one of the programs, but they are always in this range, with the Python program several times quicker than the compiled Haskell program. It seems to me that the Haskell version should be able to run quicker, and I'm hoping you can give me an idea of how to improve it so that this is the case.</p>\n\n<p>I've seen some tips on optimizing Haskell programs, as in answers to <a href=\"https://stackoverflow.com/questions/6964392/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell\">this question</a>, but can't seem to get my program running any quicker. Are loops this much quicker than recursion? Is Haskell's I/O particularly slow? Have I made a mistake in actually implementing the algorithm? Ideally, I'd like to have an optimized version of the Haskell that is still relatively easy to read</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1479260344, "post_id": 40622232, "comment_id": 68479356, "body": "Well <code>ACE</code> is not <code>Main</code> and <code>ACE</code> (but not <code>Main</code>) is involved in an import cycle with <code>GSI.Thread</code>, so this message hardly seems unreasonable. You have some Template Haskell or something in <code>ACE</code>?"}, {"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1479260992, "post_id": 40622232, "comment_id": 68479500, "body": "@ReidBarton - I don&#39;t understand at all.  You seem to know what this error message means - and Google doesn&#39;t - so maybe you could explain that?  I&#39;m completely lost."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1479261459, "post_id": 40622232, "comment_id": 68479658, "body": "I don&#39;t really know what it means except that it comes from the ghci linker, so you must be using Template Haskell or something like it."}, {"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1479261812, "post_id": 40622232, "comment_id": 68479771, "body": "Right. The problem is that ACE uses Template Haskell from GSI.Value (everything does, it&#39;s necessary for error reporting) but GSI.Value depends (inessentially, just needs types) on GSI.ByteCode, which depends (inessentially, just needs types) on GSI.Thread. Hmm"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1479262042, "post_id": 40622232, "comment_id": 68479820, "body": "I don&#39;t know exactly how TH dependency tracking works, but considering <code>GSI.Thread</code> imports <code>ACE</code> via normal imports (through <code>GSI.Eval</code>), its code surely can&#39;t be available when running splices in <code>ACE</code>."}], "answers": [{"tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": true, "score": 1, "last_activity_date": 1479266910, "creation_date": 1479266910, "answer_id": 40623585, "question_id": 40622232, "link": "https://stackoverflow.com/questions/40622232/ghc-claims-module-only-available-as-a-boot-module-when-it-shouldnt-be/40623585#40623585", "title": "GHC claims module only available as a boot module when it shouldn&#39;t be", "body": "<p>The actual problem was that ACE and GSI.Value had a circular dependency:</p>\n\n<pre><code>ACE -&gt; GSI.Value -&gt; GSI.Thread -&gt; GSI.Eval -&gt; ACE\n</code></pre>\n\n<p>This is an irresolvable problem because ACE uses a function from GSI.Value in a Template Haskell splice.  That requires GHC to dynamically load GSI.Value in order to compile ACE; but that is clearly impossible.</p>\n\n<p>The solution was to move the Thread type out of GSI.Thread, and to a separate module that could avoid any dependency on GSI.Eval or GSI.Value.</p>\n"}], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 40623585, "answer_count": 1, "score": 0, "last_activity_date": 1479266910, "creation_date": 1479256945, "question_id": 40622232, "link": "https://stackoverflow.com/questions/40622232/ghc-claims-module-only-available-as-a-boot-module-when-it-shouldnt-be", "title": "GHC claims module only available as a boot module when it shouldn&#39;t be", "body": "<p>I have this dependency graph (ignoring dependencies on third-party modules):</p>\n\n<pre><code>Main:\n    GSI.Util\n    GSI.Value\n    GSI.Result\n    GSI.Eval\n    GSI.ByteCode\n    GSI.Thread\nGSI.Main:\n    GSI.Value\n    GSI.ByteCode\nGSI.Thread:\n    GSI.Util\n    GSI.RTS\n    GSI.Value\n    GSI.Result\n    GSI.Eval\nGSI.Eval:\n    GSI.Util\n    GSI.RTS\n    GSI.Value\n    GSI.Result\n    ACE\nGSI.Eval (.hs-boot):\n    GSI.Value\nACE:\n    GSI.RTS\n    GSI.Value\n    GSI.ByteCode\n    GSI.Result\n    {-# SOURCE #-} GSI.Eval\nGSI.ByteCode:\n    GSI.Util\n    GSI.Value\n    {-# SOURCE #-} GSI.Thread\nGSI.ByteCode (.hs-boot):\n    {-# SOURCE #-} GSI.Value\n    {-# SOURCE #-} GSI.Thread\nGSI.Result:\n    GSI.Util\n    GSI.RTS\n    GSI.Value\nGSI.Value:\n    GSI.Util\n    GSI.RTS\n    {-# SOURCE #-} GSI.ByteCode\n</code></pre>\n\n<p>(I'd like to cut that graph down further, but I honestly am lost as to which pieces are relevant.  .hs-boot files not listed have no dependencies on my code).  When I do</p>\n\n<pre><code>ghc --make Main.hs\n</code></pre>\n\n<p>I get this message:</p>\n\n<pre><code>[10 of 13] Compiling ACE              ( ACE.hs, ACE.o ) [GSI.ByteCode changed]\nmodule GSI.Thread cannot be linked; it is only available as a boot module\n</code></pre>\n\n<p>What on earth?  I'm importing GSI.Thread not as a boot module from Main, so how can GHC claim it's only available as a boot module?  (And, for that matter, why can't GHC just detect this situation and include the non-boot module automatically?)</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1479250652, "post_id": 40620978, "comment_id": 68476582, "body": "<code>el ++ head xs</code> has type <code>[a]</code> but the accumulator has type <code>[[a]]</code>. You cannot return different types in an <code>if</code> statement."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1479251535, "post_id": 40620978, "comment_id": 68476863, "body": "Are you not aware of <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:group\" rel=\"nofollow noreferrer\"><code>Data.List.group</code></a>?"}], "answers": [{"tags": [], "owner": {"reputation": 682, "user_id": 4088416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1719bb302e6c3d5a78148083e73b7fc1?s=128&d=identicon&r=PG", "display_name": "Jos&#233; Antonio Riaza Valverde", "link": "https://stackoverflow.com/users/4088416/jos%c3%a9-antonio-riaza-valverde"}, "is_accepted": false, "score": 1, "last_activity_date": 1479250661, "creation_date": 1479250661, "answer_id": 40621224, "question_id": 40620978, "link": "https://stackoverflow.com/questions/40620978/grouping-consecutive-duplicates-in-a-list/40621224#40621224", "title": "Grouping consecutive duplicates in a list?", "body": "<p>Using <code>foldr</code>, it should be:</p>\n\n<pre><code>group :: (Eq a) =&gt; [a] -&gt; [[a]]\ngroup = foldr (\\x acc -&gt; if head acc == [] || head (head acc) == x then (x:head acc) : tail acc else [x] : acc) [[]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1479272333, "post_id": 40621294, "comment_id": 68482412, "body": "I&#39;d argue the first, less compact version is the better one. It is more readable, doesn&#39;t test for an empty list with <code>(==)</code> (doing that brings in an <code>Eq</code> constraint needlessly, though in this specific case you&#39;d need <code>Eq</code> anyway), and gives <code>[]</code> rather than <code>[[]]</code> for the empty list, which is a more natural result. On this last point: one might ask to which element a <code>[]</code> &quot;group&quot; corresponds, or whether the last element of <code>func xs</code> should always be <code>[]</code>, given that all lists eventually end with an empty list. Using <code>[]</code> rather than <code>[[]]</code> as the initial accumulator avoids such questions."}], "tags": [], "owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "is_accepted": false, "score": 1, "last_activity_date": 1479252523, "last_edit_date": 1479252523, "creation_date": 1479251089, "answer_id": 40621294, "question_id": 40620978, "link": "https://stackoverflow.com/questions/40620978/grouping-consecutive-duplicates-in-a-list/40621294#40621294", "title": "Grouping consecutive duplicates in a list?", "body": "<p>The type of your case case is <code>[[Char]]</code>, you are attempting to build a value of type <code>[[Int]]</code>. Our base case should be an empty list, and we'll add list elements in each step.</p>\n\n<p>Let's look at the anonymous function you're written next. Note that we'll fail due to type based on your current <code>if</code> within the accumulator (they must return values of the same type, and the same type as the accumulator. It'll be better, and cleaner, if we pattern match the accumulator and apply the function differently in each case:</p>\n\n<pre><code>func :: Eq a =&gt; [a] -&gt; [[a]]\nfunc = foldr f []\n  where f x []        = undefined\n        f x (b@(b1:_):bs)\n            | x == b1   = undefined\n            | otherwise = undefined\n</code></pre>\n\n<p>When we encounter the base case, we should just add the our element wrapped in a list:</p>\n\n<pre><code>f x [] = [[x]]\n</code></pre>\n\n<p>Next, we'll deal with the non-empty list. If x is equal to the next head of the head of the list, we should add it to that list. Otherwise, we shou</p>\n\n<pre><code>f x (b@(b1:_):bs)\n  | == b1   = (x:b):bs\n  | = [x]:b:bs\n</code></pre>\n\n<p>Putting this together, we have:</p>\n\n<pre><code>func :: Eq a =&gt; [a] -&gt; [[a]]\nfunc = foldr f []\n  where f x []        = [[x]]\n        f x (b@(b1:_):bs)\n          | x == b1    = (x:b):bs\n          | otherwise = [x]:b:bs\n</code></pre>\n\n<p>Having broken the problem down, it's much easier to rewrite this more compactly with a lambda function. Notice that the <code>head</code> <code>[[]]</code> is just <code>[]</code>, so we can handle the empty list case and the equality case as one action. Thus, we can rewrite:</p>\n\n<pre><code>func :: (Eq a) =&gt; [a] -&gt; [[a]]\nfunc = foldr (\\x (b:bs) -&gt; if b == [] || x == head b then (x:b):bs else [x]:b:bs) [[]]\n</code></pre>\n\n<p>However, this solution ends up requiring the use of <code>head</code> since we must pattern match all versions of the accumulator.</p>\n"}, {"tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": true, "score": 2, "last_activity_date": 1479311217, "creation_date": 1479311217, "answer_id": 40636330, "question_id": 40620978, "link": "https://stackoverflow.com/questions/40620978/grouping-consecutive-duplicates-in-a-list/40636330#40636330", "title": "Grouping consecutive duplicates in a list?", "body": "<p>Writing a fold on lists requires us to answer just two cases: <code>[]</code> (the empty list, or \"nil\") and <code>x:xs</code> (an element followed by a list, or \"cons\").</p>\n\n<p>What is the answer when the list is empty? Lets say the answer is also an empty list. Therefore:</p>\n\n<pre><code>nilCase = []\n</code></pre>\n\n<p>What is the answer when the list is not empty? It depends on what we have already accumulated. Lets say we have already accumulated a group. We know that groups are non-empty.</p>\n\n<pre><code>consCase x ((g11:_):gs)\n</code></pre>\n\n<p>If <code>x == g11</code> then we add it to the group. Otherwise we begin a new group. Therefore:</p>\n\n<pre><code>consCase x ggs@(g1@(g11:_):gs)\n  | x == g11  = (x:g1):gs\n  | otherwise = [x]:ggs\n</code></pre>\n\n<p>What if we have not accumulated any groups yet? Then we just create a new group.</p>\n\n<pre><code>consCase x [] = [[x]]\n</code></pre>\n\n<p>We can consolidate the three cases down to two:</p>\n\n<pre><code>consCase x ggs\n  | g1@(g11:_):gs &lt;- ggs, x == g11 = (x:g1):gs\n  | otherwise                      = [x]:ggs\n</code></pre>\n\n<p>Then the desired fold is simply:</p>\n\n<pre><code>foldr consCase nilCase\n</code></pre>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 561, "favorite_count": 0, "accepted_answer_id": 40636330, "answer_count": 3, "score": -1, "last_activity_date": 1479322518, "creation_date": 1479249498, "last_edit_date": 1479322518, "question_id": 40620978, "link": "https://stackoverflow.com/questions/40620978/grouping-consecutive-duplicates-in-a-list", "title": "Grouping consecutive duplicates in a list?", "body": "<p>Very basic but I'm finding the problem frustrating. I'm trying to group consecutive elements of a list:</p>\n\n<pre><code>myList = [1,2,3,4,4,4,5]\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>myList = [[1],[2],[3],[4,4,4],[5]]\n</code></pre>\n\n<p>This is my attempt using foldr with an accumulator:</p>\n\n<pre><code>print $ foldr (\\ el acc -&gt; if el /= head (head acc) then el ++ (head acc) else acc) [['a']] myList\n</code></pre>\n\n<p>I don't understand why I'm getting the following error:</p>\n\n<pre><code>Couldn't match expected type \u2018[a0]\u2019 with actual type \u2018Int\u2019\nIn the expression: 'a'\nIn the expression: ['a']\nIn the second argument of \u2018foldr\u2019, namely \u2018[['a']]\u2019\n</code></pre>\n\n<p>Any advice would be great! </p>\n"}, {"tags": ["haskell", "type-theory"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 4, "creation_date": 1479249440, "post_id": 40620913, "comment_id": 68476157, "body": "Union types are a form of subtyping, and subtyping does not play nicely with typeclasses or type inference."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 6, "creation_date": 1479254196, "post_id": 40620913, "comment_id": 68477695, "body": "I&#39;m not a good enough explainer of mathematics to do this justice in a full answer, but in category theory the opposite of a Cartesian product is a disjoint union, not a set union."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1479259840, "post_id": 40620913, "comment_id": 68479207, "body": "While this question is indeed closely related to <a href=\"http://stackoverflow.com/q/39582869/2751851\"><i>Why do Maybe/Optional types use a Just/Some type instead of the actual type?</i></a>, I don&#39;t think it is a duplicate. There, the intention was merely to eliminate the distinction between <code>Just x</code> and <code>x</code>, while here something rather more subtle is being suggested, even if the consequences are similar."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1479263443, "post_id": 40620913, "comment_id": 68480191, "body": "@BenjaminHodgson That leaves me wondering... a sum is to an union as a product is to an intersection. The lack of intersection types, though, seems to be a topic raised less often than that of untagged unions."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479315188, "post_id": 40620913, "comment_id": 68507794, "body": "@duplode For what it&#39;s worth, TypeScript has both union types and intersection types. In my experience working with TypeScript, intersection types seem to be less useful in daily practice. I don&#39;t know why that is."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1479316799, "post_id": 40620913, "comment_id": 68508906, "body": "@BenjaminHodgson Perhaps it&#39;s just that we want something to be one among many disparate possibilities more often than we want something to be several disparate things at once. (This discussion reminds me that, a while ago, I saw someone elsewhere saying that they had a record with fields of different types and wanted to use said fields implicitly, without using the accessors. I didn&#39;t make the connection at the time, but that person was looking for something very much like an intersection type.)"}], "answers": [{"comments": [{"owner": {"reputation": 5397, "user_id": 1149074, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/2Bm6Y.jpg?s=128&g=1", "display_name": "shock_one", "link": "https://stackoverflow.com/users/1149074/shock-one"}, "edited": false, "score": 0, "creation_date": 1479251140, "post_id": 40620931, "comment_id": 68476746, "body": "Could you please elaborate on why it&#39;s impossible to verify that all the cases have been handled in untagged unions?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479251609, "post_id": 40620931, "comment_id": 68476889, "body": "One could either let <code>Int :|: Int</code> be definitionally equal to <code>Int</code> or simply prohibit untagged unions between the same type. You could also recover tagged unions with <code>data L a = L a; data R a = R a; type Either a b = L a :|: R a</code> so barring the ambiguity of unions between equal types (which is simply resolved by giving <code>:|:</code> the desired semantics by definition) this answer doesn&#39;t address the question at all."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479251698, "post_id": 40620931, "comment_id": 68476929, "body": "@user2407038 See the <code>IntegralOrNum</code> example. You introduce implementation-dependent ambiguity, which is a rather nasty source of bugs."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479251898, "post_id": 40620931, "comment_id": 68476986, "body": "As for <code>IntegralOrNum</code> .. the declaration <code>type (Integral a, Num b) =&gt; IntegralOrNum a b = Either a b</code> is complete nonsense in real Haskell, so I don&#39;t see why it would be valid with the imaginary untagged union. Even if it was valid, then <code>5 :: IntegralOrNum Int Double</code> would be equal to whatever the <code>Num (a :|: b)</code> instance (if it even exists, again, why is this an assumption?) says it will be."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479252124, "post_id": 40620931, "comment_id": 68477045, "body": "@user2407038 What if I start making unions of unions of unions? If the types I&#39;m unioning are exported from other modules I might not realise I&#39;m doing this (and it might change <i>after</i> I first do it when I update a dependency). I would expect that if I have <code>a :|: b</code> and two functions <code>a -&gt; r, b -&gt; r</code> I could combine them into <code>(a :|: b) -&gt; r</code>, but there are squiggly corner cases in the behaviour of that if the compiler is silently merging overlapping cases. If the union types can be abstract, it might be impossible for me <i>or</i> the compiler to know whether or not that&#39;s happening."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479252183, "post_id": 40620931, "comment_id": 68477061, "body": "@user2407038 I&#39;m sure you <i>can</i> give a well-defined semantics to a system with types like this. But there <i>are</i> questions that would need work."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479252194, "post_id": 40620931, "comment_id": 68477063, "body": "@user2407038 In Haskell this would be a data type (which is possible using <code>DatatypeContexts</code>) but it is just an example to show the untagged union doesn&#39;t know whether to treat <code>5</code> as <code>Num</code> or <code>Integral</code> whereas the tagged union knows so unambigouosly."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1479253104, "post_id": 40620931, "comment_id": 68477327, "body": "@Ben Yes, there are issues that would need work (they are not mentioned in this answer). I would expect that the polymorphic function <code>caseSum :: forall a b r . (a -&gt; r) -&gt; (b -&gt; r) -&gt; a :|: b -&gt; r</code> would be definable (or primitive) in such a language - what edge cases are there, if you simply disallow invalid unions? @ThreeFx You are assuming that the imaginary <code>:|:</code> is an injective, generative type constructor, but that need not be the case - if it is an indexed family of types, then you cannot define type class instances for it."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479253235, "post_id": 40620931, "comment_id": 68477369, "body": "@user2407038 Isn&#39;t disallowing invalid unions the same thing as using tagged unions? I fail to see the difference. They are always disjoint, hence implicitly tagged."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1479253920, "post_id": 40620931, "comment_id": 68477602, "body": "@user2407038 If <code>a :|: b</code> is just not defined for all pairs of types, then you get annoyances when trying to use it on abstract types; a dependency could change its representation in a way that preserves its API in all details except that different possible unions are allowed. If we only get to have union <b>or</b> corproduct, then coproduct is more useful in my opinion <b>precisely</b> because it&#39;s injective and generative; the OP is discussing unions as an <i>alternative</i> to ADTs, so &quot;you can&#39;t define type class instances for it&quot; and &quot;some unions just don&#39;t work&quot; isn&#39;t very satisfactory."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1479255530, "post_id": 40620931, "comment_id": 68478101, "body": "@Ben You don&#39;t lose the injective, generative coproduct even if there is no primitive, since type constructors are still nominally distinct: <code>data U a b = U (Left a :|: Right b)</code>. Of course with such a type, nested coproducts are denoted by the number of <code>U</code> constructors. Since you can recover the coproduct from the union, you are not picking between union <i>or</i> coproduct, you are picking between union and coproduct <i>or</i> just coproduct."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479257586, "post_id": 40620931, "comment_id": 68478654, "body": "@user2407038 IMO you run into the problem that some untagged unions are also coproducts whether others aren&#39;t. How do you want to handle these? Furthermore, I still think that disallowing invalid unions would yield a type constructor isomorphic to the tagged union. Last but not least, how would you use these in programming? You can&#39;t pattern match on any constructors, etc. You&#39;d be at the compiler&#39;s mercy to figure out the types of the variables when attempting to define functions like that. Consider <code>a :|: b -&gt; a -&gt; b -&gt; (a, b)</code>, which complements its argument with the complement."}, {"owner": {"reputation": 512, "user_id": 12357035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XT9DZ.png?s=128&g=1", "display_name": "Sourav Kannantha B", "link": "https://stackoverflow.com/users/12357035/sourav-kannantha-b"}, "edited": false, "score": 0, "creation_date": 1613297873, "post_id": 40620931, "comment_id": 117027468, "body": "@ThreeFx why tagged unions are considered as sum types while untagged unions are not?"}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 15, "last_activity_date": 1479253527, "last_edit_date": 1479253527, "creation_date": 1479249246, "answer_id": 40620931, "question_id": 40620913, "link": "https://stackoverflow.com/questions/40620913/why-do-we-need-sum-types/40620931#40620931", "title": "Why do We Need Sum Types?", "body": "<p>Haskell's sum type is very similar to your <code>:|:</code>.</p>\n\n<p>The difference between the two is that the Haskell sum type <code>|</code> is a <em>tagged</em> union, while your \"sum type\" <code>:|:</code> is untagged.</p>\n\n<p>Tagged means every instance is unique - you can distunguish <code>Int | Int</code> from <code>Int</code> (actually, this holds for any <code>a</code>):</p>\n\n<pre><code>data EitherIntInt = Left Int | Right Int\n</code></pre>\n\n<p>In this case: <code>Either Int Int</code> carries <em>more</em> information than <code>Int</code> because there can be a <code>Left</code> and <code>Right</code> <code>Int</code>.</p>\n\n<p>In your <code>:|:</code>, you cannot distinguish those two:</p>\n\n<pre><code>type EitherIntInt = Int :|: Int\n</code></pre>\n\n<p>How do you know if it was a left or right <code>Int</code>?</p>\n\n<p>See the comments for an extended discussion of the section below.</p>\n\n<p>Tagged unions have another advantage: The compiler can verify whether you as the programmer handled all cases, which is implementation-dependent for general untagged unions. Did you handle all cases in <code>Int :|: Int</code>? Either this is isomorphic to <code>Int</code> by definition or the compiler has to decide which <code>Int</code> (left or right) to choose, which is impossible if they are indistinguishable.</p>\n\n<p>Consider another example:</p>\n\n<pre><code>type (Integral a, Num b) =&gt; IntegralOrNum a b = a :|: b    -- untagged\ndata (Integral a, Num b) =&gt; IntegralOrNum a b = Either a b -- tagged\n</code></pre>\n\n<p>What is <code>5 :: IntegralOrNum Int Double</code> in the untagged union? It is both an instance of <code>Integral</code> and <code>Num</code>, so we can't decide for sure and have to rely on implementation details. On the other hand, the tagged union knows exactly what <code>5</code> should be because it is branded with either <code>Left</code> or <code>Right</code>.</p>\n\n<hr>\n\n<p>As for naming: The disjoint union in Haskell is a union type. ADTs are only a means of implementing these.</p>\n"}, {"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479252506, "post_id": 40621163, "comment_id": 68477148, "body": "Why do the left and right hand sides being unequal make you lose parametricity? If you make such an assertion, then a type like e.g. <code>forall a b . a :|: b -&gt; ...</code> is a proof that <code>a</code> and <code>b</code> are disequal, but one cannot necessarily access this proof."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1479252521, "post_id": 40621163, "comment_id": 68477153, "body": "It seems this is the important point - &quot;As long as you require the types participation in a sum to be discernibly different, the explicit tagging should in principle not be necessary.&quot; - one must require that the types are not only disequal, but the stronger condition of them being distinguishable by their constructors. Perhaps this is too strong a condition to be useful?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1479252666, "last_edit_date": 1479252666, "creation_date": 1479250368, "answer_id": 40621163, "question_id": 40620913, "link": "https://stackoverflow.com/questions/40620913/why-do-we-need-sum-types/40621163#40621163", "title": "Why do We Need Sum Types?", "body": "<p>This is an idea I've thought a lot about myself: a language with \u201cfirst-class type algebra\u201d. Pretty sure we could do about everything this way that we do in Haskell. Certainly if these disjunctions were, like Haskell alternatives, <em>tagged</em> unions; then you could directly rewrite any ADT to use them. In fact GHC can do this for you: if you derive a <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-Generics.html#t:Generic\" rel=\"nofollow noreferrer\"><code>Generic</code></a> instance, a variant type will be represented by a <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-Generics.html#t::-43-:\" rel=\"nofollow noreferrer\"><code>:+:</code></a> construct, which is in essence just <code>Either</code>.</p>\n\n<p>I'm not so sure if <em>untagged</em> unions would also do. As long as you require the types participating in a sum to be discernibly different, the explicit tagging should in principle not be necessary. The language would then need a convenient way to match on types at runtime. Sounds a lot like what dynamic languages do \u2013 obviously comes with quite some overhead though.\n<br>The biggest problem would be that if the types on both sides of <code>:|:</code> must be unequal then you lose <em>parametricity</em>, which is one of Haskell's nicest traits.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1479258726, "last_edit_date": 1592644375, "creation_date": 1479254593, "answer_id": 40621884, "question_id": 40620913, "link": "https://stackoverflow.com/questions/40620913/why-do-we-need-sum-types/40621884#40621884", "title": "Why do We Need Sum Types?", "body": "<p>Given that you mention TypeScript, it is instructive to have a look at what <a href=\"https://www.typescriptlang.org/docs/handbook/advanced-types.html\" rel=\"nofollow noreferrer\">its docs</a> have to say about its union types. The example there starts from a function...</p>\n<blockquote>\n<pre><code>function padLeft(value: string, padding: any) { //etc.\n</code></pre>\n</blockquote>\n<p>... that has a flaw:</p>\n<blockquote>\n<p>The problem with <code>padLeft</code> is that its padding parameter is typed as <code>any</code>. That means that we can call it with an argument that\u2019s neither a <code>number</code> nor a <code>string</code></p>\n</blockquote>\n<p>One plausible solution is then suggested, and rejected:</p>\n<blockquote>\n<p>In traditional object-oriented code, we might abstract over the two types by creating a hierarchy of types. While this is much more explicit, it\u2019s also a little bit overkill.</p>\n</blockquote>\n<p>Rather, the handbook suggests...</p>\n<blockquote>\n<p>Instead of <code>any</code>, we can use a <em>union type</em> for the <code>padding</code> parameter:</p>\n<pre><code>function padLeft(value: string, padding: string | number) { // etc.\n</code></pre>\n</blockquote>\n<p>Crucially, the concept of union type is then described in this way:</p>\n<blockquote>\n<p>A union type describes a value that can be one of several types.</p>\n</blockquote>\n<p>A <code>string | number</code> value in TypeScript can be either of <code>string</code> type or of <code>number</code> type, as <code>string</code> and <code>number</code> are subtypes of <code>string | number</code> (cf. Alexis King's comment to the question). An <code>Either String Int</code> value in Haskell, however, is neither of <code>String</code> type nor of <code>Int</code> type -- its only, monomorphic, type is <code>Either String Int</code>. Further implications of that difference show up in the remainder of the discussion:</p>\n<blockquote>\n<p>If we have a value that has a union type, we can only access members that are common to all types in the union.</p>\n</blockquote>\n<p>In a roughly analogous Haskell scenario, if we have, say, an <code>Either Double Int</code>, we cannot apply <code>(2*)</code> directly on it, even though both <code>Double</code> and <code>Int</code> have instances of <code>Num</code>. Rather, something like <code>bimap</code> is necessary.</p>\n<blockquote>\n<p>What happens when we need to know specifically whether we have a <code>Fish</code>? [...] we\u2019ll need to use a type assertion:</p>\n<pre><code>let pet = getSmallPet();\n\nif ((&lt;Fish&gt;pet).swim) {\n    (&lt;Fish&gt;pet).swim();\n}\nelse {\n    (&lt;Bird&gt;pet).fly();\n}\n</code></pre>\n</blockquote>\n<p>This sort of downcasting/runtime type checking is <a href=\"https://stackoverflow.com/q/40432690/2751851\">at odds</a> with how the Haskell type system ordinarily works, even though it <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Dynamic.html\" rel=\"nofollow noreferrer\">can be implemented</a>  using the very same type system (also cf. leftaroundabout's answer). In contrast, there is nothing to figure out at runtime about the type of an <code>Either Fish Bird</code>: the case analysis happens at value level, and there is no need to deal with anything failing and producing <code>Nothing</code> (or worse, <code>null</code>) due to runtime type mismatches.</p>\n"}, {"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1479293724, "post_id": 40622178, "comment_id": 68493257, "body": "The English definitions of product and coproduct are very dense. I think this answer would be easier to understand with some pictures"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1479304225, "post_id": 40622178, "comment_id": 68499974, "body": "@BenjaminHodgson Like this?"}, {"owner": {"reputation": 2850, "user_id": 614394, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZIgig.jpg?s=128&g=1", "display_name": "Eduardo Pareja Tobes", "link": "https://stackoverflow.com/users/614394/eduardo-pareja-tobes"}, "edited": false, "score": 0, "creation_date": 1479573619, "post_id": 40622178, "comment_id": 68619950, "body": "From where &quot;we know that <code>a :|: a</code> is isomorphic to <code>a</code>.&quot;? what is the supposed definition of <code>a :|: a</code>?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 2850, "user_id": 614394, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZIgig.jpg?s=128&g=1", "display_name": "Eduardo Pareja Tobes", "link": "https://stackoverflow.com/users/614394/eduardo-pareja-tobes"}, "edited": false, "score": 0, "creation_date": 1485644610, "post_id": 40622178, "comment_id": 71013020, "body": "@EduardoParejaTobes The untagged union loses the information if the <code>a</code> in the union came from the left or the right set. You can imagine it as being one of two socks: You know it&#39;s a sock, but it could be a left or right one, so for all you know it could be a single sock. The tagged union works like those socks with L and R printed: If you have one of these socks, you know exactly which one it is, which translates to you knowing where your <code>a</code> came from."}, {"owner": {"reputation": 2850, "user_id": 614394, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZIgig.jpg?s=128&g=1", "display_name": "Eduardo Pareja Tobes", "link": "https://stackoverflow.com/users/614394/eduardo-pareja-tobes"}, "edited": false, "score": 0, "creation_date": 1485646978, "post_id": 40622178, "comment_id": 71013599, "body": "@ThreeFx thanks, but what I&#39;m asking for is a conceptual (that is, category-theoretical) definition of untagged unions."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 14, "last_activity_date": 1479303940, "last_edit_date": 1479303940, "creation_date": 1479256501, "answer_id": 40622178, "question_id": 40620913, "link": "https://stackoverflow.com/questions/40620913/why-do-we-need-sum-types/40622178#40622178", "title": "Why do We Need Sum Types?", "body": "<p>I will try to expand the categorical argument mentioned by @BenjaminHodgson.</p>\n\n<p>Haskell can be seen as the category <code>Hask</code>, in which objects are types and morphisms are functions between types (disregarding bottom).</p>\n\n<p>We can define a product in <code>Hask</code> as tuple - categorically speaking it meets the definition of the product:</p>\n\n<blockquote>\n  <p>A product of <code>a</code> and <code>b</code> is the type <code>c</code> equipped with projections <code>p</code> and <code>q</code> such that <code>p :: c -&gt; a</code> and <code>q :: c -&gt; b</code> and for any other candidate <code>c'</code> equipped with <code>p'</code> and <code>q'</code> there exists a morphism <code>m :: c' -&gt; c</code> such that we can write <code>p'</code> as <code>p . m</code> and <code>q'</code> as <code>q . m</code>.</p>\n</blockquote>\n\n<p><a href=\"https://i.stack.imgur.com/D0LyG.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/D0LyG.jpg\" alt=\"product\"></a></p>\n\n<p>Read up on this in <a href=\"https://bartoszmilewski.com/2015/01/07/products-and-coproducts/\" rel=\"noreferrer\">Bartosz' Category Theory for Programmers</a> for further information.</p>\n\n<p>Now for every category, there exists the opposite category, which has the same morphism but reverses all the arrows. The coproduct is thus:</p>\n\n<blockquote>\n  <p>The coproduct <code>c</code> of <code>a</code> and <code>b</code> is the type <code>c</code> equipped with injections <code>i :: a -&gt; c</code> and <code>j :: b -&gt; c</code> such that for all other candidates <code>c'</code> with <code>i'</code> and <code>j'</code> there exists a morphism <code>m :: c -&gt; c'</code> such that <code>i' = m . i</code> and <code>j' = m . j</code>.</p>\n</blockquote>\n\n<p><a href=\"https://i.stack.imgur.com/HL7KB.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/HL7KB.jpg\" alt=\"coproduct\"></a></p>\n\n<p>Let's see how the tagged and untagged union perform given this definition:</p>\n\n<p>The untagged union of <code>a</code> and <code>b</code> is the type <code>a :|: b</code> such that:</p>\n\n<ul>\n<li><code>i :: a -&gt; a :|: b</code> is defined as <code>i a = a</code> and</li>\n<li><code>j :: b -&gt; a :|: b</code> is defined as <code>j b = b</code></li>\n</ul>\n\n<p>However, we know that <code>a :|: a</code> is isomorphic to <code>a</code>. Based on that observation we can define a second candidate for the product <code>a :|: a :|: b</code> which is equipped with the exact same morphisms. Therefore, there is no single best candidate, since the morphism <code>m</code> between <code>a :|: a :|: b</code> and <code>a :|: b</code> is <code>id</code>. <code>id</code> is a bijection, which implies that <code>m</code> is invertible and \"convert\" types either way. A visual representation of that argument. Replace <code>p</code> with <code>i</code> and <code>q</code> with <code>j</code>.</p>\n\n<p><a href=\"https://i.stack.imgur.com/xL9Gw.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/xL9Gw.jpg\" alt=\"coproduct untagged\"></a></p>\n\n<p>Restricting ourselves <code>Either</code>, as you can verify yourself with:</p>\n\n<ul>\n<li><code>i</code> = <code>Left</code> and</li>\n<li><code>j</code> = <code>Right</code></li>\n</ul>\n\n<p>This shows that the categorical complement of the product type is the disjoint union, not the set-based union.</p>\n\n<p>The set union is part of the disjoint union, because we can define it as follows:</p>\n\n<pre><code>data Left a = Left a\ndata Right b = Right b\ntype DisjUnion a b = Left a :|: Right b\n</code></pre>\n\n<p>Because we have shown above that the set union is not a valid candidate for the coproduct of two types, we would lose many <a href=\"http://ttic.uchicago.edu/~dreyer/course/papers/wadler.pdf\" rel=\"noreferrer\">\"free\" properties</a> (which follow from <em>parametricity</em> as leftroundabout mentioned) by not choosing the disjoint union in the category <code>Hask</code> (because there would be no coproduct).</p>\n"}], "owner": {"reputation": 5397, "user_id": 1149074, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/2Bm6Y.jpg?s=128&g=1", "display_name": "shock_one", "link": "https://stackoverflow.com/users/1149074/shock-one"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1375, "favorite_count": 4, "accepted_answer_id": 40620931, "answer_count": 4, "score": 11, "last_activity_date": 1482693646, "creation_date": 1479249153, "last_edit_date": 1479252174, "question_id": 40620913, "link": "https://stackoverflow.com/questions/40620913/why-do-we-need-sum-types", "title": "Why do We Need Sum Types?", "body": "<p>Imagine a language which doesn't allow multiple value constructors for a data type. Instead of writing</p>\n\n<pre><code>data Color = White | Black | Blue\n</code></pre>\n\n<p>we would have</p>\n\n<pre><code>data White = White\ndata Black = Black\ndata Blue = Black\ntype Color = White :|: Black :|: Blue\n</code></pre>\n\n<p>where <code>:|:</code> (here it's not <code>|</code> to avoid confusion with sum types) is a built-in type union operator. Pattern matching would work in the same way</p>\n\n<pre><code>show :: Color -&gt; String\nshow White = \"white\"\nshow Black = \"black\"\nshow Blue = \"blue\"\n</code></pre>\n\n<p>As you can see, in contrast to coproducts it results in a flat structure so you don't have to deal with injections. And, unlike sum types, it allows to randomly combine types resulting in greater flexibility and granularity:</p>\n\n<pre><code>type ColorsStartingWithB = Black :|: Blue\n</code></pre>\n\n<p>I believe it wouldn't be a problem to construct recursive data types as well</p>\n\n<pre><code>data Nil = Nil\ndata Cons a = Cons a (List a)\ntype List a = Cons a :|: Nil\n</code></pre>\n\n<p>I know union types are present in TypeScript and probably other languages, but why did the Haskell committee chose ADTs over them?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 2, "creation_date": 1479243920, "post_id": 40619575, "comment_id": 68473558, "body": "Does it make sense to use <code>Floating</code> as an input constraint on <code>factors</code>? That would mean that it&#39;s valid to call <code>factor 3.14</code>. What should the output be?"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 7130136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d295bb21adb8f861f6553db64f33a942?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Park", "link": "https://stackoverflow.com/users/7130136/fred-park"}, "edited": false, "score": 0, "creation_date": 1479260794, "post_id": 40619861, "comment_id": 68479460, "body": "this doesn&#39;t work for me, it doesnt evalualte to anything!"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 33, "user_id": 7130136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d295bb21adb8f861f6553db64f33a942?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Park", "link": "https://stackoverflow.com/users/7130136/fred-park"}, "edited": false, "score": 0, "creation_date": 1479284112, "post_id": 40619861, "comment_id": 68487206, "body": "@FredPark please be more specific. What doen&#39;t work?"}, {"owner": {"reputation": 33, "user_id": 7130136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d295bb21adb8f861f6553db64f33a942?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Park", "link": "https://stackoverflow.com/users/7130136/fred-park"}, "edited": false, "score": 0, "creation_date": 1479328599, "post_id": 40619861, "comment_id": 68515682, "body": "modifying the code with your recommendation (which makes sense) does not find primes from my desired range."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 33, "user_id": 7130136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d295bb21adb8f861f6553db64f33a942?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Park", "link": "https://stackoverflow.com/users/7130136/fred-park"}, "edited": false, "score": 0, "creation_date": 1479328708, "post_id": 40619861, "comment_id": 68515758, "body": "@FredPark What is the error? Does it produce an infinite loop? Which output do you get?"}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 1, "last_activity_date": 1479247306, "last_edit_date": 1479247306, "creation_date": 1479244766, "answer_id": 40619861, "question_id": 40619575, "link": "https://stackoverflow.com/questions/40619575/ambiguous-type-variable-in-combination-of-sqrt-and-floor/40619861#40619861", "title": "Ambiguous type variable in combination of sqrt and floor", "body": "<p>It seems like you looked at the code you wrote and figured the types out after. In general, Haskell development is the other way around: First you figure out the types, then you implement the functions. What type should <code>factors</code> have? Well, you can only factorize integers, so something of type, so this seems sensible:</p>\n\n<pre><code>factor :: Integral a =&gt; a -&gt; [a]\n</code></pre>\n\n<p>Now when trying to compile your code we get the following error:</p>\n\n<pre><code>Could not deduce (Floating a) arising from a use of `sqrt` from the context (Integral a)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Could not deduce (RealFrac a) arising from a use of `sqrt` from the context (Integral a)\n</code></pre>\n\n<p>It complains that you specified <code>Integral a</code> but it needs <code>Floating a</code> for <code>sqrt</code>. We can do this by usinf <code>fromIntegral</code>:</p>\n\n<pre><code>sqrt         ::          Floating a =&gt; a -&gt; a\nfromIntegral :: (Integral a, Num b) =&gt; a -&gt; b\n\nfactors :: Integral a =&gt; a -&gt; [a]       vvvvvvvvvvvvvv\nfactors n = [x | x &lt;- [1..(floor (sqrt (fromIntegral n)))], mod n x == 0]\n</code></pre>\n\n<p>To preserve readability,</p>\n\n<pre><code>factors n = [x | x &lt;- [1..isqrt n], mod n x == 0]\n    where isqrt = floor . sqrt . fromIntegral\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 7130136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d295bb21adb8f861f6553db64f33a942?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Park", "link": "https://stackoverflow.com/users/7130136/fred-park"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1479247306, "creation_date": 1479243507, "last_edit_date": 1479245444, "question_id": 40619575, "link": "https://stackoverflow.com/questions/40619575/ambiguous-type-variable-in-combination-of-sqrt-and-floor", "title": "Ambiguous type variable in combination of sqrt and floor", "body": "<p>Trying to implement a function for listing all prime numbers in some range of numbers, I know when I am checking for factors I do not have to check beyond the sqrt of that that number.</p>\n\n<pre><code>factors n = [x | x &lt;- [1..(floor (sqrt n))], mod n x == 0]\nprime n = factors n == [1,n]\nlistPrimesFromTill n z = [ xs | xs &lt;- [n..z], prime xs == True]\n</code></pre>\n\n<p>I've been browsing for answers and I tried various methods like type checking using </p>\n\n<pre><code>factors :: (RealFrac b, Integral c, Floating b) =&gt; b -&gt; c\n</code></pre>\n\n<p>but have had no luck.</p>\n\n<p>Any help is appreciated!</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479241199, "post_id": 40618909, "comment_id": 68472038, "body": "I don&#39;t know the answer to your question, but for examples of why laziness is useful you might like <a href=\"http://stackoverflow.com/questions/7868507/non-trivial-lazy-evaluation\">Non-Trivial Lazy Evaluation</a>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 5, "creation_date": 1479241336, "post_id": 40618909, "comment_id": 68472127, "body": "That is the result of a <a href=\"http://stackoverflow.com/questions/36049689/why-does-multiplication-only-short-circuit-on-one-side\">bug in GHC 7.10.3</a> which didn&#39;t exist before 7.10 and was eliminated in 8.1."}, {"owner": {"reputation": 56, "user_id": 456625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e8718c93e9149c0cb537d7a0d5c1095?s=128&d=identicon&r=PG", "display_name": "stefk0", "link": "https://stackoverflow.com/users/456625/stefk0"}, "edited": false, "score": 0, "creation_date": 1479241791, "post_id": 40618909, "comment_id": 68472416, "body": "OK. Thanks. Do you know what is the reasoning behind the decision to make multiplication strict?  From my point of view, this is not obvious, because I make a parallel with the fact that True || undefined = True."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1479241804, "post_id": 40618909, "comment_id": 68472424, "body": "Also, you won&#39;t be able to implement a completely lazy <code>0 * x = x * 0 = 0</code> in Haskell. One of the sides will need to be evaluated to make sure the first pattern doesn&#39;t match (which one depends on which pattern match you put first in your definition)."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1479242027, "post_id": 40618909, "comment_id": 68472533, "body": "I think the reason multiplication is strict is that it would cause a significant performance decrease if it was lazy. If it was lazy in (say) the first argument, something like <code>((... * x) * y) * z</code> (with a lot of factors) would need to build up a huge thunk before any actual work (multiplication) can be done."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1479243604, "post_id": 40618909, "comment_id": 68473383, "body": "It is possible to have a multiplication that is non strict in both arguments using lub (experimental module), see <a href=\"http://hackage.haskell.org/package/lub-0.1.7/docs/Data-Lub.html\" rel=\"nofollow noreferrer\">ptimes</a>"}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1479243109, "creation_date": 1479243109, "answer_id": 40619471, "question_id": 40618909, "link": "https://stackoverflow.com/questions/40618909/strict-or-non-strict-multiplication-in-haskell/40619471#40619471", "title": "strict or non-strict multiplication in haskell?", "body": "<p>The answer is in the comments thanks to @DavidYoung - this is a GHC bug nothing more.</p>\n\n<p>If you want multiplication to be lazy in some particular manner you can certainly write your own type and instance for <code>Num</code>.  For example:</p>\n\n<pre><code>module Main where\n\nmain :: IO ()\nmain =\n  do print (one * two)\n     print (undefined * zero)\n     putStrLn \"The next one has an exception because it must evaluate the undefined arugment.\"\n     print (undefined * two)\n\none, two, zero :: LazyInt\none = 1\ntwo = 2\nzero = 0\n\n-- Not fully lazy such as in addition or Ord, which is possible,\n-- but just in the first argument for multiplication.\nnewtype LazyInt = LI { unLI :: Int }\n                deriving (Eq, Ord)\n\ninstance Show LazyInt where\n  show (LI x) = show x\n\ninstance Num LazyInt where\n  (LI a) + (LI b) = LI (a + b)\n  negate (LI a) = LI (negate a)\n  abs (LI a) = LI (abs a)\n  signum (LI a) = LI (signum a)\n  fromInteger i = LI (fromInteger i)\n\n  -- The case of interest:\n  a * (LI b) =\n    if b == 0\n       then LI 0\n       else LI (unLI a * b)\n</code></pre>\n"}], "owner": {"reputation": 56, "user_id": 456625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e8718c93e9149c0cb537d7a0d5c1095?s=128&d=identicon&r=PG", "display_name": "stefk0", "link": "https://stackoverflow.com/users/456625/stefk0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1479283941, "creation_date": 1479240978, "last_edit_date": 1479283941, "question_id": 40618909, "link": "https://stackoverflow.com/questions/40618909/strict-or-non-strict-multiplication-in-haskell", "title": "strict or non-strict multiplication in haskell?", "body": "<p>For a class, I was trying to come up with simple examples of strict and non-strict functions, arguing that non-strict functions make sense. One of my examples was that it might be useful to define 0*x = x*0 = 0 for all x in the domain. When I got back home I naturally wanted to see what the Haskell creators think about that. Here comes my confusion.</p>\n\n<p>At one machine, ghci says that multiplication is strict on both arguments:</p>\n\n<pre><code>GHCi, version 7.6.3: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\nPrelude&gt; 0 * undefined \n*** Exception: Prelude.undefined\nPrelude&gt; undefined * 0\n*** Exception: Prelude.undefined\n</code></pre>\n\n<p>At another machine, ghci says that multiplication is non-strict on the first argument:</p>\n\n<pre><code>GHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; undefined * 0\n0\nPrelude&gt; 0 * undefined\n*** Exception: Prelude.undefined\n</code></pre>\n\n<p>What causes the difference in behaviour ? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1479238907, "post_id": 40618246, "comment_id": 68470729, "body": "This is probably relevant: <a href=\"http://stackoverflow.com/q/35161616/2751851\"><i>Why does Haskell Pipes \u201cuse () to close unused inputs and X (the uninhabited type) to close unused outputs\u201d?</i></a>"}, {"owner": {"reputation": 2966, "user_id": 315302, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1d57a52c98eee46fb4bc92e0b4ffe163?s=128&d=identicon&r=PG", "display_name": "Javran", "link": "https://stackoverflow.com/users/315302/javran"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479245934, "post_id": 40618246, "comment_id": 68474528, "body": "@duplode thanks for the link, that&#39;s super relevant as I was trying to figure out the reason behind choice of <code>()</code> vs. <code>Void</code>."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 6, "last_activity_date": 1479238757, "creation_date": 1479238757, "answer_id": 40618306, "question_id": 40618246, "link": "https://stackoverflow.com/questions/40618246/whats-the-best-way-of-expressing-a-never-evaluated-argument-to-a-function-in/40618306#40618306", "title": "What&#39;s the best way of expressing a &quot;never-evaluated&quot; argument to a function in type?", "body": "<p>The first one is perfect. It will accept an argument of any type, so you have maximum flexibility in what you provide it (even <code>undefined</code>). #2 limits you to only a single valid argument, <code>()</code>. #3 isn't an option; you can't even <em>call</em> the function, because there is no valid argument to give it.</p>\n\n<p>This is exactly what <code>const :: a -&gt; b -&gt; a</code> returns. <code>foo = const 3</code> is a function that takes a value of any type and returns <code>3</code>.</p>\n"}], "owner": {"reputation": 2966, "user_id": 315302, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1d57a52c98eee46fb4bc92e0b4ffe163?s=128&d=identicon&r=PG", "display_name": "Javran", "link": "https://stackoverflow.com/users/315302/javran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 40618306, "answer_count": 1, "score": 2, "last_activity_date": 1479238757, "creation_date": 1479238515, "question_id": 40618246, "link": "https://stackoverflow.com/questions/40618246/whats-the-best-way-of-expressing-a-never-evaluated-argument-to-a-function-in", "title": "What&#39;s the best way of expressing a &quot;never-evaluated&quot; argument to a function in type?", "body": "<p>Sorry about the title, I don't know if there's a better way to describe it in one short sentence.</p>\n\n<p>The idea is I want a function type to express that the function accepts one argument but will never evaluate it.</p>\n\n<p>There are few alternatives I can think of, and I want to know what would be the best one:</p>\n\n<p>(for all following examples, <code>Int</code> is just an arbitrary choice from any concrete types)</p>\n\n<ol>\n<li><code>f :: forall a . a -&gt; Int</code>, feeding <code>f</code> with anything will do</li>\n<li><code>f :: () -&gt; Int</code>, there's nothing but a trivial value to be evaluated</li>\n<li><code>f :: Void -&gt; Int</code>, this could be a bad idea, as it's possible that <code>f = absurd</code> and <code>f</code> is applied with <code>undefined</code> or <code>let x = x in x</code>, but if you know <code>f</code> terminates, then you also know it will never evaluate its argument.</li>\n<li>I don't know if there are other ways, please give your suggestions if any.</li>\n</ol>\n\n<p>About why I need a function like this in the first place: suppose I want to design a stream-processing library and let type of stream processors be like <code>SP &lt;input-type&gt; &lt;output-type&gt;</code> and it's possible that a processor doesn't need any input. and at some point I'll have to deal with a function like <code>&lt;input-type&gt; -&gt; &lt;output-type&gt;</code> if I want to make this an <code>Arrow</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479236493, "post_id": 40617439, "comment_id": 68469353, "body": "As far as Haskell is concerned, the key point is that, in spite of the polymorphism, in <code>2 + 2.8</code> neither <code>2</code> nor <code>2.8</code> can possibly be specialised to an integer type. See also: <a href=\"http://stackoverflow.com/q/21894463/2751851\"><i>Type signature of num to double?</i></a>; <a href=\"http://stackoverflow.com/q/5445735/2751851\"><i>Haskell datatype conversion problems</i></a>."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 6, "last_activity_date": 1479237234, "last_edit_date": 1479237234, "creation_date": 1479236058, "answer_id": 40617563, "question_id": 40617439, "link": "https://stackoverflow.com/questions/40617439/addition-of-2-2-8-in-haskell/40617563#40617563", "title": "Addition of 2 + 2.8 in Haskell", "body": "<p><code>2</code> is polymorphically any numeric type in Haskell.  <code>2</code> is not fully polymorphic in C.</p>\n\n<p>Try, instead, to be more explicit about your types in both langauges:</p>\n\n<pre><code>float test()\n{\n    int i = 2;\n    float f = 2.8;\n    return (f+i);\n}\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>test :: Float\ntest = (2 :: Int) + (2.8 :: Float)\n</code></pre>\n\n<p>What happens?</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 6, "last_activity_date": 1479238431, "last_edit_date": 1479238431, "creation_date": 1479236088, "answer_id": 40617570, "question_id": 40617439, "link": "https://stackoverflow.com/questions/40617439/addition-of-2-2-8-in-haskell/40617570#40617570", "title": "Addition of 2 + 2.8 in Haskell", "body": "<p>There is no type promotion in Haskell, or else <code>(2::Int) + (2::Double)</code> would be legal. Instead, the <em>literal</em> <code>2</code> has type <code>Num a =&gt; a</code>, which means it can be treated as a <em>value</em> of any type that has an instance <code>Num</code>.</p>\n\n<p>There is, however, type <em>defaulting</em> in the interactive interpreter. An expression like <code>show 2</code> (which is implicitly called if you attempt to display a simple expression like <code>2</code>) is ambiguous; the interpreter doesn't know whether to return <code>\"2\"</code> or <code>\"2.0\"</code> or some other string value that is valid for a type which is an instance of <code>Num</code>. Rather than forcing the user to specify a type via <code>show 2 :: Integer</code>, the interpreter simply selects a default type <code>Integer</code> to use for an otherwise polymorphic value.</p>\n"}, {"comments": [{"owner": {"reputation": 35704, "user_id": 4958, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ca82d17e7496d3c20b9c8038f87ae49?s=128&d=identicon&r=PG", "display_name": "ShreevatsaR", "link": "https://stackoverflow.com/users/4958/shreevatsar"}, "edited": false, "score": 0, "creation_date": 1479236867, "post_id": 40617771, "comment_id": 68469557, "body": "Indeed:  in the interpreter, <code>:t (2 + 2.8)</code>   gives <code>(2 + 2.8) :: Fractional a =&gt; a</code>"}, {"owner": {"reputation": 627, "user_id": 634615, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/5d0319056378070fa0eea3a731fb173c?s=128&d=identicon&r=PG", "display_name": "user634615", "link": "https://stackoverflow.com/users/634615/user634615"}, "edited": false, "score": 0, "creation_date": 1479237808, "post_id": 40617771, "comment_id": 68470087, "body": "Thanks for detailed explaination. Can I reason about this as follows. Addition requires two instances of Num.  while <code>2</code> is an instance of <code>Num</code> but 2.8 is instance of Fractional which has Num as superclass. So I can add these two numbers because Num is superclass of Fractional."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 1, "creation_date": 1479238071, "post_id": 40617771, "comment_id": 68470219, "body": "At best, that&#39;s an imprecise way of saying it.  I would say that addition requires <i>one</i> instance of <code>Num</code>.  That instance is a concrete type, like <code>Int</code> or <code>Double</code>.  When you add two numbers, they must both have the same type, and that type must be an instance of <code>Num</code>.  2.8 is a value which has type <code>Fractional a =&gt; a</code>.  When you add 2 + 2.8 you pick a type which is an instance of Fractional (which means it&#39;s also an instance of Num, because Num is the superclass).  I hope I&#39;m not just confusing things further."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1479238317, "post_id": 40617771, "comment_id": 68470361, "body": "Or to try and explain the terms: <code>Num</code> is a class, <code>Int</code> is a type which is an instance of <code>Num</code>, and <code>2 :: Int</code> is a value which has type <code>Int</code>.  We just have to be precise when we use the words &quot;class&quot;, &quot;instance&quot;, &quot;type&quot;, and &quot;value&quot; since they have technical meaning, at least when we&#39;re explaining things.  We&#39;re often sloppy with these terms, however, especially since &quot;class&quot;, &quot;instance&quot;, and &quot;value&quot; correspond to terms &quot;interface&quot;, &quot;class&quot;, and &quot;instance&quot; in languages like Java."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1479238798, "post_id": 40617771, "comment_id": 68470653, "body": "Nice example. A few years ago I was asked by a colleague to guess what <code>1&#47;2*x*x+4*x+2</code> would evaluate to when <code>x=2</code> in C. I failed, but realized how Haskell did not have this &quot;promotion&quot; issue."}], "tags": [], "owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "is_accepted": true, "score": 10, "last_activity_date": 1479237414, "last_edit_date": 1479237414, "creation_date": 1479236778, "answer_id": 40617771, "question_id": 40617439, "link": "https://stackoverflow.com/questions/40617439/addition-of-2-2-8-in-haskell/40617771#40617771", "title": "Addition of 2 + 2.8 in Haskell", "body": "<p>\"Weak typing\" and \"strong typing\" are somewhat subjective terms, reasonable people will often disagree on exactly what they mean.</p>\n\n<h2>C</h2>\n\n<p>In C, you have 2 which has type <code>int</code>, and 2.8 which has type <code>double</code>.  When you compute <code>2 + 2.8</code>, the \"usual arithmetic conversions\" are applied, which promotes the <code>int</code> to <code>double</code>.  So you get this:</p>\n\n<pre><code>((double) 2) + 2.8\n</code></pre>\n\n<p>This converts the 2 (an <code>int</code>) to a <code>double</code>.  The result is type <code>double</code>.</p>\n\n<h2>Haskell</h2>\n\n<p>In Haskell, there are no implicit conversions.  What happens in Haskell is that 2 has type <code>Num a =&gt; a</code> and 2.8 has type <code>Fractional a =&gt; a</code>.  2 + 2.8 therefore has type <code>Fractional a =&gt; a</code>.</p>\n\n<p>However, this is a problem because <code>Fractional a =&gt; a</code> is polymorphic.  You can think of it as a polymorphic function which takes zero arguments.  You pass in a type, and the function produces a value of that type.</p>\n\n<p>So you can do this:</p>\n\n<pre><code>2 + 2.8 :: Rational\n</code></pre>\n\n<p>Or you can do this:</p>\n\n<pre><code>2 + 2.8 :: Double\n</code></pre>\n\n<p>You will get different answers.  When you write <code>2 + 2.8 :: Rational</code>, then the 2 is <code>Rational</code>, the 2.8 is <code>Rational</code>, and the whole result is <code>Rational</code>.  When you write <code>2 + 2.8 :: Double</code>, then the 2 is <code>Double</code>, the 2.8 is <code>Double</code>, and the result is <code>Double</code>.  You don't get conversions.</p>\n\n<h2>Summary</h2>\n\n<p>You can think of it like this: in Haskell, the type checker knows that the result has type T, so the inputs have type T as well.  In C, the type checker doesn't \"look ahead\" like that, so it has to convert the types on an ad-hoc basis.</p>\n\n<p>This is more obvious when you do things like this:</p>\n\n<pre><code>1 / 2 + 0.0\n</code></pre>\n\n<p>In C, this will give you 0.0, because <code>1 / 2</code> is integer division.  In Haskell, this will give you 0.5, because <em>everything</em> will be done using <code>Double</code> or <code>Rational</code> or whatever you choose.  This is a pretty major difference between Haskell and C, and it's generally the kind of thing people mean when people say \"strong\" or \"weak\" typing (that is, when they can even agree on what that means).</p>\n\n<p>So in C, you get:</p>\n\n<pre><code>(double) ((int) 1 / (int) 2) + (double) 0.0\n//       ^^^ intermediate result stays in int\n</code></pre>\n\n<p>In Haskell, you get:</p>\n\n<pre><code>(1 :: Double) / (2 :: Double) + (0.0 :: Double)\n</code></pre>\n\n<p>If you want the C-like behavior in Haskell, you end up with this:</p>\n\n<pre><code>fromIntegral (1 `quot` 2 :: Int) + 0.0 :: Double\n</code></pre>\n"}], "owner": {"reputation": 627, "user_id": 634615, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/5d0319056378070fa0eea3a731fb173c?s=128&d=identicon&r=PG", "display_name": "user634615", "link": "https://stackoverflow.com/users/634615/user634615"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 0, "accepted_answer_id": 40617771, "answer_count": 3, "score": 2, "last_activity_date": 1479238431, "creation_date": 1479235589, "question_id": 40617439, "link": "https://stackoverflow.com/questions/40617439/addition-of-2-2-8-in-haskell", "title": "Addition of 2 + 2.8 in Haskell", "body": "<p>The expression <code>2 + 2.8</code> is valid in Haskell and evaluates to <code>4.8</code>\nSimilar to C which involves something called type promotion, Haskell uses type inference and adhoc polymorphism to get the result.</p>\n\n<p>Question is whatever be the reason is it not an example of weak typing in both the languages.</p>\n"}, {"tags": ["haskell", "types", "sum", "foldable"], "comments": [{"owner": {"reputation": 5384, "user_id": 736957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10421ea904bf36d23d1669a6b8c21648?s=128&d=identicon&r=PG", "display_name": "laughedelic", "link": "https://stackoverflow.com/users/736957/laughedelic"}, "edited": false, "score": 0, "creation_date": 1479234313, "post_id": 40616968, "comment_id": 68468122, "body": "The list <code>sum</code> is in <code>Prelude</code>, i.e. in scope by default, so if you don&#39;t do anything special, you will use it. To refer to another <code>sum</code>, you need to import <code>Data.Foldable</code>. So what is your doubt exactly? If there is some ambiguity, compiler should report about it."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 5384, "user_id": 736957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10421ea904bf36d23d1669a6b8c21648?s=128&d=identicon&r=PG", "display_name": "laughedelic", "link": "https://stackoverflow.com/users/736957/laughedelic"}, "edited": false, "score": 3, "creation_date": 1479234367, "post_id": 40616968, "comment_id": 68468151, "body": "@laughedelic As of recent GHC releases, the Prelude <code>sum</code> is the same one from <code>Data.Foldable</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1479234372, "post_id": 40616968, "comment_id": 68468154, "body": "Since GHC 7.10, several functions in the Prelude have generalized signatures. There is no longer a <code>sum :: Num a =&gt; [a] -&gt; a</code> - the new <code>sum :: (Num a, Foldable t) =&gt; t a -&gt; a</code> still works on lists (like the old one) but it now also works on other things (<a href=\"https://hackage.haskell.org/package/containers-0.5.8.1/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\">Sequences</a> or <a href=\"https://hackage.haskell.org/package/containers-0.5.8.1/docs/Data-Set.html\" rel=\"nofollow noreferrer\">Sets</a>)"}, {"owner": {"reputation": 5384, "user_id": 736957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10421ea904bf36d23d1669a6b8c21648?s=128&d=identicon&r=PG", "display_name": "laughedelic", "link": "https://stackoverflow.com/users/736957/laughedelic"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479234555, "post_id": 40616968, "comment_id": 68468252, "body": "@duplode Cool! I didn&#39;t know about the changes."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1479238391, "post_id": 40616968, "comment_id": 68470403, "body": "It&#39;s easy to get confused by the generality of the new Prelude types. Whenever you see <code>Foldable t</code> in the constraints, mentally replace every <code>t a</code> with <code>[a]</code> to get a simpler case."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1479245662, "last_edit_date": 1479245662, "creation_date": 1479234795, "answer_id": 40617221, "question_id": 40616968, "link": "https://stackoverflow.com/questions/40616968/different-types-in-sum-function/40617221#40617221", "title": "Different types in sum function", "body": "<blockquote>\n  <p>As I've seen in <a href=\"https://www.haskell.org/hoogle/?hoogle=Sum\" rel=\"nofollow noreferrer\">https://www.haskell.org/hoogle/?hoogle=Sum</a> this difference is due to -I think- the existence of two different sum functions. Maybe it's something like polymorphism in Java</p>\n</blockquote>\n\n<p>It is, indeed, polymorphism, though not in this way (see the P.S. at the end of this answer). Note that...</p>\n\n<pre><code>sum :: (Num a) =&gt; [a] -&gt; a\n</code></pre>\n\n<p>... is already polymorphic in the type of the numbers being summed, so it would work with, for instance, lists of <code>Integer</code> and lists of <code>Double</code>. The difference between that and...</p>\n\n<pre><code>sum :: (Num a, Foldable t) =&gt; t a -&gt; a\n</code></pre>\n\n<p>... is that this <code>sum</code> is also polymorphic in the type of the <em>container</em>:</p>\n\n<pre><code>GHCi&gt; -- +t makes GHCi print the types automatically.\nGHCi&gt; :set +t\nGHCi&gt; sum [1 :: Integer, 2, 3]\n6\nit :: Integer\nGHCi&gt; sum [1 :: Double, 2, 3]\n6.0\nit :: Double\nGHCi&gt; import qualified Data.Set as S\nGHCi&gt; :t S.fromList\nS.fromList :: Ord a =&gt; [a] -&gt; S.Set a\nGHCi&gt; sum (S.fromList [1 :: Double, 2, 3])\n6.0\nit :: Double\n</code></pre>\n\n<p>For a container type to be used with <code>sum</code>, it has to have an instance of <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html\" rel=\"nofollow noreferrer\">the <code>Foldable</code> class</a>, which covers functions that, like <code>sum</code>, might be expressed as flattening the container into a list and then folding it in some way.</p>\n\n<p>P.S.: Your book says something different than what you have seen because until quite recently the <code>sum</code> function in the Prelude used to have the less general, list-specific type, and your book predates the change. Having two different functions called <code>sum</code>, even if one is strictly more general than the other, would lead to a name clash (it was for a similar reason that I imported the <code>Data.Set</code> module qualified in the example above -- it is a good idea to do so because it defines a few functions such as <code>map</code> that clash with Prelude functions, and qualifying them with, say, <code>S.map</code> avoids any issues). </p>\n"}], "owner": {"reputation": 101, "user_id": 7163457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3aa6e612f3d047f09db9f7a07035f21a?s=128&d=identicon&r=PG&f=1", "display_name": "HastatusXXI", "link": "https://stackoverflow.com/users/7163457/hastatusxxi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 852, "favorite_count": 0, "accepted_answer_id": 40617221, "answer_count": 1, "score": 1, "last_activity_date": 1479312468, "creation_date": 1479233922, "last_edit_date": 1479311754, "question_id": 40616968, "link": "https://stackoverflow.com/questions/40616968/different-types-in-sum-function", "title": "Different types in sum function", "body": "<p>I'm new to Haskell so this could be a stupid question. I'm reading a book where it says <code>:type sum</code> is supposed to show <code>sum :: (Num a) =&gt; [a] -&gt; a</code>. Instead of that the message is <code>sum :: (Num a, Foldable t) =&gt; t a -&gt; a</code>. As I've seen in <a href=\"https://www.haskell.org/hoogle/?hoogle=Sum\" rel=\"nofollow noreferrer\">https://www.haskell.org/hoogle/?hoogle=Sum</a> this difference is due to -I think- the existence of two different sum functions. Maybe it's something like polymorphism in Java, I'm just starting and I have no idea about how Haskell works.</p>\n\n<p>So my questions are: how could I use the sum function which type is <code>sum :: (Num a) =&gt; [a] -&gt; a</code> instead of the other one? Could you explain me what's going on here?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 7, "creation_date": 1479229052, "post_id": 40615478, "comment_id": 68465033, "body": "Where is <code>Date</code> defined?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1479231689, "post_id": 40615478, "comment_id": 68466725, "body": "When getting a type error, adding type signatures to all the top-level bindings can greatly simplify it. Most Haskellers do that as a best practice. Indeed, sometimes the error is found later, in a surprising place where everything looks fine -- but the real error was much earlier and was not found only because the compiler inferred a different type than the one you would expect. Using a type annotation makes the compiler report errors where they are."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1479230417, "last_edit_date": 1479230417, "creation_date": 1479229799, "answer_id": 40615750, "question_id": 40615478, "link": "https://stackoverflow.com/questions/40615478/error-in-type-matching-haskell/40615750#40615750", "title": "Error in type matching Haskell", "body": "<p>Adding a type signature for <code>event_tests</code> should do the trick:</p>\n\n<pre><code>eventTests :: History\nevent_tests = [ ( ( 28, ( Nov, 2016 ) ), 0, 0.0 ), ( ( 27, ( Nov, 2016 ) ), 0, 0.0 ) ]\n</code></pre>\n\n<p>Part of the issue is that, as the type error suggests...</p>\n\n<pre><code>ERROR \"ass16-1.hs\":90 - Type error in explicitly typed binding\n*** Term           : history\n*** Type           : Int -&gt; ((Integer,(MonthData,Integer)),Integer,Double)\n*** Does not match : Int -&gt; HistoryElem\n</code></pre>\n\n<p>... <code>Int</code> and <code>Integer</code> are not the same type. As <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch6.html#x13-1350006.4\" rel=\"nofollow noreferrer\">section 6.4 of the Haskell Report</a> specifies, an <code>Int</code> is a fixed size integer, while an <code>Integer</code> can have arbitrary size. This affects your code because, if there is no type signature anywhere to specify which type an integer literal should be, it will default to <code>Integer</code> (see <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-750004.3\" rel=\"nofollow noreferrer\">section 4.3.4 of the report for details</a>). That being so, integers such as <code>28</code> and <code>2016</code> in your <code>event_tests</code> default to <code>Integer</code> unless you specify some other type (e.g. through your <code>History</code> type synonym, which indirectly makes them <code>Int</code>s).</p>\n"}], "owner": {"reputation": 1015, "user_id": 6391764, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae6eb3e43b8792b2ce6fa3743e01a750?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre P.", "link": "https://stackoverflow.com/users/6391764/pierre-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 1, "accepted_answer_id": 40615750, "answer_count": 1, "score": 0, "last_activity_date": 1479230417, "creation_date": 1479228888, "question_id": 40615478, "link": "https://stackoverflow.com/questions/40615478/error-in-type-matching-haskell", "title": "Error in type matching Haskell", "body": "<p>I have declared the following types</p>\n\n<pre><code>data MonthData = Jan | Feb | Mar | Apr | May | Jun | Jul | Aug | Sep | Oct | Nov | Dec deriving ( Eq, Show, Enum, Ord )\ntype Year = Int\ntype Month = ( MonthData, Year )\n\n\n\ntype Gap = Int\ntype Average = Double\ntype HistoryElem = ( Date, Gap, Average )\ntype History = [ HistoryElem ]\n</code></pre>\n\n<p>Then, I have declared the following function </p>\n\n<pre><code>event_tests = [ ( ( 28, ( Nov, 2016 ) ), 0, 0.0 ), ( ( 27, ( Nov, 2016 ) ), 0, 0.0 ) ]\nhistory :: Int -&gt; HistoryElem\nhistory 0 = head( event_tests )\n</code></pre>\n\n<p>When I try to load my file, I have the following error.</p>\n\n<pre><code>ERROR \"ass16-1.hs\":90 - Type error in explicitly typed binding\n*** Term           : history\n*** Type           : Int -&gt; ((Integer,(MonthData,Integer)),Integer,Double)\n*** Does not match : Int -&gt; HistoryElem\n</code></pre>\n\n<p>It seems that it doesn't consider that HistoryElem has been previously defined because if we look carefuly, we can see that </p>\n\n<p><code>((Integer,(MonthData,Integer)),Integer,Double)</code> is the same definition than <code>HistoryElem</code></p>\n\n<p>Can't figure out what I'm doing wrong.</p>\n"}, {"tags": ["haskell", "threepenny-gui"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 7159108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea227bf0a12e84ae374dffbcfcd2d57c?s=128&d=identicon&r=PG&f=1", "display_name": "HaskellGUIProblems", "link": "https://stackoverflow.com/users/7159108/haskellguiproblems"}, "edited": false, "score": 0, "creation_date": 1479221603, "post_id": 40611342, "comment_id": 68459866, "body": "Thank alot, I was trying to use something like <code>x &lt;- liftIO (get value area)</code> and I thought there would be a function that would similar to liftIO but for UI but I didnt think to just try it like that."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1479217276, "creation_date": 1479217276, "answer_id": 40611342, "question_id": 40610967, "link": "https://stackoverflow.com/questions/40610967/remove-ui-monad-with-threepennygui/40611342#40611342", "title": "Remove UI monad with ThreepennyGUI", "body": "<p>I am not familiar with threepenny-ui, but I guess you need something like this:</p>\n\n<pre><code>on UI.click button $ const $ do\n    s &lt;- get value area\n    element reverseArea # set UI.text (reverse s)\n</code></pre>\n\n<p>The rough idea is: when you have a value of type <code>UI String</code> you can use <code>x &lt;- value</code> inside a <code>do</code> to get the string (without <code>UI</code>) and bind it to variable <code>x</code>. You can only do this if the rest of the <code>do</code> clock at the end returns value of a type <code>UI T</code> for some type <code>T</code>.</p>\n\n<p>So, use <code>&lt;-</code> as needed to get the pure values.</p>\n\n<p>By the way, this is not specific to <code>UI</code>: every monad follows this principle. You will find plenty of monad tutorials around the net.</p>\n"}], "owner": {"reputation": 13, "user_id": 7159108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea227bf0a12e84ae374dffbcfcd2d57c?s=128&d=identicon&r=PG&f=1", "display_name": "HaskellGUIProblems", "link": "https://stackoverflow.com/users/7159108/haskellguiproblems"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 1, "accepted_answer_id": 40611342, "answer_count": 1, "score": 1, "last_activity_date": 1479217276, "creation_date": 1479216311, "question_id": 40610967, "link": "https://stackoverflow.com/questions/40610967/remove-ui-monad-with-threepennygui", "title": "Remove UI monad with ThreepennyGUI", "body": "<p>I'm really new to using the threepenny gui and I want to do something like this:</p>\n\n<pre><code>on UI.click button $ const $ do\n        element reverseArea # set UI.text (reverse (get value area))\n</code></pre>\n\n<p>So when i click a certain button on the page i get the text from a textarea, reverse it and display it in a different text area.\nHowever when i try run this, I get the error :</p>\n\n<pre><code> Couldn't match expected type \u2018[Char]\u2019 with actual type \u2018UI String\u2019\n</code></pre>\n\n<p>So I wanted to know how could I remove the UI monad so I can manipulate the text</p>\n"}, {"tags": ["haskell", "recursion", "parallel-processing"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479157295, "post_id": 40597520, "comment_id": 68430923, "body": "I&#39;d say you are overthinking this. Does your <code>main</code> pass the type checker, runs and prints a result, as you expected from the example? If so, everything is fine."}, {"owner": {"reputation": 41, "user_id": 6927415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25347417d08ee4c9423b59b6d63b561e?s=128&d=identicon&r=PG&f=1", "display_name": "andrew_j", "link": "https://stackoverflow.com/users/6927415/andrew-j"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479157471, "post_id": 40597520, "comment_id": 68431019, "body": "&quot;@duplode my code compiles fine, but I can&#39;t understand if my output is correct. But the main problem is that I need to calculating definite integral, so without understanding this code it seems difficult."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479158095, "post_id": 40597520, "comment_id": 68431310, "body": "All you are doing is printing the result, so the output is exactly as correct as the example code in the documentation is. As for the <code>(x:y:xs)</code> pattern, the only difference between that and <code>(x:xs)</code> is that you are also giving a name -- <code>y</code> -- to the second element of the list (in addition to the first element -- <code>x</code> -- and to the tail -- <code>xs</code>) so that you can also refer to it in the right side of <code>=</code>. Naturally, that only works if the list has at least two elements."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1479158206, "post_id": 40597520, "comment_id": 68431366, "body": "Also note that the example is not from the <code>Control.Parallel</code> docs, but from <a href=\"http://www.stolaf.edu/people/rab/pub/PDC/I15/Pi_Integration_SharedMemory_html/Haskell/Haskell.html\" rel=\"nofollow noreferrer\">stolaf.edu/people/rab/pub/PDC/I15/&hellip;</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1479162764, "post_id": 40597520, "comment_id": 68433484, "body": "What are you asking?"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1479168423, "creation_date": 1479168423, "answer_id": 40599959, "question_id": 40597520, "link": "https://stackoverflow.com/questions/40597520/recursion-and-parallelism-in-haskell/40599959#40599959", "title": "Recursion and parallelism in Haskell", "body": "<p>The recursion, essentially, is a simple <code>fold</code>-like recursion scheme; if this were purely sequential, you might write it as</p>\n\n<pre><code>seqEstimate :: [Double] -&gt; Double\nseqEstimate (x:[]) = 0\nseqEstimate (x:y:[]) = area x y\nseqEstimate (x:y:xs) = smaller + larger\n    where smaller = area x y\n          larger = seqEstimate (y:xs)\n</code></pre>\n\n<p>(In fact, you would probably just use <code>zipWith</code> instead: <code>seqEstimate xs = sum (zipWith area xs (tail xs))</code>.)</p>\n\n<p>The parallelized version is similar. This time, though, <code>par</code> is used to indicate that the left-hand side (<code>smaller</code>) can be evaluated in parallel with the right-hand side (<code>pseq larger (smaller + larger)</code>). Whether or not the compiler chooses to do so, and regardless of whether <code>smaller</code> completes before or after <code>larger</code>, the sum of <code>smaller + larger</code> will be correctly computed.</p>\n"}], "owner": {"reputation": 41, "user_id": 6927415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25347417d08ee4c9423b59b6d63b561e?s=128&d=identicon&r=PG&f=1", "display_name": "andrew_j", "link": "https://stackoverflow.com/users/6927415/andrew-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 339, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1479168423, "creation_date": 1479156279, "last_edit_date": 1479156517, "question_id": 40597520, "link": "https://stackoverflow.com/questions/40597520/recursion-and-parallelism-in-haskell", "title": "Recursion and parallelism in Haskell", "body": "<p>I'm trying to understand how paralleling in Haskell works and I've found following example in Control.Parallel docs.</p>\n\n<pre><code>import Control.Parallel\n\n-- Equation for the upper hemisphere of the unit circle\n\ncircle :: Double -&gt; Double\ncircle x = sqrt (abs(1 - x^2))\n\n-- Calculate the area of a right-handed Riemann rectangle\n\narea :: Double -&gt; Double -&gt; Double\narea x1 x2 = (x2 - x1) * circle x2\n\n-- Recursively add the areas of the Riemann rectangles\n\nparEstimate :: [Double] -&gt; Double\nparEstimate (x:[]) = 0\nparEstimate (x:y:[]) = area x y\nparEstimate (x:y:xs) =\nsmaller `par` (larger `pseq` smaller + larger)\n  where smaller = area x y\n        larger = parEstimate (y:xs)\n</code></pre>\n\n<p>But I couldn't find an explanation of how this recursion works: parEstimate (x:y:xs), cause all examples I've found contains only two arguments.\nThat's why I cannot find out how to run this function. That's how I do:</p>\n\n<pre><code>main = print (parEstimate [1.0, 2.0])\n</code></pre>\n\n<p>but not sure, if it's correct.\nAlso I would like to implement function calculating definite integral based on this example. </p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1479154995, "post_id": 40596813, "comment_id": 68429817, "body": "One of the first rules of dealing with currency is to not use floating-point values to represent amounts of money."}, {"owner": {"reputation": 141, "user_id": 7091266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4c7265b02e328b183b28bdaf2d77ecb6?s=128&d=identicon&r=PG&f=1", "display_name": "Rad", "link": "https://stackoverflow.com/users/7091266/rad"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1479155189, "post_id": 40596813, "comment_id": 68429910, "body": "Could you please elaborate? I don&#39;t understand."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1479158650, "post_id": 40596813, "comment_id": 68431550, "body": "Floating-point values are just approximations of real numbers. You wouldn&#39;t be making change for some fuzzy fraction of a dollar; you make change for an exact integer number of cents."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1479213764, "post_id": 40596813, "comment_id": 68454483, "body": "Consider this sum: <code>sum (replicate 10 0.01)</code>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1479222767, "post_id": 40596813, "comment_id": 68460691, "body": "(Corollary: consider @chepner &#39;s example in light of your program: <code>sum (replicate 10 0.01) - 0.1 == 0</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 7091266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4c7265b02e328b183b28bdaf2d77ecb6?s=128&d=identicon&r=PG&f=1", "display_name": "Rad", "link": "https://stackoverflow.com/users/7091266/rad"}, "edited": false, "score": 0, "creation_date": 1479154623, "post_id": 40596908, "comment_id": 68429637, "body": "I renamed my original function to    changeHelp and your suggestion to    change, now it works great! Thank you."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1479154205, "last_edit_date": 1479154205, "creation_date": 1479153803, "answer_id": 40596908, "question_id": 40596813, "link": "https://stackoverflow.com/questions/40596813/converting-double-to-int/40596908#40596908", "title": "&quot;Converting&quot; Double to Int", "body": "<p>This time I think you are looking for <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:round\" rel=\"nofollow noreferrer\"><code>round</code></a>. Also, I think you really do want a new function <code>changeDouble</code> here, not to modify <code>change</code>. This will solve your <code>Double</code> problem nicely and presents the simpler signature <code>changeDouble :: Double -&gt; [Int]</code>.</p>\n\n<pre><code>changeDouble :: Double -&gt; [Int]\nchangeDouble n = change (round (100 * n)) coins\n</code></pre>\n\n<p>The problem with mixing <code>Double</code> and <code>Int</code> is indeed the same as you would encounter via use of <code>/</code> on <code>Int</code>s.</p>\n\n<hr>\n\n<p>As a side note, even if your proposed updated code to <code>change</code> were to compile, note that the recursive call would need to be updated to pass in <code>n - (fromIntegral firstCoin) / 10</code> instead of just <code>n - firstCoin</code>.</p>\n"}], "owner": {"reputation": 141, "user_id": 7091266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4c7265b02e328b183b28bdaf2d77ecb6?s=128&d=identicon&r=PG&f=1", "display_name": "Rad", "link": "https://stackoverflow.com/users/7091266/rad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3042, "favorite_count": 0, "accepted_answer_id": 40596908, "answer_count": 1, "score": 1, "last_activity_date": 1479154205, "creation_date": 1479153428, "question_id": 40596813, "link": "https://stackoverflow.com/questions/40596813/converting-double-to-int", "title": "&quot;Converting&quot; Double to Int", "body": "<p>I want to write a function that calculates change when given an amount of coins. It has worked great except when I actually want the input to be a Double rather than Int.</p>\n\n<p>This is my code</p>\n\n<pre><code>coins::[Int]\ncoins = [200, 100, 50, 20, 10, 5, 2, 1]\nchange::Int-&gt;[Int]-&gt;[Int]\nchange n [] = []\nchange n coins\n         | n == 0 = []\n         | n &gt;= firstcoin = firstcoin:change (n-firstcoin) coins  \n         | otherwise = change n (tail coins)\n         where firstcoin = head coins\n</code></pre>\n\n<p>This works nice and all, but when I try changing the code to:</p>\n\n<pre><code>change::Double-&gt;[Int]-&gt;[Int]\n         | (n*100) == 0 = []\n         | (n*100) &gt;= firstcoin = firstcoin:change (n-firstcoin) coins\n         | otherwise = change n (tail coins)\n         where firstcoin = head coins\n</code></pre>\n\n<p>The following happens:</p>\n\n<pre><code>  [1 of 1] Compiling Main             ( coin.hs, interpreted )\n\n  coin.hs:7:27:\n  Couldn't match expected type \u2018Double\u2019 with actual type \u2018Int\u2019\n  In the second argument of \u2018(&gt;=)\u2019, namely \u2018firstcoin\u2019\n  In the expression: (n * 100) &gt;= firstcoin\n\n  coin.hs:7:59:\n  Couldn't match expected type \u2018Double\u2019 with actual type \u2018Int\u2019\n  In the second argument of \u2018(-)\u2019, namely \u2018firstcoin\u2019\n  In the first argument of \u2018change\u2019, namely \u2018(n - firstcoin)\u2019\n  Failed, modules loaded: none.\n</code></pre>\n\n<p>Is this like using \"/\" where I have to use fromIntegral beforehand? If so, how does that translate here?</p>\n\n<p>*A little side question: how can I make the list of coins written here \"embedded\" into the function so that the signature would look like:</p>\n\n<pre><code>change::Int-&gt;[Int]\n</code></pre>\n\n<p>(in other words, I don't want to explicitly write in the list for it to work. Would I need to change my whole code?)</p>\n"}, {"tags": ["haskell", "generic-programming"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1479143681, "post_id": 40593441, "comment_id": 68423997, "body": "&quot;I actually don&#39;t care about the top-level declaration&quot; - how do you intend to create a type without creating a declaration for it?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1479144695, "post_id": 40593441, "comment_id": 68424581, "body": "@BenjaminHodgson I guess they want a declaration of a type <code>Magic t a</code>, which somehow &quot;digs&quot; inside the definition of <code>t</code> and produces a type isomorphic to the associated <code>Tag...</code>. I don&#39;t think this is feasible without breaking parametric polymorphism: one would need some kind of reflection inside <code>t</code>&#39;s definition."}, {"owner": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 0, "creation_date": 1479144852, "post_id": 40593441, "comment_id": 68424660, "body": "basically as chi says - so, instead of saying <code>data TagSomeUserType a ...</code>, and giving the full definition, I&#39;d like to be able to say <code>type TagSomeUserType a = Magic SomeUserType</code>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1479144874, "post_id": 40593441, "comment_id": 68424670, "body": "I suppose you could define <code>Magic</code> as a <code>data family</code> and then generate <code>data instance Magic SomeUserType where ...</code> but you&#39;d still need Template Haskell for that"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1479148635, "post_id": 40593441, "comment_id": 68426593, "body": "I&#39;m afraid @BenjaminHodgson is right and you still need TH to make a type. Making a <code>data family</code> is exactly what I had in mind."}], "answers": [{"comments": [{"owner": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 0, "creation_date": 1479149844, "post_id": 40595351, "comment_id": 68427230, "body": "thanks again alec. I&#39;m still digesting this, but it is clearer that there&#39;s a fundamental need to generate code at some point. However, would it be possible to use the same tools that the Aeson library does (<a href=\"https://hackage.haskell.org/package/aeson-1.0.2.1/docs/Data-Aeson.html#g:14\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/aeson-1.0.2.1/docs/&hellip;</a>)? The situation there seems pretty similar - take an arbitrary type and generate code that does need to interact with the structure of that type."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 1, "creation_date": 1479150426, "post_id": 40595351, "comment_id": 68427523, "body": "@ajp Unfortunately that isn&#39;t possible here. What they are doing is writing a default implementation that relies on the type having a <code>Generic</code> constraint satisfied. No code is generated though. Furthermore, we have to introduce new <i>types</i>, so <code>Generic</code> <i>really</i> can&#39;t help us."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1479152730, "post_id": 40595351, "comment_id": 68428696, "body": "Also, <code>Generic</code> still works by code generation. When you say <code>deriving Generic</code> GHC writes an <code>instance</code> and fills in the type family <code>Rep</code>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1479147862, "creation_date": 1479147862, "answer_id": 40595351, "question_id": 40593441, "link": "https://stackoverflow.com/questions/40593441/how-can-i-produce-a-tag-type-for-any-datatype-for-use-with-dsum-without-templat/40595351#40595351", "title": "How can I produce a Tag type for any datatype for use with DSum, without Template Haskell?", "body": "<p>I'm not sure you can dispense with the TH since, as noted in the comments, you still need to make a type at the end of the day. As Benjamin notes, you are probably looking for a <code>data family</code>. </p>\n\n<p>What you call <code>Magic</code>, I will refer to as <code>Tagged</code>.</p>\n\n<p>Here is the adjusted code you will need for <strong>tag.hs</strong></p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nmodule Tag where\n\nimport Language.Haskell.TH\n\nmakeTag :: Name -&gt; Name -&gt; DecsQ\nmakeTag name tag = do\n    -- Reify the data declaration to get the constructors.\n    -- Note we are forcing there to be no type variables...\n    (TyConI (DataD _ _ [] _ cons _)) &lt;- reify name\n\n    pure [ DataInstD [] tag [(ConT name), (VarT (mkName \"a\"))] Nothing (tagCon &lt;$&gt; cons) [] ]\n  where\n  -- Given a constructor, construct the corresponding constructor for\n  -- Tag GADT\n  tagCon :: Con -&gt; Con\n  tagCon (NormalC conName args) =\n    let tys = fmap snd args\n        tagType = foldl AppT (TupleT (length tys)) tys\n    in GadtC [mkName (\"Tag\" ++ nameBase conName)] []\n             (AppT (AppT (ConT tag) (ConT name)) tagType)\n</code></pre>\n\n<p>And, a sample use case (all the way through to something involving <code>DSum</code>):</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, GADTs, TypeFamilies #-}\nmodule Test where\n\nimport Data.Dependent.Sum\nimport Data.Functor.Identity\nimport Tag\n\n-- Some data types\ndata SomeUserType1 = Foo Int | Bar String\ndata SomeUserType2 = Fooo Int | Baar Char | Baaz Bool String\ndata SomeAwkUserType = Foooo Int\n\n-- Data family for all Tagged things\ndata family Tagged t a\n\n-- Generated data family instances\nmakeTag ''SomeUserType1 ''Tagged\nmakeTag ''SomeUserType2 ''Tagged\nmakeTag ''SomeAwkUserType ''Tagged\n\n--  A sample DSum's use case\ntoString :: DSum (Tagged SomeUserType1) Identity -&gt; String\ntoString (TagFoo :=&gt; Identity int) = show int\ntoString (TagBar :=&gt; Identity str) = str\n</code></pre>\n\n<p>This ends up generating <code>data family</code> tag instances for each type. Let me know if you have any questions.</p>\n"}, {"comments": [{"owner": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 0, "creation_date": 1479349320, "post_id": 40621740, "comment_id": 68523265, "body": "why do we need Tup2List?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 0, "creation_date": 1479402152, "post_id": 40621740, "comment_id": 68552762, "body": "@ajp See the edit. It is mainly just convenience and a choice of encoding (i.e. a design choice, which you are free to make how you want). I just wanted a fully faithful translation of the desired pseudocode."}, {"owner": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 0, "creation_date": 1479592437, "post_id": 40621740, "comment_id": 68625854, "body": "where does (:&amp;) come from? I don&#39;t see it on stackage hoogle <a href=\"https://www.stackage.org/lts-7.9/hoogle?q=%3A%26&amp;exact=on\" rel=\"nofollow noreferrer\">stackage.org/lts-7.9/hoogle?q=%3A%26&amp;exact=on</a> (which does turn up e.g. (:=&gt;)"}, {"owner": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 0, "creation_date": 1479600494, "post_id": 40621740, "comment_id": 68627616, "body": "actually, i&#39;ve figured that out - (:&amp;) should just be (:=&gt;). However, I am stuck writing a GEq instance for GTag <a href=\"http://stackoverflow.com/questions/40698207/how-can-i-write-this-geq-instance\" title=\"how can i write this geq instance\">stackoverflow.com/questions/40698207/&hellip;</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 0, "creation_date": 1479610968, "post_id": 40621740, "comment_id": 68629418, "body": "@ajp Actually it is the pattern synonym equal to <code>pattern t :&amp; a = t :=&gt; I a</code> - I added this code. (And I will take a look at this question, thank you ;))"}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 4, "last_activity_date": 1479592578, "last_edit_date": 1479592578, "creation_date": 1479253692, "answer_id": 40621740, "question_id": 40593441, "link": "https://stackoverflow.com/questions/40593441/how-can-i-produce-a-tag-type-for-any-datatype-for-use-with-dsum-without-templat/40621740#40621740", "title": "How can I produce a Tag type for any datatype for use with DSum, without Template Haskell?", "body": "<p>Unlike some here have claimed, it is perfectly sensible (and in fact quite straightforward, with the correct library - <code>generics-sop</code>) to define such a type. Essentially all the machinery is provided by this library already: </p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms, PolyKinds, DeriveGeneric #-} \n\nimport Generics.SOP \nimport qualified GHC.Generics as GHC \nimport Data.Dependent.Sum\n\ndata Tup2List :: * -&gt; [*] -&gt; * where \n  Tup0 :: Tup2List () '[] \n  Tup1 :: Tup2List x '[ x ] \n  TupS :: Tup2List r (x ': xs) -&gt; Tup2List (a, r) (a ': x ': xs) \n\nnewtype GTag t i = GTag { unTag :: NS (Tup2List i) (Code t) }\n</code></pre>\n\n<p>The type <code>GTag</code> is what you call <code>Magic</code>. The actual 'magic' happens in the <code>Code</code> type family, which compute the generic representation of a type, as a list of lists of types. The type <code>NS (Tup2List i) xs</code> means that for precisely one of <code>xs</code>, <code>Tup2List i</code> holds - this is simply a proof that a list of arguments is isomorphic to some tuple. </p>\n\n<p>All the classes you need can be derived: </p>\n\n<pre><code>data SomeUserType = Foo Int | Bar Char | Baz Bool String \n  deriving (GHC.Generic, Show) \ninstance Generic SomeUserType\n</code></pre>\n\n<p>You can define some pattern synonyms for the tags valid for this type:</p>\n\n<pre><code>pattern TagFoo :: () =&gt; (x ~ Int) =&gt; GTag SomeUserType x \npattern TagFoo = GTag (Z Tup1) \n\npattern TagBar :: () =&gt; (x ~ Char) =&gt; GTag SomeUserType x \npattern TagBar = GTag (S (Z Tup1)) \n\npattern TagBaz :: () =&gt; (x ~ (Bool, String)) =&gt; GTag SomeUserType x \npattern TagBaz = GTag (S (S (Z (TupS Tup1))))\n</code></pre>\n\n<p>and a simple test: </p>\n\n<pre><code>fun0 :: GTag SomeUserType i -&gt; i -&gt; String \nfun0 TagFoo i = replicate i 'a' \nfun0 TagBar c = c : [] \nfun0 TagBaz (b,s) = (if b then show else id) s \n\nfun0' = \\(t :&amp; v) -&gt; fun0 t v \n\nmain = mapM_ (putStrLn . fun0' . toTagVal) \n          [ Foo 10, Bar 'q', Baz True \"hello\", Baz False \"world\" ] \n</code></pre>\n\n<p>Since this is expressed in terms of a generic type function, you can write generic operations over tags. For example, <code>exists x . (GTag t x, x)</code> is isomorphic to <code>t</code> for any <code>Generic t</code>: </p>\n\n<pre><code>type GTagVal t = DSum (GTag t) I \n\npattern (:&amp;) :: forall (t :: * -&gt; *). () =&gt; forall a. t a -&gt; a -&gt; DSum t I\npattern t :&amp; a = t :=&gt; I a     \n\ntoTagValG_Con :: NP I xs -&gt; (forall i . Tup2List i xs -&gt; i -&gt; r) -&gt; r \ntoTagValG_Con Nil k = k Tup0 () \ntoTagValG_Con (I x :* Nil) k = k Tup1 x\ntoTagValG_Con (I x :* y :* ys) k = toTagValG_Con (y :* ys) (\\tp vl -&gt; k (TupS tp) (x, vl))\n\ntoTagValG :: NS (NP I) xss -&gt; (forall i . NS (Tup2List i) xss -&gt; i -&gt; r) -&gt; r \ntoTagValG (Z x) k = toTagValG_Con x (k . Z)\ntoTagValG (S q) k = toTagValG q (k . S)\n\nfromTagValG_Con :: i -&gt; Tup2List i xs -&gt; NP I xs \nfromTagValG_Con i Tup0 = case i of { () -&gt; Nil } \nfromTagValG_Con x Tup1 = I x :* Nil \nfromTagValG_Con xs (TupS tg) = I (fst xs) :* fromTagValG_Con (snd xs) tg \n\ntoTagVal :: Generic a =&gt; a -&gt; GTagVal a \ntoTagVal a = toTagValG (unSOP $ from a) ((:&amp;) . GTag)\n\nfromTagVal :: Generic a =&gt; GTagVal a -&gt; a \nfromTagVal (GTag tg :&amp; vl) = to $ SOP $ hmap (fromTagValG_Con vl) tg \n</code></pre>\n\n<hr>\n\n<p>As for the need for <code>Tup2List</code>, it is needed for the simply reason that you represent a constructor of two arguments (<code>Baz Bool String</code>) as a tag over a tuple of <code>(Bool, String)</code> in your example. </p>\n\n<p>You could also implement it as </p>\n\n<pre><code>type HList = NP I -- from generics-sop \n\ndata Tup2List i xs where Tup2List :: Tup2List (HList xs) xs\n</code></pre>\n\n<p>which represents the arguments as a heterogeneous list, or even more simply</p>\n\n<pre><code>newtype GTag t i = GTag { unTag :: NS ((:~:) i) (Code t) }\ntype GTagVal t = DSum (GTag t) HList  \n\nfun0 :: GTag SomeUserType i -&gt; HList i -&gt; String \nfun0 TagFoo (I i :* Nil) = replicate i 'a' \nfun0 ...\n</code></pre>\n\n<p>However, the tuple representation does have the advantage that unary tuples are 'projected' to the single value which is in the tuple (i.e., instead of <code>(x, ())</code>). If you represent arguements in the obvious way, functions such as <code>fun0</code> must pattern match to retrieve the single value stored in a constructor.  </p>\n"}], "owner": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 1, "accepted_answer_id": 40621740, "answer_count": 2, "score": 1, "last_activity_date": 1479592578, "creation_date": 1479140937, "last_edit_date": 1592644375, "question_id": 40593441, "link": "https://stackoverflow.com/questions/40593441/how-can-i-produce-a-tag-type-for-any-datatype-for-use-with-dsum-without-templat", "title": "How can I produce a Tag type for any datatype for use with DSum, without Template Haskell?", "body": "<p><strong>background</strong></p>\n<p>I want to write some library code, which internally uses DSum to manipulate a user's datatype. DSum requires a 'tag' type that has a single type argument. However I want my code to work with just any old concrete type. So, I'd like to just take the user's type and automatically produce the tag type. I've asked a very similar question here <a href=\"https://stackoverflow.com/questions/40582270/how-can-i-programatically-produce-this-datatype-from-the-other/40582869?noredirect=1#comment68402379_40582869\">How can I programatically produce this datatype from the other?</a>, and gotten a great answer. That answer relies on TH, mainly so that it can create top-level declarations. However, I actually don't care about the top-level declaration, and I'd prefer to avoid the TH if possible.</p>\n<p><strong>question</strong></p>\n<p>[How] can I write, with some generic programming technique, a datatype</p>\n<pre><code>data Magic t a ...\n</code></pre>\n<p>where given some arbitrary sum type, e.g.</p>\n<pre><code>data SomeUserType = Foo Int | Bar Char | Baz Bool String\n</code></pre>\n<p><code>Magic SomeUserType</code> is equivalent to this 'tag' type that can be used with DSum?</p>\n<pre><code>data TagSomeUserType a where\n  TagFoo :: TagSomeUserType Int\n  TagBar :: TagSomeUserType Char\n  TagBaz :: TagSomeUserType (Bool, String)\n</code></pre>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 30577, "user_id": 476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85197b0087c5bee323d2690c977878f8?s=128&d=identicon&r=PG", "display_name": "Vincent Savard", "link": "https://stackoverflow.com/users/476496/vincent-savard"}, "edited": false, "score": 0, "creation_date": 1479137765, "post_id": 40592338, "comment_id": 68420266, "body": "What do you understand about it? What do you have trouble understanding?"}, {"owner": {"reputation": 981, "user_id": 3044967, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a0e62ac8cb1ade85abbf3f04fba77608?s=128&d=identicon&r=PG&f=1", "display_name": "Aniketh", "link": "https://stackoverflow.com/users/3044967/aniketh"}, "reply_to_user": {"reputation": 30577, "user_id": 476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85197b0087c5bee323d2690c977878f8?s=128&d=identicon&r=PG", "display_name": "Vincent Savard", "link": "https://stackoverflow.com/users/476496/vincent-savard"}, "edited": false, "score": 0, "creation_date": 1479138141, "post_id": 40592338, "comment_id": 68420507, "body": "Having trouble understanding what Num(a-&gt; b) means in this context ? Num instance for a function type ? I recently started learning haskell ,so far i have seen Num a type but not Num (function)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1479138592, "post_id": 40592338, "comment_id": 68420822, "body": "<code>(10 $)</code> is a function, <code>(10 $) x = 10 $ x = 10 x</code>. This demands <code>10</code> to be of type <code>a -&gt; b</code>, because general function application is <code>(f :: a -&gt; b) (x :: a) :: b</code>.  In Haskell, numeric literals have type <code>Num a =&gt; a</code>, meaning, <i>any</i> type <code>a</code> which is <b>in</b> the type class <code>Num</code>.  Thus the type of <code>(10 $)</code> must be <code>(Num a) =&gt; (a -&gt; b)</code>. Indeed this is not a common situation. You probably didn&#39;t mean for <code>10</code> to serve as a function."}, {"owner": {"reputation": 981, "user_id": 3044967, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a0e62ac8cb1ade85abbf3f04fba77608?s=128&d=identicon&r=PG&f=1", "display_name": "Aniketh", "link": "https://stackoverflow.com/users/3044967/aniketh"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1479138910, "post_id": 40592338, "comment_id": 68421049, "body": "You are right @WillNess, I dint mean 10 to serve as a function am just trying to understand how map function and dollar operator work in different combinations. Thanks"}, {"owner": {"reputation": 981, "user_id": 3044967, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a0e62ac8cb1ade85abbf3f04fba77608?s=128&d=identicon&r=PG&f=1", "display_name": "Aniketh", "link": "https://stackoverflow.com/users/3044967/aniketh"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1479139672, "post_id": 40592338, "comment_id": 68421535, "body": "@WillNess , What happens if I put 10 on right hand side of $ like <code>($10) x</code>,how x is applied to 10 ? (for example x = (\\y-&gt;y+1)) .Thanks"}, {"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 0, "creation_date": 1479139710, "post_id": 40592338, "comment_id": 68421563, "body": "@anired: try it and see!  If you&#39;re still confused, try asking another question here."}, {"owner": {"reputation": 981, "user_id": 3044967, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a0e62ac8cb1ade85abbf3f04fba77608?s=128&d=identicon&r=PG&f=1", "display_name": "Aniketh", "link": "https://stackoverflow.com/users/3044967/aniketh"}, "reply_to_user": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 0, "creation_date": 1479140103, "post_id": 40592338, "comment_id": 68421815, "body": "@jcast I tried it <code>Prelude&gt;  ($10) (\\x-&gt;x+3)</code> returns <code>13</code>  , here I want to know how the literal  <code>10 </code> is applied to function ,as <code>($(\\x-&gt;x+3)) 10</code> fails."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479140640, "post_id": 40592338, "comment_id": 68422146, "body": "@anired In one case, <code>10</code> is the second argument to <code>($)</code>; in the other, it is the first, Now, take a second look at the type of <code>($)</code>."}, {"owner": {"reputation": 981, "user_id": 3044967, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a0e62ac8cb1ade85abbf3f04fba77608?s=128&d=identicon&r=PG&f=1", "display_name": "Aniketh", "link": "https://stackoverflow.com/users/3044967/aniketh"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1479140914, "post_id": 40592338, "comment_id": 68422320, "body": "@duplode I tried a lot to find documentation about ($) but no luck , would really appreciate if you can point me to one. Thanks much"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1479141150, "post_id": 40592338, "comment_id": 68422468, "body": "<code>($10) (\\x -&gt; x+3)</code> is equivalent to <code>(\\f -&gt; f $ 10)(\\x-&gt;x+3)</code>, which reduces to <code>(\\x -&gt; x + 3) $ 10</code>, and finally to <code>10 + 3</code> and <code>13</code>. <code>($)</code> is just function application in operator form: <code>f $ x = f x</code>. It might make more sense if you give it a different name and put it in normal prefix form: <code>apply f x = f x</code>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479142223, "post_id": 40592338, "comment_id": 68423170, "body": "@anired Try <code>:t ($)</code>. <a href=\"https://www.haskell.org/hoogle/?hoogle=%24\" rel=\"nofollow noreferrer\">Hoogle</a> can also help in such cases."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1479153618, "last_edit_date": 1495541627, "creation_date": 1479138447, "answer_id": 40592660, "question_id": 40592338, "link": "https://stackoverflow.com/questions/40592338/how-to-read-the-following-haskell-definition-num-a-b-a-b/40592660#40592660", "title": "How to read the following haskell definition &quot; Num (a -&gt; b) =&gt; [a] -&gt; [b] &quot;", "body": "<p><code>(10 $)</code> is a function, <code>(10 $) x = 10 $ x = 10 x</code>. This demands <code>10</code> to be of type <code>a -&gt; b</code>, because general function application is <code>(f :: a -&gt; b) (x :: a) :: b</code>.</p>\n\n<p>In Haskell, numeric literals have type <code>Num a =&gt; a</code>, meaning, <em>any</em> type <code>a</code> which is <strong>in</strong> the type class <code>Num</code>.</p>\n\n<p>Thus the type of <code>(10 $)</code> must be <code>(Num a) =&gt; (a -&gt; b)</code>. Indeed this is not a common situation. You probably didn't mean for <code>10</code> to serve as a function. </p>\n\n<p>On the other hand, <code>($ 10) x = x $ 10 = x 10</code>. This is known as \"operator sections\": <a href=\"https://stackoverflow.com/a/13477198/849891\"><code>(a `op` b) = (a `op`) b = (`op` b) a = op a b</code></a>. When special characters (<code>$</code>, <code>:</code>, etc.) are used as \"op\" (operator), there's no need to put them inside the back-quotes.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1479150954, "creation_date": 1479150954, "answer_id": 40596175, "question_id": 40592338, "link": "https://stackoverflow.com/questions/40592338/how-to-read-the-following-haskell-definition-num-a-b-a-b/40596175#40596175", "title": "How to read the following haskell definition &quot; Num (a -&gt; b) =&gt; [a] -&gt; [b] &quot;", "body": "<p><em>How to understand a constraint like <code>Num (a-&gt;b)</code>?</em> can be answered more generally: how to understand <code>Num SomeCompoundType</code>?</p>\n\n<p>Quite simple, such a constraint means that you tried to treat a type as a number type though it is not a number type. Such a type is just bogus, though it is not a type error (and theoretically, somebody <em>could</em> add a <code>Num (a -&gt; b)</code> instance).</p>\n\n<p>With <code>Num</code> in particular, \u201ctreated as a number\u201d usually just means that you wrote a number literal in a place where e.g. a function is expected. The section <code>(10$)</code> wants <code>10</code> to be a function. Because Haskell number literals are polymorphic, there is per se nothing wrong with that: <code>10</code> <em>could</em> be a function if only it had the suitable <code>instance Num (a -&gt; b)</code>. Just, this instance does not exist, but because somebody could in principle yet add it later, the compiler leaves this as a constraint-to-be-fulfilled.</p>\n"}], "owner": {"reputation": 981, "user_id": 3044967, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a0e62ac8cb1ade85abbf3f04fba77608?s=128&d=identicon&r=PG&f=1", "display_name": "Aniketh", "link": "https://stackoverflow.com/users/3044967/aniketh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1480450035, "creation_date": 1479137517, "last_edit_date": 1480450035, "question_id": 40592338, "link": "https://stackoverflow.com/questions/40592338/how-to-read-the-following-haskell-definition-num-a-b-a-b", "title": "How to read the following haskell definition &quot; Num (a -&gt; b) =&gt; [a] -&gt; [b] &quot;", "body": "<p>I am trying to understand below type </p>\n\n<pre><code>Prelude&gt; :t map(10$)\nmap(10$) :: Num (a -&gt; b) =&gt; [a] -&gt; [b]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "edited": false, "score": 0, "creation_date": 1479135911, "post_id": 40591673, "comment_id": 68419019, "body": "Chepner answered before I could, but just to add a little context to his (correct!) answer in case it helps you out - in Haskell, function definition/application is done using spaces, rather than brackets and commas. This trips a lot of people up coming from C-like languages - what would be <code>x(y, z)</code> becomes <code>x y z</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1479149365, "post_id": 40591673, "comment_id": 68426996, "body": "This question clearly comes from the point of view of learning Haskell; however, for anybody who finds this question by search and is trying to use (rather than learn) Haskell, take a look at <a href=\"http://hackage.haskell.org/package/time-1.6.0.1/docs/Data-Time-Calendar.html#v:gregorianMonthLength\" rel=\"nofollow noreferrer\">gregorianMonthLength</a> from the <code>time</code> package for this functionality."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1479135644, "creation_date": 1479135644, "answer_id": 40591749, "question_id": 40591673, "link": "https://stackoverflow.com/questions/40591673/instantiation-error-in-haskell/40591749#40591749", "title": "Instantiation error in Haskell", "body": "<p>Your type declaration says that <code>days</code> (ignoring currying) takes two arguments. Your definition, though, says <code>days</code> takes a single tuple as an argument. Change the type to</p>\n\n<pre><code>days :: Month -&gt; Int\ndays (m, d) = 31\n</code></pre>\n\n<p>or change the definition to</p>\n\n<pre><code>days :: Month -&gt; Int -&gt; Int\ndays (m, d) x = 31\n</code></pre>\n\n<p>depending on what <code>days</code> is supposed to do.</p>\n\n<p>Your definition only specifies the first of the two arguments expected given your type. Since <code>days :: Month -&gt; Int -&gt; Int</code>, then <code>days (m, d) :: Int -&gt; Int</code>. Since you said the return value was <code>31</code> (which has type <code>Num a =&gt; a</code>) Haskell attempted to unify <code>a</code> with <code>Int -&gt; Int</code>. (That is, treated <code>31</code> as a function that takes an integer and returns an integer.) There is no <code>Num</code> instance for <code>Int -&gt; Int</code>, hence the error.</p>\n"}], "owner": {"reputation": 1015, "user_id": 6391764, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae6eb3e43b8792b2ce6fa3743e01a750?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre P.", "link": "https://stackoverflow.com/users/6391764/pierre-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 40591749, "answer_count": 1, "score": 0, "last_activity_date": 1479135644, "creation_date": 1479135446, "question_id": 40591673, "link": "https://stackoverflow.com/questions/40591673/instantiation-error-in-haskell", "title": "Instantiation error in Haskell", "body": "<p>I have the following code in <strong>Haskell</strong></p>\n\n<pre><code>type Year = Int\ndata MonthData = Jan | Feb | March | Apr | Mar\u00a0| May | Jun | Jul | Aug | Sep | Oct | Nov | Dec deriving ( Eq, Show, Ord )\ntype Month = ( MonthData, Year )\n\ndays :: Month -&gt; Int -&gt; Int\ndays( m, d ) = 31\n</code></pre>\n\n<p>When I try to execute it in the Hugs interpreter, I have the following error:</p>\n\n<pre><code>ERROR Instance of Num (Int -&gt; Int) required for definition of days\n</code></pre>\n\n<p>The error is located on the last line of my code, FYI.</p>\n\n<p>Could anyone explain me why I have this error? I can't figure out how my function call doesn't match my function declaration.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "edited": false, "score": 2, "creation_date": 1479134458, "post_id": 40591272, "comment_id": 68417999, "body": "I think your function should be of type <code>Char -&gt; String</code>. Then use it as the base function in a <code>map</code>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1479135705, "post_id": 40591272, "comment_id": 68418876, "body": "<code>okts2bins = concatMap (okt2bin.show)</code>"}, {"owner": {"reputation": 3946, "user_id": 1261166, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vL1Ud.jpg?s=128&g=1", "display_name": "Viktor Mellgren", "link": "https://stackoverflow.com/users/1261166/viktor-mellgren"}, "edited": false, "score": 0, "creation_date": 1479138137, "post_id": 40591272, "comment_id": 68420504, "body": "Another suggestion, use pattern matching instead of guards, and one thing more, you have not considered negative inputs.(Might not be needed in exercise, but why not go above and beyond :))"}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 7091266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4c7265b02e328b183b28bdaf2d77ecb6?s=128&d=identicon&r=PG&f=1", "display_name": "Rad", "link": "https://stackoverflow.com/users/7091266/rad"}, "edited": false, "score": 0, "creation_date": 1479136404, "post_id": 40591875, "comment_id": 68419348, "body": "Thank you, doing that helped."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1479136040, "creation_date": 1479136040, "answer_id": 40591875, "question_id": 40591272, "link": "https://stackoverflow.com/questions/40591272/converting-octal-to-binary/40591875#40591875", "title": "Converting octal to binary", "body": "<p>You can write a function for a single digit, which pretty much looks the same:</p>\n\n<pre><code>octDigit2Bin :: Char -&gt; String\noctDigit2Bin n\n       |n == '0' = \"000\"\n       |n == '1' = \"001\"\n       |n == '2' = \"010\"\n       |n == '3' = \"011\"\n       |n == '4' = \"100\"\n       |n == '5' = \"101\"\n       |n == '6' = \"110\"\n       |n == '7' = \"111\"\n</code></pre>\n\n<p>Afterwards you can use the nice property that you can transform a multi-digit octal number into a binary one by transforming each digit, since <code>8</code> is a power of <code>2</code>, e.g. \"75\" can be transformed by transforming '7' into \"111\" and '5' into \"101\" and therefore \"75\" is \"111101\":</p>\n\n<pre><code>okt2bin :: String -&gt; String\nokt2bin xs = concatMap octDigit2Bin xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "is_accepted": false, "score": 0, "last_activity_date": 1479238151, "creation_date": 1479238151, "answer_id": 40618151, "question_id": 40591272, "link": "https://stackoverflow.com/questions/40591272/converting-octal-to-binary/40618151#40618151", "title": "Converting octal to binary", "body": "<p>There is functions for dealing with different integer encodings in the module 'Numeric', which is part of 'base'.</p>\n\n<p>Since it's for homework, I'm guessing the intention was for you to calculate the binary representation and be able to convert an arbitrary octal encoded integer.</p>\n"}], "owner": {"reputation": 141, "user_id": 7091266, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4c7265b02e328b183b28bdaf2d77ecb6?s=128&d=identicon&r=PG&f=1", "display_name": "Rad", "link": "https://stackoverflow.com/users/7091266/rad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 40591875, "answer_count": 2, "score": 2, "last_activity_date": 1479238151, "creation_date": 1479134297, "question_id": 40591272, "link": "https://stackoverflow.com/questions/40591272/converting-octal-to-binary", "title": "Converting octal to binary", "body": "<p>one of the things I have to do in my Haskell homework is to write a function that converts an octal number to a binary number, the things is that it is specifically asked that the input must be a string.</p>\n\n<p>I figured I would write it like this:</p>\n\n<pre><code>okt2bin:: String -&gt; String\nokt2bin n     \n       |n == \"0\" = \"000\"\n       |n == \"1\" = \"001\"\n       |n == \"2\" = \"010\"\n       |n == \"3\" = \"011\"\n       |n == \"4\" = \"100\"\n       |n == \"5\" = \"101\"\n       |n == \"6\" = \"110\"\n       |n == \"7\" = \"111\"\n</code></pre>\n\n<p>The thing is, I can't get it to work for multiple digit numbers. Can anyone help?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1479152746, "post_id": 40593020, "comment_id": 68428709, "body": "@ruben.moor I added a fourth possibility, though I don&#39;t think it is better than the first one either."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 6, "last_activity_date": 1479154709, "last_edit_date": 1479154709, "creation_date": 1479139545, "answer_id": 40593020, "question_id": 40591051, "link": "https://stackoverflow.com/questions/40591051/use-haskells-lenses-library-to-fmap-a-lens/40593020#40593020", "title": "Use Haskell&#39;s lenses library to fmap a lens", "body": "<p>Just replace <code>_barnSize</code> by <code>(^. barnSize)</code> or, equivalently, <code>view barnSize</code>:</p>\n\n<pre><code>someFunc :: Farm -&gt; IntMap Size\nsomeFunc farm = view barnSize &lt;$&gt; farm ^. farmBarns\n</code></pre>\n\n<p>For a \"100% <em>lens</em>\" solution, you can use the <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Setter.html#v:mapped\" rel=\"nofollow noreferrer\"><code>mapped</code></a> setter. In this case, though, I don't think there is any real advantage in doing that.</p>\n\n<pre><code>someFunc :: Farm -&gt; IntMap Size\nsomeFunc farm = (mapped %~ view barnSize) (farm ^. farmBarns)\n</code></pre>\n\n<p>Another possible spelling involves using <code>to</code> to combine everything in a single getter. That doesn't buy you much here either, but it might be somewhat convenient if you wanted to keep working with the <code>IntMap</code> in <em>lens</em> style by chaining additional getters/folds/etc.</p>\n\n<pre><code>someFunc :: Farm -&gt; IntMap Size\nsomeFunc farm = farm ^. farmBarns . to (fmap (view barnSize))\n</code></pre>\n\n<p>There is a special purpose combinator that subsumes the <code>to</code>/<code>(^.)</code> combination above. It is called <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Getter.html#v:views\" rel=\"nofollow noreferrer\"><code>views</code></a>:</p>\n\n<pre><code>someFunc :: Farm -&gt; IntMap Size\nsomeFunc farm = views farmBarns (fmap (view barnSize)) farm\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479152863, "post_id": 40596596, "comment_id": 68428774, "body": "<code>(^..)</code> makes this result in <code>[Size]</code>, rather than <code>IntMap Size</code>."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479154635, "post_id": 40596596, "comment_id": 68429644, "body": "I&#39;ve fixed the solution to use mapped."}], "tags": [], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "is_accepted": false, "score": 2, "last_activity_date": 1479154622, "last_edit_date": 1479154622, "creation_date": 1479152552, "answer_id": 40596596, "question_id": 40591051, "link": "https://stackoverflow.com/questions/40591051/use-haskells-lenses-library-to-fmap-a-lens/40596596#40596596", "title": "Use Haskell&#39;s lenses library to fmap a lens", "body": "<p>You can use <code>mapped</code> (or <code>traversed</code>) to 'map' over a traversable using lenses, in your case:</p>\n\n<pre><code>someFunc :: Farm -&gt; IntMap Size\nsomeFunc farm =\n    farm ^. farmBarns &amp; mapped %~ view barnSize\n</code></pre>\n\n<p>This may be a bit confusing, but here's what's happening, I'll add brackets to make it a little clearer</p>\n\n<pre><code>someFunc :: Farm -&gt; IntMap Size\nsomeFunc farm =\n    (farm ^. farmBarns) &amp; (mapped %~ (view barnSize))\n</code></pre>\n\n<p>So basically, we use <code>farm ^. farmBarns</code> to get the <code>IntMap Barns</code> from the farm, on the right hand side of <code>&amp;</code> we construct a setter using <code>%~</code> which is the infix of <code>over</code>, however the function which <code>over</code> passes its target to is actually just focuses a the barnSize using a lens. <code>view barnSize :: Barn -&gt; Size</code>. </p>\n\n<p>Lastly we use <code>&amp;</code> to tie it all together which is equivalent to <code>flip $</code> and takes the setter from the right hand and uses it on the result of the left hand.</p>\n"}], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 722, "favorite_count": 1, "accepted_answer_id": 40593020, "answer_count": 2, "score": 5, "last_activity_date": 1479154709, "creation_date": 1479133645, "last_edit_date": 1479136380, "question_id": 40591051, "link": "https://stackoverflow.com/questions/40591051/use-haskells-lenses-library-to-fmap-a-lens", "title": "Use Haskell&#39;s lenses library to fmap a lens", "body": "<p>In the code below, my question concerns the top-most function <code>someFunc</code> (everything below is just to provide a complete example). I use a record-syntax getter and <code>fmap</code> there. What's the lens way to implement <code>someFunc</code>?</p>\n\n<pre><code>import           Control.Lens\nimport           Data.IntMap  (IntMap)\n\nsomeFunc :: Farm -&gt; IntMap Size\nsomeFunc farm =\n  _barnSize &lt;$&gt; farm ^. farmBarns\n\ndata Farm = Farm\n  { _farmBarns :: IntMap Barn\n  }\n\nfarmBarns :: Lens' Farm (IntMap Barn)\nfarmBarns = lens _farmBarns (\\farm barns -&gt; farm { _farmBarns = barns } )\n\ntype Size = (Int, Int)\n\ndata Barn = Barn\n  { _barnSize :: Size\n  }\n\nbarnSize :: Lens' Barn Size\nbarnSize = lens _barnSize (\\barn size -&gt; barn { _barnSize = size } )\n</code></pre>\n"}, {"tags": ["haskell", "org-babel"], "owner": {"reputation": 43, "user_id": 5476775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fa4e807c62fb4f72ab341eee1ecf6f6?s=128&d=identicon&r=PG&f=1", "display_name": "admas1413", "link": "https://stackoverflow.com/users/5476775/admas1413"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 225, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1479135910, "creation_date": 1479133052, "last_edit_date": 1479135910, "question_id": 40590849, "link": "https://stackoverflow.com/questions/40590849/haskell-org-babel-eval-not-working-results-output", "title": "Haskell Org Babel Eval Not Working Results Output", "body": "<p>Running babel source block evaluation on the following code results in an empty generated Results block:</p>\n\n<pre><code>#+NAME test\n#+BEGIN_SRC haskell :tangle test.hs :results output\n  let sayHello x = putStrLn (\"Hello, \" ++ x ++ \"!\")\n  sayHello \"Dave\"\n#+END_SRC\n\n#+RESULTS:\n</code></pre>\n\n<p>When typing the above lines directly in ghci, however, I get the \nresults as expected:</p>\n\n<pre><code>Prelude&gt; let sayHello x = putStrLn (\"Hello, \" ++ x ++ \"!\")\nPrelude&gt; sayHello \"Dave\"\nHello, Dave!\nPrelude&gt;\n</code></pre>\n\n<p>According to the org babel documentation, the \":results output\" option captures everything written from STDOUT so the evaluation of the code block should give the expected results. Any help with this would be greatly appreciated.</p>\n\n<p><strong>Update (11/14/16 10:05 am):</strong></p>\n\n<p>When I use the following org code I get a partial result but not the expected results:</p>\n\n<pre><code>#+NAME test\n#+BEGIN_SRC haskell :tangle test.hs :results output replace \n  let sayHello x = putStrLn (\"Hello, \" ++ x ++ \"!\")\n  sayHello \"Dave\"\n  sayHello \"Steve\"\n#+END_SRC\n\n#+RESULTS:\n: \n: Hello, Dave!\n</code></pre>\n\n<p>When I look at the haskell buffer after babel eval, I see the following:</p>\n\n<pre><code>Prelude&gt; let sayHello x = putStrLn (\"Hello, \" ++ x ++ \"!\")\nsayHello \"Dave\"\nsayHello \"Steve\"\n\"org-babel-haskell-eoe\"\nPrelude&gt; Hello, Dave!\nPrelude&gt; Hello, Steve!\nPrelude&gt; \"org-babel-haskell-eoe\"\nPrelude&gt; \n</code></pre>\n"}, {"tags": ["haskell", "list-comprehension", "monads"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1479132508, "post_id": 40590229, "comment_id": 68416633, "body": "From <a href=\"http://stackoverflow.com/help/on-topic\">What topics can I ask about here?</a>: &quot;...a <i>practical</i>, answerable problem that is unique to software development&quot;. What practical reason do you have for needing to do this type of pattern matching in a list comprehension?"}, {"owner": {"reputation": 5038, "user_id": 3579309, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Wn5ES.jpg?s=128&g=1", "display_name": "lovasoa", "link": "https://stackoverflow.com/users/3579309/lovasoa"}, "edited": false, "score": 0, "creation_date": 1479133542, "post_id": 40590229, "comment_id": 68417346, "body": "You don&#39;t really need pattern matching here. <code>[(i,div i 2) | i &lt;- [2,4..10]]</code> would be enough."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1479368631, "post_id": 40590229, "comment_id": 68529774, "body": "&quot;Putting the condition in a list and using <code>&lt;-</code> to extract the result seems ad hoc&quot; would it feel less ad-hoc if instead of <code>Just j &lt;- [somethingThatReturnsMaybe i]</code> you wrote <code>Just j &lt;- return $ somethingThatReturnsMaybe i</code>?"}, {"owner": {"reputation": 6006, "user_id": 239558, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/2362bc1c423993bbdb8548a3a059702c?s=128&d=identicon&r=PG", "display_name": "user239558", "link": "https://stackoverflow.com/users/239558/user239558"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1494615120, "post_id": 40590229, "comment_id": 74922082, "body": "This is exactly a question I have @chepner.  I need to write <code>[x &lt;- xs, y &lt;- ys, Just res@(SomeData (Otherstuff bar _ _ ) _ _ &lt;- somefunc x y,  x == bar]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 1, "creation_date": 1479131949, "post_id": 40590368, "comment_id": 68416286, "body": "Where is the pattern match in that?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 2, "creation_date": 1479132047, "post_id": 40590368, "comment_id": 68416360, "body": "@Thilo There is none, since there&#39;s no need to. I wonder what the OP <i>really</i> needs, since this looks as an XY problem."}, {"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 3, "creation_date": 1479132108, "post_id": 40590368, "comment_id": 68416402, "body": "Maybe it is, but he states that &quot;this particular problem can be solved in other ways, but let&#39;s assume I want to pattern match conditionally in a list comprehension&quot;."}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1479139823, "post_id": 40590368, "comment_id": 68421639, "body": "Exactly! The question was about whether there is a good way to use pattern matching in a list comprehension. It was not about this particular problem, which just illustrated how pattern matching might be used. I explicitly pointed out that I wasn&#39;t interested in solutions to this particular problem exactly because I was afraid I would get answers like these. It didn&#39;t seem to help!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 1, "creation_date": 1479144100, "post_id": 40590368, "comment_id": 68424241, "body": "@RussAbbott I think I now understand what you don&#39;t want, but I still have little ideas about what you do want. Do you want a statement like &quot;No, you can&#39;t use guards in pattern matching in list comprehensions&quot; ? I am a bit puzzled. The closest you can get to patterns with guards is shown above in my answer as the last alternative. Not convenient at all."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1479133207, "last_edit_date": 1479133207, "creation_date": 1479131679, "answer_id": 40590368, "question_id": 40590229, "link": "https://stackoverflow.com/questions/40590229/how-can-i-pattern-match-conditionally-in-a-list-comprehension-in-haskell/40590368#40590368", "title": "How can I pattern match conditionally in a list comprehension in Haskell", "body": "<p>Would this be acceptable for you?</p>\n\n<pre><code>[(i, j) | i &lt;- [1..10], even i, let j = i `div` 2]\n</code></pre>\n\n<p>Another (IMO worse) option:</p>\n\n<pre><code>[(i, j) | i &lt;- [1..10], \n          j &lt;- if even i then [i `div` 2] else []]\n</code></pre>\n\n<p>Yet another:</p>\n\n<pre><code>do i &lt;- [1..10]\n   j &lt;- guard (even i) &gt;&gt; return (i `div` 2)\n   return (i,j)\n</code></pre>\n\n<p>Yet another:</p>\n\n<pre><code>[(i, j) | i &lt;- [1..10], \n          j &lt;- [i `div` 2 | even i]]\n</code></pre>\n\n<p>Really overkill and strongly not recommended:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms, ViewPatterns #-}\n\ntestEvenRight :: Integral a =&gt; Either b a -&gt; Maybe a\ntestEvenRight (Right n) | even n = Just n\ntestEvenRight _                  = Nothing\n\npattern EvenRight n &lt;- (testEvenRight -&gt; Just n)\n\nlist1 = [Right 2, Right 1, Left \"abc\", Right 4, Right 5]\n\nlist2 = [(i,j) | EvenRight i &lt;- list1 , let j = i `div` 2]\n</code></pre>\n"}], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 481, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1479368532, "creation_date": 1479131264, "last_edit_date": 1479368532, "question_id": 40590229, "link": "https://stackoverflow.com/questions/40590229/how-can-i-pattern-match-conditionally-in-a-list-comprehension-in-haskell", "title": "How can I pattern match conditionally in a list comprehension in Haskell", "body": "<p>I want to write something like this:</p>\n\n<pre><code>&gt; [(i, j) | i &lt;- [1..10], \n            Just j &lt;- [if (even i) then Just (i `div` 2) else Nothing]]\n[(2,1),(4,2),(6,3),(8,4),(10,5)]\n</code></pre>\n\n<p>Putting the condition in a list and using <code>&lt;-</code> to extract the result seems <em>ad hoc</em>.  </p>\n\n<p>I tried:</p>\n\n<pre><code>&gt; [(i, j) | i &lt;- [1..10], \n            let Just j = if (even i) then Just (i `div` 2) else Nothing]\n</code></pre>\n\n<p>But that failed. </p>\n\n<p>The following works but seems awkward:</p>\n\n<pre><code>&gt; [(i, j) | i &lt;- [1..10], \n            let x = if (even i) then Just (i `div` 2) else Nothing, \n            isJust x, \n            let Just j = x]\n[(2,1),(4,2),(6,3),(8,4),(10,5)]\n</code></pre>\n\n<p>Is there a preferred way to do this. </p>\n\n<p><em>I know this particular problem can be solved in other ways,</em> but let's assume I want to pattern match conditionally in a list comprehension. <strong><em>Is there a good way to do that?</em></strong></p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 6, "creation_date": 1479121077, "post_id": 40587020, "comment_id": 68409415, "body": "<code>[Do]</code> and <code>[Dog]</code> are neither strings nor lists of characters. Unless you happen to have constructors named <code>Do</code> and <code>Dog</code> in scope, they are just invalid expressions. String literals are given using <code>&quot;</code> (as in most languages), e.g., <code>&quot;Do&quot;</code> and <code>&quot;Dog&quot;</code>. <code>[&#39;D&#39;,&#39;o&#39;]</code> and <code>&quot;Do&quot;</code> are two different spellings of the same value."}], "answers": [{"comments": [{"owner": {"reputation": 30, "user_id": 7156039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdddf68f925e4a9a163d19b7ed7dceaa?s=128&d=identicon&r=PG&f=1", "display_name": "pmikkelsen", "link": "https://stackoverflow.com/users/7156039/pmikkelsen"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1479140651, "post_id": 40588316, "comment_id": 68422155, "body": "They dont have to be the same type, but for the function to typecheck, then they do. I see your point."}], "tags": [], "owner": {"reputation": 30, "user_id": 7156039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdddf68f925e4a9a163d19b7ed7dceaa?s=128&d=identicon&r=PG&f=1", "display_name": "pmikkelsen", "link": "https://stackoverflow.com/users/7156039/pmikkelsen"}, "is_accepted": false, "score": 1, "last_activity_date": 1479127554, "last_edit_date": 1479127554, "creation_date": 1479124887, "answer_id": 40588316, "question_id": 40587020, "link": "https://stackoverflow.com/questions/40587020/this-code-is-supposed-to-understand-a-string-as-a-list-of-chars-but-it-doesnt/40588316#40588316", "title": "This code is supposed to understand a String as a list of Chars, but it doesn&#39;t", "body": "<p>Your <code>[Do]</code> and <code>[Dog]</code> are not strings. If you happen to have a data-type with constructors <code>Do</code> and <code>Dog</code>, then they will be lists of that data-type. Otherwise it does not make any sense. You want to do <code>startswith \"Do\" \"Dog\"</code> </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7115782"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1479127554, "creation_date": 1479120836, "question_id": 40587020, "link": "https://stackoverflow.com/questions/40587020/this-code-is-supposed-to-understand-a-string-as-a-list-of-chars-but-it-doesnt", "title": "This code is supposed to understand a String as a list of Chars, but it doesn&#39;t", "body": "<pre><code>startswith:: Eq u =&gt; [u] -&gt; [u] -&gt; Bool\nstartswith [] _ = True\nstartswith _ [] = False\nstartswith (x:xs) (y:ys)\n    |  x==y = startswith xs ys\n    |  otherwise = False\n</code></pre>\n\n<p>if I enter startswith ['D','o'] ['D','o','g'] \nthe program is happy and I get True\nif I enter startswith [Do] [Dog] I get False, but shouldn't the two be equal?</p>\n"}, {"tags": ["haskell", "terminal", "environment-variables"], "answers": [{"tags": [], "owner": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "is_accepted": true, "score": 2, "last_activity_date": 1479118700, "last_edit_date": 1495542283, "creation_date": 1479118700, "answer_id": 40586352, "question_id": 40585781, "link": "https://stackoverflow.com/questions/40585781/how-do-i-get-the-terminal-size/40586352#40586352", "title": "How do I get the terminal size?", "body": "<p>I would try the <a href=\"https://hackage.haskell.org/package/terminal-size-0.3.2.1/docs/System-Console-Terminal-Size.html\" rel=\"nofollow noreferrer\">System.Console.Terminal.Size</a> package, which in turn is based on <a href=\"https://stackoverflow.com/questions/12806053/get-terminal-width-haskell/12807521#12807521\">Get Terminal width Haskell</a></p>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 0, "accepted_answer_id": 40586352, "answer_count": 1, "score": 1, "last_activity_date": 1479118700, "creation_date": 1479116809, "question_id": 40585781, "link": "https://stackoverflow.com/questions/40585781/how-do-i-get-the-terminal-size", "title": "How do I get the terminal size?", "body": "<p>In bash there are two environmental variables: <code>COLUMNS</code> and <code>LINES</code> that store the number of columns and rows for the terminal. I have been trying to obtain that information in Haskell.</p>\n\n<p>Since unlike ruby Haskell's run-time doesn't calculate that by default, I resorted to calling <code>stty size</code>. However, calling this command from Haskell with</p>\n\n<pre><code>readProcess \"stty\" [\"size\"] \"\"\n</code></pre>\n\n<p>results in the following run-time error:</p>\n\n<pre><code>readCreateProcess: stty \"size\" (exit 1): failed\n</code></pre>\n\n<p>What would be a good way to retrieve such information?</p>\n"}, {"tags": ["haskell", "types", "syntax"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1479116356, "post_id": 40585563, "comment_id": 68406460, "body": "Nothing about <code>$</code> and <code>.</code> themselves, more about the weirdness in <code>gcastWith :: (a :~: b) -&gt; ((a ~ b) =&gt; r) -&gt; r</code> with a constraint in the middle of the type signature."}, {"owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1479116451, "post_id": 40585563, "comment_id": 68406533, "body": "Well yes, but it&#39;s legal Haskell, and I was expecting the above transformation to be correct for all legal constructs. Obviously I was wrong."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 6, "creation_date": 1479117005, "post_id": 40585563, "comment_id": 68406888, "body": "<code>$</code> and <code>.</code> can behave very weirdly once you start using extensions. <code>$</code>, for example, has a <a href=\"http://stackoverflow.com/a/39193282/3072788\">long history of surprising people</a>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1479120326, "post_id": 40585563, "comment_id": 68409005, "body": "By the way, do you have a minimal, complete, verifiable example for this? I suspect you are hitting impredicative types, but I can&#39;t off the top of my head find something which fails in the way you describe..."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1479172460, "post_id": 40585563, "comment_id": 68436566, "body": "A lot of code transformations that should be correct for all legal Haskell can fail when you&#39;re using type system extensions. A number of them sacrifice the &quot;all types can be inferred&quot; property of vanilla Haskell. Code transformations that &quot;morally&quot; give the same result can produce different intermediate expressions; if those are ones that cause problems for type inference, then you can get type errors from one form but not another even when they should result in the same thing."}], "answers": [{"comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1479124129, "post_id": 40587181, "comment_id": 68411260, "body": "Are there solutions for this problem?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1479131536, "post_id": 40587181, "comment_id": 68416027, "body": "@ThreeFx Developer side, you can use one other other styles, like using parentheses, or using <code>$</code>. Compiler side, one could extend the special case to capture the idiom <code>f . g $ e</code> as well. Personally, I&#39;m not too happy to see more and more special cases in the type system. Perhaps this is still OK."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1479131353, "last_edit_date": 1479131353, "creation_date": 1479121388, "answer_id": 40587181, "question_id": 40585563, "link": "https://stackoverflow.com/questions/40585563/equivalence-between-and/40587181#40587181", "title": "Equivalence between &#39;.&#39; and &#39;$&#39;", "body": "<p>I guess it's some restrictions caused by how type inference works. In basic Hindley-Milner types like</p>\n\n<pre><code>f :: (forall a. G a) -&gt; T\n</code></pre>\n\n<p>are forbidden. GHC Haskell allows them (with suitable extensions turned on), but still uses the HM restriction requiring that a type variable can never be instantiated to a polytype.</p>\n\n<p>This causes some surprise: <code>f e</code> type checks but <code>f $ e</code> fails since the type variables in the type of <code>$</code> should be instantiated to a polytype.</p>\n\n<pre><code>e :: forall a. G a\nf :: (forall a. G a) -&gt; T\nf e :: T\n\n($) :: (b -&gt; c) -&gt; b -&gt; c\n\nType checking ($) f e:\n\n       b ~ (forall a. G a)   -- forbidden polytype!\n       c ~ T\n</code></pre>\n\n<p>Since <code>f $ e</code> is <em>very</em> common in Haskell, and we really want things like <code>runST $ do ....</code> to work, the GHC devs have added a special-case typing rule for <code>$</code>. Essentially, when fully applied, <code>f $ e</code> is typed like <code>f e</code>.</p>\n\n<p>There is no such special case in the typing system for <code>f . g . h $ e</code> at the moment. This can make it fail when <code>f $ g $ h $ e</code> works fine.</p>\n"}], "owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 40587181, "answer_count": 1, "score": 3, "last_activity_date": 1479131353, "creation_date": 1479116103, "question_id": 40585563, "link": "https://stackoverflow.com/questions/40585563/equivalence-between-and", "title": "Equivalence between &#39;.&#39; and &#39;$&#39;", "body": "<p>I have an expression:</p>\n\n<pre><code>gcastWith p1 $\ngcastWith p2 $\ne\n</code></pre>\n\n<p>That works ok. Now I am trying to rewrite it as:</p>\n\n<pre><code>((gcastWith p1) .\n (gcastWith p2)) $\ne\n</code></pre>\n\n<p>And it doesn't work (doesn't typecheck). However this works:</p>\n\n<pre><code>((gcastWith p1) .\n (gcastWith p2)) -- note I removed the dollar\ne\n</code></pre>\n\n<p>Am I missing something obvious about how <code>$</code> and <code>.</code> operate?</p>\n"}, {"tags": ["haskell", "pointfree"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1479114834, "post_id": 40585102, "comment_id": 68405531, "body": "I think there&#39;s nothing really better than the first pointful version."}, {"owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1479115030, "post_id": 40585102, "comment_id": 68405627, "body": "@chi: Yeah maybe. But I&#39;m really not satisfied by <code>my . awesome . (\\x -&gt; if x == y then z else x) . function . chain $ val</code>. :P"}, {"owner": {"reputation": 343, "user_id": 5085294, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TOFvi.png?s=128&g=1", "display_name": "Christof Schramm", "link": "https://stackoverflow.com/users/5085294/christof-schramm"}, "edited": false, "score": 2, "creation_date": 1479115852, "post_id": 40585102, "comment_id": 68406148, "body": "Why not just define it in a <code>where</code> clause?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479120535, "post_id": 40585102, "comment_id": 68409130, "body": "An aside: quite a few people dislike if-then-else expressions, some to the point of wanting to see them removed from the language for being superfluous special syntax. Personally, however, I think they are just fine and have their place -- they are compact, can be inserted pretty much anywhere and, unlike things like <code>bool</code>, never leave you wondering wbout the order of the arguments."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479156944, "post_id": 40585102, "comment_id": 68430725, "body": "I believe @duplode is referring to <a href=\"https://github.com/strake/rfcs/blob/if/texts/0000-no-if-then-else.rst\" rel=\"nofollow noreferrer\">this</a> RFC and its subsequent <a href=\"https://github.com/haskell/rfcs/pull/10\" rel=\"nofollow noreferrer\">discussion</a>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1479159116, "post_id": 40585102, "comment_id": 68431764, "body": "@Alec That&#39;s what I had in mind, indeed (it is the latest instance that I happened to see of a recurring complaint)."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1479181647, "post_id": 40585102, "comment_id": 68438591, "body": "If <code>y</code> is a constant, say <code>42</code>, you can do <code>(\\case 42 -&gt; z; x -&gt; x)</code> with <code>LambdaCase</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1479121612, "post_id": 40585554, "comment_id": 68409696, "body": "Straight from the docs of <code>Data.Easy</code>: &quot;Note: This is probably not considered good practice. Use the standard if-then-else instead, its almost always clearer. You have been warned.&quot; Indeed, why should I look up an uncommon function when a straightforward basic readable alternative exists?"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 4, "last_activity_date": 1479116085, "creation_date": 1479116085, "answer_id": 40585554, "question_id": 40585102, "link": "https://stackoverflow.com/questions/40585102/what-is-the-best-way-to-do-replace-if/40585554#40585554", "title": "What is the best way to do &quot;replace-if&quot;?", "body": "<p>I don't approve of this very much, but a quick <a href=\"http://hayoo.fh-wedel.de/?query=a+-%3E+%28a+-%3E+Bool%29+-%3E+a+-%3E+a\" rel=\"nofollow noreferrer\">Hayoo search</a> led me to the <a href=\"http://hackage.haskell.org/package/data-easy-0.7.0/docs/Data-Easy.html#v:-63--124-\" rel=\"nofollow noreferrer\"><code>(?|)</code></a> operator in the <a href=\"http://hackage.haskell.org/package/data-easy\" rel=\"nofollow noreferrer\"><code>data-easy</code></a> package. This package is full of such functions (with a bunch of disclaimers about \"non-idiomatic haskell\"). Looks like you could have</p>\n\n<pre><code>\\x -&gt; if x == y then z else x  -- the cluttered Haskell form\n\n\\x -&gt; x ?| (/= y) $ z          -- the \"Pythonic\" form\n\n(?| (/= y)) z                  -- Haskell-sections-galore of the \"Pythonic\" form\n</code></pre>\n\n<p>Jokes aside, there is also the much more reasonable <a href=\"http://hackage.haskell.org/package/data-easy-0.7.0/docs/Data-Easy.html#v:fromBoolC\" rel=\"nofollow noreferrer\"><code>fromBoolC</code></a> that you will probably like:</p>\n\n<pre><code>fromBoolC z (/= y)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 4, "last_activity_date": 1479116203, "creation_date": 1479116203, "answer_id": 40585595, "question_id": 40585102, "link": "https://stackoverflow.com/questions/40585102/what-is-the-best-way-to-do-replace-if/40585595#40585595", "title": "What is the best way to do &quot;replace-if&quot;?", "body": "<p>From <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\"><code>lens</code></a>:</p>\n\n<pre><code>import Control.Lens\n\nf = (^. non z) . (non y # ) -- for some z and y\n</code></pre>\n\n<p>The <code>if then else</code> version is definitely better though.</p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 5, "creation_date": 1479121600, "post_id": 40585980, "comment_id": 68409690, "body": "I feel <code>bool z &lt;*&gt; (&#47;= y)</code> is the least bad choice amongst these answers."}], "tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": true, "score": 5, "last_activity_date": 1479117498, "creation_date": 1479117498, "answer_id": 40585980, "question_id": 40585102, "link": "https://stackoverflow.com/questions/40585102/what-is-the-best-way-to-do-replace-if/40585980#40585980", "title": "What is the best way to do &quot;replace-if&quot;?", "body": "<p>I don't know of anything very readable.  Shortest I can get is</p>\n\n<pre><code>bool z &lt;*&gt; (/= y)\n</code></pre>\n\n<p>Further silly ways: </p>\n\n<pre><code>execState (gets (==y) &gt;&gt;= flip when (put z))\n\nfromMaybe &lt;*&gt; flip lookup [(y, z)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1479131123, "last_edit_date": 1479131123, "creation_date": 1479128814, "answer_id": 40589509, "question_id": 40585102, "link": "https://stackoverflow.com/questions/40585102/what-is-the-best-way-to-do-replace-if/40589509#40589509", "title": "What is the best way to do &quot;replace-if&quot;?", "body": "<p>You can use the Python trick of replacing a case statement with a lookup.</p>\n\n<pre><code>import Data.Map\n\n\\x -&gt; findWithDefault x x (singleton y z)\n</code></pre>\n\n<p>which according to pointfree.io can be reduced to</p>\n\n<pre><code>flip (join findWithDefault) (singleton y z)\n</code></pre>\n\n<p>It's not exactly clear, but at the same time it separates the functional parts from the arguments. <code>flip (join findWithDefault)</code> does what you want, and <code>singleton y z</code> is a DSL-like way of specifying the exception. Stick a <code>idExcept = flip (join findWithDefault)</code> and <code>exception = singleton</code> earlier in your code, and your chain is almost readable.</p>\n\n<pre><code>my . awesome . (idExcept (exception y z)) . function . chain $ val\n</code></pre>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 0, "accepted_answer_id": 40585980, "answer_count": 4, "score": 1, "last_activity_date": 1479131123, "creation_date": 1479114527, "question_id": 40585102, "link": "https://stackoverflow.com/questions/40585102/what-is-the-best-way-to-do-replace-if", "title": "What is the best way to do &quot;replace-if&quot;?", "body": "<p>I'm thinking of a function that can replace the value <code>x</code> with <code>z</code> when <code>x</code> is <code>y</code>, and do nothing otherwise, that is:</p>\n\n<pre><code>\\x -&gt; if x == y then z else x\n</code></pre>\n\n<p>It's only used once in my program and it's in the middle of a function chain so I don't want to define it as a named function and I think the lambda expression looks unnecessarily verbose. Instead, I'm trying to compose it from other functions. However, so far I have only come up with this cryptic (and cring-y) one:</p>\n\n<pre><code>(ap . flip . bool id $ const z) (== y)\n</code></pre>\n\n<p>Are there better point-free forms for such a simple function?</p>\n"}, {"tags": ["haskell", "ghci"], "owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 120, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1479114295, "creation_date": 1479113436, "last_edit_date": 1479114295, "question_id": 40584852, "link": "https://stackoverflow.com/questions/40584852/why-ghci-can-not-load-the-specified-shard-library", "title": "Why GHCi can not load the specified shard library?", "body": "<p>I have the library gsl (libgsl.dylib) installed under /usr/local/lib/ in Mac os and want to call the library function from Haskell. But I failed using GHCi but succeed using GHC.</p>\n\n<p>In GHCi:</p>\n\n<pre><code>stack ghci --ghci-options=\"Bessel.hs -lgsl\"\n&gt; besselJn 0 10\ndyld: lazy symbol binding failed: Symbol not found: _gsl_sf_bessel_J0_e\n  Referenced from: libgsl.dylib\n  Expected in: flat namespace\n\ndyld: Symbol not found: _gsl_sf_bessel_J0_e\n  Referenced from: libgsl.dylib\n  Expected in: flat namespace\n</code></pre>\n\n<p>In GHC:</p>\n\n<pre><code> stack ghc -- Bessel-main.hs -lgsl\n ./Bessel-main  (which is succeed)\n</code></pre>\n\n<p>Bessel.hs is a package export the function <code>besselJn</code>, <code>Bessel-main.hs</code> is just the Main module to call.</p>\n\n<p>Anything wrong in the way I using GHCi ? It's weird that GHC can successfully compile/link the shared library and run, but GHCi cannot.</p>\n\n<hr>\n\n<p>Add more info.\n<code>Bessel.hs</code> is generated by <code>Bessel.hsc</code> using command <code>hsc2hs Bessel.hsc</code>(should install hsc2hs first using <code>stack install hsc2hs</code>). Following is </p>\n\n<p>Bessel.hsc</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Bessel (besselJn) where\n\nimport Foreign\nimport Foreign.Ptr\nimport Foreign.C.String\nimport Foreign.C.Types\nimport System.IO.Unsafe\n\n#include &lt;gsl/gsl_sf_result.h&gt;\n\ndata GslSfResult = GslSfResult { gsl_value :: CDouble, gsl_error :: CDouble }\n\ninstance Storable GslSfResult where\n    sizeOf    _ = (#size gsl_sf_result)\n    alignment _ = alignment (undefined :: CDouble)\n    peek ptr = do\n        value &lt;- (#peek gsl_sf_result, val) ptr\n        error &lt;- (#peek gsl_sf_result, err) ptr\n        return  GslSfResult { gsl_value = value, gsl_error = error }\n    poke ptr (GslSfResult value error) = do\n        (#poke gsl_sf_result, val) ptr value\n        (#poke gsl_sf_result, err) ptr error\n\n\nforeign import ccall unsafe \"gsl/gsl_sf_bessel.h gsl_sf_bessel_Jn_e\"\n     c_besselJn :: CInt -&gt; CDouble -&gt; Ptr GslSfResult -&gt; IO CInt\n\nforeign import ccall unsafe \"gsl/gsl_errno.h gsl_set_error_handler_off\"\n     c_deactivate_gsl_error_handler :: IO ()\n\nforeign import ccall unsafe \"gsl/gsl_errno.h gsl_strerror\"\n     c_error_string :: CInt -&gt; IO CString\n\nbesselJn :: Int -&gt; Double -&gt; Either String (Double, Double)\nbesselJn n x = unsafePerformIO $\n    alloca $ \\gslSfPtr -&gt; do\n        c_deactivate_gsl_error_handler\n        status &lt;- c_besselJn (fromIntegral n) (realToFrac x) gslSfPtr\n        if status == 0\n            then do\n                GslSfResult val err &lt;- peek gslSfPtr\n                return $ Right (realToFrac val, realToFrac err)\n            else do\n                error &lt;- c_error_string status\n                error_message &lt;- peekCString error\n                return $ Left (\"GSL error: \"++error_message)\n</code></pre>\n\n<p>Bessel-main.hs</p>\n\n<pre><code>module Main where\n\nimport Bessel as B\n\nmain = do\n  print $ B.besselJn  0 10\n</code></pre>\n"}, {"tags": ["haskell", "generic-programming", "template-haskell", "gadt"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1479102752, "post_id": 40582270, "comment_id": 68400669, "body": "@JonPurdy I strongly disagree! Only TH can ever create declarations. <code>Generics</code> and <code>Data</code> are mostly useful for things like making default instances."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1479103071, "post_id": 40582270, "comment_id": 68400737, "body": "@Alec: D\u2019oh! I\u2019ll just see myself out."}], "answers": [{"comments": [{"owner": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 0, "creation_date": 1479107505, "post_id": 40582869, "comment_id": 68402262, "body": "this is awesome. as a followup, would it be possible to define a datatype      <code>data Magic t a</code>  where      <code>Magic SomeUserType1 == TagSomeUserType1</code>  ? If that is remotely possible I may post another question about how to do so."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 0, "creation_date": 1479107754, "post_id": 40582869, "comment_id": 68402379, "body": "@ajp That is possible I think. Care to update the question? (Or make a new one, as you wish)"}, {"owner": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "edited": false, "score": 0, "creation_date": 1479140962, "post_id": 40582869, "comment_id": 68422356, "body": "new question is here <a href=\"http://stackoverflow.com/questions/40593441/how-can-i-produce-a-tag-type-for-any-datatype-for-use-with-dsum-without-templat\" title=\"how can i produce a tag type for any datatype for use with dsum without templat\">stackoverflow.com/questions/40593441/&hellip;</a>"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1479104190, "creation_date": 1479104190, "answer_id": 40582869, "question_id": 40582270, "link": "https://stackoverflow.com/questions/40582270/how-can-i-programatically-produce-this-datatype-from-the-other/40582869#40582869", "title": "How can I programatically produce this datatype from the other?", "body": "<p>Template Haskell is what you want since you are trying to generate declarations. Here is something that works. Put the following in one file called <code>Tag.hs</code>:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nmodule Tag where\n\nimport Language.Haskell.TH\n\nmakeTag :: Name -&gt; DecsQ\nmakeTag name = do\n    -- Reify the data declaration to get the constructors.\n    -- Note we are forcing there to be no type variables...\n    (TyConI (DataD _ _ [] _ cons _)) &lt;- reify name\n\n    pure [ DataD [] tagTyName [PlainTV (mkName \"a\")] Nothing (fmap tagCon cons) [] ]\n  where\n  -- Generate the name for the new tag GADT type constructor.\n  tagTyName :: Name\n  tagTyName = mkName (\"Tag\" ++ nameBase name)\n\n  -- Given a constructor, construct the corresponding constructor for the GADT.\n  tagCon :: Con -&gt; Con\n  tagCon (NormalC conName args) =\n    let tys = fmap snd args\n        tagType = foldl AppT (TupleT (length tys)) tys\n    in GadtC [mkName (\"Tag\" ++ nameBase conName)] []\n             (AppT (ConT tagTyName) tagType)\n</code></pre>\n\n<p>Then you can test it out in another file:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, GADTs #-}\n\nimport Tag\n\ndata SomeUserType1 = Foo Int | Bar String\ndata SomeUserType2 = Fooo Int | Baar Char | Baaz Bool String\n\nmakeTag ''SomeUserType1\nmakeTag ''SomeUserType2\n</code></pre>\n\n<p>If you inspect the second file in GHCi (or look at the generated code by passing <code>-ddump-splices</code> to either <code>ghci</code> or <code>ghc</code>) you'll see that the following is generated:</p>\n\n<pre><code>data TagSomeUserType1 a where\n  TagFoo :: TagSomeUserType1 Int\n  TagBar :: TagSomeUserType1 String\n\ndata TagSomeUserType3 a where\n  TagFooo :: TagSomeUserType2 Int\n  TagBaar :: TagSomeUserType2 Char\n  TagBaaz :: TagSomeUserType2 (Bool, String)\n</code></pre>\n\n<p>I have to use <code>mkName</code> and <em>not</em> <code>newName</code> because, if you are ever expected to use these generated GADTs, you'll need them to have predictable names you can write. As should be clear from the examples, my convention is to prepend <code>Tag</code> to both the type and data constructors.</p>\n"}], "owner": {"reputation": 1431, "user_id": 1553741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6daac35161547a75785e69de774334b8?s=128&d=identicon&r=PG", "display_name": "ajp", "link": "https://stackoverflow.com/users/1553741/ajp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "accepted_answer_id": 40582869, "answer_count": 1, "score": 3, "last_activity_date": 1479104513, "creation_date": 1479100536, "last_edit_date": 1479104513, "question_id": 40582270, "link": "https://stackoverflow.com/questions/40582270/how-can-i-programatically-produce-this-datatype-from-the-other", "title": "How can I programatically produce this datatype from the other?", "body": "<p>I'd like to use <a href=\"http://hackage.haskell.org/package/dependent-sum-0.3.2.1/docs/Data-Dependent-Sum.html\" rel=\"nofollow noreferrer\"><code>DSum</code></a> for something. To work with <code>DSum</code>, you need to have a 'tag' type which takes one type argument, e.g.</p>\n\n<pre><code>data Tag a where\n  AFirst :: Tag Int\n  ASecond :: Tag String\n</code></pre>\n\n<p>However, I'd like to use this internally in a library. I want the interface that I expose to users to take any old datatype, e.g.</p>\n\n<pre><code>data SomeUserType1 = Foo Int | Bar String\n</code></pre>\n\n<p>it's clearly quite mechanical to go from this to the <code>Tag a</code> type given above. So, is it possible to do this in code, with some sort of generic programming techniques?</p>\n\n<p>Here's another example to be clear about the type of mapping I want to produce.</p>\n\n<pre><code>data SomeUserType2 = Foo Int | Bar Char | Baz Bool String\n</code></pre>\n\n<p>should become</p>\n\n<pre><code>data Tag2 a where\n  AFirst :: Tag2 Int\n  ASecond :: Tag2 Char\n  AThird :: Tag2 (Bool, String)\n</code></pre>\n\n<p>Is this a job for Template Haskell? Something else? I don't even really know what the options are here.</p>\n"}, {"tags": ["parsing", "haskell", "alternative-functor"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1479139117, "post_id": 40581610, "comment_id": 68421174, "body": "Technically, that&#39;s a Gauss number /nitpick."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1479096918, "creation_date": 1479096918, "answer_id": 40581797, "question_id": 40581610, "link": "https://stackoverflow.com/questions/40581610/parsing-a-complex-number-from-scratch/40581797#40581797", "title": "Parsing a Complex Number from Scratch", "body": "<p>You've probably already seen it, but in case you haven't: <a href=\"http://www.cs.nott.ac.uk/~pszgmh/pearl.pdf\" rel=\"nofollow noreferrer\">Monadic Parsing in Haskell</a> sets up parsing like this.</p>\n\n<p>Since you have two different ways of parsing <code>CI</code>, you might want to approach this as two problems: make one parser <code>parseCI1</code> that parses <code>\"a\"</code> to <code>CI a 0</code> and make another parser <code>parseCI2</code> that parses <code>\"(a,b)\"</code> to <code>CI a b</code>. Then, you can combine these into one with</p>\n\n<pre><code>parseCI = parseCI1 &lt;|&gt; parseCI2\n</code></pre>\n\n<p>For both of these subparsers, you will need some way of parsing integers: <code>parseInt :: Parser Int</code>. When making <code>parseInt</code>, you will likely want to use some combination of <code>satisfy</code>, <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Char.html#v:isDigit\" rel=\"nofollow noreferrer\"><code>isDigit</code></a>, <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:read\" rel=\"nofollow noreferrer\"><code>read</code></a>, and possibly <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#v:some\" rel=\"nofollow noreferrer\"><code>some</code></a> (depending on how you go about solving this).</p>\n\n<hr>\n\n<p>Making <code>CI</code> an instance of read is a bit more straightforward once you have <code>parseCI</code> done: </p>\n\n<pre><code>instance Read CI where\n  readsPrec _ = runParser parseCI\n</code></pre>\n"}], "owner": {"reputation": 175, "user_id": 7136164, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/7058f7625f65cc7249d5150d99e43b5d?s=128&d=identicon&r=PG", "display_name": "Harambe17", "link": "https://stackoverflow.com/users/7136164/harambe17"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 40581797, "answer_count": 1, "score": 1, "last_activity_date": 1613796164, "creation_date": 1479095206, "last_edit_date": 1613796164, "question_id": 40581610, "link": "https://stackoverflow.com/questions/40581610/parsing-a-complex-number-from-scratch", "title": "Parsing a Complex Number from Scratch", "body": "<p>Given a data type <code>data CI = CI Int Int</code>, representing a complex number, I want to build a parser for CI that can convert <code>\"a\"</code> to <code>CI a 0</code> and <code>\"(a,b)\"</code> to <code>CI a b</code>. For example, I want a function <code>parseCI</code> such <code>runParser parseCI \"(1,2)\"</code> returns the value <code>[(CI 1 2, \"\")]</code> (ideally, but something similar is fine). I also want to make CI an instance of <code>read</code>. </p>\n\n<p>I would like to do this using functions and definitions from the code below (basically, without anything advanced, like Parsec), but I'm not sure where to start. Some starting code to set me on the right track and/or a hint would be helpful. I'm not looking for a full answer, as I'd like to figure that out myself. </p>\n\n<pre><code>module Parser where\nimport Control.Applicative\nimport Control.Monad\n\nnewtype Parser a = Parser { runParser :: String -&gt; [(a,String)] }\n\nsatisfy :: (Char -&gt; Bool) -&gt; Parser Char\nsatisfy f = Parser $ \\s -&gt; case s of\n    [] -&gt; []\n    a:as -&gt; [(a,as) | f a]\n\nchar :: Char -&gt; Parser Char\nchar = satisfy . (==)\n\nstring :: String -&gt; Parser String\nstring str = Parser $ \\s -&gt; [(t,u) | let (t,u) = splitAt (length str) s, str == t]\n\ninstance Functor Parser where\n    fmap f p = Parser $ \\s -&gt;\n        [ (f a,t)\n        | (a,t) &lt;- runParser p s\n        ]\n\ninstance Applicative Parser where\n    pure a = Parser $ \\s -&gt; [(a,s)]\n    af &lt;*&gt; aa = Parser $ \\s -&gt;\n        [ (f a,u) \n        | (f,t) &lt;- runParser af s\n        , (a,u) &lt;- runParser aa t\n        ]\n\ninstance Alternative Parser where\n    empty = Parser $ \\s -&gt; []\n    p1 &lt;|&gt; p2 = Parser $ (++) &lt;$&gt; runParser p1 &lt;*&gt; runParser p2`\n\ninstance Monad Parser where\n    return = pure\n    ma &gt;&gt;= f = Parser $ \\s -&gt;\n       [ (b,u) \n       | (a,t) &lt;- runParser ma s\n       , (b,u) &lt;- runParser (f a) t\n       ]\n\ninstance MonadPlus Parser where\n    mzero = empty\n    mplus = (&lt;|&gt;)\n</code></pre>\n"}, {"tags": ["haskell", "megaparsec"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1479082078, "post_id": 40580164, "comment_id": 68396134, "body": "The problem is you have a common prefix for your parsers. Take a look at <a href=\"https://hackage.haskell.org/package/megaparsec-5.1.1/docs/Text-Megaparsec.html#v:try\" rel=\"nofollow noreferrer\"><code>try</code></a>."}], "answers": [{"comments": [{"owner": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "edited": false, "score": 0, "creation_date": 1479083537, "post_id": 40580283, "comment_id": 68396443, "body": "Thank you @leftaroundabout! Very nice explanation."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1479082955, "last_edit_date": 1479082955, "creation_date": 1479082631, "answer_id": 40580283, "question_id": 40580164, "link": "https://stackoverflow.com/questions/40580164/parsing-block-comments-with-megaparsec-using-symbols-for-start-and-end/40580283#40580283", "title": "Parsing block comments with Megaparsec using symbols for start and end", "body": "<p>As Alec already commented, the problem is that as soon as <code>e</code> encounters <code>'#'</code>, it counts as a <em>consumed character</em>. And the way parsec and its derivatives work is that as soon as you've consumed any characters, you're committed to that parsing branch \u2013 i.e. the <code>manyTill anyChar</code> alternative is then not considered anymore, even though <code>e</code> ultimately fails here.</p>\n\n<p>You can easily request backtracking though, by wrapping the end delimiter in <a href=\"https://hackage.haskell.org/package/megaparsec-5.1.1/docs/Text-Megaparsec.html#v:try\" rel=\"noreferrer\"><code>try</code></a>:</p>\n\n<pre><code>skip' :: Parser String\nskip' = s &gt;&gt; manyTill anyChar e\n  where s = symbol \"#\" &gt;&gt; symbol \"START\" &gt;&gt; symbol \"SKIP\"\n        e = try $ symbol \"#\" &gt;&gt; symbol \"END\" &gt;&gt; symbol \"SKIP\"\n</code></pre>\n\n<p>This then will before consuming <code>'#'</code> set a \u201ccheckpoint\u201d, and when <code>e</code> fails later on (in your example, at <code>\"Foo\"</code>), it will act as if no characters had matched at all.</p>\n\n<p>In fact, traditional parsec would give the same behaviour also for <code>skip</code>. Just, because looking for a string and only succeeding if it matches <em>entirely</em> is such a common task, megaparsec's <code>string</code> is implemented like <code>try . string</code>, i.e. if the failure occurs within that fixed string then it will always backtrack.</p>\n\n<p>However, compound parsers still don't backtrack by default, like they do in attoparsec. The main reason is that if anything can backtrack to any point, you can't really get a clear <em>point of failure</em> to show in the error message.</p>\n"}], "owner": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "accepted_answer_id": 40580283, "answer_count": 1, "score": 4, "last_activity_date": 1479082955, "creation_date": 1479081507, "question_id": 40580164, "link": "https://stackoverflow.com/questions/40580164/parsing-block-comments-with-megaparsec-using-symbols-for-start-and-end", "title": "Parsing block comments with Megaparsec using symbols for start and end", "body": "<p>I want to parse text similar to this in Haskell using Megaparsec.</p>\n\n<pre><code># START SKIP\ndef foo(a,b):\n    c = 2*a # Foo \n    return a + b\n# END SKIP\n</code></pre>\n\n<p>, where <code># START SKIP</code> and <code># END SKIP</code> marks the start and end of the block of text to parse.</p>\n\n<p>Compared to <a href=\"https://hackage.haskell.org/package/megaparsec-5.0.0/docs/src/Text-Megaparsec-Lexer.html#skipBlockComment\" rel=\"nofollow noreferrer\">skipBlockComment</a> I want the parser to return the lines between the start and end marker. </p>\n\n<p>This is my parser. </p>\n\n<pre><code>skip :: Parser String\nskip = s &gt;&gt; manyTill anyChar e\n  where s = string \"# START SKIP\"\n        e = string \"# END SKIP\"\n</code></pre>\n\n<p>The <code>skip</code> parser works as intended. </p>\n\n<p>To allow for a variable amount of white space within the start and end marker, for example <code>#    START   SKIP</code> I've tried the following: </p>\n\n<pre><code>skip' :: Parser String\nskip' = s &gt;&gt; manyTill anyChar e\n  where s = symbol \"#\" &gt;&gt; symbol \"START\" &gt;&gt; symbol \"SKIP\"\n        e = symbol \"#\" &gt;&gt; symbol \"END\" &gt;&gt; symbol \"SKIP\"\n</code></pre>\n\n<p>Using <code>skip'</code> to parse the above text gives the following error.</p>\n\n<pre><code>3:15:\nunexpected 'F'\nexpecting \"END\", space, or tab\n</code></pre>\n\n<p>I would like to understand the cause of this error and how I can fix it. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1479078247, "post_id": 40579774, "comment_id": 68395266, "body": "What precisely is your question?"}, {"owner": {"reputation": 23, "user_id": 7151331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4008e969222bf3bad3e5a12400a152c5?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Moore", "link": "https://stackoverflow.com/users/7151331/tom-moore"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1479078513, "post_id": 40579774, "comment_id": 68395324, "body": "I apologize for not adding that part in there as it may help if you all know what the actual question was! Basically what I want to know is if I should call one of these functions on the other or if I should just make one function? I&#39;ve tinkered with this quite a bit and can&#39;t seem to get either way to work."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1479078765, "post_id": 40579774, "comment_id": 68395379, "body": "@TomMoore I suggest you edit your post to add the question to it. (And while you are at it, a less generic title would also help.)"}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1479079221, "post_id": 40579774, "comment_id": 68395484, "body": "You want to insert the value to the front of the reversed list, right?"}, {"owner": {"reputation": 23, "user_id": 7151331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4008e969222bf3bad3e5a12400a152c5?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Moore", "link": "https://stackoverflow.com/users/7151331/tom-moore"}, "reply_to_user": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1479082880, "post_id": 40579774, "comment_id": 68396305, "body": "Correct @mnoronha"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1479084557, "post_id": 40579774, "comment_id": 68396638, "body": "I have the feeling there may be some miscommunication. Tom Moore, can you please show several examples of arguments to your desired function and the corresponding results?"}, {"owner": {"reputation": 23, "user_id": 7151331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4008e969222bf3bad3e5a12400a152c5?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Moore", "link": "https://stackoverflow.com/users/7151331/tom-moore"}, "edited": false, "score": 0, "creation_date": 1479084720, "post_id": 40579774, "comment_id": 68396666, "body": "Examples:      Prelude&gt; reverseAndInsert 2 [3,4,5]         Result: [2,5,4,3]      Prelude&gt; reverseAndInsert 7[8,9,10]         Result: [7,10,9,8]"}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1479085005, "post_id": 40579774, "comment_id": 68396721, "body": "@TomMoore This should be the behavior you observe based on my answer below."}], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1479081269, "post_id": 40579899, "comment_id": 68395954, "body": "<code>reverse&#39;</code> is technically not identical to <code>reverse</code> from Prelude because it&#39;s O(n^2) rather than O(n).  That difference can matter."}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1479081497, "post_id": 40579899, "comment_id": 68396012, "body": "@Carl It&#39;s <i>use</i> is the same, but I&#39;ve modified the statement."}], "tags": [], "owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "is_accepted": true, "score": 1, "last_activity_date": 1479081475, "last_edit_date": 1479081475, "creation_date": 1479079126, "answer_id": 40579899, "question_id": 40579774, "link": "https://stackoverflow.com/questions/40579774/haskell-function-reversing-a-list-and-inserting-a-new-element-into-it/40579899#40579899", "title": "Haskell function reversing a list and inserting a new element into it", "body": "<p>Your <code>reverse'</code> function works as expected, so we can use it to reverse the list that is passed to our function (note that it's use is identical to, though less efficient than, than <code>reverse</code> from <code>Prelude</code>). The <code>insert</code> function you've written is less useful here because we want to insert our value to the front of the front of the list, not after the first value that is less than it.</p>\n\n<p>We'll thus apply your <code>reverse'</code> function to the list and cons the input value to the front of what gets returned. </p>\n\n<pre><code>reverseAndInsert :: a -&gt; [a] -&gt; [a]\nreverseAndInsert x xs = x : reverse' xs\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 7151331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4008e969222bf3bad3e5a12400a152c5?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Moore", "link": "https://stackoverflow.com/users/7151331/tom-moore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "closed_date": 1479111114, "accepted_answer_id": 40579899, "answer_count": 1, "score": 2, "last_activity_date": 1479257206, "creation_date": 1479077993, "last_edit_date": 1479257206, "question_id": 40579774, "link": "https://stackoverflow.com/questions/40579774/haskell-function-reversing-a-list-and-inserting-a-new-element-into-it", "closed_reason": "Needs details or clarity", "title": "Haskell function reversing a list and inserting a new element into it", "body": "<p>I have been working on a Haskell function which is suppose to take a list as well as a value. It should reverse the list and then append the value to the front.</p>\n\n<p>I've tried making separate reverse and insert function and calling one on the other but I have failed to find a way to make it work. Here is what I have so far: </p>\n\n<p>Reverse Function:</p>\n\n<pre><code>reverse' :: [a] -&gt; [a]  \nreverse' [] = []  \nreverse' (x:xs) = reverse' xs ++ [x]  \n</code></pre>\n\n<p>Insert Function: </p>\n\n<pre><code>insert :: Ord a =&gt; a -&gt; [a] -&gt; [a]   \ninsert x [] = [x]\ninsert x (y:ys)\n  | x &gt; y     = y : insert x ys\n  | otherwise = x : y : ys \n</code></pre>\n\n<p>Should I should call one of these functions on the other? If so how would I go about doing that? Or if I should just make one function? I've tinkered with this quite a bit and can't seem to get either way to work.</p>\n\n<p>Thank you for any and all help as I am still a beginner and learning the language!</p>\n"}, {"tags": ["arrays", "haskell", "mutability", "referential-transparency", "st-monad"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1479068690, "post_id": 40578396, "comment_id": 68392439, "body": "Seems like an implementation accident to me. I wouldn&#39;t rely on it."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1479085899, "post_id": 40578396, "comment_id": 68396904, "body": "This seems worthy of discussion for vector devs. At least &quot;The immutable vector may not be used after this operation&quot; does not seem to be well-defined or sufficient documentation, and I could easily see myself accidentally using an unsafeThaw in this situation without thinking about it."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1479126337, "post_id": 40578396, "comment_id": 68412651, "body": "A quick glance at <a href=\"https://github.com/haskell/vector/blob/master/Data/Vector/Unboxed.hs#L812-L814\" rel=\"nofollow noreferrer\">the source code</a> reveals that <code>indexed</code> is just an alias for <a href=\"https://github.com/haskell/vector/blob/master/Data/Vector/Generic.hs#L1000-L1002\" rel=\"nofollow noreferrer\">the overloaded version of the same</a>, which works by converting the input vector to and from a stream. So <code>indexed</code>, as implemented, will always return a new vector, rather than a view over the old one. I guess the <code>Vector</code> devs decided fusion was more important than sharing in this case. I wouldn&#39;t necessarily want to rely on this behaviour though."}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1479068757, "creation_date": 1479068495, "last_edit_date": 1495542623, "question_id": 40578396, "link": "https://stackoverflow.com/questions/40578396/is-it-safe-to-unsafethaw-an-indexed-unboxed-vector", "title": "Is it safe to unsafeThaw an indexed unboxed vector?", "body": "<p><a href=\"https://stackoverflow.com/a/40578268/745903\">I just posted this code:</a></p>\n\n<pre><code>import qualified Data.Vector.Unboxed as VU\nimport qualified Data.Vector.Algorithms.Intro as VAlgo\n\nargSort :: (Ord a, VU.Unbox a) =&gt; VU.Vector a -&gt; VU.Vector Int\nargSort xs = VU.map fst $ VU.create $ do\n    xsi &lt;- VU.unsafeThaw $ VU.indexed xs\n    VAlgo.sortBy (comparing snd) xsi\n    return xsi\n</code></pre>\n\n<p>My reasoning was that <a href=\"http://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Unboxed.html#v:unsafeThaw\" rel=\"nofollow noreferrer\"><code>unsafeThaw</code></a> is safe to use here because I only thaw the <a href=\"http://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Unboxed.html#v:indexed\" rel=\"nofollow noreferrer\"><code>indexed</code></a> version of <code>xs</code>. However, then it occured to me that unboxed vectors of tuples \u2013 like these index-value pairs here \u2013 are really stored as <em>two</em> unboxed vectors, one for the indices and one for the values. Hence it seems plausible that <code>indexed</code> would not actually generate a new value vector at all, but just couple it with an index vector. In this case, <code>ST</code>-modifying <code>xsi</code> could possibly mess up <code>xs</code>.</p>\n\n<p>Upon testing, this does not seem to happen though. <em>Can I rely on this, or should I better use <a href=\"http://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Unboxed.html#v:thaw\" rel=\"nofollow noreferrer\"><code>thaw</code></a>?</em></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1479068687, "post_id": 40578362, "comment_id": 68392438, "body": "Is <code>:</code> a constructor?"}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1479068806, "post_id": 40578362, "comment_id": 68392471, "body": "@4castle Yes. [1,2,3,4] is basically just sugar for <code>1:2:3:4:[]</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1479070456, "post_id": 40578362, "comment_id": 68393002, "body": "Indeed, pattern matching using functions would be nonsense in the general case: what would <code>(\\(x++y) -&gt; y++x) &quot;abcde&quot;</code> evaluate to?"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 5, "last_activity_date": 1479068252, "creation_date": 1479068252, "answer_id": 40578362, "question_id": 40578340, "link": "https://stackoverflow.com/questions/40578340/haskell-pattern-matching-on-list/40578362#40578362", "title": "Haskell pattern matching on List", "body": "<p>You can pattern match using constructors and literals but not functions.</p>\n"}], "owner": {"reputation": 315, "user_id": 1324546, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/707b86b3d563645b2255850d7816799d?s=128&d=identicon&r=PG", "display_name": "ftw", "link": "https://stackoverflow.com/users/1324546/ftw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 672, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1479068252, "creation_date": 1479068083, "last_edit_date": 1479068141, "question_id": 40578340, "link": "https://stackoverflow.com/questions/40578340/haskell-pattern-matching-on-list", "title": "Haskell pattern matching on List", "body": "<p>I know we can use below pattern matching in Haskell:</p>\n\n<pre><code>sum :: (Num a) =&gt; [a] -&gt; a  \nsum [] = 0  \nsum (x:xs) = x + sum xs \n</code></pre>\n\n<p>But why can\u2019t we use <code>[x] ++ xs</code>?</p>\n\n<pre><code>sum :: (Num a) =&gt; [a] -&gt; a  \nsum [] = 0  \nsum ([x] ++ xs) = x + sum xs\n</code></pre>\n"}, {"tags": ["string", "haskell", "http-conduit"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1479067481, "post_id": 40578162, "comment_id": 68392032, "body": "That should probably be <code>%0D</code> (with a zero)."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 2, "last_activity_date": 1479067975, "creation_date": 1479067975, "answer_id": 40578326, "question_id": 40578162, "link": "https://stackoverflow.com/questions/40578162/haskell-simplehttp-appending-0d/40578326#40578326", "title": "Haskell: simplehttp appending &quot;%0D&quot;?", "body": "<p>The <code>0x0D</code> character is a component of the newline sequence on windows but not on mac. You are probably reading in a line from your windows-encoded file that contains a windows newline that your mac doesn't understand without a little help from you.</p>\n"}], "owner": {"reputation": 986, "user_id": 2953798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/47edc9c371f59db2f0620d0ae46d4c8f?s=128&d=identicon&r=PG&f=1", "display_name": "Manvi", "link": "https://stackoverflow.com/users/2953798/manvi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 40578326, "answer_count": 1, "score": 0, "last_activity_date": 1479068090, "creation_date": 1479066900, "last_edit_date": 1479068090, "question_id": 40578162, "link": "https://stackoverflow.com/questions/40578162/haskell-simplehttp-appending-0d", "title": "Haskell: simplehttp appending &quot;%0D&quot;?", "body": "<p>I am using simplehttp to query webpage. eg: let webLink = \"www.example.com/\" and number= 257 (number is read from file).</p>\n\n<pre><code>res &lt;- simpleHttp $ \"webLink\" ++ number\n</code></pre>\n\n<p>It  is working fine on windows but on mac, it is throwing error 404 as its showing path as \"www.example.com/257%0D\"\nI have no idea where this \"%0D\" is coming from because printing number is giving me 257 . I have tried filtering \"%0D\" as well like below, but still mac is showing error 404 due to %0D in path...Please suggest.</p>\n\n<pre><code>res &lt;- simpleHttp $ (filter (not . (`elem` \"%0D\")) (\"webLink\" ++ number))\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1479067983, "post_id": 40577150, "comment_id": 68392206, "body": "If you are inside the project folder, you can run <code>stack list-dependencies</code> to see which version of <code>Cabal</code> is being used. That&#39;s not quite what you want though."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1479105615, "post_id": 40577150, "comment_id": 68401585, "body": "@Alec Thanks, yeah that&#39;s not quite what I want. I want to find out the library version of the dependency just from the executable."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 0, "last_activity_date": 1479107725, "creation_date": 1479107725, "answer_id": 40583592, "question_id": 40577150, "link": "https://stackoverflow.com/questions/40577150/find-library-dependency-version-of-haskell-executable/40583592#40583592", "title": "Find library dependency version of Haskell executable", "body": "<p>Thanks to @ongy from #haskell irc for this answer.</p>\n\n<p>I can use the GNU's <code>strings</code> utility to find the information. To find\nwhich version of <code>Cabal</code> my stack executable is using, I can do this:</p>\n\n<pre><code>strings ~/.local/bin/stack | grep -i Cabal-\n</code></pre>\n\n<p>That will spit out a big string and I can find this piece of\ninformation in it:</p>\n\n<pre><code>/tmp/stack-upgrade7565/stack/.stack-work/install/x86_64-linux/lts-6.14/7.10.3/lib/x86_64-linux-ghc-7.10.3/stack-1.2.1-IEWywJcSJuzIIEqkeEd87k:/home/sibi/.stack/snapshots/x86_64-linux/lts-6.17/7.10.3/lib/x86_64-linux-ghc-7.10.3/Cabal-1.22.8.0-Ku2CIqstfjg7Z2SNHUypWH:/home/sibi/.stack/snapshots/x86_64-linux/lts-6.14/7.10.3/lib/x86_64-linux-ghc-7.10.3/Glob-0.7.11-0WpLeizIORG0eUMRaKlYmO:/home/sibi/.stack/snapshots/x86_64-linux/lts-6.14/7.10.3/lib/x86_64-li....\n</code></pre>\n\n<p>And I can see <code>Cabal-1.22.8.0</code> in it.</p>\n\n<p>To find the <code>base</code> library version, you can do</p>\n\n<p><code>executable +RTS --info</code> which will spit out the ghc version from\nwhich we can find the base. Example:</p>\n\n<pre><code>$ stack +RTS --info\n [(\"GHC RTS\", \"YES\")\n ,(\"GHC version\", \"7.10.3\")\n ,(\"RTS way\", \"rts_thr\")\n ,(\"Build platform\", \"x86_64-unknown-linux\")\n ,(\"Build architecture\", \"x86_64\")\n ,(\"Build OS\", \"linux\")\n ,(\"Build vendor\", \"unknown\")\n ,(\"Host platform\", \"x86_64-unknown-linux\")\n ,(\"Host architecture\", \"x86_64\")\n ,(\"Host OS\", \"linux\")\n ,(\"Host vendor\", \"unknown\")\n ,(\"Target platform\", \"x86_64-unknown-linux\")\n ,(\"Target architecture\", \"x86_64\")\n ,(\"Target OS\", \"linux\")\n ,(\"Target vendor\", \"unknown\")\n ,(\"Word size\", \"64\")\n ,(\"Compiler unregisterised\", \"NO\")\n ,(\"Tables next to code\", \"YES\")\n ]\n</code></pre>\n\n<p>Thanks to @MarcelineVQ for the above tip.</p>\n"}], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 40583592, "answer_count": 1, "score": 2, "last_activity_date": 1479107725, "creation_date": 1479060903, "last_edit_date": 1479065844, "question_id": 40577150, "link": "https://stackoverflow.com/questions/40577150/find-library-dependency-version-of-haskell-executable", "title": "Find library dependency version of Haskell executable", "body": "<p>Let's say I have a executable file produced by ghc. Now I want to know\nwhich version of a particular library it was built with (like which\nversion of base/&lt; insert other library here > it was built with ?) ?</p>\n\n<p>Is it possible to find it ?</p>\n\n<p>A more specific question - I want to know which version of <code>Cabal</code>\nlibrary is used by my <code>stack</code> executable.</p>\n"}, {"tags": ["haskell", "numpy", "hmatrix"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1479068689, "last_edit_date": 1479068689, "creation_date": 1479067606, "answer_id": 40578268, "question_id": 40576876, "link": "https://stackoverflow.com/questions/40576876/efficient-haskell-equivalent-to-numpys-argsort/40578268#40578268", "title": "Efficient Haskell equivalent to NumPy&#39;s argsort", "body": "<p>Use <a href=\"http://hackage.haskell.org/package/vector-algorithms\" rel=\"noreferrer\">vector-algorithms</a>:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Ord (comparing)\n\nimport qualified Data.Vector.Unboxed as VU\nimport qualified Data.Vector.Algorithms.Intro as VAlgo\n\nargSort :: (Ord a, VU.Unbox a) =&gt; VU.Vector a -&gt; VU.Vector Int\nargSort xs = VU.map fst $ VU.create $ do\n    xsi &lt;- VU.thaw $ VU.indexed xs\n    VAlgo.sortBy (comparing snd) xsi\n    return xsi\n</code></pre>\n\n<p>Note these are <code>Unboxed</code> rather than <code>Storable</code> vectors. The latter need to make some tradeoffs to allow impure C FFI operations and can't properly handle heterogeneous tuples. You can of course always <a href=\"http://hackage.haskell.org/package/vector-0.11.0.0/docs/Data-Vector-Unboxed.html#g:36\" rel=\"noreferrer\"><code>convert</code></a> to and from storable vectors.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7784908, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/280a16ff968b8d9982bf2406335f6821?s=128&d=identicon&r=PG&f=1", "display_name": "val", "link": "https://stackoverflow.com/users/7784908/val"}, "is_accepted": false, "score": 0, "last_activity_date": 1511451414, "last_edit_date": 1511451414, "creation_date": 1511437156, "answer_id": 47454648, "question_id": 40576876, "link": "https://stackoverflow.com/questions/40576876/efficient-haskell-equivalent-to-numpys-argsort/47454648#47454648", "title": "Efficient Haskell equivalent to NumPy&#39;s argsort", "body": "<p>What worked better for me is using Data.map, as it is subject to list fusion, got a speed up. Here n=Length xs. </p>\n\n<pre><code>import Data.Map as M (toList, fromList, toAscList)\n\n    out :: Int -&gt; [Double] -&gt; [Int]\n    out n !xs = let !a=  (M.toAscList (M.fromList $! (zip xs [0..n])))\n                    !res=a `seq` L.map snd a\n                in res\n</code></pre>\n\n<p>However this is only aplicable for periodic lists, as: </p>\n\n<pre><code>out 12 [1,2,3,4,1,2,3,4,1,2,3,4] == out 12 [1,2,3,4,1,3,2,4,1,2,3,4]\n</code></pre>\n"}], "owner": {"reputation": 29707, "user_id": 394167, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5b8b4928a69d422138ed747c70e8553e?s=128&d=identicon&r=PG", "display_name": "Richard Cook", "link": "https://stackoverflow.com/users/394167/richard-cook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 344, "favorite_count": 3, "accepted_answer_id": 40578268, "answer_count": 2, "score": 5, "last_activity_date": 1511451414, "creation_date": 1479059074, "last_edit_date": 1479235205, "question_id": 40576876, "link": "https://stackoverflow.com/questions/40576876/efficient-haskell-equivalent-to-numpys-argsort", "title": "Efficient Haskell equivalent to NumPy&#39;s argsort", "body": "<p>Is there a standard Haskell equivalent to NumPy's <a href=\"https://docs.scipy.org/doc/numpy/reference/generated/numpy.argsort.html\" rel=\"nofollow noreferrer\"><code>argsort</code></a> function?</p>\n\n<p>I'm using <a href=\"http://hackage.haskell.org/package/hmatrix\" rel=\"nofollow noreferrer\">HMatrix</a> and, so, would like a function compatible with <code>Vector R</code> which is an alias for <code>Data.Vector.Storable.Vector Double</code>. The <code>argSort</code> function below is the implementation I'm currently using:</p>\n\n<pre><code>{-# LANGUAGE NoImplicitPrelude #-}\n\nmodule Main where\n\nimport qualified Data.List as L\nimport qualified Data.Vector as V\nimport qualified Data.Vector.Storable as VS\nimport           Prelude (($), Double, IO, Int, compare, print, snd)\n\na :: VS.Vector Double\na = VS.fromList [40.0, 20.0, 10.0, 11.0]\n\nargSort :: VS.Vector Double -&gt; V.Vector Int\nargSort xs = V.fromList (L.map snd $ L.sortBy (\\(x0, _) (x1, _) -&gt; compare x0 x1) (L.zip (VS.toList xs) [0..]))\n\nmain :: IO ()\nmain = print $ argSort a -- yields [2,3,1,0]\n</code></pre>\n\n<p>I'm using explicit qualified <code>import</code>s just to make it clear where every type and function is coming from.</p>\n\n<p>This implementation is not terribly efficient since it converts the input vector to a list and the result back to a vector. Does something like this (but more efficient) exist somewhere?</p>\n\n<p><strong>Update</strong></p>\n\n<p>@leftaroundabout had a good solution. This is the solution I ended up with:</p>\n\n<pre><code>module LAUtil.Sorting\n  ( IndexVector\n  , argSort\n  )\n  where\n\nimport           Control.Monad\nimport           Control.Monad.ST\nimport           Data.Ord\nimport qualified Data.Vector.Algorithms.Intro as VAI\nimport qualified Data.Vector.Storable as VS\nimport qualified Data.Vector.Unboxed as VU\nimport qualified Data.Vector.Unboxed.Mutable as VUM\nimport           Numeric.LinearAlgebra\n\ntype IndexVector = VU.Vector Int\n\nargSort :: Vector R -&gt; IndexVector\nargSort xs = runST $ do\n    let l = VS.length xs\n    t0 &lt;- VUM.new l\n    forM_ [0..l - 1] $\n        \\i -&gt; VUM.unsafeWrite t0 i (i, (VS.!) xs i)\n    VAI.sortBy (comparing snd) t0\n    t1 &lt;- VUM.new l\n    forM_ [0..l - 1] $\n        \\i -&gt; VUM.unsafeRead t0 i &gt;&gt;= \\(x, _) -&gt; VUM.unsafeWrite t1 i x\n    VU.freeze t1\n</code></pre>\n\n<p>This is more directly usable with <code>Numeric.LinearAlgebra</code> since the data vector is a <code>Storable</code>. This uses an unboxed vector for the indices.</p>\n"}, {"tags": ["haskell", "ghc", "ghci"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1479058164, "post_id": 40576231, "comment_id": 68388860, "body": "The Haskell Platform includes both of these packages - <code>text</code> and <code>split</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1479060326, "post_id": 40576231, "comment_id": 68389652, "body": "You have to install the package that contains a module before can import it. Whether that installation occurs when you first install <code>ghci</code>, or you install it later with <code>cabal</code>, <code>stack</code>, or some other means, doesn&#39;t matter."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1479060594, "post_id": 40576231, "comment_id": 68389739, "body": "I know you are not looking for this, but you can do: <code>stack ghci split text</code>"}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1479072304, "post_id": 40576231, "comment_id": 68393660, "body": "I installed the standard Haskell Platform from the Haskell website using the standard download. If <code>text</code> and <code>split</code> are included in the platform, why are they not visible? <code>import text</code> and <code>import split</code> don&#39;t work. How do you make them visible without using stack or cabal? Or is that not possible? Why is it necessary to do anything special to <code>import</code> something that&#39;s been downloaded as part of the standard Platform?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1479084341, "post_id": 40576231, "comment_id": 68396604, "body": "<code>import text</code> is a syntax error. Do you mean <code>import Data.Text</code> and <code>import Data.List.Split</code>? You should probably be aware that the <code>Cabal</code> library is a fundamental piece of Haskell infrastructure. You can use it via <code>stack</code> or <code>cabal-install</code>, but avoiding it altogether is likely to be an exercise in frustration. Pretty much every important package in the Haskell world relies on Cabal to some extent."}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1479085059, "post_id": 40576231, "comment_id": 68396732, "body": "Yes, I had tried <code>import Data.Text</code> and <code>import Data.List.Split</code>. The comment was wrong, but the GHCi command was right."}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1479085182, "post_id": 40576231, "comment_id": 68396758, "body": "So for someone who just wants to write basic Haskell programs and not do major development, is there a simple tutorial that explains how to use one or the other -- and which one makes more sense for that purpose, i.e., simple programs that may need packages/modules in the standard platform?  I would like to be able to start WinGHCi and import standard things from the prompt. Is that possible? I would have thought was would be possible. It works for many modules. Why for some and not for others? And how does one tell the difference?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1479095067, "post_id": 40576231, "comment_id": 68398864, "body": "Here&#39;s a guide to using GHCi with Stack <a href=\"https://haskell-lang.org/tutorial/stack-play\" rel=\"nofollow noreferrer\">haskell-lang.org/tutorial/stack-play</a>"}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1479102083, "post_id": 40576231, "comment_id": 68400488, "body": "Thanks. It&#39;s not your responsibility, but that&#39;s just what I didn&#39;t want. The first thing it says it to read something else about installing stack. After that it doesn&#39;t say anything about using Stack to import packages that (in my view) should be imported without any extra effort. So, a lot of reading with no real answers to my simple problem: how to import something that is downloaded with the standard platform."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1480483916, "post_id": 40576231, "comment_id": 68976392, "body": "Does <code>ghc-pkg list</code> show <code>text</code> and <code>split</code>?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1480483959, "post_id": 40576231, "comment_id": 68976410, "body": "Are you able to import them if you start GHCi with the <code>-package text -package split</code> arguments?"}], "answers": [{"tags": [], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "is_accepted": true, "score": 1, "last_activity_date": 1480872964, "creation_date": 1480872964, "answer_id": 40961521, "question_id": 40576231, "link": "https://stackoverflow.com/questions/40576231/would-like-to-import-spliton-without-using-cabal-or-stack/40961521#40961521", "title": "Would like to import splitOn without using Cabal or Stack", "body": "<p>Running</p>\n\n<pre><code>cabal install missingh\n</code></pre>\n\n<p>and</p>\n\n<pre><code>cabal install split\n</code></pre>\n\n<p>solved the problem. It seems like that shouldn't have been necessary, but apparently it was.</p>\n"}], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 884, "favorite_count": 0, "accepted_answer_id": 40961521, "answer_count": 1, "score": 0, "last_activity_date": 1480872964, "creation_date": 1479055051, "last_edit_date": 1480483966, "question_id": 40576231, "link": "https://stackoverflow.com/questions/40576231/would-like-to-import-spliton-without-using-cabal-or-stack", "title": "Would like to import splitOn without using Cabal or Stack", "body": "<p>I would like to import <code>splitOn</code> without using Cabal or Stack. Is that possible? It GHCi refuses to <code>import</code> <code>Data.Text</code>, <code>Data.List.Split</code>, or <code>Data.Split</code>, what's the next step without using a Cabal or Stack? Is it possible to import it directly from within GHCi?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "recursion", "monads"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 2, "creation_date": 1479054217, "post_id": 40576027, "comment_id": 68387470, "body": "Why not just do <code>takeWhile isJust</code>, then count after?"}, {"owner": {"reputation": 609, "user_id": 1670894, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7fcce9d3b958e074a85d4a3625563961?s=128&d=identicon&r=PG", "display_name": "Luigi Sgro", "link": "https://stackoverflow.com/users/1670894/luigi-sgro"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1479054530, "post_id": 40576027, "comment_id": 68387584, "body": "How would you apply the predicate and count inside the list of <code>Maybe</code> in an elegant way, without matching on the <code>Just</code> constructor?"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1479054594, "post_id": 40576027, "comment_id": 68387607, "body": "Filter out the Nothings, then fold over the resulting list, unwrapping the justs, and counting them."}], "answers": [{"comments": [{"owner": {"reputation": 609, "user_id": 1670894, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7fcce9d3b958e074a85d4a3625563961?s=128&d=identicon&r=PG", "display_name": "Luigi Sgro", "link": "https://stackoverflow.com/users/1670894/luigi-sgro"}, "edited": false, "score": 0, "creation_date": 1479054848, "post_id": 40576112, "comment_id": 68387724, "body": "Nice one-liner. Exactly what I was looking for."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 609, "user_id": 1670894, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7fcce9d3b958e074a85d4a3625563961?s=128&d=identicon&r=PG", "display_name": "Luigi Sgro", "link": "https://stackoverflow.com/users/1670894/luigi-sgro"}, "edited": false, "score": 0, "creation_date": 1479059754, "post_id": 40576112, "comment_id": 68389424, "body": "@LuigiSgro This function can be written even shorter:  <code>howMany p = length . takeWhile (maybe False p)</code>"}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1479059916, "post_id": 40576112, "comment_id": 68389491, "body": "But that function doesn&#39;t do the same. It counts just the first elements, that  are not Nothing and satisfy <code>p</code>. The question asked for a function, that counts the number of elements satisfying <code>p</code> out of the first elements, that are not Nothing."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1479061970, "post_id": 40576112, "comment_id": 68390232, "body": "@jpath Hmm.. You&#39;re right. Didn&#39;t think about this. Well, I guess I can&#39;t write shorter :("}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": true, "score": 4, "last_activity_date": 1479054429, "creation_date": 1479054429, "answer_id": 40576112, "question_id": 40576027, "link": "https://stackoverflow.com/questions/40576027/haskell-takewhile-on-list-of-maybe/40576112#40576112", "title": "Haskell: takeWhile on list of Maybe", "body": "<p>The following would work.</p>\n\n<pre><code>import Data.Maybe (isJust, maybe)\nhowMany p = length . filter (maybe False p) . takeWhile isJust\n</code></pre>\n\n<p>Or alternatively you could also use <code>fromJust</code> instead of <code>maybe</code>. Normally partial functions like <code>fromJust</code> are discouraged, however in this case it is safe.</p>\n\n<pre><code>import Data.Maybe (isJust, fromJust)\nhowMany p = length . filter (p . fromJust) . takeWhile isJust\n</code></pre>\n"}], "owner": {"reputation": 609, "user_id": 1670894, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7fcce9d3b958e074a85d4a3625563961?s=128&d=identicon&r=PG", "display_name": "Luigi Sgro", "link": "https://stackoverflow.com/users/1670894/luigi-sgro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "accepted_answer_id": 40576112, "answer_count": 1, "score": 2, "last_activity_date": 1479054429, "creation_date": 1479054001, "question_id": 40576027, "link": "https://stackoverflow.com/questions/40576027/haskell-takewhile-on-list-of-maybe", "title": "Haskell: takeWhile on list of Maybe", "body": "<p>An infinite list of <code>Maybe n</code>, which, from a specific position, has only <code>Nothing</code> items:</p>\n\n<pre><code>someNumbers :: [Maybe Int]\nsomeNumbers = [Just 4, Just 3, Just 2, Just 1] ++ cycle [Nothing]\n</code></pre>\n\n<p>I would like to count the <code>n</code>s statisfying a predicate <code>p</code>, stopping at the first <code>Nothing</code>:</p>\n\n<pre><code>howMany :: (Int -&gt; Bool) -&gt; [Maybe Int] -&gt; Int\n</code></pre>\n\n<p>This is what I came up with, with explicit recursion:</p>\n\n<pre><code>howMany p ((Just n):rest)\n| p n = 1 + (howMany p rest)\n| otherwise = 0\nhowMany _ _ = 0\n</code></pre>\n\n<p>I am wondering if there is a better way to express this, making use of advanced Haskell abstractions.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 960, "user_id": 6800638, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8032bc02138a88415e190d8f607ad64a?s=128&d=identicon&r=PG&f=1", "display_name": "Aman Jaiswal", "link": "https://stackoverflow.com/users/6800638/aman-jaiswal"}, "edited": false, "score": 0, "creation_date": 1479047606, "post_id": 40574919, "comment_id": 68385305, "body": "No it doesn&#39;t you must have mistyped (GHC Version 8.0.1)."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 960, "user_id": 6800638, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8032bc02138a88415e190d8f607ad64a?s=128&d=identicon&r=PG&f=1", "display_name": "Aman Jaiswal", "link": "https://stackoverflow.com/users/6800638/aman-jaiswal"}, "edited": false, "score": 0, "creation_date": 1479047825, "post_id": 40574919, "comment_id": 68385359, "body": "Still strange. <code>clearBit 37 0</code> gives 36. I don&#39;t see how 36 would make sense for <code>clearBit 37 2</code>."}, {"owner": {"reputation": 960, "user_id": 6800638, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8032bc02138a88415e190d8f607ad64a?s=128&d=identicon&r=PG&f=1", "display_name": "Aman Jaiswal", "link": "https://stackoverflow.com/users/6800638/aman-jaiswal"}, "edited": false, "score": 0, "creation_date": 1479047832, "post_id": 40574919, "comment_id": 68385362, "body": "import Data.Bits       killKthBit n k = clearBit n k-1"}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 960, "user_id": 6800638, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8032bc02138a88415e190d8f607ad64a?s=128&d=identicon&r=PG&f=1", "display_name": "Aman Jaiswal", "link": "https://stackoverflow.com/users/6800638/aman-jaiswal"}, "edited": false, "score": 0, "creation_date": 1479047888, "post_id": 40574919, "comment_id": 68385384, "body": "You forgot the parenthesis around <code>(k-1)</code> ;)"}, {"owner": {"reputation": 960, "user_id": 6800638, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8032bc02138a88415e190d8f607ad64a?s=128&d=identicon&r=PG&f=1", "display_name": "Aman Jaiswal", "link": "https://stackoverflow.com/users/6800638/aman-jaiswal"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1479047933, "post_id": 40574919, "comment_id": 68385400, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/127994/discussion-between-aman-jaiswal-and-jpath\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": true, "score": 1, "last_activity_date": 1479047341, "creation_date": 1479047341, "answer_id": 40574919, "question_id": 40574864, "link": "https://stackoverflow.com/questions/40574864/convert-kth-bit-from-last/40574919#40574919", "title": "Convert kth bit from last", "body": "<p>You are looking for the <code>Bits</code> typeclass in <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Bits.html\" rel=\"nofollow noreferrer\"><code>Data.Bits</code></a>. Integer has an instance for <code>Bits</code>, so you can:</p>\n\n<pre><code>clearBit 37 2 -- 2 because we are indexing from 0.\n</code></pre>\n"}], "owner": {"reputation": 960, "user_id": 6800638, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8032bc02138a88415e190d8f607ad64a?s=128&d=identicon&r=PG&f=1", "display_name": "Aman Jaiswal", "link": "https://stackoverflow.com/users/6800638/aman-jaiswal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 40574919, "answer_count": 1, "score": 1, "last_activity_date": 1479047341, "creation_date": 1479046906, "question_id": 40574864, "link": "https://stackoverflow.com/questions/40574864/convert-kth-bit-from-last", "title": "Convert kth bit from last", "body": "<p>Hi I am new in haskell. </p>\n\n<p>Can any one tell me to convert Kth bit from last of given Integer in haskell.</p>\n\n<p>For n = 37 and k = 3, the output should be\nkillKthBit(n, k) = 33.</p>\n\n<p>37 = 100<strong>1</strong>01 ~> 100<strong>0</strong>01 = 33.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1479066697, "post_id": 40574061, "comment_id": 68391774, "body": "The <i>result</i> of <code>(++)</code> is supposed to be the same in both cases. That doesn&#39;t mean that the number of computations is the same though."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1479075946, "post_id": 40574061, "comment_id": 68394731, "body": "(big list) ++ (small list) is slower than (small list) ++ (big list)"}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1500049440, "post_id": 40574061, "comment_id": 77186446, "body": "I saw you being here for a long time and asking a lot of questions without accepting one. If an answer helps you, consider <a href=\"https://stackoverflow.com/help/accepted-answer\">accepting</a> it. Please also spend 2 minutes doing a <a href=\"https://stackoverflow.com/tour\">tour</a> to understand how this site works"}, {"owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "edited": false, "score": 0, "creation_date": 1500139236, "post_id": 40574061, "comment_id": 77212493, "body": "Hi, I just did. sorry I didnt know it. eii"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 11, "last_activity_date": 1479043024, "last_edit_date": 1479043024, "creation_date": 1479042722, "answer_id": 40574194, "question_id": 40574061, "link": "https://stackoverflow.com/questions/40574061/foldl-with-is-a-lot-slower-than-foldr/40574194#40574194", "title": "foldl with (++) is a lot slower than foldr", "body": "<p>It's because of how <code>++</code> works. Note that is is defined by induction on its first argument.</p>\n\n<pre><code>[]     ++ ys = ys\n(x:xs) ++ ys = x : (xs ++ ys)\n</code></pre>\n\n<p>The number of recursive calls only depends on <code>length xs</code>.</p>\n\n<p>Because of this, in <code>xs ++ ys</code> it is more convenient to have a small <code>xs</code> and a large <code>ys</code> than the other way around.</p>\n\n<p>Note that folding on the right achieves this:</p>\n\n<pre><code>[1] ++ ([2] ++ ([3] ++ ...\n</code></pre>\n\n<p>We only have short (O(1)-length) lists on the left of <code>++</code>, making the fold cost O(n).</p>\n\n<p>Instead folding on the left is bad:</p>\n\n<pre><code>((([] ++ [1]) ++ [2]) ++ [3]) ++ ...\n</code></pre>\n\n<p>The left arguments become larger and larger. Hence, we get O(n^2) complexity here.</p>\n\n<p>This argument can be made more precise considering how the output list is demanded. One can observe that <code>foldr</code> produces its result in a \"streaming\" fashion, where demanding e.g. the first output list cell only forces a little part of the input -- only the first <code>++</code> needs to be performed, and only its first recursive step is actually needed! Instead demanding even only the first item from the <code>foldl</code> result will force <em>all</em> the <code>++</code> calls, making it quite expensive (even if each call only needs one recursive step, there are O(n) calls).</p>\n"}], "owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 412, "favorite_count": 0, "accepted_answer_id": 40574194, "answer_count": 1, "score": 6, "last_activity_date": 1479048251, "creation_date": 1479041749, "last_edit_date": 1479048251, "question_id": 40574061, "link": "https://stackoverflow.com/questions/40574061/foldl-with-is-a-lot-slower-than-foldr", "title": "foldl with (++) is a lot slower than foldr", "body": "<p>Why is foldl slower than foldr sometimes ?\nI have a list of lists \"a\" like</p>\n\n<pre><code>a = [[1],[2],[3]]\n</code></pre>\n\n<p>and want to change it to a list by using fold</p>\n\n<pre><code>foldr (++) [] a\n</code></pre>\n\n<p>It works fine (time complexity is O(n)). But if I use foldl instead, it is very slow (time complexity is O(n^2)).</p>\n\n<pre><code>foldl (++) [] a\n</code></pre>\n\n<p>If foldl is just folding the input list from the left side,</p>\n\n<pre><code>(([] ++ [1]) ++ [2]) ++ [3]\n</code></pre>\n\n<p>and foldr is from the right side,</p>\n\n<pre><code>[1] ++ ([2] ++ ([3] ++ []))\n</code></pre>\n\n<p>the number of computations (++) is supposed to be same in both cases.  Why is foldr so slow? As per the time complexity, foldl looks as if scanning the input list twice as many times as foldr.  I used the following to computer the time</p>\n\n<pre><code>length $ fold (++) [] $ map (:[]) [1..N]   (fold is either foldl or foldr)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "monads", "dry", "reusability"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 1, "creation_date": 1479040089, "post_id": 40573790, "comment_id": 68383191, "body": "What do you mean when you say &quot;code-reuse&quot;? Monads and Applicatives are different concepts used in different contexts. While every Monad is also an applicative, using applicatives you can generate more efficient code, such as Parsers for example."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1479040692, "post_id": 40573790, "comment_id": 68383359, "body": "Somewhat related: <a href=\"http://stackoverflow.com/questions/7040844/applicatives-compose-monads-dont\" title=\"applicatives compose monads dont\">stackoverflow.com/questions/7040844/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1479042736, "post_id": 40573790, "comment_id": 68383930, "body": "With functors I am able to reuse plain, pure functions in specific computational contexts. With applicatives I am able to reuse plain, pure functions that take values from several contexts of the same applicative. Now I want to reuse plain, pure functions within monadic computations. But <code>bind</code> expects a &quot;special&quot; function (which I&#39;ve called monadic action), which have to return a monad of the same type. Therefore I have the impression that the reuse of pure functions is not the purpose of monads."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1479043424, "post_id": 40573790, "comment_id": 68384084, "body": "I can&#39;t understand the premises. <code>ap</code> does not take a function <code>a -&gt; b</code>, but <code>f (a -&gt; b)</code> which is a different thing. You <i>can</i> use <code>ap (pure g) ...</code>, of course, but that&#39;s another thing. Further, every monad is an applicative, so if you can make type <code>T a</code> into a monad, there&#39;s no reason not to make it an applicative as well (indeed, that&#39;s now mandatory in recent GHCs ...) Hence, I can not understand this question."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1479065848, "post_id": 40573790, "comment_id": 68391511, "body": "@chi <code>f (a -&gt; b)</code> is a pure function somehow produced in a context. But it is still a pure function. <code>(a -&gt; m b)</code> is different, because the mechanism of how a value is produced in a context has been shifted into the function itself. I just have a hard time to understand how (a -&gt; m b) is used in an idiomatic way. Since you don&#39;t understand my question, I guess I am on the wrong track."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1479067363, "post_id": 40573790, "comment_id": 68391987, "body": "@ftor (1) An <code>f (a -&gt; b)</code> value is not necessarily a <i>single</i> pure function in a context -- for instance, consider <code>[(2*), (3+)] :: Num a =&gt; [a -&gt; a]</code>, or <code>Nothing :: Maybe (String -&gt; String)</code>. While it does consist of (zero or more) plain functions in a context, calling it a &quot;pure function&quot; leads to confusion. (2)  A key feature of <code>(=&lt;&lt;) :: Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b</code> is that the context of <code>m b</code> depends on the <code>a</code> value(s). In <code>putStrLn =&lt;&lt; getLine</code>, the string that shows up in your screen is the very same one that you typed in the terminal. <code>fmap</code> and <code>(&lt;*&gt;)</code> can&#39;t do that."}], "answers": [{"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 8, "last_activity_date": 1479043952, "creation_date": 1479043952, "answer_id": 40574387, "question_id": 40573790, "link": "https://stackoverflow.com/questions/40573790/does-the-expressiveness-of-monads-come-at-the-expense-of-code-reuse/40574387#40574387", "title": "Does the expressiveness of monads come at the expense of code reuse?", "body": "<p>If you have pure function <code>g :: a -&gt; b</code> you can make it be either <code>Applicative</code> version by </p>\n\n<p><code>pure g :: Applicative f =&gt; f (a -&gt; b)</code> </p>\n\n<p>or <code>Monad</code>ish by </p>\n\n<p><code>pure . g :: Applicative f =&gt; a -&gt; f b</code> </p>\n\n<p>So you don't lose any code reuse in your sense.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1479063184, "post_id": 40575856, "comment_id": 68390605, "body": "I guess my understanding of monads is way too schematic. I just try to get a better sense of how to use (a -&gt; m b) in an idiomatic way. Sorry for the confusion and thanks for your help!"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1479065394, "last_edit_date": 1479065394, "creation_date": 1479053015, "answer_id": 40575856, "question_id": 40573790, "link": "https://stackoverflow.com/questions/40573790/does-the-expressiveness-of-monads-come-at-the-expense-of-code-reuse/40575856#40575856", "title": "Does the expressiveness of monads come at the expense of code reuse?", "body": "<p>Code reuse is only an advantage if you can reuse code to do what you actually want.</p>\n\n<pre><code>GHCi&gt; putStrLn =&lt;&lt; getLine\nSulfur\nSulfur\nGHCi&gt; \n</code></pre>\n\n<p>Here, <code>(=&lt;&lt;)</code> picks the <code>String</code> result produced in an <code>IO</code> context by <code>getLine</code> and feeds it to <code>putStrLn</code>, which then prints said result.</p>\n\n<pre><code>GHCi&gt; :t getLine\ngetLine :: IO String\nGHCi&gt; :t putStrLn\nputStrLn :: String -&gt; IO ()\nGHCi&gt; :t putStrLn =&lt;&lt; getLine\nputStrLn =&lt;&lt; getLine :: IO ()\n</code></pre>\n\n<p>Now, in the type of <code>fmap</code>/<code>(&lt;$&gt;)</code>...</p>\n\n<pre><code>GHCi&gt; :t (&lt;$&gt;)\n(&lt;$&gt;) :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>... it is perfectly possible for <code>b</code> to be <code>IO ()</code>, and therefore nothing stops us from using <code>putStrLn</code> with it. However...</p>\n\n<pre><code>GHCi&gt; putStrLn &lt;$&gt; getLine\nSulfur\nGHCi&gt; \n</code></pre>\n\n<p>... nothing will be printed.</p>\n\n<pre><code>GHCi&gt; :t putStrLn &lt;$&gt; getLine\nputStrLn &lt;$&gt; getLine :: IO (IO ())\n</code></pre>\n\n<p>Executing an <code>IO (IO ())</code> action won't execute the inner <code>IO ()</code> action. To do that, we need the additional power of <code>Monad</code>, either by replacing <code>(&lt;$&gt;)</code> with <code>(=&lt;&lt;)</code> or, equivalently, by using <code>join</code> on the <code>IO (IO ())</code> value:</p>\n\n<pre><code>GHCi&gt; :t join\njoin :: Monad m =&gt; m (m a) -&gt; m a\nGHCi&gt; join (putStrLn &lt;$&gt; getLine)\nSulfur\nSulfur\nGHCi&gt; \n</code></pre>\n\n<p>Like chi, I also have trouble understanding the premises of your question. You seem to expect that one of <code>Functor</code>, <code>Applicative</code> and <code>Monad</code> will turn out to be better than the others. That is not the case. We can do more things with <code>Applicative</code> than with <code>Functor</code>, and even more with <code>Monad</code>. If you need the additional power, use a suitably powerful class. If not, using a less powerful class will lead to simpler, clearer code and a broader range of available instances. </p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "is_accepted": false, "score": 1, "last_activity_date": 1479130039, "last_edit_date": 1479130039, "creation_date": 1479113817, "answer_id": 40584949, "question_id": 40573790, "link": "https://stackoverflow.com/questions/40573790/does-the-expressiveness-of-monads-come-at-the-expense-of-code-reuse/40584949#40584949", "title": "Does the expressiveness of monads come at the expense of code reuse?", "body": "<p>The reason for this question was my too schematic understanding of the relations between the functor, applicative and monad class. I thought it was only about reusing pure functions.</p>\n\n<p><code>(&lt;*&gt;)</code> essentially says give me an applicative of functions and a bunch of applicatives of values and I will apply them according to my rules.</p>\n\n<p><code>(=&lt;&lt;)</code> essentially says give me a function <code>(a -&gt; m b)</code> and a monad and I will feed <code>(a -&gt; m b)</code> with the value of the monad and leave it to <code>(a -&gt; m b)</code> to produce and return a transformed value wrapped in the same monad.</p>\n\n<p>Of course, the applicative code will be more concise and better reusable, because the mechanism of how a sequence of actions is executed is defined exclusively within <code>(&lt;*&gt;)</code>. However, applicative sequences are also somehow mechanic. So when you want to control the flow of the sequence or the \"shape\" of the resulting structure, you need the extra power of monads, which leads to more verbose code.</p>\n\n<p>I think this question isn't particularly helpful and if people vote for closing, I would have no problem deleting it.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 40575856, "answer_count": 3, "score": 5, "last_activity_date": 1479130039, "creation_date": 1479039922, "question_id": 40573790, "link": "https://stackoverflow.com/questions/40573790/does-the-expressiveness-of-monads-come-at-the-expense-of-code-reuse", "title": "Does the expressiveness of monads come at the expense of code reuse?", "body": "<p>When I compare the binary operations of the Applicative and Monad type class</p>\n\n<pre><code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n(=&lt;&lt;) :: Monad m       =&gt; (a -&gt; m b) -&gt; m a -&gt; m b\n</code></pre>\n\n<p>two differences become apparent:</p>\n\n<ul>\n<li><code>ap</code> expects a normal, pure function, whereas <code>bind</code> expects a monadic action, which must return a monad of the same type</li>\n<li>with <code>ap</code> the sequence of actions is determined by the applicative, whereas with <code>bind</code> the monadic action can determine the control flow</li>\n</ul>\n\n<p>So monads give me additional expressive power. However, since they no longer accept normal, pure functions, this expressiveness seems to come at the expense of code reuse.</p>\n\n<p>My conclusion might be somewhat naive or even false, since I have merely little experience with Haskell and monadic computations. Any light in the dark is appreciated!</p>\n"}, {"tags": ["haskell", "deserialization"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1479032691, "post_id": 40572690, "comment_id": 68381178, "body": "Do you use <code>binary</code> or <code>cereal</code>? Which <code>Get</code> monad do you use?"}, {"owner": {"reputation": 145, "user_id": 4749904, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ksgF.jpg?s=128&g=1", "display_name": "silver", "link": "https://stackoverflow.com/users/4749904/silver"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1479032854, "post_id": 40572690, "comment_id": 68381220, "body": "I use Data.Binary.Get"}], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 4749904, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ksgF.jpg?s=128&g=1", "display_name": "silver", "link": "https://stackoverflow.com/users/4749904/silver"}, "edited": false, "score": 0, "creation_date": 1479043008, "post_id": 40573127, "comment_id": 68383980, "body": "That works! (I am still fairly new to Haskell and wasn&#39;t familiar with the Applicative functions.) Thanks a lot."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 1, "last_activity_date": 1479035224, "creation_date": 1479035224, "answer_id": 40573127, "question_id": 40572690, "link": "https://stackoverflow.com/questions/40572690/haskell-find-out-how-many-bytes-a-get-expression-would-consume/40573127#40573127", "title": "Haskell: find out how many bytes a Get expression would consume", "body": "<blockquote>\n  <p>I need to know how much bytes my getter would consume without\n  consuming them.</p>\n</blockquote>\n\n<p>Perhaps you could perform two calls to the <code>bytesRead :: Get Int64</code> function, the second call inside a <code>lookAhead</code>, after having parsed the <code>a</code> value. Something like</p>\n\n<pre><code>bytesRead1 &lt;- bytesRead \nbytesRead2 &lt;- lookAhead (getter *&gt; bytesRead)\nreturn (bytesRead2 - bytesRead1)\n</code></pre>\n\n<p>I'm not sure about how <code>bytesRead</code> behaves inside <code>lookAhead</code>, however.</p>\n"}], "owner": {"reputation": 145, "user_id": 4749904, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ksgF.jpg?s=128&g=1", "display_name": "silver", "link": "https://stackoverflow.com/users/4749904/silver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 40573127, "answer_count": 1, "score": 0, "last_activity_date": 1479035224, "creation_date": 1479031770, "last_edit_date": 1479033225, "question_id": 40572690, "link": "https://stackoverflow.com/questions/40572690/haskell-find-out-how-many-bytes-a-get-expression-would-consume", "title": "Haskell: find out how many bytes a Get expression would consume", "body": "<p>I am writing a tool which includes a deserialization mechanism for my bachelor thesis, for which I use the <code>Get</code> Monad (<a href=\"https://hackage.haskell.org/package/binary-0.8.4.1/docs/Data-Binary-Get.html\" rel=\"nofollow noreferrer\"><code>Data.Binary.Get</code></a>). I ran into the following problem:</p>\n\n<p>During deserialization, there is a part where I have a getter of type <code>Get a</code> and I need to read a <code>ByteString</code> of length <code>n</code>, where <code>n</code> is the amount of bytes that would be consumed if I ran my <code>getter</code> at this position. In other words, I need to know how much bytes my <code>getter</code> would consume without consuming them.</p>\n\n<p>There is a way to do this:</p>\n\n<pre><code>readBytes :: Get a -&gt; Get ByteString\nreadBytes getter = do safe &lt;- lookAhead getRemainingLazyByteString\n                      let info = runGetOrFail getter safe\n                      -- n_cB = number of consumed bytes\n                      case info of Right (_, n_cB, _) -&gt; getLazyByteString n_cB\n</code></pre>\n\n<p>But this is hideous beyond description. Every time this method is called, it copies the entire remainder of the file.</p>\n\n<p>Even though this doesn't seem like a hard problem in theory, and so far the Get Monad has been capable of doing everything I needed, I cannot find a better solution.</p>\n"}, {"tags": ["haskell", "lambda-calculus"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1479033428, "post_id": 40572544, "comment_id": 68381375, "body": "Your second definition which you find distasteful is the standard way to do this.  My advice is, get used to it.  You are thinking in a way that is not compatible with Haskell&#39;s type system, so go forth and train thyself."}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 3, "last_activity_date": 1479031967, "creation_date": 1479031967, "answer_id": 40572721, "question_id": 40572544, "link": "https://stackoverflow.com/questions/40572544/haskell-ast-with-recursive-types/40572721#40572721", "title": "Haskell AST with recursive types", "body": "<p>Your first solution is just an erroneous definition without meaning. <code>Variable</code> is not a type there, it's a nullary value constructor. You can't refer to <code>Variable</code> in a type definition much like you can't refer to any value, like <code>True</code>, <code>False</code> or <code>100</code>. </p>\n\n<p>The second solution is in fact the direct translation of something we could write in BNF:</p>\n\n<pre><code>var  ::= &lt;string&gt;\nterm ::= \u03bb &lt;var&gt;. &lt;term&gt; | &lt;term&gt; &lt;term&gt; | &lt;var&gt;\n</code></pre>\n\n<p>And thus there is nothing wrong with it.</p>\n"}, {"comments": [{"owner": {"reputation": 159, "user_id": 2850249, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/940d62ca92db1c3a888b2f9bb64b473b?s=128&d=identicon&r=PG&f=1", "display_name": "user2850249", "link": "https://stackoverflow.com/users/2850249/user2850249"}, "edited": false, "score": 0, "creation_date": 1479036404, "post_id": 40572830, "comment_id": 68382124, "body": "Fair enough, the expr solution maybe be possible if i make a function to check that every instance of (Abstract Expr Expr) has only an atomic value as the first Expr. Think I&#39;ll go with the second solution in my question however, as it seems to be the most popular."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 159, "user_id": 2850249, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/940d62ca92db1c3a888b2f9bb64b473b?s=128&d=identicon&r=PG&f=1", "display_name": "user2850249", "link": "https://stackoverflow.com/users/2850249/user2850249"}, "edited": false, "score": 0, "creation_date": 1479036705, "post_id": 40572830, "comment_id": 68382212, "body": "@user2850249 You probably didn&#39;t see my second half of answer. If you use <code>GADT</code> you don&#39;t need to create function that checks that every <code>Abstract Expr Expr</code> has an atomic value as the first <code>Expr</code>. If you use non-atomic as first <code>Expr</code> your code just won&#39;t compile. And it is guaranteed in run-time that your first <code>Expr</code> will always be <code>Atomic</code>."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 1, "last_activity_date": 1479032915, "last_edit_date": 1495540415, "creation_date": 1479032915, "answer_id": 40572830, "question_id": 40572544, "link": "https://stackoverflow.com/questions/40572544/haskell-ast-with-recursive-types/40572830#40572830", "title": "Haskell AST with recursive types", "body": "<p>What you exactly want is to have some type like</p>\n\n<pre><code>data Expr \n  = Atomic Variable\n  | Abstract Expr Expr\n  | Application Expr Expr\n</code></pre>\n\n<p>But constrain first <code>Expr</code> in <code>Abstract</code> constructor to be only <code>Atomic</code>. There is no straightforward way to do this in Haskell because value of some type can be created by any constructor of this type. So the only approach is to make some separate data type or type alias for existing type (like your <code>Variable</code> type alias) and move all common logic into it. Your solution with <code>Variable</code> seems very ok to me.</p>\n\n<p>But. You can use some other advanced features in Haskell to achieve you goal in different way. You can be inspired by <a href=\"https://github.com/goldfirere/glambda\" rel=\"nofollow noreferrer\"><code>glambda</code></a> package which uses <code>GADT</code> to create typed lambda calculus. Also see this answer: <a href=\"https://stackoverflow.com/a/39931015/2900502\">https://stackoverflow.com/a/39931015/2900502</a></p>\n\n<p>I can come up with next solution to achieve you minimal goals (if you only want to constrain first argument of <code>Abstract</code>):</p>\n\n<pre><code>{-# LANGUAGE GADTs          #-}\n{-# LANGUAGE KindSignatures #-}\n\ndata AtomicT\ndata AbstractT\ndata ApplicationT\n\ndata Expr :: * -&gt; * where\n    Atomic      :: String -&gt; Expr AtomicT\n    Abstract    :: Expr AtomicT -&gt; Expr a -&gt; Expr AbstractT\n    Application :: Expr a -&gt; Expr b -&gt; Expr ApplicationT\n</code></pre>\n\n<p>And next example works fine:</p>\n\n<pre><code>ex1 :: Expr AbstractT\nex1 = Abstract (Atomic \"x\") (Atomic \"x\")\n</code></pre>\n\n<p>But this example won't compile because of type mismatch:</p>\n\n<pre><code>ex2 :: Expr AbstractT\nex2 = Abstract ex1 ex1\n</code></pre>\n"}], "owner": {"reputation": 159, "user_id": 2850249, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/940d62ca92db1c3a888b2f9bb64b473b?s=128&d=identicon&r=PG&f=1", "display_name": "user2850249", "link": "https://stackoverflow.com/users/2850249/user2850249"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1479032915, "creation_date": 1479030803, "question_id": 40572544, "link": "https://stackoverflow.com/questions/40572544/haskell-ast-with-recursive-types", "title": "Haskell AST with recursive types", "body": "<p>I'm currently trying to build a lambda calculus solver, and I'm having a slight problem with constructing the AST. A lambda calculus term is inductively defined as:</p>\n\n<p>1) A variable</p>\n\n<p>2) A lambda, a variable, a dot, and a lambda expression.</p>\n\n<p>3) A bracket, a lambda expression, a lambda expression and a bracket.</p>\n\n<p>What I would like to do (and at first tried) is this:</p>\n\n<pre><code>data Expr = \n    Variable\n  | Abstract Variable Expr\n  | Application Expr Expr\n</code></pre>\n\n<p>Now obviously this doesn't work, since Variable is not a type, and Abstract Variable Expr expects types. So my hacky solution to this is to have:</p>\n\n<pre><code>type Variable = String\n\ndata Expr = \n    Atomic Variable\n  | Abstract Variable Expr\n  | Application Expr Expr\n</code></pre>\n\n<p>Now this is really annoying since I don't like the Atomic Variable on its own, but Abstract taking a string rather than an expr. Is there any way I can make this more elegant, and do it like the first solution?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1479030866, "post_id": 40572348, "comment_id": 68380690, "body": "To downvoter: care to explain what about this question is not to your liking? I&#39;d say this is an interesting and non-obvious question. Please comment if you think the question is in some way not well posed."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1479030921, "post_id": 40572348, "comment_id": 68380706, "body": "<code>2</code> is a function, exactly like <code>(+)</code> or <code>(*)</code> only nullary. Why does <code>(*)</code> have the type it has? <code>2</code> uses the same reason. Is <code>(+)</code> polymorphic? So is <code>2</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1479031243, "post_id": 40572348, "comment_id": 68380797, "body": "<a href=\"https://wiki.haskell.org/Polymorphism\" rel=\"nofollow noreferrer\">wiki.haskell.org/Polymorphism</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1479053766, "post_id": 40572348, "comment_id": 68387303, "body": "@n.m. I don&#39;t think it helps to reach for the concept of a &quot;nullary function&quot; to justify that. If <code>2  :: Num a =&gt; a</code> is a nullary function, so is <code>&quot;foo&quot; :: String</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1479054642, "post_id": 40572348, "comment_id": 68387618, "body": "@duplode yes, &quot;foo&quot; is a nullary function, why is it strange or unusual? If you don&#39;t like it, use different terminoogy i.e. call (+) a variable (which it is). The bottom line, 2 is no different from (+) in this regard."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1479059979, "post_id": 40572348, "comment_id": 68389529, "body": "@n.m. I find it strange because it is much simpler to say that, in Haskell, a function is something with the type constructor <code>-&gt;</code> in its type. Calling Haskell non-functions nullary functions, while not unreasonable, is an extrinsic interpretation that doesn&#39;t really clarify anything (e.g. you might just as easily have said &quot;they are all values, and values can be polymorphic&quot;). For a more detailed formulation of this argument, see <a href=\"http://conal.net/blog/posts/everything-is-a-function-in-haskell\" rel=\"nofollow noreferrer\">conal.net/blog/posts/everything-is-a-function-in-haskell</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1479061367, "post_id": 40572348, "comment_id": 68390041, "body": "Haskell functions are functions in the mathematical sense, something a &quot;nullary function&quot; is not."}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1479031137, "post_id": 40572574, "comment_id": 68380765, "body": "I would also add that if you don&#39;t specify type of <code>2</code> explicitly and type inference doesn&#39;t assign concrete type to <code>2</code> constant then some monomorphisation take place: <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">wiki.haskell.org/Monomorphism_restriction</a>"}, {"owner": {"reputation": 23343, "user_id": 1730, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07f21e679da438a4fb2935ee8836b9da?s=128&d=identicon&r=PG", "display_name": "Nicolas", "link": "https://stackoverflow.com/users/1730/nicolas"}, "edited": false, "score": 0, "creation_date": 1479031234, "post_id": 40572574, "comment_id": 68380793, "body": "I&#39;m not sure that the Haskell wiki is correct though. Typeclss introduces <i>bounded parametric polymorphism</i>, which is slightly different than <i>ad hoc polymorphism</i>. But I might be a bit pedantic here."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 23343, "user_id": 1730, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07f21e679da438a4fb2935ee8836b9da?s=128&d=identicon&r=PG", "display_name": "Nicolas", "link": "https://stackoverflow.com/users/1730/nicolas"}, "edited": false, "score": 0, "creation_date": 1479031414, "post_id": 40572574, "comment_id": 68380841, "body": "@Nicolas AFAICT they are not different."}, {"owner": {"reputation": 23343, "user_id": 1730, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/07f21e679da438a4fb2935ee8836b9da?s=128&d=identicon&r=PG", "display_name": "Nicolas", "link": "https://stackoverflow.com/users/1730/nicolas"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1479031763, "post_id": 40572574, "comment_id": 68380940, "body": "@n.m. In general, ad-hoc polymorphism is a bit broader, it also includes overloading for example. In a Haskell context, there is no difference though."}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 4, "last_activity_date": 1479033695, "last_edit_date": 1479033695, "creation_date": 1479030989, "answer_id": 40572574, "question_id": 40572348, "link": "https://stackoverflow.com/questions/40572348/curious-case-of-type-of-2-in-haskell/40572574#40572574", "title": "Curious case of type of 2 in haskell", "body": "<p><code>2</code> is polymorphic so you can use it as whatever type of number you like. The <code>Num</code> type class has a function <code>fromInteger</code>, which is used here. So <code>2</code> is really <code>fromInteger (2 :: Integer)</code>. If <code>2</code> was not polymorphic you would always have to write this if you wanted a non-Integer number, because there is no automatic coercion in Haskell (i.e. you can't do <code>(1 :: Integer) + (1 :: Int)</code>). The is the case for <code>Fractional</code> with <code>fromRational</code> by the way.</p>\n\n<p>Polymorphic type variables can have constraints. If they do not have constraints, it is called <em>parametric polymorphism</em> and if they do <em>constrained</em>, <em>bounded parametric</em> or <em>ad-hoc polymorphism</em>. See also the <a href=\"https://wiki.haskell.org/Polymorphism\" rel=\"nofollow noreferrer\">HaskellWiki article on polymorphism</a>.</p>\n\n<p>Be aware, that you should not rely on type inference for your top-level functions or else you may fall trap to the <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\"><em>monomorphism restriction</em></a>. For example if you write this at the top-level of a module:</p>\n\n<pre><code>polymorphic = 42\n</code></pre>\n\n<p>You may expect <code>polymorphic</code> to be of type <code>Num a =&gt; a</code>, but in reality Haskell will default the type of <code>polymorphic</code> to <code>Integer</code>.</p>\n"}], "owner": {"reputation": 627, "user_id": 634615, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/5d0319056378070fa0eea3a731fb173c?s=128&d=identicon&r=PG", "display_name": "user634615", "link": "https://stackoverflow.com/users/634615/user634615"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1479033695, "creation_date": 1479029047, "last_edit_date": 1479029312, "question_id": 40572348, "link": "https://stackoverflow.com/questions/40572348/curious-case-of-type-of-2-in-haskell", "title": "Curious case of type of 2 in haskell", "body": "<p>What is the rationale behind assigning a general type <code>Num a =&gt; a</code> to <code>2</code> instead of defaulting to some specific type like <code>Int</code> or <code>Integer</code>?</p>\n\n<p>Secondly I have read at many places that <code>2</code> is a polymorphic value but the definition of polymorphism doesn't admit constrained variables. So is <code>2</code> polymorphic in Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 151, "user_id": 2884025, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4bfc932745b9a3341f74ac95fa20eeeb?s=128&d=identicon&r=PG&f=1", "display_name": "RomuloPBenedetti", "link": "https://stackoverflow.com/users/2884025/romulopbenedetti"}, "edited": false, "score": 1, "creation_date": 1479008969, "post_id": 40570208, "comment_id": 68376822, "body": "Please, if downvoting, let me at last know why so I can figure what is wrong, thanks..."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1479012031, "post_id": 40570208, "comment_id": 68377284, "body": "I didn&#39;t downvote, but if I were in an unreasonable mood then I might have due to the code fragment not compiling (needs a few imports, a <code>main</code> for testing)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1479033818, "post_id": 40570208, "comment_id": 68381468, "body": "There appears to be a downvote on a lot of haskell questions lately.  Maybe someone is disgruntled and trying to demoralize the community."}, {"owner": {"reputation": 151, "user_id": 2884025, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4bfc932745b9a3341f74ac95fa20eeeb?s=128&d=identicon&r=PG&f=1", "display_name": "RomuloPBenedetti", "link": "https://stackoverflow.com/users/2884025/romulopbenedetti"}, "edited": false, "score": 0, "creation_date": 1479140141, "post_id": 40570208, "comment_id": 68421834, "body": "Sad, I&#39;m getting some more contact with Haskell after my first contact some years ago, and finding it a beautiful language, somewhat hard, but very beautiful."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1479011951, "post_id": 40570586, "comment_id": 68377268, "body": "The strictness of the pattern matching on the second element of the tuple can cause a lot of confusion.  For example, explicit laziness works <code>where (l,~(ds:ms:as:_)) = (splitOn &quot;&#47;&quot; x, l ++ replicate 20 &quot;NULL&quot;)</code>"}, {"owner": {"reputation": 151, "user_id": 2884025, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4bfc932745b9a3341f74ac95fa20eeeb?s=128&d=identicon&r=PG&f=1", "display_name": "RomuloPBenedetti", "link": "https://stackoverflow.com/users/2884025/romulopbenedetti"}, "edited": false, "score": 0, "creation_date": 1479017416, "post_id": 40570586, "comment_id": 68378166, "body": "After some more search about strictness I believe I finally understood it, I misunderstood haskell as a <code>lazy</code> instead of <code>non-strict</code> language"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 151, "user_id": 2884025, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4bfc932745b9a3341f74ac95fa20eeeb?s=128&d=identicon&r=PG&f=1", "display_name": "RomuloPBenedetti", "link": "https://stackoverflow.com/users/2884025/romulopbenedetti"}, "edited": false, "score": 1, "creation_date": 1479034274, "post_id": 40570586, "comment_id": 68381572, "body": "@RomuloPBenedetti, I&#39;m glad you feel satisfied, but I feel like i need to point out that you probably don&#39;t understand it.  <i>lazy</i> and <i>non-strict</i> mean exactly the same thing as far as what output you will get (there is a <a href=\"http://stackoverflow.com/a/7141537/33796\">subtle distinction</a> which doesn&#39;t matter here).  I think Thomas is right on, this is about the strictness of pattern matches."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1479034688, "post_id": 40570586, "comment_id": 68381678, "body": "You can read a little about lazy pattern matches <a href=\"https://wiki.haskell.org/Lazy_pattern_match\" rel=\"nofollow noreferrer\">here</a> which might help, though I was unable to find an explanation I really liked."}, {"owner": {"reputation": 151, "user_id": 2884025, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4bfc932745b9a3341f74ac95fa20eeeb?s=128&d=identicon&r=PG&f=1", "display_name": "RomuloPBenedetti", "link": "https://stackoverflow.com/users/2884025/romulopbenedetti"}, "edited": false, "score": 0, "creation_date": 1479139790, "post_id": 40570586, "comment_id": 68421612, "body": "Ok confuse, let me see it again...  So Haskell is not purely lazy, only purely non-strict, from outside to inside reduction, but, by what I understood now, non-strict evaluations don&#39;t need to be lazy computationally saying.  Now, the problem, by what I&#39;ve understood <a href=\"https://wiki.haskell.org/Lazy_vs._non-strict\" rel=\"nofollow noreferrer\">here</a>: Is that pattern matching in particular is strict what forces non lazyness, because of some inplications you point on your link? Like avoiding patterns overlapping?"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1479011408, "creation_date": 1479011408, "answer_id": 40570586, "question_id": 40570208, "link": "https://stackoverflow.com/questions/40570208/getting-loop-exception-in-haskell-depending-on-pattern-arrangement/40570586#40570586", "title": "Getting &lt;&lt;loop&gt;&gt; Exception in Haskell Depending on Pattern Arrangement", "body": "<p>In your original, the value of <code>l</code> depends on a tuple that is recursively defined in terms of <code>l</code>. In the change, <code>l</code> depends solely on the value of <code>splitOn \"/\" x</code>.</p>\n"}], "owner": {"reputation": 151, "user_id": 2884025, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4bfc932745b9a3341f74ac95fa20eeeb?s=128&d=identicon&r=PG&f=1", "display_name": "RomuloPBenedetti", "link": "https://stackoverflow.com/users/2884025/romulopbenedetti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 40570586, "answer_count": 1, "score": 1, "last_activity_date": 1479018931, "creation_date": 1479007050, "last_edit_date": 1479018931, "question_id": 40570208, "link": "https://stackoverflow.com/questions/40570208/getting-loop-exception-in-haskell-depending-on-pattern-arrangement", "title": "Getting &lt;&lt;loop&gt;&gt; Exception in Haskell Depending on Pattern Arrangement", "body": "<p>Someone can please explain why I am getting a loop in this code?</p>\n\n<pre><code>module Main where\n\nimport Data.List.Split\nimport Data.Maybe\nimport Text.Read\n\nmain :: IO ()\nmain = print (snd (toInmetDate \"01/02/2012\"))\n\ntype P a = (Bool, a)\n\nreadP :: (Read a) =&gt; String -&gt; P a\nreadP text\n  | isJust value    = (True, fromJust value)\n  | isNothing value = (False, read \"0\")\n  where value = readMaybe text\n\ndata InmetDate = InmetDate {dia :: P Int, mes :: P Int, ano :: P Integer}\n  deriving (Show, Read)\n\ntoInmetDate :: String -&gt; P InmetDate\ntoInmetDate x = if length l == 3\n  then  (True, InmetDate (readP ds) (readP ms) (readP as))\n  else  (False, InmetDate (False, 0) (False, 0) (False, 0))\n  where (l,ds:ms:as:_) = (splitOn \"/\" x, l ++ replicate 20 \"NULL\")\n</code></pre>\n\n<p>I would state that, when I make:</p>\n\n<pre><code>  where (l,ds:ms:as:_) = (splitOn \"/\" x, l ++ replicate 20 \"NULL\")\n</code></pre>\n\n<p>equal to:</p>\n\n<pre><code>  where (ds:ms:as:_) = l ++ replicate 20 \"NULL\"\n        l = splitOn \"/\" x\n</code></pre>\n\n<p>the code work perfectly.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 7, "creation_date": 1478993064, "post_id": 40568787, "comment_id": 68374121, "body": "<code>maximumOdd = maximum . filter odd</code>"}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1478993212, "post_id": 40568787, "comment_id": 68374154, "body": "Note that they also have to change the type constraint from <code>Ord a =&gt; a</code> to <code>Integral a =&gt; a</code>"}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "reply_to_user": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1478993361, "post_id": 40568787, "comment_id": 68374198, "body": "@mnoronha yeah, the presence of <code>odd</code> implies <code>Integral</code> type"}], "answers": [{"comments": [{"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1478995571, "post_id": 40568955, "comment_id": 68374653, "body": "Good for mentioning totality ! There are useful functions in the <code>safe</code> package for this too !"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1479004277, "last_edit_date": 1479004277, "creation_date": 1478994037, "answer_id": 40568955, "question_id": 40568787, "link": "https://stackoverflow.com/questions/40568787/haskell-function-seeking-further-explanation/40568955#40568955", "title": "Haskell function seeking further explanation", "body": "<p>First of all - if you have only even elements in your list you have a problem, as your function is not total (i.e. it produces an error) - so it is best to modify the type of your result to account for that possibility:</p>\n\n<p>Also as others have already mentioned - <code>odd</code> requires your constraint to be <code>Integral</code> instead of <code>Ord</code>.</p>\n\n<pre><code>maximodd :: Integral a =&gt; [a] -&gt; Maybe a\nmaximodd xs = case filter odd xs' of\n                []  -&gt; Nothing\n                xs' -&gt; Just (maximum xs')\n</code></pre>\n\n<p>The function <code>filter odd</code> removes all non-odd elements (i.e. all even numbers) - then we pattern match on the result to account for failure.</p>\n\n<p>If you want to work with your original function then the code gets a lot more tricky:</p>\n\n<pre><code>maximum :: Integral a =&gt; [a] -&gt; a\nmaximum [x] = x\nmaximum (x:xs) = let y = maximum xs\n                 in if x &gt;= y &amp;&amp; odd x\n                      then x\n                      else if x &lt; y &amp;&amp; odd y\n                             then y\n                             else ??\n</code></pre>\n\n<p>hmm - I don't think you can make it work like this - but maybe with a helper function.</p>\n\n<pre><code>maximum :: Integral a =&gt; [a] -&gt; Maybe a\nmaximum xs = maximum' Nothing xs\n  where maximum' Nothing (x:xs) = if odd x\n                                    then maximum' (Just x) xs\n                                    else maximum' Nothing xs\n        maximum' (Just y) (x:xs) = if odd x\n                                     then maximum' (Just $ max x y) xs\n                                     else maximum' (Just y) xs\n        maximum' x _ = x\n</code></pre>\n\n<p>Which is also more complicated - and haskell is definitely not known for being complicated ;)</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1479006036, "creation_date": 1479006036, "answer_id": 40570119, "question_id": 40568787, "link": "https://stackoverflow.com/questions/40568787/haskell-function-seeking-further-explanation/40570119#40570119", "title": "Haskell function seeking further explanation", "body": "<pre><code>maximumOdd :: Integral a =&gt; [a] -&gt; Maybe a\nmaximumOdd = foldl' go Nothing\n  where\n    go Nothing x | odd x = Just x\n    go (Just gr) x | odd x &amp;&amp; x &gt; gr = Just x\n    go acc _ = acc\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 7151331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4008e969222bf3bad3e5a12400a152c5?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Moore", "link": "https://stackoverflow.com/users/7151331/tom-moore"}, "edited": false, "score": 0, "creation_date": 1479078071, "post_id": 40571423, "comment_id": 68395225, "body": "Thank you very much for this in depth explanation! I think after reading through this I have a better understanding of what is suppose to happen. Thank you!"}], "tags": [], "owner": {"reputation": 319, "user_id": 5556960, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8461c69f2ceeed1b54eb5c5ae3dd275e?s=128&d=identicon&r=PG&f=1", "display_name": "MarLinn", "link": "https://stackoverflow.com/users/5556960/marlinn"}, "is_accepted": false, "score": 1, "last_activity_date": 1479031198, "last_edit_date": 1479031198, "creation_date": 1479020769, "answer_id": 40571423, "question_id": 40568787, "link": "https://stackoverflow.com/questions/40568787/haskell-function-seeking-further-explanation/40571423#40571423", "title": "Haskell function seeking further explanation", "body": "<p>There are several options which all teach you something about the language.\nFirst of all, there's the issue with totality that <em>epsilonhalbe</em> mentioned. For now, I will just have the code throw an error.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>maximumOddError :: a\nmaximumOddError = error \"maximumOdd: list contains no odd element\"\n</code></pre>\n\n<p>The most important complication is that when you start you don't know if there will be any odd numbers at all. So you either have to defer that test (we'll come to that) or filter and check in one go.</p>\n\n<h1>Option 1: Tail recursion</h1>\n\n<p>The simplest solution is to do both checks in one. In general this is also a nice optimization technique. For now, it separates error handling and iteration.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>maximumOdd :: (Integral a) =&gt; [a] -&gt; a\nmaximumOdd ls = case dropWhile even ls of\n                  []   -&gt; maximumOddError\n                  n:ns -&gt; findOddMax n ns -- n is definitely odd\n  where\n    findOddMax currentMax [] = currentMax\n    findOddMax currentMax (x:xs)\n        | even x         = findOddMax currentMax xs\n        | x &lt; currentMax = findOddMax currentMax xs\n        | otherwise      = findOddMax x          xs\n</code></pre>\n\n<h1>Option 2: Sort</h1>\n\n<p>Instead of looking at every piece, you could also take a high-level perspective. Why search, when you could instead just sort the list and have the element you search be presented at one end? Of course you must still filter, so basically what you want is something like <code>last . sort . filter odd</code>. But <code>last</code> is another traversal, so it's better to sort the list in descending order:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>import Data.List ( sortBy )\n\nmaximumOdd :: (Integral a) =&gt; [a] -&gt; a\nmaximumOdd = head . sortBy reverseOrder . filter odd\n  where\n    reverseOrder a b = compare b a\n</code></pre>\n\n<p>Note that <code>head</code> will fail on empty lists. So the error handling isn't as nice. But it should be easy to add. What's the performance compared to a simple <code>maximum . filter odd</code>? You tell me!</p>\n\n<h1>Option 3: Tail recursion with nice error handling</h1>\n\n<p>Now let's add some better error handling via <code>Maybe</code>. The easiest version to do that is the tail recursive one, as we separated error handling and iteration.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>maximumOdd :: (Integral a) =&gt; [a] -&gt; Maybe a\nmaximumOdd ls = case dropWhile even ls of\n                  []   -&gt; Nothing\n                  n:ns -&gt; Just $ findOddMax n ns -- n is definitely odd\n  where\n    findOddMax \u2026 -- same as above\n</code></pre>\n\n<p>This is very much the same method as <em>dfeuer</em>'s. He just used more existing functions to make it shorter and even more efficient, and he integrated error handling into the recursion. That is what most experienced Haskell programmers will do. (You could argue about performance costs of wrapping and unwrapping, but eh. Do that when you need it.)</p>\n\n<h1>Option 4: Sort with nice error handling</h1>\n\n<p>This one is easy as well, because there's a nice version of <code>head</code> that does exactly what we need.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>import Data.Maybe ( listToMaybe )\n\nmaximumOdd :: (Integral a) =&gt; [a] -&gt; Maybe a\nmaximumOdd = listToMaybe . sortBy reverseOrder . filter odd\n  where\n    reverseOrder a b = compare b a\n</code></pre>\n\n<h1>Option 5: Direct traversal with nice error handling</h1>\n\n<p>Finally, we're back to the initial approach. But <code>Maybe</code> now allows us to defer error checking. The thing is: You need to know some special tools, or you must invent them. I'll just use the existing ones.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>import Control.Applicative ( (&lt;|&gt;) )\n\nmaximumOdd :: (Integral a) =&gt; [a] -&gt; Maybe a\nmaximumOdd []                 = Nothing\nmaximumOdd [x]    | even x    = Nothing\n                  | otherwise = Just x\nmaximumOdd (x:xs) | even x    =           maximumOdd xs\n                  | otherwise = max x &lt;$&gt; maximumOdd xs -- either \"max x\" applied inside the Maybe-construct\n                                &lt;|&gt; Just x              -- or x, if that produced an error\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 7151331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4008e969222bf3bad3e5a12400a152c5?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Moore", "link": "https://stackoverflow.com/users/7151331/tom-moore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1479031198, "creation_date": 1478992694, "last_edit_date": 1478993029, "question_id": 40568787, "link": "https://stackoverflow.com/questions/40568787/haskell-function-seeking-further-explanation", "title": "Haskell function seeking further explanation", "body": "<p>I've been trying to create a haskell function which gets the largest odd integer in a list. Sounds easy, and I sure thought I could do it but it looks like I'm stuck! Here is my code, so far it returns the largest number in the list including both odd and even numbers:</p>\n\n<pre><code>maximum :: (Ord a) =&gt; [a] -&gt; a  \nmaximum [x] = x  \nmaximum (x:xs) = max x (maximum xs)\n</code></pre>\n\n<p>Thank you in advance for your help!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1479033446, "post_id": 40568516, "comment_id": 68381379, "body": "I assume the (&quot;z&quot;,&quot;5&quot;) was a misprint, because none of the other numbers have quotes."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 7062034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eed4bf80c5af01d541658ffc5ab451d?s=128&d=identicon&r=PG&f=1", "display_name": "Sarah.S", "link": "https://stackoverflow.com/users/7062034/sarah-s"}, "edited": false, "score": 0, "creation_date": 1478991414, "post_id": 40568604, "comment_id": 68373783, "body": "For this function let&#39;s assume that there is only one matching tuple, and only two of the tuples have &quot;x&quot;"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 23, "user_id": 7062034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eed4bf80c5af01d541658ffc5ab451d?s=128&d=identicon&r=PG&f=1", "display_name": "Sarah.S", "link": "https://stackoverflow.com/users/7062034/sarah-s"}, "edited": false, "score": 0, "creation_date": 1479032826, "post_id": 40568604, "comment_id": 68381218, "body": "@Sarah.S: Then use pattern matching to convert from the list of results to the three-element tuple you want."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 2, "last_activity_date": 1479040888, "last_edit_date": 1479040888, "creation_date": 1478991274, "answer_id": 40568604, "question_id": 40568516, "link": "https://stackoverflow.com/questions/40568516/tuple-evaluation/40568604#40568604", "title": "Tuple evaluation", "body": "<p>What if there are three or four tuples with \"x\"? You can't have variable-length tuples. Maybe you want to return a list:</p>\n\n<pre><code>match :: [(String, a)] -&gt; Maybe (String, [a])\n</code></pre>\n\n<p>What if there are several tuples that match? Do you want them all, or just the first? If you want them all then you should return a list of matches.</p>\n\n<pre><code>match :: [(String, a)] -&gt; [(String, [a])]\n</code></pre>\n\n<p>If you think of it like this, then you can see that grouping all the \"x\" pairs together, and \"y\" pairs, and so on, would be a good start. You can do this by using</p>\n\n<pre><code>sortBy (comparing fst) xs\n</code></pre>\n\n<p><code>comparing</code> takes a function and two values, applies the function to each, and compares the results. <code>sortBy</code> uses its first argument as a comparison function, so <code>sortBy (comparing fst)</code> sorts your list into order by the first element in each tuple.</p>\n\n<p>Then you can use <code>groupBy</code> to collect the elements together.</p>\n\n<p>Edit:</p>\n\n<p><code>groupBy</code> has the type </p>\n\n<pre><code>groupBy :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>So you need to write a function <code>equalFirst</code> to give it as a parameter. So then </p>\n\n<pre><code>groupBy equalFirst $ sortBy (comparing fst) xs\n</code></pre>\n\n<p>will give you</p>\n\n<pre><code>[[(\"x\", 3), (\"x\", 6)], [(\"y\", 4)], [(\"z\", 5)]]\n</code></pre>\n\n<p>Which is a list of lists. Each sub-list contains tuples with the same letter.</p>\n\n<p>Now you can write a function which takes one of these sublists and converts it into the result you want. Then apply it to the list of lists using <code>map</code>.</p>\n"}], "owner": {"reputation": 23, "user_id": 7062034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eed4bf80c5af01d541658ffc5ab451d?s=128&d=identicon&r=PG&f=1", "display_name": "Sarah.S", "link": "https://stackoverflow.com/users/7062034/sarah-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1479047420, "creation_date": 1478990644, "last_edit_date": 1479047420, "question_id": 40568516, "link": "https://stackoverflow.com/questions/40568516/tuple-evaluation", "title": "Tuple evaluation", "body": "<p>I'm writing a function of the following type:</p>\n\n<pre><code>match :: [(String,a)] -&gt; Maybe (String, a, a)\n</code></pre>\n\n<p>I want the function to traverse the list of tuples, and determine if there are any tuples in which the first element (a string) is the same. If so, I want to return a tuple containing that string, as well as the second element in each of those matching tuples. If there are no matching tuples, return \"Nothing\". If there is more than one matching, return the first one it finds.</p>\n\n<p>For example:</p>\n\n<pre><code>match [(\"x\", 3), (\"y\", 4), (\"z\", \"5\"), (\"x\", 6)] = (\"x\", 3, 6)\nmatch [(\"x\", 3), (\"y\", 4), (\"z\", \"5\")] = Nothing\n</code></pre>\n\n<p>I'm thinking:</p>\n\n<pre><code>match (x:xs) = if (fst x) = (fst xs) return (fst x, snd x, snd xs)\n--if no matches, return Nothing\n</code></pre>\n\n<p>Thank you for any help!</p>\n"}, {"tags": ["haskell", "gtk2hs"], "comments": [{"owner": {"reputation": 532, "user_id": 660339, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ba401042a68ed65c16f73c8cf3a15287?s=128&d=identicon&r=PG", "display_name": "Ivan Perez", "link": "https://stackoverflow.com/users/660339/ivan-perez"}, "edited": false, "score": 0, "creation_date": 1479110970, "post_id": 40567598, "comment_id": 68403734, "body": "Looking at the API, and based on this commit by Duncan Coutts (<a href=\"https://sourceforge.net/p/gtk2hs/mailman/gtk2hs-commit/?viewmonth=200407\" rel=\"nofollow noreferrer\">sourceforge.net/p/gtk2hs/mailman/gtk2hs-commit/&hellip;</a>), that function is not exported by gtk2hs.  Unless you find a workaround, I&#39;d suggest emailing the gtk2hs mailing list, and/or implementing the function in haskell yourself (using Haskell&#39;s FFI to rely on the existing implementation in C; see <a href=\"https://hackage.haskell.org/package/gtk3-0.14.6/docs/src/Graphics-UI-Gtk-ModelView-CellRenderer.html#cellRendererStopEditing\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/gtk3-0.14.6/docs/src/&hellip;</a> and the bottom of that file)."}], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1478984399, "creation_date": 1478984399, "question_id": 40567598, "link": "https://stackoverflow.com/questions/40567598/how-do-i-render-a-cellrenderer-to-a-cairo-drawable", "title": "How do I render a CellRenderer to a Cairo Drawable?", "body": "<p>The documentation for gtk2hs <a href=\"https://hackage.haskell.org/package/gtk3-0.14.6/docs/Graphics-UI-Gtk-ModelView-CellRenderer.html\" rel=\"nofollow noreferrer\">CellRenderer</a> says:</p>\n\n<blockquote>\n  <p>The primary use of a CellRenderer is for drawing a certain graphical\n  elements on a Drawable</p>\n</blockquote>\n\n<p>Looking at the <a href=\"https://lazka.github.io/pgi-docs/Gtk-3.0/classes/CellRenderer.html\" rel=\"nofollow noreferrer\">corresponding page</a> for GTK+ I see it has a function</p>\n\n<blockquote>\n  <p>render(cr, widget, background_area, cell_area, flags)</p>\n</blockquote>\n\n<p>which invokes the virtual render function. However I can't find anything like that in gtk2hs.</p>\n\n<p>So how do I get a CellRenderer onto a Cairo Drawable in gtk2hs?</p>\n"}, {"tags": ["mongodb", "haskell", "haskell-persistent"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1478982909, "post_id": 40567352, "comment_id": 68371426, "body": "Servant does not have <i>anything</i> to do with how you retrieve data from your database, it only handles RESTful HTTP transport. A better question would be asking this and providing information about the type database you are using and the way you are accessing that database in Haskell, but servant is not relevant to that."}, {"owner": {"reputation": 595, "user_id": 3334477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6WWr4.jpg?s=128&g=1", "display_name": "maillard", "link": "https://stackoverflow.com/users/3334477/maillard"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1478982993, "post_id": 40567352, "comment_id": 68371446, "body": "Oh, right, i&#39;m mixing up things here. Will update the question"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1478984176, "post_id": 40567352, "comment_id": 68371765, "body": "As far as I know, at least for SQL, there is no particular efficient way of selecting a random entry from a table, so I don\u2019t expect the bindings to provide one."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1478985951, "post_id": 40567352, "comment_id": 68372255, "body": "For selecting one (or more) rows at random from a table: <a href=\"http://stackoverflow.com/q/19412/1126841\">stackoverflow.com/q/19412/1126841</a>. Spoiler: you want some variation on <code>select ... order by random() limit &lt;n&gt;</code>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1478986796, "post_id": 40567352, "comment_id": 68372453, "body": "Use persistent&#39;s rawSql function and use chepner&#39;s solution from the above to achieve what you want."}, {"owner": {"reputation": 1779, "user_id": 411161, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/xddHC.jpg?s=128&g=1", "display_name": "Daniele Tassone", "link": "https://stackoverflow.com/users/411161/daniele-tassone"}, "edited": false, "score": 0, "creation_date": 1478986979, "post_id": 40567352, "comment_id": 68372491, "body": "<a href=\"https://docs.mongodb.com/v3.2/reference/operator/aggregation/sample/\" rel=\"nofollow noreferrer\">docs.mongodb.com/v3.2/reference/operator/aggregation/sample</a>"}, {"owner": {"reputation": 18287, "user_id": 1029453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/x570w.jpg?s=128&g=1", "display_name": "Richard Huxton", "link": "https://stackoverflow.com/users/1029453/richard-huxton"}, "edited": false, "score": 0, "creation_date": 1478991438, "post_id": 40567352, "comment_id": 68373788, "body": "Better than the &quot;order by random&quot; is to use TABLESAMPLE with SQL if it is supported (<a href=\"https://www.postgresql.org/docs/current/static/sql-select.html#SQL-FROM\" rel=\"nofollow noreferrer\">postgresql.org/docs/current/static/sql-select.html#SQL-FROM</a>&zwnj;&#8203;)"}], "owner": {"reputation": 595, "user_id": 3334477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6WWr4.jpg?s=128&g=1", "display_name": "maillard", "link": "https://stackoverflow.com/users/3334477/maillard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1478983515, "creation_date": 1478982775, "last_edit_date": 1478983515, "question_id": 40567352, "link": "https://stackoverflow.com/questions/40567352/persistent-how-can-i-get-a-random-record-from-the-database", "title": "Persistent: How can I get a random record from the database", "body": "<p>I want to use persistent to fetch a number of records from the database, selected randomly.</p>\n\n<p>My first idea was to have an auto-incremented id field on the model, and fetch records by id. But I quickly concluded that this is probably not a good idea. If for instance some records are deleted, there will be gaps. (in my scenario the data will be more or less static, but it's still vulnerable)</p>\n\n<p>For now the plan is to use mongodb, but this may change, I'm just researching now, the project hasn't started yet.</p>\n\n<p>Some databases have native functions for selecting random records, does persistent support this? Or is there another way to accomplish the same?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1478980374, "post_id": 40566940, "comment_id": 68370668, "body": "What is <code>S</code>? And how is this not <i>exactly</i> the same as <code>lookup</code>?"}, {"owner": {"reputation": 23, "user_id": 7062034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eed4bf80c5af01d541658ffc5ab451d?s=128&d=identicon&r=PG&f=1", "display_name": "Sarah.S", "link": "https://stackoverflow.com/users/7062034/sarah-s"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1478981444, "post_id": 40566940, "comment_id": 68371014, "body": "I deleted that S, apologies, it was from an incorrectly attempted code. Because lookup returns &quot;Just x&quot; rather than &quot;x&quot;."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1478981611, "post_id": 40566940, "comment_id": 68371063, "body": "Yes, but if the return type is <code>Maybe b</code> then you <i>can</i> only return <code>Just x</code>. By itself, <code>x</code> has the wrong type (<code>b</code>, not <code>Maybe b</code>)."}, {"owner": {"reputation": 23, "user_id": 7062034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eed4bf80c5af01d541658ffc5ab451d?s=128&d=identicon&r=PG&f=1", "display_name": "Sarah.S", "link": "https://stackoverflow.com/users/7062034/sarah-s"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1478981943, "post_id": 40566940, "comment_id": 68371165, "body": "Ah okay I understand! Thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1478980323, "post_id": 40566978, "comment_id": 68370649, "body": "I think the OP wanted help understanding why her code wasn&#39;t working, not the solution. If it was the latter, she could&#39;ve looked up the definition of <code>lookup</code> herself."}, {"owner": {"reputation": 23, "user_id": 7062034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eed4bf80c5af01d541658ffc5ab451d?s=128&d=identicon&r=PG&f=1", "display_name": "Sarah.S", "link": "https://stackoverflow.com/users/7062034/sarah-s"}, "edited": false, "score": 0, "creation_date": 1478980588, "post_id": 40566978, "comment_id": 68370739, "body": "No I do want to know how to make this code work. I want to write this function called &quot;search&quot;, not just use the lookup function. I just know that it functions similar to the lookup function"}, {"owner": {"reputation": 682, "user_id": 4088416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1719bb302e6c3d5a78148083e73b7fc1?s=128&d=identicon&r=PG", "display_name": "Jos&#233; Antonio Riaza Valverde", "link": "https://stackoverflow.com/users/4088416/jos%c3%a9-antonio-riaza-valverde"}, "edited": false, "score": 0, "creation_date": 1478983270, "post_id": 40566978, "comment_id": 68371518, "body": "Haskell has some basic unsafe functions (like <code>head</code>). If the OP want to remove <code>Just</code> context, that is the simplest way to do it."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1478984588, "post_id": 40566978, "comment_id": 68371887, "body": "&quot;Haskell has some basic unsafe functions&quot; -- That doesn&#39;t make it a good idea to create even more of them. In particular, <code>head</code> and <code>tail</code>  should be flat-out avoided, specially by beginners -- using them is almost always a bad idea."}, {"owner": {"reputation": 682, "user_id": 4088416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1719bb302e6c3d5a78148083e73b7fc1?s=128&d=identicon&r=PG", "display_name": "Jos&#233; Antonio Riaza Valverde", "link": "https://stackoverflow.com/users/4088416/jos%c3%a9-antonio-riaza-valverde"}, "edited": false, "score": 0, "creation_date": 1478985851, "post_id": 40566978, "comment_id": 68372228, "body": "It depends on the use context of the function. Perhaps the OP is certain that the key is in the list. Otherwise, of course, a safe version is better."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478988180, "post_id": 40566978, "comment_id": 68372866, "body": "&quot;Perhaps the OP is certain that the key is in the list&quot; -- In such cases (i.e. if the absence of the key is a bug) it is better to either throw the error at usage point (<code>fromMaybe (error &quot;x key missing from degarbling list -- this is a bug&quot;)</code>) or to use <a href=\"https://www.stackage.org/haddock/lts-7.8/safe-0.3.9/Safe.html#v:lookupJustNote\" rel=\"nofollow noreferrer\"><code>lookupJustNote</code></a> from <i>safe</i>. That way at least you get an informative error message."}], "tags": [], "owner": {"reputation": 682, "user_id": 4088416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1719bb302e6c3d5a78148083e73b7fc1?s=128&d=identicon&r=PG", "display_name": "Jos&#233; Antonio Riaza Valverde", "link": "https://stackoverflow.com/users/4088416/jos%c3%a9-antonio-riaza-valverde"}, "is_accepted": false, "score": 1, "last_activity_date": 1479037984, "last_edit_date": 1479037984, "creation_date": 1478980266, "answer_id": 40566978, "question_id": 40566940, "link": "https://stackoverflow.com/questions/40566940/searching-through-list-of-tuples/40566978#40566978", "title": "Searching through list of tuples", "body": "<p>In the base case, if list is empty, it returns <code>Nothing</code>. Then, if first element <code>a</code> of tuple in the head is equal to element <code>x</code>, it returns second element <code>Just b</code>. Else, recursively, it searchs in the tail.</p>\n\n<pre><code>search :: (Eq a) =&gt; a -&gt; [(a,b)] -&gt; Maybe b\nsearch _ [] = Nothing\nsearch x ((a,b):xs) = if x == a then Just b else search x xs\n</code></pre>\n\n<p>You can implement an unsafe version without <code>Maybe</code>:</p>\n\n<pre><code>search :: (Eq a) =&gt; a -&gt; [(a,b)] -&gt; b\nsearch _ [] = error \"element not found\"\nsearch x ((a,b):xs) = if x == a then b else search x xs\n</code></pre>\n\n<p>Other option is searching a list instead of first ocurrence, then, empty list <code>[]</code> is equivalent to <code>Nothing</code>:</p>\n\n<pre><code>search :: (Eq a) =&gt; a -&gt; [(a,b)] -&gt; [b]\nsearch x = map snd . filter ((==x).fst)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1478982889, "last_edit_date": 1478982889, "creation_date": 1478981765, "answer_id": 40567204, "question_id": 40566940, "link": "https://stackoverflow.com/questions/40566940/searching-through-list-of-tuples/40567204#40567204", "title": "Searching through list of tuples", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:find\" rel=\"nofollow noreferrer\"><code>find</code></a> can retrieve the first element satisfying an arbitrary condition, and so you might build your function around it:</p>\n\n<pre><code>-- 'fmap snd' acts on the 'Maybe (a, b)' that 'find' gives back.\nsearch :: Eq a =&gt; a -&gt; [(a,b)] -&gt; Maybe b\nsearch a = fmap snd . find ((== a) . fst)\n</code></pre>\n\n<p>Note that this is exactly the same as <code>lookup</code>. Also, as leftaroundabout points out, <code>3</code> (as opposed to <code>Just 3</code>) is not a possible result for a function with a <code>Maybe b</code> result type. You can eliminate the <code>Maybe</code> wrapping when you actually need to use the result using, for instance, the <code>maybe</code> function:</p>\n\n<pre><code>GHCi&gt; :t maybe\nmaybe :: b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b\nGHCi&gt; (maybe \"No x\" ((\"x ~&gt; \" ++) . show) . search \"x\") ([(\"x\", 3), (\"z\", 5)])\n\"x ~&gt; 3\"\nGHCi&gt; (maybe \"No x\" ((\"x ~&gt; \" ++) . show) . search \"x\") ([(\"y\", 3), (\"z\", 5)])\n\"No x\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478988534, "post_id": 40568107, "comment_id": 68372966, "body": "(1) <code>(Eq a) =&gt; a -&gt; [(a, b)] -&gt; [Maybe b]</code> will work fine -- in your implementation, only <code>x</code> needs to have the same type of <code>a</code>. (2) This gives a list of <code>Maybe a</code>, while the OP only wants the first <code>Just</code>-value in the list. You need something like <code>listToMaybe . catMaybes</code> (both are in <code>Data.Maybe</code>) to perform this final step."}], "tags": [], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "is_accepted": false, "score": 0, "last_activity_date": 1478989703, "last_edit_date": 1478989703, "creation_date": 1478987926, "answer_id": 40568107, "question_id": 40566940, "link": "https://stackoverflow.com/questions/40566940/searching-through-list-of-tuples/40568107#40568107", "title": "Searching through list of tuples", "body": "<p>Just use a simple map combined with a lambda: </p>\n\n<pre><code>searchMe :: (Eq a) =&gt; a -&gt; [(a, b)] -&gt; [Maybe b]\nsearchMe a li = map (\\(x, y) -&gt; if a == x then Just y else Nothing ) li\n</code></pre>\n\n<p>OP your function, as it is, won't work as you are defining your list parameter as (x : xs), which won't enable you to apply operations to elements of the tuple.</p>\n"}], "owner": {"reputation": 23, "user_id": 7062034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eed4bf80c5af01d541658ffc5ab451d?s=128&d=identicon&r=PG&f=1", "display_name": "Sarah.S", "link": "https://stackoverflow.com/users/7062034/sarah-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4485, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1479037984, "creation_date": 1478979971, "last_edit_date": 1478992583, "question_id": 40566940, "link": "https://stackoverflow.com/questions/40566940/searching-through-list-of-tuples", "title": "Searching through list of tuples", "body": "<p>I'm trying to write a function that accepts a string and a list of tuple pairs. I want to search through the list of tuples, and if the first value in the tuple matches the input string, I want to return the second value in the pair. I believe it functions similar to the <a href=\"http://hackage.haskell.org/package/base/docs/Data-List.html#v:lookup\" rel=\"nofollow noreferrer\"><code>lookup</code></a> function, but I'm not sure how to implement it. Here is my thinking so far:</p>\n\n<pre><code>search :: a -&gt; [(a,b)] -&gt; Maybe b\nsearch a (x:xs) = if a == first value in x, return second value in x\n-- If a is not in the list of tuples, return \"Nothing\"\n</code></pre>\n\n<p>An example of this would be:</p>\n\n<pre><code>search \"x\" ([(\"x\", 3), (\"z\", 5)]) = 3\nsearch \"x\" ([(\"y\", 3), (\"z\", 5)]) = Nothing\n</code></pre>\n"}, {"tags": ["java", "haskell"], "comments": [{"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1479000047, "post_id": 40566508, "comment_id": 68375480, "body": "I&#39;m not quite sure what your goal is with this, but I think you are mistaking the purpose of <code>World</code>, and this isn&#39;t the best way of thinking about the <code>IO</code> monad.  Either way, your definition of <code>World</code> implies that &quot;transforms&quot; can add to the input and remove from the output, which is probably undesired behavior."}, {"owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "reply_to_user": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1479006681, "post_id": 40566508, "comment_id": 68376464, "body": "The goal is to introduce Haskell to java developers. I think pure IO is Haskell coolest concept so I am just making a simple model of IO. I agree though the stdin list should be readonly."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1479085530, "post_id": 40566508, "comment_id": 68396826, "body": "I&#39;m not a Java developer, but I don&#39;t see how something so hairy could be a good way to introduce Haskell&#39;s <code>IO</code> type. For that, I would suggest an &quot;operational monad&quot; approach, where <code>IO a</code> is viewed as a data structure made of primitive commands and continuations."}, {"owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "edited": false, "score": 0, "creation_date": 1479088060, "post_id": 40566508, "comment_id": 68397320, "body": "Why do you think this is hairy?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1479094694, "post_id": 40566508, "comment_id": 68398784, "body": "Well, the biggest problem is that it imitates GHC&#39;s conceptually broken internal model of I/O. The world isn&#39;t really a value you can pass around. An operational monad at least doesn&#39;t lie--it leaves the interpretation open."}, {"owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "edited": false, "score": 0, "creation_date": 1602907800, "post_id": 40566508, "comment_id": 113875104, "body": "Related: <a href=\"https://stackoverflow.com/questions/6647852/haskell-actual-io-monad-implementation-in-different-language\" title=\"haskell actual io monad implementation in different language\">stackoverflow.com/questions/6647852/&hellip;</a> ."}], "answers": [{"comments": [{"owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "edited": false, "score": 0, "creation_date": 1478985483, "post_id": 40566657, "comment_id": 68372120, "body": "Ah I tried that but I didnt make the methods static, Thanks!"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1478999873, "post_id": 40566657, "comment_id": 68375454, "body": "It would be fine, and arguably nicer, to leave <code>bind</code> as a non-static method and just remove the first argument and replace it with <code>this</code>."}, {"owner": {"reputation": 18168, "user_id": 47552, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/20c0f42cfd92cb56a020ef5bce95621d?s=128&d=identicon&r=PG", "display_name": "Matt McHenry", "link": "https://stackoverflow.com/users/47552/matt-mchenry"}, "reply_to_user": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 0, "creation_date": 1480562858, "post_id": 40566657, "comment_id": 69017686, "body": "@DerekElkins you&#39;re probably right, but for now I&#39;ve just added a disclaimer.  I think there are more issues than just that ..."}], "tags": [], "owner": {"reputation": 18168, "user_id": 47552, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/20c0f42cfd92cb56a020ef5bce95621d?s=128&d=identicon&r=PG", "display_name": "Matt McHenry", "link": "https://stackoverflow.com/users/47552/matt-mchenry"}, "is_accepted": false, "score": 4, "last_activity_date": 1480562813, "last_edit_date": 1480562813, "creation_date": 1478978077, "answer_id": 40566657, "question_id": 40566508, "link": "https://stackoverflow.com/questions/40566508/how-do-you-implement-haskells-io-type-in-java/40566657#40566657", "title": "How do you implement Haskell&#39;s IO type in Java?", "body": "<p>Leaving aside the fidelity of your approach to replicating Haskell's IO type in Java:</p>\n\n<p>The compiler thinks that the <code>A</code> in your <code>bind</code> method's signature is the same as the <code>A</code> in the class definition.  You've told us it's not in words.  In order to communicate that to the compiler, you need to make things static and introduce a couple of method-level type parameters:</p>\n\n<pre><code>import java.util.function.*;\nimport java.util.ArrayList;\npublic class IO&lt;A&gt; {\n    private Function&lt;World,Tuple&lt;World,A&gt;&gt; transform;\n    private static class World {\n        private ArrayList&lt;String&gt; stdin;\n        private ArrayList&lt;String&gt; stdout;\n        public World() {\n            this.stdin  = new ArrayList&lt;String&gt;();\n            this.stdout = new ArrayList&lt;String&gt;();\n        }\n    }\n    private static class Tuple&lt;F,S&gt; {\n        public F fst;\n        public S snd;\n        public Tuple(F fst, S snd) {\n            this.fst = fst;\n            this.snd = snd;\n        }\n    }\n    private IO(Function&lt;World,Tuple&lt;World,A&gt;&gt; transform) {\n        this.transform = transform;\n    }\n    public static &lt;A&gt; IO&lt;A&gt; pure(A a) {\n        return new IO&lt;A&gt;(r -&gt; new Tuple&lt;World,A&gt;(r,a));\n    }\n    public static &lt;A,B&gt; IO&lt;B&gt; bind(IO&lt;A&gt; io, Function&lt;A,IO&lt;B&gt;&gt; f) {\n        return new IO&lt;B&gt;(r -&gt; {\n            Tuple&lt;World,A&gt; result = io.transform.apply(r);\n            IO&lt;B&gt; ioB = f.apply(result.snd);\n            return ioB.transform.apply(result.fst);\n        });\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "edited": false, "score": 0, "creation_date": 1479181762, "post_id": 40581723, "comment_id": 68438609, "body": "I&#39;m unclear how to translate the GADTs into java data types but this is a much better solution."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "edited": false, "score": 0, "creation_date": 1479186238, "post_id": 40581723, "comment_id": 68439819, "body": "@KyleMcKean, I&#39;ve added a translation to Java, with some caveats."}, {"owner": {"reputation": 3248, "user_id": 1262542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7cf2d499caed8b2c28ccc311ddffaeb?s=128&d=identicon&r=PG", "display_name": "Stefan Hanke", "link": "https://stackoverflow.com/users/1262542/stefan-hanke"}, "edited": false, "score": 0, "creation_date": 1479188012, "post_id": 40581723, "comment_id": 68440385, "body": "Some notes from another non-Java guy: There&#39;s a duplicate import statement. OpenBind could be a static nested class to limit its visibility. Please provide an example of how this would be used."}, {"owner": {"reputation": 3248, "user_id": 1262542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7cf2d499caed8b2c28ccc311ddffaeb?s=128&d=identicon&r=PG", "display_name": "Stefan Hanke", "link": "https://stackoverflow.com/users/1262542/stefan-hanke"}, "edited": false, "score": 0, "creation_date": 1479188585, "post_id": 40581723, "comment_id": 68440608, "body": "Addendum: <a href=\"http://stackoverflow.com/questions/643906/uses-for-the-java-void-reference-type\">There is a <code>Void</code> type in Java</a>. I can&#39;t help but notice that this reminds me of a list where each element can have a different type (<code>IO&lt;X&gt;</code>, where <code>X \u2208 {Unit, String}</code>)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3248, "user_id": 1262542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7cf2d499caed8b2c28ccc311ddffaeb?s=128&d=identicon&r=PG", "display_name": "Stefan Hanke", "link": "https://stackoverflow.com/users/1262542/stefan-hanke"}, "edited": false, "score": 0, "creation_date": 1479189055, "post_id": 40581723, "comment_id": 68440777, "body": "@StefanHanke, thanks. I used your static nested class approach. The <code>Void</code> type isn&#39;t appropriate here because it can&#39;t be instantiated. What I want is a value I can actually create (and pass to a function) but that is extremely boring. In Haskell this type is called <code>()</code>; in a number of other functional languages it is called <code>Unit</code>. Usage is pretty simple: you build an instance of a class implementing <code>IO</code>, and then to demonstrate that it represents something meaningful you call its <code>run</code> method."}, {"owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "edited": false, "score": 0, "creation_date": 1479266177, "post_id": 40581723, "comment_id": 68480872, "body": "Are wildcards in java typesafe? Are they the same as existentials?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "edited": false, "score": 0, "creation_date": 1479268578, "post_id": 40581723, "comment_id": 68481429, "body": "@KyleMcKean, they are typesafe, yes. I&#39;m no Java expert and no type system expert, so I can&#39;t say if they&#39;re exactly the same as existentials, but it appears that a plain <code>?</code> (without any super/subclass constraints) means an arbitrary class. Note that we only <i>use</i> the fact that <code>start</code> and <code>cont</code> have matching types inside the <code>OpenBind</code> class, which is precisely where we can <i>see</i> that they do. If <code>start</code> and <code>cont</code> were public, and we accessed them from <code>Bind</code>, we&#39;d come up with an <code>IO &lt;?&gt;</code> and a <code>Function &lt;?, IO &lt;A&gt;&gt;</code>, neither of which would be any use without reflection."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1479268663, "post_id": 40581723, "comment_id": 68481450, "body": "But within <code>OpenBind</code>, they have types <code>IO &lt;Fst&gt;</code> and <code>Function &lt;Fst, IO &lt;Snd&gt;&gt;</code>, which we know perfectly well what to do with."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1479188759, "last_edit_date": 1479188759, "creation_date": 1479096246, "answer_id": 40581723, "question_id": 40566508, "link": "https://stackoverflow.com/questions/40566508/how-do-you-implement-haskells-io-type-in-java/40581723#40581723", "title": "How do you implement Haskell&#39;s IO type in Java?", "body": "<p>I think an \"operational monad\" approach is better for explaining the essence of Haskell I/O. The Haskell version can be quite simple:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data PrimOp a where\n  PutStr :: String -&gt; PrimOp ()\n  GetLine :: PrimOp String\n  -- Whatever other primitives you want\n\ndata MyIO a where\n  Pure :: a -&gt; MyIO a\n  Bind :: !(MyIO a) -&gt; (a -&gt; MyIO b) -&gt; MyIO b\n  LiftPrim :: !(PrimOp a) -&gt; MyIO a\n\ninstance Functor MyIO where\n  fmap = liftM\n\ninstance Applicative MyIO where\n  pure = Pure\n  (&lt;*&gt;) = ap\n\ninstance Monad MyIO where\n  (&gt;&gt;=) = Bind\n</code></pre>\n\n<p>The <code>MyIO</code> values aren't some magical world-passing functions; they're just plain data. We can interpret the data to actually perform the action represented if we so desire:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>runPrimOp :: PrimOp a -&gt; IO a\nrunPrimOp (PutStr s) = putStr s\nrunPrimOp GetLine = getLine\n\nrunMyIO :: MyIO a -&gt; IO a\nrunMyIO (Pure a) = pure a\nrunMyIO (Bind m f) = runMyIO m &gt;&gt;= runMyIO . f\nrunMyIO (LiftPrim prim) = runPrimOp prim\n</code></pre>\n\n<p>It would actually be possible to write a Haskell compiler whose <code>IO</code> type looks a lot like <code>MyIO</code>, and whose runtime system interprets values of that type directly.</p>\n\n<hr>\n\n<p>I have attempted a translation to Java below. I've never really been a Java programmer, and it's been a long time since I used it at all, so this may be terribly unidiomatic or even wrong. I imagine you'd probably want to use some version of the \"visitor pattern\" to represent interpretations of <code>Bind</code> and <code>Pure</code> (bringing things into the realm of something general like <a href=\"https://hackage.haskell.org/package/operational/docs/Control-Monad-Operational.html\" rel=\"nofollow noreferrer\"><code>Control.Monad.Operational</code></a>), while using a <code>run</code> method for a <code>PrimOp</code> subclass of <code>IO</code>. Since I don't really know the right Java way I've tried to just keep it simple.</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>public interface IO &lt;A&gt; {\n  public A run ();\n}\n\npublic final class Pure &lt;A&gt; implements IO &lt;A&gt; {\n  private final A val;\n  Pure (A x) { val = x; }\n  public A run () {\n      return val;\n      }\n}\n</code></pre>\n\n<p>The tricky bit is <code>Bind</code>, which needs existential quantification. I don't know the idiomatic way to do this in Java, so I did something awkward that seems to work. Namely, I wrote an auxiliary class <code>OpenBind</code> that exposes <em>two</em> type variables, and then a class <code>Bind</code> that wraps up an <code>OpenBind</code> leaving one of those variables wild.</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>import java.util.function.Function;\n\npublic final class Bind &lt;A&gt; implements IO &lt;A&gt; {\n    private final OpenBind &lt;?,A&gt; ob;\n\n    public &lt;B&gt; Bind (IO &lt;B&gt; m, Function &lt;B,IO &lt;A&gt;&gt; f) {\n        ob = new OpenBind &lt;B,A&gt; (m, f);\n    }\n\n    public A run() {\n        return (ob.run());\n    }\n\n    private final static class OpenBind &lt;Fst,Snd&gt; {\n        private final IO &lt;Fst&gt; start;\n        private final Function &lt;Fst, IO &lt;Snd&gt;&gt; cont;\n        public OpenBind (IO &lt;Fst&gt; m, Function &lt;Fst, IO &lt;Snd&gt;&gt; f) {\n            start = m;\n            cont = f;\n        }\n        public final Snd run () {\n            Fst x = start.run();\n            IO &lt;Snd&gt; c = cont.apply(x);\n            return (c.run());\n        }\n    }\n}\n</code></pre>\n\n<p>The primops themselves are pretty simple (I couldn't find a Java equivalent of <code>()</code> so I wrote my own <code>Unit</code>):</p>\n\n<pre><code>public class PutStr implements IO &lt;Unit&gt; {\n  private String str;\n  public PutStr (String s) {\n      str = s;\n  }\n  public Unit run () {\n      System.out.print(str);\n      return Unit.unit;\n  }\n}\n\npublic final class Unit {\n  private Unit () {}\n  public static final Unit unit = new Unit ();\n}\n\npublic class GetLine implements IO &lt;String&gt; {\n    private GetLine () {}\n    public static final GetLine getLine = new GetLine ();\n    public String run () {\n      // Replace the next line with whatever you actually use to\n      // read a string.\n      return \"\";\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 375, "user_id": 4232796, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/42912716b8f59e0f6cfd0cbbe6a74bdf?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle McKean", "link": "https://stackoverflow.com/users/4232796/kyle-mckean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 0, "accepted_answer_id": 40581723, "answer_count": 2, "score": 5, "last_activity_date": 1480562813, "creation_date": 1478977069, "last_edit_date": 1478992648, "question_id": 40566508, "link": "https://stackoverflow.com/questions/40566508/how-do-you-implement-haskells-io-type-in-java", "title": "How do you implement Haskell&#39;s IO type in Java?", "body": "<p>This is my first attempt:</p>\n\n<pre><code>import java.util.function.*;\nimport java.util.ArrayList;\npublic class IO&lt;A&gt; {\n    private Function&lt;World,Tuple&lt;World,A&gt;&gt; transform;\n    private class World {\n        private ArrayList&lt;String&gt; stdin;\n        private ArrayList&lt;String&gt; stdout;\n        public World() {\n            this.stdin  = new ArrayList&lt;String&gt;();\n            this.stdout = new ArrayList&lt;String&gt;();\n        }\n    }\n    private class Tuple&lt;F,S&gt; {\n        public F fst;\n        public S snd;\n        public Tuple(F fst, S snd) {\n            this.fst = fst;\n            this.snd = snd;\n        }\n    }\n    public IO(Function&lt;World,Tuple&lt;World,A&gt;&gt; transform) {\n        this.transform = transform;\n    }\n    public IO&lt;A&gt; pure(A a) {\n        return new IO&lt;A&gt;(r -&gt; new Tuple&lt;World,A&gt;(r,a));\n    }\n    public &lt;B&gt; IO&lt;B&gt; bind(IO&lt;A&gt; io, Function&lt;A,IO&lt;B&gt;&gt; f) {\n        return new IO&lt;B&gt;(r -&gt; {\n            Tuple&lt;World,A&gt; result = io.transform.apply(r);\n            IO&lt;B&gt; ioB = f.apply(result.snd);\n            return ioB.transform.apply(result.fst);\n        });\n    }\n}\n</code></pre>\n\n<p>But when I try to compile this I get the following error:</p>\n\n<pre><code>IO.java:29: error: incompatible types: IO&lt;B&gt;.World cannot be converted to IO&lt;A&gt;.World\n            Tuple&lt;World,A&gt; result = io.transform.apply(r);\n                                                        ^\n  where B,A are type-variables:\n    B extends Object declared in method &lt;B&gt;bind(IO&lt;A&gt;,Function&lt;A,IO&lt;B&gt;&gt;)\n    A extends Object declared in class IO\n</code></pre>\n\n<p>What I don't understand is the world class has no relationship to the type variable but javac thinks it does. What am I doing wrong?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 1625775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93ba8ea9c25121eed04596f62100474?s=128&d=identicon&r=PG", "display_name": "teh", "link": "https://stackoverflow.com/users/1625775/teh"}, "edited": false, "score": 0, "creation_date": 1478979049, "post_id": 40565955, "comment_id": 68370293, "body": "Thanks! Do you know of an equivalent to closed type families for type classes? I.e. if I now want to write a matching function like <code>handler :: Result a -&gt; Text</code> I seem I have the same unpack-sentinel issue, just moved to type classes."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 75, "user_id": 1625775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93ba8ea9c25121eed04596f62100474?s=128&d=identicon&r=PG", "display_name": "teh", "link": "https://stackoverflow.com/users/1625775/teh"}, "edited": false, "score": 1, "creation_date": 1478983879, "post_id": 40565955, "comment_id": 68371683, "body": "@teh see edit for what should be a better solution (for what I think you&#39;d like to do)."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 6, "last_activity_date": 1479715838, "last_edit_date": 1479715838, "creation_date": 1478973497, "answer_id": 40565955, "question_id": 40565371, "link": "https://stackoverflow.com/questions/40565371/deconstruct-type-level-list-into-nested-tuple-without-sentinel-for/40565955#40565955", "title": "Deconstruct type level list into nested tuple without sentinel for &#39;[]", "body": "<p>Use closed type families. They match top-to-bottom, so there's no conflict.</p>\n\n<pre><code>type family Construct (xs :: [Type]) :: Type where\n  Construct '[x]      = x\n  Construct (x ': xs) = x :&lt;&gt; Construct xs\n</code></pre>\n\n<p>Now <code>Construct [Int, Int, Int]</code> reduces to <code>Int :&lt;&gt; (Int :&lt;&gt; Int)</code>.</p>\n\n<p>However, if I'm roughly right about how you intend to use this, you're much better off with heterogeneous lists, as they're easier to work with and have better type inference.</p>\n\n<pre><code>{-# language\n  UndecidableInstances, RankNTypes, TypeOperators, TypeFamilies,\n  TypeApplications, ScopedTypeVariables, GADTs, DataKinds, PolyKinds,\n  ConstraintKinds, AllowAmbiguousTypes #-}\n\nimport Data.List\nimport Data.Kind\n\ndata HList (ts :: [Type]) :: Type where\n  Nil  :: HList '[]\n  (:&gt;) :: t -&gt; HList ts -&gt; HList (t ': ts)\ninfixr 5 :&gt;\n\n-- example\nfoo :: HList [Int, String, Bool]  \nfoo = 0 :&gt; \"foo\" :&gt; True :&gt; Nil\n</code></pre>\n\n<p>As an example for a useful operation on <code>HList</code>, if we know that each element type satisfies a class constraint, we can map over the list, either collecting it into a homogeneous list or preserving the element types:</p>\n\n<pre><code>type family AllC c (xs :: [a]) :: Constraint where\n  AllC c '[]       = ()\n  AllC c (x ': xs) = (c x, AllC c xs)\n\nhmap :: forall c ts. AllC c ts =&gt; (forall x. c x =&gt; x -&gt; x) -&gt; HList ts -&gt; HList ts\nhmap f Nil       = Nil\nhmap f (x :&gt; xs) = f x :&gt; hmap @c f xs\n\nhmap' :: forall c ts r. AllC c ts =&gt; (forall x. c x =&gt; x -&gt; r) -&gt; HList ts -&gt; [r]\nhmap' f Nil       = []\nhmap' f (x :&gt; xs) = f x : hmap' @c f xs\n</code></pre>\n\n<p>We can use <code>TypeApplications</code> to set the <code>c</code> constraints. We can implement the <code>Show</code> instance for <code>HList</code> simply with the use of <code>hmap'</code>:</p>\n\n<pre><code>instance AllC Show ts =&gt; Show (HList ts) where\n  show xs = \"[\" ++ intercalate \", \" (hmap' @Show show xs) ++ \"]\"\n</code></pre>\n\n<p>Now we have in ghci:</p>\n\n<pre><code>&gt; foo\n[0, \"foo\", True]\n</code></pre>\n\n<p>which works because all element types of <code>foo</code> have <code>Show</code> instances.</p>\n"}], "owner": {"reputation": 75, "user_id": 1625775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93ba8ea9c25121eed04596f62100474?s=128&d=identicon&r=PG", "display_name": "teh", "link": "https://stackoverflow.com/users/1625775/teh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 40565955, "answer_count": 1, "score": 2, "last_activity_date": 1479715838, "creation_date": 1478970254, "question_id": 40565371, "link": "https://stackoverflow.com/questions/40565371/deconstruct-type-level-list-into-nested-tuple-without-sentinel-for", "title": "Deconstruct type level list into nested tuple without sentinel for &#39;[]", "body": "<p>I'm trying to deconstruct a list of types (e.g. <code>'[Int, Int]</code>) into both a type and a way to create that type via type operators (isomorphic to nested tuples but nicer to write). For example:</p>\n\n<pre class=\"lang-Haskell prettyprint-override\"><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeInType #-}\n{-# LANGUAGE TypeFamilies, FlexibleInstances #-}\n\nimport Data.Kind (Type)\n\ndata a :&lt;&gt; b = a :&lt;&gt; b\ninfixr 8 :&lt;&gt;\n\nclass Construct a where\n  type Result a :: Type\n\ninstance forall a as. (Show a, Construct as) =&gt; Construct (a:as) where\n  type Result (a:as) = a :&lt;&gt; (Result as)\n\ninstance Construct '[] where\n  type Result '[] = ()\n</code></pre>\n\n<p>When using this I get e.g.</p>\n\n<pre><code>\u03bb  :kind! Result '[Int, Int, Int]\nResult '[Int, Int, Int] :: *\n= Int :&lt;&gt; (Int :&lt;&gt; (Int :&lt;&gt; ()))\n</code></pre>\n\n<p>Note the <code>:&lt;&gt; ()</code> at the end which I don't want. At first I tried matching more specifically on the length of the list elements, e.g. '[a, b]:</p>\n\n<pre class=\"lang-Haskell prettyprint-override\"><code>instance forall a b. (Show a, Show b) =&gt; Construct ('[a,b]) where\n  type Result '[a,b] = a :&lt;&gt; b\n</code></pre>\n\n<p>But of course that doesn't work:</p>\n\n<pre><code>Conflicting family instance declarations:\n  Result (a : as) = a :&lt;&gt; Result as -- Defined at test.hs:14:8\n  Result '[a, b] = a :&lt;&gt; b -- Defined at test.hs:22:8\n</code></pre>\n\n<p>I can always construct up to N specific instances:</p>\n\n<pre class=\"lang-Haskell prettyprint-override\"><code>instance forall a. (Show a) =&gt; Construct '[a] where\n  type Result '[a] = a\n\ninstance forall a b. (Show a, Show b) =&gt; Construct '[a,b] where\n  type Result '[a, b] = a :&lt;&gt; b\n\ninstance forall a b c. (Show a, Show b, Show c) =&gt; Construct '[a,b,c] where\n  type Result '[a, b, c] = a :&lt;&gt; b :&lt;&gt; c\n\n-- etc. up to N\n</code></pre>\n\n<p>but that seems very unsatisfying.</p>\n\n<p>Is there a way to unpack to <code>Int :&lt;&gt; (Int :&lt;&gt; Int)</code> instead of <code>Int :&lt;&gt; (Int :&lt;&gt; (Int :&lt;&gt; ())))</code> using the recursive definition?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478970443, "post_id": 40565302, "comment_id": 68367630, "body": "Is there any particular reason why these are lists of lists, given that in your example all the inner lists have just one element?"}, {"owner": {"reputation": 1, "user_id": 7150397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05b9ad497a4696fa7c0fe28c3e5dd09a?s=128&d=identicon&r=PG&f=1", "display_name": "SlippyJoe", "link": "https://stackoverflow.com/users/7150397/slippyjoe"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478970800, "post_id": 40565302, "comment_id": 68367747, "body": "too make it easier to read I guess but yeah they can have more than 1 element"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478971117, "post_id": 40565302, "comment_id": 68367858, "body": "Making it easier to read is not a good reason for using nested lists, as it makes everything far more complicated than necessary -- you would have to decide what to do with the other elements."}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1478972426, "post_id": 40565302, "comment_id": 68368282, "body": "Would the input list of bools have to have to only include a single term? If the nested lists over values include multiple terms, should they all be made to the default value? What if a sublist in the list of bools includes several bools?"}], "answers": [{"tags": [], "owner": {"reputation": 996, "user_id": 868518, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/995f77c6aa103f1012c2fb6defa05dcb?s=128&d=identicon&r=PG", "display_name": "JonathanZ supports MonicaC", "link": "https://stackoverflow.com/users/868518/jonathanz-supports-monicac"}, "is_accepted": false, "score": 0, "last_activity_date": 1478972654, "last_edit_date": 1478972654, "creation_date": 1478972060, "answer_id": 40565690, "question_id": 40565302, "link": "https://stackoverflow.com/questions/40565302/matching-list-of-lists-with-other-list-of-lists/40565690#40565690", "title": "Matching list of lists with other list of lists", "body": "<p>Assuming you change them to lists, as recommended by duplode, how about zipping together the two lists within a list comprehension, something like this:</p>\n\n<pre><code>[if flag then val else defaultVal  | (flag, val) &lt;- zip(list1, list2)]\n</code></pre>\n\n<p>where <code>defaultVal</code> would have to be specified, but seems to be <code>Dead</code> and <code>0</code> for lists 2 and 3.</p>\n\n<p>(I don't have access right now to Haskell, so the syntax may not be 100% there, but that's the idea.)</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1478977341, "last_edit_date": 1478977341, "creation_date": 1478972328, "answer_id": 40565743, "question_id": 40565302, "link": "https://stackoverflow.com/questions/40565302/matching-list-of-lists-with-other-list-of-lists/40565743#40565743", "title": "Matching list of lists with other list of lists", "body": "<p>As far as I can see, using nested lists here is unnecessary. Without them, all you need is <code>zipWith</code> and an appropriate combining function:</p>\n\n<pre><code>-- The first argument is the \"dead\" value. Note that this works with any type.\nmakeDead :: a -&gt; Bool -&gt; a -&gt; a\nmakeDead dead b val\n    | b = val\n    | otherwise = dead\n</code></pre>\n\n\n\n<pre><code>GHCi&gt; :t zipWith\nzipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nGHCi&gt; zipWith (makeDead \"Dead\") [True,False,True,False] [\"Bob\",\"Rick\",\"Lee\",\"Bill\"] \n[\"Bob\",\"Dead\",\"Lee\",\"Dead\"]\n</code></pre>\n\n<p>Two variations on the theme. Firstly, if whether a value should be changed depends only on what the value is, then you can simply use <code>map</code>/<code>fmap</code>:</p>\n\n<pre><code> -- Affects all names with 'i' as the second letter:\nlethalLetter :: String -&gt; String\nlethalLetter name -&gt; case name of\n    (_:'i':_) -&gt; \"Dead\"\n    _ -&gt; name\n</code></pre>\n\n\n\n<pre><code>GHCi&gt; fmap lethalLetter [\"Bob\", \"Rick\", \"Lee\", \"Bill\"]\n[\"Bob\",\"Dead\",\"Lee\",\"Dead\"]\n</code></pre>\n\n<p>Secondly, you might prefer using <code>Maybe</code> to indicate deadness rather than using an arbitrary value (what if someone is actually called \"Dead\")?</p>\n\n<pre><code>makeDead' :: Bool -&gt; a -&gt; Maybe a\nmakeDead' b val\n    | b = Just val\n    | otherwise = Nothing\n</code></pre>\n\n\n\n<pre><code>GHCi&gt; zipWith makeDead' [True,False,True,False] [\"Bob\",\"Rick\",\"Lee\",\"Bill\"] \n[Just \"Bob\",Nothing,Just \"Lee\",Nothing]\n</code></pre>\n\n<p>You can then use functions like <code>maybe</code>, <code>fromMaybe</code> and <code>catMaybes</code> (the latter two are in <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Maybe.html\" rel=\"nofollow noreferrer\"><code>Data.Maybe</code></a>) to get rid of the <code>Nothing</code>s however you feel like doing it:</p>\n\n<pre><code>GHCi&gt; import Data.Maybe\nGHCi&gt; foo = zipWith makeDead' [True,False,True,False] [\"Bob\",\"Rick\",\"Lee\",\"Bill\"]\nGHCi&gt; catMaybes foo\n[\"Bob\",\"Lee\"]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478973217, "post_id": 40565821, "comment_id": 68368529, "body": "It should be mentioned that this will zip each pair of matching inner lists, so that <code>kill &quot;Dead&quot; [[False,True]] [[&quot;James&quot;,&quot;Seamus&quot;]]</code> will be <code>[[&quot;Dead&quot;,&quot;Seamus&quot;]]</code>."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478973694, "post_id": 40565821, "comment_id": 68368682, "body": "Yes. If one would expect otherwise I think it would be strange for the first list to be of type <code>[[Bool]]</code> instead of <code>[Bool]</code>."}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 0, "last_activity_date": 1479033314, "last_edit_date": 1479033314, "creation_date": 1478972767, "answer_id": 40565821, "question_id": 40565302, "link": "https://stackoverflow.com/questions/40565302/matching-list-of-lists-with-other-list-of-lists/40565821#40565821", "title": "Matching list of lists with other list of lists", "body": "<p>You can use <code>zipWith . zipWith :: (a -&gt; b -&gt; c) -&gt; [[a]] -&gt; [[b]] -&gt; [[c]]</code> for matching lists of lists. For example:</p>\n\n<pre><code>import Data.Bool (bool)\nkill deadVal = zipWith . zipWith $ bool (const deadVal) id\n\nexample = kill 0 [[True, False],[False,True]] [[1,2,3],[2]]\n-- example = [[1,0],[0]]\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7150397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05b9ad497a4696fa7c0fe28c3e5dd09a?s=128&d=identicon&r=PG&f=1", "display_name": "SlippyJoe", "link": "https://stackoverflow.com/users/7150397/slippyjoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1479033314, "creation_date": 1478969851, "last_edit_date": 1478973240, "question_id": 40565302, "link": "https://stackoverflow.com/questions/40565302/matching-list-of-lists-with-other-list-of-lists", "title": "Matching list of lists with other list of lists", "body": "<p>Hey guys I have a question about matching lists</p>\n\n<p>Given the list of lists: </p>\n\n<pre><code>Input List 1  = [[True],[False],[True],[[False]]\nInput List 2 = [[Bob],[Rick],[Lee],[Bill]]\nInput List 3 = [[1],[2],[3],[4]]\n</code></pre>\n\n<p>Then match the Booleans of list 1 with the other lists so this happens:</p>\n\n<pre><code>Input List 1 + Input List 2 = [[Bob],[Dead],[Lee],[Dead]]\nInput List 1 + Input List 2 = [[1],[0],[3],[0]]\n</code></pre>\n"}, {"tags": ["haskell", "lambda"], "answers": [{"tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 7, "last_activity_date": 1479114379, "last_edit_date": 1479114379, "creation_date": 1478971909, "answer_id": 40565668, "question_id": 40564737, "link": "https://stackoverflow.com/questions/40564737/apply-a-function-to-every-arguments-in-haskell/40565668#40565668", "title": "Apply a function to every arguments in haskell", "body": "<p>If <code>f = g</code> you can use <code>on</code> in <code>Data.Function</code>. Otherwise there is no combinator for that in <code>base</code>. A stackage search for the appropriate type reveals <code>biSp</code> from <a href=\"https://hackage.haskell.org/package/concatenative\" rel=\"nofollow noreferrer\"><code>concatenative</code></a>.</p>\n\n<pre><code>biSp :: (a -&gt; c) -&gt; (b -&gt; d) -&gt; (c -&gt; d -&gt; e) -&gt; a -&gt; b -&gt; e\n</code></pre>\n\n<p>However if that is the only function you will be using from that package, you may not want to depend on a package just for that.</p>\n\n<p>Other than that you can use the following which would be at least marginally shorter, but not really more readable.</p>\n\n<pre><code>(. g) . combine . f\n</code></pre>\n\n<p>Or using <code>dimap</code> in <code>Data.Profunctor</code> from <a href=\"https://hackage.haskell.org/package/profunctors\" rel=\"nofollow noreferrer\"><code>profunctors</code></a>. While this also requires another package, it is likely that you are already depending on <code>profunctors</code> indirectly anyway, because you are using <code>lens</code> or some package depending on <code>lens</code>.</p>\n\n<pre><code>dimap f (. g) combine\n</code></pre>\n\n<p>This can easily be extended to three arguments. The following all do the same and are ordered from shortest to most structured and with the last two it is especially easy to extend them to any number of arguments.</p>\n\n<pre><code>dimap f (dimap g (. h)) combine3\n(dimap f . dimap g) (. h) combine3\n(dimap f . dimap g . dimap h) id combine3\n</code></pre>\n\n<p>If you wonder what this <code>dimap</code> does. This is a great tutorial: <a href=\"https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/profunctors\" rel=\"nofollow noreferrer\">I love profunctors. They're so easy.</a></p>\n\n<p>Or just write your own <code>biSp</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1478974216, "creation_date": 1478974216, "answer_id": 40566072, "question_id": 40564737, "link": "https://stackoverflow.com/questions/40564737/apply-a-function-to-every-arguments-in-haskell/40566072#40566072", "title": "Apply a function to every arguments in haskell", "body": "<p>An alternative pointfree spelling involves handling the arguments as a pair by using <code>curry</code>, <code>uncurry</code> and either <code>(***)</code> (from <code>Control.Arrow</code>) or <code>bimap</code> (from <code>Data.Bifunctor</code>):</p>\n\n<pre><code>GHCi&gt; :t \\combine f g -&gt; curry (uncurry combine . (f *** g))\n\\combine f g -&gt; curry (uncurry combine . (f *** g))\n  :: (a1 -&gt; b1 -&gt; c) -&gt; (a -&gt; a1) -&gt; (b -&gt; b1) -&gt; a -&gt; b -&gt; c\n</code></pre>\n\n<p>Note that, unlike jpath's suggestions, this isn't even shorter than the non-pointfree version.</p>\n"}], "owner": {"reputation": 5038, "user_id": 3579309, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Wn5ES.jpg?s=128&g=1", "display_name": "lovasoa", "link": "https://stackoverflow.com/users/3579309/lovasoa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 40566072, "answer_count": 2, "score": 2, "last_activity_date": 1479114379, "creation_date": 1478966477, "question_id": 40564737, "link": "https://stackoverflow.com/questions/40564737/apply-a-function-to-every-arguments-in-haskell", "title": "Apply a function to every arguments in haskell", "body": "<p>I sometimes find myself in a case where I need to create a function that maps a different function to two values, and then combines them together. How to do that without using a lambda ?</p>\n\n<p>My functions are:</p>\n\n<pre><code>f :: a -&gt; b\ng :: c -&gt; d\ncombine :: b -&gt; d -&gt; e\n</code></pre>\n\n<p>The question is: how to write <code>\\x y -&gt; combine (f x) (g y)</code> without using a lambda ?</p>\n"}, {"tags": ["haskell", "memory-leaks"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1478952429, "post_id": 40562489, "comment_id": 68362230, "body": "Did you check the Core? If I had to guess, I&#39;d say that <code>unendingN</code> are moved to a local variable or inlined, and then they can be garbage collected. (Even if as a top-level CAFs one would expect them to stay in memory)."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1478952609, "post_id": 40562489, "comment_id": 68362274, "body": "@chi I&#39;m not very experienced at reading core, but I generated it with <code>-ddump-simpl</code> and the lists do seem to remain at the top level."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1478953737, "post_id": 40562489, "comment_id": 68362581, "body": "I now checked the Core, but it&#39;s not that. The call from main to the lists is not inlined or made local. Probably global CAFs are now GC&#39;d as Andr&#225;s Kov&#225;cs points out below."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1478956497, "post_id": 40562489, "comment_id": 68363296, "body": "Readers of this question might find this blog post about memory leaks interesting: <a href=\"http://www.well-typed.com/blog/2016/09/sharing-conduit/\" rel=\"nofollow noreferrer\">well-typed.com/blog/2016/09/sharing-conduit</a> and also the following discussion on Reddit: <a href=\"https://www.reddit.com/r/haskell/comments/550wsj/new_blog_post_sharing_memory_leaks_and_conduit/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/550wsj/&hellip;</a> <a href=\"https://www.reddit.com/r/haskell/comments/55xk4z/erratum_to_sharing_memory_leaks_and_conduit_and/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/55xk4z/&hellip;</a> It was while trying to reproduce these problems that I came out with my example."}], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1478953680, "post_id": 40562764, "comment_id": 68362561, "body": "I see. If I duplicate the the <code>print (summator 0 unending1 unending2)</code> line, should the lists be retained? Because they will be needed for the second print (that will never we reached). If I do that it doesn&#39;t exhaust the heap."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1478954093, "post_id": 40562764, "comment_id": 68362661, "body": "If we define <code>cycle xs = xs ++ cycle xs</code> (see chi&#39;s answer), duplicated <code>print</code> line exhausts the heap , while single <code>print</code> line doesn&#39;t."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1478954340, "last_edit_date": 1478954340, "creation_date": 1478953064, "answer_id": 40562764, "question_id": 40562489, "link": "https://stackoverflow.com/questions/40562489/why-doesnt-this-haskell-code-exhaust-the-heap/40562764#40562764", "title": "Why doesn&#39;t this Haskell code exhaust the heap?", "body": "<p>As chi answered, your code runs in constant space because of the definition of <code>cycle</code>. </p>\n\n<p>However, it runs in constant space with <code>ghc -O0</code> even with <code>cycle xs = xs ++ cycle xs</code>, because top-level thunks (constant applicative forms, CAF-s) can be garbage collected. The info tables of closures have \"static reference tables\", which list static closures such that </p>\n\n<ul>\n<li>The code of the closure mentions them</li>\n<li>They're either top-level thunks or their code transitively refers to top-level thunks</li>\n</ul>\n\n<p>Documentation <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Storage/GC/CAFs\" rel=\"nofollow noreferrer\">here</a>. If top-level thunks can't be reached from GC roots (which include the stacks of thread-state objects, so in our case the closure of <code>main</code> under execution), heap objects they point to are discarded.</p>\n"}, {"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1478954509, "post_id": 40562827, "comment_id": 68362757, "body": "Static object GC doesn&#39;t kick in with ghci, but with  <code>ghc -O0</code> <code>cycle&#39;</code> runs in constant space as well."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1478955423, "post_id": 40562827, "comment_id": 68362971, "body": "Yes, for the leak to happen in the compiled code, we need to use the modified <code>cycle&#39;</code> AND duplicate the <code>print</code> statement so the lists are not garbage collected."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1478954370, "last_edit_date": 1478954370, "creation_date": 1478953642, "answer_id": 40562827, "question_id": 40562489, "link": "https://stackoverflow.com/questions/40562489/why-doesnt-this-haskell-code-exhaust-the-heap/40562827#40562827", "title": "Why doesn&#39;t this Haskell code exhaust the heap?", "body": "<p>From <code>GHC.List</code>:</p>\n\n<pre><code>cycle                   :: [a] -&gt; [a]\ncycle []                = errorEmptyList \"cycle\"\ncycle xs                = xs' where xs' = xs ++ xs'\n</code></pre>\n\n<p>Note that the recursion does not involve a function call, but a list value <code>xs'</code>. </p>\n\n<p>When fully forced, this should be represented in memory as a circular linked-list, with a backward pointer. Only a finite amount of memory is then required.</p>\n\n<p>Try e.g. defining your own <code>cycle</code>:</p>\n\n<pre><code>cycle' xs = xs ++ cycle' xs\n</code></pre>\n\n<p>since GHC does not do automatic memoization, this should generate an unbounded list in memory.</p>\n\n<p>Indeed, even in GHCi (unoptimized), this stays under 70M on my machine</p>\n\n<pre><code>&gt; let list1 :: [Int] ; list1 = cycle [1,2,3]\n&gt; list1 !! (4*10^9)\n2\n</code></pre>\n\n<p>while this explodes (>1GB):</p>\n\n<pre><code>&gt; let list2 :: [Int] ; list2 = cycle' [1,2,3]\n&gt; list2 !! (4*10^7)\n2\n</code></pre>\n"}], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 40562764, "answer_count": 2, "score": 3, "last_activity_date": 1478954370, "creation_date": 1478950797, "last_edit_date": 1478953125, "question_id": 40562489, "link": "https://stackoverflow.com/questions/40562489/why-doesnt-this-haskell-code-exhaust-the-heap", "title": "Why doesn&#39;t this Haskell code exhaust the heap?", "body": "<p>This code sums the contents of two (mutually cancelling) infinite lists specified at the top level:</p>\n\n<pre><code>{-# language BangPatterns #-}\nmodule Main where\n\nunending1 :: [Int]\nunending1 = cycle [1]\n\nunending2 :: [Int]\nunending2 = cycle [negate 1]\n\nmain :: IO ()\nmain = do\n    let summator :: Int -&gt; [Int] -&gt; [Int] -&gt; Int\n        summator !acc (i1 : rest1) (i2 : rest2) =\n            if acc &gt; 100\n            then acc -- never happens\n            else summator (acc+i1+i2) rest1 rest2\n    print (summator 0 unending1 unending2)\n</code></pre>\n\n<p>I compile this code with no optimizations and a low heap size, like this:</p>\n\n<pre><code>ghc -O0 -with-rtsopts=\"-M10m\" Main.hs\n</code></pre>\n\n<p>My intuition is that this code would cause a memory leak, because the summation function would try to \"materialize\" the two lists, and the heads of both of them are at the top-level, so they won't be discarded.</p>\n\n<p>However when I execute the program it seems to run indefinitely without problems.</p>\n\n<p>Where am I mistaken?</p>\n\n<hr>\n\n<p><strong>Edit.</strong> Inspecting the generated Core using <code>-ddump-simpl</code>, the lists seem to remain at the top level. For example:</p>\n\n<pre><code>Result size of Tidy Core = {terms: 77, types: 52, coercions: 0}\n\n-- RHS size: {terms: 5, types: 3, coercions: 0}\nunending1 :: [Int]\n[GblId, Str=DmdType]\nunending1 =\n  cycle\n    @ Int (GHC.Types.: @ Int (GHC.Types.I# 1#) (GHC.Types.[] @ Int))\n</code></pre>\n"}, {"tags": ["macos", "haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1478959266, "post_id": 40562437, "comment_id": 68364065, "body": "Looks like it is <a href=\"https://github.com/commercialhaskell/stack/issues/825\" rel=\"nofollow noreferrer\">this</a> issue."}, {"owner": {"reputation": 89, "user_id": 7149571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f9f9d7b534eccc7a6af42b25197abff?s=128&d=identicon&r=PG&f=1", "display_name": "Amir", "link": "https://stackoverflow.com/users/7149571/amir"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1478974850, "post_id": 40562437, "comment_id": 68369055, "body": "Thanks! It solved my problem."}, {"owner": {"reputation": 89, "user_id": 7149571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f9f9d7b534eccc7a6af42b25197abff?s=128&d=identicon&r=PG&f=1", "display_name": "Amir", "link": "https://stackoverflow.com/users/7149571/amir"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1478976829, "post_id": 40562437, "comment_id": 68369652, "body": "If you write it as an answer, I will accept it."}], "owner": {"reputation": 89, "user_id": 7149571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f9f9d7b534eccc7a6af42b25197abff?s=128&d=identicon&r=PG&f=1", "display_name": "Amir", "link": "https://stackoverflow.com/users/7149571/amir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1478953821, "creation_date": 1478950421, "last_edit_date": 1478953821, "question_id": 40562437, "link": "https://stackoverflow.com/questions/40562437/link-error-with-stack-install-hoogle-on-a-mac", "title": "Link error with &quot;stack install hoogle&quot; on a mac", "body": "<p>New to stack and haskell. I am on lts-7.8, trying to run \"stack install hoogle\" get the following link error.</p>\n\n<pre><code>  Preprocessing executable 'hoogle' for hoogle-5.0.1...\n    [1 of 1] Compiling Main             ( src/Main.hs, .stack-work/dist/x86_64-osx/Cabal-1.24.0.0/build/hoogle/hoogle-tmp/Main.o )\n    Linking .stack-work/dist/x86_64-osx/Cabal-1.24.0.0/build/hoogle/hoogle ...\n    Undefined symbols for architecture x86_64:\n      \"_iconv\", referenced from:\n          _hs_iconv in libHSbase-4.9.0.0.a(iconv.o)\n         (maybe you meant: _base_GHCziIOziEncodingziIconv_iconvEncodingzuloc_info, _base_GHCziIOziEncodingziIconv_iconvEncoding2_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding11_info , _base_GHCziIOziEncodingziIconv_iconvEncoding6_info , _base_GHCziIOziEncodingziIconv_iconvEncoding_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding1_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding1_info , _base_GHCziIOziEncodingziIconv_iconvEncoding4_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding4_info , _base_GHCziIOziEncodingziIconv_iconvEncoding7_info , _base_GHCziIOziEncodingziIconv_iconvEncoding6_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding8_info , _hs_iconv_open , _base_GHCziIOziEncodingziIconv_iconvEncodingzuloc1_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding9_info , _base_GHCziIOziEncodingziIconv_iconvEncoding10_info , _base_GHCziIOziEncodingziIconv_iconvEncodingzuloc1_info , _base_GHCziIOziEncodingziIconv_iconvEncodingzuloc_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding3_closure , _hs_iconv_close , _base_GHCziIOziEncodingziIconv_iconvEncoding8_closure , _hs_iconv , _base_GHCziIOziEncodingziIconv_iconvEncoding_info , _base_GHCziIOziEncodingziIconv_iconvEncoding7_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding11_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding2_info , _base_GHCziIOziEncodingziIconv_iconvEncoding9_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding10_closure , _base_GHCziIOziEncodingziIconv_iconvEncoding5_closure )\n      \"_iconv_close\", referenced from:\n          _hs_iconv_close in libHSbase-4.9.0.0.a(iconv.o)\n         (maybe you meant: _hs_iconv_close)\n      \"_iconv_open\", referenced from:\n          _hs_iconv_open in libHSbase-4.9.0.0.a(iconv.o)\n         (maybe you meant: _hs_iconv_open)\n      \"_locale_charset\", referenced from:\n          _localeEncoding in libHSbase-4.9.0.0.a(PrelIOUtils.o)\n    ld: symbol(s) not found for architecture x86_64\n    clang: error: linker command failed with exit code 1 (use -v to see invocation)\n    `gcc' failed in phase `Linker'. (Exit code: 1)\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["list", "haskell", "types", "infinite"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1478939504, "post_id": 40560876, "comment_id": 68359256, "body": "Why would you think that the result would be <code>[1, 2]</code>? <code>filter</code> has no way of knowing when to stop checking for the elements... for example consider that: <code>cycle [1..N]</code> contains an infinite number of <code>1</code>s and <code>2</code>s but if you only look at a finite prefix it looks very similar to <code>[1..]</code> and you can choose <code>N</code> as big as you want."}, {"owner": {"reputation": 514, "user_id": 1375259, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yuWQ9.jpg?s=128&g=1", "display_name": "Chakravarthy Raghunandan", "link": "https://stackoverflow.com/users/1375259/chakravarthy-raghunandan"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1478939767, "post_id": 40560876, "comment_id": 68359300, "body": "Oh yes. I&#39;m sorry, I got very confused between <code>filter</code> and <code>takewhile</code>. I&#39;m very new to haskell. Sorry for this stupid stupid confusion.  I&#39;ll edit the question now."}], "answers": [{"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 6, "last_activity_date": 1478939824, "creation_date": 1478939824, "answer_id": 40561071, "question_id": 40560876, "link": "https://stackoverflow.com/questions/40560876/understanding-the-representation-of-inifinite-lists-as-the-limit-of-partial-list/40561071#40561071", "title": "Understanding the representation of inifinite lists as the limit of partial lists in haskell", "body": "<p>To put things simply, the Haskell compiler is not magic, however magical it may sometimes appear. While certain sorts of expressions may seem extremely declarative compared to other programming languages, Haskell\u2019s evaluation semantics are actually remarkably simple.</p>\n\n<p>For this reason, in the example you mention, <code>filter (&lt; 3) [1..]</code>, GHC does not \u201cknow\u201d anything about the <em>meaning</em> of the above expression. While it is obvious to a human than there will never be any elements after <code>2</code> that satisfy the <code>(&lt; 3)</code> predicate, there is no reason that <code>filter</code> can be aware that there won\u2019t <em>eventually</em> be some element that does. For this reason, attempting to evaluate anything other than the first two elements of the resulting list will produce an infinite loop.</p>\n\n<p>This is the idea behind the explanation that infinite lists in Haskell are really just \u201climits\u201d. A true analytical system can work with infinite lists, and it can make assertions about <em>all</em> of their elements. One can trivially prove, mathematically, that the infinite list represented by the Haskell expression <code>[1..]</code> only contains two elements that are less than 3, but Haskell does not have any such analytical capabilities\u2014it\u2019s just a functional programming language.</p>\n\n<p>Using the analog to a mathematical limit, we can say that evaluating <code>[1..]</code> approaches the infinite list given an infinite amount of time and space, but without that, it\u2019s just a computation\u2014a promise that we can always produce more elements if we want, but unlike a mathematical infinite set, it is not some high level description of a truly infinite set of elements. It\u2019s just a finite set of elements with an arbitrary size and a description of how to obtain more.</p>\n"}], "owner": {"reputation": 514, "user_id": 1375259, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yuWQ9.jpg?s=128&g=1", "display_name": "Chakravarthy Raghunandan", "link": "https://stackoverflow.com/users/1375259/chakravarthy-raghunandan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 40561071, "answer_count": 1, "score": 2, "last_activity_date": 1478939866, "creation_date": 1478938188, "last_edit_date": 1478939866, "question_id": 40560876, "link": "https://stackoverflow.com/questions/40560876/understanding-the-representation-of-inifinite-lists-as-the-limit-of-partial-list", "title": "Understanding the representation of inifinite lists as the limit of partial lists in haskell", "body": "<p>I was going through <a href=\"https://hackhands.com/non-strict-semantics-haskell/\" rel=\"nofollow noreferrer\">this</a> article which explains Haskell's non-strict semantics. I understood till the author starts talking about <em>Partial and Infinite Lists</em> in Haskell.</p>\n\n<p>The author says :-</p>\n\n<blockquote>\n  <p>The idea is that an infinite list is to be understood as a <em>limit</em> of partial lists. </p>\n</blockquote>\n\n<hr>\n\n<p>And after that, the author goes on to explain the execution of the expression :-</p>\n\n<p><code>filter (&lt; 3) [1..]</code></p>\n\n<p><del>The result kinda goes against my intuition of my expected output. I thought the answer would be simply the list :- <code>[1, 2]</code>. But, nope!!. </del>While the authors explain is sufficient to understand the execution process and how we get the final result, it doesn't explain <strong>why</strong> it works like so.</p>\n\n<p>So, my question is <strong>why</strong> are infinite lists represented as the limit of a bunch of partial lists? Can someone explain this without digging too deep into complex mathematical jargon?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "edited": false, "score": 0, "creation_date": 1478935541, "post_id": 40560506, "comment_id": 68358492, "body": "If a type variable <code>a</code> that only constrained by Num a =&gt; a, but not constrained by Fractional type class. Is that to say the variable <code>a</code> may not implement some behaviors functions like <code>(&#47;)</code>? If for example Fractional behaviors function <code>(&#47;)</code> not implemented , how can <code>a</code> to be used in the <code>(&#47;)</code> function ?"}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "reply_to_user": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "edited": false, "score": 0, "creation_date": 1478936982, "post_id": 40560506, "comment_id": 68358748, "body": "We know that a type variable constrained by <code>Fractional a =&gt; a</code> will be able to implement all behaviors defined in the <code>Num</code> class. The same is not true in reverse, because we can think of <code>Fractional a =&gt; a</code> as a more strict constraint -&gt; the acceptable <code>a</code> types are a subset."}, {"owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "edited": false, "score": 0, "creation_date": 1478940139, "post_id": 40560506, "comment_id": 68359382, "body": "Thanks for your detailed reply. Only one question but too long here, I post after the raw question."}], "tags": [], "owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "is_accepted": true, "score": 4, "last_activity_date": 1506553236, "last_edit_date": 1506553236, "creation_date": 1478934830, "answer_id": 40560506, "question_id": 40560387, "link": "https://stackoverflow.com/questions/40560387/how-can-a-instance-with-num-type-class-coercion-to-fractional-implicitly/40560506#40560506", "title": "How can a instance with Num type class coercion to Fractional implicitly?", "body": "<p>First, note that both <code>Fractional</code> and <code>Num</code> are not types, but type classes. You can read more about them in the documentation or elsewhere, but the basic idea is that they define behaviors for types. <code>Num</code> is the most inclusive numeric typeclass, defining behaviors functions like <code>(+)</code>, <code>negate</code>, which are common to pretty much all \"numeric types.\" <code>Fractional</code> is a more constrained type class that describes \"fractional numbers, supporting real division.\"</p>\n\n<p>If we look at the type class definition for <code>Fractional</code>, we see that it is actually defined as a subclass of <code>Num</code>. That is, for a type <code>a</code> to be an have an instance <code>Fractional</code>, it must first be a member of the typeclass <code>Num</code>:</p>\n\n<pre><code>class Num a =&gt; Fractional a where\n</code></pre>\n\n<p>Let's consider some type that is constrained by <code>Fractional</code>. We know it implements the basic behaviors common to all members of <code>Num</code>. However, we can't expect it to implement behaviors from other type classes unless multiple constraints are specified (ex. <code>(Num a, Ord a) =&gt; a</code>. Take, for example, the function <code>div :: Integral a =&gt; a -&gt; a -&gt; a</code> (integral division). If we try to apply the function with an argument that is constrained by the typeclass <code>Fractional</code> (ex. <code>1.2 :: Fractional t =&gt; t</code>), we encounter an error. Type classes <strong>restrict</strong> the sort of values a function deals with, allowing us to write more specific and useful functions for types that share behaviors.     </p>\n\n<p>Now let's look at the more general typeclass, <code>Num</code>. If we have a type variable <code>a</code> that is only constrained by <code>Num a =&gt; a</code>, we know that it will implement the (few) basic behaviors included in the <code>Num</code> type class definition, but we'd need more context to know more. What does this mean practically? We know from our <code>Fractional</code> class declaration that functions defined in the <code>Fractional</code> type class are applied to <code>Num</code> types. However, these <code>Num</code> types are a <strong>subset</strong> of all possible <code>Num</code> types.</p>\n\n<p>The importance of all this, ultimately, has to do with the ground types (where type class constraints are most commonly seen in functions). <code>a</code> represents a type, with the notation <code>Num a =&gt; a</code> telling us that <code>a</code> is a type that includes an instance of the type class <code>Num</code>. <code>a</code> could be <em>any</em> of the types that include the instance (ex. <code>Int</code>, <code>Natural</code>). Thus, if we give a value a general type <code>Num a =&gt; a</code>, we know it can implement functions for every type where there is a type class defined. For example:</p>\n\n<pre><code>ghci&gt;&gt; let a = 3 :: (Num a =&gt; a)\nghci&gt;&gt; a / 2\n1.5    \n</code></pre>\n\n<p>Whereas if we'd defined <code>a</code> as a specific type or in terms of a more constrained type class, we would have not been able to expect the same results:</p>\n\n<pre><code>ghci&gt;&gt; let a = 3 :: Integral a =&gt; a\nghci&gt;&gt; a / 2\n-- Error: ambiguous type variable\n</code></pre>\n\n<p>or</p>\n\n<pre><code>ghci&gt;&gt; let a = 3 :: Integer\nghci&gt;&gt; a / 2\n-- Error: No instance for (Fractional Integer) arising from a use of \u2018/\u2019\n</code></pre>\n\n<hr>\n\n<p>(Edit responding to followup question)</p>\n\n<p>This is definitely not the most concrete explanation, so readers feel free to suggest something more rigorous.</p>\n\n<p>Suppose we have a function <code>a</code> that is just a type class constrained version of the <code>id</code> function:</p>\n\n<pre><code>a :: Num a =&gt; a -&gt; a\na = id\n</code></pre>\n\n<p>Let's look at type signatures for some applications of the function:</p>\n\n<pre><code>ghci&gt;&gt; :t (a 3)\n(a 3) :: Num a =&gt; a\nghci&gt;&gt; :t (a 3.2)\n(a 3.2) :: Fractional a =&gt; a\n</code></pre>\n\n<p>While our function had the general type signature, as a result of its application the the type of the application is more restricted.</p>\n\n<p>Now, let's look at the function <code>fromIntegral :: (Num b, Integral a) =&gt; a -&gt; b</code>. Here, the return type is the general <code>Num b</code>, and this will be true regardless of input. I think the best way to think of this difference is in terms of precision. <code>fromIntegral</code> takes a more constrained type and makes it less constrained, so we know we'll always expect the result will be constrained by the type class from the signature. However, if we give an input constraint, the actual input could be more restricted than the constraint and the resulting type would reflect that.</p>\n"}, {"tags": [], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "is_accepted": false, "score": 0, "last_activity_date": 1496862118, "creation_date": 1496862118, "answer_id": 44420813, "question_id": 40560387, "link": "https://stackoverflow.com/questions/40560387/how-can-a-instance-with-num-type-class-coercion-to-fractional-implicitly/44420813#44420813", "title": "How can a instance with Num type class coercion to Fractional implicitly?", "body": "<p>The reason why this works comes down to the way universal quantification works. To help explain this I am going to add in explicit <code>forall</code> to the type signatures (which you can do yourself if you enable <code>-XExplicitForAll</code> or any other <code>forall</code> related extension), but if you just removed them (<code>forall a. ...</code> becomes just <code>...</code>), everything will work fine.</p>\n\n<p>The thing to remember is that when a function involves a type constrained by a typeclass, then what that means is that you can input/output ANY type within that typeclass, so it's actually better to have a less constrained typeclass.</p>\n\n<p>So:</p>\n\n<pre><code>fromInteger :: forall a. Num a =&gt; Integer -&gt; a\n\nfromInteger 5 :: forall a. Num a =&gt; a\n</code></pre>\n\n<p>Means that you have a value that is of EVERY <code>Num</code> type. So not only can you use it in a function taking it in a <code>Fractional</code>, you could use it in a function that only takes in <code>MyWeirdTypeclass a =&gt; ...</code> as long as there is one single type that implements both <code>Num</code> and <code>MyWeirdTypeclass</code>. Hence why you can get the following just fine:</p>\n\n<pre><code>fromInteger 5 / 2 :: forall a. Fractional a =&gt; a\n</code></pre>\n\n<p>Now of course once you decide to divide by 2, it now wants the output type to be <code>Fractional</code>, and thus <code>5</code> and <code>2</code> will be interpreted as some <code>Fractional</code> type, so we won't run into issues where we try to divide <code>Int</code> values, as trying to make the above have type <code>Int</code> will fail to type check.</p>\n\n<p>This is really powerful and awesome, but very much unfamiliar, as generally other languages either don't support this, or only support it for input arguments (e.g <code>print</code> in most languages can take in any printable type).</p>\n\n<p>Now you may be curious when the whole superclass / subclass stuff comes into play, so when you are defining a function that takes in something of type <code>Num a =&gt; a</code>, then because a user can pass in ANY <code>Num</code> type, you are correct that in this situation you cannot use functions defined on some subclass of <code>Num</code>, only things that work on ALL <code>Num</code> values, like <code>*</code>:</p>\n\n<pre><code>double :: forall a. Num a =&gt; a -&gt; a\ndouble n = n * 2  -- in here `n` really has type `exists a. Num a =&gt; a`\n</code></pre>\n\n<p>So the following does not type check, and it wouldn't type check in any language, because you don't know that the argument is a <code>Fractional</code>.</p>\n\n<pre><code>halve :: Num a =&gt; a -&gt; a\nhalve n = n / 2  -- in here `n` really has type `exists a. Num a =&gt; a`\n</code></pre>\n\n<p>What we have up above with <code>fromInteger 5 / 2</code> is more equivalent to the following, higher rank function, note that the <code>forall</code> within parenthesis is required, and you need to use <code>-XRankNTypes</code>:</p>\n\n<pre><code>halve :: forall b. Fractional b =&gt; (forall a. Num a =&gt; a) -&gt; b\nhalve n = n / 2 -- in here `n` has type `forall a. Num a =&gt; a`\n</code></pre>\n\n<p>Since this time you are taking in EVERY <code>Num</code> type (just like the <code>fromInteger 5</code> you were dealing with before), not just ANY <code>Num</code> type. Now the downside of this function (and one reason why no one wants it) is that you really do have to pass in something of EVERY <code>Num</code> type:</p>\n\n<pre><code>halve (2 :: Int) -- does not work\n\nhalve (3 :: Integer) -- does not work\n\nhalve (1 :: Double) -- does not work\n\nhalve (4 :: Num a =&gt; a) -- works!\n\nhalve (fromInteger 5) -- also works!\n</code></pre>\n\n<p>I hope that clears things up a little. All you need for the <code>fromInteger 5 / 2</code> to work is that there exists ONE single type that is both a <code>Num</code> and a <code>Fractional</code>, or in other words just a <code>Fractional</code>, since <code>Fractional</code> implies <code>Num</code>. Type defaulting doesn't help much with clearing up this confusion, as what you may not realize is that GHC is just arbitrarily picking <code>Double</code>, it could have picked any <code>Fractional</code>.</p>\n"}], "owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 0, "accepted_answer_id": 40560506, "answer_count": 2, "score": 2, "last_activity_date": 1506553236, "creation_date": 1478933857, "last_edit_date": 1479031562, "question_id": 40560387, "link": "https://stackoverflow.com/questions/40560387/how-can-a-instance-with-num-type-class-coercion-to-fractional-implicitly", "title": "How can a instance with Num type class coercion to Fractional implicitly?", "body": "<p>I tested the numeric coercion by using GHCI:</p>\n\n<pre><code>&gt;&gt; let c = 1 :: Integer\n\n&gt;&gt; 1 / 2\n0.5\n\n&gt;&gt; c / 2\n&lt;interactive&gt;:15:1: error:\n\u2022 No instance for (Fractional Integer) arising from a use of \u2018/\u2019\n\u2022 In the expression: c / 2\n  In an equation for \u2018it\u2019: it = c / 2\n\n&gt;&gt; :t (/)\n(/) :: Fractional a =&gt; a -&gt; a -&gt; a -- (/) needs Fractional type\n\n&gt;&gt; (fromInteger c)  / 2\n0.5\n\n&gt;&gt;:t fromInteger\nfromInteger :: Num a =&gt; Integer -&gt; a  -- Just convert the Integer to Num not to Fractional\n</code></pre>\n\n<p>I can use <code>fromInteger</code> function to convert a Integer type to Num (fromInteger has the type <code>fromInteger :: Num a =&gt; Integer -&gt; a</code>), but I cannot understand that how can the type <code>Num</code> be converted to <code>Fractional</code> implicitly?</p>\n\n<p>I know that if an instance has type <code>Fractional</code> it must have type <code>Num</code> (<code>class Num a =&gt; Fractional a where</code>), but does it necessary that if an instance has type <code>Num</code> it can be used as an instance with <code>Fractional</code> type?</p>\n\n<hr>\n\n<p>@mnoronha Thanks for your detailed reply. There is only one question confuse me. I know the reason that <code>type a</code> cannot be used in function <code>(/)</code> is that <code>type a</code> is with <code>type Integer</code> which is not an instance of <code>type class Fractional</code> (the function <code>(/)</code> requires that the type of arguments must be <code>instance of Fractional</code>). What I don't understand is that even by calling <code>fromInteger</code> to convert the type integer to <code>a</code>type which be an instance of <code>Num</code>, it does not mean <code>a</code> type be an instance of <code>Fractional</code> (because Fractional type class is more constrained than Num type class, so <code>a</code> type may not implement some functions required by <code>Fractional type class</code>). If <code>a</code> type does not fully fit the condition <code>Fractional type class</code> requires, how can it be use in the function <code>(/)</code> which asks the arguments type be instance of Fractional. Sorry for not native speaker and really thanks for your patience!   </p>\n\n<hr>\n\n<p>I tested that if a type only fits the parent type class, it cannot be used in a function which requires more constrained type class.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nclass ParentAPI a where\n  printPar :: int -&gt; a -&gt; String\n\nclass (ParentAPI a) =&gt; SubAPI a where\n  printSub :: a -&gt; String\n\ndata ParentDT = ParentDT Int\ninstance ParentAPI ParentDT where\n  printPar i p = \"par\"\n\n\ntestF :: (SubAPI a) =&gt; a -&gt; String\ntestF a = printSub a\n\nmain = do\n  let m = testF $ ParentDT 10000\n  return ()\n====\ntest-typeclass.hs:19:11: error:\n\u2022 No instance for (SubAPI ParentDT) arising from a use of \u2018testF\u2019\n\u2022 In the expression: testF $ ParentDT 10000\n  In an equation for \u2018m\u2019: m = testF $ ParentDT 10000\n  In the expression:\n    do { let m = testF $ ParentDT 10000;\n         return () }\n</code></pre>\n\n<hr>\n\n<p>I have found a doc explaining the numeric overloading ambiguity very clearly and may help others with the same confusion. </p>\n\n<p><a href=\"https://www.haskell.org/tutorial/numbers.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/tutorial/numbers.html</a></p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1478934299, "post_id": 40560382, "comment_id": 68358258, "body": "<code>newtype Ntype a b = N (a -&gt; b)</code> then <code>instance Functor (Ntype a) where ...</code>"}], "answers": [{"tags": [], "owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "is_accepted": true, "score": 0, "last_activity_date": 1478962325, "last_edit_date": 1495535559, "creation_date": 1478962325, "answer_id": 40564045, "question_id": 40560382, "link": "https://stackoverflow.com/questions/40560382/how-do-i-make-the-partially-applied-function-type-into-a-functor/40564045#40564045", "title": "How do I make the partially-applied function type into a functor?", "body": "<p>Suggested by <a href=\"https://stackoverflow.com/users/3072788/alec\">Alex</a>:</p>\n\n<pre><code>newtype Ntype a b = N (a -&gt; b)\n\ninstance Functor (Ntype a) where\n    fmap f (N g) = N (f . g)\n</code></pre>\n\n<p>Thanks <a href=\"https://stackoverflow.com/users/3072788/alec\">Alex</a>!</p>\n"}], "owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 40564045, "answer_count": 1, "score": 1, "last_activity_date": 1478962325, "creation_date": 1478933819, "last_edit_date": 1495535559, "question_id": 40560382, "link": "https://stackoverflow.com/questions/40560382/how-do-i-make-the-partially-applied-function-type-into-a-functor", "title": "How do I make the partially-applied function type into a functor?", "body": "<p>There is an example program in <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\" rel=\"nofollow noreferrer\">Learn You a Haskell</a>:</p>\n\n<pre><code>instance Functor ((-&gt;) a) where\n    fmap = (.)\n</code></pre>\n\n<p>While I have trouble compiling it:</p>\n\n<blockquote>\n  <p>Duplicate instance declarations:</p>\n  \n  <p>instance Functor ((->) a) -- Defined at partiallyApplied.hs:6:10</p>\n  \n  <p>instance Functor ((->) r) -- Defined in \u2018GHC.Base\u2019</p>\n</blockquote>\n\n<p>As <a href=\"https://stackoverflow.com/questions/5643360/how-do-you-override-haskell-type-class-instances-provided-by-package-code\">How do you override Haskell type class instances provided by package code?</a> mention, I should define a new type for the declaration of <code>Functor</code>. I try so but fail:</p>\n\n<pre><code>newtype Ntype a = N ((-&gt;) a)\n\ninstance Functor ((-&gt;) a) where\n    fmap = (.)\n</code></pre>\n\n<blockquote>\n  <p>\u2022 Expecting one more argument to \u2018(->) a\u2019</p>\n  \n  <p>Expected a type, but \u2018(->) a\u2019 has kind \u2018* -> *\u2019</p>\n  \n  <p>\u2022 In the type \u2018(->) a\u2019</p>\n  \n  <p>In the definition of data constructor \u2018N\u2019</p>\n  \n  <p>In the newtype declaration for \u2018NewType\u2019</p>\n</blockquote>\n\n<p>How do I make it works?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1478931135, "post_id": 40560095, "comment_id": 68357696, "body": "Which, incidentally is <i>right after</i> <code>round</code> in the Prelude."}], "tags": [], "owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "is_accepted": true, "score": 9, "last_activity_date": 1478931081, "creation_date": 1478931081, "answer_id": 40560095, "question_id": 40560085, "link": "https://stackoverflow.com/questions/40560085/how-to-round-up-float-to-integer/40560095#40560095", "title": "How to round up float to integer", "body": "<p>You can use the <code>ceiling</code> function (in <code>Prelude</code>):</p>\n\n<pre><code>ghci&gt;&gt; ceiling 1.23\n2\n</code></pre>\n"}], "owner": {"reputation": 1179, "user_id": 6358607, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fc4656a64508378979d66b7693e19c9c?s=128&d=identicon&r=PG", "display_name": "Tri Nguyen", "link": "https://stackoverflow.com/users/6358607/tri-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3551, "favorite_count": 0, "accepted_answer_id": 40560095, "answer_count": 1, "score": 7, "last_activity_date": 1566729701, "creation_date": 1478930980, "last_edit_date": 1566729701, "question_id": 40560085, "link": "https://stackoverflow.com/questions/40560085/how-to-round-up-float-to-integer", "title": "How to round up float to integer", "body": "<p>I have a float <code>1.23</code> for instance, if I use <code>round</code>, it returns <code>1</code>. My desired output is <code>2</code>, which is round to the next integer. I can write a function to do it. I just wonder is there any already written function to do it (like <code>round</code>). Thanks.</p>\n"}, {"tags": ["haskell", "filter"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1478898445, "post_id": 40555972, "comment_id": 68350564, "body": "A solution would be using <code>map filter (==1)</code> this will yield the result given your input, and try to work your way back from there, best starting with the type signature"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1478898547, "post_id": 40555972, "comment_id": 68350603, "body": "What is the expected result of <code>[[],[1],[1,1],[1,2]]</code>"}, {"owner": {"reputation": 43, "user_id": 7134496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63ac9a8707442304ba149659c9e01b67?s=128&d=identicon&r=PG&f=1", "display_name": "Aez", "link": "https://stackoverflow.com/users/7134496/aez"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1478902299, "post_id": 40555972, "comment_id": 68352013, "body": "Maybe I should reword my question I did it generally so its easier to understand I just want filter to do something if its false and something else if its true"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1478899356, "last_edit_date": 1478899356, "creation_date": 1478898084, "answer_id": 40556158, "question_id": 40555972, "link": "https://stackoverflow.com/questions/40555972/how-do-you-make-a-custom-filter/40556158#40556158", "title": "How do you make a custom filter?", "body": "<p><code>myfilter</code> is correct. Like <code>filter</code>, all it does is, well, <em>filter</em> a list: it passes on some elements and some not, but it never changes any of them. </p>\n\n<p>Whereas you propose to have elements in the result that aren't in the original list. This can't be done with <code>filter</code>. However, there's another constant you have: you never change the <em>structure</em> of the (outer) list. So, this is a task for <code>map</code>. Where you do filter is on the <em>inner</em> lists, so you need to map the filtering over the outer list. Thanks to currying, this is extremely easy in Haskell:</p>\n\n<pre><code>Prelude&gt; map (filter isItOne) [[1],[2],[3],[1]]\n[[1],[],[],[1]]\n</code></pre>\n\n<p>Here, <code>isItOne</code> must have the signature <code>Integer -&gt; Bool</code>: it only works on single <em>elements</em> of the inner list, not on the whole inner list. That's what you implemented anyway.</p>\n\n<p>A couple of better ways to write <code>isItOne</code>:</p>\n\n<pre><code>iItOne :: Integer -&gt; Bool\n\nisItOne x | x == 1     = True\n          | otherwise  = False\n\nisItOne x = x==1\n\nisItOne = (==1)\n</code></pre>\n\n<p>In fact, you might as well just inline this:</p>\n\n<pre><code>Prelude&gt; map (filter (==1)) [[1],[2],[3],[1]]\n[[1],[],[],[1]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 3, "last_activity_date": 1478898106, "creation_date": 1478898106, "answer_id": 40556166, "question_id": 40555972, "link": "https://stackoverflow.com/questions/40555972/how-do-you-make-a-custom-filter/40556166#40556166", "title": "How do you make a custom filter?", "body": "<p><code>myfilter</code> doesn't know that it's working with lists of lists. Look at the type signature you gave <code>myfilter</code>:</p>\n\n<pre><code>myfilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p><code>[a]</code> means \"list of an arbitrary type <code>a</code>\"; <code>myfilter</code> doesn't know anything about <code>a</code>. So in the <code>otherwise</code> branch, the type-checker thinks \"you're trying to output an empty list, but I'm not certain that <code>a</code> is in fact a list\".</p>\n\n<p>One way to fix it would be to adjust the type signature to be more specific about the fact that we're working with nested lists:</p>\n\n<pre><code>myfilter :: ([a] -&gt; Bool) -&gt; [[a]] -&gt; [[a]]\n</code></pre>\n\n<p>Another problem you're having with this code is that you've forgotten to handle the case when the input list is empty. You need to add a clause matching the empty list:</p>\n\n<pre><code>myfilter p [] = []\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 0, "last_activity_date": 1478985552, "creation_date": 1478985552, "answer_id": 40567764, "question_id": 40555972, "link": "https://stackoverflow.com/questions/40555972/how-do-you-make-a-custom-filter/40567764#40567764", "title": "How do you make a custom filter?", "body": "<p>With those edits - I think the function should work a bit different, but first a solution to your problem</p>\n\n<pre><code>myfilter :: (a -&gt; Bool) -&gt; [[a]] -&gt; [[a]]\nmyfilter _ []                   = [ ]\nmyfilter p ([x]:xs) | p x       = [x]: myfilter p xs\n                    | otherwise = [ ]: myfilter p xs\nmyfilter p ( _ :xs)             = [ ]:myfilter p xs\n</code></pre>\n\n<p>But this is kind of clumsy to include the \"logic\" that you are looking for singleton lists in this function. I would rather write something like a <code>monoidalFilter</code> - which is a term I just invented. A monoid is something that allows for concatenation/addition/multiplication and has a neutral element think something like a zero or one.</p>\n\n<pre><code>monoidalFilter :: Monoid m :: (m -&gt; Bool) -&gt; [m] -&gt; [m]\nmonoidalFilter p = map (\\x -&gt; if p x then x else mempty)\n</code></pre>\n\n<p>then <code>monoidalFilter (==[1])</code> would do the trick</p>\n\n<pre><code>&gt; ghci tst.hs\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( tst.hs, interpreted )\nOk, modules loaded: Main.\n*Main&gt; monoidalFilter (==[1]) [[],[1],[1,1],[2,2]]\n[[],[1],[],[]]\n*Main&gt; myfilter (==1) [[],[1],[1,1],[2,2]]\n[[],[1],[],[]]\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 7134496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63ac9a8707442304ba149659c9e01b67?s=128&d=identicon&r=PG&f=1", "display_name": "Aez", "link": "https://stackoverflow.com/users/7134496/aez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1478985552, "creation_date": 1478897285, "last_edit_date": 1478905394, "question_id": 40555972, "link": "https://stackoverflow.com/questions/40555972/how-do-you-make-a-custom-filter", "title": "How do you make a custom filter?", "body": "<p>I am having trouble trying to figure this out myself with no success. I am trying to make my own Filter where instead of not including something in the List because it is false it does something. </p>\n\n<h3>The code</h3>\n\n<p>What I have tried:</p>\n\n<pre><code>myfilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nmyfilter p (x:xs)\n | p x = x : myfilter p xs\n | otherwise = []:myfilter p xs\n</code></pre>\n\n<p>I was trying to make myFilter add a blank [ ] to the output list for example.</p>\n\n<pre><code>myFilter isIt1andOnly1[[1],[2,2],[3,4]]])\n</code></pre>\n\n<h3>The output</h3>\n\n<p>What output should be:</p>\n\n<pre><code>[[1], [ ], [ ], []]\n</code></pre>\n\n<p>What the inbuilt filter does:</p>\n\n<pre><code>[[1]]\n</code></pre>\n\n<p>Any help is greatly appreciated.</p>\n\n<h3>EDIT:</h3>\n\n<p>Sorry for any misunderstandings I caused but I wasn't looking for </p>\n\n<pre><code>filter (==1) [list] \n</code></pre>\n\n<p>changed the question a bit to be a bit more specific on the issue of custom filter rather than filter (==1) [[randomlist]] </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1478896302, "post_id": 40555623, "comment_id": 68349582, "body": "you can rewrite this as <code>f d = d ++ (replicate 3 1)</code>.  Perhaps you wanted to express something else?"}, {"owner": {"reputation": 503, "user_id": 3925804, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/48dc4afd67e6e6b3e7172cbadc62fa1f?s=128&d=identicon&r=PG&f=1", "display_name": "theluckyemil", "link": "https://stackoverflow.com/users/3925804/theluckyemil"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1478898010, "post_id": 40555623, "comment_id": 68350396, "body": "@karakfa I put 1 for simplicity, consider this e ^ x - 2016"}], "answers": [{"tags": [], "owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "is_accepted": true, "score": 7, "last_activity_date": 1478895943, "creation_date": 1478895943, "answer_id": 40555657, "question_id": 40555623, "link": "https://stackoverflow.com/questions/40555623/passing-lambda-function-as-an-argument-of-hof/40555657#40555657", "title": "passing lambda function as an argument of HOF", "body": "<p><code>where</code> clauses apply to declaration groups, not to expressions. You use <code>let</code> instead:</p>\n\n<pre><code>(\\acc x -&gt; let distance = 1 in acc ++ [distance])\n</code></pre>\n"}], "owner": {"reputation": 503, "user_id": 3925804, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/48dc4afd67e6e6b3e7172cbadc62fa1f?s=128&d=identicon&r=PG&f=1", "display_name": "theluckyemil", "link": "https://stackoverflow.com/users/3925804/theluckyemil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 40555657, "answer_count": 1, "score": 1, "last_activity_date": 1478895943, "creation_date": 1478895747, "question_id": 40555623, "link": "https://stackoverflow.com/questions/40555623/passing-lambda-function-as-an-argument-of-hof", "title": "passing lambda function as an argument of HOF", "body": "<p>I have a function like this    </p>\n\n<pre><code>f d = foldl (\\acc x -&gt; acc ++ [distance] where distance = 1) d [1..3]\n</code></pre>\n\n<p>For some GHCI says:</p>\n\n<pre><code>error: parse error on input \u2018where\u2019\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "aeson"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478895896, "post_id": 40555584, "comment_id": 68349414, "body": "There is indeed a type mismatch, and I&#39;m quite sure you aren&#39;t doing the same thing as the tutorial. To see why, consider what the type of <code>Data.Aeson.String x</code> is."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1478904938, "post_id": 40555584, "comment_id": 68352934, "body": "Where does it appear to be done in that tutorial?"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1478905798, "last_edit_date": 1478905798, "creation_date": 1478904816, "answer_id": 40557456, "question_id": 40555584, "link": "https://stackoverflow.com/questions/40555584/why-is-aeson-not-pattern-matching-text/40557456#40557456", "title": "Why is Aeson not pattern-matching Text?", "body": "<blockquote>\n  <p>It says the pattern expected Text whereas the actual type was aeson Value. But it is clearly Text as marked by the type annotation</p>\n</blockquote>\n\n<p>The value being matched is indeed of type <code>Text</code>. But the pattern you are matching against is not a pattern for the type <code>Text</code>; instead, it is a pattern for the type <code>Value</code>. You cannot match a value of one type against a pattern of another type, for obvious reasons.</p>\n\n<p>There are many possible fixes, but it's difficult to choose one to suggest, because you have said little about what you are trying to do. <em>Possibly</em> you were intending to parse the <code>Text</code> into a <code>Value</code> and check which kind of value it was:</p>\n\n<pre><code>case decode (fromStrict (encodeUtf8 \"\\\"match\\\"\")) of\n    Just (String x) -&gt; \"match\"\n    Just _ -&gt; \"no match\"\n    Nothing -&gt; \"invalid JSON\"\n</code></pre>\n\n<p>However, I suspect that you are actually just misunderstanding how to use aeson, and should be writing a <code>FromJSON</code> instance (or using an existing one) rather than trying to muck about with <code>Text</code> values directly. For example, to parse a JSON value as <code>Text</code>, you might reuse the existing <code>FromJSON</code> instance for <code>Text</code> to write:</p>\n\n<pre><code>case decode \"\\\"match\\\"\" of\n    Just v -&gt; Data.Text.putStrLn v\n    Nothing -&gt; putStrLn \"invalid JSON\"\n</code></pre>\n\n<p>Again, both of these suggestions are pure speculation due to how light the question is on bigger-picture goals.</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 40557456, "answer_count": 1, "score": 0, "last_activity_date": 1478905798, "creation_date": 1478895505, "last_edit_date": 1478895627, "question_id": 40555584, "link": "https://stackoverflow.com/questions/40555584/why-is-aeson-not-pattern-matching-text", "title": "Why is Aeson not pattern-matching Text?", "body": "<p>I am trying to pattern-match Text to aeson Value using the String constructor, and am running into compile errors. The following example program illustrates the issue I've been running into.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport qualified Data.Text\nimport qualified Data.Aeson\n\nmain = print $\n  case (\"here\" :: Data.Text.Text) of\n  (Data.Aeson.String x) -&gt; \"match\"\n  _                     -&gt; \"no match\"\n</code></pre>\n\n<p>As shown I am trying to get the Text \"here\" to pattern-match into Aeson's 'String' Value constructor. I think that this program should pattern match the Text to Aeson String and print \"match\". But the program does not compile. Instead I get the following error:</p>\n\n<pre><code>$ ghc scratch.hs \n[1 of 1] Compiling Main             ( scratch.hs, scratch.o )\n\nscratch.hs:9:4: error:\n    \u2022 Couldn't match expected type \u2018Data.Text.Text\u2019\n                  with actual type \u2018Data.Aeson.Value\u2019\n    \u2022 In the pattern: Data.Aeson.String x\n      In a case alternative: (Data.Aeson.String x) -&gt; \"match\"\n      In the second argument of \u2018($)\u2019, namely\n        \u2018case (\"here\" :: Data.Text.Text) of {\n           (Data.Aeson.String x) -&gt; \"match\"\n           _ -&gt; \"no match\" }\u2019\n</code></pre>\n\n<p>It says the pattern expected Text whereas the actual type was aeson Value. But it is clearly Text as marked by the type annotation (\"here\" :: Data.Text.Text). I don't understand why I am getting this error. Pattern-matching Text to aeson Value via the String constructor appears to be done in <a href=\"https://artyom.me/aeson\" rel=\"nofollow noreferrer\">this aeson tutorial</a>, and I don't see why it does not also work in my example here.</p>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1478891882, "post_id": 40553192, "comment_id": 68347679, "body": "As far as 2) goes, you...wouldn&#39;t, in real code, it&#39;s just a toy example."}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 4, "last_activity_date": 1478885952, "creation_date": 1478885952, "answer_id": 40553366, "question_id": 40553192, "link": "https://stackoverflow.com/questions/40553192/understanding-monadic-fibonacci/40553366#40553366", "title": "Understanding Monadic Fibonacci", "body": "<p>In this example, the state is a pair containing the previous two numbers generated in the sequence. This is initially <code>(0, 1)</code> provided to <code>evalState</code>.</p>\n\n<p>The type of <code>get</code> is <code>MonadState s m =&gt; m s</code> so in the inner <code>do</code> block</p>\n\n<pre><code>(a, b) &lt;- get\n</code></pre>\n\n<p>fetches the state pair and binds <code>a</code> and <code>b</code> to the first and second elements respectively. The state is then updated in the following <code>put</code>. </p>\n\n<p>The state will therefore be:</p>\n\n<pre><code>(0, 1), (1, 1), (1, 2), (3, 2), (3, 5), ...\n</code></pre>\n\n<p>The outer </p>\n\n<pre><code>(a, b) &lt;- get\nreturn a\n</code></pre>\n\n<p>unpacks the final state value and returns the first element.</p>\n"}, {"tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 3, "last_activity_date": 1478896329, "last_edit_date": 1478896329, "creation_date": 1478895526, "answer_id": 40555591, "question_id": 40553192, "link": "https://stackoverflow.com/questions/40553192/understanding-monadic-fibonacci/40555591#40555591", "title": "Understanding Monadic Fibonacci", "body": "<p>First lets make clear the Fibonacci algorithm being used. The idea is to start with the tuple <code>(0, 1)</code>, then find the next as <code>(1, 0 + 1)</code>, the next as <code>(1, 1 + 1)</code>, <code>(2, 2 + 1)</code>, <code>(3, 3 + 2)</code>, and so on. Generally, the step is <code>\\(a, b) -&gt; (b, a + b)</code>. You can see that in these tuples are the Fibonacci numbers.</p>\n\n<blockquote>\n  <p>What is going inside the first statement of the inner do, i.e what\n  does (a,b)&lt;-get result into?</p>\n</blockquote>\n\n<p>Haskell does not have statements, only expressions.</p>\n\n<p><code>y &lt;- x</code> is not a complete expression. It is similar to <code>x &gt;&gt;= \\y -&gt;</code>.</p>\n\n<pre><code>y &lt;- x\nm\n</code></pre>\n\n<p>Is a complete expression and is equivalent to <code>x &gt;&gt;= \\y -&gt; m</code>. A line <code>n</code> not of the form <code>y &lt;- n</code> is equivalent to <code>_ &lt;- n</code> (excluding <code>let</code> lines and maybe some others I forget).</p>\n\n<p>Using this we can desugar do-notation.</p>\n\n<pre><code>fib n =\n  flip evalState (0, 1)\n  ( forM\n      [0..(n-1)]\n      (\\_ -&gt; get &gt;&gt;= (\\(a, b) -&gt; put (b, a + b)))\n    &gt;&gt;= (\\_ -&gt; get &gt;&gt;= (\\(a, b) -&gt; return a)))\n  )\n</code></pre>\n\n<p>Now it is just about understanding <code>&gt;&gt;=</code>, <code>return</code>, <code>get</code>, <code>put</code>, and so on.</p>\n\n<p>State is actually just functions of the type <code>s -&gt; (s, a)</code>. They take an initial state and yield the next state plus some other value.</p>\n\n<p><code>m &gt;&gt;= n</code> a.k.a. \"bind\" has the type <code>Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code>. Then, if our Monad is <code>State s</code>, this is the same as:</p>\n\n<pre><code>m &gt;&gt;= n ::\n     (     s -&gt; (s, a))\n  -&gt; (a -&gt; s -&gt; (s, b))\n  -&gt; (     s -&gt; (s, b))\n</code></pre>\n\n<p>The <code>a</code> returned by <code>m</code> has to be passed to <code>n</code>. What else can we guess? We expect the state to pass along as well, so the state returned by <code>m</code> must be passed to <code>n</code> as well. The function <code>m &gt;&gt;= n</code> must return the state and value that <code>n</code> returns. We then know how to implement bind:</p>\n\n<pre><code>m &gt;&gt;= n = uncurry (flip n) . m\n</code></pre>\n\n<p><code>return :: Monad m =&gt; a -&gt; m a</code> which is then equivalent to <code>return :: a -&gt; s -&gt; (s, a)</code>:</p>\n\n<pre><code>return = flip (,)\n</code></pre>\n\n<p><code>get :: State s s</code> is equivalent to <code>get :: s -&gt; (s, s)</code>:</p>\n\n<pre><code>get = join (,)\n</code></pre>\n\n<p><code>put :: s -&gt; State s ()</code> or <code>put :: s -&gt; s -&gt; (s, ())</code>:</p>\n\n<pre><code>put s _ = (s, ())\n</code></pre>\n\n<p><code>evalState :: s -&gt; State s a -&gt; a</code> or <code>evalState :: s -&gt; (s -&gt; (s, a)) -&gt; a</code>:</p>\n\n<pre><code>evalState s f = snd (f s)\n</code></pre>\n\n<p>You can expand all the definitions and see exactly what is happening in the example. Just the intuitions should suffice though.</p>\n\n<pre><code>forM\n  [0..(n-1)]\n  (\\_ -&gt; get &gt;&gt;= (\\(a, b) -&gt; put (b, a + b)))\n</code></pre>\n\n<p>We don't care about having the numbers <code>0</code> to <code>n - 1</code> so the first argument is dropped. <code>get</code> retrieves the current state, then <code>put</code> writes the new state. We do this <code>n</code> times.</p>\n\n<pre><code>&gt;&gt;= (\\_ -&gt; get &gt;&gt;= (\\(a, b) -&gt; return a)))\n</code></pre>\n\n<p>We don't care about the accumulated value (which is unit) and so the first parameter is dropped. Then we get the current state and project just the first element of the pair. This is the final answer we're looking for.</p>\n\n<pre><code>flip evalState (0, 1) \u2026\n</code></pre>\n\n<p>Finally we run starting from the initial state <code>(0, 1)</code>.</p>\n\n<p>There are some cleanups we can make to this implementation. First, we don't care about the range <code>[0..(n-1)]</code>, we just care about repeating an action <code>n</code> times. A more direct way to do this is the following:</p>\n\n<pre><code>replicateM n (get &gt;&gt;= \\(a, b) -&gt; put (b, a + b))\n</code></pre>\n\n<p>The result is a list of unit which is unused, so a more efficient version is:</p>\n\n<pre><code>replicateM_ n (get &gt;&gt;= \\(a, b) -&gt; put (b, a + b))\n</code></pre>\n\n<p>There is already a function for the common pattern of <code>get</code> followed by <code>put</code> named <code>modify</code>, which is defined as <code>\\f -&gt; get &gt;&gt;= put . f</code>. Therefore:</p>\n\n<pre><code>replicateM_ n (modify (\\(a, b) -&gt; (b, a + b)))\n</code></pre>\n\n<p>Then there is the part:</p>\n\n<pre><code>&gt;&gt;= (\\_ -&gt; get &gt;&gt;= (\\(a, b) -&gt; return a)))\n</code></pre>\n\n<p>Any time we don't care about the previous result we can use <code>&gt;&gt;</code>.</p>\n\n<pre><code>&gt;&gt; get &gt;&gt;= (\\(a, b) -&gt; return a))\n</code></pre>\n\n<p>This is:</p>\n\n<pre><code>&gt;&gt; get &gt;&gt;= return . fst\n</code></pre>\n\n<p><code>m &gt;&gt;= return . f</code> simplifies to <code>fmap f m</code>:</p>\n\n<pre><code>&gt;&gt; fmap fst get\n</code></pre>\n\n<p>Now we have, in total:</p>\n\n<pre><code>fib n =\n  evalState\n  (  replicateM_ n (modify (\\(a, b) -&gt; (b, a + b)))\n  &gt;&gt; fmap fst get\n  )\n  (0, 1)\n</code></pre>\n\n<p>We might also use, for comparison:</p>\n\n<pre><code>fib n =\n  fst\n  ( evalState\n    (  replicateM_ n (modify (\\(a, b) -&gt; (b, a + b)))\n    &gt;&gt; get\n    )\n    (0, 1)\n  )\n</code></pre>\n\n<p>And then because I am silly:</p>\n\n<pre><code>fib =\n  fst\n  . flip evalState (0, 1)\n  . (&gt;&gt; get)\n  . flip replicateM_ (modify (snd &amp;&amp;&amp; uncurry (+)))\n</code></pre>\n\n<blockquote>\n  <p>Why would you want to use the state monad over here?</p>\n</blockquote>\n\n<p>You wouldn't. This is clear because we only use the state value; the other value is always unit and discarded. In other words, we only need <code>n</code> (i.e. which Fibonacci number to find) at the beginning and afterwards we only need the accumulated tuple.</p>\n\n<p>Sometimes you think to have a string of compositions like <code>h . g . f</code> but you want to send two arguments through instead of just one. That is when <code>State</code> may be applicable.</p>\n\n<p>If some functions read and some write the state (the second argument), or do both, then <code>State</code> fits the bill. If there are only readers then use <code>Reader</code> and if there are only writers then use <code>Writer</code>.</p>\n\n<p>We can alter the example to make better use of the State Monad. I will make the tuple disappear!</p>\n\n<pre><code>fib =\n  flip evalState 0\n  . foldr (=&lt;&lt;) (return 1)\n  . flip replicate (\\x -&gt; get &gt;&gt;= \\y -&gt; put x $&gt; x + y)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384, "user_id": 4098149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4eff262713ed007414ceb4e35f6b63f5?s=128&d=identicon&r=PG&f=1", "display_name": "Schoon", "link": "https://stackoverflow.com/users/4098149/schoon"}, "is_accepted": false, "score": 2, "last_activity_date": 1502109805, "last_edit_date": 1502109805, "creation_date": 1478977302, "answer_id": 40566542, "question_id": 40553192, "link": "https://stackoverflow.com/questions/40553192/understanding-monadic-fibonacci/40566542#40566542", "title": "Understanding Monadic Fibonacci", "body": "<p>So the docs state: <code>get :: m s  -- Return the state from the internals of the monad</code> (see <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Lazy.html\" rel=\"nofollow noreferrer\">here</a>).</p>\n\n<p>But I remember very well that when I tried to wrap my head around the State Monad this didn't help me a lot.</p>\n\n<p>I can only recommend playing around with <code>:i</code> and <code>:t</code> in ghci and test out different sub-expressions. Just to get a feel for it. A bit like this:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code> import Control.Monad.State.Lazy \n\n runState (get) 0\n runState (get &gt;&gt;= \\x -&gt; put (x+1)) 0\n :t return 1 :: State Int Int\n runState (return 1) 0\n runState (return 1 &gt;&gt;= \\x -&gt; (get &gt;&gt;= \\y -&gt; return (x+y))) 0 \n\n -- Keeping a pair of (predecessor/current) in the state:\n let f = (get &gt;&gt;= (\\(a,b) -&gt; put (b,a+b))) :: State  (Int, Int) ()\n runState (f &gt;&gt; f &gt;&gt; f &gt;&gt; f &gt;&gt; f &gt;&gt; f) (0,1) \n\n -- only keeping the predecessor in the state:\n let f x = (get &gt;&gt;= (\\y -&gt; put x &gt;&gt; return (x+y))) :: State Int Int\n runState (return 1 &gt;&gt;= f &gt;&gt;= f &gt;&gt;= f &gt;&gt;= f &gt;&gt;= f &gt;&gt;= f) 0 \n</code></pre>\n\n<p>Also play around with <code>modify</code>, <code>runState</code>, <code>evalState</code>, <code>execState</code>.</p>\n"}], "owner": {"reputation": 49, "user_id": 6790573, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e2c1bc451bf0a06a5efca18111a4ba6?s=128&d=identicon&r=PG&f=1", "display_name": "McGill", "link": "https://stackoverflow.com/users/6790573/mcgill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 444, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1502109805, "creation_date": 1478885180, "question_id": 40553192, "link": "https://stackoverflow.com/questions/40553192/understanding-monadic-fibonacci", "title": "Understanding Monadic Fibonacci", "body": "<p>I am learning haskell and learning monads. I've watched and read various tutorials and coded some simple examples for state monad, however I am not able to understand the following piece of code (taken from Haskell Wiki):</p>\n\n<pre><code>import Control.Monad.State\nfib n = flip evalState (0,1) $ do\n  forM [0..(n-1)] $ \\_ -&gt; do\n    (a,b) &lt;- get\n    put (b,a+b)\n  (a,b) &lt;- get\n  return a\n</code></pre>\n\n<p>My question boils down to the following:</p>\n\n<ol>\n<li>What is going inside the first statement of the inner do, i.e what does <code>(a,b)&lt;-get</code> result into. What will be the values of <code>a</code> and <code>b</code> for some concrete example.</li>\n<li>Why would you want to use the state monad over here?</li>\n</ol>\n"}, {"tags": ["haskell", "monads", "arrows"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1478895350, "post_id": 40553131, "comment_id": 68349187, "body": "Maybe you want <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Arrow.html#t:ArrowMonad\" rel=\"nofollow noreferrer\"><code>Control.Arrow.ArrowMonad</code></a> ? When <code>b</code> is not <code>()</code> I guess it&#39;s trickier to define a sensible monad instance."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1478896264, "post_id": 40553131, "comment_id": 68349560, "body": "In order to define such an instance, you would additionally need a function <code>swap :: forall x y z . arr x (arr y z) -&gt; arr y (arr x z)</code> ; then <code>&gt;&gt;= = \\x f -&gt; swap (arr f) &amp;&amp;&amp; x &gt;&gt;&gt; app</code>. It is fairly easy to define such a function for the <code>Arrow</code> instances in <code>base</code>, but I can&#39;t say how useful it is in general."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1478902213, "post_id": 40553131, "comment_id": 68351980, "body": "Regarding your edit: you probably already know that, but in any case it is worth mentioning that you might write <code>action1 &gt;=&gt; action2 &gt;=&gt; action3</code> instead (<code>(&gt;=&gt;)</code> is literally <code>(&gt;&gt;&gt;)</code> for Kleisli arrows)."}, {"owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478902564, "post_id": 40553131, "comment_id": 68352126, "body": "@duplode sure, but I really want a nice looking do notation (it&#39;s Shake file, I want it to look very imperative)."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478975805, "post_id": 40561803, "comment_id": 68369356, "body": "Given the analogous functions in <i>base</i>, <code>ArrowFlip</code> and <code>flip</code> would arguably be more transparent names."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478979015, "post_id": 40561803, "comment_id": 68370282, "body": "@duplode I completely agree! I initially had it written as such, but that meant that for my sample instance I&#39;d have to import the Prelude qualified, and then use the qualified <code>flip</code>. I thought that might not be worth it. :)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478979791, "post_id": 40561803, "comment_id": 68370483, "body": "That would be annoying indeed. In fact, I had momentarily forgotten that, at some point while playing with this question, I had in fact defined a <code>fleep</code> function in GHCi :)"}, {"owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "edited": false, "score": 0, "creation_date": 1478980158, "post_id": 40561803, "comment_id": 68370590, "body": "Thanks for reminding me of <code>RebindableSyntax</code>! It should also be useful until <code>ApplicativeDo</code> becomes smart enough to put <code>*&gt;</code> instead of <code>&gt;&gt;</code>. (<a href=\"https://ghc.haskell.org/trac/ghc/ticket/12666\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/12666</a>)"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1478945761, "creation_date": 1478945761, "answer_id": 40561803, "question_id": 40553131, "link": "https://stackoverflow.com/questions/40553131/can-we-define-a-monad-instance-for-wrappedarrow/40561803#40561803", "title": "Can we define a Monad instance for WrappedArrow?", "body": "<p>Since this is an XY problem, I'll answer both the question you asked, and the question you probably wanted to ask:</p>\n\n<blockquote>\n  <p><code>WrappedArrow</code> is an instance of <code>Applicative</code>, but can it be made a <code>Monad</code> (probably if the arrow is <code>ArrowApply</code>)?</p>\n</blockquote>\n\n<p>Yes it can, but you'll need more constraints. In fact, I think there are several ways to do this. For example, you could take the approach suggested by @user2407038:</p>\n\n<pre><code>class Arrow a =&gt; ArrowSwap a where\n  swap :: a b (a c d) -&gt; a c (a b d)\n\ninstance (ArrowApply a, ArrowSwap a) =&gt; Monad (WrappedArrow a b) where\n  return = pure\n  WrapArrow m &gt;&gt;= f = WrapArrow $ swap (arr (unwrapArrow . f)) &amp;&amp;&amp; m &gt;&gt;&gt; app\n</code></pre>\n\n<p>You can get some intuition for <code>ArrowSwap</code> via its instance for <code>(-&gt;)</code>:</p>\n\n<pre><code>instance ArrowSwap (-&gt;) where\n  swap :: (b -&gt; (c -&gt; d)) -&gt; c -&gt; b -&gt; d\n  swap = flip\n</code></pre>\n\n<p>Of course, it isn't immediately clear that this is useful...</p>\n\n<blockquote>\n  <p>My initial purpose was to have a Monad instance for (wrapped) Kleisli,\n  so I could write</p>\n\n<pre><code>runWithInput input $ do\n  action1\n  action2\n  action3\n  ...\n</code></pre>\n  \n  <p>instead of</p>\n\n<pre><code>do\n  output1 &lt;- action1 input\n  output2 &lt;- action2 output1\n  output3 &lt;- action3 output2\n  ...\n</code></pre>\n</blockquote>\n\n<p>This is what <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#rebindable-syntax-and-the-implicit-prelude-import\" rel=\"nofollow noreferrer\"><code>RebindableSyntax</code></a> is for:</p>\n\n<pre><code> {-# LANGUAGE RebindableSyntax #-}\n\n import Control.Monad (&gt;=&gt;)\n\n action1 :: Monad m =&gt; T1 -&gt; m T2\n action2 :: Monad m =&gt; T2 -&gt; m T3\n action3 :: Monad m =&gt; T3 -&gt; m T4\n\n action4 :: Monad m =&gt; T1 -&gt; m T4\n action4 = let (&gt;&gt;) = (&gt;=&gt;) in do\n   action1\n   action2\n   action3\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1478980087, "post_id": 40566279, "comment_id": 68370572, "body": "I was doing something similar last night and I thought about adding a <code>Monoid</code> or <code>Default</code> constraint (to deal with the problem of <code>()</code>). But I am not sure that would give something satisfying the <code>Monad</code> laws. My intuition says not... Nice explanation!"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1478980804, "last_edit_date": 1492086747, "creation_date": 1478975659, "answer_id": 40566279, "question_id": 40553131, "link": "https://stackoverflow.com/questions/40553131/can-we-define-a-monad-instance-for-wrappedarrow/40566279#40566279", "title": "Can we define a Monad instance for WrappedArrow?", "body": "<blockquote>\n  <p><code>WrappedArrow</code> is an instance of <code>Applicative</code>, but can it be made a <code>Monad</code> (probably if the arrow is <code>ArrowApply</code>)?</p>\n</blockquote>\n\n<p>I will put <code>WrappedArrow</code> aside for a moment and consider the subtly different question \"Can we successfully implement <code>instance ArrowApply y =&gt; Monad (y r)</code>?\". The answer to this question is \"yes\". One way of demonstrating it relies on the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Arrow.html#t:ArrowMonad\" rel=\"nofollow noreferrer\"><code>ArrowMonad</code></a> newtype chi mentions...</p>\n\n<pre><code>newtype ArrowMonad a b = ArrowMonad (a () b)\n</code></pre>\n\n<p>... and the following isomorphism (cf. <a href=\"https://cstheory.stackexchange.com/q/32257/35281\">this cstheory.SE question</a> and page 18 of <a href=\"http://homepages.inf.ed.ac.uk/wadler/papers/arrows-and-idioms/arrows-and-idioms.pdf\" rel=\"nofollow noreferrer\"><em>Idioms are oblivious, arrows are meticulous, monads are promiscuous</em></a>):</p>\n\n<pre><code>kleislify :: ArrowApply y =&gt; y r a -&gt; (r -&gt; y () a)\nkleislify af = \\r -&gt; arr (const r) &gt;&gt;&gt; af\n\nunkleislify :: ArrowApply y =&gt; (r -&gt; y () a) -&gt; y r a\nunkleislify f = arr f &amp;&amp;&amp; arr (const ()) &gt;&gt;&gt; app\n\n-- unkleislify . kleislify = kleislify . unkleislify = id\n</code></pre>\n\n<p><code>ArrowMonad</code> gives us a monad instance that we can use by <code>kleislify</code>-ing the arrows and supplying a common argument to the resulting functions (in other words, we are using the <code>ArrowMonad</code> bind through the applicative instance for functions):</p>\n\n<pre><code>bindY :: ArrowApply y =&gt; y r a -&gt; (a -&gt; y r b) -&gt; y r b\nbindY af h = unkleislify $ (\\(ArrowMonad am) -&gt; am) . (\\r -&gt;\n    ArrowMonad (kleislify af r) &gt;&gt;= \\x -&gt; ArrowMonad (kleislify (h x) r))\n</code></pre>\n\n<p>The relevant <code>return</code> is also the <code>ArrowMonad</code> one, couched in the appropriate layers of boilerplate:</p>\n\n<pre><code>returnY :: ArrowApply y =&gt; a -&gt; y r a\nreturnY x = unkleislify $ \\r -&gt; (\\(ArrowMonad am) -&gt; am) (return x)\n</code></pre>\n\n<p>This, however, does not answer your question. For that to happen, <code>bindY</code> and <code>returnY</code> should be consistent with the <code>Applicative</code> instance of <code>WrappedArrow</code>; that is, we should have <code>returnY x = arr (const x)</code>, and the <code>ap</code> we can write with <code>bindY</code> and <code>returnY</code> should be equivalent to <code>(&lt;*&gt;)</code> for <code>WrappedMonad</code>. For instance, we might try using the definitions of the relevant <code>ArrowMonad</code> instances...</p>\n\n<pre><code>instance Arrow a =&gt; Applicative (ArrowMonad a) where\n   pure x = ArrowMonad (arr (const x))\n   ArrowMonad f &lt;*&gt; ArrowMonad x = ArrowMonad (f &amp;&amp;&amp; x &gt;&gt;&gt; arr (uncurry id))\n\ninstance ArrowApply a =&gt; Monad (ArrowMonad a) where\n    ArrowMonad m &gt;&gt;= f = ArrowMonad $\n        m &gt;&gt;&gt; arr (\\x -&gt; let ArrowMonad h = f x in (h, ())) &gt;&gt;&gt; app  \n</code></pre>\n\n<p>... to expand (and then hopefully simplify) <code>returnY</code>:</p>\n\n<pre><code>returnY\nunkleislify $ \\r -&gt; (\\(ArrowMonad am) -&gt; am) (return x)\nunkleislify $ \\r -&gt; (\\(ArrowMonad am) -&gt; am) (ArrowMonad (arr (const x)))\nunkleislify $ \\r -&gt; arr (const x)\narr (\\r -&gt; arr (const x)) &amp;&amp;&amp; arr (const ()) &gt;&gt;&gt; app\narr (const (arr (const x))) &amp;&amp;&amp; arr (const ()) &gt;&gt;&gt; app\narr (\\r -&gt; (r, r)) &gt;&gt;&gt; arr (const (arr (const x))) *** arr (const ()) &gt;&gt;&gt; app\narr (\\r -&gt; (arr (const x), ())) &gt;&gt;&gt; app\n</code></pre>\n\n<p>I have no idea whether that can be simplified to <code>arr (const x)</code> for any <code>ArrowApply</code>. Perhaps being able to flip arrows (as Alec and user2407038 suggest) would help getting rid of the <code>()</code>, but I haven't worked that out. In any case, for <code>Kleisli</code> at least we can carry on:</p>\n\n<pre><code>arr (\\r -&gt; (arr (const x), ())) &gt;&gt;&gt; app\nKleisli (\\r -&gt; return (arr (const x), ())) &gt;&gt;&gt; Kleisli (\\(Kleisli f, x) -&gt; f x)\nKleisli ((\\r -&gt; return (arr (const x), ())) &gt;=&gt; (\\(Kleisli f, x) -&gt; f x))\nKleisli ((\\r -&gt; return (Kleisli (return . const x), ()))\n    &gt;=&gt; (\\(Kleisli f, x) -&gt; f x))\nKleisli (\\r -&gt; return (Kleisli (return . const x), ())\n    &gt;&gt;= (\\(Kleisli f, x) -&gt; f x))\nKleisli (\\r -&gt; (\\(Kleisli f, x) -&gt; f x) (Kleisli (return . const x), ()))\nKleisli (\\r -&gt; (return . const x) ())\nKleisli (\\r -&gt; return x)\nKleisli (return . const x)\narr (const x)\n</code></pre>\n\n<p>I haven't attempted doing the same with <code>bindY</code>, but my uninformed guess is that a similar scenario would result.</p>\n"}], "owner": {"reputation": 1051, "user_id": 713303, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/sbOcy.png?s=128&g=1", "display_name": "modular", "link": "https://stackoverflow.com/users/713303/modular"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 40561803, "answer_count": 2, "score": 2, "last_activity_date": 1478980804, "creation_date": 1478884960, "last_edit_date": 1478901175, "question_id": 40553131, "link": "https://stackoverflow.com/questions/40553131/can-we-define-a-monad-instance-for-wrappedarrow", "title": "Can we define a Monad instance for WrappedArrow?", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#t:WrappedArrow\" rel=\"nofollow noreferrer\"><code>WrappedArrow</code></a> is an instance of <code>Applicative</code>, but can it be made a <code>Monad</code> (probably if the arrow is <code>ArrowApply</code>)?</p>\n\n<pre><code>instance ArrowApply a =&gt; Monad (WrappedArrow a b) where\n  return = pure\n  (&gt;&gt;) = (*&gt;)\n  (&gt;&gt;=) = ???\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>My initial purpose was to have a Monad instance for (wrapped) Kleisli, so I could write</p>\n\n<pre><code>runWithInput input $ do\n  action1\n  action2\n  action3\n  ...\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>do\n  output1 &lt;- action1 input\n  output2 &lt;- action2 output1\n  output3 &lt;- action3 output2\n  ...\n</code></pre>\n\n<p>But I realized that won't make desirable sense. Stripped of newtypes, <code>Kleisli f a b &gt;&gt; Kleisli f a c</code> is</p>\n\n<pre><code>(a -&gt; f b) -&gt; (a -&gt; f c) -&gt; (a -&gt; f c)\n</code></pre>\n\n<p>And what I need is analog of <code>&gt;&gt;&gt;</code>, i.e. <strong>b</strong> instead of second <code>a</code>:</p>\n\n<pre><code>(a -&gt; f b) -&gt; (b -&gt; f c) -&gt; (a -&gt; f c)\n</code></pre>\n\n<p>So I suppose I will have to use <code>StateT</code> or a custom monad if I want to sequence actions in this manner with <code>do</code>.</p>\n"}, {"tags": ["haskell", "tree"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1478882654, "post_id": 40552369, "comment_id": 68343251, "body": "~~You don&#39;t show how you&#39;ve tried to use <code>isOrderedTree</code>.~~ Whoops, you did, but one couldn&#39;t read it due to formatting."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1478904017, "post_id": 40552369, "comment_id": 68352640, "body": "A side note: this implementation may not be correct, depending on exactly what &quot;ordered&quot; means. For example, is <code>Node 1 (Node 0 Nil (Node 2 Nil Nil)) Nil</code> -- which has <code>2</code> in the &quot;smaller&quot; subtree of the <code>1</code> node -- ordered or not? What does your function say for this case?"}, {"owner": {"reputation": 93, "user_id": 3316136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0fb34eb1ac5b899442d2d02e4b548083?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3316136/alexander"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1478973517, "post_id": 40552369, "comment_id": 68368626, "body": "@DanielWagner Thanks, I have now adressed this problem."}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 2, "creation_date": 1478883520, "post_id": 40552606, "comment_id": 68343736, "body": "Or you can use <code>-XTypeApplications</code> from GHC 8 like <code>isOrderedTree @() Nil</code> or <code>isOrderedTree @Int Nil</code>. It is shorter than explicit type specification."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1478882999, "creation_date": 1478882999, "answer_id": 40552606, "question_id": 40552369, "link": "https://stackoverflow.com/questions/40552369/usage-of-ord-for-binary-tree/40552606#40552606", "title": "Usage of Ord for binary tree", "body": "<p>You need to provide a concrete type for <code>Nil</code>, even though the particular type is not important.</p>\n\n<pre><code>-- All of the following should return True\nisOrderedTree (Nil :: Tree ())\nisOrderedTree (Nil :: Tree Integer)\nisOrderedTree (Nil :: Tree Char)\n-- etc\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 3316136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0fb34eb1ac5b899442d2d02e4b548083?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3316136/alexander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "accepted_answer_id": 40552606, "answer_count": 1, "score": 0, "last_activity_date": 1478973619, "creation_date": 1478882197, "last_edit_date": 1478973619, "question_id": 40552369, "link": "https://stackoverflow.com/questions/40552369/usage-of-ord-for-binary-tree", "title": "Usage of Ord for binary tree", "body": "<p>I am currently working on an assignment where I have to create a binary tree in Haskell.</p>\n\n<p>We have to use the following data type definition:</p>\n\n<pre><code>data Tree a = Nil | Node a (Tree a) (Tree a) deriving (Eq,Ord,Show)\n</code></pre>\n\n<p>A tree with the value Nil is an empty (ordered) tree and a non-empty tree consists of a value and two subtrees.</p>\n\n<p>I have to write a function \"isOrderedTree\" which returns True for an ordered tree and False for an unordered one.</p>\n\n<p>The function is defined like this:</p>\n\n<pre><code>isOrderedTree :: Ord a =&gt; Tree a -&gt; Bool\nisOrderedTree Nil = True\nisOrderedTree (Node x Nil Nil) = True\nisOrderedTree (Node x (Node y a b) Nil) = x &gt; y &amp;&amp; isOrderedTree (Node y a b) &amp;&amp; x &gt; getMax (getValues (Node y a b))\nisOrderedTree (Node x Nil (Node y a b)) = y &gt; x &amp;&amp; isOrderedTree (Node y a b) &amp;&amp; x &lt; getMin (getValues (Node y a b))\nisOrderedTree (Node x (Node y a b) (Node z c d)) = x &gt; y &amp;&amp; x &lt; z &amp;&amp; isOrderedTree (Node y a b) &amp;&amp; isOrderedTree (Node z c d) &amp;&amp; x &gt; getMax (getValues (Node y a b)) &amp;&amp; x &lt; getMin (getValues (Node z c d))\n</code></pre>\n\n<p>My problem is that the following function invocation does not work:</p>\n\n<pre><code>isOrderedTree Nil\n</code></pre>\n\n<p>I receive the following error message:</p>\n\n<pre><code>Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018isOrderedTree\u2019 prevents the constraint \u2018(Ord a0)\u2019 from being solved.\nProbable fix: use a type annotation to specify what \u2018a0\u2019 should be.\nThese potential instances exist:\n instance (Ord a, Ord b) =&gt; Ord (Either a b)\n instance Ord Ordering \n instance Ord Integer\n</code></pre>\n\n<p>Does anybody know what I am missing here?</p>\n"}, {"tags": ["haskell", "enums", "polymorphism"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1478873572, "post_id": 40548990, "comment_id": 68337915, "body": "I suggest you do write your own class, and use <code>DefaultSignatures</code> to &#39;derive&#39; it automatically (i.e. you will write <code>instance SafeEnum X</code> for a suitable <code>X</code>), and with <code>DeriveAnyClass</code> in ghc8 you would even be able to write <code>data X where ... deriving (SafeEnum)</code>, which would be equivalent to the above instance. Your problem is you want to <i>decide</i> if a type has an instance, which is simply impossible - it violates the semantics of classes. Also, Enum is generally considered completely lawless so you may find your assumptions about Enum/Bounded do not always holds."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1478873598, "creation_date": 1478873598, "answer_id": 40549805, "question_id": 40548990, "link": "https://stackoverflow.com/questions/40548990/safe-and-polymorphic-enum-in-haskell/40549805#40549805", "title": "Safe and polymorphic Enum in Haskell", "body": "<p>This cannot be done. Remember that Haskell type classes are <em>open</em>. Your proposal requires to do something different depending on whether or not a type belongs to the <code>Bounded</code> class. But you can never know a type <em>doesn't</em> belong to this class. (Well, <em>you</em> can know that e.g. <code>Integer</code> must not have a <code>Bounded</code> instance, but <em>the compiler</em> can not. Nothing stops you from defining a nonsense <code>instance Bounded Integer where {minBound = 7; maxBound = 3}</code> except common sense.)</p>\n\n<p>The only reliable way to get the correct instances is to sort types manually in bounded-or-not. This can be done consisely enough, especially with a default:</p>\n\n<pre><code>class Enum a =&gt; SafeEnum a where\n  predMay :: a -&gt; Maybe a\n  predMay = predMayUnboundedEnum\n\ninstance SafeEnum Integer\ninstance SafeEnum Rational\ninstance SafeEnum Int where predMay = predMayBoundedEnum\n...\n</code></pre>\n"}], "owner": {"reputation": 367, "user_id": 5852487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hwIdw.jpg?s=128&g=1", "display_name": "gilgamec", "link": "https://stackoverflow.com/users/5852487/gilgamec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "accepted_answer_id": 40549805, "answer_count": 1, "score": 5, "last_activity_date": 1478873598, "creation_date": 1478870740, "question_id": 40548990, "link": "https://stackoverflow.com/questions/40548990/safe-and-polymorphic-enum-in-haskell", "title": "Safe and polymorphic Enum in Haskell", "body": "<p>I'm trying to write total versions of the unsafe <code>Enum</code> functions:</p>\n\n<pre><code>predMay :: Enum a =&gt; a -&gt; Maybe a\nsuccMay :: Enum a =&gt; a -&gt; Maybe a\ntoEnumMay :: Enum a =&gt; Int -&gt; Maybe a\n</code></pre>\n\n<p>My problem is that the unsafe functions are only partial if the <code>Enum</code> is also <code>Bounded</code>, so safe versions should have a different form in the two cases:</p>\n\n<pre><code>predMayUnboundedEnum :: Enum a =&gt; a -&gt; Maybe a\npredMayUnboundedEnum = Just . pred\n\npredMayBoundedEnum :: (Enum a, Bounded a) =&gt; a -&gt; Maybe a\npredMayBoundedEnum x\n  | fromEnum x == fromEnum (minBound `asTypeOf` x) = Nothing\n  | otherwise  = Just (pred x)\n</code></pre>\n\n<p>The best idea I've had to get the function I want is to use another typeclass:</p>\n\n<pre><code>class Enum a =&gt; SafeEnum a where\n  predMay :: a -&gt; Maybe a\ninstance Enum a =&gt; SafeEnum a where\n  predMay = predMayUnboundedEnum\ninstance (Enum a, Bounded a) =&gt; SafeEnum a where\n  predMay = predMayBoundedEnum\n</code></pre>\n\n<p>but this causes a complaint about <code>Duplicate instance declarations</code>.</p>\n\n<p>Do I have the right idea here, or is there a better way to approach this problem?  Has someone else already done this?  (I'm aware of the package <a href=\"https://hackage.haskell.org/package/prelude-safeenum\" rel=\"noreferrer\">prelude-safeenum</a>, but the primary advantage of <code>Enum</code> for me is that we can <code>deriving</code> it.) Are these safe functions even possible, or are <code>Enum</code>s in the wild too hairy to let such a simple solution be safe?</p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1478865774, "post_id": 40547491, "comment_id": 68333522, "body": "Can you clarify the algorithm for calculating the final price? I understood this as <i>p0_+max(_p1</i>-<i>a1</i>,0)+max(<i>p2</i>-<i>a2</i>,0)+...+max(<i>pn</i>-<i>an</i>,0) where p0,...,pn are the base prices and ai := 0.1*(p(n-1)-a(n-1))."}, {"owner": {"reputation": 5038, "user_id": 3579309, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Wn5ES.jpg?s=128&g=1", "display_name": "lovasoa", "link": "https://stackoverflow.com/users/3579309/lovasoa"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1478865852, "post_id": 40547491, "comment_id": 68333564, "body": "That&#39;s it. I&#39;ll update the question."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1478866067, "post_id": 40547491, "comment_id": 68333684, "body": "Also, are you sure an efficient algorithm exists? The problem is obviously in NP (or rather, the decision version is), but it sounds vaguely similar to some NPC problems so there&#39;s a chance it might not be efficiently solvable. Would be another story of course if this was a homework question and you were already told an efficient algorithm exists."}, {"owner": {"reputation": 5038, "user_id": 3579309, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Wn5ES.jpg?s=128&g=1", "display_name": "lovasoa", "link": "https://stackoverflow.com/users/3579309/lovasoa"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1478867029, "post_id": 40547491, "comment_id": 68334181, "body": "I&#39;m actually not sure an efficient algorithm exists. But I really think so. In fact, if you remove the rule of no negative amounts, a simple solution exists: you order the article such that the last one will be the less expensive, the one before the most expensive, the one before the second less expensive, the one before the second most expensive, etc..."}, {"owner": {"reputation": 5038, "user_id": 3579309, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Wn5ES.jpg?s=128&g=1", "display_name": "lovasoa", "link": "https://stackoverflow.com/users/3579309/lovasoa"}, "edited": false, "score": 0, "creation_date": 1478867997, "post_id": 40547491, "comment_id": 68334691, "body": "Of course. I just changed it, thank you."}], "owner": {"reputation": 5038, "user_id": 3579309, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Wn5ES.jpg?s=128&g=1", "display_name": "lovasoa", "link": "https://stackoverflow.com/users/3579309/lovasoa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 2, "answer_count": 0, "score": 2, "last_activity_date": 1478868620, "creation_date": 1478865242, "last_edit_date": 1478868620, "question_id": 40547491, "link": "https://stackoverflow.com/questions/40547491/what-is-the-best-ordering-of-purchases-when-you-have-a-10-voucher-on-everything", "title": "What is the best ordering of purchases when you have a 10% voucher on everything you buy?", "body": "<p>A shop is giving out a voucher on every purchase, which can be used towards your next purchase. The value of the voucher is 10% of your current purchase. For example, on a $10 purchase, you receive a $1 voucher towards your next purchase.</p>\n\n<p>You need to buy <em>n</em> things. In what order should you pay them in order to spend as little money as possible?</p>\n\n<p>So, if the prices of the articles are <em>u</em><sub>0</sub>, <em>u</em><sub>1</sub>, ... <em>u</em><sub><em>n</em>-1</sub>, then the prices you will actually pay will be <em>v</em><sub>0</sub>, ... <em>v</em><sub><em>n</em>-1</sub>, with the recurrence rule <em>v</em><sub><em>k</em>+1</sub> = max(0, <em>u</em><sub><em>k</em>+1</sub> - <em>\u03b1</em> \u00d7 <em>v</em><sub><em>k</em></sub>), <em>v</em><sub>0</sub> = <em>u</em><sub>0</sub>, and in this case, <em>\u03b1</em> = 10/100.</p>\n\n<p>Example:</p>\n\n<blockquote>\n  <p>You need to buy 3 articles, which cost respectively $1, $10 and $100.\n    Then you should buy them in the following order: $1, $100, $10</p>\n  \n  <p>Thus, you will pay</p>\n  \n  <p><code>1 + (100 - 1 * 10%) + (10 - (100 - 1 * 10%) * 10%) = 1 + 99.9 + 0.01 = 100.91</code></p>\n  \n  <p>This is better than you would do with any other ordering.</p>\n</blockquote>\n\n<p>(Of course, if at one point you happen to have a reduction higher then the price of the next article\nyou want to buy, the shop doesn't give you money. You can only pay positive amounts of money)</p>\n\n<p>I <a href=\"https://gist.github.com/lovasoa/db6d42bcae40a59d474699588ea08e97\" rel=\"nofollow noreferrer\">implemented a naive algorithm</a> that solves this problem in factorial time, but cannot find a general algorithm that would solve this problem in reasonable time. </p>\n"}, {"tags": ["date", "haskell", "timestamp", "seconds"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1478842466, "post_id": 40541247, "comment_id": 68322296, "body": "<a href=\"https://hackage.haskell.org/package/time\" rel=\"nofollow noreferrer\"><code>time</code></a>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 7144307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/065c810ef980f82b631480634d53c50c?s=128&d=identicon&r=PG&f=1", "display_name": "E.Morris", "link": "https://stackoverflow.com/users/7144307/e-morris"}, "is_accepted": false, "score": 0, "last_activity_date": 1478851914, "creation_date": 1478851914, "answer_id": 40543711, "question_id": 40541247, "link": "https://stackoverflow.com/questions/40541247/haskell-how-to-pretty-print-number-of-seconds-as-a-date-and-time/40543711#40543711", "title": "Haskell: How to pretty print number of seconds as a date and time?", "body": "<p>Possible use <code>unix-time</code> module</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport           Prelude\nimport qualified Data.ByteString.Char8  as B\nimport           Data.UnixTime\nimport           Data.Int\nimport           Data.Functor\n\nsecToTimestampGMT :: Int32 -&gt; [Char]\nsecToTimestampGMT t = B.unpack $ formatUnixTimeGMT \"%Y-%m-%d %H-%M-%S\" $ UnixTime (fromIntegral t) 0\n\nsecToTimestamp :: Int32 -&gt; IO [Char]\nsecToTimestamp t = B.unpack &lt;$&gt; (formatUnixTime \"%Y-%m-%d %H-%M-%S\" $ UnixTime (fromIntegral t) 0)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 2, "last_activity_date": 1478857478, "creation_date": 1478857478, "answer_id": 40545164, "question_id": 40541247, "link": "https://stackoverflow.com/questions/40541247/haskell-how-to-pretty-print-number-of-seconds-as-a-date-and-time/40545164#40545164", "title": "Haskell: How to pretty print number of seconds as a date and time?", "body": "<p>In the interests of having a simple <a href=\"https://hackage.haskell.org/package/time\" rel=\"nofollow noreferrer\"><code>time</code></a> based solution (since <code>time</code> is the defacto module for manipulating anything time related):</p>\n\n<pre><code>import Data.Time.Clock.POSIX\nimport Data.Time.Format\n\nsecToTimestamp :: Int32 -&gt; String\nsecToTimestamp = formatTime defaultTimeLocale \"%F %X\" . posixSecondsToUTCTime . fromIntegral\n</code></pre>\n"}], "owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1478857478, "creation_date": 1478839495, "question_id": 40541247, "link": "https://stackoverflow.com/questions/40541247/haskell-how-to-pretty-print-number-of-seconds-as-a-date-and-time", "title": "Haskell: How to pretty print number of seconds as a date and time?", "body": "<p>I have an integral value that is the number of seconds since the Epoch. I can output it as a big integer, but I want to show it as a human-readable date and time. </p>\n\n<p>For example:</p>\n\n<pre><code>secToTimestamp :: Int32 -&gt; [Char]\n</code></pre>\n\n<p>which returns something like:</p>\n\n<pre><code>2016-01-01 14:11:11\n</code></pre>\n"}, {"tags": ["haskell", "monads", "applicative"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1478826692, "post_id": 40539650, "comment_id": 68318685, "body": "What instance do you imagine? Note that the applicative instance for <code>Either</code> accumulates on the non-error side."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 3, "creation_date": 1478827493, "post_id": 40539650, "comment_id": 68318866, "body": "You can&#39;t to run later &quot;stages&quot; if an earlier stage failed. With Applicative, you can still <i>compute</i> the later stages even if you can&#39;t apply them to get a successful result (and thus you can know if the computation of the later stages failed). With Monad, each stage returns the next one, so you don&#39;t even know what the later stages are supposed to be."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1478828085, "post_id": 40539650, "comment_id": 68319004, "body": "@Alec The applicative for <code>Either</code> doesn&#39;t &quot;accumulate&quot; <i>at all</i> in the same sense that <code>AccValidation</code> accumulates, right?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1478829154, "post_id": 40539650, "comment_id": 68319259, "body": "@ChrisMartin While <code>ap = (&lt;*&gt;)</code> is part of the contract of the <code>Monad</code> class, as stated by the documentation you linked to, it isn&#39;t, strictly speaking, a monad law -- it&#39;s just that it would be horribly confusing if it didn&#39;t hold. Here is a <a href=\"http://stackoverflow.com/q/24112786/2751851\">highly relevant question</a>, with answers and comments that approach the issue from many different perspectives."}], "answers": [{"comments": [{"owner": {"reputation": 1373, "user_id": 5341953, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9623c8ce0399947277304f3acb48e02f?s=128&d=identicon&r=PG", "display_name": "notgiorgi", "link": "https://stackoverflow.com/users/5341953/notgiorgi"}, "edited": false, "score": 0, "creation_date": 1494354861, "post_id": 40540290, "comment_id": 74789648, "body": "isn&#39;t <code>ap</code> just an alias for <code>&lt;*&gt;</code> like <code>fmap&#47;&lt;$&gt;</code>?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 1373, "user_id": 5341953, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9623c8ce0399947277304f3acb48e02f?s=128&d=identicon&r=PG", "display_name": "notgiorgi", "link": "https://stackoverflow.com/users/5341953/notgiorgi"}, "edited": false, "score": 3, "creation_date": 1494365720, "post_id": 40540290, "comment_id": 74795497, "body": "@notgiorgi Not exactly. <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.Base.html#ap\" rel=\"nofollow noreferrer\"><code>ap</code> is <code>(&lt;*&gt;)</code> implemented using the <code>Monad</code> methods</a>. <code>ap</code> is to <code>(&lt;*&gt;)</code> what <code>liftM</code> is to <code>fmap</code>."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 6, "last_activity_date": 1478831720, "creation_date": 1478831720, "answer_id": 40540290, "question_id": 40539650, "link": "https://stackoverflow.com/questions/40539650/why-can-accvalidation-not-have-a-monad-instance/40540290#40540290", "title": "Why can AccValidation not have a Monad instance?", "body": "<p>Mechanically, the <code>Either</code>-ish <code>Monad</code> instance for <code>AccValidation</code> would be</p>\n\n<pre><code>-- The (Monoid err) context is not used for anything, \n-- it's just there to satisfy the Applicative super-instance\ninstance (Monoid err) =&gt; Monad (AccValidation err) where\n    return = AccSuccess\n    AccFailure err &gt;&gt;= f = AccFailure err\n    AccSuccess x &gt;&gt;= f = f x\n</code></pre>\n\n<p>which would mean we have</p>\n\n<pre><code>AccFailure err1 &lt;*&gt; AccFailure err2 = AccFailure (err1 &lt;&gt; err2)\nAccFailure err1 `ap` AccFailure err2 = AccFailure err1\n</code></pre>\n\n<p>which breaks the monad law of <code>&lt;*&gt; = ap</code>. </p>\n\n<p>Intuitively, it can't be made a monad because in a monad, the effect (i.e. the validation failures) of a computation can depend on previously bound results. But in the case of a failure, there is no result. So <code>Either</code> has no choice than to short-circuit to failure in that case, since there is nothing to feed to the subsequent functions on right-hand sides of <code>(&gt;&gt;=)</code>s. </p>\n\n<p>This is in stark contrast to applicative functors, where the effect (in this case, the validation failures) cannot depend on other results, which is why we can get all validation failures without having to feed results (where would they come from?) from one computation to the other.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 9, "last_activity_date": 1478837954, "last_edit_date": 1478837954, "creation_date": 1478836610, "answer_id": 40540870, "question_id": 40539650, "link": "https://stackoverflow.com/questions/40539650/why-can-accvalidation-not-have-a-monad-instance/40540870#40540870", "title": "Why can AccValidation not have a Monad instance?", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#t:Monad\" rel=\"noreferrer\">The <code>(&lt;*&gt;) = ap</code> exigence</a> can be stated explicitly in terms of <code>(&gt;&gt;=)</code>:</p>\n\n<pre><code>u &lt;*&gt; v = u &gt;&gt;= \\f -&gt; fmap f v -- [1]\n</code></pre>\n\n<p>Now, given the <code>Functor</code> and <code>Applicative</code> instances for <code>AccValidation</code>, we have:</p>\n\n<pre><code>fmap _ (AccFailure e) = AccFailure e -- [2]\n\nAccFailure e1 &lt;*&gt; AccFailure e2 = AccFailure (e1 &lt;&gt; e2) -- [3]\n</code></pre>\n\n<p>If we make <code>u = AccFailure e1</code> and <code>v = AccFailure e2</code> in [1], we get:</p>\n\n<pre><code>AccFailure e1 &lt;*&gt; AccFailure e2 = AccFailure e1 &gt;&gt;= \\f -&gt; fmap f (AccFailure e2)\n</code></pre>\n\n<p>Substituting [2] and [3] into that leads us to:</p>\n\n<pre><code>AccFailure (e1 &lt;&gt; e2) = AccFailure e1 &gt;&gt;= \\_ -&gt; AccFailure e2 -- [4]\n</code></pre>\n\n<p>The problem is that it is impossible to write a <code>(&gt;&gt;=)</code> such that [4] holds. The left-hand side depends on an <code>e2</code> value which must originate, on the right-hand side, from applying <code>\\_ -&gt; AccFailure e2 :: Semigroup e =&gt; a -&gt; AccValidation e b</code>. However, there is nothing to which it can be applied -- in particular, <code>e1</code> has the wrong type. (See the final two paragraphs of Cactus' answer for further discussion of this point.) Therefore, there is no way of giving <code>AccValidation</code> a <code>Monad</code> instance which is consistent with its <code>Applicative</code> one.</p>\n"}], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 3, "accepted_answer_id": 40540290, "answer_count": 2, "score": 7, "last_activity_date": 1478837954, "creation_date": 1478826242, "last_edit_date": 1592644375, "question_id": 40539650, "link": "https://stackoverflow.com/questions/40539650/why-can-accvalidation-not-have-a-monad-instance", "title": "Why can AccValidation not have a Monad instance?", "body": "<p>From the documentation of the <a href=\"https://hackage.haskell.org/package/validation\" rel=\"noreferrer\"><code>validation</code></a> package:</p>\n<blockquote>\n<p>The <code>AccValidation</code> data type is isomorphic to <code>Either</code>, but has an instance of <code>Applicative</code> that accumulates on the error side. That is to say, if two (or more) errors are encountered, they are appended using a <code>Semigroup</code> operation.</p>\n<p>As a consequence of this <code>Applicative</code> instance, there is no corresponding <code>Bind</code> or <code>Monad</code> instance. <code>AccValidation</code> is an example of, &quot;An applicative functor that is not a monad.&quot;</p>\n</blockquote>\n<p>It isn't evident to me why this is a consequence. I can imagine a <code>Monad</code> instance for <code>AccValidation</code> that behaves like <code>Either</code> - What would make this unlawful?</p>\n"}, {"tags": ["haskell", "gtk3", "haskell-stack"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1478826545, "post_id": 40538626, "comment_id": 68318659, "body": "Someone somewhere is probably missing <code>hSetEncoding stdout utf8</code>... I think this is default on many systems, which is why it would&#39;ve been missed up until now."}, {"owner": {"reputation": 43, "user_id": 4544037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ded10e98957fa5559deba7cb27db496?s=128&d=identicon&r=PG", "display_name": "Mike Pilgrem", "link": "https://stackoverflow.com/users/4544037/mike-pilgrem"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1478976185, "post_id": 40538626, "comment_id": 68369462, "body": "@Alec, I think that &#39;somewhere&#39; must be <code>stack</code>, as <code>cabal install gi-gtk</code> seems to work eventually (it stalled a few times on the way). What I don&#39;t follow is that, with active code page: 65001, <code>localeEncoding</code> (which I understand to be the default when a Handle is created) is already <code>UTF-8</code>."}], "answers": [{"tags": [], "owner": {"reputation": 43, "user_id": 4544037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ded10e98957fa5559deba7cb27db496?s=128&d=identicon&r=PG", "display_name": "Mike Pilgrem", "link": "https://stackoverflow.com/users/4544037/mike-pilgrem"}, "is_accepted": false, "score": 0, "last_activity_date": 1481228869, "last_edit_date": 1481228869, "creation_date": 1479035511, "answer_id": 40573156, "question_id": 40538626, "link": "https://stackoverflow.com/questions/40538626/how-to-build-gi-gtk-package-on-windows-10-with-stack/40573156#40573156", "title": "How to build gi-gtk package on Windows 10 with stack", "body": "<p>With <code>haskell-gi-0.20</code> etc provided under <code>resolver: nightly-2016-12-08</code> this is no longer an issue requiring a work around.</p>\n\n<hr>\n\n<p>My original work around for the specific error identified in the question was to edit the <code>*.gir</code> files. I found 'smart' quotation characters and replaced them with the corresponding ASCII characters.</p>\n"}], "owner": {"reputation": 43, "user_id": 4544037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ded10e98957fa5559deba7cb27db496?s=128&d=identicon&r=PG", "display_name": "Mike Pilgrem", "link": "https://stackoverflow.com/users/4544037/mike-pilgrem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 374, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1481228869, "creation_date": 1478819358, "last_edit_date": 1479035212, "question_id": 40538626, "link": "https://stackoverflow.com/questions/40538626/how-to-build-gi-gtk-package-on-windows-10-with-stack", "title": "How to build gi-gtk package on Windows 10 with stack", "body": "<p>I am unable to build a test Haskell 2010 program which depends on package <code>gi-gtk</code> with <code>stack</code> on Windows 10. Any guidance on how to do that would be appreciated.</p>\n\n<p>Specifically, <code>stack build</code> fails at/after dependency <code>gi-gdk-3.0.3: configure</code> with message:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( C:\\Users\\MIKEPI~1\\AppData\\Local\\Temp\\stack2692\\gi-gdk-3.0.3\\Setup.hs, C:\\Users\\MIKEPI~1\\AppData\\Local\\Temp\\stack2692\\gi-gdk-3.0.3\\.stack-work\\dist\\b7fec021\\setup\\Main.o )\nLinking C:\\Users\\MIKEPI~1\\AppData\\Local\\Temp\\stack2692\\gi-gdk-3.0.3\\.stack-work\\dist\\b7fec021\\setup\\setup.exe ...\nGI\\Gdk\\Structs\\EventProximity.hs: commitAndReleaseBuffer: invalid argument\n(invalid character)\n</code></pre>\n\n<p>The context is <code>stack</code> version 1.2.0, <code>resolver: lts-7.8</code> (GHC 8.0.1) and Windows 10 Version 10.0.14393 - using Command Prompt with active code page: 65001 and font DejaVu Sans Mono. I mention the latter because I've read elsewhere that 'invalid argument (invalid character)' can be something to do with Unicode. With code page 65001, <code>localeEncoding</code> is UTF-8.</p>\n\n<p>The following environmental variables have been set:</p>\n\n<pre><code>PKG_CONFIG_PATH=C:\\msys64\\mingw64\\lib\\pkgconfig\nXDG_DATA_DIRS=C:\\msys64\\mingw64\\share\n</code></pre>\n\n<p>in light of this wiki page: <a href=\"https://github.com/haskell-gi/haskell-gi/wiki/Using-haskell-gi-in-Windows\" rel=\"nofollow noreferrer\">Using haskell gi in Windows</a></p>\n\n<p>Revised Update: experimenting with a local copy of the package, it appears that what is giving rise to the problem is 'smart' single or double quotation mark characters in <code>*.gir</code> files at (on my system) <code>C:\\msys64\\mingw64\\share\\gir-1.0</code>. For example, a 'Right Single Quotation Mark' (U+2019) character. The files affected in my case are <code>Gdk-3.0.gir</code> and <code>Gtk-3.0.gir</code>. The translation of those '*.gir' files into <code>*.hs</code> files appears to abort at the point where the first 'smart' quotation character is encountered.</p>\n"}, {"tags": ["haskell", "ghc", "happy"], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1479036498, "post_id": 40539041, "comment_id": 68382152, "body": "Smart idea! Although I haven&#39;t yet managed to find a way to get two tokens by Alex, I can see how this will work. Thanks!"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1479065700, "post_id": 40539041, "comment_id": 68391463, "body": "@Alec: Yeah, I\u2019ve only ever used this technique in Parsec, where you have lookahead (e.g. <code>try (Operator &lt;$&gt; char &#39;&lt;&#39; &lt;* notFollowedBy symbol) &lt;|&gt; LeftAngle &lt;$&gt; char &#39;&lt;&#39;</code>), but that doesn\u2019t look possible to express directly in Alex. You could probably encode it without lookahead somehow."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 2, "last_activity_date": 1478821891, "creation_date": 1478821891, "answer_id": 40539041, "question_id": 40538124, "link": "https://stackoverflow.com/questions/40538124/pushing-back-tokens-in-happy-and-alex/40539041#40539041", "title": "Pushing back tokens in Happy and Alex", "body": "<p>I don\u2019t know how to express this in Happy, but you don\u2019t need a separate \u201cwhitespace\u201d token. You can parse <code>&lt;</code> or <code>&gt;</code> as a distinct \u201cangle bracket\u201d token when immediately followed by an operator symbol in the input, with no intervening whitespace.</p>\n\n<p>Then, when you want to parse an operator, you join a sequence of angles and operators into a single token. When you want to treat them as brackets, you just deal with them separately as usual.</p>\n\n<p>So <code>a &lt;&lt; b</code> would be tokenised as:</p>\n\n<pre><code>identifier \"a\"\nleft angle      -- joined with following operator\noperator \"&lt;\"\nidentifier \"b\"\n</code></pre>\n\n<p>When parsing an operator, you concatenate angle tokens with the following operator token, producing a single <code>operator \"&lt;&lt;\"</code> token.</p>\n\n<p><code>&lt;&lt;A&gt;::B&gt;</code> would be tokenised as:</p>\n\n<pre><code>left angle\noperator \"&lt;\"    -- accepted as bracket\nidentifier \"A\"\nright angle\noperator \"::\"\nidentifier \"B\"\noperator \"&gt;\"    -- accepted as bracket\n</code></pre>\n\n<p>When parsing angle-bracketed terms, you accept both angle tokens and <code>&lt;</code>/<code>&gt;</code> operators.</p>\n\n<p>This relies on your grammar not being ambiguous wrt. whether you should parse an operator name or a bracketed thing.</p>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 0, "last_activity_date": 1489031256, "creation_date": 1489031256, "answer_id": 42686293, "question_id": 40538124, "link": "https://stackoverflow.com/questions/40538124/pushing-back-tokens-in-happy-and-alex/42686293#42686293", "title": "Pushing back tokens in Happy and Alex", "body": "<p>While I initially went with @Jon's answer, I ended up running into a variety of precedence related issues (think precedence around <code>expr &lt; expr</code> vs <code>expr &lt;&lt; expr</code>) which caused me a lot of headaches. I recently (successfully) back to lexing <code>&lt;&lt;</code> as one token. The solution was twofold:</p>\n\n<ol>\n<li><p>I bit the bullet and added extra rules for <code>&lt;&lt;</code> (where previously I only had rules for <code>&lt;</code>). For the example in the question (<code>&lt;&lt;A&gt;::B&gt;</code>) my rule went from something like</p>\n\n<pre><code>ty_qual_path\n  : '&lt;' ty_sum '&gt;' '::' ident\n</code></pre>\n\n<p>to</p>\n\n<pre><code>ty_qual_path\n  : '&lt;' ty_sum '&gt;' '::' ident\n  | '&lt;&lt;' ty_sum '&gt;' '::' ident '&gt;' '::' ident\n</code></pre>\n\n<p>(The actual rule was actually a bit more involved, but that is not for this answer).</p></li>\n<li><p>I found a clever way to deal with token that started with <code>&gt;</code> (these would cause problems around things like <code>vector&lt;i32,vector&lt;i32&gt;&gt;</code> where the last <code>&gt;&gt;</code> was a token): use a <a href=\"https://www.haskell.org/happy/doc/html/sec-monads.html\" rel=\"nofollow noreferrer\">threaded lexer (section 2.5.2)</a>, exploit the <code>{%% ... }</code> RHS of rules which lets you reconsider the lookahead token, and add a <code>pushToken</code> facility to my parser monad (<a href=\"https://github.com/harpocrates/language-rust/blob/fdea2c6713db297f5bc17a65de35724725abd461/src/Language/Rust/Parser/ParseMonad.hs\" rel=\"nofollow noreferrer\">this turned out to be quite simple - here is exactly what I did</a>). I then added a dummy rule - something like</p>\n\n<pre><code>gt :: { () }\n  : {- empty -}   {%% \\tok -&gt;\n      case tok of\n        Tok \"&gt;&gt;\"  -&gt; pushToken (Tok \"&gt;\")  *&gt; pushToken (Tok \"&gt;\")\n        Tok \"&gt;=\"  -&gt; pushToken (Tok \"=\")  *&gt; pushToken (Tok \"&gt;\")\n        Tok \"&gt;&gt;=\" -&gt; pushToken (Tok \"&gt;=\") *&gt; pushToken (Tok \"&gt;\")\n        _         -&gt; pushToken tok\n    }\n</code></pre>\n\n<p>And every time in some other rule I expected a <code>&gt;</code> but there could also be any other token starting with <code>&gt;</code>, I would precede the <code>&gt;</code> token with <code>gt</code>. This has the effect of looking ahead to the next token which may could start with <code>&gt;</code> without being <code>&gt;</code>, and try to convert that token into one <code>&gt;</code> token and another token for the \"rest\" of the initial token. </p></li>\n</ol>\n"}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "accepted_answer_id": 42686293, "answer_count": 2, "score": 2, "last_activity_date": 1489031256, "creation_date": 1478816845, "question_id": 40538124, "link": "https://stackoverflow.com/questions/40538124/pushing-back-tokens-in-happy-and-alex", "title": "Pushing back tokens in Happy and Alex", "body": "<p>I'm parsing a language which has both <code>&lt;</code> and <code>&lt;&lt;</code>. In my Alex definition I've got something that contains something like</p>\n\n<pre><code>tokens :-\n\n\"&lt;\"             { token Lt }\n\"&lt;&lt;\"            { token (BinOp Shl) }\n</code></pre>\n\n<p>so whenever I encounter <code>&lt;&lt;</code>, that gets tokenized as a left shift and <em>not</em> as to less-than's. This is generally a good thing, since I end up throwing out whitespace after tokenization and want to differentiate between <code>1 &lt; &lt; 2</code> and <code>1 &lt;&lt; 2</code>. However, there are other times I wish <code>&lt;&lt;</code> had been read as two <code>&lt;</code>. For example, I have things like</p>\n\n<pre><code>&lt;&lt;A&gt;::B&gt; \n</code></pre>\n\n<p>which I want read like</p>\n\n<pre><code>&lt; &lt; A &gt; :: B &gt;\n</code></pre>\n\n<p>Obviously I can try to adjust my Happy parser rules to accommodate for the extra cases, but that scales badly. In other imperative parser generators, I might try to do something like push back \"part\" of the token (something like <code>push_back(\"&lt;\")</code> when I encountered <code>&lt;&lt;</code> but I only needed <code>&lt;</code>).</p>\n\n<p>Has anyone else had such a problem and, if so, how did you deal with it? Are there ways of \"pushing back\" tokens in Happy? Should I instead try to keep a whitespace token around (I'm actually leaning towards the last alternative - although being a huge headache, it would let me deal with <code>&lt;&lt;</code> by just making sure there is no whitespace between the two <code>&lt;</code>). </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": true, "score": 3, "last_activity_date": 1478817034, "creation_date": 1478817034, "answer_id": 40538163, "question_id": 40538087, "link": "https://stackoverflow.com/questions/40538087/threadscope-installed-via-cabal-but-cannot-be-called-from-terminal/40538163#40538163", "title": "threadscope installed via cabal, but cannot be called from terminal", "body": "<p>Assuming your using a Unix-like system like Linux or Mac:</p>\n\n<p>This is because the cabal executable directory is not part of your path. You can either:</p>\n\n<ol>\n<li><code>cabal exec threadscope</code></li>\n<li><p>Add <code>~/.cabal/bin</code> to your <code>$PATH</code>. For example if you are using bash add the following line to your <code>~/.bashrc</code>:</p>\n\n<pre><code>export PATH=$PATH:~/.cabal/bin\n</code></pre>\n\n<p>or append the <code>:~/.cabal/bin</code> to such a line that may already be in place.</p></li>\n</ol>\n"}], "owner": {"reputation": 11, "user_id": 7143693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc99b1f485eeb8b85c2a2c07cd002bee?s=128&d=identicon&r=PG&f=1", "display_name": "Kar Mootee", "link": "https://stackoverflow.com/users/7143693/kar-mootee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 40538163, "answer_count": 1, "score": 0, "last_activity_date": 1478817034, "creation_date": 1478816637, "question_id": 40538087, "link": "https://stackoverflow.com/questions/40538087/threadscope-installed-via-cabal-but-cannot-be-called-from-terminal", "title": "threadscope installed via cabal, but cannot be called from terminal", "body": "<p>Hi I've installed threadscope from cabal, yet I cannot call it from terminal (i.e. -bash: threadscope: command not found) how do I get terminal to see threadscope even while it can see other cabal installations.</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1478811290, "post_id": 40536569, "comment_id": 68313165, "body": "My guess is that the two are completely unrelated. I interpret &quot;section&quot; as: you take <code>(x+y)</code>, chop off one part of it (take a &quot;section&quot;), and consider what remains."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1478812746, "post_id": 40536569, "comment_id": 68313861, "body": "That&#39;s so... prosaic, though."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 5, "creation_date": 1478812936, "post_id": 40536569, "comment_id": 68313943, "body": "I don&#39;t know, but I will try to find out."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 1, "creation_date": 1478816435, "post_id": 40536569, "comment_id": 68315429, "body": "The Miranda language had sections, and was designed by David Turner. Miranda strongly influenced the design of Haskell."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 2, "creation_date": 1478817325, "post_id": 40536569, "comment_id": 68315814, "body": "From the Miranda Manual, Chapter 9:  Acknowledgement:  The idea of sections is due  to  Richard  Bird  (of  Oxford  University Programming  Research Group) and David Wile (of USC Information Sciences Institute).  <a href=\"http://miranda.org.uk/\" rel=\"nofollow noreferrer\">miranda.org.uk</a>"}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1478817805, "post_id": 40536569, "comment_id": 68316016, "body": "They appeared in Haskell 1.1, released Aug, 1991, according to &#39;A History of Haskell: Being Lazy With Class&#39;"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1478820072, "post_id": 40538648, "comment_id": 68316844, "body": "Thanks for checking. I had never given it much thought, but so many other things are based in category theory it seemed possible this was as well."}], "tags": [], "owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "is_accepted": true, "score": 24, "last_activity_date": 1482546347, "last_edit_date": 1482546347, "creation_date": 1478819465, "answer_id": 40538648, "question_id": 40536569, "link": "https://stackoverflow.com/questions/40536569/where-does-the-name-section-come-from-for-a-partially-applied-infix-operator/40538648#40538648", "title": "Where does the name &quot;section&quot; come from for a partially applied infix operator?", "body": "<p>As has been pointed out in the comments, Haskell got the sections from Miranda (and Orwell).  David Turner says he got the idea from Richard Bird and David Wile. </p>\n\n<p>I have just chatted with Richard Bird.  He says he doesn't remember where the name came from, but he thinks it was David Wile who coined it. Unfortunately, David Wile died last year, so we will probably never know.  But, Richard did admit that he was the one who convinced David Turner and Phil Wadler to add sections in their languages.</p>\n\n<p>Here's the page from Wile's thesis that is the first know mention of \"section\".  <a href=\"https://imgur.com/a/cQDlu\" rel=\"nofollow noreferrer\">http://imgur.com/a/cQDlu</a></p>\n"}, {"tags": [], "owner": {"reputation": 922, "user_id": 4094574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4AcNf.png?s=128&g=1", "display_name": "Alexey Birukov", "link": "https://stackoverflow.com/users/4094574/alexey-birukov"}, "is_accepted": false, "score": 3, "last_activity_date": 1478868468, "last_edit_date": 1478868468, "creation_date": 1478865092, "answer_id": 40547441, "question_id": 40536569, "link": "https://stackoverflow.com/questions/40536569/where-does-the-name-section-come-from-for-a-partially-applied-infix-operator/40547441#40547441", "title": "Where does the name &quot;section&quot; come from for a partially applied infix operator?", "body": "<p>Possibly, it comes from \"array section\" operation, used primarily in Fortran, particularly for column or row extraction. That makes sense, if you consider making lookup table from two-argument function.\n<a href=\"https://www.phy.ornl.gov/csep/pl/node16.html\" rel=\"nofollow noreferrer\">https://www.phy.ornl.gov/csep/pl/node16.html</a></p>\n"}], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 1, "accepted_answer_id": 40538648, "answer_count": 2, "score": 15, "last_activity_date": 1482546347, "creation_date": 1478810243, "last_edit_date": 1478813303, "question_id": 40536569, "link": "https://stackoverflow.com/questions/40536569/where-does-the-name-section-come-from-for-a-partially-applied-infix-operator", "title": "Where does the name &quot;section&quot; come from for a partially applied infix operator?", "body": "<p>In Haskell, we use the term \"section\" to indicate a partially applied function used in infix position. For instance, for a function <code>foo :: a -&gt; b -&gt; c</code> and values <code>x :: a</code> and <code>y :: b</code>, we have the two sections</p>\n\n<pre><code>s1 = (x `foo`) :: b -&gt; c == \\b -&gt; foo x b\n</code></pre>\n\n<p>and</p>\n\n<pre><code>s2 = (`foo` y) :: a -&gt; c == \\a -&gt; foo a y\n</code></pre>\n\n<p>In category theory, however, a section <code>g</code> of <code>f</code> is defined as a right inverse of <code>f</code> (so that <code>f . g == id</code>).</p>\n\n<p>I don't see an obvious connection between the two definitions. For instance, <code>s1</code> is clearly not an inverse of <code>foo</code>, at least not in <strong>Hask</strong>. I suppose <code>s1</code> doesn't even have to <em>have</em> an inverse in <strong>Hask</strong>.</p>\n\n<p>Is the category-theoretical definition the source of the Haskell definition, and if so, how?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user7115782"}, "edited": false, "score": 0, "creation_date": 1478804181, "post_id": 40534663, "comment_id": 68309705, "body": "the new test4 doesn&#39;t work, because it never says true (I could change test [] = False to True, but the empty list should stay False)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1478804484, "post_id": 40534663, "comment_id": 68309845, "body": "The base case <i>should</i> be <code>True</code>; if there are no numbers in the list, it is true that there is no number <i>not</i> divisible by 3. If you were trying to determine if <i>any</i> number in the list was divisible by 3, then the base case should be <code>False</code>."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1478807998, "post_id": 40534663, "comment_id": 68311548, "body": "imho beginners should be writing solutions from scratch using recursion and pattern matching until that stops hurting their brain (at least that was what worked for me)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1478808008, "post_id": 40534663, "comment_id": 68311553, "body": "I hate to see <code>mod</code> when <code>rem</code> will do as well. Yes, <code>rem</code> is mathematically unfortunate, but <code>mod</code> is only an improvement under certain circumstances. I wish Haskell had gone with &quot;Euclidean-style&quot; (non-negative remainder) and Knuthian division instead of machine-style and Knuthian. Oh well."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 7, "last_activity_date": 1478804570, "last_edit_date": 1478804570, "creation_date": 1478802742, "answer_id": 40534663, "question_id": 40534624, "link": "https://stackoverflow.com/questions/40534624/this-code-is-supposed-to-find-a-single-int-in-a-list-that-is-not-dividable-by-3/40534663#40534663", "title": "This code is supposed to find a single Int in a list that is not dividable by 3 and then say False", "body": "<p>You need to keep searching the list if you encounter a number that is divisible by 3. The <code>otherwise</code> clause needs to recursively call the function.</p>\n\n<pre><code>test4 :: [Int] -&gt; Bool\ntest4 [] = True\ntest4 (x:xs)\n   | mod x 3 /= 0 = False\n   | otherwise = test4 xs\n</code></pre>\n\n<hr>\n\n<p>But I'd advise you to avoid writing low-level pattern-matching-and-recursion code when you can. Haskell's a high-level language! In plain English, you want your function to test whether all of the elements in the list are divisible by 3. That's what the <code>all :: (a -&gt; Bool) -&gt; [a] -&gt; Bool</code> function is for:</p>\n\n<pre><code>test4 = all (\\x -&gt; x `mod` 3 == 0)\n</code></pre>\n\n<p>I think this version is much clearer and easier to read, as well as being shorter.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7115782"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1478804570, "creation_date": 1478802599, "last_edit_date": 1478802669, "question_id": 40534624, "link": "https://stackoverflow.com/questions/40534624/this-code-is-supposed-to-find-a-single-int-in-a-list-that-is-not-dividable-by-3", "title": "This code is supposed to find a single Int in a list that is not dividable by 3 and then say False", "body": "<pre><code>test4 :: [Int] -&gt; Bool\ntest4 [] = False\ntest4 (x:xs)\n   | mod x 3 /= 0 = False\n   | otherwise = True\n</code></pre>\n\n<p>I'd simply like the code to find any (not just the first) number of a list that can't be divided by three, and then say <code>False</code>.</p>\n\n<p>I just started learning Haskell.</p>\n"}, {"tags": ["haskell", "optimization"], "answers": [{"comments": [{"owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "edited": false, "score": 0, "creation_date": 1478807051, "post_id": 40533792, "comment_id": 68311098, "body": "Can you explain with code please? Thanks"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "edited": false, "score": 4, "creation_date": 1478809638, "post_id": 40533792, "comment_id": 68312343, "body": "@ZubinKadva You can convince me that it&#39;s worth my time by spending a little time yourself to try to figure it out (perhaps Googling terms you don&#39;t know), then cooking up a question that identifies where you got stuck in that process. You might also like the venerable <a href=\"http://www.catb.org/~esr/faqs/smart-questions.html\" rel=\"nofollow noreferrer\">How to Ask Questions the Smart Way</a>, especially <a href=\"http://www.catb.org/~esr/faqs/smart-questions.html#lesser\" rel=\"nofollow noreferrer\">If you don&#39;t understand...</a> and <a href=\"http://www.catb.org/~esr/faqs/smart-questions.html#explicit\" rel=\"nofollow noreferrer\">Be explicit about your question</a>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1478799417, "creation_date": 1478799417, "answer_id": 40533792, "question_id": 40533480, "link": "https://stackoverflow.com/questions/40533480/haskell-can-this-code-be-optimized/40533792#40533792", "title": "Haskell: Can this code be optimized?", "body": "<p>Precompute the frequencies of each prefix of the list. To compute the frequencies of a sublist, subtract the frequencies of the two prefixes ending at the two ends of the sublist. This will reduce the cost of each query from O(n^2) to O(n). To compute frequencies, use a counting sort. This will reduce the cost of the precomputation from O(n^2) to O(n log n).</p>\n"}], "owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "closed_date": 1478850056, "answer_count": 1, "score": -3, "last_activity_date": 1478799417, "creation_date": 1478798273, "question_id": 40533480, "link": "https://stackoverflow.com/questions/40533480/haskell-can-this-code-be-optimized", "closed_reason": "Needs more focus", "title": "Haskell: Can this code be optimized?", "body": "<p>I have the following code. I want to know whether there is any way it can be optimized so that it runs faster.</p>\n\n<p>I wanted to solve it using a <code>SegmentTree</code> but I am not well versed with Haskell, which is why I took the following list (non-tree) approach.</p>\n\n<pre><code>-- Program execution begins here\nmain :: IO()\nmain = do\n  _ &lt;- getLine\n  arr &lt;- map (read :: String -&gt; Integer) . words &lt;$&gt; getLine\n  queryList &lt;- readData\n  let queries = map (read :: String -&gt; Integer) queryList\n  putStrLn \"\"\n  mapM_ print $ compute queries arr  \n\n-- Construct a sublist\nsublist :: Integer -&gt; Integer -&gt; [Integer] -&gt; [Integer]\nsublist start end list = take (fromInteger end - fromInteger start) . drop (fromInteger start) $ list\n\n-- Calculate the resulting list\ncompute :: [Integer] -&gt; [Integer] -&gt; [Integer]\ncompute [_] [_] = []\ncompute [_] [] = []\ncompute [_] (_:_) = []\ncompute [] (_:_) = []\ncompute [] [] = []\ncompute (x1:x2:xs) list = result : compute xs list where\n  result = frequency $ sublist x1 x2 list \n\n-- Read query list, end at terminating condition\nreadData :: IO [String]\nreadData = do\n  x &lt;- getLine\n  if x == \"0\"\n    then return []\n    else do xs &lt;- readData\n            return (words x ++ xs)\n\n-- Return count of the most frequent element in a list\nfrequency :: [Integer] -&gt; Integer\nfrequency list = toInteger (snd $ maximumBy (compare `on` snd) counts) where\n  counts = nub [(element, count) | element &lt;- list, let count = length (filter (element ==) list)]\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["string", "list", "haskell", "indexing", "split"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1478795234, "post_id": 40532343, "comment_id": 68304755, "body": "Unless this happens to be an exercise that asks you to write the recursive algorithm explicitly, you are looking for <code>takeWhile</code>."}, {"owner": {"reputation": 11, "user_id": 7137981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/529687c93d32769dc163d56f7367b3ce?s=128&d=identicon&r=PG&f=1", "display_name": "J. Strange", "link": "https://stackoverflow.com/users/7137981/j-strange"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1478796817, "post_id": 40532343, "comment_id": 68305809, "body": "Ah! Thank you! That is exactly what I was looking for. Can&#39;t believe I didn&#39;t find that on my own. Oh well."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1478807018, "post_id": 40532343, "comment_id": 68311084, "body": "Check out hoogle and other things that are mentioned here: <a href=\"http://stackoverflow.com/tags/haskell/info\">stackoverflow.com/tags/haskell/info</a>"}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 0, "last_activity_date": 1478815223, "last_edit_date": 1478815223, "creation_date": 1478798079, "answer_id": 40533434, "question_id": 40532343, "link": "https://stackoverflow.com/questions/40532343/identifying-a-specific-index-in-a-list-of-strings-and-removing-everything-in-the/40533434#40533434", "title": "Identifying a specific index in a list of strings and removing everything in the list beyond that index in Haskell", "body": "<p>The solution to your first question has two parts: </p>\n\n<ol>\n<li>finding the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:takeWhile\" rel=\"nofollow noreferrer\"><code>takeWhile</code></a> function</li>\n<li>Writing a predicate to use with <code>takeWhile</code>, once you've found it</li>\n</ol>\n\n<p>For (1), you could try searching Hoogle for something like <code>[a] -&gt; [a]</code>, which is not the full type signature you want but is a part of it, and then scrolling through matches; you will find <code>takeWhile</code> before long.</p>\n\n<p>For (2) you clearly want something involving <code>(==)</code> or perhaps <code>(/=)</code>. Playing around with that a bit you may come up with:</p>\n\n<pre><code>keep :: String -&gt; Bool\nkeep x = x /= \"STP\"\n</code></pre>\n\n<p>And you can simplify that by using partial application instead:</p>\n\n<pre><code>keep :: String -&gt; Bool\nkeep = (/= \"STP\")\n</code></pre>\n\n<p>Finally you just combine parts (1) and (2):</p>\n\n<pre><code>listSplitter :: [String] -&gt; [String]\nlistSplitter = takeWhile (/= \"STP\")\n</code></pre>\n\n<p>To solve the second problem, that of <code>stringSplitter</code>, you can't simply use <code>takeWhile</code>, because it can only look at one item at a time, and you need to look at more. There is probably an elegant way to do this using something from <code>Data.List</code> and/or <code>Data.List.Split</code> (exercise: find an elegant way), but it is also quite easy to implement yourself recursively with pattern matching starting from the head of the list:</p>\n\n<pre><code>stringSplitter :: String -&gt; String\nstringSplitter [] = []\nstringSplitter ('S':'T':'P':_) = []\nstringSplitter (x:xs) = x : stringSplitter xs\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 7137981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/529687c93d32769dc163d56f7367b3ce?s=128&d=identicon&r=PG&f=1", "display_name": "J. Strange", "link": "https://stackoverflow.com/users/7137981/j-strange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 40533434, "answer_count": 1, "score": -1, "last_activity_date": 1478815223, "creation_date": 1478794872, "question_id": 40532343, "link": "https://stackoverflow.com/questions/40532343/identifying-a-specific-index-in-a-list-of-strings-and-removing-everything-in-the", "title": "Identifying a specific index in a list of strings and removing everything in the list beyond that index in Haskell", "body": "<p>I've recently started learning haskell, and I've encountered this problem which I can't seem to overcome.</p>\n\n<p>My input is a list of strings which contain 3 characters each. What I want to do is split the list at a certain point and have the output be the list up until that point.</p>\n\n<p>Example:</p>\n\n<pre><code>Main&gt; listsplitter [\"AAA\", \"BBB\", \"CCC\", \"STP\", \"DDD\"]\nMain&gt; [\"AAA\", \"BBB\", \"CCC\"]\nMain&gt; listsplitter [\"AAA\", \"STP\", \"BBB\", \"CCC\", \"DDD\"]\nMain&gt; [\"AAA\"]\n</code></pre>\n\n<p>Where STP in this case is the identifying string at which to stop the output string.</p>\n\n<p>If it's possible to split a string in a similar way, or perhaps even easier, that would also be useful. As this list of strings is further up the problem I'm working on a string. Like this:</p>\n\n<pre><code>Main&gt; stringsplitter \"AAABBBCCCSTPDDD\nMain&gt; \"AAABBBCCC\"\nMain&gt; stringsplitter \"AAASTPBBBCCCDDD\"\nMain&gt; \"AAA\"\n</code></pre>\n\n<p>I should also mention that I would like to achieve this <em>without</em> importing data modules.</p>\n\n<p>Thanks for your time!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 6, "creation_date": 1478785929, "post_id": 40529138, "comment_id": 68298549, "body": "Not that I know of.  There isn&#39;t a library function for a lot of things, particularly when they&#39;re this simple.  However, this implementation isn&#39;t necessarily the most efficient depending on the use case.  For example, it might be better to use a <code>Map Item Int</code> to build up a count of each of the items, then you can recreate the output of <code>group . sort</code> from that map instead."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1478786728, "post_id": 40529138, "comment_id": 68299047, "body": "My preliminary tests in GHCi (not always the best indicator of optimized performance, but it&#39;ll do for now) shows that <code>last . last . group . sort $ xs</code> where <code>xs = take 1000000 $ cycle [1..20]</code> and has been forced into normal form takes 2.39s and uses a total of 1.483 GB of RAM, while <code>let counter = Map.fromListWith (+) . flip zip (repeat 1); uncounter = map (uncurry $ flip replicate) . Map.toAscList</code> : <code>last . last . uncounter . counter $ xs</code> takes 0.34 seconds with 369 MB total RAM.  A lot of that RAM is from <code>xs</code> itself."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1478793442, "post_id": 40529138, "comment_id": 68303576, "body": "Using <code>HashMap</code> may be even better than just <code>Map</code> from <code>Data.Map</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 3, "last_activity_date": 1478832540, "last_edit_date": 1478832540, "creation_date": 1478803566, "answer_id": 40534882, "question_id": 40529138, "link": "https://stackoverflow.com/questions/40529138/group-elements-by-equality/40534882#40534882", "title": "Group Elements by Equality", "body": "<p>There is no such function in <code>base</code>. However there is the <a href=\"https://hackage.haskell.org/package/discrimination\" rel=\"nofollow noreferrer\"><code>discrimination</code></a> package. In <code>Data.Discrimination</code> you will find the following function:</p>\n\n<pre><code>group :: Grouping a =&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>You don't have to write those <code>Grouping</code> instances yourself, as there are default methods in place for types that have an instance for <code>Generic</code>. For example:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\nimport Data.Discrimination\n\ndata A = A deriving Generic\ninstance Grouping A\ninstance Sorting A -- Not necessary for what you are trying to do.\n</code></pre>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1478832540, "creation_date": 1478785447, "question_id": 40529138, "link": "https://stackoverflow.com/questions/40529138/group-elements-by-equality", "title": "Group Elements by Equality", "body": "<p>I'm looking for a standard library function that groups elements by equality.</p>\n\n<p>Example:</p>\n\n<p><code>f [1,2,3,1,2,3] == [ [1,1], [2,2], [3,3] ]</code></p>\n\n<p>Composing <code>group</code> and <code>sort</code> does the job:</p>\n\n<pre><code>Prelude Data.List&gt; group . sort $ [1,2,3,1,2,3]\n[[1,1],[2,2],[3,3]]\n</code></pre>\n\n<p>But, is there a native function in Haskell's library that can perform the above work in a single function?</p>\n\n<p>I looked at <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html\" rel=\"nofollow noreferrer\">Data.List</a>, but did not find such a function.</p>\n"}, {"tags": ["algorithm", "haskell", "machine-learning", "functional-programming", "gradient-descent"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1478787894, "post_id": 40527998, "comment_id": 68299822, "body": "How about trying a simpler example dataset?"}, {"owner": {"reputation": 473, "user_id": 4884986, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/19525ef8af5361c29db9b137f23dedf7?s=128&d=identicon&r=PG&f=1", "display_name": "David Anekstein", "link": "https://stackoverflow.com/users/4884986/david-anekstein"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1478788176, "post_id": 40527998, "comment_id": 68299994, "body": "I&#39;ll give it a shot with a set with a clear linear fit @leftaroundabout"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1478853856, "post_id": 40530775, "comment_id": 68326948, "body": "You sound edit your question to indicate exactly what you changed and how, and explain what is odd about the current behavior."}], "tags": [], "owner": {"reputation": 473, "user_id": 4884986, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/19525ef8af5361c29db9b137f23dedf7?s=128&d=identicon&r=PG&f=1", "display_name": "David Anekstein", "link": "https://stackoverflow.com/users/4884986/david-anekstein"}, "is_accepted": false, "score": 0, "last_activity_date": 1478790785, "last_edit_date": 1478790785, "creation_date": 1478790232, "answer_id": 40530775, "question_id": 40527998, "link": "https://stackoverflow.com/questions/40527998/gradient-descent-algorithm-not-converging-in-haskell/40530775#40530775", "title": "Gradient Descent algorithm not converging in Haskell", "body": "<p>It appears that with each run of updating theta values, the approximation function <code>h(x)</code> was using the initial <code>theta</code> vector each time, rather than the updated vector. Now, I get an alright approximation of my theta values. However, increasing the number of iterations by a large factor changes my results in an odd way.</p>\n"}], "owner": {"reputation": 473, "user_id": 4884986, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/19525ef8af5361c29db9b137f23dedf7?s=128&d=identicon&r=PG&f=1", "display_name": "David Anekstein", "link": "https://stackoverflow.com/users/4884986/david-anekstein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 170, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1478790785, "creation_date": 1478781974, "question_id": 40527998, "link": "https://stackoverflow.com/questions/40527998/gradient-descent-algorithm-not-converging-in-haskell", "title": "Gradient Descent algorithm not converging in Haskell", "body": "<p>I am trying to implement the gradient descent algorithm in Andrew Ng's ML course. After reading in the data, I try to implement the following, updating my list of theta values 1000 times, with the expectation of some convergence.<a href=\"https://i.stack.imgur.com/A54kB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/A54kB.png\" alt=\"enter image description here\"></a></p>\n\n<p>The algorithm in question is <code>gradientDescent</code>. I know that typically a cause of this problem is that alpha can be too large, but when I change alpha by a factor of <code>n</code> for example, my results change by a factor of <code>n</code>. The same happens when I change <code>iterations</code> by a factor of <code>n</code>. I want to say this could be to do with haskell's laziness, but I'm completely unsure. Any help would be appreciated.</p>\n\n<pre><code>module LR1V where\n\nimport qualified Data.Matrix as M\nimport System.IO\nimport Data.List.Split\nimport qualified Data.Vector as V\n\nmain :: IO ()\nmain = do\n    contents &lt;- getContents\n    let lns = lines contents :: [String]\n        entries = map (splitOn \",\") lns :: [[String]]\n        mbPoints = mapM readPoints entries :: Maybe [[Double]]\n    case mbPoints of \n        Just points -&gt; runData points\n        _           -&gt; putStrLn \"Error: it is possible the file is incorrectly formatted\"\n\nreadPoints :: [String] -&gt; Maybe [Double]\nreadPoints dat@(x:y:_) = return $ map read dat\nreadPoints _ = Nothing\n\nrunData :: [[Double]] -&gt; IO ()\nrunData pts = do\n    let (mxs,ys) = runPoints pts\n        c = M.ncols mxs\n        m = M.nrows mxs\n        thetas = M.zero 1 (M.ncols mxs)\n        alpha = 0.01\n        iterations = 1000\n        results = gradientDescent mxs ys thetas alpha m c iterations\n    print results\n\nrunPoints :: [[Double]] -&gt; (M.Matrix Double, [Double])\nrunPoints pts = (xs, ys) where\n    xs = M.fromLists $ addX0 $ map init pts\n    ys = map last pts\n\n-- X0 will always be 1\naddX0 :: [[Double]] -&gt; [[Double]]\naddX0 = map (1.0 :)\n\n-- theta is 1xn and x is nx1, where n is the amount of features\n-- so it is safe to assume a scalar results from the multiplication\nhypothesis :: M.Matrix Double -&gt; M.Matrix Double -&gt; Double\nhypothesis thetas x = \n    M.getElem 1 1 (M.multStd thetas x)\n\ngradientDescent :: M.Matrix Double\n                   -&gt; [Double] \n                   -&gt; M.Matrix Double\n                   -&gt; Double \n                   -&gt; Int \n                   -&gt; Int \n                   -&gt; Int\n                   -&gt; [Double]\ngradientDescent mxs ys thetas alpha m n it = \n    let x i = M.colVector $ M.getRow i mxs\n        y i = ys !! (i-1)\n        h i = hypothesis thetas (x i)\n        thL = zip [1..] $ M.toList thetas :: [(Int, Double)]\n        z i j = ((h i) - (y i))*(M.getElem i j $ mxs)\n        sumSquares j = sum [z i j | i &lt;- [1..m]]\n        thetaJ t j = t - ((alpha * (1/ (fromIntegral m))) * (sumSquares j))\n        result = map snd $ foldl (\\ts _ -&gt; [(j,thetaJ t j) | (j,t) &lt;- ts]) thL [1..it] in\n    result\n</code></pre>\n\n<p>and the data...</p>\n\n<pre><code>6.1101,17.592\n5.5277,9.1302\n8.5186,13.662\n7.0032,11.854\n5.8598,6.8233\n8.3829,11.886\n7.4764,4.3483\n8.5781,12\n6.4862,6.5987\n5.0546,3.8166\n5.7107,3.2522\n14.164,15.505\n5.734,3.1551\n8.4084,7.2258\n5.6407,0.71618\n5.3794,3.5129\n6.3654,5.3048\n5.1301,0.56077\n6.4296,3.6518\n7.0708,5.3893\n6.1891,3.1386\n20.27,21.767\n5.4901,4.263\n6.3261,5.1875\n5.5649,3.0825\n18.945,22.638\n12.828,13.501\n10.957,7.0467\n13.176,14.692\n22.203,24.147\n5.2524,-1.22\n6.5894,5.9966\n9.2482,12.134\n5.8918,1.8495\n8.2111,6.5426\n7.9334,4.5623\n8.0959,4.1164\n5.6063,3.3928\n12.836,10.117\n6.3534,5.4974\n5.4069,0.55657\n6.8825,3.9115\n11.708,5.3854\n5.7737,2.4406\n7.8247,6.7318\n7.0931,1.0463\n5.0702,5.1337\n5.8014,1.844\n11.7,8.0043\n5.5416,1.0179\n7.5402,6.7504\n5.3077,1.8396\n7.4239,4.2885\n7.6031,4.9981\n6.3328,1.4233\n6.3589,-1.4211\n6.2742,2.4756\n5.6397,4.6042\n9.3102,3.9624\n9.4536,5.4141\n8.8254,5.1694\n5.1793,-0.74279\n21.279,17.929\n14.908,12.054\n18.959,17.054\n7.2182,4.8852\n8.2951,5.7442\n10.236,7.7754\n5.4994,1.0173\n20.341,20.992\n10.136,6.6799\n7.3345,4.0259\n6.0062,1.2784\n7.2259,3.3411\n5.0269,-2.6807\n6.5479,0.29678\n7.5386,3.8845\n5.0365,5.7014\n10.274,6.7526\n5.1077,2.0576\n5.7292,0.47953\n5.1884,0.20421\n6.3557,0.67861\n9.7687,7.5435\n6.5159,5.3436\n8.5172,4.2415\n9.1802,6.7981\n6.002,0.92695\n5.5204,0.152\n5.0594,2.8214\n5.7077,1.8451\n7.6366,4.2959\n5.8707,7.2029\n5.3054,1.9869\n8.2934,0.14454\n13.394,9.0551\n5.4369,0.61705\n</code></pre>\n\n<p>When <code>alpha</code> is <code>0.01</code>, my thetas evaluate to <code>[58.39135051546406,653.2884974555699]</code>. When <code>alpha</code> is <code>0.001</code> my values become <code>[5.839135051546473,65.32884974555617]</code>. When <code>iterations</code> is changed to 10,000 my values return to what they were before.</p>\n"}, {"tags": ["function", "haskell", "operators", "function-calls"], "answers": [{"tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": false, "score": 6, "last_activity_date": 1478770251, "last_edit_date": 1478770251, "creation_date": 1478769711, "answer_id": 40523912, "question_id": 40523702, "link": "https://stackoverflow.com/questions/40523702/use-of-function-application-operator-in-haskell/40523912#40523912", "title": "Use of function application operator in Haskell", "body": "<p><code>(@ x)</code> for any operator <code>@</code> is equivalent to <code>\\a -&gt; a @ x</code>; so <code>($ 3)</code> is equivalent to <code>\\f -&gt; f $ 3</code>, i.e. a function that applies any function you pass it to <code>3</code>. This syntax is called \"sections\".</p>\n\n<pre><code>&gt; let f = ($ 3)\n&gt; f show\n\"3\"\n&gt; f square\n9\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 8, "last_activity_date": 1478770503, "last_edit_date": 1478770503, "creation_date": 1478769722, "answer_id": 40523916, "question_id": 40523702, "link": "https://stackoverflow.com/questions/40523702/use-of-function-application-operator-in-haskell/40523916#40523916", "title": "Use of function application operator in Haskell", "body": "<p><code>($ 3)</code> is a section, and is equivalent to <code>\\f -&gt; f 3</code>, which takes a function argument and applies it to 3.</p>\n\n<p>If we considered <code>3</code> to be an integer, we would have that the type of <code>f</code> is <code>Int -&gt; b</code> (for any <code>b</code>), so the type of <code>($ 3)</code> would be <code>(Int -&gt; b) -&gt; b</code>.</p>\n\n<p>Things in Haskell are a bit more complex, since <code>3</code> can be of any numeric type, so we don't really need <code>f :: Int -&gt; b</code>, it's enough if <code>f :: a -&gt; b</code> where <code>a</code> is a numeric type.</p>\n\n<p>Hence we get <code>($ 3) :: Num a =&gt; (a -&gt; b) -&gt; b</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 3946, "user_id": 1261166, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vL1Ud.jpg?s=128&g=1", "display_name": "Viktor Mellgren", "link": "https://stackoverflow.com/users/1261166/viktor-mellgren"}, "is_accepted": false, "score": 3, "last_activity_date": 1479117917, "last_edit_date": 1479117917, "creation_date": 1478770044, "answer_id": 40524018, "question_id": 40523702, "link": "https://stackoverflow.com/questions/40523702/use-of-function-application-operator-in-haskell/40524018#40524018", "title": "Use of function application operator in Haskell", "body": "<p>Another way to look at it is </p>\n\n<pre><code>($) :: (a -&gt; b) -&gt; a -&gt; b\n3 :: Num a =&gt; a\n</code></pre>\n\n<p>and when you \"insert 3\" in the <code>($)</code> it will become</p>\n\n<pre><code>($ 3) :: Num a =&gt; (a -&gt; b) -&gt; b.\n</code></pre>\n\n<p>due to that you no longer need to supply the a, but the function you need to supply is now restricted to num, since the 3 can be any numeric type.</p>\n\n<p>This is at least how I look at functions in Haskell, like substitution in algebra.</p>\n"}], "owner": {"reputation": 627, "user_id": 634615, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/5d0319056378070fa0eea3a731fb173c?s=128&d=identicon&r=PG", "display_name": "user634615", "link": "https://stackoverflow.com/users/634615/user634615"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1479117917, "creation_date": 1478769071, "last_edit_date": 1478770402, "question_id": 40523702, "link": "https://stackoverflow.com/questions/40523702/use-of-function-application-operator-in-haskell", "title": "Use of function application operator in Haskell", "body": "<p>What does the following expression means in haskell?</p>\n\n<pre><code>($ 3)\n</code></pre>\n\n<p>ghci shows the following type</p>\n\n<pre><code>($ 3) :: Num a =&gt; (a -&gt; b) -&gt; b.\n</code></pre>\n"}, {"tags": ["haskell", "state-monad"], "comments": [{"owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 3, "creation_date": 1478769183, "post_id": 40523355, "comment_id": 68287883, "body": "I kind of feel that in this case the record syntax might be better suited. So something like <code>State MyState ()</code> where <code>data MyState = MyState { a :: Int, b :: String, c :: Bool, ... }</code>."}, {"owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "edited": false, "score": 0, "creation_date": 1478769281, "post_id": 40523355, "comment_id": 68287930, "body": "So if only <code>a</code> is update, I can just write <code>put $ myState {a = a&#39;}</code>."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1478791822, "post_id": 40523355, "comment_id": 68302520, "body": "you might also like using the <code>RecordWildCards</code> extension with your new <code>MyState</code> type"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1478770620, "post_id": 40524055, "comment_id": 68288788, "body": "In this context, perhaps it is worth mentioning <code>zoom</code> from <i>lens</i> as well."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 17, "last_activity_date": 1478770184, "creation_date": 1478770184, "answer_id": 40524055, "question_id": 40523355, "link": "https://stackoverflow.com/questions/40523355/how-do-i-avoid-referring-to-all-state-variables-when-updating-only-a-few/40524055#40524055", "title": "How do I avoid referring to all state variables when updating only a few?", "body": "<p>This seems like a job for <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lenses</a>. Especially the <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Tuple.html\" rel=\"nofollow noreferrer\"><code>Control.Lens.Tuple</code></a> module together with <code>.=</code> and <code>use</code>:</p>\n\n<pre><code>p1 = do\n   a &lt;- use _1\n   -- do something --\n   _1 .= a'\n</code></pre>\n\n<p>However, it's usually better if you give the things in your state proper names, e.g.</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-\n\ndata Record = MkRecord { _age :: Int\n                       , _name :: String\n                       , _programmer :: Bool\n                       } deriving (Show, Eq)\nmakeLenses ''Record\n</code></pre>\n\n<p>That way, you have better names for your field:</p>\n\n<pre><code>p1 = do\n   a &lt;- use age\n   -- do something --\n   age .= a'\n</code></pre>\n\n<p>Note that this still helps you if you don't want to use lenses, since you can use record syntax to update your data:</p>\n\n<pre><code> p1 = do\n      r &lt;- get\n      let a = _age r\n      --- do something\n      put $ r{_age = a'}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 11, "last_activity_date": 1478770797, "creation_date": 1478770797, "answer_id": 40524270, "question_id": 40523355, "link": "https://stackoverflow.com/questions/40523355/how-do-i-avoid-referring-to-all-state-variables-when-updating-only-a-few/40524270#40524270", "title": "How do I avoid referring to all state variables when updating only a few?", "body": "<p>This is a good situation to use records, with the <code>gets</code> and <code>modify</code> functions to manipulate subparts of the state:</p>\n\n<pre><code>data Env = Env\n  { envNumber :: Int\n  , envText :: String\n  }\n\np1 :: State Env ()\np1 = do\n    a &lt;- gets envNumber\n    -- ...\n    modify $ \\r -&gt; r { envNumber = a' }\n\np2 :: State Env ()\np2 = do\n    b &lt;- gets envText\n    -- ...\n    modify $ \\r -&gt; r { envText = b' }\n</code></pre>\n\n<p><code>gets</code> turns a pure getter function into a state action:</p>\n\n<pre><code>gets :: (s -&gt; a) -&gt; State s a\nenvNumber :: Env -&gt; Int\ngets envNumber :: State Env Int\n</code></pre>\n\n<p>And <code>modify</code> turns a pure update function into a state action:</p>\n\n<pre><code>modify :: (s -&gt; s) -&gt; State s ()\n(\\r -&gt; r { envText = b' }) :: Env -&gt; Env\nmodify (\\r -&gt; ...) :: State Env ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 5, "last_activity_date": 1478808550, "creation_date": 1478808550, "answer_id": 40536169, "question_id": 40523355, "link": "https://stackoverflow.com/questions/40523355/how-do-i-avoid-referring-to-all-state-variables-when-updating-only-a-few/40536169#40536169", "title": "How do I avoid referring to all state variables when updating only a few?", "body": "<p><code>lens</code>'s <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Zoom.html#v:zoom\" rel=\"noreferrer\"><code>zoom</code> combinator</a> lifts a computation in a <code>State</code> monad into a computation that runs in a \"larger\" <code>State</code> monad.</p>\n\n<pre><code>zoom :: Lens' s t -&gt; State t a -&gt; State s a\n</code></pre>\n\n<p>So, given a \"big\" state:</p>\n\n<pre><code>data Big = Big {\n    _big1 :: Medium,\n    _big2 :: Medium\n}\ndata Medium = Medium {\n    _medium1 :: Small,\n    _medium2 :: Small\n}\ndata Small = Small { _small :: Int }\n\nmakeLenses ''Big\nmakeLenses ''Medium\nmakeLenses ''Small\n</code></pre>\n\n<p>you can \"zoom in\" on a part of the state:</p>\n\n<pre><code>incr :: State Int ()\nincr = id += 1\n\nincrSmall :: State Big ()\nincrSmall = zoom (big2.medium1.small) incr\n</code></pre>\n\n<p>Of course, this'll work on big tuples as well as records, using <code>lens</code>'s built-in <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Tuple.html\" rel=\"noreferrer\">tuple field accessors</a>.</p>\n\n<p><code>zoom</code>'s real type signature is more general than the simple one I quoted above. It uses <code>MonadState</code> constraints to work under a monad transformer stack, rather than in <code>State</code> specifically.</p>\n"}], "owner": {"reputation": 5447, "user_id": 667027, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2cc242c4ce73c7e429f9f86f262d1844?s=128&d=identicon&r=PG", "display_name": "xzhu", "link": "https://stackoverflow.com/users/667027/xzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 580, "favorite_count": 1, "accepted_answer_id": 40524055, "answer_count": 3, "score": 19, "last_activity_date": 1478808550, "creation_date": 1478767786, "question_id": 40523355, "link": "https://stackoverflow.com/questions/40523355/how-do-i-avoid-referring-to-all-state-variables-when-updating-only-a-few", "title": "How do I avoid referring to all state variables when updating only a few?", "body": "<p>An idiom I use for composing a couple of procedures (with memory) is as follows:</p>\n\n<pre><code>p1 :: State (Int, String) ()\np1 = do\n    (a, b) &lt;- get\n    ... do something ...\n    put (a', b)\n\np2 :: State (Int, String) ()\np2 = do\n    (a, b) &lt;- get\n    ... do something else ...\n    put (a, b')\n\nmain = do\n    ... initializing a0 b0 ...\n    print . flip evalState (a0, b0)\n          . sequence $ replicate 10 p1 ++ repeat p2\n</code></pre>\n\n<p>However, as the number of state variable grows, this quickly gets way more verbose than necessary: </p>\n\n<pre><code>p1 :: State (Int, String, Bool, Int, String, Bool) ()\np1 = do\n    (a, b, c, d, e, f) &lt;- get\n    ... do something ...\n    put (a, b, c', d, e, f')\n\np2 :: State (Int, String, Bool, Int, String, Bool) ()\np2 = do\n    (a, b, c, d, e, f) &lt;- get\n    ... do something ...\n    put (a', b', c, d, e, f)\n\nmain = do\n    print . flip evalState (a0, b0, c0, d0, e0, f0)\n          . sequence $ replicate 10 p1 ++ repeat p2\n</code></pre>\n\n<p>As I was wondering, is there a way of updating only a few state variables without having to refer to all the unused ones? I was thinking something like <code>IORef</code> but for <code>State</code> (in fact there is a package <a href=\"https://hackage.haskell.org/package/stateref\" rel=\"noreferrer\">stateref</a>), but I'm not sure if there are already some common idioms that other people have been using.</p>\n"}, {"tags": ["haskell", "environment-variables", "cabal"], "comments": [{"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 1, "creation_date": 1478791980, "post_id": 40523024, "comment_id": 68302619, "body": "<code>.bash_profile</code> is only executed for login shells; try adding it to your <code>.bashrc</code>.  Does the verbosity flag tell you anything?  I see the calls at the end of <a href=\"https://github.com/haskell/cabal/blob/master/cabal-install/Distribution/Client/Run.hs\" rel=\"nofollow noreferrer\">github.com/haskell/cabal/blob/master/cabal-install/Distribut&zwnj;&#8203;ion/&hellip;</a> and <code>rawSystemExitWithEnv</code> in <a href=\"https://github.com/haskell/cabal/blob/master/Cabal/Distribution/Simple/Utils.hs\" rel=\"nofollow noreferrer\">github.com/haskell/cabal/blob/master/Cabal/Distribution/Simp&zwnj;&#8203;le/&hellip;</a>"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1478792782, "post_id": 40523024, "comment_id": 68303108, "body": "Just to check, you are running <code>cabal run</code> from the same shell as <code>ghci</code>, right? What OS is this?"}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "edited": false, "score": 0, "creation_date": 1478797171, "post_id": 40523024, "comment_id": 68306043, "body": "for the record the OS is macOS Sierra Version 10.12.1"}], "answers": [{"tags": [], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "is_accepted": true, "score": 0, "last_activity_date": 1478796920, "creation_date": 1478796920, "answer_id": 40533054, "question_id": 40523024, "link": "https://stackoverflow.com/questions/40523024/haskell-why-are-my-environment-variables-not-available-when-running-my-project/40533054#40533054", "title": "Haskell: Why are my environment variables not available when running my project under cabal?", "body": "<p>Thanks for the comments, I realized that this was just due to a stupid mistake by me.</p>\n\n<p>My program used a couple different environment variables, some of which were being successfully read -- the error was due to a missing one which I hadn't tested in ghci.</p>\n\n<p>So the issue was due to not testing all the variables, a silly mistake, but thanks for the comments anyway as they were helpful in diagnosing the issue.</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 754, "favorite_count": 0, "accepted_answer_id": 40533054, "answer_count": 1, "score": 3, "last_activity_date": 1478796920, "creation_date": 1478766604, "question_id": 40523024, "link": "https://stackoverflow.com/questions/40523024/haskell-why-are-my-environment-variables-not-available-when-running-my-project", "title": "Haskell: Why are my environment variables not available when running my project under cabal?", "body": "<p>Does anyone know how to define environment variables to be accessed by a program run with cabal?</p>\n\n<p>I want to define system environment variables that are available to my program, e.g. via <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/System-Environment.html\" rel=\"nofollow noreferrer\">System.Environment</a>'s 'getEnv' function. The variables are available to 'getEnv' in ghci, but not to a program run with cabal ('cabal run').</p>\n\n<p>I define my environment variables as:</p>\n\n<pre><code>$ export myvar=MYVALUE\n</code></pre>\n\n<p>Accessing them works in ghci:</p>\n\n<pre><code>Prelude System.Environment&gt; getEnv \"myvar\"\n\"MYVALUE\"\n</code></pre>\n\n<p>However, similarly using 'getEnv' in my program and running with 'cabal run' gives the error:</p>\n\n<pre><code>getEnv: does not exist (no environment variable)\n</code></pre>\n\n<p>Somehow my program is not finding them when run via cabal. I tried placing the 'export' statements in my .bash_profile and restarting my terminal. But this gave the same issue of working in ghci and giving that error when run with cabal.</p>\n"}, {"tags": ["list", "haskell", "variable-length"], "answers": [{"comments": [{"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 2, "creation_date": 1478743460, "post_id": 40518711, "comment_id": 68279456, "body": "<code>map</code> passes over a list, applying the function it&#39;s provided to each element and then returning this new list."}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "reply_to_user": {"reputation": 3, "user_id": 7139033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33073965d2f89528b809361287d53077?s=128&d=identicon&r=PG&f=1", "display_name": "AaronONeal", "link": "https://stackoverflow.com/users/7139033/aarononeal"}, "edited": false, "score": 0, "creation_date": 1478884341, "post_id": 40518711, "comment_id": 68344210, "body": "@AaronONeal: Also note that I am using curried syntax, there is an extra list on the left and right of the equal sign that is implied."}], "tags": [], "owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "is_accepted": true, "score": 5, "last_activity_date": 1478741632, "creation_date": 1478741632, "answer_id": 40518711, "question_id": 40518692, "link": "https://stackoverflow.com/questions/40518692/checking-the-length-of-multiple-lists/40518711#40518711", "title": "Checking the length of multiple lists", "body": "<p>You can just call <code>length</code> on each inputted list using <code>map</code>.</p>\n\n<pre><code>length' :: [[a]] -&gt; [Int]\nlength' = map length\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 7139033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33073965d2f89528b809361287d53077?s=128&d=identicon&r=PG&f=1", "display_name": "AaronONeal", "link": "https://stackoverflow.com/users/7139033/aarononeal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 511, "favorite_count": 0, "accepted_answer_id": 40518711, "answer_count": 1, "score": 0, "last_activity_date": 1481163718, "creation_date": 1478741420, "last_edit_date": 1481163718, "question_id": 40518692, "link": "https://stackoverflow.com/questions/40518692/checking-the-length-of-multiple-lists", "title": "Checking the length of multiple lists", "body": "<pre><code>length' :: [[Int]] -&gt; [Int]\nlength' [(x:xs)] = map length'[(x:xs)]\n</code></pre>\n\n<p>The code I have currently prints out the length over one inputted list. How do I go around finding the length for multiple lists.</p>\n\n<pre><code>E.g. Input:  [[2,3,4], [2]] Output: [3,1] \n</code></pre>\n"}, {"tags": ["haskell", "composition", "do-notation"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1478738301, "post_id": 40518251, "comment_id": 68278250, "body": "Please specify what composition you&#39;re actually trying to obtain here. At the very least, give the type signature you want for <code>composed</code>!"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1478738557, "post_id": 40518251, "comment_id": 68278301, "body": "Just normal function composition, but with the ability to store interstitial results for use in later function calls (see the example). I added the type."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1478738828, "post_id": 40518251, "comment_id": 68278354, "body": "Is there a reason you need to write it in point-free style? This should be easy in non-point-free style."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1478752480, "post_id": 40518251, "comment_id": 68281324, "body": "@immibis I suppose I could split some of the functions a bit. This example is simplified however, in my actual use-case I&#39;m re-using one of the earlier values like 6 or 7 function calls later and I&#39;m not sure how I&#39;d make that clean. Do you have an example of how this would help out?"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1478813798, "post_id": 40518251, "comment_id": 68314344, "body": "Something along the lines of <code>composed xs = filter ((== maxLength) . length) modified</code> <code>where modified = fmap (++ &quot;!!!&quot;) xs</code> <code>maxLength = maximum $ fmap length modified</code> (with appropriate whitespace)"}], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1478746525, "post_id": 40518510, "comment_id": 68280078, "body": "Hrmm, Interesting! I gave something similar a try in the edit above, I&#39;d still love to see something a bit more elegant though, it&#39;s all a bit awkward :/"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1478739988, "creation_date": 1478739988, "answer_id": 40518510, "question_id": 40518251, "link": "https://stackoverflow.com/questions/40518251/function-composition-do-notation/40518510#40518510", "title": "Function Composition Do Notation", "body": "<p>One possible way to achieve something like that are arrows. Basically, in \u201cstoring interstitial results\u201d you're just splitting up the information flow through the composition chain. That's what the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Arrow.html#v:-38--38--38-\" rel=\"nofollow noreferrer\"><code>&amp;&amp;&amp;</code> (fanout)</a> combinator does.</p>\n\n<pre><code>import Control.Arrow\n\ncomposed = fmap (++ \"!!!\")\n       &gt;&gt;&gt; ((. length) . (==) . maximum . fmap length &amp;&amp;&amp; id)\n       &gt;&gt;&gt; uncurry filter\n</code></pre>\n\n<p>This definitely isn't good human-comprehensible code though.</p>\n\n<p>A state monad would seem to allow something related too, but the problem is that the state type is fixed through the <code>do</code> block's monadic chain. That's not really flexible enough to pick up different-typed values throughout the composition chain. While it is certainly possible to circumvent this (amongst them, indeed, <code>RebindableSyntax</code>), this too isn't a good idea IMO.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1478754253, "last_edit_date": 1478754253, "creation_date": 1478753417, "answer_id": 40520154, "question_id": 40518251, "link": "https://stackoverflow.com/questions/40518251/function-composition-do-notation/40520154#40520154", "title": "Function Composition Do Notation", "body": "<p>What you have is essentially a filter, but one where the filtering function changes as you iterate over the list. I would model this not as a \"forked\" composition, but as a fold using the following function <code>f :: String -&gt; (Int, [String])</code>:</p>\n\n<ol>\n<li>The return value maintains the current maximum and all strings of that length.</li>\n<li>If the first argument is shorter than the current maximum, drop it.</li>\n<li>If the first argument is the same as the current maximum, add it to the list.</li>\n<li>If the first argument is <em>longer</em>, make its length the new maximum, and replace the current output list with a new list.</li>\n</ol>\n\n<p>Once the fold is complete, you just extract the list from the tuple.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Not really a suitable name anymore, but...\ncomposed :: [String] -&gt; [String]\ncomposed = snd . foldr f (0, [])\n    where f curr (maxLen, result) = let currLen = length curr\n                                    in case compare currLen maxLen of\n                                       LT -&gt; (maxLen, result)       -- drop\n                                       EQ -&gt; (maxLen, curr:result)  -- keep\n                                       GT -&gt; (length curr, [curr])  -- reset\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1478756377, "last_edit_date": 1478756377, "creation_date": 1478755284, "answer_id": 40520455, "question_id": 40518251, "link": "https://stackoverflow.com/questions/40518251/function-composition-do-notation/40520455#40520455", "title": "Function Composition Do Notation", "body": "<p>The type of <code>(&lt;*&gt;)</code> specialised to the function instance of <code>Applicative</code> is:</p>\n\n<pre><code>(&lt;*&gt;) :: (r -&gt; a -&gt; b) -&gt; (r -&gt; a) -&gt; (r -&gt; b)\n</code></pre>\n\n<p>The resulting <code>r -&gt; b</code> function passes its argument to both the <code>r -&gt; a -&gt; b</code> and the <code>r -&gt; a</code> functions, and then uses the <code>a</code> value produced by the <code>r -&gt; a</code> function as the second argument of the <code>r -&gt; a -&gt; b</code> one.</p>\n\n<p>What does this have to do with your function? <code>filter</code> is a function of two arguments, a predicate and a list. Now, a key aspect of what you are trying to do is that the predicate is generated from the list. That means the core of your function can be expressed in terms of <code>(&lt;*&gt;)</code>:</p>\n\n<pre><code>-- Using the predicate-generating function from leftaroundabout's answer.\nmaxLengthOnly :: Foldable t =&gt; [t a] -&gt; [t a]\nmaxLengthOnly = flip filter &lt;*&gt; ((. length) . (==) . maximum . fmap length)\n\ncomposed :: [String] -&gt; [String]\ncomposed = maxLengthOnly . fmap (++ \"!!!\")\n</code></pre>\n\n<p>This <code>maxLengthOnly</code> definition would be a quite nice one-liner if the pointfree predicate-generating function weren't so clunky.</p>\n\n<p>Since the <code>Applicative</code> instance of functions is equivalent in power to the <code>Monad</code> one, <code>maxLengthOnly</code> can also be phrased as:</p>\n\n<pre><code>maxLengthOnly = (. length) . (==) . maximum . fmap length &gt;&gt;= filter\n</code></pre>\n\n<p>(The <code>split</code> you added to your question, by the way, is <code>(&gt;&gt;=)</code> for functions.)</p>\n\n<p>A different way of writing it with <code>Applicative</code> is:</p>\n\n<pre><code>maxLengthOnly = filter &lt;$&gt; ((. length) . (==) . maximum . fmap length) &lt;*&gt; id\n</code></pre>\n\n<p>It is no coincidence that this looks a lot like leftaroundabout's solution: for functions, <code>(,) &lt;$&gt; f &lt;*&gt; g = liftA2 (,) f g = f &amp;&amp;&amp; g</code>.</p>\n\n<p>Finally, it is also worth noting that, while it is tempting to replace <code>id</code> in the latest version of <code>maxLengthOnly</code> with <code>fmap (++ \"!!!\")</code>, that won't work because <code>fmap (++ \"!!!\")</code> changes the length of the strings, and therefore affects the result of the predicate. With a function that doesn't invalidate the predicate, though, it would work pretty well:</p>\n\n<pre><code>nicerComposed = filter\n    &lt;$&gt; ((. length) . (==) . maximum . fmap length) &lt;*&gt; fmap reverse\n</code></pre>\n\n\n\n<pre><code>GHCi&gt; nicerComposed [\"alice\",\"bob\",\"david\"]\n[\"ecila\",\"divad\"]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1478790070, "post_id": 40529545, "comment_id": 68301267, "body": "Good to mention, though I&#39;d say the strength of <code>proc</code> notation is that it allows you to write quite general arrow compositions <i>as if</i> they were functions in lambda syntax. If the category you&#39;re working on <i>is</i> <code>(-&gt;)</code>, then there&#39;s not much reason to not just use lambdas / <code>let...in</code> binding to accomplish the same thing, if you&#39;re going to give those intermediate results names anyway."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1478791276, "post_id": 40529545, "comment_id": 68302129, "body": "@leftaroundabout Yes, there exist arrows besides <code>(-&gt;)</code> and you may want to write general version function compositions though I didn&#39;t do it for this case to make example simpler. Your version follows thoughts from this blog-post: <a href=\"http://degoes.net/articles/insufficiently-polymorphic\" rel=\"nofollow noreferrer\">degoes.net/articles/insufficiently-polymorphic</a> But sometimes having variable names may ease code understandability (especially for arrows)."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 2, "last_activity_date": 1478787701, "last_edit_date": 1495542624, "creation_date": 1478786702, "answer_id": 40529545, "question_id": 40518251, "link": "https://stackoverflow.com/questions/40518251/function-composition-do-notation/40529545#40529545", "title": "Function Composition Do Notation", "body": "<p>As <a href=\"https://stackoverflow.com/users/745903/leftaroundabout\">leftaroundabout</a> mentioned, you can use <code>Arrows</code> to write your function. But, there is a feature in <em>ghc</em> Haskell compiler, which is <code>proc</code>-notation for Arrows. It is very similar to well-known <code>do</code>-notation, but, unfortunately, not many people aware of it.</p>\n\n<p>With <code>proc</code>-notation you can write your desired function in next more redable and elegant way:</p>\n\n<pre><code>{-# LANGUAGE Arrows #-}\n\nimport Control.Arrow (returnA)\nimport Data.List     (maximum)\n\ncomposed :: [String] -&gt; [String]\ncomposed = proc l -&gt; do\n    bangedL &lt;- fmap (++\"!!!\")        -&lt; l\n    maxLen  &lt;- maximum . fmap length -&lt; bangedL\n    returnA -&lt; filter ((== maxLen) . length) bangedL\n</code></pre>\n\n<p>And this works in <em>ghci</em> as expected:</p>\n\n<pre><code>ghci&gt; composed [\"alice\", \"bob\", \"david\"]\n[\"alice!!!\",\"david!!!\"]\n</code></pre>\n\n<p>If you are interested, you can read some tutorials with nice pictures to understand what is arrow and how this powerful feature works so you can dive deeper into it:</p>\n\n<p><a href=\"https://www.haskell.org/arrows/index.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/arrows/index.html</a></p>\n\n<p><a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_arrows\" rel=\"nofollow noreferrer\">https://en.wikibooks.org/wiki/Haskell/Understanding_arrows</a></p>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 1, "accepted_answer_id": 40529545, "answer_count": 4, "score": 7, "last_activity_date": 1478787701, "creation_date": 1478738113, "last_edit_date": 1478746452, "question_id": 40518251, "link": "https://stackoverflow.com/questions/40518251/function-composition-do-notation", "title": "Function Composition Do Notation", "body": "<p>Is there a \"do notation\" syntactic sugar for simple function composition? </p>\n\n<p>(i.e. <code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>)</p>\n\n<p>I'd like to be able to store results of some compositions for later (while still continuing the chain.</p>\n\n<p>I'd rather not use the RebindableSyntax extension if possible.</p>\n\n<p>I'm looking for something like this:</p>\n\n<pre><code>composed :: [String] -&gt; [String]\ncomposed = do\n    fmap (++ \"!!!\")\n    maxLength &lt;- maximum . fmap length\n    filter ((== maxLength) . length)\n\ncomposed [\"alice\", \"bob\", \"david\"]\n-- outputs: [\"alice!!!\", \"david!!!\"]\n</code></pre>\n\n<p>I'm not sure something like this is possible, since the result of the earlier function essentially has to pass \"through\" the bind of maxLength, but I'm open to hearing of any other similarly expressive options. Basically I need to collect information as I go through the composition in order to use it later.</p>\n\n<p>Perhaps I could do something like this with a state monad?</p>\n\n<p>Thanks for your help!</p>\n\n<p><strong>Edit</strong></p>\n\n<p>This sort of thing kinda works:</p>\n\n<pre><code>split :: (a -&gt; b) -&gt; (b -&gt; a -&gt; c) -&gt; a -&gt; c\nsplit ab bac a = bac (ab a) a\n\ncomposed :: [String] -&gt; [String]\ncomposed = do\n    fmap (++ \"!!!\")\n    split \n        (maximum . fmap length)\n        (\\maxLength -&gt; (filter ((== maxLength) . length)))\n</code></pre>\n"}]