[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1512596260, "post_id": 47683804, "comment_id": 82327249, "body": "<code>getContents</code> fetches ALL the input, and requires that you don&#39;t read anything from input after that. Are you satisfying that contract? Check <code>Lib.someFunc</code>, for instance."}, {"owner": {"reputation": 361, "user_id": 8514646, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/pNkTZ.png?s=128&g=1", "display_name": "kuwze", "link": "https://stackoverflow.com/users/8514646/kuwze"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512596425, "post_id": 47683804, "comment_id": 82327329, "body": "Thank you, that makes sense (and it seems the error was because I was using System.Process in Lib.someFunc)."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1512597077, "post_id": 47683804, "comment_id": 82327657, "body": "There are argument parsing libraries out there. Is there a reason not to use one of them?"}, {"owner": {"reputation": 361, "user_id": 8514646, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/pNkTZ.png?s=128&g=1", "display_name": "kuwze", "link": "https://stackoverflow.com/users/8514646/kuwze"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1512597370, "post_id": 47683804, "comment_id": 82327790, "body": "@ThomasM.DuBuisson: I am ignorant of those. Would you mind pointing me towards them?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1512597545, "post_id": 47683804, "comment_id": 82327874, "body": "<a href=\"https://hackage.haskell.org/package/optparse-applicative-0.14.0.0/docs/Options-Applicative.html\" rel=\"nofollow noreferrer\">optparse-applicative</a> is the powerful preferred parser by many developers.  However, for simple jobs I like the aptly named <a href=\"https://hackage.haskell.org/package/simple-get-opt\" rel=\"nofollow noreferrer\">simple-get-opt</a>."}, {"owner": {"reputation": 361, "user_id": 8514646, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/pNkTZ.png?s=128&g=1", "display_name": "kuwze", "link": "https://stackoverflow.com/users/8514646/kuwze"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1512597827, "post_id": 47683804, "comment_id": 82328019, "body": "@ThomasM.DuBuisson: thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "edited": false, "score": 0, "creation_date": 1533568787, "post_id": 47684631, "comment_id": 90383022, "body": "What&#39;s the <code>ShowHelpText</code>?"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "edited": false, "score": 0, "creation_date": 1533578820, "post_id": 47684631, "comment_id": 90388025, "body": "@przemo_li It is a type constructor that will fail parsing the cli arguments and terminate the program while showing the help test, i.e. options, descriptions and such. <a href=\"https://www.stackage.org/haddock/lts-12.5/optparse-applicative-0.14.2.0/Options-Applicative.html#t:ParseError\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-12.5/optparse-applicative-0.14.2.0/&zwnj;&#8203;&hellip;</a>"}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": false, "score": 5, "last_activity_date": 1512599718, "creation_date": 1512599718, "answer_id": 47684631, "question_id": 47683804, "link": "https://stackoverflow.com/questions/47683804/parsing-command-line-arguments-in-haskell/47684631#47684631", "title": "Parsing command line arguments in Haskell", "body": "<p>To follow up on @ThomasM.DuBuisson comment <a href=\"https://www.stackage.org/package/optparse-applicative\" rel=\"noreferrer\">optparse-applicative</a> is a great package for cli and arguments parsing. There is also another package <a href=\"https://www.stackage.org/package/optparse-simple\" rel=\"noreferrer\">optparse-simple</a> that is built on top of the previous one and has a few helpers that simplify things a bit. </p>\n\n<p>Just so you can get started with <code>optparse-applicative</code> here is an implementation of your example:</p>\n\n<pre><code>data Options = Options\n  { author :: String\n  }\n\nmain :: IO ()\nmain = do\n  let ver = \"gc2 -- git-cal in Haskell2010 - 0.1\"\n  args &lt;-\n    execParser $\n    info\n      (Options &lt;$&gt;\n       strOption (long \"author\" &lt;&gt;\n                  short 'a' &lt;&gt;\n                  help \"Name of the author.\") &lt;*\n       infoOption ver (long \"version\" &lt;&gt;\n                       short 'v' &lt;&gt;\n                       help \"Display version and exit.\") &lt;*\n       abortOption ShowHelpText (long \"help\" &lt;&gt;\n                                 short 'h' &lt;&gt;\n                                 help \"Display this message.\"))\n      (progDesc \"Very powerful tool.\" &lt;&gt; fullDesc)\n  putStrLn $ author args\n</code></pre>\n\n<p>And usage example from GHCi:</p>\n\n<pre><code>\u03bb&gt; :main\nMissing: (-a|--author ARG)\n\nUsage: &lt;interactive&gt; (-a|--author ARG) [-v|--version] [-h|--help]\n  Very powerful tool.\n*** Exception: ExitFailure 1\n\u03bb&gt; :main --version\ngc2 -- git-cal in Haskell2010 - 0.1\n*** Exception: ExitSuccess\n\u03bb&gt; :main --help\nUsage: &lt;interactive&gt; (-a|--author ARG) [-v|--version] [-h|--help]\n  Very powerful tool.\n\nAvailable options:\n  -a,--author ARG          Name of the author.\n  -v,--version             Display version and exit.\n  -h,--help                Display this message.\n*** Exception: ExitSuccess\n\u03bb&gt; :main --author Me\nMe\n</code></pre>\n"}], "owner": {"reputation": 361, "user_id": 8514646, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/pNkTZ.png?s=128&g=1", "display_name": "kuwze", "link": "https://stackoverflow.com/users/8514646/kuwze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2254, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1512599718, "creation_date": 1512596063, "question_id": 47683804, "link": "https://stackoverflow.com/questions/47683804/parsing-command-line-arguments-in-haskell", "title": "Parsing command line arguments in Haskell", "body": "<p>I am currently working on a project that requires parsing command line arguments. So far I have been following <a href=\"https://wiki.haskell.org/Tutorials/Programming_Haskell/Argument_handling\" rel=\"nofollow noreferrer\">this tutorial</a>, which has been incredibly helpful, but I can't figure out how to return a variable (--author=example) in the arguments. I also can't figure out why <strong><code>parse [] = getContents</code></strong> causes an error (I had to uncomment it).</p>\n\n<p>Here is my code:</p>\n\n<pre><code>module Main where\n\nimport qualified System.Environment as SE\nimport qualified System.Exit as E\nimport qualified Lib as Lib\n\nmain = do\n  args &lt;- SE.getArgs\n  rem &lt;- parse args\n  Lib.someFunc\n  putStrLn rem\n  putStrLn \"Hello\"\n\ntac  = unlines . reverse . lines\n\nparse [\"--help\"]    = usage   &gt;&gt; exit\nparse [\"--version\"] = version &gt;&gt; exit\nparse [\"--author=xyz\"] = return \"xyz\"\n-- parse [\"--author=?\"] = ?\n{-\nthis is the code I am trying to figure out... how do I get parse the passed in variable name?\n-}\n\n-- parse []            = getContents\n{-\nthe above line generates this error when I run 'main' in GHCi:\n\n  *Main&gt; &lt;stdin&gt;: hIsEOF: illegal operation (handle is semi-closed)\n  Process intero exited abnormally with code 1\n\n-}\nparse fs            = concat `fmap` mapM readFile fs\n\nusage   = putStrLn \"Usage: gc2\"\nversion = putStrLn \"gc2 -- git-cal in Haskell2010 - 0.1\"\nexit    = E.exitWith E.ExitSuccess\ndie     = E.exitWith (E.ExitFailure 1)\n</code></pre>\n"}, {"tags": ["haskell", "dynamic", "gadt"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512596102, "post_id": 47683486, "comment_id": 82327172, "body": "I guess you need to provide a specific type to that <code>(Lam ...)</code>, otherwise it is too general and can only be given a polymorphic type. Basically, you have to choose what <code>b</code> is in the <code>Const</code> application."}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 8415977, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a340bd27bb52c2887829884e9e8040e7?s=128&d=identicon&r=PG&f=1", "display_name": "Donovan", "link": "https://stackoverflow.com/users/8415977/donovan"}, "edited": false, "score": 0, "creation_date": 1512596606, "post_id": 47683846, "comment_id": 82327433, "body": "Is there a way I can give the general variable a typeable constraint? I&#39;ve tried <code>data Expr a where Const :: (Typeable a, Typeable b) =&gt; Expr a -&gt; Expr b -&gt; Expr a</code> without much luck. I&#39;ve even tried autoderiving Typeable for Expr."}, {"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "reply_to_user": {"reputation": 69, "user_id": 8415977, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a340bd27bb52c2887829884e9e8040e7?s=128&d=identicon&r=PG&f=1", "display_name": "Donovan", "link": "https://stackoverflow.com/users/8415977/donovan"}, "edited": false, "score": 0, "creation_date": 1512596729, "post_id": 47683846, "comment_id": 82327502, "body": "@Donovan I was just playing with that, but I don&#39;t think <code>Typeable</code> works like that - I think the problem is that the type variable is existential."}, {"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "reply_to_user": {"reputation": 69, "user_id": 8415977, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a340bd27bb52c2887829884e9e8040e7?s=128&d=identicon&r=PG&f=1", "display_name": "Donovan", "link": "https://stackoverflow.com/users/8415977/donovan"}, "edited": false, "score": 0, "creation_date": 1512596951, "post_id": 47683846, "comment_id": 82327606, "body": "@Donovan in the end, there needs to be a specific type for the <code>Typeable</code> instance. But because of the existential, it can never be provided. At least I think that&#39;s what&#39;s happening. You get similar errors if you try <code>toDyn</code> directly on a polymorphic function like <code>toDyn (\\a -&gt; a)</code>. Whereas <code>toDyn (\\a -&gt; a + a)</code> is ok, because of defaulting of the <code>Num</code> constraint."}, {"owner": {"reputation": 69, "user_id": 8415977, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a340bd27bb52c2887829884e9e8040e7?s=128&d=identicon&r=PG&f=1", "display_name": "Donovan", "link": "https://stackoverflow.com/users/8415977/donovan"}, "edited": false, "score": 0, "creation_date": 1512691514, "post_id": 47683846, "comment_id": 82371693, "body": "Thanks for this, maybe I can try something fancy using type families to extract the correct type from a custom Dynamic-like structure."}], "tags": [], "owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "is_accepted": true, "score": 1, "last_activity_date": 1512596233, "creation_date": 1512596233, "answer_id": 47683846, "question_id": 47683486, "link": "https://stackoverflow.com/questions/47683486/unable-to-create-dynamic-from-gadt-expression-type-in-haskell/47683846#47683846", "title": "Unable to create Dynamic from GADT Expression Type in Haskell", "body": "<p>The error is saying that type of the second argument to <code>Const</code>, the one that is being thrown away, needs to be <code>Typeable</code>. But it's a fully general type variable, without a Typeable constraint. If you write something like</p>\n\n<pre><code>toDyn (Const (Lift 1) :: Expr Int -&gt; Expr Int)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>toDyn (Lam (Const (Lift 1) :: Expr Int -&gt; Expr Int))\n</code></pre>\n\n<p>both work.</p>\n"}], "owner": {"reputation": 69, "user_id": 8415977, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a340bd27bb52c2887829884e9e8040e7?s=128&d=identicon&r=PG&f=1", "display_name": "Donovan", "link": "https://stackoverflow.com/users/8415977/donovan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 47683846, "answer_count": 1, "score": 2, "last_activity_date": 1512596233, "creation_date": 1512594575, "question_id": 47683486, "link": "https://stackoverflow.com/questions/47683486/unable-to-create-dynamic-from-gadt-expression-type-in-haskell", "title": "Unable to create Dynamic from GADT Expression Type in Haskell", "body": "<p>I have the following in Haskell (as a minimum example).</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\nimport Data.Dynamic    \n\ndata Expr a where\n  Lift  :: (Show a) =&gt; a -&gt; Expr a --Lift some type into Expr\n  Lam   :: (Expr a -&gt; Expr b) -&gt; Expr (a -&gt; b)\n  Const :: Expr a -&gt; Expr b -&gt; Expr a\n</code></pre>\n\n<p>When I try to create a Dynamic from the following, I get an error that I'm unsure how to correct.</p>\n\n<pre><code>--This is the code\ntoDyn $ (Lam (Const (Lift 1)))\n-- This is the error\n-- \u2022 No instance for (Typeable b0) arising from a use of \u2018toDyn\u2019\n-- \u2022 In the expression: toDyn (Lam (Const (Lift 1)))\n--   In an equation for \u2018it\u2019: it = toDyn (Lam (Const (Lift 1)))\n</code></pre>\n\n<p>Is there there any way around this? The other constructors all work fine (my actual program has over 100 others!) but Const is really giving me trouble!</p>\n"}, {"tags": ["haskell", "ghc", "ghc-api"], "comments": [{"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1512600473, "post_id": 47680575, "comment_id": 82329113, "body": "I have a feeling that this can be a use case for ghc <a href=\"https://plv.mpi-sws.org/backpack/\" rel=\"nofollow noreferrer\">backpack</a>, but can&#39;t tell for sure as I haven&#39;t used it yet myself. Also it is only available on ghc-8.2"}, {"owner": {"reputation": 462, "user_id": 2068056, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/845g4.jpg?s=128&g=1", "display_name": "eugenk", "link": "https://stackoverflow.com/users/2068056/eugenk"}, "reply_to_user": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1512640672, "post_id": 47680575, "comment_id": 82343531, "body": "Thanks, but I&#39;m not sure whether or not we can upgrade the project to GHC 8.2 at this point. Also, we use Stack, which is incompatible to backpack at the moment (although they are working on it)."}, {"owner": {"reputation": 462, "user_id": 2068056, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/845g4.jpg?s=128&g=1", "display_name": "eugenk", "link": "https://stackoverflow.com/users/2068056/eugenk"}, "reply_to_user": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 0, "creation_date": 1512640990, "post_id": 47680575, "comment_id": 82343758, "body": "I edited the post to show my current approach."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1514524697, "post_id": 47680575, "comment_id": 83004531, "body": "If I ensure a .hs file exists, then the error message is different, so something in the GHC make system is checking for the existence of a file which tallies with the documentations note that this is a feature for IDE&#39;s where the file can exist but some in-progress content should be used."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1514524721, "post_id": 47680575, "comment_id": 83004537, "body": "The next error in my case is: &quot;buffer needs preprocesing; interactive check disabled&quot;"}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1514524830, "post_id": 47680575, "comment_id": 83004559, "body": "which was due to the use of the Cpp option, without that the content is loaded fine and the dynamic string is used."}], "answers": [{"comments": [{"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1514551781, "post_id": 48017764, "comment_id": 83014873, "body": "If anyone knows of a way to force a module to be interpreted then perhaps no file on disk is required. If so, please add your knowledge!"}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1516093622, "post_id": 48017764, "comment_id": 83538406, "body": "Even when forcing a module to be interpreted a file on disk is required. I looked for ways to hook GHC&#39;s API where it accesses the filesystem but it looks like GHC uses the IO monad for that and there&#39;s no kind of ModuleStore type class that one could implement."}], "tags": [], "owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "is_accepted": false, "score": 1, "last_activity_date": 1515369917, "last_edit_date": 1515369917, "creation_date": 1514524889, "answer_id": 48017764, "question_id": 47680575, "link": "https://stackoverflow.com/questions/47680575/haskell-ghc-8-dynamically-load-import-module/48017764#48017764", "title": "Haskell, GHC 8: dynamically load/import module", "body": "<p>A file with a matching module name must exist by the looks of it - it doesn't seem to matter what the file's content is.</p>\n\n<p>On Linux I can even make it be a symlink to /dev/null and things work but a symlink to itself doesn't.</p>\n"}], "owner": {"reputation": 462, "user_id": 2068056, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/845g4.jpg?s=128&g=1", "display_name": "eugenk", "link": "https://stackoverflow.com/users/2068056/eugenk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 863, "favorite_count": 5, "answer_count": 1, "score": 12, "last_activity_date": 1515369917, "creation_date": 1512582843, "last_edit_date": 1512764969, "question_id": 47680575, "link": "https://stackoverflow.com/questions/47680575/haskell-ghc-8-dynamically-load-import-module", "title": "Haskell, GHC 8: dynamically load/import module", "body": "<p>I need to have something like</p>\n\n<pre><code>-- Main.hs\nmodule Main where\n\nmain :: IO ()\nmain = do\n  &lt;import Plugin&gt;\n  print Plugin.computation\n</code></pre>\n\n<p>With a Plugin like</p>\n\n<pre><code>-- Plugin.hs\nmodule Plugin where\n\ncomputation :: Int\ncomputation = 4\n</code></pre>\n\n<p>However, I need the plugin to be compiled alongside the main application. They need to be deployed together. Only the import (not the compilation) of the module should happen dynamically.</p>\n\n<p>I found <a href=\"https://stackoverflow.com/questions/16806460/dynamically-loading-compiled-haskell-module-ghc-7-6\">Dynamically loading compiled Haskell module - GHC 7.6</a> along the way and it works just fine with GHC 8.0.2 except for the fact that it requires the source file of the plugin to be in the current working directory when executing the application.</p>\n\n<hr>\n\n<h1>Edit (07.12.2017)</h1>\n\n<p>Is it possible to load a module from a String instead of a file using the GHC API? <a href=\"http://hackage.haskell.org/package/ghc-8.2.1/docs/GHC.html#t:Target\" rel=\"noreferrer\">http://hackage.haskell.org/package/ghc-8.2.1/docs/GHC.html#t:Target</a> suggests that it's possible, but the documentation has many holes and I can't find a way to actually do this. If this can be accomplished, I can use <a href=\"http://hackage.haskell.org/package/file-embed\" rel=\"noreferrer\" title=\"file-embed\">file-embed</a> to include the plugin source file into the compiled binary.\nExample:</p>\n\n<pre><code>module Main where\n\n-- Dynamic loading of modules\nimport GHC\nimport GHC.Paths ( libdir )\nimport DynFlags\nimport Unsafe.Coerce\n\nimport Data.Time.Clock (getCurrentTime)\nimport StringBuffer\n\npluginModuleNameStr :: String\npluginModuleNameStr = \"MyPlugin\"\n\npluginSourceStr :: String\npluginSourceStr = unlines\n  [ \"module MyPlugin where\"\n  , \"computation :: Int\"\n  , \"computation = 4\"\n  ]\n\npluginModuleName :: ModuleName\npluginModuleName = mkModuleName pluginModuleNameStr\n\npluginSource :: StringBuffer\npluginSource = stringToStringBuffer pluginSourceStr\n\nmain :: IO ()\nmain = do\n    currentTime &lt;- getCurrentTime\n    defaultErrorHandler defaultFatalMessager defaultFlushOut $ do\n      result &lt;- runGhc (Just libdir) $ do\n        dflags &lt;- getSessionDynFlags\n        setSessionDynFlags dflags\n        let target = Target { targetId = TargetModule $ pluginModuleName\n                            , targetAllowObjCode = True\n                            , targetContents = Just ( pluginSource\n                                                    , currentTime\n                                                    )\n                            }\n        setTargets [target]\n        r &lt;- load LoadAllTargets\n        case r of\n          Failed    -&gt; error \"Compilation failed\"\n          Succeeded -&gt; do\n            setContext [IIDecl $ simpleImportDecl pluginModuleName]\n            result &lt;- compileExpr (\"MyPlugin.computation\")\n            let result' = unsafeCoerce result :: Int\n            return result'\n      print result\n</code></pre>\n\n<p>This, however, results in </p>\n\n<pre><code>&lt;command-line&gt;: panic! (the 'impossible' happened)\n  (GHC version 8.0.2 for x86_64-apple-darwin):\n    module \u2018MyPlugin\u2019 is a package module\n</code></pre>\n\n<hr>\n\n<h1>Edit (08.12.2017)</h1>\n\n<p>I can compile the \"plugin\" directly into the final binary by writing the source to a temp file and then loading it like in the linked post (<a href=\"https://stackoverflow.com/questions/16806460/dynamically-loading-compiled-haskell-module-ghc-7-6\">Dynamically loading compiled Haskell module - GHC 7.6</a>). However, this does not play well if the plugin imports packages from Hackage:</p>\n\n<pre><code>module Main where\n\nimport Control.Monad.IO.Class (liftIO)\nimport DynFlags\nimport GHC\nimport GHC.Paths (libdir)\nimport System.Directory (getTemporaryDirectory, removePathForcibly)\nimport Unsafe.Coerce (unsafeCoerce)\n\npluginModuleNameStr :: String\npluginModuleNameStr = \"MyPlugin\"\n\npluginSourceStr :: String\npluginSourceStr = unlines\n  [ \"module MyPlugin where\"\n  , \"import Data.Aeson\"\n  , \"computation :: Int\"\n  , \"computation = 4\"\n  ]\n\nwriteTempFile :: IO FilePath\nwriteTempFile = do\n  dir &lt;- getTemporaryDirectory\n  let file = dir ++ \"/\" ++ pluginModuleNameStr ++ \".hs\"\n  writeFile file pluginSourceStr\n  return file\n\nmain :: IO ()\nmain = do\n  moduleFile &lt;- writeTempFile\n  defaultErrorHandler defaultFatalMessager defaultFlushOut $ do\n    result &lt;- runGhc (Just libdir) $ do\n      dflags &lt;- getSessionDynFlags\n      setSessionDynFlags dflags\n      target &lt;- guessTarget moduleFile Nothing\n      setTargets [target]\n      r &lt;- load LoadAllTargets\n      liftIO $ removePathForcibly moduleFile\n      case r of\n        Failed -&gt; error \"Compilation failed\"\n        Succeeded -&gt; do\n          setContext [IIDecl $ simpleImportDecl $ mkModuleName pluginModuleNameStr]\n          result &lt;- compileExpr \"MyPlugin.computation\"\n          let result' = unsafeCoerce result :: Int\n          return result'\n    print result\n</code></pre>\n\n<p>Is there a way to load packages when, for instance, <code>MyPlugin</code> contains the statement <code>import Data.Aeson</code>? If I add it to the plugin string, it fails with</p>\n\n<pre><code>/var/folders/t2/hp9y8x6s6rs7zg21hdzvhbf40000gn/T/MyPlugin.hs:2:1: error:\n    Failed to load interface for \u2018Data.Aeson\u2019\n    Perhaps you meant Data.Version (from base-4.9.1.0)\n    Use -v to see a list of the files searched for.\nhaskell-loader-exe: panic! (the 'impossible' happened)\n  (GHC version 8.0.2 for x86_64-apple-darwin):\n  Compilation failed\nCallStack (from HasCallStack):\n  error, called at app/Main.hs:40:19 in main:Main\n</code></pre>\n\n<hr>\n\n<p>The reason for my request is database support: We use Persistent to access a database and the dynamic import is needed to support multiple databases (MySQL, PostgreSQL and SQLite) while still allowing the end user to only install one of the three database servers (with other words: not requiring the user to install all of them if they only use, for instance, PostgreSQL). The module that is database-specific should only be loaded when the user actually configures the main application to use that module.</p>\n\n<p>If I don't <code>import Database.Persist.MySQL</code>, then the application does not require MySQL to be installed. Otherwise, the application fails with, for instance,</p>\n\n<pre><code>dyld: Library not loaded: \n/usr/local/opt/mysql/lib/libmysqlclient.20.dylib\n</code></pre>\n\n<p>on macOS.</p>\n"}, {"tags": ["haskell", "hspec"], "answers": [{"comments": [{"owner": {"reputation": 28942, "user_id": 398441, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/a8950160c2b3d7d0bf948d8c1f937e7f?s=128&d=identicon&r=PG", "display_name": "Johan", "link": "https://stackoverflow.com/users/398441/johan"}, "edited": false, "score": 0, "creation_date": 1512590604, "post_id": 47681049, "comment_id": 82324287, "body": "This is a good idea but databases like MongoDB generates  an id by default and it&#39;s not something that you necessarily    supply to the db. So is not exactly what I&#39;m asking for."}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "reply_to_user": {"reputation": 28942, "user_id": 398441, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/a8950160c2b3d7d0bf948d8c1f937e7f?s=128&d=identicon&r=PG", "display_name": "Johan", "link": "https://stackoverflow.com/users/398441/johan"}, "edited": false, "score": 0, "creation_date": 1512596718, "post_id": 47681049, "comment_id": 82327497, "body": "@Johan I&#39;m suggesting you create the entity using e.g. MongoDB, then use any database-populated fields it returns to you to create a record which you then do comparisons with."}, {"owner": {"reputation": 28942, "user_id": 398441, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/a8950160c2b3d7d0bf948d8c1f937e7f?s=128&d=identicon&r=PG", "display_name": "Johan", "link": "https://stackoverflow.com/users/398441/johan"}, "edited": false, "score": 0, "creation_date": 1512625864, "post_id": 47681049, "comment_id": 82336055, "body": "Oh sorry, I misunderstood."}], "tags": [], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "is_accepted": true, "score": 2, "last_activity_date": 1512625830, "last_edit_date": 1512625830, "creation_date": 1512584643, "answer_id": 47681049, "question_id": 47680481, "link": "https://stackoverflow.com/questions/47680481/match-any-string-in-haskell-record-in-hspec-test/47681049#47681049", "title": "Match &quot;any string&quot; in Haskell record in HSpec test", "body": "<p>Can you create the record, then use its <code>id</code> value to create the record you're comparing against? Something like:</p>\n\n<pre><code>new &lt;- newPersistentEntity \"myName\"\nnew `shouldBe` Entity { id = (id new), name = \"myName\" }\n</code></pre>\n\n<p>(Note: don't have enough information to test this code, treat this as somewhat pseudo code).</p>\n\n<p>As a side note, your code doesn't look like normal Persistent code, so I'm assuming you're using a different library.</p>\n"}, {"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 2, "last_activity_date": 1512589802, "last_edit_date": 1512589802, "creation_date": 1512589492, "answer_id": 47682293, "question_id": 47680481, "link": "https://stackoverflow.com/questions/47680481/match-any-string-in-haskell-record-in-hspec-test/47682293#47682293", "title": "Match &quot;any string&quot; in Haskell record in HSpec test", "body": "<p>The <code>id</code> of an <code>Entity</code> can't not be a <code>String</code>, because static typing. But you probably do want to force its evaluation to ensure that it isn't bottom.</p>\n\n<pre><code>spec :: Spec\nspec = describe \"newPersistentEntity function\" $\n    it \"returns a new Entity with a generated id and the specified name\" $ do\n        x &lt;- newPersistentEntity \"myName\"\n        pure $! id x  -- Force evaluation of the `id` field to ensure that\n                      -- the database actually did return a string here\n        name x `shouldBe` \"myName\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28942, "user_id": 398441, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/a8950160c2b3d7d0bf948d8c1f937e7f?s=128&d=identicon&r=PG", "display_name": "Johan", "link": "https://stackoverflow.com/users/398441/johan"}, "is_accepted": false, "score": 2, "last_activity_date": 1512626113, "creation_date": 1512626113, "answer_id": 47688489, "question_id": 47680481, "link": "https://stackoverflow.com/questions/47680481/match-any-string-in-haskell-record-in-hspec-test/47688489#47688489", "title": "Match &quot;any string&quot; in Haskell record in HSpec test", "body": "<p>I actually solved this myself in a different way that I'll show here for context. You probably shouldn't use it since the accepted answer is easier to understand and less verbose.</p>\n\n<pre><code>spec :: Spec\nspec = describe \"newPersistentEntity function\" $\n       it \"returns a new Entity with a generated id and the specified name\" $\n       newPersistentEntity \"myName\" &gt;&gt;= (`shouldSatisfy` (\\case\n           Entity {id = _, name = \"myName\"} -&gt; True\n           _ -&gt; False))\n</code></pre>\n\n<p>But for this to work you also need to apply the lamda case language extension:</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\n</code></pre>\n"}], "owner": {"reputation": 28942, "user_id": 398441, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/a8950160c2b3d7d0bf948d8c1f937e7f?s=128&d=identicon&r=PG", "display_name": "Johan", "link": "https://stackoverflow.com/users/398441/johan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 47681049, "answer_count": 3, "score": 0, "last_activity_date": 1512626113, "creation_date": 1512582541, "last_edit_date": 1512590675, "question_id": 47680481, "link": "https://stackoverflow.com/questions/47680481/match-any-string-in-haskell-record-in-hspec-test", "title": "Match &quot;any string&quot; in Haskell record in HSpec test", "body": "<p>I have a data class <code>Entity</code> which is defined like this:</p>\n\n<pre><code>data Entity = Entity { id :: String, name :: String }\n</code></pre>\n\n<p>and a function that returns <code>IO Entity</code>:</p>\n\n<pre><code>newPersistentEntity :: String -&gt; IO Entity\n</code></pre>\n\n<p>And I'd like to write an <a href=\"https://hspec.github.io/\" rel=\"nofollow noreferrer\">HSpec</a> test for this:</p>\n\n<pre><code>spec :: Spec\nspec = describe \"newPersistentEntity function\" $\n       it \"returns a new Entity with a generated id and the specified name\" $\n       newPersistentEntity \"myName\" `shouldReturn` Entity {id = &lt;any string&gt;, name = \"myName\"}\n</code></pre>\n\n<p>The problem is that the id is a UUID generated by the database. I want to assert that the <code>id</code> is a string to make the test pass.</p>\n\n<p>How can I achieve this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512580955, "post_id": 47680039, "comment_id": 82319279, "body": "You forgot to close a bracket on the last line of the <code>Monad</code> instance."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512581014, "post_id": 47680039, "comment_id": 82319308, "body": "But that being said, usually the bind of a list a <code>concatMap</code>, since <code>f</code> takes as input an <code>a</code>, and outputs an <code>m a</code>."}, {"owner": {"reputation": 107, "user_id": 7268260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f5e745b65d86825d84125e23a6b806f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Shalom", "link": "https://stackoverflow.com/users/7268260/michal-shalom"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512581123, "post_id": 47680039, "comment_id": 82319375, "body": "I added now the bracket but this is the error."}, {"owner": {"reputation": 107, "user_id": 7268260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f5e745b65d86825d84125e23a6b806f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Shalom", "link": "https://stackoverflow.com/users/7268260/michal-shalom"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512581187, "post_id": 47680039, "comment_id": 82319416, "body": "I don&#39;t understand, what do I need to do with the concatMap?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512581688, "post_id": 47680039, "comment_id": 82319689, "body": "Before implementing a function, it is useful to (a) look to the documentation to see which contracts bind should satisfy, (b) the signature to know what the function is supposed to do."}, {"owner": {"reputation": 107, "user_id": 7268260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f5e745b65d86825d84125e23a6b806f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Shalom", "link": "https://stackoverflow.com/users/7268260/michal-shalom"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512582328, "post_id": 47680039, "comment_id": 82320024, "body": "Hi, you really right but I looked on both of the things you told me and still don&#39;t know how to fit my data type LinkedList to the monad.."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1512586438, "post_id": 47680039, "comment_id": 82322028, "body": "Look carefully: your definition of <code>&gt;&gt;=</code> isn&#39;t really any different than <code>fmap</code>; it just reverses the order of the arguments. For a monad to be worth the fuss, it should do <i>something</i> (and indeed it does) that an ordinary functor cannot do."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512587985, "post_id": 47680039, "comment_id": 82322875, "body": "Your applicative instance does not handle all cases. It is usually convenient to define the monad instance first, and then let <code>pure=return ; (&lt;*&gt;)=ap</code> hence defining the applicative instance exploiting the more general monad instance."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1512589932, "post_id": 47680039, "comment_id": 82323932, "body": "Also, to multiply each element of your list by a given number, you don&#39;t <i>need</i> a monad; that&#39;s exactly what the <code>Functor</code> instance does (and must do)."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1512582083, "last_edit_date": 1512582083, "creation_date": 1512581645, "answer_id": 47680237, "question_id": 47680039, "link": "https://stackoverflow.com/questions/47680039/difficulty-to-define-the-monad-on-all-values/47680237#47680237", "title": "difficulty to define the monad on all values", "body": "<p>The type system will complain, since the \"bind\" operator <code>&gt;&gt;=</code> has signature:</p>\n\n<pre><code><b>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</b></code></pre>\n\n<p>So let us specialize the signature for the <code>LinkedList</code>:</p>\n\n<pre><code>(&gt;&gt;=) :: <b>LinkedList a</b> -&gt; (a -&gt; <b>LinkedList b</b>) -&gt; <b>LinkedList b</b></code></pre>\n\n<p>So the function takes at the left side a <code>LinkedList a</code>, and at the right side a function that maps an <code>a</code> (!) to a <code>LinkedList b</code>, and we expect the outcome to be a <code>LinkedList b</code>. The function you have defined can not do that: since if you construct a <code>Node (f a) (next &gt;&gt;= f)</code>, the result will be a <code>LinkedList (LinkedList b)</code>. Indeed, you apply <code>f</code> to <code>a</code> (the head of the list), which yields a <code>LinkedList b</code> (as head of the <code>Node</code>).</p>\n\n<p>If we look at the signature above, there are perhaps some ideas that might come up, but the most straightforward idea, is probably to implement some sort of <code>concatMap :: [a] -&gt; (a -&gt; [b]) -&gt; [b]</code>. The \"bind\" has to satisfy the following rules:</p>\n\n<ol>\n<li><code>return a &gt;&gt;= k  =  k a</code>;</li>\n<li><code>m &gt;&gt;= return  =  m</code>; and</li>\n<li><code>m &gt;&gt;= (\\x -&gt; k x &gt;&gt;= h)  =  (m &gt;&gt;= k) &gt;&gt;= h</code>.</li>\n</ol>\n\n<p>the <code>concatMap</code> function satisfies the three constraints. (1) If we wrap a value <code>x</code> into a <code>LinkedList</code>, and apply <code>f</code> on every element (of the singleton list), we will obtain a list that contains one list, that of the result of <code>k a</code>, but by using the <code>concat</code> of <code>concatMap</code>, we flatten this again. (2) If we would use <code>m &gt;&gt;= return</code> with concat, we will wrap every element in a new singleton list, but the concatenation, will unwrap it again.</p>\n\n<p>So we can implement it as:</p>\n\n<pre><code>instance Monad LinkedList where\n   return = NodeWithoutNext\n   (NodeWithoutNext a) &gt;&gt;= f = f a\n   (Node a next) &gt;&gt;= f =  build (f a)\n       where build (NodeWithoutNext x) = (Node x (next &gt;&gt;= f))\n             build (Node x xs) = Node x (build xs)\n</code></pre>\n\n<p>So here <code>build</code> will iterate through the <code>LinkedList</code> produced by <code>f a</code>, and basically construct an <em>almost</em> duplicate, except that when we reach the end, we will continue with the concatenation of the outcome of the bind of the remaining elements.</p>\n"}], "owner": {"reputation": 107, "user_id": 7268260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f5e745b65d86825d84125e23a6b806f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Shalom", "link": "https://stackoverflow.com/users/7268260/michal-shalom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 47680237, "answer_count": 1, "score": 3, "last_activity_date": 1512582083, "creation_date": 1512580889, "last_edit_date": 1512581060, "question_id": 47680039, "link": "https://stackoverflow.com/questions/47680039/difficulty-to-define-the-monad-on-all-values", "title": "difficulty to define the monad on all values", "body": "<p>I trying to write monad that multiply all data nodes by given number.\nI don't know how to define the Monad correctly.</p>\n\n<pre><code>module Main where  \ndata LinkedList a = NodeWithoutNext a | Node a (LinkedList a) deriving (Show)\n\ninstance Functor LinkedList where\n  fmap f (NodeWithoutNext x) = NodeWithoutNext (f x)\n  fmap f (Node a next) = Node (f a) (fmap f next)\n\ninstance Applicative LinkedList where\n   pure = NodeWithoutNext\n   (NodeWithoutNext f) &lt;*&gt; (NodeWithoutNext x) = NodeWithoutNext (f x)\n   (NodeWithoutNext f) &lt;*&gt; (Node a next) = Node (f a) (fmap f next)\n\ninstance Monad LinkedList where\n   return = NodeWithoutNext\n   (NodeWithoutNext a) &gt;&gt;= f = f a\n   **(Node a next) &gt;&gt;= f =  Node (f a) (next &gt;&gt;= f)**\n\nmain :: IO ()\nmain  =  do  \n    let list = Node 3 (Node 2 (NodeWithoutNext 7))\n    print (list)\n    print (list &gt;&gt;= (\\x -&gt; NodeWithoutNext (x+200)))\n</code></pre>\n\n<p>I get error- </p>\n\n<pre><code>Bla.hs:16:39: error:\n    * Couldn't match type `b' with `LinkedList b'\n      `b' is a rigid type variable bound by\n        the type signature for:\n          (&gt;&gt;=) :: forall a b.\n                   LinkedList a -&gt; (a -&gt; LinkedList b) -&gt; Linked\n        at Bla.hs:15:24-26\n      Expected type: LinkedList (LinkedList b)\n        Actual type: LinkedList b\n    * In the second argument of `Node', namely `(next &gt;&gt;= f)'\n      In the expression: Node (f a) (next &gt;&gt;= f)\n      In an equation for `&gt;&gt;=':\n          (Node a next) &gt;&gt;= f = Node (f a) (next &gt;&gt;= f)\n    * Relevant bindings include\n        f :: a -&gt; LinkedList b (bound at Bla.hs:16:22)\n        (&gt;&gt;=) :: LinkedList a -&gt; (a -&gt; LinkedList b) -&gt; LinkedLi\n          (bound at Bla.hs:15:24)\n   |\n16 |    (Node a next) &gt;&gt;= f =  Node (f a) (next &gt;&gt;= f)\n   |                                       ^^^^^^^^^^\n</code></pre>\n\n<p>What do I need to fix here?\nThe problem is on the line that is with **.</p>\n"}, {"tags": ["haskell", "compilation", "ghc"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1512580380, "post_id": 47679826, "comment_id": 82318927, "body": "While this is possible, I seriously doubt that it&#39;s a sensible approach to whatever problem your tackling here. Can you give some context?"}, {"owner": {"reputation": 29, "user_id": 8886492, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wC-MOfTyv08/AAAAAAAAAAI/AAAAAAAAAD4/2lGJOl5Aul0/photo.jpg?sz=128", "display_name": "Tzeroxik", "link": "https://stackoverflow.com/users/8886492/tzeroxik"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512580652, "post_id": 47679826, "comment_id": 82319088, "body": "Hum Im&#39; just turning emoji written haskell into compilable haskell, but I wanted to compile it too."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1512591410, "post_id": 47679826, "comment_id": 82324730, "body": "You can define Unicode characters, including emoji, as operators and function names in standard Haskell.  See for example the Unicode Prelude: <a href=\"https://hackage.haskell.org/package/unicode-prelude\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/unicode-prelude</a>"}, {"owner": {"reputation": 29, "user_id": 8886492, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wC-MOfTyv08/AAAAAAAAAAI/AAAAAAAAAD4/2lGJOl5Aul0/photo.jpg?sz=128", "display_name": "Tzeroxik", "link": "https://stackoverflow.com/users/8886492/tzeroxik"}, "edited": false, "score": 0, "creation_date": 1512597868, "post_id": 47679826, "comment_id": 82328037, "body": "yah but it&#39;s for the fun of doing it myself, thanks for the info :)"}], "answers": [{"comments": [{"owner": {"reputation": 877, "user_id": 2402383, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Q3QBc.jpg?s=128&g=1", "display_name": "zabeltech", "link": "https://stackoverflow.com/users/2402383/zabeltech"}, "reply_to_user": {"reputation": 29, "user_id": 8886492, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wC-MOfTyv08/AAAAAAAAAAI/AAAAAAAAAD4/2lGJOl5Aul0/photo.jpg?sz=128", "display_name": "Tzeroxik", "link": "https://stackoverflow.com/users/8886492/tzeroxik"}, "edited": false, "score": 0, "creation_date": 1522999039, "post_id": 49464272, "comment_id": 86385915, "body": "don&#39;t forget to accept and upgrade the answer then ;)"}], "tags": [], "owner": {"reputation": 877, "user_id": 2402383, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Q3QBc.jpg?s=128&g=1", "display_name": "zabeltech", "link": "https://stackoverflow.com/users/2402383/zabeltech"}, "is_accepted": true, "score": 0, "last_activity_date": 1521891894, "creation_date": 1521891894, "answer_id": 49464272, "question_id": 47679826, "link": "https://stackoverflow.com/questions/47679826/compiling-haskell-from-haskell/49464272#49464272", "title": "Compiling haskell from haskell", "body": "<p>Here is an example from the ghc user guide:\n<a href=\"https://downloads.haskell.org/~ghc/master/users-guide/extending_ghc.html#using-ghc-as-a-library\" rel=\"nofollow noreferrer\">https://downloads.haskell.org/~ghc/master/users-guide/extending_ghc.html#using-ghc-as-a-library</a></p>\n\n<pre><code>import GHC\nimport GHC.Paths ( libdir )\nimport DynFlags ( defaultLogAction )\n\nmain =\n    defaultErrorHandler defaultLogAction $ do\n      runGhc (Just libdir) $ do\n        dflags &lt;- getSessionDynFlags\n        setSessionDynFlags dflags\n        target &lt;- guessTarget \"test_main.hs\" Nothing\n        setTargets [target]\n        load LoadAllTargets\n</code></pre>\n\n<p>with that you should be able to do this:</p>\n\n<pre><code>$ cat test_main.hs\nmain = putStrLn \"hi\"\n$ ghc -package ghc simple_ghc_api.hs\n[1 of 1] Compiling Main             ( simple_ghc_api.hs, simple_ghc_api.o )\nLinking simple_ghc_api ...\n$ ./simple_ghc_api\n$ ./test_main\nhi\n$\n</code></pre>\n\n<p>Once it works for you like that, it should be easy for you to include it in you program.</p>\n"}], "owner": {"reputation": 29, "user_id": 8886492, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wC-MOfTyv08/AAAAAAAAAAI/AAAAAAAAAD4/2lGJOl5Aul0/photo.jpg?sz=128", "display_name": "Tzeroxik", "link": "https://stackoverflow.com/users/8886492/tzeroxik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "accepted_answer_id": 49464272, "answer_count": 1, "score": 1, "last_activity_date": 1521891894, "creation_date": 1512580191, "question_id": 47679826, "link": "https://stackoverflow.com/questions/47679826/compiling-haskell-from-haskell", "title": "Compiling haskell from haskell", "body": "<p>So I have a haskell program where I do some formatting to a haskell source file and then I want to call the GHC to compile said file, can anyone tell how can I do that?</p>\n\n<p>In case this helps, this is the program I'm making, it's just a emoji code haskell parser:</p>\n\n<pre><code>module EmojiParser where\n\nimport Prelude hiding (writeFile, readFile)  \nimport Data.Char\nimport Data.Text (pack, unpack)\nimport Path.Text.UTF8 (readFile, writeFile)\nimport Path.Internal\n\ntranspile filePath = do content &lt;- readFile $ Path filePath\n                        writeFile (Path filePath) . pack . parseEmoji . unpack $ content                       \n\nparseEmoji :: [Char] -&gt; [Char]\nparseEmoji = foldl (++) \"\" . map f \n  where \n    minEmoji = 128511\n    maxEmoji = 128592\n    f x = let cval = ord x\n          in if cval &gt; minEmoji &amp;&amp; cval &lt; maxEmoji \n             then \"emoji_symbol_\" ++ (show cval) \n             else [x]\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "lazy-evaluation"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1512578675, "last_edit_date": 1512578675, "creation_date": 1512578344, "answer_id": 47679262, "question_id": 47678968, "link": "https://stackoverflow.com/questions/47678968/infinite-list-in-haskell/47679262#47679262", "title": "Infinite list in Haskell", "body": "<pre><code>generate :: [MyExpr] -&gt; [MyExpr] -&gt; [MyExpr]\ngenerate ... = generate ...\ngenerate ... = generate ...\n</code></pre>\n\n<p>Any definition of this form will always call itself before producing any output. This kind of inductive structure can be defined only if, at least at some point, it returns some part of the output before recursing, e.g. emitting the first element of the output list.</p>\n\n<pre><code>generate' :: [MyExpr] -&gt; [MyExpr] -&gt; [MyExpr]\ngenerate' [] []         = generate' [MyExprStart Start] []\ngenerate' current prev  =\n  if (length current + length prev) &lt; 5 then\n    generate' (concatMap nextExprs current) (prev ++ current)\n  else prev ++ current\n</code></pre>\n\n<p>By comparison, in <code>generate'</code> the <code>else</code> branch does not recurse, so it will produce the output. Even if we had something like</p>\n\n<pre><code>else someNonEmptyList ++ generate' ...\n</code></pre>\n\n<p>this would work, since the first few list elements would be produced.</p>\n\n<p>Further, keep in mind that generating all the possible expressions merging potentially infinite lists with <code>++</code> is a bad idea. Indeed, if <code>xs</code> is infinite then <code>xs ++ ys</code> is equal to <code>xs</code>, since <code>ys</code> will never be reached in finite time. You probably want a fair interleaving of <code>xs</code> and <code>ys</code> when they are infinite.</p>\n\n<p>A similar question used <a href=\"https://stackoverflow.com/questions/23515191/how-to-enumerate-a-recursive-datatype-in-haskell\">the omega monad</a> to achieve the complete enumeration.</p>\n"}, {"tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 4, "last_activity_date": 1512579289, "last_edit_date": 1512579289, "creation_date": 1512578364, "answer_id": 47679271, "question_id": 47678968, "link": "https://stackoverflow.com/questions/47678968/infinite-list-in-haskell/47679271#47679271", "title": "Infinite list in Haskell", "body": "<p>The <code>generate</code> function freezes, because it encodes an infinite recursion. Look: every case of it just calls the function itself. There is no condition when it actually returns something that is not a call to itself. So when you try to run it, it just keeps calling itself forever. </p>\n\n<p>The <code>generate'</code> function, on the other hand, will bail out as soon at the combined length of two input lists exceeds 5. So that's when returns you a result.</p>\n\n<p>To make this function start returning data before evaluating completely (which it can never do), you need to first return the non-recursive cases, and then append the recursive cases to them by calling <code>generate</code> recursively:</p>\n\n<pre><code>generate = (MyExprStart Start) : [recur e | e &lt;- generate, recur &lt;- [MyExpr1, MyExpr2]]\n</code></pre>\n\n<p>GHCi:</p>\n\n<pre><code>&gt; head generate\nMyExprStart Start\n&gt; take 10 generate\n[MyExprStart Start, MyExpr1 (MyExprStart Start),\n MyExpr2 (MyExprStart Start), MyExpr1 (MyExpr1 (MyExprStart Start)),\n MyExpr2 (MyExpr1 (MyExprStart Start)),\n MyExpr1 (MyExpr2 (MyExprStart Start)),\n MyExpr2 (MyExpr2 (MyExprStart Start)),\n MyExpr1 (MyExpr1 (MyExpr1 (MyExprStart Start))), \n MyExpr2 (MyExpr1 (MyExpr1 (MyExprStart Start))),\n MyExpr1 (MyExpr2 (MyExpr1 (MyExprStart Start)))]\n</code></pre>\n\n<p>NOTE: the order of generators in the list comprehension is important. If you swap them, the execution will never get to <code>MyExpr2</code>, because it would need to exhaust the <code>generate</code> list first, and that list is infinite.</p>\n"}], "owner": {"reputation": 229, "user_id": 6115222, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fff0d4d9410ea55d4bed8173b3cd0238?s=128&d=identicon&r=PG&f=1", "display_name": "AnatoliySultanov", "link": "https://stackoverflow.com/users/6115222/anatoliysultanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 754, "favorite_count": 0, "accepted_answer_id": 47679271, "answer_count": 2, "score": 2, "last_activity_date": 1512579289, "creation_date": 1512577421, "last_edit_date": 1512578493, "question_id": 47678968, "link": "https://stackoverflow.com/questions/47678968/infinite-list-in-haskell", "title": "Infinite list in Haskell", "body": "<p>I'm trying to define a function that creates infinite list of all possible words in my simple grammar. But ghci freezes when I enter <code>head (generate [] [])</code>, although <code>head (generate' [] [])</code> works fine (but I still want an infinite list). What's the problem? </p>\n\n<pre><code>data Start = Start deriving(Show)\ndata MyExpr = MyExprStart Start | MyExpr1 MyExpr | MyExpr2 MyExpr deriving(Show)\n\ngenerate :: [MyExpr] -&gt; [MyExpr] -&gt; [MyExpr]\ngenerate [] []         = generate [MyExprStart Start] []\ngenerate current prev  = generate (concatMap nextExprs current) (prev ++ current)\n\ngenerate' :: [MyExpr] -&gt; [MyExpr] -&gt; [MyExpr]\ngenerate' [] []         = generate' [MyExprStart Start] []\ngenerate' current prev  =\n  if (length current + length prev) &lt; 5 then\n    generate' (concatMap nextExprs current) (prev ++ current)\n  else prev ++ current\n\nnextExprs :: MyExpr -&gt; [MyExpr]\nnextExprs expr = [MyExpr1 expr, MyExpr2 expr]\n</code></pre>\n\n<p>UPD:\nThank you, I got the point. I think I should define my function like that:</p>\n\n<pre><code>generate :: [MyExpr] -&gt; [MyExpr]\ngenerate []         = generate [MyExprStart Start]\ngenerate current    = current ++ generate (concatMap nextExprs current)\n</code></pre>\n"}, {"tags": ["windows", "haskell", "cabal", "wxhaskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1512587096, "post_id": 47677841, "comment_id": 82322390, "body": "This is indeed a bug in the package. You can try fixing it yourself (probably the easiest way is to <code>import Foreign.C hiding (CBool)</code>). You could also report the bug (<a href=\"https://sourceforge.net/p/wxhaskell/bugs/\" rel=\"nofollow noreferrer\">here</a>). <code>CBool</code> is a very recent addition to <code>base</code>, so I&#39;m guessing the library just hasn&#39;t been updated to work with GHC 8.2 (which means there could be other version related bugs). (Aside: the first error is entirely related to the second and you&#39;ve already fixed the first problem, so it&#39;s not really relevant to the question at all)."}, {"owner": {"reputation": 186, "user_id": 2657724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ff1f0fae3fa0386f4881317ad5e027?s=128&d=identicon&r=PG", "display_name": "Airton da Fonseca Granero", "link": "https://stackoverflow.com/users/2657724/airton-da-fonseca-granero"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512620420, "post_id": 47677841, "comment_id": 82334452, "body": "Maybe I can downgrade to an earlier version of ghc. After that I tried again to install from github on another directory. It worked. I was able to compile BouncingBalls to an exe. But executing it it fails to find wxc.dll. I put that on the path, but then another 3 are needed, I was able to find them from my Achelane install at wxWidgets\\lib\\gcc_dll\\ (but not where I installed from github). But then I get: Mismatch between the program and library build versions detected. So I think this is not the way to go."}], "owner": {"reputation": 186, "user_id": 2657724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ff1f0fae3fa0386f4881317ad5e027?s=128&d=identicon&r=PG", "display_name": "Airton da Fonseca Granero", "link": "https://stackoverflow.com/users/2657724/airton-da-fonseca-granero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 274, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1512598221, "creation_date": 1512574020, "last_edit_date": 1512598221, "question_id": 47677841, "link": "https://stackoverflow.com/questions/47677841/install-wxhaskell-64-on-windows-10-get-error-foreign-import-ccall-booltoint-c", "title": "Install wxHaskell 64 on Windows 10 get error (foreign import ccall &quot;boolToInt&quot; cboolToInt :: CBool -&gt; Int). What to do?", "body": "<p>I have Windows 10</p>\n\n<p>I installed Haskell Platform 8.2.1 (HaskellPlatform-8.2.1-full-x86_64-setup.exe from <a href=\"https://www.haskell.org/platform/windows.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/platform/windows.html</a>) (This version have mingw and gcc 6.2.0 for what this matters)</p>\n\n<p>I downloaded Achelane from <a href=\"https://sourceforge.net/projects/wxhaskell/files/wxInstall/\" rel=\"nofollow noreferrer\">https://sourceforge.net/projects/wxhaskell/files/wxInstall/</a></p>\n\n<p>I unzipped it in a path without spaces (a bug prevents it from compiling if path has spaces).</p>\n\n<p>I gave cabal update and updated the config lines extra-prog-path: and extra-lib-dirs</p>\n\n<p>I called Install.bat but when installing wxdirect I get the error:</p>\n\n<pre><code>cabal: The directory \"wxdirect-0.92.3.0\\\" already exists, not unpacking.\nResolving dependencies...\nConfiguring wxdirect-0.92.3.0...\nBuilding wxdirect-0.92.3.0...\nFailed to install wxdirect-0.92.3.0\nBuild log ( C:\\Users\\agranero\\AppData\\Roaming\\cabal\\logs\\ghc-8.2.1\\wxdirect-0.92.3.0-LWW4KzdSYghFJi8qk6ENNl.log ):\nPreprocessing executable 'wxdirect' for wxdirect-0.92.3.0..\nBuilding executable 'wxdirect' for wxdirect-0.92.3.0..\n[ 2 of 12] Compiling IOExtra          ( src\\IOExtra.hs, dist\\build\\wxdirect\\wxdirect-tmp\\IOExtra.o )\n\nsrc\\IOExtra.hs:16:1: error:\n    Could not find module `System.IO.Strict'\n    There are files missing in the `strict-0.3.2' package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n   |\n16 | import qualified System.IO.Strict as Strictly\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncabal: Leaving directory '.\\wxdirect-0.92.3.0'\ncabal: Error: some packages failed to install:\nwxdirect-0.92.3.0-LWW4KzdSYghFJi8qk6ENNl failed during the building phase. The\nexception was:\nExitFailure 1\nO sistema n\u00e3o pode encontrar o arquivo especificado.\nCould not install wxHaskell\n</code></pre>\n\n<p>The message \"O sistema n\u00e3o pode encontrar o arquivo especificado.\" means \"System cannot find specified file.\" because of my Brazilian Portuguese version of Windows.</p>\n\n<p>If I follow <a href=\"https://wiki.haskell.org/WxHaskell/Windows#From_GitHub\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/WxHaskell/Windows#From_GitHub</a> and try to install from github I get the same error. Idem for cabal install wx.</p>\n\n<p>I had several previous attempts where I get a little more ahead but I wiped my Haskell install clean and now I am stuck on this error.</p>\n\n<p>If I do not change cabal config file I get the same error too, so I thing it is not relevant (at this point yet).</p>\n\n<p>UPDATE: I managed to go further, but got stuck again: I gave the ghc-pkg check that the message suggest gives a huge amount of warnings. But the summary is:</p>\n\n<pre><code>The following packages are broken, either because they have a problem\nlisted above, or because they depend on a broken package.\nCabal-1.24.2.0\nprocess-1.4.3.0\ndirectory-1.3.1.5\ntime-1.8.0.3\nWin32-2.3.1.1\nstrict-0.3.2\n</code></pre>\n\n<p>Before that I get in the middle of the huge amount of warnings this:</p>\n\n<pre><code>    There are problems in package strict-0.3.2:\n    Warning: library-dirs: C:\\Users\\agranero\\AppData\\Roaming\\cabal\\x86_64-windows-ghc-8.2.1\\strict-0.3.2-7ZEebv7EabCEjNWrS66TpZ \ndoesn't exist or isn't a directory \n</code></pre>\n\n<p>Following the sequence (as at each Install.bat run It warned of the next lib) I reinstalled all those libs with cabal install lib --reinstall --force-reinstalls each time I advanced more.</p>\n\n<p>After that I run Install.bat again and I got:</p>\n\n<pre><code>Unpacking to wxdirect-0.92.3.0\\\nResolving dependencies...\nIn order, the following will be installed:\nwxdirect-0.92.3.0 (reinstall)\nWarning: Note that reinstalls are always dangerous. Continuing anyway...\nConfiguring wxdirect-0.92.3.0...\nBuilding wxdirect-0.92.3.0...\nInstalled wxdirect-0.92.3.0\n        1 arquivo(s) copiado(s).\nUnpacking to wxc-0.92.3.0\\\nResolving dependencies...\nConfiguring wxc-0.92.3.0...\nBuilding wxc-0.92.3.0...\nInstalled wxc-0.92.3.0\n        1 arquivo(s) copiado(s).\nResolving dependencies...\nDownloading wxcore-0.92.3.0...\nConfiguring wxcore-0.92.3.0...\nBuilding wxcore-0.92.3.0...\nFailed to install wxcore-0.92.3.0\nBuild log ( C:\\Users\\agranero\\AppData\\Roaming\\cabal\\logs\\ghc-8.2.1\\wxcore-0.92.3.0-Kq7hfMBPtCHIxCJN1O04PM.log ):\nBuilding wxcore-0.92.3.0...\nPreprocessing library wxcore-0.92.3.0...\n[ 1 of 23] Compiling Graphics.UI.WXCore.GHCiSupport ( src\\haskell\\Graphics\\UI\\WXCore\\GHCiSupport.hs, dist\\build\\Graphics\\UI\\WXCore\\GHCiSupport.o )\n[ 2 of 23] Compiling Graphics.UI.WXCore.WxcDefs ( src\\haskell\\Graphics\\UI\\WXCore\\WxcDefs.hs, dist\\build\\Graphics\\UI\\WXCore\\WxcDefs.o )\n[ 3 of 23] Compiling Graphics.UI.WXCore.WxcObject ( src\\haskell\\Graphics\\UI\\WXCore\\WxcObject.hs, dist\\build\\Graphics\\UI\\WXCore\\WxcObject.o )\n[ 4 of 23] Compiling Graphics.UI.WXCore.WxcClassTypes ( src\\haskell\\Graphics\\UI\\WXCore\\WxcClassTypes.hs, dist\\build\\Graphics\\UI\\WXCore\\WxcClassTypes.o )\n[ 5 of 23] Compiling Graphics.UI.WXCore.WxcTypes ( src\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs, dist\\build\\Graphics\\UI\\WXCore\\WxcTypes.o )\n\nsrc\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:752:20: error:\n    Ambiguous occurrence `CBool'\n    It could refer to either `Foreign.C.CBool',\n                             imported from `Foreign.C' at src\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:126:1-16\n                             (and originally defined in `Foreign.C.Types')\n                          or `Graphics.UI.WXCore.WxcTypes.CBool',\n                             defined at src\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:750:1\n    |\n752 | toCBool :: Bool -&gt; CBool\n    |                    ^^^^^\n\nsrc\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:755:22: error:\n    Ambiguous occurrence `CBool'\n    It could refer to either `Foreign.C.CBool',\n                             imported from `Foreign.C' at src\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:126:1-16\n                             (and originally defined in `Foreign.C.Types')\n                          or `Graphics.UI.WXCore.WxcTypes.CBool',\n                             defined at src\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:750:1\n    |\n755 | withBoolResult :: IO CBool -&gt; IO Bool\n    |                      ^^^^^\n\nsrc\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:760:14: error:\n    Ambiguous occurrence `CBool'\n    It could refer to either `Foreign.C.CBool',\n                             imported from `Foreign.C' at src\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:126:1-16\n                             (and originally defined in `Foreign.C.Types')\n                          or `Graphics.UI.WXCore.WxcTypes.CBool',\n                             defined at src\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:750:1\n    |\n760 | fromCBool :: CBool -&gt; Bool\n    |              ^^^^^\n\nsrc\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:763:55: error:\n    Ambiguous occurrence `CBool'\n    It could refer to either `Foreign.C.CBool',\n                             imported from `Foreign.C' at src\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:126:1-16\n                             (and originally defined in `Foreign.C.Types')\n                          or `Graphics.UI.WXCore.WxcTypes.CBool',\n                             defined at src\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:750:1\n    |\n763 | foreign import ccall \"intToBool\" intToCBool :: Int -&gt; CBool\n    |                                                       ^^^^^\n\nsrc\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:764:48: error:\n    Ambiguous occurrence `CBool'\n    It could refer to either `Foreign.C.CBool',\n                             imported from `Foreign.C' at src\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:126:1-16\n                             (and originally defined in `Foreign.C.Types')\n                          or `Graphics.UI.WXCore.WxcTypes.CBool',\n                             defined at src\\haskell\\Graphics\\UI\\WXCore\\WxcTypes.hs:750:1\n    |\n764 | foreign import ccall \"boolToInt\" cboolToInt :: CBool -&gt; Int\n    |                                                ^^^^^\ncabal: Leaving directory 'C:\\Users\\agranero\\AppData\\Local\\Temp\\cabal-tmp-4404\\wxcore-0.92.3.0'\ncabal: Error: some packages failed to install:\nwx-0.92.3.0-AFrVUsv18GZGvCmfR0yEpQ depends on wx-0.92.3.0 which failed to\ninstall.\nwxcore-0.92.3.0-Kq7hfMBPtCHIxCJN1O04PM failed during the building phase. The\nexception was:\nExitFailure 1\nCould not install wxHaskell\n</code></pre>\n\n<p>Now I am completely lost. There is a report of this error on  <a href=\"http://haskell.1045720.n5.nabble.com/GHC-14418-Compile-errors-wxcore-0-92-3-0-td5866957.html\" rel=\"nofollow noreferrer\">http://haskell.1045720.n5.nabble.com/GHC-14418-Compile-errors-wxcore-0-92-3-0-td5866957.html</a> and on <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14418\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/14418</a>\nbut it was closed as not being a bug of the compiler but of wxHaskell (which I agree with).</p>\n"}, {"tags": ["haskell", "monads", "applicative", "fam-proposal"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1512574553, "post_id": 47677815, "comment_id": 82315021, "body": "When all you need is <code>Ord</code>, why are you required to implement <code>Eq</code> as well? After all you could always define <code>a == b = not (a &lt; b) &amp;&amp; not (a &gt; b)</code>. Same thing here. Just a requirement to define <code>pure = return</code> and <code>(&lt;*&gt;) = ap</code>. cf. <a href=\"https://stackoverflow.com/questions/24112786/why-should-applicative-be-a-superclass-of-monad\" title=\"why should applicative be a superclass of monad\">stackoverflow.com/questions/24112786/&hellip;</a>"}], "owner": {"reputation": 107, "user_id": 7268260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f5e745b65d86825d84125e23a6b806f?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Shalom", "link": "https://stackoverflow.com/users/7268260/michal-shalom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "closed_date": 1512583692, "answer_count": 0, "score": 2, "last_activity_date": 1512575030, "creation_date": 1512573944, "last_edit_date": 1512575030, "question_id": 47677815, "link": "https://stackoverflow.com/questions/47677815/simple-tree-monad-implementation-error", "closed_reason": "Duplicate", "title": "simple tree monad implementation error", "body": "<p>Consider the next piece of code -</p>\n\n<pre><code>module Main where\n\ndata MyTree a = MyLeaf a\n              | MyNode (MyTree a) (MyTree a)\n              deriving (Show)\n\ninstance Monad MyTree where\n   return = MyLeaf\n   (MyLeaf x) &gt;&gt;= f = f x\n   (MyNode x y) &gt;&gt;= f = MyNode (x &gt;&gt;= f) (y &gt;&gt;= f)\n\nmain :: IO ()\nmain  =\n   do\n\n      let tree1 = MyNode (MyLeaf 3) (MyNode (MyLeaf 4) (MyLeaf 5))\n      let tree2 = MyNode (MyLeaf \"ABC\") (MyNode (MyLeaf \"DEFG\") (MyLeaf \"HIJKL\"))\n\n      print (tree1 &gt;&gt;= (\\x -&gt; MyLeaf (x+200)))\n      print (tree2 &gt;&gt;= (\\x -&gt; MyLeaf (tail x)))\n</code></pre>\n\n<p>I try to simply implement a Tree Monad, but the problem is when i compile the code above, i get the following errors:</p>\n\n<pre><code>* No instance for (Applicative MyTree)\n    arising from the superclasses of an instance declaration\n* In the instance declaration for `Monad MyTree'\n</code></pre>\n\n<p>I dont understand what's missing. What's the point in having <code>Applicative</code>?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1512568677, "post_id": 47676030, "comment_id": 82310900, "body": "In that case you better use an <i>accumulator</i>."}], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 6, "last_activity_date": 1512569147, "creation_date": 1512569147, "answer_id": 47676223, "question_id": 47676030, "link": "https://stackoverflow.com/questions/47676030/haskell-recursive-function-add-to-the-end-of-a-list/47676223#47676223", "title": "Haskell recursive function add to the end of a list", "body": "<p>The best approach is to implement <code>sqNList</code> in terms of a helper function that counts from 1 up to n.  That way you can just generate the list in the correct order in the first place.</p>\n\n<pre><code>sqNList :: Int -&gt; [Int]\nsqNList n = sqNListHelper 1 n\n\nsqNListHelper :: Int -&gt; Int -&gt; [Int]\nsqNListHelper current end = ...\n</code></pre>\n\n<p>There are a wide variety of more sophisticated approaches, but this is the easiest approach to debug/test interactively that also has you figuring out how to do everything yourself.</p>\n\n<p>More sophisticated approaches can include list comprehensions or composing functions like <code>map</code> and <code>enumFromTo</code> to build up the logic from simpler pieces.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1512569170, "creation_date": 1512569170, "answer_id": 47676228, "question_id": 47676030, "link": "https://stackoverflow.com/questions/47676030/haskell-recursive-function-add-to-the-end-of-a-list/47676228#47676228", "title": "Haskell recursive function add to the end of a list", "body": "<p>The easiest approach that consumes probably the least amount of memory is to work with an <em>accumulator</em>: a parameter you pass and update through every recursive call.</p>\n\n<p>Right now you use <em>n</em> as an accumulator, and decrement that, but we can decide to use an accumulator <em>i</em> instead that starts at <code>1</code>, and keeps <em>incrementing</em>:</p>\n\n<pre><code>helper :: Int -&gt; Int -&gt; [Int]\nhelper i n | i &gt; n = []\n           | otherwise = i*i : helper (i+1) n</code></pre>\n\n<p>Now we of course have to call it with <code>i = 1</code> ourselves, which is not ideal, but we can use a <code>where</code> clause that scopes the <code>helper</code> in the <code>sqNList</code>:</p>\n\n<pre><code>sqNList :: Int -&gt; [Int]\nsqNList n = helper 1 n\n    where helper :: Int -&gt; Int -&gt; [Int]\n          helper i n | i &gt; n = []\n                     | otherwise = i*i : helper (i+1) n</code></pre>\n\n<p>Now we can improve this a bit. For instanc there is no need to pass <code>n</code> through the <code>helper</code> calls, since it does not change, and is defined at the top level:</p>\n\n<pre><code>sqNList :: Int -&gt; [Int]\nsqNList n = helper 1\n    where helper :: Int -&gt; [Int]\n          helper i | i &gt; n = []\n                   | otherwise = i*i : helper (i+1)</code></pre>\n\n<p>There is furthermore no need to only work with <code>Int</code>s: we can use any type <code>a</code> for which <code>Num a</code> and <code>Ord a</code>:</p>\n\n<pre><code>sqNList :: (Num a, Ord a) =&gt; a -&gt; [a]\nsqNList n = helper 1\n    where helper i | i &gt; n = []\n                   | otherwise = i*i : helper (i+1)</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 0, "creation_date": 1512575107, "post_id": 47677603, "comment_id": 82315433, "body": "Do you have more info on these general forms of recursion? I often find myself writing recursive functions when I imagine it can be done with a fold or similar."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 0, "creation_date": 1512576654, "post_id": 47677603, "comment_id": 82316523, "body": "<code>map</code>, <code>filter</code>, <code>foldr</code> (and its cousin <code>foldl</code>) are probably the most common. <code>iterate</code> and <code>scanl</code> are fairly accessible as well. Bascially, any higher-order function that uses its function argument more than once qualifies. A good exercise is to try to implement them yourself. Eventually, you may want to google &quot;recursion schemes&quot; to learn more about the category-theory-inspired functions like catamorphisms (<code>foldr</code>), anamorphisms (<code>unfoldr</code>), and a whole host of other morphisms with Greek prefixes."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1512574220, "last_edit_date": 1512574220, "creation_date": 1512573304, "answer_id": 47677603, "question_id": 47676030, "link": "https://stackoverflow.com/questions/47676030/haskell-recursive-function-add-to-the-end-of-a-list/47677603#47677603", "title": "Haskell recursive function add to the end of a list", "body": "<p>This is a more advanced technique, so you may want to just save this for future study.</p>\n\n<hr>\n\n<p>Most recursive functions tend to use one of the same general forms of recursion, so knowing which higher-order function to use saves you the effort of reimplementing (possibly incorrectly) the recursion, and lets you focus on the work that is unique to your problem.</p>\n\n<p>This particular type of recursion is captured by the <code>unfoldr</code> function, defined in <code>Data.List</code>, which lets you generate a (possibly infinite) list using a generator function and an initial seed value.</p>\n\n<p>Its definition can be as simple as</p>\n\n<pre><code>unfoldr f x = case f x of\n                    Nothing -&gt; []\n                    Just (new, next) = new : unfoldr f next\n</code></pre>\n\n<p>although the actual definition is slightly more complicated for efficiency.</p>\n\n<p>Essentially, you just call the generator <code>f</code> on the seed value <code>x</code>. If the result is <code>Nothing</code>, return an empty list. Otherwise, build a list containing a result and the list produced by a recursive call with a new seed value.</p>\n\n<p>Applying this to your problem, we produce a square and the next integer as long as the input is still small enough.</p>\n\n<pre><code>import Data.List (unfoldr)\nsqNList n = unfoldr generator 1\n            where generator x = if x &gt; n then Nothing else Just (x*x, x+1)\n</code></pre>\n\n<p>So for a simple example like <code>sqNList 3</code>, it proceeds as follows:</p>\n\n<ol>\n<li>Call <code>generator 1</code> and get back <code>Just (1, 2)</code>; the accumulator is now <code>[1]</code>.</li>\n<li>Call <code>generator 2</code> and get back <code>Just (4, 3)</code>; the accumulator is now\n<code>[1,4]</code>.</li>\n<li>Call <code>generator 3</code> and get back <code>Just (9, 4)</code>; the accumulator is now <code>[1,4,9]</code>.</li>\n<li>Call <code>generator 4</code> and get back <code>Nothing</code>. Return the accumulator <code>[1,4,9]</code> as the result.</li>\n</ol>\n\n<hr>\n\n<p>Note that you generate the infinite list of <em>all</em> squares simply by never returning <code>Nothing</code>:</p>\n\n<pre><code>allSquares = unfoldr (\\x -&gt; Just (x*x, x+1)) 1\n</code></pre>\n\n<p>Haskell, being lazy, only generates elements in the list as you need them, so you could also define <code>sqNList</code> by taking only the first <code>n</code> items of the infinite list.</p>\n\n<pre><code>sqNList n = take n (unfoldr (\\x -&gt; Just (x*x, x+1)) 1)\n</code></pre>\n"}], "owner": {"reputation": 1239, "user_id": 3027307, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1ad7a159da4fd1c959437713ca89aa74?s=128&d=identicon&r=PG&f=1", "display_name": "Softey", "link": "https://stackoverflow.com/users/3027307/softey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2019, "favorite_count": 2, "accepted_answer_id": 47676223, "answer_count": 3, "score": 0, "last_activity_date": 1512574220, "creation_date": 1512568554, "question_id": 47676030, "link": "https://stackoverflow.com/questions/47676030/haskell-recursive-function-add-to-the-end-of-a-list", "title": "Haskell recursive function add to the end of a list", "body": "<p>I have a recursive Haskell function that takes a number n and generates a list that is n long of squared numbers from 1 up.</p>\n\n<p>The code works but instead of the list for n=3 being [9,4,1] I want it to be [1,4,9].</p>\n\n<pre><code>sqNList :: Int -&gt; [Int]\nsqNList 0  = []\nsqNList n  = n*n : sqNList (n-1)\n</code></pre>\n\n<p>I've tried swappig the : for a ++ but then the pattern matching doesn't work. I have only just started Haskell today so may be obvious</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 4, "last_activity_date": 1512561216, "creation_date": 1512561216, "answer_id": 47673681, "question_id": 47673373, "link": "https://stackoverflow.com/questions/47673373/error-and-confusion-when-creating-datatype-and-monad/47673681#47673681", "title": "Error and confusion when creating datatype and monad", "body": "<p>You write <code>data</code> but mean <code>type</code> or <code>newtype</code>:</p>\n\n<pre><code>data Tile   = EmptyTile | X | O\ndata Player = Player1 | Player2\n\ninstance Show Tile where\n    show EmptyTile = \" \"\n    show X         = \"X\"\n    show O         = \"O\"\n\ntype Board = (Tile, Tile, Tile, Tile, Tile, Tile, Tile, Tile, Tile)\n\nemptyBoard :: Board\nemptyBoard = (EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile)\n-- this won\u2019t work\ninstance Monad Board where\n    return x = x\n    f &gt;&gt;= x = x\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>data Tile   = EmptyTile | X | O\ndata Player = Player1 | Player2\n\ninstance Show Tile where\n    show EmptyTile = \" \"\n    show X         = \"X\"\n    show O         = \"O\"\n\nnewtype Board = Board (Tile, Tile, Tile, Tile, Tile, Tile, Tile, Tile, Tile)\n\nemptyBoard :: Board\nemptyBoard = Board (EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile)\n-- this also won\u2019t work \ninstance Monad Board where\n    return x = x\n    f &gt;&gt;= x = x\n</code></pre>\n\n<p>It\u2019s also worth noting that a board in a game of tic tax toe isn\u2019t going to be a <code>Monad</code>. For one thing it would need a type parameter and for another thing it will obviously never satisfy the laws.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1512562022, "last_edit_date": 1512562022, "creation_date": 1512561356, "answer_id": 47673729, "question_id": 47673373, "link": "https://stackoverflow.com/questions/47673373/error-and-confusion-when-creating-datatype-and-monad/47673729#47673729", "title": "Error and confusion when creating datatype and monad", "body": "<p>Every <code>data</code> constructor must have an unambiguous name, such as you gave with <code>EmptyTile</code>, <code>X</code>, <code>O</code>, <code>Player1</code> and <code>Player2</code>. With <code>Board</code>, there is no such name; Haskell desugars this as</p>\n\n<pre><code>data Board = (,,,,,,,,) Tile Tile Tile Tile Tile Tile Tile Tile Tile\n</code></pre>\n\n<p>so here, <code>(,,,,,,,,)</code> would be the &ldquo;constructor name&rdquo;, but that's not actually legal in Haskell, thus the error.</p>\n\n<p>Just choose a custom name, like boring</p>\n\n<pre><code>data Board = Board Tile Tile Tile Tile Tile Tile Tile Tile Tile\n</code></pre>\n\n<p>Now, this cannot possibly be a monad: a monad is foremostly a <a href=\"https://en.wikipedia.org/wiki/Functor\" rel=\"noreferrer\">functor</a>, i.e. something that's parameterised on some type and covariant in that parameter. You can make it a monad though, by replacing those hard-coded <code>Tile</code> fields with something polymorphic:</p>\n\n<pre><code>data Board t = Board t t t t t t t t t\n    deriving (Functor)\n</code></pre>\n\n<p>But the <code>Applicative</code> and <code>Monad</code> instances will look a bit more involved than what you proposed.</p>\n\n<p>You might consider an approach like this: instead of hand-rolling the <code>Board</code> data structure, you define an <em>indexing type</em>:</p>\n\n<pre><code>data BoardIndex = Edge0 | Middle | Edge1\ntype Board t = (BoardIndex, BoardIndex) -&gt; t\n</code></pre>\n\n<p>Then this will be a monad without any further definitions, namely the <em>function monad</em>, which has the semantics you probably want here. It tends to be a bit inefficient since results aren't actually <em>stored</em> but always recomputed on the spot, but for something like Tic Tac Toe that will hardly matter. (You can easily make it more efficient later, by introducing <a href=\"http://hackage.haskell.org/package/MemoTrie-0.6.8/docs/Data-MemoTrie.html\" rel=\"noreferrer\">memoisation</a>.)</p>\n"}], "owner": {"reputation": 1142, "user_id": 5180554, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/5OWnC.jpg?s=128&g=1", "display_name": "Alex Goft", "link": "https://stackoverflow.com/users/5180554/alex-goft"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 47673729, "answer_count": 2, "score": 0, "last_activity_date": 1512562022, "creation_date": 1512560256, "last_edit_date": 1512560942, "question_id": 47673373, "link": "https://stackoverflow.com/questions/47673373/error-and-confusion-when-creating-datatype-and-monad", "title": "Error and confusion when creating datatype and monad", "body": "<p>Consider the next piece of code:</p>\n\n<pre><code>data Tile   = EmptyTile | X | O\ndata Player = Player1 | Player2\n\ninstance Show Tile where\n    show EmptyTile = \" \"\n    show X         = \"X\"\n    show O         = \"O\"\n\ndata Board = (Tile, Tile, Tile, Tile, Tile, Tile, Tile, Tile, Tile)\n\nemptyBoard :: Board\nemptyBoard = (EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile,EmptyTile)\n\ninstance Monad Board where\n    return x = x\n    f &gt;&gt;= x = x\n</code></pre>\n\n<p>I'd like that Board will be a monad. But the problem is that i get the following error -</p>\n\n<pre><code>[1 of 1] Compiling Main             ( Main.hs, Main.o )\n\nMain.hs:17:14: error:\n    Illegal binding of built-in syntax: (,,,,,,,,)\n</code></pre>\n\n<p>What needs to be changed so that Board can be defined later on as a monad</p>\n"}, {"tags": ["parsing", "haskell", "parser-combinators"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1512559117, "post_id": 47672947, "comment_id": 82304926, "body": "Because data tends to be structured hierarchically, so you can write a parser for some subelement, and then build a cascade of parsers each doing one part of the puzzle? I.e. for an XML parser, first a parser that parses an attribute value, then a parser that parses <code>key=&quot;value&quot;</code> using the previous parser, then repeat that parser to parse an arbitrary number of key/value-pairs, then parse a tag, then parse a tag hierarchy, etc."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1512559742, "post_id": 47672947, "comment_id": 82305273, "body": "I&#39;d throw in the fact that you can reuse library functions, and that you&#39;re not limited to context-free grammars unlike a BNF-based approach."}, {"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1512591831, "post_id": 47672947, "comment_id": 82324956, "body": "Thanks-could you please expand that into an answer?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1512643074, "post_id": 47672947, "comment_id": 82345231, "body": "I think you can find answer here: <a href=\"https://softwareengineering.stackexchange.com/questions/338665/when-to-use-a-parser-combinator-when-to-use-a-parser-generator\" title=\"when to use a parser combinator when to use a parser generator\">softwareengineering.stackexchange.com/questions/338665/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1239, "user_id": 8887578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3nMBo.png?s=128&g=1", "display_name": "Do Say Lazy", "link": "https://stackoverflow.com/users/8887578/do-say-lazy"}, "is_accepted": true, "score": 2, "last_activity_date": 1512776322, "creation_date": 1512776322, "answer_id": 47723695, "question_id": 47672947, "link": "https://stackoverflow.com/questions/47672947/what-are-the-reasons-for-using-parser-combinators/47723695#47723695", "title": "What are the reasons for using parser combinators?", "body": "<p>I see several benefits of using parser combinators:</p>\n\n<ul>\n<li>Parser combinators are a generalization of hand-written top-down parsers. In the case that you hand-write a parser, use parser combinators to abstract away common patterns.</li>\n<li>Unlike parser generators, parser combinators are potentially <em>dynamic</em>, allowing for decisions during runtime. This aspect may be useful if the language's grammar may be redefined based on the input.</li>\n<li>Parsers are first-class objects.</li>\n</ul>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 1, "accepted_answer_id": 47723695, "answer_count": 1, "score": 4, "last_activity_date": 1512776322, "creation_date": 1512558718, "question_id": 47672947, "link": "https://stackoverflow.com/questions/47672947/what-are-the-reasons-for-using-parser-combinators", "title": "What are the reasons for using parser combinators?", "body": "<p>I'm looking at the <a href=\"https://two-wrongs.com/parser-combinators-parsing-for-haskell-beginners\" rel=\"nofollow noreferrer\">following approach</a> to using parser combinators in Haskell. The author gives the following example of Parser Combinators:</p>\n\n<pre><code>windSpeed :: String -&gt; Maybe Int\nwindSpeed windInfo =\n    parseMaybe windSpeedParser windInfo\n\nwindSpeedParser :: ReadP Int\nwindSpeedParser = do\n    direction &lt;- numbers 3\n    speed &lt;- numbers 2 &lt;|&gt; numbers 3\n    unit &lt;- string \"KT\" &lt;|&gt; string \"MPS\"\n    return speed\n</code></pre>\n\n<p>The author gives the following reasons for this approach:</p>\n\n<ul>\n<li>easy to read (I agree with this)</li>\n<li>similar format to the specification ie the parser itself is basically a description of what it parses (I agree with this)</li>\n</ul>\n\n<p>I can't help but feel I'm missing some of the reasons for choosing parser combinators. Some benefit of either <a href=\"https://pchiusano.github.io/2016-09-15/static-vs-dynamic.html\" rel=\"nofollow noreferrer\">using</a> Haskell, compile-time <a href=\"https://www.schoolofhaskell.com/user/mwm/cards\" rel=\"nofollow noreferrer\">guarantees</a>, <a href=\"https://wiki.haskell.org/Hitchhikers_guide_to_Haskell#Chapter_2:_Parsing_the_input\" rel=\"nofollow noreferrer\">elimination</a> of runtime errors. Or some subsequent benefit when you starting <a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\" rel=\"nofollow noreferrer\">parsing</a> DSLs <a href=\"https://joashc.github.io/posts/2015-09-13-free-monad-steps.html\" rel=\"nofollow noreferrer\">and using</a> free monads. </p>\n\n<p>My question is: <strong>What are the reasons for using parser combinators?</strong></p>\n"}, {"tags": ["haskell", "server", "haskell-stack", "static-content", "haskell-spock"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 2, "creation_date": 1512553010, "post_id": 47669542, "comment_id": 82300800, "body": "It&#39;s been a while since I&#39;ve used Spock, so this may be wrong: The path <code>&quot;&#47;&quot;</code> in your RouteSpec doesn&#39;t have a wildcard, so I think that will only match <i>exactly</i> <code>&#47;</code>. I suspect what you want is <code>middleware $ staticPolicy $ addBase &quot;static&quot;</code>."}], "answers": [{"tags": [], "owner": {"reputation": 280, "user_id": 9060407, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vPOIBOxCUpo/AAAAAAAAAAI/AAAAAAAAAFo/SKk9hpOB7v4/photo.jpg?sz=128", "display_name": "Rishichandra Wawhal", "link": "https://stackoverflow.com/users/9060407/rishichandra-wawhal"}, "is_accepted": true, "score": 2, "last_activity_date": 1519504820, "creation_date": 1519504820, "answer_id": 48967381, "question_id": 47669542, "link": "https://stackoverflow.com/questions/47669542/how-to-serve-static-content-using-spock-haskell/48967381#48967381", "title": "How to serve static content using Spock (Haskell)?", "body": "<p>The right way to do this is using the <code>html</code> function from the <a href=\"https://hackage.haskell.org/package/Spock-core-0.12.0.0/docs/Web-Spock-Action.html\" rel=\"nofollow noreferrer\">Web.Spock.Action</a> package.</p>\n\n<p>I used a jinja templating using ginger to parameterize my html file and then served it using the <code>html</code> function.</p>\n\n<pre><code>import qualified Web.Spock.Action as SA\n\nserveHtml :: JinjaTemplate -&gt; SA.ActionT (LoggingT IO) ()\nserveHtml tmplt = SA.html tmplt\n</code></pre>\n"}], "owner": {"reputation": 280, "user_id": 9060407, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vPOIBOxCUpo/AAAAAAAAAAI/AAAAAAAAAFo/SKk9hpOB7v4/photo.jpg?sz=128", "display_name": "Rishichandra Wawhal", "link": "https://stackoverflow.com/users/9060407/rishichandra-wawhal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 440, "favorite_count": 0, "accepted_answer_id": 48967381, "answer_count": 1, "score": 8, "last_activity_date": 1519504820, "creation_date": 1512547575, "question_id": 47669542, "link": "https://stackoverflow.com/questions/47669542/how-to-serve-static-content-using-spock-haskell", "title": "How to serve static content using Spock (Haskell)?", "body": "<p>I am running a Spock server and wanting to serve some static content.\nI am using <code>respondMiddleware</code> function from the \"Web.Spock.Action\" package.</p>\n\n<p>The signature is:</p>\n\n<pre><code>    respondMiddleware :: Monad m =&gt; Middleware -&gt; ActionCtxT ctx m a\n</code></pre>\n\n<p>I am getting this \"Middleware\" using the <code>staticPolicy</code> function from \"Network.Wai.Middleware.Static\" package</p>\n\n<pre><code>    staticPolicy :: Policy -&gt; Middleware\n</code></pre>\n\n<p>And the \"Policy\" using <code>addBase</code> from \"Network.Wai.Middleware.Static\" package</p>\n\n<pre><code>    addBase :: String -&gt; Policy\n</code></pre>\n\n<p>Here is my codeblock:</p>\n\n<pre><code>    get (\"/\") $\n      respondMiddleware $ staticPolicy $ addBase (\"static\")\n</code></pre>\n\n<p>The <code>static</code> has an <code>index.html</code> and the related JS and CSS files and it is placed in the root directory of the stack project. The error I get is <code>Failed to load resource: the server responded with a status of 400 (Bad Request)</code></p>\n"}, {"tags": ["haskell", "monads", "quickcheck"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1512523491, "last_edit_date": 1512523491, "creation_date": 1512523113, "answer_id": 47665328, "question_id": 47664913, "link": "https://stackoverflow.com/questions/47664913/how-to-combine-arbitrary-and-io-monads/47665328#47665328", "title": "How to combine Arbitrary and IO monads?", "body": "<p>As <code>Test.QuickCheck.Gen</code> tells you, you can use <code>GenT</code> from <a href=\"http://hackage.haskell.org/package/QuickCheck-GenT\" rel=\"nofollow noreferrer\"><code>QuickCheck-GenT</code></a>. <code>GenT m</code> is a <code>MonadIO</code> instance whenever <code>m</code> is.</p>\n\n<pre><code>main = join . generate . runGenT $ do\n  let n = 10\n  list &lt;- liftGen $ vector n\n  liftIO $ writeFile \"output.txt\" (unlines $ show &lt;$&gt; list)\n</code></pre>\n\n<p>seems likely to work.</p>\n"}, {"tags": [], "owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "is_accepted": false, "score": 4, "last_activity_date": 1512524725, "creation_date": 1512524725, "answer_id": 47665520, "question_id": 47664913, "link": "https://stackoverflow.com/questions/47664913/how-to-combine-arbitrary-and-io-monads/47665520#47665520", "title": "How to combine Arbitrary and IO monads?", "body": "<p>The <code>vector</code> function gives you the list generator, and not a particular list:</p>\n\n<pre><code>vector :: Arbitrary a =&gt; Int -&gt; Gen [a]\n</code></pre>\n\n<p>Since <code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code>, it won't get you out of <code>Gen</code>. But <code>generate</code> from <code>Test.QuickCheck.Gen</code> does the particular-value-generation suitable for this situation: <code>generate :: Gen a -&gt; IO a</code>. So <code>generate (vector n) &gt;&gt;= writeFile \"output.txt\" . unlines . map show</code> should do what you want (save for the the type ambiguity: it's not clear in your example for what <code>Gen [a]</code> your vector will yield, so perhaps add something like <code>(vector n :: Gen [Int])</code> unless your actual application provides enough context for type inference.</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1512524725, "creation_date": 1512520188, "question_id": 47664913, "link": "https://stackoverflow.com/questions/47664913/how-to-combine-arbitrary-and-io-monads", "title": "How to combine Arbitrary and IO monads?", "body": "<p>I am trying to write a program which writes to a file a list of data generated by an <a href=\"https://hackage.haskell.org/package/QuickCheck-2.10.1/docs/Test-QuickCheck-Arbitrary.html#v:liftArbitrary\" rel=\"nofollow noreferrer\"><code>Arbitrary</code></a> instance, and I am having trouble combining the <code>Arbitrary</code> and <code>IO</code> monads.</p>\n\n<p>A simplified version of what I am trying to do is shown below.</p>\n\n<pre><code>main = do\n  let n = 10\n  list &lt;- vector n\n  writeFile \"output.txt\" (unlines $ show &lt;$&gt; list)\n</code></pre>\n\n<p>This leads to a type error since <code>writeFile</code>'s <code>IO</code> monad does not match <code>vector</code>'s <code>Gen</code> monad.</p>\n\n<pre><code>TestCases.hs:31:3: error:\n    \u2022 Couldn't match type \u2018IO\u2019 with \u2018Test.QuickCheck.Gen.Gen\u2019\n      Expected type: Test.QuickCheck.Gen.Gen ()\n        Actual type: IO ()\n    \u2022 In a stmt of a 'do' block:\n        writeFile \"output.txt\" (unlines $ show &lt;$&gt; list)\n      In the expression:\n        do { let n = 10;\n             list &lt;- vector n;\n             writeFile \"output.txt\" (unlines $ show &lt;$&gt; list) }\n      In an equation for \u2018main\u2019:\n          main\n            = do { let n = ...;\n                   list &lt;- vector n;\n                   writeFile \"output.txt\" (unlines $ show &lt;$&gt; list) }\n</code></pre>\n\n<p>I have tried using <code>liftIO</code> to resolve this type mismatch, but it appears that this does not work due to <code>Gen</code> lacking a <code>MonadIO</code> instance.</p>\n\n<pre><code>main = do\n  let n = 10\n  list &lt;- vector n :: Gen [Integer]\n  liftIO $ writeFile \"output.txt\" (unlines $ show &lt;$&gt; list)\n</code></pre>\n\n<p>gives the error</p>\n\n<pre><code>TestCases.hs:32:3: error:\n    \u2022 No instance for (MonadIO Gen) arising from a use of \u2018liftIO\u2019\n    \u2022 In a stmt of a 'do' block:\n        liftIO $ writeFile \"output.txt\" (unlines $ show &lt;$&gt; list)\n      In the expression:\n        do { let n = 10;\n             list &lt;- vector n :: Gen [Integer];\n             liftIO $ writeFile \"output.txt\" (unlines $ show &lt;$&gt; list) }\n      In an equation for \u2018main\u2019:\n          main\n            = do { let n = ...;\n                   list &lt;- vector n :: Gen [Integer];\n                   liftIO $ writeFile \"output.txt\" (unlines $ show &lt;$&gt; list) }\n</code></pre>\n\n<p>How can I print an Arbitrary-generated list to a file?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1512511417, "post_id": 47663389, "comment_id": 82286076, "body": "What is <code>testMArray</code>? I bet you need <code>testMArray &gt;&gt;= go 0 0</code> or similar."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1512511753, "post_id": 47663389, "comment_id": 82286212, "body": "@DanielWagner <code>testMArray :: ST s (STArray s Int Int)</code>. I&#39;ll edit."}, {"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 1, "creation_date": 1512514261, "post_id": 47663389, "comment_id": 82287221, "body": "@AdamSmith In case you&#39;re interested, I did the same but using mutable vectors: <a href=\"https://github.com/ZedPea/advent-of-code/blob/master/day05-2.hs\" rel=\"nofollow noreferrer\">github.com/ZedPea/advent-of-code/blob/master/day05-2.hs</a>"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 0, "creation_date": 1512516708, "post_id": 47663389, "comment_id": 82288019, "body": "@Zpalmtree Thanks! Can you quickly summarize the difference between Arrays and Vectors?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 0, "creation_date": 1512518023, "post_id": 47663389, "comment_id": 82288481, "body": "@Zpalmtree also: share and <a href=\"https://gitlab.com/nottheeconomist/adventofcode_hs/\" rel=\"nofollow noreferrer\">share alike</a>"}, {"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 1, "creation_date": 1512518469, "post_id": 47663389, "comment_id": 82288627, "body": "@AdamSmith I&#39;m not really sure what the difference is to be honest. I believe they both have O(1) access times, but after looking at the array API, vector looked a lot more easy to use, it has a lot more of the functions that you&#39;re used to from lists."}], "answers": [{"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512512783, "post_id": 47663587, "comment_id": 82286679, "body": "Yes I think that&#39;s likely. So <code>testMArray</code> is not itself a stateful array, just an action that produces one, yes? One of these days I&#39;m going to understand Haskell, and my Godhood shall be magnificent ;)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 2, "creation_date": 1512512822, "post_id": 47663587, "comment_id": 82286691, "body": "@AdamSmith Correct!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1512515326, "post_id": 47663587, "comment_id": 82287544, "body": "Reading this I can&#39;t stop wondering why <code>MA.getBounds</code> returns the pair inside the monad, instead of outside it. Does <code>MArray</code> have some instances of array types supporting resizing, to justify this monad nature of <code>MA.getBounds</code>? Possibly, it&#39;s slightly more general than needed in practice (?)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1512518515, "post_id": 47663587, "comment_id": 82288640, "body": "@chi I believe you&#39;ve nailed it: <code>MArray</code> was designed to be flexible enough to handle resizable arrays, but no extant instances take advantage of this."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1512512807, "last_edit_date": 1512512807, "creation_date": 1512512370, "answer_id": 47663587, "question_id": 47663389, "link": "https://stackoverflow.com/questions/47663389/starray-indexing-gives-a-type-error/47663587#47663587", "title": "STArray indexing gives a type error", "body": "<p>You simply seem to be mixing up <code>ST</code> actions which produce arrays with the arrays themselves. The fix is pretty easy: run such actions to get their arrays. Here's the minimal fix I needed to make to get this to compile (no idea if it is \"correct\" -- just that it type-checks).</p>\n\n<ol>\n<li><p>Run the <code>ST</code> action.</p>\n\n<pre><code>mStep = testMArray &gt;&gt;= go 0 0 where\n</code></pre></li>\n<li><p>Give <code>go</code> a type that expects an array, not an <code>ST</code> action.</p>\n\n<pre><code>go :: Integer -&gt; Int -&gt; STArray s Int Int -&gt; ST s Integer\n</code></pre></li>\n<li><p>Define <code>day5Input</code>. (Presumably you need not backport this fix.)</p>\n\n<pre><code>day5Input = undefined\n</code></pre></li>\n</ol>\n\n<p>For your subquestion, you can use</p>\n\n<pre><code>getBounds :: (Ix i, MArray a e m) =&gt; a i e -&gt; m (i, i)\n</code></pre>\n\n<p>to get the bounds dynamically. So:</p>\n\n<pre><code>mStep = do\n    arr &lt;- testMArray\n    (lbound, ubound) &lt;- MA.getBounds arr\n    go lbound ubound 0 0 arr\n    where\n    go :: Int -&gt; Int -&gt; Integer -&gt; Int -&gt; STArray s Int Int -&gt; ST s Integer\n    go lbound ubound c i arr | -- same as before\n        -- until the very last line\n        go lbound ubound (c+1) i' arr\n</code></pre>\n"}], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 47663587, "answer_count": 1, "score": 1, "last_activity_date": 1512512807, "creation_date": 1512511330, "last_edit_date": 1512512378, "question_id": 47663389, "link": "https://stackoverflow.com/questions/47663389/starray-indexing-gives-a-type-error", "title": "STArray indexing gives a type error", "body": "<p>I'm trying to solve this year's <a href=\"http://adventofcode.com/2017/\" rel=\"nofollow noreferrer\">Advent of Code</a> using Haskell, and ran into an issue on day 5 which asks us to jump around instructions in a list of jumps and count how many steps it takes until you exit the instruction set. I implemented this correctly with <code>IArray</code>s, but it seems like a waste to re-initialize this huge array over and over so I'm trying to re-implement with <code>MArray</code> instead, which is throwing me into the scary world of the <code>ST</code> monad.</p>\n\n<p>Here is my correctly working code:</p>\n\n<pre><code>import qualified Data.Array as A\n\n-- sample input\nday5Input :: [Int]\nday5Input = [0, -1, 1032] ++ replicate 1030 [1]  -- to fill the array\n\nday5Array :: A.Array Int Int\nday5Array = A.listArray (0, 1032) day5Input\n\np1Day5Result :: Integer\np1Day5Result = go 0 0 day5Array where\n  go :: Integer -&gt; Int -&gt; A.Array Int Int -&gt; Integer\n  go c i a | i &gt; ubound || i &lt; lbound = c\n           | otherwise                = let n = a A.! i\n                                            i' = i+n\n                                            n' = n+1\n                                            a' = a A.// [(i, n')]\n                                        in  go (c+1) i' a'\n  (lbound, ubound) = A.bounds day5Array\n</code></pre>\n\n<p>which I attempted to re-create using an <code>STArray</code> with:</p>\n\n<pre><code>import Data.Array.MArray as MA\nimport Data.Array.ST (STArray, runSTArray)\nimport Control.Monad.ST\n\n-- sample input\nday5Input :: [Int]\nday5Input = [0, -1, 1032] ++ replicate 1030 [1]  -- to fill the array\n\ntestMArray :: ST s (STArray s Int Int)\ntestMArray = MA.newListArray (0, 1032) day5Input\n\nmStep :: ST s Integer\nmStep = go 0 0 testMArray where\n  go :: Integer -&gt; Int -&gt; ST s (STArray s Int Int) -&gt; ST s Integer\n  go c i arr | i &gt; ubound || i &lt; lbound = return c\n             | otherwise                = do\n                     n &lt;- MA.readArray arr i\n                     let i' = i+n\n                         n' = n+1\n                     MA.writeArray arr i n'\n                     go (c+1) i' arr\n  (lbound, ubound) = (0, 1032)  -- sub-question, how do I query for this\n                                -- like I did with A.bounds above?\n</code></pre>\n\n<p>However I get the error:</p>\n\n<pre><code>day5.hs:1091:44: error:\n    * Couldn't match expected type `s1' with actual type `Int'\n      `s1' is a rigid type variable bound by\n        the type signature for:\n          go :: forall s1.\n                Integer -&gt; Int -&gt; ST s1 (STArray s1 Int Int) -&gt; ST s1 Integer\n</code></pre>\n\n<p>I'm not seeing how my code differs from <a href=\"https://wiki.haskell.org/Modern_array_libraries#Mutable_arrays_in_ST_monad_.28module_Data.Array.ST.29\" rel=\"nofollow noreferrer\">this example code</a> that works. Please advise.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512507967, "post_id": 47662570, "comment_id": 82284392, "body": "This seems like <i>imerative code</i> written in Haskell syntax, although we can write this although it is possible to do this that way, it is usually not a good idea. Here for instance you will call <code>a</code> (n+1) times. And although this may look as a detail since you &quot;throw away&quot; the result, since action is an IO monad, this will probably/usually have side-effects."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1512508003, "post_id": 47662570, "comment_id": 82284406, "body": "Please be more specific than &quot;it doesn&#39;t work&quot;. Do you get a compilation error? If so, which one? If not, do you get an exception at runtime? If so, which one? Or does the function just not behave as expected? If so, how did you call it; what did you expect to happen and what actually happened? The first problem I see is your indentation, but that might very well be a copy-and-paste issue."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512508244, "post_id": 47662570, "comment_id": 82284516, "body": "<code>replicateIO n-1 a</code> means <code>(replicateIO n) - (1 a)</code>; you want <code>replicateIO (n-1) a</code>. Further, you should really start writing the type of <code>replicateIO</code> first, otherwise GHC will infer/guess its type and produce confusing error messages. If you do provide the (right) type, the errors will usually make much more sense."}, {"owner": {"reputation": 5, "user_id": 9058081, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pS9zy_xozOc/AAAAAAAAAAI/AAAAAAAAAAo/kdBWPh3IpPM/photo.jpg?sz=128", "display_name": "Thiago Roberto", "link": "https://stackoverflow.com/users/9058081/thiago-roberto"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512508360, "post_id": 47662570, "comment_id": 82284571, "body": "@chi nice, it compiles now. But now it doesn&#39;t let me type(read) anything. It returns [ ] always."}], "answers": [{"tags": [], "owner": {"reputation": 123, "user_id": 5957296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea0341a76a1b19e27b1991e69aee9835?s=128&d=identicon&r=PG&f=1", "display_name": "Guest", "link": "https://stackoverflow.com/users/5957296/guest"}, "is_accepted": false, "score": 6, "last_activity_date": 1512508531, "creation_date": 1512508531, "answer_id": 47662765, "question_id": 47662570, "link": "https://stackoverflow.com/questions/47662570/haskell-how-to-do-a-loop/47662765#47662765", "title": "Haskell: how to do a loop", "body": "<p>Have you tried <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Monad.html#v:replicateM\" rel=\"noreferrer\"><code>replicateM</code></a>?</p>\n\n<blockquote>\n  <p><code>replicateM n act</code> performs the action <code>n</code> times, gathering the results.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 5, "user_id": 9058081, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pS9zy_xozOc/AAAAAAAAAAI/AAAAAAAAAAo/kdBWPh3IpPM/photo.jpg?sz=128", "display_name": "Thiago Roberto", "link": "https://stackoverflow.com/users/9058081/thiago-roberto"}, "edited": false, "score": 0, "creation_date": 1512508864, "post_id": 47662769, "comment_id": 82284805, "body": "thank you so much. Functional Programming is really hard for me &#39;cause it was really new for me &#39;till this semester, and it is kinda of hard to think on functions instead of variables. You were really helpfull, thanks!!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1512508546, "creation_date": 1512508546, "answer_id": 47662769, "question_id": 47662570, "link": "https://stackoverflow.com/questions/47662570/haskell-how-to-do-a-loop/47662769#47662769", "title": "Haskell: how to do a loop", "body": "<p>There are some problems here:</p>\n\n<ol>\n<li>you write <code>[y:ys]</code> as cons, but a <em>cons</em> in Haskell is the <code>(:) :: a -&gt; [a] -&gt; [a]</code> operator, so it is <code>y : ys</code>, or <code>(y : ys)</code> (between brackets). If you write <code>[y:ys]</code>, you wrap the result of <code>(y:ys)</code> an a new singleton list;</li>\n<li>you perform <code>y &lt;- a</code> <em>n+1</em> times, since one of the reasons to use Monads can be to use a <em>state</em> (for instance the state of the machine with <code>IO</code>), this can have unintended side effects; and</li>\n<li>you use <code>(replicateIO n-1 a)</code> which is interpreted in Haskell as <code>((replicateIO n)-(1 a))</code>.</li>\n</ol>\n\n<p>But I think the most important aspect is that you write <em>imperative programs</em> in <em>Haskell syntax</em>. Haskell is a <em>functional</em> programming language. This means a different paradigm. I think it would probably be better to write first some programs that do not work with monads (and <code>do</code> notation).</p>\n\n<p>That being said, we can use the above remarks to solve the problem in the question:</p>\n\n<pre><code>replicateIO n a = if n &lt; 0\n                    then return []\n                    else do y &lt;- a\n                            ys &lt;- replicateIO (n-1) a\n                            return (y:ys)\n</code></pre>\n\n<p>Although this fixes the issues, it is not very elegant and <em>Haskell-ish</em> syntax. We can for instance use guards instead of <code>if</code>-<code>then</code>-<code>else</code>:</p>\n\n<pre><code>replicateIO n a | n &lt; 0 = return []\n                | otherwise = do\n                      y &lt;- a\n                      ys &lt;- replicateIO (n-1) a\n                      return (y:ys)\n</code></pre>\n\n<p>We can make some further improvements (and even omit the <code>do</code> notation, but I think it is probably beneficial to first realize that <code>do</code> is actually syntactical sugar for some functions).</p>\n"}], "owner": {"reputation": 5, "user_id": 9058081, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pS9zy_xozOc/AAAAAAAAAAI/AAAAAAAAAAo/kdBWPh3IpPM/photo.jpg?sz=128", "display_name": "Thiago Roberto", "link": "https://stackoverflow.com/users/9058081/thiago-roberto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 47662769, "answer_count": 2, "score": 0, "last_activity_date": 1512508546, "creation_date": 1512507587, "last_edit_date": 1512508235, "question_id": 47662570, "link": "https://stackoverflow.com/questions/47662570/haskell-how-to-do-a-loop", "title": "Haskell: how to do a loop", "body": "<p>I have to read <code>n</code> times and then put it all in a list. I have the following code but it doesn't work. Any Haskell/Functional expert may give me a light? </p>\n\n<pre><code>replicateIO n a = do y &lt;- a \n                 if n &lt; 0\n                    then return []\n                    else do ys &lt;- (replicateIO n-1 a)\n                            return [y:ys]\n</code></pre>\n\n<p>Compile error: </p>\n\n<pre><code>tres.hs:1:1: error:\n    Couldn't match type \u2018(-&gt;) t0\u2019 with \u2018[]\u2019\n    Expected type: t -&gt; [[a]]\n      Actual type: t -&gt; t0 -&gt; [[a]]\n  |\n1 | replicateIO n a = if n &lt; 0    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^...\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1512500960, "post_id": 47660915, "comment_id": 82280854, "body": "What does not work? <code>75</code> is odd, so you get an <code>IO Bool</code> that is a <code>False</code> wrapped in an <code>IO</code>."}, {"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1512501180, "post_id": 47660915, "comment_id": 82280962, "body": "<code>return f(b);</code> should be <code>return $ f b</code> or <code>return (f b)</code>. @WillemVanOnsem I think that&#39;s meant to be the example output, not the actual output"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512501182, "post_id": 47660915, "comment_id": 82280967, "body": "<code>return f(b)</code> is parsed as <code>return f b</code>, i.e. the application of <code>return</code> to two arguments, <code>f</code> and <code>b</code>. <code>return</code> is not a keyword as you may expect (i.e. as in many imperative/OO languages) so it follows the normal rules of function application precedence."}, {"owner": {"reputation": 5, "user_id": 9058081, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pS9zy_xozOc/AAAAAAAAAAI/AAAAAAAAAAo/kdBWPh3IpPM/photo.jpg?sz=128", "display_name": "Thiago Roberto", "link": "https://stackoverflow.com/users/9058081/thiago-roberto"}, "edited": false, "score": 0, "creation_date": 1512501402, "post_id": 47660915, "comment_id": 82281080, "body": "It worked when I did return (f b). Sorry I&#39;m really newbie using functional languages. Thank you guys, really!"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1512501536, "post_id": 47660915, "comment_id": 82281153, "body": "I&#39;m stumped at the inferred type of OP&#39;s <code>mapIO</code> despite understanding how it&#39;s parsed... Can anyone explain?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1512501667, "post_id": 47660915, "comment_id": 82281232, "body": "@ThiagoRoberto you&#39;re going about things the wrong way around; start by writing your type signature (then you won&#39;t have to write out things like that tortured second paragraph), then start on the implementation. Also use e.g. <code>:t mapIO</code> to query for the types of things in ghci"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1512501894, "post_id": 47660915, "comment_id": 82281359, "body": "@jberryman Yes, I can explain. See my answer. =)"}, {"owner": {"reputation": 5, "user_id": 9058081, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pS9zy_xozOc/AAAAAAAAAAI/AAAAAAAAAAo/kdBWPh3IpPM/photo.jpg?sz=128", "display_name": "Thiago Roberto", "link": "https://stackoverflow.com/users/9058081/thiago-roberto"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1512502278, "post_id": 47660915, "comment_id": 82281567, "body": "@jberryman actually it was the activity statement, anyway thanks for the tip, I&#39;ll try that more oftenly from now on"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 8, "last_activity_date": 1512501872, "creation_date": 1512501872, "answer_id": 47661179, "question_id": 47660915, "link": "https://stackoverflow.com/questions/47660915/haskell-i-dont-know-how-to-match-types/47661179#47661179", "title": "Haskell: I don&#39;t know how to match types", "body": "<p>In many other languages, <code>g(x)</code> is the syntax for applying function <code>g</code> to argument <code>x</code>. In Haskell, juxtaposition suffices, so that <code>g x</code> applies <code>g</code> to <code>x</code>. By coincidence, this means <code>g(x)</code> is <em>also</em> valid syntax that applies <code>g</code> to the value <code>(x)</code>, which is the same as <code>x</code>, so to a beginner it may seem that <code>g(x)</code> is the correct syntax for function application. But it ain't, and that confusion has bitten you here.</p>\n\n<p>When you write <code>return f(b)</code>, you probably assume this means to use the special syntax <code>return</code> and the thing to return should be the function application <code>f(b)</code>. However, <code>return</code> is itself a function in Haskell. So what it actually means is to apply <code>return</code> to the function <code>f</code>, then apply the result to the term <code>(b)</code>. (Function application is \"left-associative\" in that sense.)</p>\n\n<p>Luckily the fix for function application associativity problems, as with other associativity problems, is to use parentheses. So:</p>\n\n<pre><code>return (f(b))\n</code></pre>\n\n<p>Or, without the coincidentally correct extra parentheses:</p>\n\n<pre><code>return (f b)\n</code></pre>\n\n<p>This leaves only the question of why it \"worked\" (in the sense of compiled and type-checked) in <code>return f(b)</code> form. This is a bit of an advanced topic; but it turns out that functions also form a <code>Monad</code> with <code>return = const</code>, and so <code>return f(b)</code> actually meant <code>const f(b)</code>, which threw away the <code>(b)</code> term. (Aside: in addition to being <em>allowed</em> to use the function instance of <code>Monad</code>, we also <em>must</em> be using the function instance of <code>Monad</code> here. Since we are applying <code>return f</code> to <code>(b)</code>, the type of <code>return f</code> must be a function.) So your definition was the same as:</p>\n\n<pre><code>mapIO' f a = do b &lt;- a\n                f\n</code></pre>\n\n<p>That is: first do <code>a</code>, throw away its result, then do <code>f</code> <em>as if it were another input/output action</em>. If you check the type inferred for <code>mapIO</code> you will see it matches this intuition:</p>\n\n<pre><code>mapIO :: Monad m =&gt; m b -&gt; m t -&gt; m b\n</code></pre>\n\n<p>Whoops!</p>\n"}], "owner": {"reputation": 5, "user_id": 9058081, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pS9zy_xozOc/AAAAAAAAAAI/AAAAAAAAAAo/kdBWPh3IpPM/photo.jpg?sz=128", "display_name": "Thiago Roberto", "link": "https://stackoverflow.com/users/9058081/thiago-roberto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 47661179, "answer_count": 1, "score": 0, "last_activity_date": 1512505098, "creation_date": 1512500789, "last_edit_date": 1512505098, "question_id": 47660915, "link": "https://stackoverflow.com/questions/47660915/haskell-i-dont-know-how-to-match-types", "title": "Haskell: I don&#39;t know how to match types", "body": "<p>So, I have this Haskell question to resolve: </p>\n\n<p>Define a <code>mapIO</code> function that receives a function <code>f</code> and an input and output action <code>a</code> and results in an input and output action that, when executed, performs the given action <code>a</code> and returns the application of <code>f</code> to the return of <code>a</code>.</p>\n\n<p>Here's my code: </p>\n\n<pre><code>mapIO f a = do b &lt;- a\n               return f(b);\n</code></pre>\n\n<p>It compiles but it doesn't work. When I try to do the same as the following execution example, it doesn't work. Please, can someone help me? </p>\n\n<pre><code>Prelude Data.Char&gt; mapIO even readLn\n75\nFalse\n</code></pre>\n"}, {"tags": ["haskell", "idris", "state-machine", "pushdown-automaton"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512501720, "post_id": 47660589, "comment_id": 82281264, "body": "Your code, while somewhat cumbersome, doesn&#39;t seem to be completely wrong. You define a type of actions which is indexed on pairs of state (input/output state) and each action indicates from which states it can move and into which states it can move. This part is fine. Since you want to add each ingredient at most once, you need to place the appropriate constraints on <code>st</code> in the type <code>AddLettuce :: ... -&gt; SaladAction (bowl ** HasIngredient lettuce bowl)  st (const AddingIngredients)</code> (likewise for other ingredients) - namely that <code>lettuce st = False</code>."}], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512510606, "post_id": 47662741, "comment_id": 82285677, "body": "This looks like a great answer, but could you explain it a little more?"}, {"owner": {"reputation": 33569, "user_id": 3434, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5a484dc0812eb4542ee718d969513f66?s=128&d=identicon&r=PG", "display_name": "Apocalisp", "link": "https://stackoverflow.com/users/3434/apocalisp"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512510633, "post_id": 47662741, "comment_id": 82285696, "body": "Can you explain a bit what you want to have explained?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1512510824, "post_id": 47662741, "comment_id": 82285787, "body": "What exactly is an indexed state monad, and how does it work internally? What exactly is happening in the code here? I can see small steps, but the <code>IxState</code> is still non-transparent."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1512524102, "post_id": 47662741, "comment_id": 82290112, "body": "You&#39;re not really using the <i>monad</i> part of your indexed state monad, though. All of your actions return <code>()</code>, so it&#39;s just an obfuscated <code>-&gt;</code>. Additionally, I think you&#39;ll run into problems with your <code>Elem</code> as defined when you try to actually use it because of the overlapping instances, as I outlined in <a href=\"https://stackoverflow.com/a/47665387/1523776\">my answer</a>"}, {"owner": {"reputation": 33569, "user_id": 3434, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5a484dc0812eb4542ee718d969513f66?s=128&d=identicon&r=PG", "display_name": "Apocalisp", "link": "https://stackoverflow.com/users/3434/apocalisp"}, "edited": false, "score": 0, "creation_date": 1512524475, "post_id": 47662741, "comment_id": 82290195, "body": "I&#39;m not using the monad here, but I&#39;m assuming that in a real program you&#39;ll want to use <code>IxStateT</code> with some other monad that does the real thing that depends on the state."}, {"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 0, "creation_date": 1512583120, "post_id": 47662741, "comment_id": 82320438, "body": "Thanks @Apocalisp, I had considered IxMonad and Super monads, but not the more specific IxState, this opens up whole new worlds!"}], "tags": [], "owner": {"reputation": 33569, "user_id": 3434, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5a484dc0812eb4542ee718d969513f66?s=128&d=identicon&r=PG", "display_name": "Apocalisp", "link": "https://stackoverflow.com/users/3434/apocalisp"}, "is_accepted": false, "score": 7, "last_activity_date": 1512525869, "last_edit_date": 1512525869, "creation_date": 1512508398, "answer_id": 47662741, "question_id": 47660589, "link": "https://stackoverflow.com/questions/47660589/how-can-i-have-a-constrained-finite-state-machine-in-haskell-idris/47662741#47662741", "title": "How can I have a constrained Finite State Machine in Haskell / Idris?", "body": "<p>The <em>indexed state monad</em> does exactly this.</p>\n\n<p>The regular <code>State s</code> monad models a state machine (a <em>Mealy</em> machine, specifically) whose state alphabet is the type <code>s</code>. This data type is really just a function:</p>\n\n<pre><code>newtype State s a = State { run :: s -&gt; (a, s) }\n</code></pre>\n\n<p>A function of type <code>a -&gt; State s b</code> is a machine with input alphabet <code>a</code> and output alphabet <code>b</code>. But it's really just a function of type <code>(a, s) -&gt; (b, s)</code>.</p>\n\n<p>Lining up the input type of one machine and output type of another machine, we can compose two machines:</p>\n\n<pre><code>(&gt;&gt;=) :: State s a -&gt; (a -&gt; State s b) -&gt; State s b\nm &gt;&gt;= f = State (\\s1 -&gt; let (a, s2) = run m s1 in run (f a) s2)  \n</code></pre>\n\n<p>In other words, <code>State s</code> is a <em>monad</em>.</p>\n\n<p>But sometimes (as in your case), we need the type of the intermediate states to vary. This is where the indexed state monad comes in. It has <em>two</em> state alphabets. <code>IxState i j a</code> models a machine whose start state must be in <code>i</code> and end state will be in <code>j</code>:</p>\n\n<pre><code>newtype IxState i j a = IxState { run :: i -&gt; (a, j) }\n</code></pre>\n\n<p>The regular <code>State s</code> monad is then equivalent to <code>IxState s s</code>. We can compose <code>IxState</code> as easily as <code>State</code>. The implementation is the same as before, but the type signature is more general:</p>\n\n<pre><code>(&gt;&gt;&gt;=) :: IxState i j a -&gt; (a -&gt; IxState j k b) -&gt; IxState i k b\nm &gt;&gt;&gt;= f = IxState (\\s1 -&gt; let (a, s2) = run m s1 in run (f a) s2)  \n</code></pre>\n\n<p><code>IxState</code> is not exactly a monad, but an <em>indexed monad</em>.</p>\n\n<p>We now just need a way of specifying constraints on the type of our state. For the salad example, we want something like this:</p>\n\n<pre><code>mix :: IxState (Salad r) Ready ()\n</code></pre>\n\n<p>This is a machine whose input state is some incomplete <code>Salad</code> consisting of ingredients <code>r</code>, and whose output state is <code>Ready</code> indicating that our salad is ready to eat.</p>\n\n<p>Using type-level lists, we could say this:</p>\n\n<pre><code>data Salad xs = Salad\ndata Ready = Ready\ndata Lettuce\ndata Cucumber\ndata Tomato\n</code></pre>\n\n<p>The empty salad has an empty list of ingredients.</p>\n\n<pre><code>emptyBowl :: IxState x (Salad '[]) ()\nemptyBowl = iput Salad\n</code></pre>\n\n<p>We can add Lettuce to any Salad:</p>\n\n<pre><code>addLettuce :: IxState (Salad r) (Salad (Lettuce ': r)) ()\naddLettuce = iput Salad\n</code></pre>\n\n<p>And we can repeat the same for Tomato and Cucumber.</p>\n\n<p>Now the type of <code>mix</code> just needs to be:</p>\n\n<pre><code>mix :: IxState (Salad '[Lettuce, Cucumber, Tomato]) Ready ()\nmix = const Ready\n</code></pre>\n\n<p>We'll get a type error if we try to mix any salad that we haven't added <code>Lettuce</code>, <code>Cucumber</code>, and <code>Tomato</code> to, in that order. E.g. this will be a type error:</p>\n\n<pre><code>emptyBowl &gt;&gt;&gt;= \\_ -&gt; addLettuce &gt;&gt;&gt;= \\_ -&gt; mix\n</code></pre>\n\n<p>But ideally we'd like to be able to add the ingredients in any order. So we need a constraint on our type-level list asking for evidence that a particular ingredient is somewhere in our salad:</p>\n\n<pre><code>class Elem xs x\n\ninstance {-# OVERLAPS #-} Elem (x ': xs) x\ninstance Elem xs x =&gt; Elem (y ': xs) x\n</code></pre>\n\n<p><code>Elem xs x</code> is now evidence that the type <code>x</code> is in the type-level list <code>xs</code>. The first instance (the base case) says that <code>x</code> is obviously an element of <code>x ': xs</code>. The second instance says that if the type <code>x</code> is an element of <code>xs</code>, then it's also an element of <code>y ': xs</code> for any type <code>y</code>. <code>OVERLAPS</code> is necessary to make sure Haskell knows to check the base case first.</p>\n\n<p>Here's the complete listing:</p>\n\n<pre><code>{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nimport Control.Monad.Indexed\nimport Control.Monad.Indexed.State\n\ndata Lettuce\ndata Tomato\ndata Cucumber\n\ndata Ready = Ready\n\nclass Elem xs x\n\ninstance {-# OVERLAPS #-} Elem (x ': xs) x\ninstance Elem xs x =&gt; Elem (y ': xs) x\n\ndata Salad xs = Salad\n\nemptyBowl :: IxState x (Salad '[]) ()\nemptyBowl = iput Salad\n\naddLettuce :: IxState (Salad r) (Salad (Lettuce ': r)) ()\naddLettuce = iput Salad\n\naddTomato :: IxState (Salad r) (Salad (Tomato ': r)) ()\naddTomato = iput Salad\n\naddCucumber :: IxState (Salad r) (Salad (Cucumber ': r)) ()\naddCucumber = iput Salad\n\nmix :: (Elem r Lettuce, Elem r Tomato, Elem r Cucumber)\n    =&gt; IxState (Salad r) Ready ()\nmix = imodify mix'\n  where mix' = const Ready\n\nx &gt;&gt;&gt; y = x &gt;&gt;&gt;= const y\n\n-- Compiles\ntest = emptyBowl &gt;&gt;&gt; addLettuce &gt;&gt;&gt; addTomato &gt;&gt;&gt; addCucumber &gt;&gt;&gt; mix\n\n-- Fails with a compile-time type error\nfail = emptyBowl &gt;&gt;&gt; addTomato &gt;&gt;&gt; mix\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 33569, "user_id": 3434, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5a484dc0812eb4542ee718d969513f66?s=128&d=identicon&r=PG", "display_name": "Apocalisp", "link": "https://stackoverflow.com/users/3434/apocalisp"}, "edited": false, "score": 0, "creation_date": 1512525191, "post_id": 47665387, "comment_id": 82290373, "body": "There seems to be an obsession with Boolean type families that&#39;s endemic to the Haskell community. Don&#39;t use them! :)"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 33569, "user_id": 3434, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5a484dc0812eb4542ee718d969513f66?s=128&d=identicon&r=PG", "display_name": "Apocalisp", "link": "https://stackoverflow.com/users/3434/apocalisp"}, "edited": false, "score": 0, "creation_date": 1512525649, "post_id": 47665387, "comment_id": 82290469, "body": "Haha, you used my own words against me! The problem with type-level Booleans (as a substitute for evidence-passing) is that they erase information - namely in this case the type equality - which you then find yourself trying to recover down the line. But here I <i>wanted</i> to erase that information - I needed to synthesise a concrete type in order to influence instance matching. To put it another way, I&#39;m just choosing between two alternatives, not trying to propagate information through the system. If I was choosing between three alternatives I&#39;d use some three-valued type."}, {"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 0, "creation_date": 1512581908, "post_id": 47665387, "comment_id": 82319792, "body": "I&#39;m struggling to reproduce your code, especially the final instance of <code>Has&#39;</code>, After a slew of pragmas, i&#39;m getting &quot;<code>Here</code> is not injective... AllowAmbigousTypes&quot;, and if I do, it can&#39;t see that the type variables carry over from the instance declaration to the <code>has</code> fn. I tried explicit <code>forall</code>, but, no go... any help?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 1, "creation_date": 1512581963, "post_id": 47665387, "comment_id": 82319817, "body": "@Josh.F Did you turn on ScopedTypeVariables?"}, {"owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 0, "creation_date": 1512582318, "post_id": 47665387, "comment_id": 82320020, "body": "huh, I had, but now that I did again, it works fine... Thanks, and if you like, I added the complete program in an edit at the end of your answer (it still needs to be peer reviewed)"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "edited": false, "score": 1, "creation_date": 1512582349, "post_id": 47665387, "comment_id": 82320038, "body": "@Josh.F Thanks! Approved."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 5, "last_activity_date": 1512582339, "last_edit_date": 1512582339, "creation_date": 1512523640, "answer_id": 47665387, "question_id": 47660589, "link": "https://stackoverflow.com/questions/47660589/how-can-i-have-a-constrained-finite-state-machine-in-haskell-idris/47665387#47665387", "title": "How can I have a constrained Finite State Machine in Haskell / Idris?", "body": "<p>Your question is a little vague, but I read it as \"how can I incrementally build a heterogeneous 'context' and create a record once I have values of the correct types in scope?\" Here's how I'd skin this particular cat: rather than threading input and output types through some monadic context, let's just work with ordinary functions. If you want to use clever type-level machinery, you can use it with the values you pass around, rather than structure your program around a particular notion of computation.</p>\n\n<p>Enough waffling. I'm going to represent a heterogeneous context as a nested tuple. I'll use the unit (<code>()</code>) to represent an empty context, and I'll add types to the context by nesting the context into the left element of a new tuple. So, a context containing an <code>Int</code>, a <code>Bool</code> and a <code>Char</code> looks like this:</p>\n\n<pre><code>type IntBoolChar = ((((), Int), Bool), Char)\n</code></pre>\n\n<p>Hopefully you can see how you'd incrementally add ingredients to a salad bowl:</p>\n\n<pre><code>-- we will *not* be using this type like a state monad\naddLettuce :: a -&gt; (a, Lettuce)\naddLettuce = (, Romaine)\n\naddOlives :: a -&gt; (a, Olive)\naddOlives = (, Kalamata)\n\naddCheese :: a -&gt; (a, Cheese)\naddCheese = (, Feta)\n\naddGreekSaladIngredients :: a -&gt; (((a, Lettuce), Olive), Cheese)\n-- yes, i know you also need tomatoes and onions for a Greek salad. i'm trying to keep the example short\naddGreekSaladIngredients = addCheese . addOlives . addLettuce\n</code></pre>\n\n<p><strong>This is not advanced type magic</strong>. It'll work in any language with tuples. I've even designed real-world APIs around this idea in C#, to partially compensate for C#'s lack of currying when you might use <code>Applicative</code> syntax in Haskell. <a href=\"https://github.com/benjamin-hodgson/Pidgin/blob/140357e9f373155fd147158ec051d8a1ff893735/Pidgin/Permutation/PermutationParser.cs\" rel=\"nofollow noreferrer\">Here's an example</a> from my parser combinator library: <a href=\"https://github.com/benjamin-hodgson/Pidgin/blob/140357e9f373155fd147158ec051d8a1ff893735/Pidgin/Permutation/PermutationParser.cs#L17\" rel=\"nofollow noreferrer\">starting with an empty permutation parser</a>, you <a href=\"https://github.com/benjamin-hodgson/Pidgin/blob/140357e9f373155fd147158ec051d8a1ff893735/Pidgin/Permutation/PermutationParser.cs#L77\" rel=\"nofollow noreferrer\"><code>Add</code></a> a number of atomic parsers of different types, and then <a href=\"https://github.com/benjamin-hodgson/Pidgin/blob/140357e9f373155fd147158ec051d8a1ff893735/Pidgin/Permutation/PermutationParser.cs#L60\" rel=\"nofollow noreferrer\"><code>Build</code></a> a parser which runs those parsers in an order-insensitive manner, returning a nested tuple of their results which you can then flatten by hand.</p>\n\n<hr>\n\n<p>The other half of the question was about turning a value of this sort of context into a record.</p>\n\n<pre><code>data Salad = Salad {\n    _lettuce :: Lettuce,\n    _olive :: Olive,\n    _cheese :: Cheese\n}\n</code></pre>\n\n<p>You can generically map nested tuples onto a record like this in an order-insensitive way using the following simple class:</p>\n\n<pre><code>class Has a s where\n    has :: Lens' s a\n\n-- this kind of function can be written generically using TH or Generics\ntoSalad :: (Has Lettuce s, Has Olive s, Has Cheese s) =&gt; s -&gt; Salad\ntoSalad x = Salad (x^.has) (x^.has) (x^.has)\n</code></pre>\n\n<p>(This is a straightforward generalisation of <a href=\"https://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-TH.html#v:makeClassy\" rel=\"nofollow noreferrer\">the <code>HasX</code> classes that <code>lens</code> generates with Template Haskell</a>.)</p>\n\n<p>The only part which requires some type cleverness is automatically instantiating <code>Has</code> for nested tuples. We need to distinguish between two cases: either an item of the type we're looking for is on the right of a pair, or it's somewhere inside the nested tuple on the left of the pair. The problem is that under ordinary circumstances these two cases look the same to the elaborator: instance resolution occurs by a simple-minded process of syntactic type matching; type equalities aren't inspected and backtracking doesn't happen.</p>\n\n<p>The upshot is that we need <a href=\"https://wiki.haskell.org/GHC/AdvancedOverlap\" rel=\"nofollow noreferrer\">The Advanced Overlap Trick</a>. Briefly, the trick uses a closed type family to dispatch a type class based on a type equality. We're choosing between two alternatives, so this is one of the few cases when a type-level boolean is acceptable.</p>\n\n<pre><code>type family Here a as where\n    Here a (_, a) = True\n    Here a (_, b) = False\n\nclass Has' (here :: Bool) a s where\n    has' :: Proxy here -&gt; Lens' s a\n\ninstance Has' True a (as, a) where\n    has' _ = _2\ninstance Has a as =&gt; Has' False a (as, b) where\n    has' _ = _1.has\n\ninstance Has' (Here a (as, b)) a (as, b) =&gt; Has a (as, b) where\n    has = has' (Proxy :: Proxy (Here a (as, b)))\n</code></pre>\n\n<p>This program will stop the search at the first matching type. If you need two different types of lettuce in your salad, you'll have to wrap one in a <code>newtype</code>. In practice, when you combine this disadvantage with the complexity of the overlapping instances, I'm not convinced the <code>Has</code> abstraction pays its way. I'd just flatten the tuple by hand:</p>\n\n<pre><code>toSalad :: (((a, Lettuce), Olive), Cheese) -&gt; Salad\ntoSalad (((_, l), o), c) = Salad l o c\n</code></pre>\n\n<p>You do lose order-insensitivity though.</p>\n\n<p>Here's an example usage:</p>\n\n<pre><code>greekSalad = toSalad $ addGreekSaladIngredients ()\n\nghci&gt; greekSalad\nSalad {_lettuce = Romaine, _olive = Kalamata, _cheese = Feta}  -- after deriving Show\n</code></pre>\n\n<hr>\n\n<p>And here's the completed program</p>\n\n<pre><code>{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE TupleSections #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeInType #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Control.Lens hiding (has, has')\nimport Data.Proxy\n\ndata Lettuce = Romaine deriving (Show)\ndata Olive = Kalamata deriving (Show)\ndata Cheese = Feta deriving (Show)\n\ndata Salad = Salad {\n    _lettuce :: Lettuce,\n    _olive :: Olive,\n    _cheese :: Cheese\n} deriving (Show)\n\n-- we will *not* be using this type like a state monad\naddLettuce :: a -&gt; (a, Lettuce) -- &lt;&lt;&lt; Tuple Sections\naddLettuce = (, Romaine)\n\naddOlives :: a -&gt; (a, Olive)\naddOlives = (, Kalamata)\n\naddCheese :: a -&gt; (a, Cheese)\naddCheese = (, Feta)\n\naddGreekSaladIngredients :: a -&gt; (((a, Lettuce), Olive), Cheese)\naddGreekSaladIngredients = addCheese . addOlives . addLettuce\n\nclass Has a s where\n  has :: Lens' s a\n\ntype family Here a as where\n    Here a (_, a) = True\n    Here a (_, b) = False\n\nclass Has' (here :: Bool) a s where\n    has' :: Proxy here -&gt; Lens' s a\n\ninstance Has' True a (as, a) where\n    has' _ = _2\n\ninstance Has a as =&gt; Has' False a (as, b) where\n    has' _ = _1.has\n\ninstance  Has' (Here a (as, b)) a (as, b) =&gt; Has a (as, b) where -- &lt;&lt;&lt; Undecidable Instances\n    has = has' (Proxy :: Proxy (Here a (as, b)))\n\ntoSalad :: (Has Lettuce s, Has Olive s, Has Cheese s) =&gt; s -&gt; Salad\ntoSalad x = Salad (x ^. has) (x ^. has) (x ^. has)\n\ngreekSalad = toSalad $ addGreekSaladIngredients ()\n\n-- nonSaladsError = toSalad $ (addCheese . addOlives) ()\n</code></pre>\n"}], "owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 934, "favorite_count": 4, "accepted_answer_id": 47665387, "answer_count": 2, "score": 7, "last_activity_date": 1512582339, "creation_date": 1512499360, "last_edit_date": 1512580108, "question_id": 47660589, "link": "https://stackoverflow.com/questions/47660589/how-can-i-have-a-constrained-finite-state-machine-in-haskell-idris", "title": "How can I have a constrained Finite State Machine in Haskell / Idris?", "body": "<p><strong>EDIT:</strong> Users @apocalisp and @BenjaminHodgson left awesome answers below, skip reading most of the question and jump to their answers.</p>\n\n<p><em>TLDR of the Question</em>: How can I go from the first picture, where FSM states combinatorial explode, to the second picture, where you're just required to visit all of them before moving on.</p>\n\n<hr>\n\n<p>I would like to build a <em>Finite State Machine</em> (in Haskell really, but I'm trying Idris first to see if it can guide my Haskell) where there are some interim states that must be visited before a final state can be reached. It'd be great if I could arbitrarily constrain the FSM with predicates on some state.</p>\n\n<p>In the following picture, there's an <code>Initial</code> state, 3 interim states <code>A, B, C</code>, and a <code>Final</code> state. If I'm not mistaken, in a \"normal\" FSM, you will always need <code>n!</code> interim states to represent each combination of possible paths.</p>\n\n<p><a href=\"https://i.stack.imgur.com/r1iBH.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/r1iBH.jpg\" alt=\"A combinatorial Explosion\"></a></p>\n\n<p>This is undesirable.</p>\n\n<p>Instead, using <em>Type Families</em>, and maybe <em>Dependent types</em>, I think it should be possible to have a sort of state that is carried around, and only when it passes certain predicates will you be allowed to travel to the final state. (Does that make it <em>Push Down Automata</em> instead of FSM?)</p>\n\n<p><a href=\"https://i.stack.imgur.com/PlPQt.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PlPQt.jpg\" alt=\"Constrained Finite State Machine\"></a></p>\n\n<p>My code so far (<em>idris</em>), which by analogy, is adding ingredients to make a salad, and the order doesn't matter, but they all need to make it in:</p>\n\n<pre><code>data SaladState = Initial | AddingIngredients | ReadyToEat\n\nrecord SaladBowl where\n       constructor MkSaladBowl\n       lettuce, tomato, cucumber : Bool\n\ndata HasIngredient : (ingredient : SaladBowl -&gt; Bool) -&gt; (bowl : SaladBowl ** ingredient bowl = True) -&gt; Type where\n     Bowl : HasIngredient ingredient bowl\n\ndata HasIngredients : (ingredients : List (SaladBowl -&gt; Bool))\n                     -&gt; (bowl : SaladBowl ** (foldl (&amp;&amp;) True (map (\\i =&gt; i bowl) ingredients) = True)) \n                     -&gt; Type where\n     Bowlx : HasIngredients ingredients bowl\n\ndata SaladAction : (ty : Type) -&gt; SaladState -&gt; (ty -&gt; SaladState) -&gt; Type where\n     GetBowl     : SaladAction SaladBowl Initial (const Initial)\n     AddLettuce  : SaladBowl -&gt; SaladAction (bowl ** HasIngredient lettuce bowl)  st (const AddingIngredients)\n     AddTomato   : SaladBowl -&gt; SaladAction (bowl ** HasIngredient tomato bowl)   st (const AddingIngredients)\n     AddCucumber : SaladBowl -&gt; SaladAction (bowl ** HasIngredient cucumber bowl) st (const AddingIngredients)\n     MixItUp     : SaladBowl -&gt; SaladAction (bowl ** (HasIngredients [lettuce, tomato, cucumber] bowl)) AddingIngredients (const ReadyToEat)\n     Pure : (res : ty) -&gt; SaladAction ty (state_fn res) state_fn\n     (&gt;&gt;=) : SaladAction a state1 state2_fn\n           -&gt; ((res : a) -&gt; SaladAction b (state2_fn res) state3_fn)\n           -&gt; SaladAction b state1 state3_fn\n\nemptyBowl : SaladBowl\nemptyBowl = MkSaladBowl False False False\n\nprepSalad1 : SaladAction SaladBowl Initial (const ReadyToEat)\nprepSalad1 = do\n           (b1 ** _) &lt;- AddTomato emptyBowl\n           (b2 ** _) &lt;- AddLettuce b1\n           (b3 ** _) &lt;- AddCucumber b2\n           MixItUp b3\n</code></pre>\n\n<p>And counter example programs that the compiler should error on:</p>\n\n<pre><code>BAD : SaladAction SaladBowl Initial (const ReadyToEat)\nBAD = do\n           (b1 ** _) &lt;- AddTomato emptyBowl\n           (b2 ** _) &lt;- AddTomato emptyBowl\n           (b3 ** _) &lt;- AddLettuce b2\n           (b4 ** _) &lt;- AddCucumber b3\n           MixItUp b4\n\nBAD' : SaladAction SaladBowl Initial (const ReadyToEat)\nBAD' = do\n           (b1 ** _) &lt;- AddTomato emptyBowl\n           MixItUp b1\n</code></pre>\n\n<p>I eventually want the \"ingredients\" to be Sums instead of Bools (<code>data Lettuce = Romaine | Iceberg | Butterhead</code>), and more robust semantics where I can say things like \"you must first add lettuce, or spinach, but not both\".</p>\n\n<p>Really, I feel so quite thoroughly lost, that I imagine my above code has gone in the completely wrong direction... How can I build this FSM (PDA?) to preclude bad programs? I'd especially like to use Haskell for it, perhaps using <em>Indexed Monads</em>?</p>\n"}, {"tags": ["haskell", "math", "primality-test"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1512491621, "post_id": 47658395, "comment_id": 82275312, "body": "Why not <code>True</code> or <code>False</code>? I do not really get why you encoding things as <code>Int</code>s, if these are truth values"}, {"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 1, "creation_date": 1512491666, "post_id": 47658395, "comment_id": 82275336, "body": "Or if you need to return the number, Just n and Nothing"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1512491732, "post_id": 47658395, "comment_id": 82275381, "body": "<code>list</code> is somewhat pointless; you can just write <code>fermatPT n = fermatPT&#39; n [1..n-1]</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1512492417, "post_id": 47658395, "comment_id": 82275816, "body": "If it always return -1, then there is probably something wrong with <code>gc</code> that causes it to never return 1."}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 9057412, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wwEH9_z4Qq0/AAAAAAAAAAI/AAAAAAAAJ_c/HeRmDOhuvX4/photo.jpg?sz=128", "display_name": "Eros Fabrici", "link": "https://stackoverflow.com/users/9057412/eros-fabrici"}, "edited": false, "score": 0, "creation_date": 1512559118, "post_id": 47658715, "comment_id": 82304927, "body": "I know it should return a bool, but the second part of the exercise is to return the lower fermat witness if n is not prime."}, {"owner": {"reputation": 5, "user_id": 9057412, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wwEH9_z4Qq0/AAAAAAAAAAI/AAAAAAAAJ_c/HeRmDOhuvX4/photo.jpg?sz=128", "display_name": "Eros Fabrici", "link": "https://stackoverflow.com/users/9057412/eros-fabrici"}, "edited": false, "score": 0, "creation_date": 1512562079, "post_id": 47658715, "comment_id": 82306648, "body": "And still this solution doesn&#39;t work unfortunately, fermatPT 53 return false, should return True"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 5, "user_id": 9057412, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wwEH9_z4Qq0/AAAAAAAAAAI/AAAAAAAAJ_c/HeRmDOhuvX4/photo.jpg?sz=128", "display_name": "Eros Fabrici", "link": "https://stackoverflow.com/users/9057412/eros-fabrici"}, "edited": false, "score": 0, "creation_date": 1512566690, "post_id": 47658715, "comment_id": 82309528, "body": "You are running into overflow errors with the naive computation of <code>a^(n-1) mod n</code>; changing the type signature to <code>Integer -&gt; Bool</code> seems to fix it. (For example, <code>52 ^ 52 :: Int == 0</code>, while <code>52 ^ 52 :: Integer == 170676555274132171974277914691501574771358362295975962674353&zwnj;&#8203;04573794004185519123&zwnj;&#8203;2907575296</code>)."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1512567920, "last_edit_date": 1512567920, "creation_date": 1512492736, "answer_id": 47658715, "question_id": 47658395, "link": "https://stackoverflow.com/questions/47658395/fermat-primality-test-haskell/47658715#47658715", "title": "Fermat Primality Test Haskell", "body": "<p>Your function should return a boolean indicating if the given number is a prime. If you do that, you can use the <code>all</code> function to define this simply as</p>\n\n<pre><code>fermatPT :: Integer -&gt; Bool\nfermatPT n = all (fermatTest n) (filter (\\a -&gt; gcd n a == 1) [1..n-1])\n             where fermatTest n a = mod (a^(n-1)) n == 1\n</code></pre>\n\n<p><code>gcd</code> is defined in the Prelude.</p>\n\n<p><code>all</code> avoids the explicit recursion that requires you to apply the test to one element of <code>[1..n-1]</code> at a time; its definition is effectively</p>\n\n<pre><code>all _ [] = True\nall p (x:xs) = p x &amp;&amp; all p xs\n</code></pre>\n\n<hr>\n\n<p>Note that <code>mod (a ^ (n - 1)) n</code> is inefficient, since it may require computing an absurdly large number before ultimately reducing it to the range <code>[0..n-1]</code>. Instead, take advantage of the fact that <code>ab mod n == (a mod n * b mod n) mod n</code>, and reduce the value after each multiplication. One way to implement this (not the fastest, but it's simple):</p>\n\n<pre><code>modN :: Integer -&gt; Integer -&gt; Integer -&gt; Integer\nmodN a 0 _ = 1\nmodN a b n = ((a `mod` n) * (modN a (b - 1) n)) `mod` n\n</code></pre>\n\n<p>Then use</p>\n\n<pre><code>fermatTest n a = modN a (n-1) n == 1\n</code></pre>\n\n<p>Note that you could use this (with <code>Int</code> instead of <code>Integer</code>) to correctly implement <code>fermatPT :: Int -&gt; Bool</code>; although the input would still be restricted to smaller integers, it won't suffer from overflow.</p>\n"}], "owner": {"reputation": 5, "user_id": 9057412, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wwEH9_z4Qq0/AAAAAAAAAAI/AAAAAAAAJ_c/HeRmDOhuvX4/photo.jpg?sz=128", "display_name": "Eros Fabrici", "link": "https://stackoverflow.com/users/9057412/eros-fabrici"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1512567920, "creation_date": 1512491584, "last_edit_date": 1512491868, "question_id": 47658395, "link": "https://stackoverflow.com/questions/47658395/fermat-primality-test-haskell", "title": "Fermat Primality Test Haskell", "body": "<p>I have implemented the following two functions for establishing if n is a fermat prime number (will return n if its true, -1 if not), but it returns always -1, can't figure out why (gc is a funct taht calculates gcd)</p>\n\n<pre><code>fermatPT :: Int -&gt; Int\nfermatPT n = fermatPT' n list\n  where\n    list = [a | a &lt;- [1..n-1]]\n\n-- | heper function\nfermatPT' :: Int -&gt; [Int] -&gt; Int\nfermatPT' n l      | gc (n, head l) == 1 &amp;&amp; fermatTest n (head l) = fermatPT' n (tail l)\n                   | null l                                       = n\n                   | otherwise                                    = -1\n                where\n                  fermatTest n a = mod (a^(n-1)) n == 1\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1512489767, "post_id": 47657786, "comment_id": 82274082, "body": "Please include error any error messages you get in your question.  (In this case, I&#39;m pretty sure the error message tells you <i>exactly</i> how to fix it.)"}], "answers": [{"comments": [{"owner": {"reputation": 345, "user_id": 7940179, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh6.googleusercontent.com/-7SGHx7vKvMw/AAAAAAAAAAI/AAAAAAAAACM/Bu7lIb3oiTA/photo.jpg?sz=128", "display_name": "EmberTraveller", "link": "https://stackoverflow.com/users/7940179/embertraveller"}, "edited": false, "score": 0, "creation_date": 1512490295, "post_id": 47657934, "comment_id": 82274425, "body": "Thank you. Yes, i cannot assume that, but is there a way to indicate that a is always a Bool in class instance?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1512490438, "post_id": 47657934, "comment_id": 82274531, "body": "<code>()</code> isn&#39;t really an empty tuple."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 8, "last_activity_date": 1512490783, "last_edit_date": 1512490783, "creation_date": 1512490118, "answer_id": 47657934, "question_id": 47657786, "link": "https://stackoverflow.com/questions/47657786/class-instance-of-two-variables/47657934#47657934", "title": "Class instance of two variables", "body": "<p>You wrote an instance where you write that for a tuple <code>(a, b)</code>, the tuple is <code>Printable</code> in case the items <code>a</code> and <code>b</code> are <code>Printable</code>. But that does <em>not</em> mean that <code>a</code> or <code>b</code> are <code>Bool</code>s, or units.</p>\n\n<p>You may think that - like in many languages - the <code>(==)</code> operator works on any two types, but in Haskell <code>(==)</code> has type <code>(==) :: Eq a =&gt; a -&gt; a -&gt; Bool</code>, so it is a function where the left and the right operand have the <em>same</em> type. So we can not use <code>x == True</code>, unless <code>x</code> is a <code>Bool</code>.</p>\n\n<p>We do not need these guards. What we need to do is <em>call</em> the <code>toString</code> function of the operands, so:</p>\n\n<pre><code>instance (Printable a, Printable b) =&gt; Printable (a, b) where\n    toString <b>(x,y)</b> = \"(\"<b> ++ toString x ++</b> \",\" ++ <b>toString y ++</b> \")\"</code></pre>\n\n<p>We can also replace <code>[x] ++</code> with <code>x : ...</code> so we can rewrite it to:</p>\n\n<pre><code>instance (Printable a, Printable b) =&gt; Printable (a, b) where\n    toString (x,y) = <b>'(' : </b> toString x ++ <b>',' :</b> toString y ++<b> \")\"</b></code></pre>\n\n<p><strong>EDIT</strong>: in case you want <code>a</code> to be always a <code>Bool</code>, you can write:</p>\n\n<pre><code>instance <b>Printable b</b> =&gt; Printable (<b>Bool</b>, b) where\n    toString (x,y) = '(' :  toString x ++ ',' : toString y ++ \")\"</code></pre>\n\n<p>You can of course now add guards, pattern matching, or some other method to discriminate between <code>x == True</code> and <code>x == False</code>, but I advice you not to do this, since this violates the DRY principle: <strong>D</strong>on't <strong>R</strong>epeat <strong>Y</strong>ourself.</p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1512490203, "creation_date": 1512490203, "answer_id": 47657968, "question_id": 47657786, "link": "https://stackoverflow.com/questions/47657786/class-instance-of-two-variables/47657968#47657968", "title": "Class instance of two variables", "body": "<p>Just because <code>a</code> has a <code>Printable</code> instance doesn't mean you can assume <code>a ~ Bool</code>, so <code>x == True</code> fails.</p>\n\n<p>You should be using pattern matching instead of equality, though, which would sidestep the issue.</p>\n\n<pre><code>class Printable a where \n    toString :: a -&gt; String\n\ninstance Printable Bool where\n    toString True = \"true\"\n    toString False = \"false\"\n\ninstance Printable () where\n    toString () = \"unit type\"\n</code></pre>\n\n<p>Your tuple instance should then make use of the fact that <code>a</code> and <code>b</code> are both <code>Printable</code>. You only need to pattern-match on the constructor, not the individual components.</p>\n\n<pre><code>instance (Printable a, Printable b) =&gt; Printable (a, b) where\n    toString (x, y)  = \"(\" ++ toString x ++ \",\" ++ toString y ++ \")\"\n</code></pre>\n"}], "owner": {"reputation": 345, "user_id": 7940179, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh6.googleusercontent.com/-7SGHx7vKvMw/AAAAAAAAAAI/AAAAAAAAACM/Bu7lIb3oiTA/photo.jpg?sz=128", "display_name": "EmberTraveller", "link": "https://stackoverflow.com/users/7940179/embertraveller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 47657934, "answer_count": 2, "score": 2, "last_activity_date": 1512491054, "creation_date": 1512489640, "last_edit_date": 1512491054, "question_id": 47657786, "link": "https://stackoverflow.com/questions/47657786/class-instance-of-two-variables", "title": "Class instance of two variables", "body": "<p>I'm very new to Haskell and created this class </p>\n\n<pre><code>class Printable a where \n    toString :: a -&gt; String\n</code></pre>\n\n<p>And two of its instances</p>\n\n<pre><code>instance Printable Bool where\n    toString x | x == True = \"true\"\n               | x == False  = \"false\" \n\ninstance Printable () where\n    toString x = \"unit type\"\n</code></pre>\n\n<p>They work just fine, and now I want to create an instance that would take two parameters, but I'm having troubles. What I created so far is </p>\n\n<pre><code>instance (Printable a, Printable b) =&gt; Printable (a, b) where\n    toString x | fst x == True = \"(true,unit type)\"\n</code></pre>\n\n<p>But now I get the error </p>\n\n<blockquote>\n  <p>Couldn't match expected type \u2018a\u2019 with actual type \u2018Bool\u2019</p>\n</blockquote>\n\n<p>which is reasonable, but when I replace <code>a</code> with <code>Bool</code> I also get an error. How can I make it work in the first place, and can I restrict the types for <code>a</code> and <code>b</code> - for example, what if I want <code>a</code> to always be <code>Bool</code> and <code>b</code> to always be ()?</p>\n"}, {"tags": ["haskell", "type-families", "ghc-generics"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1512478782, "post_id": 47653880, "comment_id": 82266521, "body": "What is <code>Choose</code>?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1512478905, "post_id": 47653880, "comment_id": 82266626, "body": "I added a description of what <code>Choose</code> could be."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1512479452, "creation_date": 1512479452, "answer_id": 47654489, "question_id": 47653880, "link": "https://stackoverflow.com/questions/47653880/using-type-families-and-generics-to-find-an-id-value/47654489#47654489", "title": "Using type families and Generics to find an Id value", "body": "<p>You're pretty close to making <code>Choose</code> typecheck. <code>L1</code> and <code>R1</code> are constructors of <code>(:+:)</code>, not <code>Crumbs</code>. There's also a type <code>GHC.Generics.R :: *</code> which hides the <code>R</code> constructor from <code>Crumbs</code> at the type level, but you can use <code>'R</code> to disambiguate (singly-quoted names are constructors, doubly-quoted are type constructors).</p>\n\n<p>It's also good practice to annotate kinds of types, much like we annotate types of toplevel functions.</p>\n\n<pre><code>type family Choose (e :: Res) (f :: Res) :: Res where\n  Choose (Found a) b = Found ('L a)\n  Choose a (Found b) = Found ('R b)\n  Choose NotFound NotFound = NotFound  -- I'm not a fan of overlapping families\n</code></pre>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 1, "accepted_answer_id": 47654489, "answer_count": 1, "score": 4, "last_activity_date": 1512479452, "creation_date": 1512477634, "last_edit_date": 1512478882, "question_id": 47653880, "link": "https://stackoverflow.com/questions/47653880/using-type-families-and-generics-to-find-an-id-value", "title": "Using type families and Generics to find an Id value", "body": "<p>This question is related to <a href=\"https://stackoverflow.com/questions/47453657/extracting-an-id-with-ghc-generics\">this one</a>, where I wanted to avoid the boilerplate of extracting an <code>Id</code> value from a data structure, but in a type-safe manner.</p>\n\n<p>I'll repeat the relevant details of the problem here: suppose you have a type <code>Id</code>:</p>\n\n<pre><code>newtype Id = Id { _id :: Int }\n</code></pre>\n\n<p>And you want to define a function <code>getId</code> that extracts this <code>Id</code> from any structure that contains at least one <code>Id</code> value:</p>\n\n<pre><code>class Identifiable e where\n    getId :: e -&gt; Id\n</code></pre>\n\n<p>Now the problem is how to define such a class in a <strong>type-safe</strong> manner, while at the same time <strong>avoiding the boilerplate</strong> using Generics.</p>\n\n<p>In my <a href=\"https://stackoverflow.com/questions/47453657/extracting-an-id-with-ghc-generics?noredirect=1#comment82000025_47453657\">previous question</a> I was pointed to type families, and in particular to the ideas <a href=\"http://mpickering.github.io/posts/2014-12-20-closed-type-family-data-types.html\" rel=\"nofollow noreferrer\">described in this blog post</a>. As far as I understand the idea is to define a type-class <code>MkIdentifiable</code> such that:</p>\n\n<pre><code>class MakeIdentifiable (res :: Res) e where\n    mkGetId :: Proxy res -&gt; e -&gt; Id\n</code></pre>\n\n<p>Where a value is of type <code>Res</code> only if there is at least one <code>Id</code> value that is nested inside of it:</p>\n\n<pre><code>data Crumbs = Here | L Crumbs | R Crumbs\ndata Res = Found Crumbs | NotFound\n</code></pre>\n\n<p>Then, it seems, one could define:</p>\n\n<pre><code>instance MakeIdentifiable (Found e) e =&gt; Identifiable e where\n    getId = mkGetId (Proxy :: Proxy (Found e))\n</code></pre>\n\n<p>Now the question is how to define a type family for <code>Res</code> that is associated to the types of GHC.Generics (<code>U1</code>, <code>K1</code>, <code>:*:</code>, <code>:+:</code>).</p>\n\n<p>I've tried the following:</p>\n\n<pre><code>type family HasId e :: Res where\n    HasId Id = Found Here\n    HasId ((l :+: r) p) = Choose (HasId (l p)) (HasId (r p))\n</code></pre>\n\n<p>Where <code>Choose</code> would be something like what is defined in the aforementioned blog post:</p>\n\n<pre><code>type family Choose e f :: Res where\n    Choose (Found a) b = Found (L1 a)\n    Choose a (Found b) = Found (R1 b)\n    Choose a b = NotFound\n</code></pre>\n\n<p>But this won't compile as <code>HasId (l p)</code> has kind <code>Res</code> and a type is expected instead. </p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1512480278, "post_id": 47653454, "comment_id": 82267580, "body": "How are you running your program? How long does it take for the stackoverflow to occur?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1512480730, "post_id": 47653454, "comment_id": 82267845, "body": "FWIW, I did this exercise earlier today as well, and the second puzzle did take long enough to run that I went and brushed my teeth waiting for it to finish - which it did, 26,948,068 steps later! Here&#39;s my code, in case anyone&#39;s interested: <a href=\"https://github.com/ploeh/advent-of-code-2017/blob/master/Day05/Solution.hs\" rel=\"nofollow noreferrer\">github.com/ploeh/advent-of-code-2017/blob/master/Day05/&hellip;</a>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1512481897, "post_id": 47653454, "comment_id": 82268571, "body": "I can&#39;t reproduce the stack overflow, but there is a space leak in the first argument of <code>takeStep&#39;</code> which is fixed either by forcing it or compiling with optimizations."}, {"owner": {"reputation": 177, "user_id": 3183436, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3f9e2ebb97ecff328a4fe064c18a3dcb?s=128&d=identicon&r=PG&f=1", "display_name": "Mauro Palsgraaf", "link": "https://stackoverflow.com/users/3183436/mauro-palsgraaf"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1512482060, "post_id": 47653454, "comment_id": 82268681, "body": "@Li-yaoXia I run it just in the repl by first loading it (:l adventofcode5.hs) and then running just main2."}, {"owner": {"reputation": 177, "user_id": 3183436, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3f9e2ebb97ecff328a4fe064c18a3dcb?s=128&d=identicon&r=PG&f=1", "display_name": "Mauro Palsgraaf", "link": "https://stackoverflow.com/users/3183436/mauro-palsgraaf"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1512482194, "post_id": 47653454, "comment_id": 82268785, "body": "@Li-yaoXia How do you compile with optimizations? I get the stackoverflow after running for a long time (15 minutes maybe). My computer slept in between but that shouldn&#39;t be a problem right"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1512512194, "post_id": 47653454, "comment_id": 82286410, "body": "You can also enable the <code>BangPatterns</code> extension and then write either <code>takeStep&#39; !count ...</code> or <code>let !newCount = ...</code>. This avoids the clutter of <code>seq</code>."}], "answers": [{"comments": [{"owner": {"reputation": 177, "user_id": 3183436, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3f9e2ebb97ecff328a4fe064c18a3dcb?s=128&d=identicon&r=PG&f=1", "display_name": "Mauro Palsgraaf", "link": "https://stackoverflow.com/users/3183436/mauro-palsgraaf"}, "edited": false, "score": 0, "creation_date": 1512484179, "post_id": 47655710, "comment_id": 82270059, "body": "This indeed seemed to be the problem and thank you for explaining how this could be fixed!"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 5, "last_activity_date": 1512485030, "last_edit_date": 1512485030, "creation_date": 1512483260, "answer_id": 47655710, "question_id": 47653454, "link": "https://stackoverflow.com/questions/47653454/possible-tail-recursive-solution-in-haskell-producing-stack-overflow/47655710#47655710", "title": "Possible tail recursive solution in haskell producing stack overflow", "body": "<p>There is a space leak in the first argument of <code>takeStep'</code>, because it builds a thunk <code>(... ((0 + 1) + 1) ...) + 1</code> instead of just evaluating the integer.</p>\n\n<p>The stack may explode when that thunk gets evaluated.</p>\n\n<ul>\n<li>Use <code>seq</code> to force <code>count</code> before continuing, e.g., <code>count `seq` otherwise</code> in the guard;</li>\n<li>or compile with optimizations.</li>\n</ul>\n\n<p><code>ghci</code> is interpreting it, not compiling it. In particular, it doesn't perform the strictness analysis necessary to automatically fix that leak.</p>\n\n<p>You can run this command to compile with optimizations (<code>-O</code>)</p>\n\n<pre><code>ghc -O -main-is AdventOfCode5.main2 AdventOfCode5.hs\n</code></pre>\n\n<p>(although even without optimizations compilation seems to reduce space usage enough to succeed.)</p>\n"}], "owner": {"reputation": 177, "user_id": 3183436, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3f9e2ebb97ecff328a4fe064c18a3dcb?s=128&d=identicon&r=PG&f=1", "display_name": "Mauro Palsgraaf", "link": "https://stackoverflow.com/users/3183436/mauro-palsgraaf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1512485030, "creation_date": 1512476284, "question_id": 47653454, "link": "https://stackoverflow.com/questions/47653454/possible-tail-recursive-solution-in-haskell-producing-stack-overflow", "title": "Possible tail recursive solution in haskell producing stack overflow", "body": "<p>I've been trying to solve the adventofcode day 5 question 2 (<a href=\"https://adventofcode.com/2017/day/5\" rel=\"nofollow noreferrer\">https://adventofcode.com/2017/day/5</a>). It differs from the first question where if the item is bigger of equal to 3, it's decreased instead of increased by 1.</p>\n\n<p>When running the implementation with the test data, it produces the correct outcome, so it seems that the implementation is perfect. Also, the recursive call looks to be in tail position, but it's still producing a stackoverflow exception.</p>\n\n<p>The code looks like this</p>\n\n<pre><code>module AdventOfCode5 where\n\ntype Instruction = Int\ntype Position = Int\n\nmain :: IO ()\nmain = do\n  input &lt;- readFile \"day5input.txt\"\n  let instructions = fmap (read :: String -&gt; Instruction) $ lines input\n  _ &lt;- putStrLn $ show $ computeResult (Prelude.length instructions) 0 (+1) $ instructions\n  return ()\n\nmain2 :: IO ()\nmain2 = do\n  input &lt;- readFile \"day5input.txt\"\n  let instructions = fmap (read :: String -&gt; Instruction) $ lines input\n  _ &lt;- putStrLn $ show $ computeResult (Prelude.length instructions) 0 decAbove3AndIncBelow3 instructions\n  return ()\n\ndecAbove3AndIncBelow3 :: Int -&gt; Int\ndecAbove3AndIncBelow3 x\n  | x &gt;= 3 = x - 1\n  | otherwise = x + 1\n\ncomputeResult :: Int -&gt; Position -&gt; (Int -&gt; Int) -&gt; [Instruction] -&gt; Int\ncomputeResult = takeStep' 0\n  where takeStep' :: Int -&gt; Int -&gt; Position -&gt; (Int -&gt; Int) -&gt; [Instruction] -&gt; Int\n        takeStep' count max pos changeInteger instructions\n          | pos &gt;= max = count\n          | otherwise =\n              let\n                elementAtPos = instructions!!pos\n                newCount = count + 1\n                newPos = pos + elementAtPos\n                newInstructions = (take pos instructions) ++ ([(changeInteger elementAtPos)]) ++ (drop (pos + 1)) instructions\n              in\n                takeStep' newCount max newPos changeInteger newInstructions\n</code></pre>\n\n<p>The idea of the implementation is that you hold a counter and increment the counter for every iteration, in combination with altering the list of instructions with the updated version (where the Int -> Int is the function that knows how to update). You got a position where to look at and the recursion stops as soon as the position is larger than the list size (which i passed as input but could also be derived from the list of instructions).</p>\n\n<p>Can anybody explain to me why this one is producing a stackoverflow?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 3, "creation_date": 1512473085, "post_id": 47651943, "comment_id": 82262948, "body": "Could you add a minimal, complete example of the kind of code you want to be able to write? It\u2019ll help illustrate the actual problem you\u2019re trying to solve."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1512474942, "post_id": 47651943, "comment_id": 82264168, "body": "<a href=\"https://stackoverflow.com/questions/47577470/read-of-types-sum\">Begin of journey</a>. This is a tags combining from different types w/ generic read/match/show. All is good and task is solved but I hit that I need to distinguish cases when tag matched tags like [tag1,tag2] and [tag1,anyTag] (this is pseudo-code) - to know best matching case (more specialized/general case). So, I need to check that tag type (<code>a|||b</code>) keeps something which is <code>==anyTag</code>"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1512489301, "creation_date": 1512489301, "answer_id": 47657668, "question_id": 47651943, "link": "https://stackoverflow.com/questions/47651943/how-to-match-such-type/47657668#47657668", "title": "How to match such type", "body": "<p>It won't get much better than this:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\nclass IsAnyTag a where\n    isAnyTag :: a -&gt; Bool\n    default isAnyTag :: (Eq a, IsTag a) =&gt; a -&gt; Bool\n    isAnyTag = (anyTag ==)\n\ninstance (IsAnyTag a, IsAnyTag b) =&gt; IsAnyTag (a ||| b) where\n    isAnyTag (A a) = isAnyTag a\n    isAnyTag (B b) = isAnyTag b\n\n-- and one more line of `instance IsAnyTag X` for each `X` that\n-- is an instance of `IsTag`\n</code></pre>\n\n<p>The main drawback here is that this requires that the types on both sides of the <code>|||</code> will have to be <code>IsAnyTag</code> instances, even though you are testing only one side. Them's the breaks with static type checking.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 47657668, "answer_count": 1, "score": 0, "last_activity_date": 1512489301, "creation_date": 1512471519, "question_id": 47651943, "link": "https://stackoverflow.com/questions/47651943/how-to-match-such-type", "title": "How to match such type", "body": "<p>I have:</p>\n\n<pre><code>infixr 9 |||\ndata a ||| b = A a|B b deriving (Eq, Data, Show)\n\nclass IsTag a where\n  anyTag :: a\n</code></pre>\n\n<p>and I keep in this <code>a|||b</code> some values, which are instances of <code>IsTag</code>, for example: <code>A (B (A x))</code> - the deep of nesting can be any, sure. And I want to write function which detects that <code>x</code> is equal to <code>anyTag</code>, so it takes <code>a|||b</code> and returns <code>Bool</code> - is underlying value (<code>x</code> in the example) equal to <code>anyTag</code> of x's instance or not. How to write such function? I can't do pattern-matching due to errors like \"infinite type\", etc. I added <code>deriving Data</code> to <code>a|||b</code> and to x's type in the hope that it will be possible to use something from <code>Data</code>, but I can't understand how to fold/traverse via such recursive type.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1512467797, "post_id": 47650421, "comment_id": 82259498, "body": "Did you test <code>evenList</code>? I&#39;d suggest you try <code>evenList [1,3]</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1512468261, "post_id": 47650421, "comment_id": 82259777, "body": "Integral and Foldable are <i>type classes</i>, google this term. Basically <code>Foldable t</code> means &quot;t is a list-like type&quot;."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1512468801, "post_id": 47650421, "comment_id": 82260130, "body": "Type classes are how overloading is done in Haskell. A type implements a type class by implementing some functions. For example, the type of <code>(+)</code> is <code>Num a =&gt; a -&gt; a -&gt; a</code> so if I define a type <code>Foo</code> which I want to be able to add then I need to define <code>(+) :: Foo -&gt; Foo -&gt; Foo</code> which I can only do by instantiating the <code>Num</code> class with <code>Foo</code>"}, {"owner": {"reputation": 61, "user_id": 8821089, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/5400cede19ef593f6ec39cdb0b9ff450?s=128&d=identicon&r=PG&f=1", "display_name": "Mostafa Ibrahim", "link": "https://stackoverflow.com/users/8821089/mostafa-ibrahim"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512473500, "post_id": 47650421, "comment_id": 82263217, "body": "@chi ahahahha thanks for the heads up I fixed it evenList :: [Int] -&gt; Bool evenList xs =  foldr (&amp;&amp;) (True) (map (even) xs)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512479882, "post_id": 47650421, "comment_id": 82267285, "body": "@MostafaIbrahim Much better ;-)"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1512470280, "last_edit_date": 1512470280, "creation_date": 1512469514, "answer_id": 47651294, "question_id": 47650421, "link": "https://stackoverflow.com/questions/47650421/haskell-type-signatures/47651294#47651294", "title": "Haskell Type Signatures", "body": "<p>Those are <em>constraints to a polymorphic type</em>.</p>\n\n<p>Haskell, despite being statically typed, makes it very easy to write function that can work with different types, through a system called <a href=\"https://en.wikipedia.org/wiki/Parametric_polymorphism\" rel=\"nofollow noreferrer\">parametric polymorphism</a>. I'll first give all your functions concrete (monomorphic) signatures instead:</p>\n\n<pre><code>mult :: [Integer] -&gt; Integer\nmult  = foldl' (*) 1  -- foldl' is better for performance/memory than foldr\n\nposList :: [Integer] -&gt; [Integer]\nposList = filter (&gt;0) \n\ntrueList :: [Bool] -&gt; Bool\ntrueList  =  foldl' (&amp;&amp;) True\n\nevenList :: [Integer] -&gt; Bool\nevenList x = foldl' (+) 2 x `mod` 2 == 0\n            -- `if True then True else False` is tautological\n</code></pre>\n\n<p>All of these signatures work (both with the improved implementation and with your original ones).</p>\n\n<p>But they <em>only</em> work with lists of <code>Integer</code>. That's not always sufficiently general; for instance, it's perfectly reasonable to compute the product of a list of fractional numbers. But with the monomorphic signature, <code>mult [1.5, 2.4, 20]</code> does not work: these numbers aren't compatible with <code>Integer</code>. You don't want to restrict the function to integers, you just want it to work with any number type and always get a result of the same type as the elements. I.e., you basically want the signature</p>\n\n<pre><code>mult :: \u2200 a . [a] -&gt; a\n</code></pre>\n\n<p>...to be read \"for all types <code>a</code>, the function <code>mult</code> takes a list whose elements have type <code>a</code>, and gives a single <code>a</code>-value as the result. The <code>\u2200</code> is implicit in Haskell when you have such type variables, i.e. you could as well make it</p>\n\n<pre><code>mult :: [a] -&gt; a\n</code></pre>\n\n<p>That doesn't work yet though, because the function must be able to multiply elements. But that is not possible for <em>all</em> types, only for <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#t:Num\" rel=\"nofollow noreferrer\">number types</a>. Hence you add the constraint</p>\n\n<pre><code>mult :: Num a =&gt; [a] -&gt; a\n</code></pre>\n\n<p>For <code>posList</code> it's much the same thing: the signature is essentially</p>\n\n<pre><code>posList :: [a] -&gt; [a]\n</code></pre>\n\n<p>but you also need to be able to compare (<code>Ord</code>) the elements with <code>0</code> (<code>Num</code>). Thus the constraint</p>\n\n<pre><code>posList :: (Num a, Ord a) =&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>In case of <code>evenList</code>, the numerical operations are <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:-43-\" rel=\"nofollow noreferrer\"><code>(+)</code></a>, <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Eq.html#v:-61--61-\" rel=\"nofollow noreferrer\"><code>(==)</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:mod\" rel=\"nofollow noreferrer\"><code>mod</code></a>. So in principle we need <code>Num</code>, <code>Eq</code> and <code>Integral</code>, but <code>Integral</code> has <code>Num</code> and <code>Eq</code> as <em>superclasses</em> anyway, so that alone is sufficient:</p>\n\n<pre><code>evenList :: Integral a =&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>...which is not the most general form yet, though. You reduce that list with a fold, but lists aren't the only thing that can be folded, for instance you can also fold arrays, maps and <code>Maybe</code> values. The type class for all containers that can be folded is called, you won't guess it, <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Foldable.html\" rel=\"nofollow noreferrer\"><code>Foldable</code></a>. So we end up with</p>\n\n<pre><code>evenList :: (Integral a, Foldable t) =&gt; t a -&gt; Bool\n</code></pre>\n\n<p>You could apply the same generalisation to <code>mult</code> and <code>trueList</code>:</p>\n\n<pre><code>mult :: (Num a, Foldable t) =&gt; t a -&gt; a\ntrueList :: Foldable t =&gt; t Bool -&gt; Bool\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 8821089, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/5400cede19ef593f6ec39cdb0b9ff450?s=128&d=identicon&r=PG&f=1", "display_name": "Mostafa Ibrahim", "link": "https://stackoverflow.com/users/8821089/mostafa-ibrahim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1512470280, "creation_date": 1512467094, "last_edit_date": 1512467897, "question_id": 47650421, "link": "https://stackoverflow.com/questions/47650421/haskell-type-signatures", "title": "Haskell Type Signatures", "body": "<p>I am new to haskell and I read some stuff about this thing called type signatures, but there are a few things that I dont understand.</p>\n\n<p>Here is the the code am looking at:</p>\n\n<pre><code>--mult applies product\nmult :: Num a =&gt; [a] -&gt; a\nmult  = foldr (*) 1 \n\n--posList filters positive numbers out\nposList :: (Ord a, Num a) =&gt; [a] -&gt; [a]\nposList = filter (&gt;0) \n\n--trueList determines whether all of the members of a list are T or not\ntrueList :: [Bool] -&gt; Bool\ntrueList  =  foldr(&amp;&amp;) True \n\n--evenList determines where all of the members of a list are even or not\nevenList :: (Integral a, Foldable t) =&gt; t a -&gt; Bool\nevenList x = if (((foldr (+) 2 x ) `mod` 2) == 0) then True else False\n</code></pre>\n\n<p>So, I know you can do those functions easier in a different way, but I had assignments to use higher order functions <code>map</code>, <code>filter</code> and <code>foldr</code>, so I had to do them that way. Anyway, I understand how the functions work since I am the one who wrote them , what I dont understand is those terms <code>Integral</code>, <code>Foldable</code>, what do they mean? and what are they called in terms of Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1512465824, "post_id": 47649657, "comment_id": 82258276, "body": "What are you really trying to do? You&#39;re putting <code>&quot;x&quot;</code> and <code>&quot;y&quot;</code> into a <code>Set</code>, then filtering on e.g. <code>&quot;x&quot;</code>. If it&#39;s there, the return value will <i>also</i> be <code>&quot;x&quot;</code>. Basically, then, can&#39;t you use <code>member</code> to query whether or not <code>&quot;x&quot;</code> is in the <code>Set</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 5, "creation_date": 1512466081, "post_id": 47650057, "comment_id": 82258428, "body": "or <code>find (== &quot;x&quot;) setWithTwoElems</code> ;)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1512498560, "post_id": 47650057, "comment_id": 82279631, "body": "...but if you are using it with <code>(==)</code> predicates, you <i>probably</i> just want <code>member :: Ord a =&gt; a -&gt; Set a -&gt; Bool</code>, which will need only O(log n) comparisons instead of O(n) equality checks. (Yes, I know it is possible to construct pathological examples where this is not the right function, but we are certainly not in those cases if we&#39;re dealing with <code>Set String</code>s.)"}], "tags": [], "owner": {"reputation": 4190, "user_id": 2110623, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5f1b5f95d5b3bb75901fb546cd1c52d?s=128&d=identicon&r=PG", "display_name": "aochagavia", "link": "https://stackoverflow.com/users/2110623/aochagavia"}, "is_accepted": true, "score": 5, "last_activity_date": 1512465893, "creation_date": 1512465893, "answer_id": 47650057, "question_id": 47649657, "link": "https://stackoverflow.com/questions/47649657/get-first-element-from-a-set-if-it-exists-in-haskell/47650057#47650057", "title": "Get first element from a Set, if it exists, in Haskell", "body": "<p>The function you are looking for is called <code>find</code> and comes from <code>Data.Foldable</code>.</p>\n\n<p>From the <a href=\"https://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Foldable.html#v:find\" rel=\"noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>The find function takes a predicate and a structure and returns the leftmost element of the structure matching the predicate, or Nothing if there is no such element.</p>\n</blockquote>\n\n<p>Therefore, you can use <code>find (\\v -&gt; v == \"x\") setWithTwoElems</code></p>\n"}], "owner": {"reputation": 28942, "user_id": 398441, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/a8950160c2b3d7d0bf948d8c1f937e7f?s=128&d=identicon&r=PG", "display_name": "Johan", "link": "https://stackoverflow.com/users/398441/johan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1112, "favorite_count": 0, "accepted_answer_id": 47650057, "answer_count": 1, "score": 2, "last_activity_date": 1512465893, "creation_date": 1512464524, "question_id": 47649657, "link": "https://stackoverflow.com/questions/47649657/get-first-element-from-a-set-if-it-exists-in-haskell", "title": "Get first element from a Set, if it exists, in Haskell", "body": "<p>I'm using the <a href=\"https://hackage.haskell.org/package/containers-0.5.7.1/docs/Data-Set.html\" rel=\"nofollow noreferrer\">containers</a> library and I'm trying to extract the first element out of a set using this approach in the REPL:</p>\n\n<pre><code>let initialSet = insert \"x\" empty\nlet setWithTwoElems = insert \"y\" initialSet\nelemAt 0 (filter (\\v -&gt; v == \"x\") setWithTwoElems)\n</code></pre>\n\n<p>While this works it's not safe if the predicate passed to filter doesn't match any of the elements in the Set. If I do for example:</p>\n\n<pre><code>elemAt 0 (filter (\\v -&gt; v == \"z\") setWithTwoElems)\n</code></pre>\n\n<p>it'll blow up saying:</p>\n\n<pre><code>\"*** Exception: Set.elemAt: index out of range\nCallStack (from HasCallStack):\n  error, called at libraries/containers/Data/Set/Base.hs:1186:16 in containers-0.5.7.1:Data.Set.Base\n</code></pre>\n\n<p>which kind of defies the purpose of using Haskell? I'd like something similar to <code>elemAt</code> (or just <code>first</code>) that returns a <code>Maybe</code> result instead.</p>\n\n<p>How can I do this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1512706369, "post_id": 47649343, "comment_id": 82375100, "body": "A couple of pointers that may help you understand folds in the future: you can think of them in a functional way, as <code>foldr k z [x1, x2, x3]</code> = <code>x1 `k` (x2 `k` (x3 `k` z))</code> (replacing all the <code>:</code> in the list with <code>k</code> and the final <code>[]</code> with <code>z</code>), or you can think of them in an iterative/imperative way: starting with an initial state <code>z</code>, for each element of the list (<code>foldr</code> = right to left, <code>foldl</code> = left to right), call some function <code>k</code> on the current state and the current element, and use its result as the state for the next element."}], "answers": [{"comments": [{"owner": {"reputation": 639, "user_id": 5715485, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6cb679baae60c79d57ea33ee91424a96?s=128&d=identicon&r=PG&f=1", "display_name": "limitless", "link": "https://stackoverflow.com/users/5715485/limitless"}, "edited": false, "score": 0, "creation_date": 1512499157, "post_id": 47650134, "comment_id": 82279964, "body": "Thank you, I really do more interested in the third soultion to this problem although it look more artificial.  But I think what you wrote dosent work well. I think that the signature of (:).f is not a-&gt;b-&gt;b"}, {"owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "reply_to_user": {"reputation": 639, "user_id": 5715485, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6cb679baae60c79d57ea33ee91424a96?s=128&d=identicon&r=PG&f=1", "display_name": "limitless", "link": "https://stackoverflow.com/users/5715485/limitless"}, "edited": false, "score": 0, "creation_date": 1512528017, "post_id": 47650134, "comment_id": 82291068, "body": "Thanks. I didn&#39;t make it consistent. Edited."}, {"owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "reply_to_user": {"reputation": 639, "user_id": 5715485, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6cb679baae60c79d57ea33ee91424a96?s=128&d=identicon&r=PG&f=1", "display_name": "limitless", "link": "https://stackoverflow.com/users/5715485/limitless"}, "edited": false, "score": 0, "creation_date": 1512528554, "post_id": 47650134, "comment_id": 82291201, "body": "And I missed an equal sign on the third line. Edited. it should work well now. Thx."}], "tags": [], "owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "is_accepted": false, "score": 0, "last_activity_date": 1512528391, "last_edit_date": 1512528391, "creation_date": 1512466134, "answer_id": 47650134, "question_id": 47649343, "link": "https://stackoverflow.com/questions/47649343/trying-to-write-map-using-foldr/47650134#47650134", "title": "Trying to write `map` using `foldr`", "body": "<p>It seems that you want to apply foldr on one element, then recursively adds up the result.</p>\n\n<p>It seems the ability of foldr to accumulate is not used.</p>\n\n<p>To implement map by foldr, you will want the accumulated result by foldr to be like a mapped list.</p>\n\n<p>So that's why in the short way foldr fold (:).f (a->[b]->[b]) instead of f (a->b). </p>\n\n<p>After you apply f onto an element x, then you will want to make it as an accumulated result (:) (f x) [] => (f x):[] => [f x]</p>\n\n<pre><code>foldr ((:).f) [] [x1,x2,x3] = (f x1):(f x2):(f x3):[] = [f x1, f x2, f x3] = map f [x1,x2,x3].\n</code></pre>\n\n<p>Edit:</p>\n\n<p>Recursion without foldr</p>\n\n<pre><code>map' f [] = []\nmap' f [x] = [f x]\nmap' f (x:xs) = map' f [x] ++ map' f xs\n</code></pre>\n\n<p>So if you really want to use both recursion and foldr:</p>\n\n<pre><code>map' :: (a-&gt;b) -&gt; [a] -&gt;[b]\nmap' f [] = []\nmap' f [x] = foldr ((:).f) [] [x]\nmap' f (x:xs) = (foldr ((:).f) [] [x]) ++ map' f xs\n\nf :: a -&gt; b\n(:).f :: a -&gt; [b] -&gt; [b]\n</code></pre>\n\n<p>Then every time foldr will only be applied to one element. It will just be like [f x].</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 3, "last_activity_date": 1512511147, "last_edit_date": 1512511147, "creation_date": 1512509804, "answer_id": 47663062, "question_id": 47649343, "link": "https://stackoverflow.com/questions/47649343/trying-to-write-map-using-foldr/47663062#47663062", "title": "Trying to write `map` using `foldr`", "body": "<p><code>foldr</code> is a very general recursive list processing function, because of how it mirrors the structure of the list type it self:</p>\n\n<pre><code>data [a]        -- a list is either\n  = a : [a]     -- a head element, plus a tail list\n  | []          -- or an empty list\n\nfoldr :: (a -&gt; b -&gt; b)    -- given a handler for a head element and the\n                          --   result of processing the tail\n      -&gt; b                -- and a \"handler\" for an empty list\n      -&gt; [a]              -- foldr turns a list\n      -&gt; b                -- into a single result\n</code></pre>\n\n<p>That might need a bit more unpacking than I could fit in inline comments.</p>\n\n<p>We all know a list has two cases, either a cons cell <code>:</code> containing a single element and the rest of the list, or an empty list containing no information.</p>\n\n<p>Well, the first two parameters to <code>foldr</code> are exactly instructions for how to handle each of these two cases. The <code>a -&gt; b -&gt; b</code> function parameter is the handler for the cons <code>:</code> case. When <code>foldr</code> encounters a cons cell like <code>x : xs</code> it will call the handler with <code>x</code> as the first argument, which fits type <code>a</code>. The second argument it passes to the handler is not the rest of the list <code>xs</code>, but the result of <code>foldr</code> processing <code>xs</code> - remembering that <code>foldr</code> ultimately turns a list into a <code>b</code>, that fits the second parameter of the <code>a -&gt; b -&gt; b</code> type.</p>\n\n<p>The \"handler\" for the empty list case is much simpler; since an empty list contains no more information, we don't need a function that can transform the information inside an empty list into a <code>b</code>, we can just use a <code>b</code> value as the result immediately.</p>\n\n<p>Because of this mirrored structure, a lot of recursive functions can be implemented by calling <code>foldr</code> with appropriate arguments. The exam question is <em>certainly</em> asking you to make use of this and implement <code>map</code> in terms of <code>foldr</code> without using recursion; the recursion inside <code>foldr</code> is enough.</p>\n\n<p>So your answer <em>must</em> look like this:</p>\n\n<pre><code>map f xs = foldr _ _ xs\n</code></pre>\n\n<p>You don't need to use multiple cases to handle an empty list or a cons cell; we handle those cases by the two arguments we give to <code>foldr</code>. The empty list case is obvious, since <code>map f [] == []</code>, so lets go ahead and fill in <code>foldr</code>'s \"empty list handler\":</p>\n\n<pre><code>map f xs = foldr _ [] xs\n</code></pre>\n\n<p>The <code>:</code> case is handled by the first argument. Remember what we said above; that is supposed to be a function taking an element of the list and the result of processing the tail of the list. And remembering that we're configuring <em>this</em> <code>foldr</code> to do the job of <code>map</code>, the \"result of processing the tail of the list\" is going to be the equivalent of having already mapped <code>f</code> over the tail of the list. So <em>all</em> we need to do is write a function that can take an element of the original list, apply <code>f</code> to it, and glue it onto the front of the already-mapped list. So:</p>\n\n<pre><code>map f xs = foldr applyCons [] xs\n  where applyCons elem mappedRest = f elem : mappedRest\n\n-- or\n\nmap f xs = foldr (\\x xs' -&gt; f x : xs') [] xs\n</code></pre>\n\n<p>I would expect something like either of those to get full marks on an exam question.</p>\n\n<hr>\n\n<p>Just for a little follow up though, lets see how the \"short and weird\" version you quoted <code>map f = foldr ((:) . f) []</code> is actually basically the same as the above, just with a few fairly mechanical simplifications applied. Starting from here:</p>\n\n<pre><code>map f xs = foldr (\\x xs' -&gt; f x : xs') [] xs\n</code></pre>\n\n<p>We can see that both sides of that definition are just <code>&lt;something&gt; xs</code>; that is, <code>xs</code> is the last argument on both sides of the <code>=</code> and isn't otehrwised used anywhere else. So we can drop it from both sides (this process is known as \"eta-reduction\" in unnecessarily fancy jargon), leaving us with:</p>\n\n<pre><code>map f = foldr (\\x xs' -&gt; f x : xs') []\n</code></pre>\n\n<p>Then we can use <code>:</code> inside the lambda in its prefix form instead of as an operator:</p>\n\n<pre><code>map f = foldr (\\x xs' -&gt; (:) (f x) xs') []\n</code></pre>\n\n<p>Which reveals that in the lambda function <code>xs'</code> is also the last thing in the list of parameters and the last argument on the right hand side, so we can drop that too:</p>\n\n<pre><code>map f = foldr (\\x -&gt; (:) (f x)) []\n</code></pre>\n\n<p>And then you may or may not remember (but should be able to figure out if you remember how it works) that the definition of the composition <code>.</code> operator is:</p>\n\n<pre><code>f . g = \\x -&gt; f (g x)\n</code></pre>\n\n<p>Or in our case:</p>\n\n<pre><code>(:) . f = \\x -&gt; (:) (f x)\n</code></pre>\n\n<p>The right hand side of that is exactly the lambda we were working with, so we can replace it with the left hand side:</p>\n\n<pre><code>map f = foldr ((:) . f) []\n</code></pre>\n\n<p>Which is our weird and short version.</p>\n\n<p>The reason I said it was \"basically the same\" as the longer versions you might have found more readable, is that I could rewrite the long version into the short version without thinking at all about <code>map</code> or <code>foldr</code>, or the purpose of any of this code at all. I \"merely\" applied some knowledge I had about functions in general (and the <code>.</code> operator in particular) to make some changes that <em>always</em> result in equivalent code, without needing any knowledge of what the code is doing. In an exam situation you almost certainly won't be expected to produce the shortest expressions (unless it was an exam for an advanced course, perhaps). And even in real programming \"short\" isn't a virtue in and of itself (the virtue is \"simpler and clearer\", which <em>sometimes</em> means shorter), so stopping at the longer non-weird version is fine if that is clearer to you.</p>\n"}, {"tags": [], "owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "is_accepted": false, "score": 1, "last_activity_date": 1512527222, "creation_date": 1512527222, "answer_id": 47665872, "question_id": 47649343, "link": "https://stackoverflow.com/questions/47649343/trying-to-write-map-using-foldr/47665872#47665872", "title": "Trying to write `map` using `foldr`", "body": "<p>Recursing on the structure of the list with your custom <code>map'</code> is unlikely to give you an answer that your exam grader will be happy with, regardless of how you manipulate <code>f</code>. You will essentially end up using <code>foldr</code> in the most trivial way possible. To see why, note that the below is an implementation of map.</p>\n\n<pre><code>map f [] = []\n-- Yes you could use (:) here, but this mirrors your example better\nmap f (x : xs) = [f x] ++ (map f xs)\n</code></pre>\n\n<p>You're already done! No <code>foldr</code> necessary. If we preserved this approach, you would only use <code>foldr</code> to create <code>[f x]</code> which is rather boring (something like <code>foldr (\\_ _ -&gt; [f x]) []</code> would suffice, see what I mean by boring?).</p>\n\n<p>So really the key is to realize that <code>foldr</code> takes care of the recursion for you, or equivalently that <code>foldr</code> already does a list traversal for you. </p>\n\n<p>One possible approach for intuition is to think of <code>foldr</code> as accumulating into another collection, rather than folding into a single element.</p>\n\n<pre><code>-- Hmmm well this just accumulates a list into another list, \n-- resulting in an identical list\nfoldr (\\x acc -&gt; x : acc) xs\n-- What if we changed x along the way?\nfoldr (\\x acc -&gt; (f x) : acc) xs -- This is it!\n</code></pre>\n\n<p>If you're curious how to get to <code>(:) . f</code>, @Ben's answer does a great job of walking through it.</p>\n"}], "owner": {"reputation": 639, "user_id": 5715485, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6cb679baae60c79d57ea33ee91424a96?s=128&d=identicon&r=PG&f=1", "display_name": "limitless", "link": "https://stackoverflow.com/users/5715485/limitless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 949, "favorite_count": 0, "accepted_answer_id": 47663062, "answer_count": 3, "score": 1, "last_activity_date": 1512528391, "creation_date": 1512463417, "last_edit_date": 1512465840, "question_id": 47649343, "link": "https://stackoverflow.com/questions/47649343/trying-to-write-map-using-foldr", "title": "Trying to write `map` using `foldr`", "body": "<p>I had an exam where I was forced to create the function <code>map</code> using <code>foldr</code>\nI know by now there is a wirde and short way to do it which is <code>map f = foldr ((:) . f) []</code>. \nMy shot was </p>\n\n<pre><code>map' :: (a-&gt;b) -&gt; [a] -&gt;[b]\nmap' f [] = []\nmap' f [x] = foldr f x [] : []\nmap' f (x:xs) (foldr f x []) ++ map' f xs\n</code></pre>\n\n<p>my problem is that <code>f</code> need to be of type <code>a-&gt;b-&gt;b</code> and it is <code>a-&gt;b</code>.\nHow can i force it to work? how can i change <code>f</code> to fit this implemention?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 2, "creation_date": 1512453823, "post_id": 47646991, "comment_id": 82252479, "body": "Can you give the type of the function you&#39;re trying to write?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512453974, "post_id": 47646991, "comment_id": 82252524, "body": "What do you mean by &quot;more easily&quot;? Your function is a single line of code; it doesn&#39;t really get much easier than that."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1512494251, "post_id": 47646991, "comment_id": 82276978, "body": "what simplification you want to do? I tried to think of something, but it really ended up to be some sort of folding, and you must call <code>&lt;*&gt;</code> to pull the function from applicative out to be a function in hask."}], "answers": [{"comments": [{"owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "edited": false, "score": 0, "creation_date": 1512462900, "post_id": 47649131, "comment_id": 82256640, "body": "Already an improvement, but still requires me to supply <code>(&lt;*&gt;)</code> explicitly, in this case to <code>iterate</code>. Just trying to understand how the applicative machinery could be used to solve this directly."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "edited": false, "score": 0, "creation_date": 1512463104, "post_id": 47649131, "comment_id": 82256732, "body": "@jhu I&#39;m pretty sure that there is nothing builtin that will avoid that. I could be wrong (especially since it is 2:35 a.m. here, hah), but I can&#39;t think of anything at the moment. Of the builtin Applicative functions I can think of right now, none of them have the &quot;statefulness&quot; required (in the way that you need): they don&#39;t keep track of the intermediate results in any way. So, for example, something like <code>(sequence (fmap sequence (replicateM 10 (Just (+1))))) 0</code> will just give you <code>Just [1,1,1,1,1,1,1,1,1,1]</code>."}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 3, "last_activity_date": 1512464532, "last_edit_date": 1512464532, "creation_date": 1512462593, "answer_id": 47649131, "question_id": 47646991, "link": "https://stackoverflow.com/questions/47646991/ways-to-apply-an-applicative-functor-multiple-times/47649131#47649131", "title": "Ways to apply an applicative functor multiple times", "body": "<p>You could use <code>iterate</code>:</p>\n\n<pre><code>applyAppl :: Applicative f =&gt; f (a -&gt; a) -&gt; Int -&gt; f a -&gt; f a\napplyAppl f n i = iterate (f &lt;*&gt;) i !! n\n</code></pre>\n\n<p>Loaded into GHCi:</p>\n\n<pre><code>ghci&gt; applyAppl (Just (+1)) 10 (pure 0)\nJust 10\n</code></pre>\n\n<p>I'm not sure that's necessarily better than your implementation, since I suspect both implementations fuse into something with essentially the same performance profile (though I haven't tested that), but it is different.</p>\n\n<p>I've seen this sort of \"<code>iterate</code> with <code>(!!)</code>\" pattern for memoization so I'm pretty sure that, at the very least, it won't have worse performance.</p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1512742435, "last_edit_date": 1512742435, "creation_date": 1512600111, "answer_id": 47684709, "question_id": 47646991, "link": "https://stackoverflow.com/questions/47646991/ways-to-apply-an-applicative-functor-multiple-times/47684709#47684709", "title": "Ways to apply an applicative functor multiple times", "body": "<p>Perhaps you are looking for the following variation of @David Young's answer:</p>\n\n<pre><code>foo :: Applicative f =&gt; f (a -&gt; a) -&gt; Int -&gt; a -&gt; f a\nfoo f n i = fmap (($ i) . iterateN n) f\n   where iterateN n f = (!! n) . iterate f\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>&gt; foo (Just (1+)) 10 0\nJust 10\n&gt;\n</code></pre>\n\n<p>This uses the \"applicative machinery\" in the form of the Functor instance for applicatives to perform both the functional iteration and the application without explicit use of <code>&lt;*&gt;</code>.  I'm not sure what else you'd be hoping for here.</p>\n"}], "owner": {"reputation": 402, "user_id": 9009630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/920657e98e40c2206e2166bba183551d?s=128&d=identicon&r=PG&f=1", "display_name": "jhu", "link": "https://stackoverflow.com/users/9009630/jhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 345, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1512742435, "creation_date": 1512453552, "last_edit_date": 1512459621, "question_id": 47646991, "link": "https://stackoverflow.com/questions/47646991/ways-to-apply-an-applicative-functor-multiple-times", "title": "Ways to apply an applicative functor multiple times", "body": "<p>Hello fellow Haskellers.</p>\n\n<p>Let's say I have an applicative functor (not an instance of monad) I\nwant to apply multiple times to a pure initial value. For example,</p>\n\n<pre><code>\u03bb&gt; Just (1+) &lt;*&gt; (Just (1+) &lt;*&gt; pure 0)\nJust 2\n</code></pre>\n\n<p>If I want to generalize this to any number of consecutive\napplications, I can do it with a <code>fold</code>.</p>\n\n<pre><code>applyAppl :: Applicative f =&gt; f (a -&gt; a) -&gt; Int -&gt; f a -&gt; f a\napplyAppl f n i = foldr (&lt;*&gt;) i $ replicate n f\n</code></pre>\n\n<p>After this definition,</p>\n\n<pre><code>\u03bb&gt; applyAppl (Just (1+)) 10 $ pure 0\nJust 10\n</code></pre>\n\n<p>I have an awkward suspicion that the generalization could also be\ndone with one of the higher-order builtin applicative tools such as <code>sequenceA</code> or <code>traverse</code>. Can it?</p>\n\n<p>(Edited to take into account the first two comments below.)</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512447461, "post_id": 47645637, "comment_id": 82250555, "body": "You tried something and probably the compiler gave you a very useful error message explaining why it doesn&#39;t work"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9054066, "user_type": "registered", "profile_image": "https://graph.facebook.com/1602599133134287/picture?type=large", "display_name": "Jan v", "link": "https://stackoverflow.com/users/9054066/jan-v"}, "edited": false, "score": 0, "creation_date": 1512486127, "post_id": 47645841, "comment_id": 82271444, "body": "Thank you very much! This helped me a lot"}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": true, "score": 4, "last_activity_date": 1512446135, "creation_date": 1512446135, "answer_id": 47645841, "question_id": 47645637, "link": "https://stackoverflow.com/questions/47645637/showing-an-unknown-type-in-haskell-basic/47645841#47645841", "title": "Showing an unknown type in Haskell (basic)", "body": "<p>Not every type can be <code>show</code>n in Haskell. Some types cannot be shown inherently - e.g. type <code>Int -&gt; Int</code> - how do you show that? But some types just don't yet have an implementation of <code>show</code>. So in general, if you have some type <code>a</code> about which you know nothing, you cannot assume that it can be <code>show</code>n.</p>\n\n<p>In order to use the function <code>show</code> on your type <code>a</code>, you need to ask the compiler to make sure that type <code>a</code> has an instance of <code>Show a</code>. To do that, you add a <em>constraint</em> to your instance, like this:</p>\n\n<pre><code>instance Show a =&gt; Show (STree a) where\n    show (LeafS b) = show b\n    ...\n</code></pre>\n\n<p>Because you have specified <code>Show a =&gt;</code>, the compiler knows that a given type <code>STree a</code> is an instance of the <code>Show</code> class if and only if the type <code>a</code> itself is. This allows the compiler to call <code>show b</code> and be sure that, when all types become known, this call will be possible. On the flip side, anyone who tries to <code>show</code> an instance of <code>STree a</code> will need to make sure that there exists an instance <code>Show a</code>, and the compiler will check that and issue an error if that is not so.</p>\n"}], "owner": {"reputation": 13, "user_id": 9054066, "user_type": "registered", "profile_image": "https://graph.facebook.com/1602599133134287/picture?type=large", "display_name": "Jan v", "link": "https://stackoverflow.com/users/9054066/jan-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 0, "accepted_answer_id": 47645841, "answer_count": 1, "score": -2, "last_activity_date": 1512446135, "creation_date": 1512444717, "question_id": 47645637, "link": "https://stackoverflow.com/questions/47645637/showing-an-unknown-type-in-haskell-basic", "title": "Showing an unknown type in Haskell (basic)", "body": "<p>i'm currently learning Haskell and I have difficulties with a task.</p>\n\n<p>I have a non-empty Binary Tree which looks like this</p>\n\n<pre><code>data STree a = BinS (STree a) a (STree a) | LeftS (STree a) a | RightS a (STree a) | LeafS a    \n</code></pre>\n\n<p>All I try to do right now is understanding how to output this tree.</p>\n\n<p>As for the beginning I just want to output the case for LeafS a</p>\n\n<p>I tried this</p>\n\n<pre><code>instance Show (STree a) where\nshow (LeafS b) = show b\n</code></pre>\n\n<p>I just dont know how to convert this unknown type a to a String that I can output. I tried show, print, everything i can think of but nothing works. </p>\n\n<p>The tree will only contain integers later on, but I have to do it with type a...</p>\n\n<p>This is what I want: LeafS 2 ~> \"2\"\nLeafS \"100\" ~> \"100\"</p>\n"}, {"tags": ["haskell", "ghc", "ffi"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512418474, "post_id": 47640973, "comment_id": 82240883, "body": "What is the type of the C function you&#39;re importing? I think its type in C determines entirely what type you can assign to it in Haskell. <code>ccall</code> is intended to model the C calling convention; since there is no concept of multiple return in C itself, it isn&#39;t present in <code>ccall</code> either. I think the proposals for automatic struct marshalling were scraped in favour of using <code>c2hs</code> or the like to automatically generate the code to marshal structs."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512418709, "post_id": 47640973, "comment_id": 82240998, "body": "@user2407038 Sure it has a C type (I&#39;ve included some code), but the <code>Storable</code> instances <code>c2hs</code> generates all assume I&#39;m passing a pointer. Here, I&#39;d like to pass an unboxed product (just three raw ints on the stack). My understanding is that the only way to do that in Haskell is via unboxed tuples."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512420978, "post_id": 47640973, "comment_id": 82242054, "body": "Indeed, there&#39;s no easy way to return a struct from a C function without allocating temporary memory somewhere. If this is too great a performance penalty (or some other obstacle to doing so), the only option is to use <code>prim</code> and return an unboxed tuple as you&#39;ve done. But if your function is a regular C function, it won&#39;t conform to the GHC call conventions which <code>prim</code> functions are required to use. You&#39;d have to write a C-- wrapper around your function."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512423010, "post_id": 47640973, "comment_id": 82242990, "body": "@user2407038 I would love to see an example of that!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512424623, "post_id": 47640973, "comment_id": 82243825, "body": "I&#39;ve managed to find one such <a href=\"https://bitbucket.org/carter/who-ya-gonna-call-talk-may-2013-ny-haskell/src/68c62ffd82e48c533491792275cd7ac2b1d678a1/FunShim/c4hs.c\" rel=\"nofollow noreferrer\">example</a> (and the associated <a href=\"https://vimeo.com/69025829\" rel=\"nofollow noreferrer\">talk</a>). Although in practice if you want this to be portable you would need much more code."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512425014, "post_id": 47640973, "comment_id": 82244016, "body": "<a href=\"http://breaks.for.alienz.org/blog/2012/02/09/parsing-market-data-feeds-with-ragel/\" rel=\"nofollow noreferrer\">Another example</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1512425190, "post_id": 47640973, "comment_id": 82244093, "body": "@user2407038 Yeah - I&#39;ve read the second one a couple of times. There is an annoying caveat: &quot;Many messages don\u2019t fit within the 5 free registers (R2-R6) that are available here and need to be partially loaded onto the stack. In this example I\u2019m just discarding the \u2018printable\u2019 flag to make everything fit in registers. Managing the stack is more involved&quot;"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512426772, "post_id": 47640973, "comment_id": 82244816, "body": "I guess you&#39;d have to dive into the GHC internals at this point, which is mainly undocumented... Probably the code which generates FFI wrappers for <code>ccall</code> imports would be a good place to start (if you&#39;re prepared for such a non-trivial undertaking, that is!)"}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1512422457, "post_id": 47642131, "comment_id": 82242734, "body": "Oh this isn&#39;t actually for GCD. This is for generating Haskell interop with Rust tuples. :) This is nonetheless useful! Thank you."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 1, "last_activity_date": 1512422326, "creation_date": 1512422326, "answer_id": 47642131, "question_id": 47640973, "link": "https://stackoverflow.com/questions/47640973/ffi-returning-three-ints-on-the-stack/47642131#47642131", "title": "FFI: returning three Int#&#39;s on the stack", "body": "<p>If you can implement your procedure in assembly directly, rather than C, it's pretty easy to do this. See: <a href=\"http://brandon.si/code/almost-inline-asm-in-haskell-with-foreign-import-prim/\" rel=\"nofollow noreferrer\">http://brandon.si/code/almost-inline-asm-in-haskell-with-foreign-import-prim/</a> . Maybe for a GCD algorithm this will be okay for you.</p>\n\n<p>There is a complete cabal project I put together <a href=\"https://github.com/jberryman/almost-inline-asm-haskell-example\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1512422326, "creation_date": 1512417134, "last_edit_date": 1512418623, "question_id": 47640973, "link": "https://stackoverflow.com/questions/47640973/ffi-returning-three-ints-on-the-stack", "title": "FFI: returning three Int#&#39;s on the stack", "body": "<p>Is there any way to return three <code>Int#</code> on the stack from a foreign function call? Here is the C code (or C code that generates an object file equivalent to the one I'm actually interested in):</p>\n\n<pre><code>struct Tuple {\n  int bezout1, bezout2, gcd;\n}\n\nstruct Tuple extendedGcd(int a, int b) {\n  /* elided */\n}\n</code></pre>\n\n<p>This won't compile since <code>(# Int#, Int#, Int# #)</code> isn't supported by <code>ccall</code>:</p>\n\n<pre><code>foreign import ccall \"extendedGcd\"\n  extendedGcd :: Int# -&gt; Int# -&gt; (# Int#, Int#, Int# #)\n</code></pre>\n\n<p>All my uses of the following (which compiles, albeit with <code>MagicHash</code>, <code>GHCForeignImportPrim</code>, <code>ForeignFunctionInterface</code>, <code>UnboxedTuples</code>, and <code>MagicHash</code>) seg-fault:</p>\n\n<pre><code>foreign import prim \"extendedGcd\"\n  extendedGcd :: Int# -&gt; Int# -&gt; (# Int#, Int#, Int# #)\n</code></pre>\n\n<p>I can find some evidence that there was some effort to get around this sort of problem:</p>\n\n<ul>\n<li><a href=\"https://mail.haskell.org/pipermail/ghc-devs/2014-March/004301.html\" rel=\"nofollow noreferrer\">thread on the mailing list</a></li>\n<li><a href=\"https://ghc.haskell.org/trac/ghc/wiki/CStructures\" rel=\"nofollow noreferrer\">a proposed (but abandoned) <code>CStructures</code> GHC extension</a> (by the same person)</li>\n</ul>\n\n<p>I imagine this is a common issue, yet I can't find any working examples. Is this at all possible? If it isn't does anyone care about this anymore (is there a Trac ticket somewhere?)</p>\n"}, {"tags": ["haskell", "pandoc"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1512413202, "post_id": 47639781, "comment_id": 82238214, "body": "See <a href=\"https://hackage.haskell.org/package/pandoc-2.0.4/docs/Text-Pandoc-Class.html#v:runIO\" rel=\"nofollow noreferrer\"><code>runIO :: PandocIO a -&gt; IO (Either PandocError a</code></a>."}, {"owner": {"reputation": 134, "user_id": 6049771, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7af641d29fe460006c5f0ef5158aec75?s=128&d=identicon&r=PG&f=1", "display_name": "Shaurya", "link": "https://stackoverflow.com/users/6049771/shaurya"}, "edited": false, "score": 0, "creation_date": 1512413733, "post_id": 47639781, "comment_id": 82238489, "body": "Alec , I tried Prelude T Text.Pandoc&gt; let  doc = readMarkdown def (T.pack &quot;[testing](url)&quot;) Prelude T Text.Pandoc&gt; :t doc doc :: PandocMonad m =&gt; m Pandoc , is it possible to get Pandoc out of m Pandoc"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1512414537, "post_id": 47639781, "comment_id": 82238906, "body": "@amali I just gave you the answer in my previous comment. :). <code>doc &lt;- runIO (readMarkdown def (T.pack &quot;[testing](url)&quot;)</code>. You should have <code>doc ::  Either PandocError Pandoc</code>."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 6, "last_activity_date": 1512415926, "creation_date": 1512415926, "answer_id": 47640642, "question_id": 47639781, "link": "https://stackoverflow.com/questions/47639781/how-to-get-pandoc-from-m-pandoc/47640642#47640642", "title": "How to get Pandoc from m Pandoc?", "body": "<p>The new version of <code>pandoc</code> has <a href=\"https://hackage.haskell.org/package/pandoc-2.0.4/docs/Text-Pandoc-Readers.html#v:readMarkdown\" rel=\"noreferrer\"><code>readMarkdown :: PandocMonad m =&gt; ReaderOptions -&gt; Text -&gt; m Pandoc</code></a>. This follows the usual <code>mtl</code>-style of specifying the constraints on the monad, instead of the actual monad.</p>\n\n<p>That means that to use <code>readMarkdown</code>, you need to pick a particular <code>m</code> satisfying <code>PandocMonad</code>. You can find what instances <code>PandocMonad</code> has by scrolling to the \"Instances\" section of <a href=\"https://hackage.haskell.org/package/pandoc-2.0.4/docs/Text-Pandoc-Class.html#t:PandocMonad\" rel=\"noreferrer\">its doc</a>. In this case, you find:</p>\n\n<ul>\n<li><code>PandocMonad PandocPure</code> maybe interesting</li>\n<li><code>PandocMonad PandocIO</code> maybe interesting</li>\n<li><code>(MonadTrans t, PandocMonad m, Functor (t m), MonadError PandocError (t m), Monad (t m), Applicative (t m)) =&gt; PandocMonad (t m)</code> - not interesting, requires another <code>PandocMonad m</code></li>\n<li><code>PandocMonad m =&gt; PandocMonad (ParsecT s st m)</code> - not interesting, requires another <code>PandocMonad m</code></li>\n</ul>\n\n<p>Now, scrolling past where <code>PandocPure</code> and <code>PandocIO</code> are defined, you can find ways of running extracting information out of those:</p>\n\n<ul>\n<li><a href=\"https://hackage.haskell.org/package/pandoc-2.0.4/docs/Text-Pandoc-Class.html#v:runIO\" rel=\"noreferrer\"><code>runIO :: PandocIO a -&gt; IO (Either PandocError a)</code></a></li>\n<li><a href=\"https://hackage.haskell.org/package/pandoc-2.0.4/docs/Text-Pandoc-Class.html#v:runPure\" rel=\"noreferrer\"><code>runPure :: PandocPure a -&gt; Either PandocError a</code></a></li>\n</ul>\n\n<p>Combining either of these functions with <code>readMarkdown</code>, you can get a concrete <code>Either</code> type.</p>\n\n<pre><code>runIO (readMarkdown def (T.pack \"[testing](url)\")) :: IO (Either PandocError Pandoc)\nrunPure (readMarkdown def (T.pack \"[testing](url)\")) :: Either PandocError Pandoc\n</code></pre>\n\n<p>Note that I know nothing about Pandoc or its API - all I did was walk through the above process.</p>\n"}, {"comments": [{"owner": {"reputation": 134, "user_id": 6049771, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7af641d29fe460006c5f0ef5158aec75?s=128&d=identicon&r=PG&f=1", "display_name": "Shaurya", "link": "https://stackoverflow.com/users/6049771/shaurya"}, "edited": false, "score": 0, "creation_date": 1512502651, "post_id": 47644630, "comment_id": 82281745, "body": "Hi john, is it possible to pass argument to filters dynamically ?"}], "tags": [], "owner": {"reputation": 7779, "user_id": 1261777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc793fa11fa22df8961198cccaa057d?s=128&d=identicon&r=PG", "display_name": "John MacFarlane", "link": "https://stackoverflow.com/users/1261777/john-macfarlane"}, "is_accepted": false, "score": 3, "last_activity_date": 1512437011, "creation_date": 1512437011, "answer_id": 47644630, "question_id": 47639781, "link": "https://stackoverflow.com/questions/47639781/how-to-get-pandoc-from-m-pandoc/47644630#47644630", "title": "How to get Pandoc from m Pandoc?", "body": "<p>Have a look at <a href=\"http://pandoc.org/using-the-pandoc-api.html\" rel=\"nofollow noreferrer\">http://pandoc.org/using-the-pandoc-api.html</a> for a basic tutorial on using the pandoc 2.x API.</p>\n"}], "owner": {"reputation": 134, "user_id": 6049771, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7af641d29fe460006c5f0ef5158aec75?s=128&d=identicon&r=PG&f=1", "display_name": "Shaurya", "link": "https://stackoverflow.com/users/6049771/shaurya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 47640642, "answer_count": 2, "score": 1, "last_activity_date": 1512437011, "creation_date": 1512412522, "last_edit_date": 1512412943, "question_id": 47639781, "link": "https://stackoverflow.com/questions/47639781/how-to-get-pandoc-from-m-pandoc", "title": "How to get Pandoc from m Pandoc?", "body": "<p>I started to write few programs using the pandoc api ,taking examples  from , <a href=\"https://johnmacfarlane.net/BayHac2014/#/the-pandoc-types\" rel=\"nofollow noreferrer\">https://johnmacfarlane.net/BayHac2014/#/the-pandoc-types</a> , But I am unable to isolate Pandoc from m Pandoc.</p>\n\n<pre><code>module ImageAttr where\nimport Text.Pandoc.Builder\nimport Text.Pandoc.Generic\nimport Text.Pandoc.Definition\nimport Text.Pandoc.JSON\nimport qualified Data.Char as DataChar\nimport qualified Data.List as DataList\nimport Data.Either\nimport Text.Parsec as Parsec\nimport Text.Pandoc\nimport qualified Data.Text as T\nimport qualified Data.Text.IO as TIO\n\nfromRight :: b -&gt; Either a b -&gt; b\nfromRight _ (Right b) = b\nfromRight b _         = b\n\n\nfromLeft :: b -&gt; Either b a -&gt; b\nfromLeft  _ (Left b)  = b\nfromLeft  b _        = b\n\n\nmain :: IO ()\nmain = do\n        result &lt;- runIO $ do\n            doc &lt;- readMarkdown def (T.pack \"[testing](url)\")\n            writeRST def doc\n        x&lt;-((handleError result))\n        print x\n</code></pre>\n\n<p>output is String but I need pandoc ast previously it was Either PandocError Pandoc type , instead I am getting \"m Pandoc\". How to get Pandoc out of \"m Pandoc\".</p>\n\n<p>any Thought?\nBy the way , I am new and still learning haskell.</p>\n\n<p>I am getting error message  as :</p>\n\n<pre><code>ImageSizeModifer.hs:28:12:\n    Couldn't match expected type \u2018PandocIO a0\u2019 with actual type \u2018IO ()\u2019\n    In a stmt of a 'do' block: print \"\"\n    In the second argument of \u2018($)\u2019, namely\n      \u2018do { doc &lt;- readMarkdown def (T.pack \"[testing](url)\");\n            print \"\" }\u2019\nFailed, modules loaded: none.\nPrelude T&gt;\n</code></pre>\n\n<p>My problem is I need Pandoc , but I have not much idea how to to get it ? There are new PandocIO and PandocPure , I believe these are new.</p>\n"}, {"tags": ["haskell", "uniqueness-typing"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512413618, "post_id": 47639718, "comment_id": 82238436, "body": "By the way, I think you mixed up two examples. The function above is the one marked &quot;incorrect&quot; in the blog."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512416802, "post_id": 47639718, "comment_id": 82240044, "body": "This function appears twice in the blog post; the first time with the comment &quot;correct but useless&quot; and the second with &quot;incorrect&quot;. Either I&#39;ve misunderstood what the author is trying to say about this function, or they&#39;ve including the wrong function in the &quot;correct but useless&quot; case. As far as I can tell, this function is indeed incorrect - the most general type of <code>(,)</code> should be <code>n:a -&gt; m:b -&gt; (min n m):(n:a, m:b)</code> (as far as I understand, at least) which should reject the <code>mkPair</code> definition (since <code>\u03c9 &#47;= min 1 1</code>)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512551246, "post_id": 47639718, "comment_id": 82299643, "body": "@user2407038, the function appears twice: once under uniqueness types, the other under linear types."}], "answers": [{"comments": [{"owner": {"reputation": 2699, "user_id": 304435, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/38fb50d1c81b7a8ea1994bc02f695fef?s=128&d=identicon&r=PG", "display_name": "tesserakt", "link": "https://stackoverflow.com/users/304435/tesserakt"}, "edited": false, "score": 0, "creation_date": 1512488552, "post_id": 47639970, "comment_id": 82273258, "body": "So mkPair has to have the type 1:(1:a, 1:b), correct?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2699, "user_id": 304435, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/38fb50d1c81b7a8ea1994bc02f695fef?s=128&d=identicon&r=PG", "display_name": "tesserakt", "link": "https://stackoverflow.com/users/304435/tesserakt"}, "edited": false, "score": 0, "creation_date": 1512497252, "post_id": 47639970, "comment_id": 82278807, "body": "@tesserakt Yes, that should be its return type. We can&#39;t change the first 1 to \u03c9."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1512413889, "last_edit_date": 1512413889, "creation_date": 1512413289, "answer_id": 47639970, "question_id": 47639718, "link": "https://stackoverflow.com/questions/47639718/linear-and-unique-types-with-mkpair/47639970#47639970", "title": "Linear and Unique types with mkPair", "body": "<p>Actually, <code>mkPair</code> is ill-typed (as the blog itself states), since its return type allows one to duplicate the resulting pair. So, any caller having unique values of types <code>a</code> and <code>b</code>, could make a pair, duplicate it, and take the four components (two from each pair), and obtain two values of type <code>a</code>, and two values of type <code>b</code>.</p>\n\n<p>This would circumvent the linearity of <code>a</code> and <code>b</code>, so there must be no function having a type as the one of <code>mkPair</code> you show above.</p>\n"}, {"comments": [{"owner": {"reputation": 2699, "user_id": 304435, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/38fb50d1c81b7a8ea1994bc02f695fef?s=128&d=identicon&r=PG", "display_name": "tesserakt", "link": "https://stackoverflow.com/users/304435/tesserakt"}, "edited": false, "score": 0, "creation_date": 1512488515, "post_id": 47641754, "comment_id": 82273226, "body": "Just so I&#39;m understanding this: if you have a function mkPair and pass two unique types to it, the only result you can get it a unique pair? At that point the calling function could read the pair returned from mkPair exactly once, correct?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1544337"}, "reply_to_user": {"reputation": 2699, "user_id": 304435, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/38fb50d1c81b7a8ea1994bc02f695fef?s=128&d=identicon&r=PG", "display_name": "tesserakt", "link": "https://stackoverflow.com/users/304435/tesserakt"}, "edited": false, "score": 0, "creation_date": 1512490720, "post_id": 47641754, "comment_id": 82274720, "body": "@tesserakt uniqueness is a property of types, not of functions. The type <code>\u03c9:(1:a, 1:b)</code> simply does not exist, so the larger type <code>1:a -&gt; 1:b -&gt; \u03c9:(1:a, 1:b)</code> also doesn&#39;t exist. You <i>could</i> define a function <code>1:a -&gt; 1:b -&gt; \u03c9:(\u03c9:a, \u03c9:b)</code>, for instance <code>f _ _ = (undefined, undefined)</code>. You are of course not allowed to promote a unique type to a non-unique type (<code>f x y = (x,y)</code> with that same signature)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1544337"}, "reply_to_user": {"reputation": 2699, "user_id": 304435, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/38fb50d1c81b7a8ea1994bc02f695fef?s=128&d=identicon&r=PG", "display_name": "tesserakt", "link": "https://stackoverflow.com/users/304435/tesserakt"}, "edited": false, "score": 0, "creation_date": 1512490847, "post_id": 47641754, "comment_id": 82274793, "body": "@tesserakt concretely,  &quot;If you have a function and pass two unique types to it, the only result you can get is a unique pair&quot; - I think you have the right idea, but type like <code>1:a -&gt; 1:b -&gt; 1:a</code> or <code>1:a -&gt; 1:b -&gt; Int</code> <i>are</i> possible of course. If you want to return a tuple of the arguments, it has to be unique and have unique elements."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1544337"}, "is_accepted": true, "score": 1, "last_activity_date": 1512420671, "creation_date": 1512420671, "answer_id": 47641754, "question_id": 47639718, "link": "https://stackoverflow.com/questions/47639718/linear-and-unique-types-with-mkpair/47641754#47641754", "title": "Linear and Unique types with mkPair", "body": "<p>I'm not sure what the author of the blog post means when he says that this is correct but useless. In <a href=\"http://clean.cs.ru.nl\" rel=\"nofollow noreferrer\">Clean</a>, a language which has actually implemented uniqueness types, this is <em>not</em> allowed due to uniqueness propagation. You can read more about that in <a href=\"https://cloogle.org/doc/#CleanRep.2.2_11.htm;jump=_Toc311798094\" rel=\"nofollow noreferrer\">section 9.2</a> of the <a href=\"http://clean.cs.ru.nl/download/doc/CleanLangRep.2.2.pdf\" rel=\"nofollow noreferrer\">language report</a>. There simply does not exist a type <code>\u03c9:(1:a, 1:b)</code> (which is <code>(*a,*b)</code> in Clean syntax), because due to uniqueness propagation this actually is <code>1:(1:a, 1:b)</code> or <code>*(*a,*b)</code>.</p>\n\n<p>This may be what the author is trying to express, but I find the post hard to read due to the lack of a theoretical framework.</p>\n"}], "owner": {"reputation": 2699, "user_id": 304435, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/38fb50d1c81b7a8ea1994bc02f695fef?s=128&d=identicon&r=PG", "display_name": "tesserakt", "link": "https://stackoverflow.com/users/304435/tesserakt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 47641754, "answer_count": 2, "score": 1, "last_activity_date": 1512420671, "creation_date": 1512412246, "question_id": 47639718, "link": "https://stackoverflow.com/questions/47639718/linear-and-unique-types-with-mkpair", "title": "Linear and Unique types with mkPair", "body": "<p>I've been reading through this article here <a href=\"http://edsko.net/2017/01/08/linearity-in-haskell/\" rel=\"nofollow noreferrer\">http://edsko.net/2017/01/08/linearity-in-haskell/</a> and the author mentions that one can construct a non-unique array with unique elements but that you can't extract them. </p>\n\n<p>I.e. </p>\n\n<pre><code>mkPair :: 1:a -&gt; 1:b -&gt; \u03c9:(1:a, 1:b) -- correct but useless\nmkPair x y = (x, y) \n</code></pre>\n\n<p>but couldn't you read the elements once in the calling function? Maybe I'm missing something. </p>\n\n<p>Also, although legal, this same function is illegal when looking at it from a linearity perspective. But I thought these were just 2 sides of the same coin, so the function would not change legality depending upon perspective.</p>\n"}, {"tags": ["haskell", "monads", "maybe"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1512411738, "post_id": 47639595, "comment_id": 82237520, "body": "Well, what error?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1512411759, "post_id": 47639595, "comment_id": 82237531, "body": "And, for that matter, what code?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1512411909, "post_id": 47639595, "comment_id": 82237618, "body": "You should always include the error in your question if you get one."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1512411982, "post_id": 47639595, "comment_id": 82237667, "body": "Do you want to <i>replace</i> Nothing with a &quot;.&quot; or do you want to <i>print</i> a &quot;.&quot;? Your code and your description of your code say two different things."}, {"owner": {"reputation": 1, "user_id": 9052196, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6pgwtQHMzoY/AAAAAAAAAAI/AAAAAAAAABo/1yjZFltHk1Q/photo.jpg?sz=128", "display_name": "Brandon Ajax", "link": "https://stackoverflow.com/users/9052196/brandon-ajax"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1512412253, "post_id": 47639595, "comment_id": 82237787, "body": "yes, replace Nothing with a &quot;.&quot;"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1512412264, "post_id": 47639595, "comment_id": 82237789, "body": "Then why are you using <code>putStr</code>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1512417421, "post_id": 47639595, "comment_id": 82240374, "body": "The compiler tells you exactly what&#39;s wrong. <code>yd</code> has type <code>Hmm</code> but the pattern <code>[Nothing]</code> only matches on types <code>[Maybe a]</code> for any type <code>a</code>. In order to pattern match on an expression <code>yd :: Hmm</code> you have to pattern match on the <code>Hmm</code> constructor. (NB: this has nothing to do with monads)."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9052196, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6pgwtQHMzoY/AAAAAAAAAAI/AAAAAAAAABo/1yjZFltHk1Q/photo.jpg?sz=128", "display_name": "Brandon Ajax", "link": "https://stackoverflow.com/users/9052196/brandon-ajax"}, "edited": false, "score": 1, "creation_date": 1512423896, "post_id": 47641853, "comment_id": 82243489, "body": "thanks a lot for your explanation + time. could you please explain the last bit (map f) as it seems to be a nice elegant approach"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1512482717, "post_id": 47641853, "comment_id": 82269125, "body": "what about <code>Just 17</code> though? also, cf. <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Maybe.html#v:maybe\" rel=\"nofollow noreferrer\">Data.Maybe.maybe</a>"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1512498190, "post_id": 47641853, "comment_id": 82279378, "body": "@WillNess you could collect as a <code>[String]</code> and exit the function with <code>intercalate &quot; &quot;</code>, but that&#39;s ultimately a different question isn&#39;t it?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 1, "user_id": 9052196, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6pgwtQHMzoY/AAAAAAAAAAI/AAAAAAAAABo/1yjZFltHk1Q/photo.jpg?sz=128", "display_name": "Brandon Ajax", "link": "https://stackoverflow.com/users/9052196/brandon-ajax"}, "edited": false, "score": 0, "creation_date": 1512498486, "post_id": 47641853, "comment_id": 82279575, "body": "@BrandonAjax <code>map</code> has type <code>(a -&gt; b) -&gt; [a] -&gt; [b]</code>. You&#39;re passing a <code>[Maybe Int]</code> and want a <code>[Char]</code> back, so that&#39;s your <code>a</code> and <code>b</code>. The function <code>f</code> turns all <code>Nothing</code>s to <code>&#39;.&#39;</code>s, and all <code>Just x</code>s to <code>intToDigit x</code>. As WillNess pointed out, this will fail for any <code>x&gt;16</code> (<code>intToDigit 17</code> throws an exception), but it&#39;s also unclear what the appropriate output would be in that case (how is <code>getVal $ Hmm [Just 17]</code> different from <code>getVal $ Hmm [Just 1, Just 7]</code>?)"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1512498822, "post_id": 47641853, "comment_id": 82279806, "body": "ed. above: this will fail for any <code>x&gt;=16</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1512512714, "post_id": 47641853, "comment_id": 82286657, "body": "@AdamSmith right, converting to <code>Char</code> was wrong. Just convert to <code>String</code>s with <code>map $ maybe &quot;.&quot; show</code> and <code>concat</code> all the results, or <code>mapM_ putStr</code> them. No <code>&quot; &quot;</code> is necessary."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1512514117, "post_id": 47641853, "comment_id": 82287169, "body": "@WillNess right but as I mentioned in my comment above, the desired result of that implementation is ambiguous since <code>[Just 17]</code> and <code>[Just 1, Just 7]</code> would appear synonymous."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 3, "last_activity_date": 1512477425, "last_edit_date": 1512477425, "creation_date": 1512421114, "answer_id": 47641853, "question_id": 47639595, "link": "https://stackoverflow.com/questions/47639595/extracting-from-a-list-in-haskell/47641853#47641853", "title": "Extracting from a list in haskell", "body": "<p>The error message tells you the error:</p>\n\n<blockquote>\n  <p>Couldn't match expected type \"Hmm\" with actual type '[Maybe a0]'</p>\n</blockquote>\n\n<p>Let's simplify by using <code>[Int]</code> instead of <code>[Maybe Int]</code> so we can take monads completely out of the picture here. Let's re-write your test cases by using <code>0</code> instead of <code>Nothing</code>, and <code>x</code> instead of <code>Just x</code></p>\n\n<pre><code>data Hmm = Hmm [Int]\n deriving (Show, Eq)\n\nyd = Hmm [8, 5, 0, 2, 0, 2, 0, 0]\n\ngetVal = case yd of\n  [0] -&gt; putStr \".\"\n  [x] -&gt; putStr $ show x\n-- N.B. I had to reverse the order here since `[x]` will match before `[0]`.\n-- This isn't an issue when you're still using Maybes, since Just x doesn't match Nothing\n</code></pre>\n\n<p>Now we've got no monadic elements at all (except <code>getVal :: Hmm -&gt; IO ()</code>, but...) and you'll still have the same issue as before. <code>yd</code> is constructed as a <code>Hmm</code>, but the only pattern matching you're doing on it is looking for an <code>[a]</code>. In addition, both patterns are only looking for single-element lists, so they wouldn't match even if <code>yd :: [Int]</code>.</p>\n\n<p>Let's re-write using the <code>Hmm</code> constructor in our pattern match and recursing correctly to capture the whole list. We'll also re-write <code>getVal</code> to return the <code>String</code> so we don't even have to mess with the <code>IO</code> monad that <code>putStr :: String -&gt; IO ()</code> returns.</p>\n\n<pre><code>import Data.Char (intToDigit)\n\ndata Hmm = Hmm [Int]\n  deriving (Show, Eq)\n\nyd = Hmm [8, 5, 0, 2, 0, 2, 0, 0]\n\ngetVal :: Hmm -&gt; String\ngetVal (Hmm [])    = []\ngetVal (Hmm (0:xs) = '.'          : getVal (Hmm xs)\ngetVal (Hmm (x:xs) = intToDigit x : getVal (Hmm xs)\n\nresult :: String\nresult = getVal yd\n</code></pre>\n\n<p>Notice how I include three alternations in my pattern matches. One for <code>Hmm []</code> -- an empty list wrapped in a <code>Hmm</code> type, one for <code>Hmm (0:xs)</code> -- a non-empty list wrapped by a <code>Hmm</code> whose first value is zero, and one for <code>Hmm (x:xs)</code> -- a non-empty list wrapped by a <code>Hmm</code>, and each result but the first is recursive. This will return:</p>\n\n<pre><code>getVal yd =\ngetVal (Hmm (8:[5, 0, 2, 0, 2, 0, 0])) =\n'8' : getVal (Hmm (5: [0, 2, 0, 2, 0, 0])) =\n'8':'5' : getVal (Hmm (0: [2, 0, 2, 0, 0])) =\n'8':'5':'.' : getVal (Hmm (2: [0, 2, 0, 0])) =\n'8':'5':'.':'2' : getVal (Hmm (0: [2, 0, 0])) =\n'8':'5':'.':'2':'.' : getVal (Hmm (2: [0, 0])) =\n'8':'5':'.':'2':'.':'2' : getVal (Hmm (0: [0])) =\n'8':'5':'.':'2':'.':'2':'.' : getVal (Hmm (0:[])) =\n'8':'5':'.':'2':'.':'2':'.':'.': getVal (Hmm []) =   -- base case!\n'8':'5':'.':'2':'.':'2':'.':'.':[] =      -- re-write as list\n['8', '5', '.', '2', '.', '2', '.', '.']  -- re-write as String\n\"85.2.2..\"\n</code></pre>\n\n<p>Do note that this is just:</p>\n\n<pre><code>toString :: Hmm -&gt; String\ntoString (Hmm xs) = map f xs where\n  f 0 = '.'\n  f x = intToDigit x\n</code></pre>\n\n<p>To use a <code>Maybe Int</code> here and return this to the world of monads, just apply the same changes to your code</p>\n\n<pre><code>import Data.Char (intToDigit)\n\ndata Hmm = Hmm [Maybe Int]\n  deriving (Show, Eq)\n\nyd = Hmm [Just 8, Just 5, Nothing, Just 2, Nothing, Just 2, Nothing, Nothing]\n\ngetVal :: Hmm -&gt; String\ngetVal (Hmm []) = []\ngetVal (Hmm (Nothing:xs)) = '.'          : getVal (Hmm xs)\ngetVal (Hmm (Just x :xs)) = intToDigit x : getVal (Hmm xs)\n\n-- or equivalently\n\ngetVal' :: Hmm -&gt; String\ngetVal' (Hmm xs) = map f xs where\n  f Nothing = '.'\n  f (Just x) = intToDigit x\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9052196, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6pgwtQHMzoY/AAAAAAAAAAI/AAAAAAAAABo/1yjZFltHk1Q/photo.jpg?sz=128", "display_name": "Brandon Ajax", "link": "https://stackoverflow.com/users/9052196/brandon-ajax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 47641853, "answer_count": 1, "score": -3, "last_activity_date": 1512477425, "creation_date": 1512411691, "last_edit_date": 1512417297, "question_id": 47639595, "link": "https://stackoverflow.com/questions/47639595/extracting-from-a-list-in-haskell", "title": "Extracting from a list in haskell", "body": "<p>I'm pretty new to Haskell and don't fully understand the Maybe monads. </p>\n\n<pre><code>data Hmm = Hmm [Maybe Int]\n deriving (Show, Eq)\n\nyd = Hmm [Just 8, Just 5,Nothing,Just 2, Nothing, Just 2, Nothing,Nothing]\n\ngetVal = case yd of\n  [Just val] -&gt; putStr val\n  [Nothing] -&gt; putStr \".\"\n</code></pre>\n\n<p>I want to extract my list by replacing Nothing with a dot and Just n with n (all in one line). However, this code gives me an error. </p>\n\n<pre><code>Couldn't match expected type \"Hmm\" with actual type '[Maybe a0]'\n\nIn the pattern : [Nothing] \nIn a case alternative: [Nothing] -&gt; putStr \".\"\nIn the expression:\n  case yd of\n  [Just val] -&gt; putStr val\n  [Nothing] -&gt; putStr \".\"\n</code></pre>\n\n<p>basically i want the list above to be in the format \" 85.2.2.. \" </p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1512411840, "post_id": 47639535, "comment_id": 82237586, "body": "Why do you think it has type <code>Char -&gt; Tree Char</code> instead of type <code>Tree Char</code>?"}, {"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 0, "creation_date": 1512412014, "post_id": 47639535, "comment_id": 82237679, "body": "It looks like <code>insert (tr x)</code> should be <code>insert tr x</code>. Otherwise, you are applying tr to x, then passing that to insert."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 2, "last_activity_date": 1512412062, "creation_date": 1512412062, "answer_id": 47639679, "question_id": 47639535, "link": "https://stackoverflow.com/questions/47639535/haskell-couldnt-match-expected-type-tree-char-with-actual-type-char-tree/47639679#47639679", "title": "Haskell: Couldn&#39;t match expected type \u2018Tree Char\u2019 with actual type \u2018Char -&gt; Tree Char\u2019", "body": "<p><code>insert (tr x)</code> means \"apply the function <code>tr</code> to the argument <code>x</code> and then apply the function <code>insert</code> to the result\". Since <code>insert</code> has type <code>Tree Char -&gt; Char -&gt; Tree Char</code> and you're only applying it to one argument, this means that you get back a function of type <code>Char -&gt; Tree Char</code>, which expects the second argument. That's why you get type errors about <code>newTree</code> having type <code>Char -&gt; Tree Char</code></p>\n\n<p>The next problem is that <code>tr</code> isn't actually a function, so applying it to an argument makes no sense. That's the \"The function \u2018tr\u2019 is applied to one argument, but its type \u2018Tree Char\u2019 has none\" error.</p>\n\n<p>You can fix both of those by instead applying <code>insert</code> to the arguments <code>tr</code> and <code>x</code> (<code>insert tr x</code>), as you presumably meant to all along.</p>\n"}], "owner": {"reputation": 45, "user_id": 6136015, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1196526490360559/picture?type=large", "display_name": "Sasithorn Hannarong", "link": "https://stackoverflow.com/users/6136015/sasithorn-hannarong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "accepted_answer_id": 47639679, "answer_count": 1, "score": 0, "last_activity_date": 1512412062, "creation_date": 1512411479, "question_id": 47639535, "link": "https://stackoverflow.com/questions/47639535/haskell-couldnt-match-expected-type-tree-char-with-actual-type-char-tree", "title": "Haskell: Couldn&#39;t match expected type \u2018Tree Char\u2019 with actual type \u2018Char -&gt; Tree Char\u2019", "body": "<p>\nI want to construct a binary tree in Haskell. This tree construction is different from normal BST because the input is in Pre-order traversal and I want to reconstruct the binary tree from this input. However, I got an error when compiling this following code:</p>\n\n\n\n<pre><code>module Main where\n\nimport System.IO\nimport Text.Printf\n\ndata Tree a = Nil | Leaf | Branch a (Tree a) (Tree a) deriving (Eq, Show)\n\nmain = do\n    -- get input tree\n    line &lt;- getLine\n    return ()\n\ninsert :: Tree Char -&gt; Char -&gt; Tree Char\ninsert Nil a = Branch a Nil Nil\ninsert (Branch v t1 t2) a\n    | t1 == Nil &amp;&amp; t2 == Nil &amp;&amp; v == '*' = Branch v (makeB a) t2    --If *     has no child, insert a to leftside of the tree\n    | (getElement t1) == '*' &amp;&amp; v == '*' = Branch v (insert t1 a) t2\n    | (getElement t1) /= '*' &amp;&amp; v == '*' = Branch v t1 (makeB a)\n\ngetElement :: Tree Char -&gt; Char\ngetElement (Branch v t1 t2) = v\n\nmakeB :: Char -&gt; Tree Char\nmakeB a =  Branch a Nil Nil\n\ninputTree :: Tree Char -&gt; [Char] -&gt; Tree Char\ninputTree tr [] = tr\ninputTree tr (x:xs) = inputTree newtree xs\n    where newtree = insert (tr x)\n</code></pre>\n\n<p>\nThe problem is in >> inputTree newtree xs.  It said</p>\n\n<pre><code>main.hs:43:33: error:\n\u2022 Couldn't match expected type \u2018Tree Char\u2019\n              with actual type \u2018Char -&gt; Tree Char\u2019\n\u2022 Probable cause: \u2018newtree\u2019 is applied to too few arguments\n  In the first argument of \u2018inputTree\u2019, namely \u2018newtree\u2019\n  In the expression: inputTree newtree xs\n  In an equation for \u2018inputTree\u2019:\n      inputTree tr (x : xs)\n        = inputTree newtree xs\n        where\n            newtree = insert (tr x)\nmain.hs:44:29: error:\n\u2022 Couldn't match expected type \u2018Char -&gt; Tree Char\u2019\n              with actual type \u2018Tree Char\u2019\n\u2022 The function \u2018tr\u2019 is applied to one argument,\n  but its type \u2018Tree Char\u2019 has none\n  In the first argument of \u2018insert\u2019, namely \u2018(tr x)\u2019\n  In the expression: insert (tr x)\n</code></pre>\n\n<p>My newtree should have type Tree Char but it has type Char -> Tree Char instead. I don't know how to fix it. Thanks for any help</p>\n\n\n"}, {"tags": ["haskell", "yield", "conduit", "statet"], "answers": [{"tags": [], "owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "is_accepted": false, "score": 2, "last_activity_date": 1512437069, "creation_date": 1512437069, "answer_id": 47644638, "question_id": 47639415, "link": "https://stackoverflow.com/questions/47639415/conduit-streaming-monad-state/47644638#47644638", "title": "Conduit streaming monad state", "body": "<p>Turns out a solution is something like</p>\n\n<pre><code>passState = mapMC $ \\_ -&gt; do\n  state &lt;- get\n  return state\n</code></pre>\n"}], "owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512437069, "creation_date": 1512410976, "last_edit_date": 1512411472, "question_id": 47639415, "link": "https://stackoverflow.com/questions/47639415/conduit-streaming-monad-state", "title": "Conduit streaming monad state", "body": "<p>I have a conduit pipeline whose monad includes state. At one point I'd like to have a conduit that streams the state to the following ones (this is a simplified version of what I actually need).</p>\n\n<p>But I have trouble making this. The following example only streams the state once, from the yield:</p>\n\n<pre><code>import Conduit (ConduitM, yield)\nimport Control.Monad.Except (Except)\nimport Control.Monad.State.Lazy (StateT, get)\n\ntype CondState = String\ntype CondMonad = StateT CondState (Except String)\n\npassState :: ConduitM i CondState CondMonad ()\npassState = do\n  state &lt;- get\n  yield state\n</code></pre>\n\n<p>If I run</p>\n\n<pre><code>runExcept $ (runStateT . runConduit $ yieldMany [(1::Int)..] .| passState .| sinkList) \"state\"\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>Right ([\"state\"], \"state\")\n</code></pre>\n\n<p>rather than the infinite list that I'm aiming for in the first tuple position.</p>\n\n<p>In the actual application the state changes as the conduit streams.</p>\n\n<p>Any ideas? </p>\n"}, {"tags": ["haskell", "haskell-stack", "intero"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1512408294, "post_id": 47638079, "comment_id": 82235682, "body": "Can you do a <code>stack build intero</code> and/or <code>stack clean</code> before."}, {"owner": {"reputation": 89, "user_id": 7149571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f9f9d7b534eccc7a6af42b25197abff?s=128&d=identicon&r=PG&f=1", "display_name": "Amir", "link": "https://stackoverflow.com/users/7149571/amir"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1512409065, "post_id": 47638079, "comment_id": 82236094, "body": "Did not work. Still same error. Also running <code>stack exec -- ghc-pkg unregister --force intero</code> says: <code>ghc-pkg: cannot find package intero</code>."}, {"owner": {"reputation": 89, "user_id": 7149571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f9f9d7b534eccc7a6af42b25197abff?s=128&d=identicon&r=PG&f=1", "display_name": "Amir", "link": "https://stackoverflow.com/users/7149571/amir"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1512409952, "post_id": 47638079, "comment_id": 82236561, "body": "I had to manually copy it from <code>~&#47;.stack&#47;global-project&#47;.stack-work&#47;install&#47;x86_64-osx&#47;lts-9&zwnj;&#8203;.14&#47;8.0.2&#47;bin&#47;intero</code> to <code>~&#47;.stack&#47;snapshots&#47;x86_64-osx&#47;lts-9.14&#47;8.0.2&#47;bin&#47;</code>. And that fixed the problem."}], "answers": [{"tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": false, "score": 1, "last_activity_date": 1512411467, "creation_date": 1512411467, "answer_id": 47639533, "question_id": 47638079, "link": "https://stackoverflow.com/questions/47638079/reinstalling-intero-using-stack/47639533#47639533", "title": "Reinstalling intero using stack", "body": "<p>There is an issue about this <a href=\"https://github.com/commercialhaskell/stack/issues/3083\" rel=\"nofollow noreferrer\">here</a>.  Workaround for now is to also do <code>rm ~/Users/amir/.stack/snapshots/x86_64-osx/lts-9.14/8.0.2/installed-packages/intero-*</code></p>\n"}], "owner": {"reputation": 89, "user_id": 7149571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f9f9d7b534eccc7a6af42b25197abff?s=128&d=identicon&r=PG&f=1", "display_name": "Amir", "link": "https://stackoverflow.com/users/7149571/amir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 721, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512411467, "creation_date": 1512405957, "last_edit_date": 1512406061, "question_id": 47638079, "link": "https://stackoverflow.com/questions/47638079/reinstalling-intero-using-stack", "title": "Reinstalling intero using stack", "body": "<p>I deleted intero from <code>~/Users/amir/.stack/snapshots/x86_64-osx/lts-9.14/8.0.2/bin/</code>. Now if i run <code>stack install intero</code>. I get the following error:</p>\n\n<pre><code>Couldn't find executable intero in directory ~/.stack/snapshots/x86_64-osx/lts-9.14/8.0.2/bin/\n</code></pre>\n\n<p>Is there any way to force reinstalling? I tried <code>--force-dirty</code> as well.</p>\n"}, {"tags": ["haskell", "nix"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1512401842, "post_id": 47636243, "comment_id": 82231687, "body": "You can probably define a function that includes its argument as a package with profiling. You might also just want to do it the slow, repetitive way in a <code>shell.nix</code> file instead of specifying everything on the command line."}, {"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "edited": false, "score": 0, "creation_date": 1524176479, "post_id": 47636243, "comment_id": 86878035, "body": "For whomever might end up here from Google: <a href=\"https://nixos.org/nixpkgs/manual/#how-to-build-with-profiling-enabled\" rel=\"nofollow noreferrer\">nixos.org/nixpkgs/manual/#how-to-build-with-profiling-enable&zwnj;&#8203;d</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 0, "creation_date": 1512488948, "post_id": 47639503, "comment_id": 82273527, "body": "As it turns out, I may need to sneak in <code>-fprof-auto</code> somewhere in there."}], "tags": [], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "is_accepted": true, "score": 2, "last_activity_date": 1512420111, "last_edit_date": 1512420111, "creation_date": 1512411353, "answer_id": 47639503, "question_id": 47636243, "link": "https://stackoverflow.com/questions/47636243/with-nix-how-can-i-specify-haskell-dependencies-with-profiling-enabled/47639503#47639503", "title": "With Nix, how can I specify Haskell dependencies with profiling enabled?", "body": "<p>With further snooping around in <code>nix-repl</code> and some helpful pointers from ElvishJerricco on #reflex-frp at FreeNode, I was able to construct this, which seems to work:</p>\n\n<p><code>$ nix-shell -p \"(haskell.packages.ghc821.extend (self: super: {mkDerivation = expr: super.mkDerivation (expr // { enableLibraryProfiling = true; });})).ghcWithPackages (p: with p; [text hspec lens])\" -j4 --run 'ghc Main.hs -prof'</code></p>\n"}, {"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1573917085, "post_id": 48373811, "comment_id": 104049495, "body": "<a href=\"https://www.fosskers.ca/#orgc7fbdab\" rel=\"nofollow noreferrer\">fosskers.ca/#orgc7fbdab</a> I&#39;m guessing this is the blogpost? :)"}, {"owner": {"reputation": 1620, "user_id": 643684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/sGlFM.jpg?s=128&g=1", "display_name": "Colin Woodbury", "link": "https://stackoverflow.com/users/643684/colin-woodbury"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1574094001, "post_id": 48373811, "comment_id": 104099034, "body": "@ChrisStryczynski here is the safer link: <a href=\"https://www.fosskers.ca/blog/nix-en.html\" rel=\"nofollow noreferrer\">fosskers.ca/blog/nix-en.html</a>"}], "tags": [], "owner": {"reputation": 1620, "user_id": 643684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/sGlFM.jpg?s=128&g=1", "display_name": "Colin Woodbury", "link": "https://stackoverflow.com/users/643684/colin-woodbury"}, "is_accepted": false, "score": 1, "last_activity_date": 1516586892, "creation_date": 1516586892, "answer_id": 48373811, "question_id": 47636243, "link": "https://stackoverflow.com/questions/47636243/with-nix-how-can-i-specify-haskell-dependencies-with-profiling-enabled/48373811#48373811", "title": "With Nix, how can I specify Haskell dependencies with profiling enabled?", "body": "<p>I figured out a simple approach that I'm working into a largest blog post on Haskell development using Nix. For now, here's the text of just the profiling section:</p>\n\n<p>Nix makes this fairly easy. First, we add the following to a <code>~/.config/nixpkgs/config.nix</code>:</p>\n\n<pre><code>{\n  packageOverrides = super: let self = super.pkgs; in\n  {\n    profiledHaskellPackages = self.haskellPackages.override {\n      overrides = self: super: {\n        mkDerivation = args: super.mkDerivation (args // {\n          enableLibraryProfiling = true;\n        });\n      };\n    };\n  };\n}\n</code></pre>\n\n<p>Now in the project we want to profile, we create a new <code>profiling-shell.nix</code>:</p>\n\n<pre><code>let nixpkgs = import &lt;nixpkgs&gt; {};\n    orig = nixpkgs.pkgs.profiledHaskellPackages.callPackage ./default.nix {};\nin (nixpkgs.pkgs.haskell.lib.doBenchmark orig).env\n</code></pre>\n\n<p>Almost identical to our normal <code>shell.nix</code>, except for the usage of <code>profiledHaskellPackages</code>, which we just defined globally. Now, an invocation of <code>nix-shell profiling-shell.nix</code> will rebuild <em>every</em> dependency in our project with profiling enabled. The first time this is done it will take quite a long time. Luckily this doesn't corrupt our Nix store - a vanilla <code>nix-shell</code> does seem to present us with our regular dependencies again, without redownloading or rebuilding.</p>\n\n<p><strong>WARNING:</strong> A <code>nix-collect-garbage -d</code> will wipe away all the custom-built libs from our Nix Store, and we'd have to build them again if they're needed.</p>\n\n<p>If we're writing a library, the closest executable on hand that we could profile would be our benchmark suite. To do that:</p>\n\n<ul>\n<li>Add <code>-prof</code> and <code>-fprof-auto</code> to our benchmark's GHC options</li>\n<li>Regenerate <code>default.nix</code></li>\n<li>Enter our profiling shell: <code>nix-shell profiling-shell.nix</code></li>\n<li><code>cabal configure --enable-library-profiling --enable-benchmarks</code></li>\n<li><code>cabal build</code></li>\n<li><code>dist/build/projname/projname-bench +RTS -p</code></li>\n<li>Look at the produced <code>projname-bench.prof</code> file</li>\n</ul>\n\n<p>Based on the results, we can make code changes, remove the profiling options, regenerate <code>default.nix</code>, and benchmark as usual in our normal Nix Shell.</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 929, "favorite_count": 1, "accepted_answer_id": 47639503, "answer_count": 2, "score": 7, "last_activity_date": 1516586892, "creation_date": 1512399909, "last_edit_date": 1512400327, "question_id": 47636243, "link": "https://stackoverflow.com/questions/47636243/with-nix-how-can-i-specify-haskell-dependencies-with-profiling-enabled", "title": "With Nix, how can I specify Haskell dependencies with profiling enabled?", "body": "<p>I was trying like this initially:</p>\n\n<pre><code>nix-shell -p \"haskell.packages.ghc821.ghcWithPackages (p: with p; [text hspec lens])\" -j4 --run 'ghc Main.hs -prof\n</code></pre>\n\n<p>Then GHC told me </p>\n\n<pre><code>Main.hs:4:1: error:\n    Could not find module \u2018Control.Lens\u2019\n    Perhaps you haven't installed the profiling libraries for package \u2018lens-4.15.4\u2019?\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>Searching around the web I found this: <a href=\"https://github.com/NixOS/nixpkgs/issues/22340\" rel=\"noreferrer\">https://github.com/NixOS/nixpkgs/issues/22340</a></p>\n\n<p>So it seems I won't be able to download from the cache. But that's okay, if at least I can build the profiled variants locally.</p>\n\n<p>Can I do that somehow simply by modifying the nix expression given to <code>-p</code> slightly?</p>\n\n<p>Then at this point in writing this question, I remembered this resource: <a href=\"https://github.com/NixOS/nixpkgs/blob/bd6ba7/pkgs/development/haskell-modules/lib.nix\" rel=\"noreferrer\">https://github.com/NixOS/nixpkgs/blob/bd6ba7/pkgs/development/haskell-modules/lib.nix</a></p>\n\n<p>Where I found <code>enableLibraryProfiling</code>. So I tried:</p>\n\n<pre><code>nix-shell -p \"haskell.packages.ghc821.ghcWithPackages (p: with p; [text hspec (haskell.lib.enableLibraryProfiling lens)])\" -j4 --run 'ghc Main.hs -prof'\n</code></pre>\n\n<p>Which got me to a new error:</p>\n\n<pre><code>src/Control/Lens/Internal/Getter.hs:26:1: error:\n    Could not find module \u2018Data.Functor.Contravariant\u2019\n    Perhaps you haven't installed the profiling libraries for package \u2018contravariant-1.4\u2019?\n    Use -v to see a list of the files searched for.\n   |\n26 | import Data.Functor.Contravariant\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>So if I could map over all packages to <code>enableLibraryProfiling</code> on them, then I guess this could work. But my nix knowledge doesn't quite extend that far at the moment. How could I do that? And is this even the correct path to pursue?</p>\n"}, {"tags": ["list", "haskell", "text-parsing"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1512402996, "post_id": 47629927, "comment_id": 82232412, "body": "I assume you are a beginner - one tipp for the future, when you know a bit more haskell; revisit this exercise and implement a parser instead of just having a listof list of double values."}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1512464095, "post_id": 47629927, "comment_id": 82257232, "body": "yes @epsilonhalbe, I&#39;m a beginner and start to like this language. I will take your advise for the future. thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1512386006, "post_id": 47630134, "comment_id": 82221716, "body": "Thanks @Dan, I&#39;ve tried but some bug in String - Char things. A bit of edit then it works! I post the answer below."}, {"owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "reply_to_user": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 1, "creation_date": 1512386881, "post_id": 47630134, "comment_id": 82222251, "body": "@SirDK I think the type annotation I&#39;ve added should help."}], "tags": [], "owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "is_accepted": false, "score": 7, "last_activity_date": 1512386653, "last_edit_date": 1512386653, "creation_date": 1512379709, "answer_id": 47630134, "question_id": 47629927, "link": "https://stackoverflow.com/questions/47629927/haskell-parsing-line-of-text-into-a-list-of-list/47630134#47630134", "title": "Haskell :: Parsing Line of Text into a List of List", "body": "<p>You can use the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:lines\" rel=\"noreferrer\"><code>lines</code></a> function; for example <code>map words $ lines text</code>.</p>\n\n<p>This would also be a good time for a helper function, ie</p>\n\n<pre><code>let parse :: String -&gt; [Float]\n    parse line = map read $ words line\n    pcVal = map parse $ lines text\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "is_accepted": false, "score": 0, "last_activity_date": 1512385838, "creation_date": 1512385838, "answer_id": 47632006, "question_id": 47629927, "link": "https://stackoverflow.com/questions/47629927/haskell-parsing-line-of-text-into-a-list-of-list/47632006#47632006", "title": "Haskell :: Parsing Line of Text into a List of List", "body": "<p>Thanks Dan for suggesting lines as the solution. Here is the code that works fine with my question:</p>\n\n<pre><code>main = do\n    text &lt;- readFile \"mytext.txt\" \n    let\n        readparse txtLines = map read txtLines :: [Float]\n        parse txtLines = map (words) (lines txtLines)\n        pcval = map readparse (parse text) \n    print pcVal\n    return ()\n</code></pre>\n\n<p>Hope it help others too. Thanks and cheers!</p>\n"}], "owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1512386653, "creation_date": 1512378948, "last_edit_date": 1512379607, "question_id": 47629927, "link": "https://stackoverflow.com/questions/47629927/haskell-parsing-line-of-text-into-a-list-of-list", "title": "Haskell :: Parsing Line of Text into a List of List", "body": "\n\n\n\n\n\n\n\n<p>Hi guys,</p>\n\n<p>I'm parsing a text file which look like this:</p>\n\n<pre><code>114.474998474121 15.7440004348755 25.806999206543 -873 172 182 188 \n114.46199798584 15.7419996261597 25.8799991607666 -1396 180 192 205 \n</code></pre>\n\n<p>And wish it can read as like this:</p>\n\n<pre><code>[[114.475,15.744,25.807,-873.0,172.0,182.0,188.0],\n[114.462,15.742,25.88,-1396.0,180.0,192.0,205.0]]\n</code></pre>\n\n<p>Currently my code for this text parsing doesn't give that. Here is my code:</p>\n\n<pre><code>main = do\n    text &lt;- readFile \"mytext.txt\" \n    let\n        pcVal = map read (words text) :: [Float]\n    print pcVal\n    return ()\n</code></pre>\n\n<p>This code parsed all the text as a single list like this: </p>\n\n<pre><code>[114.475,15.744,25.807,-873.0,172.0,182.0,188.0,\n114.462,15.742,25.88,-1396.0,180.0,192.0,205.0]\n</code></pre>\n\n<p>I couldn't find how to take the whole single line (in text file) as a list, and the second line as another list till end of the file. Appreciate if somebody have experience in this. Thanks.</p>\n"}, {"tags": ["haskell", "type-conversion"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 6, "creation_date": 1512339488, "post_id": 47623844, "comment_id": 82205705, "body": "<code>read</code>ing after <code>readLn</code> is a bad idea. <code>readLn = readIO =&lt;&lt; getLine</code> so you&#39;ll read a line, parse that into a <code>String</code> (requiring proper quoting and escaping), and then parse that <i>again</i> into a number. Just use <code>readLn</code>"}], "answers": [{"comments": [{"owner": {"reputation": 201, "user_id": 7089758, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/189983078119537/picture?type=large", "display_name": "Kuba Krzy\u017cy\u0144ski", "link": "https://stackoverflow.com/users/7089758/kuba-krzy%c5%bcy%c5%84ski"}, "edited": false, "score": 0, "creation_date": 1512339803, "post_id": 47623873, "comment_id": 82205814, "body": "This code compiles fine but when I&#39;m trying to run <code>.exe</code> file I get this message: <code>user error (Prelude.readIO: no parse)</code>"}, {"owner": {"reputation": 201, "user_id": 7089758, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/189983078119537/picture?type=large", "display_name": "Kuba Krzy\u017cy\u0144ski", "link": "https://stackoverflow.com/users/7089758/kuba-krzy%c5%bcy%c5%84ski"}, "edited": false, "score": 0, "creation_date": 1512339960, "post_id": 47623873, "comment_id": 82205848, "body": "it&#39;s working after changing <code>readLn</code> to <code>getLine</code> as @HTNW suggested"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 201, "user_id": 7089758, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/189983078119537/picture?type=large", "display_name": "Kuba Krzy\u017cy\u0144ski", "link": "https://stackoverflow.com/users/7089758/kuba-krzy%c5%bcy%c5%84ski"}, "edited": false, "score": 0, "creation_date": 1512341221, "post_id": 47623873, "comment_id": 82206149, "body": "@KubaKrzy\u017cy\u0144ski whoops, yes :)"}, {"owner": {"reputation": 1536, "user_id": 588611, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/f1ef7d612f498f57d5c1f6b82cf83d12?s=128&d=identicon&r=PG", "display_name": "Shulhi Sapli", "link": "https://stackoverflow.com/users/588611/shulhi-sapli"}, "reply_to_user": {"reputation": 201, "user_id": 7089758, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/189983078119537/picture?type=large", "display_name": "Kuba Krzy\u017cy\u0144ski", "link": "https://stackoverflow.com/users/7089758/kuba-krzy%c5%bcy%c5%84ski"}, "edited": false, "score": 0, "creation_date": 1512350763, "post_id": 47623873, "comment_id": 82208411, "body": "@KubaKrzy\u017cy\u0144ski I suggest you use <code>readMaybe</code> from <code>Text.Read</code> instead of <code>read</code> because <code>read</code> is not total."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1512361455, "post_id": 47623873, "comment_id": 82210650, "body": "Or use <code>number &lt;- readLn</code> as in the original.  But there is no need to <code>read</code> the <code>number</code> -- <code>readLn</code> already does that for you.  Just <code>print $ power number</code>"}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 6, "last_activity_date": 1512350543, "last_edit_date": 1512350543, "creation_date": 1512338955, "answer_id": 47623873, "question_id": 47623844, "link": "https://stackoverflow.com/questions/47623844/haskell-convert-type-error/47623873#47623873", "title": "Haskell convert type error", "body": "<p>It helps when you write out the types.</p>\n\n<pre><code>power :: (Num a, Integral b) =&gt; b -&gt; a\npower a = 2^a\n\nmain :: IO ()\nmain = do\n  number &lt;- getLine\n  let x = read number :: Int\n  power x\n</code></pre>\n\n<p>But let's look what these things really return. <code>power</code> looks right, but <code>main</code> is trying to return a <code>Num a</code>, not an <code>IO ()</code>. <code>main</code> is not meant to return values -- you should do something with them. Maybe you want to <code>print</code> the result? <code>print :: Show a =&gt; a -&gt; IO ()</code></p>\n\n<pre><code>main :: IO ()\nmain = do\n  number &lt;- getLine\n  let x = read number :: Int\n  print $ power x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4546, "user_id": 1546473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c8bc03863b8d1b0cc086d2319cda57c?s=128&d=identicon&r=PG", "display_name": "Andreas R&#246;hler", "link": "https://stackoverflow.com/users/1546473/andreas-r%c3%b6hler"}, "is_accepted": false, "score": 1, "last_activity_date": 1512383990, "creation_date": 1512383990, "answer_id": 47631445, "question_id": 47623844, "link": "https://stackoverflow.com/questions/47623844/haskell-convert-type-error/47631445#47631445", "title": "Haskell convert type error", "body": "<p>Got it running that way - <code>number</code> is not an <code>Int</code>:</p>\n\n<pre><code>power :: (Num a, Integral b) =&gt; b -&gt; a\npower a = 2^a\n\nmain :: IO ()\nmain = do\n  number &lt;- getLine\n  let x = read number\n  print $ power x\n</code></pre>\n"}], "owner": {"reputation": 201, "user_id": 7089758, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/189983078119537/picture?type=large", "display_name": "Kuba Krzy\u017cy\u0144ski", "link": "https://stackoverflow.com/users/7089758/kuba-krzy%c5%bcy%c5%84ski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 47623873, "answer_count": 2, "score": 1, "last_activity_date": 1512383990, "creation_date": 1512338782, "question_id": 47623844, "link": "https://stackoverflow.com/questions/47623844/haskell-convert-type-error", "title": "Haskell convert type error", "body": "<p>I'm writing a simple program in Haskell that lets user input exponent of the power of 2<br /></p>\n\n<pre><code>power a = 2^a\nmain = do\n   number &lt;- readLn\n   let x = (read number :: Int)\n   power x\n</code></pre>\n\n<p><br /> I figured out that I need to convert <code>String</code> to <code>Int</code> but i still get following error: <code>No instance for (Num (IO t0)) arising from a use of 'power'</code> <br /> How do I make it work?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 3, "creation_date": 1512336822, "post_id": 47623458, "comment_id": 82204933, "body": "The error message is pretty simple, you&#39;re calling tail with an empty list. Step through your algorithm and think what could cause that to occur."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7302428"}, "reply_to_user": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 0, "creation_date": 1512337041, "post_id": 47623458, "comment_id": 82205002, "body": "Iv tried that but i haven&#39;t found problem, could you point me what I need to change?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1512337154, "post_id": 47623458, "comment_id": 82205044, "body": "I&#39;d guess at some point <code>xs</code> becomes empty, triggering the error. This is why <code>head,tail</code> should be avoided. Sure, you do check <code>any null xss</code> at the beginning to prevent that, but this property is not necessarily preserves at each recursive call. (Is your code trying to do something like <code>concat . transpose</code>, by the way?)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512337600, "post_id": 47623458, "comment_id": 82205173, "body": "By the way, you could try to use the GHCi debugger to see what&#39;s going on. <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#debugging-exceptions\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1512379251, "post_id": 47623458, "comment_id": 82217725, "body": "Try <code>map head . takeWhile ((==1) . length) . map group . transpose</code>"}], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 3, "last_activity_date": 1512341131, "last_edit_date": 1512341131, "creation_date": 1512340864, "answer_id": 47624133, "question_id": 47623458, "link": "https://stackoverflow.com/questions/47623458/haskell-error-on-program/47624133#47624133", "title": "Haskell Error on program", "body": "<p>I can\u2019t quite work out what your function is supposed to do. It doesn\u2019t make sense to me as a reasonable thing to want. Here\u2019s what it looks like to me:</p>\n\n<p>You take some list of lists (let\u2019s say it\u2019s a matrix for now as I\u2019m about to talk about columns) and you want to return the longest prefix of the first row such that each element is in a constant column.</p>\n\n<p>So let\u2019s try to write this in a more idiomatic way. </p>\n\n<p>Now we want to look for constantness in columns, but what should we do if the rows aren\u2019t the same length? I\u2019m going to decide that we\u2019ll just ignore them and imagine shoving all elements upwards so that there are no gaps. Let\u2019s convert rows to columns:</p>\n\n<pre><code>transpose :: [[a]] -&gt; [[a]]\ntranspose xss = t xss where\n  n = maximum (map length xss)\n  t [] = repeat n []\n  t (xs:xss) = join xs (t xss)\n  join [] yss = yss\n  join (x:xs) (ys:yss) = (x:ys) : join xs yss\n</code></pre>\n\n<p>So now we can write the function.</p>\n\n<pre><code>myWeirdFunction xss\n  | any null xss = []\n  | otherwise = map head $ takeWhile constant $ transpose xss where\n    constant (x:xs) = c x xs\n    c x (y:ys) | y == x = c x ys\n               | True   = False\n    c x [] = True\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7302428"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1512341131, "creation_date": 1512336233, "last_edit_date": 1512340851, "question_id": 47623458, "link": "https://stackoverflow.com/questions/47623458/haskell-error-on-program", "title": "Haskell Error on program", "body": "<p>just working on a problem and it keeps giving me this error:\nException: Prelude.tail: empty list</p>\n\n<p>Here is my code so far:</p>\n\n<pre><code>lxP :: Eq a =&gt; [[a]] -&gt; [a]\nlxP []   = []\nlxP xss \n   | any null xss = []\n   | otherwise    = loop xss []\n   where loop ::Eq b =&gt; [[b]] -&gt; [b] -&gt; [b] \n         loop xss acc =        \n               let xs = concatMap (take 1) xss\n               in if any (\\x -&gt; x /= head xs) (tail xs)       \n                     then reverse acc\n                     else loop (map tail xss) (head xs : acc)\n</code></pre>\n\n<p>Any idea if my indentation is the problem or is it something with the code?\nPS. How could I improve the efficiency?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1512330657, "post_id": 47622491, "comment_id": 82203018, "body": "The first thing I question here is why this is all <code>IO</code>. You have completely arbitrary print statements in the middle (possibly debugging statements) and no other I/O. Eliminating the <code>IO</code> monad dependency would probably open you up to some more reductions between <code>Maybe</code> and <code>Either</code>."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1512330841, "post_id": 47622491, "comment_id": 82203072, "body": "The reason for IO is because <code>fileReferenceContent</code> is of type <code>FileReference -&gt; IO (Maybe Text)</code>. I could possibly provide a simpler example if it helps."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512331709, "post_id": 47622491, "comment_id": 82203346, "body": "Perhaps you should craft a <code>[IO (Maybe (Either String Text))]</code>, with <code>Nothing</code> meaning &quot;try the next case in the list&quot;, and <code>Just</code> meaning &quot;stop here, we have a result&quot;."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1512340962, "post_id": 47622491, "comment_id": 82206104, "body": "That&#39;s not the monomorphism restriction by the way. It&#39;s just a requirement of homogeneous lists that all the elements have the same type."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1512736750, "last_edit_date": 1512736750, "creation_date": 1512332093, "answer_id": 47622826, "question_id": 47622491, "link": "https://stackoverflow.com/questions/47622491/how-can-i-handle-nested-case-statements-without-an-indentation-tree/47622826#47622826", "title": "How can I handle nested case statements without an indentation tree?", "body": "<p>Translating the exact example (keeping the non-exhaustive pattern matching as it is):</p>\n\n<pre><code>import Data.Foldable\n\n\nexample2 :: Int -&gt; Maybe String\nexample2 x = asum tests\n   where\n   tests =\n      [ case abc x of \n         \"yes\" -&gt; Just \"abc\"\n         \"no\"  -&gt; Nothing\n      , case abc2 x of\n         1.0 -&gt; Just \"abc2\"\n         2.0 -&gt; Nothing\n      , case abc3 x of\n         100 -&gt; Just \"abc3\"\n         200 -&gt; Nothing\n      ]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512332448, "post_id": 47622859, "comment_id": 82203591, "body": "If we need to use pattern matching (instead of <code>Eq</code>), we can also abuse <code>do</code> notation or even monad comprehensions, relying on <code>fail &quot;...&quot;</code> being <code>Nothing</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1512332246, "creation_date": 1512332246, "answer_id": 47622859, "question_id": 47622491, "link": "https://stackoverflow.com/questions/47622491/how-can-i-handle-nested-case-statements-without-an-indentation-tree/47622859#47622859", "title": "How can I handle nested case statements without an indentation tree?", "body": "<p>At least when the result is <code>Maybe</code>, this looks like a clear-cut use case for the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Applicative.html#t:Alternative\" rel=\"nofollow noreferrer\"><code>Alternative</code></a> instance:</p>\n\n<pre><code>example x = (\"abc\" &lt;$ guard (abc x==\"yes\"))\n         &lt;|&gt;(\"abc2\" &lt;$ guard (abc2 x==1))\n         &lt;|&gt;(\"abc3\" &lt;$ guard (abc3 x==100))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 3, "last_activity_date": 1512333138, "creation_date": 1512333138, "answer_id": 47622985, "question_id": 47622491, "link": "https://stackoverflow.com/questions/47622491/how-can-i-handle-nested-case-statements-without-an-indentation-tree/47622985#47622985", "title": "How can I handle nested case statements without an indentation tree?", "body": "<p>I'm going to work with your original example. A contrived example like your second one is unlikely to simplify nicely, whereas your first one looks like monad transformer code is actually something you might see in production.</p>\n\n<p>Looking for a general \"if-then-case\" statement like you seem to is not going to end fruitfully. That's because case-statements are really the catch-all in Haskell, and reductions are going to be more specific, not more general, than <code>case</code>. So with that in mind, let's take a look at your code.</p>\n\n<pre><code>parseLine :: Text -&gt; IO (Either String Text)\nparseLine x = do\n  let xStr = convertString x :: String\n  case parse (parseFileReference) \"file reference\" xStr of\n    Right z -&gt; do\n      print z\n      fileReferenceContent z &gt;&gt;= \\case\n        Just v' -&gt; return2x $ \"```\\n\" &lt;&gt; v' &lt;&gt; \"```\"\n        Nothing -&gt; return $ Left \"Unable to parse\"\n    Left _ -&gt; case parse (parseGitDiffReference) \"git diff tag\" xStr of\n        Right z -&gt; do\n          print z\n          return2x $ \"\"\n        Left _ -&gt; case parse (parsePossibleTag) \"possible tag\" xStr of\n          Right _ -&gt; return $ Left $ \"Tag that failed to match: \" ++ xStr\n          Left _ -&gt; return2x x\n</code></pre>\n\n<p>In each case, when you parse, you ignore the contents if it's a <code>Left</code>. So let's strip out that pointless data that you ignore.</p>\n\n<pre><code>eitherToMaybe :: Either a b -&gt; Maybe b\neitherToMaybe (Left _) = Nothing\neitherToMaybe (Right x) = Just x\n\nparse' :: Foo0 -&gt; String -&gt; String -&gt; Maybe Bar -- where Foo0 and Bar are the correct types\nparse' foo s0 s1 = eitherToMaybe $ parse foo s0 s1\n</code></pre>\n\n<p>Then call <code>parse'</code> instead of <code>parse</code>. This doesn't, as yet, improve anything. But let's refactor a bit more and then we'll see what it gets us. I want all of the \"success\" cases (which were <code>Right z</code> before and are <code>Just z</code> in the new <code>parse'</code> code) to be in a <code>where</code> block.</p>\n\n<pre><code>parseLine x = do\n  let xStr = convertString x :: String\n  case parse' (parseFileReference) \"file reference\" xStr of\n    Just z -&gt; fileRef z\n    Nothing -&gt; case parse' (parseGitDiffReference) \"git diff tag\" xStr of\n        Just z -&gt; gitDiff z\n        Nothing -&gt; case parse' (parsePossibleTag) \"possible tag\" xStr of\n          Just _ -&gt; tagMatch xStr\n          Nothing -&gt; return2x x\n    where fileRef z = do\n                print z\n                fileReferenceContent z &gt;&gt;= \\case\n                      Just v' -&gt; return2x $ \"```\\n\" &lt;&gt; v' &lt;&gt; \"```\"\n                      Nothing -&gt; return $ Left \"Unable to parse\"\n          gitDiff z = do\n                print z\n                return2x \"\"\n          tagMatch xStr = do\n                return (Left $ \"Tag that failed to match: \" ++ xStr)\n</code></pre>\n\n<p>Once again, no real benefit yet. But here's the thing: <code>Maybe</code> has an <code>Alternative</code> instance that does exactly what you want, whereas <code>Either</code> does not. Specifically, it will select the first successful match while ignoring the others. Let's pull out the matches and then go from there.</p>\n\n<pre><code>parseLine :: Text -&gt; IO (Either String Text)\nparseLine x = do\n  let xStr = convertString x :: String\n  case parseFile xStr of\n    Just z -&gt; fileRef z\n    Nothing -&gt; case parseDiff xStr of\n        Just z -&gt; gitDiff z\n        Nothing -&gt; case parseTag xStr of\n          Just _ -&gt; tagMatch xStr\n          Nothing -&gt; return2x x\n    where parseFile = parse' (parseFileReference) \"file reference\"\n          parseDiff = parse' (parseGitDiffReference) \"git diff tag\"\n          parseTag  = parse' (parsePossibleTag) \"possible tag\"\n          fileRef z = do\n                print z\n                fileReferenceContent z &gt;&gt;= \\case\n                      Just v' -&gt; return2x $ \"```\\n\" &lt;&gt; v' &lt;&gt; \"```\"\n                      Nothing -&gt; return $ Left \"Unable to parse\"\n          gitDiff z = do\n                print z\n                return2x \"\"\n          tagMatch xStr = do\n                return (Left $ \"Tag that failed to match: \" ++ xStr)\n</code></pre>\n\n<p>Now here's where the magic happens. <code>Alternative</code> for <code>Maybe</code> will select the first successful match. So we're going to use <code>asum</code>, which sums up a list of alternatives using the <code>Alternative</code> instance.</p>\n\n<pre><code>parseLine :: Text -&gt; IO (Either String Text)\nparseLine x = do\n  let xStr = convertString x :: String\n  let result = asum [\n                fileRef &lt;$&gt; parseFile xStr,\n                gitDiff &lt;$&gt; parseDiff xStr,\n                tagMatch xStr &lt;$ parseTag xStr -- Not a typo, the operator is (&lt;$) since you ignore the value\n               ]\n  maybe failure id result\n    where ...\n          failure = return2x x\n</code></pre>\n\n<p>At the end, we're left with <code>result :: Maybe (IO (Either String Text)). If it exists, we want to return it unmodified. If it doesn't, we want to fall back to</code>failure<code>. So we use</code>maybe`, which is more compact than a full case statement here.</p>\n\n<p>Finally, in <code>fileRef</code> we can factor out the pattern of \"custom error message on failure\".</p>\n\n<pre><code>maybeToEither :: a -&gt; Maybe b -&gt; Either a b\nmaybeToEither x Nothing  = Left x\nmaybeToEither _ (Just y) = Right y\n</code></pre>\n\n<p>Then that statement becomes</p>\n\n<pre><code>fileRef z = do\n     print z\n     value &lt;- maybeToEither \"Unable to parse\" &lt;$&gt; fileReferenceContent z\n     return $ (\\v' -&gt; \"```\\n\" &lt;&gt; v' &lt;&gt; \"```\") &lt;$&gt; value\n</code></pre>\n\n<p>So the final code looks like</p>\n\n<pre><code>eitherToMaybe :: Either a b -&gt; Maybe b\neitherToMaybe (Left _) = Nothing\neitherToMaybe (Right x) = Just x\n\nparse' :: Foo0 -&gt; String -&gt; String -&gt; Maybe Bar -- where Foo0 and Bar are the correct types\nparse' foo s0 s1 = eitherToMaybe $ parse foo s0 s1\n\nmaybeToEither :: a -&gt; Maybe b -&gt; Either a b\nmaybeToEither x Nothing  = Left x\nmaybeToEither _ (Just y) = Right y\n\nparseLine :: Text -&gt; IO (Either String Text)\nparseLine x = do\n  let xStr = convertString x :: String\n  let result = asum [\n                fileRef &lt;$&gt; parseFile xStr,\n                gitDiff &lt;$&gt; parseDiff xStr,\n                tagMatch xStr &lt;$ parseTag xStr\n               ]\n  maybe failure id result\n    where parseFile = parse' (parseFileReference) \"file reference\"\n          parseDiff = parse' (parseGitDiffReference) \"git diff tag\"\n          parseTag  = parse' (parsePossibleTag) \"possible tag\"\n          fileRef z = do\n                print z\n                value &lt;- maybeToEither \"Unable to parse\" &lt;$&gt; fileReferenceContent z\n                return $ (\\v' -&gt; \"```\\n\" &lt;&gt; v' &lt;&gt; \"```\") &lt;$&gt; value\n          gitDiff z = do\n                print z\n                return2x \"\"\n          tagMatch xStr = do\n                return (Left $ \"Tag that failed to match: \" ++ xStr)\n          failure = return2x x\n</code></pre>\n\n<p>It's not shorter than the original code, but it has less nested case alternatives, and it certainly reads more linearly.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1567, "favorite_count": 0, "accepted_answer_id": 47622826, "answer_count": 3, "score": 3, "last_activity_date": 1512736750, "creation_date": 1512330132, "last_edit_date": 1512332443, "question_id": 47622491, "link": "https://stackoverflow.com/questions/47622491/how-can-i-handle-nested-case-statements-without-an-indentation-tree", "title": "How can I handle nested case statements without an indentation tree?", "body": "<p>I occasionally run into a minor issue where I've got a set of nested case statements, which becomes cumbersome to handle. Is there any technique / pattern I can use to possibly have a list of functions (which would be equivalent to the examples's <code>case ...</code> statements), evaluate all of them, and pick the first that matches a pattern (example: <code>Right x</code>)? </p>\n\n<p>A specific issue I have with putting them in a list, is they won't necessarily be of the same type (the monomorphism restriction I think). For example the following:</p>\n\n<pre><code>  let possibleTags = [\n          parse (parseFileReference) \"file reference\" xStr\n        , parse (parseGitDiffReference) \"git diff tag\" xStr\n        ]\n</code></pre>\n\n<p>Produces the following error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018GitDiffReference\u2019 with \u2018FileReference\u2019\n  Expected type: Either ParseError FileReference\n    Actual type: Either ParseError GitDiffReference\n\u2022 In the expression:\n    parse (parseGitDiffReference) \"git diff tag\" xStr\n  In the expression:\n    [parse (parseFileReference) \"file reference\" xStr,\n     parse (parseGitDiffReference) \"git diff tag\" xStr]\n  In an equation for \u2018possibleTags\u2019:\n      possibleTags\n        = [parse (parseFileReference) \"file reference\" xStr,\n           parse (parseGitDiffReference) \"git diff tag\" xStr]\n</code></pre>\n\n<hr>\n\n<pre><code>abc :: Int -&gt; String\nabc = undefined\n\nabc2 :: Int -&gt; Float\nabc2 = undefined\n\nabc3 :: Int -&gt; Int\nabc3 = undefined\n\nexample :: Int -&gt; Maybe String\nexample x = case abc x of \n  (\"yes\") -&gt; Just \"abc\"\n  (\"no\")  -&gt; case abc2 x of\n               1.0 -&gt; Just \"abc2\"\n               2.0 -&gt; case abc3 x of\n                        100 -&gt; Just \"abc3\"\n                        200 -&gt; Nothing\n</code></pre>\n\n<p>I'm ideally looking for something like the below (not valid code):</p>\n\n<pre><code>-- Psuedo code\nexample :: Int -&gt; Maybe String\nexample = \n if (abc x &amp;&amp; \"yes\") then Just \"abc\"\n if (abc2 x &amp;&amp; 1.0) then Just \"abc2\"\n if (abc3 x &amp;&amp; 100) then Just \"abc3\"\n</code></pre>\n\n<p>The problem with using <code>if</code> conditional is I can't(to my knowledge) do a pattern match, for example <code>if (Just x)</code>.</p>\n"}, {"tags": ["haskell", "yesod", "heroku-postgres"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 4, "creation_date": 1512331251, "post_id": 47622262, "comment_id": 82203214, "body": "Make sure that you have listed <code>persistent-postgresql</code> in your cabal ( or package.yaml file)"}, {"owner": {"reputation": 8576, "user_id": 327074, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/785321440230453d4a2a721f753bd538?s=128&d=identicon&r=PG", "display_name": "icc97", "link": "https://stackoverflow.com/users/327074/icc97"}, "edited": false, "score": 0, "creation_date": 1512382580, "post_id": 47622262, "comment_id": 82219744, "body": "Have you looked through the more general &quot;failed to load interface&quot; question?: <a href=\"https://stackoverflow.com/questions/20446802/failed-to-load-interface-error-when-loading-compiled-modules-in-ghci\" title=\"failed to load interface error when loading compiled modules in ghci\">stackoverflow.com/questions/20446802/&hellip;</a>"}, {"owner": {"reputation": 8576, "user_id": 327074, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/785321440230453d4a2a721f753bd538?s=128&d=identicon&r=PG", "display_name": "icc97", "link": "https://stackoverflow.com/users/327074/icc97"}, "edited": false, "score": 0, "creation_date": 1512382673, "post_id": 47622262, "comment_id": 82219794, "body": "This seems very similar to the previous question that you asked on here: <a href=\"https://stackoverflow.com/q/47291657/327074\">stackoverflow.com/q/47291657/327074</a>"}, {"owner": {"reputation": 41, "user_id": 6876476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f97aa92a4282a037d5d34867e3beff11?s=128&d=identicon&r=PG", "display_name": "Flavia", "link": "https://stackoverflow.com/users/6876476/flavia"}, "edited": false, "score": 0, "creation_date": 1512587631, "post_id": 47622262, "comment_id": 82322676, "body": "I fixed the error installing cabal dependences: cabal install --only-dependencies"}], "owner": {"reputation": 41, "user_id": 6876476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f97aa92a4282a037d5d34867e3beff11?s=128&d=identicon&r=PG", "display_name": "Flavia", "link": "https://stackoverflow.com/users/6876476/flavia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 227, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1512382224, "creation_date": 1512328764, "last_edit_date": 1512382224, "question_id": 47622262, "link": "https://stackoverflow.com/questions/47622262/problems-using-a-postgres-database-in-a-haskell-yesod-application", "title": "Problems using a Postgres database in a Haskell Yesod application", "body": "<p>I'm trying to use a Heroku Postgres database on my Yesod application in a c9 workspace, but the following error message appears when the stack build command is running:</p>\n\n<pre><code> $ stack build\n    projeto-0.0.0: build (lib + exe)\n    Preprocessing library projeto-0.0.0...\n    [ 9 of 15] Compiling Handler.Cliente  ( src/Handler/Cliente.hs, .stack-work/dist/x86_64-linux/Cabal-1.24.2.0/build/Handler/Cliente.o )\n\n    /home/ubuntu/workspace/projeto/src/Handler/Cliente.hs:11:1: error:\n        Failed to load interface for \u2018Database.Persist.Postgresql\u2019\n        Use -v to see a list of the files searched for.\n\n    --  While building package projeto-0.0.0 using:\n          /home/ubuntu/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-linux/Cabal-1.24.2.0 build lib:projeto exe:projeto --ghc-options \" -ddump-hi -ddump-to-file\"\n        Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>What I should do?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1512326437, "post_id": 47621764, "comment_id": 82201579, "body": "See <a href=\"https://stackoverflow.com/questions/2675655/whats-the-for-in-a-haskell-class-definition?rq=1\" title=\"whats the for in a haskell class definition\">stackoverflow.com/questions/2675655/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 1, "last_activity_date": 1512326355, "creation_date": 1512326355, "answer_id": 47621862, "question_id": 47621764, "link": "https://stackoverflow.com/questions/47621764/wired-type-class-definition/47621862#47621862", "title": "Wired type class definition", "body": "<p>Those are <a href=\"https://wiki.haskell.org/Functional_dependencies\" rel=\"nofollow noreferrer\">functional dependencies</a>.</p>\n\n<p>Each of the clauses separated by a <code>,</code> after the <code>|</code> says that one type can be determined by another.</p>\n\n<p>For example <code>m -&gt; s</code> says that they type <code>s</code> can be determined from <code>m</code></p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 28, "favorite_count": 0, "closed_date": 1512328040, "answer_count": 1, "score": 0, "last_activity_date": 1512326355, "creation_date": 1512325863, "question_id": 47621764, "link": "https://stackoverflow.com/questions/47621764/wired-type-class-definition", "closed_reason": "Duplicate", "title": "Wired type class definition", "body": "<p>Could someone please explain it to me following type class definition</p>\n\n<pre><code>class (Monad m, Monad n) =&gt; MonadCompose m n s t | m -&gt; s, n -&gt; t, n s -&gt; m where  \n</code></pre>\n\n<p>What does <code>|</code>, <code>,</code> and <code>-&gt;</code> mean ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23, "user_id": 3079799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3af6fd8ef1f83bb1085d297871a9a71?s=128&d=identicon&r=PG&f=1", "display_name": "user3079799", "link": "https://stackoverflow.com/users/3079799/user3079799"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1512290097, "post_id": 47616492, "comment_id": 82191544, "body": "I can&#39;t give you a faulty implementation unfortunately, because I deleted it to start from scratch. But my approach would be a helper function like this: <code>generatePaths_h :: (Node -&gt; [Node]) -&gt; [Node] -&gt; [Node] -&gt; Node -&gt; Node -&gt; [[Node]]</code> where the second argument now is the path leading to the current node, and the second argument shall be a list of neighbors that still has to be iterated through. The remaining arguments are the same as in <code>generatePaths</code>"}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1512291989, "post_id": 47616492, "comment_id": 82191909, "body": "Is the graph directed? Which algorithm to solve this problem did you try to implement?"}, {"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 0, "creation_date": 1512293929, "post_id": 47616492, "comment_id": 82192397, "body": "Just use the depth first search algorithm if the graph is directed."}, {"owner": {"reputation": 23, "user_id": 3079799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3af6fd8ef1f83bb1085d297871a9a71?s=128&d=identicon&r=PG&f=1", "display_name": "user3079799", "link": "https://stackoverflow.com/users/3079799/user3079799"}, "edited": false, "score": 0, "creation_date": 1512296840, "post_id": 47616492, "comment_id": 82193089, "body": "Thx for the hint to dfs. I already thought about that but threw the idea away because I found no way to generate a list of lists (i.e. list of paths).  I post my implementation in the original question."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 3079799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3af6fd8ef1f83bb1085d297871a9a71?s=128&d=identicon&r=PG&f=1", "display_name": "user3079799", "link": "https://stackoverflow.com/users/3079799/user3079799"}, "edited": false, "score": 0, "creation_date": 1512480314, "post_id": 47618215, "comment_id": 82267604, "body": "sorry for the late response. Yeah I have to agree. Your function is much simpler and understandable than my attempt. Thx."}], "tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": true, "score": 2, "last_activity_date": 1512303032, "creation_date": 1512303032, "answer_id": 47618215, "question_id": 47616492, "link": "https://stackoverflow.com/questions/47616492/get-a-list-of-paths-through-a-graph/47618215#47618215", "title": "Get a list of paths through a graph", "body": "<p>Your recursion step</p>\n\n<pre><code>| otherwise = dfs_h graph (n:visited) ((graph n) ++ ns) end\n</code></pre>\n\n<p>looks weird. You try to handle the case that <code>n</code> is a valid intermediate node on your path. For the recursion, you therefore collect <code>n</code> in the <code>visited</code> log. The problem is, that <code>ns</code> - a list of further intermediate nodes in the current step - will be handled in the recursion step. Instead it should be handled with the unmodified current set of visited nodes.</p>\n\n<p>A simpler solution would be to separate you logging from the  computed intermediate results:</p>\n\n<pre><code>generatePaths :: (Node -&gt; [Node]) -&gt; Node -&gt; Node -&gt; [[Node]]\ngeneratePaths successors start end = map reverse $ dfs [] [[]] start\n  where\n    dfs :: [Node] -&gt; [[Node]] -&gt; Node -&gt; [[Node]]\n    dfs visited acc next\n      -- destination reached, add final step\n      | next == end = step next acc\n      -- circle detected, reject paths\n      | next `elem` visited = []\n      -- make one step, continue recursion\n      | otherwise = concat . map (dfs (next:visited) (step next acc)) $ successors next\n\n    -- add `next` to each of the current paths\n    step :: Node -&gt; [[Node]] -&gt; [[Node]]\n    step next = map ((:) next)\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 3079799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3af6fd8ef1f83bb1085d297871a9a71?s=128&d=identicon&r=PG&f=1", "display_name": "user3079799", "link": "https://stackoverflow.com/users/3079799/user3079799"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 457, "favorite_count": 1, "accepted_answer_id": 47618215, "answer_count": 1, "score": 2, "last_activity_date": 1512303032, "creation_date": 1512288221, "last_edit_date": 1512301494, "question_id": 47616492, "link": "https://stackoverflow.com/questions/47616492/get-a-list-of-paths-through-a-graph", "title": "Get a list of paths through a graph", "body": "<p>\nI am trying to get a list of lists of all possible paths through a graph with a given starting point and a destination. \nThe graph is given as follows:\n</p>\n\n<pre><code>data Node = N1 | N2 | N3 | N4 | N5 deriving (Show, Eq)\n\nneighbor :: Node -&gt; [Node]\nneighbor N1 = [N2, N4, N5]\nneighbor N2 = [N1, N3]\nneighbor N3 = [N1, N4, N5]\nneighbor N4 = [N5]\nneighbor N5 = [N1]\n</code></pre>\n\n<p>The problem is: given a start node and a destination node (e.g. start node = N1 and destination = N4) all possible routes, without cycles, leading from start to destination shall be the result. In the example given it would be: </p>\n\n<pre><code>[[N1, N2, N3, N4],[N1, N4]]\n</code></pre>\n\n<p>The function I am trying to solve this problem with is: </p>\n\n<pre><code>generatePaths :: (Node -&gt; [Node]) -&gt; Node -&gt; Node -&gt; [[Node]]\n</code></pre>\n\n<p>Here the first argument shall be the neighbor function, the second the start node and the third the destinaion node. </p>\n\n<p>My main problem is that I find now way on how to iterate through all neighbors and call <code>generatePaths</code> with every neighbor as new start node. </p>\n\n<p>Any help is highly appreciated</p>\n\n<p>EDIT:\nThx to Krom and RoadRunner I came up with an implementation. </p>\n\n<pre><code>dfs_h :: (Node -&gt; [Node]) -&gt; [Node] -&gt; [Node] -&gt; Node -&gt; [[Node]]\ndfs_h graph visited [] _ = [visited]\ndfs_h graph visited (n:ns) end \n    | elem n visited = (dfs_h graph visited ns end)\n    | elem end ns = [reverse (end:visited)] ++ (dfs_h graph visited (n:[neigh|neigh &lt;- ns, neigh /= end]) end)\n    | n == end = [reverse (end:visited)] ++ (dfs_h graph visited ns end)\n    | otherwise = dfs_h graph (n:visited) ((graph n) ++ ns) end\n\ndfs start end = filter (\\x -&gt; elem end x) (dfs_h neighbor [start] (neighbor start) end                         \n</code></pre>\n\n<p>I am aware that this isn't the most beautiful solution, just the first I came up with. </p>\n\n<p>EDIT2: \nBut a problem with this algorithm is when the graph looks like this: </p>\n\n<pre><code>neighbor :: Node -&gt; [Node]\nneighbor N1 = [N2, N3]\nneighbor N2 = [N5]\nneighbor N3 = [N4]\nneighbor N4 = [N2, N1]\nneighbor N5 = [N1]\n</code></pre>\n\n<p>and a path from <code>N1</code> to <code>N4</code> shall be found then the result of the function is </p>\n\n<pre><code>[[N1, N2, N5, N3, N4]]\n</code></pre>\n\n<p>Now I don't what to implement so that the <code>N2</code> and <code>N5</code>, which should not be part of the solution, don't get included. \nAny suggenstions?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1512264764, "post_id": 47614394, "comment_id": 82187280, "body": "Look up the source code for <code>filter</code>. You will find that <code>setSuchThat = filter</code>."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1512264767, "post_id": 47614394, "comment_id": 82187282, "body": "That would be impossible. There&#39;s an infinite number of possible strings. How would the program know when it has all of the values which will return <code>True</code>? A more realistic solution would be to use <code>filter</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1512269618, "post_id": 47614394, "comment_id": 82188019, "body": "If the only function you have to implement is <code>setSuchThat</code>, then let me suggest <code>type Set a = a -&gt; Bool</code>. You should then find <code>setSuchThat</code> trivial."}, {"owner": {"reputation": 97, "user_id": 5465340, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/49a662e8abbfb14408e6d0bcfd318703?s=128&d=identicon&r=PG&f=1", "display_name": "Frank", "link": "https://stackoverflow.com/users/5465340/frank"}, "edited": false, "score": 0, "creation_date": 1512270197, "post_id": 47614394, "comment_id": 82188119, "body": "Yeah, I am not entirely sure still what to do, but yes, there are more functions that need to be implemented such as unions and intersection."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1512310743, "post_id": 47614394, "comment_id": 82196589, "body": "It would be either <code>type Set a = [a]</code> or <code>data Set a = Set [a]</code>. The latter would be necessary if you want <code>Set</code> to be a distinct data structure, rather than just another name for a list. You would want that, since you don&#39;t really want <code>Set [1] ++ Set [1]</code> to be <code>Set [1,1]</code>, or even compile."}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 4, "last_activity_date": 1512274761, "creation_date": 1512274761, "answer_id": 47615213, "question_id": 47614394, "link": "https://stackoverflow.com/questions/47614394/creating-a-set-data-type/47615213#47615213", "title": "Creating a Set data type", "body": "<p>Following Daniel Wagner\u2019s suggestion, you can define a set as a <em>predicate</em> that indicates whether an element is in the set:</p>\n\n<pre><code>type Set a = a -&gt; Bool\n</code></pre>\n\n<p>For good measure, I\u2019ll use a <code>newtype</code> to make it clearer where we\u2019re using sets:</p>\n\n<pre><code>newtype Set a = Set { contains :: a -&gt; Bool }\n</code></pre>\n\n<p>Then <code>setSuchThat</code> just wraps a predicate in <code>Set</code>:</p>\n\n<pre><code>setSuchThat :: (a -&gt; Bool) -&gt; Set a\nsetSuchThat = Set\n</code></pre>\n\n<p>You can test for membership in a set using the <code>contains</code> function:</p>\n\n<pre><code>&gt; setSuchThat (== \"coke\") `contains` \"coke\"\nTrue\n\n&gt; setSuchThat (== \"coke\") `contains` \"pepsi\"\nFalse\n</code></pre>\n\n<p>So an empty set is just <code>setSuchThat (const False)</code>\u2014for any given element, it always answers the question \u201cDoes the set contain this element?\u201d with \u201cNo\u201d.</p>\n\n<p>Then you can implement functions such as <code>insert</code> to extend the set with a new element by <em>composing</em> the existing <code>contains</code> function with a new function:</p>\n\n<pre><code>insert :: (Eq a) =&gt; a -&gt; Set a -&gt; Set a\ninsert x s = Set $ \\ x' -&gt; x == x' || s `contains` x'\n\n&gt; insert \"pepsi\" (setSuchThat (== \"coke\")) `contains` \"pepsi\"\nTrue\n</code></pre>\n\n<p>Other functions like <code>union</code> are easy:</p>\n\n<pre><code>union :: Set a -&gt; Set a -&gt; Set a\nunion s1 s2 = Set $ \\ x -&gt; s1 `contains` x || s2 `contains` x\n\n&gt; let sodas = setSuchThat (== \"coke\") `union` setSuchThat (== \"pepsi\")\n\n&gt; sodas `contains` \"coke\"\nTrue\n\n&gt; sodas `contains` \"pepsi\"\nTrue\n\n&gt; sodas `contains` \"water\"\nFalse\n</code></pre>\n\n<p>As an exercise, try implementing other set functions like <code>delete</code>, <code>intersect</code>, and <code>difference</code>.</p>\n\n<p>One drawback to this approach is that every lookup is linear\u2014O(n)\u2014in the number of elements that have been inserted or deleted. In addition, you can\u2019t simply enumerate all the elements of the set to convert it to a list\u2014you can only enumerate <em>values</em> and <em>test</em> whether each one is an element. However, one <em>advantage</em> is that this lets you easily represent infinite sets; for example, <code>setSuchThat (&gt; 0)</code> contains all non-negative numbers.</p>\n\n<p>That\u2019s why the standard <code>Data.Set</code> type uses a tree-based data structure instead of functions, representing elements as their actual values. With that approach, values can be deleted without increasing the size of the set, and since it uses <code>Ord</code> instead of <code>Eq</code>, it achieves more efficient logarithmic\u2014O(log n)\u2014lookups and insertions.</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 7123695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77f2f5ee99afd6a097345b30d25d5871?s=128&d=identicon&r=PG&f=1", "display_name": "Fiend394", "link": "https://stackoverflow.com/users/7123695/fiend394"}, "is_accepted": false, "score": 1, "last_activity_date": 1512286960, "creation_date": 1512286960, "answer_id": 47616343, "question_id": 47614394, "link": "https://stackoverflow.com/questions/47614394/creating-a-set-data-type/47616343#47616343", "title": "Creating a Set data type", "body": "<p>To build on what <a href=\"https://stackoverflow.com/users/246886/jon-purdy\">Jon Purdy</a> has laid out:</p>\n\n<p>You need to think of the <code>Set a = a -&gt; Bool</code> as a restriction that you have to work with.  When you look at <code>setSuchThat :: (a -&gt; Bool) -&gt; (Set a)</code> you can read it to be the same as <code>setSuchThat :: (Set a) -&gt; (Set a)</code> or <code>setSuchThat :: (a -&gt; Bool) -&gt; (a -&gt; Bool)</code>.  <code>setSuchThat</code> is kind of like a mcguffin, it's just there to make using the functions more clear - it is unnecessary.  </p>\n\n<p>Everything you are doing is taking function <code>f</code> and applying it to variable <code>x</code>.  The entire point of <code>setSuchThat</code> is to be passed <code>f</code> and <code>x</code> and return  only <code>f x</code>.  </p>\n"}], "owner": {"reputation": 97, "user_id": 5465340, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/49a662e8abbfb14408e6d0bcfd318703?s=128&d=identicon&r=PG&f=1", "display_name": "Frank", "link": "https://stackoverflow.com/users/5465340/frank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1078, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1512286960, "creation_date": 1512264338, "question_id": 47614394, "link": "https://stackoverflow.com/questions/47614394/creating-a-set-data-type", "title": "Creating a Set data type", "body": "<p>So I need to create a Set data type in Haskell. </p>\n\n<p>So, for the first part of my question I need to define the </p>\n\n<pre><code>type Set a = ...\n</code></pre>\n\n<p>I have it set as</p>\n\n<pre><code>type Set a = Set [a]\n</code></pre>\n\n<p>because Set would just be a list of alphas, right?\nOr, would the correct way to do it be</p>\n\n<pre><code>type Set a = ([a])\n</code></pre>\n\n<p>Then, for the next part I need to implement a function</p>\n\n<pre><code>setSuchThat :: (a -&gt; Bool) -&gt; (Set a)\n</code></pre>\n\n<p>The function takes a characteristic function f and returns a set such that the value x(of appropriate type) is in the set only when f(x) is True. So an example of it in use would be, </p>\n\n<pre><code>setSuchThat (\\x -&gt; x == \"coke\")\n</code></pre>\n\n<p>So my question is now, is in that function I would essentially need to evaluate that function to get \"coke\" and then add it to my Set. I guess I just don't understand how, in this function, I would go about doing this.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 5, "creation_date": 1512253879, "post_id": 47613132, "comment_id": 82184846, "body": "Well how do you want to differentiate <code>b</code> and <code>b&#39;</code>? If your operator was simply defined in terms of two values of the same type, it&#39;s enough to wrap them in different wrappers."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1512257904, "post_id": 47613132, "comment_id": 82185933, "body": "I&#39;ve edited the comment to exclude that answer, I&#39;m looking for something pretty generic that allows liberal usage with low boilerplate."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1512271843, "post_id": 47613132, "comment_id": 82188341, "body": "if i am not mistaken, you can define a customized functor, applicative wrapper which carries a type level tag, maybe something like <code>Symbol</code>, or <code>Nat</code>. <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/GHC-TypeLits.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.10.0.0/docs/&hellip;</a> is it what you want to do?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512284462, "post_id": 47613132, "comment_id": 82190399, "body": "If construct and destruct are semantically the identity, what is to stop the user from just writing <code>construct ((-) &lt;$&gt; destruct c&#39; &lt;*&gt; destruct b)</code> instead (that is, even if you find a way to get the type system to reject the given term)? If they are not semantically the identity, under which conditions may they not be used? If you want to have a type which is only accessible using its <code>Applicative</code> instance, all you need is a (abstract) type <code>newtype T s t a = T (t a)</code> and a function <code>t a -&gt; (forall s . T s t a -&gt; T s t b) -&gt; t b</code> (but again, this adds no safety to your program)."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1512294726, "post_id": 47613132, "comment_id": 82192584, "body": "HuStmpHrr, that&#39;s interesting. It might be an important part of the solution. Thanks."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1512294888, "post_id": 47613132, "comment_id": 82192626, "body": "user2407038, that would be okay with me. The goal is not to prevent the user from doing well-defined things if they&#39;ve decided its right, but to make the correct thing by far the easiest and incorrect things less likely due to typos. However, I&#39;d be interested in a solution that prohibits even more because it&#39;s highly instructive and such a solution can get the karma if it comes more than a couple of days before another solution. I&#39;m not trying to restrict a thing to its applicative instance."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1512295860, "post_id": 47613132, "comment_id": 82192862, "body": "user2407038, to be clear, though, the newly constructed value couldn&#39;t be used with either c&#39; or b in your example. So it still defines a group of related values."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1512322086, "post_id": 47613132, "comment_id": 82200153, "body": "You&#39;re gonna have to give a more concrete example of what you&#39;re trying to achieve. In the case of <code>ZipList</code>s I can&#39;t think of any reason to prevent mixing and matching computations like that."}, {"owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "edited": false, "score": 0, "creation_date": 1512414306, "post_id": 47613132, "comment_id": 82238796, "body": "Benjamin Hodgson, This models games like &quot;subtract the number you first thought of&quot; with a single level of indirection allowing parallelism and problems with undefined results, etc, and allows symbolic computation instead of acting on lists, etc. It&#39;s a very generic thing that applies to problems that most programmers have solved in concrete ways in system programming, FRP, databases, etc. It&#39;s already unreasonably concrete."}], "answers": [{"tags": [], "owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "is_accepted": false, "score": 0, "last_activity_date": 1513509724, "creation_date": 1513509724, "answer_id": 47854574, "question_id": 47613132, "link": "https://stackoverflow.com/questions/47613132/how-do-i-use-that-haskell-type-system-to-describe-relationships-and-thus-prevent/47854574#47854574", "title": "How do I use that haskell type system to describe relationships and thus prevent more mistakes", "body": "<p>According to this comment:</p>\n\n<p><a href=\"https://softwareengineering.stackexchange.com/questions/279316/what-exactly-makes-the-haskell-type-system-so-revered-vs-say-java#comment605791_279362\">https://softwareengineering.stackexchange.com/questions/279316/what-exactly-makes-the-haskell-type-system-so-revered-vs-say-java#comment605791_279362</a></p>\n\n<blockquote>\n  <p>there's no way to have referential transparency and allow for analysis of self-referential graphs. If you can identify whether two references point to the same place then you are exactly violating referential transparency</p>\n</blockquote>\n\n<p>Ie, by the fundamental principles by which Haskell was designed, one cannot do what I wanted to in this way.</p>\n"}], "owner": {"reputation": 1155, "user_id": 962394, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/97268298c366b07e5556567639105ee1?s=128&d=identicon&r=PG", "display_name": "codeshot", "link": "https://stackoverflow.com/users/962394/codeshot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1513509724, "creation_date": 1512252627, "last_edit_date": 1512257834, "question_id": 47613132, "link": "https://stackoverflow.com/questions/47613132/how-do-i-use-that-haskell-type-system-to-describe-relationships-and-thus-prevent", "title": "How do I use that haskell type system to describe relationships and thus prevent more mistakes", "body": "<p>In this program, how can I use the type system to prevent imposter_d from type-checking so I can write functions where assumptions about relationships are checked. Here I have \"accidentally\" written imposter_d such that unrelated items are combined in error.</p>\n\n<p>Is there some type-system feature (possibly with extra classes, data types, newtypes, etc) which I can use for construct and destruct so that Haskell will allow d and d' to typecheck and not imposter_d - perhaps based on some type parameter which, although its exact type cannot be known is known to be the same for b and c, or for b' and c', but cannot be known to be the same type for b and c'?</p>\n\n<p>I want to avoid defining extra types for each place where I use construct - hence suspecting that universal quantification might be part of the solution.</p>\n\n<pre><code>module Foo where\n\nimport Control.Applicative\n\nconstruct = id\ndestruct = id\n\ntx = ZipList . reverse . getZipList\n\na = ZipList [1,2,3]\na' = tx a\n\nb = construct a\nc = (+1) &lt;$&gt; b\nd = (-) &lt;$&gt; c &lt;*&gt; b\ne = destruct d\n\n-- same thing but for data in a different arrangement\nb' = construct a'\nc' = (+1) &lt;$&gt; b'\nd' = (-) &lt;$&gt; c' &lt;*&gt; b'\ne' = destruct d'\n\n-- mixed the two arrangements together by mistake!!! oops, help me haskell!\nimposter_d = (-) &lt;$&gt; c' &lt;*&gt; b\nimposter_e = destruct imposter_d\n\nmain = do putStrLn $ show e\n          putStrLn $ show e'\n          putStrLn $ show imposter_e\n</code></pre>\n\n<p>e and e' are both ZipList [1, 1, 1] but imposter_e is different and I want to prevent myself from defining it by mistake. I appreciate that I might need a new type class for functor and applicative operations where correlating items are to be assumed.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 5, "creation_date": 1512240935, "post_id": 47611311, "comment_id": 82181007, "body": "Yes, backticks are syntax. They turn any identifier into an infix operator."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 7, "creation_date": 1512241689, "post_id": 47611311, "comment_id": 82181261, "body": "There&#39;s really no difference between an identifier bound during pattern matching and an identifier bound via a definition."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 7, "creation_date": 1512241914, "post_id": 47611311, "comment_id": 82181337, "body": "If you really want your mind blown, <code>let apply x (*) y = x * y in apply 1 (+) 2</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1512243158, "post_id": 47611311, "comment_id": 82181649, "body": "The scope of the identifier cannot possibly affect whether the identifier can be surrounded with backticks, since parsing happens before scope checking. In general, as far as the parser is concerned, there is no difference between a globally bound identifier or a locally bound identifier (indeed, even an <i>unbound</i> identifier is just an identifier to the parser). If you are ever confused about the syntax of Haskell, the best way to resolve that is to consult the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-18000010.5\" rel=\"nofollow noreferrer\">syntax reference</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1512252288, "post_id": 47611311, "comment_id": 82184393, "body": "You can also write definitions like <code>x `op` y = ...</code>, to define an <code>op</code> identifier. And you can give a fixity declaration for a backticked operator: <code>infixr 5 `Cons` </code>. Almost everything works out exactly as you&#39;d expect. Unfortunately, there&#39;s a weird syntactic corner having to do with kind-promotion of these sorts of things. It&#39;s a bug that may or may not get fixed."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1512254249, "post_id": 47611311, "comment_id": 82184971, "body": "When I was learning I was disappointed that I couldn&#39;t say <code>x `op arg` y</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1512338625, "post_id": 47618627, "comment_id": 82205460, "body": "Section 3.2 says &quot;An operator is either an operator symbol, such as + or $$, or is an ordinary identifier enclosed in grave accents (backquotes), such as <code>op</code>. For example, instead of writing the prefix application op x y, one can write the infix application x `op` y.&quot; That suggested to me that backticks were considered as something like an extension of the identifier rather than being parsed as an operator. As you say, a backticked expression has a precedence. So there must be some ad hoc processing in the parser. No?."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 1, "creation_date": 1512339419, "post_id": 47618627, "comment_id": 82205682, "body": "@RussAbbott Yes, that is my understanding. The precedence <code>infixl 9</code> is the default for <i>all</i> infix operators, hence the precedence for backticked identifiers. This is parser-level, you can test this by seeing what errors occur when you write <code>`(+)`</code> or another illegal expression."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1512339886, "post_id": 47618627, "comment_id": 82205832, "body": "Minor point: unless you are compiling your code with <code>-XHaskell98</code> (or using a non-GHC compiler which doesn&#39;t implement Haskell 2010) you should reference the Haskell 2010 report (which is the default semantics used by GHC) - 2010 and &#39;98 are largely identical, but there are some minor differences which can cause some confusion. (The only thing lacking in 2010 which is present in &#39;98 is <code>n+k</code> patterns, which are widely considered a mis-feature anyways)."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 4, "last_activity_date": 1512306045, "creation_date": 1512306045, "answer_id": 47618627, "question_id": 47611311, "link": "https://stackoverflow.com/questions/47611311/backticks-as-a-syntactic-operator/47618627#47618627", "title": "Backticks as a syntactic operator", "body": "<p>Backticks are syntax sugar that turns an identifier into an infix operator. That is to say, <code>a `f` b = f a b</code> is the general rewrite rule. This is useful for clarity, but also allows one to avoid too many brackets, since <code>f (a b) (c d)</code> can be rewritten as <code>a b `f` c d</code>.</p>\n\n<p>However there are a few caveats with using these, but only two restrictions:</p>\n\n<ul>\n<li><p><strong>The backticked expression must be an identifier</strong>, so <code>1 `mod` 2</code> is valid, but <code>a `zipWith (+)` b</code> is not valid, because it involved a function application.</p></li>\n<li><p><strong>Only alphanumeric identifiers can be backticked</strong>, so <code>1 `mod` 2</code> is valid, but <code>1 `(+)` 2</code> is invalid. You could see this as an application of the previous restriction.</p></li>\n<li><p><strong>Backticked expressions have precedence 9, and are left-associative</strong>, so <code>a `f` b `f` c</code> is parsed as <code>(a `f` b) `f` c</code>, and in general other operators will inlcude it, so <code>a +\nc `f` b</code> is parsed as <code>a + (c `f` b)</code>*</p></li>\n</ul>\n\n<p>In this case, <code>applyOp x op y = x `op` y</code> is valid, since <code>op</code> is an alphanumeric identifier, and this is equivalent to <code>applyOp x op y = op x y</code>. Note that there is <em>no</em> restriction on  binding pattern-matched identifiers!</p>\n\n<hr>\n\n<p><em>*This is untrue for the standard Prelude operators <code>!!</code> and <code>.</code>. More info of precedence and fixity can be found in <a href=\"https://www.haskell.org/onlinereport/decls.html\" rel=\"nofollow noreferrer\">The Haskell 98 Report</a>.</em></p>\n"}], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "accepted_answer_id": 47618627, "answer_count": 1, "score": 0, "last_activity_date": 1512306045, "creation_date": 1512240494, "question_id": 47611311, "link": "https://stackoverflow.com/questions/47611311/backticks-as-a-syntactic-operator", "title": "Backticks as a syntactic operator", "body": "<p>Just ran into something that seems strange to me. Backticks function as something like a syntactic operator.</p>\n\n<pre><code>applyOp :: Int -&gt; (Int -&gt; Int -&gt; Int) -&gt; Int -&gt; Int\napplyOp x op y = x `op` y\n\n&gt;  applyOp 2 (+) 5\n7\n</code></pre>\n\n<p>I was surprised to see this. I had always imagined that backticks were required to surround an operator symbol or identifier, not an identifier which can be bound during execution to an operator. Am I thinking about this the wrong way?</p>\n"}, {"tags": ["haskell", "ghci", "manjaro"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1512242276, "post_id": 47610439, "comment_id": 82181434, "body": "Try <code>LD_LIBRARY_PATH=&#47;usr&#47;local&#47;haskell&#47;ghc-8.2.1-x86_64&#47;lib ghc --interactive</code>"}, {"owner": {"reputation": 11, "user_id": 6344427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80502bbcaf4d29c3928b0d446755c7d?s=128&d=identicon&r=PG&f=1", "display_name": "jortseljongen", "link": "https://stackoverflow.com/users/6344427/jortseljongen"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1512245652, "post_id": 47610439, "comment_id": 82182407, "body": "Sadly returns the same error message."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1512247308, "post_id": 47610439, "comment_id": 82182919, "body": "You might try using strace to see exactly which directories are being searched to see whether or not the linker is checking in the right places"}, {"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 0, "creation_date": 1512269417, "post_id": 47610439, "comment_id": 82188000, "body": "It appears that Manjaro linux is based on Arch Linux.  I&#39;m not sure how you have installed GHC, but there is a project called <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">stack</a>, that, among other things, installs GHC for you automatically.  There have <a href=\"https://github.com/commercialhaskell/stack/issues/3509\" rel=\"nofollow noreferrer\">been</a> <a href=\"https://github.com/commercialhaskell/stack/issues/257\" rel=\"nofollow noreferrer\">numerous</a> <a href=\"https://github.com/commercialhaskell/stack/issues/2712\" rel=\"nofollow noreferrer\">bugs</a> over the past few months relating to the interaction of GHC, ncurses, and libtinfo."}, {"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 0, "creation_date": 1512269631, "post_id": 47610439, "comment_id": 82188023, "body": "I&#39;m not sure if the three bugs I&#39;ve linked to are related to your problem, but they seem relevant.  You may also want to try installing the <code>libtinfo5</code> package from AUR (assuming that Manjaro Linux also has something like AUR).  If that doesn&#39;t work, you may want to try installing the <code>ncurses-full</code> package from AUR.  If that also doesn&#39;t work, you may want to try using <code>stack</code> to install GHC."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "edited": false, "score": 0, "creation_date": 1517610951, "post_id": 47610439, "comment_id": 84180930, "body": "@illabout why the heck would using stack to install GHC make a bit of difference here? It ends up using the default GHC installer under-the-hood."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1517611272, "post_id": 47610439, "comment_id": 84181054, "body": "One approach would be to use the AUR-installed GHC (it may not be as recent, but it is likely to be tested well). The other would be to see if you need to set the no-pie setting by editing  <code>usr&#47;local&#47;haskell&#47;ghc-___&#47;lib&#47;ghc-___&#47;settings</code> and changing the &quot; compiler supports -no-pie&quot; flag from &quot;NO&quot; to &quot;YES&quot;."}, {"owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1517632149, "post_id": 47610439, "comment_id": 84185011, "body": "@sclv I was under the impression that stack will install a GHC linked to different libraries based on the distro you are using it on.  For instance, I am pretty sure that something different is being done for arch linux.  I can&#39;t find the exact issue that talks about this, but I believe it can find found by following links from <a href=\"https://github.com/commercialhaskell/stack/issues/3509\" rel=\"nofollow noreferrer\">here</a>.  If all jortseljongen wants to do is use GHCi for an assignment, it might be faster installing it with stack than building GHC from source."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1517718991, "post_id": 47610439, "comment_id": 84206059, "body": "I&#39;m not suggesting installing from source. I&#39;m suggesting either using the AUR from Arch directly, which is the best way to install things on a distro (using the distro&#39;s own mechanisms) or using a GHC installer (i.e. from <a href=\"https://www.haskell.org/ghc/download_ghc_8_2_2.html\" rel=\"nofollow noreferrer\">haskell.org/ghc/download_ghc_8_2_2.html</a>) directly. That installer is does not build from source. It is a binary installer that runs some scripts to configure things based on your system."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1517719125, "post_id": 47610439, "comment_id": 84206088, "body": "Installing the <a href=\"https://aur.archlinux.org/packages/ncurses5-compat-libs/\" rel=\"nofollow noreferrer\">aur.archlinux.org/packages/ncurses5-compat-libs</a> compat  libs may  also help."}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 9420255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0da8cdf3c39fafe2fd8f507751507e8c?s=128&d=identicon&r=PG&f=1", "display_name": "Fedor", "link": "https://stackoverflow.com/users/9420255/fedor"}, "is_accepted": false, "score": 0, "last_activity_date": 1519755221, "creation_date": 1519755221, "answer_id": 49015310, "question_id": 47610439, "link": "https://stackoverflow.com/questions/47610439/cant-run-ghci-from-terminal/49015310#49015310", "title": "Can&#39;t run ghci from terminal", "body": "<p>Run the following:</p>\n\n<pre><code>$ sudo pacman-key --refresh-keys\n$ gpg --keyserver pgp.mit.edu --recv-keys C52048C0C0748FEE227D47A2702353E0F7E48EDB\n$ yaourt -S ncurses5-compat-libs\n</code></pre>\n\n<p>Then try running GHCi</p>\n"}], "owner": {"reputation": 11, "user_id": 6344427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80502bbcaf4d29c3928b0d446755c7d?s=128&d=identicon&r=PG&f=1", "display_name": "jortseljongen", "link": "https://stackoverflow.com/users/6344427/jortseljongen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 489, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1519755221, "creation_date": 1512234894, "last_edit_date": 1512633933, "question_id": 47610439, "link": "https://stackoverflow.com/questions/47610439/cant-run-ghci-from-terminal", "title": "Can&#39;t run ghci from terminal", "body": "<p>I'm trying to run ghci for a Haskell assignment for a project. However it gives me this error message:</p>\n\n<pre><code>/usr/local/haskell/ghc-8.2.1-x86_64/lib/ghc-8.2.1/bin/ghc: error while loading shared libraries: libtinfo.so.5: cannot open shared object file: No such file or directory\n</code></pre>\n\n<p>I've tried to make a symbolic libtinfo.so.5 using ln, but it still doesn't work. Entering 'locate libtinfo.so.5' gives me the following:</p>\n\n<pre><code>/usr/lib/libtinfo.so.5\n\n/usr/local/haskell/ghc-8.2.1-x86_64/lib/libtinfo.so.5\n</code></pre>\n\n<p>I'm running Manjaro Linux.</p>\n"}, {"tags": ["haskell", "function-pointers", "ffi"], "comments": [{"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1512233142, "post_id": 47609959, "comment_id": 82178677, "body": "When one creates a wrapper function, it is implied that arbitrary function pointers of that signature may be needed. The style here let\u2019s you know exactly which functions might be passed to C. I don\u2019t know a great deal about the Haskell ffi. Perhaps this style predates the introduction of wrapper functions."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1512235335, "post_id": 47609959, "comment_id": 82179381, "body": "Wrappers can also provide pointer to closures. A function <code>a -&gt; IO b</code> in Haskell can be crafted at runtime, unlike in C. E.g. <code>do x &lt;- readLn ; w &lt;- mkWrapper (\\y -&gt; print (x+y)) ; use w</code> has to build a pointer to a closure containing the value of <code>x</code>. Every time a wrapper is created, a new closure will be allocated, so that they can refer to different values of <code>x</code>. If you don&#39;t need that flexibility, but only want a pointer to a fixed function, the export/import mechanism seems more primitive."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1512244819, "post_id": 47609959, "comment_id": 82182148, "body": "I have never seen the first style of exporting a Haskell function just to import a function pointer to that function. I cannot find it in any documentation (which, if it existed there, may indicate why one would use one style over the other). The Haskell FFI is somewhat fragile, so I wouldn&#39;t even assume that it works without testing it (even with testing, I still wouldn&#39;t think it &#39;works&#39; - just like undefined behaviour in C can produce the correct answer &#39;sometimes&#39;)."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 3, "creation_date": 1512247061, "post_id": 47609959, "comment_id": 82182834, "body": "Another thought: the export-import method here does not require any run time allocation of functions which means there is never a process of writing to executable memory or writing to memory and then changing it to executable. Perhaps some very strict security policies would not be happy with using a wrapper for this reason. Also this way you\u2019ll probably get some debugging symbols for these functions so e.g. gdb could tell you which function you are about to call from C. Finally if you use wrapper functions then you need to find somewhere in your program to put the <code>IO</code> action of wrapping."}], "owner": {"reputation": 12250, "user_id": 2425163, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/05f4000597865eeaf51c32ed5694479c?s=128&d=identicon&r=PG", "display_name": "tarleb", "link": "https://stackoverflow.com/users/2425163/tarleb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 176, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1512237899, "creation_date": 1512232032, "last_edit_date": 1512237899, "question_id": 47609959, "link": "https://stackoverflow.com/questions/47609959/exporting-importing-via-ffi-vs-using-the-ffi-wrapper", "title": "Exporting/importing via FFI vs. using the FFI wrapper", "body": "<p>I inherited a code base using the following idiom, which exports and then reimports a function via the FFI:</p>\n\n<pre><code>foreign export ccall someHaskellFn :: a -&gt; IO b\nforeign import ccall \"&amp;someHaskellFn\"\n  someHaskellFn_addr :: FunPtr (a -&gt; IO b)\n</code></pre>\n\n<p>Neither the Haskell function <code>someHaskellFn</code>, nor the exported function is ever used; only <code>someHaskellFn_addr</code> is required, and is always used in an IO context:</p>\n\n<pre><code>-- frob :: FunPtr (a -&gt; IO b) -&gt; IO ()\nfrob someHaskellFn_addr\n</code></pre>\n\n<p>I'm wondering whether this has any advantages over using a <em>wrapper</em> function:</p>\n\n<pre><code>foreign import ccall \"wrapper\"\n  mkWrapper :: (a -&gt; IO b) -&gt; IO (FunPtr (a -&gt; IO b))\n\n-- Function pointer to someHaskellFn, never freed\nsomeHaskellFnPtr = mkWrapper someHaskellFn\nfrob =&lt;&lt; someHaskellFnPtr\n</code></pre>\n\n<hr>\n\n<p>The documentation for Foreign.Ptr mentions these two methods to create a value of type <code>FunPtr a</code>:</p>\n\n<blockquote>\n  <p>A value of type FunPtr a may be a pointer to a foreign function,\n  either returned by another foreign function or imported with a a\n  static address import like</p>\n\n<pre><code>foreign import ccall \"stdlib.h &amp;free\"\n  p_free :: FunPtr (Ptr a -&gt; IO ())\n</code></pre>\n  \n  <p>or a pointer to a Haskell function created using a wrapper stub\n  declared to produce a FunPtr of the correct type.</p>\n</blockquote>\n\n<p>It also says</p>\n\n<blockquote>\n  <p>Calls to <em>wrapper</em> stubs [\u2026] allocate storage, which should be released with freeHaskellFunPtr when no longer required.</p>\n</blockquote>\n\n<p>My understanding is that the <em>wrapper</em> using code behaves indentical (on the Haskell side) to the export/import variant; is this correct? Are there any finer details about foreign function imports and exports which I am missing?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1512211028, "post_id": 47606730, "comment_id": 82172252, "body": "My question is about how to call <code>fromConstrB</code> with simple (builtin) types, not about typeclasses and instances. So, in most modern languages I can: a) get all constructors b) get constructor arguments c) get types/default values for them d) even call constructor. I see example how to do it in those tutorial, but seems the tutorial lies. So, question is: how to construct value of Data-like type if I found needed constructor already? Example only illustrates the goal. Sure, it has problem: I must check that found constructor has 1 arg only and it&#39;s String"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1512214397, "post_id": 47606730, "comment_id": 82173276, "body": "@Paul-AG See my edit on how to use <code>fromConstrB</code> and some related functions."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 1, "creation_date": 1512369788, "post_id": 47606730, "comment_id": 82213233, "body": "<code>nextField = StateT uncons &gt;&gt;= lift . fromDynamic</code>"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1512471680, "post_id": 47606730, "comment_id": 82262081, "body": "hmm, seems that I was not enough attentive. Tutorial says that it&#39;s possible with <code>fromConstr $ toConstr s</code>, where <code>s</code> is some <code>String</code>, for example. @chi, thanks again!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1512214352, "last_edit_date": 1512214352, "creation_date": 1512209374, "answer_id": 47606730, "question_id": 47606189, "link": "https://stackoverflow.com/questions/47606189/fromconstrb-or-something-other-useful/47606730#47606730", "title": "fromConstrB or something other useful", "body": "<p>A definition having type</p>\n\n<pre><code>foo :: C a =&gt; a\n</code></pre>\n\n<p>is promising to deliver a value of <em>any</em> type <code>a</code>, as long as it is inside class <code>C</code>. The <em>user</em> of <code>foo</code> gets to choose <code>a</code>, <code>foo</code> itself can't pick a specific type.</p>\n\n<p>With your setting, the only possible (non-error) definition is</p>\n\n<pre><code>foo = anyC\n</code></pre>\n\n<p>If you want to return <code>D \"hello\"</code>, then this is of type <code>D</code>. You can use that type if you want:</p>\n\n<pre><code>bar :: D\nbar = D \"hello\"\n</code></pre>\n\n<p>Also note that, if you want, you can change your instance as well:</p>\n\n<pre><code>instance C D where\n  anyC = D \"hello\"\n</code></pre>\n\n<hr>\n\n<p>Regarding</p>\n\n<blockquote>\n  <p>In most modern languages it's easy.</p>\n</blockquote>\n\n<p>This is actually not the case. In Java, for instance, a vague equivalent could be</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>// the typeclass, roughly\ninterface C&lt;A&gt; {\n   A anyC();\n}\n\nclass D implements C&lt;D&gt; { ... }\n\n&lt;A extends C&lt;A&gt;&gt; A foo() {\n   return new D(...);\n}\n</code></pre>\n\n<p>Java won't accept that, either. Other issues aside, <code>foo()</code> is promising to return any <code>A</code> chosen by the caller, it can't choose to return a <code>D</code>.</p>\n\n<p>Haskell type variables very roughly correspond to Java's generic type parameters. You might be instead thinking about subtyping, which exists in Java and other OOP languages, but is not used by Haskell.</p>\n\n<hr>\n\n<p>If you want a <code>fromConstrB</code> example, you can try this one:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable, ScopedTypeVariables, TypeOperators, GADTs #-}\n\nmodule FromConstr where\n\nimport Data.Data\n\ndata D = D String | AnyD deriving (Show, Data)\n\nfoo :: D\nfoo = fromConstrB field ctor\n   where\n   ctor :: Constr\n   ctor = toConstr (D \"aaa\")\n   field :: forall a. Data a =&gt; a\n   field = case eqT :: Maybe (a :~: String) of\n      Just Refl -&gt; \"new string\"\n      Nothing   -&gt; error \"trying to fill a non-string field\"\n</code></pre>\n\n<p><code>foo</code> evaluates to <code>D \"new string\"</code>. This can be expanded so that <code>field</code> covers more types, if the constructor need more, by nesting <code>case eqT</code>s, so that we check for all needed types.</p>\n\n<p>Also note that <code>fromConstrB</code> is limited since if our constructor has two fields with the same type we can't fill the fields with different values. For that, we would need to resort to the more complex <code>fromConstrM</code>, I think.</p>\n\n<hr>\n\n<p>Here's a little convenience helper function. It takes a <code>Constr</code>, and a list of \"untyped\" arguments (<code>Dynamic</code> makes all the type checking at runtime), and tries to build a value applying the constructor to the given arguments.</p>\n\n<pre><code>applyConstr :: Data a =&gt; Constr -&gt; [Dynamic] -&gt; Maybe a\napplyConstr ctor args = let\n   nextField :: forall d. Data d =&gt; StateT [Dynamic] Maybe d\n   nextField = do\n      as &lt;- get\n      case as of\n         [] -&gt; lift Nothing  -- too few arguments\n         (a:rest) -&gt; do\n            put rest\n            case fromDynamic a of\n               Nothing -&gt; lift Nothing  -- runtime type mismatch\n               Just x  -&gt; return x\n   in case runStateT (fromConstrM nextField ctor) args of\n      Just (x, []) -&gt; Just x\n      _            -&gt; Nothing  -- runtime type error or too few / too many arguments\n</code></pre>\n\n<p>For example, you can use it as follows:</p>\n\n<pre><code>bar :: D\nbar = case applyConstr (toConstr (D \"aaa\")) [toDyn \"hello\"] of\n   Just x  -&gt; x\n   Nothing -&gt; error \"runtime type mismatch\"\n</code></pre>\n\n<p>If the constructor has more arguments, you only have to make the list longer, as in <code>[toDyn \"string\", toDyn (42::Int), toDyn True]</code>. The <code>toDyn</code> function converts typed values into \"untyped\" ones, so that they can be stored together in the same list, and passed to <code>applyConstr</code>. Later on <code>applyConstr</code> will test (at runtime) if this list is of the exact length, and having values of the right types.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 47606730, "answer_count": 1, "score": 0, "last_activity_date": 1512214352, "creation_date": 1512205078, "question_id": 47606189, "link": "https://stackoverflow.com/questions/47606189/fromconstrb-or-something-other-useful", "title": "fromConstrB or something other useful", "body": "<p>I have:</p>\n\n<pre><code>class C a where\n  anyC :: a \ndata D = D String|AnyD deriving (Eq, Show, Data)\ninstance C D where\n  anyC = AnyD\n</code></pre>\n\n<p>and I want to write function <code>:: C a =&gt; a</code> which will create <code>D someString</code>. I'll call <code>anyC</code> and get <code>a</code> which is <code>AnyD</code>. And next step is to create <code>D someString</code> from <code>AnyD</code>. In most modern languages it's easy. For Haskell I found <a href=\"http://chrisdone.com/posts/data-typeable#fnref1\" rel=\"nofollow noreferrer\">this tutorial</a> and see there <code>fromConstrB</code>. So, goal seems doable, but.. I hit problem that article looks wrong: I can't construct anything in the way of Chris because constructor argument must be algebraic type and code like <code>fromConstr (toConstr (1 :: Int))</code> returns error <code>Exception: Data.Data.constrIndex is not supported for Prelude.Int, as it is not an algebraic data type.</code>. And the same is for <code>String</code>, so I can't pass my <code>someString</code> to my constructor! How to workaround it? </p>\n"}, {"tags": ["haskell", "math", "functional-programming", "integration", "difference"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1512182384, "post_id": 47603971, "comment_id": 82166898, "body": "<code>marginOfError = random * 1e-5</code>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512183296, "post_id": 47603971, "comment_id": 82167035, "body": "1. You are performing calculations with floating point arithmetic (this you can avoid simply by testing with infinite precision, i.e. <code>Rational</code>). 3. Your algorithm only approximates the integral; you must compute the error bound of the algorithm (which is typically phrased in terms of the minimum <code>n</code> required to produce a result whose error is bounded by a certain <code>e</code> - set <code>e</code> to some small number, like 1e-5). The error bound of the trapezoidal rule is well known (&quot;trapezoidal rule error bound&quot;). (Aside: <code>(n&gt;0)==&gt;..</code> is a bad way to produce non-negative numbers - use <code>NonNegative Integer</code>)."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1512183374, "post_id": 47603971, "comment_id": 82167045, "body": "you can check relative error which will be scale independent.  Only for small numbers check absolute error."}, {"owner": {"reputation": 151, "user_id": 8622509, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/64ce0a9af573d9ec892fbd05278c43ec?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Buckley", "link": "https://stackoverflow.com/users/8622509/jack-buckley"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512183542, "post_id": 47603971, "comment_id": 82167066, "body": "@user2407038 Unfortunately, due to the requirements of my function, I have to use doubles. I&#39;m seeking a solution to the problem, keeping in mind the problems posed by floating-point arithmetic error."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1512184049, "post_id": 47603971, "comment_id": 82167149, "body": "@JackBuckley Perhaps you have constraints which require you to eventually use floating point numbers, but surely you can run your tests with <code>Rational</code> (in other words, if the function is correct on Rational, it is also correct on Double, since Rational is strictly more precise). Even if this is somehow not true, the rest still applies - you just have to compute the error bound factoring in imprecision due to floating point error as well as approximation error (which is a significantly harder task)."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1512202091, "post_id": 47603971, "comment_id": 82170287, "body": "Divide one number by the other and check how close the result is to 1."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512243470, "post_id": 47606091, "comment_id": 82181743, "body": "This only works (in the sense of making the test pass) because (presumably) the definition of <code>definiteIntegral</code> is correct. If you pick an arbitrary margin of error, an incorrect definition of <code>definiteIntegral</code> could always add or subtract a number less than that margin of error, producing a function which passes the test."}, {"owner": {"reputation": 1290, "user_id": 5499871, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206799318615183/picture?type=large", "display_name": "Izaak Weiss", "link": "https://stackoverflow.com/users/5499871/izaak-weiss"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512359921, "post_id": 47606091, "comment_id": 82210306, "body": "Yes? But that is what the original post asks for. In fact, this method is functionally equivalent to the second method proposed in the question, which OP said he didn&#39;t know how to implement in Haskell.     See:  &quot;I&#39;m thinking I need to check either significant digits or the numbers in scientific notation that are multiplied by 10 to a power, but I&#39;m unsure how to implement either in Haskell.&quot;"}], "tags": [], "owner": {"reputation": 1290, "user_id": 5499871, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206799318615183/picture?type=large", "display_name": "Izaak Weiss", "link": "https://stackoverflow.com/users/5499871/izaak-weiss"}, "is_accepted": false, "score": 0, "last_activity_date": 1512204291, "creation_date": 1512204291, "answer_id": 47606091, "question_id": 47603971, "link": "https://stackoverflow.com/questions/47603971/comparing-big-numbers-in-haskell-to-pass-quickcheck/47606091#47606091", "title": "Comparing big numbers in Haskell to pass quickCheck", "body": "<p>In order to compute a fairly robust margin of error for two numbers is to average them, and divide by some large constant; use that as the margin of error.</p>\n\n<pre><code>margin :: Double -&gt; Double -&gt; Double\nmargin a b = (a + b) / (1e5) -- Increase this for more precision; decrease for less\n\nclose :: Double -&gt; Double -&gt; Bool\nclose a b = (abs (a - b)) &lt; (margin a b)\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 8622509, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/64ce0a9af573d9ec892fbd05278c43ec?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Buckley", "link": "https://stackoverflow.com/users/8622509/jack-buckley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1512204291, "creation_date": 1512181796, "question_id": 47603971, "link": "https://stackoverflow.com/questions/47603971/comparing-big-numbers-in-haskell-to-pass-quickcheck", "title": "Comparing big numbers in Haskell to pass quickCheck", "body": "<p>I have made a function that calculates the definite integral of some function g from a to b using the trapezoidal rule with n number of trapezoids. \ni.e. <code>definiteIntegral (-4) 5 (\\x -&gt; x) 5 = 4.499999999999998</code></p>\n\n<p>I need to develop a quickCheck function to test my function. I want to make use of the property that a coefficient inside an integral can be taken outside and multiplied by the integral. </p>\n\n<p>This is my quickCheck function:</p>\n\n<pre><code>prop :: (Double, Double, Integer, Double) -&gt; Property\nprop (a, b, n, random) = (n &gt; 0) ==&gt; abs(random * (definiteIntegral a b (\\x-&gt;x) n) - (definiteIntegral a b (\\x-&gt; random * x) n)) &lt;= marginOfError\n                            where \n                                marginOfError = 1e-5\n</code></pre>\n\n<p>The problem I have is that I need the margin of error to change according to the size of the integrals. This is because while <code>2.8109220919999948-2.810922091999996 = -1.3322676295501878e-15</code>, <code>2.8109220919999948e15-2.810922091999996e15 = -1</code>.</p>\n\n<p>As a result, I need to some way to check these two numbers to see if they are similar, but my current margin of error method does not work. I'm thinking I need to check either significant digits or the numbers in scientific notation that are multiplied by 10 to a power, but I'm unsure how to implement either in Haskell.</p>\n\n<p>Any ideas?\nThanks in advance. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1512165423, "post_id": 47601520, "comment_id": 82162830, "body": "Your title is (unintentionally) misleading, as there actually <i>is</i> a function named <code>guard</code> defined in <code>Control.Monad</code>. You are talking about the guard <i>syntax</i>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1512167371, "post_id": 47601520, "comment_id": 82163522, "body": "The error is confusing because you made GHC guess the types of the variables at hand. With a proper type annotation, GHC can generate much better error messages -- this is why it is strongly recommended to do so, possibly even before starting to write the function definition. Type annotations are also a very useful piece of documentation for human programmers."}], "answers": [{"comments": [{"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 0, "creation_date": 1512164471, "post_id": 47601546, "comment_id": 82162478, "body": "<code>a &amp;&amp; b &gt; 0</code> does not have implicit parentheses around <code>a &amp;&amp; b</code>.  It has them around <code>b &gt; 0</code>.  <code>(&amp;&amp;)</code> is precedence 3, <code>(&gt;)</code> is precedence 4."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 0, "creation_date": 1512165259, "post_id": 47601546, "comment_id": 82162748, "body": "@DavidFletcher oh, hmm. I even checked that in ghci before I posted, then apparently ignored my tests and wrote the wrong thing :D. Fixing now."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1512174522, "post_id": 47601546, "comment_id": 82165481, "body": "In the original code, the compiler infers that the types of <code>a</code> and <code>b</code> are <code>Bool</code>, not that they are numbers. In other words, the type error is not due to trying to apply <code>&amp;&amp;</code> to two numbers, it is due to trying to apply <code>+</code> to two non-numbers (as well as using a numeric literal at type <code>Bool</code>). Indeed, if you define an <code>instance Bool</code> the original code compiles (but is certainly still wrong)."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 2, "last_activity_date": 1512173044, "last_edit_date": 1512173044, "creation_date": 1512162623, "answer_id": 47601546, "question_id": 47601520, "link": "https://stackoverflow.com/questions/47601520/haskell-guard-function-not-loading-checking-two-variables/47601546#47601546", "title": "Haskell guard function not loading, checking two variables", "body": "<p><code>a &amp;&amp; b &gt; 0</code> collapses as <code>a &amp;&amp; (b &gt; 0) =&gt; a &amp;&amp; True</code> (assuming <code>b&gt;0</code>). Since you can't AND two numbers, this fails, giving you the error you reported above since <code>(&amp;&amp;) :: Bool -&gt; Bool -&gt; Bool</code></p>\n\n<p>You instead want</p>\n\n<pre><code>test a b\n    | a &gt; 0 &amp;&amp; b &gt; 0 = a+b\n    | otherwise      = a-b\n</code></pre>\n\n<p>Alternatively you could reverse your logic</p>\n\n<pre><code>test a b\n    | a &lt;= 0    = a-b\n    | b &lt;= 0    = a-b\n    | otherwise = a+b\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 9026817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9db28de3462cd97e579ee27209c9992c?s=128&d=identicon&r=PG&f=1", "display_name": "EStudent", "link": "https://stackoverflow.com/users/9026817/estudent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "accepted_answer_id": 47601546, "answer_count": 1, "score": 0, "last_activity_date": 1512173044, "creation_date": 1512162522, "last_edit_date": 1512163831, "question_id": 47601520, "link": "https://stackoverflow.com/questions/47601520/haskell-guard-function-not-loading-checking-two-variables", "title": "Haskell guard function not loading, checking two variables", "body": "<p>I have this following function. \nI want to check if both variables a and b are bigger than 0 and if thats the case \nthey get add and if not they get subtracted. My function is not meant to make sense its only for testing purposes it should only load and work.</p>\n\n<pre><code>test a b\n    |a &amp;&amp; b &gt; 0 = a+b\n    |otherwise = a-b\n</code></pre>\n\n<p>and i get the following error:</p>\n\n<pre><code>No instance for (Num Bool) arising from the literal `0'\n</code></pre>\n\n<p>But  when I remove the \"<code>&amp;&amp; b</code>\" my function is working. Why is my function not working as how it is now, what does this error mean, and how can I make this function load?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 3, "creation_date": 1512153944, "post_id": 47599616, "comment_id": 82157662, "body": "<code>max (3 5) * 2</code> isn&#39;t 10, it&#39;s a type error because <code>3</code> isn&#39;t a function. I don&#39;t understand anything else in your question."}], "answers": [{"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 4, "last_activity_date": 1512154039, "creation_date": 1512154039, "answer_id": 47599677, "question_id": 47599616, "link": "https://stackoverflow.com/questions/47599616/in-haskell-max-3-5-2-10/47599677#47599677", "title": "In Haskell (max 3 5) * 2 =&gt; 10", "body": "<p>You have your parentheses inexplicably backwards.</p>\n\n<blockquote>\n  <p>Haskell multiplies 5*2 and compare the result with 3 and finding the max.</p>\n</blockquote>\n\n<p>so you want</p>\n\n<pre><code>max 3 (5 * 2)\n</code></pre>\n\n<hr>\n\n<p>Your code as written tries to coerce the literal <code>3</code> into a function <code>Num a =&gt; a -&gt; b</code>, then apply <code>5</code> to it. It can't do that, of course, so it stops.</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 4, "last_activity_date": 1512154097, "creation_date": 1512154097, "answer_id": 47599695, "question_id": 47599616, "link": "https://stackoverflow.com/questions/47599616/in-haskell-max-3-5-2-10/47599695#47599695", "title": "In Haskell (max 3 5) * 2 =&gt; 10", "body": "<p><strong>Syntax</strong></p>\n\n<pre><code>max (3 5) * 2\n</code></pre>\n\n<p>This doesn't mean what you seem to think it means.  In the above, the function <code>3</code> is applied to the argument <code>5</code>.  Consider instead:</p>\n\n<pre><code>(max 3 5) * 2\n</code></pre>\n\n<p>Or equivalently:</p>\n\n<pre><code>max 3 5 * 2\n</code></pre>\n\n<p><strong>Terminology</strong></p>\n\n<p>Let's also keep the terminology straight: the compiler doesn't perform any evaluation, it just produces binaries.</p>\n\n<p><strong>Answer</strong></p>\n\n<p>The first thing to consider is the function <code>*</code>.  There is no guaranteed order of evaluation here. To evaluate <code>max 3 5</code> the <code>max</code> function is applied to each argument and the results is <code>5</code>.  The second argument, <code>2</code> is already in normal form.  So now we just have <code>5*2</code> which produces <code>10</code>.</p>\n"}], "owner": {"reputation": 806, "user_id": 4704059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e893e8bd4c4a4bf985a212b087838ba2?s=128&d=identicon&r=PG&f=1", "display_name": "Muthaiah PL", "link": "https://stackoverflow.com/users/4704059/muthaiah-pl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "closed_date": 1512156214, "accepted_answer_id": 47599695, "answer_count": 2, "score": -4, "last_activity_date": 1512167490, "creation_date": 1512153710, "last_edit_date": 1512167490, "question_id": 47599616, "link": "https://stackoverflow.com/questions/47599616/in-haskell-max-3-5-2-10", "closed_reason": "Needs details or clarity", "title": "In Haskell (max 3 5) * 2 =&gt; 10", "body": "<p>This is my first day with Haskell, Can you please explain, how this works. </p>\n\n<p>I assume, first the compiler should work on finding the max value among 3 and 5 and then multiply the result by 2.</p>\n\n<p>Whereas, Haskell multiplies 5*2 and compare the result with 3 and finding the max. </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1512154393, "creation_date": 1512154393, "answer_id": 47599762, "question_id": 47599519, "link": "https://stackoverflow.com/questions/47599519/haskell-getline-called-before-putstr/47599762#47599762", "title": "Haskell - getLine called before putStr", "body": "<p><code>putStr \"enter value: \"</code> actually writes to an output buffer, which is flushed to the actual standard output only later on, when the buffer becomes full or when a newline is found.</p>\n\n<p>This is roughly the same mechanism found in the C programming language.</p>\n\n<p>So, even if <code>putStr \"enter value: \"</code> is run before <code>getLine</code>, we don't see the output message, yet, which feels wrong.</p>\n\n<p>The solution is to flush the standard output handle explicitly.</p>\n\n<pre><code>import System.IO\n-- ...\nputStr \"enter value: \"\nhFlush stdout\nvar &lt;- getLine\n</code></pre>\n"}], "owner": {"reputation": 333, "user_id": 7441934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gKmnB.png?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7441934/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 282, "favorite_count": 1, "closed_date": 1512178989, "accepted_answer_id": 47599762, "answer_count": 1, "score": 1, "last_activity_date": 1512154393, "creation_date": 1512153330, "question_id": 47599519, "link": "https://stackoverflow.com/questions/47599519/haskell-getline-called-before-putstr", "closed_reason": "Duplicate", "title": "Haskell - getLine called before putStr", "body": "<p>When I want to put some text before reading an input in Haskell, I tried writing it like this:</p>\n\n<pre><code>putStr \"enter value: \"\nvar &lt;- getLine\n</code></pre>\n\n<p>However the output requires the user input before it displays the text:</p>\n\n<pre><code>[input]\nenter value: \n</code></pre>\n\n<p>When I use <code>putStrLn</code> instead of <code>putStr</code>, it displays as it should:</p>\n\n<pre><code>enter value: \n[input]\n</code></pre>\n\n<p>Why do these two statements function differently? Is it the addition of the newline?</p>\n"}, {"tags": ["sorting", "haskell", "mergesort"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1512151191, "post_id": 47598965, "comment_id": 82156171, "body": "Do you have a question?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1512151562, "post_id": 47598965, "comment_id": 82156389, "body": "You can pattern match on a list of length exactly one with <code>msort [x] = ..</code> or <code>msort (x:[]) = ..</code>. Alternatively you can add a catch-all case <i>after</i> the <code>(x:xs)</code> case, e.g. <code>msort x = x</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1512154563, "post_id": 47598965, "comment_id": 82157955, "body": "@user2407038 Adding a catch-all case after <code>(x:xs)</code> won&#39;t work, though, since that already catches all lists with length &gt;= 1, including <code>[x]</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1512160960, "post_id": 47598965, "comment_id": 82161034, "body": "@chi Indeed, the recursive case would then have to be changed to <code>(x:y:xs)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1512157024, "post_id": 47599883, "comment_id": 82159186, "body": "While this works, there are some efficiency problems. First, you should only <code>splitAt halfPoint xs</code> once, not twice; as it is, you&#39;re potentially doubling the splitting work. Second, all those <code>length</code> calculations are kind of expensive: a whole extra <code>n * log n</code>. You can either get the length at the beginning and use <code>quotRem</code> recursively, use a tortoise-and-hare algorithm to split the lists, or switch to a bottom-up mergesort."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1512157076, "post_id": 47599883, "comment_id": 82159213, "body": "A lazy tortoise-and-hare splitter looks like this: <code>half :: [a] -&gt; ([a], [a]); half xs0 = go xs0 xs0 where go t [] = ([], t); go t [_] = ([], t); go (t : ts) (_:_:hs) = case go ts hs of ~(front,rear) -&gt; (t : front, rear)</code>"}, {"owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1512169454, "post_id": 47599883, "comment_id": 82164241, "body": "@dfeuer I fixed the duplicate <code>splitAt</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1512175876, "post_id": 47599883, "comment_id": 82165712, "body": "I just realized a <i>non-lazy</i> tortoise-and-hare splitter is probably a better fit."}], "tags": [], "owner": {"reputation": 520, "user_id": 1871467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8dd0a983cef2c8c9a905a7f42af0ec46?s=128&d=identicon&r=PG", "display_name": "aplainzetakind", "link": "https://stackoverflow.com/users/1871467/aplainzetakind"}, "is_accepted": false, "score": 3, "last_activity_date": 1512162302, "last_edit_date": 1512162302, "creation_date": 1512154989, "answer_id": 47599883, "question_id": 47598965, "link": "https://stackoverflow.com/questions/47598965/haskell-merge-sort-implementation/47599883#47599883", "title": "Haskell merge sort implementation", "body": "<p>Your <code>merge</code> function has two issues.</p>\n\n<p>i) Patterns are not exhaustive: If precisely one of the lists is empty, there's no match. You should have</p>\n\n<pre><code>merge :: Ord a =&gt; [a] -&gt; [a] -&gt; [a]\nmerge [] ys = ys\nmerge xs [] = xs\nmerge (x:xs) (y:ys) = something\n</code></pre>\n\n<p>ii) Your <code>something</code> is not actually merge sorting, it is looking at the heads and concatenates the two lists based on the comparison of the heads. For instance, if given <code>[1,4,5]</code> and <code>[2,3,4]</code>, <code>1</code> would be bound to <code>x</code>, <code>2</code> to <code>y</code>, and then since <code>y &gt; x</code> holds, then it would return <code>[1,4,5,2,3,4]</code>, clearly unsorted, though the two given lists were sorted.</p>\n\n<p>Imagine the merging as follows. Given two lists, you see only the heads, and pick the smaller one. In place of the one you removed, the next element rolls in, and you keep doing the same thing. This is a recursive process; after each pick, you do the same thing. In code:</p>\n\n<pre><code>merge (x:xs) (y:ys) | x &lt; y     = x : merge xs (y:ys)\n                    | otherwise = y : merge (x:xs) ys\n</code></pre>\n\n<p>As for the actual sorting <code>:: Ord a =&gt; [a] -&gt; [a]</code>, you must also work with halves that are already sorted, which also calls for recursion:</p>\n\n<pre><code>msort :: Ord a =&gt; [a] -&gt; [a]\nmsort []  = []\nmsort [x] = [x]\nmsort xs  = merge firstHalfSorted secondHalfSorted\n     where firstHalfSorted  = msort . fst $ halves\n           secondHalfSorted = msort . snd $ halves\n           halves           = splitAt halfPoint xs\n           halfPoint        = length xs `div` 2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1512251267, "last_edit_date": 1512251267, "creation_date": 1512177863, "answer_id": 47603651, "question_id": 47598965, "link": "https://stackoverflow.com/questions/47598965/haskell-merge-sort-implementation/47603651#47603651", "title": "Haskell merge sort implementation", "body": "<p>Because I can't resist a challenge, here's an efficient, incremental, stable top-down mergesort. The same design with a couple minor tweaks should produce an efficient (but non-incremental) mergesort for a strict language; laziness is only used in the <code>merge</code> function, so it should be possible to do some juggling to avoid it if desired.</p>\n\n<pre><code>{-# language BangPatterns #-}\n\nimport Control.Monad\n\n-- Divide a list into the first n `quot` 2 elements and\n-- the rest. The front of the list is reversed.\nhalf :: [a] -&gt; ([a], [a])\nhalf = join (go []) where\n  go front ts [] = (front, ts)\n  go front ts [_] = (front, ts)\n  go front (t:ts) (_:_:hs) = go (t:front) ts hs\n\n-- Some care is required to make the sort stable.\nmerge :: Ord a =&gt; Bool -&gt; [a] -&gt; [a] -&gt; [a]\nmerge _ [] ys = ys\nmerge _ xs [] = xs\nmerge up xxs@(x : xs) yys@(y : ys)\n  | (if up then (&lt;=) else (&lt;)) x y = x : merge up xs yys\n  | otherwise = y : merge up xxs ys\n\nmsort :: Ord a =&gt; [a] -&gt; [a]\nmsort = go True where\n  go _ [] = []\n  go _ xs@[_] = xs\n  go !up xs = merge up frontSorted rearSorted where\n    frontSorted = go (not up) front\n    rearSorted = go up rear\n    (front, rear) = half xs\n</code></pre>\n\n<hr>\n\n<p>A version that uses laziness more heavily is considerably easier to write and understand, but may be susceptible to a <a href=\"https://ghc.haskell.org/trac/ghc/ticket/2607\" rel=\"nofollow noreferrer\">subtle space leak</a> if care is not taken to control certain compiler optimizations:</p>\n\n<pre><code>-- Split a list in half, with both halves in order\nhalf :: [a] -&gt; ([a], [a])\nhalf = join go\n  where\n    go t [] = ([], t)\n    go t [_] = ([], t)\n    go (t : ts) (_:_:hs) = (t : front, rear)\n      where (front, rear) = go ts hs -- Interesting laziness\n\nmerge :: Ord a =&gt; [a] -&gt; [a] -&gt; [a]\nmerge [] ys = ys\nmerge xs [] = xs\nmerge xxs@(x:xs) yys@(y:ys)\n  | x &lt;= y    = x : merge xs yys\n  | otherwise = y : merge xxs ys\n\nmsort :: Ord a =&gt; [a] -&gt; [a]\nmsort []  = []\nmsort [x] = [x]\nmsort xs  = merge (msort front) (msort rear)\n  where (front, rear) = half xs\n</code></pre>\n\n<p>For completeness, I should mention that <em>bottom-up</em> mergesort seems rather more natural in Haskell.</p>\n"}], "owner": {"reputation": 61, "user_id": 8821089, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/5400cede19ef593f6ec39cdb0b9ff450?s=128&d=identicon&r=PG&f=1", "display_name": "Mostafa Ibrahim", "link": "https://stackoverflow.com/users/8821089/mostafa-ibrahim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1608, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1512251267, "creation_date": 1512151051, "question_id": 47598965, "link": "https://stackoverflow.com/questions/47598965/haskell-merge-sort-implementation", "title": "Haskell merge sort implementation", "body": "<p>I am trying to solve this question:\nDe\ffine a recursive function msort :: Ord a => [a] -> [a] that imple-\nments merge sort, which can be specified by the following two rules:\n\u000f Lists of length  1 are already sorted;\n\u000f Other lists can be sorted by sorting the two halves and merging the\nresulting lists.</p>\n\n<p>But I am having a hard time understanding how exactly the code of merge sort work.</p>\n\n<p>here is my code ::</p>\n\n<pre><code>merge :: Ord a =&gt; [a] -&gt; [a] -&gt; [a]\nmerge [] [] = []\nmerge (x:xs) (y:ys) | y &gt; x =  (x:xs) ++  (y:ys)\n                    |otherwise =  (y:ys) ++  (x:xs)\n\n\nmsort :: Ord a =&gt; [a] -&gt; [a]\n--base case , if length less than or equal 1 , then list is already  sorted\nmsort [] = [] -- how to implement base case?\nmsort (x:xs)  = merge  (take (length(x:xs) `div` 2 ) (x:xs)) (drop (length(x:xs) `div` 2 ) (x:xs))\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "is_accepted": false, "score": 2, "last_activity_date": 1512176979, "last_edit_date": 1512176979, "creation_date": 1512149059, "answer_id": 47598443, "question_id": 47598366, "link": "https://stackoverflow.com/questions/47598366/haskell-program-to-replicate-elements-in-list-for-k-value-it-should-be-reapeted/47598443#47598443", "title": "Haskell program to replicate elements in List (for k value it should be reapeted k times)", "body": "<p>What about something like this?</p>\n\n<pre><code>replicate' :: [Int] -&gt; [[Int]]\nreplicate' l = map (\\n -&gt; take n (repeat n)) l\nreplicate' [1, 2, 3] -- [[1],[2,2],[3,3,3]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1512156682, "last_edit_date": 1512156682, "creation_date": 1512149063, "answer_id": 47598445, "question_id": 47598366, "link": "https://stackoverflow.com/questions/47598366/haskell-program-to-replicate-elements-in-list-for-k-value-it-should-be-reapeted/47598445#47598445", "title": "Haskell program to replicate elements in List (for k value it should be reapeted k times)", "body": "<p>You can construct a list that contains <em><code>k</code></em> times te item <code>x</code>, by writing:</p>\n\n<pre><code>replicate k x\n</code></pre>\n\n<p>So now we want to map every item <code>x</code> in the original list to a list that contains <code>x</code>, <code>x</code> times. We can for instance write it as:</p>\n\n<pre><code>replic the_list = map helper the_list\n    where helper x = replicate x x\n</code></pre>\n\n<p>Or by using a <em>lambda expression</em>:</p>\n\n<pre><code>replic the_list = map (\\x -&gt; replicate x x) the_list\n</code></pre>\n\n<p>Or we can use the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Monad.html#v:join\" rel=\"noreferrer\"><strong><code>join :: Monad m =&gt; m (m a) -&gt; m a</code></strong></a> function:</p>\n\n<pre><code>import Control.Monad(join)\n\nreplic the_list = map (join replicate) the_list\n</code></pre>\n\n<p>We can also use an <em>eta-reducation</em> here: remove <code>the_list</code> both in the head and body of the function clause:</p>\n\n<pre><code>import Control.Monad(join)\n\nreplic :: [Int] -&gt; [[Int]]\nreplic = map (join replicate)\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 8686264, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-pqAJXjOyhUQ/AAAAAAAAAAI/AAAAAAAAA1I/_XS1GUaZsTY/photo.jpg?sz=128", "display_name": "Abhishek Raut", "link": "https://stackoverflow.com/users/8686264/abhishek-raut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 47598445, "answer_count": 2, "score": 1, "last_activity_date": 1512210205, "creation_date": 1512148735, "last_edit_date": 1512210205, "question_id": 47598366, "link": "https://stackoverflow.com/questions/47598366/haskell-program-to-replicate-elements-in-list-for-k-value-it-should-be-reapeted", "title": "Haskell program to replicate elements in List (for k value it should be reapeted k times)", "body": "<p>I am new to Haskell. \n    e.g\n   [[1],[2,2],[3,3,3]]</p>\n"}, {"tags": ["haskell", "ghc", "template-haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1512149106, "post_id": 47598270, "comment_id": 82155033, "body": "By the way, I am aware that in general the sort of error reporting I&#39;m looking for is unhelpful to the end user - fear not, they will have more error reporting logs before this broad error  - just not coming from GHC."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1512151412, "post_id": 47598270, "comment_id": 82156302, "body": "The only thing I can think of is &#39;faking&#39; the error message with something like <code>runIO (System.Exit.die &quot;fail&quot;)</code>. Depending on your specific use case, this could be entirely unsatisfactory, e.g. with <code>-fdefer-type-errors</code> compilation of subsequent modules should continue after one fails, but this would kill the entire process. At least, GHC stills seems to do cleanup after compilation even if you kill it unceremoniously like this. Alternatively, consider adding a disclaimer at the bottom of the error stating that the location below is entirely bogus."}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 2, "answer_count": 0, "score": 4, "last_activity_date": 1512148400, "creation_date": 1512148400, "question_id": 47598270, "link": "https://stackoverflow.com/questions/47598270/whole-file-template-haskell-error", "title": "Whole file Template Haskell error", "body": "<p>I'm writing a TH library and I have a situation where I'm doing some module-wide stuff. In a nutshell, I'm collecting information from all quasiquotes and <code>putQ</code>-ing it into <code>Q</code>.</p>\n\n<p>Then, once the Haskell module has been typechecked, I look up all this state and do some stuff with it. I'm managing that by recording this final action in using <code>addModFinalizer</code>.</p>\n\n<p>Now, the problem: sometimes, this final action can fail. If it does, I want to report a compile error. Doing this with <code>fail</code>, I get error messages that look like:</p>\n\n<pre><code>Main.hs:1:1: error: My message of something going wrong with the whole module...\n  |\n1 | {-# LANGUAGE TemplateHaskell, QuasiQuotes #-}\n  | ^\n</code></pre>\n\n<p>As you can see, GHC decides to associate my error message to the top of the file. <strong>Is there any way I can tell GHC not to associate my error with a bit of code?</strong> I'd prefer something like:</p>\n\n<pre><code>Main.hs: error: My message of something going wrong with the whole module...\n</code></pre>\n"}, {"tags": ["haskell", "r-markdown", "cabal", "pandoc"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1512143964, "post_id": 47596941, "comment_id": 82152078, "body": "All cabal commands should be run from the command line, not from GHCi."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1512146260, "post_id": 47596941, "comment_id": 82153482, "body": "Please don&#39;t paste images of problems, just the text will do."}, {"owner": {"reputation": 1101, "user_id": 3174566, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c1a71e48d2df19ba65b2f734176ec748?s=128&d=identicon&r=PG&f=1", "display_name": "filups21", "link": "https://stackoverflow.com/users/3174566/filups21"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1512146960, "post_id": 47596941, "comment_id": 82153852, "body": "@ThomasM.DuBuisson how was I to know that the error message itself was not relevant here?"}, {"owner": {"reputation": 12250, "user_id": 2425163, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/05f4000597865eeaf51c32ed5694479c?s=128&d=identicon&r=PG", "display_name": "tarleb", "link": "https://stackoverflow.com/users/2425163/tarleb"}, "edited": false, "score": 1, "creation_date": 1512148615, "post_id": 47596941, "comment_id": 82154755, "body": "The <code>pandoc-citeproc</code> binary is shipped with pandoc. Best to save yourself some trouble and just download it from the <a href=\"https://github.com/jgm/pandoc/releases/\" rel=\"nofollow noreferrer\">download page</a>."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1512151145, "post_id": 47596941, "comment_id": 82156147, "body": "@filups21 I was suggesting you use text instead of images, not omit the information entirely.  Pictures of code and errors are usually less helpful than copy/paste-able blocks of text."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1512146370, "creation_date": 1512146370, "answer_id": 47597705, "question_id": 47596941, "link": "https://stackoverflow.com/questions/47596941/how-to-install-pandoc-crossref/47597705#47597705", "title": "How to install pandoc-crossref", "body": "<p><code>cabal</code> is a binary from the <code>cabal-install</code> package and not a Haskell function.  You should execute programs from a command line and not within GHCi.  It looks like you are using windows so there might be some steps to find the program but once you do you should be able to call it directly.</p>\n"}], "owner": {"reputation": 1101, "user_id": 3174566, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c1a71e48d2df19ba65b2f734176ec748?s=128&d=identicon&r=PG&f=1", "display_name": "filups21", "link": "https://stackoverflow.com/users/3174566/filups21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2247, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1512146370, "creation_date": 1512143415, "question_id": 47596941, "link": "https://stackoverflow.com/questions/47596941/how-to-install-pandoc-crossref", "title": "How to install pandoc-crossref", "body": "<p>I would like cross-reference figures in rMarkdown, and pandoc-crossref seems to be a common solution (see <a href=\"https://stackoverflow.com/questions/37116632/rmarkdown-html-number-figures\">here</a>). The instructions on pandoc's Github page say: </p>\n\n<blockquote>\n  <p>Assuming you already installed Haskell platform, you can install pandoc-crossref with cabal:<br>\n  <code>cabal update</code><br>\n  <code>cabal install pandoc-crossref</code></p>\n</blockquote>\n\n<p>So I installed Haskell from <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\">here</a>. However, when I try to run <code>cabal update</code> in the GHCi terminal, I just get an error: \n<a href=\"https://i.stack.imgur.com/wuOr7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wuOr7.png\" alt=\"enter image description here\"></a></p>\n\n<p>So, how do I install pandoc-crossref?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1512132712, "post_id": 47593481, "comment_id": 82144758, "body": "Thanks, it&#39;s good option. Another option is to wrap my data in <code>newtype</code> and to write &quot;default&quot; instances for this newtype&#39;s. Template Haskell is interesting option to make the work, but I have not experience with it. Is it possible to make custom <code>deriving MyCustomClass</code>? Or did you mean another (something like <code>$(mkReadInstance)</code> quotes) ?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 2, "creation_date": 1512137064, "post_id": 47593481, "comment_id": 82147507, "body": "@Paul-AG Using <code>newtype</code> wrappers indeed works. It&#39;s not easy to add <code>deriving MyCustomClass</code> (I think it requires to write a plugin to the compiler itself, if it is doable at all). Using TH and <code>$(mkReadInstance &#39;&#39;T)</code> looks easier, especially if the instance is a fixed one, calling the default implementation."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1512131860, "last_edit_date": 1512131860, "creation_date": 1512131513, "answer_id": 47593481, "question_id": 47592742, "link": "https://stackoverflow.com/questions/47592742/default-instance-implementations-with-overlaps/47593481#47593481", "title": "Default instance implementations with &quot;overlaps&quot;", "body": "<p>Overlapping instances are quite fragile. Arguably, they should never be used.</p>\n\n<p>Anyway, overlapping instances cause GHC to avoid committing to an instance too soon. E.g.</p>\n\n<pre><code>-- overlapping\ninstance ... =&gt; Read [Int]  -- 1\ninstance ... =&gt; Read [a]    -- 2\n</code></pre>\n\n<p>When GHC has to solve a constraint such as <code>Read [b]</code>, it does not commit to instance 2, since it can't rule out the more specific instance 1: after all the type variable <code>b</code> could be later on found to be <code>Int</code>.</p>\n\n<p>If later on, <code>b</code> is found to be <code>Int</code>, instance 1 will be picked. If <code>b</code> is instead found to be <code>String</code>, GHC will pick instance 2.</p>\n\n<p>This however requires that there is a \"best choice\" in each case. I.e. when <code>b = Int</code>, both instances could be used, but 1 is more specific, hence it is the \"best\", and GHC chooses that.</p>\n\n<p>In the case you have instances</p>\n\n<pre><code>instance ... =&gt; Read [a] -- 3\ninstance ... =&gt; Read [a] -- 4\n</code></pre>\n\n<p>then no best instance exists, since they use the same head <code>Read [a]</code>, making the choice to be inherently ambiguous, and GHC rejects that.</p>\n\n<p>What probably confuses you is that GHC will <strong>never</strong> consider what's on the left of <code>=&gt;</code> (the \"context\") to pick an instance. It does not matter if the instances will not overlap once you consider their context, since no type can satisfy both contexts of 3 and 4. Detecting that the contexts are mutually exclusive is very hard in general, and GHC does not even attempt to do so. Only the instance head (on the right of <code>=&gt;</code>) is considered.</p>\n\n<p>There is no way to create such <em>two</em> default instances which are turned on automatically unless the client defines a more specific one.</p>\n\n<p>I'd prefer to avoid overlaps in instances, and provide a default implementation outside an instance. E.g.</p>\n\n<pre><code>-- library\nreadPrec_fromStrTag :: StrTag a =&gt; Int -&gt; ReadS a\nreadPrec_fromStrTag = parens $ do\n    RP.lift P.skipSpaces\n    (RP.lift $ expectShown anyStr) &lt;++ RP.lift g\n    where g = do\n            Just s@(_:_) &lt;- L.stripPrefix tagPrefix &lt;$&gt; expectTag\n            return $ toStr s\n</code></pre>\n\n<p>If the client wants to use that, they can enable the default implementation using</p>\n\n<pre><code>instance StrTag T where\n   ...\ninstance Read T where\n   readPrec = readPrec_fromStrTag  -- use default from the library\n</code></pre>\n\n<p>If this and other boilerplate is becoming too much burdensome, Template Haskell might help the user in writing that.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1512146617, "creation_date": 1512128886, "last_edit_date": 1512146617, "question_id": 47592742, "link": "https://stackoverflow.com/questions/47592742/default-instance-implementations-with-overlaps", "title": "Default instance implementations with &quot;overlaps&quot;", "body": "<p>I get error:</p>\n\n<pre><code> Duplicate instance declarations:\n   instance [overlap ok] EnumTag a =&gt; Read a\n     -- Defined at /XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX/intero/intero2932Xpa-TEMP.hs:110:27\n   instance [overlap ok] StrTag a =&gt; Read a\n     -- Defined at /XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX/intero/intero2932Xpa-TEMP.hs:121:27 (intero)\n</code></pre>\n\n<p>For this code:</p>\n\n<pre><code>class (Show a, Enum a) =&gt; EnumTag a where\n  anyEnum :: a\n\ninstance {-# OVERLAPS #-} EnumTag a =&gt; Read a where\n  readPrec = RP.lift P.skipSpaces &gt;&gt; expectEnum\ninstance {-# OVERLAPS #-} EnumTag a =&gt; Eq a where\n  a == b | a == anyEnum || b == anyEnum = True\n         | otherwise = fromEnum a == fromEnum b\n\nclass StrTag a where\n  anyStr :: a\n  tagPrefix :: a -&gt; String -- ^ should be constant\n  toStr :: String -&gt; a\n\ninstance {-# OVERLAPS #-} StrTag a =&gt; Read a where\n  readPrec = parens $ do\n    RP.lift P.skipSpaces\n    (RP.lift $ expectShown anyStr) &lt;++ RP.lift g\n    where g = do\n            Just s@(_:_) &lt;- L.stripPrefix tagPrefix &lt;$&gt; expectTag\n            return $ toStr s\n</code></pre>\n\n<p>Why does it happen? <code>Read a</code> in 1st instance is valid only when <code>a</code> is <code>EnumTag</code>, in 2nd one - is valid only when <code>a</code> is <code>StrTag</code>.</p>\n\n<p>How can I fix this error and to create \"default\" instances for <code>EnumTag</code> and to <code>StrTag</code>, so client code will \"inherit\" those functionality (Read) simple, only with instantiation of <code>EnumTag</code> or <code>StrTag</code> ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512129556, "post_id": 47592601, "comment_id": 82142851, "body": "<code>foldr (\\x ante-&gt;[x]:ante) [[4]] [1,2,3]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 215, "user_id": 7412579, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-73NA5jGT32Q/AAAAAAAAAAI/AAAAAAAAAIc/Tah3Og__E6I/photo.jpg?sz=128", "display_name": "Tyler Nickerson", "link": "https://stackoverflow.com/users/7412579/tyler-nickerson"}, "edited": false, "score": 0, "creation_date": 1512163212, "post_id": 47592974, "comment_id": 82161978, "body": "small nitpick: if <code>ante</code> has type <code>b</code> wouldn&#39;t <code>[ante]</code> have type <code>[b]</code>?"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1512163465, "last_edit_date": 1512163465, "creation_date": 1512129744, "answer_id": 47592974, "question_id": 47592601, "link": "https://stackoverflow.com/questions/47592601/why-does-foldr-give-me-this-error/47592974#47592974", "title": "Why does foldr give me this error?", "body": "<p>The <code>foldr</code> function has type:</p>\n\n<pre><code>foldr :: <b>(a -&gt; b -&gt; b)</b> -&gt; b -&gt; [a] -&gt; b</code></pre>\n\n<p>So that means that it takes as input an element (type <code>a</code>) of the list to fold, together with the accumulator (type <code>b</code>), and returns an accumulator (again type <code>b</code>). In case Haskell was not statically typed, it would each time wrap the accumulator in a new list. So it would result in:</p>\n\n<pre><code>[4]\n-&gt; [[3],[4]]\n-&gt; [[2],[[3],[4]]]\n-&gt; [[1],[[2],[[3],[4]]]]\n</code></pre>\n\n<p>which makes no sense.</p>\n\n<p>There are two problems here:</p>\n\n<ol>\n<li>if <code>ante</code> has type <code>b</code>, then <code>[x] : [ante]</code> has type <code>[b]</code>; and</li>\n<li>the type of the initial accumulator <code>[4]</code> is not the result of the foldr.</li>\n</ol>\n\n<p>So you can fix this by writing:</p>\n\n<pre><code>foldr (\\x ante-&gt;[x]:ante) [[4]] [1,2,3]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1512132416, "creation_date": 1512132416, "answer_id": 47593744, "question_id": 47592601, "link": "https://stackoverflow.com/questions/47592601/why-does-foldr-give-me-this-error/47593744#47593744", "title": "Why does foldr give me this error?", "body": "<p>Let's pretend this type checks, and run it anyway</p>\n\n<pre><code>foldr (\\x ante-&gt;[x]:[ante]) [4] [1,2,3]\n</code></pre>\n\n<p>Let's write <code>f</code> for <code>\\x ante -&gt; [x]:[ante]</code>.</p>\n\n<pre><code>foldr f [4] [1,2,3]\n=\nf 1 (f 2 (f 3 [4]))\n=\nf 1 (f 2 ([3]:[[4]]))\n=\nf 1 (f 2 [[3],[4]])\n</code></pre>\n\n<p>So far, so good.</p>\n\n<pre><code>=\nf 1 ([2] : [[[3],[4]]])\n=\nf 1 [[2] , [[3],[4]] ]\n</code></pre>\n\n<p>Now we're in trouble. Is that a <code>[[Int]]</code> or a <code>[[[Int]]]</code>?\nThings get even worse if we continue.</p>\n\n<p>The problem is that <code>f</code> must return a value of the same type as that of its second argument. Otherwise, we can't compose <code>f</code> in the way <code>foldr</code> does. Your <code>f</code> does not do that, instead adding a <code>[]</code> to the type at every call.</p>\n"}], "owner": {"reputation": 287, "user_id": 8738033, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/1944285682265003/picture?type=large", "display_name": "Joao Parente", "link": "https://stackoverflow.com/users/8738033/joao-parente"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1512163465, "creation_date": 1512128407, "last_edit_date": 1512128566, "question_id": 47592601, "link": "https://stackoverflow.com/questions/47592601/why-does-foldr-give-me-this-error", "title": "Why does foldr give me this error?", "body": "<pre><code>foldr (\\x ante-&gt;[x]:[ante]) [4] [1,2,3]\n</code></pre>\n\n<p>So if I get foldr right, the first time the function <code>(\\x ante-&gt;[x]:[ante])</code>  will do something, I will call this function f, it will be in:</p>\n\n<pre><code>   f 3 [4] = [3]:[[4]] = [[3],[4]]\n</code></pre>\n\n<p>Why doesn't the function do this? It shows this error instead:</p>\n\n<pre><code>* Occurs check: cannot construct the infinite type: a ~ [a]\n  Expected type: [a]\n    Actual type: [[a]]\n* In the expression: [x] : [ante]\n  In the first argument of `foldr', namely\n    `(\\ x ante -&gt; [x] : [ante])'\n  In the expression: foldr (\\ x ante -&gt; [x] : [ante]) [4] [1, 2, 3]\n* Relevant bindings include\n    ante :: [a] (bound at testefoldr.hs:51:21)\n    x :: a (bound at testefoldr.hs:51:19)\n    folder4 :: [a] (bound at testefoldr.hs:51:1)\n   |51 | folder4 = foldr (\\x ante-&gt;[x]:[ante]) [4] [1,2,3]    \n</code></pre>\n\n<p>I created a <code>.hs</code> then I put </p>\n\n<pre><code>folder4 = foldr (\\x ante-&gt;[x]:[ante]) [4] [1,2,3]\n</code></pre>\n\n<p>for faster testing. That's why there is folder4 in the error.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1512122116, "post_id": 47590514, "comment_id": 82138471, "body": "Haskell has not really &quot;<i>native</i>&quot; lists I think. Lists are not something that has to be implemented by a Haskell compiler, it is defined as a datastructure <code>data [a] = [] | (a : [a])</code>."}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512123394, "post_id": 47590514, "comment_id": 82139250, "body": "I get &quot;temp.hs:13:37: error:     Data constructor not in scope: Some :: a -&gt; Maybe a  temp.hs:15:34: error:     Data constructor not in scope:       Some :: Iterator [] a -&gt; Maybe (Iterator [] a)&quot; here."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1512129019, "post_id": 47590514, "comment_id": 82142514, "body": "Note that the error message you quoted is talking about <code>[]</code> as the first argument of <code>Iterable</code>, not anything to do with <code>Iterator</code> or <code>ListIterator</code>. It says <code>[]</code> of kind <code>* -&gt; *</code> (which is true), where it&#39;s expecting a type (which means something of kind <code>*</code>). leftaroundabout&#39;s answer explained why GHC was expecting that, but a careful read of the error message would have got you much closer to the right questions to be asking to debug this."}], "answers": [{"comments": [{"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1512122092, "post_id": 47590704, "comment_id": 82138449, "body": "What do you mean with &quot;c is not used&quot;  - My intention was that <code>c</code> is the &quot;container&quot; type of kind `` * -&gt; *`` and <code>a</code> is the element type of the container. Did I get it all wrong?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1512122175, "post_id": 47590704, "comment_id": 82138506, "body": "Yes... but you don&#39;t, for all the <i>class interface</i> knows, ever contain anything in <code>c</code>, you merely use it as the argument of <code>Iterator</code>. Hence the compiler doesn&#39;t see any reason to infer the more complicated kind <code>* -&gt; *</code> for <code>c</code>, and just picks <code>*</code> instead."}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1512122711, "post_id": 47590704, "comment_id": 82138822, "body": "I like the kind signature idea as it expresses what I really mean in this case. But... my <code>instance Iterable []</code> is still not compiling for whatever obscure reason. Could you show me your instance version?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1512123289, "post_id": 47590704, "comment_id": 82139176, "body": "It&#39;s exactly the one you posted. Save for the <code>Some</code> obviously, that should certainly be <code>Just</code>?"}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1512123536, "post_id": 47590704, "comment_id": 82139336, "body": "I get &quot;temp.hs:13:37: error:     Data constructor not in scope: Some :: a -&gt; Maybe a  temp.hs:15:34: error:     Data constructor not in scope:       Some :: Iterator [] a -&gt; Maybe (Iterator [] a)&quot; here."}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1512124042, "post_id": 47590704, "comment_id": 82139640, "body": "Gosh - this was a F# crossover... Its &quot;Just&quot; in haskell!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1512127718, "post_id": 47590704, "comment_id": 82141820, "body": "Right. <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Applicative.html#v:some\" rel=\"nofollow noreferrer\"><code>some</code></a> is something different in Haskell..."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1512122424, "last_edit_date": 1512122424, "creation_date": 1512121898, "answer_id": 47590704, "question_id": 47590514, "link": "https://stackoverflow.com/questions/47590514/do-native-haskell-lists-have-a-real-type-name-or-what-am-i-doing-wrong-her/47590704#47590704", "title": "Do native Haskell lists have a &quot;real&quot; type name? Or... what am I doing wrong here?", "body": "<p>Note that the class does not really use its argument in any way at all, it only uses <code>Iterator c</code> but not <code>c</code> itself. That's ok in principle &ndash; <code>c</code> works basically just as a tag, to select some other type &ndash; though you should ask yourself whether that's really what you want and if a more direct approach wouldn't be better.</p>\n\n<p>The only real problem: because <code>c</code> isn't used by itself, the compiler has no way of knowing what <em>kind</em> this should have. I.e., basically your class is <em>polymorphically kinded</em>, which Haskell98 doesn't allow... hence it defaults to the simplest possible kind, namely <code>*</code>. GHCi can tell you this:</p>\n\n<pre><code>*Main&gt; :k Iterable\nIterable :: * -&gt; Constraint\n</code></pre>\n\n<p>So that would work for e.g. <code>instance Iterable Int</code>, because <code>Int</code> has kind <code>*</code>. But <code>[]</code> doesn't, it has kind <code>* -&gt; *</code>. Hence that error message.</p>\n\n<p>You can enable GHC's <code>PolyKinds</code> extension to avoid this defaulting:</p>\n\n<pre><code>{-# LANGUAGE PolyKinds     #-}\n\nclass Iterable c where\n    data Iterator c :: * -&gt; *\n    current :: Iterator c a -&gt; Maybe a\n    next :: Iterator c a -&gt; Maybe (Iterator c a)\n</code></pre>\n\n<p>Now it is</p>\n\n<pre><code>*Main&gt; :k Iterable\nIterable :: k -&gt; Constraint\n</code></pre>\n\n<p>and therefore both <code>instance Iterable Int</code> will work (with <code>k ~ *</code>) and <code>instance Iterable []</code> too (with <code>k ~ (* -&gt; *)</code>).</p>\n\n<p>Alternatively, you could manually state that <code>c</code> should always have kind <code>* -&gt; *</code>:</p>\n\n<pre><code>{-# LANGUAGE KindSignatures #-}\n\nclass Iterable (c :: * -&gt; *) where\n    data Iterator c :: * -&gt; *\n    current :: Iterator c a -&gt; Maybe a\n    next :: Iterator c a -&gt; Maybe (Iterator c a)\n</code></pre>\n\n<p>Now <code>instance Iterable []</code> would work, but <code>instance Iterable Int</code> wouldn't.</p>\n"}], "owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 47590704, "answer_count": 1, "score": 1, "last_activity_date": 1512145326, "creation_date": 1512121253, "last_edit_date": 1512145326, "question_id": 47590514, "link": "https://stackoverflow.com/questions/47590514/do-native-haskell-lists-have-a-real-type-name-or-what-am-i-doing-wrong-her", "title": "Do native Haskell lists have a &quot;real&quot; type name? Or... what am I doing wrong here?", "body": "<p>Following the article about <a href=\"https://wiki.haskell.org/Type_families\" rel=\"nofollow noreferrer\">Haskell type families</a>, I found the courage to try it myself. Well knowing that Lists are already Applicative and whatnot, just to see if I got the ideas right, I tried to do the following:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nclass Iterable c where\n    data Iterator c :: * -&gt; *\n    current :: Iterator c a -&gt; Maybe a\n    next :: Iterator c a -&gt; Maybe (Iterator c a)\n\ninstance Iterable [] where\n    data Iterator [] a = ListIterator [a] -- Problem in this line!\n    current (ListIterator []) = Nothing\n    current (ListIterator (x:xs)) = Just x\n    next (ListIterator []) = Nothing\n    next (ListIterator (x:xs)) = Just (ListIterator xs)\n</code></pre>\n\n<p>This is in analogy of the example code given in the above haskell tutorial.\nWhat this is supposed to do is, to implement the type family <code>Iterable</code> for native Haskell lists, generically.</p>\n\n<p>I tried alternatively to write <code>data Iterator [a] = ListIterator [a]</code> but this yields the same error message as the code I show here:</p>\n\n<pre><code> temp.hs:8:19: error:\n    * Expecting one more argument to `[]'\n      Expected a type, but `[]' has kind `* -&gt; *'\n    * In the first argument of `Iterable', namely `[]'\n      In the instance declaration for `Iterable []'\n</code></pre>\n\n<p>Hence, my question, if I have an option to use the real type name for lists instead of <code>[]</code>, as I suspect, this is where my (syntactical?) problem is coming from.</p>\n"}, {"tags": ["javascript", "haskell", "functional-programming", "operators", "modulus"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 4, "creation_date": 1512120074, "post_id": 47590033, "comment_id": 82137317, "body": "No, not all operators form a <a href=\"https://en.wikipedia.org/wiki/Group_(mathematics)\" rel=\"nofollow noreferrer\">group</a> with an <a href=\"https://en.wikipedia.org/wiki/Identity_element\" rel=\"nofollow noreferrer\">identity element</a>. <code>%</code> does not, for example."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1512120195, "post_id": 47590033, "comment_id": 82137372, "body": "I&#39;m voting to close this question as off-topic because it has not much to do with programming (or even JS and Haskell specifically). You might get a better response at <a href=\"https://math.stackexchange.com\">Mathematics</a>"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1512122308, "post_id": 47590033, "comment_id": 82138595, "body": "This is not a monoid, nor even a semigroup, but the practical way to do what you probably want is to use a function such as <code>foldr1</code> in Haskell that does not take any identity element. Even if this is arguably an abuse of notation."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1512144244, "post_id": 47590033, "comment_id": 82152273, "body": "<code>%</code> has a <i>right</i> identity <code>1</code> because <code>a % 1 == a</code> for all <code>a</code>, but it has no <i>left</i> identity <code>e</code> that satisfies <code>e % a == a</code> for all <code>a</code>."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1512176902, "post_id": 47590033, "comment_id": 82165901, "body": "You might be interested in learning about modular arithmetic. This includes definitions of addition and multiplication that differs from the traditional meaning on real numbers."}, {"owner": {"reputation": 125, "user_id": 3219715, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/vQ0gr.png?s=128&g=1", "display_name": "Abhishek", "link": "https://stackoverflow.com/users/3219715/abhishek"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1512278011, "post_id": 47590033, "comment_id": 82189255, "body": "@chepner <code>a%1 = 0</code> so I don&#39;t think that mod even has a right identity."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1512309812, "post_id": 47590033, "comment_id": 82196328, "body": "@Abhishek Oh, right. I think i was getting confused with <code>1 % a == 1</code>, which establishes <code>1</code> as a left neutral element, not a left identity, for <code>%</code>."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1512207922, "post_id": 47590237, "comment_id": 82171486, "body": "Side note, your proof need not be by contradiction.  The same reasoning leads to a constructive proof that all identity elements are equal."}, {"owner": {"reputation": 125, "user_id": 3219715, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/vQ0gr.png?s=128&g=1", "display_name": "Abhishek", "link": "https://stackoverflow.com/users/3219715/abhishek"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1512388188, "post_id": 47590237, "comment_id": 82222993, "body": "@luqui can you elaborate on your comment about a constructive proof for uniqueness of identity?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1512414745, "post_id": 47590237, "comment_id": 82239023, "body": "@Abishek Say there are two neutral elements <i>a</i> and <i>b</i>.  Then <i>f(a,b) = a</i> by neutrality of <i>b</i>, and <i>f(a,b) = b</i> by neutrality of <i>a</i>, so <i>a = b</i>.   With Willem&#39;s proof, we only have that &quot;<i>a \u2260 b</i> is impossible&quot;.  The difference between these two proofs is important in constructive type theories (used by Agda, Coq, HoTT, etc.), and in these settings constructive proof is much richer in how it can be used."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1512472359, "last_edit_date": 1512472359, "creation_date": 1512120420, "answer_id": 47590237, "question_id": 47590033, "link": "https://stackoverflow.com/questions/47590033/identity-element-of-modulus-operator-to-be-used-in-fold/47590237#47590237", "title": "Identity element of modulus operator to be used in fold", "body": "<p>Typically a <em>fold</em> is done over an algebraic structure called a <a href=\"https://en.wikipedia.org/wiki/Monoid\" rel=\"nofollow noreferrer\"><strong>monoid</strong> [wiki]</a>.</p>\n\n<p>A monoid is an <em>algebraic</em> structure. It is defined over a set <em>S</em> with an <em>associative</em> function <em>f</em> (modulo is not an associative function). Furthermore there should be an element <em>e &in; S</em> that is called the \"*identity\" element. An element such that <em>f(e,x) = x</em> and <em>f(x,e) = x</em>.</p>\n\n<p>One can proof that for a monoid there is always <em>one</em> identity element (so it is impossible to construct a monoid where two elements are identity elements. The proof is a follows: say there are two elements <em>a</em> and <em>b</em> that are neutral elements, with <em>a &ne; b</em>, then <em>f(a,b) = a</em> (definition above), but <em>f(a,b)=b</em> also holds, since a function can only return one element, and <em>a&ne; b</em>, we have reached a contradiction. We can furthermore thus conclude that <em>a = b</em>.</p>\n\n<p>We can not define a monoid for the modulo operation (and natural, integral, ...) numbers, since the operator should be <em>associative</em>, and for these sets, it does not hold that: <s><em>(a % b) % c = a % (b % c)</em></s>.</p>\n\n<p>To answer your questions (in general):</p>\n\n<blockquote>\n  <p>What is identity element for modulus operator if it exists? %(identity, a) = a</p>\n</blockquote>\n\n<p>If we take natural, integral, rational, real, etc. numbers, then modulo does not have an identity element.</p>\n\n<blockquote>\n  <p>Are there any specific properties that the operator must follow to have an identity?</p>\n</blockquote>\n\n<p>Simply that there is an element <em>e &in; S</em> such that <em>f(x, e) = x</em>. We can \"construct\" such function from every function, by simply picking an element <em>e &in; S</em>, and then define it as: <em>f'(x,y) = x</em> if <em>y = e</em> and <em>f'(x,y) = f(x,y)</em> otherwise.</p>\n\n<blockquote>\n  <p>Is there a general way to find the identity of an operator if it has an identity.</p>\n</blockquote>\n\n<p>Since the above shows that we can construct such function for every function, there are no general methods as far as I know to fund the identity element of an operator.</p>\n"}], "owner": {"reputation": 125, "user_id": 3219715, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/vQ0gr.png?s=128&g=1", "display_name": "Abhishek", "link": "https://stackoverflow.com/users/3219715/abhishek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 468, "favorite_count": 0, "accepted_answer_id": 47590237, "answer_count": 1, "score": 2, "last_activity_date": 1512472359, "creation_date": 1512119617, "last_edit_date": 1512120103, "question_id": 47590033, "link": "https://stackoverflow.com/questions/47590033/identity-element-of-modulus-operator-to-be-used-in-fold", "title": "Identity element of modulus operator to be used in fold", "body": "<p>In fold function in functional paradigm, we pass and accumulator value which is generally initialized as the identity element of the operator the function applies.</p>\n\n<p>Like for addition over a list it will be 0, for multiplication 1, and so on.\ni.e., <code>+(0, a) = a</code> and</p>\n\n<pre><code>*(1, a) = a\n</code></pre>\n\n<p>So what it will be for mod operator <strong><em>%(identity, a) = a</em></strong>?\nMod will be from <code>[0,a)</code> so identity does not seem to be possible.\nI understand that computers don't necessarily follow the mathematical definition of modulus.\nMoreover <strong><em>do all operators have an identity element or it is dependent on some specific properties that the operator should have?\nAnd is there any generalised way to find the identity element of any operator?</em></strong></p>\n\n<p>My questions are:</p>\n\n<ul>\n<li>What is identity element for modulus operator if it exists? %(identity, a) = a</li>\n<li>Are there any specific properties that the operator must follow to have an identity?</li>\n<li>Is there a general way to find the identity of an operator if it has an identity.</li>\n</ul>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512108134, "post_id": 47587357, "comment_id": 82132292, "body": "In my opinion, you&#39;ve misidentified what your problem is. If you are working from the command line and opening a browser is too much of a workflow interruption, then get a command line browser (there are an absolute throng of these out there...). A web browser is (primarily) a tool to browse remote web servers. Any support stack has now or in the future for browsing stackage will be reinventing the wheel (in other words, stack is not a web browser, and so will never have the functionality of a web browser)."}, {"owner": {"reputation": 1073, "user_id": 570693, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/116541a9a982bab83135291c70eb914b?s=128&d=identicon&r=PG&f=1", "display_name": "Karl", "link": "https://stackoverflow.com/users/570693/karl"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512157250, "post_id": 47587357, "comment_id": 82159279, "body": "@user2407038 I strongly disagree with this.  A web browser is for viewing externally located documents, not for browsing general data.  Would you also suggest is not be possible to query package managers like apt without first loading a website?  Perhaps tools like curl shouldn&#39;t exist?"}], "answers": [{"comments": [{"owner": {"reputation": 1073, "user_id": 570693, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/116541a9a982bab83135291c70eb914b?s=128&d=identicon&r=PG&f=1", "display_name": "Karl", "link": "https://stackoverflow.com/users/570693/karl"}, "edited": false, "score": 0, "creation_date": 1512157494, "post_id": 47587420, "comment_id": 82159383, "body": "Thank you. This gives me a good overview of everything relevant."}], "tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": true, "score": 4, "last_activity_date": 1512107701, "creation_date": 1512107701, "answer_id": 47587420, "question_id": 47587357, "link": "https://stackoverflow.com/questions/47587357/using-stack-without-a-browser-list-resolvers-search-etc/47587420#47587420", "title": "Using Stack without a browser? List resolvers, search, etc.", "body": "<p>There is a soon-to-be-merged feature that will probably make it into the version after 1.6 <a href=\"https://github.com/commercialhaskell/stack/pull/3252\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/pull/3252</a> , it lists snapshots.</p>\n\n<p>One option to see the latest snapshots is to use what <code>stack build --resolver lts</code> or <code>--resolver nightly</code> uses.  You can also see what <code>stack init</code> chooses.</p>\n\n<p>I don't think there are currently any direct ways to query what's in the snapshot from the CLI.  One option would be to do <code>stack build name-of-tool --dry-run</code>, and it will tell you what would be installed.</p>\n\n<p>Generally, yes, I think stack could do a better job of letting you query info.  Some of it is tracked here - <a href=\"https://github.com/commercialhaskell/stack/issues/1614\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/issues/1614</a> .  Please consider discussing design of such features on the issue tracker, and possibly implementing the features.  That would be greatly appreciated and valuable to the community!</p>\n\n<p>Also, you might like <code>stack hoogle</code>!  Very handy for getting offline info / without web browser, but requires that you build everything with docs enabled.</p>\n"}], "owner": {"reputation": 1073, "user_id": 570693, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/116541a9a982bab83135291c70eb914b?s=128&d=identicon&r=PG&f=1", "display_name": "Karl", "link": "https://stackoverflow.com/users/570693/karl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 47587420, "answer_count": 1, "score": 3, "last_activity_date": 1512107701, "creation_date": 1512107331, "question_id": 47587357, "link": "https://stackoverflow.com/questions/47587357/using-stack-without-a-browser-list-resolvers-search-etc", "title": "Using Stack without a browser? List resolvers, search, etc.", "body": "<p>Is there a way to use Stack as a proper command line tool without constantly trying to navigate and search in a browser on <a href=\"http://stackage.org\" rel=\"nofollow noreferrer\">Stackage</a>?</p>\n\n<p>I often want to search for a tool that I might want to install globally to see what version, if any, is offered.  Additionally, I sometimes want to see what resolver versions are available when considering upgrading a project.</p>\n\n<p>As far as I can tell, this currently requires navigating to stackage.org, which is a very disruptive workflow.  Have I overlooked some kind of search command?</p>\n"}, {"tags": ["haskell", "functional-programming", "scheme"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1512101680, "post_id": 47586536, "comment_id": 82130691, "body": "What would a function without a return value do in Haskell?"}, {"owner": {"reputation": 313, "user_id": 3053405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97af3f6be0ec30b92f79beda9b1e8f28?s=128&d=identicon&r=PG&f=1", "display_name": "Zooby", "link": "https://stackoverflow.com/users/3053405/zooby"}, "edited": false, "score": 0, "creation_date": 1512101703, "post_id": 47586536, "comment_id": 82130701, "body": "I&#39;m not sure I&#39;m following the question. if something has no return type, why&#39;s it a function?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1512101736, "post_id": 47586536, "comment_id": 82130709, "body": "Sort of. Ignoring implementation details, you can think of <code>void</code> as being a return type that has exactly one inhabitant. Haskell chooses to make that sort of thing explicit - our <code>void</code> is <code>()</code>."}, {"owner": {"reputation": 167, "user_id": 9018650, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/38270f480b97b98be067cae9564c8542?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff Yan", "link": "https://stackoverflow.com/users/9018650/jeff-yan"}, "edited": false, "score": 0, "creation_date": 1512101815, "post_id": 47586536, "comment_id": 82130730, "body": "Like in Java, we have the void method.We just do some operation, but no return value"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1512101907, "post_id": 47586536, "comment_id": 82130753, "body": "You can&#39;t do such operations in Haskell. It is a pure language. A function without a return value (or one that returns <code>()</code>, as Alec suggests) wouldn&#39;t do anything at all."}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 5, "last_activity_date": 1512102108, "creation_date": 1512102108, "answer_id": 47586601, "question_id": 47586536, "link": "https://stackoverflow.com/questions/47586536/declare-a-function-with-no-return-value/47586601#47586601", "title": "Declare a function with no return value?", "body": "<p>What would the purpose be of such a function? Also if you think of a mathematical function (the base of functional programming) what would be the codomain of such a function?</p>\n\n<p>So the short answer is no in haskell (i don't know enough scheme to give an informed answer regarding that).</p>\n\n<p>The closest thing to void in java in haskell would be <code>IO ()</code></p>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1512133244, "post_id": 47588086, "comment_id": 82145088, "body": "I think there&#39;s a connection between functions to <code>void</code> and polymorphic null data constructors. One could think of <code>Nothing</code> as a function from a type to <code>()</code>."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 7, "last_activity_date": 1512111189, "creation_date": 1512111189, "answer_id": 47588086, "question_id": 47586536, "link": "https://stackoverflow.com/questions/47586536/declare-a-function-with-no-return-value/47588086#47588086", "title": "Declare a function with no return value?", "body": "<p>In Haskell, you can write a whole family of functions that return <code>()</code> (<em>unit</em>), which is equivalent to <code>void</code> in C languages:</p>\n\n<pre><code>foo :: a -&gt; ()\nfoo _ = ()\n\nbar :: a -&gt; b -&gt; ()\nbar _ _ = ()\n</code></pre>\n\n<p>You'll notice, however, that my implementations <em>ignore their</em> input, and simply return <code>()</code>, so they don't <em>do</em> anything.</p>\n\n<p>You can call them like this:</p>\n\n<pre><code>Prelude&gt; foo 42\n()\nPrelude&gt; bar 42 \"foo\"\n()\n</code></pre>\n\n<p>but this still doesn't accomplish anything.</p>\n\n<p>You can, on the other hand, write functions that return <code>IO ()</code>, like this:</p>\n\n<pre><code>main :: IO ()\nmain = putStrLn \"Hello, world!\"\n</code></pre>\n\n<p>but this is now impure. While this produces a side-effect, you could argue whether or not it's functional. At the very least, in Haskell, you can't call impure code from pure code (this is by design), so it doesn't compose.</p>\n"}, {"tags": [], "owner": {"reputation": 18082, "user_id": 1193075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MzRH4.jpg?s=128&g=1", "display_name": "uselpa", "link": "https://stackoverflow.com/users/1193075/uselpa"}, "is_accepted": false, "score": 2, "last_activity_date": 1512114032, "creation_date": 1512114032, "answer_id": 47588716, "question_id": 47586536, "link": "https://stackoverflow.com/questions/47586536/declare-a-function-with-no-return-value/47588716#47588716", "title": "Declare a function with no return value?", "body": "<p>In Racket you can:</p>\n\n<pre><code>Welcome to DrRacket, version 6.11 [3m].\nLanguage: racket, with debugging; memory limit: 128 MB.\n&gt; (define (f) (displayln \"hello\") (void))\n&gt; (f)\nhello\n&gt; (void? (f))\nhello\n#t\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 0, "last_activity_date": 1512121882, "creation_date": 1512121882, "answer_id": 47590694, "question_id": 47586536, "link": "https://stackoverflow.com/questions/47586536/declare-a-function-with-no-return-value/47590694#47590694", "title": "Declare a function with no return value?", "body": "<p>In Haskell the <em>only</em> thing a function <em>does</em> is to return a value.</p>\n\n<p>If a function doesn't return anything, then what the heck does it actually <em>do</em>?</p>\n\n<p>You're probably thinking about something like a print \"function\", which prints something out and returns nothing. But that's not a mathematical <em>function</em>, that's an <em>action</em>. Haskell models those in a completely different way (i.e., monads). If you want to know what that is, there's elevanty billion discussions about it here on Stack Overflow, and littered across the face of the Internet.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512136325, "post_id": 47594477, "comment_id": 82147047, "body": "<a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Void.html#v:absurd\" rel=\"nofollow noreferrer\"><code>absurd</code></a> is actually <code>Void -&gt; a</code>, not the other way around. <code>Void</code> is the <i>initial</i> object of <b>Hask</b>; the terminal object is <code>()</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512136427, "post_id": 47594477, "comment_id": 82147126, "body": "Sigh. That&#39;s what I get for trying to write this from memory."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1512166549, "post_id": 47594477, "comment_id": 82163228, "body": "Also, you <i>can</i> define <code>absurd</code>; basically the only way to do it is the (empty but exhaustive!) case match <code>absurd x = case x of {}</code>. That&#39;s the point: there exists precisely one function <code>Void -&gt; a</code>, like there is exactly one function <code>a -&gt; ()</code>. This being the requirement of an initial / terminal object."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1512171799, "post_id": 47594477, "comment_id": 82164902, "body": "Yes, <code>absurd</code> is perfectly well defined and non-absurd in and of itself. It&#39;s the implications of actually <i>calling</i> it that are absurd, which you can&#39;t do without &quot;cheating&quot; since you need to first obtain a value of type <code>Void</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1512177947, "last_edit_date": 1512177947, "creation_date": 1512134858, "answer_id": 47594477, "question_id": 47586536, "link": "https://stackoverflow.com/questions/47586536/declare-a-function-with-no-return-value/47594477#47594477", "title": "Declare a function with no return value?", "body": "<p>First, you need to remember that programming languages tend to use the word \"function\" in a sense that is different from the mathematical meaning. A programming-language function is just a named subroutine that may or may not produce a value that can be assigned or passed around.</p>\n\n<p>Pascal made somewhat of a distinction between a \"real\" function and one that returned no value; the keyword <code>procedure</code> creates a subroutine that returns nothing, the keyword <code>function</code> has to return a value of some type.</p>\n\n<p>C is an example that blurs this distinction; a function can have a return value of type <code>void</code> which in reality is type with exactly <em>one</em> value (although that value isn't actually represented in code; you have to pretend it exists). Every function with this return type always returns that same value. Python makes it a little more explicit; a function with no <code>return</code> statement or a <code>return</code> statement with no value actually returns the singleton value <code>None</code>.</p>\n\n<p>Haskell has a similar type, <code>()</code>, which is inhabited by a single value with the same name. You can of course define a family of functions, one function per type, <code>foo :: a -&gt; ()</code> which ignores its argument and returns <code>()</code>. It doesn't have any <em>practical value</em> (as a pure language, a function can't do anything <em>except</em> return a value of its declared return type), but it does indeed exist. <code>foo _ = ()</code>.</p>\n\n<p>Incidentally, the functions of type <code>a -&gt; ()</code> establish <code>()</code> as the <em>terminal</em> object in the (pseudo)category <strong>Hask</strong>, which is necessary for establishing <strong>Hask</strong> as a <em>cartesian-closed category</em>, making it suitable for defining the semantics of Haskell.</p>\n\n<hr>\n\n<p>However, Haskell also <em>does</em> have a type that contains <em>no</em> values, appropriately called <code>Void</code>:</p>\n\n<pre><code>data Void\n</code></pre>\n\n<p>Since <code>Void</code> is a valid type, you can imagine a type that contains functions from <code>Void</code> to any other type:</p>\n\n<pre><code>absurd :: Void -&gt; a\n</code></pre>\n\n<p>However, since there are no values of type <code>Void</code>, you can't really <em>call</em> such a function. The unique function of type <code>Void -&gt; a</code> can be defined as</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>absurd x = case x of {}  -- There's nothing x *can* match\n</code></pre>\n\n<p>This is not to say that <code>absurd</code> has no use at all, just no practical use. Just as functions of type <code>a -&gt; ()</code> define <code>()</code> as the terminal object in <strong>Hask</strong>, <code>absurd</code> defines <code>Void</code> as the <em>initial</em> object in <strong>Hask</strong>.</p>\n\n<p>(The latter half of this answer is a (bad) synopsis of information found in Bartosz Milewski's fantastic series of posts <a href=\"https://bartoszmilewski.com/2014/10/28/category-theory-for-programmers-the-preface/\" rel=\"nofollow noreferrer\">Category Theory for Programmers</a>.)</p>\n"}], "owner": {"reputation": 167, "user_id": 9018650, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/38270f480b97b98be067cae9564c8542?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff Yan", "link": "https://stackoverflow.com/users/9018650/jeff-yan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5522, "favorite_count": 1, "answer_count": 5, "score": 1, "last_activity_date": 1512177947, "creation_date": 1512101533, "question_id": 47586536, "link": "https://stackoverflow.com/questions/47586536/declare-a-function-with-no-return-value", "title": "Declare a function with no return value?", "body": "<p>Can we create a function with void (i.e with no return value)  in functional languages? Like Haskell or Scheme</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1512088031, "post_id": 47584823, "comment_id": 82127304, "body": "What is the exact sequence of commands you are running?"}, {"owner": {"reputation": 11, "user_id": 4621297, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-fmjEVva4L4A/AAAAAAAAAAI/AAAAAAAAEGo/5OnzdRGxoTE/photo.jpg?sz=128", "display_name": "Spikes ", "link": "https://stackoverflow.com/users/4621297/spikes"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1512088779, "post_id": 47584823, "comment_id": 82127531, "body": "@DanielWagner I am using the command <code>:l Main.hs</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 6, "creation_date": 1512088894, "post_id": 47584823, "comment_id": 82127560, "body": "This is a happy grammar - it should have a <code>.y</code> suffix and you need to compile it with <code>happy</code> before loading it into GHCi. Note that if this is part of a larger project, Cabal can handle that second part for you (just make sure to include <code>happy</code> in <code>build-tools</code>)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1512088896, "post_id": 47584823, "comment_id": 82127561, "body": "Okay. This is not Haskell code, and cannot be used directly by ghc(i). Presumably you got this code from a tutorial or similar; you should consult the tutorial to know for sure the right way to build this code. It needs to be preprocessed by some tool (probably alex or happy?) to produce Haskell code."}], "answers": [{"tags": [], "owner": {"reputation": 62902, "user_id": 90511, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/nmOPo.png?s=128&g=1", "display_name": "hugomg", "link": "https://stackoverflow.com/users/90511/hugomg"}, "is_accepted": true, "score": 6, "last_activity_date": 1512089043, "creation_date": 1512089043, "answer_id": 47584979, "question_id": 47584823, "link": "https://stackoverflow.com/questions/47584823/haskell-parse-error-on-input-module/47584979#47584979", "title": "Haskell; Parse error on input &#39;module&#39;", "body": "<p>What you have there is not a Haskell file. It looks like it is a grammar file for a parser generator, (likely <a href=\"https://www.haskell.org/happy/\" rel=\"noreferrer\">Happy</a>).</p>\n\n<p>You should first rename your grammar file to use the <code>.y</code> file extension, since it is a grammar file and isn't a Haskell source code file. Then, invoke the parser generator to generate the <code>Main.hs</code> from the <code>Main.y</code> you have</p>\n\n<pre><code>happy Main.y\n</code></pre>\n\n<p>Finally, you can take this generated <code>Main.hs</code> file and run it with ghc.</p>\n"}], "owner": {"reputation": 11, "user_id": 4621297, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-fmjEVva4L4A/AAAAAAAAAAI/AAAAAAAAEGo/5OnzdRGxoTE/photo.jpg?sz=128", "display_name": "Spikes ", "link": "https://stackoverflow.com/users/4621297/spikes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 702, "favorite_count": 0, "accepted_answer_id": 47584979, "answer_count": 1, "score": 0, "last_activity_date": 1512089043, "creation_date": 1512087929, "question_id": 47584823, "link": "https://stackoverflow.com/questions/47584823/haskell-parse-error-on-input-module", "title": "Haskell; Parse error on input &#39;module&#39;", "body": "<p>I am trying to write a parser in Haskell, and am having trouble with it compiling. The error is \"parse error on input 'module'. I can fix this error by taking away the brackets, but then the error just switches to \"parse error on input \"%\". I have also tried removing the <code>module Main where</code> line, but that still give me the error on input for \"%\".</p>\n\n<pre><code>{\nmodule Main where\n}\n\n%name parser\n%tokentype { Token }\n%error { parseError }\n\n%token\n...\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1512117799, "post_id": 47584615, "comment_id": 82136201, "body": "<code>a -&gt; a</code> unifies with <code>c -&gt; m b</code>: we can pick ` a = c = m b`."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 7, "last_activity_date": 1512140383, "last_edit_date": 1512140383, "creation_date": 1512086631, "answer_id": 47584643, "question_id": 47584615, "link": "https://stackoverflow.com/questions/47584615/implement-join-using-bind/47584643#47584643", "title": "Implement join using bind", "body": "<p>If <code>x</code> has type <code>m (m t)</code>, then <code>a</code> is <code>m t</code>, so <code>id</code> in this context has the type <code>m b -&gt; m b</code>, which fits the type of <code>&gt;&gt;=</code>.</p>\n"}], "owner": {"reputation": 181, "user_id": 3511511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f695d53cc3acd300a9e119b40c9d7ac?s=128&d=identicon&r=PG", "display_name": "user12457", "link": "https://stackoverflow.com/users/3511511/user12457"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1512140383, "creation_date": 1512086412, "question_id": 47584615, "link": "https://stackoverflow.com/questions/47584615/implement-join-using-bind", "title": "Implement join using bind", "body": "<p>I am trying to understand how join is implemented using bind (>>=). </p>\n\n<pre><code>join x  = x &gt;&gt;= id\n</code></pre>\n\n<p>id has type of (a -> a) but bind needs a function of type (a -> m b). I couldn't match the type.</p>\n"}, {"tags": ["haskell", "dependency-injection", "separation-of-concerns"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1512063627, "post_id": 47579216, "comment_id": 82115957, "body": "&quot;In the code above, both DummyStorage and DummyReporter have to have trivial instances for WeatherService, which seems plainly wrong.&quot; No, that&#39;s how MTL works. All the transformers have instances for all the type classes (well, mostly) so that you can stack them in any order you want. <a href=\"https://github.com/haskell/mtl/blob/master/Control/Monad/Reader/Class.hs#L125\" rel=\"nofollow noreferrer\">Example</a> from the MTL source code."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1512063828, "post_id": 47579216, "comment_id": 82116083, "body": "Ok, so it seems unavoidable then. And now that you mention it, I don&#39;t use transformers at all in the code above (maybe thanks to the <code>GeneralizedNewtypeDeriving</code> magic?)."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1512063965, "post_id": 47579216, "comment_id": 82116173, "body": "And I also wonder whether using MTL when you have cross-cutting concerns as in this example has any advantages over functions."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1512064234, "post_id": 47579216, "comment_id": 82116358, "body": "You are using transformers, you just didn&#39;t write the instances of <code>MonadTrans</code>. eg, <code>instance MonadTrans DummyReporter where lift = DummyReporter</code>. I&#39;m afraid I don&#39;t understand your question about cross-cutting concerns"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1512064662, "post_id": 47579216, "comment_id": 82116644, "body": "Sorry for the confusion. What I meant by cross curring concerns is that we need implementations for a weather-service, a storage-service, and a reporting-service (all of which are orthogonal), that need to be combined in a single program <code>reportWeather</code> above. Maybe orthogonal-concerns is a better description."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 5, "creation_date": 1512068244, "post_id": 47579216, "comment_id": 82118715, "body": "I&#39;ve been writing <a href=\"http://blog.ploeh.dk/2017/01/27/from-dependency-injection-to-dependency-rejection\" rel=\"nofollow noreferrer\">fairly extensively on this topic</a>. In this case, I&#39;d question whether you even <i>need</i> DI, or an alternative. Essentially, all you describe is impure, with little (if any) logic, so you should be able to just compose (impure) functions together: 1. Fetch the weather data (impure). 2. translate it (probably pure). 3. Report (side-effects, impure). Just chain the functions together. Why do you need mtl or transformers? What value does it provide?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1512070700, "post_id": 47579216, "comment_id": 82120034, "body": "It seems that you&#39;ve already found at least one proper solution to this problem (the linked module you&#39;ve entitled <code>WeatherReporterFreeSeparated</code>). It is a well known limitation of monad transformers that you need <code>n*m</code> instances (where <code>n</code>=the number of transformers and <code>m</code>=number of classes) - e.g. <code>ReaderT</code> has &#39;trivial&#39; instances for <code>MonadWriter</code>, <code>MonadState</code>, etc. However, it isn&#39;t true that order matters (you can have instances for all 3 classes for all 3 types). Unless there is a compelling reason to use monad transformers, I would recommend you use the solution you&#39;ve found already."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1512401161, "post_id": 47579216, "comment_id": 82231200, "body": "@MarkSeemann I&#39;ve went through the series of articles you referred, nice. For the problem I posed in this question, I think I do need what in the OO world is called DI: the core business logic should remain the same (fetch, store, report - all impure), but the implementation of these (impure) parts might change. I do agree that from the three approaches I tried <a href=\"https://github.com/capitanbatata/sandbox/blob/master/on-dependency-injection-in-fp/a-weather-app/src/WeatherReporterFunctionsAndMonads.hs\" rel=\"nofollow noreferrer\">using monadic functions</a> is the one that seems simpler and better separates concerns."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1512403620, "post_id": 47579216, "comment_id": 82232834, "body": "<i>fetch, store, report</i> - is that really <i>business</i> logic? Is it something your business stakeholders care about, and that they may ask you to change in the future?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1512407562, "post_id": 47579216, "comment_id": 82235299, "body": "I would say the sequence <code>fetch &gt;&gt; store &gt;&gt; report</code> is business logic. And as I exemplified in the question, <code>fetch</code> might use an online service or some hardware, <code>store</code> might use a database or a file, <code>report</code> might print to screen or speak the weather. So I was wondering how these implementation specific details could be abstracted using MTL (instead of functions or free monads for instance)."}], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1512401249, "post_id": 47582371, "comment_id": 82231273, "body": "Looks good. I think I&#39;ve reached a <a href=\"https://github.com/capitanbatata/sandbox/blob/master/on-dependency-injection-in-fp/a-weather-app/src/WeatherReporterFunctionsAndMonads.hs\" rel=\"nofollow noreferrer\">similar solution</a> using monadic functions."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 1, "creation_date": 1512412072, "post_id": 47582371, "comment_id": 82237702, "body": "@DamianNadales I expanded my answer in this gist <a href=\"https://gist.github.com/danidiaz/5fb8ac9ecf40875617cba503214dd3c2\" rel=\"nofollow noreferrer\">gist.github.com/danidiaz/5fb8ac9ecf40875617cba503214dd3c2</a>  My aim was to avoid the boilerplate of explicitly zooming every typeclass method when declaring the instances for the <code>Injected</code> newtype. Interestingly, I too ended up using <code>MultiParamTypeClasses</code>, but perhaps went a bit overboard with the type shenanigans."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 1, "creation_date": 1512558060, "post_id": 47582371, "comment_id": 82304224, "body": "@DamianNadales If we avoid <code>StateT</code> and limit ourselves to using <code>ReaderT</code> over <code>IO</code> and mutable references for carrying state, these patterns fit well with the &quot;unliftio&quot; approach <a href=\"http://hackage.haskell.org/package/unliftio\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/unliftio</a> <a href=\"https://www.youtube.com/watch?v=KZIN9f9rI34\" rel=\"nofollow noreferrer\">youtube.com/watch?v=KZIN9f9rI34</a>"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1512561786, "post_id": 47582371, "comment_id": 82306458, "body": "Thanks for the links. I didn&#39;t know about unliftio. For the example I gave, I&#39;d expect <code>ReaderT</code> and <code>IO</code> to be enough. In more concrete scenarios maybe these restrictions make sense as well."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 3, "last_activity_date": 1512075790, "last_edit_date": 1512075790, "creation_date": 1512074999, "answer_id": 47582371, "question_id": 47579216, "link": "https://stackoverflow.com/questions/47579216/doing-dependency-injection-using-monad-stacks/47582371#47582371", "title": "Doing dependency injection using monad stacks", "body": "<p>Instead of tying implementations to specific newtypes, perhaps you could have \"free-floating\" implementation functions that required access to IO and to some necessary bookkeeping state, like</p>\n\n<pre><code>data WeatherState = WeatherState -- dummy\nfetch' :: (MonadState WeatherState m,MonadIO m) =&gt; m WeatherData\nfetch' = undefined \ndata StorageState = StorageState -- dummy\nstore' :: (MonadState StorageState m,MonadIO m) =&gt; WeatherData -&gt; m ()\nstore' = undefined \ndata ReporterState = ReporterState -- dummy\nreport' :: (MonadState ReporterState m,MonadIO m) =&gt; WeatherData -&gt; m ()\nreport' = undefined\n</code></pre>\n\n<p>\"Injecting\" would mean creating some newtype over a <code>StateT</code> carrying the required states, and then declaring instances like</p>\n\n<pre><code>newtype Injected a = \n    Injected { getInjected :: StateT (WeatherState,StorageState,ReportState) a } \n    deriving (Functor,Applicative,Monad)\n\ninstance WeatherService Injected where\n    fetch = Injected $ zoom _1 fetch'\n\ninstance Storage Injected where\n    store x = Injected $ zoom _2 $ store' x\n\ninstance Reporter Injected where\n    report x = Injected $ zoom _3 $ report' x\n</code></pre>\n\n<p>(<a href=\"http://hackage.haskell.org/package/microlens-0.4.8.1/docs/Lens-Micro.html#v:_1\" rel=\"nofollow noreferrer\"><code>_1</code></a> is from <em>microlens</em> and  <a href=\"http://hackage.haskell.org/package/microlens-mtl-0.1.11.0/docs/Lens-Micro-Mtl.html#v:zoom\" rel=\"nofollow noreferrer\"><code>zoom</code></a> from <em>microlens-mtl</em>.)</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 552, "favorite_count": 1, "accepted_answer_id": 47582371, "answer_count": 1, "score": 8, "last_activity_date": 1512075790, "creation_date": 1512062694, "question_id": 47579216, "link": "https://stackoverflow.com/questions/47579216/doing-dependency-injection-using-monad-stacks", "title": "Doing dependency injection using monad stacks", "body": "<p>I'm <a href=\"https://github.com/capitanbatata/sandbox/tree/master/on-dependency-injection-in-fp/a-weather-app\" rel=\"noreferrer\">trying different approaches</a> to do what is sometimes known as dependency injection. For this I've elaborated a simple example of a weather app, where we want to fetch the weather data (from a web-service or from a hardware device), store the weather data (could be a database or simply a file), and report it (either print it to screen, or speak the weather). The idea is to write a program that uses some <code>fetch</code>, <code>store</code>, and <code>report</code> functions, whose implementations can vary.</p>\n\n<p>I've managed to separate concerns and abstract away from the implementations of retrieval, storage, and reporting using <a href=\"https://github.com/capitanbatata/sandbox/blob/master/on-dependency-injection-in-fp/a-weather-app/src/WeatherReporterFunctions.hs\" rel=\"noreferrer\">functions</a> and <a href=\"https://github.com/capitanbatata/sandbox/blob/master/on-dependency-injection-in-fp/a-weather-app/src/WeatherReporterFreeSeparated.hs\" rel=\"noreferrer\">free-monads</a>, however the solution I reached with monad stacks looks bad:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nmodule WeatherReporterMTL where\n\nimport           Control.Monad.IO.Class\nimport           Control.Monad.Trans.Class\n\ntype WeatherData = String\n\nclass Monad m =&gt; WeatherService m where\n    fetch :: m WeatherData\n\nclass Monad m =&gt; Storage m where\n    store :: WeatherData -&gt; m ()\n\nclass Monad m =&gt; Reporter m where\n    report :: WeatherData -&gt; m ()\n\n-- | A dummy implementation of the @WeatherService@\nnewtype DummyService m a = DummyService { runDummyService :: m a }\n    deriving (Functor, Applicative, Monad, MonadIO)\n\ninstance MonadIO m =&gt; WeatherService (DummyService m) where\n    fetch = return \"won't get any warmer in December.\"\n\n-- | A dummy implementation of the @Storage@\nnewtype DummyStorage m a = DummyStorage { runDummyStorage :: m a }\n    deriving (Functor, Applicative, Monad, MonadIO, WeatherService)\n\n-- It seems wrong that the storage has to be an instance the weather service\n-- (@WeatherService@) ...\n\ninstance MonadIO m =&gt; Storage (DummyStorage m) where\n    store d = liftIO $ putStrLn $ \"No room left for this report: \" ++ d\n\n-- | A dummy implementation of the @Reporter@\nnewtype DummyReporter m a = DummyReporter { runDummyReporter :: m a }\n    deriving (Functor, Applicative, Monad, MonadIO, WeatherService, Storage)\n\n-- Ok, now this seems even worse: we're putting information about\n-- how we're gonna stack our monads :/\n\ninstance MonadIO m =&gt; Reporter (DummyReporter m) where\n    report d = liftIO $ putStrLn $ \"Here at the MTL side \" ++ d\n\nreportWeather :: (WeatherService m, Storage m, Reporter m) =&gt; m ()\nreportWeather = do\n    w &lt;- fetch\n    store w\n    report w\n\ndummyWeatherReport :: IO ()\ndummyWeatherReport = runDummyService $ runDummyStorage $ runDummyReporter reportWeather\n</code></pre>\n\n<p>In the code above, both <code>DummyStorage</code> and <code>DummyReporter</code> have to have trivial instances for <code>WeatherService</code>, which seems plainly wrong. Moreover, these instances depend on the order monads are stacked in the end. Is there a way to avoid leaking information between the different stacks?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 0, "creation_date": 1512059405, "post_id": 47577986, "comment_id": 82113364, "body": "Are you using archlinux? Try installing ncurses5-compat-libs from the AUR, and adding <code>ghc-build: nopie</code> to your stack.yaml, or if you want to prevent this happening in other projects, add it to your <code>~&#47;.stack&#47;config.yaml</code>"}, {"owner": {"reputation": 55, "user_id": 4930352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98f8a5e7e47657651f63380ab30d5211?s=128&d=identicon&r=PG&f=1", "display_name": "ljw", "link": "https://stackoverflow.com/users/4930352/ljw"}, "reply_to_user": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 0, "creation_date": 1512072120, "post_id": 47577986, "comment_id": 82120788, "body": "I am indeed using arch Linux --- should have mentioned that but didn&#39;t think that&#39;d be related! Thanks, this worked!"}, {"owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "edited": false, "score": 0, "creation_date": 1512073423, "post_id": 47577986, "comment_id": 82121468, "body": "Great! I added a slightly more in depth answer to hopefully help any other users who come across this."}], "answers": [{"tags": [], "owner": {"reputation": 1287, "user_id": 8737306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3bb7d3a90fd41a59ba3e205cbbc5a3e?s=128&d=identicon&r=PG&f=1", "display_name": "Zpalmtree", "link": "https://stackoverflow.com/users/8737306/zpalmtree"}, "is_accepted": true, "score": 2, "last_activity_date": 1512073390, "creation_date": 1512073390, "answer_id": 47581951, "question_id": 47577986, "link": "https://stackoverflow.com/questions/47577986/stack-build-failed-with-usr-bin-ld-final-link-failed-on-archlinux/47581951#47581951", "title": "`stack build` failed with `/usr/bin/ld: final link failed` on Archlinux", "body": "<p>This issue has been plaguing users of Arch Linux for a few months. It appears to be related to the ncurses library, and possibly due to Arch Linux dynamically linking Haskell packages, whilst most (all?) other distros use static linking.</p>\n\n<p>The current work around involves using the <code>ghc-build: nopie</code> option for the stack ghc version, and installing <a href=\"https://aur.archlinux.org/packages/ncurses5-compat-libs/\" rel=\"nofollow noreferrer\"><code>ncurses5-compat-libs</code></a> from the AUR.</p>\n\n<p>If you wish to set this globally, you can set it in your <code>~/.stack/config.yaml</code>, so it applies to all projects you build with stack.</p>\n\n<p>A bug report is currently open <a href=\"https://bugs.archlinux.org/task/56101\" rel=\"nofollow noreferrer\">here</a>, and some related discussion can be found on the <a href=\"https://bbs.archlinux.org/viewtopic.php?id=230091\" rel=\"nofollow noreferrer\">arch forums</a> or the <a href=\"https://github.com/commercialhaskell/stack/issues/3509\" rel=\"nofollow noreferrer\">stack github</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": false, "score": 1, "last_activity_date": 1514501005, "last_edit_date": 1514501005, "creation_date": 1513092845, "answer_id": 47776224, "question_id": 47577986, "link": "https://stackoverflow.com/questions/47577986/stack-build-failed-with-usr-bin-ld-final-link-failed-on-archlinux/47776224#47776224", "title": "`stack build` failed with `/usr/bin/ld: final link failed` on Archlinux", "body": "<p>For me deleting <code>~/.stack</code> and using</p>\n\n<pre><code>stack setup --ghc-build=ncurses6\n</code></pre>\n\n<p>and adding</p>\n\n<pre><code>ghc-build: ncurses6\n</code></pre>\n\n<p>to</p>\n\n<pre><code>~/.stack/config.yaml\n</code></pre>\n\n<p>resolved this.</p>\n\n<p>Addendum:</p>\n\n<pre><code>ghc-build: tinfo6\n</code></pre>\n\n<p>and</p>\n\n<pre><code>stack setup --ghc-build=tinfo6\n</code></pre>\n\n<p>worked even better for me.</p>\n"}], "owner": {"reputation": 55, "user_id": 4930352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98f8a5e7e47657651f63380ab30d5211?s=128&d=identicon&r=PG&f=1", "display_name": "ljw", "link": "https://stackoverflow.com/users/4930352/ljw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 551, "favorite_count": 0, "accepted_answer_id": 47581951, "answer_count": 2, "score": 4, "last_activity_date": 1514501005, "creation_date": 1512058877, "last_edit_date": 1513122446, "question_id": 47577986, "link": "https://stackoverflow.com/questions/47577986/stack-build-failed-with-usr-bin-ld-final-link-failed-on-archlinux", "title": "`stack build` failed with `/usr/bin/ld: final link failed` on Archlinux", "body": "<p>I'm trying to use the <code>req</code> package (<a href=\"http://hackage.haskell.org/package/req\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/req</a>) in a Haskell project, with stack.</p>\n\n<p>So far, I've done <code>stack new my-project</code>, <code>stack setup</code>, <code>stack build</code> and <code>stack exec my-project-exe</code> all fine.</p>\n\n<p>Have added <code>req</code> to the cabal file like so:</p>\n\n<pre><code>name:                my-project\nversion:             0.1.0.0\nsynopsis:            Short description of your package\nhomepage:            https://github.com/githubuser/#readme\nlicense:             BSD3\nlicense-file:        LICENSE\nauthor:              Author name here\nmaintainer:          example@example.com\ncopyright:           2017 Author name here\ncategory:            Web\nbuild-type:          Simple\nextra-source-files:  README.md\ncabal-version:       &gt;=1.10\n\n\nlibrary\n  hs-source-dirs:      src\n  exposed-modules:     Lib\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                     , req   -- THIS IS THE LINE IVE ADDED\n  default-language:    Haskell2010\n\nexecutable my-project-exe\n  hs-source-dirs:      app\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  build-depends:       base\n                     , my-project\n  default-language:    Haskell2010\n\ntest-suite my-project-test\n  type:                exitcode-stdio-1.0\n  hs-source-dirs:      test\n  main-is:             Spec.hs\n  build-depends:       base\n                     , my-project\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N\n  default-language:    Haskell2010\n\nsource-repository head\n  type:     git\n  location: https://github.com/githubuser/my-project\n</code></pre>\n\n<p>And finally, cut and paste the example from the req readme into <code>src/Lib.hs</code>, changing the function name like so:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings    #-}\n{-# OPTIONS_GHC -fno-warn-orphans #-}\n\nmodule Lib \n    ( someFunc\n    ) where\n\nimport Control.Exception (throwIO)\nimport Network.HTTP.Req\nimport Data.Aeson\n\n-- Just make your monad stack an instance of MonadHttp in your application\n-- and start making requests, enjoy automatic connection sharing.\n\ninstance MonadHttp IO where\n  handleHttpException = throwIO\n\nsomeFunc :: IO ()\nsomeFunc = do\n  let payload = object\n        [ \"foo\" .= (10 :: Int)\n        , \"bar\" .= (20 :: Int) ]\n  -- One function, full power and flexibility.\n  r &lt;- req POST -- method\n    (https \"httpbin.org\" /: \"post\") -- safe by construction URL\n    (ReqBodyJson payload) -- use built-in options or add your own\n    jsonResponse -- specify how to interpret response\n    mempty       -- query params, headers, explicit port number, etc.\n  print (responseBody r :: Value)\n</code></pre>\n\n<p>And now <code>stack build</code> is erroring:</p>\n\n<pre><code>%&gt; stack build\nbasement-0.0.4: configure\nbasement-0.0.4: build\nzlib-0.6.1.2: configure\naeson-1.1.2.0: download\nzlib-0.6.1.2: build\nnetwork-2.6.3.2: configure\nth-lift-instances-0.1.11: download\naeson-1.1.2.0: configure\naeson-1.1.2.0: build\nth-lift-instances-0.1.11: configure\nth-lift-instances-0.1.11: build\nth-lift-instances-0.1.11: copy/register\naeson-1.1.2.0: copy/register\nProgress: 5/28\n--  While building package network-2.6.3.2 using:\n      /tmp/stack7830/network-2.6.3.2/.stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/setup/setup --builddir=.stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0 configure --with-ghc=/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/bin/ghc --with-ghc-pkg=/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/bin/ghc-pkg --user --package-db=clear --package-db=global --package-db=/home/liam/.stack/snapshots/x86_64-linux-tinfo6-nopie/lts-9.14/8.0.2/pkgdb --libdir=/home/liam/.stack/snapshots/x86_64-linux-tinfo6-nopie/lts-9.14/8.0.2/lib --bindir=/home/liam/.stack/snapshots/x86_64-linux-tinfo6-nopie/lts-9.14/8.0.2/bin --datadir=/home/liam/.stack/snapshots/x86_64-linux-tinfo6-nopie/lts-9.14/8.0.2/share --libexecdir=/home/liam/.stack/snapshots/x86_64-linux-tinfo6-nopie/lts-9.14/8.0.2/libexec --sysconfdir=/home/liam/.stack/snapshots/x86_64-linux-tinfo6-nopie/lts-9.14/8.0.2/etc --docdir=/home/liam/.stack/snapshots/x86_64-linux-tinfo6-nopie/lts-9.14/8.0.2/doc/network-2.6.3.2 --htmldir=/home/liam/.stack/snapshots/x86_64-linux-tinfo6-nopie/lts-9.14/8.0.2/doc/network-2.6.3.2 --haddockdir=/home/liam/.stack/snapshots/x86_64-linux-tinfo6-nopie/lts-9.14/8.0.2/doc/network-2.6.3.2 --dependency=base=base-4.9.1.0 --dependency=bytestring=bytestring-0.10.8.1 --dependency=unix=unix-2.7.2.1\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/liam/code/forecast-compare/.stack-work/logs/network-2.6.3.2.log\n\n    [1 of 2] Compiling Main             ( /tmp/stack7830/network-2.6.3.2/Setup.hs, /tmp/stack7830/network-2.6.3.2/.stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/setup/Main.o )\n    [2 of 2] Compiling StackSetupShim   ( /home/liam/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs, /tmp/stack7830/network-2.6.3.2/.stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/setup/StackSetupShim.o )\n    Linking /tmp/stack7830/network-2.6.3.2/.stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/setup/setup ...\n    Configuring network-2.6.3.2...\n    configure: WARNING: unrecognized options: --with-compiler\n    checking build system type... x86_64-pc-linux-gnu\n    checking host system type... x86_64-pc-linux-gnu\n    checking for gcc... /usr/bin/gcc\n    checking whether the C compiler works... yes\n    checking for C compiler default output file name... a.out\n    checking for suffix of executables... \n    checking whether we are cross compiling... configure: error: in `/tmp/stack7830/network-2.6.3.2':\n    configure: error: cannot run C compiled programs.\n    If you meant to cross compile, use `--host'.\n    See `config.log' for more details\n\n\n--  While building package zlib-0.6.1.2 using:\n      /home/liam/.stack/setup-exe-cache/x86_64-linux-tinfo6-nopie/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0 build --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/liam/code/forecast-compare/.stack-work/logs/zlib-0.6.1.2.log\n\n    Configuring zlib-0.6.1.2...\n    Building zlib-0.6.1.2...\n    Preprocessing library zlib-0.6.1.2...\n    /usr/bin/ld: .stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/build/Codec/Compression/Zlib/Stream_hsc_make.o: relocation R_X86_64_32 against `.rodata' can not be used when making a shared object; recompile with -fPIC\n    /usr/bin/ld: final link failed: Nonrepresentable section on output\n    collect2: error: ld returned 1 exit status\n    linking .stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/build/Codec/Compression/Zlib/Stream_hsc_make.o failed (exit code 1)\n    command was: /usr/bin/gcc .stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/build/Codec/Compression/Zlib/Stream_hsc_make.o .stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/build/Codec/Compression/Zlib/Stream_hsc_utils.o -o .stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/build/Codec/Compression/Zlib/Stream_hsc_make -fno-PIE -fno-stack-protector -lz -L/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/bytestring-0.10.8.1 -Wl,-R,/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/bytestring-0.10.8.1 -L/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/deepseq-1.4.2.0 -Wl,-R,/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/deepseq-1.4.2.0 -L/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/array-0.5.1.1 -Wl,-R,/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/array-0.5.1.1 -L/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/base-4.9.1.0 -Wl,-R,/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/base-4.9.1.0 -L/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/integer-gmp-1.0.0.1 -Wl,-R,/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/integer-gmp-1.0.0.1 -lgmp -L/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/ghc-prim-0.5.0.0 -Wl,-R,/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/ghc-prim-0.5.0.0 -L/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/rts -Wl,-R,/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/rts -lm -lrt -ldl -lpthread\n\n\n--  While building package basement-0.0.4 using:\n      /home/liam/.stack/setup-exe-cache/x86_64-linux-tinfo6-nopie/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0 build --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/liam/code/forecast-compare/.stack-work/logs/basement-0.0.4.log\n\n    Configuring basement-0.0.4...\n    Building basement-0.0.4...\n    Preprocessing library basement-0.0.4...\n    /usr/bin/ld: .stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/build/Basement/Terminal/Size_hsc_make.o: relocation R_X86_64_32 against `.rodata' can not be used when making a shared object; recompile with -fPIC\n    /usr/bin/ld: final link failed: Nonrepresentable section on output\n    collect2: error: ld returned 1 exit status\n    linking .stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/build/Basement/Terminal/Size_hsc_make.o failed (exit code 1)\n    command was: /usr/bin/gcc .stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/build/Basement/Terminal/Size_hsc_make.o .stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/build/Basement/Terminal/Size_hsc_utils.o -o .stack-work/dist/x86_64-linux-tinfo6-nopie/Cabal-1.24.2.0/build/Basement/Terminal/Size_hsc_make -fno-PIE -fno-stack-protector -L/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/base-4.9.1.0 -Wl,-R,/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/base-4.9.1.0 -L/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/integer-gmp-1.0.0.1 -Wl,-R,/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/integer-gmp-1.0.0.1 -lgmp -L/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/ghc-prim-0.5.0.0 -Wl,-R,/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/ghc-prim-0.5.0.0 -L/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/rts -Wl,-R,/home/liam/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.0.2/lib/ghc-8.0.2/rts -lm -lrt -ldl -lpthread\n</code></pre>\n\n<p>Any help much appreciated!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1512057654, "post_id": 47577470, "comment_id": 82112167, "body": "If your data can be one of many types (Char or Int or String, etc) then yes, there is no way to represent it without a sum type. Your type <code>|||</code> is just <code>Either</code> (from <code>Data.Either</code>) which is a very standard type (not that weird) - see that module to how to deconstruct an <code>Either</code> (and likewise your <code>|||</code>). Note: the &#39;alternate&#39; definition is just <code>[Either a b]</code>."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512058032, "post_id": 47577470, "comment_id": 82112434, "body": "<code>Either</code> is parameterized by only 2 types, which means that I can read strings into one of 2 types. But I need to read string into N different types, not 2. I can use something like <code>read s::A|||B|||C|||D|||E</code>. If I&#39;ll re-write standard <code>Read</code> instance of <code>Either</code> I&#39;ll can to read <code>s</code> to <code>A</code> or to <code>B</code> and never to <code>C</code>, <code>D</code> and etc..."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512058466, "post_id": 47577470, "comment_id": 82112703, "body": "<code>A ||| B ||| C</code> is just nested applications of <code>|||</code> - it is <code>(|||) A ((|||) B C)</code>. The same exact thing can be accomplished with <code>Either</code> - <code>Either A (Either B C)</code>. If you need a custom <code>Read</code> instance (as you do in your case), then declaring a new (isomorphic) type or using a newtype are the way to go. But my understanding is your question is primarily this: &quot;I want to fold it to Int or to Char or to String&quot; - in which case, you can deconstruct <code>|||</code> exactly the same ways as <code>Either</code>, regardless of the <code>Read</code> instances."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512058671, "post_id": 47577470, "comment_id": 82112846, "body": "Exactly, this is what I don&#39;t know how to do: how to deconstruct such nested/recursive type. I can get <code>A 1</code> or <code>A (B &#39;a&#39;)</code> or <code>B (B (A (B 1)))</code> and so on, and how to match it - all those expressions have different types"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512060211, "post_id": 47577470, "comment_id": 82113842, "body": "The types should not be different; that is the point of a sum type. Indeed, the term <code>[ A 1, A (B &#39;a&#39;), B (B (A (B 1))) ]</code> is well-typed (except for the fact that it requires a <code>Num (a ||| Char)</code> instance, which arises from the fact that the inferred type is not strictly right-nested). If you really want, you can have a &#39;true&#39; n-ary sum, e.g. <code>data Sum (xs :: [*]) where { A :: x -&gt; Sum (x : xs) ; B :: Sum xs -&gt; Sum (x : xs) }</code>"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512061559, "post_id": 47577470, "comment_id": 82114695, "body": "I wasn&#39;t exact: I need generic read function which can be called with different signatures (like standard <code>read</code>), for example: <code>read _::Int ||| Char</code> or <code>read _::Char|||String|||Int</code>. And some another function which will &quot;fold&quot; such <code>a|||b</code> to something simple: <code>m a</code>, <code>m b</code>. This folding function will work with values of types like <code>Int ||| Char</code>, <code>Char ||| String ||| Int</code> and similar, so how it can be generic and process all kinds of such types? This is what I mean &quot;different types&quot;: folding function arg will have flex type/structure of common form <code>a ||| b</code>. Excuse me if I was not exact"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1512061951, "post_id": 47577470, "comment_id": 82114956, "body": "You can already call <code>read</code> in such a way at different types with your <code>Read</code> instances; the issue, as I see it, is only in how to deconstruct your type, which depends entirely on <i>what</i> you wish to do. E.g., if you want to deconstruct a sum <code>a ||| b</code> into a <code>String</code> by <code>show</code>ing each variant, you must have a <code>Show</code> instance for <code>a</code> and <code>b</code> (this is exactly how the derived <code>Show</code> instance works). In general, to have a function <code>a ||| b -&gt; X</code> you need two functions <code>a -&gt; X</code> and <code>b -&gt; X</code> (indeed, there is <code>either :: (a -&gt; x) -&gt; (b -&gt; x) -&gt; (Either a b -&gt; x)</code> - implement yours the same way)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1512062196, "post_id": 47577470, "comment_id": 82115116, "body": "I&#39;d like to offer a different opinion than the above: you should rethink your plan. The plan you have in mind is doable but very unidiomatic in Haskell, in part because Haskell does <i>not</i> support it very well at all. There will be a bunch of extra noise in your code compared to a more idiomatic solution. (I would also say it is unidiomatic in part because it is an error-prone way to design software.) But I can&#39;t offer an alternative given only the few details described here -- there are many possible design fixes depending on what&#39;s wanted."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1512062431, "post_id": 47577470, "comment_id": 82115250, "body": "Seems I need to patter-match on type-level, bcz <code>a</code> in <code>(a-&gt;x)</code> (1st <code>either</code> arg) can be any: <code>A _</code>/<code>A (A _)</code>/<code>B (A (B _))</code> and so on. All of them have diff. types. I check src of HSet/HVec but they looks very difficult to me. @DanielWagner: seems you are right, may be I need another solution."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1512066768, "post_id": 47577470, "comment_id": 82117866, "body": "@Paul-AG, you are basically writing a parser.  You could just embrace that and define an AST, a parser into it, and an evaluation function out of it.  What do you want to do with the result?"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1512117983, "post_id": 47577470, "comment_id": 82136284, "body": "Result should be collection (list): tags. And I will match/check existent of tag in this collection. I have collection, have matching, has different types (one per tag type) and show list of tags as &quot;tag1,tag2,tag2&quot;. But when I&#39;ll read it, I need to specify returned type, so I think about something like those <code>|||</code> (or <code>Either</code>)..."}], "answers": [{"comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1512118414, "post_id": 47583947, "comment_id": 82136491, "body": "Yes, I thought about such solution, but trick here is that this &quot;read&quot; function must be generic: client of the library may want to read different types&#39; sums: <code>AnyOf3</code> of something else. It must be function which can read one of N types. So, I thought: usually it&#39;s not possible, but if client will pass type? So, I wrote those <code>|||</code> operator which allows client to specify what exactly types can be read from the string. But this does not help, because Haskell hasn&#39;t simple way to match/fold such types. Type-level lists? But I&#39;m not familiar w/ such things"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1512118528, "post_id": 47583947, "comment_id": 82136531, "body": "It&#39;s like to write &quot;read&quot; which parses only Int&#39;s or Int either Char. OK, but how to write generic &quot;read&quot; which can parse one of N types, and those N-types are specified by client, so can be absolutely any."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1512118746, "post_id": 47583947, "comment_id": 82136649, "body": "so main question in your solution is: how to avoid hardcoded constructors of <code>AnyOf3</code> and <code>AnyOf3</code> itself. It must be some type which can be traversable and each item is type, so I can to pattern-match on one of them, then on another one, etc..."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1512119885, "post_id": 47583947, "comment_id": 82137217, "body": "Hm, I done Eq for <code>|||</code>, so I need only some wildcard to equal any <code>a|||b</code> with it. So, parsed type will be <code>a|||b</code> and I will not extract something from <code>a|||b</code>. Looks like, parsed result is elem of set <code>a|||b|||...</code> &lt;- this is the type of tags set and tag itself (&quot;tag&quot; is a parse result from str like &quot;tag1,tag2,...&quot;). Not good is only that <code>a|||b</code> != <code>b|||a</code>."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1512120297, "post_id": 47583947, "comment_id": 82137422, "body": "@Paul-AG The way to get any number of types would be, I suppose, nested <code>Either</code>, e.g. <code>Either a (Either b c)</code>, but it would be very easy to extend any of those functions to two, four or any other number of alternatives.  The solution I posted <i>does</i> allow <code>a</code>, <code>b</code> and <code>c</code> to be any completely generic types."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1512120792, "post_id": 47583947, "comment_id": 82137701, "body": "However,  @user2407038 made the suggestion of nested binary infix TypeOperators, which I think is on the right track for what you want."}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1512098876, "last_edit_date": 1512098876, "creation_date": 1512082347, "answer_id": 47583947, "question_id": 47577470, "link": "https://stackoverflow.com/questions/47577470/read-of-types-sum/47583947#47583947", "title": "Read of types sum", "body": "<p>There\u2019s no way to do this <strong>in general</strong> using <code>read</code>, because the same input string might parse correctly to more than one of the valid types.  You could, however, do this with a function like <code>Text.Read.readMaybe</code>, which returns <code>Nothing</code> on ambiguous input.  You might also return a tuple or list of the valid interpretations, or have a rule for which order to attempt to parse the types in, such as: attempt to parse each type in the order they were declared.</p>\n\n<p>Here\u2019s some example code, as proof of concept:</p>\n\n<pre><code>import Data.Maybe (catMaybes, fromJust, isJust, isNothing)\nimport qualified Text.Read\n\ndata AnyOf3 a b c = FirstOf3 a | SecondOf3 b | ThirdOf3 c\n\ninstance (Show a, Show b, Show c) =&gt; Show (AnyOf3 a b c) where\n  show (FirstOf3 x) = show x -- Can infer the type from the pattern guard.\n  show (SecondOf3 x) = show x\n  show (ThirdOf3 x) = show x\n\nmain :: IO ()\nmain =\n (putStrLn . unwords . map show . catMaybes . map readDBS)\n   [\"True\", \"2\", \"\\\"foo\\\"\", \"bar\"] &gt;&gt;\n (putStrLn . unwords . map show . readIID) \"100\"\n\nreadMaybe' :: (Read a, Read b, Read c) =&gt; String -&gt; Maybe (AnyOf3 a b c)\n-- Based on the function from Text.Read\nreadMaybe' x | isJust a &amp;&amp; isNothing b &amp;&amp; isNothing c =\n  (Just . FirstOf3 . fromJust) a -- Can infer the type of a from this.\n             | isNothing a &amp;&amp; isJust b &amp;&amp; isNothing c =\n  (Just . SecondOf3 . fromJust) b -- Can infer the type of b from this.\n             | isNothing a &amp;&amp; isNothing b &amp;&amp; isJust c =\n  (Just . ThirdOf3 . fromJust) c -- Can infer the type of c from this.\n             | otherwise                              = Nothing\n  where a = Text.Read.readMaybe x\n        b = Text.Read.readMaybe x\n        c = Text.Read.readMaybe x\n\nreadDBS :: String -&gt; Maybe (AnyOf3 Double Bool String)\nreadDBS = readMaybe'\n\nreadToList :: (Read a, Read b, Read c) =&gt; String -&gt; [AnyOf3 a b c]\nreadToList x = repack FirstOf3 x ++ repack SecondOf3 x ++ repack ThirdOf3 x\n  where repack constructor y | isJust z  = [(constructor . fromJust) z]\n                             | otherwise = []\n          where z = Text.Read.readMaybe y\n\nreadIID :: String -&gt; [AnyOf3 Int Integer Double]\nreadIID = readToList\n</code></pre>\n\n<p>The first output line echoes every input that parsed successfully, that is, the Boolean constant, the number and the quoted string, but not <code>bar</code>.  The second output line echoes every possible interpretation of the input, that is, 100 as an <code>Int</code>, an <code>Integer</code> and a <code>Double</code>.</p>\n\n<p>For something more complicated, you want to write a parser.  Haskell has some very good libraries to build them out of combinators.  You might look at one such as Parsec.  But it\u2019s still helpful to understand what goes on under the hood.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512098876, "creation_date": 1512057329, "question_id": 47577470, "link": "https://stackoverflow.com/questions/47577470/read-of-types-sum", "title": "Read of types sum", "body": "<p>When I want to read string to type A I write <code>read str::A</code>. Consider, I want to have generic function which can read string to different types, so I want to write something like <code>read str::A|||B|||C</code> or something similar. The only thing I could think of is:</p>\n\n<pre><code>{-# LANGUAGE TypeOperators #-}\ninfixr 9 |||\ndata a ||| b = A a|B b deriving Show\n-- OR THIS:\n-- data a ||| b = N | A a (a ||| b) | B b (a ||| b) deriving (Data, Show)\n\ninstance (Read a, Read b) =&gt; Read (a ||| b) where\n  readPrec = parens $ do\n    a &lt;- (A &lt;$&gt; readPrec) &lt;|&gt; (B &lt;$&gt; readPrec)\n    -- OR:\n    -- a &lt;- (flip A N &lt;$&gt; readPrec) &lt;|&gt; (flip B N &lt;$&gt; readPrec)\n    return a\n</code></pre>\n\n<p>And if I want to read something:</p>\n\n<pre><code>&gt; read \"'a'\"::Int|||Char|||String\nB (A 'a')\n</code></pre>\n\n<p>But what to do with such weird type? I want to fold it to <code>Int</code> or to <code>Char</code> or to <code>String</code>... Or to something another but \"atomic\" (scalar/simple). Final goal is to read strings like <code>\"1,'a'\"</code> to list-like <code>[D 1, D 'a']</code>. And main constraint here is that structure is flexible, so string can be <code>\"1, 'a'\"</code> or <code>\"'a', 1\"</code> or <code>\"\\\"xxx\\\", 1, 2, 'a'\"</code>. I know how to read something separated with delimiter, but this something should be passed as type, not as sum of types like <code>C Char|I Int|S String|etc</code>. Is it possible? Or no way to accomplish it without sum of types?</p>\n"}, {"tags": ["list", "parsing", "haskell", "infinite"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 5, "creation_date": 1512056358, "post_id": 47577124, "comment_id": 82111300, "body": "<code>data Nested a = Flat a | Nested (Nested [a])</code>. A <code>Nested a</code> value consists of <i>n</i> <code>Nested</code> constructors, terminated by a <code>Flat</code> constructor containing an <i>n</i>-deep nested list of <code>a</code>s."}], "answers": [{"comments": [{"owner": {"reputation": 12323, "user_id": 15982, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/543d0222ea3269453527c07141d48e4b?s=128&d=identicon&r=PG", "display_name": "Rene Saarsoo", "link": "https://stackoverflow.com/users/15982/rene-saarsoo"}, "edited": false, "score": 0, "creation_date": 1512072812, "post_id": 47580975, "comment_id": 82121136, "body": "Thanks. This <code>N []</code> thingie works well. I managed to easily plug it into my existing code. I&#39;ll definitely need to learn about these parsing libraries as well... though first I&#39;ll need to wrap my head around monads."}, {"owner": {"reputation": 3246, "user_id": 936584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c1f5574b8584710146fdba3cd537a4e1?s=128&d=identicon&r=PG", "display_name": "user26732", "link": "https://stackoverflow.com/users/936584/user26732"}, "edited": false, "score": 0, "creation_date": 1512092721, "post_id": 47580975, "comment_id": 82128582, "body": "Is there any particular reason for creating new datatype. It seems to me parsing to list is enough."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 3246, "user_id": 936584, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c1f5574b8584710146fdba3cd537a4e1?s=128&d=identicon&r=PG", "display_name": "user26732", "link": "https://stackoverflow.com/users/936584/user26732"}, "edited": false, "score": 0, "creation_date": 1512139066, "post_id": 47580975, "comment_id": 82148769, "body": "@user26732, the original issue was deciding what type to give <code>parseParens</code>.  For example, If it had type <code>parseParens :: String -&gt; [[[[a]]]]</code>, you could return plain lists, but only up to depth 4."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 8, "last_activity_date": 1512138897, "last_edit_date": 1512138897, "creation_date": 1512069211, "answer_id": 47580975, "question_id": 47577124, "link": "https://stackoverflow.com/questions/47577124/parsing-string-of-parenthesis-to-nested-list-in-haskell/47580975#47580975", "title": "Parsing String of parenthesis to nested List in Haskell", "body": "<p><em>Edit</em>: Fixed my mischaracterization of Benjamin's answer.</p>\n\n<p>While the answer in @Benjamin Hodgson's comment:</p>\n\n<pre><code>data Nested a = Flat a | Nested (Nested [a]) deriving (Show)\n</code></pre>\n\n<p>gives a good way to represent a homogeneous list of arbitrary nesting depth (i.e., sort of like a sum type of <code>[a]</code> plus <code>[[a]]</code> plus <code>[[[a]]]</code> plus all the rest), it seems like an unusual representation for your problem, particularly in a case like:</p>\n\n<pre><code>parseParens \"(()(()))\"\n</code></pre>\n\n<p>where the nesting depth of the \"child nodes\" differs.  This would be represented as:</p>\n\n<pre><code>Nested (Nested (Nested (Flat [[],[[]]]))) :: Nested a\n</code></pre>\n\n<p>so it literally allows you to represent the result of the parse as the desired list, given enough <code>Nested</code> constructors, but it has some odd properties.  For example, the innermost empty lists actually have different types:  the first is of type <code>[[a]]</code> while the second is of type <code>[a]</code>.</p>\n\n<p>As a alternative approach, I think the data type you <strong>actually</strong> want is probably just:</p>\n\n<pre><code>data Nested = N [Nested] deriving (Show)\n</code></pre>\n\n<p>where each node <code>N</code> is a (possibly empty) list of nodes.  Then, you'll get:</p>\n\n<pre><code>&gt; parseParens \"()\"\nN []\n&gt; parseParens \"(())\"\nN [N []]\n&gt; parseParens \"((()()))\"\nN [N [N [],N []]]\n&gt; parseParens \"(()(()))\"\nN [N [],N [N []]]\n</code></pre>\n\n<p>If you just ignore the <code>N</code> constructors in these results, the first three of these match your \"corresponding list\" test cases from the beginning of your question.</p>\n\n<p>As a side note:  the <code>Nested</code> data type above is actually a \"rose tree\" containing no data, equivalent to <code>Tree ()</code> using the <code>Tree</code> data type from <code>Data.Tree</code> in the <code>containers</code> package.</p>\n\n<p>Finally, I can't emphasize enough how helpful it is to learn and use a monadic parsing library, even for simple parsing jobs.  Using the <code>parsec</code> library, for example, you can write a parser for your grammar in one line: </p>\n\n<pre><code>nested = N &lt;$&gt; between (char '(') (char ')') (many nested)\n</code></pre>\n\n<p>My full code for <code>parseParens</code> is:</p>\n\n<pre><code>import Data.Tree\nimport Text.Parsec\nimport Text.Parsec.String\n\ndata Nested = N [Nested] deriving (Show)\n\nnested :: Parser Nested\nnested = N &lt;$&gt; between (char '(') (char ')') (many nested)\n\nparseParens :: String -&gt; Nested\nparseParens str =\n  let Right result = parse (nested &lt;* eof) \"\" str\n  in  result\n</code></pre>\n"}], "owner": {"reputation": 12323, "user_id": 15982, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/543d0222ea3269453527c07141d48e4b?s=128&d=identicon&r=PG", "display_name": "Rene Saarsoo", "link": "https://stackoverflow.com/users/15982/rene-saarsoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1086, "favorite_count": 1, "accepted_answer_id": 47580975, "answer_count": 1, "score": 4, "last_activity_date": 1512138897, "creation_date": 1512056212, "last_edit_date": 1512056479, "question_id": 47577124, "link": "https://stackoverflow.com/questions/47577124/parsing-string-of-parenthesis-to-nested-list-in-haskell", "title": "Parsing String of parenthesis to nested List in Haskell", "body": "<p>My goal was to write a function to parse string of nested parentheses into a corresponding list:</p>\n\n<pre><code>parseParens \"()\" --&gt; []\nparseParens \"(())\" --&gt; [[]]\nparseParens \"((()()))\" --&gt; [[[],[]]]\n</code></pre>\n\n<p>First off I discovered that I can't specify easily define a type of the return value. I could do something like:</p>\n\n<pre><code>parseParens :: String -&gt; [[[[t]]]]\n</code></pre>\n\n<p>But how do I say that it's infinitely nested? I guess Haskell doesn't allow that.</p>\n\n<h1>My solution</h1>\n\n<p>I came up with my own data type:</p>\n\n<pre><code>data InfiniteList = EmptyList | Cons InfiniteList InfiniteList deriving (Show)\n</code></pre>\n\n<p>And a parser function that uses this:</p>\n\n<pre><code>parseParens :: String -&gt; InfiniteList\nparseParens ('(':xs) =\n    if remainder == \"\"\n        then result\n        else error \"Unbalanced parenthesis\"\n    where (result, remainder) = parseToClose EmptyList xs\nparseParens _ = error \"Unbalanced parenthesis\"\n\nparseToClose :: InfiniteList -&gt; String -&gt; (InfiniteList, String)\nparseToClose acc \"\" = error \"Unbalanced parenthesis!\"\nparseToClose acc (')':xs) = (acc, xs)\nparseToClose acc ('(':xs) = parseToClose (concatInfLists acc (Cons result EmptyList)) remainder\n    where (result, remainder) = parseToClose EmptyList xs\n\nconcatInfLists :: InfiniteList -&gt; InfiniteList -&gt; InfiniteList\nconcatInfLists EmptyList ys = ys\nconcatInfLists (Cons x xs) ys = Cons x (concatInfLists xs ys)\n</code></pre>\n\n<p>Working like so:</p>\n\n<pre><code>parseParens \"()\" --&gt; EmptyList\nparseParens \"(())\" --&gt; Cons EmptyList EmptyList\nparseParens \"((()()))\" --&gt; Cons (Cons EmptyList (Cons EmptyList EmptyList)) EmptyList\n</code></pre>\n\n<h1>How to improve?</h1>\n\n<p>There surely must be a better way to do this. Perhaps there's even a way to use the built-in List data type for this?</p>\n"}, {"tags": ["haskell", "monoids"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1512057121, "post_id": 47576620, "comment_id": 82111772, "body": "While it is not implemented in this way, you can pretend that <code>F.foldl</code> internally chooses the list monoid, turning the tree into a list, and then folding over that as usual. As long as the tree is a finite one, this mental model should be accurate to describe the actual result."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1512110920, "post_id": 47576620, "comment_id": 82133301, "body": "Actually the <code>Sum</code> or <code>Product</code> monoids are not used anywhere here."}], "answers": [{"comments": [{"owner": {"reputation": 241, "user_id": 1550188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fc48bac07a01f7773894386398a61d0?s=128&d=identicon&r=PG", "display_name": "Bradley Nowacki", "link": "https://stackoverflow.com/users/1550188/bradley-nowacki"}, "edited": false, "score": 0, "creation_date": 1512055990, "post_id": 47576844, "comment_id": 82111055, "body": "But at some point the Num&#39;s that exist in the nodes need to be some sort of Monoid, or else mappend would throw an exception, would it not?"}, {"owner": {"reputation": 241, "user_id": 1550188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fc48bac07a01f7773894386398a61d0?s=128&d=identicon&r=PG", "display_name": "Bradley Nowacki", "link": "https://stackoverflow.com/users/1550188/bradley-nowacki"}, "edited": false, "score": 0, "creation_date": 1512056050, "post_id": 47576844, "comment_id": 82111099, "body": "Scratch that Endo is a monoid, I have not seen this before though."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 241, "user_id": 1550188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fc48bac07a01f7773894386398a61d0?s=128&d=identicon&r=PG", "display_name": "Bradley Nowacki", "link": "https://stackoverflow.com/users/1550188/bradley-nowacki"}, "edited": false, "score": 0, "creation_date": 1512056063, "post_id": 47576844, "comment_id": 82111107, "body": "No, they are not. <code>mappend</code> works on <code>Endo f</code>, for which it is <code>Endo f &lt;&gt; Endo g = Endo (f . g)</code>. &quot;Endo&quot; here is just a marker; the important bit is the <code>f . g</code>."}, {"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 0, "creation_date": 1512056892, "post_id": 47576844, "comment_id": 82111619, "body": "<code>appEndo</code> doesn&#39;t actually result in anything being applied. It just extracts the monoidally collapsed final function from the <code>Endo</code> newtype wrapper. You still have to apply it to something manually, which is what that <code>z</code> argument is."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 0, "creation_date": 1512057230, "post_id": 47576844, "comment_id": 82111856, "body": "@AsadSaeeduddin it&#39;s like <code>($)</code>. Does it apply its argument function? (no) Do we think of it as application operator? (yes)."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 8, "last_activity_date": 1512074293, "last_edit_date": 1512074293, "creation_date": 1512055353, "answer_id": 47576844, "question_id": 47576620, "link": "https://stackoverflow.com/questions/47576620/monoids-and-num-in-haskell/47576844#47576844", "title": "Monoids and Num in Haskell", "body": "<p>It doesn't need to. <code>foldl</code> is translated into <code>foldr</code> which translates into <code>foldMap</code> over <code>Endo</code> which means function composition which means simple nesting of the function <em>you have supplied</em>.</p>\n\n<p>Or something. Meaning, <code>foldl</code> could be translated into <code>foldMap</code> over <code>Dual . Endo</code> which composes left-to-right, etc..</p>\n\n<p><em>update:</em> yes, <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#t:Foldable\" rel=\"nofollow noreferrer\">the docs says</a>:</p>\n\n<blockquote>\n  <p>Foldable instances are expected to satisfy the following laws:</p>\n\n<pre><code>foldr f z t = appEndo (foldMap (Endo . f) t ) z\nfoldl f z t = appEndo (getDual (foldMap (Dual . Endo . flip f) t)) z  -- &lt;&lt; --\nfold = foldMap id\n</code></pre>\n</blockquote>\n\n<p><code>Dual (Endo f) &lt;&gt; Dual (Endo g) = Dual (Endo g &lt;&gt; Endo f) = Dual (Endo (g . f))</code>. So when <code>appEndo</code> strikes, the chain of functions that's been built, i.e. </p>\n\n<pre><code>    ((+10) . (+9) . (+8) . (+5) . ... . (+1))\n</code></pre>\n\n<p>or equivalent (here, shown for the <code>(+)</code> case), is applied to the user-supplied value -- in your case, </p>\n\n<pre><code>                                                 0\n</code></pre>\n\n<p>Another thing to notice is that <code>Endo</code> and <code>Dual</code> are <code>newtype</code>s, so all these machinations will be done by compiler, and be gone by run time.</p>\n"}, {"tags": [], "owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "is_accepted": false, "score": 4, "last_activity_date": 1512057079, "last_edit_date": 1512057079, "creation_date": 1512056240, "answer_id": 47577130, "question_id": 47576620, "link": "https://stackoverflow.com/questions/47576620/monoids-and-num-in-haskell/47577130#47577130", "title": "Monoids and Num in Haskell", "body": "<p>There is (implicitly, if not explicitly), a monoid instance for ordinary functions of the form <code>a -&gt; a</code>, where <code>mappend</code> corresponds to function composition, and <code>mempty</code> corresponds to the <code>id</code> function. </p>\n\n<p>What is <code>(+)</code>? It is a function <code>(Num a) =&gt; a -&gt; a -&gt; a</code>. If you <code>foldMap</code> over your foldable full of numbers with <code>+</code>, you turn each one into the partially applied <code>(+ &lt;some number)</code>, which is a <code>a -&gt; a</code>. Lo and behold, you've found the magic <code>f</code> that will turn everything in your foldable into a monoid! </p>\n\n<p>Assuming there was a direct monoid instance for functions, you'd be able to do:</p>\n\n<pre><code>foldMap (+) [1, 2, 3, 4]\n</code></pre>\n\n<p>, which would produce an ultimate <code>(Num a) =&gt; a -&gt; a</code> that you could apply to <code>0</code> to get <code>10</code>.</p>\n\n<p>There is no such direct instance however, so you need to use the builtin <code>newtype</code> wrapper <code>Endo</code> and the corresponding unwrapper <code>appEndo</code>, which implement monoid for <code>a -&gt; a</code> functions. Here's what it looks like:</p>\n\n<pre><code>Prelude Data.Monoid&gt; (appEndo (foldMap (Endo . (+)) [1, 2, 3, 4])) 0\n10\n</code></pre>\n\n<p>Here <code>Endo .</code> is just our annoying need to lift plain <code>a -&gt; a</code>s so they have their natural <code>Monoid</code> instance. After the <code>foldMap</code> is done reducing our foldable by turning everything into <code>a -&gt; a</code>s and chaining them together with composition, we extract the final <code>a -&gt; a</code> using <code>appEndo</code>, and finally apply it to <code>0</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 18, "last_activity_date": 1512058891, "last_edit_date": 1512058891, "creation_date": 1512057193, "answer_id": 47577430, "question_id": 47576620, "link": "https://stackoverflow.com/questions/47576620/monoids-and-num-in-haskell/47577430#47577430", "title": "Monoids and Num in Haskell", "body": "<p><strong>Short answer</strong>: it is a type constraint in the signature of <code>foldMap</code>.</p>\n\n<p>If we look to the source code of <code>Foldable</code> (more specifically <code>foldMap</code>), we see:</p>\n\n<pre><code>class Foldable (t :: * -&gt; *) where\n  ...\n  foldMap :: Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m</code></pre>\n\n<p>So that means that if we declare <code>Tree</code> a member of <code>Foldable</code> (not that <code>Tree</code> has kind <code>* -&gt; *</code>), it means that a <code>foldMap</code> is defined over that tree, such that: <code>foldMap :: Monoid m =&gt; (a -&gt; m) -&gt; Tree a -&gt; m</code>. So this thus means that the <em>result type</em> (and the result of the function passed to <code>foldMap</code>) <code>m</code> must be a <code>Monoid</code>.</p>\n\n<p>Haskell is statically typed: after compile time, Haskell knows exactly the types that are passed in an out of every function <em>instance</em>. So that means it knows for instance what the output type will be, and thus how to handle it.</p>\n\n<p>Now <code>Int</code> is not an instance of <code>Monoid</code>. You here use <code>F.foldl (+) 0 testTree</code>, so that means that you more or less have constructed an \"ad hoc\" monoid. This works if we look at the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/src/Data.Foldable.html#foldl\" rel=\"noreferrer\">source code of <code>foldl</code></a>:</p>\n\n<blockquote>\n<pre><code>foldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\nfoldl f z t = appEndo (getDual (foldMap (Dual . Endo . flip f) t)) z\n</code></pre>\n</blockquote>\n\n<p>This has a lot of logic surrounding the parameters <code>f</code>, <code>z</code> and <code>t</code>. So let us break that down first.</p>\n\n<p>Let us first take a look at <code>Dual . Endo . flip f</code>. This is short for:</p>\n\n<pre><code>helper = \\x -&gt; Dual (Endo (\\y -&gt; f y x))\n</code></pre>\n\n<p><code>Dual</code> and <code>Endo</code> are types with each one constructor that takes one parameter. So we wrap the outcome of <code>f y x</code> in the <code>Dual (Endo ...)</code> constructors.</p>\n\n<p>We will use this as the function of <code>foldMap</code>. If our <code>f</code> has type <code>a -&gt; b -&gt; a</code>, then this function has type <code>b -&gt; Dual (Endo a)</code>. So the output type of the function passed to <code>foldMap</code> has output type <code>Dual (Endo a)</code>. Now if we inspect the source code, we see two intersting things:</p>\n\n<blockquote>\n<pre><code>instance Monoid (Endo a) where\n        mempty = Endo id\n        Endo f `mappend` Endo g = Endo (f . g)\n\ninstance Monoid a =&gt; Monoid (Dual a) where\n        mempty = Dual mempty\n        Dual x `mappend` Dual y = Dual (y `mappend` x)\n</code></pre>\n</blockquote>\n\n<p>(note that it is <code>y `mappend` x</code>, not <code>x `mappend` y</code>).</p>\n\n<p>So what happens here is that the <code>mempty</code> that is used in the <code>foldMap</code> is <code>mempty = Dual mempty = Dual (Endo id)</code>. So a <code>Dual (Endo ...)</code> that encapsulates the <em>identity function</em>.</p>\n\n<p>Furthermore the <code>mappend</code> of two duals comes down to <em>function composition</em> of the values in <code>Endo</code>. So:</p>\n\n<pre><code>mempty = Dual (Endo id)\nmappend (Dual (Endo f)) (Dual (Endo g)) = Dual (Endo (g . f))\n</code></pre>\n\n<p>So that means that if we fold over the tree, in case we see an <code>Empty</code> (a leaf), we will return <code>mempty</code>, and in case we see a <code>Node x l r</code>, we will perform the <code>mappend</code> as described above. So a \"<em>specialized</em>\" <code>foldMap</code> will look like:</p>\n\n<pre><code>-- specialized foldMap\nfoldMap f Empty = Dual (Endo id)  \nfoldMap f (Node x l r) =  Dual (Endo (c . b . a))\n        where Dual (Endo a) = foldMap f l\n              Dual (Endo b) = helper x\n              Dual (Endo c) = foldMap f l\n</code></pre>\n\n<p>So for every <code>Node</code> we make a function composition right-to-left over the the children and item of the node. <code>a</code> and <code>c</code> can be compositions of the tree as well (since these are recursive calls). In case of a <code>Leaf</code>, we do nothing (we return <code>id</code>, but the composition over an <code>id</code> is a no-op).</p>\n\n<p>So that means that if we have a tree:</p>\n\n<pre><code>5\n|- 3\n|  |- 1\n|  `- 6\n`- 9\n   |- 8\n   `- 10\n</code></pre>\n\n<p>This will result in a function:</p>\n\n<pre><code>(Dual (Endo ( (\\x -&gt; f x 10) .\n              (\\x -&gt; f x 9) .\n              (\\x -&gt; f x 8) .\n              (\\x -&gt; f x 5) .\n              (\\x -&gt; f x 6) .\n              (\\x -&gt; f x 3) .\n              (\\x -&gt; f x 1)\n            )\n      )\n)\n</code></pre>\n\n<p>(omitted the identities, to make it a cleaner). This is the outcome of <code>getDual (foldMap (Dual . Endo . flip f))</code>. But now we need to post process this result. With <code>getDual</code>, we get the content wrapped in the <code>Dual</code> constructor. So now we have:</p>\n\n<pre><code>Endo ( (\\x -&gt; f x 10) .\n       (\\x -&gt; f x 9) .\n       (\\x -&gt; f x 8) .\n       (\\x -&gt; f x 5) .\n       (\\x -&gt; f x 6) .\n       (\\x -&gt; f x 3) .\n       (\\x -&gt; f x 1)\n     )\n</code></pre>\n\n<p>and with <code>appEndo</code>, we obtain the function wrapped in <code>Endo</code>, so:</p>\n\n<pre><code>( (\\x -&gt; f x 10) .\n  (\\x -&gt; f x 9) .\n  (\\x -&gt; f x 8) .\n  (\\x -&gt; f x 5) .\n  (\\x -&gt; f x 6) .\n  (\\x -&gt; f x 3) .\n  (\\x -&gt; f x 1)\n)\n</code></pre>\n\n<p>and then we apply this to <code>z</code> the \"initial\" value. So that means that we will process the chain starting with <code>z</code> (the initial element), and apply it like:</p>\n\n<pre><code>f (f (f (f (f (f (f z 1) 3) 6) 5) 8) 9) 10\n</code></pre>\n\n<p>So we have constructed some sort of Monoid, where <code>mappend</code> is replaced by <code>f</code>, and <code>mempty</code> as a no-op (the identity function).</p>\n"}], "owner": {"reputation": 241, "user_id": 1550188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fc48bac07a01f7773894386398a61d0?s=128&d=identicon&r=PG", "display_name": "Bradley Nowacki", "link": "https://stackoverflow.com/users/1550188/bradley-nowacki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1220, "favorite_count": 2, "accepted_answer_id": 47577430, "answer_count": 3, "score": 18, "last_activity_date": 1522952298, "creation_date": 1512054634, "last_edit_date": 1522952298, "question_id": 47576620, "link": "https://stackoverflow.com/questions/47576620/monoids-and-num-in-haskell", "title": "Monoids and Num in Haskell", "body": "<p>I have been learning Haskell over the past few months and I came across an example of Monoids that has me puzzled.</p>\n\n<p>Given these definitions:</p>\n\n<pre><code>data Tree a = Empty | Node a (Tree a) (Tree a) deriving (Show, Read, Eq) \n\ninstance F.Foldable Tree where  \n    foldMap f Empty = mempty  \n    foldMap f (Node x l r) = F.foldMap f l `mappend`  \n                             f x           `mappend`  \n                             F.foldMap f r  \n</code></pre>\n\n<p>And this Tree:</p>\n\n<pre><code>testTree = Node 5  \n        (Node 3  \n            (Node 1 Empty Empty)  \n            (Node 6 Empty Empty)  \n        )  \n        (Node 9  \n            (Node 8 Empty Empty)  \n            (Node 10 Empty Empty)  \n        )  \n</code></pre>\n\n<p>If I run:</p>\n\n<pre><code>ghci&gt; F.foldl (+) 0 testTree  \n42  \nghci&gt; F.foldl (*) 1 testTree  \n64800  \n</code></pre>\n\n<p>How does GHCi know what Monoid to use for the mappend when it's folding? Because by default the numbers in the tree are just of the type Num, and we never explicitly said they where of some Monoid such as Sum or Product.</p>\n\n<p>So how does GHCi infer the correct Monoid to use? Or am I totally off at this point?</p>\n\n<p>Example source: <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids#monoids\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/functors-applicative-functors-and-monoids#monoids</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1512054965, "post_id": 47576601, "comment_id": 82110352, "body": "What is <code>a</code>? Seems to be ambiguous."}, {"owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512056017, "post_id": 47576601, "comment_id": 82111075, "body": "It&#39;s something with a Num instance.  I left out a few constraints for readability, but I can see why the declaration doesn&#39;t make much sense without some other constraint on a.  I edited it back in."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1512056602, "post_id": 47576601, "comment_id": 82111458, "body": "The <code>a</code> should be somehow linked to the type after the <code>=&gt;</code> (or at least the code itself, with some extensions on), otherwise GHC will always be unable to understand how to use such <code>a</code> -- it will continue inferring another type variable <code>a0</code> instead, and complain that it can&#39;t deduce the needed constraints on <code>a0</code>. It can be puzzling at the beginning, but that&#39;s how it has to work. After all, <code>f</code> could call <code>f&#39;</code> on a <i>different</i> type than <code>a</code>."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1512057002, "post_id": 47576601, "comment_id": 82111686, "body": "The compiler doesn&#39;t know what specifc <code>a</code> to use. This might be important, because the choice of <code>a</code> will determine the choice of some class instances, which will have an effect on the meaning of the program. Of course, it might also <i>not</i> matter if all classes involved are trivial or empty, but the compiler doesn&#39;t know that, only you do."}, {"owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "edited": false, "score": 0, "creation_date": 1512059410, "post_id": 47576601, "comment_id": 82113366, "body": "Still, it works fine as long as I don&#39;t write the type signature.  This is a minimal example based on a (working) real function that multiplies two frames that have (AllAre a .., Num a).  I believe that the type a is inferred from the AllAre constraints and the type of frames passed in."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1512060813, "post_id": 47576601, "comment_id": 82114190, "body": "I can&#39;t reproduce this behaviour - <code>f&#39;</code> doesn&#39;t compile with a bunch of ambiguous type errors related precisely to the type <code>a</code>. (NB: I&#39;ve added the imports I needed to get it to compile; if these are not the right ones, please correct). I&#39;m guessing you have <code>AllowAmbiguousTypes</code> enabled, which makes <code>f&#39;</code> compile. To get <code>f</code> to compile, enable <code>TypeApplications</code> and <code>ScopedTypeVariables</code>, add a <code>forall rs1 rs2 a . {..}</code> to the type of <code>f</code>, and change <code>f&#39;</code> in the body of <code>f</code> to <code>f&#39; @_ @_ @a</code>. I&#39;m not actually sure what cleverness the compile does to figure it out w/o a type signature."}, {"owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512107585, "post_id": 47576601, "comment_id": 82132126, "body": "@user2407038 You are correct - AllowAmbiguousTypes is on and without this extension the code won&#39;t type check with or without the type annotation.  I&#39;ve added this to the question. And I confirm that your changes with TypeApplications make it compile."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1512154867, "last_edit_date": 1512154867, "creation_date": 1512151651, "answer_id": 47599104, "question_id": 47576601, "link": "https://stackoverflow.com/questions/47576601/type-annotation-breaks-function/47599104#47599104", "title": "Type annotation breaks function", "body": "<p>As a <strong>general rule of thumb</strong>, adding an explicit type signature that matches the inferred type to a Haskell program will not change its meaning, but it's not actually guaranteed in the general case.  (I believe it <em>is</em> guaranteed for top-level definitions in Haskell98, though.)</p>\n\n<p>Ultimately, your problem isn't much different from the sort of type variable scoping problem that can happen with local definitions in Haskell98:</p>\n\n<pre><code>import Data.List\nsortImage :: Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]\nsortImage f = sortBy cmp\n  where cmp x y = compare (f x) (f y)\n</code></pre>\n\n<p>Here, the inferred type of <code>cmp</code> is effectively <code>(Ord b) =&gt; a -&gt; a -&gt; Ordering</code>.  You can't make this signature explicit, though, because you can't tie <code>a</code> and <code>b</code> back to the outer signature (and the type of <code>f</code> in particular) unless you use <code>ScopedTypeVariables</code>, in which case you can write:</p>\n\n<pre><code>sortImage :: forall a b . Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]\nsortImage f = sortBy cmp\n  where cmp :: a -&gt; a -&gt; Ordering\n        cmp x y = compare (f x) (f y)\n</code></pre>\n\n<p>As you've discovered, you can make this sort of type variable scoping problem happen with top level definitions, too, at least with <code>AllowAmbiguousTypes</code> enabled.</p>\n\n<p>Here is a simpler example that illustrates what I believe is the same problem, adapted from the GHC documentation on the <code>AllowAmbiguousTypes</code> extension:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE AllowAmbiguousTypes #-}\n\nclass D a b\ninstance D Bool b\ninstance D Int b\n\nstrange :: D a b =&gt; a -&gt; a\nstrange = undefined\n\n-- stranger :: (D a b1, D a b) =&gt; a -&gt; a\nstranger x = strange (strange x)\n</code></pre>\n\n<p>I've shown the inferred type of <code>stranger</code> as a comment.  If you try to make it explicit, you'll get the error:</p>\n\n<blockquote>\n  <p>\u2022 Could not deduce (D a b0) arising from a use of \u2018strange\u2019\n    from the context: (D a b2, D a b)</p>\n</blockquote>\n\n<p>The issue is that GHC can infer that <code>stranger</code> can be called on any <code>a</code> that satisfies <code>D a b1</code> for the outer <code>strange :: D a b1 =&gt; a -&gt; a</code> and also satisfies <code>D a b</code> for the inner <code>strange :: D a b =&gt; a -&gt; a</code>.</p>\n\n<p>However, if you attempt to make this type signature explicit, the link between the <code>b1</code> and <code>b</code> variables in the explicit signature for <code>stranger</code> and their relationship to the types of the <code>strange</code> calls is lost, much as the relationship between the <code>a</code> and <code>b</code> in a hypothetical <code>cmp</code> signature and the <code>a</code> and <code>b</code> in the <code>sortImage</code> signature is lost in the first example.</p>\n\n<p>Using <code>ScopedTypeVariables</code> alone isn't enough to solve the problem here because, constraints aside, the type of <code>strange</code> is just <code>a -&gt; a</code> and doesn't directly reference <code>b</code>.  So, you can write:</p>\n\n<pre><code>stranger :: forall a b1 b2 . (D a b1, D a b2) =&gt; a -&gt; a\nstranger x = (strange :: a -&gt; a) ((strange :: a -&gt; a) x)\n</code></pre>\n\n<p>but you can't tie the <code>b1</code> and <code>b2</code> to the types of the <code>strange</code> calls.  You need <code>TypeApplications</code> to do that:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE AllowAmbiguousTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeApplications #-}\n\nclass D a b\ninstance D Bool b\n\nstrange :: forall a b . D a b =&gt; a -&gt; a\nstrange = id\n\nstranger :: forall a b1 b2 . (D a b1, D a b2) =&gt; a -&gt; a\nstranger x = (strange @a @b1) (strange @a @b2 x)\n</code></pre>\n\n<p>and then it type checks okay, and you can even call:</p>\n\n<pre><code>&gt; stranger False\nFalse\n</code></pre>\n\n<p>without any type annotations (which is somewhat surprising).  If you had an instance:</p>\n\n<pre><code>instance D Int Double\n</code></pre>\n\n<p>though, then you'd need to be explicit to use <code>stranger</code> on <code>Int</code>s:</p>\n\n<pre><code>&gt; stranger @_ @Double @Double (1 :: Int)\n</code></pre>\n"}], "owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 47599104, "answer_count": 1, "score": 2, "last_activity_date": 1512154867, "creation_date": 1512054580, "last_edit_date": 1512107686, "question_id": 47576601, "link": "https://stackoverflow.com/questions/47576601/type-annotation-breaks-function", "title": "Type annotation breaks function", "body": "<p>Consider the following declarations for a function f' using singletons with the Frames library (which defines UnColumn and AllAre), and a wrapper function using withSing.</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes -#}\nimport Frames\nimport Data.Singletons.Prelude\n\nf' ::  forall rs1 rs2 a. (AllAre a (UnColumn rs1), AllAre a (UnColumn rs2), Num a)\n      =&gt; SList rs1 -&gt; SList rs2 -&gt; Frame (Record rs1) -&gt; Frame (Record rs2) -&gt; Int\nf' = undefined\n\nf df1 df2 = withSing (withSing f') df1 df2\n</code></pre>\n\n<p>This seems to work fine. But when I add a type annotation, type checking fails with the error Could not deduce: <code>(AllAre a0 (UnColumn rs1), AllAre a0 (UnColumn rs2))</code>.</p>\n\n<pre><code>f :: (SingI rs1, SingI rs2, AllAre a (UnColumn rs2), AllAre a (UnColumn rs1), Num a)\n=&gt; Frame (Record rs1) -&gt; Frame (Record rs2) -&gt; Int\nf df1 df2 = withSing (withSing f') df1 df2\n</code></pre>\n\n<p>The thing is, this is precisely the <em>inferred</em> type signature, according to GHCi (well, Intero). To my understanding adding an explicit signature matching the inferred signature should have no impact on the code semantics, so why would this break the code?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512054424, "post_id": 47576497, "comment_id": 82109974, "body": "Perhaps you can first aim to implement a counter to count the number of zeros, ones, etc."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512054519, "post_id": 47576497, "comment_id": 82110044, "body": "Furthermore perhaps you better first try to process a list of <code>Int</code>s, not a list of tuples."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1512054903, "post_id": 47576497, "comment_id": 82110307, "body": "If you install the <code>multiset</code> package and import <code>Data.MultiSet</code>, you could use <code>toOccurList . fromList</code> to get the number of occurrences of each value in a list. Perhaps first though, you should do this the manual way, with <code>foldr</code>/<code>foldl</code> and incrementing an accumulator as you see each value in the list."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1512067877, "post_id": 47576497, "comment_id": 82118479, "body": "A more appropriate data structure for <code>ProbabilityMatrix</code> is an array. Check out the <code>array</code> or <code>vector</code> libraries."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1512081748, "post_id": 47576497, "comment_id": 82125282, "body": "1 line: Get a list from the tuples.  2nd line: Get an array or map of the counts 3rd line: convert the array to a list (if desired) and return."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 9034519, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a632944b0a74e9bbae2ad03275f1de4?s=128&d=identicon&r=PG&f=1", "display_name": "BlueSnow", "link": "https://stackoverflow.com/users/9034519/bluesnow"}, "edited": false, "score": 0, "creation_date": 1512064959, "post_id": 47576748, "comment_id": 82116819, "body": "Thank you! I&#39;ve created a working program now but I was wondering if there&#39;s a cleaner way to write it - have added an edit to the main post"}], "tags": [], "owner": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "is_accepted": true, "score": 3, "last_activity_date": 1512055043, "creation_date": 1512055043, "answer_id": 47576748, "question_id": 47576497, "link": "https://stackoverflow.com/questions/47576497/counting-number-of-occurences-of-ints-in-a-list/47576748#47576748", "title": "Counting number of occurences of ints in a list", "body": "<p>How about you create the result list of Ints for each tuple, and then merge them together with a Sum function. You'd need at least two functions with signatures:</p>\n\n<p><code>tupleToList :: (Int, Int) -&gt; [Int]</code></p>\n\n<p>and </p>\n\n<p><code>sumLists :: [Int] -&gt; [Int] -&gt; [Int]</code></p>\n\n<p>The first one will detect both items in the tuple, and generate the corresponding list for it, e.g. <code>tupleToList (4, 2) -&gt; [0,0,1,0,1,0,0]</code>.</p>\n\n<p>The second function will merge two lists of ints by summing 2 counters at the same index, e.g. <code>sumLists [0,1,1,0,1] [1,1,0,0,0] -&gt; [1,2,1,0,1]</code>. You can do this recursively until you end up with 1 list that will be the answer to the problem.</p>\n\n<p>You'd execute <code>tupleToList</code> for each of the elements in the tuple list (probably with <code>map</code>) and then consolidate the resulting list by executing <code>sumLists</code> for 2 lists iteratively (maybe with <code>foldl</code>)</p>\n\n<p>This approach is rather naive and would probably run slowly for bigger inputs.</p>\n"}, {"tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 0, "last_activity_date": 1512183920, "creation_date": 1512183920, "answer_id": 47604156, "question_id": 47576497, "link": "https://stackoverflow.com/questions/47576497/counting-number-of-occurences-of-ints-in-a-list/47604156#47604156", "title": "Counting number of occurences of ints in a list", "body": "<p>You can try this solution:</p>\n\n<pre><code>-- flattens a list of tuples into a list\nflatten :: (Num a) =&gt; [(a, a)] -&gt; [a]\nflatten xs = concat [[a,b] | (a, b) &lt;- xs]\n\n-- updates list element at a position\nupdate_list :: (Num a) =&gt; Int -&gt; [a] -&gt; [a]\nupdate_list n xs = take n xs ++ [(xs !! n) + 1] ++ drop (n + 1) xs\n\n-- performs count of numbers\ncount_numbers :: [(Int, Int)] -&gt; [Int]\ncount_numbers xs = go (flatten xs) acc\n    where go [] acc = acc\n          go (x:xs) acc = go xs (update_list x acc)\n          acc = replicate 7 0\n</code></pre>\n\n<p>Where it first flattens a list:</p>\n\n<pre><code>*Main&gt; flatten [(0,1), (1,2), (2,3)]\n[0,1,1,2,2,3]\n</code></pre>\n\n<p>Then updates a list at a certain position:</p>\n\n<pre><code>*Main&gt; update_list 1 (replicate 7 0)\n[0,1,0,0,0,0,0]\n</code></pre>\n\n<p>And performs counting of list elements similarly to your function <code>tupleToList2</code>, where an accumulator of the number counts is stored and updated:</p>\n\n<pre><code>*Main&gt; count_numbers [(0,1), (1,2), (2,3)]\n[1,2,2,1,0,0,0]\n*Main&gt; count_numbers [(0,1), (1,2), (2,4)]\n[1,2,2,0,1,0,0]\n*Main&gt; count_numbers [(0,0), (1,0), (3,6)]\n[3,1,0,1,0,0,1]\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 9034519, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a632944b0a74e9bbae2ad03275f1de4?s=128&d=identicon&r=PG&f=1", "display_name": "BlueSnow", "link": "https://stackoverflow.com/users/9034519/bluesnow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 723, "favorite_count": 0, "accepted_answer_id": 47576748, "answer_count": 2, "score": 0, "last_activity_date": 1512183920, "creation_date": 1512054293, "last_edit_date": 1512065220, "question_id": 47576497, "link": "https://stackoverflow.com/questions/47576497/counting-number-of-occurences-of-ints-in-a-list", "title": "Counting number of occurences of ints in a list", "body": "<p>I'm trying to do the following:<br>\nThe function I'm writing takes list of tuples of ints <code>[(x,y),(i,j)...]</code> in range 0-6<br>\nI want to return an <code>[Int]</code> where each element is a count of how many of its\nrespective number were seen in the list.<br>\ne.g. <code>[(0,1), (1,2), (2,3)]</code> would return <code>[1, 2, 2, 1, 0, 0, 0]</code>.</p>\n\n<p>in other words, one 0, two 1's, two 2's 1 three and no 4s, 5s or 6s  </p>\n\n<pre><code>countNumbers :: [(Int, Int)] -&gt; [Int]  \ncountNumbers [] = [0, 0, 0, 0, 0, 0, 0]\n</code></pre>\n\n<p>but am not sure how to go about this as I am somewhat new to Haskell.<br>\nEDIT - I've found a solution  - please let me know if there's a more succinct way to code it  !</p>\n\n<pre><code>type ProbabilityMatrix = (Int,Int,Int,Int,Int,Int,Int)\n-- converts list of tuples into list of ints as suggested\ntupleToList :: [(Int, Int)] -&gt; [Int]  \ntupleToList ((a,b):xs) = a : b : tupleToList xs  \ntupleToList _          = []    \n\ntupleToList2 :: [Int] -&gt; ProbabilityMatrix -&gt; ProbabilityMatrix  \ntupleToList2 [] list = list  \ntupleToList2 (x : xs) (zero, one, two, three, four, five, six)  \n  | x == 0 =  tupleToList2 xs (zero + 1, one, two, three, four, five, six)  \n  | x == 1 = tupleToList2 xs (zero, one + 1, two, three, four, five, six)  \n  | x == 2 = tupleToList2 xs (zero, one, two + 1, three, four, five, six)  \n  | x == 3 = tupleToList2 xs (zero, one, two, three + 1, four, five, six)  \n  | x == 4 = tupleToList2 xs (zero, one, two, three, four + 1, five, six)  \n  | x == 5 = tupleToList2 xs (zero, one, two, three, four, five + 1, six)  \n  | x == 6 = tupleToList2 xs (zero, one, two, three, four, five, six + 1)  \n  | otherwise = tupleToList2 xs (zero + 1, one, two, three, four, five, six)   \n</code></pre>\n"}, {"tags": ["haskell", "parsec", "megaparsec"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1512054319, "post_id": 47576351, "comment_id": 82109899, "body": "I suspect you need a <code>try</code> before the recursive call."}, {"owner": {"reputation": 1131, "user_id": 2615160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6c82d2b99325ea24eedae70d7ea24bc8?s=128&d=identicon&r=PG", "display_name": "Sergey Sosnin", "link": "https://stackoverflow.com/users/2615160/sergey-sosnin"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512058446, "post_id": 47576351, "comment_id": 82112692, "body": "I do it, but it&#39;s not working:("}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1512143958, "creation_date": 1512143958, "answer_id": 47597050, "question_id": 47576351, "link": "https://stackoverflow.com/questions/47576351/parsec-how-to-recursively-parse-simple-expression/47597050#47597050", "title": "parsec how to recursively parse simple expression?", "body": "<p>Let's start with a simpler test case:</p>\n\n<pre><code>&gt; parseTest chain \"*\"\nparse error at (line 1, column 2):\nunexpected end of input\nexpecting \"*\" or \"(\"\n</code></pre>\n\n<p>Note that there's a parse error after reading the first star.  The input ended, but the parser expected to read either another star or an open parenthesis.</p>\n\n<p>Looking at your parser, it's clear that:</p>\n\n<pre><code>line &lt;- many $ char '*'\n</code></pre>\n\n<p>succeeds, by reading the first string of stars, but the next line:</p>\n\n<pre><code>branch &lt;- between (char '(') (char ')') chain\n</code></pre>\n\n<p>requires an open parenthesis in the input, and this is not made optional in any way.</p>\n\n<p>We could fix this by writing:</p>\n\n<pre><code>branch &lt;- option Empty $ between (char '(') (char ')') chain\n</code></pre>\n\n<p>Now, the parser works okay on <code>\"***\"</code>, but it hangs on <code>\"**(*)*\"</code>.  The problem is the line:</p>\n\n<pre><code>cont &lt;- (eof &gt;&gt; return Empty) &lt;|&gt; chain\n</code></pre>\n\n<p>This tries to decide when to stop parsing based on detecting the end of input, but this only works at the top level <code>chain</code> call where the end of the current tree corresponds to the end of the input -- in a recursive call, the tree can end before the input does, so this won't work.</p>\n\n<p>Specifically, in the test case <code>\"**(*)*\"</code>, when parsing the tree inside the parentheses, namely <code>*</code>, we get <code>line</code> set to <code>*</code>, <code>branch</code> set to <code>Empty</code>, and then the <code>cont</code> line sees that we aren't at the end of the input (since the rest of the input <code>\")*\"</code> is still to be read) and recursively calls <code>chain</code>.  In this recursive call, <code>line</code> gets set to the empty string, <code>branch</code> gets set to <code>Empty</code>, and the <code>cont</code> line again causes a recursive call to <code>chain</code>, and we have an infinite loop.</p>\n\n<p>Instead, let's write a parser <code>tree</code> that parses the <code>line</code> of a tree:</p>\n\n<pre><code>tree = do\n  line &lt;- many $ char '*'\n</code></pre>\n\n<p>and now <em>optionally</em> a <code>tree</code> in parenthesis (for the left hand side):</p>\n\n<pre><code>  mleft  &lt;- optionMaybe $ between (char '(') (char ')') tree\n</code></pre>\n\n<p>If there is no left-hand side, then there can't be a right hand side either (convince yourself that this is true! -- try to write a tree that has no left hand side in parenthesis but still has a non-empty right hand side, and you'll see it can't be done), so we're finished:</p>\n\n<pre><code>  case mleft of\n    Nothing -&gt; return $ Node line Empty Empty\n</code></pre>\n\n<p>If there is a left-hand side, then read the right hand side tree (which might be empty, but that's okay) and return the node:</p>\n\n<pre><code>    Just left -&gt; do\n      right &lt;- tree\n      return $ Node line left right\n</code></pre>\n\n<p>The whole parser looks like:</p>\n\n<pre><code>tree :: Parser Tree\ntree = do\n  line &lt;- many $ char '*'\n  mleft  &lt;- optionMaybe $ between (char '(') (char ')') tree\n  case mleft of\n    Nothing -&gt; return $ Node line Empty Empty\n    Just left -&gt; do\n      right &lt;- tree\n      return $ Node line left right\n</code></pre>\n\n<p>and hopefully does what you expect:</p>\n\n<pre><code>&gt; parseTest tree \"*\"\nNode \"*\" Empty Empty\n&gt; parseTest tree \"***\"\nNode \"***\" Empty Empty\n&gt; parseTest tree \"**(*)*\"\nNode \"**\" (Node \"*\" Empty Empty) (Node \"*\" Empty Empty)\n&gt; parseTest tree \"****(**(**)*)**\"\nNode \"****\" (Node \"**\" (Node \"**\" Empty Empty)\n    (Node \"*\" Empty Empty)) (Node \"**\" Empty Empty)\n</code></pre>\n\n<p>This parser just ignores trailing input:</p>\n\n<pre><code>&gt; parseTest tree \"*hello*\"\nNode \"*\" Empty Empty\n</code></pre>\n\n<p>but you can write a wrapper to require the end of the outermost tree correspond to the end of input:</p>\n\n<pre><code>treeOnly :: Parser Tree\ntreeOnly = tree &lt;* eof\n</code></pre>\n"}], "owner": {"reputation": 1131, "user_id": 2615160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6c82d2b99325ea24eedae70d7ea24bc8?s=128&d=identicon&r=PG", "display_name": "Sergey Sosnin", "link": "https://stackoverflow.com/users/2615160/sergey-sosnin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "accepted_answer_id": 47597050, "answer_count": 1, "score": 1, "last_activity_date": 1512143958, "creation_date": 1512053783, "question_id": 47576351, "link": "https://stackoverflow.com/questions/47576351/parsec-how-to-recursively-parse-simple-expression", "title": "parsec how to recursively parse simple expression?", "body": "<p>I have a strings like that: <code>***</code>, <code>**(*)*</code>, <code>****(**(**)*)**</code></p>\n\n<p>And I want to parse it in the data structure like that:</p>\n\n<p><code>data Tree = Node [S] Tree Tree | Empty</code> where <code>S</code> is <code>*</code>\n(<code>*</code> doesn't mean any char it is just star symbol)</p>\n\n<p>I tried to build parser (I use <code>megaparsec</code> but it is very similar to habitual <code>parsec</code>):</p>\n\n<pre><code>data Tree = Node [Char] Tree Tree | Empty deriving (Show)\n\nchain :: Parser Tree \nchain = do\n    line &lt;- many $ char '*'\n    branch &lt;- between (char '(') (char ')') chain\n    cont &lt;- (eof &gt;&gt; return Empty) &lt;|&gt; chain\n    return $ Node line branch cont\n\ntest = parseTest chain \"****(*(*)***)*(*)**\"\n</code></pre>\n\n<p>But It doesn't work. I tried many ways but can't struggle with it. </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1512050702, "post_id": 47575258, "comment_id": 82107463, "body": "Right! I forgot about that :/"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1512050408, "creation_date": 1512050408, "answer_id": 47575258, "question_id": 47575065, "link": "https://stackoverflow.com/questions/47575065/fixity-declarations-for-data-constructors/47575258#47575258", "title": "Fixity declarations for data constructors", "body": "<p>You can do this allright, just, infix constructors must always begin with a colon.</p>\n\n<pre><code>infixl 7 :&gt;&gt;&gt;\ndata A = A :&gt;&gt;&gt; A\n</code></pre>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 47575258, "answer_count": 1, "score": 2, "last_activity_date": 1512050408, "creation_date": 1512049806, "question_id": 47575065, "link": "https://stackoverflow.com/questions/47575065/fixity-declarations-for-data-constructors", "title": "Fixity declarations for data constructors", "body": "<p>Is it possible to declare fixity for a data constructor in Haskell. For instance, given:</p>\n\n<pre><code>data A = (&gt;&gt;&gt;) A A\n</code></pre>\n\n<p>I would like to declare</p>\n\n<pre><code>infixl 4 &gt;&gt;&gt;\n</code></pre>\n\n<p>Looking at <a href=\"https://downloads.haskell.org/~ghc/7.8.3/docs/html/users_guide/data-type-extensions.html\" rel=\"nofollow noreferrer\">the data type extensions</a> documentation it seems one can only declare fixity for the type constructor. But even that does not seem to work, at least in the way I tried:</p>\n\n<pre><code>infixl 7 A\ndata A = (&gt;&gt;&gt;) A A\n</code></pre>\n\n<p>Can this be done at all?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1512047400, "post_id": 47573979, "comment_id": 82105301, "body": "what should <code>search 1 (Fork 1 Empty Empty)</code> return?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1512047902, "post_id": 47573979, "comment_id": 82105618, "body": "probably <code>Just []</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512048367, "post_id": 47573979, "comment_id": 82105898, "body": "@WillemVanOnsem right. thanks."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1512048952, "post_id": 47573979, "comment_id": 82106284, "body": "What if the element appears twice (or more)?"}], "answers": [{"comments": [{"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1512051451, "post_id": 47574852, "comment_id": 82107965, "body": "Can you explain which part is using the <code>MonadPlus</code> a little bit more? I do understand <code>&lt;$&gt;</code> for functor, <code>&lt;|&gt;</code> for alternative and <code>guard</code> for monad."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 2, "creation_date": 1512051539, "post_id": 47574852, "comment_id": 82108037, "body": "@wizzup <code>guard :: MonadPlus m =&gt; Bool -&gt; m ()</code>."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1512051564, "last_edit_date": 1512051564, "creation_date": 1512049146, "answer_id": 47574852, "question_id": 47573979, "link": "https://stackoverflow.com/questions/47573979/search-for-element-in-binary-tree/47574852#47574852", "title": "Search for Element in binary tree", "body": "<pre><code>search :: Eq a =&gt; a -&gt; Bintree a -&gt; Maybe [Edge]\nsearch a Empty = Nothing\nsearch a (Fork b lt rt) = (guard (a==b) &gt;&gt; pure [])\n                        &lt;|&gt; (Left  :) &lt;$&gt; search a lt\n                        &lt;|&gt; (Right :) &lt;$&gt; search a rt\n</code></pre>\n\n<p>should do the trick. Performs left-biased depth-first search, returning the path to the first matching value, if any.</p>\n\n<p>This uses <code>Just</code> as a Functor, as an Applicative, as Alternative, a Monad and as a MonadPlus, using data type-encoded behavior to spare us having to write some mundane code ourselves.</p>\n"}], "owner": {"reputation": 43, "user_id": 8951381, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-PszXe-KggKE/AAAAAAAAAAI/AAAAAAAAABo/pdb4Hf1GyAM/photo.jpg?sz=128", "display_name": "Anonnnn", "link": "https://stackoverflow.com/users/8951381/anonnnn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 0, "closed_date": 1512050285, "answer_count": 1, "score": -3, "last_activity_date": 1512051564, "creation_date": 1512046305, "question_id": 47573979, "link": "https://stackoverflow.com/questions/47573979/search-for-element-in-binary-tree", "closed_reason": "Needs more focus", "title": "Search for Element in binary tree", "body": "<p>We have this tree:</p>\n\n<pre><code>data Bintree a = Empty | Fork a (Bintree a) (Bintree a) deriving Show\ndata Edge = Left | Right deriving Show\ntype Node = [Edge]\n</code></pre>\n\n<p>I should search for an element in it. If I find it, I return Just Node. If not, I return Nothing. The tree is not ordered.</p>\n\n<pre><code>search :: Eq a =&gt; a -&gt; Bintree a -&gt; Maybe Node\n</code></pre>\n\n<p>The search function should look like this.</p>\n"}, {"tags": ["haskell", "case"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1512046085, "post_id": 47573725, "comment_id": 82104440, "body": "you <i>indentation</i> is ragged. <code>_</code> is under <code>X</code>, not under the first <code>&#39;</code> as it should be. Either be extra careful, or use explicit braces and semicolons, to be sure about the grouping of expressions."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1512046737, "post_id": 47573725, "comment_id": 82104847, "body": "Having added a type annotation for <code>convertCharToInteger</code>, you don&#39; need to do likewise for <code>read</code>; the compiler knows that <code>read</code> has to return an <code>Integer</code>. Point-free style hurts here as well; <code>convertCharToInteger c = read [c]</code> is much simpler. (Although if you really want to be point-free, take advantage of the <code>Applicative</code> instance for lists: <code>convertCharToInteger = read . pure</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1512046190, "post_id": 47573923, "comment_id": 82104514, "body": "The new line is not necessary (though usually sensible), the important thing is that the cases are aligned."}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 0, "last_activity_date": 1512046096, "creation_date": 1512046096, "answer_id": 47573923, "question_id": 47573725, "link": "https://stackoverflow.com/questions/47573725/why-does-this-case-expression-for-foldr-does-not-work/47573923#47573923", "title": "Why does this case expression for foldr does not work?", "body": "<p>You should start listing the cases on a new line and align them like so:</p>\n\n<pre><code>parseAsNumbers :: String -&gt; [Integer]\nparseAsNumbers xs = foldr (\\x acc -&gt; case x of\n                                       '-' -&gt; acc\n                                       'X' -&gt; 10:acc\n                                       _   -&gt; (convertCharToInteger x):acc\n                      ) [] xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 497, "user_id": 3979725, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mj52I.jpg?s=128&g=1", "display_name": "David Lilue", "link": "https://stackoverflow.com/users/3979725/david-lilue"}, "is_accepted": false, "score": 0, "last_activity_date": 1512046771, "creation_date": 1512046771, "answer_id": 47574128, "question_id": 47573725, "link": "https://stackoverflow.com/questions/47573725/why-does-this-case-expression-for-foldr-does-not-work/47574128#47574128", "title": "Why does this case expression for foldr does not work?", "body": "<p>The patterns should be aligned, like this:</p>\n\n<pre><code>parseAsNumbers :: String -&gt; [Integer]\nparseAsNumbers xs = foldr (\\x acc -&gt; case x of '-' -&gt; acc\n                                               'X' -&gt; 10:acc\n                                               _   -&gt; (convertCharToInteger x):acc) [] xs\n</code></pre>\n\n<p>Also, you could use <code>read</code> instead of <code>convertCharToInteger</code>.</p>\n\n<pre><code>parseAsNumbers :: String -&gt; [Integer]\nparseAsNumbers xs = foldr doit [] xs\n    where\n        doit = \\x acc -&gt; case x of\n            '-' -&gt; acc\n            'X' -&gt; (10:acc)\n            _   -&gt; (read [x]:acc) \n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7452571, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BtG2B8zyfbE/AAAAAAAAAAI/AAAAAAAAAYU/XPS14CYgbK4/photo.jpg?sz=128", "display_name": "Ranbir Singh", "link": "https://stackoverflow.com/users/7452571/ranbir-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 155, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1512046771, "creation_date": 1512045513, "question_id": 47573725, "link": "https://stackoverflow.com/questions/47573725/why-does-this-case-expression-for-foldr-does-not-work", "title": "Why does this case expression for foldr does not work?", "body": "<p>The following function should take \"7-8-X\" and convert to [7,8,10]</p>\n\n<pre><code>convertCharToInteger :: Char -&gt; Integer\nconvertCharToInteger = (read::String-&gt;Integer) . (:[])\n\nparseAsNumbers :: String -&gt; [Integer]\nparseAsNumbers xs = foldr (\\x acc -&gt; case x of '-' -&gt; acc\n                                           'X' -&gt; 10:acc\n                                            _  -&gt; (convertCharToInteger x):acc\n                      ) [] xs\n</code></pre>\n\n<p>it gives me following error </p>\n\n<p>Pattern syntax in expression context:</p>\n\n<pre><code>\\x acc\n    -&gt; case x of {\n      '-' -&gt; acc\n      'X' -&gt; 10 : acc (...) } -&gt; (convertCharToInteger x) : acc\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1512400292, "post_id": 47572807, "comment_id": 82230635, "body": "Does <a href=\"https://github.com/commercialhaskell/stack/issues/1476\" rel=\"nofollow noreferrer\">this</a> issue describe your problem?"}, {"owner": {"reputation": 23557, "user_id": 12266, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6a2a454191fa75d4114ed05836a0b924?s=128&d=identicon&r=PG", "display_name": "Andrew Jaffe", "link": "https://stackoverflow.com/users/12266/andrew-jaffe"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1512464631, "post_id": 47572807, "comment_id": 82257529, "body": "@Alec, I think so, at least filib&#39;s description sounds the same. I admit I can&#39;t tell from the thread on GitHub whether there is any resolution/workaround."}, {"owner": {"reputation": 23557, "user_id": 12266, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6a2a454191fa75d4114ed05836a0b924?s=128&d=identicon&r=PG", "display_name": "Andrew Jaffe", "link": "https://stackoverflow.com/users/12266/andrew-jaffe"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1512487332, "post_id": 47572807, "comment_id": 82272353, "body": "Followup: I think for the above problem I should be doing <code>stack exec -- ghc-pkg unregister --force ihaskell-plot</code> and then <code>stack install</code>?"}], "owner": {"reputation": 23557, "user_id": 12266, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6a2a454191fa75d4114ed05836a0b924?s=128&d=identicon&r=PG", "display_name": "Andrew Jaffe", "link": "https://stackoverflow.com/users/12266/andrew-jaffe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1512380113, "creation_date": 1512042536, "last_edit_date": 1512055619, "question_id": 47572807, "link": "https://stackoverflow.com/questions/47572807/haskell-stack-compilation-fails-when-library-versions-change", "title": "Haskell Stack: compilation fails when library versions change", "body": "<p>I've started using the <a href=\"http://haskellstack.org\" rel=\"nofollow noreferrer\">Haskell Stack</a>, mostly as a vehicle to compile and run the <a href=\"https://github.com/gibiansky/IHaskell\" rel=\"nofollow noreferrer\">iHaskell kernel</a> for <a href=\"http://jupyter.org\" rel=\"nofollow noreferrer\">jupyter</a>.</p>\n\n<p>I am on macOS 10.13 and using <a href=\"http://brew.sh\" rel=\"nofollow noreferrer\">homebrew</a> to supply needed libraries. I try to keep these up-to-date, but this means that when running <code>stack install</code> after updating with homebrew I sometimes get error messages like</p>\n\n<pre><code>Configuring ihaskell-plot-0.3.0.0...\nPreprocessing library ihaskell-plot-0.3.0.0...\n[1 of 1] Compiling IHaskell.Display.Plot ( IHaskell/Display/Plot.hs, .stack-work/dist/x86_64-osx/Cabal-1.24.2.0/build/IHaskell/Display/Plot.o )\nld: warning: directory not found for option '-L/usr/local/Cellar/pango/1.40.13/lib'\nInstalling library in\n/Users/jaffe/home/python/IHaskell/.stack-work/install/x86_64-osx/lts-9.14/8.0.2/lib/x86_64-osx-ghc-8.0.2/ihaskell-plot-0.3.0.0-NgQdZJT4fgFyloQxui3eM\n</code></pre>\n\n<p>as homebrew has updated to a newer version of (in this case) <code>pango</code> since I most recently installed <a href=\"http://haskellstack.org\" rel=\"nofollow noreferrer\">stack</a> and therefore there are files in the global <code>~/.stack</code> directory that point to the wrong libraries. The only fix I have found is to delete all of <code>~/.stack</code> and recompile everything. (Note that the problem is indeed because of out-of-date files in the global <code>~/.stack</code>, not the local project directory).</p>\n\n<p>For my current use case, where this is essentially the only thing for which I use stack, this isn't a big deal, but I can imagine that it could get to be a pain if I have many projects going. </p>\n\n<p>So: Is there any easy way to force recompilation/regeneration of just the appropriate files in <code>~/.stack</code> rather than the whole directory?</p>\n"}, {"tags": ["javascript", "haskell", "tree", "functional-programming", "fold"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512044053, "post_id": 47572451, "comment_id": 82103151, "body": "Did you figure out the signature for <code>mapTree</code> already?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512045700, "post_id": 47572451, "comment_id": 82104172, "body": "Can you show your implementation of <code>reduceTree</code>, please? I would guess it currently does never call <code>f</code> - unless you change <code>getChildren</code> into something like <code>getContents :: T a -&gt; (a, [T a])</code>."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512045782, "post_id": 47572451, "comment_id": 82104234, "body": "Ah, it does - but your <code>f</code> should take an <code>a</code> parameter, not a <code>T a</code>."}, {"owner": {"reputation": 493, "user_id": 1250621, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gisqt.jpg?s=128&g=1", "display_name": "Luftzig", "link": "https://stackoverflow.com/users/1250621/luftzig"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512056566, "post_id": 47572451, "comment_id": 82111430, "body": "@Bergi I avoid dealing with the structure of the nodes themselves by making <code>f :: b -&gt; T a -&gt; b</code>. Remember that I&#39;m actually using javascript, so everything is pretty loose."}, {"owner": {"reputation": 493, "user_id": 1250621, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gisqt.jpg?s=128&g=1", "display_name": "Luftzig", "link": "https://stackoverflow.com/users/1250621/luftzig"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1512057388, "post_id": 47572451, "comment_id": 82111965, "body": "@WillNess, @Bergi I added my implementation of <code>reduceTree</code> and my pseudo code for it. Notice that my &quot;Tree&quot; only has Nodes with some value, and a (possibly empty) list of children."}], "answers": [{"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512110410, "post_id": 47580167, "comment_id": 82133128, "body": "I think <code>reduceTree</code> should have the signature <code>(a -&gt; b -&gt; b) -&gt; T a -&gt; b</code> - not a list of <code>b</code>s. Of course this definition fits better for your <code>map</code>."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512130350, "post_id": 47580167, "comment_id": 82143294, "body": "No, a <code>Node</code> has a list of children. Each of those children need to be converted to a <code>b</code> in order for the <code>Node</code> to be converted to a <code>b</code>. It doesn&#39;t make sense to take exactly one <code>b</code> as an input. What if the <code>Node</code> doesn&#39;t have any children? From where would you conjure a <code>b</code>?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512130909, "post_id": 47580167, "comment_id": 82143605, "body": "Oops, right, that <code>reduceTree</code> also misses a parameter for the initial value. You&#39;d usually have <code>foldTree f acc (Node val children) = foldList (foldTree f) (f val acc) children)</code>"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512132343, "post_id": 47580167, "comment_id": 82144520, "body": "Forgive me if I&#39;m missing something here but why do we need an initial value? Why do we need an accumulator at all? Also, by <code>foldList</code> I&#39;m assuming that you mean <code>foldl</code> in Haskell right?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512132502, "post_id": 47580167, "comment_id": 82144616, "body": "A generic <code>fold</code> function needs an initial value because there are foldable structures that are empty - unlike your representation of the n-ary tree that contains always at least one value in its root node."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512132656, "post_id": 47580167, "comment_id": 82144709, "body": "Yes, <code>foldList</code> would be <code>foldl</code> or <code>foldr</code> in Haskell, I just used a different name to avoid the confusion from using the same overloaded function with different types."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512132853, "post_id": 47580167, "comment_id": 82144847, "body": "Using <code>foldr</code> would restrict its type to <code>(a -&gt; T a -&gt; T a) -&gt; T a -&gt; T a -&gt; T a</code> which is probably not what you&#39;d want. Using <code>foldl</code> would allow its type to be <code>(a -&gt; b -&gt; b) -&gt; b -&gt; T a -&gt; b</code>."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512133090, "post_id": 47580167, "comment_id": 82145005, "body": "Yes, but <code>foldTree</code> isn&#39;t a generic fold. Also, your initial value keeps changing due to <code>foldList</code>. In fact, it changes from the get go due to <code>(f val acc)</code>. Just trying to understand what&#39;s the purpose of <code>acc</code> at all. To me, it doesn&#39;t seem like you&#39;d need it."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1512136037, "post_id": 47580167, "comment_id": 82146853, "body": "Yes, folding the initial value with all the individual values from the tree is the entire purpose of a <code>fold</code> function, isn&#39;t it? Yes, the accumulator &quot;changes&quot; in the course of that."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1512148108, "post_id": 47580167, "comment_id": 82154487, "body": "@Bergi Haskell <a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Tree.html#v:foldTree\" rel=\"nofollow noreferrer\">has it the exact same way as here</a>. John Hughes in his paper &quot;Why Functional Programming Matters&quot; <a href=\"https://codegolf.stackexchange.com/a/50418/5021\">had it almost the same, as</a> <code>foldTree :: (a -&gt; b -&gt; r) -&gt; (r -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; r ; foldTree f g z (Node x t) = f x . foldr g z . map (foldTree f g z) $ t</code>. With it, <code>foldTree f g z = reduceTree (\\a rs -&gt; f a (foldr g z rs))</code> and <code>map h = reduceTree (Node . h) = reduceTree (\\a rs -&gt; Node (h a) rs) = foldTree (Node . h) (:) []</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1512148902, "post_id": 47580167, "comment_id": 82154903, "body": "@Bergi the absence of &quot;zero&quot; i.e. initial accumulator value comes from the absence of second clause in the data definition, <code>T a = Node a [T a]</code> a.o.t. lists&#39; <code>List a = Nil | Cons a (List a)</code>. So the algebra for the former is <code>NodeF a r -&gt; r</code> where <code>data NodeF a r = NodeF a [r]</code>  and for the second it&#39;s <code>ConsF a r -&gt; r</code> where <code>data ConsF a r = NilF | ConsF a r</code> (speaking in <i>recursion-schemes</i>). So there&#39;s no Nil case to handle."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1512172776, "post_id": 47580167, "comment_id": 82165143, "body": "@WillNess Haskell also has <a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Tree.html#v:foldr\" rel=\"nofollow noreferrer\"><code>foldr</code> on those trees</a> :-)"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1512196352, "post_id": 47580167, "comment_id": 82169164, "body": "@WillNess It&#39;s in the <code>Foldable Tree</code> instance"}, {"owner": {"reputation": 493, "user_id": 1250621, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gisqt.jpg?s=128&g=1", "display_name": "Luftzig", "link": "https://stackoverflow.com/users/1250621/luftzig"}, "edited": false, "score": 1, "creation_date": 1512306125, "post_id": 47580167, "comment_id": 82195304, "body": "Thank y&#39;all! I&#39;ve ended up using your version, but everyone were very helpful!"}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": true, "score": 4, "last_activity_date": 1512066123, "creation_date": 1512066123, "answer_id": 47580167, "question_id": 47572451, "link": "https://stackoverflow.com/questions/47572451/map-an-arbitrary-n-ary-tree-with-fold/47580167#47580167", "title": "Map an arbitrary n-ary Tree with fold", "body": "<p>I see that your tree data structure is defined as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data T a = Node a [T a]\n</code></pre>\n\n<p>If that's the case then the fold for your tree data structure would be:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>reduceTree :: (a -&gt; [b] -&gt; b) -&gt; T a -&gt; b\nreduceTree f = let g (Node a xs) = f a (map g xs) in g\n</code></pre>\n\n<p>You can now define <code>mapTree</code> using <code>reduceTree</code> as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>mapTree :: (a -&gt; b) -&gt; T a -&gt; T b\nmapTree f = reduceTree (Node . f)\n</code></pre>\n\n<p>Converting it all to JavaScript:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>const Node = (a, xs) =&gt; ({a, xs});\r\n\r\nconst reduceTree = (f, node) =&gt; {\r\n    const g = node =&gt; f(node.a, node.xs.map(g));\r\n    return g(node);\r\n};\r\n\r\nconst mapTree = (f, node) =&gt; reduceTree((a, xs) =&gt; Node(f(a), xs), node);\r\n\r\nconst tree = Node(2, [ Node(3, [ Node(11, [])\r\n                               , Node(13, []) ])\r\n                     , Node(5, [])\r\n                     , Node(7, [ Node(17, [])\r\n                               , Node(19, []) ]) ]);\r\n\r\nconsole.log(mapTree(x =&gt; 2 * x, tree));</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Hope that helps.</p>\n"}, {"comments": [{"owner": {"reputation": 493, "user_id": 1250621, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gisqt.jpg?s=128&g=1", "display_name": "Luftzig", "link": "https://stackoverflow.com/users/1250621/luftzig"}, "edited": false, "score": 0, "creation_date": 1512306232, "post_id": 47609111, "comment_id": 82195333, "body": "Thank you! That is some extremely helpful explanation, and it helped me a lot. I ended up using Aadit&#39;s solution, but I did not understand it before reading your answer."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 493, "user_id": 1250621, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gisqt.jpg?s=128&g=1", "display_name": "Luftzig", "link": "https://stackoverflow.com/users/1250621/luftzig"}, "edited": false, "score": 0, "creation_date": 1512308165, "post_id": 47609111, "comment_id": 82195871, "body": "@Luftzig thank you, and me too, before writing it. :) Interesting how one kind of a fold lets you recreate the structure easily, and the other destroys it. There&#39;s something like this in implementing <code>tail</code> with a right fold, which is very hard to do IIRC, and trivial with a paramorphism. there&#39;s some deeper currents here for sure..."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 493, "user_id": 1250621, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gisqt.jpg?s=128&g=1", "display_name": "Luftzig", "link": "https://stackoverflow.com/users/1250621/luftzig"}, "edited": false, "score": 0, "creation_date": 1512308786, "post_id": 47609111, "comment_id": 82196030, "body": "re: linearity, it means it <i>is</i> easy to map a function over  node values <i>while</i> transforming a Tree into a List. It&#39;s just that the tree structure is lost in the process. Maybe it can be recovered by somehow decorating the output type of the reducer function with some &quot;markings&quot;, and recreating the structure back, afterwards. --- the opposite question to ask oneself might be, is it possible to flatten a tree into a list with Aadit&#39;s fold."}, {"owner": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 0, "creation_date": 1607364182, "post_id": 47609111, "comment_id": 115243801, "body": "@WillNess Maybe your <code>foldTree</code> aka <code>redtree</code> is too mundane but I consider it a functional pearl. The equivalence to Aadit&#39;s catamorphism isn&#39;t obvious to me, b/c it inlcudes a right fold and thus loses non-linear structure. But since <code>foldTree</code> has two distinct functions it can somehow retrieve the structure. It is an amazing combinator, thanks for digging it out of the paper."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 3831, "user_id": 5536315, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/38Cjm.png?s=128&g=1", "display_name": "scriptum", "link": "https://stackoverflow.com/users/5536315/scriptum"}, "edited": false, "score": 1, "creation_date": 1607375093, "post_id": 47609111, "comment_id": 115248136, "body": "@scriptum <i>John Hughes&#39;s</i> <code>foldTree</code>, I only tweaked it syntactically. :)  The paper presents it in a more verbose way, I was real proud of myself recognizing that pattern and putting that recursive call into the composition chain. :) it also features <a href=\"https://codegolf.stackexchange.com/questions/50417/most-concise-way-to-fold-tree-structures/50418#50418\">here</a> BTW.  I do remember writing this answer, but not all the details about it. :)  I think you&#39;ve put your finger on it, with the two functions distinction."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 4, "last_activity_date": 1552081350, "last_edit_date": 1552081350, "creation_date": 1512226201, "answer_id": 47609111, "question_id": 47572451, "link": "https://stackoverflow.com/questions/47572451/map-an-arbitrary-n-ary-tree-with-fold/47609111#47609111", "title": "Map an arbitrary n-ary Tree with fold", "body": "<p>TL;DR: Your pseudocode is broken. One way to fix it is</p>\n\n\n\n<pre class=\"lang-js prettyprint-override\"><code>reduceTree :: (b -&gt; a -&gt; b) -&gt; b -&gt; T a -&gt; b\nreduceTree f acc (Node val []) = f acc val\nreduceTree f acc (Node val ts) = \n    Data.List.foldl (\\acc tree -&gt; reduceTree f acc tree) (f acc val) ts\n</code></pre>\n\n<p>This means that your  Javascript  should have been</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>export function reduceTree(getChildren, f, accumulator, tree) {\n  const children = getChildren(tree);\n  if (!children || children.length === 0) {\n    return f(accumulator, tree)\n  } else {\n    const childrenResult = children.reduce(\n      (accumulator, subTree) =&gt; reduceTree(getChildren, f, accumulator, subTree),\n      f(accumulator,tree)  // referring to `tree` only for its stored node value, yes?\n    );\n    return childrenResult;\n  }\n}\n</code></pre>\n\n<p>Presumably Javascript's <code>reduce</code> on lists is a <em>left</em> fold (according to Wikipedia it is so).</p>\n\n<p>It performs pre-order tree traversal, and is equivalent to the <code>tfoldl</code> function at the bottom of this post. Implementing <code>map</code> with it doesn't quite work though,</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>tmap f t = reduceTree (\\acc val -&gt; Node (f val) ???) ??? t\n</code></pre>\n\n<p>because the types are not right for the <code>Node :: a -&gt; [T a] -&gt; T a</code>, which can't be made to fit the reducer type above, <code>b -&gt; a -&gt; b</code> (it needs the type  <code>a -&gt; [b] -&gt; b</code>).</p>\n\n<p>This is because this kind of linear folding is essentially flattening the structure, treating it as a <em>linear</em> sequence.</p>\n\n<p>Some extraneous elaborations follow.</p>\n\n<hr>\n\n<p>Haskell <a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Tree.html#v:foldTree\" rel=\"nofollow noreferrer\">has it the exact same way</a> as the <code>reduceTree</code> function in <a href=\"https://stackoverflow.com/a/47580167/849891\">Aadit's answer</a>. </p>\n\n<p>John Hughes in his famous paper \"Why Functional Programming Matters\" had it almost the same way too, as </p>\n\n<pre class=\"lang-js prettyprint-override\"><code>foldTree :: (a -&gt; b -&gt; r) -&gt; (r -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; r \nfoldTree f g z (Node x t) = f x . foldr g z . map (foldTree f g z) $ t\n</code></pre>\n\n<p>He used an equivalent, but a bit more verbose formulation, which he called <code>redtree</code>, for \"reduce tree\". It holds that</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>foldTree f g z = reduceTree (\\a rs -&gt; f a (foldr g z rs)) \n</code></pre>\n\n<p>so the two are pretty much equivalent. Then,</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>map h = reduceTree (Node . h) \n      = reduceTree (\\a rs -&gt; Node (h a) rs) \n      = foldTree (Node . h) (:) [] \n</code></pre>\n\n<p>The absence of \"zero\" i.e. initial accumulator value comes from the absence of second clause in the data definition, <code>data T a = Node a [T a]</code> as opposed to <code>List a = Nil | Cons a (List a)</code>, for the lists. </p>\n\n<p>The fold's reducer function for the latter takes either <code>Nil</code> or <code>Cons a r</code> to <code>r</code>, hence it must have the \"zero\" i.e. defult value supplied to it; and for the former it  takes <code>Node a [r]</code> to <code>r</code>, so there's no <code>Nil</code> case to handle (cf. <a href=\"/questions/tagged/recursion-schemes\" class=\"post-tag\" title=\"show questions tagged &#39;recursion-schemes&#39;\" rel=\"tag\">recursion-schemes</a>).</p>\n\n<hr>\n\n<p>Following <a href=\"https://stackoverflow.com/questions/47572451/map-an-arbitrary-n-ary-tree-with-fold/47580167?noredirect=1#comment82169164_47580167\">a hint</a> from <a href=\"https://stackoverflow.com/users/1048572/bergi\">user Bergi</a> in the comments, the Haskell package <a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Tree.html\" rel=\"nofollow noreferrer\"><code>containers</code></a> defines <a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/src/Data.Tree.html#line-170\" rel=\"nofollow noreferrer\">a Foldable instance</a> for this type,</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>data T a = Node a [T a]\n</code></pre>\n\n<p>whose equivalent of <code>foldr</code> (with flipped arguments, for convenience), is</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>tfoldr :: (a -&gt; b -&gt; b) -&gt; T a -&gt; b -&gt; b \ntfoldr f (Node x ts) z = f x $ Data.List.foldr ($) z [tfoldr f t | t &lt;- ts]\n</code></pre>\n\n<p>indeed threading through the state / accumulator! It can be also written as </p>\n\n<pre class=\"lang-js prettyprint-override\"><code>tfoldr :: (a -&gt; b -&gt; b) -&gt; T a -&gt; b -&gt; b \ntfoldr f (Node x ts) z = f x . Data.List.foldr (.) id [tfoldr f t | t &lt;- ts] $ z\n</code></pre>\n\n<p>whichever is easier for you to implement. This is implementing the post-order tree traversal; for the usual pre-order traversal use</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>tfoldl :: (a -&gt; b -&gt; b) -&gt; T a -&gt; b -&gt; b\ntfoldl f (Node x ts) z = Data.List.foldr (&gt;&gt;&gt;) id [tfoldl f t | t &lt;- ts] $ f x z\n                 -- // = tfoldl f tn (... (tfoldl f t2 (tfoldl f t1 (f x z))) ...)\n</code></pre>\n\n<p>where <code>(f &gt;&gt;&gt; g) x = g (f x)</code>, or</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>tfoldl :: (b -&gt; a -&gt; b) -&gt; T a -&gt; b -&gt; b\ntfoldl f (Node x ts) z = Data.List.foldr (&gt;&gt;&gt;) id [tfoldl f t | t &lt;- ts] $ f z x\n                 -- // = tfoldl f tn (... (tfoldl f t2 (tfoldl f t1 (f z x))) ...)\n</code></pre>\n\n<p>which is  equivalent to the code at the start of this post, up to the order of arguments.</p>\n\n<ul>\n<li>see also: <a href=\"https://stackoverflow.com/q/52451923/849891\">Variations of folds on Haskell Trees</a></li>\n</ul>\n"}], "owner": {"reputation": 493, "user_id": 1250621, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gisqt.jpg?s=128&g=1", "display_name": "Luftzig", "link": "https://stackoverflow.com/users/1250621/luftzig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 492, "favorite_count": 0, "accepted_answer_id": 47580167, "answer_count": 2, "score": 4, "last_activity_date": 1552081350, "creation_date": 1512041527, "last_edit_date": 1512242940, "question_id": 47572451, "link": "https://stackoverflow.com/questions/47572451/map-an-arbitrary-n-ary-tree-with-fold", "title": "Map an arbitrary n-ary Tree with fold", "body": "<p>I want to have some general purpose tools for dealing with trees. I'm using JavaScript, so there's little I can impose, and I'm using existing data structures that I can't change. I managed to define the following:</p>\n\n<pre><code>reduceTree :: (T a -&gt; [T a]) -&gt; (b -&gt; T a -&gt; b) -&gt; b -&gt; T a -&gt; b\nreduceTree(getChildren, f, accumulator, tree)\n</code></pre>\n\n<p>(I'm using Haskell type signatures because they're easier to read)</p>\n\n<p>This <code>getChildren</code> function is required because my tree is arbitrary, and I know nothing about how it is constructed.</p>\n\n<p><code>reduceTree</code> works well. But I would like to have a <code>mapTree</code> function too, preferably reusing my <code>reduceTree</code> function, but I'm stuck. Something is amiss but I can't figure out what. </p>\n\n<h2>Edit</h2>\n\n<p>My <code>reduceTree</code> implementation:</p>\n\n<pre><code>export function reduceTree(getChildren, f, accumulator, tree) {\n  const children = getChildren(tree);\n  if (!children || children.length === 0) {\n    return f(accumulator, tree)\n  } else {\n    const childrenResult = children.reduce(\n      (accumulator, subTree) =&gt; reduceTree(getChildren, f, accumulator, subTree),\n      accumulator\n    );\n    return f(childrenResult, tree)\n  }\n}\n</code></pre>\n\n<p>It was tested and works.</p>\n\n<p>(My pseudo Haskell implementation I used to construct/prove the javascript above:</p>\n\n<pre><code>reduceTree f a (Node val []) = f a val\nreduceTree f a (Node val xs) = f (fold (reduceTree f) acc) val\n</code></pre>\n\n<p>)</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1512039566, "post_id": 47571696, "comment_id": 82100559, "body": "Not in Haskell, this is bascially how strings are escaped. A backslash is <code>&#39;\\\\&#39;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 321, "user_id": 2260430, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/UVI0j.jpg?s=128&g=1", "display_name": "l&#230;ran91", "link": "https://stackoverflow.com/users/2260430/l%c3%a6ran91"}, "edited": false, "score": 0, "creation_date": 1512040403, "post_id": 47571941, "comment_id": 82101073, "body": "oooh @willem Thank you so much.actually, I forgot to show my gratitude on your previous answer of my previous question forgive me for that.but your help meant me a lot.a big Thank you once again ..cheers :)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1512039939, "creation_date": 1512039939, "answer_id": 47571941, "question_id": 47571696, "link": "https://stackoverflow.com/questions/47571696/how-to-use-specialreserved-characters-in-haskell/47571941#47571941", "title": "how to use Special(reserved) characters in haskell?", "body": "<p>Short answer: use <strong><code>'\\\\'</code></strong>.</p>\n\n<p>Most programming languages use <a href=\"https://en.wikipedia.org/wiki/String_literal#Escape_sequences\" rel=\"noreferrer\"><strong><em>escape sequences</em></strong> [wiki]</a> to represent special characters, and use the backslash as the start of en escape sequence.</p>\n\n<p>The backslash character is then represented as an escaped backslash, so <strong><code>'\\\\'</code></strong>.</p>\n\n<p>Like the table in the Wikipedia article says:</p>\n\n<blockquote>\n<pre><code>Escape Sequence   Unicode   Literal Characters placed into string\n\\\\                U+005C    backslash (\\)\n</code></pre>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1512040327, "creation_date": 1512040327, "answer_id": 47572070, "question_id": 47571696, "link": "https://stackoverflow.com/questions/47571696/how-to-use-specialreserved-characters-in-haskell/47572070#47572070", "title": "how to use Special(reserved) characters in haskell?", "body": "<pre><code>Prelude&gt; putStrLn $ \"You can generate a backslash like this: \\\\ (escape sequence) or like this: \\x5c (Unicode identifier sequence) or like this: \" ++ [toEnum 92] ++ \" (Unicode code point).\"\nYou can generate a backslash like this: \\ (escape sequence) or like this: \\ (Unicode identifier sequence) or like this: \\ (Unicode code point).\n</code></pre>\n"}], "owner": {"reputation": 321, "user_id": 2260430, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/UVI0j.jpg?s=128&g=1", "display_name": "l&#230;ran91", "link": "https://stackoverflow.com/users/2260430/l%c3%a6ran91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 554, "favorite_count": 0, "accepted_answer_id": 47571941, "answer_count": 2, "score": 1, "last_activity_date": 1512040327, "creation_date": 1512039264, "question_id": 47571696, "link": "https://stackoverflow.com/questions/47571696/how-to-use-specialreserved-characters-in-haskell", "title": "how to use Special(reserved) characters in haskell?", "body": "<p>I am newbie to haskell.am trying to implement encryption for a given plain text to cipher.here below is my sample code</p>\n\n<pre><code>encryptChar :: Int -&gt; Char -&gt; Char\nencryptChar shift c\n             | canEncrypt c = chr(ord c + wrapshift)\n             | isUpper c = c\n            where wrapshift = let shift' = shift `mod` 26 \n                              in if (wraparound shift' c)\n                                 then shift'-26\n                                 else shift'\nencryptChar _ '0' = '*'\nencryptChar _ '1' = '\\''\nencryptChar _ '2' = '~'\nencryptChar _ '3' = '!'\nencryptChar _ '4' = '@'\nencryptChar _ '5' = '#'\nencryptChar _ '6' = '$'\nencryptChar _ '7' = '%'\nencryptChar _ '8' = '^'\nencryptChar _ '9' = '&amp;'\nencryptChar _ '?' = ' '\nencryptChar _ c = c\n</code></pre>\n\n<p>when my charecter contains a number it has to encrypt with special symbols for example in the above code when my character contains <code>1</code> it has to replace with <code>\\</code> which I found that it's reserved character in haskell.but how can I use these charecters to encrypt ?</p>\n"}, {"tags": ["haskell", "higher-order-functions"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1512037997, "creation_date": 1512037997, "answer_id": 47571263, "question_id": 47571066, "link": "https://stackoverflow.com/questions/47571066/anything-wrong-with-the-type-declaration/47571263#47571263", "title": "Anything wrong with the type declaration?", "body": "<p>Your signature is <strong>too broad</strong>. The predicate you have written is <code>== []</code>. Haskell can only check if two lists are equal, if the <em>elements</em> of the list can be checked as well. In the source code we see something like:</p>\n\n<pre><code>instance <b>Eq a =&gt;</b> Eq [a] where\n    ...</code></pre>\n\n<p>Yes, here we will never check the equality of two items, since we check with the empty list, but the compiler of course does not know that: it simply sees that in order to check whether two lists are equal, we need to be able to check if elements are equal.</p>\n\n<p>The <code>Num</code> typeclass does <em>not</em> imply that the type is also an <code>Eq</code> type. We can do two things here:</p>\n\n<ol>\n<li><p>add the <code>Eq</code> type constraint to the signature:</p>\n\n<pre><code>mapinc :: <b>(Eq a, </b>Num a<b>)</b> =&gt; [a] -&gt; [a]\nmapinc = unfold (==[]) ((+1).head) tail</code></pre></li>\n<li><p>more elegant: do not rely on the fact that we need to be able to compare elements, but use <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:null\" rel=\"noreferrer\"><strong><code>null :: [a] -&gt; Bool</code></strong></a> instead (a function that checks if the list is empty):</p>\n\n<pre><code>mapinc :: Num a =&gt; [a] -&gt; [a]\nmapinc = unfold <b>null</b> ((+1).head) tail</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 4283, "user_id": 5462608, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb8700e5129804fc324f2cc4dc4ccff?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Lee", "link": "https://stackoverflow.com/users/5462608/nick-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 47571263, "answer_count": 1, "score": 3, "last_activity_date": 1512037997, "creation_date": 1512037411, "question_id": 47571066, "link": "https://stackoverflow.com/questions/47571066/anything-wrong-with-the-type-declaration", "title": "Anything wrong with the type declaration?", "body": "<p>I am reading the book \"Programming in Haskell\". One exercise asks me to define <code>map f</code> using an higher-order function. I choose to define <code>map (+1)</code> like the following:</p>\n\n<pre><code>unfold p h t x | p x       = []\n               | otherwise = h x : unfold p h t (t x)\n\n-- equivalent to `map (+1)`\nmapinc = unfold (==[]) ((+1).head) tail\n</code></pre>\n\n<p>(Taken straight from the exercise question) The function <code>unfold p h t</code> produces the empty list if the predicate <code>p</code> is true of the argument value, and otherwise produces a non-empty list by applying the function <code>h</code> to this value to give the head, and the function <code>t</code> to generate another argument that is recursively processed in the same way to produce the tail of the list.</p>\n\n<p>I have checked my implementation of <code>mapinc</code> and it looks fine:</p>\n\n<pre><code>*Main&gt; mapinc [1,2,3]\n[2,3,4]\n</code></pre>\n\n<p>However, after I add the type declaration:</p>\n\n<pre><code>mapinc :: Num a =&gt; [a] -&gt; [a]\nmapinc = unfold (==[]) ((+1).head) tail\n</code></pre>\n\n<p>Then reload the script in WinGHCi, it gives the following error:</p>\n\n<pre><code>\u2022 Could not deduce (Eq a) arising from a use of \u2018==\u2019\n  from the context: Num a\n    bound by the type signature for:\n               mapinc :: forall a. Num a =&gt; [a] -&gt; [a]\n    at D:\\7a.hs:4:1-29\n  Possible fix:\n    add (Eq a) to the context of\n      the type signature for:\n        mapinc :: forall a. Num a =&gt; [a] -&gt; [a]\n\u2022 In the first argument of \u2018unfold\u2019, namely \u2018(== [])\u2019\n  In the expression: unfold (== []) ((+ 1) . head) tail\n  In an equation for \u2018mapinc\u2019:\n      mapinc = unfold (== []) ((+ 1) . head) tail\n  |\n5 | mapinc = unfold (==[]) ((+1).head) tail   |                  ^^^^\n</code></pre>\n\n<p><strong>Any clue why it happens?</strong></p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 911, "user_id": 3528539, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/76bcc5c6b40213c8bbee447308334cf4?s=128&d=identicon&r=PG&f=1", "display_name": "Asalle", "link": "https://stackoverflow.com/users/3528539/asalle"}, "is_accepted": false, "score": 1, "last_activity_date": 1512031729, "creation_date": 1512031729, "answer_id": 47569223, "question_id": 47569155, "link": "https://stackoverflow.com/questions/47569155/include-extensions-in-haskell-stack-conf-file/47569223#47569223", "title": "include extensions in haskell-stack conf file", "body": "<p><code>extensions:</code> is currently unsupported by stack, see follow-ups in this github <a href=\"https://github.com/commercialhaskell/stack/issues/3137\" rel=\"nofollow noreferrer\">issue</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 2082, "user_id": 2002580, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b2d16135241bda360d9fe3bfbfe08b0d?s=128&d=identicon&r=PG", "display_name": "BWStearns", "link": "https://stackoverflow.com/users/2002580/bwstearns"}, "edited": false, "score": 0, "creation_date": 1569182850, "post_id": 47569553, "comment_id": 102503944, "body": "When I do this I get <code>Unrecognized field in ProjectAndConfigMonoid: default-extensions</code>, Is there something I need to include to make that field valid?"}, {"owner": {"reputation": 1069, "user_id": 4299824, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LKWkrlvV9UE/AAAAAAAAAAI/AAAAAAAABYQ/OWKjHFpdGGs/photo.jpg?sz=128", "display_name": "YAMAMOTO Yuji", "link": "https://stackoverflow.com/users/4299824/yamamoto-yuji"}, "reply_to_user": {"reputation": 2082, "user_id": 2002580, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b2d16135241bda360d9fe3bfbfe08b0d?s=128&d=identicon&r=PG", "display_name": "BWStearns", "link": "https://stackoverflow.com/users/2002580/bwstearns"}, "edited": false, "score": 0, "creation_date": 1569367594, "post_id": 47569553, "comment_id": 102571818, "body": "I can&#39;t diagnose by that error message. Can you post a question with the entire content of package.yaml?"}], "tags": [], "owner": {"reputation": 1069, "user_id": 4299824, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LKWkrlvV9UE/AAAAAAAAAAI/AAAAAAAABYQ/OWKjHFpdGGs/photo.jpg?sz=128", "display_name": "YAMAMOTO Yuji", "link": "https://stackoverflow.com/users/4299824/yamamoto-yuji"}, "is_accepted": true, "score": 18, "last_activity_date": 1512032807, "creation_date": 1512032807, "answer_id": 47569553, "question_id": 47569155, "link": "https://stackoverflow.com/questions/47569155/include-extensions-in-haskell-stack-conf-file/47569553#47569553", "title": "include extensions in haskell-stack conf file", "body": "<p>Do not confuse stack with <a href=\"https://github.com/sol/hpack\" rel=\"noreferrer\">hpack</a>.</p>\n\n<p><code>package.yaml</code> is actually read by hpack.\nBut <code>stack build</code> command implicitly calls hpack to automatically convert into a cabal file, which may make you confused.</p>\n\n<p>Anyway, to specify extensions in package.yaml,\nuse <code>default-extensions</code>:</p>\n\n<pre><code>default-extensions: ViewPatterns\n</code></pre>\n"}], "owner": {"reputation": 911, "user_id": 3528539, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/76bcc5c6b40213c8bbee447308334cf4?s=128&d=identicon&r=PG&f=1", "display_name": "Asalle", "link": "https://stackoverflow.com/users/3528539/asalle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2600, "favorite_count": 0, "accepted_answer_id": 47569553, "answer_count": 2, "score": 10, "last_activity_date": 1512047488, "creation_date": 1512031479, "last_edit_date": 1512047488, "question_id": 47569155, "link": "https://stackoverflow.com/questions/47569155/include-extensions-in-haskell-stack-conf-file", "title": "include extensions in haskell-stack conf file", "body": "<p>I want to add ViewPatterns extensions to my build and currently I do it by adding the following lines to package.yaml</p>\n\n<pre><code>ghc-options:\n- -Wall\n- -XViewPatterns\n</code></pre>\n\n<p>I get a warning:</p>\n\n<pre><code>Warning: Instead of 'ghc-options: -XViewPatterns' use 'extensions:\nViewPatterns'\n</code></pre>\n\n<p>But, when I add an <code>extensions</code> field to package.yaml, I get the following:</p>\n\n<pre><code>WARNING: Ignoring unknown field \"extensions\" in package description\n</code></pre>\n\n<p>Also, I could not find any definition of <code>extensions</code> in the official stack documentation.</p>\n"}, {"tags": ["haskell", "recursion", "out-of-memory"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1512031092, "post_id": 47568199, "comment_id": 82095532, "body": "<code>seq</code> may not help because it only forces WHNF, you may want to try <code>deepseq</code>. At least for me it makes <code>ghci</code> run this function in apparently constant memory (I didn&#39;t wait for the function to finish)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1512078944, "post_id": 47568199, "comment_id": 82124060, "body": "I haven&#39;t really analyzed this, but you might try <code>otherwise = case a_cards of {hd:tl -&gt; let result1 = ...}</code>. That way, you&#39;re sure to actually take the list apart as you go rather than building a bunch of thunks to do so. Also, you may find it helpful to use a custom &quot;strict pair&quot; type rather than <code>(Int, Int)</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512082342, "post_id": 47568199, "comment_id": 82125540, "body": "Have you tried <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html\" rel=\"nofollow noreferrer\">profiling</a>?"}], "owner": {"reputation": 41, "user_id": 8064494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cd9f057e367fd620a7b8edb0e9aa998?s=128&d=identicon&r=PG&f=1", "display_name": "vamsikal", "link": "https://stackoverflow.com/users/8064494/vamsikal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1512027537, "creation_date": 1512027537, "question_id": 47568199, "link": "https://stackoverflow.com/questions/47568199/haskell-tree-recursion-out-of-memory", "title": "Haskell - Tree Recursion - Out Of Memory", "body": "<p>The following code with any real-logic \"hollowed out\" still runs out of memory when compiled on GHC 7.10.3 with the -O flag. I do not understand why a simple tree recursion with at-most a stack-depth of 52 (number of cards in a standard deck) needs so much memory. I tried using <code>seq</code> on the result variables, but that did not help. Could someone take a look and let me know why the memory usage is so high, and what can I do to avoid it?</p>\n\n<pre><code>import qualified Data.Map.Strict as M\n\ntype Card = (Int, Char)\n\ncompute_rank_multiplicity_map :: [Card] -&gt; M.Map Int Int\ncompute_rank_multiplicity_map cards = M.fromList [(x, x) | (x, _) &lt;- cards]\n\ndetermine_hand :: [Card] -&gt; (Int, [(Int, Int)])\ndetermine_hand [] = error \"Card list is empty!\"\ndetermine_hand cards = (0, mult_rank_desc_list)\n  where rank_mult_map = compute_rank_multiplicity_map cards\n        mult_rank_desc_list = M.toDescList rank_mult_map\n\ncheck_kicker_logic :: [Card] -&gt; (Int, Int)\ncheck_kicker_logic cards =\n  let first_cards = take 5 cards\n      second_cards = drop 5 cards\n      first_hand@(f_h, f_mrdl) = determine_hand first_cards\n      second_hand@(s_h, s_mrdl) = determine_hand second_cards\n  in if (first_hand &gt; second_hand) || (first_hand &lt; second_hand) -- is there a clear winner?\n     then if (f_h == s_h) &amp;&amp; (head f_mrdl) == (head s_mrdl) -- do we need kicker logic?\n          then (1, 1)\n          else (0, 1)\n     else (0, 0)\n\ncard_deck :: [Card]\ncard_deck = [(r, s) | r &lt;- [2 .. 14], s &lt;- ['C', 'D', 'H', 'S']]\n\nneed_kicker_logic :: [Card] -&gt; (Int, Int)\nneed_kicker_logic cards = visit_subset cards (length cards) [] 0 (0, 0)\n  where visit_subset a_cards num_a_cards picked_cards num_picked_cards result@(num_kicker_logic, num_clear_winners)\n          | num_cards_needed == 0 = (num_kicker_logic + nkl, num_clear_winners + ncw)\n          | num_cards_needed &gt; num_a_cards = result\n          | otherwise = let result_1 = visit_subset (tail a_cards)\n                                                    (num_a_cards - 1)\n                                                    picked_cards\n                                                    num_picked_cards\n                                                    result\n                            result_2 = visit_subset (tail a_cards)\n                                                    (num_a_cards - 1)\n                                                    ((head a_cards) : picked_cards)\n                                                    (num_picked_cards + 1)\n                                                    result_1\n                        in result_2\n          where num_cards_needed = 10 - num_picked_cards\n                (nkl, ncw) = check_kicker_logic picked_cards\n\n\nmain :: IO ()\nmain =\n  do\n    putStrLn $ show $ need_kicker_logic card_deck\n</code></pre>\n"}, {"tags": ["haskell", "type-signature"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1512026084, "post_id": 47567805, "comment_id": 82093073, "body": "<code>(Int -&gt; Int -&gt; Int)</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "is_accepted": false, "score": 5, "last_activity_date": 1512026291, "creation_date": 1512026291, "answer_id": 47567880, "question_id": 47567805, "link": "https://stackoverflow.com/questions/47567805/how-to-define-the-functions-type-signature/47567880#47567880", "title": "How to define the function&#39;s type signature?", "body": "<p><code>multiply</code> is of type <code>Int -&gt; Int -&gt; Int</code>, so <code>doWithFunctionArg</code> is of type</p>\n\n<pre><code>-- typeof(multiply) -&gt; Int -&gt; Int -&gt; Int\n(Int -&gt; Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Int\n</code></pre>\n\n<p>Actually you can call ghci for help:</p>\n\n<pre><code>Prelude&gt; doWithFunctionArg f a b = f a b\nPrelude&gt; :t doWithFunctionArg\ndoWithFunctionArg :: (t2 -&gt; t1 -&gt; t) -&gt; t2 -&gt; t1 -&gt; t\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1512030325, "creation_date": 1512030325, "answer_id": 47568874, "question_id": 47567805, "link": "https://stackoverflow.com/questions/47567805/how-to-define-the-functions-type-signature/47568874#47568874", "title": "How to define the function&#39;s type signature?", "body": "<p>As delta points out above, you can omit the type signature and then ask GHC to infer it.</p>\n\n<p>You can also leave your type signature where it is, and only replace your unknown <code>?</code> with a type wildcard <code>_</code>. When GHC meets with <code>_</code> in a type, it will try to infer only that, in the context of the rest of the type signature, producing an error with the inferred type.</p>\n\n<p>Here's a GHCi demo:</p>\n\n<pre><code>&gt; doWithFunctionArg :: _ -&gt; Int -&gt; Int -&gt; Int ; doWithFunctionArg f a b = f a b\n\n&lt;interactive&gt;:7:22: error:\n    \u2022 Found type wildcard \u2018_\u2019 standing for \u2018Int -&gt; Int -&gt; Int\u2019\n      To use the inferred type, enable PartialTypeSignatures\n    \u2022 In the type signature:\n        doWithFunctionArg :: _ -&gt; Int -&gt; Int -&gt; Int\n    \u2022 Relevant bindings include\n        doWithFunctionArg :: (Int -&gt; Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Int\n          (bound at &lt;interactive&gt;:7:47)\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 9018650, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/38270f480b97b98be067cae9564c8542?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff Yan", "link": "https://stackoverflow.com/users/9018650/jeff-yan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1512030325, "creation_date": 1512025954, "last_edit_date": 1512029265, "question_id": 47567805, "link": "https://stackoverflow.com/questions/47567805/how-to-define-the-functions-type-signature", "title": "How to define the function&#39;s type signature?", "body": "<pre><code>doWithFunctionArg :: ? -&gt; Int -&gt; Int -&gt; Int \ndoWithFunctionArg f a b = f a b\n\nmultiply :: Int -&gt; Int -&gt; Int\nmultiply a b = a * b\n\nmain = do\n    print $ doWithFunctionArg mutiple 7 8\n</code></pre>\n\n<p>I'm not sure what is the function's type signature. <code>multiply :: Int -&gt; Int -&gt; Int</code> is the function's type signature for the multiply function right? If yes, how can I write the type signature for the function <code>doWithFunctionArg</code>? <code>doWithFunctionArg</code> function has three arguments, \"f\" is the function type, \"a\" and \"b\" are <code>Int</code>, the result should be the <code>Int</code>. If I'm right, what should I write in \"?\"</p>\n"}, {"tags": ["haskell", "logging", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 829, "user_id": 640078, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/01e5b91ad42c7d309b09d6ae8991a32c?s=128&d=identicon&r=PG", "display_name": "rprospero", "link": "https://stackoverflow.com/users/640078/rprospero"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1512133552, "post_id": 47574977, "comment_id": 82145279, "body": "@dfeuer I&#39;m not happy about it, either.  What really needs to happen is that Snoyman needs to add an instance (MonadLogger m, MonadTrans t) =&gt; MonadLogger (t m) with the code given above.  MonadLogger already depends on Mtl and Proxy is already a MonadTrans, so everything else would be taken care of.  Until that happens, though, they&#39;re either going to have to deal with an evil orphan instance or put up with the lifts that they asked the question specifically to avoid."}, {"owner": {"reputation": 829, "user_id": 640078, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/01e5b91ad42c7d309b09d6ae8991a32c?s=128&d=identicon&r=PG", "display_name": "rprospero", "link": "https://stackoverflow.com/users/640078/rprospero"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1512133952, "post_id": 47574977, "comment_id": 82145520, "body": "Looking again at the MonadLogger code, there does seem to be some MonadTrans options in there, which makes me wonder if there&#39;s somehow a better answer?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1512160079, "post_id": 47574977, "comment_id": 82160635, "body": "The ultra-general instance you described doesn&#39;t work. If you look at the instances for the standard transformers, you&#39;ll find that they all define <code>localLogger</code> somewhat differently. The <code>ContT</code> instance is particularly strange, as usual, but the rest are specialized as well."}], "tags": [], "owner": {"reputation": 829, "user_id": 640078, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/01e5b91ad42c7d309b09d6ae8991a32c?s=128&d=identicon&r=PG", "display_name": "rprospero", "link": "https://stackoverflow.com/users/640078/rprospero"}, "is_accepted": true, "score": 1, "last_activity_date": 1512049536, "creation_date": 1512049536, "answer_id": 47574977, "question_id": 47566940, "link": "https://stackoverflow.com/questions/47566940/why-do-i-need-to-lift-when-using-monadlog-with-pipes/47574977#47574977", "title": "Why do I need to lift when using MonadLog with Pipes", "body": "<p>The problem is that the types in <code>pipes</code> aren't instances of <code>MonadLog</code>.  In <code>testApp</code>, you've declared</p>\n\n<pre><code>(MonadLog (WithSeverity Doc) m) =&gt; m ()\n</code></pre>\n\n<p>So we are in an instance of <code>MonadLog</code>.  Comparatively, for <code>readInputMessage</code>, you've declared</p>\n\n<pre><code>(MonadLog (WithSeverity Doc) m) =&gt; Producer Text m ()\n</code></pre>\n\n<p>So the type <code>m</code> is an instance of <code>MonadLog</code>, but we're not <em>in</em> type <code>m ()</code>.  We're in type <code>Producer Text m ()</code>.  Using <code>lift</code> then takes us into the <code>m</code> monad, which is what you've observed.</p>\n\n<p>The solution is to make the Pipes types members of <code>MonadLog</code> when it's inner monad is.  If you're willing to put up with orphan instances, you can write something similar to the code below.</p>\n\n<pre><code>instance (MonadLog m) =&gt; MonadLog Proxy a' a b' b m r  where\n    askLogger = lift askLogger\n    localLogger f = lift  . localLogger x\n</code></pre>\n\n<p>This <em>should</em> allow you to use <code>MonadLog</code> in any of the Pipes types as long as the inner monad is also a <code>MonadLog</code>.</p>\n"}], "owner": {"reputation": 25, "user_id": 7078147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5e8421e354aeb886b924b7bca364970?s=128&d=identicon&r=PG&f=1", "display_name": "filterfish", "link": "https://stackoverflow.com/users/7078147/filterfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 47574977, "answer_count": 1, "score": 1, "last_activity_date": 1512049536, "creation_date": 1512022277, "question_id": 47566940, "link": "https://stackoverflow.com/questions/47566940/why-do-i-need-to-lift-when-using-monadlog-with-pipes", "title": "Why do I need to lift when using MonadLog with Pipes", "body": "<p>I'm trying to get <code>logging-error</code> working with <code>pipes</code>. I'm nearly there\u2014in the sense that I have something working\u2014but I don't think it's quite right and I don't know how to fix it. The code:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts  #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE NoImplicitPrelude #-}\n{-# LANGUAGE PartialTypeSignatures #-}\n\nmodule Main where\n\nimport           Protolude hiding ((&lt;&gt;), empty, for, get)\n\nimport           Control.Monad.Log\nimport           Text.PrettyPrint.Leijen.Text\n\nimport           Pipes\n\n\ntestApp :: (MonadIO m, MonadLog (WithSeverity Doc) m) =&gt; m ()\ntestApp = logInfo $ textStrict \"Logging works. Yah!\"\n\n\nprintMessage :: (MonadIO m, MonadLog (WithSeverity Doc) m) =&gt; Consumer Text m ()\nprintMessage = forever $ await &gt;&gt;= putStrLn\n\n\nreadInputMessage :: (MonadIO m, MonadLog (WithSeverity Doc) m) =&gt; Producer Text m ()\nreadInputMessage = forever action      \n  where\n    action = do\n      liftIO $ putStr (\"&gt; \" :: Text)\n      liftIO getLine &gt;&gt;= yield\n      lift $ logInfo $ text \"Waits with abated breath\"\n\n\nrunMyLogging :: MonadIO m =&gt; LoggingT (WithSeverity Doc) m a -&gt; m a\nrunMyLogging f = runLoggingT f (print . renderWithSeverity identity)\n\n\nrunPipesApp :: IO ()\nrunPipesApp = runMyLogging $ runEffect $\n        readInputMessage\n    &gt;-&gt; printMessage\n\n\nrunTestApp :: IO ()\nrunTestApp = runMyLogging testApp\n\n\nmain :: IO ()\nmain = do\n  runTestApp\n  runPipesApp\n</code></pre>\n\n<p>In <code>readInputMessage</code> I need to <code>lift</code> <code>logInfo</code> otherwise it won't compile. However <code>testApp</code> <code>logInfo</code> dosen't need to be lift'ed. Why do I need to lift in one but not the other?</p>\n\n<p>Without <code>lift</code> this is the compilation error:</p>\n\n<pre><code>/home/rgh/dev/haskell/fa-logging/app/Main.hs:29:7: error:\n    \u2022 Could not deduce (MonadLog\n                          (WithSeverity Doc) (Pipes.Proxy X () () Text m))\n        arising from a use of \u2018logInfo\u2019\n      from the context: (MonadIO m, MonadLog (WithSeverity Doc) m)\n        bound by the type signature for:\n                   readInputMessage :: forall (m :: * -&gt; *).\n                                       (MonadIO m, MonadLog (WithSeverity Doc) m) =&gt;\n                                       Producer Text m ()\n        at app/Main.hs:23:1-84\n    \u2022 In a stmt of a 'do' block:\n        logInfo $ text \"Waits with abated breath\"\n      In the expression:\n        do liftIO $ putStr (\"&gt; \" :: Text)\n           liftIO getLine &gt;&gt;= yield\n           logInfo $ text \"Waits with abated breath\"\n      In an equation for \u2018action\u2019:\n          action\n            = do liftIO $ putStr (\"&gt; \" :: Text)\n                 liftIO getLine &gt;&gt;= yield\n                 logInfo $ text \"Waits with abated breath\"\n   |\n29 |       logInfo $ text \"Waits with abated breath\"\n   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n--  While building package fa-logging-0.0.0 using:\n      /srv/cache/rgh/.stack/setup-exe-cache/x86_64-linux-nopie/Cabal-simple_mPHDZzAJ_2.0.0.2_ghc-8.2.1 --builddir=.stack-work/dist/x86_64-linux-nopie/Cabal-2.0.0.2 build lib:fa-logging exe:fa-logging --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>I <em>think</em> it's not compiling because the compiler can't work out what type <code>m</code> is but I don't know how to fix it.</p>\n"}, {"tags": ["parsing", "haskell", "scheme", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "is_accepted": true, "score": 3, "last_activity_date": 1512018879, "creation_date": 1512018879, "answer_id": 47566344, "question_id": 47566098, "link": "https://stackoverflow.com/questions/47566098/parsing-scheme-dottedlist-list-with-haskell/47566344#47566344", "title": "Parsing scheme dottedlist/list with Haskell", "body": "<p>The <code>sepBy</code> parser is seeing the space before the dot, and committing to parse another expression, which fails.</p>\n\n<p>You should have lexemes consume and discard trailing spaces (see parsec's <code>lexeme</code>) and change the <code>sepBy</code> to just <code>many1</code>.  The <code>optionMaybe</code> can then commit after seeing a dot, which would otherwise have required a <code>try</code>.</p>\n"}], "owner": {"reputation": 313, "user_id": 3219382, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ABhji.jpg?s=128&g=1", "display_name": "chronologos", "link": "https://stackoverflow.com/users/3219382/chronologos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 47566344, "answer_count": 1, "score": 2, "last_activity_date": 1512063414, "creation_date": 1512017402, "last_edit_date": 1512063414, "question_id": 47566098, "link": "https://stackoverflow.com/questions/47566098/parsing-scheme-dottedlist-list-with-haskell", "title": "Parsing scheme dottedlist/list with Haskell", "body": "<p>I am following <a href=\"https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours/Parsing%20this%20guide\" rel=\"nofollow noreferrer\">this guide</a> on writing a scheme interpreter. In trying to left-factor the grammar for DottedList/List, I came up with this:</p>\n\n<pre><code>E -&gt; (H T)\nH -&gt; E H'\nH' -&gt; &lt;space&gt; H\nH' -&gt; &lt;term&gt;\nT -&gt;  &lt;term&gt;\nT -&gt; &lt;space&gt; . &lt;space&gt; E\n</code></pre>\n\n<p>--</p>\n\n<pre><code>spaces :: Parser ()\nspaces = skipMany1 (space &lt;?&gt; \"spaces\")\n\nparseExpr :: Parser LispVal\nparseExpr = (... omitted ...) &lt;|&gt;\n             do char '('\n                h &lt;- sepBy parseExpr spaces\n                t &lt;- optionMaybe ((spaces' &gt;&gt; char '.' &gt;&gt; spaces' &gt;&gt; parseExpr)  &lt;?&gt; \"parseDotExpr failed\")\n                z &lt;- if isJust t then return $ DottedSuffix $ fromJust t else return Tail\n                z' &lt;- case z of Tail           -&gt; return $ List x\n                                DottedSuffix s -&gt; return $ DottedList x s\n                char ')'\n                return z'\n</code></pre>\n\n<p>Unfortunately this doesn't handle the basic dottedlists:</p>\n\n<pre><code>test/Spec.hs:23: \n1) test eval 1 evals DottedList\n     expected: \"(1 2 . 1)\"\n      but got: \"Parse error at \\\"lisp\\\" (line 1, column 7):\\nunexpected \\\".\\\"\\nexpecting spaces' or parseExpr!\"\n\ntest/Spec.hs:26: \n2) test eval 1 evals DottedList (quoted)\n     expected: \"((1 2) . 1)\"\n      but got: \"Parse error at \\\"lisp\\\" (line 1, column 15):\\nunexpected \\\".\\\"\\nexpecting spaces' or parseExpr!\"\n\ntest/Spec.hs:29: \n3) test eval 1 evals DottedList (sugared)\n     expected: \"((1 2) . 1)\"\n      but got: \"Parse error at \\\"lisp\\\" (line 1, column 9):\\nunexpected \\\".\\\"\\nexpecting spaces' or parseExpr!\"\n</code></pre>\n\n<p>Update:\nFrom @pat's response, I got my tests to pass using:</p>\n\n<pre><code>parseExpr :: Parser LispVal\nparseExpr = {- omitted -}\n         &lt;|&gt; do char '('\n                x &lt;- many1 (do e &lt;- parseExpr; spaces'; return e)\n               {- omitted -}\n</code></pre>\n"}, {"tags": ["haskell", "singleton-type", "vinyl"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512008070, "post_id": 47564757, "comment_id": 82087665, "body": "The definition of the pattern synonym seems fine; it&#39;s type is wrong. The types of pattern synonyms are not really types at all (in particular, pattern synonym type annotations must specify which constraints are proved by matching on the pattern - your type definition says <i>no</i> constraints are proved, but the inlined pattern match is a GADT; by pattern matching on it you prove <code>rs1 ~ &#39;[ x :-&gt; xs ]</code> for some <code>x, xs</code>). A description of pattern synonym type annotations is given <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#typing-of-pattern-synonyms\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512010468, "post_id": 47564757, "comment_id": 82088244, "body": "Thank you; that link is very enlightening. I&#39;m still having a hard time figuring out what proved constraint I need to add in this case, however. rs1 doesn&#39;t appear anywhere in the pattern declaration so adding <code>rs1 ~ &#39;[ x :-&gt; xs ]</code> doesn&#39;t constrain anything."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512011707, "post_id": 47564757, "comment_id": 82088595, "body": "I was referring to the <code>rs1</code> in the type of <code>f</code> - indeed, the appropriate change would add a new variable to the pattern signature. I believe something like <code>() =&gt; (rs ~ &#39;[s :-&gt; t]) =&gt; Sing s -&gt; Sing t -&gt; SList rs</code> should work (but I can&#39;t compile the example myself to make sure)."}, {"owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512014343, "post_id": 47564757, "comment_id": 82089207, "body": "That did it! I&#39;m still not really clear on why my original type signature doesn&#39;t imply the new constraint. Anyway, if you want to lift your comment into an answer, I will accept it. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 2, "last_activity_date": 1512059890, "creation_date": 1512059890, "answer_id": 47578307, "question_id": 47564757, "link": "https://stackoverflow.com/questions/47564757/pattern-synonym-binds-differently-from-normal-pattern/47578307#47578307", "title": "Pattern synonym binds differently from normal pattern", "body": "<p>The definition of the pattern synonym is correct; it is the type which is wrong. The correct type is</p>\n\n<pre><code>pattern OnlyRecord :: () =&gt; (rs ~ '[s :-&gt; t]) =&gt; Sing s -&gt; Sing t -&gt; SList rs\npattern OnlyRecord ...\n</code></pre>\n\n<p>With your original pattern type signature (which is equivalent to <code>() =&gt; () =&gt; Sing s -&gt; Sing t -&gt; SList '[s :-&gt; t]</code>), you are claiming that given an expression <code>x :: SList '[s :-&gt; t]</code> you can match on this expression using your pattern synonym. However, in <code>f</code>, you don't have such an expression - you only have <code>x :: SList rs1</code> for some <code>rs1</code>, which is strictly more general. With the correct signature, you can use the pattern synonym to match on such an expression, because the pattern synonym is declared to be applicable to any <code>SList rs</code>; and then the <em>provided constraints</em> (namely <code>rs ~ '[s :-&gt; t]</code>) are available within the scope of the pattern match.</p>\n\n<p>For additional details regarding pattern signatures, see the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#typing-of-pattern-synonyms\" rel=\"nofollow noreferrer\">GHC user guide</a>.</p>\n"}], "owner": {"reputation": 687, "user_id": 1663294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/1f1f15839995e207042345b821855528?s=128&d=identicon&r=PG", "display_name": "RichardW", "link": "https://stackoverflow.com/users/1663294/richardw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 47578307, "answer_count": 1, "score": 2, "last_activity_date": 1512059890, "creation_date": 1512007455, "question_id": 47564757, "link": "https://stackoverflow.com/questions/47564757/pattern-synonym-binds-differently-from-normal-pattern", "title": "Pattern synonym binds differently from normal pattern", "body": "<p>The function f does not type check in the following code, which uses singletons with Frames and Vinyl:</p>\n\n<pre><code>f :: forall rs1 rs2.  SList rs1 -&gt; Frame (Record rs1) -&gt; Int\nf (OnlyRecord s1 t1) df1 = broadcast (*) (rhead &lt;$&gt; df1)\n\npattern OnlyRecord :: Sing s -&gt; Sing t -&gt; SList '[s :-&gt; t]\npattern OnlyRecord sym typsing = SCons (SRecArrow sym typsing) SNil\n\nrhead :: Record ((s :-&gt; t) ': sstt) -&gt; t\nrhead (x :&amp; xs) = getCol $ getIdentity x\n\ndata instance Sing (a :: Type) where\n    SRecArrow :: Sing (s :: Symbol) -&gt; Sing (t :: Type) -&gt; Sing (s :-&gt; t)\n</code></pre>\n\n<p>The error is <code>Couldn't match type \u2018rs1\u2019 with \u2018'[s2 :-&gt; t1]</code> in the call to rhead -- basically it seems as if the pattern match is not binding the structure of rs1 as I would expect.  But if I inline the pattern, it type checks:</p>\n\n<pre><code>f' :: forall rs1 rs2.  SList rs1 -&gt; Frame (Record rs1) -&gt; Int\nf' (SCons (SRecArrow s1 t1) SNil) df1 = broadcast (*) (rhead &lt;$&gt; df1)\n</code></pre>\n\n<p>Given the pattern synonym is supposed to be, well, a synonym, shouldn't it work identically to the inline pattern?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512007575, "post_id": 47564655, "comment_id": 82087549, "body": "<code>(&gt;&gt;=) :: Monad (m n) =&gt; m n a -&gt; (a -&gt; m n b) -&gt; m n b</code> is valid (<code>m</code> cannot be a Monad here because it has the wrong kind)."}, {"owner": {"reputation": 35, "user_id": 2065062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f63eaeae434580dee1ddc82a3faf02c3?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/2065062/max"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512007924, "post_id": 47564655, "comment_id": 82087641, "body": "I have: <code>type TargetClient = ReaderT TargetClientChannels IO</code> and <code>type MethodResult a = Either ResponseError a</code>. I also have functions <code>a -&gt; TargetClient (MethodResult a)</code>. How can I connect them?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1512008474, "post_id": 47564655, "comment_id": 82087756, "body": "Why not write a question describing this actual problem in detail? As it stands, I fail to see what you mean by &quot;connect them&quot; (connect how? what are the desired semantics? etc.)"}, {"owner": {"reputation": 2139, "user_id": 116198, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HgA1y.png?s=128&g=1", "display_name": "Chris R. Timmons", "link": "https://stackoverflow.com/users/116198/chris-r-timmons"}, "edited": false, "score": 0, "creation_date": 1512008559, "post_id": 47564655, "comment_id": 82087776, "body": "Perhaps monad transformers are what you&#39;re looking for?  (<a href=\"http://book.realworldhaskell.org/read/monad-transformers.html\" rel=\"nofollow noreferrer\">Here</a> and <a href=\"http://dev.stephendiehl.com/hask/#monad-transformers\" rel=\"nofollow noreferrer\">here</a>)."}, {"owner": {"reputation": 35, "user_id": 2065062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f63eaeae434580dee1ddc82a3faf02c3?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/2065062/max"}, "edited": false, "score": 0, "creation_date": 1512008680, "post_id": 47564655, "comment_id": 82087804, "body": "Result of function <code>a -&gt; TargetClient (MethodResult a)</code> transfer to the next  <code>a -&gt; TargetClient (MethodResult a)</code> whithout do notation and <code>case of</code>s"}, {"owner": {"reputation": 35, "user_id": 2065062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f63eaeae434580dee1ddc82a3faf02c3?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/2065062/max"}, "reply_to_user": {"reputation": 2139, "user_id": 116198, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HgA1y.png?s=128&g=1", "display_name": "Chris R. Timmons", "link": "https://stackoverflow.com/users/116198/chris-r-timmons"}, "edited": false, "score": 0, "creation_date": 1512008792, "post_id": 47564655, "comment_id": 82087827, "body": "@Chris: May be, but I do not know how to do it."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1512010687, "post_id": 47564655, "comment_id": 82088312, "body": "Did you mean <code>(&gt;&gt;=) :: m (n a) -&gt; (a -&gt; m (n b)) -&gt; m (n b)</code>?"}, {"owner": {"reputation": 35, "user_id": 2065062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f63eaeae434580dee1ddc82a3faf02c3?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/2065062/max"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1512011092, "post_id": 47564655, "comment_id": 82088427, "body": "@PyRulez: Yes, apparently I did not write the correct."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1512011229, "post_id": 47564655, "comment_id": 82088471, "body": "@Max There is no general solution for arbitrary <code>m</code> and <code>n</code>, but for specific <code>m</code> and <code>n</code> there might be a solution. It also depends on what you want <code>&gt;&gt;=</code> to do, since otherwise <code>a &gt;&gt;= f = undefined</code> works fine."}, {"owner": {"reputation": 35, "user_id": 2065062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f63eaeae434580dee1ddc82a3faf02c3?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/2065062/max"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1512011497, "post_id": 47564655, "comment_id": 82088541, "body": "@PyRulez: Do I need to create custom method for my types? It&#39;s a pity!"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1512014069, "post_id": 47564655, "comment_id": 82089132, "body": "@Max you could combine them into one big monad."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1512061986, "post_id": 47564655, "comment_id": 82114978, "body": "If you could find a general solution for arbitrary m and n, wouldn&#39;t monads compose then?"}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 2065062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f63eaeae434580dee1ddc82a3faf02c3?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/2065062/max"}, "edited": false, "score": 0, "creation_date": 1512059750, "post_id": 47576056, "comment_id": 82113568, "body": "I again was inattentive. My functions have a semantics such as <code>a -&gt; TargetClient (MethodResult b)</code>, <code>b -&gt; TargetClient (MethodResult c)</code>, etc."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 35, "user_id": 2065062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f63eaeae434580dee1ddc82a3faf02c3?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/2065062/max"}, "edited": false, "score": 0, "creation_date": 1512060283, "post_id": 47576056, "comment_id": 82113886, "body": "@Max That shouldn&#39;t make any difference. See updated answer."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 0, "last_activity_date": 1512060268, "last_edit_date": 1512060268, "creation_date": 1512052908, "answer_id": 47576056, "question_id": 47564655, "link": "https://stackoverflow.com/questions/47564655/haskell-monad-into-monad/47576056#47576056", "title": "Haskell monad into monad", "body": "<p>As PyRulez writes, there's no general solution for this, but given the types you report, something like the following should work.</p>\n\n<p>You're going to need</p>\n\n<pre><code>import Control.Monad (join)\n</code></pre>\n\n<p>Using <code>do</code> notation, you can compose two functions, <code>foo</code> and <code>bar</code>, like this:</p>\n\n<pre><code>comp :: (a -&gt; TargetClient (MethodResult b)) -&gt;\n        (b -&gt; TargetClient (MethodResult c)) -&gt;\n         a -&gt; TargetClient (MethodResult c)\ncomp foo bar x = do\n  f &lt;- foo x\n  b &lt;- join &lt;$&gt; traverse bar f\n  return b\n</code></pre>\n\n<p>If you don't like the <code>do</code> notation, you can reduce it all to this:</p>\n\n<pre><code>comp' :: (a -&gt; TargetClient (MethodResult b)) -&gt;\n         (b -&gt; TargetClient (MethodResult c)) -&gt;\n          a -&gt; TargetClient (MethodResult c)\ncomp' foo bar x = foo x &gt;&gt;= fmap join . traverse bar\n</code></pre>\n\n<p>When you map <code>f</code> with <code>bar</code>, you'll get the monads stacked in the wrong order, so to speak, but you can use <code>traverse</code> to switch the stack. Even when you do that, you'll have an <code>Either</code> in an <code>Either</code>, so that's the reason you need <code>join</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "is_accepted": false, "score": 0, "last_activity_date": 1512060796, "creation_date": 1512060796, "answer_id": 47578594, "question_id": 47564655, "link": "https://stackoverflow.com/questions/47564655/haskell-monad-into-monad/47578594#47578594", "title": "Haskell monad into monad", "body": "<p>If both <code>m</code> and <code>n</code> are monads, you need an additional piece to make the composite <code>m.n</code> a monad as well.</p>\n\n<p>What is required is a \"distributive law\", that is a natural morphism \n<code>forall a . n(m a) -&gt; m(n a)</code>  (see <a href=\"https://en.wikipedia.org/wiki/Distributive_law_between_monads\" rel=\"nofollow noreferrer\">here</a> it comes from Beck and is also used in Street)</p>\n\n<p>It then becomes easy to write the missing piece and verify it satisfies the monad laws.</p>\n"}], "owner": {"reputation": 35, "user_id": 2065062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f63eaeae434580dee1ddc82a3faf02c3?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/2065062/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 47576056, "answer_count": 2, "score": 1, "last_activity_date": 1512060796, "creation_date": 1512006723, "last_edit_date": 1512020216, "question_id": 47564655, "link": "https://stackoverflow.com/questions/47564655/haskell-monad-into-monad", "title": "Haskell monad into monad", "body": "<p>There are method <code>(&gt;&gt;=) :: forall a b. m a -&gt; (a -&gt; m b) -&gt; m b</code>.\nHow can i make method <code>:: forall a b. m (n a) -&gt; (a -&gt; m (n b)) -&gt; m (n b)</code> where m and n is monads.</p>\n"}, {"tags": ["haskell", "lambda", "numbers", "church-encoding"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1512002276, "post_id": 47563925, "comment_id": 82086233, "body": "What exactly are you asking? This seems like more of a question for <a href=\"https://cs.stackexchange.com/\">CS.SE</a>, and has not very much to do with Haskell."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1512006105, "post_id": 47563925, "comment_id": 82087235, "body": "<code>churchTwo churchTwo</code> typechecks because <code>(a -&gt; a) -&gt; (a -&gt; a)</code> unifies with <code>b -&gt; b</code> (in particular by the unifier <code>b ~ (a -&gt; a)</code>). As it stands, this question is too broad, because the concept of an &quot;easy&quot; or &quot;difficult&quot; deduction is largely subjective. Each of the implementations of the three functions is deduced from its desired equational properties (for exponentiation, they are <code>x^0=1</code> and <code>x^(1+k)=x*x^k</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 3, "last_activity_date": 1512017560, "creation_date": 1512017560, "answer_id": 47566130, "question_id": 47563925, "link": "https://stackoverflow.com/questions/47563925/church-naturals-exponentiation-function-and-type-checking/47566130#47566130", "title": "Church naturals, exponentiation function and type checking", "body": "<p>Your <code>exp</code> is a bit backwards:</p>\n\n<pre><code>((\\f x -&gt; f$f$f$x) `exp` (\\f x -&gt; f$f$x)) (+1) 0 == 8\n--      3            ^          2                 = 8???\n-- But 2^3 = 8\n</code></pre>\n\n<p>The correct(-er-ish) version would be</p>\n\n<pre><code>exp n m = m n\n((\\f x -&gt; f$f$f$x) `exp` (\\f x -&gt; f$f$x)) (+1) 0 == 9\n--      3            ^          2                 = 9\n</code></pre>\n\n<p>because it maintains the familiar order. This doesn't really affect how you might go around defining <code>exp</code>.</p>\n\n<hr/>\n\n<p>Exponentation is repeated multiplication: <code>n<sup>m</sup></code> is <code>n</code> multiplied by itself <code>m</code> times. Church numerals represent repeated application of a function to a value. So, <code>churchMul n</code> is a function that multiplies a numeral by <code>n</code>, <code>m</code> is function that repeats a function <code>m</code> times, and <code>churchOne</code> is the base value (identity of multiplication). Put them together, then simplify:</p>\n\n<pre><code>-- n^m is the repeated multiplication of 1 by n, m times\nexp n m = m (churchMul n) churchOne\n-- expand definitions x2; simplify churchOne\nexp n m = m (\\o f x -&gt; n (o f) x) (\\f x -&gt; f x)\n-- eta contract x2\nexp n m = m (\\o f -&gt; n (o f)) (\\f -&gt; f)\n-- definition of (.), id\nexp n m = m (\\o -&gt; n . o) id\n-- eta contract\nexp n m = m (n .) id\n-- eta expand\nexp n m f = m (n .) id f\n-- Assume m has the type forall b. (b -&gt; b) -&gt; b -&gt; b\n-- This assumption may actually be false here, because the implicit type of exp\n-- does not require that m, n have that type. The difference is that you could define\n-- bogus _ _ _ = 0\n-- (which isn't a church numeral) and still pass it to exp, which would no longer\n-- act like exponentiation:\n-- exp n bogus = bogus (n .) id = const 0\n-- which also isn't a church numeral\n\n-- Polymorphic functions like m give rise to theorems that can be derived\n-- entirely from their types. I used http://www-ps.iai.uni-bonn.de/cgi-bin/free-theorems-webui.cgi\n-- to get this one automatically.\n-- Free theorem of the type of m\nforall a b (g :: a -&gt; b) (p :: a -&gt; a) (q :: b -&gt; b).\n   (forall (x :: a). g (p x) = q (g x)) -&gt;\n     (forall (y :: a). g (m p y) = m q (g y))\n\n-- Instantiate g = ($ f), p = (n .), q = n, y = id\n  (forall x. (n . x) f = n (x f)) -&gt; (m (n .) id f = m n f)\n\n-- definition of (.)\n  (n . x) f = n (x f)\n-- so...\n  m (n .) id f = m n f\n-- transitive property\nexp n m f = m n f\n-- eta contract\nexp n m = m n\n</code></pre>\n\n<p>The above stuff with the free theorem of <code>m</code> is really a rigorous version of the following argument (which probably translates better to the untyped lambda calculus):</p>\n\n<pre><code>-- m, being a valid numeral, is of the form\nm f x = f $ f $ ... $ f $ f $ x\n\nm (n .) id = (n .) $ (n .) $ ... $ (n .) $ (n .) $ id\n           = (n .) $ (n .) $ ... $ (n .) $ n . id\n           = (n .) $ (n .) $ ... $ (n .) $ n\n           = (n .) $ (n .) $ ... $ n . n\n           ...\n           = n . n . ... . n . n\n-- so\nm n = n . n . ... . n . n = m (n .) id\n</code></pre>\n\n<hr/>\n\n<p>As for why <code>churchTwo churchTwo</code> typechecks, note each occurrence in that expression has a different type, because <code>churchTwo</code> is polymorphic and describes an entire family of functions instead of just one.</p>\n\n<pre><code>-- most general type\nchurchTwo :: forall b. (b -&gt; b) -&gt; (b -&gt; b)\n-- Each occurrence of churchTwo can have a different type, so let's give them\n-- different names.\n-- I'm using underscores because these variables haven't been solved yet\nchurchTwo0 :: (_b0 -&gt; _b0) -&gt; (_b0 -&gt; _b0)\nchurchTwo1 :: (_b1 -&gt; _b1) -&gt; (_b1 -&gt; _b1)\nchurchTwo0 churchTwo1 :: _\n-- Since churchTwo0 is being applied, the whole expression must have the\n-- type on the right of the arrow\nchurchTwo0 churchTwo1 :: _b0 -&gt; _b0\n-- Since churchTwo0 is being applied to churchTwo1, the left side of the\n-- top level arrow in churchTwo0 must be equal to the type of churchTwo1\n(_b0 -&gt; _b0) ~ ((_b1 -&gt; _b1) -&gt; (_b1 -&gt; _b1))\n-- Therefore...\n(_b0 ~ (_b1 -&gt; _b1))\nchurchTwo0 churchTwo1 :: (_b1 -&gt; _b1) -&gt; (_b1 -&gt; _b1)\n-- That's all the constraints we have, so replace the free variables\n-- with universally quantified ones\nchuchTwo0 churchTwo1 :: forall b. (b -&gt; b) -&gt; (b -&gt; b)\n-- (which is the type of a numeral)\n</code></pre>\n"}], "owner": {"reputation": 497, "user_id": 3979725, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mj52I.jpg?s=128&g=1", "display_name": "David Lilue", "link": "https://stackoverflow.com/users/3979725/david-lilue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 545, "favorite_count": 0, "accepted_answer_id": 47566130, "answer_count": 1, "score": 3, "last_activity_date": 1512017560, "creation_date": 1512000643, "question_id": 47563925, "link": "https://stackoverflow.com/questions/47563925/church-naturals-exponentiation-function-and-type-checking", "title": "Church naturals, exponentiation function and type checking", "body": "<p>I have a definition of the natural numbers in lambda calculus as follow, which was my main goal.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- Apply a function n times on x\napply = \\f -&gt; \\n -&gt; \\x -&gt; foldr ($) x $ replicate n f\n\n-- Church numbers\nchurchZero = \\f -&gt; id\n\nchurchOne = \\f -&gt; \\x -&gt; apply f 1 x\n\nchurchTwo = \\f -&gt; \\x -&gt; apply f 2 x\n\nchurchNatural = \\n -&gt; \\f -&gt; \\x -&gt; apply f n x\n</code></pre>\n\n<p>Then, the next step was defining the operators <code>churchSum</code>, <code>churchMul</code> and <code>churchExp</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>churchSum = \\n -&gt; \\m -&gt; \\f -&gt; \\x -&gt; n f (m f x)\n\nchurchMul = \\n -&gt; \\m -&gt; \\f -&gt; \\x -&gt; n (m f) x\n\nchurchExp = \\n -&gt; \\m -&gt; n m\n</code></pre>\n\n<p>Fine, it works, the first two functions are \"easy\" to deduce, but the exponentiation is not. For me at least. To understand a little bit more, i did the beta normalization on the lambda term:<br> <code>(\u03bbf.\u03bbx. f(f x))(\u03bbf.\u03bbx f(f x))</code> to see that effectively the exponentiation is correct.</p>\n\n<p><a href=\"https://i.stack.imgur.com/zh6dV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zh6dV.png\" alt=\"beta reduction\"></a></p>\n\n<p>So, my question is: how could i deduce this lambda term for the exponentiation without known it? Even more, why something like <code>\u03bb&gt; churchTwo churchTwo</code> type checks on <code>Haskell</code> when the types are <code>\u03bb&gt; churchTwo :: (b -&gt; b) -&gt; b -&gt; b</code>? Inside it do the beta normalization of the function?</p>\n"}]