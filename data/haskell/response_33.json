[{"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 8, "creation_date": 1440625528, "post_id": 32236957, "comment_id": 52356710, "body": "I don&#39;t understand what you&#39;re trying to abstract over, because you are talking about stuff like greens and gauges instead of functions and I don&#39;t know what those are or how you would want to abstract them (I suspect other potential answerers are in this boat). Do you have a concrete example of some repetitive stuff you have to write now, and a more abstract way you wish you could write it?"}, {"owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "edited": false, "score": 2, "creation_date": 1440637904, "post_id": 32236957, "comment_id": 52360239, "body": "Even knowing what Green&#39;s functions are, it&#39;s not clear what you actually want to do with them.  Are you integrating them over something?  Often it&#39;s best to not start with the most general case.  Start by writing the code for both Coulomb and Lorenz gauges, then identify what code they share and use that as a guide for generalizing the code."}, {"owner": {"reputation": 319, "user_id": 1214036, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b44c47230e3f69296931078db73dd4a4?s=128&d=identicon&r=PG", "display_name": "TheMADMAN", "link": "https://stackoverflow.com/users/1214036/themadman"}, "edited": false, "score": 0, "creation_date": 1440658826, "post_id": 32236957, "comment_id": 52366590, "body": "I admit I was maybe to straight forward. I want to have a function, the Green&#39;s function, based on my individual problem. For case A I have a specific function which returns a real number. But for case B the function returns a complex number and also receives an additional input argument. Now I want to be very flexible and have one function for based on the problem. Of course I want to integrate over this function. But this is another story. Basically it is this: Environment leads to -&gt; Case 1 -&gt; Case 2 -&gt; ... -&gt; Case n =&gt; Each Case has a function based on an additionial parameter like Gauge."}], "answers": [{"comments": [{"owner": {"reputation": 319, "user_id": 1214036, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b44c47230e3f69296931078db73dd4a4?s=128&d=identicon&r=PG", "display_name": "TheMADMAN", "link": "https://stackoverflow.com/users/1214036/themadman"}, "edited": false, "score": 0, "creation_date": 1440881255, "post_id": 32244913, "comment_id": 52458603, "body": "This looks very nice. I want to learn more about the type system and its possibilities, that&#39;s why I would like to follow this approach. @viorior&#39;s version looks also very elegant, but I prefer the classes now. I will accept your answer."}, {"owner": {"reputation": 319, "user_id": 1214036, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b44c47230e3f69296931078db73dd4a4?s=128&d=identicon&r=PG", "display_name": "TheMADMAN", "link": "https://stackoverflow.com/users/1214036/themadman"}, "edited": false, "score": 0, "creation_date": 1440881746, "post_id": 32244913, "comment_id": 52458722, "body": "And it makes absolut sense physically. In electrodynamics you have a certain variability in the way you define your problem. Based on your gauge, your equations change, although the overall result is the same. This can lead to either simple or more complicated calculations. Ideally, you find a solution or design of your equations that is gauge invariant. But that might be complicated :)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 1, "last_activity_date": 1440666332, "last_edit_date": 1440666332, "creation_date": 1440665911, "answer_id": 32244913, "question_id": 32236957, "link": "https://stackoverflow.com/questions/32236957/proper-use-of-class-and-types/32244913#32244913", "title": "proper use of class and types", "body": "<p>Honestly I don't know if this makes any sense physically, but looking at your code I'd be tempted to do something like the following:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\ndata GreenParamFC a = GreenParamFC {\n       gpFC_f1, gpFC_f2 :: Scalar a -&gt; a\n     , gpFC_s1, gpFC_s2 :: Scalar a\n     }\ndata GreenParamFL a = GreenParamFL {\n       gpFL_f1, gpFL_f2 :: Scalar a -&gt; a\n     , gpFL_s1, gpFL_s2, gpFL_s3 :: Scalar a\n     }\ndata GreenMixParam a = GreenMix {\n       gm_FC :: GreenParamFC a\n     , gm_FL :: GreenParamFL a\n     }\n\nclass GreenParams p where\n  type GreenResult p a :: *\n  greenF :: p a -&gt; GreenResult p a\n\ninstance GreenParams GreenParamFC where\n  type GreenResult GreenParamFC a = Scalar a\n  greenF (GreenParamFC f1 f2 s1 s2) = ...\n\ninstance GreenParams GreenParamFL where\n  type GreenResult GreenParamFL a = Complex (Scalar a)\n  greenF (GreenParamFL f1 f2 s1 s2 s3) = ...\n\ninstance GreenParams GreenMixParam where\n  type GreenResult GreenMixParam a = (Scalar a, Complex (Scalar a))\n  greenF (GreenMix\n              (GreenParamFC f1 f2 s1 s2)\n              (GreenParamFL f1 f2 s1 s2 s3)\n         ) = (..., ...)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1765, "user_id": 2181660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bda83eedd4ccbae9799c1fab98aed7ff?s=128&d=identicon&r=PG", "display_name": "viorior", "link": "https://stackoverflow.com/users/2181660/viorior"}, "is_accepted": false, "score": 1, "last_activity_date": 1440667359, "last_edit_date": 1440667359, "creation_date": 1440665990, "answer_id": 32244937, "question_id": 32236957, "link": "https://stackoverflow.com/questions/32236957/proper-use-of-class-and-types/32244937#32244937", "title": "proper use of class and types", "body": "<p>There is a problem with different number of arguments.</p>\n\n<p>The simplest way is to use data type for \"parameters\". And to use data type for \"result\".</p>\n\n<p>And to use just pattern-matching instead of class.</p>\n\n<p>Something like that:</p>\n\n<pre><code>type GreenMix a = (Scalar a, Complex (Scalar a))\ndata ResultType a  = Clomb (Scalar a) \n                   | Lrenz (Complex (Scalar a)) \n                   | Mix (GreenMix a)\n\ndata Gauge a = Gauge1 (Scalar a) (Scalar a)\n             | Gauge2 (Scalar a) (Scalar a) (Scalar a)\n\ngreenF :: (Scalar a -&gt; a) -&gt; (Scalar a -&gt; a) -&gt; Gauge a -&gt; Result a\ngreenF f1 f2 (Gauge1 g1 g2)    = Clomb $ greenF_Gauge1 f1 f2 g1 g2\ngreenF f1 f2 (Gauge2 g1 g2 g3) = Lrenz $ greenF_Gauge2 f1 f2 g1 g2 g3\n</code></pre>\n"}], "owner": {"reputation": 319, "user_id": 1214036, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b44c47230e3f69296931078db73dd4a4?s=128&d=identicon&r=PG", "display_name": "TheMADMAN", "link": "https://stackoverflow.com/users/1214036/themadman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 32244913, "answer_count": 2, "score": 2, "last_activity_date": 1440667359, "creation_date": 1440624237, "last_edit_date": 1440636097, "question_id": 32236957, "link": "https://stackoverflow.com/questions/32236957/proper-use-of-class-and-types", "title": "proper use of class and types", "body": "<p>I am currently working on a project that is related to physics. I want to improve my already working program and give it more structure.\nBut at the moment I am going in circles and not making progress.</p>\n\n<p>I want to build green's functions, but I also want to be very general, so that I can reuse my library, of course.</p>\n\n<p>I would like to have a class that holds the green's function based on the problem, this can be free space, or a resonator or something else. And the functions also depend on the gauge. In gauge 1 I get a representation of green's function like this:</p>\n\n<pre><code>greenF_Gauge1 :: (Scalar a -&gt; a) -&gt; (Scalar a -&gt; a) -&gt; Scalar a -&gt; Scalar a -&gt; Scalar a\n</code></pre>\n\n<p>But in Gauge 2 I have one argument more and a different return type</p>\n\n<pre><code>greenF_Gauge2 :: (Scalar a -&gt; a) -&gt; (Scalar a -&gt; a) -&gt; Scalar a -&gt; Scalar a -&gt; Scalar a -&gt; Scalar a -&gt; Complex (Scalar a)\n</code></pre>\n\n<p>It would be nice to have only one function for the green's function and just select the correct one by the type of the Gauge. And building on that I want to create the correct function based on the nature of the problem (free space etc.)\nSince I have different numbers of arguments and different return types I somehow failed at the class definition.</p>\n\n<p>I tried:</p>\n\n<pre><code>type GreenFC a =  ((Scalar a -&gt; a) -&gt; (Scalar a -&gt; a)  -&gt; Scalar a -&gt; Scalar a -&gt; Scalar a)\ntype GreenFL a =  ((Scalar a -&gt; a) -&gt; (Scalar a -&gt; a)  -&gt; Scalar a -&gt; Scalar a -&gt; Scalar a -&gt; Complex (Scalar a))\ntype GreenMix a = (GreenFC a, GreenFL a)\ndata ResultType a  = Clomb (GreenFC a) | Lrenz (GreenFL a) | Mix (GreenMix a)\n\nclass  (VectorSpace a) =&gt; GreenFunc g a  where\n  greenF :: g -&gt; ResultType a \n</code></pre>\n\n<p>But when constructing the actual functions based on my structure, I have a problem accessing the return values, which are functions hidden in <code>ResultType</code>. I think there must be a more elegant way to do this.</p>\n\n<p>I would like to use the power of the type system and make the whole program more abstract, so that I can exchange the gauge for example and don't have to hack in my code. But currently my level of understanding is that I know about type families etc but I still don't know how to apply them properly.\nAny hints in that direction are very much appreciated.</p>\n"}, {"tags": ["haskell", "hyperlink", "cabal", "haddock"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440624628, "post_id": 32236857, "comment_id": 52356309, "body": "What version of <code>haddock</code> is cabal calling?"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440624795, "post_id": 32236857, "comment_id": 52356380, "body": "@user5402 I have 2.16.1 installed. I don&#39;t know which it is using."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440625050, "post_id": 32236857, "comment_id": 52356491, "body": "I don&#39;t think that version is new enough. Does that haddock understand the <code>--hyperlinked-source</code> flag?"}], "answers": [{"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440625973, "post_id": 32237273, "comment_id": 52356857, "body": "Oh, so it isn&#39;t officially out yet then?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1440626379, "post_id": 32237273, "comment_id": 52357037, "body": "Well - it&#39;s not on Hackage. It&#39;s confusing, because there is also a cabal haddock  option called <code>--hyperlink-source</code> (note: no <b>ed</b>) See this old SO question: <a href=\"http://stackoverflow.com/q/2472630/866915\">stackoverflow.com/q/2472630/866915</a>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 6, "last_activity_date": 1440625736, "creation_date": 1440625736, "answer_id": 32237273, "question_id": 32236857, "link": "https://stackoverflow.com/questions/32236857/why-isnt-cabal-hyperlinking-my-sources/32237273#32237273", "title": "Why isn&#39;t Cabal hyperlinking my sources?", "body": "<p>Hopefully we're talking about the <code>haddock</code> command line option <code>--hyperlinked-source</code> (note hyperlink<strong>ed</strong>).</p>\n\n<p>Version 2.16.1 does not support the <code>--hyperlinked-source</code> option.</p>\n\n<p>Version 2.16.2 does support the <code>--hyperlinked-source</code> option.</p>\n\n<p>You might have to build 2.16.2 from the git repo:</p>\n\n<p><a href=\"https://github.com/haskell/haddock\">https://github.com/haskell/haddock</a></p>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 32237273, "answer_count": 1, "score": 4, "last_activity_date": 1440683152, "creation_date": 1440623843, "last_edit_date": 1440683152, "question_id": 32236857, "link": "https://stackoverflow.com/questions/32236857/why-isnt-cabal-hyperlinking-my-sources", "title": "Why isn&#39;t Cabal hyperlinking my sources?", "body": "<pre><code>$ cabal --version\ncabal-install version 1.22.2.0\nusing version 1.22.2.0 of the Cabal library \n\n\n$ cabal install --haddock-hyperlink-source gloss-juicy\nWarning: /home/theking/.cabal/config: Unrecognized field hyperlink-source on\nline 91\n</code></pre>\n\n<p>I do have <code>hyperlink-source: True</code> on in my config. I added the flag just to be redundant. When I look for the docs, it is all colorized and everything, but the source code isn't linkified. What am I doing wrong?</p>\n"}, {"tags": ["linux", "haskell", "input", "keyboard", "scancodes"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1440623456, "post_id": 32236500, "comment_id": 52355779, "body": "AFAIK there is standard library way to get access to input. Also note that getContents (and by extension, interact and friends) are usually not used that much because lazy IO has a tendency to be a bit of a pain in the ass."}, {"owner": {"reputation": 333, "user_id": 2179640, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/43241417331124518968869d20b0322f?s=128&d=identicon&r=PG", "display_name": "Vanzef", "link": "https://stackoverflow.com/users/2179640/vanzef"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1440625253, "post_id": 32236500, "comment_id": 52356581, "body": "@Cubic Could you please tell me more about lazy IO and &quot;pain in the ass&quot;? I am new in haskell and programming at all, so I don&#39;t know this."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440625721, "post_id": 32236500, "comment_id": 52356774, "body": "lazy IO isn&#39;t too bad. It just doesn&#39;t work like you would expect."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1440627773, "last_edit_date": 1495541730, "creation_date": 1440627773, "answer_id": 32237689, "question_id": 32236500, "link": "https://stackoverflow.com/questions/32236500/how-to-get-scancodes-of-pressed-and-released-keys-in-haskell/32237689#32237689", "title": "How to get scancodes of pressed and released keys in Haskell?", "body": "<p>If you really want simple, then check out these answers:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/3894792/what-is-a-simple-way-to-wait-for-and-then-detect-keypresses-in-haskell\">What is a simple way to wait for and then detect keypresses in Haskell?</a></li>\n<li><a href=\"https://stackoverflow.com/q/9143041/866915\">Block until keypress or given time of day</a></li>\n</ul>\n\n<p>You might have to put your tty into raw mode first for it to work. The second question asks for a Windows solution, but the same idea should also work for Linux.</p>\n"}], "owner": {"reputation": 333, "user_id": 2179640, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/43241417331124518968869d20b0322f?s=128&d=identicon&r=PG", "display_name": "Vanzef", "link": "https://stackoverflow.com/users/2179640/vanzef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 546, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1440627773, "creation_date": 1440622326, "question_id": 32236500, "link": "https://stackoverflow.com/questions/32236500/how-to-get-scancodes-of-pressed-and-released-keys-in-haskell", "title": "How to get scancodes of pressed and released keys in Haskell?", "body": "<p>I am writing a simple text editor, so I want to have something like this</p>\n\n<pre><code>type Scancode = Int\ndata KeyState = Pressed | Released\nnewtype InStream = InStream [(Scancode, State)]\n\nmain = do\n    input &lt;- getKeys\n    parse input\n\nparse :: InStream -&gt; IO ()\nparse [] = return ()\nparse (x : xs)\n  | x == (1, Released) = return ()\n  | otherwise = do\n      doSomething\n      parse xs\n</code></pre>\n\n<p>As you could guess, I want <code>getKeys</code> function to behave like <code>getContents</code>, to have continuos list of scancodes.</p>\n\n<p>As I know SDL or even GTK can provide me such functionality, but is there more idiomatic (for haskell and functional programming at all) and with less \"overhead\" way to do such thing?</p>\n\n<p>P.S. If it matters, I want to use my \"editor\" under Linux both in console (tty) and X11/Wayland.</p>\n"}, {"tags": ["file", "haskell", "io"], "answers": [{"comments": [{"owner": {"reputation": 2761, "user_id": 1846280, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/45af98ea7a43d56ae05b6ffd531b0f1a?s=128&d=identicon&r=PG", "display_name": "Tetramputechture", "link": "https://stackoverflow.com/users/1846280/tetramputechture"}, "edited": false, "score": 4, "creation_date": 1440621518, "post_id": 32236239, "comment_id": 52354833, "body": "I got the getNumbers function on my own! Thank you so much! I knew I had to do something like that, I just wasn&#39;t sure of myself."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 2761, "user_id": 1846280, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/45af98ea7a43d56ae05b6ffd531b0f1a?s=128&d=identicon&r=PG", "display_name": "Tetramputechture", "link": "https://stackoverflow.com/users/1846280/tetramputechture"}, "edited": false, "score": 1, "creation_date": 1440625768, "post_id": 32236239, "comment_id": 52356790, "body": "@Tetramputechture You could edit your function into the answer."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 6, "last_activity_date": 1440621528, "last_edit_date": 1440621528, "creation_date": 1440621327, "answer_id": 32236239, "question_id": 32236072, "link": "https://stackoverflow.com/questions/32236072/haskell-read-a-file-containing-numbers-into-a-list/32236239#32236239", "title": "Haskell - Read a file containing numbers into a list", "body": "<p>In so many lines...</p>\n\n<pre><code>getNumbers :: String -&gt; [Int]\ngetNumbers str = -- left as exercise\n                 -- helpful functions: `read`, `words`\n\nmain :: IO ()\nmain = do\n    contents &lt;- readFile \"numbers.txt\"\n    let numbers = getNumbers contents\n    print numbers\n</code></pre>\n"}], "owner": {"reputation": 2761, "user_id": 1846280, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/45af98ea7a43d56ae05b6ffd531b0f1a?s=128&d=identicon&r=PG", "display_name": "Tetramputechture", "link": "https://stackoverflow.com/users/1846280/tetramputechture"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 0, "accepted_answer_id": 32236239, "answer_count": 1, "score": 3, "last_activity_date": 1440621528, "creation_date": 1440620721, "question_id": 32236072, "link": "https://stackoverflow.com/questions/32236072/haskell-read-a-file-containing-numbers-into-a-list", "title": "Haskell - Read a file containing numbers into a list", "body": "<p>So I have a text file in this format:</p>\n\n<p><code>1 3 4 5 1 3 9 12 5</code></p>\n\n<p>Say this file is called <code>numbers.txt</code>.</p>\n\n<p>I want to tell Haskell to read from the file, and put those numbers in a list. So I would end up with:</p>\n\n<p><code>[1,3,4,5,1,3,9,12,5]</code></p>\n\n<p>I really don't understand how to do this, and I've been searching a lot. I know I'll need to use getLine, but then what? Would I use a function to map that string to a list? I'm really not sure how I would write this, and I know it's probably a really stupid question, but I just started learning Haskell and I want to go forward.</p>\n"}, {"tags": ["haskell", "matrix", "indentation"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1440616709, "post_id": 32234674, "comment_id": 52352245, "body": "<a href=\"https://github.com/tibbe/haskell-style-guide/blob/master/haskell-style.md\" rel=\"nofollow noreferrer\">Johan Tibell&#39;s Haskell style guide</a> may be of interest to you."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1440616559, "post_id": 32234740, "comment_id": 52352153, "body": "I am partial to the third style, with one adjustment: putting the final <code>]</code> in a separate line, as in the first snippet."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1440616798, "post_id": 32234740, "comment_id": 52352292, "body": "yeah, that&#39;s probably what I&#39;d do too, because it&#39;s easy to add fourth, fifth lines that way :)"}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1440616838, "post_id": 32234740, "comment_id": 52352313, "body": "I added that fourth option into my answer"}], "tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": true, "score": 5, "last_activity_date": 1440616814, "last_edit_date": 1440616814, "creation_date": 1440615944, "answer_id": 32234740, "question_id": 32234674, "link": "https://stackoverflow.com/questions/32234674/how-can-i-initialize-matrices-with-sensible-indentation-in-haskell/32234740#32234740", "title": "How can I initialize matrices with sensible indentation in haskell", "body": "<p>The way that the haskell community has sort of decided we like to do our indenting is:</p>\n\n<pre><code>matrix = [ [1, 0, 0 ]\n         , [0, 2, 0 ]\n         , [0 ,0 ,3 ]\n         ]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>matrix = [ [1, 0, 0 ]\n         , [0, 2, 0 ]\n         , [0 ,0 ,3 ] ]\n</code></pre>\n\n<p>leading commas is by far the dominating style :)</p>\n\n<p>You can bring the matrix down too</p>\n\n<pre><code>matrix =\n  [ [1, 0, 0 ]\n  , [0, 2, 0 ]\n  , [0 ,0, 3 ] ]\n\nmatrix =\n  [ [1, 0, 0 ]\n  , [0, 2, 0 ]\n  , [0 ,0, 3 ]\n  ]\n</code></pre>\n\n<p>The problem with your example is that only things indented \"past the <code>m</code>\" are considered \"still a part of the declaration of matrix\".  So for example:</p>\n\n<pre><code>matrix = blah\n  bloh\nbluh\n</code></pre>\n\n<p>the <code>bluh</code> is on the same level as the <code>m</code>, so haskell sees <code>bluh</code> and goes, \"welp, this is a new declaration!  we're done with <code>matrix</code>!\"</p>\n\n<p>Admittedly, the compiler error could be a bit clearer :)</p>\n"}], "owner": {"reputation": 1001, "user_id": 867377, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/9b695266843a42e85ba91f1c6b7d645e?s=128&d=identicon&r=PG", "display_name": "toftis", "link": "https://stackoverflow.com/users/867377/toftis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 32234740, "answer_count": 1, "score": 3, "last_activity_date": 1440616814, "creation_date": 1440615728, "question_id": 32234674, "link": "https://stackoverflow.com/questions/32234674/how-can-i-initialize-matrices-with-sensible-indentation-in-haskell", "title": "How can I initialize matrices with sensible indentation in haskell", "body": "<p>I want to get a matrix filled with hard coded values in haskell. However because of the indentation rules in haskell, the only way I have managed to do this is to write the whole matrix on a single line which is hard to read.</p>\n\n<pre><code>matrix = [                          \n   [1,0,0],\n   [0,2,0],\n   [0,0,3]\n] --parse error (possibly incorrect indentation or mismatched brackets)\n\nmatrix = [ [1,0,0], [0,1,0], [0,0,1] ] --OK\n</code></pre>\n\n<p>What is the recommended way to do this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1440614493, "post_id": 32234185, "comment_id": 52350949, "body": "The example I showed is just a toy example, in reality I need to traverse a arb large list many times computing statistics, hence I&#39;m using the foldl library, which allow me to combine the computations using applicatives ie <code>toResults &lt;$&gt; stat1 &lt;*&gt; stat2 &lt;*&gt; ... &lt;*&gt; statm $ largeList</code> and foldl allow me to traverse the list just once, computing all m statistics."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1440614723, "post_id": 32234185, "comment_id": 52351098, "body": "One thing doesn&#39;t exclude the other. You can make your &quot;histogram&quot; a <code>Map (Maybe String) Int</code> (or whatever is appropriate) and still use a <code>Fold</code> to build it."}], "answers": [{"tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": true, "score": 4, "last_activity_date": 1440616917, "last_edit_date": 1440616917, "creation_date": 1440614862, "answer_id": 32234418, "question_id": 32234185, "link": "https://stackoverflow.com/questions/32234185/counting-the-frequency-of-values-in-a-list-using-control-foldl/32234418#32234418", "title": "Counting the frequency of values in a list Using Control.Foldl", "body": "<p>You can encode a normal <code>foldl'</code> pretty straightforwardly as a <code>Fold</code>:</p>\n\n<pre><code>foldlToFold :: (b -&gt; a -&gt; b) -&gt; b -&gt; Fold a b\nfoldlToFold f z = Fold f z id\n</code></pre>\n\n<p>I'm actually a bit puzzled that this combinator isn't in the library...</p>\n\n<p>Anyways, if you have</p>\n\n<pre><code>foldl' f z\n</code></pre>\n\n<p>you can replace it with</p>\n\n<pre><code>fold (Fold f z id)\n</code></pre>\n\n<p>so here, you would normally be using</p>\n\n<pre><code>foldl' (\\mp x -&gt; M.insertWith (+) x 1 mp) M.empty\n</code></pre>\n\n<p>with <code>Fold</code>,  you'd be making</p>\n\n<pre><code>countingFold :: Ord a =&gt; Fold a (Map a Int)\ncountingFold = Fold (\\mp x -&gt; M.insertWith (+) 1 mp) M.empty id\n</code></pre>\n\n<p>and you can use it as</p>\n\n<pre><code>countUp :: Ord a =&gt; [a] -&gt; Map a Int\ncountUp = fold countingFold\n\n-- or\ncountUp = fold (Fold (\\mp x -&gt; M.insertWith (+) 1 mp) M.empty id)\n</code></pre>\n\n<p>If you want to go back to a list at the end, you can do</p>\n\n<pre><code>M.toList . countUp\n</code></pre>\n\n<p>In general, if you can formulate your fold as a <code>foldl'</code>, you can do the transformation above to be able to encode it as a <code>Fold</code>.  <code>Fold</code> is a bit more expressive because for <code>foldl'</code>, the <code>b</code> type is both the accumulator and the result type; for a <code>Fold</code>, you can have a separate accumulator and result type.</p>\n\n<p>Roughly speaking,  you can translate any <code>Fold</code> into a foldl-and-map:</p>\n\n<pre><code>Fold f z g = map g . foldl' f z\n</code></pre>\n\n<p>And you can go backwards too:</p>\n\n<pre><code>foldlMapToFold :: (b -&gt; a -&gt; b) -&gt; b -&gt; (b -&gt; c) -&gt; Fold a c\nfoldlMapToFold = Fold\n</code></pre>\n\n<p>So if you had</p>\n\n<pre><code>map g . foldl' f z\n</code></pre>\n\n<p>you can write</p>\n\n<pre><code>fold (Fold f z g)\n</code></pre>\n\n<p>If you want to use a <code>Fold</code>, think, \"how can i describe my operation as a <code>foldl'</code> and a <code>map</code>?\", and then go from there.</p>\n\n<p>The advantage of using the <code>Fold</code> type over just normal maps and folds is (apart from performance tweaks) the ability to combine and manipulate multiple <code>Fold</code>s as objects using their Applicative instance, and other nice instances too, like Functor, Profunctor, fun stuff like that.  Combining folds encoded as maps-and-foldl's is a bit tedious, but the <code>Fold</code> wrapper lets you do it in a cleaner first-class way using the abstractions everyone knows and loves.</p>\n\n<p>For example, if i had</p>\n\n<pre><code>fold1 = map g . foldl' f z\n</code></pre>\n\n<p>and</p>\n\n<pre><code>fold2 = map g' . foldl' f' z'\n</code></pre>\n\n<p>and I wanted to do</p>\n\n<pre><code>fold3 = map (\\(x,y) -&gt; foo (g x) (g' y))\n      . foldl' (\\(x,x') (y,y) -&gt; (f x y, f' x' y')) (z', z')\n</code></pre>\n\n<p>(that is, do both folds on the list in one pas, and recombine the results at the end with <code>foo</code>).  It's a big hassle, right?</p>\n\n<p>But i can also just do</p>\n\n<pre><code>fold1 = Fold f z g\nfold2 = Fold f' z' g'\nfold3 = foo &lt;$&gt; fold1 &lt;*&gt; fold2\n</code></pre>\n\n<p>(Note that, even better, using using <code>Fold</code> actually keeps <code>foldl'</code> strict, because in the example above, the lazy tuples add a layer of indirection and make the fold' lazy again incidentally)</p>\n"}], "owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 32234418, "answer_count": 1, "score": 0, "last_activity_date": 1440616917, "creation_date": 1440614094, "last_edit_date": 1440614489, "question_id": 32234185, "link": "https://stackoverflow.com/questions/32234185/counting-the-frequency-of-values-in-a-list-using-control-foldl", "title": "Counting the frequency of values in a list Using Control.Foldl", "body": "<p>I am using the <code>Control.Foldl</code> library to traverse an arbitrarily long list and counting all occurrences of arbitrarily many unique entities. Ie, the list may be of form</p>\n\n<pre><code>[Just \"a\", Just \"b\", Just \"aab\", Nothing, Just \"aab\"]\n</code></pre>\n\n<p>and I my result should something like:</p>\n\n<p><code>[(Just \"a\",1),(Just \"b\",1) (Just \"aab\", 2), (Nothing, 1)]</code></p>\n\n<p>Now the issue is I do not have the name of these entities a priori, and I would like to dynamically update the results as I fold. </p>\n\n<p>My problem is that I do not know how to describe this computation in terms of the <code>Fold</code> data type from <code>Control.foldl</code>. Specifically, at each step of the fold I need to traverse the result list and ask if I have seen the current item, but I see no way of describing this using <code>foldl</code>.</p>\n\n<p>Please note for future use purposes it's <strong>really</strong> important that I use the Control.Foldl library here, not fold over some other foldable data type like a map. In some sense my question is more along the lines of how to use the Foldl library, since the documentation is not too clear to me.    </p>\n\n<p>Edit: The example I showed is just a toy example, in reality I need to traverse a arb large list many times computing statistics, hence I'm using the foldl library, which allow me to combine the computations using applicatives ie <code>toResults &lt;$&gt; stat1 &lt;*&gt; stat2 &lt;*&gt; ... &lt;*&gt; statm $ largeList</code> and foldl allow me to traverse the list just once, computing all m statistics. Please find a solution using the foldl library. </p>\n"}, {"tags": ["haskell", "optimization", "functional-programming", "referential-transparency"], "comments": [{"owner": {"reputation": 813, "user_id": 2093501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/266441e0f8afb9354f0ea551f230f949?s=128&d=identicon&r=PG", "display_name": "&#201;milien Tlapale", "link": "https://stackoverflow.com/users/2093501/%c3%89milien-tlapale"}, "edited": false, "score": 1, "creation_date": 1440613491, "post_id": 32233788, "comment_id": 52350333, "body": "For the second possibility, you may want to use <code>lastBucket :: IORef Int</code> instead, and use <code>unsafePerformIO</code> to \u201cimpurely modify it\u201d. Your JS code does not handle the fact that <code>__lastBucket</code> may be modified by an other <code>read()</code> call from another thread, hence have a different value at <code>if</code> and at <code>=</code>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 813, "user_id": 2093501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/266441e0f8afb9354f0ea551f230f949?s=128&d=identicon&r=PG", "display_name": "&#201;milien Tlapale", "link": "https://stackoverflow.com/users/2093501/%c3%89milien-tlapale"}, "edited": false, "score": 0, "creation_date": 1440614482, "post_id": 32233788, "comment_id": 52350937, "body": "@Xic&#242; of course, thanks! I wish I could hide that, though, because it is not part of the API. Also, what you said is true. But I don&#39;t need locks here, correct? Just store <code>__lastBucket</code> in a variable on the beginning. (JS doesn&#39;t have threads...). Edit: updated the OP."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1440615019, "post_id": 32233788, "comment_id": 52351265, "body": "Beware of threads if you decide to use unsafe tricks."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1440616390, "post_id": 32233788, "comment_id": 52352056, "body": "The first solution with the global map would need to use a weakmap instead, otherwise you&#39;d get garbage collection issues."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1440620676, "post_id": 32233788, "comment_id": 52354355, "body": "Lift your operations into <code>ST</code>..."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1440622264, "post_id": 32233788, "comment_id": 52355210, "body": "But @DanielWagner there is no actual state there in the sense that the function output doesn&#39;t change based on it, it is just an internal optimization. Wouldn&#39;t that make an ST API wrong?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1440622521, "post_id": 32233788, "comment_id": 52355337, "body": "@Viclib I don&#39;t know the technical definition of &quot;wrong&quot;. =)"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440694130, "post_id": 32233788, "comment_id": 52390379, "body": "I don&#39;t know what is the english word, but I meant something additional that isn&#39;t essential, like a fifth wheel for a car... it is not &quot;redundant&quot;..."}], "answers": [{"comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 2, "creation_date": 1440669902, "post_id": 32235699, "comment_id": 52373332, "body": "In this case it probably doesn&#39;t matter, as the value is only a cache, but in general it&#39;s safer and somewhat more idiomatic to use <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-IORef.html#v:atomicModifyIORef\" rel=\"nofollow noreferrer\"><code>atomicModifyIORef</code></a>."}], "tags": [], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "is_accepted": false, "score": 2, "last_activity_date": 1440619416, "creation_date": 1440619416, "answer_id": 32235699, "question_id": 32233788, "link": "https://stackoverflow.com/questions/32233788/how-to-impurely-modify-a-state-associated-with-an-object/32235699#32235699", "title": "How to impurely modify a state associated with an object?", "body": "<p>Using solution (1), I managed to get the following design. First, I added a <code>__lastAccessedBucket :: IORef Int</code> field to my datatype, as suggested by @Xic\u00f2:</p>\n\n<pre><code>data Container a = Container { \n    length :: Int, \n    buffer :: V.Vector (Int,a), \n    __lastAccessedBucket :: IORef Int }\n</code></pre>\n\n<p>Then, I had to update the functions that create a new <code>Container</code> in order to create a new IORef using <code>unsafePerformIO</code>:</p>\n\n<pre><code>fromList :: [a] -&gt; Container a\nfromList list = unsafePerformIO $ do\n    ref &lt;- newIORef 0\n    return $ Container (L.length list) buffer ref\n    where buffer = V.fromList (prepare list)\n</code></pre>\n\n<p>Finally, I created two new functions, <code>findBucketWithHint</code>, a pure function which searches the bucket of an index with guess (i.e., the bucket where you think it might be), and the <code>unsafeFindBucket</code> function, which replaces the pure <code>findBucket</code> when performance is needed, by always using the last accessed bucket as the hint:</p>\n\n<pre><code>unsafeFindBucket :: Int -&gt; Container a -&gt; Int\nunsafeFindBucket findIdx container = unsafePerformIO $ do \n    let lastBucketRef = __lastAccessedBucket contianer\n    lastBucket       &lt;- readIORef lastBucketRef\n    let newBucket     = findBucketWithHint lastBucket findIdx container\n    writeIORef lastBucketRef newBucket\n    return $ newBucket\n</code></pre>\n\n<p>With this, <code>unsafeFindBucket</code> is technically a pure function with the same API of the original <code>findBucket</code> function, but is an order of magnitude faster in some benchmarks. <strong>I have no idea how safe this is and where it could cause bugs.</strong> Threads are certainly a concern. </p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440716393, "post_id": 32250959, "comment_id": 52401249, "body": "Edward Kmett has been working on some crazy tree-of-vector structures with lots of unsafe stuff that might work well for this, especially if modifications are also needed."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1441198741, "post_id": 32250959, "comment_id": 52580703, "body": "@viclib, you&#39;ll have to dig around in GitHub/ekmett, and look for recent stuff there. I&#39;m not sure what&#39;s actually been released yet."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 2, "last_activity_date": 1440682730, "creation_date": 1440682730, "answer_id": 32250959, "question_id": 32233788, "link": "https://stackoverflow.com/questions/32233788/how-to-impurely-modify-a-state-associated-with-an-object/32250959#32250959", "title": "How to impurely modify a state associated with an object?", "body": "<p><sup>(This is more an extended comment than an answer.)</sup></p>\n\n<p>First I'd suggest to check if this isn't a case of <a href=\"https://en.wikipedia.org/w/index.php?title=Program_optimization&amp;oldid=677554019#When_to_optimize\" rel=\"nofollow\">premature optimization</a>. After all, <em>O(log n)</em> ins't that bad.</p>\n\n<p>If this part is indeed performance-critical, your intention is definitely valid. The usual warning for <code>unsafePerformIO</code> is \"use it only if you know what you're doing\", which you obviously do, and it can help to make things pure and fast at the same time.\nBe sure that you follow all <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/System-IO-Unsafe.html#v:unsafePerformIO\" rel=\"nofollow\">the precautions in the docs</a>, in particular setting the proper compiler flags (you might want to use <a href=\"https://downloads.haskell.org/~ghc/7.0.4/docs/html/users_guide/ch04s02.html#source-file-options\" rel=\"nofollow\">the <code>OPTIONS_GHC</code> pragma</a>).</p>\n\n<p>Also make sure that the <code>IO</code> operation is thread safe. The easiest way to ensure that is to use <code>IORef</code> together with <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-IORef.html#v:atomicModifyIORef\" rel=\"nofollow\"><code>atomicModifyIORef</code></a>.</p>\n\n<p>The disadvantage of an internal mutable state is that the performance of the cache will deteriorate if it's accessed from multiple threads, if they lookup different elements.</p>\n\n<p>One remedy would be to explicitly thread the updated state instead of using the internal mutable state. This is obviously what you want to avoid, but if your program is using monads, you could just add another monadic layer that'd internally keep the state for you and expose the lookup operation as a monadic action.</p>\n\n<p>Finally, you could consider using <a href=\"https://en.wikipedia.org/wiki/Splay_tree\" rel=\"nofollow\">splay trees</a> instead of the array. You'd still have (amortized) <em>O(log n)</em> complexity, but their big advantage is that by design they move frequently accessed elements near the top. So if you'll be accessing a subset of elements of size <em>k</em>, they'll be soon moved to the top, so the lookup operations will be just <em>O(log k)</em> (constant for a single, repeatedly accessed element). Again, they update the structure on lookups, but you could use the same approach with <code>unsafePerformIO</code> and atomic updates of <code>IORef</code> to keep the outer interface pure.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 2, "answer_count": 2, "score": 5, "last_activity_date": 1440682730, "creation_date": 1440612751, "last_edit_date": 1440614600, "question_id": 32233788, "link": "https://stackoverflow.com/questions/32233788/how-to-impurely-modify-a-state-associated-with-an-object", "title": "How to impurely modify a state associated with an object?", "body": "<p>In Haskell, I have a container like:</p>\n\n<pre><code>data Container a = Container { length :: Int, buffer :: Unboxed.Vector (Int,a) }\n</code></pre>\n\n<p>This container is a flattened tree. Its accessor <code>(!)</code> performs a binary (<code>log(N)</code>) search through the vector in order to find the right bucket where <code>index</code> is stored. </p>\n\n<pre><code>(!) :: Container a -&gt; Int -&gt; a\ncontainer ! index = ... binary search ...\n</code></pre>\n\n<p>Since consecutive accesses are likely to be in the same bucket, this could be optimized in the following way:</p>\n\n<pre><code>if `index` is on the the last accessed bucket, skip the search\n</code></pre>\n\n<p>The tricky point is the <code>last accessed bucket</code> part. In JavaScript, I'd just impurely modify a hidden variable on the container object.</p>\n\n<pre><code>function read(index,object){\n\n    var lastBucket = object.__lastBucket;\n\n    // if the last bucket contains index, no need to search\n    if (contains(object, lastBucket, index))\n        var bucket = lastBucket;\n\n    // if it doesn't\n    else {\n        // then we search the bucket\n        var bucket = searchBucket(index,object);\n\n        // And impurely annotate it on the container, so the\n        // next time we access it we could skip the search.\n        container.__lastBucket = bucket;\n    }\n\n    return object.buffer[bucket].value;\n}\n</code></pre>\n\n<p>Since this is just an optimization and the result is the same independent of the branch taken, I believe it doesn't break referential transparency. How is it possible, in Haskell, to impurely modify an state associated with a runtime value?</p>\n\n<p>~</p>\n\n<p>I have thought in 2 possible solutions.</p>\n\n<ol>\n<li><p>A global, mutable hashmap linking pointers to the <code>lastBucket</code> value, and use unsafePerformIO to write on it. But I'd need a way to get the runtime pointer of an object, or at least an unique id of some sort (how?).</p></li>\n<li><p>Add an extra field to <code>Container</code>, <code>lastBucket :: Int</code>, and somehow impurely modify it within <code>(!)</code>, and consider that field internal (because it obviously break referential transparency).</p></li>\n</ol>\n"}, {"tags": ["haskell", "type-inference", "ghci", "type-systems"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 13, "creation_date": 1440610133, "post_id": 32232731, "comment_id": 52348388, "body": "Sounds like the monomorphism restriction. Try using <code>:set -XNoMonomorphismRestriction</code> in ghci. Btw - you can type <code>:set -XNoMonom</code> and then hit TAB to complete it."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 5, "creation_date": 1440610427, "post_id": 32232731, "comment_id": 52348576, "body": "Monomorphism + GCCi defaulting rules."}, {"owner": {"reputation": 675, "user_id": 485482, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aIf9p.png?s=128&g=1", "display_name": "Csongor Kiss", "link": "https://stackoverflow.com/users/485482/csongor-kiss"}, "edited": false, "score": 2, "creation_date": 1440610434, "post_id": 32232731, "comment_id": 52348580, "body": "That was it! Monomorphism restriction is turned off by default in newer GHC versions, as it happens I was playing around with 7.0.4"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 2, "creation_date": 1440645485, "post_id": 32232731, "comment_id": 52361909, "body": "@CsongorKiss: The monomorphism restriction is turned off by default in newer <i>GHCis</i>.  It&#39;s still on by default in source files."}], "owner": {"reputation": 675, "user_id": 485482, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aIf9p.png?s=128&g=1", "display_name": "Csongor Kiss", "link": "https://stackoverflow.com/users/485482/csongor-kiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "closed_date": 1457157823, "answer_count": 0, "score": 1, "last_activity_date": 1440621299, "creation_date": 1440609219, "last_edit_date": 1440621299, "question_id": 32232731, "link": "https://stackoverflow.com/questions/32232731/haskell-literals-in-type-inference", "closed_reason": "Duplicate", "title": "Haskell literals in type inference", "body": "<p>Let's say I have a function <code>($10)</code>.</p>\n\n<p>Now, since 10 is of type <code>Num a =&gt; a</code>, <code>($10)</code> is surely of type <code>Num a =&gt; (a -&gt; b) -&gt; b</code>, and GHCi confirms this.</p>\n\n<p>But when I say <code>let f = ($10)</code>, GHC infers f's type to be <code>(Integer -&gt; b) -&gt; b</code>, as if the <code>let</code>-assignment deduced some 'extra' information from the use of the literal. </p>\n\n<p>Does this mean GHC's type inference coerces a concrete type for literals?</p>\n\n<p>But if so, why does <code>:t ($10)</code> return <code>Num a =&gt; (a -&gt; b) -&gt; b</code> ?</p>\n\n<pre><code>f :: Num a =&gt; (a -&gt; b) -&gt; b\nf = ($10)\n</code></pre>\n\n<p>typechecks, and <code>f (+0.1)</code> yields a correct result, while</p>\n\n<pre><code>g = ($10)\n</code></pre>\n\n<p>called with <code>g (+0.1)</code> fails, expecting an <code>Integer</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 6, "creation_date": 1440606227, "post_id": 32231659, "comment_id": 52346116, "body": "Why do you expect that <code>fmap (*) 3</code> should be exactly the same as <code>(*) 3</code>? The <code>fmap</code> function is clearly making some kind of a difference, and i don&#39;t imagine you expect that, say, <code>filter (*) 3</code> would be the same."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1440671586, "post_id": 32231659, "comment_id": 52374499, "body": "You&#39;re confusing mapping with application. <code>fmap</code> is a generalized <code>map</code> function, not at all like <code>($)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1440611562, "post_id": 32232126, "comment_id": 52349215, "body": "Can you give an example of <code>(fmap (*) 3) X</code> where <code>X</code> is a value that does not cause the expression to end in error?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 1, "creation_date": 1440613872, "post_id": 32232126, "comment_id": 52350600, "body": "@kurzweil4 It should be possible to do that, but why do you expect the result of <code>fmap (*) 3</code> to be a function? It has type <code>f (a -&gt; a)</code>, which is not necessarily a function type. E.g., <code>f</code> could be <code>[]</code>, making <code>fmap (*) 3</code> a list of functions, not a function."}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1440614049, "post_id": 32232126, "comment_id": 52350697, "body": "I do not know what to expect at all from the output, so seeing an example of how to use the output would help me to grasp the problem."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 1, "creation_date": 1440616255, "post_id": 32232126, "comment_id": 52351954, "body": "You can write a <code>Num</code> instance for lists, like <code>instance Num a =&gt; [a] where fromInteger x = [fromInteger x]</code>, then <code>fmap (*) 3</code> would be <code>fmap (*) [3]</code>, which is <code>[(*) 3]</code>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1440622507, "post_id": 32232126, "comment_id": 52355335, "body": "@kurzweil4 - I added some more to my answer."}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1440623926, "post_id": 32232126, "comment_id": 52356009, "body": "Thank you for the update! So the answer then is that the output of <code>fmap (*) 3</code> is a functor of function of <code>a -&gt;a</code>?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1440702178, "post_id": 32232126, "comment_id": 52394923, "body": "It&#39;s valuable to note that any for any <code>Applicative f</code> instance there is a generic way of writing a <code>Num a =&gt; Num (f a)</code> instance. Operations like <code>fmap (*)</code> are completely normal with <code>Applicative</code> instances\u2014in the the common applicative <code>f &lt;$&gt; a &lt;*&gt; b</code> idiom, <code>&lt;$&gt;</code> is just a synonym for <code>fmap</code>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 9, "last_activity_date": 1440622432, "last_edit_date": 1440622432, "creation_date": 1440607177, "answer_id": 32232126, "question_id": 32231659, "link": "https://stackoverflow.com/questions/32231659/do-not-understand-fmap-of-function-and-value-in-haskell/32232126#32232126", "title": "Do Not Understand fmap of Function and Value in Haskell", "body": "<p>The key is here:</p>\n\n<pre><code>fmap (*) 3 :: (Functor f, Num a, Num (f a)) =&gt; f (a -&gt; a)\n                                 ^^^^^^^^^\n</code></pre>\n\n<p>In Haskell numeric literals are overloaded, so <code>3</code> could have any type <code>b</code> as long as <code>b</code> has a <code>Num</code> instance.</p>\n\n<p>The compiler goes through the following analysis:</p>\n\n<ol>\n<li>3 has some type <code>b</code> with constraint <code>Num b</code></li>\n<li><code>fmap</code> has type <code>Functor f =&gt; (a -&gt; c) -&gt; f a -&gt; f c</code></li>\n<li>So <code>*</code> has type <code>a -&gt; c</code> and 3 has type <code>f a</code></li>\n<li><code>*</code> has type <code>Num a =&gt; a -&gt; a -&gt; a</code> so <code>c</code> = <code>a -&gt; a</code>, and <code>a</code> has constraint <code>Num a</code></li>\n<li><code>b</code> = <code>f a</code> from (1) and (2)</li>\n</ol>\n\n<p>Gathering up all of the constraints and equivalences:</p>\n\n<pre><code>fmap (*) 3 :: ( Functor f,       -- by (2)\n                Num a,           -- by (4)\n                Num (f a)        -- by (1) and (5)\n              ) =&gt; f ( a -&gt; a )  -- by (2) and c = a -&gt; a\n</code></pre>\n\n<p>Update:</p>\n\n<p>You asked for an example where <code>fmap (*) 3</code> makes sense. What is problematic here is that <code>(*)</code> has arity 2 and <code>fmap</code> is usually used with a function of a single argument (arity 1). For instance:</p>\n\n<pre><code>fmap (+1) (Just 3)  = Just 4\nfmap (+1) Nothing   = Nothing\nfmap (*6) [1,2,3]   = [6,12,18]\nfmap words getLine  = do x &lt;- getLine; return (words x)\n</code></pre>\n\n<p>Note: <code>(+1)</code> is just the \"add 1\" function, e.g. <code>\\x -&gt; x+1</code>, and <code>(*6)</code> is just the multiply by 6 function, e.g. <code>\\x -&gt; x*6</code>.</p>\n\n<p>So fmapping <code>(*) :: Int -&gt; Int -&gt; Int</code> is somewhat unusual. Of course, we  can interpret the type of <code>(*)</code> to be <code>Int -&gt; (Int -&gt; Int)</code> which gives it arity 1, but then dealing with functors of functions is getting into a level of abstraction that we don't normally deal with.</p>\n"}], "owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 32232126, "answer_count": 1, "score": 0, "last_activity_date": 1440622432, "creation_date": 1440605599, "question_id": 32231659, "link": "https://stackoverflow.com/questions/32231659/do-not-understand-fmap-of-function-and-value-in-haskell", "title": "Do Not Understand fmap of Function and Value in Haskell", "body": "<p>I am confused about the result of this expression:</p>\n\n<pre><code>fmap (*) 3\n</code></pre>\n\n<p>Which produces type:</p>\n\n<pre><code>fmap (*) 3 :: (Functor f, Num a, Num (f a)) =&gt; f (a -&gt; a)\n</code></pre>\n\n<p>What I was expecting is that the result would be the same as doing:</p>\n\n<pre><code>(*) 3\n</code></pre>\n\n<p>Which produces a 1-parameter function:</p>\n\n<pre><code>Prelude&gt; (*) 3 $ 10\n30\n</code></pre>\n\n<p>I was expecting that <code>fmap</code> would apply <code>3</code> to <code>(*)</code> producing <code>(*3)</code>, but the following produces an error:</p>\n\n<pre><code>Prelude&gt; (fmap (*) 3) 10\n\n&lt;interactive&gt;:201:1:\n    Non type-variable argument in the constraint: Num (a -&gt; a)\n    (Use FlexibleContexts to permit this)\n    When checking that `it' has the inferred type\n      it :: forall a a1. (Num a, Num a1, Num (a1 -&gt; a)) =&gt; a -&gt; a\n</code></pre>\n\n<p>What type of parameter is the result of <code>(fmap (*) 3)</code> expecting?</p>\n"}, {"tags": ["haskell", "generics"], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 4841072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d2ced6c99273e990b4c9b38f403244f5?s=128&d=identicon&r=PG&f=1", "display_name": "Zale", "link": "https://stackoverflow.com/users/4841072/zale"}, "edited": false, "score": 0, "creation_date": 1440592861, "post_id": 32226825, "comment_id": 52336242, "body": "Thanks for your answer. But what does the error message mean? Why can&#39;t i use &quot;Rep a&quot; but &quot;Rep Person&quot;?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 133, "user_id": 4841072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d2ced6c99273e990b4c9b38f403244f5?s=128&d=identicon&r=PG&f=1", "display_name": "Zale", "link": "https://stackoverflow.com/users/4841072/zale"}, "edited": false, "score": 0, "creation_date": 1440593277, "post_id": 32226825, "comment_id": 52336555, "body": "The complete error message gives this clue: <code>NB: \u2018Rep\u2019 is a type function, and may not be injective</code>"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1440593411, "last_edit_date": 1440593411, "creation_date": 1440592430, "answer_id": 32226825, "question_id": 32226158, "link": "https://stackoverflow.com/questions/32226158/what-does-this-ghc-generic-function-signature-error-message-mean/32226825#32226825", "title": "What does this GHC.Generic function signature error message mean?", "body": "<p>Just omit the type signature for <code>getName</code>.</p>\n\n<p>Running your code in a ghci session yields this:</p>\n\n<pre><code>ghci&gt; :t getName\ngetName :: Datatype d =&gt; t d f a -&gt; [Char]\n\nghci&gt; getName p\n\"Lib9_Person\"\n\nghci&gt; :t getName p\ngetName p :: [Char]\n</code></pre>\n\n<p>Note: My code resides in the module <code>Lib9</code> which explains the output for <code>getName p</code>.</p>\n\n<p>If you want to give it a type signature, enable <code>KindSignatures</code> and use:</p>\n\n<pre><code>getName :: Datatype d =&gt; (t :: * -&gt; (* -&gt; *) -&gt; * -&gt; *) d f a -&gt; [Char]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 2, "last_activity_date": 1440593431, "creation_date": 1440593431, "answer_id": 32227175, "question_id": 32226158, "link": "https://stackoverflow.com/questions/32226158/what-does-this-ghc-generic-function-signature-error-message-mean/32227175#32227175", "title": "What does this GHC.Generic function signature error message mean?", "body": "<p><code>Rep</code> is an associated type-synonym i.e. the actual type can be anything depending on the implementation of the specific type-class instance. There is no guarantee that <code>Rep a</code> for any arbitrary <code>a</code> is a type that is compatible with the type required by the function <code>moduleName</code>.</p>\n\n<p><code>Rep Person</code> works because the compiler is able to check that the associated type for the type-class instance of <code>Generic Person</code> fits the type expected by <code>moduleName</code> (which is <code>Datatype d =&gt; t d (f :: * -&gt; *) a</code>).</p>\n\n<p>Instead of using <code>Rep a</code> you can instead use</p>\n\n<pre><code>getName :: Datatype d =&gt; t d (f :: * -&gt; *) a -&gt; String\ngetName f = concat [ moduleName f\n                   , \"_\"\n                   , datatypeName f\n                   ]\n</code></pre>\n\n<p>Although you also need to enable the <code>KindSignatures</code> extension.</p>\n"}], "owner": {"reputation": 133, "user_id": 4841072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d2ced6c99273e990b4c9b38f403244f5?s=128&d=identicon&r=PG&f=1", "display_name": "Zale", "link": "https://stackoverflow.com/users/4841072/zale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 32227175, "answer_count": 2, "score": 4, "last_activity_date": 1440594930, "creation_date": 1440590666, "last_edit_date": 1440594930, "question_id": 32226158, "link": "https://stackoverflow.com/questions/32226158/what-does-this-ghc-generic-function-signature-error-message-mean", "title": "What does this GHC.Generic function signature error message mean?", "body": "<p>I'm learning Haskell. Why can't I change <code>Person</code> to type variable <code>a</code> in the method signature of <code>getName</code></p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\nmodule Main where\n\nimport GHC.Generics\n\n\ndata Person = Person { id   :: Int\n                     , name :: String\n                     , age  :: Int }\n            deriving (Generic, Show)\n\np = from $ Person 12 \"J\" 12\n\ngetName :: (Rep Person) x -&gt; String\n-- getName :: Generic a =&gt; (Rep a) x -&gt; String\n----^ Err: Couldn't match type \u2018Rep a0\u2019 with \u2018Rep a\ngetName f = concat [ moduleName f\n                   , \"_\"\n                   , datatypeName f\n                   ]\n\nn = getName p\n</code></pre>\n"}, {"tags": ["scala", "haskell", "scalaz", "lenses", "calmm"], "comments": [{"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1440593571, "post_id": 32223859, "comment_id": 52336830, "body": "Looks like what Scala calls a PLens is called a prism in Haskell. Turns out it&#39;s a dual concept to a lens working along sums where lenses work along products."}], "answers": [{"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 8, "last_activity_date": 1440588830, "last_edit_date": 1592644375, "creation_date": 1440584195, "answer_id": 32223875, "question_id": 32223859, "link": "https://stackoverflow.com/questions/32223859/whats-the-difference-between-a-lens-and-a-partial-lens/32223875#32223875", "title": "What&#39;s the difference between a lens and a partial lens?", "body": "<h3>Scalaz documentation</h3>\n<p>Below are the scaladocs for Scalaz's <code>LensFamily</code> and <code>PLensFamily</code>, with emphasis added on the diffs.</p>\n<p>Lens:</p>\n<blockquote>\n<p><a href=\"http://docs.typelevel.org/api/scalaz/nightly/index.html#scalaz.LensFamily\" rel=\"noreferrer\"><em><strong>A Lens Family</strong></em></a>, offering a purely functional means to access and retrieve <em><strong>a field</strong></em> transitioning from type <code>B1</code> to type <code>B2</code> in a record simultaneously transitioning from type <code>A1</code> to type <code>A2</code>. <em><strong><code>scalaz.Lens</code></strong></em> is a convenient alias for when <code>A1 =:= A2</code>, and <code>B1 =:= B2</code>.</p>\n<p>The term &quot;field&quot; should not be interpreted restrictively to mean a member of a class. For example, <em><strong>a lens family can address membership of a <code>Set</code></strong></em>.</p>\n</blockquote>\n<p>Partial lens:</p>\n<blockquote>\n<p><a href=\"http://docs.typelevel.org/api/scalaz/nightly/index.html#scalaz.PLensFamily\" rel=\"noreferrer\"><em><strong>Partial Lens Families</strong></em></a>, offering a purely functional means to access and retrieve <em><strong>an optional field</strong></em> transitioning from type <code>B1</code> to type <code>B2</code> in a record that is simultaneously transitioning from type <code>A1</code> to type <code>A2</code>. <em><strong><code>scalaz.PLens</code></strong></em> is a convenient alias for when <code>A1 =:= A2</code>, and <code>B1 =:= B2</code>.</p>\n<p>The term &quot;field&quot; should not be interpreted restrictively to mean a member of a class. For example, <em><strong>a partial lens family can address the nth element of a <code>List</code></strong></em>.</p>\n</blockquote>\n<h3>Notation</h3>\n<p>For those unfamiliar with scalaz, we should point out the symbolic type aliases:</p>\n<pre><code>type @&gt;[A, B] = Lens[A, B]\ntype @?&gt;[A, B] = PLens[A, B]\n</code></pre>\n<p>In infix notation, this means the type of a lens that retrieves a field of type <code>B</code> from a record of type <code>A</code> is expressed as <code>A @&gt; B</code>, and a partial lens as <code>A @?&gt; B</code>.</p>\n<h3>Argonaut</h3>\n<p><a href=\"http://argonaut.io/\" rel=\"noreferrer\">Argonaut</a> (a JSON library) provides a lot of examples of partial lenses, because the schemaless nature of JSON means that attempting to retrieve something from an arbitrary JSON value always has the possibility of failure. Here are a few examples of lens-constructing functions from Argonaut:</p>\n<ul>\n<li><code>def jArrayPL: Json @?&gt; JsonArray</code> \u2014 Retrieves a value only if the JSON value is an array</li>\n<li><code>def jStringPL: Json @?&gt; JsonString</code> \u2014 Retrieves a value only if the JSON value is a string</li>\n<li><code>def jsonObjectPL(f: JsonField): JsonObject @?&gt; Json</code> \u2014 Retrieves a value only if the JSON object has the field <code>f</code></li>\n<li><code>def jsonArrayPL(n: Int): JsonArray @?&gt; Json</code> \u2014 Retrieves a value only if the JSON array has an element at index <code>n</code></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 2, "creation_date": 1440609782, "post_id": 32228391, "comment_id": 52348161, "body": "I do not think &quot;partial lens&quot; and &quot;prism&quot; are quite the same thing. Note that the &quot;nth element of a <code>List</code>&quot; example @ChrisMartin&#39;s documentation paste lists isn&#39;t a prism. It&#39;s more like &quot;traversal with at most one target&quot;, which I don&#39;t think has its own type in <code>lens</code>."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1440612157, "post_id": 32228391, "comment_id": 52349559, "body": "Ah, that is a good point :( those would be &quot;affine traversals&quot; I suppose."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1440634265, "post_id": 32228391, "comment_id": 52359481, "body": "And Haskell has its own notion of <a href=\"https://hackage.haskell.org/package/data-lens-2.10.7/docs/Data-Lens-Partial-Common.html\" rel=\"nofollow noreferrer\">partial lens</a> that is distinct from prism, right?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 2, "creation_date": 1440634377, "post_id": 32228391, "comment_id": 52359513, "body": "@ChrisMartin That&#39;s a very different lens library, so not used as much I think."}], "tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": true, "score": 12, "last_activity_date": 1440612238, "last_edit_date": 1440612238, "creation_date": 1440596655, "answer_id": 32228391, "question_id": 32223859, "link": "https://stackoverflow.com/questions/32223859/whats-the-difference-between-a-lens-and-a-partial-lens/32228391#32228391", "title": "What&#39;s the difference between a lens and a partial lens?", "body": "<p>To describe partial lenses\u2014which I will henceforth call, according to the Haskell <code>lens</code> nomenclature, prisms (excepting that they're not! See the comment by \u00d8rjan)\u2014I'd like to begin by taking a different look at lenses themselves.</p>\n\n<p>A lens <code>Lens s a</code> indicates that given an <code>s</code> we can \"focus\" on a subcomponent of <code>s</code> at type <code>a</code>, viewing it, replacing it, and (if we use the lens family variation <code>Lens s t a b</code>) even changing its type.</p>\n\n<p>One way to look at this is that <code>Lens s a</code> witnesses an isomorphism, an equivalence, between <code>s</code> and the tuple type <code>(r, a)</code> for some <em>unknown</em> type <code>r</code>.</p>\n\n<pre><code>Lens s a ====== exists r . s ~ (r, a)\n</code></pre>\n\n<p>This gives us what we need since we can pull the <code>a</code> out, replace it, and then run things back through the equivalence backward to get a new <code>s</code> with out updated <code>a</code>.</p>\n\n<hr>\n\n<p>Now let's take a minute to refresh our high school algebra via algebraic data types. Two key operations in ADTs are multiplication and summation. We write the type <code>a * b</code> when we have a type consisting of items which have <em>both</em> an <code>a</code> and a <code>b</code> and we write <code>a + b</code> when we have a type consisting of items which are <em>either</em> <code>a</code> or <code>b</code>.</p>\n\n<p>In Haskell we write <code>a * b</code> as <code>(a, b)</code>, the tuple type. We write <code>a + b</code> as <code>Either a b</code>, the either type.</p>\n\n<p>Products represent bundling data together, sums represent bundling <em>options</em> together. Products can represent the idea of having many things only one of which you'd like to choose (at a time) whereas sums represent the idea of failure because you were hoping to take one option (on the <em>left</em> side, say) but instead had to settle for the other one (along the <em>right</em>).</p>\n\n<p>Finally, sums and products are categorical duals. They <em>fit together</em> and having one without the other, as most PLs do, puts you in an awkward place.</p>\n\n<hr>\n\n<p>So let's take a look at what happens when we <em>dualize</em> (part of) our lens formulation above.</p>\n\n<pre><code>exists r . s ~ (r + a)\n</code></pre>\n\n<p>This is a declaration that <code>s</code> is <em>either</em> a type <code>a</code> <em>or</em> some other thing <code>r</code>. We've got a <code>lens</code>-like thing that embodies the notion of option (and of failure) deep at it's core.</p>\n\n<p>This is exactly a prism (or partial lens)</p>\n\n<pre><code>Prism s a ====== exists r . s ~ (r + a)\n                 exists r . s ~ Either r a\n</code></pre>\n\n<p>So how does this work concerning some simple examples?</p>\n\n<p>Well, consider the prism which \"unconses\" a list:</p>\n\n<pre><code>uncons :: Prism [a] (a, [a])\n</code></pre>\n\n<p>it's equivalent to this</p>\n\n<pre><code>head :: exists r . [a] ~ (r + (a, [a]))\n</code></pre>\n\n<p>and it's relatively obvious what <code>r</code> entails here: total failure since we have an empty list!</p>\n\n<p>To substantiate the type <code>a ~ b</code> we need to write a way to transform an <code>a</code> into a <code>b</code> and a <code>b</code> into an <code>a</code> such that they invert one another. Let's write that in order to describe our prism via the mythological function</p>\n\n<pre><code>prism :: (s ~ exists r . Either r a) -&gt; Prism s a\n\nuncons = prism (iso fwd bck) where\n  fwd []     = Left () -- failure!\n  fwd (a:as) = Right (a, as)\n  bck (Left ())       = []\n  bck (Right (a, as)) = a:as\n</code></pre>\n\n<p>This demonstrates how to use this equivalence (at least in principle) to create prisms and also suggests that they ought to feel really natural whenever we're working with sum-like types such as lists.</p>\n"}, {"comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1440644593, "post_id": 32238680, "comment_id": 52361710, "body": "Do you have an opinion favoring the haskell or the scalaz design? Is one of them underfeatured or less correct than the other?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1440647005, "post_id": 32238680, "comment_id": 52362240, "body": "@ChrisMartin Sorry, I don&#39;t really know Scala."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 10, "last_activity_date": 1440638979, "last_edit_date": 1440638979, "creation_date": 1440634332, "answer_id": 32238680, "question_id": 32223859, "link": "https://stackoverflow.com/questions/32223859/whats-the-difference-between-a-lens-and-a-partial-lens/32238680#32238680", "title": "What&#39;s the difference between a lens and a partial lens?", "body": "<p>A lens is a \"functional reference\" that allows you to extract and/or update a generalized \"field\" in a larger value.  For an ordinary, non-partial lens that field is always required to be <em>there</em>, for any value of the containing type. This presents a problem if you want to look at something like a \"field\" which might not always be there.  For example, in the case of \"the nth element of a list\" (as listed in the Scalaz documentation @ChrisMartin pasted), the list might be too short.</p>\n\n<p>Thus, a \"partial lens\" generalizes a lens to the case where a field may or may not always be present in a larger value.</p>\n\n<p>There are at least three things in the Haskell <a href=\"https://hackage.haskell.org/package/lens\"><code>lens</code></a> library that you could think of as \"partial lenses\", none of which corresponds exactly to the Scala version:</p>\n\n<ul>\n<li>An ordinary <a href=\"https://hackage.haskell.org/package/lens-4.12.3/docs/Control-Lens-Lens.html#t:Lens\"><code>Lens</code></a> whose \"field\" is a <code>Maybe</code> type.</li>\n<li>A <a href=\"https://hackage.haskell.org/package/lens-4.12.3/docs/Control-Lens-Prism.html#t:Prism\"><code>Prism</code></a>, as described by @J.Abrahamson.</li>\n<li>A <a href=\"https://hackage.haskell.org/package/lens-4.12.3/docs/Control-Lens-Traversal.html#t:Traversal\"><code>Traversal</code></a>.</li>\n</ul>\n\n<p>They all have their uses, but the first two are too restricted to include all cases, while <code>Traversal</code>s are \"too general\". Of the three, only <code>Traversal</code>s support the \"nth element of list\" example.</p>\n\n<ul>\n<li><p>For the \"<code>Lens</code> giving a <code>Maybe</code>-wrapped value\" version, what breaks is the lens laws: to have a proper lens, you should be able to set it to <code>Nothing</code> to remove the optional field, then set it back to what it was, and then get back the same value.  This works fine for a <code>Map</code> say (and <a href=\"https://hackage.haskell.org/package/lens-4.12.3/docs/Control-Lens-At.html#g:1\"><code>Control.Lens.At.at</code></a> gives such a lens for <code>Map</code>-like containers), but not for a list, where deleting e.g. the <code>0</code>th element cannot avoid disturbing the later ones.</p></li>\n<li><p>A <code>Prism</code> is in a sense a generalization of a <em>constructor</em> (approximately case class in Scala) rather than a field.  As such the \"field\" it gives when present should contain <em>all</em> the information to regenerate the whole structure (which you can do with the <code>review</code> function.)</p></li>\n<li><p>A <code>Traversal</code> can do \"nth element of a list\" just fine, in fact there are at least two different functions <a href=\"https://hackage.haskell.org/package/lens-4.12.3/docs/Control-Lens-At.html#g:2\"><code>ix</code></a> and <a href=\"https://hackage.haskell.org/package/lens-4.12.3/docs/Control-Lens-Traversal.html#v:element\"><code>element</code></a> that both work for this (but generalize slightly differently to other containers).</p></li>\n</ul>\n\n<p>Thanks to the typeclass magic of <code>lens</code>, any <code>Prism</code> or <code>Lens</code> automatically works as a <code>Traversal</code>, while a <code>Lens</code> giving a <code>Maybe</code>-wrapped optional field can be turned into a <code>Traversal</code> of a plain optional field by composing with <code>traverse</code>.</p>\n\n<p>However, a <code>Traversal</code> is in some sense <em>too</em> general, because it is not restricted to a single field: A <code>Traversal</code> can have <em>any</em> number of \"target\" fields. E.g.</p>\n\n<pre><code>elements odd\n</code></pre>\n\n<p>is a <code>Traversal</code> that will happily go through all the odd-indexed elements of a list, updating and/or extracting information from them all.</p>\n\n<p>In theory, you could define a fourth variant (the \"affine traversals\" @J.Abrahamson mentions) that I think might correspond more closely to Scala's version, but due to a technical reason outside the <code>lens</code> library itself they would not fit well with the rest of the library - you would have to explicitly convert such a \"partial lens\" to use some of the <code>Traversal</code> operations with it.</p>\n\n<p>Also, it would not buy you much over ordinary <code>Traversal</code>s, since there's e.g. a simple operator <a href=\"https://hackage.haskell.org/package/lens-4.12.3/docs/Control-Lens-Fold.html#v:-94--63-\"><code>(^?)</code></a> to extract just the first element traversed.</p>\n\n<p>(As far as I can see, the technical reason is that the <a href=\"https://hackage.haskell.org/package/pointed-4.2.0.2/docs/Data-Pointed.html\"><code>Pointed</code></a> typeclass which would be needed to define an \"affine traversal\" is not a superclass of <code>Applicative</code>, which ordinary <code>Traversal</code>s use.)</p>\n"}], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1334, "favorite_count": 5, "accepted_answer_id": 32228391, "answer_count": 3, "score": 13, "last_activity_date": 1506511075, "creation_date": 1440584146, "last_edit_date": 1506511075, "question_id": 32223859, "link": "https://stackoverflow.com/questions/32223859/whats-the-difference-between-a-lens-and-a-partial-lens", "title": "What&#39;s the difference between a lens and a partial lens?", "body": "<p>A \"lens\" and a \"partial lens\" seem rather similar in name and in concept. How do they differ? In what circumstances do I need to use one or the other?</p>\n\n<p>Tagging Scala and Haskell, but I'd welcome explanations related to any functional language that has a lens library.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1440582394, "post_id": 32223008, "comment_id": 52329106, "body": "well the first one seems to have more &quot;batteries-included&quot; ;)"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1440586589, "post_id": 32223008, "comment_id": 52331989, "body": "This is strange. <code>Data.Functor.Constant</code> seems to be released in 2010, long after <code>Control.Applicative</code>. And it provides something that is less useful than what there was already available. So it really looks like <code>Constant a b</code> is pretty much useless..."}], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 4, "creation_date": 1440610781, "post_id": 32226565, "comment_id": 52348784, "body": "There&#39;s a <a href=\"https://mail.haskell.org/pipermail/libraries/2015-July/026014.html\" rel=\"nofollow noreferrer\">more recent proposal</a> by Kmett to move some types from <code>transformers</code> to <code>base</code>, in which he deliberately ignores <code>Constant</code> (I get a certain &quot;Die already!&quot; vibe from that discussion.) (To be fair, <code>lens</code> actually provides some support for it.)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 11, "last_activity_date": 1440597385, "last_edit_date": 1440597385, "creation_date": 1440591734, "answer_id": 32226565, "question_id": 32223008, "link": "https://stackoverflow.com/questions/32223008/whats-the-difference-between-const-and-constant/32226565#32226565", "title": "What&#39;s the difference between Const and Constant?", "body": "<p>They do the same thing indeed. As far as I'm aware of, most people use <code>Const</code> because it is older (as Bakuriu pointed out), is in <code>base</code> and has a shorter name. Case in point: <code>lens</code> uses <code>Const</code>. There was at least one <a href=\"http://thread.gmane.org/gmane.comp.lang.haskell.libraries/17189\" rel=\"noreferrer\">discussion about unifying them</a> in the libraries mailing list back in 2012, but it didn't went through, seemingly because of differences of opinion about the name and the most appropriate module for it.</p>\n"}], "owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 316, "favorite_count": 1, "accepted_answer_id": 32226565, "answer_count": 1, "score": 8, "last_activity_date": 1440597385, "creation_date": 1440581807, "question_id": 32223008, "link": "https://stackoverflow.com/questions/32223008/whats-the-difference-between-const-and-constant", "title": "What&#39;s the difference between Const and Constant?", "body": "<p>There seems to be two implementations of the constant functor:</p>\n\n<ul>\n<li><p><a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Applicative.html#t:Const\" rel=\"noreferrer\"><code>Const</code></a> in <code>Control.Applicative</code></p></li>\n<li><p><a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/Data-Functor-Constant.html\" rel=\"noreferrer\"><code>Constant</code></a> in <code>Data.Functor.Constant</code></p></li>\n</ul>\n\n<p>Why do both of them exist, and which one should I use?</p>\n"}, {"tags": ["haskell", "vim", "haskell-mode"], "answers": [{"tags": [], "owner": {"reputation": 156267, "user_id": 546861, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SIhsx.png?s=128&g=1", "display_name": "romainl", "link": "https://stackoverflow.com/users/546861/romainl"}, "is_accepted": false, "score": 1, "last_activity_date": 1440594051, "last_edit_date": 1440594051, "creation_date": 1440573335, "answer_id": 32220190, "question_id": 32219460, "link": "https://stackoverflow.com/questions/32219460/develop-haskell-code-with-vim-and-haskelmode-plugin/32220190#32220190", "title": "develop Haskell code with vim and haskelmode plugin", "body": "<p>From <a href=\"https://github.com/lukerandall/haskellmode-vim/blob/master/doc/haskellmode.txt#L242\" rel=\"nofollow\">the documentation</a>:</p>\n\n<pre><code>Finally, the mappings actually use &lt;LocalLeader&gt; behind the scenes, so if\nyou have to, you can redefine maplocalleader to something other than '_'.\nJust remember that the docs still refer to mappings starting with '_', to\navoid confusing the majority of users!-)\n</code></pre>\n\n<p>So you must press <kbd>_</kbd>, then <kbd>C</kbd>, then <kbd>T</kbd> in rapid succession to create a <code>tags</code> file for your project.</p>\n\n<p>Unless you have set your <code>&lt;LocalLeader&gt;</code> to something other than <code>_</code>.</p>\n"}], "owner": {"reputation": 91, "user_id": 2663390, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/xp0Kw.jpg?s=128&g=1", "display_name": "srncristea", "link": "https://stackoverflow.com/users/2663390/srncristea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1440594051, "creation_date": 1440570656, "question_id": 32219460, "link": "https://stackoverflow.com/questions/32219460/develop-haskell-code-with-vim-and-haskelmode-plugin", "title": "develop Haskell code with vim and haskelmode plugin", "body": "<p>I have a silly question, I'm sure, I use vim with haskell-mode plugin to develop on haskell but I'm not sure how to enable the keys combination define on the haskellmode -vim, for example:</p>\n\n<blockquote>\n  <p>|_ct| create |tags| file</p>\n  \n  <p>|_si| show info for id under cursor</p>\n  \n  <p>|_t| show type for id under cursor</p>\n  \n  <p>|_T| insert type declaration for id under cursor |balloon| show type\n  for id under mouse pointer</p>\n  \n  <p>|_?| browse Haddock entry for id under cursor</p>\n  \n  <p>|_?1| search Hoogle for id under cursor</p>\n  \n  <p>|_?2| search Hayoo! for id under cursor</p>\n</blockquote>\n\n<p>how to type a command on vim that start with '_' (I know there said that this represent cursor and than I suppose that I just have to type 'si' for that field but nothing is happened) on which mode have to type it, I suppose on normal mode. I work on Mac but the same problem I have on linux.</p>\n\n<p>Thanks\nSorin.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1440563476, "post_id": 32217973, "comment_id": 52319376, "body": "This question seems slightly confused. <code>chr</code> returns a <code>Char</code>; it knows nothing about hex or escape sequences."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1440563533, "post_id": 32217973, "comment_id": 52319396, "body": "That is, the output you are asking about is that of <code>print</code>, which just uses the <code>Show</code> instance of <code>Char</code>."}, {"owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "edited": false, "score": 0, "creation_date": 1440564722, "post_id": 32217973, "comment_id": 52319765, "body": "yes, of course. a typo. fixed. thanks."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 8, "last_activity_date": 1440564823, "last_edit_date": 1440564823, "creation_date": 1440564183, "answer_id": 32218151, "question_id": 32217973, "link": "https://stackoverflow.com/questions/32217973/change-output-format-of-chr-to-hexadecimal/32218151#32218151", "title": "change output format of chr to hexadecimal", "body": "<p>The short answer is that you can't change it.</p>\n\n<p><code>print x</code> is the same as <code>putStrLn (show x)</code> and you can't change the way <code>show</code> works for types which already have a Show instance defined.</p>\n\n<p>You can, however, define you own formatting functions:</p>\n\n<pre><code>fmtChar :: Char -&gt; String\nfmtChar ch = ...\n\nfmtString :: String -&gt; String\nfmtString s = \"\\\"\" ++ (concatMap fmtChar s) ++ \"\\\"\"\n</code></pre>\n\n<p>and use them where you want to see your format:</p>\n\n<pre><code>putStrLn $ fmtString [ chr 0x49, chr 0x9f ]\n</code></pre>\n\n<p>One way of defining <code>fmtChar</code>:</p>\n\n<pre><code>import Numeric (showHex)\n\nfmtChar ch =\n  if length s == 1\n    then s\n    else \"\\\\x\" ++ showHex (fromEnum ch) \"\"\n  where s = show ch\n</code></pre>\n\n<p>(Note: <code>Numeric</code> is in <code>base</code> so you already have it.)</p>\n"}], "owner": {"reputation": 26022, "user_id": 410102, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a70b7da5a3a712e800100e61ef8d8917?s=128&d=identicon&r=PG", "display_name": "akonsu", "link": "https://stackoverflow.com/users/410102/akonsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 1, "accepted_answer_id": 32218151, "answer_count": 1, "score": 4, "last_activity_date": 1440564823, "creation_date": 1440563011, "last_edit_date": 1440564703, "question_id": 32217973, "link": "https://stackoverflow.com/questions/32217973/change-output-format-of-chr-to-hexadecimal", "title": "change output format of chr to hexadecimal", "body": "<p>Suppose I have</p>\n\n<pre><code>print [chr 0x49, chr 0x9f]\n</code></pre>\n\n<p>which outputs</p>\n\n<pre><code>\"I\\159\"\n</code></pre>\n\n<p>How do I make <code>print</code> use hexadecimal numbers when it prints characters that have to be shown as escape sequences? So that my output reads:</p>\n\n<pre><code>\"I\\x9f\"\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1440554633, "post_id": 32216832, "comment_id": 52317379, "body": "Could you post any attempts you&#39;ve made so far? With which part are you having difficulty?"}, {"owner": {"reputation": 343, "user_id": 5066328, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-Sc93ZNN8dbo/AAAAAAAAAAI/AAAAAAAABVM/HfCPP8bagsM/photo.jpg?sz=128", "display_name": "christian russo", "link": "https://stackoverflow.com/users/5066328/christian-russo"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1440554721, "post_id": 32216832, "comment_id": 52317397, "body": "all, I dont know programming this function."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 1, "creation_date": 1440555130, "post_id": 32216832, "comment_id": 52317488, "body": "@christianrusso Why do you need to express it as <code>foldr</code>, and is that the difficulty? Are you able to write <code>split</code> another way?"}, {"owner": {"reputation": 343, "user_id": 5066328, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-Sc93ZNN8dbo/AAAAAAAAAAI/AAAAAAAABVM/HfCPP8bagsM/photo.jpg?sz=128", "display_name": "christian russo", "link": "https://stackoverflow.com/users/5066328/christian-russo"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1440555286, "post_id": 32216832, "comment_id": 52317517, "body": "I can&#39;t use a explicit recursion"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 2, "creation_date": 1440555364, "post_id": 32216832, "comment_id": 52317538, "body": "@christianrusso then you should at least write your code which uses explicit recursion. and then ask how to use <code>foldr</code>."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1440556133, "post_id": 32216832, "comment_id": 52317704, "body": "Does it have to be <code>foldr</code> or can it be <code>foldl</code>?"}, {"owner": {"reputation": 343, "user_id": 5066328, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-Sc93ZNN8dbo/AAAAAAAAAAI/AAAAAAAABVM/HfCPP8bagsM/photo.jpg?sz=128", "display_name": "christian russo", "link": "https://stackoverflow.com/users/5066328/christian-russo"}, "edited": false, "score": 0, "creation_date": 1440556296, "post_id": 32216832, "comment_id": 52317742, "body": "is the same. I can use foldl or foldr"}, {"owner": {"reputation": 10954, "user_id": 1315962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bea6dfaf2899091d64886a526503fd2?s=128&d=identicon&r=PG", "display_name": "andrewsi", "link": "https://stackoverflow.com/users/1315962/andrewsi"}, "edited": false, "score": 1, "creation_date": 1440556702, "post_id": 32216832, "comment_id": 52317827, "body": "@christianrusso - I&#39;ve rolled your change back. Please don&#39;t completely alter the text of questions, especially after you&#39;ve got answers - add a new question instead,"}], "answers": [{"comments": [{"owner": {"reputation": 343, "user_id": 5066328, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-Sc93ZNN8dbo/AAAAAAAAAAI/AAAAAAAABVM/HfCPP8bagsM/photo.jpg?sz=128", "display_name": "christian russo", "link": "https://stackoverflow.com/users/5066328/christian-russo"}, "edited": false, "score": 0, "creation_date": 1440556138, "post_id": 32216979, "comment_id": 52317706, "body": "I use this function split :: Eq a =&gt; a -&gt; [a] -&gt; [[ a ]]. And I have the follow error: Couldn&#39;t match type \u2018a\u2019 with \u2018Char\u2019"}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1440556364, "post_id": 32216979, "comment_id": 52317757, "body": "&#39;(c:x):xs` does not work. <code>c : x</code> would have type of <code>[a]</code>, but <code>: xs</code> expects type of <code>a</code>. Left associativity with <code>(:)</code> never works."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 1, "creation_date": 1440556453, "post_id": 32216979, "comment_id": 52317775, "body": "@Kwarrtz Except it <i>does</i> work. It&#39;s parenthesized. You <i>want</i> <code>c:x</code> to be of type <code>[a]</code>. <code>xs</code> is of type <code>[[a]]</code>."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 5, "last_activity_date": 1440556410, "last_edit_date": 1440556410, "creation_date": 1440555600, "answer_id": 32216979, "question_id": 32216832, "link": "https://stackoverflow.com/questions/32216832/split-with-foldr-in-haskell/32216979#32216979", "title": "Split with foldr in haskell", "body": "<p>Something like this should work:</p>\n\n<pre><code>foldr (\\c (x:xs) -&gt;\n    if c == '/'\n    then \"\":x:xs\n    else (c:x):xs\n  ) [\"\"] \"hello/my/friends\"\n</code></pre>\n\n<p>Generalized:</p>\n\n<pre><code>split on = foldr (\\c (x:xs) -&gt;\n    if c == on\n    then []:x:xs\n    else (c:x):xs\n  ) [[]]\n</code></pre>\n"}], "owner": {"reputation": 343, "user_id": 5066328, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-Sc93ZNN8dbo/AAAAAAAAAAI/AAAAAAAABVM/HfCPP8bagsM/photo.jpg?sz=128", "display_name": "christian russo", "link": "https://stackoverflow.com/users/5066328/christian-russo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 659, "favorite_count": 0, "accepted_answer_id": 32216979, "answer_count": 1, "score": 2, "last_activity_date": 1440559372, "creation_date": 1440554352, "last_edit_date": 1440559372, "question_id": 32216832, "link": "https://stackoverflow.com/questions/32216832/split-with-foldr-in-haskell", "title": "Split with foldr in haskell", "body": "<p>I need to program a function <code>split</code> using <code>foldr</code></p>\n\n<pre><code>split :: Eq a \u21d2 a \u2192 [a] \u2192 [[ a ]]\n</code></pre>\n\n<p>Examples:</p>\n\n<pre><code>split '/' \u201dhello/my/friends\u201d ----&gt; [\u201dhello\u201d,\u201dmy\u201d,\u201dfriends\u201d]\n</code></pre>\n\n<p>Here's what I've tried:</p>\n\n<pre><code>split :: Eq a \u21d2 a \u2192 [a] \u2192 [[ a ]]\nsplit str delim = let (start, end) = break (== delim) str\n                in start : if null end then [] else groupBy (tail end) delim \n</code></pre>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440550575, "post_id": 32216244, "comment_id": 52316478, "body": "Are you running compiled code? Are you comparing an interpreted <code>digits</code> to calling <code>show</code> which will run compiled code?"}, {"owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440550699, "post_id": 32216244, "comment_id": 52316506, "body": "@user5402 I think I was not running compiled code. Trying now."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1440554120, "post_id": 32216244, "comment_id": 52317280, "body": "Try redefining <code>digits :: Int -&gt; [Int]</code>, if that is legal within the realm of the question of course."}, {"owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "reply_to_user": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1440554168, "post_id": 32216244, "comment_id": 52317291, "body": "@Kwarrtz That speeds it up, but not by that much, and also it&#39;s required that I can find the digits of numbers such as <code>2^1000</code> or <code>100!</code>."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 2, "creation_date": 1440554626, "post_id": 32216244, "comment_id": 52317376, "body": "In that case, I think <code>digitsWithShow</code> is faster here for no other reason than that <code>show</code> already does almost what you are trying to do. Int to string conversion is a very low level operation (assembler on some processors, I think). Just out of curiosity, have you tried <code>digitsByShow = map read . show</code>? I&#39;d think it should be slower, but then again..."}, {"owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "reply_to_user": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1440555099, "post_id": 32216244, "comment_id": 52317481, "body": "@Kwarrtz <code>map read . show</code> doesn&#39;t work, neither does <code>(map read) . show</code>. Seems that <code>read</code> only works on a String, not a Char, so it&#39;s expecting <code>show</code> to return <code>[String]</code> but of course it returns <code>String</code>."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1440555862, "post_id": 32216244, "comment_id": 52317642, "body": "Oh, of course. I meant <code>map (read . (:[])) . show</code>."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440556423, "post_id": 32216244, "comment_id": 52317768, "body": "Why are you doing the division twice? <code>let (q,r) = quotRem x 10 in ...</code>"}, {"owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440557158, "post_id": 32216244, "comment_id": 52317944, "body": "@recursion.ninja I figured that out. I forgot to edit it in, but I did figure it out. I&#39;ll edit in the improvements I&#39;ve found."}, {"owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "reply_to_user": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1440557244, "post_id": 32216244, "comment_id": 52317973, "body": "@Kwarrtz With <code>-O</code>, the execution time of that method is about 30 seconds. That&#39;s about 60 times slower than <code>digitsByShow</code>."}], "answers": [{"comments": [{"owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "edited": false, "score": 1, "creation_date": 1440558138, "post_id": 32217316, "comment_id": 52318149, "body": "What about this makes it faster? Why is my version slower? Does this have something to do with mutability?"}, {"owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "edited": false, "score": 0, "creation_date": 1440560445, "post_id": 32217316, "comment_id": 52318673, "body": "The bang pattern barely sped anything up for me."}, {"owner": {"reputation": 402, "user_id": 4674225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66f4e8f49f5ccc43297b4b185cd3866b?s=128&d=identicon&r=PG&f=1", "display_name": "No_signal", "link": "https://stackoverflow.com/users/4674225/no-signal"}, "reply_to_user": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "edited": false, "score": 0, "creation_date": 1440561999, "post_id": 32217316, "comment_id": 52318999, "body": "@Justin It works for me. Where did you put it , <code>!(q,r)</code> or <code>digits !x</code> the second one did not help."}, {"owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "edited": false, "score": 0, "creation_date": 1440562468, "post_id": 32217316, "comment_id": 52319088, "body": "I copied exactly the code you wrote. It sped it up, but not by nearly as much as you suggested."}, {"owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "edited": false, "score": 0, "creation_date": 1440564271, "post_id": 32217316, "comment_id": 52319619, "body": "Looking at your benchmarks, it actually does sound proportional to the results I&#39;m getting. Thank you. PS Do you know if there is a good way to disassemble haskell code (at different points)?"}, {"owner": {"reputation": 402, "user_id": 4674225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66f4e8f49f5ccc43297b4b185cd3866b?s=128&d=identicon&r=PG&f=1", "display_name": "No_signal", "link": "https://stackoverflow.com/users/4674225/no-signal"}, "reply_to_user": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "edited": false, "score": 2, "creation_date": 1440565012, "post_id": 32217316, "comment_id": 52319834, "body": "You can use <code>-ddump-simpl</code> to look at the core code. real world haskell talks about it on ch 25 <a href=\"http://book.realworldhaskell.org/read/profiling-and-optimization.html\" rel=\"nofollow noreferrer\">Link</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440568667, "post_id": 32217316, "comment_id": 52321161, "body": "You can also tell GHC to spit out assembly. <code>-S</code>, maybe?"}], "tags": [], "owner": {"reputation": 402, "user_id": 4674225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66f4e8f49f5ccc43297b4b185cd3866b?s=128&d=identicon&r=PG&f=1", "display_name": "No_signal", "link": "https://stackoverflow.com/users/4674225/no-signal"}, "is_accepted": true, "score": 4, "last_activity_date": 1440564031, "last_edit_date": 1440564031, "creation_date": 1440558043, "answer_id": 32217316, "question_id": 32216244, "link": "https://stackoverflow.com/questions/32216244/why-is-the-better-digit-listing-function-slower/32217316#32217316", "title": "Why is the &quot;better&quot; digit-listing function slower?", "body": "<p>This is the best I can come up with.</p>\n\n<pre><code>digitsV2 :: (Integral a) =&gt; a -&gt; [Int]\ndigitsV2 n = go n []\n    where\n      go x xs\n          | x &lt; 10    = fromIntegral x : xs\n          | otherwise = case quotRem x 10 of\n                  (q,r) -&gt; go q (fromIntegral r : xs)\n</code></pre>\n\n<p>when compiled with <code>-O2</code> and tested with Criterion</p>\n\n<p><code>digits</code>       runs in 470.4 ms</p>\n\n<p><code>digitsByShow</code> runs in 421.8 ms</p>\n\n<p><code>digitsV2</code>     runs in 258.0 ms</p>\n\n<p>results may vary</p>\n\n<p>edit:\nI am not sure why building the list like this helps so much.\nBut you can improve your codes speed by strictly evaluating <code>quotRem x 10</code></p>\n\n<p>You can do this with BangPatterns</p>\n\n<pre><code>| otherwise = let !(q, r) = x `quotRem` 10 in (fromIntegral r) : (digits q)\n</code></pre>\n\n<p>or with case</p>\n\n<pre><code>| otherwise = case quotRem x 10 of\n                (q,r) -&gt; fromIntegral r : digits q\n</code></pre>\n\n<p>Doing this drops <code>digits</code> down to 323.5 ms</p>\n\n<p>edit: time without using Criterion</p>\n\n<p>digits = 464.3 ms</p>\n\n<p>digitsStrict = 328.2 ms</p>\n\n<p>digitsByShow = 259.2 ms</p>\n\n<p>digitV2 = 252.5 ms</p>\n\n<p>note: The criterion package measures software performance.</p>\n"}, {"tags": [], "owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "is_accepted": false, "score": 0, "last_activity_date": 1440576115, "last_edit_date": 1495535234, "creation_date": 1440576115, "answer_id": 32221054, "question_id": 32216244, "link": "https://stackoverflow.com/questions/32216244/why-is-the-better-digit-listing-function-slower/32221054#32221054", "title": "Why is the &quot;better&quot; digit-listing function slower?", "body": "<p>Let's investigate why <a href=\"https://stackoverflow.com/a/32217316/1896169\">@No_signal's solution</a> is faster.</p>\n\n<p>I made three runs of ghc:</p>\n\n<pre><code>ghc -O2 -ddump-simpl digits.hs &gt;digits.txt\nghc -O2 -ddump-simpl digitsV2.hs &gt;digitsV2.txt\nghc -O2 -ddump-simpl show.hs &gt;show.txt\n</code></pre>\n\n<p><i><code>digits.hs</code></i></p>\n\n<pre><code>digits :: (Integral a) =&gt; a -&gt; [Int]\ndigits x\n    | x &lt; 10 = [fromIntegral x]\n    | otherwise = let (q, r) = x `quotRem` 10 in (fromIntegral r) : (digits q)\n\nmain = return $ digits 1\n</code></pre>\n\n<p><i><code>digitsV2.hs</code></i></p>\n\n<pre><code>digitsV2 :: (Integral a) =&gt; a -&gt; [Int]\ndigitsV2 n = go n []\n    where\n      go x xs\n          | x &lt; 10    = fromIntegral x : xs\n          | otherwise = let (q, r) = x `quotRem` 10 in go q (fromIntegral r : xs)\n\nmain = return $ digits 1\n</code></pre>\n\n<p><i><code>show.hs</code></i></p>\n\n<pre><code>import Data.Char\n\ndigitsByShow :: (Integral a, Show a) =&gt; a -&gt; [Int]\ndigitsByShow = map (\\x -&gt; ord x - ord '0') . show\n\nmain = return $ digitsByShow 1\n</code></pre>\n\n<p>If you'd like to view the complete txt files, I placed them on ideone (rather than paste a 10000 char dump here):</p>\n\n<ul>\n<li><a href=\"http://ideone.com/dIfhY7\" rel=\"nofollow noreferrer\">digits.txt</a></li>\n<li><a href=\"http://ideone.com/SIKzQE\" rel=\"nofollow noreferrer\">digitsV2.txt</a></li>\n<li><a href=\"http://ideone.com/7CbZ2y\" rel=\"nofollow noreferrer\">show.txt</a></li>\n</ul>\n\n<hr>\n\n<p>If we carefully look through <i><code>digits.txt</code></i>, it appears that this is the relevant section:</p>\n\n<pre><code>lvl_r1qU = __integer 10\n\nRec {\nMain.$w$sdigits [InlPrag=[0], Occ=LoopBreaker]\n  :: Integer -&gt; (# Int, [Int] #)\n[GblId, Arity=1, Str=DmdType &lt;S,U&gt;]\nMain.$w$sdigits =\n  \\ (w_s1pI :: Integer) -&gt;\n    case integer-gmp-1.0.0.0:GHC.Integer.Type.ltInteger#\n           w_s1pI lvl_r1qU\n    of wild_a17q { __DEFAULT -&gt;\n    case GHC.Prim.tagToEnum# @ Bool wild_a17q of _ [Occ=Dead] {\n      False -&gt;\n        let {\n          ds_s16Q [Dmd=&lt;L,U(U,U)&gt;] :: (Integer, Integer)\n          [LclId, Str=DmdType]\n          ds_s16Q =\n            case integer-gmp-1.0.0.0:GHC.Integer.Type.quotRemInteger\n                   w_s1pI lvl_r1qU\n            of _ [Occ=Dead] { (# ipv_a17D, ipv1_a17E #) -&gt;\n            (ipv_a17D, ipv1_a17E)\n            } } in\n        (# case ds_s16Q of _ [Occ=Dead] { (q_a11V, r_X12h) -&gt;\n           case integer-gmp-1.0.0.0:GHC.Integer.Type.integerToInt r_X12h\n           of wild3_a17c { __DEFAULT -&gt;\n           GHC.Types.I# wild3_a17c\n           }\n           },\n           case ds_s16Q of _ [Occ=Dead] { (q_X12h, r_X129) -&gt;\n           case Main.$w$sdigits q_X12h\n           of _ [Occ=Dead] { (# ww1_s1pO, ww2_s1pP #) -&gt;\n           GHC.Types.: @ Int ww1_s1pO ww2_s1pP\n           }\n           } #);\n      True -&gt;\n        (# GHC.Num.$fNumInt_$cfromInteger w_s1pI, GHC.Types.[] @ Int #)\n    }\n    }\nend Rec }\n</code></pre>\n\n<p><i><code>digitsV2.txt</code></i>:</p>\n\n<pre><code>lvl_r1xl = __integer 10\n\nRec {\nMain.$wgo [InlPrag=[0], Occ=LoopBreaker]\n  :: Integer -&gt; [Int] -&gt; (# Int, [Int] #)\n[GblId, Arity=2, Str=DmdType &lt;S,U&gt;&lt;L,U&gt;]\nMain.$wgo =\n  \\ (w_s1wh :: Integer) (w1_s1wi :: [Int]) -&gt;\n    case integer-gmp-1.0.0.0:GHC.Integer.Type.ltInteger#\n           w_s1wh lvl_r1xl\n    of wild_a1dp { __DEFAULT -&gt;\n    case GHC.Prim.tagToEnum# @ Bool wild_a1dp of _ [Occ=Dead] {\n      False -&gt;\n        case integer-gmp-1.0.0.0:GHC.Integer.Type.quotRemInteger\n               w_s1wh lvl_r1xl\n        of _ [Occ=Dead] { (# ipv_a1dB, ipv1_a1dC #) -&gt;\n        Main.$wgo\n          ipv_a1dB\n          (GHC.Types.:\n             @ Int\n             (case integer-gmp-1.0.0.0:GHC.Integer.Type.integerToInt ipv1_a1dC\n              of wild2_a1ea { __DEFAULT -&gt;\n              GHC.Types.I# wild2_a1ea\n              })\n             w1_s1wi)\n        };\n      True -&gt; (# GHC.Num.$fNumInt_$cfromInteger w_s1wh, w1_s1wi #)\n    }\n    }\nend Rec }\n</code></pre>\n\n<p>I actually couldn't find the relevant section for <i><code>show.txt</code></i>. I'll work on that later.</p>\n\n<p>Right off the bat, <i><code>digitsV2.hs</code></i> produces shorter code. That's probably a good sign for it.</p>\n\n<p><i><code>digits.hs</code></i> seems to be following this psuedocode:</p>\n\n<pre class=\"lang-python prettyprint-override\"><code>def digits(w_s1pI):\n    if w_s1pI &lt; 10: return [fromInteger(w_s1pI)]\n    else:\n        ds_s16Q = quotRem(w_s1pI, 10)\n        q_X12h = ds_s16Q[0]\n        r_X12h = ds_s16Q[1]\n        wild3_a17c = integerToInt(r_X12h)\n\n        ww1_s1pO = r_X12h\n        ww2_s1pP = digits(q_X12h)\n        ww2_s1pP.pushFront(ww1_s1pO)\n        return ww2_s1pP\n</code></pre>\n\n<p><i><code>digitsV2.hs</code></i> seems to be following this psuedocode:</p>\n\n<pre class=\"lang-python prettyprint-override\"><code>def digitsV2(w_s1wh, w1_s1wi=[]): # actually disguised as go(), as @No_signal wrote\n    if w_s1wh &lt; 10:\n        w1_s1wi.pushFront(fromInteger(w_s1wh))\n        return w1_s1wi\n    else:\n        ipv_a1dB, ipv1_a1dC = quotRem(w_s1wh, 10)\n        w1_s1wi.pushFront(integerToIn(ipv1a1dC))\n        return digitsV2(ipv1_a1dC, w1_s1wi)\n</code></pre>\n\n<p>It might not be that these functions mutate lists like my psuedocode suggests, but this immediately suggests something: it looks as if <code>digitsV2</code> is fully tail-recursive, whereas <code>digits</code> is actually not (may have to use some Haskell trampoline or something). It appears as if Haskell needs to store all the remainders in <code>digits</code> before pushing them all to the front of the list, whereas it can just push them and forget about them in <code>digitsV2</code>. This is purely speculation, but it is well-founded speculation.</p>\n"}], "owner": {"reputation": 21009, "user_id": 1896169, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/jap8U.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/1896169/justin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 32217316, "answer_count": 2, "score": 3, "last_activity_date": 1440576115, "creation_date": 1440549501, "last_edit_date": 1440557870, "question_id": 32216244, "link": "https://stackoverflow.com/questions/32216244/why-is-the-better-digit-listing-function-slower", "title": "Why is the &quot;better&quot; digit-listing function slower?", "body": "<p>I was playing around with Project Euler #34, and I wrote these functions:</p>\n\n<pre><code>import Data.Time.Clock.POSIX\nimport Data.Char\n\ndigits :: (Integral a) =&gt; a -&gt; [Int]\ndigits x\n    | x &lt; 10 = [fromIntegral x]\n    | otherwise = let (q, r) = x `quotRem` 10 in (fromIntegral r) : (digits q)\n\ndigitsByShow :: (Integral a, Show a) =&gt; a -&gt; [Int]\ndigitsByShow = map (\\x -&gt; ord x - ord '0') . show\n</code></pre>\n\n<p>I thought that for sure <code>digits</code> has to be the faster one, as we don't convert to a String. I could not have been more wrong. I ran the two versions via <code>pe034</code>:</p>\n\n<pre><code>pe034 digitFunc = sum $ filter sumFactDigit [3..2540160]\n    where\n        sumFactDigit :: Int -&gt; Bool\n        sumFactDigit n = n == (sum $ map sFact $ digitFunc n)\n        sFact :: Int -&gt; Int\n        sFact n\n            | n == 0 = 1\n            | n == 1 = 1\n            | n == 2 = 2\n            | n == 3 = 6\n            | n == 4 = 24\n            | n == 5 = 120\n            | n == 6 = 720\n            | n == 7 = 5040\n            | n == 8 = 40320\n            | n == 9 = 362880\n\nmain = do\n    begin &lt;- getPOSIXTime\n    print $ pe034 digitsByShow -- or digits\n    end &lt;- getPOSIXTime\n    print $ end - begin\n</code></pre>\n\n<p>After compiling with <code>ghc -O</code>, <code>digits</code> consistently takes .5 seconds, while <code>digitsByShow</code> consistently takes .3 seconds. Why is this so? Why is the function which stays within Integer arithmetic slower, whereas the function which goes into string comparison is faster?</p>\n\n<p>I ask this because I come from programming in Java and similar languages, where the <code>% 10</code> trick of generating digits is way faster than the \"convert to String\" method. I haven't been able to wrap my head around the fact that converting to a string could be faster.</p>\n"}, {"tags": ["haskell", "packages", "cabal"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1440549420, "post_id": 32215569, "comment_id": 52316220, "body": "What&#39;s the <code>version:</code> line at the top of the cabal file for <code>UTFConverter</code>? Does it work if you just omit the bounds check for <code>UTFConverter</code>?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440604745, "post_id": 32215569, "comment_id": 52345206, "body": "@user5402: <a href=\"https://github.com/cirquit/UTFTConverter/blob/master/UTFTConverter.cabal\" rel=\"nofollow noreferrer\"><code>0.1.0.0</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 1, "last_activity_date": 1440606829, "last_edit_date": 1440606829, "creation_date": 1440605177, "answer_id": 32231525, "question_id": 32215569, "link": "https://stackoverflow.com/questions/32215569/executable-within-a-library-and-while-using-the-same-library-in-cabal/32231525#32231525", "title": "Executable within a library and while using the same library in cabal", "body": "<p>That's due to your library version being <code>0.1.0.0</code>, not <code>0.1</code>. They don't match up exactly, thus cabal doesn't recognize your library as a candidate. Instead, use <code>0.1.*</code> or <code>0.1.0.0</code> depending on your version policy:</p>\n\n<pre><code>executable UTFTConverter\nmain-is:         Main.hs\nbuild-depends:     base             &gt;=4.7  &amp;&amp; &lt;4.8\n                 , filepath         &gt;=1.3  &amp;&amp; &lt;1.4\n                 , directory        &gt;=1.2  &amp;&amp; &lt;1.3\n                 , time             &gt;=1.4  &amp;&amp; &lt;1.5\n                 , bytestring       &gt;=0.10 &amp;&amp; &lt;0.11\n                 , JuicyPixels      &gt;=3.2  &amp;&amp; &lt;3.3\n                 , UTFTConverter    ==0.1.0.0\nhs-source-dirs:  src\n</code></pre>\n\n<h3>References</h3>\n\n<ul>\n<li><a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#build-information\" rel=\"nofollow\">Cabal User Guide</a>, section \"Build Information\".</li>\n</ul>\n"}], "owner": {"reputation": 464, "user_id": 3825556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7ajzp.png?s=128&g=1", "display_name": "Cirquit", "link": "https://stackoverflow.com/users/3825556/cirquit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 32231525, "answer_count": 1, "score": 2, "last_activity_date": 1440606829, "creation_date": 1440544266, "question_id": 32215569, "link": "https://stackoverflow.com/questions/32215569/executable-within-a-library-and-while-using-the-same-library-in-cabal", "title": "Executable within a library and while using the same library in cabal", "body": "<p>This is my first try at an open source project, but I still can't get the right way to set up my <code>.cabal</code> file.</p>\n\n<p>I have have library, an executable and a (soon to come) test config.\nI want to use the library and within the executable, so the both of them can be used when it gets downloaded.</p>\n\n<p>I followed this <a href=\"https://howistart.org/posts/haskell/1\" rel=\"nofollow\">guide</a>, but I'm still struggling with the cabal-config as I only get it to work while importing everything again.</p>\n\n<p>My current directory</p>\n\n<pre><code>- src/\n    - Main.hs\n    - Format/\n          - C.hs\n          - Converter.hs\n          - Raw.hs\n          - RGB565.hs\n- tests/...\n- dist/...\n- UTFTConverter.cabal\n</code></pre>\n\n<p>The executable Main.hs header looks like this.</p>\n\n<pre><code>module Main where\n\nimport Format.C\nimport Format.Converter\n</code></pre>\n\n<p>The library files in Format/ look like this.</p>\n\n<pre><code>module Format.{filename} where\n...\n</code></pre>\n\n<p>This is what the cabal file looks like.</p>\n\n<pre><code>name:          UTFTConverter\n...\ncabal-version: &gt;=1.10\n\nlibrary\nexposed-modules:   Format.C\n                 , Format.Converter\n                 , Format.Raw\n                 , Format.RGB565\nbuild-depends:     base        &gt;=4.7  &amp;&amp; &lt;4.8\n                 , filepath    &gt;=1.3  &amp;&amp; &lt;1.4\n                 , directory   &gt;=1.2  &amp;&amp; &lt;1.3\n                 , time        &gt;=1.4  &amp;&amp; &lt;1.5\n                 , bytestring  &gt;=0.10 &amp;&amp; &lt;0.11\n                 , JuicyPixels &gt;=3.2  &amp;&amp; &lt;3.3\nhs-source-dirs:  src\n...\n\nexecutable UTFTConverter\nmain-is:         Main.hs\nbuild-depends:     base             &gt;=4.7  &amp;&amp; &lt;4.8\n                 , filepath         &gt;=1.3  &amp;&amp; &lt;1.4\n                 , directory        &gt;=1.2  &amp;&amp; &lt;1.3\n                 , time             &gt;=1.4  &amp;&amp; &lt;1.5\n                 , bytestring       &gt;=0.10 &amp;&amp; &lt;0.11\n                 , JuicyPixels      &gt;=3.2  &amp;&amp; &lt;3.3\n               --, UTFTConverter    ==0.1    &lt;-- this does not work\nhs-source-dirs:  src\n...\n\ntest-suite tests:\n...\n</code></pre>\n\n<p>Without the comment this error comes up when I <code>cabal build</code>.</p>\n\n<pre><code>...\ncabal: At least the following dependencies are missing:\nUTFTConverter ==0.1\n...\n</code></pre>\n\n<p>It works right now, but in the tutorial the executable was using the library in the same cabal file.</p>\n\n<pre><code>executable bassbull\nmain-is:             Main.hs\nghc-options:         -rtsopts -O2\nbuild-depends:       base,\n                     bassbull,    -- &lt;-- this is the name of the library\n                     bytestring,\n                     cassava\nhs-source-dirs:      src\ndefault-language:    Haskell2010\n</code></pre>\n\n<p>I know this is currently working, but I would rather use it the right way from the start. Is this the \"right\" way?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440545670, "post_id": 32215568, "comment_id": 52315216, "body": "<code>sudo</code> seems appropriate... it does say it downloaded and installed the GHC complier..."}, {"owner": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440546255, "post_id": 32215568, "comment_id": 52315390, "body": "I was maybe a little unclear ... yes <code>sudo stack setup</code> solved the problem. My questions was if using sudo is the expected way (that is, there is a bug in the guide I was following) or if there is some other preferred method."}, {"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 0, "creation_date": 1440547749, "post_id": 32215568, "comment_id": 52315805, "body": "This may be a string question, but do you have read / write permissions for your home directory? Who is the current owner of the <code>.stack</code> directory in your home?"}, {"owner": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "reply_to_user": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 0, "creation_date": 1440548173, "post_id": 32215568, "comment_id": 52315908, "body": "@JustinWood I have read/write permission for my home directory. I&#39;m the owner of  the <code>.stack</code> directory <code>drwxr-xr-x  10 karl  staff    340 Aug 26 00:54 .stack</code>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 3, "creation_date": 1440556906, "post_id": 32215568, "comment_id": 52317882, "body": "Probably a directory under your <code>~&#47;.stack</code> is owned by root. At the cost of recompiling modules doing a <code>&#47;bin&#47;rm -rf ~&#47;.stack</code> is pretty safe. Then just do a <code>stack setup</code> again."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1440557178, "post_id": 32215568, "comment_id": 52317947, "body": "You shouldn&#39;t need <code>sudo</code> within your own home directory, for stack or anything else. I second user5402&#39;s suggestion."}], "answers": [{"tags": [], "owner": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "is_accepted": true, "score": 3, "last_activity_date": 1440584696, "creation_date": 1440584696, "answer_id": 32224059, "question_id": 32215568, "link": "https://stackoverflow.com/questions/32215568/permission-denied-when-installing-ghc-using-stack-setup/32224059#32224059", "title": "Permission denied when installing ghc using stack setup", "body": "<p>Thanks to the suggestion by @user5402 I found, that for some reason, <code>~/.stack/programs</code> was owned by root. </p>\n\n<p>After removing the <code>.stack</code> directory <code>stack setup</code> worked as expected. </p>\n"}], "owner": {"reputation": 445, "user_id": 3834375, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3262d94a862e25fc09204d0511481ce3?s=128&d=identicon&r=PG&f=1", "display_name": "Karl Marklund", "link": "https://stackoverflow.com/users/3834375/karl-marklund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2407, "favorite_count": 1, "accepted_answer_id": 32224059, "answer_count": 1, "score": 4, "last_activity_date": 1440584696, "creation_date": 1440544259, "question_id": 32215568, "link": "https://stackoverflow.com/questions/32215568/permission-denied-when-installing-ghc-using-stack-setup", "title": "Permission denied when installing ghc using stack setup", "body": "<p>I'm following <a href=\"http://seanhess.github.io/2015/08/04/practical-haskell-getting-started.html\" rel=\"nofollow\">http://seanhess.github.io/2015/08/04/practical-haskell-getting-started.html</a> to get started with the stack tool.</p>\n\n<pre><code>$&gt; stack --version\nVersion 0.1.3.1, Git revision 908b04205e6f436d4a5f420b1c6c646ed2b804d7\n</code></pre>\n\n<p>In the step \"Installing GHC\" I get <code>Permission denied</code>: </p>\n\n<pre><code>$&gt; stack setup\nRun from outside a project, using implicit global config\nUsing resolver: lts-3.2 from global config file: /Users/karl/.stack/global/stack.yaml\nPreparing to download ghc-7.10.2 .../Users/karl/.stack/programs/x86_64-osx/ghc-7.10.2.tar.bz2.tmp: \nopenBinaryFile: permission denied (Permission denied)\n</code></pre>\n\n<p>Is this expected (a bug in the guide) or a bug in <code>stack</code>?</p>\n\n<p>Running the same command with <code>sudo</code> seems to solve the problem. Is this the intended method?</p>\n\n<pre><code>$&gt; sudo stack setup\nPassword:\nDownloaded ghc-7.10.2.                                      \nInstalled GHC.     \nstack will use a locally installed GHC\nFor more information on paths, see 'stack path' and 'stack exec env'\nTo use this GHC and packages outside of a project, consider using:\nstack ghc, stack ghci, stack runghc, or stack exec\n</code></pre>\n\n<p>I'm running a fresh install of OS X 10.10.4 (Yosemite).</p>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1440540200, "post_id": 32214738, "comment_id": 52313390, "body": "My assumption is that it is because there is an instance declared for <code>Typ (Label x) (Label y)</code> but not for <code>Typ (Label x) String</code>. What is the definition of <code>Label</code>?"}, {"owner": {"reputation": 1066, "user_id": 369367, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a6a8914cf6878a20aa537209b6846929?s=128&d=identicon&r=PG", "display_name": "Prasanna K Rao", "link": "https://stackoverflow.com/users/369367/prasanna-k-rao"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1440540303, "post_id": 32214738, "comment_id": 52313428, "body": "<code>data Label (l :: Symbol) = Get</code> I was hoping to get a compile-time error for <code>func2</code>, and not a runtime error"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1440540413, "post_id": 32214738, "comment_id": 52313463, "body": "You may be interested in <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-910004.5.3\" rel=\"nofollow noreferrer\">this discussion of context reduction</a>. I&#39;m tempted to call it a bug that ghci complains: it probably should not be doing context reduction on user-supplied type signatures. Note that of course if you ever tried to use <code>func2</code> in a real program -- which would eventually trace back to a <code>main</code> which has no context, and in particular would not be allowed to have <code>Typ (Label &quot;la&quot;) String</code> in its context -- you would get a type error."}, {"owner": {"reputation": 1066, "user_id": 369367, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a6a8914cf6878a20aa537209b6846929?s=128&d=identicon&r=PG", "display_name": "Prasanna K Rao", "link": "https://stackoverflow.com/users/369367/prasanna-k-rao"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1440540679, "post_id": 32214738, "comment_id": 52313567, "body": "@DanielWagner Thanks. Let me read through the context reduction details."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1440545720, "post_id": 32214738, "comment_id": 52315230, "body": "This is an open type family, so someone could later come along and add a <code>type instance Type (Label x) String = ()</code> in a module that imports this module. A closed type family would disallow this."}], "answers": [{"comments": [{"owner": {"reputation": 1066, "user_id": 369367, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a6a8914cf6878a20aa537209b6846929?s=128&d=identicon&r=PG", "display_name": "Prasanna K Rao", "link": "https://stackoverflow.com/users/369367/prasanna-k-rao"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1440540627, "post_id": 32214874, "comment_id": 52313552, "body": "Yes @DanielWagner . Your understanding is correct. I am interested in why the type error is delayed."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1066, "user_id": 369367, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a6a8914cf6878a20aa537209b6846929?s=128&d=identicon&r=PG", "display_name": "Prasanna K Rao", "link": "https://stackoverflow.com/users/369367/prasanna-k-rao"}, "edited": false, "score": 3, "creation_date": 1440540824, "post_id": 32214874, "comment_id": 52313611, "body": "@PrasannaKRao &quot;Why it is delayed&quot; -- this part is easy. It is a general principle that complaints about unsatisfied constraints are delayed as long as possible, to support separate compilation. (With separate compilation, you may not know all the ways to satisfy a constraint.) But I&#39;m not sure about the &quot;and no farther&quot; part."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 1066, "user_id": 369367, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a6a8914cf6878a20aa537209b6846929?s=128&d=identicon&r=PG", "display_name": "Prasanna K Rao", "link": "https://stackoverflow.com/users/369367/prasanna-k-rao"}, "edited": false, "score": 0, "creation_date": 1440541112, "post_id": 32214874, "comment_id": 52313705, "body": "@PrasannaKRao I&#39;m sorry I misunderstood initially and have updated my answer."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 3, "last_activity_date": 1440540947, "last_edit_date": 1440540947, "creation_date": 1440540381, "answer_id": 32214874, "question_id": 32214738, "link": "https://stackoverflow.com/questions/32214738/understanding-type-families/32214874#32214874", "title": "Understanding type families", "body": "<p>I was able to duplicate what you described with this definition of <code>Label</code>:</p>\n\n<pre><code>import GHC.TypeLits (Symbol)\n\ndata Label (a :: Symbol)\n</code></pre>\n\n<p>And adding:</p>\n\n<pre><code>type instance Typ (Label x) String = ()\n</code></pre>\n\n<p>Then provides the type of <code>func2</code></p>\n\n<p><strong>Edit</strong></p>\n\n<p>Sorry I misunderstood the concern. My understanding is that checking the satisfiability of the constraint will be deferred until <code>func2</code> is actually used since an instance could be added later.</p>\n\n<p>For example, adding:</p>\n\n<pre><code>func3 = func2 (undefined :: Label \"la\") \"\"\n</code></pre>\n\n<p>Causes it to fail at compile time.</p>\n\n<p>The way I make sense of it is that <code>func2</code> is saying, if you give me a <code>Label \"la\"</code> and a <code>String</code> <em>and an instance of <code>Typ (Label \"la\") String</code> is in scope at the time</em>, I'll give you a <code>String</code>. But <code>func2</code> doesn't need to have an instance in scope to know <em>what it would do with one if it had it</em>.</p>\n"}], "owner": {"reputation": 1066, "user_id": 369367, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a6a8914cf6878a20aa537209b6846929?s=128&d=identicon&r=PG", "display_name": "Prasanna K Rao", "link": "https://stackoverflow.com/users/369367/prasanna-k-rao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 32214874, "answer_count": 1, "score": 6, "last_activity_date": 1442326994, "creation_date": 1440539604, "last_edit_date": 1442326994, "question_id": 32214738, "link": "https://stackoverflow.com/questions/32214738/understanding-type-families", "title": "Understanding type families", "body": "<p>I am learning Type Families and trying to understand why I am not getting a compile-time error under a specific case. </p>\n\n<p>My type family is defined as below:</p>\n\n<pre><code>type family Typ a b :: Constraint\ntype instance Typ (Label x) (Label y) = ()\n</code></pre>\n\n<p>I have two functions as below:</p>\n\n<pre><code>func1 :: (Typ (Label \"la\") (Label \"lb\")) =&gt; Label \"la\" -&gt; Label \"lb\" -&gt; String\nfunc1  = undefined\n\nfunc2 :: (Typ (Label \"la\") String) =&gt; Label \"la\" -&gt; String -&gt; String\nfunc2  = undefined\n</code></pre>\n\n<p>Both these functions compile OK. </p>\n\n<p>When I try to view the type of <code>func1</code>, I get the correct signature. But, when I try to view the type of <code>func2</code>, I get the error the following error </p>\n\n<blockquote>\n  <p>Could not deduce (Typ (Label \"la\") String)</p>\n</blockquote>\n\n<p>Why is this so? Can someone help me understand?</p>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 11, "creation_date": 1440536280, "post_id": 32213779, "comment_id": 52311665, "body": "You can not perform IO inside the pure <code>State</code> monad.  That is a designed restriction.  The purpose of <code>StateT</code> is specifically for bringing in effects from other monads, such as <code>IO</code>.  You&#39;ll want to have your type as <code>StateT Game IO Link</code>, then you&#39;ll be able to use <code>liftIO getLine</code> the same as you are now.  Keep in mind that <code>State s a = StateT s Identity a</code>, where <code>Identity</code> is the identity monad (it does nothing, essentially).  All you&#39;re doing is swapping out <code>Identity</code> for <code>IO</code> so you can perform <code>IO</code> actions inside your <code>State</code>."}, {"owner": {"reputation": 34692, "user_id": 356440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d16fc2844c1d9f8f815f318734554266?s=128&d=identicon&r=PG", "display_name": "Stephane Rolland", "link": "https://stackoverflow.com/users/356440/stephane-rolland"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1440536814, "post_id": 32213779, "comment_id": 52311895, "body": "it compiles directly, and I start to see <code>StateT</code> now. thanks for you your answer/comment."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 3, "last_activity_date": 1440558836, "creation_date": 1440558836, "answer_id": 32217412, "question_id": 32213779, "link": "https://stackoverflow.com/questions/32213779/is-it-possible-to-use-io-inside-state-monad-without-using-statet-and-st/32217412#32217412", "title": "Is it possible to use IO inside State monad, without using StateT and ST", "body": "<p>As @bheklilr said in his comment, you can't use IO from <code>State</code>. The reason for that, basically, is that <code>State</code> (which is just shorthand for <code>StateT</code> over <code>Identity</code>) is no magic, so it's not going to be able to use anything more than </p>\n\n<ul>\n<li>What you can already do in its base monad, <code>Identity</code></li>\n<li>The new operations provided by <code>State</code> itself</li>\n</ul>\n\n<p>However, that first point also hints at the solution: if you change the base monad from <code>Identity</code> to some other monad <code>m</code>, then you get the capability to use the effects provided by <code>m</code>. In your case, by setting <code>m</code> to <code>IO</code>, you're good to go.</p>\n\n<p>Note that if you have parts of your computation that <em>don't</em> need to do IO, but require access to your state, you can still express this fact by making their type something like</p>\n\n<pre><code>foo :: (Monad m) =&gt; Bar -&gt; StateT Game m Baz\n</code></pre>\n\n<p>You can then compose <code>foo</code> with computations in <code>StateT Game IO</code>, but its type also makes it apparent that it can't possibly do any IO (or anything else base monad-specific).</p>\n\n<p>You also mentioned <code>ST</code> in your question as possible solution. <code>ST</code> is not a monad transformer and thus doesn't allow you to import effects from some base monad.</p>\n"}], "owner": {"reputation": 34692, "user_id": 356440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d16fc2844c1d9f8f815f318734554266?s=128&d=identicon&r=PG", "display_name": "Stephane Rolland", "link": "https://stackoverflow.com/users/356440/stephane-rolland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 926, "favorite_count": 0, "accepted_answer_id": 32217412, "answer_count": 1, "score": 2, "last_activity_date": 1440558836, "creation_date": 1440535721, "last_edit_date": 1440558405, "question_id": 32213779, "link": "https://stackoverflow.com/questions/32213779/is-it-possible-to-use-io-inside-state-monad-without-using-statet-and-st", "title": "Is it possible to use IO inside State monad, without using StateT and ST", "body": "<p>In the code below I manage a game, which owns a list of links.\nAt each step of the game, I change the game state updating the list of links modified.</p>\n\n<p>As I am learning the State monad, I was trying to apply the <code>State</code> monad technique to this use case.</p>\n\n<p>Nonetheless, at each turn, I need to get a piece of info from IO, using <code>getLine</code></p>\n\n<p>this gives such a code</p>\n\n<pre><code>{-# LANGUAGE NamedFieldPuns #-}\n{-# LANGUAGE RecordWildCards #-}\nimport Control.Monad\nimport Control.Monad.State.Strict\nimport qualified Data.List as List\nimport qualified Control.Monad.IO.Class as IOClass\n\ntype Node = Int \ntype Link = (Node,Node)\ntype Links = [Link]\ntype Gateway = Node\ntype Gateways = [Gateway]\n\ndata Game = Game { nbNodes :: Int, links :: Links, gateways :: Gateways }\n\ncomputeNextTurn :: State Game Link\ncomputeNextTurn = do\n    g &lt;- get\n    inputLine &lt;- IOClass.liftIO getLine -- this line causes problem\n    let node = read inputLine :: Int\n    let game@(Game _ ls gs) = g\n    let linkToSever = computeLinkToSever game node\n    let ls' = List.delete linkToSever ls\n    let game' = game{links = ls'}\n    put game'\n    return linkToSever\n\ncomputeAllTurns :: State Game Links\ncomputeAllTurns = do\n            linkToSever &lt;- computeNextTurn\n            nextGames &lt;- computeAllTurns\n            return (linkToSever : nextGames)\n\ncomputeLinkToSever :: Game -&gt; Node -&gt; Link\ncomputeLinkToSever _ _ = (0,1) -- just a dummy value\n        -- this function doesnt compute really anything for the moment\n        -- but it will depend on the value of node i got from IO\n</code></pre>\n\n<p>However I get an error at compilation:</p>\n\n<blockquote>\n  <p>No instance for <code>(MonadIO Data.Functor.Identity.Identity)</code>\n       arising from a use of <code>liftIO</code></p>\n</blockquote>\n\n<p>and I get the same style of error, if I try to use <code>liftM</code> and <code>lift</code>.</p>\n\n<p>I have read some questions that are suggesting <code>StateT</code> and <code>ST</code>, which I don't grasp yet.</p>\n\n<p>I am wondering if my current techique with a simple State is doomed to fail, and that indeed I can not use <code>State</code>, but <code>StateT</code> / <code>ST</code> ?</p>\n\n<p>Or is there a possible operation to simply get the value from <code>getLine</code>, inside the <code>State</code> monad ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1440535542, "post_id": 32213649, "comment_id": 52311277, "body": "Please fix the indention in your code example - that is, post your actual code. Posting code other than what you&#39;re actually using just obfuscates the actual problem."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1440542703, "post_id": 32213649, "comment_id": 52314284, "body": "&quot;Can&#39;t the compiler get the type of <code>c</code> from the <code>T a b c</code> of <code>f</code>?&quot; Yes, but where does <code>f</code> get its <code>T a b c</code> from?"}, {"owner": {"reputation": 787, "user_id": 3307736, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e9015090707d0e02ee256b8c4687951f?s=128&d=identicon&r=PG&f=1", "display_name": "Larry", "link": "https://stackoverflow.com/users/3307736/larry"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1440542965, "post_id": 32213649, "comment_id": 52314372, "body": "@DanielWagner Sorry I dont think i understand how type family works. Isn&#39;t the T a b c in both f and g what I declare in an instance declaration using the data key word?"}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 4, "last_activity_date": 1440543062, "creation_date": 1440543062, "answer_id": 32215372, "question_id": 32213649, "link": "https://stackoverflow.com/questions/32213649/haskell-type-family-error/32215372#32215372", "title": "Haskell type family error", "body": "<p>Note that in the definition</p>\n\n<pre><code>h :: c -&gt; a -&gt; b\nh c a = g $ f a\n</code></pre>\n\n<p>there is no restriction that <code>f</code> and <code>g</code> refer to the <em>same</em> instance that you are defining <code>h</code> for. (And this flexibility is often useful for defining instances.)</p>\n\n<p>From type inference, the result of <code>g</code> is restricted to be of the same type <code>b</code>, and the argument of <code>f</code> is restricted to be of type <code>a</code>, but there's nothing saying that the <code>T a b c</code> passed from one to the other is using the same <code>c</code>!</p>\n\n<p>To fix this in this case, you can enable <code>ScopedTypeVariables</code> and do</p>\n\n<pre><code>    h c a = g (f a :: T a b c)\n</code></pre>\n\n<p>Note that this works because data families are \"injective\" (the type arguments of a data family can be deduced from the final type). If you had used a <em>type</em> family instead, even this wouldn't work, since then <code>T a b c</code> would not necessarily determine <code>c</code> at all.</p>\n"}], "owner": {"reputation": 787, "user_id": 3307736, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e9015090707d0e02ee256b8c4687951f?s=128&d=identicon&r=PG&f=1", "display_name": "Larry", "link": "https://stackoverflow.com/users/3307736/larry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 32215372, "answer_count": 1, "score": 5, "last_activity_date": 1440543062, "creation_date": 1440535274, "last_edit_date": 1440536343, "question_id": 32213649, "link": "https://stackoverflow.com/questions/32213649/haskell-type-family-error", "title": "Haskell type family error", "body": "<p>Sorry to bother you with this simple problem. I'm trying to learn how the type family extension works. When I fool around with it I encountered an error I couldn't figure out why.</p>\n\n<pre><code>class Foo a b c where\n    data T a b c :: *\n\n    f :: a -&gt; T a b c\n\n    g :: T a b c -&gt; b\n\n    h :: c -&gt; a -&gt; b\n    h c a = g $ f a\n</code></pre>\n\n<p>Error message:</p>\n\n<pre><code>    Could not deduce (Foo a b c0) arising from a use of \u2018g\u2019\nfrom the context (Foo a b c)\n  bound by the class declaration for \u2018Foo\u2019\n  at DB/Internal/Typecast.hs:(17,1)-(25,19)\nThe type variable \u2018c0\u2019 is ambiguous\nRelevant bindings include\n  a :: a (bound at DB/Internal/Typecast.hs:25:9)\n  h :: c -&gt; a -&gt; b (bound at DB/Internal/Typecast.hs:25:5)\nIn the expression: g\nIn the expression: g $ f a\nIn an equation for \u2018h\u2019: h c a = g $ f a\n</code></pre>\n\n<p>I don't understand how is c ambiguous in <code>T a b c</code> for <code>g</code>. Can't the compiler get the type of <code>c</code> from the <code>T a b c</code> of <code>f</code>?</p>\n\n<p>I just want the composite of <code>g . f</code></p>\n"}, {"tags": ["haskell", "ghc", "type-families"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1440531299, "post_id": 32211822, "comment_id": 52308932, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/16338175/type-families-extension-does-not-work-as-described\">Type Families extension does not work as described</a>"}], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 2, "creation_date": 1440544619, "post_id": 32211970, "comment_id": 52314893, "body": "Apparently the OP syntax <i>was</i> implemented for a while (in HEAD, not any released version), but <a href=\"https://ghc.haskell.org/trac/ghc/wiki/NewAxioms/ClosedTypeFamilies\" rel=\"nofollow noreferrer\">technical issues</a> led to it being retracted and replaced by the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/NewAxioms\" rel=\"nofollow noreferrer\">current closed type family version only</a>."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 8, "last_activity_date": 1440529216, "creation_date": 1440529216, "answer_id": 32211970, "question_id": 32211822, "link": "https://stackoverflow.com/questions/32211822/ghc-7-10-2-type-families-extension-doesnt-work/32211970#32211970", "title": "ghc 7.10.2 type families extension doesn&#39;t work", "body": "<p>You can't mix open and closed type family syntax like this, and I'm not sure where you are getting that idea from. The correct syntax is</p>\n\n<pre><code>type family F a :: * where\n  F (Maybe Int)  = Int\n  F (Maybe Bool) = Bool\n  F (Maybe a)    = String\n</code></pre>\n"}], "owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 32211970, "answer_count": 1, "score": 5, "last_activity_date": 1458384892, "creation_date": 1440528669, "last_edit_date": 1495540229, "question_id": 32211822, "link": "https://stackoverflow.com/questions/32211822/ghc-7-10-2-type-families-extension-doesnt-work", "title": "ghc 7.10.2 type families extension doesn&#39;t work", "body": "<p>I'm getting <code>parse error on input \u2018where\u2019</code> when trying the following example in GHC 7.10.2:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\ntype family F a :: *\ntype instance where\n  F (Maybe Int)  = Int\n  F (Maybe Bool) = Bool\n  F (Maybe a)    = String\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/questions/16338175/type-families-extension-does-not-work-as-described\">Same question was asked two years ago about GHC 7.4.2</a>.</p>\n\n<p>I used type families fine with GHC 7.6.* (can't remember last digit) this year. Is it a problem with GHC 7.10.2?</p>\n\n<p>According to <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/index.html\" rel=\"nofollow noreferrer\">the User's Guide</a>, type families are available.</p>\n\n<p>My GHC 7.10.2 and cabal 1.22.6.0 where installed from <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow noreferrer\">this PPA</a>.</p>\n"}, {"tags": ["list", "haskell", "recursion"], "comments": [{"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "edited": false, "score": 0, "creation_date": 1440517239, "post_id": 32207809, "comment_id": 52300707, "body": "Well the subsequences method works but my code is too slow :( What would you do? I just pushed my solution."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1440520480, "post_id": 32207809, "comment_id": 52302739, "body": "AFAIK this kind of problem is generally <i>hard</i> (as in computationally hard). So I wouldn&#39;t expect <i>any</i> solution to work efficiently for big areas."}, {"owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1440520684, "post_id": 32207809, "comment_id": 52302844, "body": "Hmm.. They have a reference solution here: <a href=\"https://github.com/instructure/contests/blob/master/2012-mebipenny/contest/kyles-kitchen/solution.rb\" rel=\"nofollow noreferrer\">github.com/instructure/contests/blob/master/2012-mebipenny/&hellip;</a> - and they have test cases. I time out on about half of them."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1440521179, "post_id": 32207809, "comment_id": 52303123, "body": "It may be. What I meant is that general tessellation problems are hard. Probably the shapes and number of shapes chosen allows a simple algorithm to find an optimal tessellation but with generic shapes you can&#39;t do much better than generate &amp; test and the number of tessellations is exponential."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1440521550, "last_edit_date": 1440521550, "creation_date": 1440520821, "answer_id": 32209525, "question_id": 32207809, "link": "https://stackoverflow.com/questions/32207809/how-to-recurse-to-find-maximum-number-of-tetris-tiles-that-will-fit/32209525#32209525", "title": "How to recurse to find maximum number of tetris tiles that will fit", "body": "<p>Update:</p>\n\n<p>There is a lot of literature on this kind of problem. Besides \"tetris packing problem\" you will also find useful results searching for \"polyomino packing\".</p>\n\n<p>In particular, this article might be useful:</p>\n\n<ul>\n<li><a href=\"http://www.mattbusche.org/blog/article/polycube\" rel=\"nofollow\">http://www.mattbusche.org/blog/article/polycube</a></li>\n</ul>\n\n<p>Original Answer:</p>\n\n<p>One issue I see is that you are not pruning your search enough.</p>\n\n<p>Your main search function is this:</p>\n\n<pre><code>maxTiles :: Grid -&gt; [Tile] -&gt; Int\nmaxTiles g ts =\n    let tss = subsequences ts\n        gs = map (\\ts -&gt; placeAllTiles ts g) tss\n        scores = map (uncurry scoreGrid) $ zip tss gs\n    in maximum scores\n</code></pre>\n\n<p>You are calling <code>placeAllTiles</code> on all subsequences of your tile set.\nSuppose your tile set is <code>A A B B C C D D</code> and after placing <code>A A B B</code> the grid is filled up. <code>maxTiles</code> will still call <code>placeAllTiles</code> with <code>A A B B C</code>, and <code>A A B B C C</code> and <code>A A B B C C D</code>, and others. You want to find a way to prune the search if you get into this kind of situation.</p>\n\n<p>You should also prune if there is no way to improve the score. In general this means you are going to have to use a search algorithm which keeps track of the current best solution and prunes away search paths which are not going to be fruitful.</p>\n\n<p>Here is a outline of a brute-force algorithm:</p>\n\n<ol>\n<li>Each space in the grid can be occupied by either a piece or\na \"blank\" space.</li>\n<li>Keep track of the current grid, the pieces remaining, and the\n   best solution so far.</li>\n<li>If there are no more available spaces in the grid, return\n   the best solution so far.</li>\n<li>If there are no more pieces, return the best solution so far.</li>\n<li>Pick some available grid square. Consider all possible ways of\n   filling that square with a piece or a \"blank\". For each of those\n   possible ways, find the best solution by recursing.</li>\n</ol>\n"}], "owner": {"reputation": 14449, "user_id": 105678, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/859da59b3e4097fa659aabb55412de10?s=128&d=identicon&r=PG", "display_name": "Sean Clark Hess", "link": "https://stackoverflow.com/users/105678/sean-clark-hess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1440521550, "creation_date": 1440515746, "question_id": 32207809, "link": "https://stackoverflow.com/questions/32207809/how-to-recurse-to-find-maximum-number-of-tetris-tiles-that-will-fit", "title": "How to recurse to find maximum number of tetris tiles that will fit", "body": "<p>I'm working on a practice problem about tiling a kitchen with Tetris tiles. Basically I have a certain number of tiles in Tetris shapes, and I want to find the maximum number I can fit on a given sized floor.  </p>\n\n<p><a href=\"https://github.com/instructure/contests/blob/master/2012-mebipenny/contest/kyles-kitchen/description.html\" rel=\"nofollow\">Here's the full problem description</a></p>\n\n<p>I already have a lot of useful functions, including calculating all possible placements of a tile on a grid, whether a given tile can be placed at all, etc. <a href=\"https://github.com/seanhess/mebipenny/blob/master/haskell/2012/KylesKitchen.hs\" rel=\"nofollow\">Here's what I have so far</a></p>\n\n<p>I can't figure out how to write the main function though. How should I be recursing through the tiles? </p>\n\n<p>One idea I had was to use <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:subsequences\" rel=\"nofollow\"><code>subsequences</code></a> to get all combinations of tiles, then see whether they all fit or not. Then I just find the largest list that fit. What other (better?) ways are there to do it? </p>\n"}, {"tags": ["haskell", "functional-programming", "memoization"], "comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440514245, "post_id": 32204926, "comment_id": 52298557, "body": "GHC has decided that you would probably use too much memory if you remembered function application, and its probably right. It does remember constants though."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1440514293, "post_id": 32204926, "comment_id": 52298598, "body": "Another haskell implementation would be free to memoize functions if it pleased."}], "answers": [{"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440514364, "post_id": 32205134, "comment_id": 52298648, "body": "It probably isn&#39;t magic, it just remembers what is given to it."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 4, "creation_date": 1440514800, "post_id": 32205134, "comment_id": 52298958, "body": "@PyRulez: there&#39;s no such thing as \u201cjust remembering\u201d, you need some sort of data structure. I suppose Mathematica uses a mutable hash map."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440514919, "post_id": 32205134, "comment_id": 52299034, "body": "You can remember them in evaluation order. Only a finite number of evaluations are ever performed. See unsafememo."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440522526, "post_id": 32205134, "comment_id": 52303919, "body": "Can you say a bit more about MemoTrie? How might I use to for example <a href=\"http://codereview.stackexchange.com/q/101851/37543\">here</a>?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1440526771, "post_id": 32205134, "comment_id": 52306363, "body": "This is exactly what gets usually done in python. You have a &quot;decorator&quot; (which is nothing than an higher order function that wraps a given function with the cache functionality) that keeps tracks of the results in a <code>dict</code> (a hashmap)."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440531122, "post_id": 32205134, "comment_id": 52308830, "body": "@PyRulez you mean like <code>map f [1..999999999999999999999999999999999]</code>, and then <code>f 999999999999</code> ? It would seem that memory is unfortunately more finite than the number of evaluations ...."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1440531771, "post_id": 32205134, "comment_id": 52309223, "body": "@Ingo More like <code>force (map f [1..999999999999999999999999999999999])</code> and then <code>f 999999999999</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440599406, "post_id": 32205134, "comment_id": 52341343, "body": "@raxacoricofallapatorius: <a href=\"http://hackage.haskell.org/package/MemoTrie-0.6.2/docs/Data-MemoTrie.html\" rel=\"nofollow noreferrer\">what do you mean</a>?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440599650, "post_id": 32205134, "comment_id": 52341500, "body": "Remember: &quot;new to Haskell&quot;. I&#39;m coming from a world where &quot;docs&quot; means something else, I guess. How, for example would I implement <code>g x y z :: String -&gt; Int -&gt; String -&gt; Int</code> as a memo?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440601110, "post_id": 32205134, "comment_id": 52342584, "body": "@raxacoricofallapatorius: you have <code>String -&gt; Int -&gt; String -&gt; Int</code> and want another <code>String -&gt; Int -&gt; String -&gt; Int</code> (with the property that each parameter be memoised). Clearly the particular types shouldn&#39;t matter, so the memoising-function should have a type of the form <code>(a-&gt;b-&gt;c-&gt;d) -&gt; a-&gt;b-&gt;c-&gt;d</code>, or whatever else type variables. You look in the documentation, and see <code>memo3 :: (HasTrie r, HasTrie s, HasTrie t) =&gt; (r -&gt; s -&gt; t -&gt; a) -&gt; r -&gt; s -&gt; t -&gt; a</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1440601384, "post_id": 32205134, "comment_id": 52342783, "body": "That was assuming that you actually want to memoise every possible combination of parameters \u2013 note that this may require an infeasible amount of memory! Perhaps the expensive calculation only depends on the first <code>String</code> parameter? Then you can make it so only that part is memoised, by writing you function in the form <code>f str1 = \\int str2 -&gt; ...</code>, and using <code>memo</code> to memoise it."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440601403, "post_id": 32205134, "comment_id": 52342799, "body": "That&#39;s what I was wondering. So the memoize a function with X arguments, I need to use (and there needs to be a) memoX in MemoTrie, right?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1440601632, "post_id": 32205134, "comment_id": 52342958, "body": "Yup, though in fact <code>memo3</code> is the highest they offer out of the box \u2013 but you can write any function of <i>n</i> arguments as a function of a single tuple with <i>n</i> fields. (That&#39;s basically what most other languages default to anyway; <a href=\"https://en.wikipedia.org/wiki/Currying\" rel=\"nofollow noreferrer\">just Haskell doesn&#39;t</a>. Which actually makes memoisation quite a bit nicer.)"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440601972, "post_id": 32205134, "comment_id": 52343218, "body": "And &quot;That&#39;s hardly less nice than the Mathematica version, is it?&quot; \u2014 It&#39;s very much less nice. It introduces introduces an additional function, <code>f&#39;</code> that requires me that I need to remember to use (instead of <code>f</code>) when I want performance (either in my other code or, critically, in the definition of <code>f</code>. Things might be better of the names automatically had some systematic representation (e.g. if memoization of <code>f</code> aways created a function named <code>f&#39;</code>.)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1440602247, "post_id": 32205134, "comment_id": 52343406, "body": "You <i>can&#39;t</i> use <code>f</code> in other code: it&#39;s not visible, because defined locally in <code>f&#39;</code>&#39;s scope. In fact you don&#39;t need to define <code>f</code> at all: just write <code>f&#39; = memo $ \\n -&gt; case n of ...</code>. Then you can&#39;t even use <code>f</code> withing <code>f&#39;</code>, because it doesn&#39;t exist! However, if for some reason you want to evaluate the function in some cases <i>without</i> memoisation, you can easily do that if there&#39;s both <code>f</code> and <code>f&#39;</code>. \u2014 What&#39;s also nice about the Haskell way is that it doesn&#39;t require any built-in language support. This makes the compiler simpler, and often simpler means it can optimise more agressively."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 12, "last_activity_date": 1440509589, "last_edit_date": 1440509589, "creation_date": 1440508759, "answer_id": 32205134, "question_id": 32204926, "link": "https://stackoverflow.com/questions/32204926/is-there-a-way-to-preserve-results-in-haskell/32205134#32205134", "title": "Is there a way to &quot;preserve&quot; results in Haskell?", "body": "<p>Use a suitable library, such as <a href=\"http://hackage.haskell.org/package/MemoTrie\">MemoTrie</a>.</p>\n\n<pre><code>import Data.MemoTrie\n\nf' = memo f\n where f 0 = ... \n       f n = f' ...\n</code></pre>\n\n<p>That's hardly less nice than the Mathematica version, is it?</p>\n\n<hr>\n\n<p>Regarding</p>\n\n<blockquote>\n  <p>&ldquo;why can't it simply (in effect) redefine evaluated functions to be their computed value?&rdquo;</p>\n</blockquote>\n\n<p>Well, it's not so easy in general. These values have to be stored somewhere. Even for an <code>Int</code>-valued function, you can't just allocate an array with all possible values &ndash; it wouldn't fit in memory. The list solution only works because Haskell is lazy and therefore allows infinite lists, but that's not particularly satisfying since lookup is <em>O</em>(<em>n</em>).\nFor other types it's simply hopeless &ndash; you'd need to somehow diagonalise an over-countably infinite domain.</p>\n\n<p>You need some cleverer organisation. I don't know how Mathematica does this, but it probably uses a lot of &ldquo;proprietary magic&rdquo;. I wouldn't be so sure that it does really work the way you'd like, for any inputs.</p>\n\n<p>Haskell fortunately has type classes, and these allow you to express exactly what a type needs in order to be quickly memoisable. <a href=\"http://hackage.haskell.org/package/MemoTrie-0.6.2/docs/Data-MemoTrie.html#t:HasTrie\">HasTrie</a> is such a class.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 1, "accepted_answer_id": 32205134, "answer_count": 1, "score": 5, "last_activity_date": 1440509589, "creation_date": 1440508183, "last_edit_date": 1492087233, "question_id": 32204926, "link": "https://stackoverflow.com/questions/32204926/is-there-a-way-to-preserve-results-in-haskell", "title": "Is there a way to &quot;preserve&quot; results in Haskell?", "body": "<p>I'm new to Haskell and understand that it is (basically) a pure functional language, which has the advantage that results to functions will not change across multiple evaluations. Given this, I'm puzzled by why I can't easily mark a function in such a way that its remembers the results of its first evaluation, and does not have to be evaluated again each time its value is required.</p>\n\n<p>In <a href=\"http://www.wolfram.com/mathematica/\" rel=\"nofollow noreferrer\"><em>Mathematica</em></a>, for example, there is a <a href=\"http://reference.wolfram.com/language/tutorial/FunctionsThatRememberValuesTheyHaveFound.html\" rel=\"nofollow noreferrer\">simple idiom</a> for accomplishing this:</p>\n\n<pre><code>f[x_]:=f[x]= ...\n</code></pre>\n\n<p>but in Haskell, the closest things I've found is <a href=\"https://wiki.haskell.org/Memoization\" rel=\"nofollow noreferrer\">something like</a></p>\n\n<pre><code>f' = (map f [0 ..] !!)\n   where f 0 = ... \n         f n = f' ...\n</code></pre>\n\n<p>which in addition to being far less clear (and apparently limited to <code>Int</code> arguments?) does not (seem to) preserve results within an interactive session.</p>\n\n<p>Admittedly (and clearly), I don't understand exactly what's going on here; but naively, it seems like Haskel should have some way, at the function definition level, of </p>\n\n<ul>\n<li>taking advantage of the fact that its functions are <em>functions</em> and skipping re-computation of their results once they have been computed, and</li>\n<li>indicating a desire to do this at the function definition level with a simple and clean idiom.</li>\n</ul>\n\n<p>Is there a way to accomplish this in Haskell that I'm missing? I understand (sort of) that Haskell can't store the evaluations as \"state\", but why can't it simply (in effect) redefine evaluated functions to be their computed value?</p>\n\n<hr>\n\n<p>This grows out of <a href=\"https://codereview.stackexchange.com/q/101851/37543\">this question</a>, in which lack of this feature results in terrible performance.</p>\n"}, {"tags": ["haskell", "where-clause"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 2262052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0194e9f234fef9e275a64a0ae5de36cb?s=128&d=identicon&r=PG", "display_name": "sch0rschi", "link": "https://stackoverflow.com/users/2262052/sch0rschi"}, "edited": false, "score": 0, "creation_date": 1440502050, "post_id": 32202733, "comment_id": 52289604, "body": "facepalm. 3 minutes left to mark your answer as the solution :D"}], "tags": [], "owner": {"reputation": 848, "user_id": 5263547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5765579c508aa191ce2c5aa64d478073?s=128&d=identicon&r=PG&f=1", "display_name": "JHobern", "link": "https://stackoverflow.com/users/5263547/jhobern"}, "is_accepted": true, "score": 4, "last_activity_date": 1440501802, "creation_date": 1440501802, "answer_id": 32202733, "question_id": 32202605, "link": "https://stackoverflow.com/questions/32202605/parse-error-on-input-where/32202733#32202733", "title": "Parse Error on Input \u2018where\u2019", "body": "<p>In the second guard of minXRec you don't have a conditional test. You will need to change</p>\n\n<pre><code>| minXRec [p1, p2, a*p1+p0] [q1, q2, a*q1+q0] newM newD newA n\n</code></pre>\n\n<p>to most probably</p>\n\n<pre><code>| otherwise = minXRec [p1, p2, a*p1+p0] [q1, q2, a*q1+q0] newM newD newA n\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 2262052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0194e9f234fef9e275a64a0ae5de36cb?s=128&d=identicon&r=PG", "display_name": "sch0rschi", "link": "https://stackoverflow.com/users/2262052/sch0rschi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2401, "favorite_count": 0, "accepted_answer_id": 32202733, "answer_count": 1, "score": 3, "last_activity_date": 1440506391, "creation_date": 1440501371, "last_edit_date": 1440506391, "question_id": 32202605, "link": "https://stackoverflow.com/questions/32202605/parse-error-on-input-where", "title": "Parse Error on Input \u2018where\u2019", "body": "<p>I am trying to \"solve\" the Pell's equation for a given <code>d</code>:  <code>x^2 - d * y^2 = 1</code>, or at least I want to get the minimal <code>x &gt; 0</code> which will solve the equation. So far so good. Here is my Haskell code</p>\n\n<pre><code>minX :: Integer -&gt; Integer\nminX n  | isSquare n = 1\n        | otherwise  = minXRec [0,1,intSqrt n] [1,0,1] 0 1 (intSqrt n) n\n\nminXRec :: [Integer] -&gt; [Integer] -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer -&gt; Integer\nminXRec (p0:p1:p2:x) (q0:q1:q2:y) m d a n\n    | p2*p2 - n*q2*q2 == 1 = p2\n    | minXRec [p1, p2, newA*p2+p1] [q1, q2, newA*q2+q1] newM newD newA n\n    where\n        newM = d*a-m\n        newD = quot (n-newM*newM) d\n        newA = quot (intSqrt n + newM) newD\n</code></pre>\n\n<p>The logic of the code should work fine, but on compiling I get</p>\n\n<pre><code>PE66.hs:28:9: parse error on input \u2018where\u2019\n</code></pre>\n\n<p>Which does not provide me with enough information to fix the problem.\nI already tried to put this in an <code>let .. in ..</code> style but I, like this, did not get it to work.</p>\n\n<p>Where is my mistake?</p>\n"}, {"tags": ["haskell", "yesod", "haskell-stack"], "comments": [{"owner": {"reputation": 20971, "user_id": 3576214, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d2c5a0f2653e7d11d518b584f4c46536?s=128&d=identicon&r=PG", "display_name": "Damjan Pavlica", "link": "https://stackoverflow.com/users/3576214/damjan-pavlica"}, "edited": false, "score": 0, "creation_date": 1527008692, "post_id": 32200773, "comment_id": 87959696, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/14589358/could-not-find-module-yesod\">Could not find module `Yesod&#39;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 6, "last_activity_date": 1440502100, "last_edit_date": 1495542782, "creation_date": 1440502100, "answer_id": 32202818, "question_id": 32200773, "link": "https://stackoverflow.com/questions/32200773/getting-could-not-find-module-yesod-when-i-try-to-run-first-example-from-yes/32202818#32202818", "title": "Getting &quot;Could not find module `Yesod&#39;&quot; when I try to run first example from Yesod book", "body": "<p><code>runhaskell hello-world.hs</code> and <code>ghc-pkg list</code> will default to using the global system and user package databases (that is, the ones cabal-instal normally uses), and not the snapshot and project-specific ones used by stack (see also: <a href=\"https://stackoverflow.com/q/31393189/2751851\">Why doesn't stack add packages to the ghc package database?</a>). You should instead use <code>stack runghc hello-world.hs</code> and <code>stack exec -- ghc-pkg list</code>. The stack commands ensure the GHC tools use the appropriate package databases (and also the appropriate versions of GHC, in case you ever need a <code>stack setup</code> to use a different GHC than the one installed system-wide). </p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 5080857, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A194R.jpg?s=128&g=1", "display_name": "Wayne M Adams", "link": "https://stackoverflow.com/users/5080857/wayne-m-adams"}, "is_accepted": false, "score": 1, "last_activity_date": 1515888638, "creation_date": 1515888638, "answer_id": 48245521, "question_id": 32200773, "link": "https://stackoverflow.com/questions/32200773/getting-could-not-find-module-yesod-when-i-try-to-run-first-example-from-yes/48245521#48245521", "title": "Getting &quot;Could not find module `Yesod&#39;&quot; when I try to run first example from Yesod book", "body": "<p>Your results may vary, but this worked for me (on 13 Jan 2018):</p>\n\n<ul>\n<li>Mac OS 10.13.2 (High Sierra)</li>\n<li>Searched Hackage for Yesod, found 1.4.5 at <a href=\"https://hackage.haskell.org/package/yesod-1.4.5/docs/Yesod.html\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/yesod-1.4.5/docs/Yesod.html</a></li>\n<li>stack install yesod-1.4.5</li>\n<li>Got dependency error with suggestion to add conduit-extra-1.1.13.1 to extra-deps (in ~/.stack/global/stack.yaml).</li>\n<li>Tried again; got more dependency errors, with the result being that I ended up with:</li>\n<li>extra-deps: [\"gtk-mac-integration-0.3.4.0\",\"conduit-extra-1.2.3.2\",\"conduit-1.2.13\",\"streaming-commons-0.1.18\",\"typed-process-0.2.1.0\",\"unliftio-core-0.1.1.0\"] (You might get different recommendations; I just followed the ones I got. Note: I already had the gtk-mac-integration extra-dep before I started).</li>\n<li>successfully stack-installed yesod-1.4.5</li>\n<li>stack runghc helloworld.hs</li>\n<li>success!</li>\n</ul>\n\n<p>In hindsight, it should seem obvious that module \"Yesod\" would not be found it it had not yet been installed. I usually work within a stack-created Haskell project, and in that case would have taken the usual steps to ensure the dependency was present. I usually don't run applications with \"stack runghc\".</p>\n"}], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1330, "favorite_count": 1, "accepted_answer_id": 32202818, "answer_count": 2, "score": 4, "last_activity_date": 1515888638, "creation_date": 1440496188, "last_edit_date": 1495541700, "question_id": 32200773, "link": "https://stackoverflow.com/questions/32200773/getting-could-not-find-module-yesod-when-i-try-to-run-first-example-from-yes", "title": "Getting &quot;Could not find module `Yesod&#39;&quot; when I try to run first example from Yesod book", "body": "<p>I know this seems a duplicate to <a href=\"https://stackoverflow.com/questions/14589358/could-not-find-module-yesod\">Could not find module `Yesod&#39;</a>, but unlike that user, <code>ghc-pkg list</code> does not show <code>Yesod</code> in its output on my computer, they didn't seem to be using <code>stack</code> (I am, and I'm not sure if that means I don't need to worry about <code>ghc-pkg list</code>), and additionally, the answer (code) to that question did not help my situation.</p>\n\n<p>The <em>Yesod Book</em> has an <a href=\"http://www.yesodweb.com/book/basics#basics_hello_world\" rel=\"nofollow noreferrer\">example</a> that I've been trying to get to work for several hours now. I'll reprint it here</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings     #-}\n{-# LANGUAGE QuasiQuotes           #-}\n{-# LANGUAGE TemplateHaskell       #-}\n{-# LANGUAGE TypeFamilies          #-}\nimport           Yesod\n\ndata HelloWorld = HelloWorld\n\nmkYesod \"HelloWorld\" [parseRoutes|\n/ HomeR GET\n|]\n\ninstance Yesod HelloWorld\n\ngetHomeR :: Handler Html\ngetHomeR = defaultLayout [whamlet|Hello World!|]\n\nmain :: IO ()\nmain = warp 3000 HelloWorld\n</code></pre>\n\n<p>I'm using the latest 64-bit Ubuntu OS. The problem I consistently run into is that <code>runhaskell hello-world.hs</code> will time-and-time again return </p>\n\n<pre><code>hello-world.hs:6:18:\n    Could not find module `Yesod'\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>Likewise when I add a <code>module</code> name to the file and try loading it with <code>stack ghci hello-world.hs</code>. I'm using <code>stack</code> to build things, and I've tried many different iterations of <code>stack new</code> (with yesod templates), <code>stack init</code>, and <code>stack build</code>'s left and right, with <code>stack update</code>'s here and there for good measure, and even a few <code>cabal install</code>'s, along with the entirety of <a href=\"http://www.yesodweb.com/page/quickstart\" rel=\"nofollow noreferrer\">the Yesod quickstart guide</a>, all to no avail, and all within the proper directories.</p>\n\n<p>When I use Yesod templates with <code>simpleSQL</code>, the template site loads properly, and moreover a much larger project that I'm working with, <a href=\"https://git.gnu.io/snowdrift/snowdrift/tree/master\" rel=\"nofollow noreferrer\">Snowdrift</a>, runs as well (albeit as a site, using <code>stack exec yesod devel</code> and not a <code>runhaskell FILE</code> command; but still, it works, and I've tried the exact same build process for handling the <code>hello-world.hs</code> file above. </p>\n\n<p>I feel like this problem has a simple solution that I'm missing, but I've tried and tried, and searched all over, and I just haven't come across an answer. </p>\n\n<p>Thanks a bunch for taking the time to help me out.</p>\n"}, {"tags": ["haskell", "ffi", "bytestring"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1440489267, "creation_date": 1440489267, "answer_id": 32198466, "question_id": 32197977, "link": "https://stackoverflow.com/questions/32197977/how-to-create-two-bytestrings-calling-this-external-library-api/32198466#32198466", "title": "How to create two ByteStrings calling this external library API?", "body": "<p>This does not answer your question, but it's too long to be put in a comment.</p>\n\n<p>As a hack, if you want to avoid doing manual allocations, you could use two nested <code>create</code> calls and an <code>IORef ByteString</code> to store the bytestring created by the innermost <code>create</code>. E.g. (pseudocode)</p>\n\n<pre><code>secRef &lt;- newIORef \"\"\npubB &lt;- create publicKeyBytes (\\pub -&gt; do\n   secB &lt;- create secretKeyBytes (\\sec -&gt; void $ c_random_keypair pub sec)\n   writeIORef secRef secB)\nsecB &lt;- readIORef secRef\nreturn (pubB, secB)\n</code></pre>\n\n<p>However, I prefer your <code>createWithResult</code> to this approach.</p>\n"}, {"comments": [{"owner": {"reputation": 1884, "user_id": 78264, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/184b96c136e7aa7b05b8e1539f345c70?s=128&d=identicon&r=PG", "display_name": "dnaq", "link": "https://stackoverflow.com/users/78264/dnaq"}, "edited": false, "score": 0, "creation_date": 1440535586, "post_id": 32206701, "comment_id": 52311298, "body": "So if ByteString had exposed a &#39;replicateIO :: Int -&gt; Word8 -&gt; IO ByteString&#39; function that didn&#39;t call &#39;unsafePerformIO&#39;, then it would have worked?"}], "tags": [], "owner": {"reputation": 36, "user_id": 5264506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abaddcc2d72f33c8a4261ff57355465?s=128&d=identicon&r=PG&f=1", "display_name": "Maciej Bielecki", "link": "https://stackoverflow.com/users/5264506/maciej-bielecki"}, "is_accepted": true, "score": 2, "last_activity_date": 1440512745, "creation_date": 1440512745, "answer_id": 32206701, "question_id": 32197977, "link": "https://stackoverflow.com/questions/32197977/how-to-create-two-bytestrings-calling-this-external-library-api/32206701#32206701", "title": "How to create two ByteStrings calling this external library API?", "body": "<p>The problem with your first approach is that you're trying to modify an immutable value (<code>pk</code> and <code>sk</code> in your function). The <a href=\"http://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString-Unsafe.html#v:unsafeUseAsCString\" rel=\"nofollow\">docs for unsafeUseAsCString</a> say:</p>\n\n<blockquote>\n  <p>modifying the CString, either in C, or using poke, will cause the contents of the ByteString to change, breaking referential transparency</p>\n</blockquote>\n\n<p>The <code>IO</code> monad doesn't have different semantics when it comes to sharing and referential transparency. In fact, the <code>let</code> in the <code>do</code> block is not in any way related to <code>IO</code> monad; your code is equivalent to:</p>\n\n<pre><code>randomKeypair :: IO (PublicKey, SecretKey)\nrandomKeypair =\n    let pk = B.replicate 0 publicKeyBytes\n        sk = B.replicate 0 secretKeyBytes\n    in B.unsafeUseAsCString pk (\\ppk -&gt;\n        B.unsafeUseAsCString sk $ \\psk -&gt;\n        c_random_keypair ppk psk) &gt;&gt;\n    return (PublicKey pk, SecretKey sk)\n</code></pre>\n\n<p>Now it's clearly visible that <code>pk</code> and <code>sk</code> can be floated to top level.</p>\n"}], "owner": {"reputation": 1884, "user_id": 78264, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/184b96c136e7aa7b05b8e1539f345c70?s=128&d=identicon&r=PG", "display_name": "dnaq", "link": "https://stackoverflow.com/users/78264/dnaq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 32206701, "answer_count": 2, "score": 5, "last_activity_date": 1440512745, "creation_date": 1440487760, "last_edit_date": 1440500443, "question_id": 32197977, "link": "https://stackoverflow.com/questions/32197977/how-to-create-two-bytestrings-calling-this-external-library-api", "title": "How to create two ByteStrings calling this external library API?", "body": "<p>I'm currently writing bindings to a cryptographic library that exposes a function for generating keypairs:</p>\n\n<pre><code>const size_t PUBLICKEYBYTES = 32;\nconst size_t SECRETKEYBYTES = 32;\nint random_keypair(unsigned char pk[PUBLICKEYBYTES],\n                   unsigned char sk[SECRETKEYBYTES]);\n</code></pre>\n\n<p>This function randomly generates a secret key, computes the corresponding public key and puts the results in <code>pk</code> and <code>sk</code>.</p>\n\n<p>When just returning one <code>ByteString</code> I've found that the easiest way is to use <code>create :: Int -&gt; (Ptr Word8 -&gt; IO ()) -&gt; IO ByteString</code> from <code>Data.ByteString.Internal</code>. However, that function can't create two <code>ByteStrings</code> at the same time.</p>\n\n<p>My first approach was to write something like:</p>\n\n<pre><code>newtype PublicKey = PublicKey ByteString\nnewtype SecretKey = SecretKey ByteString\nrandomKeypair :: IO (PublicKey, SecretKey)\nrandomKeypair = do\n    let pk = B.replicate 0 publicKeyBytes\n        sk = B.replicate 0 secretKeyBytes\n    B.unsafeUseAsCString pk $ \\ppk -&gt;\n        B.unsafeUseAsCString sk $ \\psk -&gt;\n        c_random_keypair ppk psk\n    return (PublicKey pk, SecretKey sk)\n</code></pre>\n\n<p>However, this doesn't seem to work with GHC 7.10.2. When running the test suite I'm finding that I seem to have sharing of the <code>ByteString</code>s in between function calls, leading to encryption/decryption failing and giving incorrect results.</p>\n\n<p>I've managed to work around the problem by defining my own function:</p>\n\n<pre><code>createWithResult :: Int -&gt; (Ptr Word8 -&gt; IO a) -&gt; IO (ByteString, a)\ncreateWithResult i f = do\n    fp &lt;- B.mallocByteString i\n    r &lt;- withForeignPtr fp f\n    return (B.fromForeignPtr fp 0 i, r)\n</code></pre>\n\n<p>and using it like:</p>\n\n<pre><code>randomKeypair = fmap (PublicKey *** SecretKey) $\n    createWithResult publicKeyBytes $ \\ppk -&gt;\n    B.create secretKeyBytes $ \\psk -&gt;\n    void $ c_random_keypair ppk psk\n</code></pre>\n\n<p>This seems to work, all tests pass.</p>\n\n<p>My question is, what exactly are the semantics when it comes to sharing and referential transparency when it comes to the <code>IO</code> monad?</p>\n\n<p>My intuition told me (incorrectly) that I could solve the problem in the first way, but apparently I couldn't. What I believe was happening is that the optimizer saw that the <code>let</code>-statements could be floated up into top level definitions, and that was the reason I got these issues.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1440484689, "post_id": 32196993, "comment_id": 52278924, "body": "have you read  <a href=\"https://wiki.haskell.org/SPOJ\" rel=\"nofollow noreferrer\">wiki.haskell.org/SPOJ</a> ?"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1440485596, "post_id": 32196993, "comment_id": 52279380, "body": "also my personal diary in two years ago says that using <code>Data.ByteString</code> instead of <code>String</code> made it pass the SPOJ&#39;s PALIN problem."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1440487712, "post_id": 32196993, "comment_id": 52280575, "body": "Did you profile the code on your machine? I mean did you verify that on your laptop the code runs in less than the time required by spoj?"}, {"owner": {"reputation": 41, "user_id": 5263008, "user_type": "registered", "profile_image": "https://graph.facebook.com/917052508363489/picture?type=large", "display_name": "Seo Ha Kim", "link": "https://stackoverflow.com/users/5263008/seo-ha-kim"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1440489109, "post_id": 32196993, "comment_id": 52281374, "body": "@ymonad , Bakuriu Thanks a lot, my code works in lesser than 0.5 s under 50000 digit but it freezes over that. Maybe I should try Data.ByteString"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1440489514, "post_id": 32196993, "comment_id": 52281594, "body": "@SeoHaKim note that actually i used <code>Data.ByteString.Lazy.Char8</code> for solving it because it was more convenient than <code>Data.ByteString</code> (at least two years ago) . <a href=\"https://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString-Lazy-Char8.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/bytestring-0.10.6.0/docs/&hellip;</a>"}, {"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1440490319, "post_id": 32196993, "comment_id": 52282115, "body": "As haskellers, maybe we should add a prominent banner in www.haskell.org: &quot;Looking for speed? You will need Data.ByteString. Check it out! It is free!&quot;. And of course, respect and love to the package maintainers ;-)"}, {"owner": {"reputation": 41, "user_id": 5263008, "user_type": "registered", "profile_image": "https://graph.facebook.com/917052508363489/picture?type=large", "display_name": "Seo Ha Kim", "link": "https://stackoverflow.com/users/5263008/seo-ha-kim"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1440491172, "post_id": 32196993, "comment_id": 52282630, "body": "@Bakuriu wow I was wondering why my question looks better! Thanks"}, {"owner": {"reputation": 41, "user_id": 5263008, "user_type": "registered", "profile_image": "https://graph.facebook.com/917052508363489/picture?type=large", "display_name": "Seo Ha Kim", "link": "https://stackoverflow.com/users/5263008/seo-ha-kim"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1440491315, "post_id": 32196993, "comment_id": 52282727, "body": "@ymonad Thanks. haskell is most interesting language I&#39;ve ever learned!"}], "owner": {"reputation": 41, "user_id": 5263008, "user_type": "registered", "profile_image": "https://graph.facebook.com/917052508363489/picture?type=large", "display_name": "Seo Ha Kim", "link": "https://stackoverflow.com/users/5263008/seo-ha-kim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1440485074, "creation_date": 1440484358, "last_edit_date": 1440485074, "question_id": 32196993, "link": "https://stackoverflow.com/questions/32196993/why-does-this-code-run-slower-on-spoj-triggering-the-timeout", "title": "Why does this code run slower on spoj, triggering the timeout?", "body": "<p>I was trying to solve this problem on spoj: <a href=\"http://www.spoj.com/problems/PALIN/\" rel=\"nofollow\">http://www.spoj.com/problems/PALIN/</a></p>\n\n<p>My code works fine and fast on my laptop (even slower cpu than the one that spoj provides) but spoj keeps giving me time exceeded:</p>\n\n<pre><code>import Control.Monad\n\nmain = do\n        num &lt;- getLine\n        inputs &lt;- replicateM (read num) getLine\n        test inputs\n\ntest [] = return ()\ntest (l:ls) = do\n    putStrLn (send l)\n    test ls\n\nsend :: String -&gt; String\nsend str\n    | odd (length str) = makePalindrome str (take (length str `div` 2 + 1) str ++ ( reverse $ take (length str `div` 2) str))\n    | otherwise        = makePalindrome str (take (length str `div` 2) str ++ (reverse $ take (length str `div` 2) str))\nmakePalindrome :: String -&gt; String  -&gt; String\nmakePalindrome str pal \n        | (read str :: Integer) &lt; (read pal :: Integer) = pal\n        | otherwise = makePalindrome str (nextPalindrome pal)\n\n\nnextPalindrome :: String -&gt; String\nnextPalindrome (x:xs) = succ' ++ (reverse $ take rightlen succ')\n        where\n            strlen = length (x:xs)\n            allNine = all ( (==) '9') \n            odd' = odd strlen\n            left = if odd' then take (strlen `div` 2 + 1) (x:xs)  else take (strlen `div` 2) (x:xs)\n            rightlen = strlen - (length left)\n            succ' = show (read left + 1)\n\n\ncheckPalindrome :: String -&gt; Bool\ncheckPalindrome str = str == (reverse str)\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 3, "creation_date": 1440479381, "post_id": 32195656, "comment_id": 52276804, "body": "The non-existence of the general solution is discussed in <a href=\"http://stackoverflow.com/q/7040844/414413\">Applicatives compose, monads don&#39;t</a>."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1440553818, "post_id": 32195656, "comment_id": 52317220, "body": "@Cirdec Yes, that offers a very comprehensive explanation."}], "answers": [{"comments": [{"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 0, "creation_date": 1440478991, "post_id": 32195801, "comment_id": 52276698, "body": "I hadn&#39;t even considered <code>traverse</code>, that&#39;s just what I was looking for."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 6, "last_activity_date": 1440478622, "creation_date": 1440478622, "answer_id": 32195801, "question_id": 32195656, "link": "https://stackoverflow.com/questions/32195656/joining-nested-monads/32195801#32195801", "title": "Joining Nested Monads", "body": "<p>There isn't an obvious way to do so. You could cobble together something with the right type using functions like <a href=\"https://hackage.haskell.org/package/sodium/docs/FRP-Sodium-Context.html#v:sample\"><code>sample</code></a> and <a href=\"https://hackage.haskell.org/package/sodium/docs/FRP-Sodium-Context.html#v:sync\"><code>sync</code></a> or <a href=\"https://hackage.haskell.org/package/sodium/docs/FRP-Sodium-Context.html#v:updates\"><code>updates</code></a> and <a href=\"https://hackage.haskell.org/package/sodium/docs/FRP-Sodium-Context.html#t:ContextIO\"><code>executeSyncIO/executeAsyncIO</code></a>, but it probably wouldn't obey the <code>Monad</code> laws.</p>\n\n<p>There isn't a more general solution for <code>a (b (a (b c))) -&gt; a (b c))</code>, but there is if <code>b</code> is <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-Traversable.html#t:Traversable\"><code>Traversable</code></a>, which lets you rearrange things into <code>a (a (b (b c)))</code> by <a href=\"http://hackage.haskell.org/package/base/docs/Data-Traversable.html#v:sequenceA\">traversing</a> the outer <code>b</code>.</p>\n"}], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 32195801, "answer_count": 1, "score": 4, "last_activity_date": 1440478622, "creation_date": 1440477679, "question_id": 32195656, "link": "https://stackoverflow.com/questions/32195656/joining-nested-monads", "title": "Joining Nested Monads", "body": "<p>I am using <code>FRP.Sodium</code> and I have an object of type <code>IO (Behavior (IO (Behavior)))</code>. I need to convert that object to type <code>IO (Behavior)</code>, using something akin to a nested <code>join</code>. Is this possible using Sodium functions? Is there a more general solution for <code>a (b (a (b c))) -&gt; a (b c))</code>?</p>\n"}, {"tags": ["haskell", "io", "monads"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1440454163, "post_id": 32192471, "comment_id": 52270179, "body": "Check that type of <code>g</code>!   <code>g &lt;- newStdGen</code>  <code>:type g</code> yields <code>g :: StdGen</code>.  You can&#39;t escape, but you you can get values and perform pure computations."}, {"owner": {"reputation": 615, "user_id": 3571042, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/eafffaef76417c2adafb5a351bc15ecb?s=128&d=identicon&r=PG&f=1", "display_name": "davik", "link": "https://stackoverflow.com/users/3571042/davik"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1440454334, "post_id": 32192471, "comment_id": 52270250, "body": "but why doesn&#39;t line 2 (in do) compile"}, {"owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "edited": false, "score": 1, "creation_date": 1440454565, "post_id": 32192471, "comment_id": 52270329, "body": "line 2 does not compile because <code>take 5 (randoms g :: [Double])</code> does not return an <code>IO</code> (or <i>monadic</i>) value.  If you change the line to <code>let a = take 5 (randoms g :: [Double])</code> then it should compile alright."}], "answers": [{"tags": [], "owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "is_accepted": true, "score": 4, "last_activity_date": 1440454438, "creation_date": 1440454438, "answer_id": 32192600, "question_id": 32192471, "link": "https://stackoverflow.com/questions/32192471/how-does-io-monad-work-in-system-random/32192600#32192600", "title": "How does IO monad work in System.Random", "body": "<p>You can't escape from <code>IO</code>, but inside a <code>do</code> block you're not actually <em>escaping</em> per se.</p>\n\n<p>Loosely: when you write <code>g &lt;- newStdGen</code> in a <code>do</code> block, you can then use <code>g</code> later in the block as if it just had type <code>StdGen</code>, instead of <code>IO StdGen</code>.  At the end of the block, whatever you return will be wrapped back up in <code>IO</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 2, "last_activity_date": 1440454715, "creation_date": 1440454715, "answer_id": 32192648, "question_id": 32192471, "link": "https://stackoverflow.com/questions/32192471/how-does-io-monad-work-in-system-random/32192648#32192648", "title": "How does IO monad work in System.Random", "body": "<p>Use <code>let a =</code> instead of <code>a &lt;-</code> since the RHS is a pure value.</p>\n\n<pre><code>import System.Random\n\nmain = do\n  g &lt;- newStdGen\n  let a = take 5 (randoms g :: [Double])\n  print a\n</code></pre>\n"}], "owner": {"reputation": 615, "user_id": 3571042, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/eafffaef76417c2adafb5a351bc15ecb?s=128&d=identicon&r=PG&f=1", "display_name": "davik", "link": "https://stackoverflow.com/users/3571042/davik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 32192600, "answer_count": 2, "score": 3, "last_activity_date": 1440454715, "creation_date": 1440453781, "question_id": 32192471, "link": "https://stackoverflow.com/questions/32192471/how-does-io-monad-work-in-system-random", "title": "How does IO monad work in System.Random", "body": "<pre><code>import System.Random\n\nmain = do\n  g &lt;- newStdGen\n  a &lt;-take 5 (randoms g :: [Double])\n  return ()\n</code></pre>\n\n<p>So this code doesn't work because apparently what I'm assigning to a has type [Double] instead of IO [Double] but I thought that you can't escape from IO ever? So how come I seemed to have escaped from IO even though g is type IO? I'm still confused on how IO monads work inside do notation.</p>\n"}, {"tags": ["list", "haskell", "category-theory"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1440469848, "post_id": 32191851, "comment_id": 52274383, "body": "A simple test shows that it is not replicating the performance characteristics of real difference lists: while <code>length . Data.DList.toList $ Data.DList.fromList [1..1000000] `Data.DList.append` Data.DList.fromList [1..1000000]</code> returns instantly, the corresponding <code>length . Codensity.toList $ Codensity.fromList [1..1000000] `Codensity.append` Codensity.fromList [1..1000000]</code> takes several seconds."}, {"owner": {"reputation": 2527, "user_id": 1396134, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85ae7e9104d0484386cbb4ac7791ad8f?s=128&d=identicon&r=PG", "display_name": "raichoo", "link": "https://stackoverflow.com/users/1396134/raichoo"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1440484892, "post_id": 32191851, "comment_id": 52279025, "body": "Good point, I rewrote <code>fromList</code> to change to performance characteristics: <code>fromList xs = Codensity (\\k -&gt; k xs)</code>"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1440510697, "post_id": 32191851, "comment_id": 52295818, "body": "It&#39;s not difference lists: <code>length . toList . foldl&#39; append nil . map (fromList . (:[]))</code> is O(n^2)."}], "answers": [{"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 15, "last_activity_date": 1440494670, "creation_date": 1440494670, "answer_id": 32200231, "question_id": 32191851, "link": "https://stackoverflow.com/questions/32191851/relation-between-dlist-and-with-codensity/32200231#32200231", "title": "Relation between `DList` and `[]` with Codensity", "body": "<p>One view could be that <code>DList</code> is a way for reordering monoid operations, just as <code>Codensity</code> is a way for reordering monad operations.</p>\n\n<p><code>[]</code> is a free monoid on <code>a</code>, so let's represent lists using a free writer monad, that is <code>Free ((,) a)</code>:</p>\n\n<pre><code>module Codensity where\n\nimport Control.Monad\nimport Control.Monad.Free\nimport Control.Monad.Codensity\nimport Control.Monad.Trans (lift)\n\ntype DList a = Free ((,) a) ()\n</code></pre>\n\n<p>Now we can define the standard list operations:</p>\n\n<pre><code>nil :: DList a\nnil = return ()\n\nsingleton :: a -&gt; DList a\nsingleton x = liftF (x, ())\n\nappend :: DList a -&gt; DList a -&gt; DList a\nappend = (&gt;&gt;)\n\ninfixr 5 `snoc`\nsnoc :: DList a -&gt; a -&gt; DList a\nsnoc xs x = xs &gt;&gt; singleton x\n\nexec :: Free ((,) a) () -&gt; [a]\nexec (Free (x, xs)) = x : exec xs\nexec (Pure _) = []\n\nfromList :: [a] -&gt; DList a\nfromList = mapM_ singleton\n\ntoList :: DList a -&gt; [a]\ntoList = exec\n</code></pre>\n\n<p>This representation has the same drawbacks as list when it comes to <code>snoc</code>. We can verify that</p>\n\n<pre><code>last . toList . foldl snoc nil $ [1..10000]\n</code></pre>\n\n<p>takes a significant (quadratic) amount of time. However, just as every free monad, it can be improved using <code>Codensity</code>. We just replace the definition with</p>\n\n<pre><code>type DList a = Codensity (Free ((,) a)) ()\n</code></pre>\n\n<p>and <code>toList</code> with</p>\n\n<pre><code>toList = exec . lowerCodensity\n</code></pre>\n\n<p>Now the same expression is executed instantly, as <code>Codensity</code> reorders the operations, just like the original difference lists.</p>\n"}, {"comments": [{"owner": {"reputation": 2527, "user_id": 1396134, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85ae7e9104d0484386cbb4ac7791ad8f?s=128&d=identicon&r=PG", "display_name": "raichoo", "link": "https://stackoverflow.com/users/1396134/raichoo"}, "edited": false, "score": 0, "creation_date": 1440622420, "post_id": 32214036, "comment_id": 52355288, "body": "While the first answer is more on point concerning my question, this certainly deserves an upvote :) Thanks, for the writeup!"}, {"owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "reply_to_user": {"reputation": 2527, "user_id": 1396134, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85ae7e9104d0484386cbb4ac7791ad8f?s=128&d=identicon&r=PG", "display_name": "raichoo", "link": "https://stackoverflow.com/users/1396134/raichoo"}, "edited": false, "score": 1, "creation_date": 1440659014, "post_id": 32214036, "comment_id": 52366689, "body": "I didn&#39;t even plan to write that much, but I just couldn&#39;t stop after starting :P"}], "tags": [], "owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "is_accepted": false, "score": 17, "last_activity_date": 1440784136, "last_edit_date": 1440784136, "creation_date": 1440536626, "answer_id": 32214036, "question_id": 32191851, "link": "https://stackoverflow.com/questions/32191851/relation-between-dlist-and-with-codensity/32214036#32214036", "title": "Relation between `DList` and `[]` with Codensity", "body": "<blockquote>\n  <p><strong>TL;DR:</strong>\n  <code>DList</code> for <code>(++)</code> serves the same purpose as <code>Codensity</code> for <code>(&gt;&gt;=)</code>: reassociating the operators to the right.</p>\n  \n  <p>This is beneficial, because for both, <code>(++)</code> and <code>(&gt;&gt;=)</code>, left associated computations\n  (can) exhibit <strong>quadratic</strong> runtime behaviour.</p>\n</blockquote>\n\n<h2>1. The full story</h2>\n\n<p>The plan is as follows:</p>\n\n<ul>\n<li>We go step by step through an example for <code>(++)</code> and <code>(&gt;&gt;=)</code>,\nemonstrating the problem with associativity.</li>\n<li>We use CPS to avoid quadratic complexity with <code>DList</code> and\n<code>Codensity</code></li>\n<li>Aftermath and Bonus (Generalize from <code>(++)</code> to <code>(&lt;&gt;)</code>)</li>\n</ul>\n\n<h2>2. The problem: quadratic runtime behaviour</h2>\n\n<h3>2a. List <code>(++)</code></h3>\n\n<blockquote>\n  <p>Keep in mind that while I am using <code>(++)</code> as an example, this is\n    valid for other functions as well, if they work analogous to <code>(++)</code>.</p>\n</blockquote>\n\n<p>So let's first look at the problem with lists.  The concat operation\nfor lists is commonly <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Base.html#%2B%2B\" rel=\"noreferrer\">defined as</a>:</p>\n\n<pre><code>(++) []     ys = ys\n(++) (x:xs) ys = x : xs ++ ys\n</code></pre>\n\n<p>which means that <code>(++)</code> will always walk the <strong>first</strong> argument from\nstart to end.  To see when this is a problem consider the following\ntwo computations:</p>\n\n<pre><code>as, bs, cs:: [Int]\n\nrightAssoc :: [Int]\nrightAssoc = (as ++ (bs ++ cs))\n\nleftAssoc :: [Int]\nleftAssoc = ((as ++ bs) ++ cs)\n</code></pre>\n\n<p>Let's start with <code>rightAssoc</code> and walk through the evaluation.</p>\n\n<pre><code>as = [1,2]\nbs = [3,4]\ncs = [5,6]\nrightAssoc = ([1,2] ++ ([3,4] ++ [5,6]))\n           -- pattern match gives (1:[2]) for first arg\n           = 1 : ([2] ++ ([3,4] ++ [5,6]))\n           -- pattern match gives (2:[]) for first arg\n           = 1 : 2 : ([] ++ ([3,4] ++ [5,6]))\n           -- first case of (++)\n           = 1 : 2 : ([3,4] ++ [5,6])\n           = 1 : 2 : 3 : ([4] ++ [5,6])\n           = 1 : 2 : 3 : 4 : ([] ++ [5,6])\n           = 1 : 2 : 3 : 4 : [5,6]\n           = [1,2,3,4,5,6]\n</code></pre>\n\n<p>So we have to walk over <code>as</code> and <code>bs</code>.</p>\n\n<p>Okay that was not too bad, let's continue to <code>leftAssoc</code>:</p>\n\n<pre><code>as = [1,2]\nbs = [3,4]\ncs = [5,6]\nleftAssoc = (([1,2] ++ [3,4]) ++ [5,6])\n          = ((1 : ([2] ++ [3,4])) ++ [5,6])\n          = ((1 : 2 : ([] ++ [3,4])) ++ [5,6])\n          = ((1 : 2 : [3,4]) ++ [5,6])\n          = ([1,2,3,4] ++ [5,6])\n          -- uh oh\n          = 1 : ([2,3,4] ++ [5,6])\n          = 1 : 2 : ([3,4] ++ [5,6])\n          = 1 : 2 : 3 : ([4] ++ [5,6])\n          = 1 : 2 : 3 : 4 : ([] ++ [5,6])\n          = 1 : 2 : 3 : 4 : [5,6]\n          = [1,2,3,4,5,6]\n</code></pre>\n\n<p>Uh oh, did you see that we had to walk over <code>as</code> <strong>twice</strong>?  Once as\n<code>[1,2]</code> and then again inside <code>as ++ bs = [1,2,3,4]</code>.  With each\nfurther operand that is wrongly associated, the list on the <strong>left</strong>\nof <code>(++)</code> which we have to traverse completely each time will grow\nlonger in each step, leading to <strong>quadratic</strong> runtime behaviour.</p>\n\n<p>So as you see above left-associated <code>(++)</code> will destroy performance.\nWhich leads us to:</p>\n\n<h3>2b. Free monad <code>(&gt;&gt;=)</code></h3>\n\n<blockquote>\n  <p>Keep in mind that while I am using <code>Free</code> as an example, this is\n    also the case for other monads, e.g. the instance for <code>Tree</code> behaves\n    like this, too</p>\n</blockquote>\n\n<p>First, we use the naive <code>Free</code> type:</p>\n\n<pre><code>data Free f a = Pure a | Free (f (Free f a))\n</code></pre>\n\n<p>Instead of <code>(++)</code>, we look at <code>(&gt;&gt;=)</code> which is <a href=\"https://hackage.haskell.org/package/free-4.12.1/docs/src/Control-Monad-Free.html#Free\" rel=\"noreferrer\">defined as</a> and use\n<code>(&gt;&gt;=)</code> in prefix form:</p>\n\n<pre><code>instance Functor f =&gt; Monad (Free f) where\n  return = Pure\n  (&gt;&gt;=) (Pure a) f = f a\n  (&gt;&gt;=) (Free m) f = Free ((&gt;&gt;= f) &lt;$&gt; m)\n</code></pre>\n\n<p>If you compare this with the definition of <code>(++)</code> from <code>2a</code> above, you can\nsee that the definition of <code>(&gt;&gt;=)</code> again looks at the <strong>first</strong>\nargument.  That raises a first concern, will this perform as bad as in\nthe <code>(++)</code> case when associated wrongly?  Well, let's see, I use\n<code>Identity</code> here for simplicity but the choice of the functor is not\nthe important fact here:</p>\n\n<pre><code>-- specialized to 'Free'\nliftF :: Functor f =&gt; f a -&gt; Free f a\nliftF fa = Free (Pure &lt;$&gt; fa)\n\nx :: Free Identity Int\nx = liftF (Identity 20) = Free (Identity (Pure 20))\n\nf :: Int -&gt; Free Identity Int\nf x = liftF (Identity (x+1)) = Free (Identity (Pure (x+1)))\n\ng :: Int -&gt; Free Identity Int\ng x = liftF (Identity (x*2)) = Free (Identity (Pure (x*2)))\n\nrightAssoc :: Free Identity Int\nrightAssoc = (x &gt;&gt;= \\x -&gt; (f x &gt;&gt;= g))\n\nleftAssoc :: Free Identity Int\nleftAssoc = ((x &gt;&gt;= f) &gt;&gt;= g)\n</code></pre>\n\n<p>We again start with the <code>rightAssoc</code> variant first:</p>\n\n<pre><code>rightAssoc = (x &gt;&gt;= \\x -&gt; (f x &gt;&gt;= g))\n                    ~~~\n           -- definition of x\n           = ((Free (Identity (Pure 20))) &gt;&gt;= \\x -&gt; (f x &gt;&gt;= g))\n              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n           -- second case of definition for 'Free's (&gt;&gt;=)\n           = Free ((&gt;&gt;= \\x -&gt; (f x &gt;&gt;= g)) &lt;$&gt; Identity (Pure 20))\n                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n           -- (&lt;$&gt;) for Identity\n           = Free (Identity ((Pure 20) &gt;&gt;= \\x -&gt; (f x &gt;&gt;= g)))\n                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n           -- first case of the definition for 'Free's (&gt;&gt;=)\n           = Free (Identity (f 20 &gt;&gt;= g))\n                             ~~~~\n           = Free (Identity ((Free (Identity (Pure 21))) &gt;&gt;= g))\n                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n           -- second case of definition for 'Free's (&gt;&gt;=)\n           = Free (Identity (Free ((&gt;&gt;= g) &lt;$&gt; Identity (Pure 21))))\n                                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n           = Free (Identity (Free (Identity ((Pure 21) &gt;&gt;= g))))\n                                             ~~~~~~~~~~~~~~~\n           = Free (Identity (Free (Identity (g 21))))\n                                             ~~~~\n           = Free (Identity (Free (Identity (Free (Identity (Pure 42))))))\n</code></pre>\n\n<p>Puh, okay I added <code>~~~~</code> under the expression that is reduced in the\nnext step for clarity.  If you squint hard enough, you may see some\nfamiliarity from <code>2a</code>'s' case for <code>rightAssoc</code>: we walk the two first\narguments (now <code>x</code> and <code>f</code> instead of <code>as</code> and <code>bs</code>) arguments once.\nWithout wasting further time, here is <code>leftAssoc</code>:</p>\n\n<pre><code>leftAssoc = ((x &gt;&gt;= f) &gt;&gt;= g)\n             ~~~\n          = ((Free (Identity (Pure 20)) &gt;&gt;= f) &gt;&gt;= g)\n             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n          = (Free ((&gt;&gt;= f) &lt;$&gt; Identity (Pure 20)) &gt;&gt;= g)\n                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n          = (Free (Identity ((Pure 20) &gt;&gt;= f)) &gt;&gt;= g)\n                             ~~~~~~~~~~~~~~~\n          = (Free (Identity (f 20)) &gt;&gt;= g)\n                             ~~~~\n          = (Free (Identity (Free (Identity (Pure 21)))) &gt;&gt;= g)\n            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n          = Free ((&gt;&gt;= g) &lt;$&gt; (Identity (Free (Identity (Pure 21)))))\n                  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n          -- uh oh\n          = Free (Identity (Free (Identity (Pure 21)) &gt;&gt;= g))\n                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n          = Free (Identity (Free ((&gt;&gt;= g) &lt;$&gt; Identity (Pure 21))))\n                                  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n          = Free (Identity (Free (Identity ((Pure 21) &gt;&gt;= g))))\n                                            ~~~~~~~~~~~~~~~~\n          = Free (Identity (Free (Identity (g 21))))\n                                            ~~~~\n          = Free (Identity (Free (Identity (Free (Identity (Pure 42))))))\n</code></pre>\n\n<p>If you look close, after the <code>uh oh</code> we have to tear down the\nintermediate structure again, just like in the <code>(++)</code> case (also\nmarked with <code>uh oh</code>).</p>\n\n<h3>2c. Result so far</h3>\n\n<p>In both cases, <code>leftAssoc</code> leads to quadratic runtime behaviour,\nbecause we rebuild the <strong>first</strong> argument several times and tear it\ndown right again for the next operation.  This means that at each step\nin the evaluation we have to <em>build</em> and <em>tear down</em> a growing\nintermediate structure --- bad.</p>\n\n<h2>3.  The relation between <code>DList</code> and <code>Codensity</code></h2>\n\n<p>This is where we will discover the relation between <code>DList</code> and\n<code>Codensity</code>.  Each one solves the problem of wrongly associated\ncomputations seen above by using CPS to effectively reassociate to the\nright.</p>\n\n<h3>3a.  DList</h3>\n\n<p>First we introduce the <a href=\"https://hackage.haskell.org/package/dlist-0.7.1.1/docs/src/Data-DList.html#DList\" rel=\"noreferrer\">definition</a> of <code>DList</code> and <code>append</code>:</p>\n\n<pre><code>newtype DList a = DL { unDL :: [a] -&gt; [a] }\n\nappend :: DList a -&gt; DList a -&gt; DList a\nappend xs ys = DL (unDL xs . unDL ys)\n\nfromList :: [a] -&gt; DList a\nfromList = DL . (++)\n\ntoList :: DList a -&gt; [a]\ntoList = ($[]) . unDL\n</code></pre>\n\n<p>and now our old friends:</p>\n\n<pre><code>as,bs,cs :: DList Int\nas = fromList [1,2] = DL ([1,2] ++)\nbs = fromList [3,4] = DL ([3,4] ++)\ncs = fromList [5,6] = DL ([5,6] ++)\n\nrightAssoc :: [Int]\nrightAssoc = toList $ as `append` (bs `append` cs)\n\nleftAssoc :: [Int]\nleftAssoc = toList $ ((as `append` bs) `append` cs)\n</code></pre>\n\n<p>Evaluation is roughly as follows:</p>\n\n<pre><code>rightAssoc = toList $ (DL ([1,2] ++)) `append` (bs `append` cs)\n           = toList $ DL $ unDL (DL ([1,2] ++)) . unDL (bs `append` cs)\n                           ~~~~~~~~~~~~~~~~~~~~\n           = toList $ DL $ ([1,2] ++) . unDL (bs `append` cs)\n                                              ~~\n           = toList $ DL $ ([1,2] ++) . unDL ((DL ([3,4] ++)) `append` cs)\n                                              ~~~~~~~~~~~~~~~~~~~~~~~~~~~\n           = toList $ DL $ ([1,2] ++) . unDL (DL $ unDL (DL ([3,4] ++)) . unDL cs)\n                                                   ~~~~~~~~~~~~~~~~~~~~\n           = toList $ DL $ ([1,2] ++) . unDL (DL $ ([3,4] ++) . unDL cs)\n                                                                     ~~\n           = toList $ DL $ ([1,2] ++) . unDL (DL $ ([3,4] ++) . unDL (DL ([5,6] ++)))\n           = toList $ DL $ ([1,2] ++) . unDL (DL $ ([3,4] ++) . ([5,6] ++))\n                                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n           = toList $ DL $ ([1,2] ++) . (([3,4] ++) . ([5,6] ++))\n             ~~~~~~\n           -- definition of toList\n           = ($[]) . unDL $ DL $ ([1,2] ++) . (([3,4] ++) . ([5,6] ++))\n                     ~~~~~~~~~\n           -- unDL . DL == id\n           = ($[]) $ (([1,2] ++) . (([3,4] ++) . ([5,6] ++)))\n           -- move ($[]) to end\n           = (([1,2] ++) . (([3,4] ++) . ([5,6] ++))) []\n           -- def: (.) g f x = g (f x)\n           = (([1,2] ++) ((([3,4] ++) . ([5,6] ++)) []))\n           = (([1,2] ++) (([3,4] ++) (([5,6] ++) [])))\n           -- drop unnecessary parens\n           = (([1,2] ++) (([3,4] ++) ([5,6] ++ [])))\n           = ([1,2] ++ ([3,4] ++ ([5,6] ++ [])))\n                                  ~~~~~~~~~~~\n           -- (xs ++ []) == xs\n           = ([1,2] ++ ([3,4] ++ ([5,6])))\n           = (as ++ (bs ++ cs))\n</code></pre>\n\n<p>Hah! The result is exactly the same as <code>rightAssoc</code> from <code>2a</code>.\nAllright, with tension building up, we move on to <code>leftAssoc</code>:</p>\n\n<pre><code>leftAssoc = toList $ ((as `append` bs) `append` cs)\n          = toList $ (((DL ([1,2]++)) `append` bs) `append` cs)\n          = toList $ ((DL (unDL (DL ([1,2]++)) . unDL bs)) `append` cs)\n          = toList $ ((DL (unDL (DL ([1,2]++)) . unDL (DL ([3,4]++)))) `append` cs)\n          = toList $ ((DL (([1,2]++) . ([3,4]++))) `append` cs)\n          = toList $ (DL (unDL (DL (([1,2]++) . ([3,4]++))) . unDL cs))\n          = toList $ (DL (unDL (DL (([1,2]++) . ([3,4]++))) . unDL (DL ([5,6]++))))\n          = toList $ (DL ((([1,2]++) . ([3,4]++)) . ([5,6]++)))\n          = ($[]) . unDL $ (DL ((([1,2]++) . ([3,4]++)) . ([5,6]++)))\n          = ($[]) ((([1,2]++) . ([3,4]++)) . ([5,6]++))\n          = ((([1,2]++) . ([3,4]++)) . ([5,6]++)) []\n          -- expand (f . g) to \\x -&gt; f (g x)\n          = ((\\x -&gt; ([1,2]++) (([3,4]++) x)) . ([5,6]++)) []\n          = ((\\x -&gt; ([1,2]++) (([3,4]++) x)) (([5,6]++) []))\n          -- apply lambda\n          = ((([1,2]++) (([3,4]++) (([5,6]++) []))))\n          = ([1,2] ++ ([3,4] ++ [5,6]))\n          = as',bs',cs' ~ versions of 2a with no prime\n          = (as' ++ (bs' ++ cs'))\n</code></pre>\n\n<p>Heureka!  The result is associated correctly (to the right), <strong>no</strong>\nquadratic slowdown.</p>\n\n<h3>3b. Codensity</h3>\n\n<p>Okay if you've come to this point you must be seriously interested, that's good,\nbecause so am I :).  We start with the definition and <code>Monad</code> instance of Codensity (with abbreviated names):</p>\n\n<pre><code>newtype Codensity m a = C { run :: forall b. (a -&gt; m b) -&gt; m b }\n\ninstance Monad (Codensity f) where\n  return x = C (\\k -&gt; k x)\n  m &gt;&gt;= k = C (\\c -&gt; run m (\\a -&gt; run (k a) c))\n\n-- hidden as a instance for `MonadTrans`\nliftCodensity :: Monad m =&gt; m a -&gt; Codensity m a\nliftCodensity m = C (m &gt;&gt;=)\n\nlowerCodensity :: Monad m =&gt; Codensity m a -&gt; m a\nlowerCodensity a = run a return\n</code></pre>\n\n<p>I guess you know what comes next:</p>\n\n<pre><code>x :: Codensity (Free Identity) Int\nx = liftCodensity (Free (Identity (Pure 20)))\n  = C (Free (Identity (Pure 20)) &gt;&gt;=)\n  -- note the similarity to (DL (as ++))\n  -- with DL ~ Codensity and (++) ~ (&gt;&gt;=) !\n\nf :: Int -&gt; Codensity (Free Identity) Int\nf x = liftCodensity (Free (Identity (Pure (x+1))))\n    = C (Free (Identity (Pure (x+1))) &gt;&gt;=)\n\ng :: Int -&gt; Codensity (Free Identity) Int\ng x = liftCodensity (Free (Identity (Pure (x*2))))\n    = C (Free (Identity (Pure (x*2))) &gt;&gt;=)\n\nrightAssoc :: Free Identity Int\nrightAssoc = lowerCodensity (x &gt;&gt;= \\x -&gt; (f x &gt;&gt;= g))\n\nleftAssoc :: Free Identity Int\nleftAssoc = lowerCodensity ((x &gt;&gt;= f) &gt;&gt;= g)\n</code></pre>\n\n<p>Before we go through the evaluation once again, you might be\ninterested in the comparison of <code>append</code> from <code>DList</code> and <code>(&gt;&gt;=)</code> from\n<code>Codensity</code> (<code>unDL</code> <code>~</code> <code>run</code>), go ahead and do that if you\nwant, I'll wait for you.</p>\n\n<p>Okay we start with <code>rightAssoc</code>:</p>\n\n<pre><code>rightAssoc = lowerCodensity (x &gt;&gt;= \\x -&gt; (f x &gt;&gt;= g))\n                            ~~~\n           -- def of x\n           = lowerCodensity ((C (Free (Identity (Pure 20)) &gt;&gt;=)) &gt;&gt;= \\x -&gt; (f x &gt;&gt;= g))\n           -- (&gt;&gt;=) of codensity\n           = lowerCodensity (C (\\c -&gt; run (C (Free (Identity (Pure 20)) &gt;&gt;=)) (\\a -&gt; run ((\\x -&gt; (f x &gt;&gt;= g)) a) c)))\n           -- run . C == id\n           = lowerCodensity (C (\\c -&gt; Free (Identity (Pure 20)) &gt;&gt;= \\a -&gt; run ((\\x -&gt; (f x &gt;&gt;= g)) a) c))\n           -- substitute x' for 'Free (Identity (Pure 20))' (same as only x from 2b)\n           = lowerCodensity (C (\\c -&gt; x' &gt;&gt;= \\a -&gt; run ((\\x -&gt; (f x &gt;&gt;= g)) a) c))\n                                                                ~~~\n           = lowerCodensity (C (\\c -&gt; x' &gt;&gt;= \\a -&gt; run ((\\x -&gt; (C (Free (Identity (Pure (x+1))) &gt;&gt;=)) &gt;&gt;= g) a) c))\n                                                                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n           = lowerCodensity (C (\\c -&gt; x' &gt;&gt;= \\a -&gt; run ((\\x -&gt; (C (\\c2 -&gt; run (C (Free (Identity (Pure (x+1))) &gt;&gt;=)) (\\a2 -&gt; run (g a2) c2)))) a) c))\n                                                                           ~~~~~~\n           = lowerCodensity (C (\\c -&gt; x' &gt;&gt;= \\a -&gt; run ((\\x -&gt; (C (\\c2 -&gt; (Free (Identity (Pure (x+1))) &gt;&gt;=) (\\a2 -&gt; run (g a2) c2)))) a) c))\n           -- again, substitute f' for '\\x -&gt; Free (Identity (Pure (x+1)))' (same as only f from 2b)\n           = lowerCodensity (C (\\c -&gt; x' &gt;&gt;= \\a -&gt; run ((\\x -&gt; (C (\\c2 -&gt; (f' x &gt;&gt;=) (\\a2 -&gt; run (g a2) c2)))) a) c))\n                                                                                                   ~~~~\n           = lowerCodensity (C (\\c -&gt; x' &gt;&gt;= \\a -&gt; run ((\\x -&gt; (C (\\c2 -&gt; (f' x &gt;&gt;=) (\\a2 -&gt; run (C (Free (Identity (Pure (a2*2))) &gt;&gt;=)) c2)))) a) c))\n                                                                                              ~~~~~~\n           = lowerCodensity (C (\\c -&gt; x' &gt;&gt;= \\a -&gt; run ((\\x -&gt; (C (\\c2 -&gt; (f' x &gt;&gt;=) (\\a2 -&gt; (Free (Identity (Pure (a2*2))) &gt;&gt;=) c2)))) a) c))\n           -- one last time, substitute g' (g from 2b)\n           = lowerCodensity (C (\\c -&gt; x' &gt;&gt;= \\a -&gt; run ((\\x -&gt; (C (\\c2 -&gt; (f' x &gt;&gt;=) (\\a2 -&gt; (g' a2 &gt;&gt;=) c2)))) a) c))\n           -- def of lowerCodensity\n           = run (C (\\c -&gt; x' &gt;&gt;= \\a -&gt; run ((\\x -&gt; (C (\\c2 -&gt; (f' x &gt;&gt;=) (\\a2 -&gt; (g' a2 &gt;&gt;=) c2)))) a) c)) return\n           = (\\c -&gt; x' &gt;&gt;= \\a -&gt; run ((\\x -&gt; (C (\\c2 -&gt; (f' x &gt;&gt;=) (\\a2 -&gt; (g' a2 &gt;&gt;=) c2)))) a) c) return\n           = (x' &gt;&gt;= \\a -&gt; run ((\\x -&gt; (C (\\c2 -&gt; (f' x &gt;&gt;=) (\\a2 -&gt; (g' a2 &gt;&gt;=) c2)))) a) return)\n                                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n           = (x' &gt;&gt;= \\a -&gt; run (C (\\c2 -&gt; (f' a &gt;&gt;=) (\\a2 -&gt; (g' a2 &gt;&gt;=) c2))) return)\n                           ~~~~~~\n           = (x' &gt;&gt;= \\a -&gt; (\\c2 -&gt; (f' a &gt;&gt;=) (\\a2 -&gt; (g' a2 &gt;&gt;=) c2)) return)\n                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n           = (x' &gt;&gt;= \\a -&gt; (f' a &gt;&gt;=) (\\a2 -&gt; g' a2 &gt;&gt;= return))\n           -- m &gt;&gt;= return ~ m\n           = (x' &gt;&gt;= \\a -&gt; (f' a &gt;&gt;=) (\\a2 -&gt; g' a2))\n           -- m &gt;&gt;= (\\x -&gt; f x) ~ m &gt;&gt;= f\n           = (x' &gt;&gt;= \\a -&gt; (f' a &gt;&gt;= g'))\n           -- rename a to x\n           = (x' &gt;&gt;= \\x -&gt; (f' x &gt;&gt;= g'))\n</code></pre>\n\n<p>And we can now see that the <code>(&gt;&gt;=)</code>s are associated to the right, this\nis not yet particularly astonishing, given that this was also the case\nat the start.  So, full of anticipation, we turn our attention to our\nlast and final evaluation trace, <code>leftAssoc</code>:</p>\n\n<pre><code>leftAssoc = lowerCodensity ((x &gt;&gt;= f) &gt;&gt;= g)\n          -- def of x\n          = lowerCodensity ((C (Free (Identity (Pure 20)) &gt;&gt;=) &gt;&gt;= f) &gt;&gt;= g)\n          -- (&gt;&gt;=) from Codensity\n          = lowerCodensity ((C (\\c -&gt; run (C (Free (Identity (Pure 20)) &gt;&gt;=)) (\\a -&gt; run (f a) c))) &gt;&gt;= g)\n                                      ~~~~~~\n          = lowerCodensity ((C (\\c -&gt; (Free (Identity (Pure 20)) &gt;&gt;=) (\\a -&gt; run (f a) c))) &gt;&gt;= g)\n          -- subst x'\n          = lowerCodensity ((C (\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; run (f a) c))) &gt;&gt;= g)\n          -- def of f\n          = lowerCodensity ((C (\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; run (C (Free (Identity (Pure (a+1))) &gt;&gt;=)) c))) &gt;&gt;= g)\n                                                      ~~~~~~\n          = lowerCodensity ((C (\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; (Free (Identity (Pure (a+1))) &gt;&gt;=) c))) &gt;&gt;= g)\n          -- subst f'\n          = lowerCodensity ((C (\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;=) c))) &gt;&gt;= g)\n                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n          = lowerCodensity (C (\\c2 -&gt; run (C (\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;=) c))) (\\a2 -&gt; run (g a2) c2)))\n                                      ~~~~~~\n          = lowerCodensity (C (\\c2 -&gt; (\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;=) c)) (\\a2 -&gt; run (g a2) c2)))\n          -- def of g\n          = lowerCodensity (C (\\c2 -&gt; (\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;=) c)) (\\a2 -&gt; run (C (Free (Identity (Pure (a2*2))) &gt;&gt;=)) c2)))\n                                                                                    ~~~~~~\n          = lowerCodensity (C (\\c2 -&gt; (\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;=) c)) (\\a2 -&gt; (Free (Identity (Pure (a2*2))) &gt;&gt;=) c2)))\n          -- subst g'\n          = lowerCodensity (C (\\c2 -&gt; (\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;=) c)) (\\a2 -&gt; (g' a2 &gt;&gt;=) c2)))\n          -- def lowerCodensity\n          = run (C (\\c2 -&gt; (\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;=) c)) (\\a2 -&gt; (g' a2 &gt;&gt;=) c2))) return\n          = (\\c2 -&gt; (\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;=) c)) (\\a2 -&gt; (g' a2 &gt;&gt;=) c2)) return\n          = ((\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;=) c)) (\\a2 -&gt; g' a2 &gt;&gt;= return))\n          = ((\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;=) c)) (\\a2 -&gt; g' a2))\n          = ((\\c -&gt; (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;=) c)) g')\n          = (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;=) g')\n          = (x' &gt;&gt;=) (\\a -&gt; (f' a &gt;&gt;= g')\n          = (x' &gt;&gt;= (\\a -&gt; (f' a &gt;&gt;= g'))\n          = (x' &gt;&gt;= (\\x -&gt; (f' x &gt;&gt;= g'))\n</code></pre>\n\n<p><strong>Finally</strong> there we have it, all binds associated to the right, just\n  how we like them!</p>\n\n<h2>4. Aftermath</h2>\n\n<p>If you made it until here, congratulations.  Let's summarize what we\ndid:</p>\n\n<ol>\n<li>We demonstrated the problem with wrongly associated <code>(++)</code> in <code>2a</code>\nand <code>(&gt;&gt;=)</code> in <code>2b</code></li>\n<li>We've shown the solution using <code>DList</code> in <code>3a</code> and <code>Codensity</code> in\n<code>3b</code>.</li>\n<li>Demonstrated the power of equational reasoning in Haskell :)</li>\n</ol>\n\n<h2>5. Bonus</h2>\n\n<p>Actuall, we can generalize <code>DList</code> from <code>(++)</code> and use <code>(&lt;&gt;)</code> instead\nto get <code>DMonoid</code>, reordering <code>(&lt;&gt;)</code>.</p>\n\n<pre><code>newtype DMonoid m = DM { unDM :: m -&gt; m }\n\ninstance Monoid m =&gt; Monoid (DMonoid m) where\n  mempty = DM (mempty &lt;&gt;)\n  x `mappend` y = DM (unDM x . unDM y)\n\nliftDM :: Monoid m =&gt; m -&gt; DMonoid m\nliftDM = DM . (&lt;&gt;)\n\nlowerDM :: Monoid m =&gt; DMonoid m -&gt; m\nlowerDM = ($ mempty) . unDM\n</code></pre>\n\n<p>Then the comparison goes as follows:</p>\n\n<ul>\n<li><code>DMonoid</code> is a (my invention) \"<strong>monoid</strong> transformer\", reassociating <code>(&lt;&gt;)</code> to the right</li>\n<li><code>Codensity</code> is a monad transformer, reassociating <code>(&gt;&gt;=)</code> to the right</li>\n</ul>\n"}], "owner": {"reputation": 2527, "user_id": 1396134, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85ae7e9104d0484386cbb4ac7791ad8f?s=128&d=identicon&r=PG", "display_name": "raichoo", "link": "https://stackoverflow.com/users/1396134/raichoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 5, "accepted_answer_id": 32200231, "answer_count": 2, "score": 21, "last_activity_date": 1440784136, "creation_date": 1440450922, "last_edit_date": 1440484950, "question_id": 32191851, "link": "https://stackoverflow.com/questions/32191851/relation-between-dlist-and-with-codensity", "title": "Relation between `DList` and `[]` with Codensity", "body": "<p>I've been experimenting with <code>Codensity</code> lately which is supposed to relate <code>DList</code> with <code>[]</code> among other things. Anyway, I've never found code that states this relation. After some experiments I ended up with this:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nmodule Codensity where\n\nnewtype Codensity f a = Codensity\n  { runCodensity :: forall b. (a -&gt; f b) -&gt; f b }\n\ntype DList a = Codensity [] [a]\n\nnil :: DList a\nnil = Codensity ($ [])\n\ninfixr 5 `cons`\ncons :: a -&gt; DList a -&gt; DList a\ncons x (Codensity xs) = Codensity ($ (xs (x:)))\n\nappend :: DList a -&gt; DList a -&gt; DList a\nappend (Codensity xs) ys = Codensity ($ (xs (++ toList ys)))\n\ntoList :: DList a -&gt; [a]\ntoList xs = runCodensity xs id\n\nfromList :: [a] -&gt; DList a\nfromList xs = Codensity (\\k -&gt; k xs)\n</code></pre>\n\n<p>However, the definition of <code>DList</code> feels a bit icky in my example. Is there a different way to state this relation? Is this even the right way to do this?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 14, "last_activity_date": 1440436197, "creation_date": 1440436197, "answer_id": 32187882, "question_id": 32187546, "link": "https://stackoverflow.com/questions/32187546/how-can-i-reduce-syntactic-clutter-when-tagging-a-polymorphic-tree-in-haskell/32187882#32187882", "title": "How can I reduce syntactic clutter when tagging a polymorphic tree in Haskell?", "body": "<p>The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/syntax-extns.html\"><code>PatternSynonyms</code></a> language extension can help here. It lets you specify aliases for patterns:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n\npattern ParseLit x = A (Lit x)\n\nsomeFunc :: Parse -&gt; Int\nsomeFunc p = case p of\n    ParseLit x -&gt; x\n    _ -&gt; 0\n</code></pre>\n\n<p>There are two flavors of pattern synonyms: bidirectional (like in the example) and unidirectional. The bidirectional ones can also be used as constructors:</p>\n\n<pre><code>*Main&gt; :t ParseLit\nParseLit :: Int -&gt; Parse\n\n*Main&gt; ParseLit 77\n</code></pre>\n"}], "owner": {"reputation": 2667, "user_id": 383188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b9f4333859c623061b3447a36ce6f97a?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/383188/andrew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 2, "accepted_answer_id": 32187882, "answer_count": 1, "score": 10, "last_activity_date": 1440476001, "creation_date": 1440434861, "last_edit_date": 1440476001, "question_id": 32187546, "link": "https://stackoverflow.com/questions/32187546/how-can-i-reduce-syntactic-clutter-when-tagging-a-polymorphic-tree-in-haskell", "title": "How can I reduce syntactic clutter when tagging a polymorphic tree in Haskell?", "body": "<p>So I want a type that represents trees containing a set of node-types. I would also like types that represent similar tree defined over overlapping sets. This is another version of the Typed AST problem. Say that my pool of node-types is:</p>\n\n<pre><code>data Lit = Lit Int\ndata Var = Var String\ndata Hole = Hole Int\n</code></pre>\n\n<p>A parse-tree can contain <code>Lit</code>s or <code>Var</code>s but no <code>Hole</code>s. A second kind tree called a template can contain <code>Lit</code>s, <code>Var</code>s or <code>Hole</code>s.</p>\n\n<p>To keep things simple there is a single type of recursive node called <code>Add</code>.</p>\n\n<pre><code>data Parse = A Lit | B Var\ndata Template = C Lit | D Var | E Hole\ndata Tree a = Leaf a \n            | Add (Tree a) (Tree a)\n</code></pre>\n\n<p>So now I can declare data, and I can still pattern-match on it, the only problem is the syntactic clutter. </p>\n\n<pre><code>aParse = Add (A Lit 3) (B Var \"x\")\naTemplate = Add (C Lit 4) (E Hole 3)\nfun (Add (A lit) (B var) = ...\n</code></pre>\n\n<p>What I would like is some sugar similar to :</p>\n\n<pre><code>ParseLit = A . Lit\nTempLit = C . Lit \n</code></pre>\n\n<p>Obviously aliases for compositions of constructors (not types) is not legal in Haskell. But what is the cleanest way to write this, avoiding as much boiler-plate as possible?</p>\n"}, {"tags": ["haskell", "monads", "free-monad", "monadplus"], "answers": [{"comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1440438503, "post_id": 32186008, "comment_id": 52262249, "body": "You shouldn&#39;t use things like &quot;update&quot; or &quot;edit&quot; in a post. The edit history is more than enough to look at when something was changed/added. I took the liberty of removing them (but not the content) and moving the part that references the bug tracker at the top, so that it&#39;s more easily accessible."}, {"owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1440443865, "post_id": 32186008, "comment_id": 52265190, "body": "@Bakuriu Really? So, instead of just seeing immediately that something was changed, we&#39;re supposed to dig into edit history? Is the normal way just too simple?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "edited": false, "score": 3, "creation_date": 1440444234, "post_id": 32186008, "comment_id": 52265408, "body": "@MigMit The &quot;normal way&quot;, as you call it, is <b>noise</b>. If I&#39;m looking for an answer why should I read hundreds of lines of unrelated &quot;edits&quot; to end up with a 2 line answer in the end?  Answer should maximize usefulness, which means being readable and easily accessible. Splitting information into various blocks isn&#39;t generally a good solution. It may be ok when the question/answer is still unclear/incomplete but once it&#39;s clear the content should be well organized. If someone is curious to see how it evolved he can look at the edit history, but that&#39;s metadata."}, {"owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1440445287, "post_id": 32186008, "comment_id": 52266015, "body": "@Bakuriu if I want an answer to my question, it&#39;s entirely possible that the first reply is not what I need. Later, when I revisit the page, I would normally skip the answers I&#39;ve already seen \u2014 UNLESS there is a clear visual clue that SOMETHING has changed. The bold <i>Edit</i> provides such a clue. It&#39;s not <i>noise</i>, it&#39;s <i>information</i>, that makes using this page EASIER."}, {"owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "edited": false, "score": 1, "creation_date": 1440445344, "post_id": 32186008, "comment_id": 52266048, "body": "Maybe we should transfer this discussion somewhere else?"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 13, "last_activity_date": 1440438396, "last_edit_date": 1440438396, "creation_date": 1440429878, "answer_id": 32186008, "question_id": 32185389, "link": "https://stackoverflow.com/questions/32185389/what-was-wrong-with-control-monadplus-free/32186008#32186008", "title": "What was wrong with Control.MonadPlus.Free?", "body": "<p>According to this <a href=\"https://github.com/ekmett/free/issues/38\">issue</a> in the bug tracker the old definition does not obey the associative law.</p>\n\n<hr>\n\n<p>Although I know little about such things, I suspect an other problem is redundancy:</p>\n\n<pre><code>Pure a\nPlus [Pure a]\nPlus [Plus [Pure a]]\n...\n</code></pre>\n\n<p>all seem to represent the same thing. Free structures are generally supposed to be unique. There are times when they cannot be represented uniquely (e.g., free abelian groups) but when possible they should be.</p>\n\n<p>Actually, I think the suggested alternative suffers from the same problem, although it might be possible to repair it by using <code>NonEmpty</code> instead of <code>[]</code>. So this change could just be a matter of removing excess cruft from the library.</p>\n"}, {"tags": [], "owner": {"reputation": 6337, "user_id": 1572599, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/f8125f451db25e510aa1b7fd6c2c0566?s=128&d=identicon&r=PG", "display_name": "Tomas Mikula", "link": "https://stackoverflow.com/users/1572599/tomas-mikula"}, "is_accepted": false, "score": 1, "last_activity_date": 1476906504, "creation_date": 1476906504, "answer_id": 40140303, "question_id": 32185389, "link": "https://stackoverflow.com/questions/32185389/what-was-wrong-with-control-monadplus-free/40140303#40140303", "title": "What was wrong with Control.MonadPlus.Free?", "body": "<p>I believe that the representation itself was OK and that the lawfulness could have been remedied by changing these method signatures</p>\n\n<pre><code>iter :: Functor f =&gt; (f a -&gt; a) -&gt; ([a] -&gt; a) -&gt; Free f a -&gt; a\niterM :: (Monad m, Functor f) =&gt; (f (m a) -&gt; m a) -&gt; ([m a] -&gt; m a) -&gt; Free f a -&gt; m a\n</code></pre>\n\n<p>to</p>\n\n<pre><code>iter :: (Functor f, Monoid a) =&gt; (f a -&gt; a) -&gt; Free f a -&gt; a\niterM :: (MonadPlus m, Functor f) =&gt; (f (m a) -&gt; m a) -&gt; Free f a -&gt; m a\n</code></pre>\n\n<p>i.e.</p>\n\n<ul>\n<li>use <code>Monoid a</code> instead of an <em>arbitrary</em> function <code>[a] -&gt; a</code> in <code>iter</code>;</li>\n<li>use <code>MonadPlus m</code> instead of an <em>arbitrary</em> function <code>[m a] -&gt; m a</code> in <code>iterM</code>.</li>\n</ul>\n\n<p>My guess is that it was removed (instead of fixed) just because it is not worth to keep around when <code>FreeT f []</code> gives an equivalent representation.</p>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "accepted_answer_id": 32186008, "answer_count": 2, "score": 18, "last_activity_date": 1613887722, "creation_date": 1440428122, "last_edit_date": 1613887722, "question_id": 32185389, "link": "https://stackoverflow.com/questions/32185389/what-was-wrong-with-control-monadplus-free", "title": "What was wrong with Control.MonadPlus.Free?", "body": "<p>The <a href=\"https://hackage.haskell.org/package/free-4.5/docs/Control-MonadPlus-Free.html#t:Free\">free MonadPlus</a> defined as</p>\n\n<pre><code>data Free f a = Pure a | Free (f (Free f a)) | Plus [Free f a]\n</code></pre>\n\n<p>was removed in <em>free</em> 4.6 with the following remark (<a href=\"http://hackage.haskell.org/package/free-4.6/changelog\">changelog</a>):</p>\n\n<blockquote>\n  <p>Removed <code>Control.MonadPlus.Free</code>. Use <code>FreeT f []</code> instead and the result will be law-abiding.</p>\n</blockquote>\n\n<p>What was the problem, in particular, what laws didn't hold?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 269, "user_id": 1084637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/745239e23061d746727436ec06e5dd2e?s=128&d=identicon&r=PG", "display_name": "asp5", "link": "https://stackoverflow.com/users/1084637/asp5"}, "edited": false, "score": 0, "creation_date": 1440423666, "post_id": 32183691, "comment_id": 52253009, "body": "not able to edit the Q, hence the continuation here. IFF GHCI is optimizing this, is it considered a tail call optimization? But without doing the comparison, between x and <code>fst y</code> how is GHCI even making a call to optimize is what is puzzling me..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440424251, "post_id": 32183691, "comment_id": 52253394, "body": "Optimizations should never lead to different answers from pure code. In very rare cases (when your code does something ill-advised) they can cause exceptions that technically shouldn&#39;t happen. That&#39;s not the case here. What do you expect your program to do?"}, {"owner": {"reputation": 269, "user_id": 1084637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/745239e23061d746727436ec06e5dd2e?s=128&d=identicon&r=PG", "display_name": "asp5", "link": "https://stackoverflow.com/users/1084637/asp5"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440426611, "post_id": 32183691, "comment_id": 52255124, "body": "@ dfeuer: I think the program is doing what it is expected to do. this is trying to count the number of occurrences of the last &quot;char&quot;/  element in that list...  I&#39;m trying to see if there is an optimization going on here. If so what is that technique called and other info on that."}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1440428463, "post_id": 32183691, "comment_id": 52256457, "body": "I don&#39;t have a definitive answer but I suspect this happens because of a combination of sharing, a conversion to continuation passing style and perhaps even tail-call elimination? I tried to write up a quick explanation but I feel like I don&#39;t have a good enough grasp of what really happens to be able to do that."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1440741153, "post_id": 32183691, "comment_id": 52407335, "body": "It looks like you are not getting to <code>else y</code> simply because nothing there needs to be evaluated. <code>y</code> is already evaluated and <code>else</code> is not an expression."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1441003660, "post_id": 32183691, "comment_id": 52486409, "body": "Would looking at the output of <code>-ddump-bcos</code> help you?"}], "answers": [{"comments": [{"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "reply_to_user": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1441375024, "post_id": 32386402, "comment_id": 52667833, "body": "Haskell doesn&#39;t have stack frames in the same vein as a procedural language.  Think of Haskell&#39;s stack resembling a mathematical equation, where each recursive call is a term in the equation.  In the case where the last letter is not repeated, the equation is &quot;solved&quot; once the singleton case is hit.  Then, just like in math, there&#39;s no reason to restate any of the original &quot;terms&quot;, because the solution has been found.  (i.e. in f(&#39;abc&#39;)=f(&#39;bc&#39;)=f(&#39;c&#39;)=(&#39;c&#39;,1) all terms are equal to (&#39;c&#39;,1) without any more work to be done)"}, {"owner": {"reputation": 13597, "user_id": 1463507, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9d940a7d55911df9afca8e2dd525f3ee?s=128&d=identicon&r=PG", "display_name": "kqr", "link": "https://stackoverflow.com/users/1463507/kqr"}, "edited": false, "score": 0, "creation_date": 1441525284, "post_id": 32386402, "comment_id": 52707971, "body": "But it&#39;s running on a von Neumann machine, so it must use stack frames! I understand your very high-level explanation, but I&#39;m interested in what actually happens in the registers and memory."}], "tags": [], "owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "is_accepted": false, "score": 2, "last_activity_date": 1441325465, "last_edit_date": 1441325465, "creation_date": 1441319218, "answer_id": 32386402, "question_id": 32183691, "link": "https://stackoverflow.com/questions/32183691/understanding-haskell-ghci-behavior-for-recursion/32386402#32386402", "title": "understanding Haskell/GHCI behavior for recursion", "body": "<p>The recursion you're expecting (namely, the evaluation of <code>else y</code>) is a procedural expectation that isn't needed in Haskell's lazy evaluation.  </p>\n\n<ul>\n<li><code>y</code> has already been evaluated in the <code>where y = countNumLastChar xs</code> statement when it was needed to evaluate the <code>if</code>, so it doesn't need to be evaluated again.  (<code>else y</code> isn't showing up in the trace, because there's nothing new to evaluate) </li>\n<li><code>then (fst y, (snd y) + 1)</code> has not been evaluated when the function reaches the singleton case, so you do see it evaluated on the way back up the recursive stack.  </li>\n</ul>\n\n<p>If you were to change the else case to something that couldn't be evaluated until after the singleton case, it would be evaluated on the way back up the recursive calls.</p>\n"}], "owner": {"reputation": 269, "user_id": 1084637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/745239e23061d746727436ec06e5dd2e?s=128&d=identicon&r=PG", "display_name": "asp5", "link": "https://stackoverflow.com/users/1084637/asp5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1441325465, "creation_date": 1440423303, "question_id": 32183691, "link": "https://stackoverflow.com/questions/32183691/understanding-haskell-ghci-behavior-for-recursion", "title": "understanding Haskell/GHCI behavior for recursion", "body": "<p>I'm trying to make sense of what I'm seeing with the  following function. Not sure if my understanding is incorrect or if this is the behavior specific to the GHC implementation of Haskell.</p>\n\n<pre><code>countNumLastChar :: Eq a =&gt; [a] -&gt; (a, Int)\ncountNumLastChar [x]      = (x, 1)\ncountNumLastChar (x:xs)  = if x == fst y\n                            then (fst y, (snd y) + 1)\n                            else y\n                            where y = countNumLastChar xs\n</code></pre>\n\n<p>I'm seeing something that I'm not able to explain with this code. </p>\n\n<pre><code>*Main&gt; countNumLastChar \"aba\"\n('a',2)\n*Main&gt; countNumLastChar \"abql;kejrqlwkjer;lqwkejr;lwjerca\"\n('a',2)\n*Main&gt; countNumLastChar \"abql;kejrqlwkjer;lqwkejr;lwjercap\"\n('p',1)\n*Main&gt; countNumLastChar \"abql;kejrqlwkjer;lqwkejr;lwjerca;\"\n(';',4)\n</code></pre>\n\n<p>For example :tracing through the below run with GHCI, I see that when we reach the singleton list with an element that has NOT been repeated yet, we do NOT recurse back each step. </p>\n\n<pre><code>*Main&gt; countNumLastChar \"aabc\"\n('c',1)\n[maxOccurCharInStr.hs:(3,28)-(5,34)] *Main&gt; :step\nStopped at maxOccurCharInStr.hs:3:31-40\n_result :: Bool = _\nx :: Char = 'b'\ny :: (Char, Int) = _\n[maxOccurCharInStr.hs:3:31-40] *Main&gt; :list\n2  countNumLastChar [x]      = (x, 1)\n3  countNumLastChar (x:xs)  = if x == fst y\n4                              then (fst y, (snd y) + 1)\n[maxOccurCharInStr.hs:3:31-40] *Main&gt; :step\nStopped at maxOccurCharInStr.hs:3:36-40\n_result :: a = _\ny :: (a, Int) = _\n[maxOccurCharInStr.hs:3:36-40] *Main&gt; :step\nStopped at maxOccurCharInStr.hs:6:39-57\n_result :: (Char, Int) = _\nxs :: [Char] = 'c' : _\n[maxOccurCharInStr.hs:6:39-57] *Main&gt; :list\n5                              else y\n6                              where y = countNumLastChar xs\n7  \n[maxOccurCharInStr.hs:6:39-57] *Main&gt; :step\nStopped at maxOccurCharInStr.hs:(2,1)-(6,57)\n_result :: (a, Int) = _\n[maxOccurCharInStr.hs:(2,1)-(6,57)] *Main&gt; :list\n1  countNumLastChar :: Eq a =&gt; [a] -&gt; (a, Int)\n2  countNumLastChar [x]      = (x, 1)\n3  countNumLastChar (x:xs)  = if x == fst y\n4                              then (fst y, (snd y) + 1)\n5                              else y\n6                              where y = countNumLastChar xs\n7  \n[maxOccurCharInStr.hs:(2,1)-(6,57)] *Main&gt; :step\nStopped at maxOccurCharInStr.hs:2:29-34\n_result :: (Char, Int) = _\nx :: Char = 'c'\n[maxOccurCharInStr.hs:2:29-34] *Main&gt; :list\n1  countNumLastChar :: Eq a =&gt; [a] -&gt; (a, Int)\n2  countNumLastChar [x]      = (x, 1)\n3  countNumLastChar (x:xs)  = if x == fst y\n[maxOccurCharInStr.hs:2:29-34] *Main&gt; :step\n('c',1)\n*Main&gt; \n</code></pre>\n\n<p>I was expecting that the last <code>:step</code> would take me back to the <code>else y</code> case in the definition, but instead I see that the result is returned immediately. But when the last char was present before then we recurse back and do  the <code>(fst y, (snd y) + 1)</code> part... Can someone please tell what is happening? is my understanding incorrect or is GHCI optimizing something. If it is optimizing, how does it know it has to return the result directly? Any reference to this would be of great help.</p>\n"}, {"tags": ["haskell", "cuda", "numeric", "accelerate-haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1440428457, "post_id": 32183411, "comment_id": 52256451, "body": "You&#39;ve checked that CUDA as such runs fine, have you?"}, {"owner": {"reputation": 829, "user_id": 640078, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/01e5b91ad42c7d309b09d6ae8991a32c?s=128&d=identicon&r=PG", "display_name": "rprospero", "link": "https://stackoverflow.com/users/640078/rprospero"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1440430285, "post_id": 32183411, "comment_id": 52257681, "body": "If I remove <code>hist</code> from the calculation, the rest of the function runs under CUDA without issue."}, {"owner": {"reputation": 66945, "user_id": 681865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77320b8ddf13954ffb22aa22965d465e?s=128&d=identicon&r=PG&f=1", "display_name": "talonmies", "link": "https://stackoverflow.com/users/681865/talonmies"}, "edited": false, "score": 0, "creation_date": 1458828164, "post_id": 32183411, "comment_id": 60037411, "body": "@user640078. did you ever find a solution to this? Is there an answer to add here?"}], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 6716325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e4f4da0d0954eba69cf06d7df00480e?s=128&d=identicon&r=PG", "display_name": "tmcdonell", "link": "https://stackoverflow.com/users/6716325/tmcdonell"}, "is_accepted": true, "score": 1, "last_activity_date": 1471231435, "creation_date": 1471231435, "answer_id": 38948890, "question_id": 32183411, "link": "https://stackoverflow.com/questions/32183411/accelerate-code-passes-intepreter-but-fails-under-cuda/38948890#38948890", "title": "Accelerate code passes intepreter but fails under CUDA", "body": "<p>This was a bug in Accelerate (and/or underlying change in CUDA) which has <a href=\"https://github.com/AccelerateHS/accelerate/issues/280\" rel=\"nofollow\">now been fixed</a>. Apologies for taking so long to get to it, this slipped off my radar.</p>\n"}], "owner": {"reputation": 829, "user_id": 640078, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/01e5b91ad42c7d309b09d6ae8991a32c?s=128&d=identicon&r=PG", "display_name": "rprospero", "link": "https://stackoverflow.com/users/640078/rprospero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 38948890, "answer_count": 1, "score": 2, "last_activity_date": 1471231435, "creation_date": 1440422470, "question_id": 32183411, "link": "https://stackoverflow.com/questions/32183411/accelerate-code-passes-intepreter-but-fails-under-cuda", "title": "Accelerate code passes intepreter but fails under CUDA", "body": "<p>I have been trying to write a function in that will take a histogram of a vector using the accelerate library.  I recognize that histograms aren't the idea case for GPU processing, but I'm generating a fairly large dataset from a small seed and it would be nice if it could be reduced to a few kilobyte array before transferring it back to main memory.</p>\n\n<p>The code that I've come up with is below.  It takes a number of output bins then then creates a new array where the values of a[x] is the number of occurrences of x in xs</p>\n\n<pre><code>hist :: A.Exp Int -&gt; A.Acc (A.Vector Int) -&gt; A.Acc (A.Vector Int)\nhist bins xs = A.permute\n               (const (+1))\n               (A.fill (A.index1 bins) 0)\n               (A.index1 . (xs A.!))\n               xs\n</code></pre>\n\n<p>The code appears to run properly under the Accelerate interpreter.  However, if I try to call it through accelerate-cuda, I get the following error message.</p>\n\n<pre><code>./Data/Array/Accelerate/CUDA/State.hs:85:9: (unhandled): CUDA Exception: unspecified launch failure\n</code></pre>\n\n<p>My question is two-fold.  First, what am I doing that causes CUDA to fail?  Second, is there a better way to take a histogram through Accelerate?</p>\n"}, {"tags": ["haskell", "types", "ghci", "exponentiation"], "comments": [{"owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "edited": false, "score": 6, "creation_date": 1440396926, "post_id": 32175510, "comment_id": 52236980, "body": "What type do you want the result to be?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1440397015, "post_id": 32175510, "comment_id": 52237019, "body": "Related: <a href=\"http://stackoverflow.com/q/6400568/2541573\">stackoverflow.com/q/6400568/2541573</a>"}, {"owner": {"reputation": 1819, "user_id": 2059662, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/995b46d292bdd2e74f81d247a14cf8bc?s=128&d=identicon&r=PG", "display_name": "Ludwik", "link": "https://stackoverflow.com/users/2059662/ludwik"}, "edited": false, "score": 0, "creation_date": 1440397745, "post_id": 32175510, "comment_id": 52237321, "body": "Well I&#39;d expect the result of the first one to be 4, the second one to be 3."}, {"owner": {"reputation": 1819, "user_id": 2059662, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/995b46d292bdd2e74f81d247a14cf8bc?s=128&d=identicon&r=PG", "display_name": "Ludwik", "link": "https://stackoverflow.com/users/2059662/ludwik"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1440397865, "post_id": 32175510, "comment_id": 52237386, "body": "And @Jubobs: Yeah, and the other two don&#39;t typecheck either. I thought it would work, since <code>Data.Ratio</code> is an instance of <code>Integral</code>, so it seems to fit with the type signature of <code>(^)</code>."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1440398672, "post_id": 32175510, "comment_id": 52237728, "body": "@Ludwik There is a <code>Integral a =&gt; Fractional (Ratio a)</code> instance, but there is no <code>Integral</code> instance for <code>Ratio a</code>."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 7, "creation_date": 1440399642, "post_id": 32175510, "comment_id": 52238170, "body": "AFAIK there are three power operators in Haskell: <code>(^) :: (Num a, Integral b) =&gt; a -&gt; b -&gt; a</code>, <code>(^^) :: (Fractional a, Integral b) =&gt; a -&gt; b -&gt; a</code> and <code>(**) :: (Floating a) =&gt; a -&gt; a -&gt; a</code>.  So the exponent is either <code>Integral</code> or <code>Floating</code> but there is no <code>Fractional</code> exponent available... you should use <code>27**(realToFrac $ 2%3)</code>."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 6, "creation_date": 1440416997, "post_id": 32175510, "comment_id": 52248502, "body": "I second Lambda Fairy; what <i>type</i> do you want the result to be? Do you want a <code>Ratio</code>? (2^(1/2) isn&#39;t rational.) Do you want the nearest whole number? Do you want a <code>Double</code>? What <i>type</i> do you want?"}, {"owner": {"reputation": 1819, "user_id": 2059662, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/995b46d292bdd2e74f81d247a14cf8bc?s=128&d=identicon&r=PG", "display_name": "Ludwik", "link": "https://stackoverflow.com/users/2059662/ludwik"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1440613019, "post_id": 32175510, "comment_id": 52350052, "body": "@MathematicalOrchid Thanks, that cleared my mind. I see the reason it didn&#39;t work now."}], "answers": [{"tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 6, "last_activity_date": 1440443154, "last_edit_date": 1440443154, "creation_date": 1440442789, "answer_id": 32189732, "question_id": 32175510, "link": "https://stackoverflow.com/questions/32175510/raising-a-number-to-a-fractionaldata-ratio-power/32189732#32189732", "title": "Raising a number to a fractional(Data.Ratio) power?", "body": "<p>Haskell has <em>three</em> power operators:</p>\n\n<ol>\n<li><p><code>(^) :: (Num a, Integral b) =&gt; a -&gt; b  -&gt; a</code></p>\n\n<p>This raises <em>any</em> type of number using a <strong>positive integral</strong> exponent.</p>\n\n<p>You are getting an errors like <code>Could not deduce (Integral (Ratio a0)) arising from a use of \u2018^\u2019</code> when typing <code>2^(2%3)</code> because <code>Data.Ratio</code> is <em>not</em> an instance of <code>Integral</code>. GHC sees that <code>^</code> wants an <code>Integral</code> and notices <code>Data.Ratio</code> cannot be used in such a situation.</p></li>\n<li><p><code>(^^) :: (Fractional a, Integral b) =&gt; a -&gt; b -&gt; a</code></p>\n\n<p>This operator allows <strong>negative integral</strong> exponents. Remember that <code>x^(-n) == 1/(x^n)</code>. That's why it requires <code>Fractional</code>.</p>\n\n<p>Note that the exponent has to still be integral. <code>2^^(1%2)</code> would <strong>not</strong> be a <code>Fractional</code> number.</p></li>\n<li><p><code>(**) :: Floating a =&gt; a -&gt; a -&gt; a</code></p>\n\n<p>This is the \"catch all\" operator. It can raise a fractional number to a fractional power. However this uses floating point numbers, not exact rationals.</p></li>\n</ol>\n\n<p>Since we <em>cannot</em> represent all real numbers they have decided to simply rely on floats when you want inexact operations.</p>\n\n<p>So you <strong>should</strong> use type conversions to perform that operation. <strong>A</strong> possible implementation could be:</p>\n\n<pre><code>realToFrac $ 27**(realToFrac $ 2%3) :: Rational\n</code></pre>\n\n<p>Or you may define a new operator:</p>\n\n<pre><code>(*^*) :: (RealFrac a, RealFrac b) =&gt; a -&gt; b -&gt; a\nx *^* y = realToFrac $ realToFrac x ** realToFrac y\n</code></pre>\n\n<p>Which would allow you to write:</p>\n\n<pre><code>27 *^* (2%3)\n</code></pre>\n\n<p><sup>I used two <code>*</code> to remind of the <code>**</code> which is used in the implementation and I've added a <code>^</code> to refer to the type of the first two operators... not sure whether that makes sense, or maybe <code>^**</code> or <code>^^*</code> would have been better.</sup></p>\n\n<p>However it may be better to simply use <code>Double</code>s. It really depends on what the number represents and what you are doing with them.</p>\n"}, {"comments": [{"owner": {"reputation": 1819, "user_id": 2059662, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/995b46d292bdd2e74f81d247a14cf8bc?s=128&d=identicon&r=PG", "display_name": "Ludwik", "link": "https://stackoverflow.com/users/2059662/ludwik"}, "edited": false, "score": 0, "creation_date": 1440612953, "post_id": 32190974, "comment_id": 52350017, "body": "Thanks for this dip into number theory, was really insightful."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1440447335, "creation_date": 1440447335, "answer_id": 32190974, "question_id": 32175510, "link": "https://stackoverflow.com/questions/32175510/raising-a-number-to-a-fractionaldata-ratio-power/32190974#32190974", "title": "Raising a number to a fractional(Data.Ratio) power?", "body": "<p>To adress &ldquo;why does this not work&rdquo; &ndash; Haskell's multiple exponentiation operators actually reflect quite closely the way mathematicians define exponentiations!</p>\n\n<ul>\n<li>Ab initio, you only know (directly by definition) that for natural <em>n</em>, the expression <em>x</em><sup><em>n</em></sup> denotes 1&middot;<em>x</em>&middot;<em>x</em>&middot;<em>x</em>&hellip;, with <em>n</em> uses of <em>x</em>. That's exactly what <code>^</code> implements, and it obviously works for any number type at all (because multiplication is always defined).</li>\n<li>By &ldquo;reverse continuation&rdquo; across zero it makes sense to define <em>x</em><sup>-<em>n</em></sup> as <sup>1</sup>/<sub><em>x</em>&middot;<em>x</em>&middot;<em>x</em>&hellip;</sub>. This only works when you have multiplicative inverses, i.e. fractions. Well, <code>Fractional</code>, you know! This is what <code>^^</code> does.</li>\n<li>To define <em>fractional exponents</em>, you can start with considering roots. Those are essentially what you're asking for. However, roots are in fact mathematically quite involved. They aren't really unique. The result type for such roots would be something representing the <a href=\"https://en.wikipedia.org/wiki/Algebraic_number\">algebraic numbers</a>. For most users, there's not much of a reason to have a dedicated treatment for those numbers, hence Haskell skips this.<br>\nNow you say, well, but we could certainly define roots for particular numbers. The third root of 27 happens to be an integer, but for most other numbers this is not true. Ill-specified or partial functions are evil; we would therefore need a signature like <code>Num a =&gt; a -&gt; Rational -&gt; Maybe a</code>. But the result would <em>usually</em> be <code>Nothing</code>, so this would be a pretty useless function honestly. Implement it yourself if you like.</li>\n<li>It's more useful if you straightly go one step further: switching from algebra to calculus, the mathematician gets access to the <a href=\"https://en.wikipedia.org/wiki/Exponential_function\">exponential</a> and logarithm functions, and these give you a cover-all for all power expressions, by virtue of the equality<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \n<em>x</em><sup><em>y</em></sup>\n= (exp(ln <em>x</em>))<sup>y</sup>\n= exp(<em>y</em> &middot; ln <em>x</em>).\n<br>\nThis works whenever <em>x</em> is positive<sup>&dagger;</sup>. For the definition of exponentials, mathematically you need <a href=\"https://en.wikipedia.org/wiki/Limit_%28mathematics%29\">limits</a>. These exist in <a href=\"https://en.wikipedia.org/wiki/Complete_metric_space\">complete spaces</a>, i.e. &ldquo;spaces without holes&rdquo;. The real numbers are complete by definition, but the rationals are not! To handwave the reason: <code>Rational</code> is &ldquo;infinitely accurate&rdquo;, i.e. each value is really a single exact number. However, you can in reality only ever use a finite number of such rationals.<br>\nOTOH, floating-point types are by design <em>not exact</em>. <a href=\"http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html\">This often leads to confusion</a>, but mathematically it can actually be interpreted quite nicely: every <code>Double</code> value represents a whole <em>interval</em> of real numbers, and if you take the unit of all those values you get not just a set of discrete points but <em>the whole real line</em>.<br>\nAnd that's how the <code>Floating</code> class with its instance for <code>Double</code> represents complete spaces, and why this class has the method <code>(**) :: Floating a =&gt; a -&gt; a -&gt; a</code>.</li>\n</ul>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>In the <a href=\"https://en.wikipedia.org/wiki/Complex_number\">complex numbers</a> you can even define the logarithm of negative numbers, though it leads again to uniqueness problems.</sub></p>\n"}], "owner": {"reputation": 1819, "user_id": 2059662, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/995b46d292bdd2e74f81d247a14cf8bc?s=128&d=identicon&r=PG", "display_name": "Ludwik", "link": "https://stackoverflow.com/users/2059662/ludwik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 604, "favorite_count": 0, "accepted_answer_id": 32189732, "answer_count": 2, "score": 2, "last_activity_date": 1440447335, "creation_date": 1440396764, "last_edit_date": 1440442909, "question_id": 32175510, "link": "https://stackoverflow.com/questions/32175510/raising-a-number-to-a-fractionaldata-ratio-power", "title": "Raising a number to a fractional(Data.Ratio) power?", "body": "<p>An expression like <code>2^(2%1)</code> does not typecheck in GHCi, and the error messages are cryptic. Why does this not work, what do I need to change?</p>\n\n<p>I can't convert to another type, I want this for expressions like <code>27^(1%3)</code>.</p>\n"}, {"tags": ["haskell", "types", "existential-type"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 7, "last_activity_date": 1440389845, "creation_date": 1440389845, "answer_id": 32174361, "question_id": 32174157, "link": "https://stackoverflow.com/questions/32174157/wrapping-unwrapping-universally-quantified-types/32174361#32174361", "title": "Wrapping / Unwrapping Universally Quantified Types", "body": "<p>You claim to define an existential type, but you do not.</p>\n\n<pre><code>type Y = forall a. X a\n</code></pre>\n\n<p>defines a universally quantified type. For something to have type <code>Y</code>, it must have type <code>X a</code> for <em>every</em> <code>a</code>. To make an existentially quantified type, you always need to use <code>data</code>, and I find the GADT syntax easier to understand than the traditional existential one.</p>\n\n<pre><code>data Y where\n  Y :: forall a . X a -&gt; Y\n</code></pre>\n\n<p>The <code>forall</code> there is actually optional, but I think clarifies things.</p>\n\n<p>I'm too sleepy right now to work out your other questions, but I'll try again tomorrow if no one else does.</p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1440393963, "post_id": 32174704, "comment_id": 52235901, "body": "Your remark took me a while. Don&#39;t you mean &quot;I could not really <b>put</b> it there&quot;? That being said you can always edit other answers to add more information, or provide a link to a gist/similar external resources in a comment if you think that&#39;s more appropriate."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1440396455, "post_id": 32174704, "comment_id": 52236787, "body": "yes sorry <code>put</code> (one moment) - and yeah I could edit dfeuers answer (and I&#39;ve done so on occasion) but in this case I kindof hoped to get some rep as well (yeah I know, I already feel ashamed) ^^"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440408654, "post_id": 32174704, "comment_id": 52243240, "body": "Constrain the forall, or stick more than one thing in the box, that will match each other."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1440409658, "post_id": 32174704, "comment_id": 52243844, "body": "<b>thanks for the edit</b> ... I should not answer questions before my first cup of coffee ... seems my fingers are faster than my brain (and yes the english was horrible)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 6, "last_activity_date": 1440408906, "last_edit_date": 1440408906, "creation_date": 1440392266, "answer_id": 32174704, "question_id": 32174157, "link": "https://stackoverflow.com/questions/32174157/wrapping-unwrapping-universally-quantified-types/32174704#32174704", "title": "Wrapping / Unwrapping Universally Quantified Types", "body": "<h3>Remark:</h3>\n\n<p>This is more like a comment but I could not really put it there as it would have been unreadable; please forgive me this one time. </p>\n\n<hr>\n\n<p>Aside from what dfeuer already told you, you might see (when you use his answer) that <code>toY</code> is now really easy to do but you might have trouble defining <code>fromY</code> &ndash; because you basically lose the type-information, so this <strong>will not work</strong>:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\nmodule ExTypes where\n\ndata X a = X a\n\ndata Y where\n  Y :: X a -&gt; Y\n\nfromY :: Y -&gt; X a\nfromY (Y a) = a\n</code></pre>\n\n<p>as here you have two different <code>a</code>s &ndash; one from the constructor <code>Y</code> and one from <code>X a</code> &ndash; indeed if you strip the definition and try to compile: <code>fromY (Y a) = a</code> the compiler will tell you that the <em>type <code>a</code> escapes</em>:</p>\n\n<pre><code>Couldn't match expected type `t' with actual type `X a'\n  because type variable `a' would escape its scope\nThis (rigid, skolem) type variable is bound by\n  a pattern with constructor\n    Y :: forall a. X a -&gt; Y,\n  in an equation for `fromY'\n</code></pre>\n\n<p>I think the only thing you will have left now will be something like this:</p>\n\n<pre><code>useY :: (forall a . X a -&gt; b) -&gt; Y -&gt; b\nuseY f (Y x) = f x\n</code></pre>\n\n<p>but this might prove not to be too useful.</p>\n\n<p>The thing is that you normally should constrain the <code>forall a</code> there a bit more (with type-classes) to get any meaningful behavior &ndash; but of course I cannot help here.</p>\n\n<p>This <a href=\"https://wiki.haskell.org/Existential_type\">wiki article</a> might be interesting for you on the details.</p>\n"}], "owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 32174704, "answer_count": 2, "score": 4, "last_activity_date": 1440459103, "creation_date": 1440387810, "last_edit_date": 1440459103, "question_id": 32174157, "link": "https://stackoverflow.com/questions/32174157/wrapping-unwrapping-universally-quantified-types", "title": "Wrapping / Unwrapping Universally Quantified Types", "body": "<p>I have imported a data type, <code>X</code>, defined as</p>\n\n<pre><code>data X a = X a\n</code></pre>\n\n<p>Locally, I have defined a universally quantified data type, <code>Y</code></p>\n\n<pre><code>type Y = forall a. X a\n</code></pre>\n\n<p>Now I need to define two functions, <code>toY</code> and <code>fromY</code>. For <code>fromY</code>, this definition works fine:</p>\n\n<pre><code>fromY :: Y -&gt; X a\nfromY a = a\n</code></pre>\n\n<p>but if I try the same thing for <code>toY</code>, I get an error</p>\n\n<pre><code>Couldn't match type 'a' with 'a0'\n'a' is a rigid type variable bound by the type signature for 'toY :: X a -&gt; y'\n'a0' is a rigid type variable bound by the type signature for 'toY :: X a -&gt; X a0'\nExpected type: X a0\nActual type: X a\n</code></pre>\n\n<p>If I understand correctly, the type signature for <code>toY</code> is expanding to <code>forall a. X a -&gt; (forall a0. X a0)</code> because <code>Y</code> is defined as a synonym, rather than a newtype, and so the two <code>a</code>s in the definitions don't match up. </p>\n\n<p>But if this is the case, then why does <code>fromY</code> type-check successfully? And is there any way around this problem other than using <code>unsafeCoerce</code>?</p>\n"}, {"tags": ["haskell", "emacs"], "comments": [{"owner": {"reputation": 5058, "user_id": 1653187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3942782a314cdc7d6a7364cd32bfd3b3?s=128&d=identicon&r=PG", "display_name": "nickie", "link": "https://stackoverflow.com/users/1653187/nickie"}, "edited": false, "score": 0, "creation_date": 1440370436, "post_id": 32172230, "comment_id": 52231022, "body": "Is the <code>ghci</code> binary somewhere in the <code>PATH</code> or in <code>~&#47;Library&#47;Haskell&#47;bin</code>?  If <code>which ghci</code> reveals that it&#39;s somewhere else, try adding it to the path."}, {"owner": {"reputation": 27385, "user_id": 729907, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HeXcc.png?s=128&g=1", "display_name": "Drew", "link": "https://stackoverflow.com/users/729907/drew"}, "edited": false, "score": 0, "creation_date": 1440374189, "post_id": 32172230, "comment_id": 52231768, "body": "Check the generated autoloads file, to see in what way it does not correspond to what you expected, in particular, wrt loading the file that defines <code>haskell-interactive-bring</code>. The error msg is telling you that the file that defines it was not loaded. Check also for a typo in the function name. ;-)"}, {"owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "reply_to_user": {"reputation": 5058, "user_id": 1653187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3942782a314cdc7d6a7364cd32bfd3b3?s=128&d=identicon&r=PG", "display_name": "nickie", "link": "https://stackoverflow.com/users/1653187/nickie"}, "edited": false, "score": 0, "creation_date": 1440375224, "post_id": 32172230, "comment_id": 52231967, "body": "@nickie: ghci is in /usr/bin, and I added the path with <code>(add-to-list &#39;exec-path &quot;&#47;usr&#47;bin&quot;)</code> in <code>init.el</code> just in case. The results are the same, though."}, {"owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "reply_to_user": {"reputation": 27385, "user_id": 729907, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HeXcc.png?s=128&g=1", "display_name": "Drew", "link": "https://stackoverflow.com/users/729907/drew"}, "edited": false, "score": 0, "creation_date": 1440375308, "post_id": 32172230, "comment_id": 52231979, "body": "@Drew: Could you elaborate where the generated autoloads file is located? The file name is correct, as is blinded to C-` in the setup file. I corrected the title though."}, {"owner": {"reputation": 27385, "user_id": 729907, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HeXcc.png?s=128&g=1", "display_name": "Drew", "link": "https://stackoverflow.com/users/729907/drew"}, "edited": false, "score": 0, "creation_date": 1440386690, "post_id": 32172230, "comment_id": 52234261, "body": "I&#39;m no expert on <code>package.el</code>, but I think you might find a file <code>YOUR-PACKAGE-autoloads.el</code>, which was generated when you installed package <code>YOUR-PACKAGE</code>. In any case, one place to start is to find out what file <code>haskell-interactive-bring</code> is defined in."}], "answers": [{"tags": [], "owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "is_accepted": true, "score": 2, "last_activity_date": 1440377655, "creation_date": 1440377655, "answer_id": 32173088, "question_id": 32172230, "link": "https://stackoverflow.com/questions/32172230/autoloading-failed-to-define-function-haskell-interactive-bring-issue-with-run/32173088#32173088", "title": "&quot;Autoloading failed to define function haskell-interactive-bring&quot; issue with running Haskell on Emacs", "body": "<p>The issue was that I have \"haskell.el\" that stores all the haskell related configuration setup. This has caused some conflict so that the \"haskell.el\" in the <code>ELPA/haskell...</code> package unable to properly loaded. </p>\n\n<p>When I renamed my \"haskell.el\" to \"haskell_config.el\", everything seems to be working fine. </p>\n"}], "owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 665, "favorite_count": 0, "accepted_answer_id": 32173088, "answer_count": 1, "score": 0, "last_activity_date": 1440377655, "creation_date": 1440369406, "last_edit_date": 1495539835, "question_id": 32172230, "link": "https://stackoverflow.com/questions/32172230/autoloading-failed-to-define-function-haskell-interactive-bring-issue-with-run", "title": "&quot;Autoloading failed to define function haskell-interactive-bring&quot; issue with running Haskell on Emacs", "body": "<p>Following <a href=\"https://stackoverflow.com/questions/26603649/haskell-repl-in-emacs\">haskell repl in emacs</a>, I could install packages. I used MELPA stable for repository (<code>'(\"melpa-stable\" . \"http://stable.melpa.org/packages/\") t)</code>)</p>\n\n<ul>\n<li>ghc</li>\n<li>haskell-mode</li>\n<li>flycheck</li>\n<li>flycheck-haskell</li>\n</ul>\n\n<p>I also installed the binaries with <code>cabal</code>.</p>\n\n<ul>\n<li>cabal install ghc-mod (5.3.0.0)</li>\n<li>cabal install happy (1.19.5)</li>\n</ul>\n\n<p>Cabal version 1.22.6.0, GNU Emacs version 24.5.1 on Mac OS X 10.10.4. </p>\n\n<p>The issue is that when I tried to run ghci with C-`, I have the error message.  </p>\n\n<pre><code>command-execute: Autoloading failed to define function haskell-interactive-bring\n</code></pre>\n\n<p>With <code>C-c C-l</code>, I have this error message. </p>\n\n<pre><code>command-execute: Autoloading failed to define function haskell-process-load-or-reload\n</code></pre>\n\n<p>What might be wrong? </p>\n\n<p><a href=\"https://i.stack.imgur.com/KElTx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KElTx.png\" alt=\"enter image description here\"></a></p>\n\n<p>This is the Haskell related code in <code>init.el</code>.</p>\n\n<pre><code>;; Haskell\n\n; http://www.mew.org/~kazu/proj/ghc-mod/en/preparation.html\n(autoload 'ghc-init \"ghc\" nil t)\n(autoload 'ghc-debug \"ghc\" nil t)\n(add-hook 'haskell-mode-hook (lambda () (ghc-init)))\n;;(add-hook 'haskell-mode-hook 'turn-on-haskell-indentation).\n\n; https://github.com/serras/emacs-haskell-tutorial/blob/master/tutorial.md \n; https://stackoverflow.com/questions/26603649/haskell-repl-in-emacs\n(let ((my-cabal-path (expand-file-name \"~/Library/Haskell/bin\")))\n  (setenv \"PATH\" (concat my-cabal-path \":\" (getenv \"PATH\")))\n  (add-to-list 'exec-path my-cabal-path))\n(custom-set-variables '(haskell-tags-on-save t))\n\n(add-hook 'haskell-mode-hook 'turn-on-haskell-indentation)\n\n(eval-after-load 'haskell-mode '(progn\n  (define-key haskell-mode-map (kbd \"C-c C-l\") 'haskell-process-load-or-reload)\n  (define-key haskell-mode-map (kbd \"C-`\") 'haskell-interactive-bring)\n  (define-key haskell-mode-map (kbd \"C-c C-n C-t\") 'haskell-process-do-type)\n  (define-key haskell-mode-map (kbd \"C-c C-n C-i\") 'haskell-process-do-info)\n  (define-key haskell-mode-map (kbd \"C-c C-n C-c\") 'haskell-process-cabal-build)\n  (define-key haskell-mode-map (kbd \"C-c C-n c\") 'haskell-process-cabal)))\n(eval-after-load 'haskell-cabal '(progn\n  (define-key haskell-cabal-mode-map (kbd \"C-`\") 'haskell-interactive-bring)\n  (define-key haskell-cabal-mode-map (kbd \"C-c C-k\") 'haskell-interactive-ode-clear)\n  (define-key haskell-cabal-mode-map (kbd \"C-c C-c\") 'haskell-process-cabal-build)\n  (define-key haskell-cabal-mode-map (kbd \"C-c c\") 'haskell-process-cabal)))\n\n(custom-set-variables\n '(haskell-interactive-mode-hide-multi-line-errors nil)\n '(haskell-process-log t)\n '(haskell-process-type (quote cabal-repl)))\n</code></pre>\n\n<h2>Added</h2>\n\n<p>In Emacs, auto completion shows that the \"haskell-interactive-bring\" function is available. </p>\n\n<p><a href=\"https://i.stack.imgur.com/Uo1P0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Uo1P0.png\" alt=\"enter image description here\"></a></p>\n\n<p>However, <code>autoloading</code> is failed. </p>\n\n<p><a href=\"https://i.stack.imgur.com/MXydt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/MXydt.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "count", "factors", "number-theory", "factorization"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 2, "creation_date": 1440364511, "post_id": 32171280, "comment_id": 52229549, "body": "Another hint: note that the nth triangular number is <code>n*(n+1)&#47;2</code>, and since <code>n</code> and <code>n+1</code> are co-prime ..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4933255"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440366077, "post_id": 32171280, "comment_id": 52229973, "body": "[Thinks] So, given n, get the prime factors of it and n + 1, then multiply every combination of them to get all factors of the triangular number??"}], "answers": [{"tags": [], "owner": {"reputation": 23808, "user_id": 2382734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d80069e46785505b443aa9d1dd9eb3a3?s=128&d=identicon&r=PG", "display_name": "Renzo", "link": "https://stackoverflow.com/users/2382734/renzo"}, "is_accepted": false, "score": 3, "last_activity_date": 1440363832, "last_edit_date": 1495541962, "creation_date": 1440363832, "answer_id": 32171515, "question_id": 32171280, "link": "https://stackoverflow.com/questions/32171280/efficiently-finding-the-number-of-divisors-in-haskell/32171515#32171515", "title": "Efficiently finding the number of divisors in Haskell", "body": "<p>The problem is that the function to find the number of divisors is very slow, since it test for all the numbers. There are much more efficient functions. See for instance the answers to this question on StackOverflow: <a href=\"https://stackoverflow.com/questions/12052059/two-simple-codes-to-generate-divisors-of-a-number-why-is-the-recursive-one-fast\">Two simple codes to generate divisors of a number. Why is the recursive one faster?</a>. </p>\n\n<p>But if you Google a little bit you could find many other algorithms.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 8, "last_activity_date": 1440369872, "creation_date": 1440369872, "answer_id": 32172277, "question_id": 32171280, "link": "https://stackoverflow.com/questions/32171280/efficiently-finding-the-number-of-divisors-in-haskell/32172277#32172277", "title": "Efficiently finding the number of divisors in Haskell", "body": "<p>Another problem is that your generation of the triangular numbers which, while correct, is very inefficient. For instance, to compute the 11th number you are summing [1..11], and then to compute the 12th number you are summing [1..12] which doesn't use the results of the previous computation.</p>\n\n<p>As I mentioned in my comment, you can compute the n-th triangular number directly using <code>n*(n+1)/2</code>. However, even if you didn't know this formula you can take advantage of the similarity between consecutive triangular numbers by using a recursion like this:</p>\n\n<pre><code>triangulars = go 1 2\n  where go s n = s : go (s+n) (n+1)\n</code></pre>\n\n<p>This kind of recursion is also captured by the <code>scanl</code> function:</p>\n\n<pre><code>triangulars = scanl (+) 1 [2..]\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4933255"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2057, "favorite_count": 0, "accepted_answer_id": 32172277, "answer_count": 2, "score": 4, "last_activity_date": 1584117309, "creation_date": 1440362222, "last_edit_date": 1584117309, "question_id": 32171280, "link": "https://stackoverflow.com/questions/32171280/efficiently-finding-the-number-of-divisors-in-haskell", "title": "Efficiently finding the number of divisors in Haskell", "body": "<p>Trying to work out Problem 12 on Project Euler in Haskell.</p>\n\n<blockquote>\n  <p>The sequence of triangle numbers is generated by adding the natural\n  numbers.</p>\n  \n  <p>So the 7th triangle number would be 1 + 2 + 3 + 4 + 5 + 6 + 7 = 28. The first ten terms would be:</p>\n\n<pre><code>1, 3, 6, 10, 15, 21, 28, 36, 45, 55, ...\n</code></pre>\n  \n  <p>Let us list the factors of the first seven triangle numbers:</p>\n\n<pre><code>1: 1\n3: 1,3\n6: 1,2,3,6\n10: 1,2,5,10\n15: 1,3,5,15\n21: 1,3,7,21\n28: 1,2,4,7,14,28\n We can see that 28 is the first triangle number to have over five divisors.\n</code></pre>\n  \n  <p>What is the value of the first triangle number to have over five\n  hundred divisors?</p>\n</blockquote>\n\n<p>My solution works fine for small numbers of divisors (e.g. given 5, it returns 28), but when 500 is input, it seems to hang indefinitely.</p>\n\n<pre><code>-- Lazily generates infinite list of triangle numbers.\ntriangleNumbers :: [Integer]\ntriangleNumbers = map (\\x -&gt; sum [1..x]) [1..]\n\n-- Given a number, returns the a tuple of how many divisors it has and the number.\nnumDivisors :: Integer -&gt; (Int, Integer)\nnumDivisors num = (length [x | x &lt;- [1..num], num `mod` x == 0], num)\n\np12 :: Integer\np12 = snd $ head $ filter (\\x -&gt; fst x &gt; 500) $ map numDivisors triangleNumbers\n</code></pre>\n\n<p>Do you have any idea what I might be doing wrong? Thank you!</p>\n"}, {"tags": ["haskell", "double", "rounding", "show"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 11, "last_activity_date": 1440360551, "last_edit_date": 1440360551, "creation_date": 1440356222, "answer_id": 32170321, "question_id": 32170167, "link": "https://stackoverflow.com/questions/32170167/haskell-how-to-properly-display-a-percentage-up-to-two-decimals/32170321#32170321", "title": "Haskell: how to properly display a percentage up to two decimals?", "body": "<pre><code>&gt; import Text.Printf\n&gt; printf \"%.2f\" 0.22324 :: String\n\"0.22\"\n</code></pre>\n\n<p>You can use <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Text-Printf.html\">most format strings C's <code>printf</code> supports</a>.</p>\n\n<p>Keep in mind, however, that Haskell's <code>printf</code> involves some complex typeclass machinery, and can generate hard-to-read type errors. It is also very general, since it can also return IO actions, i.e.</p>\n\n<pre><code>&gt; printf \"%.2f\" 0.22324 :: IO ()\n0.22\n</code></pre>\n\n<p>does not return a string but directly prints it. I'd recommend you always add a type annotation (such as <code>:: String</code> above) after each call of <code>printf</code>, unless it's clear from the context what is the return type (e.g. in a <code>do</code> block with other IO actions).</p>\n"}, {"tags": [], "owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "is_accepted": false, "score": 8, "last_activity_date": 1440361077, "last_edit_date": 1440361077, "creation_date": 1440360707, "answer_id": 32171030, "question_id": 32170167, "link": "https://stackoverflow.com/questions/32170167/haskell-how-to-properly-display-a-percentage-up-to-two-decimals/32171030#32171030", "title": "Haskell: how to properly display a percentage up to two decimals?", "body": "<p><code>printf</code> is solid, and another library worth knowing about is <a href=\"https://hackage.haskell.org/package/formatting\" rel=\"noreferrer\">formatting</a> (which is based off of the lovely <a href=\"https://hackage.haskell.org/package/HoleyMonoid\" rel=\"noreferrer\">HoleyMonoid</a> library):</p>\n\n<pre><code>Prelude Formatting&gt; format (\"to two decimal places: \" % prec 2 % \"!\") 0.2222\n\"to two decimal places: 0.22!\"\n</code></pre>\n\n<p>Note that <code>formatting</code> is type-safe, unlike <code>printf</code>:</p>\n\n<pre><code>Prelude Text.Printf Formatting&gt; :t printf \"%.2f\" \"hi\"\nprintf \"%.2f\" \"hi\" :: PrintfType t =&gt; t\nPrelude Text.Printf Formatting&gt; printf \"%.2f\" \"hi\"\n*** Exception: printf: bad formatting char 'f'\n\nPrelude Text.Printf Formatting&gt; :t format (prec 2) \"hi\"\n-- type error\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12964, "user_id": 704015, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/rpCnn.png?s=128&g=1", "display_name": "Jezen Thomas", "link": "https://stackoverflow.com/users/704015/jezen-thomas"}, "is_accepted": false, "score": 1, "last_activity_date": 1550551214, "creation_date": 1550551214, "answer_id": 54758957, "question_id": 32170167, "link": "https://stackoverflow.com/questions/32170167/haskell-how-to-properly-display-a-percentage-up-to-two-decimals/54758957#54758957", "title": "Haskell: how to properly display a percentage up to two decimals?", "body": "<p>Here's a function to display a floating point number used to represent a percentage. It doesn't include the <code>%</code> symbol, but you could prepend that. It's validating the number is between <code>0</code> and <code>100</code> because this function would produce incorrect results for a number like <code>1e7</code>.</p>\n\n<pre><code>showPercent :: Double -&gt; Maybe Text\nshowPercent d\n  | d &lt; 0 = Nothing\n  | d &gt; 100 = Nothing\n  | otherwise = Just . pack $ f d\n  where\n    f x = reverse $ case reverse (show x) of\n      '0':'.':rest -&gt; rest\n      rest         -&gt; rest\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>\u03bb showPercent (-5)\nNothing\n\n\u03bb showPercent 0\nJust \"0\"\n\n\u03bb showPercent 5\nJust \"5\"\n\n\u03bb showPercent 10.5\nJust \"10.5\"\n\n\u03bb showPercent 15.765\nJust \"15.765\"\n\n\u03bb showPercent 35.123000000\nJust \"35.123\"\n\n\u03bb showPercent 51.123000321000\nJust \"51.123000321\"\n\n\u03bb showPercent 200\nNothing\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 5069069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/prATt.png?s=128&g=1", "display_name": "Fornost", "link": "https://stackoverflow.com/users/5069069/fornost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2605, "favorite_count": 2, "accepted_answer_id": 32170321, "answer_count": 3, "score": 11, "last_activity_date": 1550652534, "creation_date": 1440355403, "last_edit_date": 1550652534, "question_id": 32170167, "link": "https://stackoverflow.com/questions/32170167/haskell-how-to-properly-display-a-percentage-up-to-two-decimals", "title": "Haskell: how to properly display a percentage up to two decimals?", "body": "<p>In a program, I calculate a percentage and print it to the user. The issue is that the percentage printed is shown with too many decimals. I searched for a function addressing this issue, didn't find one, and programmed the rounding function below, but I wonder if there is a more standard way to do this instead. Also, the idea described in <a href=\"https://stackoverflow.com/questions/30396740/how-to-round-off-a-float-value-so-that-it-should-not-contain-0-after-decimal\">this Java topic</a> is pretty neat, and if there already are functions to do that, I would love to know.</p>\n\n<pre><code>roundTo :: (Integral int1, Integral int2) =&gt; int1 -&gt; Double -&gt; Either int2 Double\nroundTo digitsAfterComma value\n    | (digitsAfterComma &gt;= 1) =\n        let\n            factor = fromIntegral (10 ^ digitsAfterComma)\n            result = ((/ factor) . fromIntegral . round . (* factor)) value\n        in\n            Right result\n    | (digitsAfterComma == 0) = Left (round value)\n    | otherwise = error \"minimal precision must be non-negative\"\n</code></pre>\n\n<p>Update: A more complete version follows, developed thanks to some of the answers I've received.</p>\n\n<pre><code>import qualified Text.Printf as T\n\nshowPercentage :: (Integral a, Show a) =&gt; a -&gt; Double -&gt; String\nshowPercentage digitsAfterComma fraction\n    | (digitsAfterComma &gt;= 1) =\n        let formatString = \"%.\" ++ (show digitsAfterComma) ++ \"f%%\"\n        in  T.printf formatString percentage\n\n    | (digitsAfterComma == 0) =\n        let formatString = \"%d%%\"\n        in  T.printf formatString (round percentage :: Int)\n\n    | otherwise = error \"minimal precision must be non-negative\"\n    where percentage = 100 * fraction\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 6, "creation_date": 1440355778, "post_id": 32170103, "comment_id": 52227080, "body": "<code>filter (\\x -&gt; checkFibDigits x == True) ([1..]))</code> <b><i>UGH!!!</i></b>. Do you realize that&#39;s <i>exactly</i> as doing: <code>filter checkFibDigits [1..]</code>?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1440444120, "post_id": 32170103, "comment_id": 52265335, "body": "Let me clarify what @Bakuriu wrote: <code>a == True</code> is <code>a</code> for any <code>a</code>. also, <code>\\x -&gt; f x</code> is <code>f</code>. Thus, <code>(\\x -&gt; checkFibDigits x == True)</code> can be reduced to <code>(\\x -&gt; checkFibDigits x)</code> and from that into <code>checkFibDigits</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4933255"}, "edited": false, "score": 0, "creation_date": 1440534112, "post_id": 32170103, "comment_id": 52310590, "body": "I get it! Thank you! :)"}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 3, "last_activity_date": 1440356541, "last_edit_date": 1440356541, "creation_date": 1440355937, "answer_id": 32170262, "question_id": 32170103, "link": "https://stackoverflow.com/questions/32170103/digit-counter-fibonacci-list-haskell-trouble/32170262#32170262", "title": "Digit Counter Fibonacci List Haskell trouble", "body": "<p>Just change <code>Int</code> to <code>Integer</code> for <code>fib</code> and <code>checkDigits</code>, you will notice that the answer will appear instantaneously:</p>\n\n<pre><code>fib :: [Integer]\nfib = 1 : 1 : zipWith (+) fib (tail fib)\n\ncheckDigits :: Integer -&gt; Bool\ncheckDigits number = length (show number) == 1000\n</code></pre>\n\n<p>That's because <code>Int</code> has limited size whereas <code>Integer</code> has an arbitrary precision which is limited by your system memory.</p>\n"}, {"tags": [], "owner": {"reputation": 117024, "user_id": 200291, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/399cacf55045372a29f1f844d12ee777?s=128&d=identicon&r=PG", "display_name": "icktoofay", "link": "https://stackoverflow.com/users/200291/icktoofay"}, "is_accepted": true, "score": 3, "last_activity_date": 1440357675, "last_edit_date": 1440357675, "creation_date": 1440356133, "answer_id": 32170307, "question_id": 32170103, "link": "https://stackoverflow.com/questions/32170103/digit-counter-fibonacci-list-haskell-trouble/32170307#32170307", "title": "Digit Counter Fibonacci List Haskell trouble", "body": "<p>Your immediate problem is using <code>Int</code> rather than <code>Integer</code> in the type of <code>fib</code>, which limits the values to never go above around 2<sup>31</sup>, but beyond that, yes, the way you\u2019re doing it is pretty inefficient. Namely, it\u2019s O(n<sup>2</sup>) when it really ought to be O(n). The way you\u2019re generating the Fibonacci sequence is fine, but when trying to find the first value that\u2019s a thousand digits, you go:</p>\n\n<ul>\n<li>Is the first element of the Fibonacci sequence greater than 1000 digits? No, move on\u2026</li>\n<li>Is the second element [which, oh wait, I need to get from this linked list, so I better follow the \u2018next\u2019 pointer some number of times] greater than 1000 digits? No, move on\u2026</li>\n<li>\u2026</li>\n<li>Is the 50th element [better start at the beginning of the linked list, follow the next pointer, follow the next pointer, follow the next pointer, \u2026, and fetch the value at this element] greater than 1000 digits? No, move on\u2026</li>\n<li>\u2026</li>\n</ul>\n\n<p>Basically, you\u2019re re-traversing the linked list each and every single time. A different approach might be to zip together the index and corresponding Fibonacci result:</p>\n\n<pre><code>ghci&gt; take 10 $ zip [1..] fib\n[(1,1),(2,1),(3,2),(4,3),(5,5),(6,8),(7,13),(8,21),(9,34),(10,55)]\n</code></pre>\n\n<p>Then you drop elements until the Fibonacci value is at least 1000 digits, and take the index of the first one left:</p>\n\n<pre><code>ghci&gt; fst $ head $ dropWhile ((&lt; 1000) . length . show . snd) $ zip [1..] fib\n4782\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4933255"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 32170307, "answer_count": 2, "score": 0, "last_activity_date": 1440357675, "creation_date": 1440355077, "question_id": 32170103, "link": "https://stackoverflow.com/questions/32170103/digit-counter-fibonacci-list-haskell-trouble", "title": "Digit Counter Fibonacci List Haskell trouble", "body": "<p>So, for problem 25 in Project Euler, I have to find the position of the first number in the Fibonacci sequence with a thousand digits.</p>\n\n<pre><code>-- Lazily generates an infinite Fibonacci series\nfib :: [Int]\nfib = 1 : 1 : zipWith (+) fib (tail fib)\n\n-- Checks if given number has a thousand digits.\ncheckDigits :: Int -&gt; Bool\ncheckDigits number = length (show number) == 1000\n\n-- Checks if position in Fibonacci series has a thousand digits.\ncheckFibDigits :: Int -&gt; Bool\ncheckFibDigits pos = checkDigits (fib !! (pos - 1))\n\np25 = head (filter (\\x -&gt; checkFibDigits x == True) ([1..]))\n</code></pre>\n\n<p>For some reason, this approach seems to hang indefinitely. If I replace 1000 with 10, it spits out 45, which is the position of the first number with 10 digits. </p>\n\n<p>Either my approach is crazy inefficient, or Haskell's doing something weird with big numbers. A similar approach in Python worked pretty flawlessly.</p>\n\n<p>Thank you for your help!</p>\n"}, {"tags": ["haskell", "functional-programming", "parsec"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1440344009, "post_id": 32168244, "comment_id": 52223406, "body": "<code>return $ nub value</code> - this is a simple typographical error. Right now you&#39;re trying to apply <code>return</code> to <code>nub</code>, instead of to <code>nub value</code>. Note that this will <i>not</i> make your parser only parse a unique list of items, it will merely filter out duplicates that exist in the list."}, {"owner": {"reputation": 2332, "user_id": 5257398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YBwUZ.png?s=128&g=1", "display_name": "Dexter", "link": "https://stackoverflow.com/users/5257398/dexter"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1440344780, "post_id": 32168244, "comment_id": 52223640, "body": "@Cubic Thank you for pointing this out, this indeed works and you are right in that this will not make my parser parse a unique list of items, but it is already pretty close to what I want to achieve. What I am wondering is whether what I want to achieve is possible using a parser or whether I should perhaps try to achieve this in another way."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1440345163, "post_id": 32168244, "comment_id": 52223758, "body": "Spoilers: yes, it&#39;s possible - but if you don&#39;t restrict the possible strings in that list you&#39;re entering context sensitive territory. You have to parse the list in a more manual way though, because you&#39;ll need to remember list items you&#39;ve already looked at."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1440345214, "post_id": 32168244, "comment_id": 52223779, "body": "It should be possible but I think this <i>requires</i> the monadic interface. Using only <code>Applicative</code> I don&#39;t think this is achievable."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1440346251, "post_id": 32168244, "comment_id": 52224113, "body": "@Cubic, it would be possible to parse the list as in the current code, but then to <code>=&lt;&lt;</code> on a function checking that elements are unique. The downside is that failure won&#39;t be detected till the list is completely parsed, but the code will be simple."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1440346657, "post_id": 32168244, "comment_id": 52224235, "body": "You can use <code>do ... value &lt;- ... ; guard (noDuplicates value); return value</code>, after having defined your own custom predicate <code>noDuplicates :: [String] -&gt; Bool</code>. Note that this will make the parser fail only after the whole list is parsed -- you may want to fail as soon as the first duplicate is found instead."}], "answers": [{"comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1440355681, "post_id": 32168831, "comment_id": 52227047, "body": "To improve efficiency redefine <code>allUnique ls = size (fromList ls) == length ls</code> where you <code>import Data.Set(size, fromList)</code>. This should take O(nlogn) (which is optimal). It changes the constraint from <code>Eq</code> to <code>Ord</code> but this shouldn&#39;t be a problem."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1440437517, "post_id": 32168831, "comment_id": 52261723, "body": "With the Functor-Applicative-Monad proposal in effect, <code>guard</code> now has type <code>Alternative f =&gt; Bool -&gt; f ()</code>, but that&#39;s fine because Parsec parsers also have an <code>Alternative</code> instance."}, {"owner": {"reputation": 5171, "user_id": 2718186, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ca44ca18bf615e74f930d28a89d01508?s=128&d=identicon&r=PG", "display_name": "MicroVirus", "link": "https://stackoverflow.com/users/2718186/microvirus"}, "edited": false, "score": 1, "creation_date": 1457015456, "post_id": 32168831, "comment_id": 59221161, "body": "<code>guard</code> gives the &#39;expecting ...&#39; error message; this isn&#39;t always appropriate and then you can use <code>when cond $ fail &quot;message here&quot;</code> to get an error message that is not &#39;expecting&#39;."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 8, "last_activity_date": 1440347013, "creation_date": 1440347013, "answer_id": 32168831, "question_id": 32168244, "link": "https://stackoverflow.com/questions/32168244/how-can-i-write-a-parser-using-parsec-that-only-accepts-unique-elements/32168831#32168831", "title": "How can I write a parser using Parsec that only accepts unique elements?", "body": "<p>The Parsec <code>Parser</code> type is an instance of <code>MonadPlus</code> which means that we can always fail (ie cause a parse error) whenever we want. A handy function for this is <code>guard</code>:</p>\n\n<pre><code>guard :: MonadPlus m =&gt; Bool -&gt; m ()\n</code></pre>\n\n<p>This function takes a boolean. If it's true, it return <code>()</code> and the whole computation (a parse in this case) does not fail. If it's false, the whole thing fails.</p>\n\n<p>So, as long as you don't care about efficiency, here's a reasonable approach: parse the whole list, check for whether all the elements are unique and fail if they aren't.</p>\n\n<p>To do this, the first thing we have to do is write a predicate that checks if every element of a list is unique. <code>nub</code> does not quite do the right thing: it return a list with all the duplicates taken out. But if we don't care much about performance, we can use it to check:</p>\n\n<pre><code>allUnique ls = length (nub ls) == length ls\n</code></pre>\n\n<p>With this predicate in hand, we can write a function <code>unique</code> that wraps <em>any</em> parser that produces a list and ensures that list is unique:</p>\n\n<pre><code>unique parser = do res &lt;- parser\n                   guard (allUnique res)\n                   return res\n</code></pre>\n\n<p>Again, if <code>guard</code> is give <code>True</code>, it doesn't affect the rest of the parse. But if it's given <code>False</code>, it will cause an error.</p>\n\n<p>Here's how we could use it:</p>\n\n<pre><code>\u03bb&gt; parse (unique collection) \"&lt;interactive&gt;\" \"&lt;\\\"apple\\\",\\\"pear\\\",\\\"pineapple\\\",\\\"orange\\\"&gt;\"\nRight [\"apple\",\"pear\",\"pineapple\",\"orange\"]\n\u03bb&gt; parse (unique collection) \"&lt;interactive&gt;\" \"&lt;\\\"apple\\\",\\\"pear\\\",\\\"pineapple\\\",\\\"orange\\\",\\\"apple\\\"&gt;\"\nLeft \"&lt;interactive&gt;\" (line 1, column 46):unknown parse error\n</code></pre>\n\n<p>This does what you want. However, there's a problem: there is no error message supplied. That's not very user friendly! Happily, we can fix this using <code>&lt;?&gt;</code>. This is an operator provided by Parsec that lets us set the error message of a parser.</p>\n\n<pre><code>unique parser = do res &lt;- parser\n                   guard (allUnique res) &lt;?&gt; \"unique elements\"\n                   return res\n</code></pre>\n\n<p>Ahhh, much better:</p>\n\n<pre><code>\u03bb&gt; parse (unique collection) \"&lt;interactive&gt;\" \"&lt;\\\"apple\\\",\\\"pear\\\",\\\"pineapple\\\",\\\"orange\\\",\\\"apple\\\"&gt;\"\nLeft \"&lt;interactive&gt;\" (line 1, column 46):\nexpecting unique elements\n</code></pre>\n\n<p>All this works but, again, it's worth noting that it isn't efficient. It parses the whole list before realizing elements aren't unique, and <code>nub</code> takes quadratic time. However, this works and it's probably more than good enough for parsing small to medium-sized files: ie most things written by hand rather than autogenerated. </p>\n"}], "owner": {"reputation": 2332, "user_id": 5257398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YBwUZ.png?s=128&g=1", "display_name": "Dexter", "link": "https://stackoverflow.com/users/5257398/dexter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 410, "favorite_count": 3, "accepted_answer_id": 32168831, "answer_count": 1, "score": 5, "last_activity_date": 1440347013, "creation_date": 1440343270, "question_id": 32168244, "link": "https://stackoverflow.com/questions/32168244/how-can-i-write-a-parser-using-parsec-that-only-accepts-unique-elements", "title": "How can I write a parser using Parsec that only accepts unique elements?", "body": "<p>I have recently started learning Haskell and have been trying my hand at Parsec. However, for the past couple of days I have been stuck with a problem that I have been unable to find the solution to. So what I am trying to do is write a parser that can parse a string like this:</p>\n\n<pre><code>&lt;\"apple\", \"pear\", \"pineapple\", \"orange\"&gt;\n</code></pre>\n\n<p>The code that I wrote to do that is:</p>\n\n<pre><code>collection :: Parser [String]    \ncollection = (char '&lt;') *&gt; (string `sepBy` char ',')) &lt;* (char '&gt;')\n\nstring :: Parser String\nstring = char '\"' *&gt; (many (noneOf ['\\\"', '\\r', '\\n', '\"'])) &lt;* char '\"'\n</code></pre>\n\n<p>This works fine for me as it is able to parse the string that I have defined above. Nevertheless, I would now like to enforce the rule that every element in this collection must be unique and that is where I am having trouble. One of the first results I found when searching on the internet was <a href=\"https://stackoverflow.com/questions/3098391/unique-elements-in-a-haskell-list\">this</a> one, which suggest the usage of the <code>nub</code> function. Although the problem stated in that question is not the same, it would in theory solve my problem. But what I don't understand is how I can apply this function within a Parser. I have tried adding the nub function to several parts of the code above without any success. Later I also tried doing it the following way:</p>\n\n<pre><code> collection :: Parser [String]\n collection = do\n  char '&lt;'\n  value &lt;- (string `sepBy` char ','))\n  char '&gt;'\n  return nub value\n</code></pre>\n\n<p>But this does not work as the type does not match what <code>nub</code> is expecting, which I believe is one of the problems I am struggling with. I am also not entirely sure whether <code>nub</code> is the right way to go. My fear is that I am going in the wrong direction and that I won't be able to solve my problem like this. Is there perhaps something I am missing? Any advice or help anyone could provide would be greatly appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 4, "creation_date": 1440334957, "post_id": 32166754, "comment_id": 52220592, "body": "Use the function <code>elem :: Eq a =&gt; a -&gt; [a] -&gt; Bool</code> from the prelude."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1440335642, "post_id": 32166754, "comment_id": 52220755, "body": "See my updated answer for an easy way to implement this function."}], "answers": [{"tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": false, "score": 7, "last_activity_date": 1440334075, "creation_date": 1440334075, "answer_id": 32166809, "question_id": 32166754, "link": "https://stackoverflow.com/questions/32166754/check-if-a-string-contains-a-certain-character/32166809#32166809", "title": "Check if a string contains a certain character", "body": "<p>The type of <code>filter</code> is <code>(a -&gt; Bool) -&gt; [a] -&gt; [a]</code>.</p>\n\n<p>You have supplied the first argument which has type <code>Char -&gt; Bool</code> (which is correct), then the second argument which is <code>String</code> (that's <code>[Char]</code>) which is correct, so the type of <code>filter (\\x -&gt; x == c) s</code> is <code>[Char]</code>.</p>\n\n<p>But the type signature you have provided says the function returns a <code>Bool</code>, which doesn't match the actual type returned.</p>\n\n<p>You probably want to use <code>any</code> instead of <code>filter</code>. It's type is <code>(a -&gt; Bool) -&gt; [a] -&gt; Bool</code>.</p>\n\n<hr>\n\n<p>There's also an <code>all</code> function that returns <code>True</code> if and only if all elements of the list satisfy the predicate passed. You may also consider the functions <code>or</code> and <code>and</code> that given a <code>[Bool]</code> compute the disjunction or conjunction of the values. So <code>any f = or . map f</code> and <code>all f = and . map f</code>. </p>\n\n<p>For all list-related functions see the <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html\"><code>Data.List</code></a> module.</p>\n"}, {"comments": [{"owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 1, "creation_date": 1440336339, "post_id": 32166941, "comment_id": 52220944, "body": "I&#39;m not sure what you did (I&#39;m noob on Haskell). What I did was <code>charFound c s = c elem s</code> and worked ;s"}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "reply_to_user": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "edited": false, "score": 0, "creation_date": 1440336442, "post_id": 32166941, "comment_id": 52220969, "body": "Your text came out a bit garbled but you can basically implement <code>charFound</code> as <code>charFound c s = elem c s</code> or even <code>charFound = elem</code>."}], "tags": [], "owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "is_accepted": true, "score": 11, "last_activity_date": 1440400991, "last_edit_date": 1440400991, "creation_date": 1440335024, "answer_id": 32166941, "question_id": 32166754, "link": "https://stackoverflow.com/questions/32166754/check-if-a-string-contains-a-certain-character/32166941#32166941", "title": "Check if a string contains a certain character", "body": "<p>For your purpose, you could use the function <code>elem :: Eq a =&gt; a -&gt; [a] -&gt; Bool</code> from prelude. It does exactly what it says on the label. To implement this function, I would use something like this:</p>\n\n<pre><code>elem = any . (==)\n</code></pre>\n\n<p>or even more elementary:</p>\n\n<pre><code>elem x = foldr ((||) . (x ==)) False\n</code></pre>\n\n<p>Notice that due to the short-circuit behaviour of <code>(||)</code> this also works with infinite lists as long as <code>x</code> is found.</p>\n"}], "owner": {"reputation": 2302, "user_id": 2054434, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/e8f5c753d781ce498b857ec9b7ce366f?s=128&d=identicon&r=PG&f=1", "display_name": "PlayHardGoPro", "link": "https://stackoverflow.com/users/2054434/playhardgopro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13061, "favorite_count": 1, "accepted_answer_id": 32166941, "answer_count": 2, "score": 4, "last_activity_date": 1440400991, "creation_date": 1440333698, "last_edit_date": 1440335437, "question_id": 32166754, "link": "https://stackoverflow.com/questions/32166754/check-if-a-string-contains-a-certain-character", "title": "Check if a string contains a certain character", "body": "<p>I need to check if my string contain a specific character.  </p>\n\n<p>I tried this:  </p>\n\n<pre><code>charFound :: Char -&gt; String -&gt; Bool\ncharFound c s = filter(\\x -&gt; x == c) s\n</code></pre>\n\n<p>But it gives me: </p>\n\n<blockquote>\n  <p>Couldn't match expected type <code>Bool</code> with actual type <code>[Char]</code>  </p>\n</blockquote>\n\n<p>I know that filter:  </p>\n\n<blockquote>\n  <p>returns a list constructed from members of a list (the second argument) fulfilling a condition given by the first argument.  </p>\n</blockquote>\n\n<p>How could I reach the goal and return a bool instead of a list?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 6, "creation_date": 1440336302, "post_id": 32166635, "comment_id": 52220929, "body": "And what should happen if some string is longer than 10?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1440355212, "post_id": 32166635, "comment_id": 52226885, "body": "<a href=\"http://hackage.haskell.org/package/split-0.2.2/docs/Data-List-Split.html#v:chunksOf\" rel=\"nofollow noreferrer\">chunksOf</a>"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 3042405, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/55649e03fa7c14ee37f459c006055075?s=128&d=identicon&r=PG&f=1", "display_name": "user3042405", "link": "https://stackoverflow.com/users/3042405/user3042405"}, "edited": false, "score": 0, "creation_date": 1440334148, "post_id": 32166795, "comment_id": 52220363, "body": "Sorry I didn\u2019t make my questions clear, the limit of 10 is based on Characters within the strings. So if the limit was 2, the input &quot;abcde&quot; would be broken down in to 3 lists."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": -1, "last_activity_date": 1440334419, "last_edit_date": 1440334419, "creation_date": 1440333971, "answer_id": 32166795, "question_id": 32166635, "link": "https://stackoverflow.com/questions/32166635/how-to-split-a-string-in-to-string-based-on-length/32166795#32166795", "title": "How to split a [String] in to [[String]] based on length", "body": "<p>Here is an elementary approach. First, the type <code>String</code> doesn't matter, so we can define our function in terms of a general type <code>a</code>:</p>\n\n<pre><code>breakup :: [a] -&gt; [[a]]\n</code></pre>\n\n<p>I'll illustrate with a limit of 3 instead of 10. It'll be obvious how to implement it with another limit.</p>\n\n<p>The first pattern will handle lists which are of size >= 3 and the the second pattern handles all of the other cases:</p>\n\n<pre><code>breakup (a1 : a2 : a3 : as) = [a1, a2, a3] : breakup as\nbreakup as = [ as ]\n</code></pre>\n\n<p>It is important to have the patterns in this order. That way the second pattern will only be used when the first pattern does not match, i.e. when there are less than 3 elements in the list.</p>\n\n<p>Examples of running this on some inputs:</p>\n\n<pre><code>breakup [1..5]       -&gt; [ [1,2,3], [4,5] ]\nbreakup [1..4]       -&gt; [ [1,2,3], [4] ]\nbreakup [1..2]       -&gt; [ [1,2] ]\nbreakup [1..3]       -&gt; [ [1,2,3], [] ]\n</code></pre>\n\n<p>We see these is an extra <code>[]</code> when we run the function on <code>[1..3]</code>. Fortunately this is easy to fix by inserting another rule before the last one:</p>\n\n<pre><code>breakup [] = []\n</code></pre>\n\n<p>The complete definition is:</p>\n\n<pre><code>breakup :: [a] -&gt; [[a]]\nbreakup [] = []\nbreakup (a1 : a2 : a3 : as) = [a1, a2, a3] : breakup as\nbreakup as = [ as ]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 597, "user_id": 2157021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5f361d3bd72832787dc2b79ce78de71?s=128&d=identicon&r=PG", "display_name": "amar47shah", "link": "https://stackoverflow.com/users/2157021/amar47shah"}, "edited": false, "score": 1, "creation_date": 1440346769, "post_id": 32168083, "comment_id": 52224269, "body": "Your solution is interesting, and clearly more efficient. However, it is very difficult for a beginner to read. As such, it&#39;s not clear that it is helpful to someone in the OP&#39;s position. Your answer could be improved by 1) providing a solution that optimizes the trade-off between efficiency and readability, as I requested, and 2) explaining how your solution works. It is important to remember that efficiency often has a cost in readability. Prematurely optimized code is not necessarily better than inefficient, easy-to-read code."}], "tags": [], "owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "is_accepted": false, "score": 3, "last_activity_date": 1440345548, "last_edit_date": 1440345548, "creation_date": 1440342094, "answer_id": 32168083, "question_id": 32166635, "link": "https://stackoverflow.com/questions/32166635/how-to-split-a-string-in-to-string-based-on-length/32168083#32168083", "title": "How to split a [String] in to [[String]] based on length", "body": "<p>You can do something like this:</p>\n\n<pre><code>splitByLen :: Int -&gt; [String] -&gt; [[String]]\nsplitByLen n s = go (zip s $ scanl1 (+) $ map length s) 0\n  where go [] _ = []\n        go xs prev = let (lst, rest) = span (\\ (x, c) -&gt; c - prev &lt;= n) xs\n                     in (map fst lst) : go rest (snd $ last lst)\n</code></pre>\n\n<p>And then:</p>\n\n<pre><code>*Main&gt; splitByLen 5 [\"abc\",\"cd\",\"abcd\",\"ab\"]\n[[\"abc\",\"cd\"],[\"abcd\"],[\"ab\"]]\n</code></pre>\n\n<p>In case there is a string longer than <code>n</code>, this function will fail. Now, what you want to do in those cases depends on your requirements and that was not specified in your question.</p>\n\n<hr>\n\n<p><strong>[Update]</strong></p>\n\n<p>As requested by @amar47shah, I made a benchmark comparing his solution (<code>breakup</code>) with mine (<code>splitByLen</code>):</p>\n\n<pre><code>import Data.List\nimport Data.Time.Clock\nimport Control.DeepSeq\nimport System.Random\n\nmain :: IO ()\nmain = do\n  s &lt;- mapM (\\ _ -&gt; randomString 10) [1..10000]\n  test \"breakup    10000\" $ breakup    10 s\n  test \"splitByLen 10000\" $ splitByLen 10 s\n  putStrLn \"\"\n  r &lt;- mapM (\\ _ -&gt; randomString 10) [1..100000]\n  test \"breakup    100000\" $ breakup    10 r\n  test \"splitByLen 100000\" $ splitByLen 10 r\n\ntest :: (NFData a) =&gt; String -&gt; a -&gt; IO ()\ntest s a = do time1 &lt;- getCurrentTime\n              time2 &lt;- a `deepseq` getCurrentTime\n              putStrLn $ s ++ \": \" ++ show (diffUTCTime time2 time1)\n\nrandomString :: Int -&gt; IO String\nrandomString n = do\n  l &lt;- randomRIO (1,n)\n  mapM (\\ _ -&gt; randomRIO ('a', 'z')) [1..l]\n</code></pre>\n\n<p>Here are the results:</p>\n\n<pre><code>breakup    10000: 0.904012s\nsplitByLen 10000: 0.005966s\n\nbreakup    100000: 150.945322s\nsplitByLen 100000: 0.058658s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "edited": false, "score": 1, "creation_date": 1440343516, "post_id": 32168143, "comment_id": 52223235, "body": "I guess your function will be very inefficient will all those <code>++</code>, <code>init</code> and <code>last</code>, and recalculating the sum of lengths each time."}, {"owner": {"reputation": 597, "user_id": 2157021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5f361d3bd72832787dc2b79ce78de71?s=128&d=identicon&r=PG", "display_name": "amar47shah", "link": "https://stackoverflow.com/users/2157021/amar47shah"}, "reply_to_user": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "edited": false, "score": 1, "creation_date": 1440343969, "post_id": 32168143, "comment_id": 52223396, "body": "@HelderPereira This answer was written to maximize readability for a Haskell beginner; that is, it was written to help the OP understand the problem and solution. If you would like to contribute in a constructive way, please demonstrate that the solution is inefficient using a real benchmark, and then provide an alternative that optimizes the trade-off between efficiency and readability."}, {"owner": {"reputation": 4685, "user_id": 5180989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gxpck.jpg?s=128&g=1", "display_name": "Helder Pereira", "link": "https://stackoverflow.com/users/5180989/helder-pereira"}, "edited": false, "score": 0, "creation_date": 1440345649, "post_id": 32168143, "comment_id": 52223915, "body": "Sorry, I didn&#39;t mean any offense. I was just trying to help pointing out possible efficiency issues in your solution. I had already posted my solution which doesn&#39;t have the same issues. I updated my answer with a benchmark."}, {"owner": {"reputation": 33, "user_id": 3042405, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/55649e03fa7c14ee37f459c006055075?s=128&d=identicon&r=PG&f=1", "display_name": "user3042405", "link": "https://stackoverflow.com/users/3042405/user3042405"}, "edited": false, "score": 0, "creation_date": 1440412709, "post_id": 32168143, "comment_id": 52245740, "body": "Just one questions about this line &quot;breakup size = foldl&#39; accumulate [[]]&quot;. Since there are two inputs the size and the list to be transformed. Why is there only one defined? usually (from the little experience I have anyway) is would be something like &quot;breakup size list =&quot;. I mean it works so there must be an explanation but I don&#39;t get where the input list comes from."}, {"owner": {"reputation": 597, "user_id": 2157021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5f361d3bd72832787dc2b79ce78de71?s=128&d=identicon&r=PG", "display_name": "amar47shah", "link": "https://stackoverflow.com/users/2157021/amar47shah"}, "reply_to_user": {"reputation": 33, "user_id": 3042405, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/55649e03fa7c14ee37f459c006055075?s=128&d=identicon&r=PG&f=1", "display_name": "user3042405", "link": "https://stackoverflow.com/users/3042405/user3042405"}, "edited": false, "score": 0, "creation_date": 1440421032, "post_id": 32168143, "comment_id": 52251151, "body": "Good question, @user3042405. <code>breakup size</code> defines a higher-order function, which takes an <code>Int</code> and returns a function of type <code>[[a]] -&gt; [[[a]]]</code>. We can define <code>breakup</code> this way, without explicitly referencing the <code>[[a]]</code> input, since we don&#39;t need to do anything with that input except apply <code>breakup size</code> to it. This chapter of LYAH goes into a lot of detail about higher-order functions in general. There are many examples, and some of them illustrate this exact situation: <a href=\"http://learnyouahaskell.com/higher-order-functions\" rel=\"nofollow noreferrer\">learnyouahaskell.com/higher-order-functions</a>. Happy coding!"}], "tags": [], "owner": {"reputation": 597, "user_id": 2157021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5f361d3bd72832787dc2b79ce78de71?s=128&d=identicon&r=PG", "display_name": "amar47shah", "link": "https://stackoverflow.com/users/2157021/amar47shah"}, "is_accepted": true, "score": 4, "last_activity_date": 1440357268, "last_edit_date": 1440357268, "creation_date": 1440342477, "answer_id": 32168143, "question_id": 32166635, "link": "https://stackoverflow.com/questions/32166635/how-to-split-a-string-in-to-string-based-on-length/32168143#32168143", "title": "How to split a [String] in to [[String]] based on length", "body": "<p>Here's an intuitive solution:</p>\n\n<pre><code>import Data.List (foldl')\n\nbreakup :: Int -&gt; [[a]] -&gt; [[[a]]]\nbreakup size = foldl' accumulate [[]]\n  where accumulate broken l\n         | length l &gt; size = error \"Breakup size too small.\"\n         | sum (map length (last broken ++ [l])) &lt;= size\n               = init broken ++ [last broken ++ [l]]\n         | otherwise = broken ++ [[l]]\n</code></pre>\n\n<p>Now, let's go through it line-by-line:</p>\n\n<pre><code>breakup :: Int -&gt; [[a]] -&gt; [[[a]]]\n</code></pre>\n\n<p>Since you hinted that you may want to generalize the function to accept different size limits, our type signature reflects this. We also generalize beyond <code>[String]</code> (that is, <code>[[Char]]</code>), since our problem is not specific to <code>[[Char]]</code>, and could equally apply to any <code>[[a]]</code>.</p>\n\n<pre><code>breakup size = foldl' accumulate [[]]\n</code></pre>\n\n<p>We're using a left fold because we want to transform a list, left-to-right, into our target, which will be a list of sub-lists. Even though we're not concerned with efficiency, we're using <code>Data.List.foldl'</code> instead of Prelude's own <code>foldl</code> because this is standard practice. You can read more about <code>foldl</code> vs. <code>foldl'</code> <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl%27\" rel=\"noreferrer\">here</a>.</p>\n\n<p>Our folding function is called <code>accumulate</code>. It will consider a new item and decide whether to place it in the last-created sub-list or to start a new sub-list. To make that judgment, it uses the <code>size</code> we passed in. We start with an initial value of <code>[[]]</code>, that is, a list with one empty sub-list.</p>\n\n<p>Now the question is, how should you <code>accumulate</code> your target?</p>\n\n<pre><code>  where accumulate broken l\n</code></pre>\n\n<p>We're using <code>broken</code> to refer to our constructed target so far, and <code>l</code> (for \"list\") to refer to the next item to process. We'll use guards for the different cases:</p>\n\n<pre><code>         | length l &gt; size = error \"Breakup size too small.\"\n</code></pre>\n\n<p>We need to raise an error if the item surpasses the size limit on its own, since there's no way to place it in a sub-list that satisfies the size limit. (Alternatively, we could build a safe function by wrapping our return value in the <code>Maybe</code> monad, and that's something you should definitely try out on your own.)</p>\n\n<pre><code>         | sum (map length (last broken ++ [l])) &lt;= size\n               = init broken ++ [last broken ++ [l]]\n</code></pre>\n\n<p>The guard condition is <code>sum (map length (last broken ++ [l])) &lt;= size</code>, and the return value for this guard is <code>init broken ++ [last broken ++ [l]]</code>. Translated into plain English, we might say, \"If the item can fit in the last sub-list without going over the size limit, append it there.\"</p>\n\n<pre><code>         | otherwise = broken ++ [[l]]\n</code></pre>\n\n<p>On the other hand, if there isn't enough \"room\" in the last sub-list for this item, we start a new sub-list, containing only this item. When the <code>accumulate</code> helper is applied to the next item in the input list, it will decide whether to place that item in <em>this</em> sub-list or start yet another sub-list, following the same logic.</p>\n\n<p>There you have it. Don't forget to <code>import Data.List (foldl')</code> up at the top. As another answer points out, this is not a performant solution if you plan to process 100,000 strings. However, I believe this solution is easier to read and understand. In many cases, readability is the more important optimization.</p>\n\n<p>Thanks for the fun question. Good luck with Haskell, and happy coding!</p>\n"}, {"tags": [], "owner": {"reputation": 12143, "user_id": 367649, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/HNrje.jpg?s=128&g=1", "display_name": "Marimuthu Madasamy", "link": "https://stackoverflow.com/users/367649/marimuthu-madasamy"}, "is_accepted": false, "score": 0, "last_activity_date": 1440435653, "creation_date": 1440435653, "answer_id": 32187762, "question_id": 32166635, "link": "https://stackoverflow.com/questions/32166635/how-to-split-a-string-in-to-string-based-on-length/32187762#32187762", "title": "How to split a [String] in to [[String]] based on length", "body": "<p>Here is another approach. It is clear from the problem that the result is a list of lists and we need a running length and an inner list to keep track of how much we have accumulated (We use <code>foldl'</code> with these two as input). We then describe what we want which is basically:</p>\n\n<ol>\n<li>If the length of the current input string itself exceeds the input length, we ignore that string (you may change this if you want a different behavior).</li>\n<li>If the new length after we have added the length of the current string is within our input length, we add it to the current result list.</li>\n<li>If the new length exceeds the input length, we add the result so far to the output and start a new result list.</li>\n</ol>\n\n\n\n<pre><code>chunks len = reverse  . map reverse . snd . foldl' f (0, [[]]) where\n  f (resSoFar@(lenSoFar, (currRes: acc)) curr\n    | currLength &gt; len = resSoFar -- ignore\n    | newLen &lt;= len    = (newLen, (curr: currRes):acc)\n    | otherwise        = (currLength, [curr]:currRes:acc) \n    where\n      newLen = lenSoFar + currLength\n      currLength = length curr\n</code></pre>\n\n<p>Every time we add a result to the output list, we add it to the front hence we need <code>reverse . map reverse</code> at the end.</p>\n\n<pre><code>&gt; chunks 5 [\"abc\",\"cd\",\"abcd\",\"ab\"]\n[[\"abc\",\"cd\"],[\"abcd\"],[\"ab\"]]\n\n&gt; chunks 5 [\"abc\",\"cd\",\"abcdef\",\"ab\"]\n[[\"abc\",\"cd\"],[\"ab\"]]\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 3042405, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/55649e03fa7c14ee37f459c006055075?s=128&d=identicon&r=PG&f=1", "display_name": "user3042405", "link": "https://stackoverflow.com/users/3042405/user3042405"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 0, "accepted_answer_id": 32168143, "answer_count": 4, "score": 0, "last_activity_date": 1440435653, "creation_date": 1440332841, "last_edit_date": 1440401597, "question_id": 32166635, "link": "https://stackoverflow.com/questions/32166635/how-to-split-a-string-in-to-string-based-on-length", "title": "How to split a [String] in to [[String]] based on length", "body": "<p>I'm trying to split a list of Strings in to a List of Lists of Strings\nso like in the title <code>[String] -&gt; [[String]]</code></p>\n\n<p>This has to be done based on length of characters, so that the Lists in the output are no longer than 10. So if input was length 20 this would be broken down in to 2 lists and if length 21 in to 3 lists.</p>\n\n<p>I'm not sure what to use to do this, I don't even know how to brake down a list in to a list of lists never mind based on certain length.</p>\n\n<p>For example if the limit was <code>5</code> and the input was:</p>\n\n<pre><code>[\"abc\",\"cd\",\"abcd\",\"ab\"]\n</code></pre>\n\n<p>The output would be:</p>\n\n<pre><code>[[\"abc\",\"cd\"],[\"abcd\"],[\"ab\"]]\n</code></pre>\n\n<p>I'd like to be pointed in the right direction and what methods to use, list comprehension? recursion? </p>\n"}, {"tags": ["haskell", "pointfree"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 7, "creation_date": 1440325764, "post_id": 32165578, "comment_id": 52218229, "body": "I think the pointful version you suggested is about as idiomatic as it gets."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1440329824, "post_id": 32165578, "comment_id": 52219257, "body": "For <code>n = 5</code> you&#39;d get something like: <code>bar = flip flip f5 . ((flip . ((flip . ((.) .)) .)) .) . flip flip f4 . ((flip . ((.) .)) .) . flip flip f3 . ((.) .) . (. f2) . foo . f1</code> ..."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1440330189, "post_id": 32166204, "comment_id": 52219354, "body": "Yes, although with N-ary versions of curry/uncurry like we have for (eg) zipWith and liftM, this would be reasonably clear: <code>bar = curry4 $ uncurry4 foo . (f1 *** f2 *** f3 *** f4)</code>"}, {"owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1440333710, "post_id": 32166204, "comment_id": 52220261, "body": "@amalloy I think with example of curryN uncurryN implementation you should post curryN $ uncurryN foo . (f1 *** f2 *** ... *** fN) as answer."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1440333942, "post_id": 32166204, "comment_id": 52220310, "body": "@amalloy Indeed. I looked for them on hackage, but surprisingly they are not in any package. They are easy to define, of course, but I wanted to stick to available combinators. Also don&#39;t forget that <code>uncurryN</code> would produce (I assume) an N-tuple, which is incompatible with <code>f1***...***fN</code> which expects nested pairs."}, {"owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "edited": false, "score": 1, "creation_date": 1440334707, "post_id": 32166204, "comment_id": 52220520, "body": "@chi I think this functions should have different names, something like curryPairs uncurryPairs"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1440330048, "last_edit_date": 1440330048, "creation_date": 1440329659, "answer_id": 32166204, "question_id": 32165578, "link": "https://stackoverflow.com/questions/32165578/is-there-idiomatic-pointfree-way-to-call-a-function-with-arguments-through-anoth/32166204#32166204", "title": "Is there idiomatic pointfree way to call a function with arguments through another functions", "body": "<p>Not really idiomatic:</p>\n\n<pre><code>import Control.Arrow\n\nbar = curry . curry $ (f1 *** f2) *** f3 &gt;&gt;&gt; (uncurry . uncurry $ foo)\n</code></pre>\n\n<p>Add more <code>curry/uncurry</code>s for more arguments.</p>\n\n<p>The pointful version is much more clear.</p>\n"}, {"tags": [], "owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "is_accepted": false, "score": 1, "last_activity_date": 1440395935, "creation_date": 1440395935, "answer_id": 32175306, "question_id": 32165578, "link": "https://stackoverflow.com/questions/32165578/is-there-idiomatic-pointfree-way-to-call-a-function-with-arguments-through-anoth/32175306#32175306", "title": "Is there idiomatic pointfree way to call a function with arguments through another functions", "body": "<p>If we have this set of functions</p>\n\n<pre><code>uncurryPairsN f (x1,(x2,...)) =  f x1 x2 ... xN\ncurryPairsN f x1 x2 ... xN =  f (x1, (x2, ...))\n</code></pre>\n\n<p>then</p>\n\n<pre><code>bar = curryPairsN $ uncurryPairsN foo . (f1 *** f2 *** ... *** fN)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1973, "user_id": 1716999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a58106c9a1013f1ca791c46579d664?s=128&d=identicon&r=PG", "display_name": "rubystallion", "link": "https://stackoverflow.com/users/1716999/rubystallion"}, "is_accepted": false, "score": 0, "last_activity_date": 1504254607, "creation_date": 1504254607, "answer_id": 45996140, "question_id": 32165578, "link": "https://stackoverflow.com/questions/32165578/is-there-idiomatic-pointfree-way-to-call-a-function-with-arguments-through-anoth/45996140#45996140", "title": "Is there idiomatic pointfree way to call a function with arguments through another functions", "body": "<p>You could use <a href=\"https://hackage.haskell.org/package/pointless-fun/docs/Data-Function-Pointless.html\" rel=\"nofollow noreferrer\">Data.Function.Pointless</a> from the package pointless-fun:</p>\n\n<p>If you have</p>\n\n<p><code>bar x1 x2 x3 = foo (f1 x1) (f2 x2) (f3 x3)</code></p>\n\n<p>you can turn it into the pointless refactoring</p>\n\n<p><code>bar = foo ~&gt; f1 ~&gt; f2 ~&gt; f3 ~&gt; id</code></p>\n\n<p>The workings are described in a <a href=\"http://matt.immute.net/content/pointless-fun\" rel=\"nofollow noreferrer\">blog post</a>.</p>\n"}], "owner": {"reputation": 2216, "user_id": 2260919, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6732557387dfa9107c693e19b95b292e?s=128&d=identicon&r=PG", "display_name": "ais", "link": "https://stackoverflow.com/users/2260919/ais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 32166204, "answer_count": 3, "score": 5, "last_activity_date": 1504254607, "creation_date": 1440325147, "last_edit_date": 1440330370, "question_id": 32165578, "link": "https://stackoverflow.com/questions/32165578/is-there-idiomatic-pointfree-way-to-call-a-function-with-arguments-through-anoth", "title": "Is there idiomatic pointfree way to call a function with arguments through another functions", "body": "<p>We have these functions</p>\n\n<pre><code>foo x1 x2 ... xN =\n\nf1 x =\nf2 x =\n...\nfN x = \n</code></pre>\n\n<p>Is there idiomatic pointfree version of this function?</p>\n\n<pre><code>bar x1 x2 ... xn = foo (f1 x1) (f2 x2) ... (fN xN)\n</code></pre>\n\n<p>edit</p>\n\n<p>If not can we somehow generalize this function to N parameters?</p>\n\n<pre><code>applyF3 f f1 f2 f3 x1 x2 x3 = f (f1 x1) (f2 x2) (f3 x3)\nbar = applyF3 foo f1 f2 f3\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1440406709, "post_id": 32169971, "comment_id": 52242005, "body": "OK, it&#39;s going to me a take a while to digest this. But I notice the result is wrong. The expected result is a bit too big to fit in a comment; I&#39;ll go edit it into the question..."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 3, "last_activity_date": 1440372315, "last_edit_date": 1440372315, "creation_date": 1440354313, "answer_id": 32169971, "question_id": 32165185, "link": "https://stackoverflow.com/questions/32165185/a-monad-for-building-test-data/32169971#32169971", "title": "A monad for building test data", "body": "<p>You are trying to reinvent <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow\"><code>pipes</code></a>. Your <code>source</code> and <code>yield</code> are pipes <code>await</code> and <code>yield</code>.  The other two concerns you are trying to handle are a <code>ReaderT</code> and a <code>WriterT</code> respectively. If you put the entire list of inputs in the environment of the <code>ReaderT</code> you can run <code>local</code> sub computations that start over at the beginning of the list. You can collect all of the results from a sub-computation by adding a <code>WriterT</code> layer to collect the output.</p>\n\n<p>For the nice syntax with <code>gather</code> you are trying to recreate <code>ListT</code>.</p>\n\n<h3>Pipes, Readers, and Writers</h3>\n\n<p>We're going to use all of the following in very short order.</p>\n\n<pre><code>import Data.Functor.Identity\nimport Data.Foldable\n\nimport Control.Monad\nimport Control.Monad.Morph\nimport Control.Monad.IO.Class\nimport Control.Monad.Trans.Class\nimport Control.Monad.Trans.Reader hiding (local)\nimport Control.Monad.Trans.Writer.Strict\n\nimport Pipes.Core\nimport Pipes ((&gt;-&gt;))\nimport qualified Pipes as P\nimport qualified Pipes.Prelude as P\n\nimport Pipes.Lift (runWriterP, runReaderP)\n</code></pre>\n\n<p>Your builder is a <code>Pipe i o</code> over a <code>Reader [i]</code> which allows you to reset at the beginning of the input. We will define two versions of it, <code>BuildT</code> which is a monad transformer, and <code>BuildM</code> which is a monad. <code>BuildM</code> is jsut the transformer applied to <code>Identity</code>.</p>\n\n<pre><code>type BuildT e i o m r = Pipe i o (ReaderT e m) r\ntype BuildM e i o   r = BuildT e i o Identity r\n</code></pre>\n\n<p><code>local</code> runs a builder feeding it the entire input read from the environment. We might want to give this a different name to avoid conflicting with <code>local</code> defined for <code>ReaderT</code></p>\n\n<pre><code>local :: (Monad m, Foldable f) =&gt; BuildT (f i) i o m () -&gt; Proxy a' a () o (ReaderT (f i) m) ()\nlocal subDef = do\n    e &lt;- lift ask\n    hoist lift $ runReaderP e $\n        P.each e &gt;-&gt;\n        subDef\n</code></pre>\n\n<p>To collect the results of the sub computations, we take advantage of the fact that pipes are so pure that you can swap out the underlying monad provided you have a natural transformation <code>forall x. m x -&gt; n x</code>. The proxies from pipes have an <a href=\"https://hackage.haskell.org/package/mmorph/docs/Control-Monad-Morph.html#t:MFunctor\" rel=\"nofollow\"><code>MFunctor</code></a> instance that provides a function <code>hoist :: (forall x. m x -&gt; n x) -&gt; Proxy a' a b' b m r -&gt; Proxy a' a b' b n r</code>; it lets us lift all of the underlying monad operations under a pipe to use the pipe over another transformer, in this case <code>WriterT</code>.</p>\n\n<pre><code>collect :: (Monad m) =&gt; Proxy a' a () b m r -&gt; Proxy a' a c' c m ([b], r)\ncollect subDef = do\n    (r, w) &lt;- runWriterP $\n        hoist lift subDef //&gt; \\x -&gt; lift $ tell (++[x])\n    return (w [], r)\n</code></pre>\n\n<p>To run a builder we feed it all of the input from the environment, provide the initial environment, collect the results, and run the entire pipe.</p>\n\n<pre><code>runBuildT :: (Monad m) =&gt; [i] -&gt; BuildT [i] i o m () -&gt; m [o]\nrunBuildT e = runEffect . fmap fst . collect . runReaderP e . local\n</code></pre>\n\n<p>Running the monad instead of the transformer is just</p>\n\n<pre><code>runBuildM :: [i] -&gt; BuildM [i] i o () -&gt; [o]\nrunBuildM e = runIdentity . runBuildT e\n</code></pre>\n\n<h3>ListT</h3>\n\n<p>This section lets us use <code>do</code>-notation when generating all combinations of things. It's equivalent to using pipes' <a href=\"https://hackage.haskell.org/package/pipes/docs/Pipes.html#v:for\" rel=\"nofollow\"><code>for</code></a> in place of each <code>&gt;&gt;=</code> and <code>yield</code> in place of each <code>return</code>.</p>\n\n<p>The syntax that <code>gather</code>s all of the results from a sub computation is reinventing <a href=\"https://hackage.haskell.org/package/pipes/docs/Pipes.html#t:ListT\" rel=\"nofollow\"><code>ListT</code></a>. a <code>ListT m a</code> holds a <code>Producer a m ()</code> that only returns data downstream. Pipes that get data from upstream and return data downstream don't fit into the <code>Producer b m ()</code>. This will take a bit of conversion.</p>\n\n<p>We can convert a <code>Proxy</code> that has both an upstream and a downstream interface into one with only a downstream interface wrapped around another proxy with the upstream interface. To do so, we hoist the underlying monad into our new inner upstream proxy, then replace all of the <code>request</code>s in the outer downstream proxy with <code>request</code>s lifted from the inner upstream proxy.</p>\n\n<pre><code>floatRespond :: (Monad m) =&gt; Proxy a' a b' b m r -&gt; Proxy c' c b' b (Proxy a' a d' d m) r\nfloatRespond = (lift . request &gt;\\\\) . hoist lift\n</code></pre>\n\n<p>These can be converted into a <code>ListT</code>. We'll discard any returned data to get a more polymorphic type.</p>\n\n<pre><code>gather :: (Monad m) =&gt; Proxy a' a () b m r -&gt; P.ListT (Proxy a' a c' c m) b\ngather = P.Select . floatRespond . (&gt;&gt;= return . const ())\n</code></pre>\n\n<p>Using <code>ListT</code> is a bit cumbersome to use; you need an <code>mplus</code> between <code>return</code>s to get both outputs. It's frequently convenient to shove a proxy into a <code>ListT</code> so you can <code>lift . yield</code> instead of <code>return</code>ing. We are going to discard all our <code>ListT</code> results an rely on the output coming from <code>lift . yield.</code>enumerate<code>just runs a</code>ListT` wrapped around anything, discarding all the results</p>\n\n<pre><code>enumerate = P.runListT\n</code></pre>\n\n<h3>Example</h3>\n\n<p>We're now equipped to write and run your example. I thing you mean for <code>source</code> to get one value from the source and for <code>yield</code> to return one value. If you don't need to be able to get values one at a time your question is over-specified and this answer is overkill.</p>\n\n<pre><code>source = P.await\nyield = P.yield\n</code></pre>\n\n<p>In the example, where we use <code>gather</code> to build lists, we run that portion of the code with <code>enumerate</code> and yield results with <code>lift . yield</code>. </p>\n\n<pre><code>import Data.Char\n\nbuild_tests :: Monad m =&gt; Int -&gt; BuildT [String] String String m ()\nbuild_tests depth = do\n  local $ do\n    v &lt;- source\n    yield $ v\n    yield $ (map toLower v)\n  yield \"[]\"\n  yield \"()\"\n  when (depth &gt; 2) $ enumerate $ do\n    t1 &lt;- gather $ build_tests (depth-1)\n    lift . yield $ \"(\" ++ t1 ++ \")\"\n    lift . yield $ \"[\" ++ t1 ++ \"]\"\n    t2 &lt;- gather $ build_tests (depth-1)\n    lift . yield $ \"(\" ++ t1 ++ \",\" ++ t2 ++ \")\"\n</code></pre>\n\n<p>If we run this example with the input <code>[\"A\", \"B\"]</code> the \"B\" input is never used because <code>source</code> is only ever used once inside each <code>local</code>.</p>\n\n<pre><code>main = do\n    putStrLn \"Depth 2\"\n    print =&lt;&lt; runBuildT [\"A\", \"B\"] (build_tests 2)\n    putStrLn \"Depth 3\"\n    print =&lt;&lt; runBuildT [\"A\", \"B\"] (build_tests 3)\n</code></pre>\n\n<p>The output for depths less than 4 is small enough to repeat here.</p>\n\n<pre><code>[\"A\",\"a\",\"[]\",\"()\"]\nDepth 3\n[\"A\",\"a\",\"[]\",\"()\",\"(A)\",\"[A]\",\"(A,A)\",\"(A,a)\",\"(A,[])\",\"(A,())\",\"(a)\",\"[a]\",\"(a,A)\",\"(a,a)\",\"(a,[])\",\"(a,())\",\"([])\",\"[[]]\",\"([],A)\",\"([],a)\",\"([],[])\",\"([],())\",\"(())\",\"[()]\",\"((),A)\",\"((),a)\",\"((),[])\",\"((),())\"]\n</code></pre>\n\n<h3>This might be overkill</h3>\n\n<p>I suspect that you might have meant for <code>source</code> to get everything from the source.</p>\n\n<pre><code>source = gather P.cat\nyield = P.yield\n</code></pre>\n\n<p>If we use this for the example instead of getting a single item from the source we'll <code>enumerate</code> the first <code>local</code> block and yield results by <code>return</code>ing in <code>ListT</code>.</p>\n\n<pre><code>build_tests :: Monad m =&gt; Int -&gt; BuildT [String] String String m ()\nbuild_tests depth = do\n  local $ enumerate $ do\n    v &lt;- source\n    lift . yield $ v\n    lift . yield $ (map toLower v)\n  yield \"[]\"\n  yield \"()\"\n  when (depth &gt; 2) $ enumerate $ do\n    t1 &lt;- gather $ build_tests (depth-1)\n    lift . yield $ \"(\" ++ t1 ++ \")\"\n    lift . yield $ \"[\" ++ t1 ++ \"]\"\n    t2 &lt;- gather $ build_tests (depth-1)\n    lift . yield $ \"(\" ++ t1 ++ \",\" ++ t2 ++ \")\"\n</code></pre>\n\n<p>This uses both source values when we run the example with two sources.</p>\n\n<pre><code>Depth 2\n[\"A\",\"a\",\"B\",\"b\",\"[]\",\"()\"]\nDepth 3\n[\"A\",\"a\",\"B\",\"b\",\"[]\",\"()\",\"(A)\",\"[A]\",\"(A,A)\",\"(A,a)\",\"(A,B)\",\"(A,b)\",\"(A,[])\",\"(A,())\",\"(a)\",\"[a]\",\"(a,A)\",\"(a,a)\",\"(a,B)\",\"(a,b)\",\"(a,[])\",\"(a,())\",\"(B)\",\"[B]\",\"(B,A)\",\"(B,a)\",\"(B,B)\",\"(B,b)\",\"(B,[])\",\"(B,())\",\"(b)\",\"[b]\",\"(b,A)\",\"(b,a)\",\"(b,B)\",\"(b,b)\",\"(b,[])\",\"(b,())\",\"([])\",\"[[]]\",\"([],A)\",\"([],a)\",\"([],B)\",\"([],b)\",\"([],[])\",\"([],())\",\"(())\",\"[()]\",\"((),A)\",\"((),a)\",\"((),B)\",\"((),b)\",\"((),[])\",\"((),())\"]\n</code></pre>\n\n<p>If you never get a single value from the source you could just use <code>ListT (ReaderT [i] m) o</code> instead. You might still want a proxy to avoid messing around with <code>mplus</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 2, "last_activity_date": 1440396965, "last_edit_date": 1495541671, "creation_date": 1440396965, "answer_id": 32175554, "question_id": 32165185, "link": "https://stackoverflow.com/questions/32165185/a-monad-for-building-test-data/32175554#32175554", "title": "A monad for building test data", "body": "<p>If <a href=\"https://stackoverflow.com/a/32169971/414413\">my other answer</a> is overkill,  the continuation monad transformer provides a convenient way to construct any <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Control-Monad.html#t:MonadPlus\" rel=\"nofollow noreferrer\"><code>MonadPlus</code></a> values.</p>\n\n<p>The continuation monad lets us easily capture the idea of doing something <code>mplus</code> the as yet unknown remainder.</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans.Cont\n\nonce :: MonadPlus m =&gt; m a -&gt; ContT a m ()\nonce m = ContT $ \\k -&gt; m `mplus` k ()\n</code></pre>\n\n<p>Yielding a result is just returning it once.</p>\n\n<pre><code>yield :: MonadPlus m =&gt; a -&gt; ContT a m ()\nyield = once . return\n</code></pre>\n\n<p>We can gather up all the results by sticking <code>mzero</code> at the end.</p>\n\n<pre><code>gather :: MonadPlus m =&gt; ContT a m r -&gt; m a\ngather m = runContT m (const mzero)\n</code></pre>\n\n<p>Your example is written in terms of <code>yield</code>, <code>gather</code>, <code>once</code>, and <code>lift</code>.</p>\n\n<pre><code>import Data.Char\n\nimport Control.Monad.Trans.Class\n\nbuild_tests :: MonadPlus m =&gt; m String -&gt; Int -&gt; ContT String m ()\nbuild_tests source = go\n  where\n    go depth = do\n      once . gather $ do\n        v &lt;- lift source\n        yield v\n        yield (map toLower v)\n      yield \"[]\"\n      yield \"()\"\n      when (depth &gt; 2) $ do\n        t1 &lt;- lift . gather $ go (depth-1)\n        yield $ \"(\" ++ t1 ++ \")\"\n        yield $ \"[\" ++ t1 ++ \"]\"\n        t2 &lt;- lift . gather $ go (depth-1)\n        yield $ \"(\" ++ t1 ++ \",\" ++ t2 ++ \")\"\n\nmain = print . gather $ build_tests [\"A\", \"B\"] 3\n</code></pre>\n\n<p>This outputs the following:</p>\n\n<pre><code>Depth 2\n[\"A\",\"a\",\"B\",\"b\",\"[]\",\"()\"]\nDepth 3\n[\"A\",\"a\",\"B\",\"b\",\"[]\",\"()\",\"(A)\",\"[A]\",\"(A,A)\",\"(A,a)\",\"(A,B)\",\"(A,b)\",\"(A,[])\",\"(A,())\",\"(a)\",\"[a]\",\"(a,A)\",\"(a,a)\",\"(a,B)\",\"(a,b)\",\"(a,[])\",\"(a,())\",\"(B)\",\"[B]\",\"(B,A)\",\"(B,a)\",\"(B,B)\",\"(B,b)\",\"(B,[])\",\"(B,())\",\"(b)\",\"[b]\",\"(b,A)\",\"(b,a)\",\"(b,B)\",\"(b,b)\",\"(b,[])\",\"(b,())\",\"([])\",\"[[]]\",\"([],A)\",\"([],a)\",\"([],B)\",\"([],b)\",\"([],[])\",\"([],())\",\"(())\",\"[()]\",\"((),A)\",\"((),a)\",\"((),B)\",\"((),b)\",\"((),[])\",\"((),())\"]\n</code></pre>\n\n<p>I've taken the liberty of getting rid of the requirement to read the original source from the environment for simplicity. You can add a <code>ReaderT</code> to the transformer stack to get it back. I also haven't chosen a list transfomer for you, the example is running using the ordinary list monad. Since it's written in terms of <code>MonadPlus</code> it will work for any <code>(MonadTrans t, MonadPlus (t m)) =&gt; t m</code> as well.</p>\n"}, {"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1445167599, "post_id": 32180165, "comment_id": 54199859, "body": "Having waded through the extensive documentation for <code>Pipes</code>, it appears it does in fact do the thing I want. Thanks."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 2, "last_activity_date": 1440412481, "last_edit_date": 1495542594, "creation_date": 1440412481, "answer_id": 32180165, "question_id": 32165185, "link": "https://stackoverflow.com/questions/32165185/a-monad-for-building-test-data/32180165#32180165", "title": "A monad for building test data", "body": "<p>You are trying to reinvent <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow noreferrer\">pipes</a> and some <a href=\"https://stackoverflow.com/a/32175554/414413\">nice syntax for building lists</a>. The problem is much simpler than how you characterize it. The source of strings can be completely separated from building the structures.</p>\n\n<p>You want to generate structures that draw symbols from some source. Without worrying about the source, let's build the structures. Each structure is a <code>Pipe</code> that will draw from some source and <code>yield</code> strings to concatenate together to build the expression.</p>\n\n<pre><code>import Data.Char\n\nimport Data.Functor.Identity\n\nimport Pipes.Core\nimport Pipes ((&gt;-&gt;))\nimport qualified Pipes as P\nimport qualified Pipes.Prelude as P\n\nbuild_structures :: Int -&gt; [Pipe String String Identity ()]\nbuild_structures depth = gather $ do\n    yield $ P.take 1\n    yield $ P.map (map toLower) &gt;-&gt; P.take 1\n    when (depth &gt; 2) $ do\n        t1 &lt;- lift $ build_structures (depth - 1)\n        yield $ P.yield \"(\" &gt;&gt; t1 &gt;&gt; P.yield \")\"\n        yield $ P.yield \"[\" &gt;&gt; t1 &gt;&gt; P.yield \"]\"\n        t2 &lt;- lift $ build_structures (depth - 1)\n        yield $ P.yield \"(\" &gt;&gt; t1 &gt;&gt; P.yield \",\" &gt;&gt; t2 &gt;&gt; P.yield \")\"\n</code></pre>\n\n<p>This code uses the <a href=\"https://stackoverflow.com/a/32175554/414413\"><code>ContT</code> yield trick</a> from the continuation answer.</p>\n\n<p>We run one of these structures by feeding it the symbols and concatenating the results.</p>\n\n<pre><code>run :: Pipe String String Identity () -&gt; String\nrun p = concat . P.toList $ P.each symbols &gt;-&gt; p\n\n-- an infinite source of unique symbols\nsymbols :: [String]\nsymbols = drop 1 symbols'\n    where\n        symbols' = [\"\"] ++ do\n            tail &lt;- symbols'\n            first &lt;- ['A'..'Z']\n            return (first : tail)\n</code></pre>\n\n<p>The examples produce the desired strings. I'll leave producing the two special cases <code>\"[]\"</code> and <code>\"()\"</code>, which do not appear in recursive terms, as an exercise.</p>\n\n<pre><code>import Data.Functor\n\nmain = do\n    putStrLn \"Depth 2\"\n    print $ run &lt;$&gt; build_structures 2\n    putStrLn \"Depth 3\"\n    print $ run &lt;$&gt; build_structures 3\n    putStrLn \"Depth 4\"\n    print $ run &lt;$&gt; build_structures 4\n</code></pre>\n\n<p>This results in</p>\n\n<pre><code>Depth 2\n[\"A\",\"a\"]\nDepth 3\n[\"A\",\"a\",\"(A)\",\"[A]\",\"(A,B)\",\"(A,b)\",\"(a)\",\"[a]\",\"(a,B)\",\"(a,b)\"]\nDepth 4\n[\"A\",\"a\",\"(A)\",\"[A]\",\"(A,B)\",\"(A,b)\",\"(A,(B))\",\"(A,[B])\",\"(A,(B,C))\",\"(A,(B,c))\",\"(A,(b))\",\"(A,[b])\",\"(A,(b,C))\",\"(A,(b,c))\",\"(a)\",\"[a]\",\"(a,B)\",\"(a,b)\",\"(a,(B))\",\"(a,[B])\",\"(a,(B,C))\",\"(a,(B,c))\",\"(a,(b))\",\"(a,[b])\",...\n</code></pre>\n"}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "accepted_answer_id": 32180165, "answer_count": 3, "score": 6, "last_activity_date": 1440412481, "creation_date": 1440322539, "last_edit_date": 1440407152, "question_id": 32165185, "link": "https://stackoverflow.com/questions/32165185/a-monad-for-building-test-data", "title": "A monad for building test data", "body": "<p>OK, so I'm trying to write a monad for building test data, but I can't quite get it to work how I want it. It looks something like this:</p>\n\n<pre><code>runBuildM :: [i] -&gt; BuildM i o x -&gt; [o]\n-- Given a list of i, build a list of o.\n\nsource :: BuildM i o i\n-- Fetch unique i.\n\nyield :: o -&gt; BuildM i o ()\n-- Return a new o to the caller.\n\ngather :: BuildM i o x -&gt; BuildM i o o\n-- Fetch every possible o from sub-computation.\n\nlocal :: BuildM i o x -&gt; BuildM i o x\n-- Isolate any source invocations from the rest of the code.\n</code></pre>\n\n<p>In other words, it's a supply monad, writer monad and list monad. The idea is that I can write something like this:</p>\n\n<pre><code>build_tests depth = do\n  local $ do\n    v &lt;- source\n    yield v\n    yield (map toLower v)\n  yield \"[]\"\n  yield \"()\"\n  when (depth &gt; 2) $ do\n    t1 &lt;- gather $ build_tests (depth-1)\n    yield $ \"(\" ++ t1 ++ \")\"\n    yield $ \"[\" ++ t1 ++ \"]\"\n    t2 &lt;- gather $ build_tests (depth-1)\n    yield $ \"(\" ++ t1 ++ \",\" ++ t2 ++ \")\"\n</code></pre>\n\n<p>The idea is to generate all possible combinations of data. You can do that just using list comprehensions, but the result ends up syntactically awful. This is <em>much</em> more readable. Unfortunately, it doesn't actually <em>work</em>...</p>\n\n<p>The problem seems to boil down to the <code>local</code> function not behaving correctly. The <em>intention</em> is for any <code>source</code> calls in the sub-computation to have no effect outside of it. (I.e., subsequent calls to <code>source</code> from outside the <code>local</code> block get the first token again.) However, what my implementation of <code>local</code> <em>actually</em> does is reset the next token for <em>everything</em> (i.e., including the contents of the sub-computation). This is clearly incorrect, but I cannot for the life of me bend my mind around how to make it work correctly.</p>\n\n<p>The fact that I'm having this much trouble getting the code to work as required probably means the actual internal representation of my monad is just <em>wrong</em>. Can anybody take a stab at implementing this correctly?</p>\n\n<hr>\n\n<p><strong>EDIT:</strong> I should perhaps have realised this, but I didn't actually specify the expected result I'm trying to get. The above code is supposed to produce this:</p>\n\n<pre><code>[\"A\", \"a\", \"[]\", \"()\", \"(A)\", \"(a)\", \"[A]\", \"[a]\", \"(A, B)\", \"(A, b)\", \"(a, B)\", \"(a, b)\"]\n</code></pre>\n\n<p>It's not super-critical that the results appear in exactly this order. I'd like the single cases to appear before the compound ones, but I'm not too fussed exactly what order the compounds appear. The rule is that the same variable never appears twice in any individual expression.</p>\n\n<p>If we allow the depth to be a bit deeper, we additionally get terms such as</p>\n\n<pre><code>\"((A))\", \"([A])\", \"[(A)]\", \"((A, B), C)\", \"(A, (B, C))\"\n</code></pre>\n\n<p>and so on.</p>\n\n<hr>\n\n<p>It's clearly broken, but here's what I have so far:</p>\n\n<pre><code>newtype BuildM i o x = BuildM ([i] -&gt; SEQ.Seq ([i], SEQ.Seq o, x))\n\ninstance Functor (BuildM i o) where\n  fmap uf (BuildM sf) =\n    BuildM $ \\ is0 -&gt; do\n      (is1, os, x) &lt;- sf is0\n      return (is1, os, uf x)\n\ninstance Applicative (BuildM i o) where\n  pure x = BuildM $ \\ is0 -&gt; return (is0, SEQ.empty, x)\n\n  BuildM sf1 &lt;*&gt; BuildM sf2 =\n    BuildM $ \\ is1 -&gt; do\n      (is2, os2, f) &lt;- sf1 is1\n      (is3, os3, x) &lt;- sf2 is2\n      return (is3, os2 &gt;&lt; os3, f x)\n\ninstance Monad (BuildM i o) where\n  return = pure\n\n  BuildM sf1 &gt;&gt;= uf =\n    BuildM $ \\ is1 -&gt; do\n      (is2, os2, x) &lt;- sf1 is1\n      let BuildM sf2 = uf x\n      (is3, os3, y) &lt;- sf2 is2\n      return (is3, os2 &gt;&lt; os3, y)\n\nrunBuildM :: [i] -&gt; BuildM i o x -&gt; [o]\nrunBuildM is0 (BuildM sf) =\n  toList $ do\n    (is, os, x) &lt;- sf is0\n    os\n\nsource :: BuildM i o i\nsource =\n  BuildM $ \\ is -&gt;\n    if null is\n      then error \"AHC.Tests.TestBuilder.source: end of input\"\n      else return (tail is, SEQ.empty, head is)\n\nyield :: o -&gt; BuildM i o ()\nyield o = BuildM $ \\ is -&gt; return (is, SEQ.singleton o, () )\n\ngather :: BuildM i o x -&gt; BuildM i o' o\ngather (BuildM sf1) =\n  BuildM $ \\ is1 -&gt; do\n    (is2, os2, _) &lt;- sf1 is1\n    o &lt;- os2\n    return (is2, SEQ.empty, o)\n\nlocal :: BuildM i o x -&gt; BuildM i o ()\nlocal (BuildM sf1) =\n  BuildM $ \\ is1 -&gt;\n    let os = do (is2, os2, x) &lt;- sf1 is1; os2\n    in  return (is1, os, () )\n</code></pre>\n"}, {"tags": ["haskell", "monads", "higher-order-functions"], "comments": [{"owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "edited": false, "score": 1, "creation_date": 1440312102, "post_id": 32163806, "comment_id": 52215101, "body": "I seemed to be a bit over-intimidated with using <code>Monads</code>, as it appears that a simple recursive function using a list of tuples (pairing each lookup key with it&#39;s directory) might be the solution: <code>lookupALot ((k,d):(keys,directories)) = lookup k d &gt;&gt;= lookupALot keys directories</code>; if only I can figure out a base case; perhaps I should make the result a <code>Maybe</code>?"}, {"owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "edited": false, "score": 1, "creation_date": 1440312492, "post_id": 32163806, "comment_id": 52215158, "body": "Or even perhaps something like: <code>lookupALot :: ([String], [[String, String]]) -&gt; Maybe Double, lookupALot tuples = foldr (&gt;&gt;=) (base_case?) tuples</code>. I seemed to forget that the original function used data that already was in the Maybe type. Oops."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1440312606, "post_id": 32163806, "comment_id": 52215179, "body": "in this case I think you should do the same <code>head</code> and <code>tail</code> does (i.e. if there is no reasonable base case - if you need an non-empty list - it might be ok to fail) - or you can go first <code>Maybe (Maybe a)</code> and finally flatten this too ;)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 2, "creation_date": 1440312622, "post_id": 32163806, "comment_id": 52215182, "body": "btw: you should put this into an answer - also note that you can do this with [foldM](<a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#v:foldM\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.8.1.0/docs/&hellip;</a>, ...)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1440312799, "post_id": 32163806, "comment_id": 52215225, "body": "It may look like you&#39;re calling the same function three times, but I bet <code>lookup</code> has a different type on every line there. Which makes it a <i>little</i> bit like calling three different functions -- and also severely complicates attempts to abstract over which function is repeated to the point that it is almost surely not worth it."}, {"owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "edited": false, "score": 0, "creation_date": 1440312918, "post_id": 32163806, "comment_id": 52215254, "body": "Carsten, foldM might be the answer I&#39;m looking for."}], "answers": [{"tags": [], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "is_accepted": false, "score": 2, "last_activity_date": 1440360755, "last_edit_date": 1440360755, "creation_date": 1440317937, "answer_id": 32164624, "question_id": 32163806, "link": "https://stackoverflow.com/questions/32163806/abstracting-over-repeated-application-within-monad-chains/32164624#32164624", "title": "Abstracting over repeated application within Monad chains", "body": "<p>Big thanks to Carsten for the link to <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#v:foldM\" rel=\"nofollow\"><code>foldM</code></a>! Credit to them for the insight of this answer.</p>\n\n<p>So, if we use <code>foldM</code>, we can write a function that repeatedly performs a <code>lookup</code> chained through multiple directories that depend upon each previous result. If, thanks to the use of <code>monads</code>, at any point <code>lookup</code> cannot find the current <code>key</code> in a directory, it will terminate, and return <code>Nothing</code>: </p>\n\n<pre><code>lookupALot :: Eq a =&gt; a -&gt; [(a,b)] -&gt; Maybe b\nlookupALot key directories = foldM lookup key directories\n</code></pre>\n\n<p>this has output of the form</p>\n\n<pre><code>  foldM f k1 [d1, d2, ..., dm] -- k == key, d == directory\n  ==\n  do\n    k2 &lt;- f k1 d1\n    k3 &lt;- f k2 d2\n    ...\n    f km dm\n</code></pre>\n\n<p>which is exactly the same structure as</p>\n\n<pre><code>  do\n    number       &lt;- lookup name phonebook\n    registration &lt;- lookup number governmentDatabase\n    lookup registration taxDatabase\n</code></pre>\n\n<p>Hence, a more compact way of writing <code>getTaxOwed</code> would be:</p>\n\n<pre><code>getTaxOwed :: String -&gt; Maybe Double\ngetTaxOwed name = foldM lookup name [phonebook, governmentDatabase, taxDatabase]\n</code></pre>\n\n<p>Which kinda blows me away! That line of code will find the phone-number associated with a person's <code>name</code>, then check the <code>governmentDatabase</code> with their number for their <code>registration</code>, and finally find their tax information from that <code>registration</code>. Note though, that this will only work for data in the form of <code>[(a,b)]</code>, as indicated by the type of <code>lookupALot</code>.</p>\n"}], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1440360755, "creation_date": 1440310937, "last_edit_date": 1440311313, "question_id": 32163806, "link": "https://stackoverflow.com/questions/32163806/abstracting-over-repeated-application-within-monad-chains", "title": "Abstracting over repeated application within Monad chains", "body": "<p>The <a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_monads/Maybe\" rel=\"nofollow\">Haskell wikibook</a> has an example that shows how to chain <code>lookup</code> commands when trying to find different pieces of connected information throughout a database, seen here:</p>\n\n<pre><code>getTaxOwed :: String       -- their name\n       -&gt; Maybe Double -- the amount of tax they owe\ngetTaxOwed name = \n  lookup name phonebook &gt;&gt;=\n    (\\number -&gt; lookup number governmentDatabase) &gt;&gt;=\n      (\\registration -&gt; lookup registration taxDatabase)\n</code></pre>\n\n<p>and rewritten in <code>do</code> notation:</p>\n\n<pre><code>getTaxOwed name = do\n  number       &lt;- lookup name phonebook\n  registration &lt;- lookup number governmentDatabase\n  lookup registration taxDatabase\n</code></pre>\n\n<p>Now, anytime I see a function repeated more than once I immediately try to think of ways to abstract over its repeated application, but as I haven't used <code>Monads</code> much in practice yet, and as they seem to already be at a pretty high level of abstraction, I didn't know how to approach that in this case. </p>\n\n<p>What are some ways, if any, a coder could abstract over the common pattern above, that is, a call to <code>lookup</code> in every line?</p>\n\n<p>(an aside: is this an appropriate context for the phrase \"abstract over\"? I felt it captured my meaning, but I'm not sure, and I'd like to make sure I'm using terminology appropriately as a relatively new coder; I looked through other posts which clarified its use and meaning but I still can't figure it out for this particular example) </p>\n"}, {"tags": ["macos", "haskell", "static", "ghc", "ffi"], "answers": [{"comments": [{"owner": {"reputation": 409, "user_id": 899333, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a3c36106bbf7b90e4d67d54e37863feb?s=128&d=identicon&r=PG", "display_name": "Tom Kludy", "link": "https://stackoverflow.com/users/899333/tom-kludy"}, "edited": false, "score": 0, "creation_date": 1440427522, "post_id": 32163855, "comment_id": 52255762, "body": "Thanks!  Though brief your answer got me much further than before.  I was able to build a static library by using:  <code>ld -r -arch x86_64 -o libffihell.a    -force_load ${DIST_LIB}&#47;libHSffihell-0.1.0.0-70CjWiqse6C2Al3vL5a4k7.a    -reexport_library ${HASKELL_LIB}&#47;text-1.2.1.3&#47;libHStext-1.2.1.3-1l1AN4I48k37Ra&zwnj;&#8203;Q6fm6CEh.a    -reexport_library [...] </code>.  I still had to list every imported library but I can work with this."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 1, "last_activity_date": 1440311354, "creation_date": 1440311354, "answer_id": 32163855, "question_id": 32163380, "link": "https://stackoverflow.com/questions/32163380/creating-a-statically-linked-haskell-library-on-mac/32163855#32163855", "title": "Creating a statically-linked Haskell library on Mac", "body": "<p>In short, use <code>ghc -v</code> to build an application that uses your library and see how it invokes <code>gcc</code> in the link step, then use <code>ld -r</code> instead. You might also want to adjust the link command to link against some C dependencies like GMP statically, depending on your needs.</p>\n"}], "owner": {"reputation": 409, "user_id": 899333, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a3c36106bbf7b90e4d67d54e37863feb?s=128&d=identicon&r=PG", "display_name": "Tom Kludy", "link": "https://stackoverflow.com/users/899333/tom-kludy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1440428081, "creation_date": 1440306606, "last_edit_date": 1440428081, "question_id": 32163380, "link": "https://stackoverflow.com/questions/32163380/creating-a-statically-linked-haskell-library-on-mac", "title": "Creating a statically-linked Haskell library on Mac", "body": "<p>I am using: Mac OS X 10.10, GHC 7.10.2 (Haskell Platform), Cabal 1.22</p>\n\n<p>I am trying to create a statically-linked library in Haskell.  The intention is to provide a library with a C-compatible ABI, for use cross-platform and cross-language.  None of the consumers of this library are expected to be implemented in Haskell so the C-compatible ABI is critical, as is ease of distribution of the resulting library.</p>\n\n<p>My problem is, none of the FFI tutorials / examples use 3rd party modules, and hardly any even mention cabal.  Both of these are prerequisites for me.  When I follow a simple FFI tutorial it works, but as soon as I put in a 3rd party module, it fails for me.</p>\n\n<p>I created a very simple example detailing my problem at: <a href=\"https://github.com/tomkludy/ffihell\" rel=\"nofollow\">https://github.com/tomkludy/ffihell</a></p>\n\n<p>If you build the library using <code>cabal configure;cabal build</code>, you will find in <code>dist\\build</code> a library named something like <code>libHSffihell-0.1.0.0-70CjWiqse6C2Al3vL5a4k7</code> (followed by .a, _p.a, and -ghc7.10.2.dylib).</p>\n\n<p><strong>Problem 1: The library is named something different every time</strong>.  How can I make cabal name the library the same every time I build it?</p>\n\n<p>If you then build the C program that consumes it (tryit.c) by modifying <code>build_c.sh</code> to point to the right library name, it works:</p>\n\n<pre><code>&gt; ghc tryit.c -Idist/build -Ldist/build -lHSffihell-0.1.0.0-70CjWiqse6C2Al3vL5a4k7 -no-hs-main -o tryit\n&gt; ./tryit\nfoo 4: 5\n</code></pre>\n\n<p>However, if you uncomment these lines in Foo.hs, causing it to pull in the Data.Text library:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface, OverloadedStrings #-}\nmodule Foo where\n\nimport qualified Data.Text as T\n\nforeign export ccall foo :: Int -&gt; IO Int\n\nfoo :: Int -&gt; IO Int\nfoo n = return $ n + 1\n\n-- UNCOMMENTED BELOW HERE...\nforeign export ccall bar :: Int -&gt; IO ()\nbar :: Int -&gt; IO ()\nbar n = putStrLn $ T.unpack $ T.concat $ [\".\" :: T.Text | _ &lt;- [1..n]]\n</code></pre>\n\n<p>Then try to build...</p>\n\n<pre><code>&gt; cabal build\n(... no errors ...)\n&gt; ghc tryit.c -Idist/build -Ldist/build -lHSffihell-0.1.0.0-70CjWiqse6C2Al3vL5a4k7 -no-hs-main -o tryit\nUndefined symbols for architecture x86_64:\n  \"_textzu1l1AN4I48k37RaQ6fm6CEh_DataziText_concat_closure\", referenced from:\n      _S45B_srt in libHSffihell-0.1.0.0-70CjWiqse6C2Al3vL5a4k7.a(Foo.o)\n  \"_textzu1l1AN4I48k37RaQ6fm6CEh_DataziText_concat_info\", referenced from:\n      _ffihezu70CjWiqse6C2Al3vL5a4k7_Foo_zdfstableZZC0ZZCffihezzu70CjWiqse6C2Al3vL5a4k7ZZCFooZZCbar2_info in libHSffihell-0.1.0.0-70CjWiqse6C2Al3vL5a4k7.a(Foo.o)\n      _c4bD_info in libHSffihell-0.1.0.0-70CjWiqse6C2Al3vL5a4k7.a(Foo.o)\n  \"_textzu1l1AN4I48k37RaQ6fm6CEh_DataziTextziShow_unpackCStringzh_closure\", referenced from:\n      _S45B_srt in libHSffihell-0.1.0.0-70CjWiqse6C2Al3vL5a4k7.a(Foo.o)\n  \"_textzu1l1AN4I48k37RaQ6fm6CEh_DataziTextziShow_unpackCStringzh_info\", referenced from:\n      _ffihezu70CjWiqse6C2Al3vL5a4k7_Foo_zdfstableZZC0ZZCffihezzu70CjWiqse6C2Al3vL5a4k7ZZCFooZZCbar4_info in libHSffihell-0.1.0.0-70CjWiqse6C2Al3vL5a4k7.a(Foo.o)\nld: symbol(s) not found for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n</code></pre>\n\n<p><strong>Problem 2: Can't find symbols related to 3rd party module</strong></p>\n\n<p>The errors seem to be related to symbols imported by Data.Text.</p>\n\n<p>This example is as trivial as I could make it, but my real library has about 50 3rd party modules, and the list of modules will change over time as I expand the functionality provided.  I need to get to a single statically linked library that includes my own functions + all of the dependencies so that the people using my library won't have to keep changing their build scripts/makefiles/etc.</p>\n\n<p><strong>Problem 3: Unable to build with clang/gcc</strong></p>\n\n<p>The only way that I could get the \"tryit.c\" program to link with my program at all, even before consuming 3rd parties, was to compile it with GHC.  Since my consumers are not programming Haskell they will not have GHC.  Is there any documentation on compiling programs against Haskell libraries, NOT using GHC for the compilation?  I could not find anything...  Just docs stating that it \"should be possible\" but without any details.</p>\n\n<p>Thanks for any help!</p>\n\n<p><strong>Update</strong>\nI was able to get much further by using <code>ld -r</code> as suggested below, in combination with <code>-force_load</code><em>(my library)</em> and <code>-reexport_library</code><em>(every module library, plus many of the GHC framework libraries)</em>.  You can see the new code at the same git repo.  The <code>build_lib.sh</code> builds the Haskell library, and <code>build_c.sh</code> then uses that library to build a C-source executable that consumes it.</p>\n\n<p>I am still unable to solve Problem #1 or Problem #3, and I am also struggling to find a way to automatically pick up all of the right module library dependencies.  I will update if I get a complete solution.</p>\n"}, {"tags": ["haskell", "recursion", "fold", "readability", "lcm"], "answers": [{"comments": [{"owner": {"reputation": 579, "user_id": 2873090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6ca02599d836c10ad5420f740311ef9?s=128&d=identicon&r=PG&f=1", "display_name": "catleeball", "link": "https://stackoverflow.com/users/2873090/catleeball"}, "edited": false, "score": 0, "creation_date": 1440299360, "post_id": 32162665, "comment_id": 52213096, "body": "Oh cool, perfect, thank you! I need to study up on folds and get used to using them more. As a follow-up question: is there a reason to use the lazy foldl from prelude over the more eager foldl&#39; from Data.List? Is either faster? I know the lazy foldl can create stack overflows on large lists, but don&#39;t know what advantage it provides or of its laziness is faster for short lists."}, {"owner": {"reputation": 597, "user_id": 2157021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5f361d3bd72832787dc2b79ce78de71?s=128&d=identicon&r=PG", "display_name": "amar47shah", "link": "https://stackoverflow.com/users/2157021/amar47shah"}, "edited": false, "score": 1, "creation_date": 1440299385, "post_id": 32162665, "comment_id": 52213100, "body": "You could also use <code>foldr</code>, as in <code>lcms = foldr lcm 1</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 579, "user_id": 2873090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6ca02599d836c10ad5420f740311ef9?s=128&d=identicon&r=PG&f=1", "display_name": "catleeball", "link": "https://stackoverflow.com/users/2873090/catleeball"}, "edited": false, "score": 2, "creation_date": 1440299402, "post_id": 32162665, "comment_id": 52213104, "body": "@clball <code>foldl</code> is almost never what you want."}, {"owner": {"reputation": 597, "user_id": 2157021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5f361d3bd72832787dc2b79ce78de71?s=128&d=identicon&r=PG", "display_name": "amar47shah", "link": "https://stackoverflow.com/users/2157021/amar47shah"}, "edited": false, "score": 1, "creation_date": 1440299654, "post_id": 32162665, "comment_id": 52213142, "body": "This article has an in-depth treatment of the three, with some rules of thumb at the end. <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl%27\" rel=\"nofollow noreferrer\">wiki.haskell.org/Foldr_Foldl_Foldl%27</a>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1440300769, "post_id": 32162665, "comment_id": 52213267, "body": "@Daniel Wagner - what about <code>foldl&#39;</code> here?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1440311829, "post_id": 32162665, "comment_id": 52215046, "body": "@user5402 <code>foldr</code> and <code>foldl&#39;</code> could both be reasonable choices, depending on the usage. Considering that this particular use is type-restricted to <code>Int</code> -- an inherently strict type -- I think <code>foldl&#39;</code> is the natural choice."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440357096, "post_id": 32162665, "comment_id": 52227505, "body": "folder could be used for lazy naturals."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1451432946, "post_id": 32162665, "comment_id": 56783374, "body": "@PyRulez, I eagerly await your performance analysis of your preferred LCM algorithm for lists of lazy naturals."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 9, "last_activity_date": 1440297413, "creation_date": 1440297413, "answer_id": 32162665, "question_id": 32162645, "link": "https://stackoverflow.com/questions/32162645/is-there-a-more-clean-elegant-haskell-way-to-write-this-lcm-function/32162665#32162665", "title": "Is there a more clean, elegant, Haskell way to write this LCM function?", "body": "<p>It's a fold:</p>\n\n<pre><code>import Data.List\n\nlcms :: [Int] -&gt; Int\nlcms xs = foldl' lcm 1 xs\n</code></pre>\n\n<p>where <code>lcm</code> compute the lcm of just two numbers:</p>\n\n<pre><code>lcm :: Int -&gt; Int -&gt; Int\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 579, "user_id": 2873090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6ca02599d836c10ad5420f740311ef9?s=128&d=identicon&r=PG&f=1", "display_name": "catleeball", "link": "https://stackoverflow.com/users/2873090/catleeball"}, "edited": false, "score": 0, "creation_date": 1440301045, "post_id": 32162782, "comment_id": 52213303, "body": "Thanks for a very detailed explanation! Why is explicit recursion generally avoided? Just generally not the best way to go about something? Also it&#39;s really cool that you were able to implement a solution that was almost exactly the psudocode. That&#39;s pretty rad."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 579, "user_id": 2873090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6ca02599d836c10ad5420f740311ef9?s=128&d=identicon&r=PG&f=1", "display_name": "catleeball", "link": "https://stackoverflow.com/users/2873090/catleeball"}, "edited": false, "score": 4, "creation_date": 1440311774, "post_id": 32162782, "comment_id": 52215034, "body": "@clball Generally using functions like <code>map</code>, <code>filter</code>, and similar (and to a certain extent <code>foldr</code>) are preferred over general recursion because there are fewer ways to insert bugs, and because it is easier for readers to understand at a glance. If I see recursion, I&#39;m always looking to see what special cases it has that make it not fit into the standard patterns."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 579, "user_id": 2873090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6ca02599d836c10ad5420f740311ef9?s=128&d=identicon&r=PG&f=1", "display_name": "catleeball", "link": "https://stackoverflow.com/users/2873090/catleeball"}, "edited": false, "score": 1, "creation_date": 1440320761, "post_id": 32162782, "comment_id": 52216934, "body": "@clball Note how this solution avoids <code>head</code> and <code>tail</code>. These functions are dangerous since they will crash your program if you ever call them on an empty list. You then have a burden to carefully insert guards such as your <code>length list &gt; 1</code>. Instead, using pattern matching as above will not crash the program, <i>unless</i> you do not cover all the possible cases. Fortunately, <code>-Wall</code> will warn you if a definition is not exhaustive. I find this <i>very</i> helpful. Also, pattern matching can make the code more readable."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1440298985, "creation_date": 1440298985, "answer_id": 32162782, "question_id": 32162645, "link": "https://stackoverflow.com/questions/32162645/is-there-a-more-clean-elegant-haskell-way-to-write-this-lcm-function/32162782#32162782", "title": "Is there a more clean, elegant, Haskell way to write this LCM function?", "body": "<p>You can write it with almost the syntax you suggested, thus:</p>\n\n<pre><code>lcms (a:b:c) = lcms (lcm a b:c)\nlcms list = list\n</code></pre>\n\n<p>I find the second clause a little bit odd, but not terrible: it gracefully handles empty lists, though returning a list when you know you will return at most one item might be seen by some hasochists as being a bit imprecise with your types. You could also consider using <code>Maybe</code>, the canonical 0-or-1 element type:</p>\n\n<pre><code>lcms (a:b:c)  = lcms (lcm a b:c)\nlcms [answer] = Just answer\nlcms []       = Nothing\n</code></pre>\n\n<p>Another good choice would be to identify a sane base case. For binary operations, the unit of the operation is usually a good choice, so for <code>lcm</code>, I would choose <code>1</code>, thus:</p>\n\n<pre><code>lcms (a:b:c)  = lcms (lcm a b:c)\nlcms [answer] = answer\nlcms []       = 1\n</code></pre>\n\n<p>Generally, one tries to avoid explicit recursion when possible; the other answer shows how to take that step. In this case, there is an intermediate transformation that makes the base cases slightly more aesthetically pleasing: instead of keeping your accumulator at the head of the list -- which only incidentally works because your accumulator is the same type as the list elements -- one can make the accumulation more explicit or less. Thus, one of these:</p>\n\n<pre><code>lcms (x:xs) = lcm x (lcm xs)\nlcms []     = 1\n\n-- OR\n\nlcms = go 1 where\n    go acc (x:xs) = go (lcm acc x) xs\n    go acc []     = acc\n</code></pre>\n\n<p>These two implementations correspond to choosing <code>foldr</code> or <code>foldl</code> for eliminating the explicit recursion; <code>foldl'</code> would be similar to the second one, but with an extra <code>seq</code>:</p>\n\n<pre><code>lcms = go 1 where\n    go acc (x:xs) = let acc' = lcm acc x in acc' `seq` go acc' xs\n    go acc []     = acc\n</code></pre>\n"}], "owner": {"reputation": 579, "user_id": 2873090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6ca02599d836c10ad5420f740311ef9?s=128&d=identicon&r=PG&f=1", "display_name": "catleeball", "link": "https://stackoverflow.com/users/2873090/catleeball"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 283, "favorite_count": 0, "accepted_answer_id": 32162665, "answer_count": 2, "score": 3, "last_activity_date": 1451430299, "creation_date": 1440297173, "last_edit_date": 1451430299, "question_id": 32162645, "link": "https://stackoverflow.com/questions/32162645/is-there-a-more-clean-elegant-haskell-way-to-write-this-lcm-function", "title": "Is there a more clean, elegant, Haskell way to write this LCM function?", "body": "<p>I'm just starting out with Haskell and hammered out this simple recursive algo to find the LCM for every number in a list. It works, but it's messy and I was hoping for some peer-review on how to make this more elegant, readable, and Haskell-y.</p>\n\n<pre><code>lcms list \n  | length list &gt; 1 = lcms (lcm (head list) (head (tail list)):(tail (tail list)))\n  | otherwise = list\n</code></pre>\n\n<p>So that takes a list and does LCM of the first two items, then prepends it to list minus those two elements. Basically, the psudocode I'm going for is like this:</p>\n\n<pre><code>lcms [a,b,c] = lcm (a, (lcm (b, c))\n</code></pre>\n\n<p>Any suggestions, anyone? I'm eager to improve at Haskell and write things that people can actually read. Efficiency tips are welcome too!</p>\n\n<p>Thanks, all!</p>\n"}, {"tags": ["haskell", "cabal", "haddock"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 3, "last_activity_date": 1440286629, "creation_date": 1440286629, "answer_id": 32161792, "question_id": 32161496, "link": "https://stackoverflow.com/questions/32161496/where-does-cabal-put-the-hyperlinked-source/32161792#32161792", "title": "Where does cabal put the hyperlinked source?", "body": "<p>Look at your <code>~/.cabal/config</code> file for the <code>install-dirs</code> stanza:</p>\n\n<pre><code>install-dirs user\n  prefix: ...\n  -- bindir: $prefix/bin\n  libdir: $prefix/$compiler-$arch/lib\n  libsubdir: $pkgid\n  -- libexecdir: $prefix/libexec\n  -- datadir: $prefix/share\n  datasubdir: $compiler-$arch/$pkgid\n  docdir: $prefix/$compiler-$arch/lib/$pkgid/doc\n</code></pre>\n\n<p>The <code>docdir</code> setting is what you're interested in.</p>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1440317718, "creation_date": 1440283486, "last_edit_date": 1495541736, "question_id": 32161496, "link": "https://stackoverflow.com/questions/32161496/where-does-cabal-put-the-hyperlinked-source", "title": "Where does cabal put the hyperlinked source?", "body": "<p>According to <a href=\"https://stackoverflow.com/questions/2472630/enable-hyperlink-source-for-cabal-install#comment35437211_3930939\">this comment</a>, you can cause cabal-install to also hyperlink the source of the package you are installing. Where does it put theses sources? Do I need to enable any other options or packages to acquire them?</p>\n"}, {"tags": ["haskell", "fold"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1440275741, "creation_date": 1440275741, "answer_id": 32160513, "question_id": 32160350, "link": "https://stackoverflow.com/questions/32160350/folding-over-a-list-and-counting-all-occurrences-of-arbitrarily-many-unique-and/32160513#32160513", "title": "Folding over a list and counting all occurrences of arbitrarily many unique and unknown entities", "body": "<p>A fold allows you to traverse a list while keep track of some state. In this case the state you want to keep is the current list of counts of each string seen so far.</p>\n\n<p>Let's model this state as <code>Map String Int</code> where <code>Map</code> is from <code>Data.Map.Strict</code>.</p>\n\n<p>If <code>m</code> is our current state, we can perform these operations:</p>\n\n<pre><code>findWithDefault 0 str m -- returns the count for string str\n                           returns 0 if the string isn't found\n\ninsert str count m      -- insert the tuple (str,count) into the map\n                           (replaces previous value at key str)\n\nempty                   -- the empty map\n</code></pre>\n\n<p>With these operations, our step function for the fold can look like this:</p>\n\n<pre><code>step :: Map String Int -&gt; String -&gt; Map String Int\nstep m str =\n  let count = findWithDefault 0 str m\n      m' = insert str (count+1) m\n  in m'\n</code></pre>\n\n<p>The complete fold is:</p>\n\n<pre><code>countStrings :: [String] -&gt; Map String Int\ncountStrings strs = foldl step empty strs\n</code></pre>\n\n<p>Note that the use of <code>Data.Map.Strict</code> is important here. You want <code>count+1</code> to be evaluated eagerly instead of stored as a thunk.</p>\n"}, {"comments": [{"owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "edited": false, "score": 0, "creation_date": 1440523706, "post_id": 32164297, "comment_id": 52304548, "body": "This solution is good, but I&#39;m going to be computing several values, each time I need to traverse the entire list. Hence using foldl."}], "tags": [], "owner": {"reputation": 18463, "user_id": 3189923, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/5d3122866199817cdf56b96a788d406f?s=128&d=identicon&r=PG&f=1", "display_name": "elm", "link": "https://stackoverflow.com/users/3189923/elm"}, "is_accepted": false, "score": 1, "last_activity_date": 1440404568, "last_edit_date": 1440404568, "creation_date": 1440315250, "answer_id": 32164297, "question_id": 32160350, "link": "https://stackoverflow.com/questions/32160350/folding-over-a-list-and-counting-all-occurrences-of-arbitrarily-many-unique-and/32164297#32164297", "title": "Folding over a list and counting all occurrences of arbitrarily many unique and unknown entities", "body": "<p>Consider grouping the sorted list by equality, then applying a lambda function to count occurrences,</p>\n\n<pre><code>import Data.List\n\nentryCount :: Ord a =&gt; [a] -&gt; [(a,Int)]\nentryCount = map (\\v -&gt; (head v, length v)) . groupBy (==) . sort\n</code></pre>\n\n<p>Hence</p>\n\n<pre><code>entryCount [Just \"a\", Just \"b\", Just \"aab\", Nothing, Just \"aab\"]\n[(Nothing,1),(Just \"a\",1),(Just \"aab\",2),(Just \"b\",1)]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "edited": false, "score": 0, "creation_date": 1440523717, "post_id": 32176661, "comment_id": 52304558, "body": "This solution is good as well, but I&#39;m going to be computing several values, each time I need to traverse the entire list. Hence using foldl."}], "tags": [], "owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "is_accepted": false, "score": 2, "last_activity_date": 1440401496, "creation_date": 1440401496, "answer_id": 32176661, "question_id": 32160350, "link": "https://stackoverflow.com/questions/32160350/folding-over-a-list-and-counting-all-occurrences-of-arbitrarily-many-unique-and/32176661#32176661", "title": "Folding over a list and counting all occurrences of arbitrarily many unique and unknown entities", "body": "<p>What about:</p>\n\n<pre><code>\u03bb&gt; :set -XTupleSections\n\u03bb&gt; import qualified Data.Map.Strict as Map\n\u03bb&gt; Map.fromListWith (+) $ fmap (,1) [Just \"a\", Just \"b\", Just \"aab\", Nothing, Just \"aab\"]\nfromList [(Nothing,1),(Just \"a\",1),(Just \"aab\",2),(Just \"b\",1)]\n</code></pre>\n\n<p>we just map over the list to form a pair of <code>(x,1)</code> and then use <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Map-Strict.html#v:fromListWith\" rel=\"nofollow\">fromListWith</a> to build up the <code>Map</code>.</p>\n\n<pre><code>countOccurences :: (Num a, Ord k) =&gt; [k] -&gt; Map.Map k a\ncountOccurences = Map.fromListWith (+) . fmap (,1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 1, "last_activity_date": 1440411994, "creation_date": 1440411994, "answer_id": 32180010, "question_id": 32160350, "link": "https://stackoverflow.com/questions/32160350/folding-over-a-list-and-counting-all-occurrences-of-arbitrarily-many-unique-and/32180010#32180010", "title": "Folding over a list and counting all occurrences of arbitrarily many unique and unknown entities", "body": "<p>In addition to the other answers, I'd like to bring your attention to the concept of <a href=\"https://en.wikipedia.org/wiki/Monoid\" rel=\"nofollow\">monoids</a>. It's an abstraction for combining a sequence of elements (including 0-length) using an <a href=\"https://en.wikipedia.org/wiki/Associative_property\" rel=\"nofollow\">associative</a> operation.</p>\n\n<p>In this case, the monoid will be a map of elements to numbers (their count), with the empty element being an empty map and the combining operation merges the two maps, summing values for keys present in both.</p>\n\n<pre><code>import Data.Foldable\nimport qualified Data.Map as M\nimport Data.Monoid\n\nnewtype CountMap k = CountMap { getCountMap :: M.Map k Int }\n  deriving (Eq, Ord, Show, Read)\n\ninstance (Ord k) =&gt; Monoid (CountMap k) where\n    mempty = CountMap M.empty\n    mappend (CountMap m1) (CountMap m2) = CountMap $ M.unionWith (+) m1 m2\n\nsingleton :: k -&gt; CountMap k\nsingleton x = CountMap $ M.singleton x 1\n\nunique :: (Foldable f, Ord k) =&gt; f k -&gt; [(k, Int)]\nunique = M.toList . getCountMap . foldMap singleton\n</code></pre>\n\n<p>While solutions described using monoids aren't not necessarily the shortest ones, they often express the main idea more clearly and on a higher level than than folds.</p>\n\n<p>Also for structures other than lists, for example trees, combining elements using monoids is more natural (and in some cases more efficient): Each leaf is converted to its corresponding value in the monoid and then the values are combined bottom up.</p>\n\n<p>See also <a href=\"http://apfelmus.nfshost.com/articles/monoid-fingertree.html\" rel=\"nofollow\">Monoids and Finger Trees</a>.</p>\n"}], "owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 710, "favorite_count": 1, "accepted_answer_id": 32180010, "answer_count": 4, "score": 1, "last_activity_date": 1440527120, "creation_date": 1440274509, "last_edit_date": 1440527120, "question_id": 32160350, "link": "https://stackoverflow.com/questions/32160350/folding-over-a-list-and-counting-all-occurrences-of-arbitrarily-many-unique-and", "title": "Folding over a list and counting all occurrences of arbitrarily many unique and unknown entities", "body": "<p>I am using the <code>Control.Foldl</code> library to traverse an arbitrarily long list and counting all occurrences of arbitrarily many unique entities. Ie, the list may be of form</p>\n\n<pre><code>[Just \"a\", Just \"b\", Just \"aab\", Nothing, Just \"aab\"]\n</code></pre>\n\n<p>and I my result should be of form </p>\n\n<p><code>[(Just \"a\",1),(Just \"b\",1) (Just \"aab\", 2), (Nothing, 1)]</code></p>\n\n<p>Now the issue is I do not have the name of these entities a priori, and I would like to dynamically update the results as I fold. </p>\n\n<p>My problem is that I do not know how to describe this computation in terms of the <code>Fold a b</code> data type from <code>foldl</code>. Specifically, at each step of the fold I need to traverse the result list and ask if I have seen the current item, but I see no way of describing this using <code>foldl</code>.</p>\n"}, {"tags": ["image", "haskell", "memory", "ghc", "ghci"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1440274605, "post_id": 32159800, "comment_id": 52208414, "body": "What&#39;s in the <code>smiley.bmp</code> file? Perhaps it claims a huge height and width?"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1440276449, "post_id": 32159800, "comment_id": 52208878, "body": "@Cirdec It is only 9 by 9 pixels. You can click the link above if you want to examine it."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1440277533, "post_id": 32159800, "comment_id": 52209142, "body": "That&#39;s a really good question.  I don&#39;t care so much about the actual issue, but just the completeness, hyperlinks, and all.  Very impressive.  Also, have you tried DevIL?"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1440277807, "post_id": 32159800, "comment_id": 52209196, "body": "@ThomasM.DuBuisson Putting links in the code block is actually quite difficult. I was going to raise an issue on meta about it."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1440277849, "post_id": 32159800, "comment_id": 52209203, "body": "@ThomasM.DuBuisson The reason I choose Juicy Pixels is because of gloss compatibility. I will look at DevIL though."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1440278979, "post_id": 32159800, "comment_id": 52209458, "body": "@PyRulez Notice that <a href=\"http://hackage.haskell.org/package/friday-devil\" rel=\"nofollow noreferrer\">DevIL can convert to Friday</a> and <a href=\"https://github.com/TomMD/friday-juicypixels\" rel=\"nofollow noreferrer\">Friday can convert to JuicyPixels</a> and that can <a href=\"http://hackage.haskell.org/package/gloss-juicy\" rel=\"nofollow noreferrer\">convert to Gloss</a>, so its very nearly the same format through and through.  After my patches are accepted it will all be O(1) too."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1440279786, "post_id": 32159800, "comment_id": 52209691, "body": "@ThomasM.DuBuisson That is insane. Someone should put them all in one library before my head explodes."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1440281876, "post_id": 32159800, "comment_id": 52210218, "body": "@PyRulez Go for it!  We can have all A-B packages, Devil-gloss is just one more."}], "answers": [{"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440277971, "post_id": 32160831, "comment_id": 52209229, "body": "What the? Bad smiley!"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1440279621, "post_id": 32160831, "comment_id": 52209650, "body": "Yeah that was it. It works with another image just fine."}, {"owner": {"reputation": 640, "user_id": 949024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d81f9bcedb04a5e043fc9edd218ad83?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/949024/alex"}, "edited": false, "score": 1, "creation_date": 1440280498, "post_id": 32160831, "comment_id": 52209872, "body": "The bitmap is valid. According to MSDN a negative height means the origin is in the upper left corner."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1440281863, "post_id": 32160831, "comment_id": 52210217, "body": "Then someone should patch both JP and <code>file</code>."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 4, "last_activity_date": 1440277864, "creation_date": 1440277864, "answer_id": 32160831, "question_id": 32159800, "link": "https://stackoverflow.com/questions/32159800/juicy-pixels-complains-about-not-having-enough-memory/32160831#32160831", "title": "Juicy Pixels complains about not having enough memory", "body": "<p>This is not really a valid bitmap file and JuicyPixels is not error checking the inputs like it should.  Notice the dimensions...</p>\n\n<pre><code>% file smiley.bmp\nsmiley.bmp: PC bitmap, Windows 3.x format, 8 x -8 x 24\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1440350406, "post_id": 32161248, "comment_id": 52225364, "body": "Its been fixed now. They even made smiley a test case."}], "tags": [], "owner": {"reputation": 640, "user_id": 949024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d81f9bcedb04a5e043fc9edd218ad83?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/949024/alex"}, "is_accepted": false, "score": 5, "last_activity_date": 1440281037, "creation_date": 1440281037, "answer_id": 32161248, "question_id": 32159800, "link": "https://stackoverflow.com/questions/32159800/juicy-pixels-complains-about-not-having-enough-memory/32161248#32161248", "title": "Juicy Pixels complains about not having enough memory", "body": "<p>This is a bug in juicypixels where bitmaps with negative heights aren't interpreted properly.</p>\n\n<p>The negative height should denote the origin is in the top left rather than bottom left corner.</p>\n\n<p>I have opened a new bug report here: <a href=\"https://github.com/Twinside/Juicy.Pixels/issues/105\">https://github.com/Twinside/Juicy.Pixels/issues/105</a></p>\n\n<p>Juicy pixels does not support bitmap particularly well. There are a number of other limitations. (see <a href=\"https://github.com/Twinside/Juicy.Pixels/issues/96\">https://github.com/Twinside/Juicy.Pixels/issues/96</a>)</p>\n"}], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 32160831, "answer_count": 2, "score": 5, "last_activity_date": 1440281037, "creation_date": 1440270571, "question_id": 32159800, "link": "https://stackoverflow.com/questions/32159800/juicy-pixels-complains-about-not-having-enough-memory", "title": "Juicy Pixels complains about not having enough memory", "body": "<pre>$ ghci\nGHCi, version 7.10.1: http://www.haskell.org/ghc/  :? for help\nPrelude> import <a href=\"http://hackage.haskell.org/package/JuicyPixels-3.2.6/docs/Codec-Picture.html\">Codec.Picture</a>\nPrelude Codec.Picture> Right pic &lt- <a href=\"http://hackage.haskell.org/package/JuicyPixels-3.2.6/docs/Codec-Picture.html#v:readImage\">readImage</a> \"<a href=\"http://filebin.ca/2D30bfu82mDT/smiley.bmp\">smiley.bmp</a>\"\n&ltinteractive>: out of memory (requested 4296015872 bytes)\n</pre>\n\n<p><code>smiley.bmp</code> is under 300 bytes. Why did I run out of memory?</p>\n"}, {"tags": ["parsing", "csv", "haskell", "conduit"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1440278337, "last_edit_date": 1440278337, "creation_date": 1440277883, "answer_id": 32160835, "question_id": 32159328, "link": "https://stackoverflow.com/questions/32159328/can-csv-conduit-read-a-string-in-csv-form-and-parse-it-into-some-intermediate-da/32160835#32160835", "title": "Can csv-conduit read a string in csv form and parse it into some intermediate datatype?", "body": "<p>Here is an example which shows how to add a processing step in a cvs conduit pipeline. Here we just add a column to each input row.</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction, OverloadedStrings #-}\n\nmodule Lib\nwhere\n\nimport Data.Conduit\nimport Data.Conduit.Binary\nimport Data.CSV.Conduit\nimport Data.Text\nimport qualified Data.Map as Map\nimport Control.Monad\n\nmyProcessor :: Monad m =&gt; Conduit (MapRow Text) m (MapRow Text)\nmyProcessor = do\n  x &lt;- await\n  case x of\n    Nothing -&gt; return ()\n    Just m -&gt; do let m' = Map.insert \"asd\" \"qwe\" m\n                 yield m'\n                 myProcessor\n\ntest = runResourceT $\n   sourceFile \"input.csv\" $=\n   intoCSV defCSVSettings $=\n   myProcessor $=\n   (writeHeaders defCSVSettings &gt;&gt; fromCSV defCSVSettings) $$\n   sinkFile \"output.csv\"\n</code></pre>\n\n<p>Of course, your processing stage doesn't have to produce <code>MapRow Text</code> items - it can produce items of whatever type you want. Use other conduit operations to collect / filter / process that pipeline.</p>\n\n<p>If you have a specific task you want to perform I can address that.</p>\n"}], "owner": {"reputation": 4310, "user_id": 1128571, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e743815e7a4a5f8c1d66277d6397624f?s=128&d=identicon&r=PG", "display_name": "xiaolingxiao", "link": "https://stackoverflow.com/users/1128571/xiaolingxiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1440278337, "creation_date": 1440267455, "last_edit_date": 1440268059, "question_id": 32159328, "link": "https://stackoverflow.com/questions/32159328/can-csv-conduit-read-a-string-in-csv-form-and-parse-it-into-some-intermediate-da", "title": "Can csv-conduit read a string in csv form and parse it into some intermediate datatype?", "body": "<p>The documentation found on csv-conduit's github page is scant, my use case involve reading a string in csv form, ie:</p>\n\n<pre><code>csv :: String\ncsv = \"\\\"column1 (text)\\\",\\\"column2 (text)\\\",\\\"column3 (number)\\\",\\\"column4 (number)\\\"\\r\\anId,stuff,12,30.454\\r\\n\"\n</code></pre>\n\n<p>and transforming it into some intermediate data type, so suppose we declare data type <code>Row</code>, then I'd have</p>\n\n<pre><code>csv' :: Row\ncsv' = Row (Just \"anId\") \"stuff\" 12 (Just 30.454)\n</code></pre>\n\n<p>But I'm not sure which functions to call. Furthermore, it seems like csv-conduit export some <code>Row</code> type already, but I'm not sure how to use it?</p>\n"}, {"tags": ["performance", "haskell", "comparison"], "comments": [{"owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "edited": false, "score": 0, "creation_date": 1440260966, "post_id": 32158319, "comment_id": 52204519, "body": "For what its worth, Im not too sure about my use of vectors, maybe thats the problem?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1440261801, "post_id": 32158319, "comment_id": 52204750, "body": "If you add <code>+RTS -s</code> when you call your executable, you&#39;ll note that GC takes most of the time."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1440261960, "post_id": 32158319, "comment_id": 52204789, "body": "Why do people continuously believe <code>-O3</code> is a GHC option? GHC&#39;s optimization levels max out at 2."}, {"owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1440262451, "post_id": 32158319, "comment_id": 52204932, "body": "@Zeta I appreciate the feedback, but I don&#39;t know how to use that information to make this faster. Maybe you can point me in the right direction?"}, {"owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1440262483, "post_id": 32158319, "comment_id": 52204941, "body": "@Carl <code>-O2</code> did not make any difference in the numbers."}, {"owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "edited": false, "score": 0, "creation_date": 1440264071, "post_id": 32158319, "comment_id": 52205437, "body": "Using <code>[x | x &lt;- map ((v!) . (n-)) cs, x &gt;= 0]</code> instead of <code>[v ! x | x &lt;- map (n-) cs, x &gt;= 0]</code> brought execution time down to <code>2.18user 0.29system 0:02.48elapsed 99%CPU (0avgtext+0avgdata 983660maxresident)k 0inputs+0outputs (0major+226603minor)pagefaults 0swaps</code>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1440264218, "post_id": 32158319, "comment_id": 52205486, "body": "What does profiling tell you?"}, {"owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1440321540, "post_id": 32158319, "comment_id": 52217096, "body": "@jberryman mostly the same things as the time output -- reduced time and memory usage. I am a little new to the <code>+RTS -s</code> option so my profiling may not be the greatest."}], "answers": [{"comments": [{"owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "edited": false, "score": 0, "creation_date": 1440264312, "post_id": 32158829, "comment_id": 52205517, "body": "Lol, I just tried this myself and I&#39;m amazed at the difference. The last time measurements <code>0.00user 0.00system 0:00.00elapsed 100%CPU (0avgtext+0avgdata 3856maxresident)k 0inputs+0outputs (0major+568minor)pagefaults 0swaps</code> -- Beating even my C++ implementation (although this is one off and in terms of statistics, insignificant)"}, {"owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "edited": false, "score": 1, "creation_date": 1440264450, "post_id": 32158829, "comment_id": 52205558, "body": "What is surprising though is why in the boxed case, manual fusion produced so much difference -- I would&#39;ve expected ghc to automatically fuse those loops."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1440265138, "last_edit_date": 1440265138, "creation_date": 1440264039, "answer_id": 32158829, "question_id": 32158319, "link": "https://stackoverflow.com/questions/32158319/difference-in-performance-for-coin-change-between-haskell-and-c/32158829#32158829", "title": "Difference in performance for Coin Change between Haskell and C++", "body": "<p>Unboxed vectors might help here:</p>\n\n<pre><code>import Data.Vector.Unboxed as U ((!), constructN, length)\n\ncoinchangev :: Int -&gt; [Int] -&gt; Int\ncoinchangev n cs = v ! n\n where v = constructN (n+1) f\n       f w = case U.length w of\n             0 -&gt; 0\n             m -&gt; 1 + minimum [w ! x | x &lt;- map (m-) cs, x &gt;= 0]\n</code></pre>\n\n<p>Original code:</p>\n\n<pre><code>$ time ./CoinChange \n100000\n\nreal    0m12.543s\nuser    0m11.742s\nsys 0m0.800s\n</code></pre>\n\n<p>Unboxed variant:</p>\n\n<pre><code>$ time ./CoinChange2\n100000\n\nreal    0m1.598s\nuser    0m1.588s\nsys 0m0.012s\n</code></pre>\n\n<p>Original C++:</p>\n\n<pre><code>$ time ./CoinChange_cpp \n100000\n\nreal    0m0.084s\nuser    0m0.072s\nsys 0m0.012s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "edited": false, "score": 2, "creation_date": 1440321423, "post_id": 32162519, "comment_id": 52217072, "body": "Hi, this solution is fast because it does not do the same thing as my implementation -- it just finds one way of producing n, not the one with the smallest number of coins. Consider <code>n=15</code> and <code>coins = [12, 10, 5, 1]</code>. This gives 4 whereas the correct answer is 2."}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "reply_to_user": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "edited": false, "score": 0, "creation_date": 1440321932, "post_id": 32162519, "comment_id": 52217203, "body": "OK got it! I haven&#39;t seen this case first! Now the problem is more interesting to me :)"}], "tags": [], "owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "is_accepted": false, "score": 0, "last_activity_date": 1440295681, "creation_date": 1440295681, "answer_id": 32162519, "question_id": 32158319, "link": "https://stackoverflow.com/questions/32158319/difference-in-performance-for-coin-change-between-haskell-and-c/32162519#32162519", "title": "Difference in performance for Coin Change between Haskell and C++", "body": "<p>I found that taking the length of the actual computed change is quite fast. (The coin list has to be sorted in descending order)</p>\n\n<pre><code>module Main where\n\nchange :: Int -&gt; [Int] -&gt; [Int]\nchange 0 _ = []\nchange _ [] = []\nchange amount coins@(c:cs)\n   | c &lt;= amount = c : change (amount - c) coins\n   | otherwise  = change amount cs\n\nmain :: IO ()\nmain =\n  print $ length $ change 10000000 [100, 25, 10, 5, 1]\n</code></pre>\n"}], "owner": {"reputation": 193, "user_id": 2265553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ac857999cccfeda5f5dc53be3cffb7d?s=128&d=identicon&r=PG", "display_name": "Ajit Singh", "link": "https://stackoverflow.com/users/2265553/ajit-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 534, "favorite_count": 2, "accepted_answer_id": 32158829, "answer_count": 2, "score": 6, "last_activity_date": 1440295681, "creation_date": 1440260855, "last_edit_date": 1440263143, "question_id": 32158319, "link": "https://stackoverflow.com/questions/32158319/difference-in-performance-for-coin-change-between-haskell-and-c", "title": "Difference in performance for Coin Change between Haskell and C++", "body": "<p>I was trying to implement the Coin Change problem in Haskell. The problem is as follows:</p>\n\n<blockquote>\n  <p>Given a set of coins and an infinite supply of those coins, find the minimum number of coins that it will require to make a certain value, say n.</p>\n</blockquote>\n\n<p>I wrote the following program in haskell:</p>\n\n<pre><code>import Data.Vector ((!), generate)\nimport Control.Applicative\nimport Control.Monad\n\ncoins = [1, 5, 10, 25, 100] :: [Int]\n\ncoinchangev :: Int -&gt; [Int] -&gt; Int\ncoinchangev n cs = v ! n\n where v = generate (n+1) f\n       f 0 = 0\n       f n = 1 + minimum [v ! x | x &lt;- map (n-) cs, x &gt;= 0]\n\nmain :: IO ()\nmain = do n &lt;- read &lt;$&gt; getLine :: IO Int\n           putStrLn . show $ coinchangev n coins\n</code></pre>\n\n<p>I wrote the following program in c++:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;vector&gt;\n\nusing namespace std;\ntypedef vector&lt;int&gt; row;\n\nconst row coins {1, 5, 10, 25, 100};\n#define INT_MAX 9999999;\n\nint coinchange(const int n, const row&amp; coins) {\n    row v(n+1, 0);\n\n    for (int i=1; i&lt;n+1; i++) {\n        int min = INT_MAX;\n\n        for (int j=0; j&lt;coins.size(); j++) {\n            int x = i - coins[j];\n            if (x &gt;= 0 &amp;&amp; v[x] &lt; min) {\n                min = v[x];\n            }\n        }\n\n        v[i] = 1 + min;\n    }\n\n    return v.back();\n}\n\nint main() {\n    int n; cin &gt;&gt; n;\n    cout &lt;&lt; coinchange(n, coins) &lt;&lt; endl;\n\n    return 0;\n}\n</code></pre>\n\n<p>I compiled the haskell version with <code>ghc -O3</code> (version 7.8.4) and the c++ version with <code>g++ --std=c++1y -O3</code> (version 4.8.4).</p>\n\n<p>For the input <code>10000000</code> my haskell program takes much longer than my c++ version to complete. Here are the timings that were measured using time:</p>\n\n<p>Haskell: <code>6.40user 0.85system 0:07.26elapsed 99%CPU (0avgtext+0avgdata 2664316maxresident)k \n152inputs+0outputs (1major+647822minor)pagefaults 0swaps</code></p>\n\n<p>C++: <code>0.08user 0.00system 0:00.08elapsed 97%CPU (0avgtext+0avgdata 39964maxresident)k\n0inputs+0outputs (0major+936minor)pagefaults 0swaps</code></p>\n\n<p>My question is why I'm seeing such a large difference and what steps I can take (if any) to improve the performance of the Haskell code. I had expected performance to be basically equivalent (at least within the same order). My objective was to keep the solution simple (and hopefully idiomatic) in both languages.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1440266800, "post_id": 32158110, "comment_id": 52206246, "body": "While there is no such thing available in the language (except , you might consider using <a href=\"https://wiki.haskell.org/Generics\" rel=\"nofollow noreferrer\">generics</a> or <a href=\"https://wiki.haskell.org/Template_Haskell\" rel=\"nofollow noreferrer\">Template Haskell</a> to generate such code. Would it be reasonable for your use case?"}], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440262035, "post_id": 32158440, "comment_id": 52204813, "body": "I guess the choice of approaches (the one I was using vs. your second one, at least) depends on how many &quot;tagged&quot; one there are. In practice, I just have a few (and there are more constructors with slightly different forms) and I think the approach I have may be cleanest. Is there a <i>conceptual</i> reason to choose one of these three approaches over another?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440264720, "post_id": 32158440, "comment_id": 52205653, "body": "@raxacoricofallapatorius Which one makes sense depends greatly on what you want the type to mean -- just like you might write <code>2*1 + 2*2 + 2*3</code> in some cases and <code>2 * (1 + 2 + 3)</code> in others to emphasize different reasons for being interested in the number <code>12</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 2, "creation_date": 1440271170, "post_id": 32158440, "comment_id": 52207505, "body": "@raxacoricofallapatorius, if the strings represent the same thing in each case, the tag approach makes sense. If the strings are unrelated, you probably want three constructors. The fact that you want to do the same thing to the strings regardless suggests, but does not imply, that the tagged approach makes sense."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 19, "last_activity_date": 1440261627, "creation_date": 1440261627, "answer_id": 32158440, "question_id": 32158110, "link": "https://stackoverflow.com/questions/32158110/can-i-match-a-data-constructor-wildcard-in-haskell/32158440#32158440", "title": "Can I match a data constructor wildcard in Haskell?", "body": "<p>Nope. But you can write this:</p>\n\n<pre><code>data Foo\n    = X { name :: String, age :: Int } \n    | A { name :: String }\n    | B { name :: String }\n    | C { name :: String }\n    | D { name :: String }\n</code></pre>\n\n<p>and then have <code>name :: Foo -&gt; String</code>. You could also consider this:</p>\n\n<pre><code>data Tag = A | B | C | D\ndata Foo = X String Int | Tagged Tag String\n\nf (X s _) = s\nf (Tagged _ s) = s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 5, "last_activity_date": 1440268762, "creation_date": 1440268762, "answer_id": 32159528, "question_id": 32158110, "link": "https://stackoverflow.com/questions/32158110/can-i-match-a-data-constructor-wildcard-in-haskell/32159528#32159528", "title": "Can I match a data constructor wildcard in Haskell?", "body": "<p>In addition to @DanielWagner's answer, an alternative is to use <a href=\"https://wiki.haskell.org/Scrap_your_boilerplate\" rel=\"noreferrer\">Scrap your boilerplate</a> (AKA \"SYB\"). It allows you to find the first subterm of a given type. So you could define</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n\nimport Control.Monad\nimport Data.Data\nimport Data.Generics.Schemes\nimport Data.Typeable\n\ndata Foo = X (String, Int) | A String | B String | C String | D String\n  deriving (Show, Eq, Ord, Data, Typeable)\n\nfooString :: Foo -&gt; Maybe String\nfooString = msum . gmapQ cast\n</code></pre>\n\n<p>and <code>fooString</code> will return the first <code>String</code> argument of your constructors. Function <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Typeable.html#v:cast\" rel=\"noreferrer\"><code>cast</code></a> filters out <code>String</code>s and <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Data.html#v:gmapQ\" rel=\"noreferrer\"><code>gmapQ</code></a> gets the filtered values for all immediate subterms.</p>\n\n<p>However, this won't return the <code>String</code> from <code>X</code>, because <code>X</code> has no immediate <code>String</code> subterm, it has only one subterm of type <code>(String, Int)</code>. In order to get the first <code>String</code> anywhere in the term hierarchy, you could use <a href=\"https://hackage.haskell.org/package/syb-0.3.7/docs/Data-Generics-Schemes.html#v:everywhere\" rel=\"noreferrer\"><code>everywhere</code></a>:</p>\n\n<pre><code>fooString' :: Foo -&gt; Maybe String\nfooString' = everything mplus cast\n</code></pre>\n\n<p>Note that this approach is slightly fragile: It includes simply all <code>String</code>s it finds, which might not be always what you want, in particular, if you later extend your data type (or some data type that it references).</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1357, "favorite_count": 0, "accepted_answer_id": 32158440, "answer_count": 2, "score": 13, "last_activity_date": 1440268762, "creation_date": 1440259503, "last_edit_date": 1440261558, "question_id": 32158110, "link": "https://stackoverflow.com/questions/32158110/can-i-match-a-data-constructor-wildcard-in-haskell", "title": "Can I match a data constructor wildcard in Haskell?", "body": "<p>I have</p>\n\n<pre><code>data Foo = X (String, Int) | A String | B String | C String | D String -- ...\n</code></pre>\n\n<p>and have defined</p>\n\n<pre><code>f (X (s, _)) =s \nf (A s) = s\nf (B s) = s\nf (C s) = s\nf (D s) = s\n-- ...\n</code></pre>\n\n<p>but would prefer to be able to write something like </p>\n\n<pre><code>f (X (s, _)) =s \nf (_ s) = s\n</code></pre>\n\n<p>But there seems to be no way to do this (I get a \"parse error\" associated with the <code>_</code>).</p>\n\n<p>Is there a way to match a data constructor wildcard in Haskell?</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440256985, "post_id": 32157642, "comment_id": 52203444, "body": "I just noticed my code only replaces double-tabs with single tabs - not all consecutive tabs."}, {"owner": {"reputation": 2332, "user_id": 615030, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Yd1uW.png?s=128&g=1", "display_name": "Artyom", "link": "https://stackoverflow.com/users/615030/artyom"}, "edited": false, "score": 0, "creation_date": 1440257070, "post_id": 32157642, "comment_id": 52203465, "body": "yeah, I meant consecutive tabs. Sorry for confusion."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440261526, "post_id": 32157642, "comment_id": 52204676, "body": "The whole point of the library is to give ways of working with sources of byte strings as though they were sources of bytes, without worrying about chunks!"}, {"owner": {"reputation": 2332, "user_id": 615030, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Yd1uW.png?s=128&g=1", "display_name": "Artyom", "link": "https://stackoverflow.com/users/615030/artyom"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440262091, "post_id": 32157642, "comment_id": 52204829, "body": "@dfeuer I agree, and I feel that it should be possible to write a more idiomatic solution with combinators in <code>Pipes.ByteString</code>, yet I&#39;ve no idea how to do it. Would you care to try your hand at a better solution? (It really feels like it should be obvious...)"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1440257746, "last_edit_date": 1440257746, "creation_date": 1440256344, "answer_id": 32157642, "question_id": 32157114, "link": "https://stackoverflow.com/questions/32157114/how-to-replace-double-tabs-with-single-tabs-using-pipes/32157642#32157642", "title": "How to replace double tabs with single tabs using pipes?", "body": "<p>Here is a solution which doesn't use <code>PB.break</code> but just uses basic pipe operations. One of the problem is that the data comes in chunks, and you have to keep track of whether or not the last chunk ended in a tab or not:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule Lib5\nwhere\n\nimport Pipes\nimport Pipes.ByteString\nimport qualified Data.ByteString.Char8 as BS\nimport Control.Monad\n\nprintAll = forever $ do a &lt;- await; lift $ putStrLn $ \"got: \" ++ show a\n\nendsWith bs ch = BS.length bs &gt; 0 &amp;&amp; BS.last bs == ch\n\nconvertDoubleTabs = await &gt;&gt;= go0\n\n-- no precediing tab\ngo0 b = do\n  let (pre,post) = BS.breakSubstring \"\\t\\t\" b\n  yield pre\n  if BS.length post == 0\n    then if endsWith pre '\\t'\n            then await &gt;&gt;= go1\n            else await &gt;&gt;= go0\n    else do yield \"\\t\"\n            go0 (BS.drop 2 post)\n\n-- last chunk ended in a tab\ngo1 b = do\n  if BS.length b == 0\n    then await &gt;&gt;= go1\n    else if BS.index b 0 == '\\t'\n            then go0 (BS.drop 1 b)\n            else go0 b\n\nexample1 = runEffect $ each [ \"this\", \"is\\t an\", \"\\t\\texample\\t\", \"\\t.\"] \n                       &gt;-&gt; convertDoubleTabs\n                       &gt;-&gt; printAll\n</code></pre>\n\n<p>I'll add to this answer if I figure out a solution using the <code>Pipes.ByteString</code> and lenses.</p>\n\n<p>To convert all consecutive tabs:</p>\n\n<pre><code>convertTabs = await &gt;&gt;= go0\n  where\n    go0 b = do\n      let (pre,post) = BS.break (== '\\t') b\n      yield pre\n      if BS.length post == 0\n        then await &gt;&gt;= go0\n        else do yield \"\\t\"\n                go1 post\n\n    go1 b = do\n      let b' = BS.dropWhile (== '\\t') b\n      if BS.null b'\n        then await &gt;&gt;= go1\n        else go0 b'\n\nexample2 = runEffect $ each [ \"___\\t___\\t\\t___\\t\\t\\t___\" ]\n                       &gt;-&gt; convertTabs\n                       &gt;-&gt; printAll\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440300736, "post_id": 32162713, "comment_id": 52213261, "body": "It seems that the focus of the library is more on parsing from streams than on manipulating them."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1440350426, "post_id": 32162713, "comment_id": 52225371, "body": "I don&#39;t think you need to use <code>view</code> with both <code>pack</code> and <code>unpack</code> I think you can just pick one and use it as a function (or maybe with some idiomatic identity function from <code>lens</code>)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440351161, "post_id": 32162713, "comment_id": 52225618, "body": "@dfeuer Indeed, all you need is <code>over</code>. Looks obvious in hindsight :) Thanks for pointing it out!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440351644, "post_id": 32162713, "comment_id": 52225785, "body": "Now I&#39;m wondering if this can be cleaned up a bit using <code>StateT</code> to handle the <code>wasTab</code>. I don&#39;t know how monad transformers and pipes get along. You could certainly run the effect in the transformed monad; I&#39;m not sure if there&#39;s a nicer approach available."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440351983, "post_id": 32162713, "comment_id": 52225892, "body": "@dfeuer I thought about <code>StateT</code> too, but I don&#39;t think it would feel natural in practice. You&#39;d either have to carry a single-purpose <code>StateT</code> layer around or run the pipe to completion earlier than intended to get rid of it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440353104, "post_id": 32162713, "comment_id": 52226244, "body": "What would go wrong using <code>flip evalStateT False . runEffect</code>, aside from failing to separate concerns?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1440354172, "post_id": 32162713, "comment_id": 52226577, "body": "@dfeuer Nothing would break, but the concern separation failure would be ugly. <code>runEffectT</code> is the final step used to run what can be a complex pipeline, all stages of which would now be in some manner aware of a state which only matters to that one tab-filtering function."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440355431, "post_id": 32162713, "comment_id": 52226960, "body": "That makes me wonder if there is or could be a function that takes a pipe over <code>StateT m</code> and an initial state and manufactures a pipe over <code>m</code>."}, {"owner": {"reputation": 2332, "user_id": 615030, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Yd1uW.png?s=128&g=1", "display_name": "Artyom", "link": "https://stackoverflow.com/users/615030/artyom"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1440363680, "post_id": 32162713, "comment_id": 52229341, "body": "@dfeuer sure, see <code>runStateP</code> in <code>Pipes.Lift</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2332, "user_id": 615030, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Yd1uW.png?s=128&g=1", "display_name": "Artyom", "link": "https://stackoverflow.com/users/615030/artyom"}, "edited": false, "score": 0, "creation_date": 1440364583, "post_id": 32162713, "comment_id": 52229570, "body": "@Artyom, I just opened a request to add such functionality to <code>machines</code>. I didn&#39;t have a good name for it though."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1440351081, "last_edit_date": 1440351081, "creation_date": 1440298061, "answer_id": 32162713, "question_id": 32157114, "link": "https://stackoverflow.com/questions/32157114/how-to-replace-double-tabs-with-single-tabs-using-pipes/32162713#32162713", "title": "How to replace double tabs with single tabs using pipes?", "body": "<p>The key is operating on a stream of bytes rather than one of bytestring chunks. That can be done through <code>pack</code> from pipes-bytestring (and pipes-text). Here is a not particularly sophisticated demo:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Pipes\nimport qualified Pipes.ByteString as PB\nimport qualified Data.ByteString as B\nimport Control.Monad\nimport Control.Lens (over)\n\ntest byst = runEffect $\n    removingConsecutiveTabs (PB.fromLazy byst) &gt;-&gt; PB.stdout\n\nremovingConsecutiveTabs :: Monad m\n                        =&gt; Producer B.ByteString m r\n                        -&gt; Producer B.ByteString m r\nremovingConsecutiveTabs = over PB.pack tabGatekeeper\n\ntabGatekeeper :: Monad m =&gt; Producer PB.Word8 m r -&gt; Producer PB.Word8 m r\ntabGatekeeper = go False\n    where\n    go wasTab stream = do\n        ex &lt;- lift $ next stream\n        case ex of\n            Left r -&gt; return r\n            Right (x, stream') -&gt; do\n                let thisIsATab = w8IsTab x\n                unless (wasTab &amp;&amp; thisIsATab) $ yield x\n                go thisIsATab stream'\n\n    w8IsTab x = toEnum (fromIntegral x) == '\\t'\n</code></pre>\n\n\n\n<pre><code>GHCi&gt; :set -XOverloadedStrings\nGHCi&gt; test \"___\\t___\\t\\t___\\t\\t\\t___\\n\"\n___ ___ ___ ___\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1440309894, "last_edit_date": 1440309894, "creation_date": 1440304827, "answer_id": 32163216, "question_id": 32157114, "link": "https://stackoverflow.com/questions/32157114/how-to-replace-double-tabs-with-single-tabs-using-pipes/32163216#32163216", "title": "How to replace double tabs with single tabs using pipes?", "body": "<p>Try this:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Pipes\nimport qualified Pipes.Prelude as P\nimport qualified Pipes.ByteString as PB\nimport           Data.ByteString (ByteString)\nimport Control.Lens hiding (each)\n\ncleanTabs p = do\n  p1 &lt;- view (PB.span (/= 9)) p\n  x &lt;- lift $ next p1\n  case x of\n    Left r -&gt; return r\n    Right (a, p2) -&gt; do\n      yield \"\\t\"\n      let p3 = PB.dropWhile (== 9) (yield a &gt;&gt; p2)\n      cleanTabs p3\n\nsource :: Monad m =&gt; Producer ByteString m ()\nsource = each [ \"this\", \"is\\t an\", \"\\t\\texample\\t\", \"\\t.\", \"\\t\\tmiddle\\t\", \"\\there\"]\n\nexample = do\n  putStrLn $ \"input: \" ++ (show $ P.toList source)\n  putStrLn $ \"output:\" ++ (show $ P.toList (cleanTabs source))\n</code></pre>\n"}], "owner": {"reputation": 2332, "user_id": 615030, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Yd1uW.png?s=128&g=1", "display_name": "Artyom", "link": "https://stackoverflow.com/users/615030/artyom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 32163216, "answer_count": 3, "score": 2, "last_activity_date": 1440351081, "creation_date": 1440253078, "last_edit_date": 1440257040, "question_id": 32157114, "link": "https://stackoverflow.com/questions/32157114/how-to-replace-double-tabs-with-single-tabs-using-pipes", "title": "How to replace double tabs with single tabs using pipes?", "body": "<p>I need to replace all consecutive tabs in a bytestring with single tabs, like so:</p>\n\n<pre><code>\"___\\t___\\t\\t___\\t\\t\\t___\"\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>\"___\\t___\\t___\\t___\"\n</code></pre>\n\n<p>I have <em>no</em> idea how to do it.</p>\n\n<p>After half an hour of figuring stuff out I managed to replace the first occurrence of double tabs, like so (and even this is actually wrong \u2013 it adds a tab to an empty string):</p>\n\n<pre><code>import qualified Pipes.ByteString as PB\nimport qualified Data.ByteString as B\n\nremoveConsecutiveTabs =\n  PB.break (== tab) . mapped %~ \\p -&gt; do\n    yield (B.singleton tab)\n    PB.dropWhile (== tab) p\n</code></pre>\n\n<p>However, I still don't know how to replace all occurrences of consecutive tabs.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 3577498, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NXy7r.jpg?s=128&g=1", "display_name": "dos", "link": "https://stackoverflow.com/users/3577498/dos"}, "edited": false, "score": 0, "creation_date": 1440215873, "post_id": 32152070, "comment_id": 52193219, "body": "Thanks! <code>enumFrom x = map toEnum [fromEnum x .. 17]</code> Is this good style?"}], "tags": [], "owner": {"reputation": 136287, "user_id": 65696, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/d8da959b2a586b4a147604e6f534a9fe?s=128&d=identicon&r=PG", "display_name": "SingleNegationElimination", "link": "https://stackoverflow.com/users/65696/singlenegationelimination"}, "is_accepted": false, "score": 6, "last_activity_date": 1440215202, "creation_date": 1440215202, "answer_id": 32152070, "question_id": 32151954, "link": "https://stackoverflow.com/questions/32151954/haskell-toenum-on-data-type-throws-range-exception/32152070#32152070", "title": "Haskell toEnum on data type throws range exception", "body": "<p><code>[x ..]</code> is desugared into <code>enumFrom x</code> method, for which the <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/src/GHC.Enum.html#enumFrom\">prelude provides the following default implementation</a>:</p>\n\n<pre><code>enumFrom x = map toEnum [fromEnum x ..]\n</code></pre>\n\n<p>Override it to do the right thing by your instance.  You'll also likely want to override <code>enumFromThen</code> for similar reasons.  </p>\n"}, {"tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 10, "last_activity_date": 1440226444, "last_edit_date": 1440226444, "creation_date": 1440215460, "answer_id": 32152098, "question_id": 32151954, "link": "https://stackoverflow.com/questions/32151954/haskell-toenum-on-data-type-throws-range-exception/32152098#32152098", "title": "Haskell toEnum on data type throws range exception", "body": "<p>Your problem is that <code>Pitch</code> is implicitly <em>bounded</em> \u2013 i.e., it has a least and greatest element \u2013 but you don't reflect that boundedness in your code.  The code</p>\n\n<pre><code>[Pitch O1 A ..]\n</code></pre>\n\n<p>desugars to </p>\n\n<pre><code>enumFrom (Pitch O1 A)\n</code></pre>\n\n<p>which keeps <code>succ</code>ing the generated values until it <code>succ</code>s <code>Pitch O3 F</code> and blows up.  How could it know that it should stop there?</p>\n\n<p><a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#t:Enum\">From the Prelude documentation</a>:</p>\n\n<blockquote>\n  <p>For any type that is an instance of class <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#t:Bounded\"><code>Bounded</code></a> as well as <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#t:Enum\"><code>Enum</code></a>, the following should hold:</p>\n  \n  <p>\u2026</p>\n  \n  <ul>\n  <li><p><a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:enumFrom\"><code>enumFrom</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#v:enumFromThen\"><code>enumFromThen</code></a> should be defined with\n  an implicit bound, thus:</p>\n\n<pre><code>enumFrom     x   = enumFromTo     x maxBound\nenumFromThen x y = enumFromThenTo x y bound\n  where\n    bound | fromEnum y &gt;= fromEnum x = maxBound\n          | otherwise                = minBound\n</code></pre></li>\n  </ul>\n</blockquote>\n\n<p>Thus, to fix this problem, just add</p>\n\n<pre><code>instance Bounded Pitch where\n  minBound = Pitch minBound minBound\n  maxBound = Pitch maxBound maxBound\n</code></pre>\n\n<p>and then add the code from the documentation:</p>\n\n<pre><code>instance Enum Pitch where\n  -- ...\n  enumFrom     x   = enumFromTo     x maxBound\n  enumFromThen x y = enumFromThenTo x y bound\n    where\n      bound | fromEnum y &gt;= fromEnum x = maxBound\n            | otherwise                = minBound\n</code></pre>\n\n<p>and now [Pitch O1 A ..] will stop at the end:</p>\n\n<pre><code>\u03bb&gt; [Pitch O1 A ..]\n[Pitch O1 A,Pitch O1 B,Pitch O1 C,Pitch O1 D,Pitch O1 E,Pitch O1 F,Pitch O2 A,Pitch O2 B,Pitch O2 C,Pitch O2 D,Pitch O2 E,Pitch O2 F,Pitch O3 A,Pitch O3 B,Pitch O3 C,Pitch O3 D,Pitch O3 E,Pitch O3 F]\n</code></pre>\n\n<hr>\n\n<p>Side note: you can replace separate calls to <code>div</code> and <code>mod</code> with pattern-matching on a single call to <code>divMod</code>: <code>x `divMod` y == (x `div` y, x `mod` y)</code>.  (For strictly positive numbers, like these, I believe I've heard that <code>quotRem</code> may be a better choice; <code>quot</code> and <code>rem</code> are like <code>div</code> and <code>mod</code>, but with different sign-related behaviors.)  Additionally, you could replace your <code>6</code>s with <code>1 + (fromEnum (maxBound :: Note))</code> to avoid accidentally getting the number wrong.</p>\n"}], "owner": {"reputation": 125, "user_id": 3577498, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NXy7r.jpg?s=128&g=1", "display_name": "dos", "link": "https://stackoverflow.com/users/3577498/dos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 754, "favorite_count": 0, "accepted_answer_id": 32152098, "answer_count": 2, "score": 8, "last_activity_date": 1586700429, "creation_date": 1440213918, "last_edit_date": 1586700429, "question_id": 32151954, "link": "https://stackoverflow.com/questions/32151954/haskell-toenum-on-data-type-throws-range-exception", "title": "Haskell toEnum on data type throws range exception", "body": "<p>I am trying to write an instance of Enum for the following type:</p>\n\n<pre><code>-- Type declarations:\n\n-- Octave\ndata Octave =\n    O1 | O2 | O3\n    deriving (Show, Read, Eq, Ord, Bounded, Enum)\n\n-- Note\ndata Note = \n    A | B | C | D | E | F\n    deriving (Show, Read, Eq, Ord, Bounded, Enum)\n\n-- Pitch\ndata Pitch = Pitch Octave Note\n    deriving (Show, Eq, Ord)\n\n-- Why doesn't this work?\ninstance Enum Pitch where\n    fromEnum (Pitch o n) = (fromEnum o)*6 + (fromEnum n)\n    toEnum x = (Pitch o n)\n        where \n            o = toEnum (x `div` 6)\n            n = toEnum (x `mod` 6)\n</code></pre>\n\n<p>This works fine for:</p>\n\n<pre><code>[(Pitch O1 A) .. (Pitch O3 F)]\n</code></pre>\n\n<p>But fails for:</p>\n\n<pre><code>[(Pitch O1 A) .. ]\n</code></pre>\n\n<p>With the error:</p>\n\n<pre><code>*** Exception: toEnum{Octave}: tag (3) is outside of enumeration's range (0,2)\n</code></pre>\n\n<p>I understand the error. \nMy questions are: \nHow to correctly write the Enum instance to perform this enumeration?\nIs it possible?\nMost of all: Is it good practice?</p>\n"}, {"tags": ["haskell", "let"], "comments": [{"owner": {"reputation": 136287, "user_id": 65696, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/d8da959b2a586b4a147604e6f534a9fe?s=128&d=identicon&r=PG", "display_name": "SingleNegationElimination", "link": "https://stackoverflow.com/users/65696/singlenegationelimination"}, "edited": false, "score": 0, "creation_date": 1440212798, "post_id": 32151817, "comment_id": 52192749, "body": "what error message does it give you?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4933255"}, "reply_to_user": {"reputation": 136287, "user_id": 65696, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/d8da959b2a586b4a147604e6f534a9fe?s=128&d=identicon&r=PG", "display_name": "SingleNegationElimination", "link": "https://stackoverflow.com/users/65696/singlenegationelimination"}, "edited": false, "score": 0, "creation_date": 1440212959, "post_id": 32151817, "comment_id": 52192777, "body": "No instance for (Num (IO t0)) arising from a use of \u2018-\u2019     In the expression: sumSquares - squaredSum     In the expression:       let         sumSquares = sum (map (^ 2) [1 .. 100])         squaredSum = sum [1 .. 100] ^ 2       in sumSquares - squaredSum     In an equation for \u2018main\u2019:         main           = let               sumSquares = sum (map (^ 2) ...)               squaredSum = sum ... ^ 2             in sumSquares - squaredSum Failed, modules loaded: none."}, {"owner": {"reputation": 136287, "user_id": 65696, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/d8da959b2a586b4a147604e6f534a9fe?s=128&d=identicon&r=PG", "display_name": "SingleNegationElimination", "link": "https://stackoverflow.com/users/65696/singlenegationelimination"}, "edited": false, "score": 0, "creation_date": 1440213341, "post_id": 32151817, "comment_id": 52192842, "body": "When adding information to your question, you should edit the question, not add comments."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1440258700, "post_id": 32151893, "comment_id": 52203896, "body": "Minor nit: the type of <code>main</code> has to unify with <code>IO a</code>, and need not specifically be <code>IO ()</code>. Otherwise the answer is spot on."}], "tags": [], "owner": {"reputation": 136287, "user_id": 65696, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/d8da959b2a586b4a147604e6f534a9fe?s=128&d=identicon&r=PG", "display_name": "SingleNegationElimination", "link": "https://stackoverflow.com/users/65696/singlenegationelimination"}, "is_accepted": true, "score": 3, "last_activity_date": 1440213278, "creation_date": 1440213278, "answer_id": 32151893, "question_id": 32151817, "link": "https://stackoverflow.com/questions/32151817/nested-let-syntax-in-haskell-confusion/32151893#32151893", "title": "Nested Let syntax in haskell confusion", "body": "<p>You have chosen to name this term <code>main</code>, without giving it the correct type.  A Haskell module with a <code>main</code> term is expected to define it with type <code>IO ()</code>, but you have given it an expression that looks something like <code>Num a =&gt; a</code>, by virtue of the <code>-</code>  This error happens because Haskell is looking for some sort of way to make <code>IO ..</code> an instance of <code>Num</code>, which it isn't.</p>\n\n<p>Try naming it something else.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4933255"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 32151893, "answer_count": 1, "score": 0, "last_activity_date": 1440213278, "creation_date": 1440212295, "question_id": 32151817, "link": "https://stackoverflow.com/questions/32151817/nested-let-syntax-in-haskell-confusion", "title": "Nested Let syntax in haskell confusion", "body": "<pre><code>main = let sumSquares = sum (map (^2) [1..100]) \n           squaredSum = sum [1..100] ^ 2 \n           in sumSquares - squaredSum\n</code></pre>\n\n<p>New to Haskell, so I've been going back through Project Euler. I know my solution is sound, and it works when I don't bother with any lets.</p>\n\n<p>For some reason, this gives me an error message. Can you help? Thank you!</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440291039, "post_id": 32151623, "comment_id": 52211945, "body": "You might try the <a href=\"https://github.com/feuerbach/standalone-haddock\" rel=\"nofollow noreferrer\">standalone-haddock</a> app."}, {"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440304675, "post_id": 32151623, "comment_id": 52213765, "body": "It doesn&#39;t look like what I want; I&#39;m fine with the relative links, and it doesn&#39;t seem to offer anything else beyond straight-up <code>haddock</code>?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440314683, "post_id": 32151623, "comment_id": 52215604, "body": "I think it just shells out to your <code>haddock</code> executable. If it doesn&#39;t invoke it with the correct options, try creating a wrapper script to add the options you need."}, {"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440360773, "post_id": 32151623, "comment_id": 52228532, "body": "I don&#39;t know what options to pass <code>haddock</code>. I&#39;m relying on <code>stack</code> (and in the past, <code>cabal</code>) to invoke it."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440367231, "post_id": 32151623, "comment_id": 52230278, "body": "See my answer for details on how to create a wrapper script which always adds <code>--hyperlinked-source</code> to the haddock command line. If you create the wrapper the <code>stack haddock</code> command will probably create the hyperlinked source."}], "answers": [{"comments": [{"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1440381387, "post_id": 32171838, "comment_id": 52233187, "body": "Considering that it answered my question, I felt like it was worth posting as an answer."}], "tags": [], "owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "is_accepted": false, "score": 2, "last_activity_date": 1440366167, "creation_date": 1440366167, "answer_id": 32171838, "question_id": 32151623, "link": "https://stackoverflow.com/questions/32151623/how-to-add-documentation-after-packages-have-already-been-installed/32171838#32171838", "title": "How to add documentation after packages have already been installed?", "body": "<p>It seems that the obvious <code>stack haddock package</code> will install haddock for the package, so </p>\n\n<pre><code>$ cd ~/.stack/snapshots/x86_64-linux/lts-3.0/7.10.2/doc\n$ stack haddock *\n</code></pre>\n\n<p>seems to do what I want, with two downsides:</p>\n\n<ol>\n<li>I'll still need to remember to pass the <code>--haddock</code> flag to every <code>build</code> (there isn't a <code>~/.stack/config</code> file, is there?)</li>\n<li>It seems to rebuild them; is there a way to avoid that?</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "edited": false, "score": 0, "creation_date": 1440381684, "post_id": 32171973, "comment_id": 52233262, "body": "This barely addresses the question at all. For example, one problem with this approach (I tried something similar) is that <code>stack</code> doesn&#39;t use the <code>haddock</code> that&#39;s on the <code>PATH</code>; another is that I want docs for packages already installed."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1440367127, "creation_date": 1440367127, "answer_id": 32171973, "question_id": 32151623, "link": "https://stackoverflow.com/questions/32151623/how-to-add-documentation-after-packages-have-already-been-installed/32171973#32171973", "title": "How to add documentation after packages have already been installed?", "body": "<p>Step 1. Download and build the newest haddock. The build instructions are\nin <code>README.md</code>. </p>\n\n<pre><code>git clone https://github.com/haskell/haddock.git\ncd haddock\n\ncabal sandbox init\ncabal sandbox add-source haddock-library\ncabal sandbox add-source haddock-api\ncabal install --dependencies-only\ncabal build\n</code></pre>\n\n<p>Then install the new haddock as <code>haddock.real</code></p>\n\n<pre><code>cp dist/build/haddock/haddock /some/bin/dir/haddock.real\n</code></pre>\n\n<p>Step 2. Create a wrapper script named <code>haddock</code>:</p>\n\n<pre><code>#!/bin/sh\n\n/some/bin/dir/haddock.real --hyperlinked-source \"$@\"\n</code></pre>\n\n<p>Don't forget to make it executable and put it in your path.</p>\n\n<p>Step 3. Download and build <code>standalone-haddock</code>:</p>\n\n<pre><code>mkdir build-standalone-haddock\ngit clone https://github.com/feuerbach/standalone-haddock.git\ncd standalone-haddock\ncabal build\ncp dist/build/standalone-haddock/standalone-haddock /some/bin/dir/\n</code></pre>\n\n<p>An example of how to use <code>standalone-haddock</code>:</p>\n\n<pre><code>mkdir temp\ncd temp\ncabal get heredoc-0.2.0.0\nstandalone-haddock -o doc heredoc-0.2.0.0\n</code></pre>\n\n<p>Then open <code>doc/heredoc/index.html</code> in your browser.</p>\n\n<p>When you navigate to a type definition you should see a <code>Source</code> link on the right and that will bring you to the new hyperlinked source.</p>\n"}], "owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1440381434, "creation_date": 1440209973, "last_edit_date": 1440381434, "question_id": 32151623, "link": "https://stackoverflow.com/questions/32151623/how-to-add-documentation-after-packages-have-already-been-installed", "title": "How to add documentation after packages have already been installed?", "body": "<p>I have installed a bunch of packages to the snapshot database. I would now like a local copy of their documentation (even better if it's with <a href=\"https://www.reddit.com/r/haskell/comments/3ecest/haddock2161_released_with_source_code/\" rel=\"nofollow\">hyperlinked source</a>). Is there a way I can tell <code>stack</code> to run <code>haddock</code> on all of them?</p>\n\n<p>EDIT (copied from my answer):</p>\n\n<p>It seems that the obvious <code>stack haddock package</code> will install haddock for the package, so </p>\n\n<pre><code>$ cd ~/.stack/snapshots/x86_64-linux/lts-3.0/7.10.2/doc\n$ stack haddock *\n</code></pre>\n\n<p>seems to do what I want, with two downsides:</p>\n\n<ol>\n<li>I'll still need to remember to pass the <code>--haddock</code> flag to every <code>build</code> (there isn't a <code>~/.stack/config</code> file, is there?)</li>\n<li>It seems to rebuild them; is there a way to avoid that?</li>\n</ol>\n"}, {"tags": ["rest", "haskell"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1440205767, "post_id": 32151151, "comment_id": 52191613, "body": "Code. Show us your code."}, {"owner": {"reputation": 354, "user_id": 1327871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b962c154cf0fd4c104e4419d26db0272?s=128&d=identicon&r=PG&f=1", "display_name": "devgeek", "link": "https://stackoverflow.com/users/1327871/devgeek"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1440207479, "post_id": 32151151, "comment_id": 52191879, "body": "Added the code. I should be handling fromJust better and I could probably break it up into some smaller functions, but for now I&#39;m just trying to get the mechanics of pagination."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440252459, "post_id": 32151151, "comment_id": 52202156, "body": "Consider using the default <code>fromJSON</code> instance. Just make your type derive <code>Generic</code> (from <code>GHC.Generics</code>) and then write <code>instance FromJSON Post</code>."}], "answers": [{"tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 1, "last_activity_date": 1440241197, "last_edit_date": 1495541175, "creation_date": 1440241197, "answer_id": 32155357, "question_id": 32151151, "link": "https://stackoverflow.com/questions/32151151/haskell-api-client-pagination/32155357#32155357", "title": "Haskell API client pagination", "body": "<p>I would suggest you need a continuation monad. Within the continuation you can have the logic to assemble a page, yield it to the caller of the continuation, and then repeat. When you call your \"get_pages\" function you will get back the first page and a new function that takes your new parameters.</p>\n\n<p>It sounds like you need <a href=\"https://stackoverflow.com/questions/31358856/continuation-monad-for-a-yield-await-function-in-haskell\">this answer</a>, which shows how to create such a monad. Make it a monad transformer if you need any other monadic state inside your function.</p>\n"}, {"tags": [], "owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "is_accepted": true, "score": 4, "last_activity_date": 1440252914, "creation_date": 1440252914, "answer_id": 32157095, "question_id": 32151151, "link": "https://stackoverflow.com/questions/32151151/haskell-api-client-pagination/32157095#32157095", "title": "Haskell API client pagination", "body": "<p>Your approach is certainly appealing due to it's simplicity, however it has the disadvantage, that the list of <code>Post</code>s will only be available after the whole pagination chain has ended.</p>\n\n<p>I would suggest to use a streaming library like <code>Pipe</code>, <code>Conduit</code> and friends.  The advantage is that you can stream the results and also limit the number of posts to retrieve, by using functions provided by the respective streaming library.  Here is an example with <code>Pipe</code>, I added the necessary imports and added <code>postsP</code>:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport Data.Aeson\nimport Data.Text (Text)\nimport qualified Data.Text as T\nimport Network.Wreq\nimport Data.Maybe\nimport Control.Lens\nimport Control.Monad.IO.Class\nimport qualified Pipes as P\nimport Data.Foldable (for_)\n\ndata Post = Post {\n          title  :: !Text,\n          domain :: !Text,\n          score  :: Int,\n          url    :: !Text\n} deriving (Show)\n\ninstance FromJSON Post where\n  parseJSON (Object v) = do\n    objectData &lt;- v .: \"data\"\n    title  &lt;- objectData .: \"title\"\n    domain &lt;- objectData .: \"domain\"\n    score  &lt;- objectData .: \"score\"\n    url    &lt;- objectData .: \"url\"\n    return $ Post title domain score url\n\ndata GetPostsResult = GetPostsResult {\n  posts :: [Post],\n  after :: Maybe Text\n} deriving (Show)\n\ninstance FromJSON GetPostsResult where\n  parseJSON (Object v) = do\n    rootData   &lt;- v        .:  \"data\"\n    posts      &lt;- rootData .:  \"children\"\n    afterCode &lt;- rootData .:? \"after\"\n    return $ GetPostsResult posts afterCode\n\nfetchPage:: Text -&gt; IO (Maybe ([Post],Maybe Text))\nfetchPage afterCode = do\n  let url = \"https://www.reddit.com/r/videos/top/.json?sort=top&amp;t=day&amp;after=\" ++ T.unpack afterCode\n  b &lt;- get url\n  let jsonBody = b ^. responseBody\n  let postResponse = decode jsonBody :: Maybe GetPostsResult\n  let pagePosts = posts &lt;$&gt;  postResponse\n  let nextAfterCode = after $ fromJust postResponse\n  if isNothing pagePosts then return Nothing else return (Just (fromJust pagePosts,nextAfterCode))\n\ngetPosts :: Text -&gt; [Post] -&gt; IO [Post]\ngetPosts x y = do\n  p &lt;- liftIO $ fetchPage x\n  let posts = fst (fromJust p)\n  let afterParam =  snd (fromJust p)\n  case afterParam of\n    Nothing -&gt;  return []\n    Just aff -&gt; getPosts aff (posts ++ y)\n\npostsP :: Text -&gt; P.Producer Post IO ()\npostsP x = do\n  p &lt;- liftIO (fetchPage x)\n  for_ p $ \\(posts,afterParam) -&gt; do\n    P.each posts\n    for_ afterParam postsP\n\nmain = P.runEffect $ P.for (postsP \"\") (liftIO . print)\n</code></pre>\n"}], "owner": {"reputation": 354, "user_id": 1327871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b962c154cf0fd4c104e4419d26db0272?s=128&d=identicon&r=PG&f=1", "display_name": "devgeek", "link": "https://stackoverflow.com/users/1327871/devgeek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 441, "favorite_count": 1, "accepted_answer_id": 32157095, "answer_count": 2, "score": 1, "last_activity_date": 1440252914, "creation_date": 1440204099, "last_edit_date": 1440229887, "question_id": 32151151, "link": "https://stackoverflow.com/questions/32151151/haskell-api-client-pagination", "title": "Haskell API client pagination", "body": "<p>I'm trying to build a Haskell client to consume a RESTful JSON API. I want to fetch a page, then take the \"next_page\" key from the response, and feed it into the query params of another api request. I want to continue doing this until I have paged through all the items. What is the cleanest way of doing this in Haskell? I'm using explicit recursion now, but I feel there must be a better way, maybe with the writer or state monad.</p>\n\n<p>EDIT: Added my code. I'm aware I'm misusing fromJust.</p>\n\n<pre><code>data Post = Post {\n          title  :: !Text,\n          domain :: !Text,\n          score  :: Int,\n          url    :: !Text\n} deriving (Show)\n\ninstance FromJSON Post where\n  parseJSON (Object v) = do\n    objectData &lt;- v .: \"data\"\n    title  &lt;- objectData .: \"title\"\n    domain &lt;- objectData .: \"domain\"\n    score  &lt;- objectData .: \"score\"\n    url    &lt;- objectData .: \"url\"\n    return $ Post title domain score url\n\ndata GetPostsResult = GetPostsResult {\n  posts :: [Post],\n  after :: Maybe Text\n} deriving (Show)\n\ninstance FromJSON GetPostsResult where\n  parseJSON (Object v) = do\n    rootData   &lt;- v        .:  \"data\"\n    posts      &lt;- rootData .:  \"children\"\n    afterCode &lt;- rootData .:? \"after\"\n    return $ GetPostsResult posts afterCode\n\nfetchPage:: Text -&gt; IO (Maybe ([Post],Maybe Text))\nfetchPage afterCode = do\n  let url = \"https://www.reddit.com/r/videos/top/.json?sort=top&amp;t=day&amp;after=\" ++ unpack afterCode\n  b &lt;- get url\n  let jsonBody = b ^. responseBody\n  let postResponse = decode jsonBody :: Maybe GetPostsResult\n  let pagePosts = posts &lt;$&gt;  postResponse\n  let nextAfterCode = after $ fromJust postResponse\n  if isNothing pagePosts then return Nothing else return (Just (fromJust pagePosts,nextAfterCode))\n\ngetPosts :: Text -&gt; [Post] -&gt; IO [Post]\ngetPosts x y = do\n  p &lt;- liftIO $ fetchPage x\n  let posts = fst (fromJust p)\n  let afterParam =  snd (fromJust p)\n  case afterParam of\n    Nothing -&gt;  return []\n    Just aff -&gt; getPosts aff (posts ++ y)\n\nmain = do\n  a &lt;- getPosts \"\" []\n  print a\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1440204018, "post_id": 32151038, "comment_id": 52191294, "body": "\u201cBoth cases are isomorphic to lists\u201d \u2013 not they aren&#39;t. They clearly don&#39;t support any list length, or indeed different lengths at all."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440205538, "post_id": 32151180, "comment_id": 52191567, "body": "I wasn&#39;t aware of that possibility - that is starting to make more and more sense and Pixel works fine now. Yet, you basically said that tuples should work, although my definition didn&#39;t compile. Am I missing something? I&#39;ve updated the original post with the whole def."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440259007, "post_id": 32151180, "comment_id": 52203984, "body": "@Viclib Turn <code>Tuple2</code> into a newtype."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1440298018, "post_id": 32151180, "comment_id": 52212900, "body": "@Viclib Just had another thought: you could write <code>instance ListIsomorphic  ((,) a) where type Elem ((,) a) b = a ~ b</code>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1440204346, "creation_date": 1440204346, "answer_id": 32151180, "question_id": 32151038, "link": "https://stackoverflow.com/questions/32151038/how-to-create-listisomorphic-instances-for-tuples-and-packed-types/32151180#32151180", "title": "How to create ListIsomorphic instances for tuples and packed types?", "body": "<p>The constraint family</p>\n\n<pre><code>type Elem l a :: Constraint\ntype Elem l a = ()\n</code></pre>\n\n<p>allows you to restrict the types that may be contained in those containers. In the case of <code>Tuple2</code>, or lists themselves, this isn't necessary at all, because these can contain <em>any</em> type of element.\n<br>\nIn the case e.g. of <code>Storable</code> vectors, you need primitive types that can actually be stored in a C array.\n<br>\nIn the case of <code>Pixel</code>, you can only store one single type, namely <code>Word32</code>. That means you need an <em>equational constraint</em>:</p>\n\n<pre><code>instance ListIsomorphic Pixel where\n    type Elem Pixel a = a~Word32\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 32151180, "answer_count": 1, "score": 1, "last_activity_date": 1440205345, "creation_date": 1440202907, "last_edit_date": 1440205345, "question_id": 32151038, "link": "https://stackoverflow.com/questions/32151038/how-to-create-listisomorphic-instances-for-tuples-and-packed-types", "title": "How to create ListIsomorphic instances for tuples and packed types?", "body": "<p>Sorry, this is yet another topic in the same serie. I have a typeclass for things that are isomorphic to lists: </p>\n\n<pre><code>class ListIsomorphic l where\n    type Elem l a :: Constraint\n    type Elem l a = ()\n\n    toList    :: l a -&gt; [a]\n    fromList  :: [a] -&gt; l a\n</code></pre>\n\n<p>There are two cases for which I'm not managing to create an instance; singly-typed tuples and types that pack multiple elements in a single value. </p>\n\n<pre><code>type Tuple2 a   = (a,a)\nnewtype Pixel a = Pixel a\n</code></pre>\n\n<p>On this case, Pixel usually holds a <code>Word32</code> with 4 elements that are extracted with bitwise operations:</p>\n\n<pre><code>red (Pixel pixel)   = pixel .&amp;. 0x000000FF\ngreen (Pixel pixel) = shiftR (pixel .&amp;. 0x0000FF00) 8\nblue (Pixel pixel)  = shiftR (pixel .&amp;. 0x00FF0000) 16\nalpha (Pixel pixel) = shiftR (pixel .&amp;. 0xFF000000) 24\n</code></pre>\n\n<p>While both cases aren't isomorphic to lists (they are fixed length), having an instance would be useful, yet I'm not sure how to justify this to the type system. Writing an instance for tuples:</p>\n\n<pre><code>type Tuple2 a = (a,a)\ninstance ListIsomorphic Tuple2 where\n    fromList [a,b] = (a,b)\n    toList   (a,b) = [a,b]\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>Type synonym \u2018Tuple2\u2019 should have 1 argument, but has been given none\n</code></pre>\n\n<p>Writing an instance for Pixel:</p>\n\n<pre><code>instance ListIsomorphic Pixel where\n    type Elem Pixel_ a = Word32\n    fromList [r,g,b,a] = rgba r g b a\n    toList pixel       = [red pixel, green pixel, blue pixel, alpha pixel]\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>Expected a constraint, but \u2018Word32\u2019 has kind \u2018*\u2019\n</code></pre>\n\n<p>Of course, I didn't expect that to work, but that is to say I have no idea how to write it.</p>\n"}, {"tags": ["regex", "haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440199119, "post_id": 32149354, "comment_id": 52190345, "body": "Since you know it doesn&#39;t make sense to attempt to parse XML with regular expressions, why are you doing it? By the way, the prettiest Haskell API for parsing regular languages is <code>regex-applicative</code>."}, {"owner": {"reputation": 810, "user_id": 370611, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b5d487d6cd2acd4046500efbf7021139?s=128&d=identicon&r=PG", "display_name": "JohnL4", "link": "https://stackoverflow.com/users/370611/johnl4"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440253214, "post_id": 32149354, "comment_id": 52202326, "body": "I&#39;m hacking, is why. Thanks for the pointer to regex-applicative. Bear in mind: Haskell noob. This is a Perl script written in Haskell. I&#39;m sure applicative stuff is wonderful, but I&#39;m not there yet."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440258512, "post_id": 32149354, "comment_id": 52203833, "body": "Great things about applicative and monadic parsing libraries: they&#39;re easy to learn, and once you&#39;ve learned one they all look familiar. One of the most popular and easiest to use is <code>attoparsec</code>."}], "answers": [{"comments": [{"owner": {"reputation": 810, "user_id": 370611, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b5d487d6cd2acd4046500efbf7021139?s=128&d=identicon&r=PG", "display_name": "JohnL4", "link": "https://stackoverflow.com/users/370611/johnl4"}, "edited": false, "score": 0, "creation_date": 1440252726, "post_id": 32150031, "comment_id": 52202212, "body": "Beautiful, many thanks. It works like a champ (but you already knew that :) )."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1440195847, "last_edit_date": 1440195847, "creation_date": 1440195422, "answer_id": 32150031, "question_id": 32149354, "link": "https://stackoverflow.com/questions/32149354/how-do-i-control-compoption-multiline-in-a-regex-tdfa-regular-expression-has/32150031#32150031", "title": "How do I control CompOption &quot;multiline&quot; in a regex-tdfa regular expression? (Haskell)", "body": "<p>The definition of a compilation options for <code>regex-tdfa</code> may be found here:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/regex-tdfa-1.2.0/docs/src/Text-Regex-TDFA-Common.html#CompOption\" rel=\"nofollow\">https://hackage.haskell.org/package/regex-tdfa-1.2.0/docs/src/Text-Regex-TDFA-Common.html#CompOption</a></p>\n\n<p>The documentation says that <code>multiLine</code> is set to <code>True</code> by default.</p>\n\n<p>Here is a way to compile and execute regular expressions with custom options:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nimport Text.Regex.TDFA\n\ntoRegex = makeRegexOpts defaultCompOpt{multiline=False} defaultExecOpt\n\ntest str =\n  if match (toRegex \"&lt;Tag&gt;.*&lt;/Tag&gt;\") str\n    then putStrLn \"matches\"\n    else putStrLn \"does not match\"\n\ntest2 fileContents =\n    match (toRegex \"&lt;Tag&gt;.*&lt;/Tag&gt;\") fileContents :: (String, String, String)\n</code></pre>\n\n<p>Note that <code>match</code> is polymorphic just like <code>=~</code> is.</p>\n\n<p>You can find code which uses custom regex options in the hledger-lib package:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/hledger-lib-0.26/docs/src/Hledger-Utils-Regex.html#Regexp\" rel=\"nofollow\">https://hackage.haskell.org/package/hledger-lib-0.26/docs/src/Hledger-Utils-Regex.html#Regexp</a></p>\n"}], "owner": {"reputation": 810, "user_id": 370611, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b5d487d6cd2acd4046500efbf7021139?s=128&d=identicon&r=PG", "display_name": "JohnL4", "link": "https://stackoverflow.com/users/370611/johnl4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 32150031, "answer_count": 1, "score": 3, "last_activity_date": 1440195847, "creation_date": 1440191760, "last_edit_date": 1440192395, "question_id": 32149354, "link": "https://stackoverflow.com/questions/32149354/how-do-i-control-compoption-multiline-in-a-regex-tdfa-regular-expression-has", "title": "How do I control CompOption &quot;multiline&quot; in a regex-tdfa regular expression? (Haskell)", "body": "<p>Haskell noob here. I'm using regex-tdfa (for no particular reason) to (attempt to) match multiline chunks of code files (XAML, and, yes, I know about regexes and parsing XML and the the-ponies-they-come post).</p>\n\n<p>If I use a simple regex in code like</p>\n\n<pre><code>fileContents =~ \"&lt;UserControl.Resources&gt;\"\n</code></pre>\n\n<p>I get hits in my files. Yay.</p>\n\n<p>If I \"upgrade\" the regex to something like \"&lt;UserControl.Resources&gt;.*&lt;/UserControl.Resources&gt;\", then I get no hits. So, I'm thinking my problem is multiline regexes and convincing the engine to match across multiple lines.</p>\n\n<p>The thing is, I'm such a rank noob I have no idea how to do that. All I know is what I've learned from <em>Real World Haskell</em> and <em>Learn You a Haskell</em>, and those don't talk about regex compilation options.</p>\n\n<p>So, I can force results like</p>\n\n<pre><code>fileContents =~ \"&lt;UserControl.Resources&gt;\" :: (String, String, String)\n</code></pre>\n\n<p>But that's all I know.  </p>\n\n<p>How do I turn multiline OFF? (I think it's ON, for some reason.)</p>\n"}, {"tags": ["function", "haskell", "recursion", "arguments", "operator-precedence"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1440189812, "post_id": 32148859, "comment_id": 52187352, "body": "Look up <i>currying</i>: in most functional programming language there is no such a thing as a function taking more than one argument. A &quot;binary function&quot; is a technically incorrect term for a function taking <i>one</i> argument (the &quot;first&quot; one) and returning a function. This returned function takes <i>one</i> argument (the &quot;second&quot; one), and finally returns the result. E.g. <code>(++) [1,2]</code> is a function that can be applied to <code>[4,5]</code> to produce <code>[1,2,4,5]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "is_accepted": false, "score": 2, "last_activity_date": 1440197847, "last_edit_date": 1440197847, "creation_date": 1440190054, "answer_id": 32149029, "question_id": 32148859, "link": "https://stackoverflow.com/questions/32148859/haskell-arrow-precedence-with-function-arguments/32149029#32149029", "title": "Haskell: arrow precedence with function arguments", "body": "<h3>You are confused about how <em><a href=\"https://en.wikipedia.org/wiki/Currying\" rel=\"nofollow\">Function Currying</a></em> works.</h3>\n\n<p>Consider the following function definitions of <code>(++)</code>.</p>\n\n<p><strong>Takes two arguments, produces one list:</strong></p>\n\n<pre><code>(++) :: [a] -&gt; [a] -&gt; [a]\n[]     ++ ys = ys\n(x:xs) ++ ys = x : (xs ++ ys)\n</code></pre>\n\n<p><strong>Takes one argument, produces a function taking one list and producing a list:</strong></p>\n\n<pre><code>(++) :: [a] -&gt; ([a] -&gt; [a])\n(++) []     = id\n(++) (x:xs) = (x :) . (xs ++)\n</code></pre>\n\n<p>If you look closely, these functions will always produce the same output. By removing the second parameter, we have changed the return type from <code>[a]</code> to <code>[a] -&gt; [a]</code>. </p>\n\n<ul>\n<li>If we supply two parameters to <code>(++)</code> we get a result of type <code>[a]</code></li>\n<li>If we supply only one parameter we get a result of type <code>[a] -&gt; [a]</code></li>\n</ul>\n\n<p>This is called function currying. We don't need to provide all the arguments to a function with multiple arguments. If we supply fewer then the total number of arguments, instead of getting a \"concrete\" result (<code>[a]</code>) we get a function as a result which can take the remaining parameters (<code>[a] -&gt; [a]</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 455, "user_id": 3140914, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gFHmn.png?s=128&g=1", "display_name": "D.Naesuko", "link": "https://stackoverflow.com/users/3140914/d-naesuko"}, "edited": false, "score": 0, "creation_date": 1440195437, "post_id": 32149058, "comment_id": 52189311, "body": "Alright, so I can think of functions being <i>aliases</i> for lambda functions. Arguments aren&#39;t passed but sort of <i>filled/replaced</i> as per : <code>add = \\x y -&gt; x + y</code>, <code>add 3 4</code> &lt;=&gt; <code>(\\x y -&gt; x + y) 3 4</code>"}, {"owner": {"reputation": 455, "user_id": 3140914, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gFHmn.png?s=128&g=1", "display_name": "D.Naesuko", "link": "https://stackoverflow.com/users/3140914/d-naesuko"}, "edited": false, "score": 0, "creation_date": 1440199111, "post_id": 32149058, "comment_id": 52190342, "body": "Yet, I read that the point-free style is the most preferred one. Is there any way to write your last <code>func =</code> line with high-order functions ?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 455, "user_id": 3140914, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gFHmn.png?s=128&g=1", "display_name": "D.Naesuko", "link": "https://stackoverflow.com/users/3140914/d-naesuko"}, "edited": false, "score": 2, "creation_date": 1440211653, "post_id": 32149058, "comment_id": 52192583, "body": "@D.Naesuko Point-free style is only preferred when it looks clearer. That is only some times the case when you remove <i>one</i> function argument, and <i>rarely</i> the case when you remove more than one."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 4, "last_activity_date": 1440193596, "last_edit_date": 1440193596, "creation_date": 1440190236, "answer_id": 32149058, "question_id": 32148859, "link": "https://stackoverflow.com/questions/32148859/haskell-arrow-precedence-with-function-arguments/32149058#32149058", "title": "Haskell: arrow precedence with function arguments", "body": "<p>The trick to understanding this is that all haskell functions only take 1 argument at most, it's just that the implicit parentheses in the type signature and syntax sugar make it appear as if there are more arguments.  To use <code>++</code> as an example, the following transformations are all equivalent</p>\n\n<pre><code>xs ++ ys = ...\n(++) xs ys = ...\n(++) xs = \\ys -&gt; ...\n(++) = \\xs -&gt; (\\ys -&gt; ...)\n(++) = \\xs ys -&gt; ...\n</code></pre>\n\n<p>Another quick example:</p>\n\n<pre><code>doubleList :: [Int] -&gt; [Int]\ndoubleList = map (*2)\n</code></pre>\n\n<p>Here we have a function of one argument <code>doubleList</code> without any explicit arguments.  It would have been equivalent to write</p>\n\n<pre><code>doubleList x = map (*2) x\n</code></pre>\n\n<p>Or any of the following</p>\n\n<pre><code>doubleList = \\x -&gt; map (*2) x\ndoubleList = \\x -&gt; map (\\y -&gt; y * 2) x\ndoubleList x = map (\\y -&gt; y * 2) x\ndoubleList = map (\\y -&gt; y * 2)\n</code></pre>\n\n<p>The first definition of <code>doubleList</code> is written in what is commonly called point-free notation, so called because in the mathematical theory backing it the arguments are referred to as \"points\", so point-free is \"without arguments\".</p>\n\n<p>A more complex example:</p>\n\n<pre><code>func = \\x y z -&gt; x * y + z\nfunc = \\x -&gt; \\y z -&gt; x * y + z\nfunc x = \\y z -&gt; x * y + z\nfunc x = \\y -&gt; \\z -&gt; x * y + z\nfunc x y = \\z -&gt; x * y + z\nfunc x y z = x * y + z\n</code></pre>\n\n<p>Now if we wanted to completely remove all references to the arguments we can make use of the <code>.</code> operator which performs function composition:</p>\n\n<pre><code>func x y z = (+) (x * y) z    -- Make the + prefix\nfunc x y = (+) (x * y)        -- Now z becomes implicit\nfunc x y = (+) ((*) x y)      -- Make the * prefix\nfunc x y = ((+) . ((*) x)) y  -- Rewrite using composition\nfunc x = (+) . ((*) x)        -- Now y becomes implicit\nfunc x = (.) (+) ((*) x)      -- Make the . prefix\nfunc x = ((.) (+)) ((*) x)    -- Make implicit parens explicit\nfunc x = (((.) (+)) . (*)) x  -- Rewrite using composition\nfunc = ((.) (+)) . (*)        -- Now x becomes implicit\nfunc = (.) ((.) (+)) (*)      -- Make the . prefix\n</code></pre>\n\n<p>So as you can see there are lots of different ways to write a particular function with a varying number of explicit \"arguments\", some of which are very readable (i.e. <code>func x y z = x * y + z</code>) and some which are just a jumble of symbols with little meaning (i.e. <code>func = (.) ((.) (+)) (*)</code>)</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1440191669, "creation_date": 1440191669, "answer_id": 32149341, "question_id": 32148859, "link": "https://stackoverflow.com/questions/32148859/haskell-arrow-precedence-with-function-arguments/32149341#32149341", "title": "Haskell: arrow precedence with function arguments", "body": "<p>Maybe this will help.  First let's write it without operator notation which might be confusing.</p>\n\n<pre><code>append :: [a] -&gt; [a] -&gt; [a]\nappend [] ys = ys\nappend (x:xs) ys = x : append xs ys\n</code></pre>\n\n<p>We can apply one argument at a time:</p>\n\n<pre><code>appendEmpty :: [a] -&gt; [a]\nappendEmpty = append []\n</code></pre>\n\n<p>we could equivalently could have written that</p>\n\n<pre><code>appendEmpty ys = ys\n</code></pre>\n\n<p>from the first equation.</p>\n\n<p>If we apply a non-empty first argument:</p>\n\n<pre><code>-- Since 1 is an Int, the type gets specialized.\nappendOne :: [Int] -&gt; [Int]\nappendOne = append (1:[])\n</code></pre>\n\n<p>we could have equivalently have written that</p>\n\n<pre><code>appendOne ys = 1 : append [] ys\n</code></pre>\n\n<p>from the second equation.</p>\n"}], "owner": {"reputation": 455, "user_id": 3140914, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gFHmn.png?s=128&g=1", "display_name": "D.Naesuko", "link": "https://stackoverflow.com/users/3140914/d-naesuko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 329, "favorite_count": 0, "accepted_answer_id": 32149058, "answer_count": 3, "score": 4, "last_activity_date": 1440197847, "creation_date": 1440189228, "last_edit_date": 1440193045, "question_id": 32148859, "link": "https://stackoverflow.com/questions/32148859/haskell-arrow-precedence-with-function-arguments", "title": "Haskell: arrow precedence with function arguments", "body": "<p>I'm a <em>relatively</em> experienced Haskell programmer with a few hours of experience, so the answer might be obvious.</p>\n\n<p>After watching A taste of Haskell, I got lost when Simon explained how the append <code>(++)</code> function <em>really</em> works with its arguments.</p>\n\n<p>So, <a href=\"https://youtu.be/jLj1QV11o9g?t=36m37s\" rel=\"nofollow\">here's the part where he talks about this</a>.</p>\n\n<p>First, he says that <code>(++) :: [a] -&gt; [a] -&gt; [a]</code> can be understood as a function which gets two lists as arguments, and returns a list after the last arrow). However, he adds that <em>actually</em>, something like this happens: <code>(++) :: [a] -&gt; ([a] -&gt; [a])</code>, the function takes only <em>one</em> argument and returns a function.</p>\n\n<p>I'm not sure to understand how the returned function closure gets the first list as it expects one argument as well.</p>\n\n<p>On the next slide of the presentation, we have the following implementation:</p>\n\n<pre><code>(++) :: [a] -&gt; [a] -&gt; [a]\n\n[]     ++ ys = ys\n(x:xs) ++ ys = x : (xs ++ ys)\n</code></pre>\n\n<p>If I think that (++) receives two arguments and return a list, this piece of code along with the recursion is clear enough. </p>\n\n<p>If we consider that <code>(++)</code> receives only one argument and returns a list, <em>where does</em> <code>ys</code> <em>come from? Where is the returned function ?</em></p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 7, "creation_date": 1440179265, "post_id": 32146202, "comment_id": 52182286, "body": "Do you have a typo or something missing from what you copied into the question? I don&#39;t believe you have a <code>type Vector = [Num a]</code> because the type variable <code>a</code> doesn&#39;t exist. If you did, what is the <code>Num</code> type? It can&#39;t be the <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#t:Num\" rel=\"nofollow noreferrer\"><code>Num</code></a> class from base, since that&#39;s a constraint, not a type."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1440179483, "post_id": 32146202, "comment_id": 52182391, "body": "If <code>Vector a</code> is a type snonymn defined as being a list <code>[F a]</code> why are you trying to write an <code>Eq</code> instance for it? There&#39;s already an <code>Eq</code> instance for <code>Eq a =&gt; Eq [a]</code>."}, {"owner": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1440179751, "post_id": 32146202, "comment_id": 52182523, "body": "@Cirdec, I thought as much about &#39;constraint, not a type&#39; but to my surprise GHCi was happy with <code>type Vector a = [Num a]</code> (and every other known type class in place of <code>Num</code>)."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "edited": false, "score": 1, "creation_date": 1440180087, "post_id": 32146202, "comment_id": 52182676, "body": "@AndreyChernyakhovskiy My 7.10 GHCi objects to <code>type Vector a = [Num a]</code> with the error <code>Expected kind &#39;*&#39;, but &#39;Num a&#39; has kind &#39;Constraint&#39;</code>, unsurprisingly even with <code>PolyKinds</code> and <code>DataKinds</code> enabled."}, {"owner": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1440180338, "post_id": 32146202, "comment_id": 52182808, "body": "@Cirdec, Mine is 7.6.3. Looks like a bug that&#39;s been fixed."}, {"owner": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "edited": false, "score": 1, "creation_date": 1440180423, "post_id": 32146202, "comment_id": 52182852, "body": "Btw, If I remember correctly, one cannot define an instance of type class on a type synonym."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 2134, "user_id": 2623659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1bd33f70a971bf89c7719005d477e2b?s=128&d=identicon&r=PG", "display_name": "ach", "link": "https://stackoverflow.com/users/2623659/ach"}, "edited": false, "score": 0, "creation_date": 1440183307, "post_id": 32146202, "comment_id": 52184365, "body": "@AndreyChernyakhovskiy Using <code>FlexibleInstances</code> I believe it&#39;s possible. However it shouldn&#39;t overlap with existing instances (in this case it would overlap). E.g. <code>class A a;instance A String</code> compiles when using that extension."}, {"owner": {"reputation": 2513, "user_id": 4725625, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/YwH49.png?s=128&g=1", "display_name": "Kwarrtz", "link": "https://stackoverflow.com/users/4725625/kwarrtz"}, "edited": false, "score": 1, "creation_date": 1440190329, "post_id": 32146202, "comment_id": 52187587, "body": "I get a <code>not in scope: type variable &#39;a&#39; </code> on GHC 7.8.3."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1440212324, "post_id": 32146202, "comment_id": 52192673, "body": "As has been said, there are several errors in this code. But the <code>parse error on input &#39;[&#39;</code> is not related to types (types are only checked once <i>everything</i> already parses). It&#39;s most likely due to an indentation problem, which we cannot see in your paste here."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1440216199, "post_id": 32151438, "comment_id": 52193259, "body": "Don&#39;t add examples of bad code. Such restrictions went out years ago."}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440693003, "post_id": 32151438, "comment_id": 52389749, "body": "@dfeuer, was that a criticism of the examples I gave, or just a response to my last paragraph?  If the latter - yes, I left it out because it&#39;s a bad practice."}, {"owner": {"reputation": 1724, "user_id": 3286513, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/bc0cef8062401f1b84db320cb56c28bd?s=128&d=identicon&r=PG", "display_name": "Steven L.", "link": "https://stackoverflow.com/users/3286513/steven-l"}, "edited": false, "score": 0, "creation_date": 1530761105, "post_id": 32151438, "comment_id": 89347959, "body": "@bergey sorry to bring up an old post, but I am interested in learning Haskell. In order to make sure that a <code>Vector</code> can only contains types that are instances of <code>Num</code>, would a quantified type do? <code>data Vector a = forall a . Num a =&gt; Vector [a]</code>? Or is there a more &quot;direct&quot; way of doing this?"}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "reply_to_user": {"reputation": 1724, "user_id": 3286513, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/bc0cef8062401f1b84db320cb56c28bd?s=128&d=identicon&r=PG", "display_name": "Steven L.", "link": "https://stackoverflow.com/users/3286513/steven-l"}, "edited": false, "score": 0, "creation_date": 1530762208, "post_id": 32151438, "comment_id": 89348154, "body": "@StevenL. I think you will do better making a new question for your post.  You&#39;ll get better answers if you explain the wider context of what you&#39;re trying to do.  What do you want to permit and forbid?  The type you propose doesn&#39;t do what you want, but I don&#39;t know what else to suggest without knowing <i>what</i> you want."}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 1, "last_activity_date": 1440207594, "creation_date": 1440207594, "answer_id": 32151438, "question_id": 32146202, "link": "https://stackoverflow.com/questions/32146202/typeclass-instance-for-type-synonym/32151438#32151438", "title": "Typeclass instance for type synonym", "body": "<p>There are several issues with this code, preventing it from being compiled.  I think you mean that <code>Vector</code> is parameterized by the type <code>a</code> that it contains:</p>\n\n<p><code>type Vector a = [a]</code></p>\n\n<p>I've dropped the <code>Num</code> constraint because it isn't needed for the rest of the example; I'll pick it up at the end.</p>\n\n<p>There's already an <code>Eq</code> instance for lists, so this is a bit of a dead end.  One way forward is to switch to a newtype:</p>\n\n<p><code>newtype Vector a = Vector [a]</code></p>\n\n<p>Unlike a type synonym declared with <code>type</code>, Haskell sees a <code>newtype</code> as a completely different type.  A <code>Vector</code> is not a list, so we can define whatever type class instances we want.</p>\n\n<p>Our <code>Eq</code> instance gets a little longer, because we have to write the <code>Vector</code> constructor each time.  I added parentheses around <code>Vector a</code> in the first line.</p>\n\n<p>The only other change we need to make is adding the <code>Eq a</code> constraint before the instance.  In the last line of the definition, we compare the first element of the two <code>Vectors</code>.  This only makes sense if the type <code>a</code> is an instance of <code>Eq</code>. </p>\n\n<pre><code>instance Eq a =&gt; Eq (Vector a) where\n  Vector [] == Vector [] = True\n  Vector [_] == Vector [] = False\n  Vector [] == Vector [_] = False\n  Vector (a : u) == Vector (b : v) = (a == b) &amp;&amp; (Vector u == Vector v)\n</code></pre>\n\n<p>This compiles.  You could add a <code>Num</code> constraint, insisting that no one may construct a <code>Vector a</code> unless <code>a</code> is <code>Num</code>, or that <code>Vector a</code> is only <code>Eq</code> if <code>a</code> is <code>Num</code>.  If this is something you want to do, I can add an example.</p>\n"}], "owner": {"reputation": 785, "user_id": 3979938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9b5ffb83346cf7b19ac7af84b6f9d58?s=128&d=identicon&r=PG&f=1", "display_name": "cwindolf", "link": "https://stackoverflow.com/users/3979938/cwindolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 953, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1551734435, "creation_date": 1440178375, "last_edit_date": 1551734435, "question_id": 32146202, "link": "https://stackoverflow.com/questions/32146202/typeclass-instance-for-type-synonym", "title": "Typeclass instance for type synonym", "body": "<p>Afraid that I've grossly misunderstood types in Haskell. I'll get into it. Say I have a type defined so:</p>\n\n<pre><code>type Vector = [Num a]\n</code></pre>\n\n<p>So I'm using a typeclass in the definition of the synonym. Then if I want to add it to another typeclass, say Eq, maybe I would do something like so:</p>\n\n<pre><code>instance Eq Vector a where\n  [] == [] = True\n  [_]== [] = False\n  [] == [_] = False\n  (a : u) == (b : v) = (a == b) &amp;&amp; (u == v)\n</code></pre>\n\n<p>But when I do this, GHC gives a</p>\n\n<blockquote>\n  <p>parse error on input '['</p>\n</blockquote>\n\n<p>It's referring to the first left bracket in the line <code>[_]== [] = False</code>.</p>\n\n<p>Is this caused by an issue with my type definition?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1440188127, "post_id": 32145443, "comment_id": 52186566, "body": "Uhm... do you mean <code>++ [mod z k]</code> instead of <code>:[mod z k]</code>? The latter does not look well-typed."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1440188744, "post_id": 32145443, "comment_id": 52186873, "body": "@chi Fixed. Keep me on my toes!"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1440212814, "post_id": 32145443, "comment_id": 52192754, "body": "<code>++ [...]</code> is very inefficient compared to <code>reverse</code>ing at the end."}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1440249335, "post_id": 32145443, "comment_id": 52201265, "body": "Yeah, concatentation is O(n^2) while reversing at the end keeps the whole function O(n)."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 4, "last_activity_date": 1440188727, "last_edit_date": 1440188727, "creation_date": 1440175401, "answer_id": 32145443, "question_id": 32145329, "link": "https://stackoverflow.com/questions/32145329/representation-of-a-number-in-a-generic-base/32145443#32145443", "title": "Representation of a number in a generic base", "body": "<p>The type of <code>rep</code> is <code>rep :: (Integral a) =&gt; a -&gt; a -&gt; [a]</code>), but the type of <code>mod z k</code> is just <code>a</code>. Thus you should write</p>\n\n<pre><code>(rep (floor ...)) ++ [mod z k]\n</code></pre>\n\n<p>as the type of <code>(:)</code> is <code>a -&gt; [a] -&gt; [a]</code>, while <code>(++)</code> has type <code>[a] -&gt; [a] -&gt; [a]</code>.</p>\n\n<p>Another reasonable alternative is to just call <code>reverse</code> on the resulting list!</p>\n"}, {"tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": false, "score": 3, "last_activity_date": 1440175693, "creation_date": 1440175693, "answer_id": 32145524, "question_id": 32145329, "link": "https://stackoverflow.com/questions/32145329/representation-of-a-number-in-a-generic-base/32145524#32145524", "title": "Representation of a number in a generic base", "body": "<p>The quickest fix is to just apply <code>reverse</code> on the result:</p>\n\n<pre><code>rep :: Int -&gt; Int -&gt; [Int]\nrep a = reverse . rep' a\n    where rep' 0 _ = [0]\n          rep' z k = (z `mod` k) : rep' (z `div` k) k\n</code></pre>\n\n<p>Your previous <code>(floor (fromIntegral z / fromIntegral k) )</code> has also been refactored to the equivalent expression <code>(div z k)</code>.</p>\n\n<p><a href=\"http://coliru.stacked-crooked.com/a/cb36d545f93252c5\" rel=\"nofollow\"><kbd>Live demo</kbd></a></p>\n"}, {"tags": [], "owner": {"reputation": 1375, "user_id": 420038, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14e486867defc84340f1837639ca54ee?s=128&d=identicon&r=PG", "display_name": "thomie", "link": "https://stackoverflow.com/users/420038/thomie"}, "is_accepted": false, "score": 1, "last_activity_date": 1440203989, "creation_date": 1440203989, "answer_id": 32151140, "question_id": 32145329, "link": "https://stackoverflow.com/questions/32145329/representation-of-a-number-in-a-generic-base/32151140#32151140", "title": "Representation of a number in a generic base", "body": "<p>Also have a look at <code>showIntAtBase</code> from <code>Numeric</code>. Here is the source: <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/src/Numeric.html#showIntAtBase\" rel=\"nofollow\">http://hackage.haskell.org/package/base-4.8.1.0/docs/src/Numeric.html#showIntAtBase</a></p>\n"}], "owner": {"reputation": 331, "user_id": 5231990, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/563abcb48f1195c34619244e9b662bc3?s=128&d=identicon&r=PG&f=1", "display_name": "Swift", "link": "https://stackoverflow.com/users/5231990/swift"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1440203989, "creation_date": 1440174959, "last_edit_date": 1440178015, "question_id": 32145329, "link": "https://stackoverflow.com/questions/32145329/representation-of-a-number-in-a-generic-base", "title": "Representation of a number in a generic base", "body": "<p>I am new to Haskell and I was just trying to write a simple function, that returns the representation of any number <code>z</code> that is passed in to it in base <code>k</code> that is also passed into it.</p>\n\n<p>Thus far the function does what it is supposed to do but in reverse.</p>\n\n<pre><code>rep 0 _ = [0]\nrep z k = (mod z k) : rep (floor (fromIntegral z / fromIntegral k) ) k\n</code></pre>\n\n<p>There is also a (leading, but now trailing 0), but this is not too important right now. So for example <code>rep 1 2</code> will result in <code>[1,0]</code>, but it should result in <code>[0,1]</code>.</p>\n\n<p>Another example: <code>rep 8 2</code> should create <code>[0,1,0,0]</code> which would be fine, but it does create <code>[0,0,1,0]</code>. I also think the problem is that <code>:</code>appends to the front of the list. I rather should swap the code to:</p>\n\n<pre><code>rep z k =rep (floor (fromIntegral z / fromIntegral k) ) k : (mod z k)\n</code></pre>\n\n<p>or with brackets</p>\n\n<pre><code>rep z k =(rep (floor (fromIntegral z / fromIntegral k) ) k) : (mod z k)\n</code></pre>\n\n<p>But neither one works as it gets infinite.</p>\n\n<pre><code>Occurs check: cannot construct the infinite type: t ~ [t]\nRelevant bindings include\nk :: [t] (bound at knaerBasis.hs:3:7)\nz :: [t] (bound at knaerBasis.hs:3:5)\nrep :: [t] -&gt; [t] -&gt; [t] (bound at knaerBasis.hs:1:1)\nIn the first argument of \u2018(:)\u2019, namely\n\u2018(rep (floor (fromIntegral z / fromIntegral k)) k)\u2019\nIn the expression:\n(rep (floor (fromIntegral z / fromIntegral k)) k) : (mod z k)\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "monads", "continuations"], "comments": [{"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 1, "creation_date": 1440176726, "post_id": 32145000, "comment_id": 52181003, "body": "<a href=\"https://wiki.haskell.org/Continuation\" rel=\"nofollow noreferrer\">wiki.haskell.org/Continuation</a>"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 7, "creation_date": 1440180182, "post_id": 32145000, "comment_id": 52182719, "body": "The right way to continue with this intuition may be to abandon it: not all monads are containers (or at least not very elegantly).  <code>State</code>, <code>Writer</code>, and \u2013 yes \u2013 <code>Cont</code>, for instance, doesn&#39;t feel like containers at all.  &quot;Container&quot; is an intuition that might help you get your foot in the door, but it&#39;s something you&#39;ll need to generalize.  (Incidentally, &quot;container&quot; to me feels like a more useful intuition for functors \u2013 but again, not perfect by any means.)"}, {"owner": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1440183863, "post_id": 32145000, "comment_id": 52184638, "body": "@AntalS-Z Is there another intuition that you&#39;d recommend?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1440187381, "post_id": 32145000, "comment_id": 52186209, "body": "Why are you looking for &quot;intuition&quot; rather than understanding? If monads were intuitive, you&#39;d understand them already, without asking any questions! Monads as containers is more like an analogy: one that works well for List and Maybe, kinda works for IO, and is rather stretched for most of the others."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1440188495, "post_id": 32145000, "comment_id": 52186755, "body": "If you are looking for a very quick and dirty intuition, I&#39;d look at monads as &quot;programmable semicolons&quot; (as in redefining the <code>;</code> in <code>a;b</code>) rather than containers."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 3, "creation_date": 1440189156, "post_id": 32145000, "comment_id": 52187065, "body": "@Moses: The only monad tutorial I ever recommend is <a href=\"http://blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.html\" rel=\"nofollow noreferrer\">\u201cYou Could Have Invented Monads!  (And Maybe You Already Have.)\u201d</a>, by Dan \u201csigfpe\u201d Piponi.  It isn\u2019t so much about intuition as about <i>why</i> we want monads: monads are what allow us to compose functions that do something <i>other</i> than just produce a result.  (But really, that\u2019s a pale one-sentence summary \u2013 the whole post is worth reading.)"}, {"owner": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1440206140, "post_id": 32145000, "comment_id": 52191667, "body": "@amalloy what is the type of <code>;</code>?  @AntalS-Z Yuppers; I really like that post :-)"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1440206512, "post_id": 32145000, "comment_id": 52191729, "body": "I wasn&#39;t the one who said anything about <code>;</code>; you are looking for @chi. And since the topic has been broached, my favorite monad article was <a href=\"https://cdsmith.wordpress.com/2012/04/18/why-do-monads-matter/\" rel=\"nofollow noreferrer\">Why Do Monads Matter</a>. I know it won&#39;t be everyone&#39;s favorite, because you have to <a href=\"http://codetojoy.blogspot.com/2009/03/monads-are-burritos.html\" rel=\"nofollow noreferrer\">find your own burrito</a>, but maybe it will help you along the way."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1440229268, "post_id": 32145000, "comment_id": 52195837, "body": "In Haskell, the &quot;semicolon&quot; in <code>a;b</code> is actually written <code>a &gt;&gt; b</code>. To account for the fact that <code>b</code> may depend on the result of <code>a</code>, we can generalize it to <code>a &gt;&gt;= b</code>. Most other languages implicitly work in the <code>IO</code> monad, while Haskell lets you redefine the &quot;semicolon&quot; <code>&gt;&gt;=</code> in different ways."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1440229605, "post_id": 32145000, "comment_id": 52195911, "body": "In the list monad <code>[]</code>, for instance, you change the &quot;semicolon&quot; so that the semantics of the language now is non deterministic (roughly -- it actually just return a list in a certain order). Using <code>Writer a</code> you can now collect data in a log, using <code>Cont r</code> you can do early returns. With <code>Maybe</code> or <code>Error a</code> you can have failures. With <code>Parser</code> you can express LL grammars."}], "answers": [{"comments": [{"owner": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "edited": false, "score": 0, "creation_date": 1440184563, "post_id": 32146054, "comment_id": 52184969, "body": "Hmmm, thanks for the insight and link; but I&#39;m still more interested in how to view this monad as an aggregation. That is, for example <code>Reader e</code> is not immediately seen to be an aggregation, but when you note that a function space <code>e -&gt; a</code> is nothing more than a power space <code>a ^ e</code>, then you note that this is just a sequence of <code>a</code> of &quot;length&quot; |e|. I am aiming for something as ubiquitous to assign as intuition for the continuation monad. Thanks for your time!"}], "tags": [], "owner": {"reputation": 3113, "user_id": 1193741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be1d97fc244eaa2bfd3d7d64c1717f9f?s=128&d=identicon&r=PG", "display_name": "jtobin", "link": "https://stackoverflow.com/users/1193741/jtobin"}, "is_accepted": false, "score": 8, "last_activity_date": 1440179465, "last_edit_date": 1440179465, "creation_date": 1440177828, "answer_id": 32146054, "question_id": 32145000, "link": "https://stackoverflow.com/questions/32145000/continuations-as-meaningful-comprehensions/32146054#32146054", "title": "continuations as meaningful comprehensions", "body": "<p>I like to think of continuations as programs with holes in them.  I think I originally gleaned this insight from <a href=\"http://www.haskellforall.com/2012/12/the-continuation-monad.html\">Tekmo's blog</a>.</p>\n\n<p>Check out this little continuation:</p>\n\n<pre><code>import Control.Monad.Trans.Cont\n\nprogram :: ContT () IO Char\nprogram = ContT $ \\doThing -&gt; do\n  c &lt;- getChar\n  doThing c\n</code></pre>\n\n<p>It's a program that's 'missing a piece' - namely, what to do with the <code>Char</code> retrieved from <code>getChar</code>.  We can run it by filling the missing piece with something like <code>putChar</code>; evaluating the continuation via <code>runContT program putChar</code> will get a character and then print it to stdout.</p>\n\n<p>If you're comfortable with representing programs by abstract syntax trees the container analogy might be intuitive.</p>\n\n<p>To make it clearer, you can build up a little AST containing a <code>DoThing</code> term that represents a hole that needs to be filled:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\nimport Control.Monad.Free\n\ndata ExprF a =\n    GetChar (Char -&gt; a)\n  | DoThing Char a\n  deriving Functor\n\ntype Expr = Free ExprF\n\ngetChar' :: Expr Char\ngetChar' = liftF (GetChar id)\n\ndoThing' :: Char -&gt; Expr ()\ndoThing' c = liftF (DoThing c ())\n\nprogram' :: Expr ()\nprogram' = do\n  c &lt;- getChar'\n  doThing' c\n</code></pre>\n\n<p><code>program'</code> is hopefully more clearly a container; to run it we need to process the AST in a similar fashion as we would any other recursive container:</p>\n\n<pre><code>eval :: Expr () -&gt; (Char -&gt; IO ()) -&gt; IO ()\neval prog f = iterM alg prog where\n  alg (GetChar k)   = getChar &gt;&gt;= k\n  alg (DoThing c k) = f c &gt;&gt; k\n</code></pre>\n\n<p>Evaluating <code>program'</code> via <code>eval program' putChar</code> is analogous to running <code>program</code> via <code>runContT program putChar</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 6, "last_activity_date": 1440267288, "last_edit_date": 1495541245, "creation_date": 1440223608, "answer_id": 32152954, "question_id": 32145000, "link": "https://stackoverflow.com/questions/32145000/continuations-as-meaningful-comprehensions/32152954#32152954", "title": "continuations as meaningful comprehensions", "body": "<p>The real key to understanding monads is to stop trying to say</p>\n\n<blockquote>\n  <p>A monad is <strong>X</strong></p>\n</blockquote>\n\n<p>and instead start saying</p>\n\n<blockquote>\n  <p><strong>X</strong> is a monad</p>\n</blockquote>\n\n<p>Something is a monad if it <a href=\"https://en.wikipedia.org/wiki/Monad_(category_theory)\" rel=\"nofollow noreferrer\">has a certain structure and obeys certain laws</a>. For the purpose of programming in Haskell, something is a <code>Monad</code> if it has the right kind and types and obeys the <a href=\"https://wiki.haskell.org/Monad_laws\" rel=\"nofollow noreferrer\"><code>Monad</code> laws</a>.</p>\n\n<pre><code> return a &gt;&gt;= f \u2261 f a\n m &gt;&gt;= return   \u2261 m\n(m &gt;&gt;= f) &gt;&gt;= g \u2261 m &gt;&gt;= (\\x -&gt; f x &gt;&gt;= g)\n</code></pre>\n\n<p>Gabriel Gonzales points out that <a href=\"http://www.haskellforall.com/2012/08/the-category-design-pattern.html\" rel=\"nofollow noreferrer\">the monad laws are \"the category laws in disguise\"</a>. We can use <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Control-Monad.html#v:-62--61--62-\" rel=\"nofollow noreferrer\"><code>&gt;=&gt;</code></a>, which is defined as follow, instead of <code>&gt;&gt;=</code>.</p>\n\n<pre><code>(f &gt;=&gt; g) = \\x -&gt; f x &gt;&gt;= g\n</code></pre>\n\n<p>When we do, the monad laws become the <a href=\"https://en.wikibooks.org/wiki/Haskell/Category_theory\" rel=\"nofollow noreferrer\">category laws</a> with identity <code>return</code> and associative composition <code>&gt;=&gt;</code>.</p>\n\n<pre><code>return &gt;=&gt; f    \u2261 f\nf &gt;=&gt; return    \u2261 f\nf &gt;=&gt; (g &gt;=&gt; h) \u2261 (f &gt;=&gt; g) &gt;=&gt; h\n</code></pre>\n\n<p>In your examples you are already discussing two different things for a monad to be: an aggregation that flattens and an aggregation that prunes. Instead of trying to say that monad is both of these things we'll say that both of these things are monads. To develop intuition about what things are monads, let's talk about the largest class of things that are all monads.</p>\n\n<h3>Trees with grafting</h3>\n\n<p>The largest class that are <code>Monad</code>s are <a href=\"http://blog.sigfpe.com/2010/01/monads-are-trees-with-grafting.html\" rel=\"nofollow noreferrer\">trees with grafting</a> and simplification. This class is so big that every <code>Monad</code> that I know of in Haskell is a tree with grafting. Each of these monads includes a <code>return</code> which constructs a tree holding the value at the leaves and a bind <code>&gt;&gt;=</code> which does two things. Bind replaces each leaf with a new tree, grafting the new tree onto the tree where the leaf was, and simplies the resulting tree. The examples that you mention differ in how they simplify the tree. Which simplifications are allowed are governed by the <code>Monad</code> laws.</p>\n\n<p>If we have a simple tree holding values at its leaves, it is a monad.</p>\n\n<pre><code>data Tree a = Branch [Tree a] | Leaf a\n</code></pre>\n\n<p>Its <code>return</code> constucts a single <code>Leaf</code>. Here's <code>return 1</code>:</p>\n\n<pre><code>          1\n</code></pre>\n\n<p>Its bind replaces leaves with entire trees. We start with the following tree:</p>\n\n<pre><code>          *\n         / \\\n        0   1\n</code></pre>\n\n<p>And bind this to <code>\\x -&gt; Branch [x*2, x*2 + 1]</code>. We replace each leaf with the newly calculated tree.</p>\n\n<pre><code>        __*__\n       /     \\\n      *       *\n     / \\     / \\\n    0   1   2   3\n</code></pre>\n\n<p>For ordinary trees, the grafting step doesn't perform any simplification. After checking that these operations obey the monad laws we can say</p>\n\n<blockquote>\n  <p>A tree with grafting and no simplification is a monad</p>\n</blockquote>\n\n<h3>Flatten</h3>\n\n<p>Lists, bags, sets, <code>Maybe</code>, and <a href=\"http://hackage.haskell.org/package/transformers-0.4.1.0/docs/Data-Functor-Identity.html\" rel=\"nofollow noreferrer\"><code>Identity</code></a> flatten all the levels of the resulting tree into a single level. Everything grafted anywhere onto  the tree ends up in the same list or bag or set or <code>Just</code>. Sets also remove any duplicates from the resulting single-layer tree.</p>\n\n<pre><code>          *\n         / \\\n       [0,  1]\n</code></pre>\n\n<p>If we bind this to <code>\\x -&gt; [x*2, x*2 + 1]</code> we replace each leaf with the new tree</p>\n\n<pre><code>        __*__\n       /     \\\n      *       *\n     / \\     / \\\n   [0,  1] [2,  3]\n</code></pre>\n\n<p>and then flatten the intermediate layer</p>\n\n<pre><code>      ____*____\n     /  |   |  \\\n   [0,  1,  2,  3]\n</code></pre>\n\n<p>We can say that</p>\n\n<blockquote>\n  <p>An aggregation that flattens is a tree with grafting and simplification</p>\n</blockquote>\n\n<p>And, after checking the monad laws we can say that</p>\n\n<blockquote>\n  <p>An aggregation that flattens is a monad</p>\n</blockquote>\n\n<h3>Prune</h3>\n\n<p><code>Reader e</code> and <a href=\"http://hackage.haskell.org/package/transformers/docs/Data-Functor-Product.html#v:Pair\" rel=\"nofollow noreferrer\">pairs</a> like <code>data Pair a = Pair a a</code> are a little different. They can't flatten all of the results into a single layer, or at least can't do so immediately. Instead they prune branches that didn't branch the same direction as the parent.</p>\n\n<p>If we start with a pair</p>\n\n<pre><code>          *\n         / \\\n       &lt;0,  1&gt;\n</code></pre>\n\n<p>When we bind this to <code>\\x -&gt; &lt;x*2, x*2 + 1&gt;</code> we replace each leaf with the new tree</p>\n\n<pre><code>        __*__\n       /     \\\n      *       *\n     / \\     / \\\n   &lt;0,  1&gt; &lt;2,  3&gt;\n</code></pre>\n\n<p>We prune the branches that didn't branch the same direction</p>\n\n<pre><code>        __*__\n       /     \\\n      *       *\n     /         \\\n   &lt;0,          3&gt;\n</code></pre>\n\n<p>And then can additionally simplify this by flattening the layers</p>\n\n<pre><code>          *\n         / \\\n       &lt;0,  3&gt;\n</code></pre>\n\n<p>As you pointed out, <code>Reader e a</code> branches a number of directions equal to the number of possible values of <code>e</code>.</p>\n\n<p>We can say that</p>\n\n<blockquote>\n  <p>An aggregation that prunes and flattens is a tree with grafting and simplification</p>\n</blockquote>\n\n<p>And, after checking the monad laws we can say that</p>\n\n<blockquote>\n  <p>An aggregation that prunes and flattens is a monad</p>\n</blockquote>\n\n<h3>Continuations</h3>\n\n<p>The <em>continuation monad</em> is a tree that has a branch for each of the possible <em>continuations</em>. We will adopt the <a href=\"https://stackoverflow.com/a/25657590/414413\">terminology Philip JF suggested for continuations</a>. The <em>continuation monad</em> is the whole <code>(a -&gt; r) -&gt; r</code>. The <em>continuation</em> is the <code>a -&gt; r</code> function passed in as the first argument</p>\n\n<pre><code>--                               continuation                                 \n--                               |------|            \ndata Cont r a = Cont {runCont :: (a -&gt; r) -&gt; r}\n--                               |-----------|\n--                               continuation monad\n</code></pre>\n\n<p>The continuation monad has a number of branches equal to <code>|r| ^ |a|</code>, the number of possible values of the continuation <code>a -&gt; r</code>. Each branch is labeled with a corresponding function. <strong>A continuation always holds the same value in every leaf</strong>, which we will justify in a moment. We will also be adding labels to the internal nodes of the tree, a function <code>r -&gt; r</code>, which I'll discuss later.</p>\n\n<p>We'll use the following data type to write out an example tree.</p>\n\n<pre><code>data Tri = A | B | C\n</code></pre>\n\n<p>Our example tree will be for <code>return A :: Cont Bool Tri</code>. The type of the values held in the tree, <code>Tri</code>, has three constructors, and the result of the contination monad, <code>Bool</code>, has two constructors. There are <code>2 ^ 3 = 8</code> possible functions <code>Tri -&gt; Bool</code>, each of which makes up one branch of the tree.</p>\n\n<pre><code>                               id *\n      ____________________________|____________________________\nfalse |     a |     b |     c |  aOrB |  aOrC |  bOrC |  true |\n      A       A       A       A       A       A       A       A\n</code></pre>\n\n<p><a href=\"http://www.haskellforall.com/2012/12/the-continuation-monad.html\" rel=\"nofollow noreferrer\">\"The way to a Monad's heart is through its Kleisli arrows\"</a>. <a href=\"https://wiki.haskell.org/Arrow_tutorial#Kleisli_Arrows\" rel=\"nofollow noreferrer\">Kleisli arrows</a> are the things you can pass to the second argument of <code>&gt;&gt;=</code>; they have the type <code>a -&gt; m b</code>. We are going to study the Kleisli arrows of <code>Cont</code> which have the type <code>a -&gt; Cont r b</code>, or, when we look through the <code>Cont</code> constructor</p>\n\n<pre><code>a -&gt; (b -&gt; r) -&gt; r\n</code></pre>\n\n<p>We can break the Kleisli arrows of the contination monad <code>a -&gt; (b -&gt; r) -&gt; r</code> into two parts. The first part is the function that decides what <code>b</code> to pass into the continuation <code>b -&gt; r</code>. The only thing it has to work with is the <code>a</code> argument, so it must be one of the functions  <code>g :: a -&gt; b</code>. The second part is the function that combines the results. It can see the argument <code>a</code> and the result of passing <code>g a</code> into the continuation. We will call this second function <code>r :: a -&gt; r -&gt; r</code>. All functions of type <code>a -&gt; (b -&gt; r) -&gt; r</code> can be written in the form</p>\n\n<pre><code>a  -&gt; (b -&gt; r) -&gt; r\n\\x -&gt; \\f       -&gt; r x (f (g x))\n</code></pre>\n\n<p>for some <code>g :: a -&gt; b</code> and <code>r :: a -&gt; r -&gt; r</code>.</p>\n\n<p>Similarly, every continuation monad <code>(a -&gt; r) -&gt; r</code> can be written in the form</p>\n\n<pre><code>(a -&gt; r) -&gt; r\n\\f       -&gt; r (f a)\n</code></pre>\n\n<p>for some <code>a :: a</code> and <code>r :: r -&gt; r</code>. Combined these make up the justification that a continuation monad always holds the same value in every leaf.</p>\n\n<p>When we bind a function <code>\\x -&gt; \\f -&gt; r x (f (g x))</code> onto a continuation monad tree we will record <code>g x</code> as the new leaves and record <code>(r x, g x)</code> as the label for the new intermediate node. The trees are really big, but we'll draw the corner of another complete example using <code>\\x -&gt; \\f -&gt; r x (f (g x)) :: Tri -&gt; (Bit -&gt; Bool) -&gt; Bool</code> where <code>Bit</code> only has two constructors. The resulting continuation monad should only have <code>|Bool| ^ |Bit| = 4</code> branches, but we haven't simplified it yet.</p>\n\n<pre><code>                                            id *  \n                _______________________________|_...\n          false |                         a |\n            r A *                       r A *\n       _________|____________          _____|_...\nbfalse |  b0 |  b1 |  btrue |   bfalse |  b0 |  \n      g A   g A   g A      g A        g A   g A\n</code></pre>\n\n<p>Since every leaf holds the same value, the only differences between the paths through the tree are the functions labeling each branch. We will drop the labels from the branches and only draw a single branch. Our first example for <code>return a</code> will now be drawn as</p>\n\n<pre><code>        id *\n           |\n           A\n</code></pre>\n\n<p>And the example of binding <code>\\x -&gt; \\f -&gt; r x (f (g x))</code> onto <code>return A</code> will be drawn as</p>\n\n<pre><code>        id *\n           |\n       r A *\n           |\n          g A\n</code></pre>\n\n<p>Any continuation monad written in the form <code>\\f -&gt; r (f a)</code> for some <code>a :: a</code> and <code>r :: r -&gt; r</code> will be represented by the tree</p>\n\n<pre><code>         r *\n           |\n           a\n</code></pre>\n\n<p>When bound to <code>\\x -&gt; \\f' -&gt; r' x (f' (g' x))</code>, it will be represented by the following tree (this is just grafting)</p>\n\n<pre><code>           r *\n             |\n        r' a *\n             |\n           g' a\n</code></pre>\n\n<p>We are going to figure out what the simplification step is from the <a href=\"https://hackage.haskell.org/package/transformers-0.4.3.0/docs/src/Control-Monad-Trans-Cont.html#instance%20Monad%20(ContT%20r%20m)\" rel=\"nofollow noreferrer\">definition of <code>&gt;&gt;=</code> for <code>Cont</code></a>.</p>\n\n<pre><code>m &gt;&gt;= k = Cont $ \\ c -&gt; runCont m (\\x -&gt; runCont (k x) c)\n\n(\\f -&gt; r (f a)) &gt;&gt;= (\\x' -&gt; \\f' -&gt; r' x' (f' (g' x')))\n= \\c -&gt; (\\f -&gt; r (f a)) (\\x -&gt; (\\x' -&gt; \\f' -&gt; r' x' (f' (g' x'))) x c) -- by definition\n= \\c -&gt; (\\f -&gt; r (f a)) (\\x -&gt; (       \\f' -&gt; r' x  (f' (g' x )))   c) -- beta reduction\n= \\c -&gt; (\\f -&gt; r (f a)) (\\x -&gt;                r' x  (c  (g' x ))     ) -- beta reduction\n= \\c -&gt;        r ((\\x -&gt; r' x  (c  (g' x))) a) -- beta reduction\n= \\c -&gt;        r (       r' a  (c  (g' a))   ) -- beta reduction\n= \\c -&gt;       (r .       r' a) (c  (g' a))     -- f (g x) = (f . g) x\n= \\c -&gt; (r . r' a) (c (g' a))                  -- whitespace\n</code></pre>\n\n<p>which is in the form <code>\\f -&gt; r (f a)</code>. Our tree will be simplified to</p>\n\n<pre><code>    r . r' a *\n             |\n           g' a\n</code></pre>\n\n<p>The continuation monad is a tree whose internal nodes are labeled with functions. Its bind operation is tree grafting followed by a simplification step. The simplification step composes the functions on the internal nodes. We can say that</p>\n\n<blockquote>\n  <p>The continuation monad is a tree with grafting and simplification</p>\n</blockquote>\n\n<p>And, after checking the monad laws we can say that</p>\n\n<blockquote>\n  <p>The continuation monad is a monad</p>\n</blockquote>\n"}], "owner": {"reputation": 792, "user_id": 3550444, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8a06f855d0b44ead04edffa576cd943e?s=128&d=identicon&r=PG", "display_name": "Musa Al-hassy", "link": "https://stackoverflow.com/users/3550444/musa-al-hassy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 3, "answer_count": 2, "score": 9, "last_activity_date": 1440267288, "creation_date": 1440173699, "last_edit_date": 1440184374, "question_id": 32145000, "link": "https://stackoverflow.com/questions/32145000/continuations-as-meaningful-comprehensions", "title": "continuations as meaningful comprehensions", "body": "<p>Monads may be construed as forms of containers:</p>\n\n<ul>\n<li>list : aggregation of items from a given type</li>\n<li>bag  : unordered aggregation</li>\n<li>set  : unordered aggregation that ignores multiplicity</li>\n<li>Maybe : aggregation of at-most one item</li>\n<li>Reader e : aggregations of cardinality |e|</li>\n</ul>\n\n<p>I am wondering how continuations are interpreted in this view as forms of packages / containers, in a meaningful fashion. Thanks!</p>\n"}, {"tags": ["haskell", "ghcjs"], "answers": [{"tags": [], "owner": {"reputation": 735, "user_id": 961761, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2631f359822e6f25df80319ec3f5dcfe?s=128&d=identicon&r=PG", "display_name": "pchiusano", "link": "https://stackoverflow.com/users/961761/pchiusano"}, "is_accepted": false, "score": 5, "last_activity_date": 1440172334, "creation_date": 1440172334, "answer_id": 32144569, "question_id": 32144568, "link": "https://stackoverflow.com/questions/32144568/how-do-i-do-multiline-foreign-imports-with-ghcjs/32144569#32144569", "title": "How do I do multiline foreign imports with ghcjs?", "body": "<p>If you're within a CPP block, remove the leading <code>\\</code> from each line. See <a href=\"https://github.com/ghcjs/ghcjs/issues/84\">this issue</a>.</p>\n"}], "owner": {"reputation": 735, "user_id": 961761, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2631f359822e6f25df80319ec3f5dcfe?s=128&d=identicon&r=PG", "display_name": "pchiusano", "link": "https://stackoverflow.com/users/961761/pchiusano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1440172334, "creation_date": 1440172334, "question_id": 32144568, "link": "https://stackoverflow.com/questions/32144568/how-do-i-do-multiline-foreign-imports-with-ghcjs", "title": "How do I do multiline foreign imports with ghcjs?", "body": "<p>How do I do multiline foreign imports in GHCJS? I have a block of javascript that stretches over multiple lines:</p>\n\n<pre><code>foreign import javascript unsafe\n  \"{ var x = 41;\\\n  \\  $r = x + 1; \\\n  \\}\"\n  answerToGreatestQuestion :: IO (JSRef Double)\n</code></pre>\n\n<p>And I get an error like:</p>\n\n<pre><code>lexical error in string/character literal at character 'i'\n</code></pre>\n\n<p>which points to the <code>\\</code> character. What's going on here?</p>\n"}, {"tags": ["haskell", "module", "export"], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 2, "last_activity_date": 1440173988, "creation_date": 1440173988, "answer_id": 32145077, "question_id": 32144387, "link": "https://stackoverflow.com/questions/32144387/haskell-namespace-when-reexporting/32145077#32145077", "title": "Haskell namespace when reexporting", "body": "<p>The constructors for <code>HostPreference</code> are not exported, the <code>streaming-commons</code> package intends for them to be private, if I am to judge by what is exported.  Instead, the documentation suggests using <code>OverloadedStrings</code> and typing string literals to get the different values:</p>\n\n<blockquote>\n  <p><code>data HostPreference</code></p>\n  \n  <p>Which host to bind.</p>\n  \n  <p>Note: The <code>IsString</code> instance recognizes the following special values:</p>\n  \n  <p><code>*</code> means <code>HostAny</code></p>\n  \n  <p><code>*4</code> means <code>HostIPv4</code></p>\n  \n  <p><code>!4</code> means <code>HostIPv4Only</code></p>\n  \n  <p><code>*6</code> means <code>HostIPv6</code></p>\n  \n  <p><code>!6</code> means <code>HostIPv6Only</code></p>\n  \n  <p>Any other values is treated as a hostname. As an example, to bind to the IPv4 local host only, use <code>\"127.0.0.1\"</code>.</p>\n</blockquote>\n\n<p>So in your <code>Server.hs</code>, just enable <code>OverloadedStrings</code> and then where ever you're trying to use <code>HostAny</code> just type <code>\"*\"</code> instead.</p>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "accepted_answer_id": 32145077, "answer_count": 1, "score": 2, "last_activity_date": 1440173988, "creation_date": 1440171722, "question_id": 32144387, "link": "https://stackoverflow.com/questions/32144387/haskell-namespace-when-reexporting", "title": "Haskell namespace when reexporting", "body": "<p>I am not sure how the namespace works in the following case :</p>\n\n<p><a href=\"https://hackage.haskell.org/package/streaming-commons-0.1.12.1/docs/src/Data-Streaming-Network.html\" rel=\"nofollow\">Data.Streaming.Network</a> reexports HostPreference from  <a href=\"https://hackage.haskell.org/package/streaming-commons-0.1.12.1/docs/src/Data-Streaming-Network-Internal.html#HostPreference\" rel=\"nofollow\">Data.Streaming.Network.Internal</a></p>\n\n<p>When I load up in ghci, I can see that the constructors are prefixed by the original namespace. </p>\n\n<pre><code>$ ghci                                                          \nGHCi, version 7.8.4: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\nPrelude&gt; import Data.Streaming.Network\nPrelude Data.Streaming.Network&gt; :info HostPreference\ndata HostPreference\n  = Data.Streaming.Network.Internal.HostAny\n  | Data.Streaming.Network.Internal.HostIPv4\n  | Data.Streaming.Network.Internal.HostIPv4Only\n  | Data.Streaming.Network.Internal.HostIPv6\n  | Data.Streaming.Network.Internal.HostIPv6Only\n  | Data.Streaming.Network.Internal.Host String\n        -- Defined in \u2018Data.Streaming.Network.Internal\u2019\n</code></pre>\n\n<p>But some program expect the bindings for the constructors to be available under the reexporting module Data.Streaming.Network.</p>\n\n<pre><code>Prelude Data.Streaming.Network&gt; :l src/Server.hs\n[1 of 1] Compiling Main             ( src/Server.hs, interpreted )\n\nsrc/Server.hs:14:58: Not in scope: data constructor \u2018HostAny\u2019\n</code></pre>\n\n<p>What is going on, who is correct ?</p>\n"}, {"tags": ["haskell", "monad-transformers"], "answers": [{"tags": [], "owner": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "is_accepted": false, "score": 2, "last_activity_date": 1440176391, "creation_date": 1440176391, "answer_id": 32145722, "question_id": 32144140, "link": "https://stackoverflow.com/questions/32144140/lift-a-function-with-a-monad-parameter-into-a-monad-transformer/32145722#32145722", "title": "Lift a function with a monad parameter into a monad transformer", "body": "<p>If we generalize <code>lmask_</code> to get rid of the <code>StateT Bool IO</code>, we get something like this:</p>\n\n<pre><code>lift1 :: (Monad m, Monad (t m), MonadTrans t) =&gt; (m a -&gt; m a) -&gt; (t m a -&gt; t m a)\nlift1 f term = do\n    x &lt;- term\n    lift (f (return x))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 2, "last_activity_date": 1440181876, "last_edit_date": 1495535196, "creation_date": 1440181876, "answer_id": 32147154, "question_id": 32144140, "link": "https://stackoverflow.com/questions/32144140/lift-a-function-with-a-monad-parameter-into-a-monad-transformer/32147154#32147154", "title": "Lift a function with a monad parameter into a monad transformer", "body": "<p>In general this is not possible without knowing something about the monad transformer. However, there is a way how to do this for all the standard monad transformers. See type class <a href=\"https://hackage.haskell.org/package/monad-control-1.0.0.4/docs/Control-Monad-Trans-Control.html#t:MonadBaseControl\" rel=\"nofollow noreferrer\"><code>MonadBaseControl</code></a>. It's superclass <code>MonadBase</code> defines what is the bottom monad in a monad transformer stack (which is <code>IO</code> for all stacks that include <code>IO</code>), and <code>MonadBaseControl</code> defines a way how to embed the monad into the base monad. Its instances are somewhat convoluted, but once they're defined, it's possible to lift all such functions like <code>mask_</code>.</p>\n\n<p>In your case, package <em>lifted-base</em> uses the above construction to re-define the standard <code>IO</code> functions lifted to <code>MonadBaseControl</code>. In particular, there is <a href=\"https://hackage.haskell.org/package/lifted-base-0.2.3.6/docs/Control-Exception-Lifted.html#v:mask_\" rel=\"nofollow noreferrer\"><code>mask_</code></a></p>\n\n<pre><code>mask_ :: MonadBaseControl IO m =&gt; m a -&gt; m a\n</code></pre>\n\n<p>which can be specialized to <code>StateT Bool IO a -&gt; StateT Bool IO a</code>, as <code>StateT s</code> has an instance of <code>MonadBaseControl</code>.</p>\n\n<p>See also <a href=\"https://stackoverflow.com/q/25102588/1333025\">Lift a function and its argument to a different monadic context</a>.</p>\n"}], "owner": {"reputation": 31, "user_id": 5252449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45a34cfd6570b8df51f97e70b8c81f61?s=128&d=identicon&r=PG&f=1", "display_name": "downwards-spiral", "link": "https://stackoverflow.com/users/5252449/downwards-spiral"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1440181876, "creation_date": 1440170872, "question_id": 32144140, "link": "https://stackoverflow.com/questions/32144140/lift-a-function-with-a-monad-parameter-into-a-monad-transformer", "title": "Lift a function with a monad parameter into a monad transformer", "body": "<p>I want to lift a function like <a href=\"https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#v:mask_\" rel=\"nofollow\"><code>mask_ :: IO a -&gt; IO a</code></a> to create a function with this signature: <code>lmask_ :: StateT Bool IO a -&gt; StateT IO a</code>.</p>\n\n<p>My problem is, how to handle the callback/first parameter? Wouldn't the following code be incorrect since it would execute the callback before <code>mask_</code>'s code?</p>\n\n<pre><code>lmask_ :: StateT Bool IO a -&gt; StateT Bool IO a\nlmask_ m = do\n  r &lt;- m\n  lift (mask_ (return r))\n</code></pre>\n\n<p>Is there some general way to do this? A helper like <code>lift1 :: MonadTrans t =&gt; (m a -&gt; m a) -&gt; (t m a -&gt; t m a)</code>?</p>\n"}, {"tags": ["haskell", "abstract-data-type"], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440166311, "post_id": 32142424, "comment_id": 52174390, "body": "I almost understand, but I&#39;m a beginner. Can you elaborate a bit?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440166576, "post_id": 32142424, "comment_id": 52174609, "body": "It&#39;s a bit less cryptic if I look at <code>:t tofu</code>, actually. Though I&#39;m still a bit foggy."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440166761, "post_id": 32142424, "comment_id": 52174761, "body": "Thanks. I get the chain of reasoning that leads to <code>* -&gt; (* -&gt; *) -&gt; *</code>. What I&#39;m struggling with is how that fits into the bigger picture, particularly the idea that &quot;classes take type parameters and return a <code>Constraint</code>&quot;."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440166858, "post_id": 32142424, "comment_id": 52174849, "body": "Just like <code>(Num a)</code> is a constraint (corresponding to the <code>Num</code> class), <code>Tofu t</code> is  a constraint. (Fully applied) constraints like <code>Tofu t</code> have kind <code>Constraint</code>."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1440167201, "post_id": 32142424, "comment_id": 52175130, "body": "I think one thing (though not the only thing) that confuses me here is that the constraint seems to float free. I see that it says, roughly, that the class <code>Tofu</code> has defined (?) a constraint that (one of the types it expects?) must be of kind <code>* -&gt; (* -&gt; *) -&gt; *</code>. But that understanding feels a bit shaky (for example, what if there were two arguments to <code>Tofu</code>?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1440168168, "post_id": 32142424, "comment_id": 52175839, "body": "@raxacoricofallapatorius Think of typeclass declarations as defining special data types (the <code>Constraint</code>s; though they are often called <i>dictionaries</i>). So your class <code>Tofu</code> defines a type <code>Constraint</code>. It has an argument <code>t</code> which has kind <code>* -&gt; (* -&gt; *) -&gt; *</code> and so the type of the type-constructor <code>Tofu</code> is a function from the type of <code>t</code> to <code>Constraint</code>.  If <code>Tofu</code> had two arguments <code>t</code> and <code>s</code> you&#39;d have that the type of <code>Tofu</code> would be &quot;type of <code>t</code>&quot; <code>-&gt;</code> &quot;type of <code>s</code>&quot; <code>-&gt;Constraint</code>, etc."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1440168341, "post_id": 32142424, "comment_id": 52175951, "body": "@raxacoricofallapatorius To get a better understanding on <code>class</code> and <code>instance</code> declaration it&#39;s a good thing to know how they are translated into <code>Core</code>. <code>class</code>es becomes <code>data</code> declarations for dictionaries (or <code>Constraint</code>s if you want) while <code>instance</code>s become functions from dictionaries to dictionaries (i.e. given certain <code>Constraint</code>s (the parent classes context) they return a new <code>Constraint</code> that represent the current instance)."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 6, "last_activity_date": 1440195859, "last_edit_date": 1440195859, "creation_date": 1440166014, "answer_id": 32142424, "question_id": 32142136, "link": "https://stackoverflow.com/questions/32142136/why-does-the-kind-of-my-type-have-constraint-at-the-end/32142424#32142424", "title": "Why does the kind of my type have &#39;-&gt; Constraint&#39; at the end?", "body": "<p><code>t</code> is a type parameter of the class <code>Tofu</code> of kind <code>* -&gt; (* -&gt; *) -&gt; *</code> (written <code>t :: * -&gt; (* -&gt; *) -&gt; *</code>). \nThis is the inferred type of <code>t</code> by GHC because in the absence of <code>-XPolyKinds</code>, GHC tries to default all type parameters to kind <code>*</code>. Thus GHC assumes <code>a</code> has kind <code>*</code> (though nothing in your signature makes this the only choice). </p>\n\n<p>The <em>type</em> constructor <code>(-&gt;)</code> has <em>kind</em> <code>* -&gt; * -&gt; *</code>. Since <code>j a</code> appears as a parameter to <code>(-&gt;)</code>, <code>j a</code> must have kind <code>*</code>. Since GHC has assumed that <code>a</code> has kind <code>*</code>, <code>j</code> is a type that takes something of kind <code>*</code> and returns something of kind <code>*</code>. Thus:</p>\n\n<pre><code>j :: * -&gt; *\n</code></pre>\n\n<p>Since <code>t</code> is applied to both <code>a</code> and <code>j</code>, <code>t</code> has the kind <code>* -&gt; (* -&gt; *) -&gt; *</code>, because the first argument <code>a</code> has kind <code>*</code> and the second argument <code>j</code> has kind <code>*-&gt;*</code>, and the overall type <code>t a j</code> <em>must</em> have kind <code>*</code> since it is also a parameter of the type <code>(-&gt;)</code>.</p>\n\n<p>Classes are just types taking type parameters (just like <code>data Foo a b</code>), except <code>Foo a b</code> has kind <code>*</code> while <code>Tofu t</code> has kind a special kind <code>Constraint</code>. Thus the kind of <code>Tofu</code> is:</p>\n\n<pre><code>(* -&gt; (* -&gt; *) -&gt; *) -&gt; Constraint\n</code></pre>\n\n<p>as GHC indicates. <code>Constraint</code> is just the kind given to constraints. In the signature</p>\n\n<pre><code>(Num a) =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p><code>(Num a)</code> is a <em>type</em> of <em>kind</em> <code>Constraint</code>.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 2, "accepted_answer_id": 32142424, "answer_count": 1, "score": 5, "last_activity_date": 1440195859, "creation_date": 1440165274, "last_edit_date": 1440166416, "question_id": 32142136, "link": "https://stackoverflow.com/questions/32142136/why-does-the-kind-of-my-type-have-constraint-at-the-end", "title": "Why does the kind of my type have &#39;-&gt; Constraint&#39; at the end?", "body": "<p>The Haskell tutorial I'm reading has a section introducing the basics of type <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#kinds-and-some-type-foo\"><em>kinds</em></a>, and describes a type class</p>\n\n<pre><code>class Tofu t where  \n    tofu :: j a -&gt; t a j \n</code></pre>\n\n<p>as having the kind</p>\n\n<pre><code>* -&gt; (* -&gt; *) -&gt; *\n</code></pre>\n\n<p>I understand that, but when I enter <code>:k Tofu</code> in GHCi, I get</p>\n\n<pre><code>Tofu :: (* -&gt; (* -&gt; *) -&gt; *) -&gt; GHC.Prim.Constraint\n</code></pre>\n\n<p>What is <code>GHC.Prim.Constraint</code> and why does the kind of <code>Tofu</code> have this form rather than simply <code>* -&gt; (* -&gt; *) -&gt; *</code>?</p>\n"}, {"tags": ["haskell", "sandbox", "cabal"], "comments": [{"owner": {"reputation": 91, "user_id": 2663390, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/xp0Kw.jpg?s=128&g=1", "display_name": "srncristea", "link": "https://stackoverflow.com/users/2663390/srncristea"}, "edited": false, "score": 1, "creation_date": 1440166234, "post_id": 32141628, "comment_id": 52174318, "body": "fix it, change on helloworld.cabal at  <b>build-depends:       base &gt;=4.7 &amp;&amp; &lt;4.9</b>."}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 2663390, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/xp0Kw.jpg?s=128&g=1", "display_name": "srncristea", "link": "https://stackoverflow.com/users/2663390/srncristea"}, "edited": false, "score": 0, "creation_date": 1440166629, "post_id": 32142598, "comment_id": 52174664, "body": "you right, already change the file, thanks for your replay ;)"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 1, "last_activity_date": 1440166493, "creation_date": 1440166493, "answer_id": 32142598, "question_id": 32141628, "link": "https://stackoverflow.com/questions/32141628/cabal-sandbox-dependencies-not-found/32142598#32142598", "title": "cabal sandbox dependencies not found", "body": "<p>It looks like your version constraints want you to use GHC 7.10- which bundles base version 4.8- while you're using GHC 7.8 and base 4.7. You could:</p>\n\n<ul>\n<li>Modify the cabal file and its base version bounds</li>\n<li>Switch to a different version of GHC</li>\n<li>Try building with <a href=\"https://github.com/commercialhaskell/stack#readme\" rel=\"nofollow\">stack</a>, which will automatically detect those kinds of things during stack init and then offer to install the appropriate GHC for you.</li>\n</ul>\n"}], "owner": {"reputation": 91, "user_id": 2663390, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/xp0Kw.jpg?s=128&g=1", "display_name": "srncristea", "link": "https://stackoverflow.com/users/2663390/srncristea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1440264423, "creation_date": 1440163915, "last_edit_date": 1440264423, "question_id": 32141628, "link": "https://stackoverflow.com/questions/32141628/cabal-sandbox-dependencies-not-found", "title": "cabal sandbox dependencies not found", "body": "<p>I have a problem when I work with cabal sandbox, I created a sandbox  for a 'hello world' application but when I try to run <code>cabal install --only-dependencies</code> I get the following error:</p>\n\n<pre><code>$ cabal install --only-dependencies\nResolving dependencies... cabal: Could not resolve dependencies:\ntrying: haskeline-0.7.2.1/installed-dad... (user goal) next goal:\nhelloworld (user goal) rejecting: helloworld-0.1.0.0 (conflict:\nhaskeline =&gt; base==4.7.0.2/installed-918..., helloworld =&gt; base&gt;=4.8\n&amp;&amp; &lt;4.9) Dependency tree exhaustively searched.\n\nNote: when using a sandbox, all packages are required to have\nconsistent dependencies. Try reinstalling/unregistering the offending\npackages or recreating the sandbox.\n</code></pre>\n\n<p>I want to mention that if I try to run on this sandbox <em>cabal repl</em> I get the error.</p>\n\n<pre><code>$ cabal repl\nPackage has never been configured. Configuring with default flags. If\nthis fails, please run configure manually. Resolving dependencies...\nConfiguring helloworld-0.1.0.0... cabal: At least the following\ndependencies are missing: base ==4.8.*\n</code></pre>\n\n<p>If I run cabal repl outside of sandbox everything is working ok.</p>\n\n<p>If any of you have an idea pls share with me :),</p>\n\n<p>thanks\nsorin</p>\n"}, {"tags": ["haskell", "shake-build-system"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1440162594, "post_id": 32140397, "comment_id": 52171681, "body": "There does not seem to be much support for that. See <a href=\"https://groups.google.com/forum/#!topic/shake-build-system/ZPyTIfVL-dA\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/shake-build-system/ZPyTIfVL-&zwnj;&#8203;dA</a> for a recent discussion of a related proposal on the shake mailing list."}], "answers": [{"comments": [{"owner": {"reputation": 1285, "user_id": 2402979, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/829bc316fab5f901254854af172a6778?s=128&d=identicon&r=PG", "display_name": "Fr0stBit", "link": "https://stackoverflow.com/users/2402979/fr0stbit"}, "edited": false, "score": 0, "creation_date": 1440186672, "post_id": 32143305, "comment_id": 52185901, "body": "Fantastic solution! Still would be nice to have a syncronous version as you said to.."}, {"owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "reply_to_user": {"reputation": 1285, "user_id": 2402979, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/829bc316fab5f901254854af172a6778?s=128&d=identicon&r=PG", "display_name": "Fr0stBit", "link": "https://stackoverflow.com/users/2402979/fr0stbit"}, "edited": false, "score": 0, "creation_date": 1440188172, "post_id": 32143305, "comment_id": 52186582, "body": "@TheArtist: I raised a ticket to add it - shouldn&#39;t be too hard: <a href=\"https://github.com/ndmitchell/shake/issues/293\" rel=\"nofollow noreferrer\">github.com/ndmitchell/shake/issues/293</a>"}, {"owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "edited": false, "score": 0, "creation_date": 1450555143, "post_id": 32143305, "comment_id": 56491376, "body": "I&#39;ll remark that this approach doesn&#39;t work so well for more complicated build systems which have a more heavy Haskell component, because there may be a large number of rules which you don&#39;t want to print output for, but they&#39;ll show up in the count. (Also, countTodo isn&#39;t perfectly accurate.)"}], "tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 1, "last_activity_date": 1440168374, "creation_date": 1440168374, "answer_id": 32143305, "question_id": 32140397, "link": "https://stackoverflow.com/questions/32140397/how-to-show-progress-in-shake/32143305#32143305", "title": "How to show progress in Shake?", "body": "<p>Values of type <code>Progress</code> are currently only available as an argument to the function stored in <code>shakeProgress</code>. You can obtain the <code>Progress</code> whenever you want with:</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\nimport Development.Shake\nimport Data.IORef\nimport Data.Monoid\nimport Control.Monad\n\nmain = do\n    ref &lt;- newIORef $ return mempty\n    shakeArgs shakeOptions{shakeProgress = writeIORef ref} $ do\n         want [\"test\" ++ show i | i &lt;- [1..5]]\n         \"test*\" %&gt; \\out -&gt; do\n             Progress{..} &lt;- liftIO $ join $ readIORef ref\n             putNormal $\n                \"[\" ++ show (countBuilt + countSkipped + 1) ++\n                \"/\" ++ show (countBuilt + countSkipped + countTodo) ++\n                \"] \" ++ out\n             writeFile' out \"\"\n</code></pre>\n\n<p>Here we create an <code>IORef</code> to squirrel away the argument passed to <code>shakeProgress</code>, then retrieve it later when running the rules. Running the above code I see:</p>\n\n<pre><code>[1/5] test5\n[2/5] test4\n[3/5] test3\n[4/5] test2\n[5/5] test1\n</code></pre>\n\n<p>Running at a higher level of parallelism gives less precise results - initially there are only 3 items in todo (Shake increments <code>countTodo</code> as it finds items todo, and spawns items as soon as it knows about any of them), and there are often two rules running at the same index (there is no information about how many are in progress). Given knowledge of your specific rules, you could refine the output, e.g. storing an <code>IORef</code> you increment to ensure the index was monotonic.</p>\n\n<p>The reason this code is somewhat convoluted is that the <code>Progress</code> information was intended to be used for asynchronous progress messages, although your approach seems perfectly valid. It may be worth introducing a <code>getProgress :: Action Progress</code> function for synchronous progress messages.</p>\n"}], "owner": {"reputation": 1285, "user_id": 2402979, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/829bc316fab5f901254854af172a6778?s=128&d=identicon&r=PG", "display_name": "Fr0stBit", "link": "https://stackoverflow.com/users/2402979/fr0stbit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 1, "accepted_answer_id": 32143305, "answer_count": 1, "score": 2, "last_activity_date": 1440168374, "creation_date": 1440160241, "question_id": 32140397, "link": "https://stackoverflow.com/questions/32140397/how-to-show-progress-in-shake", "title": "How to show progress in Shake?", "body": "<p>I am trying to figure out how can i take the progress info from a Progress type (in Development.Shake.Progress) to output it before executing a command. The possible desired output would be:</p>\n\n<pre><code>[1/9] Compiling src/Window/Window.cpp\n[2/9] Compiling src/Window/GlfwError.cpp\n[3/9] Compiling src/Window/GlfwContext.cpp\n[4/9] Compiling src/Util/MemTrack.cpp\n...\n</code></pre>\n\n<p>For now i am simulating this using some IORef that keeps the total (initially set to the sum of the source files) and a count that i increase before executing each build command, but this seems like a hackish solution to me.</p>\n\n<p>On top of that this solution seems to work correctly on clean builds, but misbehaves on partial builds as the sum that displayed is still the total of all the source files.</p>\n\n<p>With access to a Progress data type i will be able to calculate this fraction correctly using its countSkipped, countBuild, and countTodo members (see Progress.hs:53), but i am still not sure how i can i achieve this.</p>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1440157474, "post_id": 32139212, "comment_id": 52168495, "body": "<code>Num</code> is the class of numbers (including integers, floats, rational numbers etc.)... I wouldn&#39;t expect a Matrix to be a number."}, {"owner": {"reputation": 1284, "user_id": 5209349, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f5341e747308691d40f30d79ffd75f9?s=128&d=identicon&r=PG", "display_name": "Michael Benfield", "link": "https://stackoverflow.com/users/5209349/michael-benfield"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 2, "creation_date": 1440158406, "post_id": 32139212, "comment_id": 52169119, "body": "Obviously <code>Num</code> is intended to be used for numbers. Mathematically (and apparently, programatically), it&#39;s less clear than one might think what is a number and what is not. Is <code>Num</code> supposed to only be for subrings of the complex numbers? That can&#39;t be right; there are lots of other rings that have a sensible <code>Num</code> implementation. I&#39;m asking if the Haskell community has a consensus on what a number is for the purposes of <code>Num</code>."}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 3, "creation_date": 1440160132, "post_id": 32139212, "comment_id": 52170141, "body": "It is my understanding (sorry, no references at present) that <code>Num</code> is a bit of a wart. It has been recognized time and time again (references?) that it should be replaced with a mathematically sound and thought-through hierarchy of typeclasses corresponding to various algebraic structures. As you&#39;ve noticed, though, people haven&#39;t been able to agree on anything. I am bugged by this myself, and frequently find myself copying my own self-made such hierarchy. It is not nice, and has many problems. I really wish we could all agree on something compatible with mathematics :)"}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 4, "creation_date": 1440160330, "post_id": 32139212, "comment_id": 52170251, "body": "As for the question &quot;should a type like <code>Matrix</code> be an instance of <code>Num</code>?&quot;: No, absolutely not, as it does not at all fit into the interface <code>Num</code> represents (never mind that that interface is poorly designed). You give a perfect example yourself."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 1, "creation_date": 1440161822, "post_id": 32139212, "comment_id": 52171179, "body": "@gspr: yeah, the <a href=\"http://hackage.haskell.org/package/numeric-prelude\" rel=\"nofollow noreferrer\">numerical prelude</a> just is a bit to ambituous, too bulky to catch on. \u2014 IMO the <code>Num</code> class is actually not so bad (at least since it doesn&#39;t require <code>Show</code> anymore), it does exactly the right thing for the numerical types that are relevant for most users. For more advanced number-similar things it&#39;s not useful, but well... just don&#39;t write instances for those, then! There&#39;s no good reason to do so, as weaker classes are available that do the job."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1440162196, "last_edit_date": 1440162196, "creation_date": 1440161594, "answer_id": 32140839, "question_id": 32139212, "link": "https://stackoverflow.com/questions/32139212/should-i-instantiate-the-num-type-class-for-a-type-that-questionably-fits-the-in/32140839#32140839", "title": "Should I instantiate the Num type class for a type that questionably fits the interface?", "body": "<p>Don't make <code>Num</code> instances for non-rings. It's just confusing.</p>\n\n<p>Of course, you can often define instances which do <em>something useful</em>, but if it's not completely obvious <em>what</em> then better just define a plain function with descriptive name, or some weaker class instance with better-defined semantics. If somebody wants to use this with short operators or polymorphic <code>Num</code> functions, they can still define that locally in their own module (preferrably with a simple <code>newtype</code> wrapper.</p>\n\n<p>In particular, a <code>Num</code>-instance for general (dynamically-sized) matrices is problematic because it's not obvious what should happen when the dimensions don't match. What behaviour do you want to generalise?\n<br>\nWhat I would consider a good instance is matrices of fixed quadratic size (i.e. linear endomorphisms on a given vector space). In this case, multiplication is evidently composition<sup>&dagger;</sup>, and number literals would be taken as constant-diagonal matrices, so <code>1</code> is actually multiplicative identity. Like what you write in maths contexts.</p>\n\n<p>But that's not compatible with your idea of arbitrarily choosing the size of number-literals as 1&times;1! People would expect <code>2 * m</code> to work, but it crashes. Well, better crash than give unexpected results; unfortunately it's tempting to come up with some clever way of defining multiplication in a suitable way. For instance, we could block-diagonal-copy the smaller matrix until it's large enough, perhaps only do this in the 1&times;1 case... well, Matlab does this kind of ad-hoc stuff, but please! let's not take <a href=\"http://www.parallelnetz.de/ScriptingHater.html#MatLab\" rel=\"nofollow\">such a horrible language</a> as a model for what's good ideas.</p>\n\n<p>If you have something that's obviously an additive group, indeed vector space, then make it a <a href=\"http://hackage.haskell.org/package/vector-space-0.10.2/docs/Data-VectorSpace.html\" rel=\"nofollow\"><code>VectorSpace</code></a>! If you also have a multiplication, but it's partial, then better only define it as a plain function.</p>\n\n<p>If you fancy, you can define instances for the fine finely staggered <a href=\"http://hackage.haskell.org/package/numeric-prelude\" rel=\"nofollow\">numeric-prelude</a> classes. Personally (though I like the idea of this project) I couldn't yet be bothered to use it anywhere, because it's rather an efford to understand the hierarchy.</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub><em>Or is it</em>? Trouble already starts here, I think <a href=\"http://hackage.haskell.org/package/hmatrix\" rel=\"nofollow\">hmatrix</a> actually implements <code>*</code> on matrices as element-wise multiplication. That's more horrible than Matlab!</sub></p>\n"}], "owner": {"reputation": 1284, "user_id": 5209349, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f5341e747308691d40f30d79ffd75f9?s=128&d=identicon&r=PG", "display_name": "Michael Benfield", "link": "https://stackoverflow.com/users/5209349/michael-benfield"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 32140839, "answer_count": 1, "score": 3, "last_activity_date": 1440162196, "creation_date": 1440156683, "question_id": 32139212, "link": "https://stackoverflow.com/questions/32139212/should-i-instantiate-the-num-type-class-for-a-type-that-questionably-fits-the-in", "title": "Should I instantiate the Num type class for a type that questionably fits the interface?", "body": "<p>It seems to me that the <code>Num</code> type class consists of a pretty arbitrary collection of functions. There are lots of types that naturally have <code>+</code> and <code>*</code> operations, but are problematic as instances of <code>Num</code>, due to the presence of <code>abs</code>, <code>signum</code>, and <code>fromInteger</code>. I can't find any discussion of the design philosophy behind this class, so it's not clear to me if there is a sensible rationale here, or if it's an unfortunate historical oddity.</p>\n\n<p>I'll give an illustration of my question. Suppose I'm implementing a <code>Matrix</code> class, with components that are <code>Double</code>s. I can obviously implement <code>+</code>, <code>*</code>, <code>-</code>, and <code>negate</code>. Maybe <code>fromInteger x</code> could give a 1x1 <code>Matrix</code> with component the <code>Double</code> value <code>fromInteger x</code>. It's less obvious what to do with <code>abs</code> and <code>signum</code>, but I could come up with something that satisfies the rule (from the class's documentation):</p>\n\n<pre><code>abs x * signum x == x\n</code></pre>\n\n<p>The objection to this idea is that my instance of <code>Num</code> is not fulfilling some implicit rules that people expect of <code>Num</code>. My <code>*</code> is a partial function (assuming the size of the <code>Matrix</code> is a runtime parameter), which is not true for the usual instances like <code>Double</code> and <code>Int</code>. And it doesn't commute. Whatever I come up with for <code>abs</code> and <code>signum</code> are not going to satisfy everyone's expectations.</p>\n\n<p>The objection to this objection is that my <code>Matrix</code> multiplication is going to be a partial function anyway (and in this kind of type that seems to be accepted in the Haskell community), so why does it matter if it's <code>*</code> in particular that is the partial function? And if my <code>abs</code> and <code>signum</code> satisfy the rule from the documentation, then I've fulfilled my side of the bargain. Anyone relying on anything more from a <code>Num</code> instance is in the wrong.</p>\n\n<p>Should a type like <code>Matrix</code> be an instance of <code>Num</code>?</p>\n"}, {"tags": ["javascript", "angularjs", "node.js", "haskell", "yesod"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1440148109, "post_id": 32135704, "comment_id": 52163138, "body": "Yes, it&#39;s definitely possible. To see an example, look at this: <a href=\"https://github.com/snoyberg/yesod-js\" rel=\"nofollow noreferrer\">github.com/snoyberg/yesod-js</a> (Although I&#39;m not sure how updated angular is in the repo)"}], "answers": [{"comments": [{"owner": {"reputation": 2274, "user_id": 5169236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a549deb942a43c8ea746f15dc629dde4?s=128&d=identicon&r=PG&f=1", "display_name": "ralh", "link": "https://stackoverflow.com/users/5169236/ralh"}, "reply_to_user": {"reputation": 77, "user_id": 3079733, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6bd1062db354891f37ad25e5f1605cc1?s=128&d=identicon&r=PG&f=1", "display_name": "Messing", "link": "https://stackoverflow.com/users/3079733/messing"}, "edited": false, "score": 1, "creation_date": 1440146506, "post_id": 32135889, "comment_id": 52162174, "body": "Be aware that if you&#39;re just learning programming, Haskell is probably not a good place to start. It&#39;s a beatiful language, but might be pretty hard for a beginner. And learning a framework like Yesod on top of that will make it even harder."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 7, "creation_date": 1440159640, "post_id": 32135889, "comment_id": 52169847, "body": "@ralh Your mileage (and the OPs) may vary, but anecdotally Haskell is relatively easier for absolute beginners than for people with some programming experience, as in the first case there are less habits you have to unlearn or suspend. In any case, it might indeed be useful for a beginner to play a bit with a microframework like Scotty or Spock before moving on to a fully-featured one like Yesod."}], "tags": [], "owner": {"reputation": 2274, "user_id": 5169236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a549deb942a43c8ea746f15dc629dde4?s=128&d=identicon&r=PG&f=1", "display_name": "ralh", "link": "https://stackoverflow.com/users/5169236/ralh"}, "is_accepted": true, "score": 8, "last_activity_date": 1440146236, "creation_date": 1440146236, "answer_id": 32135889, "question_id": 32135704, "link": "https://stackoverflow.com/questions/32135704/is-it-possible-to-have-backend-written-in-haskell-and-frontend-with-javascript/32135889#32135889", "title": "Is it possible to have backend written in Haskell and frontend with Javascript?", "body": "<p>Your server simply exposes a HTTP API to your angular app. You can implement that functionality in any web framework (or even without a framework) in pretty much any language. </p>\n\n<p>Yesod is probably the most popular and well documented Haskell framework (personal opinion), so I guess you can start with that. </p>\n"}], "owner": {"reputation": 77, "user_id": 3079733, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6bd1062db354891f37ad25e5f1605cc1?s=128&d=identicon&r=PG&f=1", "display_name": "Messing", "link": "https://stackoverflow.com/users/3079733/messing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1185, "favorite_count": 0, "accepted_answer_id": 32135889, "answer_count": 1, "score": 4, "last_activity_date": 1440146236, "creation_date": 1440145655, "question_id": 32135704, "link": "https://stackoverflow.com/questions/32135704/is-it-possible-to-have-backend-written-in-haskell-and-frontend-with-javascript", "title": "Is it possible to have backend written in Haskell and frontend with Javascript?", "body": "<p>currently I'm working on this project (<a href=\"https://github.com/Giegling/addressbook\" rel=\"nofollow\">https://github.com/Giegling/addressbook</a>) and for the backend I use Node.js with Express framework, for the frontend Angularjs. Is it possible to \"translate\" the backend to Haskell without touching the frontend? If it's possible, which framework should I use? (Yesod, scotty...) </p>\n\n<p>Thanks</p>\n"}, {"tags": ["algorithm", "haskell", "search"], "comments": [{"owner": {"reputation": 30659, "user_id": 1210053, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/8cee821e7bf4acaa7f0de12d603b9f1d?s=128&d=identicon&r=PG", "display_name": "Nico Schertler", "link": "https://stackoverflow.com/users/1210053/nico-schertler"}, "edited": false, "score": 3, "creation_date": 1440143207, "post_id": 32134856, "comment_id": 52160348, "body": "A Trie seems appropriate."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1440144235, "post_id": 32134856, "comment_id": 52160957, "body": "Is there a reason why you are providing only a link to the code and not the code directly in the question? To me it seems like you are just hurting easiness of copy &amp; pasting and highlighting (ideone gets it wrong)... sure a link to ideone may be useful but I don&#39;t see any reason not to paste the code <i>also</i> in the question."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1440144553, "post_id": 32134856, "comment_id": 52161123, "body": "BTW you are mistaken about the ordered tree, you do not have to check that many elements.  If <code>[1,1] .. [1,100] and [2,1] .. [2,100]</code> are in the tree, then to get to <code>[2,1]</code> you&#39;d need to check, say, <code>[1,100]</code>, <code>[2,50]</code>, <code>[2,25]</code>, <code>[2,12]</code>, <code>[2,6]</code>, <code>[2,3]</code>, <code>[2,1]</code> -- i.e. a logarithmic number of elements.  This is usually pretty fast: the logarithm of a billion is only 30.  Still I agree with Nico that a trie seems perfect -- then you can even have infinitely many elements! :-)"}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 5250928, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/536ea0e65e5491dbcb9480f9bb180838?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/5250928/petr"}, "is_accepted": false, "score": 3, "last_activity_date": 1440154753, "last_edit_date": 1440154753, "creation_date": 1440144649, "answer_id": 32135408, "question_id": 32134856, "link": "https://stackoverflow.com/questions/32134856/matching-against-longest-leading-substring/32135408#32135408", "title": "Matching against longest leading substring", "body": "<p>A <em>trie</em> would be a good solution. In your case, values would be just <code>()</code>, marking that a given node corresponds to an end of a list. Then, given a list, you'll just traverse the trie as far down as possible, and the last encountered value will mark the longest matched list.</p>\n\n<p>A <code>ByteString</code> based trie in <code>Data.Trie</code> offers <a href=\"https://hackage.haskell.org/package/bytestring-trie-0.2.4.1/docs/Data-Trie.html#v:match\" rel=\"nofollow\"><code>match</code></a>, which seems to be exactly what you're looking for (if 8-byte chars keys would be sufficient for you):</p>\n\n<pre><code>-- | Given a query, find the longest prefix with an associated value in \n-- the trie, returning that prefix, it's value, and the remaining string.\nmatch :: Trie a -&gt; ByteString -&gt; Maybe (ByteString, a, ByteString)\n</code></pre>\n\n<p>There is also another package <a href=\"http://hackage.haskell.org/package/list-tries\" rel=\"nofollow\">list-tries</a>, which has more generic keys. I'm not sure if there is an exact function like <code>match</code> above, but definitely it'd be possible to implement one.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1440154753, "creation_date": 1440142749, "question_id": 32134856, "link": "https://stackoverflow.com/questions/32134856/matching-against-longest-leading-substring", "title": "Matching against longest leading substring", "body": "<p>I'm looking to return the best match of a list against a collection of lists.</p>\n\n<p><code>x</code> matches against a list in the collection if the list in the collection of length n matches the first n elements of <code>x</code>.</p>\n\n<p>e.g. <code>[1,2,3]</code> matches against <code>[1,2]</code> but <code>[1,2]</code> does not match against <code>[1,2,3]</code>.</p>\n\n<p>I want the function to return the \"best\" match, that is, the match that is the longest.</p>\n\n<p>e.g.</p>\n\n<pre><code>bestMatch [1,2,3,3] [[1],[1,2,3],[1,2],[1,2,3,2],[1,2,3,4]] == Just [1,2,3]\n</code></pre>\n\n<p>Obviously a list here isn't the best data structure, and I'd rather use a standard structure and search rather than roll my own, any ideas what I should be using and how?</p>\n\n<p>I don't think hash tables will work because the matches aren't exact. I then thought about searching against an ordered tree, but it has the problem that if I search for <code>[1,2,100]</code>, I'll get <code>[1,2,99]</code>, <code>[1,2,98]</code>, ... etc before getting the correct answer, <code>[1,2]</code>. Could use a hash of hashes (and so-on down the tree) but that seems like a lot of overhead.</p>\n\n<p>(A linear search list based implementation is <a href=\"http://ideone.com/aKpl3A\" rel=\"nofollow\">here</a>)</p>\n"}, {"tags": ["haskell", "yesod", "haskell-stack"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1440132093, "post_id": 32131757, "comment_id": 52155629, "body": "This looks somewhat like <a href=\"https://github.com/commercialhaskell/stack/issues/795\" rel=\"nofollow noreferrer\">issue 795</a> and/or the related issue 466."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1440743133, "post_id": 32131757, "comment_id": 52408177, "body": "If that&#39;s the problem, [this workaround(<a href=\"https://www.fpcomplete.com/blog/2015/08/stack-ghc-windows#workaround--shorter-paths\" rel=\"nofollow noreferrer\">fpcomplete.com/blog/2015/08/&hellip;</a>) may help out."}, {"owner": {"reputation": 31, "user_id": 5250040, "user_type": "registered", "profile_image": "https://graph.facebook.com/902602179804944/picture?type=large", "display_name": "Vitor Coimbra", "link": "https://stackoverflow.com/users/5250040/vitor-coimbra"}, "edited": false, "score": 0, "creation_date": 1441460143, "post_id": 32131757, "comment_id": 52694437, "body": "Hey, thanks for the comments. Unfortunately, the workaround mentioned by Michael was not enough for me. I guess I&#39;ll have to wait until this gets completely addressed then?"}], "owner": {"reputation": 31, "user_id": 5250040, "user_type": "registered", "profile_image": "https://graph.facebook.com/902602179804944/picture?type=large", "display_name": "Vitor Coimbra", "link": "https://stackoverflow.com/users/5250040/vitor-coimbra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 262, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1441460106, "creation_date": 1440126573, "last_edit_date": 1441460106, "question_id": 32131757, "link": "https://stackoverflow.com/questions/32131757/stack-build-results-in-exitfailure-1-with-yesod", "title": "stack build results in ExitFailure 1 with Yesod", "body": "<p>I'm trying to get started with Yesod development on Windows, but I cannot seem to build the generated bare app. I followed all the <a href=\"http://www.yesodweb.com/page/quickstart\" rel=\"nofollow\">quick start guide</a> steps. Specifically, it fails on step 4, when I execute the</p>\n\n<pre><code>stack build\n</code></pre>\n\n<p>command. The following output is generated.</p>\n\n<pre><code>C:\\Users\\Vitor Coimbra\\testeyesod&gt;stack build\nSetting codepage to UTF-8 (65001) to ensure correct output from GHC\nTeste-0.0.0: build\nPreprocessing library Teste-0.0.0...\nIn-place registering Teste-0.0.0...\nPreprocessing executable 'Teste' for Teste-0.0.0...\nLinking .stack-work\\dist\\x86_64-windows\\Cabal-1.22.4.0\\build\\Teste\\Teste.exe ...\nghc.exe: could not execute: C:\\Program Files\\Haskell Platform\\7.10.2-a\\lib/../mingw/bin/gcc.exe\nghc: warning: _tzset from msvcrt is linked instead of __imp__tzset\n\n--  While building package Teste-0.0.0 using:\n      C:\\\\Program Files\\\\Haskell Platform\\\\7.10.2-a\\\\bin\\\\runhaskell.exe -package=Cabal-1.22.4.0 -clear-package-db -global-package-db -package-db=C:\\Users\\Vitor Coimbra\\AppData\\Roaming\\stack\\snapshots\\x86_64-windows\\lts-3.1\\7.10.2\\pkgdb\\ C:\\Users\\VITORC~1\\AppData\\Local\\Temp\\stack5620\\Setup.hs --builddir=.stack-work\\dist\\x86_64-windows\\Cabal-1.22.4.0\\ build exe:Teste --ghc-options -hpcdir .stack-work\\dist\\x86_64-windows\\Cabal-1.22.4.0\\hpc\\.hpc\\ -ddump-hi -ddump-to-file\nProcess exited with code: ExitFailure 1\n</code></pre>\n\n<p>The project was created with the name Teste and with SQLite as the persistence layer.</p>\n"}, {"tags": ["haskell", "vector", "typeclass"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1440126787, "post_id": 32131352, "comment_id": 52154347, "body": "That basically just means you can&#39;t define this instance. An instance method can&#39;t have stricter requirements on its arguments than those given in the class definition."}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440129186, "post_id": 32131801, "comment_id": 52154897, "body": "Is there any way to abbreviate the <code>(ListIsomorphic l, Elem l a)</code> constraint?"}, {"owner": {"reputation": 28662, "user_id": 10311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ee697b9dc2411d50fb66a4f330ba4df?s=128&d=identicon&r=PG", "display_name": "porges", "link": "https://stackoverflow.com/users/10311/porges"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440129633, "post_id": 32131801, "comment_id": 52154992, "body": "Yes, with <code>ConstraintKinds</code> you can write <code>type ListLike l a = (ListIsomorphic l, Elem l a)</code>. Then use it like <code>someFunc :: (ListLike l a) =&gt; l a -&gt; ...</code>"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440129753, "post_id": 32131801, "comment_id": 52155035, "body": "Okay, sorry for the rain of related questions. It seems like I finally managed to get it to work now. Just let me know if this is a bad practice and is likely to break things later?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440136112, "post_id": 32131801, "comment_id": 52156872, "body": "@Viclib I don&#39;t know of any common complaints about this pattern."}], "tags": [], "owner": {"reputation": 28662, "user_id": 10311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ee697b9dc2411d50fb66a4f330ba4df?s=128&d=identicon&r=PG", "display_name": "porges", "link": "https://stackoverflow.com/users/10311/porges"}, "is_accepted": true, "score": 2, "last_activity_date": 1440126934, "creation_date": 1440126934, "answer_id": 32131801, "question_id": 32131352, "link": "https://stackoverflow.com/questions/32131352/how-do-i-create-a-listisomorphic-instance-for-vector-unboxed/32131801#32131801", "title": "How do I create a ListIsomorphic instance for Vector.Unboxed?", "body": "<p>You can't. Your <code>ListIsomorphic</code> class promises that <code>fromList</code> can be applied to <em>any</em> type <code>a</code>. However, the unboxed vector requires that <code>a</code> is an instance of <code>Unbox</code>.</p>\n\n<p>You could instead write a class <code>ListIsomorphicUnboxed</code> that has:</p>\n\n<pre><code>class ListIsomorphicUnboxed l where\n    fromListUnboxed :: (Unbox a) =&gt; [a] -&gt; l a\n    toListUnboxed :: (Unbox a) =&gt; l a -&gt; [a]\n</code></pre>\n\n<p>An alternate approach could be to use Constraints (you'll need to add a few language extensions):</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds, TypeFamilies #-}\nimport GHC.Exts (Constraint)\n\nclass ListIsomorphic l where\n    type C l a :: Constraint\n    type C l a = () -- default to no constraint\n\n    fromList :: C l a =&gt; [a] -&gt; l a\n    toList :: C l a =&gt; l a -&gt; [a]\n\ninstance ListIsomorphic UV.Vector where\n    type C UV.Vector a = UV.Unbox a\n    toList   = UV.toList\n    fromList = UV.fromList\n</code></pre>\n\n<p>(Code untested!)</p>\n\n<p>In this way each instance can have different constraints. This isn't a very common solution, however.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 32131801, "answer_count": 1, "score": 1, "last_activity_date": 1440129329, "creation_date": 1440123228, "last_edit_date": 1495539843, "question_id": 32131352, "link": "https://stackoverflow.com/questions/32131352/how-do-i-create-a-listisomorphic-instance-for-vector-unboxed", "title": "How do I create a ListIsomorphic instance for Vector.Unboxed?", "body": "<p>Since it seems that <a href=\"https://stackoverflow.com/questions/32129603/how-do-i-create-a-listisomorphic-instance-for-generic-vectors\">writing a <code>ListIsomorphic</code> instance for generic vectors</a> is impossible (or not a good idea), I'm trying to write one for <code>Vector.Unboxed</code> directly. </p>\n\n<pre><code>class ListIsomorphic l where\n    toList    :: l a -&gt; [a]\n    fromList  :: [a] -&gt; l a\n\ninstance ListIsomorphic UV.Vector where\n    toList   = UV.toList\n    fromList = UV.fromList\n</code></pre>\n\n<p>I'm getting the following error:</p>\n\n<pre><code>test.hs:70:14:\n    No instance for (UV.Unbox a) arising from a use of \u2018UV.toList\u2019\n    Possible fix:\n    add (UV.Unbox a) to the context of\n        the type signature for toList :: UV.Vector a -&gt; [a]\n    In the expression: UV.toList\n    In an equation for \u2018toList\u2019: toList = UV.toList\n    In the instance declaration for \u2018ListIsomorphic UV.Vector\u2019\n\ntest.hs:71:16:\n    No instance for (UV.Unbox a) arising from a use of \u2018UV.fromList\u2019\n    Possible fix:\n    add (UV.Unbox a) to the context of\n        the type signature for fromList :: [a] -&gt; UV.Vector a\n    In the expression: UV.fromList\n    In an equation for \u2018fromList\u2019: fromList = UV.fromList\n    In the instance declaration for \u2018ListIsomorphic UV.Vector\u2019\n</code></pre>\n\n<p>I've tried following the compiler error advice but it didn't work. How can I write it?</p>\n"}, {"tags": ["haskell", "optimization", "ghc"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 4, "creation_date": 1440126454, "post_id": 32130011, "comment_id": 52154266, "body": "That&#39;s actually not &quot;obvious&quot;. That&#39;s a property you have to explicitly demand. For example, you could have a tree structure that you can convert to a list and that you can also construct from a list, but where this identity doesn&#39;t necessarily hold."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1440126573, "post_id": 32130011, "comment_id": 52154299, "body": "That sounds reasonable. Thanks."}, {"owner": {"reputation": 4838, "user_id": 440294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6f9b4bd073537b03827fe2047aa4c91?s=128&d=identicon&r=PG", "display_name": "Nathan Davis", "link": "https://stackoverflow.com/users/440294/nathan-davis"}, "edited": false, "score": 0, "creation_date": 1440128618, "post_id": 32130011, "comment_id": 52154757, "body": "Also, couldn&#39;t <code>l</code> differ between the <code>toList</code> and <code>fromList</code> calls?  For example <code>redBlackTreeToBTree = toList . fromList</code> where <code>redBlackTreeToBTree :: RedBlackTree a -&gt; BTree a</code>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440128859, "post_id": 32130011, "comment_id": 52154818, "body": "Yes, it could. Considering that, I guess the only right answer would be writing a specific rule inside each instance. Is that possible?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440133058, "post_id": 32130011, "comment_id": 52155887, "body": "Rules and classes mix in weird ways. Often, the trick is to write a tiny class method that just invokes a function, and then attach the rule to the function."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4838, "user_id": 440294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6f9b4bd073537b03827fe2047aa4c91?s=128&d=identicon&r=PG", "display_name": "Nathan Davis", "link": "https://stackoverflow.com/users/440294/nathan-davis"}, "edited": false, "score": 1, "creation_date": 1440136492, "post_id": 32130011, "comment_id": 52157043, "body": "@NathanDavis I expect <code>toList . fromList :: ListIsomorphic l =&gt; [a] -&gt; [a]</code> (which has an ambiguous &quot;middle instance&quot;, but only one), so I don&#39;t think there can be two different instances involved."}, {"owner": {"reputation": 4838, "user_id": 440294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6f9b4bd073537b03827fe2047aa4c91?s=128&d=identicon&r=PG", "display_name": "Nathan Davis", "link": "https://stackoverflow.com/users/440294/nathan-davis"}, "edited": false, "score": 0, "creation_date": 1440173657, "post_id": 32130011, "comment_id": 52179329, "body": "You&#39;re right.  I had the operations flipped in my mind.  I was thinking of <code>fromList . toList</code>."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 12, "last_activity_date": 1440153014, "last_edit_date": 1495541175, "creation_date": 1440135658, "answer_id": 32133083, "question_id": 32130011, "link": "https://stackoverflow.com/questions/32130011/how-do-you-write-rewrite-rules-for-typeclass-methods/32133083#32133083", "title": "How do you write rewrite rules for typeclass methods?", "body": "<p>You can use a <code>RULES</code> pragma to implement this simplification but you have to do <a href=\"https://stackoverflow.com/a/9815210/477476\">a bit of extra work</a> to make sure the generic method rewrite rules don't fire before yours have a chance to:</p>\n\n<pre><code>{-# RULES\n  \"protect toList\"   toList = toList';\n  \"protect fromList\" fromList = fromList';\n  \"fromList/toList\"  forall x . fromList' (toList' x) = x; #-}\n\n{-# NOINLINE [0] fromList' #-}\nfromList' :: (ListIsomorphic l) =&gt; [a] -&gt; l a\nfromList' = fromList\n\n{-# NOINLINE [0] toList' #-}\ntoList' :: (ListIsomorphic l) =&gt; l a -&gt; [a]\ntoList' = toList\n</code></pre>\n\n<p>Here's a silly example to show that it works:</p>\n\n<pre><code>instance ListIsomorphic Maybe where\n    toList = error \"toList\"\n    fromList = error \"fromList\"\n\ntest1 :: Maybe a -&gt; Maybe a\ntest1 x = fromList (toList x)\n\nmain = print $ test1 $ Just \"Hello\"\n</code></pre>\n\n<p>This prints <code>Just \"Hello\"</code> instead of erroring out. Also, you can see the rules firing:</p>\n\n<pre><code>$ ghc -O -ddump-rule-firings --make rewrite-method.hs\n[1 of 1] Compiling Main             ( rewrite-method.hs, rewrite-method.o )\nRule fired: protect toList\nRule fired: protect fromList\nRule fired: unpack\nRule fired: unpack\nRule fired: protect toList\nRule fired: protect fromList\nRule fired: fromList/toList\nRule fired: unpack\nRule fired: Class op show\nRule fired: &gt;#\nRule fired: tagToEnum#\nRule fired: Class op showsPrec\nRule fired: Class op showList\nRule fired: ++\nRule fired: unpack-list\nRule fired: foldr/app\nRule fired: unpack-list\nRule fired: unpack-list\nLinking rewrite-method.exe ...\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 5, "accepted_answer_id": 32133083, "answer_count": 1, "score": 12, "last_activity_date": 1440153014, "creation_date": 1440112892, "last_edit_date": 1440144966, "question_id": 32130011, "link": "https://stackoverflow.com/questions/32130011/how-do-you-write-rewrite-rules-for-typeclass-methods", "title": "How do you write rewrite rules for typeclass methods?", "body": "<p>Mind the following class:</p>\n\n<pre><code>class ListIsomorphic l where\n    toList    :: l a -&gt; [a]\n    fromList  :: [a] -&gt; l a\n</code></pre>\n\n<p>I also demand that <code>toList . fromList == id</code>. How do I write rewrite rules to tell GHC to make that substitution?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1440111935, "post_id": 32129818, "comment_id": 52150675, "body": "I guess you could write <code>allEq [] = True; allEq (x:xs) = all (x ==) xs</code> which might help you a little.  Ultimately non-linear patterns are not in Haskell and they are in Miranda, it appears, so you will have to do a little extra work to compensate.  Btw you can get rid of the <code>| otherwise</code> line altogether, the next equation will take care of it."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1440112320, "post_id": 32129818, "comment_id": 52150784, "body": "Thanks. I always put in an otherwise as a reflex. Good catch."}], "answers": [{"tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 13, "last_activity_date": 1440112322, "creation_date": 1440112322, "answer_id": 32129932, "question_id": 32129818, "link": "https://stackoverflow.com/questions/32129818/miranda-to-haskell-what-is-the-improved-version/32129932#32129932", "title": "Miranda To Haskell - What is the improved version?", "body": "<p>For reference, a pattern with a repeated name like that is called <strong>non-linear</strong>. Miranda supports these and Haskell doesn't. It's a design trade-off taken by the <em>original</em> Haskell design comittee back in <a href=\"https://groups.google.com/forum/#!topic/pure-lang/IReQo-L8-Ik\">1988</a>. <a href=\"https://groups.google.com/forum/#!topic/pure-lang/IReQo-L8-Ik\">This thread</a> has some additional rationale for not supporting non-linear patterns in Haskell.</p>\n\n<p>Unfortunately, this means that you can't really get close to Miranda using Haskell's pattern matching. You'll have to write some code that explicitly compares values for equality, like you have.</p>\n\n<p>The one improvement you <em>can</em> easily make is to get rid of your <code>othewise</code> case: if all the guards fail, pattern matching moves on to the next pattern. You could also make your equality check a bit shorter, but you <strong>can't get rid of the check completely</strong>. Here's a version that seems a bit improved to me:</p>\n\n<pre><code>fix :: (Eq a) =&gt; QTree a -&gt; QTree a\nfix (Leaf a) = Leaf a\nfix (Internal nw ne sw se) =\n  merge (Internal (fix nw) (fix ne) (fix sw) (fix se))\n  where merge (Internal (Leaf w) (Leaf x) (Leaf y) (Leaf z))\n          | all (== w) [x, y, z] = Leaf x\n        merge other = other\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 7, "last_activity_date": 1440115020, "creation_date": 1440115020, "answer_id": 32130325, "question_id": 32129818, "link": "https://stackoverflow.com/questions/32129818/miranda-to-haskell-what-is-the-improved-version/32130325#32130325", "title": "Miranda To Haskell - What is the improved version?", "body": "<p>You might find that <a href=\"https://hackage.haskell.org/package/uniplate\">uniplate</a> or something like it works really well for your quadtree:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\nimport Data.Generics.Uniplate.Data\nimport Data.Data(Data)\nimport Data.Typeable(Typeable)\n\ndata QTree a = Internal (QTree a) (QTree a) (QTree a) (QTree a)\n             | Leaf a\n             deriving (Data,Typeable -- for uniplate\n                       , Eq, Show)\n-- not tested:\nfix :: (Data a, Eq a) =&gt; QTree a -&gt; QTree a\nfix t = case map fix $ children t of\n  lw@(Leaf w):xyz\n    | all (lw ==) xyz -&gt; lw\n  _                   -&gt; t\n</code></pre>\n\n<p>These simple generics plus our ability to combine predicates with pattern matching in a <code>case</code> fix what <em>actually</em> bothered me about both versions which were the duplicated identical branches.</p>\n"}], "owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 518, "favorite_count": 1, "accepted_answer_id": 32129932, "answer_count": 2, "score": 6, "last_activity_date": 1440115020, "creation_date": 1440111566, "question_id": 32129818, "link": "https://stackoverflow.com/questions/32129818/miranda-to-haskell-what-is-the-improved-version", "title": "Miranda To Haskell - What is the improved version?", "body": "<p>I'm working out the code from <a href=\"http://conal.net/papers/warren-burton/Functional%20Programming%20and%20Quadtrees.pdf\">this</a> paper. It's bugging me that my translation is more verbose. It occurs to me I'm missing something obvious that would make it as succinct as the original Miranda.</p>\n\n<p>Here's the Miranda:</p>\n\n<pre><code>fix :: qtree(*) -&gt; qtree(*)\nfix(Leaf(x)) = Leaf(x)\nfix(Internal(nw, ne, sw, se)) =\n   merge(Internal(fix(nw), fix(ne), fix(sw), fix(se)))\n   where\n      merge(Internal (Leaf(x), Leaf(x), Leaf(x), Leaf(x))) = Leaf(x)\n      merge(other) = other\n</code></pre>\n\n<p>Notice the LHS of <code>merge</code>. It captures the case where all four leaves have the same value. Can't do a straight transliteration into Haskell, for I'll get a complaint of multiple definitions of <code>x</code>. Here's my version:</p>\n\n<pre><code>fix :: (Eq a) =&gt; QTree a -&gt; QTree a\nfix (Leaf a) = Leaf a\nfix (Internal nw ne sw se) =\n   merge (Internal (fix nw) (fix ne) (fix sw) (fix se))\n      where\n   merge internal@(Internal (Leaf w) (Leaf x) (Leaf y) (Leaf z))\n     | (w == x) &amp;&amp; (x == y) &amp;&amp; (y == z) = Leaf x\n     | otherwise                        = internal\n   merge other = other\n</code></pre>\n\n<p>How can I get closer to what is going on in the Miranda code?</p>\n"}, {"tags": ["haskell", "typeclass", "ghc-generics"], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440122755, "post_id": 32129866, "comment_id": 52153360, "body": "Are you sure? (2) gives me <code>\u2018Listable\u2019 is applied to too many type arguments</code>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440125117, "post_id": 32129866, "comment_id": 52153893, "body": "I actually tried that before, but it gave me <code>\u2018V.Vector\u2019 is applied to too many type arguments</code>... I tried a few combinations of that too."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440125972, "post_id": 32129866, "comment_id": 52154124, "body": "My guess is that you have imported <code>Data.Vector</code> instead of <code>Data.Vector.Generic</code>, since the <code>Vector</code> types in those libraries take different number of arguments."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440126179, "post_id": 32129866, "comment_id": 52154184, "body": "Ah, or you might need some explicit kind signatures (<code>-XKindSignatures</code>). Something like <code>type C (l :: * -&gt; *) a :: Constraint</code> , sorry I don&#39;t have a compiler with me right now."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 5, "last_activity_date": 1440124946, "last_edit_date": 1440124946, "creation_date": 1440111877, "answer_id": 32129866, "question_id": 32129603, "link": "https://stackoverflow.com/questions/32129603/how-do-i-create-a-listisomorphic-instance-for-generic-vectors/32129866#32129866", "title": "How do I create a ListIsomorphic instance for generic vectors?", "body": "<p>I frequently run into this problem. Here are two solutions I've come up with:</p>\n\n<ol>\n<li><p>Change the class parameters:</p>\n\n<pre><code>class ListIsomorphic l a where\n  toList :: l a -&gt; [a]\n  fromList :: [a] -&gt; l a\n\ninstance (V.Vector v a) =&gt; Listable v a where\n  ...\n</code></pre></li>\n<li><p>Use constraint kinds</p>\n\n<pre><code>class ListIsomorphic l where\n  type C l a :: Constraint\n  toList :: l a -&gt; [a]\n  fromList :: [a] -&gt; l a\n\ninstance Listable v where\n  type C v a = (V.Vector v a)\n  ...\n</code></pre></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440112484, "post_id": 32129941, "comment_id": 52150821, "body": "Thanks. I don&#39;t understand any of those advanced type system features, do you suggest any resource?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440112760, "post_id": 32129941, "comment_id": 52150906, "body": "<a href=\"https://wiki.haskell.org/GHC/Type_families\" rel=\"nofollow noreferrer\"><code>TypeFamilies</code></a> makes functions that match on types. It&#39;s used to define the <code>Elem</code> function that takes the type of the <code>ConstrainedList</code> instance and produces the constraint on its member elements."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440113104, "post_id": 32129941, "comment_id": 52150999, "body": "<a href=\"https://downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/constraint-kind.html\" rel=\"nofollow noreferrer\"><code>ConstraintKinds</code></a> lets you talk about the kind of constraints (the things to the left of <code>=&gt;</code>). For example <code>Show :: * -&gt; Constraint</code>, <code>Show a :: Constraint</code>, and <code>a ~ b :: Constraint</code>. There&#39;s some <code>GHC</code> module that defines  <a href=\"https://hackage.haskell.org/package/constraints/docs/Data-Constraint.html#t:Constraint\" rel=\"nofollow noreferrer\"><code>Constraint :: BOX</code></a>; it&#39;s easier to import from constraints."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440122852, "post_id": 32129941, "comment_id": 52153383, "body": "Wait, does this mean that functions written for &quot;ListIsomorphic&quot; (the original one) can&#39;t work for vectors?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440125235, "post_id": 32129941, "comment_id": 52153928, "body": "Or, just... are you suggesting that I just use that class instead? In that case, how would I write the <code>type Elem ... = ...</code> line for common types such as <code>[]</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 1, "creation_date": 1440127255, "post_id": 32129941, "comment_id": 52154451, "body": "@Viclib, Cirdec is suggesting you use the one they suggested instead. Designing classes is a bit of an art, and one I wouldn&#39;t claim to have mastered myself. But any time you see <code>instance ... =&gt; C a</code> or <code>instance ... =&gt; C (a ...)</code>, you&#39;ve probably taken a wrong turn. Such instances will overlap with others one might wish to define."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440127547, "post_id": 32129941, "comment_id": 52154519, "body": "How/where I&#39;m supposed to learn that art? I still don&#39;t understand, though, if I use it, how do I write a normal instance - and does that mean I have to write functions like <code>(ListIso l, Elem l a) =&gt; (a \u2192 b) \u2192 l a \u2192 l b</code>, instead of just <code>ListIso l =&gt; (a \u2192 b) \u2192 l a \u2192 l b</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1440131381, "post_id": 32129941, "comment_id": 52155442, "body": "The art is mostly learned by reading recent code by good library designers and making mistakes. Normal instances start with type constructors, not type variables. I have no idea what you are asking in the rest, and I have to go to sleep."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1440139001, "post_id": 32129941, "comment_id": 52158201, "body": "I understand now why dfeuer said this is an art. It is all the same... I can look at it and appreciate its beauty, yet wonder if I&#39;d ever be able to come up with something similar."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 6, "last_activity_date": 1440135327, "last_edit_date": 1440135327, "creation_date": 1440112373, "answer_id": 32129941, "question_id": 32129603, "link": "https://stackoverflow.com/questions/32129603/how-do-i-create-a-listisomorphic-instance-for-generic-vectors/32129941#32129941", "title": "How do I create a ListIsomorphic instance for generic vectors?", "body": "<p><strong>Don't</strong>. Adding an instance for all <code>v</code> to your <code>Listable</code> class will become cumbersome to use due to overlapping instances.</p>\n\n<p>A <code>Vector v a =&gt; v</code> isn't isomorphic to a list because it is constrained by which items can be elements of the list. You'd need a class that captures this constraint, something like</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n\nimport Data.Constraint\n\nclass ConstrainedList l where\n    type Elem l a :: Constraint\n    toList   :: Elem l a =&gt; l a -&gt; [a]\n    fromList :: Elem l a =&gt; [a] -&gt; l a\n</code></pre>\n\n<p>Instead of adding <code>ConstrainedList</code> instances for all types <code>Vector v a =&gt; v</code> which would get us into overlapping instances territory, instead we'll define it only for the types we're interested in.  The following will cover all the types with a <a href=\"https://hackage.haskell.org/package/vector/docs/Data-Vector-Generic.html#t:Vector\" rel=\"nofollow\"><code>Vector</code></a> instance in the vector package.</p>\n\n<pre><code>import qualified Data.Vector.Primitive as VP\nimport qualified Data.Vector.Generic as VG\n\ninstance ConstrainedList VP.Vector where\n    type Elem VP.Vector a = VG.Vector VP.Vector a\n    toList   = VG.toList\n    fromList = VG.fromList\n</code></pre>\n\n<h3>Instances for other types</h3>\n\n<p>You can write a <code>ConstrainedList</code> instance for regular lists <code>[]</code> that requires only the empty constraint for its elements.</p>\n\n<pre><code>instance ConstrainedList [] where\n    type Elem [] a = ()\n    toList   = id\n    fromList = id\n</code></pre>\n\n<p>Anywhere that uses <code>toList</code> or <code>fromList</code> will also require an <code>Elem l a</code> instance.</p>\n\n<pre><code>cmap :: (ConstrainedList l, Elem l a, Elem l b) =&gt; (a -&gt; b) -&gt; l a -&gt; l b\ncmap f = fromList . map f . toList\n</code></pre>\n\n<p>When we know concrete types for the lists and elements these functions will be easy to use without messing around with constraints.</p>\n\n<pre><code>cmap (+1) [1,2,3,4]\n</code></pre>\n\n<h3>Here Be Dragons</h3>\n\n<p>Don't try what follows. If you are interested in the class of things that are isomorphic to lists without additional constraints, just make another class for it. This just demonstrates what you can do when you've designed yourself into a corner: summon a dragon.</p>\n\n<p>You can also write functions that require a proof that there is no constraint on the elements of a <code>ConstrainedList</code>. This is way off into the realms of the <code>constraints</code> package and programming styles that aren't really supported by GHC, but there aren't enough <code>constraints</code> examples so I'll leave this one here.</p>\n\n<pre><code>{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nmap' :: forall l a b. (ConstrainedList l, () :=&gt; Elem l a, () :=&gt; Elem l b) =&gt;\n                      (a -&gt; b) -&gt; l a -&gt; l b\nmap' f = case (ins :: () :- Elem l a) of { Sub Dict -&gt;\n         case (ins :: () :- Elem l b) of { Sub Dict -&gt;\n         fromList . map f . toList\n         }}\n</code></pre>\n\n<p>We could check that a <code>ConstrainedList</code> has no constraint by just checking that <code>Elem l a ~ ()</code>, but that wouldn't work if its constraint was written in a different way.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\nclass Any a\ninstance Any a\n\ndata AList a = AList {getList :: [a]}\n    deriving (Show)\n\ninstance ConstrainedList AList where\n    type Elem AList a = Any a\n    toList   = getList\n    fromList = AList\n</code></pre>\n\n<p><code>()</code> isn't the same type as <code>Any a</code> even though <code>()</code> implies <code>Any a</code>. The constraints package captures relationships like this by reifying them to the type classes <a href=\"https://hackage.haskell.org/package/constraints/docs/Data-Constraint.html#t:Class\" rel=\"nofollow\"><code>Class</code></a> and <a href=\"https://hackage.haskell.org/package/constraints/docs/Data-Constraint.html#t::-61--62-\" rel=\"nofollow\"><code>:=&gt;</code></a></p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n\n--       class () =&gt; Any a\ninstance Class ()   (Any a) where\n    cls = Sub Dict\n\n-- instance ()  =&gt; Any a\ninstance    () :=&gt; Any a where\n    ins = Sub Dict\n</code></pre>\n\n<p>All of that work lets us easily reuse functions without providing all those dictionaries when a concrete list type is known.</p>\n\n<pre><code>map'' :: (a -&gt; b) -&gt; AList a -&gt; AList b\nmap'' = map'\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "accepted_answer_id": 32129941, "answer_count": 2, "score": 4, "last_activity_date": 1440135327, "creation_date": 1440110368, "last_edit_date": 1440130146, "question_id": 32129603, "link": "https://stackoverflow.com/questions/32129603/how-do-i-create-a-listisomorphic-instance-for-generic-vectors", "title": "How do I create a ListIsomorphic instance for generic vectors?", "body": "<p>Given the following class:</p>\n\n<pre><code>class ListIsomorphic l where\n    toList   :: l a -&gt; [a]\n    fromList :: [a] -&gt; l a\n</code></pre>\n\n<p>How can I write a instance for vector types using <code>Data.Vector.Generic</code>? This doesn't work:</p>\n\n<pre><code>instance (V.Vector v a) =&gt; ListIsomorphic v where\n    toList   = V.toList\n    fromList = V.fromList\n</code></pre>\n\n<p>Giving me:</p>\n\n<pre><code>test.hs:31:10:\n    Variable \u2018a\u2019 occurs more often than in the instance head\n      in the constraint: V.Vector v a\n    (Use UndecidableInstances to permit this)\n    In the instance declaration for \u2018ListIsomorphic v\u2019\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1440104968, "post_id": 32128377, "comment_id": 52148141, "body": "<code>Int</code>s are only guaranteed to have <i>at least</i> that range.  <code>Int</code>s on your platform are 64 bits.  Compare with <code>2^63</code>."}, {"owner": {"reputation": 541, "user_id": 3413038, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2336033472ec66c9f686b6cffd6bf89f?s=128&d=identicon&r=PG&f=1", "display_name": "Henry98", "link": "https://stackoverflow.com/users/3413038/henry98"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1440105031, "post_id": 32128377, "comment_id": 52148164, "body": "Ohhhhh! That makes so much sense! Although, you should&#39;ve answered that as an answer and not a comment so I can give you best answer. :P"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1440137142, "post_id": 32128377, "comment_id": 52157308, "body": "Next time read twice the documentation before posting a question. Moreover do <i>not</i> use screenshots when you could simply copy &amp; paste text in a code block. By using screenshots you just made the post useless to impaired readers (yes they exist; you should add a description to your images for this reason), moreover it would be impossible for an answerer to copy and paste the result you get. In other words: you are harming usability for most users."}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 12, "last_activity_date": 1440105112, "creation_date": 1440105112, "answer_id": 32128475, "question_id": 32128377, "link": "https://stackoverflow.com/questions/32128377/minbound-and-maxbound-return-wrong-number-for-int/32128475#32128475", "title": "minBound and maxBound return wrong number for Int", "body": "<p><code>Int</code>s are only guaranteed to have <em>at least</em> that range.  <code>Int</code>s on your platform appear to be 64 bits.   Compare with <code>2^63</code>:</p>\n\n<pre><code>ghci&gt; 2^63\n9223372036854775808\n</code></pre>\n"}], "owner": {"reputation": 541, "user_id": 3413038, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2336033472ec66c9f686b6cffd6bf89f?s=128&d=identicon&r=PG&f=1", "display_name": "Henry98", "link": "https://stackoverflow.com/users/3413038/henry98"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 1, "accepted_answer_id": 32128475, "answer_count": 1, "score": 8, "last_activity_date": 1440107411, "creation_date": 1440104704, "last_edit_date": 1440107411, "question_id": 32128377, "link": "https://stackoverflow.com/questions/32128377/minbound-and-maxbound-return-wrong-number-for-int", "title": "minBound and maxBound return wrong number for Int", "body": "<blockquote>\n  <p>A fixed-precision integer type with at least the range [-2^29 ..\n  2^29-1]. The exact range for a given implementation can be determined\n  by using minBound and maxBound from the Bounded class.</p>\n</blockquote>\n\n<p>This came straight from hackage.haskell.org.</p>\n\n<p>According to both hackage.haskell.org and learnyouahaskell.com, what I'm supposed to get is <code>-2147483648</code> for <code>minBound</code> and <code>2147483648</code> for <code>maxBound</code>.</p>\n\n<p>When I actually run it myself, I get this result :</p>\n\n<p><a href=\"https://i.stack.imgur.com/L0jyE.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/L0jyE.png\" alt=\"enter image description here\"></a></p>\n\n<p>Apologies if this is a really stupid question. I'm new to Haskell and was testing around to see how things worked.</p>\n\n<p>Am I doing something wrong? </p>\n"}, {"tags": ["haskell", "cabal", "cabal-install"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1440100631, "post_id": 32126861, "comment_id": 52145814, "body": "I suggest you to use <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow noreferrer\">hvr&#39;s</a> GHC packages. That way you can simply <code>apt-get install ghc-7.10.1 cabal-install-1.22</code>, instead of GHC 7.6.4."}, {"owner": {"reputation": 433, "user_id": 2483602, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c09de2e13c6e0938e9437dd5687ab34d?s=128&d=identicon&r=PG", "display_name": "SiXoS", "link": "https://stackoverflow.com/users/2483602/sixos"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1440102948, "post_id": 32126861, "comment_id": 52147085, "body": "@Zeta They don&#39;t seem to be in the standard repository. Do I have to add one? In that case, how?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1440103157, "post_id": 32126861, "comment_id": 52147193, "body": "The instructions are on the linked site. You need to add the sources. This can be done via <code>sudo add-apt-repository ppa:hvr&#47;ghc</code>, followed by <code>apt-get update</code> and then <code>apt-get install \u2026</code>. Keep in mind that this isn&#39;t an official repository, but it&#39;s been reliable for a some time"}], "owner": {"reputation": 433, "user_id": 2483602, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c09de2e13c6e0938e9437dd5687ab34d?s=128&d=identicon&r=PG", "display_name": "SiXoS", "link": "https://stackoverflow.com/users/2483602/sixos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 120, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1440099307, "creation_date": 1440099307, "question_id": 32126861, "link": "https://stackoverflow.com/questions/32126861/bytestring-types-fail-when-installing-cabal-install", "title": "Bytestring types fail when installing cabal-install", "body": "<p>I just ran </p>\n\n<pre><code>apt-get install haskell-platform\ncabal update\n</code></pre>\n\n<p>Now I'm trying to upgrade the cabal version using </p>\n\n<pre><code>cabal install cabal-install\n</code></pre>\n\n<p>But it fails and I get the following errors:</p>\n\n<pre><code>Resolving dependencies...\n[ 1 of 81] Compiling Distribution.PackageDescription.Utils ( /tmp/Cabal-1.22.4.0-11586/Cabal-1.22.4.0/Distribution/PackageDescription/Utils.hs, /tmp/Cabal-1.22.4.0-11586/Cabal-1.22.4.0/dist/setup/Distribution/PackageDescription/Utils.o )\n[ 2 of 81] Compiling Distribution.Simple.CCompiler ( /tmp/Cabal-1.22.4.0-11586/Cabal-1.22.4.0/Distribution/Simple/CCompiler.hs, /tmp/Cabal-1.22.4.0-11586/Cabal-1.22.4.0/dist/setup/Distribution/Simple/CCompiler.o )\n[ 3 of 81] Compiling Distribution.Compat.CreatePipe ( /tmp/Cabal-1.22.4.0-11586/Cabal-1.22.4.0/Distribution/Compat/CreatePipe.hs, /tmp/Cabal-1.22.4.0-11586/Cabal-1.22.4.0/dist/setup/Distribution/Compat/CreatePipe.o )\n[ 4 of 81] Compiling Distribution.Compat.Binary.Class ( /tmp/Cabal-1.22.4.0-11586/Cabal-1.22.4.0/Distribution/Compat/Binary/Class.hs, /tmp/Cabal-1.22.4.0-11586/Cabal-1.22.4.0/dist/setup/Distribution/Compat/Binary/Class.o )\n\n/tmp/Cabal-1.22.4.0-11586/Cabal-1.22.4.0/Distribution/Compat/Binary/Class.hs:435:31:\n    Couldn't match expected type `bytestring-0.10.0.2:Data.ByteString.Internal.ByteString'\n                with actual type `B.ByteString'\n    In the first argument of `putByteString', namely `bs'\n    In a stmt of a 'do' block: putByteString bs\n    In the expression:\n      do { put (B.length bs);\n           putByteString bs }\n\n/tmp/Cabal-1.22.4.0-11586/Cabal-1.22.4.0/Distribution/Compat/Binary/Class.hs:436:22:\n    Couldn't match type `bytestring-0.10.0.2:Data.ByteString.Internal.ByteString'\n                  with `B.ByteString'\n    Expected type: Int -&gt; Get B.ByteString\n      Actual type: Int\n                   -&gt; Get bytestring-0.10.0.2:Data.ByteString.Internal.ByteString\n    In the second argument of `(&gt;&gt;=)', namely `getByteString'\n    In the expression: get &gt;&gt;= getByteString\n    In an equation for `get': get = get &gt;&gt;= getByteString\n\n/tmp/Cabal-1.22.4.0-11586/Cabal-1.22.4.0/Distribution/Compat/Binary/Class.hs:445:35:\n    Couldn't match expected type `bytestring-0.10.0.2:Data.ByteString.Lazy.Internal.ByteString'\n                with actual type `ByteString'\n    In the first argument of `putLazyByteString', namely `bs'\n    In a stmt of a 'do' block: putLazyByteString bs\n    In the expression:\n      do { put (fromIntegral (L.length bs) :: Int);\n           putLazyByteString bs }\n\n/tmp/Cabal-1.22.4.0-11586/Cabal-1.22.4.0/Distribution/Compat/Binary/Class.hs:446:22:\n    Couldn't match type `bytestring-0.10.0.2:Data.ByteString.Lazy.Internal.ByteString'\n                  with `ByteString'\n    Expected type: Int64 -&gt; Get ByteString\n      Actual type: Int64\n                   -&gt; Get bytestring-0.10.0.2:Data.ByteString.Lazy.Internal.ByteString\n    In the second argument of `(&gt;&gt;=)', namely `getLazyByteString'\n    In the expression: get &gt;&gt;= getLazyByteString\n    In an equation for `get': get = get &gt;&gt;= getLazyByteString\nFailed to install Cabal-1.22.4.0\ncabal: Error: some packages failed to install:\nCabal-1.22.4.0 failed during the configure step. The exception was:\nExitFailure 1\ncabal-install-1.22.6.0 depends on Cabal-1.22.4.0 which failed to install.\n</code></pre>\n\n<p>As I said this is a completely fresh install so i don't know how I can make any changes. It seems as a version of the bytestring package is installed when I install haskell that isn't compatible with the latest cabal-install. Can I, in some way, choose which cabal i want to begin with or how do I cope with this problem?</p>\n\n<p>I should note that I had a previous install of haskell-platform but i ran</p>\n\n<pre><code>apt-get purge haskell-platform\napt-get autoremove\n</code></pre>\n\n<p>Before i reinstalled it</p>\n"}, {"tags": ["haskell", "gcc", "linker"], "answers": [{"comments": [{"owner": {"reputation": 818, "user_id": 1542000, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/lK7QR.jpg?s=128&g=1", "display_name": "cronburg", "link": "https://stackoverflow.com/users/1542000/cronburg"}, "reply_to_user": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1440167668, "post_id": 32127442, "comment_id": 52175474, "body": "Yes, though I&#39;d accept another answer if someone can explain why the <code>rts</code> library is mentioned at all when the only error was in <code>pads-haskell</code>"}], "tags": [], "owner": {"reputation": 818, "user_id": 1542000, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/lK7QR.jpg?s=128&g=1", "display_name": "cronburg", "link": "https://stackoverflow.com/users/1542000/cronburg"}, "is_accepted": true, "score": 0, "last_activity_date": 1440101375, "creation_date": 1440101375, "answer_id": 32127442, "question_id": 32126423, "link": "https://stackoverflow.com/questions/32126423/linking-cabalized-haskell-package-to-c-program-undefined-reference-linker-error/32127442#32127442", "title": "Linking cabalized Haskell package to C program (undefined reference linker error)", "body": "<p>I was dumb and missed the obvious: try to fix the first error gcc printed.</p>\n\n<p>I managed to get the <code>test</code> function removed from the exported modules in my cabal package. Upon re-building the cabal package with <code>test</code> added to the <code>.so</code>, all the linking errors went away.</p>\n"}], "owner": {"reputation": 818, "user_id": 1542000, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/lK7QR.jpg?s=128&g=1", "display_name": "cronburg", "link": "https://stackoverflow.com/users/1542000/cronburg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 32127442, "answer_count": 1, "score": 0, "last_activity_date": 1440101375, "creation_date": 1440097798, "last_edit_date": 1495541201, "question_id": 32126423, "link": "https://stackoverflow.com/questions/32126423/linking-cabalized-haskell-package-to-c-program-undefined-reference-linker-error", "title": "Linking cabalized Haskell package to C program (undefined reference linker error)", "body": "<p>My link command is:</p>\n\n<pre><code>gcc -O2 -m32 -o ParseInt.exe ParseInt.o hsbracket.o \\\n    -L../../dist/ia32/build -lffi -lHSarray-0.5.0.0-ghc7.8.3 \\\n    -lHSbin-package-db-0.0.0.0-ghc7.8.3 -lHSbinary-0.7.1.0-ghc7.8.3 \\\n    -lHSbytestring-0.10.4.0-ghc7.8.3 -lHSCabal-1.18.1.3-ghc7.8.3 \\\n    -lHScontainers-0.5.5.1-ghc7.8.3 -lHSdeepseq-1.3.0.2-ghc7.8.3 \\\n    -lHSdirectory-1.2.1.0-ghc7.8.3 -lHSfilepath-1.3.0.2-ghc7.8.3 \\\n    -lHSghc-7.8.3-ghc7.8.3 -lHSghc-prim-0.3.1.0-ghc7.8.3 \\\n    -lHShaskeline-0.7.1.2-ghc7.8.3 -lHShaskell2010-1.1.2.0-ghc7.8.3 \\\n    -lHShaskell98-2.0.0.3-ghc7.8.3 -lHShoopl-3.10.0.1-ghc7.8.3 \\\n    -lHShpc-0.6.0.1-ghc7.8.3 -lHSinteger-gmp-0.5.1.0-ghc7.8.3 \\\n    -lHSold-locale-1.0.0.6-ghc7.8.3 -lHSold-time-1.1.0.2-ghc7.8.3 \\\n    -lHSpads-haskell-1.1-ghc7.8.3 -lHSpretty-1.1.1.1-ghc7.8.3 \\\n    -lHSprocess-1.2.0.0-ghc7.8.3 -lHSrts-ghc7.8.3 \\\n    -lHSrts_debug-ghc7.8.3 -lHSrts_l-ghc7.8.3 -lHSrts_thr-ghc7.8.3 \\\n    -lHSrts_thr_debug-ghc7.8.3 -lHSrts_thr_l-ghc7.8.3 \\\n    -lHStemplate-haskell-2.9.0.0-ghc7.8.3 -lHSterminfo-0.4.0.0-ghc7.8.3 \\\n    -lHStime-1.4.2-ghc7.8.3 -lHStransformers-0.3.0.0-ghc7.8.3 \\\n    -lHSunix-2.7.0.1-ghc7.8.3 -lHSxhtml-3000.2.1-ghc7.8.3 \\\n    -lHSbase-4.7.0.1-ghc7.8.3  -Wl,-melf_i386\n</code></pre>\n\n<p>and I'm getting a bunch of errors like:</p>\n\n<pre><code>ParseInt.o: In function `main':\nParseInt.c:(.text.startup+0x16): undefined reference to `test'\n../../dist/ia32/build/libHSrts-ghc7.8.3.so: undefined reference to `base_GHCziWord_W16zh_con_info'\n../../dist/ia32/build/libHSrts-ghc7.8.3.so: undefined reference to `base_GHCziConcziSync_runSparks_closure'\n../../dist/ia32/build/libHSrts-ghc7.8.3.so: undefined reference to `base_ControlziExceptionziBase_nonTermination_closure'\n</code></pre>\n\n<p>but the undefined references are defined in the base <code>.so</code> I linked against:</p>\n\n<pre><code>$ nm ../../dist/ia32/build/libHSbase-4.7.0.1-ghc7.8.3.so | grep base_GHCziWord_W16zh_con_info\n26690:00550884 T base_GHCziWord_W16zh_con_info\n$ nm ../../dist/ia32/build/libHSrts-ghc7.8.3.so | grep base_GHCziWord_W16zh_con_info\n104:         U base_GHCziWord_W16zh_con_info\n</code></pre>\n\n<p>So why doesn't <code>libHSrts</code> see things defined in <code>libHSbase</code>? I was following the directions here: <a href=\"http://www.vex.net/~trebla/haskell/so.xhtml\" rel=\"nofollow noreferrer\">http://www.vex.net/~trebla/haskell/so.xhtml</a>, and had <code>ParseInt.exe</code> correctly linking at one point but then I added some libraries to the cabal package / wrote a bunch more Haskell code (<code>ParseInt.c</code> and <code>hsbracket.c</code> did not change).</p>\n\n<p>I've read about linking order (<a href=\"https://stackoverflow.com/a/409470/1542000\">https://stackoverflow.com/a/409470/1542000</a>), and <code>rts</code> is earlier in the link command than the <code>base</code> library it depends on, so I'm not sure why I'm getting undefined references.</p>\n"}, {"tags": ["haskell", "shake-build-system"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1440129926, "post_id": 32125187, "comment_id": 52155083, "body": "<a href=\"https://github.com/ndmitchell/shake/issues/186\" rel=\"nofollow noreferrer\">github.com/ndmitchell/shake/issues/186</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 5, "last_activity_date": 1440093518, "creation_date": 1440093518, "answer_id": 32125188, "question_id": 32125187, "link": "https://stackoverflow.com/questions/32125187/why-does-shake-not-provide-a-monadmask-instance-for-action/32125188#32125188", "title": "Why does Shake not provide a MonadMask instance for Action?", "body": "<p>There are two reasons:</p>\n\n<ul>\n<li>It's impossible, since <code>Action</code> is based on a continuation monad, and you can't implement <code>MonadMask</code> for a continuation monad. See <a href=\"http://neilmitchell.blogspot.co.uk/2014/08/continuations-and-exceptions.html\">this blog post</a> for a rough justification of why that is impossible.</li>\n<li>It's undesirable, since then you could make choices depending on whether a dependent rule succeeds or fails, whereas in Shake the failure of a rule you depend on should always result in you failing.</li>\n</ul>\n\n<p>However, Shake does provide <code>actionFinally</code> and <code>actionOnException</code> as building blocks, which are a restricted variant of the functions available in <code>MonadMask</code>. In addition, Shake provides <code>withTempFile</code> and <code>withTempDir</code>, which do some of the same things as the <code>temporary</code> package. And finally, if you are entirely in <code>IO</code>, then <code>liftIO</code> and <code>bracket</code> works fine.</p>\n"}], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 32125188, "answer_count": 1, "score": 2, "last_activity_date": 1440093518, "creation_date": 1440093518, "question_id": 32125187, "link": "https://stackoverflow.com/questions/32125187/why-does-shake-not-provide-a-monadmask-instance-for-action", "title": "Why does Shake not provide a MonadMask instance for Action?", "body": "<p>I would like to use the <a href=\"https://hackage.haskell.org/package/temporary\" rel=\"nofollow\"><code>temporary</code> package</a> with <a href=\"http://shakebuild.com/\" rel=\"nofollow\">Shake</a>, but that requires <code>Action</code> to have an instance for <code>MonadMask</code>, which is missing. Why does Shake not provide such an instance?</p>\n"}, {"tags": ["c++", "haskell", "c++-concepts"], "comments": [{"owner": {"reputation": 15165, "user_id": 1116364, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b67dfca0caba03083330d39a304b1766?s=128&d=identicon&r=PG", "display_name": "Daniel Jour", "link": "https://stackoverflow.com/users/1116364/daniel-jour"}, "edited": false, "score": 0, "creation_date": 1440092714, "post_id": 32124627, "comment_id": 52141493, "body": "Concepts are a form of type system for the currently untyped metaprogramming facilities (everything is a <code>typename</code>, not looking at value parameters). Type classes allow overloading / selecting functions dependent of the type of their arguments. <a href=\"https://m.reddit.com/r/haskell/comments/1e9f49/concepts_in_c_template_programming_and_type/\" rel=\"nofollow noreferrer\">m.reddit.com/r/haskell/comments/1e9f49/&hellip;</a> This may be a relevant discussion."}], "answers": [{"comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 2, "creation_date": 1440094211, "post_id": 32125304, "comment_id": 52142310, "body": "Could you add an expert from the paper? The community generally frowns on &quot;link-only&quot; questions!"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 1, "creation_date": 1440097824, "post_id": 32125304, "comment_id": 52144292, "body": "@recursion.ninja Excerpt?"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 7, "creation_date": 1440097913, "post_id": 32125304, "comment_id": 52144337, "body": "@Jubobs No he should add an <i>expert</i> from the paper. He must take one of the authors and digitize him/her into his post. I though I was being clear ;)"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440098008, "post_id": 32125304, "comment_id": 52144391, "body": "@recursion.ninja Ah! Sarcasm! :)"}, {"owner": {"reputation": 122530, "user_id": 2756719, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b06a9c91425630fdb69e861abe483d7e?s=128&d=identicon&r=PG&f=1", "display_name": "T.C.", "link": "https://stackoverflow.com/users/2756719/t-c"}, "edited": false, "score": 9, "creation_date": 1440100118, "post_id": 32125304, "comment_id": 52145513, "body": "The Concepts in the C++0x draft (which the cited paper is comparing) is quite different from the one in the Concepts TS."}], "tags": [], "owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "is_accepted": false, "score": 19, "last_activity_date": 1440149588, "last_edit_date": 1440149588, "creation_date": 1440093867, "answer_id": 32125304, "question_id": 32124627, "link": "https://stackoverflow.com/questions/32124627/how-are-c-concepts-different-to-haskell-typeclasses/32125304#32125304", "title": "How are c++ concepts different to Haskell typeclasses?", "body": "<p>You might be interested in the following research paper:</p>\n\n<p>\"A comparison of C++ concepts and Haskell type classes\", Bernardy et al., WGP 2008.  <a href=\"http://sms.cs.chalmers.se/publications/papers/2008-WGP.pdf\" rel=\"noreferrer\">Pdf</a> <a href=\"http://dl.acm.org/citation.cfm?id=1411324\" rel=\"noreferrer\">More details</a>.</p>\n\n<p>Update: as a short summary of the paper: the paper defines a precise mapping between terminology for C++ concepts and terminology for Haskell type classes and uses this mapping to provide a detailed feature comparison between the two.  </p>\n\n<p><em>Their conclusion says:</em></p>\n\n<blockquote>\n  <p>Out of our 27 criteria, summarised in table 2, 16 are equally supported in both languages, and only one or two are not portable. So, we can safely conclude as we started \u2014 C++ concepts and Haskell type classes are very similar.</p>\n</blockquote>\n\n<p>As noted by T.C. below, it is worth pointing out that the paper is comparing C++0x concepts, not Concepts TS.  I am not aware of a good reference describing the differences.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440200120, "post_id": 32147454, "comment_id": 52190585, "body": "In practice, Haskell&#39;s modularity is somewhat limited because its compilation relies heavily on inlining and specialization for performance. If a module is modified in any way, all modules that import it will need to be recompiled. There are techniques for performing type-driven optimizations off various sorts (such as unrolling loops over data structures whose size is fixed by their types), and also a somewhat wild system for user-defined compiler rewrite rules."}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1440770450, "post_id": 32147454, "comment_id": 52424565, "body": "Do you have a good reference on the differences between C++0x concepts and Concepts TS?  I was under the impression that the former did achieve modular type-checking, so is it correct to assume that this was then dropped for Concepts TS?"}, {"owner": {"reputation": 849, "user_id": 2996247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a547821705113ecafb64ceee53d5fc7a?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Sutton", "link": "https://stackoverflow.com/users/2996247/andrew-sutton"}, "edited": false, "score": 0, "creation_date": 1440852913, "post_id": 32147454, "comment_id": 52450167, "body": "No good reference yet. C++0x concepts are not too different than type classes. The Concepts TS uses a predicates to define constraints, and does not include modular type checking."}, {"owner": {"reputation": 313, "user_id": 469224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z80tz.jpg?s=128&g=1", "display_name": "iustin", "link": "https://stackoverflow.com/users/469224/iustin"}, "edited": false, "score": 0, "creation_date": 1473858797, "post_id": 32147454, "comment_id": 66300260, "body": "Late reply here, but a small correction: as far as I know, Haskell typeclasses are in compile-time constructs, as long as you don&#39;t use existential quantification.  See <a href=\"http://stackoverflow.com/questions/28169119/is-the-dispatch-of-a-haskell-typeclass-dynamic\" title=\"is the dispatch of a haskell typeclass dynamic\">stackoverflow.com/questions/28169119/&hellip;</a> for more details."}, {"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1559725844, "post_id": 32147454, "comment_id": 99506868, "body": "Being a practical guy, if it comes to Haskell type classes -&gt; C++ concepts boils down to 1 question: Do concepts support the statement: &quot;There must be a function <code>std::string foo(const T&amp; arg)</code> with a concept related argument type list.&quot;? Point is: The first idea I had to test concepts was to have a &quot;concept Show&quot;, which would act like Haskells <code>Show</code> type class....and the reading and googling started. Also, I remember when I started learning haskell, that no one in IRC made the connection, that the old style C++ interfaces can be found in Haskell in the form of type classes.."}], "tags": [], "owner": {"reputation": 849, "user_id": 2996247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a547821705113ecafb64ceee53d5fc7a?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Sutton", "link": "https://stackoverflow.com/users/2996247/andrew-sutton"}, "is_accepted": true, "score": 46, "last_activity_date": 1440183034, "creation_date": 1440183034, "answer_id": 32147454, "question_id": 32124627, "link": "https://stackoverflow.com/questions/32124627/how-are-c-concepts-different-to-haskell-typeclasses/32147454#32147454", "title": "How are c++ concepts different to Haskell typeclasses?", "body": "<p>Concepts (as defined by the Concepts TS) and type classes are related only in the sense that they restrict the sets of types that can be used with a generic function. Beyond that, I can only think of ways in which the two features differ.</p>\n\n<p>I should note that I am not a Haskell expert. Far from it. However, I am an expert on the Concepts TS (I wrote it, and I implemented it for GCC).</p>\n\n<ul>\n<li><p>Concepts (and constraints) are predicates that determine whether a type is a member of a set. You do not need to explicitly declare whether a type is a model of concept (an instance of a type class). That's determined by a set of requirements and checked by the compiler. In fact, concepts do not allow you to write \"<code>T</code> is a model of <code>C</code>\" at all, although this is readily supported using various metaprogramming techniques.</p></li>\n<li><p>Concepts can be used to constrain non-type arguments, and because of <code>constexpr</code> functions and template metaprogramming, express pretty much any constraint you could ever hope to write (e.g., a hash array whose extent must be a prime number). I don't believe this is true for type classes.</p></li>\n<li><p>Concepts are not part of the type system. They constrain the use of declarations and, in some cases template argument deduction. Type classes are part of the type system and participate in type checking.</p></li>\n<li><p>Concepts do not support modular type checking or compilation. Template definitions are not checked against concepts, so you can still get late caught type errors during instantiation, but this does add a certain degree of flexibility for library writers (e.g., adding debugging code to an algorithm won't change the interface). Because type classes are part of the type system, generic algorithms can be checked and compiled modularly.</p></li>\n<li><p>The Concepts TS supports the specialization of generic algorithms and data structures based based on the ordering of constraints. I am not at all an expert in Haskell, so I don't know if there is an equivalent here or not. I can't find one.</p></li>\n<li><p>The use of concepts will never add runtime costs. The last time I looked, type classes could impose the same runtime overhead as a virtual function call, although I understand that Haskell is very good at optimizing those away.</p></li>\n</ul>\n\n<p>I think that those are the major differences when comparing feature (Concepts TS) to feature (Haskell type classes). </p>\n\n<p>But there's an underlying philosophical difference in two languages -- and it isn't functional vs. whatever flavor of C++ you're writing. Haskell wants to be modular: being so has many nice properties. C++ templates refuse to be modular: instantiation-time lookup allows for type-based optimization without runtime overhead. This is why C++ generic libraries offer both broad reuse and unparalleled performance. </p>\n"}], "owner": {"reputation": 3181, "user_id": 166601, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3312831361d90cc9218ff3d542a16495?s=128&d=identicon&r=PG&f=1", "display_name": "jbcoe", "link": "https://stackoverflow.com/users/166601/jbcoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3937, "favorite_count": 13, "accepted_answer_id": 32147454, "answer_count": 2, "score": 35, "last_activity_date": 1440183034, "creation_date": 1440091754, "question_id": 32124627, "link": "https://stackoverflow.com/questions/32124627/how-are-c-concepts-different-to-haskell-typeclasses", "title": "How are c++ concepts different to Haskell typeclasses?", "body": "<p>Concepts for C++ from the Concepts TS have been recently merged into GCC trunk. Concepts allow one to constrain generic code by requiring types to satisfy the conditions of the concept ('Comparable' for instance).</p>\n\n<p>Haskell has type classes. I'm not so familiar with Haskell. How are concepts and type classes related?</p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "comments": [{"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1440096452, "post_id": 32124334, "comment_id": 52143562, "body": "It seems to me that the compiler is broken for the architecture. But I&#39;ve been interested in running Haskell in the pi for a long time and have been less lucky than you so far. So you may pull it off ... and let us know if you manage."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1440098831, "post_id": 32124334, "comment_id": 52144828, "body": "@dsign I wouldn&#39;t call it broken but experimental. :) A week or two ago, GHC distribution for ARM was uploaded which was built on Debian Jessie."}, {"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1440098988, "post_id": 32124334, "comment_id": 52144921, "body": "@Sibi Agreed, unfortunate wording on my part. I just wish it could be fixed."}, {"owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "edited": false, "score": 0, "creation_date": 1440099058, "post_id": 32124334, "comment_id": 52144965, "body": "I&#39;ve had GHC 7.8 working on the banana pi, and the raspberry pi (with 7.6 I think).  On the banana pi (with arch) I was even able to compile my yesod project.  But that&#39;s starting to seem like a lucky break.  The same procedures for 7.8 on the pi failed."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1440140372, "post_id": 32124334, "comment_id": 52158855, "body": "Are you running an armv7 or an armv6 Linux distro on your Pi?"}, {"owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "edited": false, "score": 0, "creation_date": 1440141149, "post_id": 32124334, "comment_id": 52159265, "body": "the current device is a raspberry pi 2, with an armv7 processor."}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1440154942, "post_id": 32124334, "comment_id": 52167106, "body": "Was GCC configured/compiled with the gold linker too?"}, {"owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "edited": false, "score": 0, "creation_date": 1440161095, "post_id": 32124334, "comment_id": 52170707, "body": "I just installed gcc with apt-get, I didn&#39;t compile it.  As for the gold linker, I got the symlink technique from a random comment on the internet, and I don&#39;t know if that&#39;s the right way to configure it on debian or not."}, {"owner": {"reputation": 5267, "user_id": 1102851, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/0e1866c32c13460429d2f9ba066949bc?s=128&d=identicon&r=PG", "display_name": "bgamari", "link": "https://stackoverflow.com/users/1102851/bgamari"}, "edited": false, "score": 0, "creation_date": 1440166569, "post_id": 32124334, "comment_id": 52174599, "body": "Could you bring up your question on the <a href=\"https://mail.haskell.org/mailman/listinfo/ghc-devs\" rel=\"nofollow noreferrer\">ghc-devs</a> list? I would be happy to help there."}, {"owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "edited": false, "score": 0, "creation_date": 1440178458, "post_id": 32124334, "comment_id": 52181901, "body": "Ok, posted to ghc-devs, thx."}, {"owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "edited": false, "score": 0, "creation_date": 1440201586, "post_id": 32124334, "comment_id": 52190848, "body": "Its looking like its related to this bug: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10375\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/10375</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "is_accepted": true, "score": 3, "last_activity_date": 1442521703, "creation_date": 1442521703, "answer_id": 32639411, "question_id": 32124334, "link": "https://stackoverflow.com/questions/32124334/ghc-armv7-binary-cabal-illegal-instruction/32639411#32639411", "title": "ghc armv7 binary + cabal? illegal instruction", "body": "<p>Ok finally got this straightened out.  According to the ghc download page you should use llvm 3.5 which comes with debian jessie.  But the default llvm version is 3.5-10 and that doesn't work.  What is needed is 3.5.2-2.  </p>\n\n<p>I downloaded the debs for 3.5.2-2 and installed but it turned into dependency hell pretty quick, needing to install 5-6 libs that llvm 3.5.2-2 requires.  I switched to debian testing and it was easier to get llvm installed.  It might be easier still if you're on debian experimental.  </p>\n\n<p>the ghc 7.10.2 package I used:\n<a href=\"https://packages.debian.org/experimental/armhf/ghc/download\" rel=\"nofollow\">https://packages.debian.org/experimental/armhf/ghc/download</a></p>\n\n<p>the bug where I was using it with the default llvm 3.5 on debian jessie:\n<a href=\"https://ghc.haskell.org/trac/ghc/ticket/10863\" rel=\"nofollow\">https://ghc.haskell.org/trac/ghc/ticket/10863</a></p>\n"}], "owner": {"reputation": 1044, "user_id": 476114, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/18db9bf4cb83fb9c8f30aeb53b3ccfae?s=128&d=identicon&r=PG", "display_name": "Bzzt", "link": "https://stackoverflow.com/users/476114/bzzt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 517, "favorite_count": 1, "accepted_answer_id": 32639411, "answer_count": 1, "score": 7, "last_activity_date": 1442521703, "creation_date": 1440090780, "last_edit_date": 1440092255, "question_id": 32124334, "link": "https://stackoverflow.com/questions/32124334/ghc-armv7-binary-cabal-illegal-instruction", "title": "ghc armv7 binary + cabal? illegal instruction", "body": "<p>I'm trying to get up and running on the raspberry pi 2 with the recently released ghc binaries for armv7, available here:</p>\n\n<p><a href=\"https://www.haskell.org/ghc/download_ghc_7_10_2#linux_armv7\" rel=\"noreferrer\">https://www.haskell.org/ghc/download_ghc_7_10_2#linux_armv7</a></p>\n\n<p>This says it was built with debian jesse, so I've installed debian jesse on my pi2.  I've installed ghc successfully - at least ghci works.  But there's no cabal, and apparently ghc 7.10.2 requires cabal 1.22+.  The debian version of cabal is something like 1.16 (and also would install ghc 7.6.x).  So I'm trying to install cabal-install from source with its bootstrap.sh script.  That downloads the mtl package and builds a 'Setup' executble, then tries to execute it.  But the Setup exe fails with 'illegal instruction'.  </p>\n\n<p>According to the download page, the 'gold' linker is required.  I added that by doing </p>\n\n<blockquote>\n  <p>ln -s <code>which gold</code> ~/bin/ld</p>\n</blockquote>\n\n<p>and setting my path to include ~/bin.  Same result unfortunately.  </p>\n\n<p>Next up I tried reinstalling the ghc binaries with gold (I think).  So as root:</p>\n\n<pre><code>&gt; ln -s `which gold` /usr/local/bin/ld\n&gt; cd ghc-7.10.2\n&gt; make install\n</code></pre>\n\n<p>Once again ghc was successfully installed, but the result for building cabal-install is the same:</p>\n\n<pre><code>bburdette@jessie-rpi:~/code/cabal/cabal-install$ ./bootstrap.sh \nUsing gcc for C compiler. If this is not what you want, set CC.\nUsing /usr/lib/gcc/arm-linux-gnueabihf/4.9/collect2 instead.\nChecking installed packages for ghc-7.10.2...\ndeepseq is already installed and the version is ok.\nbinary is already installed and the version is ok.\ntime is already installed and the version is ok.\nCabal is already installed and the version is ok.\ntransformers is already installed and the version is ok.\nmtl-2.2.1 will be installed from local tarball.\ntext-1.2.0.3 will be downloaded and installed.\nparsec-3.1.7 will be downloaded and installed.\nnetwork-2.6.0.2 will be downloaded and installed.\nold-locale-1.0.0.7 will be downloaded and installed.\nold-time-1.1.0.3 will be downloaded and installed.\nHTTP-4000.2.19 will be downloaded and installed.\nzlib-0.5.4.2 will be downloaded and installed.\nrandom-1.1 will be downloaded and installed.\nstm-2.4.4 will be downloaded and installed.\n\nUsing local tarball for mtl-2.2.1.\n[1 of 1] Compiling Main             ( Setup.hs, Setup.o )\nLinking Setup ...\nIllegal instruction\n\nError during cabal-install bootstrap:\nConfiguring the mtl package failed.\n</code></pre>\n\n<p>Any ideas?</p>\n\n<p>I'm wondering if the symlinks is the correct way to enable gold for this?  Maybe I need to add that as a ghc option in each cabal project, or there's some other way to use gold?  Or maybe that's not the issue at all?  </p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 551, "user_id": 755773, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/93681534482869a80cf1a45f1180d1fd?s=128&d=identicon&r=PG", "display_name": "Yves Par&#232;s", "link": "https://stackoverflow.com/users/755773/yves-par%c3%a8s"}, "edited": false, "score": 5, "creation_date": 1443308797, "post_id": 32130002, "comment_id": 53443062, "body": "This doesn&#39;t work. Using stack exec my-exe +RTS -p shows executables haven&#39;t been compiled with -prof, and trying to do so shows that ld cannot find the profiled versions of the libraries."}, {"owner": {"reputation": 3905, "user_id": 250944, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/725bf8f1d6111d05c7b7887d7f3ce7da?s=128&d=identicon&r=PG", "display_name": "Dfr", "link": "https://stackoverflow.com/users/250944/dfr"}, "edited": false, "score": 2, "creation_date": 1449866952, "post_id": 32130002, "comment_id": 56208410, "body": "This worked for me: <code>stack install --enable-executable-profiling --enable-library-profiling --ghc-options=&quot;-fprof-auto -rtsopts&quot;</code>"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1487602468, "post_id": 32130002, "comment_id": 71846530, "body": "How do you execute it / profile it after the build has finished?"}, {"owner": {"reputation": 9504, "user_id": 470844, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8354544a22bb5a0ac8005ca008f94ad1?s=128&d=identicon&r=PG", "display_name": "ntc2", "link": "https://stackoverflow.com/users/470844/ntc2"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 1, "creation_date": 1487616485, "post_id": 32130002, "comment_id": 71855079, "body": "@ChrisStryczynski: I just edited my answer. Hope that helps."}, {"owner": {"reputation": 1115, "user_id": 890016, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/BO6bH.png?s=128&g=1", "display_name": "Mario Carneiro", "link": "https://stackoverflow.com/users/890016/mario-carneiro"}, "edited": false, "score": 2, "creation_date": 1541298579, "post_id": 32130002, "comment_id": 93167505, "body": "Could you put the part about <code>.stack-work-profile</code> first? The first time I read this answer, I saw the first line and did it, and regretted it once I read on."}, {"owner": {"reputation": 2707, "user_id": 784284, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/fbdc90cdceb8b8c04841bb794d40d704?s=128&d=identicon&r=PG", "display_name": "Calvin", "link": "https://stackoverflow.com/users/784284/calvin"}, "edited": false, "score": 2, "creation_date": 1571107862, "post_id": 32130002, "comment_id": 103120402, "body": "Hi from 2019! Today with Stack 2.1.3, these instructions did not work for me. I needed to add <code>--profile</code> to the <code>stack exec</code> call as well. This worked: <code>stack build --profile &amp;&amp; stack exec --profile -- my-exe +RTS ...</code>"}, {"owner": {"reputation": 9504, "user_id": 470844, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8354544a22bb5a0ac8005ca008f94ad1?s=128&d=identicon&r=PG", "display_name": "ntc2", "link": "https://stackoverflow.com/users/470844/ntc2"}, "reply_to_user": {"reputation": 2707, "user_id": 784284, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/fbdc90cdceb8b8c04841bb794d40d704?s=128&d=identicon&r=PG", "display_name": "Calvin", "link": "https://stackoverflow.com/users/784284/calvin"}, "edited": false, "score": 1, "creation_date": 1571115596, "post_id": 32130002, "comment_id": 103122027, "body": "@Calvin: thanks for the heads up! Ijust  updated my answer to include <code>--profile</code> in the <code>stack exec</code> command. My brief testing indicates that Stack 2.x versions are smarter than before about profiling, automatically keeping the regular and <code>--profile</code> versions separate, but I can&#39;t find the documentation for this. I believe this is the relevant Stack issue, but it&#39;s still open: <a href=\"https://github.com/commercialhaskell/stack/issues/4032\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/4032</a>"}, {"owner": {"reputation": 325758, "user_id": 415784, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2WX9Z.jpg?s=128&g=1", "display_name": "Nawaz", "link": "https://stackoverflow.com/users/415784/nawaz"}, "edited": false, "score": 0, "creation_date": 1594231964, "post_id": 32130002, "comment_id": 111057322, "body": "What do the numbers mean in <code>src&#47;Main.hs:(4,1)-(5,15)</code>? I initially thought they&#39;re range of line numbers but they dont make sense; also they dont seem to match in my case.. The first of each pair may define a range of lines?"}, {"owner": {"reputation": 325758, "user_id": 415784, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2WX9Z.jpg?s=128&g=1", "display_name": "Nawaz", "link": "https://stackoverflow.com/users/415784/nawaz"}, "edited": false, "score": 0, "creation_date": 1594232217, "post_id": 32130002, "comment_id": 111057449, "body": "Ok. It seems they indicate the pair of the cursor locations.. as in the code-snippet <i>from</i> and <i>to</i> .."}], "tags": [], "owner": {"reputation": 9504, "user_id": 470844, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/8354544a22bb5a0ac8005ca008f94ad1?s=128&d=identicon&r=PG", "display_name": "ntc2", "link": "https://stackoverflow.com/users/470844/ntc2"}, "is_accepted": true, "score": 104, "last_activity_date": 1571116007, "last_edit_date": 1571116007, "creation_date": 1440112795, "answer_id": 32130002, "question_id": 32123475, "link": "https://stackoverflow.com/questions/32123475/profiling-builds-with-stack/32130002#32130002", "title": "Profiling builds with Stack", "body": "<h1>Profiling builds with Stack 1.0.0 and newer</h1>\n\n<p>To build with profiling enabled:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>stack build --profile\n</code></pre>\n\n<p><strong>You may need to run <code>stack clean</code> first</strong>, but <a href=\"https://github.com/commercialhaskell/stack/issues/2984\" rel=\"noreferrer\">this should be fixed in Stack 1.5.0</a>.</p>\n\n<p>To profile:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>stack exec --profile -- &lt;your program&gt; +RTS &lt;profiling options&gt;\n</code></pre>\n\n<p>where for <code>&lt;profiling options&gt;</code> you might want <code>-p</code> for time profiling or <code>-h</code> for memory profiling. For time profiling, the profile appears in <code>./&lt;your program&gt;.prof</code>, and for memory profiling, the profile appears in <code>./&lt;your program&gt;.hp</code>.</p>\n\n<p>See <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html\" rel=\"noreferrer\">GHC profiling documentation</a> for more profiling options.</p>\n\n<h1>Avoiding unnecessary rebuilding of local packages (fixed in Stack 2.X?)</h1>\n\n<p>Due to a <a href=\"https://github.com/commercialhaskell/stack/issues/1132\" rel=\"noreferrer\">long standing Stack\nissue</a>,\nswitching between profiling and non-profiling builds can cause a lot\nof unnecessary rebuilding of local packages and <code>extra-deps</code>. To work\naround this, you can use separate build caches for your profiling and\nnon-profiling builds. For example, where you use <code>stack &lt;cmd&gt;</code> for\nnon profiling you can use</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>stack --work-dir .stack-work-profile --profile &lt;cmd&gt;\n</code></pre>\n\n<p>for a profiling version of <code>&lt;cmd&gt;</code>. This uses a separate \ncache in <code>.stack-work-profile</code> for profiling artifacts,\nwhereas non profiling artifacts will be preserved in the default\n<code>.stack-work</code> cache.</p>\n\n<h1>Profiling builds with Stack versions before 1.0.0 (i.e. from 2015)</h1>\n\n<p>To build with profiling enabled:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>stack build --executable-profiling --library-profiling --ghc-options=\"-fprof-auto -rtsopts\"\n</code></pre>\n\n<p>To profile:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>stack exec -- &lt;your program&gt; +RTS &lt;profiling options&gt;\n</code></pre>\n\n<h1>Example for Stack 1.0.0 and newer</h1>\n\n<p>Suppose you have a package called <code>test</code> with a single executable <code>test</code> defined by <code>main</code> here:</p>\n\n<pre><code>module Main where\n\nmain :: IO ()\nmain = do\n  print $ foo 0\n\nfoo :: Int -&gt; Int\nfoo x = fooSub (x+1)\n  where\n    fooSub x = bar (x+1)\n\nbar :: Int -&gt; Int\nbar x = barSub (x+1)\n  where\n    barSub x = barSubSub (x+1)\n      where\n        barSubSub x = x+1\n</code></pre>\n\n<p>then doing <code>stack build --profile &amp;&amp; stack exec -- test +RTS -p</code> will produce a file <code>./test.prof</code> which includes</p>\n\n<pre><code>                                                                                                individual      inherited\nCOST CENTRE                 MODULE                SRC                        no.     entries  %time %alloc   %time %alloc\n\n  [... many lines omitted ...]\n  main                      Main                  src/Main.hs:(4,1)-(5,15)    97          0    0.0    0.0     0.0    0.0\n   foo                      Main                  src/Main.hs:(8,1)-(10,24)   98          1    0.0    0.0     0.0    0.0\n    foo.fooSub              Main                  src/Main.hs:10:5-24         99          1    0.0    0.0     0.0    0.0\n     bar                    Main                  src/Main.hs:(13,1)-(17,46) 100          1    0.0    0.0     0.0    0.0\n      bar.barSub            Main                  src/Main.hs:(15,5)-(17,46) 101          1    0.0    0.0     0.0    0.0\n       bar.barSub.barSubSub Main                  src/Main.hs:17:9-46        102          1    0.0    0.0     0.0    0.0\n main                       Main                  src/Main.hs:(4,1)-(5,15)    95          0    0.0   20.5     0.0   20.5\n</code></pre>\n\n<p>I.e., there is profiling information for all definitions, including\nlocal definitions in <code>where</code> clauses.</p>\n\n<p>If you only want to profile top-level definitions, you can build with\nthe GHC option <code>-fprof-auto-top</code> instead: doing <code>stack build --profile --ghc-options=-fprof-auto-top &amp;&amp; stack exec -- test +RTS -p</code> produces a <code>./test.prof</code> which includes</p>\n\n<pre><code>                                                                                individual      inherited\nCOST CENTRE MODULE                SRC                        no.     entries  %time %alloc   %time %alloc\n\n [... many lines omitted ...]\n  main      Main                  src/Main.hs:(4,1)-(5,15)    97          0    0.0    0.0     0.0    0.0\n   foo      Main                  src/Main.hs:(8,1)-(10,24)   98          1    0.0    0.0     0.0    0.0\n    bar     Main                  src/Main.hs:(13,1)-(17,46)  99          1    0.0    0.0     0.0    0.0\n main       Main                  src/Main.hs:(4,1)-(5,15)    95          0    0.0   20.5     0.0   20.5\n</code></pre>\n\n<p>instead.</p>\n\n<p>Finally, note that <code>stack build --profile</code> also turns on stack\ntraces. If you change the program so that <code>barSubSub x = error $ show x</code>, then running <code>stack build --profile &amp;&amp; stack exec test</code> produces</p>\n\n<pre><code>test: 4\nCallStack (from HasCallStack):\n  error, called at src/Main.hs:17:23 in main:Main\nCallStack (from -prof):\n  Main.bar.barSub.barSubSub (src/Main.hs:17:9-36)\n  Main.bar.barSub (src/Main.hs:(15,5)-(17,36))\n  Main.bar (src/Main.hs:(13,1)-(17,36))\n  Main.foo.fooSub (src/Main.hs:10:5-24)\n  Main.foo (src/Main.hs:(8,1)-(10,24))\n  Main.main (src/Main.hs:(4,1)-(5,15))\n  Main.CAF:lvl8_r4Fc (&lt;no location info&gt;)\n</code></pre>\n\n<p>Pretty cool!</p>\n"}, {"tags": [], "owner": {"reputation": 6587, "user_id": 3407728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/391a8b936b51adccd057c83e6ace7241?s=128&d=identicon&r=PG", "display_name": "Tom&#225;\u0161 Janou\u0161ek", "link": "https://stackoverflow.com/users/3407728/tom%c3%a1%c5%a1-janou%c5%a1ek"}, "is_accepted": false, "score": 14, "last_activity_date": 1571066779, "last_edit_date": 1571066779, "creation_date": 1452261800, "answer_id": 34678897, "question_id": 32123475, "link": "https://stackoverflow.com/questions/32123475/profiling-builds-with-stack/34678897#34678897", "title": "Profiling builds with Stack", "body": "<p>I had this problem as well and found that the problem was in the invocation:</p>\n\n<p><code>stack exec my-exe +RTS -p</code> passes <code>-p</code> to stack instead of my-exe. This works:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>stack exec -- my-exe +RTS -p\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13132, "user_id": 2168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/5e7e68e1cdaea224d93da209afb28e9d?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/2168/john"}, "edited": false, "score": 1, "creation_date": 1496889836, "post_id": 40922201, "comment_id": 75849872, "body": "You can also add &quot;--force-dirty&quot; to the end of your stack build command to force it to recompile."}, {"owner": {"reputation": 917, "user_id": 310162, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/7b2de1e75c19ad98aa5757ca005cca9a?s=128&d=identicon&r=PG", "display_name": "arya", "link": "https://stackoverflow.com/users/310162/arya"}, "edited": false, "score": 0, "creation_date": 1582924146, "post_id": 40922201, "comment_id": 106957114, "body": "did you mean to say <code>stack exec</code>?"}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 5, "last_activity_date": 1486306283, "last_edit_date": 1495540034, "creation_date": 1480634431, "answer_id": 40922201, "question_id": 32123475, "link": "https://stackoverflow.com/questions/32123475/profiling-builds-with-stack/40922201#40922201", "title": "Profiling builds with Stack", "body": "<p>For <code>stack build</code>, <code>stack bench</code> and <code>stack test</code> you can just use <code>stack build/bench/test --profile</code>. You may have to <code>stack clean</code> first to get it to recompile with profiling.</p>\n\n<p>For <code>stack build</code> you will still have to pass <code>+RTS -p</code> or whatever option you need (see <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html#time-and-allocation-profiling\" rel=\"nofollow noreferrer\">GHC User Guide</a>) when running the executable as in <a href=\"https://stackoverflow.com/a/34678897/2246434\">@Tom\u00e1\u0161 Janou\u0161ek answer</a>.</p>\n\n<p>You can also find more information in the <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/GUIDE.md#debugging\" rel=\"nofollow noreferrer\">debugging section of the stack user guide</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "reply_to_user": {"reputation": 428, "user_id": 2521261, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/wCt8l.png?s=128&g=1", "display_name": "Lupus Ossorum", "link": "https://stackoverflow.com/users/2521261/lupus-ossorum"}, "edited": false, "score": 0, "creation_date": 1556354007, "post_id": 55631220, "comment_id": 98416425, "body": "@LupusOssorum: I don&#39;t know if there&#39;s a way to turn a <code>.prof</code> file into PDF. But there are visualization tools for <code>.prof</code> files such as <a href=\"https://jaspervdj.be/posts/2014-02-25-profiteur-ghc-prof-visualiser.html\" rel=\"nofollow noreferrer\">profiteur</a>, <a href=\"https://github.com/vincenthz/professor\" rel=\"nofollow noreferrer\">professor</a>, and <a href=\"https://github.com/maoe/viewprof\" rel=\"nofollow noreferrer\">viewprof</a>."}], "tags": [], "owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "is_accepted": false, "score": 2, "last_activity_date": 1554981374, "creation_date": 1554981374, "answer_id": 55631220, "question_id": 32123475, "link": "https://stackoverflow.com/questions/32123475/profiling-builds-with-stack/55631220#55631220", "title": "Profiling builds with Stack", "body": "<p>Assuming a project called <code>project-name</code>, this is how I get a time and heap profile (with colors):</p>\n\n<ol>\n<li>Add dependencies to the <code>build-depends</code> section of <code>project-name.cabal</code></li>\n<li>Get dependent packages: <code>stack build</code></li>\n<li>From inside <code>project-name/app</code> compile the program with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html#ghc-flag--prof\" rel=\"nofollow noreferrer\">profiling enabled</a>: <code>stack ghc -- -prof -fprof-auto -rtsopts -O2 Main.hs</code></li>\n<li>Then create the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html#rts-options-for-heap-profiling\" rel=\"nofollow noreferrer\">heap</a> and <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html#rts-flag--p\" rel=\"nofollow noreferrer\">time</a> profile <code>./Main +RTS -hc -p</code>. This will produce <code>Main.hp</code> and <code>Main.prof</code></li>\n<li>Turn the heap profile into a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html#hp2ps-rendering-heap-profiles-to-postscript\" rel=\"nofollow noreferrer\">PostScript file</a> and then into a PDF chart with colors: <code>stack exec -- hp2ps -c Main.hp &amp;&amp; ps2pdf Main.ps</code></li>\n</ol>\n\n<p>That's the heap profile from the PDF:</p>\n\n<p><a href=\"https://i.stack.imgur.com/nNbAW.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nNbAW.png\" alt=\"heap_profile_with_colors\"></a></p>\n"}], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14217, "favorite_count": 27, "accepted_answer_id": 32130002, "answer_count": 4, "score": 66, "last_activity_date": 1571116007, "creation_date": 1440087862, "last_edit_date": 1554981941, "question_id": 32123475, "link": "https://stackoverflow.com/questions/32123475/profiling-builds-with-stack", "title": "Profiling builds with Stack", "body": "<p>How do I tell <code>stack</code> to build my executable and all its dependencies with <code>-prof</code>? </p>\n\n<p>Simply adding it to <code>ghc-options</code> in the <code>.cabal</code> file is not enough, because it only tries to build the executable with profiling enabled, which fails.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1440086996, "post_id": 32122778, "comment_id": 52138521, "body": "To be clear: You want the union of all sets with a non-empty intersection?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1440087024, "post_id": 32122778, "comment_id": 52138536, "body": "...actually, thinking about it, that sounds just as confusing. :-/"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440089984, "post_id": 32122778, "comment_id": 52140036, "body": "You might want to define the performance target you&#39;re looking for in terms of algorithm complexity!"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1440090031, "post_id": 32122778, "comment_id": 52140070, "body": "Could you provide link to your data set (or something similar), so we can benchmark on our own?"}], "answers": [{"comments": [{"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440088164, "post_id": 32123458, "comment_id": 52139155, "body": "The result should be <code>Set (Set a)</code>, so you need a <code>fromList</code> call"}, {"owner": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "edited": false, "score": 0, "creation_date": 1440088336, "post_id": 32123458, "comment_id": 52139224, "body": "Thanks. I&#39;m testing this solution on a large set of sets. About 200K sets of 2-4 integers. It&#39;s taking a while."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440088727, "post_id": 32123458, "comment_id": 52139426, "body": "I think I see the problem. You need to call <code>mergeSets</code> again until you get completely disjoint sets. IN that case a completely different algorithm is warranted."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440089557, "post_id": 32123458, "comment_id": 52139847, "body": "I have posted such an algorithm consisting of a &quot;simultaneous construction &amp; consumption&quot; fold."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440090079, "post_id": 32123458, "comment_id": 52140102, "body": "Nice reference to <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-IntSet.html\" rel=\"nofollow noreferrer\"><b><code>Data.IntSet</code></b></a>. I often substitute <code>(Enum a =&gt; Set a)</code> with  <code>IntSet a</code> by using the <code>fromEnum</code> call. This can save <i>a ton</i> of space and result in <i>much</i> better access times."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 5, "last_activity_date": 1440098074, "last_edit_date": 1440098074, "creation_date": 1440087802, "answer_id": 32123458, "question_id": 32122778, "link": "https://stackoverflow.com/questions/32122778/how-to-merge-all-intersecting-set-a-in-haskell/32123458#32123458", "title": "How to merge all intersecting (Set a) in Haskell?", "body": "<p>For the large number of sets you want to merge you want to use a <a href=\"https://www.cs.princeton.edu/~rs/AlgsDS07/01UnionFind.pdf\" rel=\"nofollow\">union find</a> algorithm.</p>\n\n<p>You can find Haskell code which implements the union find algorithm here:</p>\n\n<p><a href=\"https://github.com/erantapaa/union-find-example\" rel=\"nofollow\">https://github.com/erantapaa/union-find-example</a></p>\n\n<p>Also, for Int sets you'll want to use <code>Data.IntSet</code> - it much more efficient.</p>\n\n<p>Previously I wrote the following which doesn't transitively merge sets:</p>\n\n<p>It's a fold:</p>\n\n<pre><code>import qualified Data.Set as S\nimport Data.List (foldl')\n\nmergeSets as = foldl' merge [] as\n\n-- merge one set into a list of sets\nmerge [] a = [a]\nmerge (b:bs) a = if S.null (S.intersection a b)\n                    then b : merge bs a\n                    else (S.union a b) : bs\n\ntest = mergeSets [ S.fromList [1,2], S.fromList [2,3], S.fromList [5] ]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "edited": false, "score": 0, "creation_date": 1440089678, "post_id": 32123832, "comment_id": 52139899, "body": "Thanks for the clear explanation. I&#39;m testing this on 200,000 sets of (Set Text) where the inner sets have 1-4 members. Performance still seems to be a major issue."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "edited": false, "score": 0, "creation_date": 1440090225, "post_id": 32123832, "comment_id": 52140176, "body": "@dan <code>O(n+m)</code> for intersection checks, and <code>O(q^2)</code> checks, where <code>n</code> &amp;<code>m</code> are the size of member sets and <code>q</code> is the size of the set of sets. That makes the time complexity <code>O(n*q^2)</code> where <code>n</code> is the size of the largest member set and <code>q</code> is the size of set of sets. I&#39;m not sure if there is room for improvement... I will think about it!"}, {"owner": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "edited": false, "score": 0, "creation_date": 1440091015, "post_id": 32123832, "comment_id": 52140569, "body": "The processing run took 21 minutes, reducing 200,000 sets to about 90,000. That may be acceptable."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "edited": false, "score": 0, "creation_date": 1440091221, "post_id": 32123832, "comment_id": 52140669, "body": "@dan There might be a more efficient method by transforming <code>Set (Set a)</code> to another data-structure such as <code>Graph a</code> or <code>Set IntSet</code>. This will require some thought. Must a solution work in general for all parameterized types <code>a</code>, or would you like a possible optimized answer for a specific type such as <code>Text</code>?"}, {"owner": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "edited": false, "score": 0, "creation_date": 1440091757, "post_id": 32123832, "comment_id": 52140970, "body": "The <code>Text</code> data is a bunch of codes like <code>B0055URMG0</code> that can be translated into <code>Integer</code> using base36 encoding. So either <code>Text</code> or <code>Integer</code> would be fine; <code>Int</code> is too small."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "edited": false, "score": 0, "creation_date": 1440092081, "post_id": 32123832, "comment_id": 52141119, "body": "@dan Perhaps <a href=\"https://hackage.haskell.org/package/hashmap-1.3.0.1/docs/Data-HashSet.html\" rel=\"nofollow noreferrer\"><b><code>HashSet</code></b></a> would be a more appropriate data-structure? Try using <code>Set (HashSet Text)</code>. Hope that there are no hash collisions! If so, we lose the correctness of the result..."}, {"owner": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "edited": false, "score": 0, "creation_date": 1440092698, "post_id": 32123832, "comment_id": 52141489, "body": "HashSet is not quite a drop-in replacement. There&#39;s no <code>findMin</code> or <code>deleteMin</code>"}, {"owner": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "edited": false, "score": 0, "creation_date": 1440093178, "post_id": 32123832, "comment_id": 52141741, "body": "Thanks for your help. I&#39;ll accept your answer since you&#39;ve done enough."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "edited": false, "score": 0, "creation_date": 1440093178, "post_id": 32123832, "comment_id": 52141742, "body": "@dan You are correct, but the <code>findMin</code> &amp; <code>deleteMin</code> functions will operate on the type <code>Set (HashSet Text)</code>. <code>findMin</code> &amp; <code>deleteMin</code> are applied to the outer set <code>Set (HashSet Text)</code>, the set of sets, not the member sets which will be substituted for <code>HashSet Text</code>. It should still work by modifying the imports and qualifications on some of the Set/HashSet calls. For instance you will need to differentiate between the similarly names functions in the two separate modules!"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440094342, "post_id": 32123832, "comment_id": 52142374, "body": "How about assigning the Text values unique integer values starting from 1.  From what you say you only have at most 1 million distinct Text values."}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "reply_to_user": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "edited": false, "score": 0, "creation_date": 1440094918, "post_id": 32123832, "comment_id": 52142694, "body": "@dan @user5402 You could enumerate all the <code>Text</code> values into a <code>Map Int Text</code>, then use <code>Set IntSet</code> as the data-structure. After doing the intensive <code>innerUnion</code> operation, you then translate the <code>Int</code>s back to the corresponding <code>Text</code> values. That might work better then the current general solution. If you need help with such a process, you should probably ask it as a different question, and include a reference to this question."}, {"owner": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "edited": false, "score": 0, "creation_date": 1440096521, "post_id": 32123832, "comment_id": 52143600, "body": "@recursion.ninja Thanks for the suggestions. I might not be able to try them out immediately but I&#39;ll post if and when I get around to it."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440098151, "post_id": 32123832, "comment_id": 52144462, "body": "I&#39;ve updated my answer with a link to code which uses a union-find algo."}], "tags": [], "owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "is_accepted": true, "score": 2, "last_activity_date": 1440089694, "last_edit_date": 1440089694, "creation_date": 1440089024, "answer_id": 32123832, "question_id": 32122778, "link": "https://stackoverflow.com/questions/32122778/how-to-merge-all-intersecting-set-a-in-haskell/32123832#32123832", "title": "How to merge all intersecting (Set a) in Haskell?", "body": "<h3>This definition works as expected on complicated <code>Set (Set a)</code> constructions</h3>\n\n<p><a href=\"http://ideone.com/0UMug3\" rel=\"nofollow\"><strong>Solution:</strong></a></p>\n\n<pre><code>import qualified Data.Set as S\n\ninnerUnions :: Ord a =&gt;  S.Set (S.Set a) -&gt; S.Set (S.Set a)\ninnerUnions = innerUnion' S.empty\n  where\n    innerUnion' :: Ord a =&gt;  S.Set (S.Set a) -&gt; S.Set (S.Set a) -&gt; S.Set (S.Set a)\n    innerUnion' seta setb\n      | S.null setb = seta\n      | otherwise   = innerUnion' (S.insert unioned seta) stripped\n      where\n        (unioned,stripped) = S.foldl f (minElem, setb') setb'\n        minElem = S.findMin setb\n        setb' = S.deleteMin setb\n        f :: Ord a =&gt; (S.Set a, S.Set (S.Set a)) -&gt; S.Set a -&gt; (S.Set a, S.Set (S.Set a))\n        f (x,xs) y\n          | (not . S.null) (x `S.intersection` y) = (x `S.union` y, S.delete y xs)\n          | otherwise = (x,xs)\n</code></pre>\n\n<p>A simple fold will not work for complex <code>Set (Set a)</code> constructions. A simple fold will produce <em>incorrect</em> results</p>\n\n<p><strong>Example:</strong></p>\n\n<pre><code>ghci&gt; simpleFold $ S.fromList \n         [ S.fromList [1,2], S.fromList [2,3], S.fromList [3,4]\n         , S.fromList [5], S.fromList [5,6], S.fromList [6]\n         , S.fromList [8,9], S.fromList [0,9], S.fromList [0,1]]\n&gt; fromList [fromList [0,1,2,3,4],fromList [5,6],fromList [0,8,9]]\n</code></pre>\n\n<p><strong>Correct Transformation:</strong></p>\n\n<pre><code>ghci&gt; innerUnions $ S.fromList \n         [ S.fromList [1,2], S.fromList [2,3], S.fromList [3,4]\n         , S.fromList [5], S.fromList [5,6], S.fromList [6]\n         , S.fromList [8,9], S.fromList [0,9], S.fromList [0,1]]\n&gt; fromList [fromList [0,1,2,3,4,8,9],fromList [5,6]]\n</code></pre>\n\n<p>This is because we must consume the input set while building the result set. A fold will not have access to the entire input set during the fold, only access to a single element of the input set at a given time. This means that the transformation function cannot properly consume elements from the input set because it cannot access all elements of the input set. We need to manually write a more complicated fold which <em>simultaneously</em> consumes the input set and builds the result set. </p>\n\n<p>The <code>f</code> function above performs this simultaneous consumption &amp; construction when applied to a fold. </p>\n"}], "owner": {"reputation": 38848, "user_id": 232417, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/004e78a7e0aaf9f1eb0009668cd84b1a?s=128&d=identicon&r=PG", "display_name": "dan", "link": "https://stackoverflow.com/users/232417/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 510, "favorite_count": 0, "accepted_answer_id": 32123832, "answer_count": 2, "score": 2, "last_activity_date": 1440098074, "creation_date": 1440085767, "last_edit_date": 1440090454, "question_id": 32122778, "link": "https://stackoverflow.com/questions/32122778/how-to-merge-all-intersecting-set-a-in-haskell", "title": "How to merge all intersecting (Set a) in Haskell?", "body": "<p>I have a set of sets represented by type <code>Set (Set a)</code> from <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3\" rel=\"nofollow\"><strong><code>Data.Set</code></strong></a>. </p>\n\n<p><em>I want to union all the member sets whose intersection is not empty.</em> </p>\n\n<p>Equivalently, I want the components of the graph where there is an edge connecting <em>x</em> and <em>y</em> if <em>x</em> and <em>y</em> are in the same Set.</p>\n\n<p><strong>Examples:</strong></p>\n\n<pre><code>-- import qualified Data.Set as S\nghci&gt; f $ S.fromList [S.fromList [1,2], S.fromList [2,3], S.fromList [5]]\n&gt; S.fromList [S.fromList [1,2,3], S.fromList [5]]\n\nghci&gt; f $ S.fromList [ S.fromList [1,2], S.fromList [2,3], S.fromList [3,4] ]\n&gt; S.fromlist [ S.fromList [1,2,3,4] ]\n</code></pre>\n\n<p>What would be an elegant and <em>performant</em> solution?</p>\n"}, {"tags": ["haskell", "data-kinds"], "comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1440089920, "post_id": 32121688, "comment_id": 52140004, "body": "Without <code>DataKind</code>? Aren&#39;t you already using the extension given the type of <code>Universe</code> and <code>Worker</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1440090375, "post_id": 32121688, "comment_id": 52140248, "body": "It&#39;s pretty hard for me to see, from your code, what your ultimate goal is. That is, I can&#39;t tell which parts are important to you and which are pieces of the solution you don&#39;t like."}, {"owner": {"reputation": 1980, "user_id": 1773231, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fa583dce412cb12defd92d6c18700df6?s=128&d=identicon&r=PG", "display_name": "Martin Kolinek", "link": "https://stackoverflow.com/users/1773231/martin-kolinek"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1440095215, "post_id": 32121688, "comment_id": 52142864, "body": "@gallais, yes I&#39;m already using DataKinds extension, I was just asking whether there isn&#39;t a better solution."}, {"owner": {"reputation": 1980, "user_id": 1773231, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fa583dce412cb12defd92d6c18700df6?s=128&d=identicon&r=PG", "display_name": "Martin Kolinek", "link": "https://stackoverflow.com/users/1773231/martin-kolinek"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1440095764, "post_id": 32121688, "comment_id": 52143198, "body": "@dfeuer, my ultimate goal is to get a compile time error when I try to call doSomething with a worker and a universe if the worker and universe are unrelated. I achieve this by adding a version to the Universe and the workers which is incremented everytime something has happened. The type of the function doSomething checks whether the universe and the worker have the same version. This solution is ok, I&#39;m just wondering if there isn&#39;t a simpler one as I have a feeling that the Haskell type system can check it without the version."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 2, "creation_date": 1440104184, "post_id": 32121688, "comment_id": 52147746, "body": "Ok, I think I see what you mean. I&#39;d say that <a href=\"http://stackoverflow.com/questions/12468622/how-does-the-st-monad-work\">something similar to the ST monad</a> would be idiomatic."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1440105800, "post_id": 32121688, "comment_id": 52148510, "body": "And here is a link to the paper describing it: <a href=\"http://www.researchgate.net/profile/Simon_Peyton_Jones/publication/2295326_Lazy_Functional_State_Threads/links/0046351edd5bb96287000000.pdf\" rel=\"nofollow noreferrer\">researchgate.net/profile/Simon_Peyton_Jones/publication/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1440103642, "creation_date": 1440103642, "answer_id": 32128086, "question_id": 32121688, "link": "https://stackoverflow.com/questions/32121688/how-do-i-make-values-depend-on-other-values-without-datakinds/32128086#32128086", "title": "How do I make values depend on other values without DataKinds?", "body": "<p>One way is to use existential types:</p>\n\n<pre><code>data Un = forall s. Un (Universe s)\n\ndoSomething :: Worker s -&gt; Universe s -&gt; Un\n\ninitialUniverse :: Un\n\n\ndoStep :: Un -&gt; Un\ndoStep (Un u) = let w = head $ _allWorkers u\n               u2 = doSomething w u\n               w2 = head $ _allWorkers u2\n               u3 = doSomething w2 u2\n            in Un u3\n</code></pre>\n"}], "owner": {"reputation": 1980, "user_id": 1773231, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fa583dce412cb12defd92d6c18700df6?s=128&d=identicon&r=PG", "display_name": "Martin Kolinek", "link": "https://stackoverflow.com/users/1773231/martin-kolinek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 32128086, "answer_count": 1, "score": 4, "last_activity_date": 1440103642, "creation_date": 1440082714, "last_edit_date": 1440100295, "question_id": 32121688, "link": "https://stackoverflow.com/questions/32121688/how-do-i-make-values-depend-on-other-values-without-datakinds", "title": "How do I make values depend on other values without DataKinds?", "body": "<p>I have a universe type, and a worker type. Workers can change the universe. What I would like to achieve is ensure that the universe can only be modified by workers from that universe (not one in the future, or in the past).</p>\n\n<p>The best I could achieve is this:</p>\n\n<pre><code>{-# LANGUAGE DataKinds       #-}\n{-# LANGUAGE KindSignatures  #-}\n\nmodule Module(initialUniverse, doSomething, doStep) where\n\ndata Nat = Z | S Nat\n\ndata Universe (t :: Nat) = Universe {\n  _allWorkers :: [Worker t]\n}\n\ndata Worker (t :: Nat) = Worker\n\ninitialUniverse :: Universe Z\ninitialUniverse = Universe [Worker]\n\ndoSomething :: Worker t -&gt; Universe t -&gt; Universe (S t)\ndoSomething = undefined\n\ndoStep :: Universe t -&gt; Universe (S (S t))\ndoStep u = let w = head $ _allWorkers u\n               u2 = doSomething w u\n               w2 = head $ _allWorkers u2\n               u3 = doSomething w2 u2\n           in u3\n</code></pre>\n\n<p>If I change <code>w2 = head $ _allWorkers u2</code> to <code>w2 = head $ _allWorkers u</code> I get a compilation error which is what I want.</p>\n\n<p>What I don't like that much is that now I have a version attached to each universe, and I have to increment it manually. Can this be done in another way which would not require the explicit versioning? Something like making the <code>doSomething</code> function return a <code>Universe otherType</code> where the type checker would know <code>otherType</code> is different from <code>t</code>.</p>\n\n<p>Thanks for your time. </p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1440082050, "post_id": 32121241, "comment_id": 52135125, "body": "I haven&#39;t read the whole question, but why not simply define <code>isqrt</code> as <code>floor . sqrt . fromIntegral</code>?"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440082124, "post_id": 32121241, "comment_id": 52135169, "body": "Consider using tools from the <a href=\"https://hackage.haskell.org/package/arithmoi\" rel=\"nofollow noreferrer\"><b><code>arithmoi</code></b> package</a>"}, {"owner": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440082325, "post_id": 32121241, "comment_id": 52135339, "body": "Surely there is some room for dynamic programming via memorization. If <code>ax^2 + by^2 + cz^2 = n&#47;q</code> exists, then you know that <code>qax^2 + qby^2 + qcz^2 = n</code> exists. This multiplicity memorization technique will work for all numbers <code>q</code> in the set <code>[2..sqrt n]</code>. Efficient optimizations will likely devolve into application of number theory theorems. This might be better received on math.SE."}, {"owner": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1440082413, "post_id": 32121241, "comment_id": 52135414, "body": "@Jubobs Because for a square number, sqrt may give a result slightly less than a integer, and then floor would round it down to the number below. Of course, you could put in a guard to check if it&#39;s doing this or not, but I feel happier keeping everything as an integer."}, {"owner": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "reply_to_user": {"reputation": 4938, "user_id": 1465011, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5c11daff0c870a2b41ae9b907a136adf?s=128&d=identicon&r=PG", "display_name": "recursion.ninja", "link": "https://stackoverflow.com/users/1465011/recursion-ninja"}, "edited": false, "score": 0, "creation_date": 1440083447, "post_id": 32121241, "comment_id": 52136229, "body": "@recursion.ninja That&#39;s a good technique, and it would certainly generate a lot of answers, but it may be possible that there are solutions a,b,c to a^2 +b^2 + c^2 = n, with composite n, where a,b,c have no common factor. Some equations you can show ARE multiplicative in this sense, so you only need to worry about the case where n is a prime power, but I&#39;m not sure it&#39;s obvious for a general ellipse."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440086166, "post_id": 32121241, "comment_id": 52138011, "body": "@user1440894 See my comments about <code>floor</code> and <code>sqrt</code> at the end of my answer."}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1440085195, "post_id": 32121537, "comment_id": 52137418, "body": "The modification to count both positive and negative solutions is <code>sum [ (1+signum x)*(1+signum y)*(1+signum z) | ... ]</code>. There&#39;s a pair of 2 solutions when the coordinate isn&#39;t 0."}, {"owner": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "edited": false, "score": 0, "creation_date": 1440086224, "post_id": 32121537, "comment_id": 52138040, "body": "That looks great - why is it so much quicker though?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1440086851, "post_id": 32121537, "comment_id": 52138416, "body": "Because your algorithm iterates over the same values of (x,y,z) multiple times. For instance, you look at (0,0,0) n times (when n = 0, n = 1, ...), but you only count it once -  when n = 0."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 4, "last_activity_date": 1440086241, "last_edit_date": 1440086241, "creation_date": 1440082333, "answer_id": 32121537, "question_id": 32121241, "link": "https://stackoverflow.com/questions/32121241/most-efficient-algorithm-to-find-integer-points-within-an-ellipse/32121537#32121537", "title": "Most efficient algorithm to find integer points within an ellipse", "body": "<p>Some things I would try:</p>\n\n<p><code>isqrt</code> is not efficient for the range of values you are working work. Simply use the floating point <code>sqrt</code> function:</p>\n\n<pre><code>isqrt = floor $ sqrt ((fromIntegral n) :: Double)\n</code></pre>\n\n<p>Alternatively, instead of computing integer square roots, use logic like this in your list comprehensions:</p>\n\n<pre><code>x &lt;- takeWhile (\\x -&gt; x*x &lt;= n) [0..],\ny &lt;- takeWhile (\\y -&gt; y*y &lt;= n - x*x) [0..]\n</code></pre>\n\n<p>Also, I would use expressions like <code>x*x</code> instead of <code>x^2</code>.</p>\n\n<p>Finally, why not compute the number of solutions with something like this:</p>\n\n<pre><code>sols a b c n =\n  length [ () | x &lt;- takeWhile (\\x -&gt; a*x*x &lt;= n) [0..]\n              , y &lt;- takeWhile (\\y -&gt; a*x*x+b*y*y &lt;= n) [0..]\n              , z &lt;- takeWhile (\\z -&gt; a*x*x+b*y*y+c*z*z &lt;= n) [0..]\n         ]\n</code></pre>\n\n<p>This does not exactly compute the same answer that you want because it doesn't account for positive and negative solutions, but you could easily modify it to compute your answer. The idea is to use one list comprehension instead of iterating over various values of <code>n</code> and summing.</p>\n\n<p>Finally, I think using <code>floor</code> and <code>sqrt</code> to compute the integral square root is completely safe in this case. This code verifies that the integer square root by sing <code>sqrt</code> of (x*x) == x for all x &lt;= 3037000499:</p>\n\n<pre><code>testAll :: Int -&gt; IO ()\ntestAll n =\n  print $ head [ (x,a) | x &lt;- [n,n-1 .. 1], let a = floor $ sqrt (fromIntegral (x*x) :: Double), a /= x ]\n\nmain = testAll 3037000499\n</code></pre>\n\n<p>Note I am running this on a 64-bit GHC - otherwise just use <code>Int64</code> instead of <code>Int</code> since Doubles are 64-bit in either case. Takes only a minute or so to verify.</p>\n\n<p>This shows that taking the floor of sqrt y will never result in the wrong answer if y &lt;= 3037000499^2.</p>\n"}], "owner": {"reputation": 657, "user_id": 1440894, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5cd84e40bb321eb1d75a9b7aa94fec42?s=128&d=identicon&r=PG", "display_name": "MadMonty", "link": "https://stackoverflow.com/users/1440894/madmonty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 1, "accepted_answer_id": 32121537, "answer_count": 1, "score": 3, "last_activity_date": 1440086241, "creation_date": 1440081618, "question_id": 32121241, "link": "https://stackoverflow.com/questions/32121241/most-efficient-algorithm-to-find-integer-points-within-an-ellipse", "title": "Most efficient algorithm to find integer points within an ellipse", "body": "<p>I'm trying to find all the integer lattice points within various 3D ellipses.</p>\n\n<p>I would like my program to take an integer N, and count all the lattice points within the ellipses of the form ax^2  + by^2 + cz^2 = n, where a,b,c are fixed integers and n is between 1 and N. This program should then return N tuples of the form (n, numlatticePointsWithinEllipse n).</p>\n\n<p>I'm currently doing it by counting the points on the ellipses ax^2 + by^2 + cz^2 = m, for m between 0 and n inclusive, and then summing over m. I'm also only looking at x, y and z all positive initially, and then adding in the negatives by permuting their signs later. </p>\n\n<p>Ideally, I'd like to reach numbers of N = 1,000,000+ within the scale of hours </p>\n\n<p>Taking a specific example of x^2 + y^2 + 3z^2 = N, here's the Haskell code I'm currently using:</p>\n\n<pre><code>import System.Environment\n\nisqrt :: Int -&gt; Int\nisqrt 0 = 0\nisqrt 1 = 1\nisqrt n = head $ dropWhile (\\x -&gt; x*x &gt; n) $ iterate (\\x -&gt; (x + n `div` x) `div` 2) (n `div` 2)\n\nlatticePointsWithoutNegatives :: Int -&gt; [[Int]]\nlatticePointsWithoutNegatives 0 = [[0,0,0]]\nlatticePointsWithoutNegatives n = [[x,y,z] | x&lt;-[0.. isqrt n], y&lt;- [0.. isqrt (n - x^2)], z&lt;-[max 0 (isqrt ((n-x^2 -y^2) `div` 3))], x^2 +y^2 + z^2 ==n]\n\nlatticePoints :: Int -&gt; [[Int]]\nlatticePoints n = [ zipWith (*) [x1,x2,x3] y |  [x1,x2,x3] &lt;- (latticePointsWithoutNegatives n), y &lt;- [[a,b,c] | a &lt;- (if x1 == 0 then [0] else [-1,1]), b&lt;-(if x2 == 0 then [0] else [-1,1]), c&lt;-(if x3 == 0 then [0] else [-1,1])]]\n\nlatticePointsUpTo :: Int -&gt; Int\nlatticePointsUpTo n = sum [length (latticePoints x) | x&lt;-[0..n]]\n\nlistResults :: Int -&gt; [(Int, Int)]\nlistResults n = [(x, latticePointsUpTo x) | x&lt;- [1..n]]\n\nmain = do\n    args &lt;- getArgs\n    let cleanArgs = read (head args)\n    print (listResults cleanArgs)\n</code></pre>\n\n<p>I've compiled this with </p>\n\n<pre><code>ghc -O2 latticePointsTest\n</code></pre>\n\n<p>but using the PowerShell \"Measure-Command\" command, I get the following results:</p>\n\n<pre><code>Measure-Command{./latticePointsTest 10}\nTotalMilliseconds : 12.0901\n\nMeasure-Command{./latticePointsTest 100}\nTotalMilliseconds : 12.0901\n\n Measure-Command{./latticePointsTest 1000}\nTotalMilliseconds : 31120.4503\n</code></pre>\n\n<p>and going any more orders of magnitude up takes us onto the scale of days, rather than hours or minutes.</p>\n\n<p>Is there anything fundamentally wrong with the algorithm I'm using? Is there any core reason why my code isn't scaling well? Any guidance will be greatly appreciated. I may also want to process the data between \"latticePoints\" and \"latticePointsUpTo\", so I can't just rely entirely on clever number theoretic counting techniques - I need the underlying tuples preserved.</p>\n"}, {"tags": ["haskell", "ghci", "jupyter", "ihaskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1440072829, "post_id": 32117860, "comment_id": 52128324, "body": "I guess you get an answer here at some point - but in this case isn&#39;t this more like an <i>issue</i> you could bring up on <a href=\"https://github.com/gibiansky/IHaskell\" rel=\"nofollow noreferrer\">github.com/gibiansky/IHaskell</a> ?"}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1440074368, "post_id": 32117860, "comment_id": 52129339, "body": "@Carsten: I&#39;ll do that too. But I suspect it is due to something architectural that will reveal a bit about how IHaskell, IO, and GHC(i) are related."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1440083045, "post_id": 32117860, "comment_id": 52135924, "body": "Well, the relationship between IHaskell and GHC<b>i</b> is pretty simple: <b>absolutely none</b>. IHaskell uses the GHC <i>libraries</i> to <i>reimplement</i> the whole interactive interpreter. So you shouldn&#39;t associate GHCi behaviours/commands with IHaskell. AFAIK currently there is no way to display what you want, but I don&#39;t think it&#39;s due to any limitation of the system but simply because IHaskell doesn&#39;t implement all the directives that GHCi has."}], "answers": [{"tags": [], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "is_accepted": true, "score": 0, "last_activity_date": 1440341699, "last_edit_date": 1440341699, "creation_date": 1440331293, "answer_id": 32166430, "question_id": 32117860, "link": "https://stackoverflow.com/questions/32117860/how-do-i-show-bindings-in-in-an-ihaskell-notebook/32166430#32166430", "title": "How do I show bindings in in an IHaskell Notebook?", "body": "<p>This is <a href=\"https://github.com/gibiansky/IHaskell/issues/559\" rel=\"nofollow\">not supported</a> in IHaskell (0.6.5.0; yet) but may be in the future.</p>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 32166430, "answer_count": 1, "score": 2, "last_activity_date": 1440341699, "creation_date": 1440072436, "question_id": 32117860, "link": "https://stackoverflow.com/questions/32117860/how-do-i-show-bindings-in-in-an-ihaskell-notebook", "title": "How do I show bindings in in an IHaskell Notebook?", "body": "<p>In GHCi I can show current bindings by executing </p>\n\n<pre><code>:show bindings\n</code></pre>\n\n<p>but when I try this in an IHaskell Notebook I get</p>\n\n<blockquote>\n  <p>Parse error (line 1, column 1): Unknown directive: 'show'.</p>\n</blockquote>\n\n<p>Is there a way to get a list of (and perhaps even remove specific) bindings in an IHaskell Notebook? If not, why can I do this in GHCi but not in a Notebook (I suspect the answer reveals something generally important about the architecture of Haskell IO and how that's employed by IHaskell)?</p>\n"}, {"tags": ["haskell", "emacs", "io-monad"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 8, "creation_date": 1440069094, "post_id": 32115828, "comment_id": 52125837, "body": "Note: Your &quot;emacs&quot; question doesn&#39;t really fit the rest of the question. It should be a question on its own."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1440076472, "post_id": 32115828, "comment_id": 52130875, "body": "<code>IO</code> is not a taint. It&#39;s its own distinct type. Thinking of it as a taint will do you a lot of harm when you start seeing type signatures like <code>IO (IO (), IO ())</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440091455, "post_id": 32115828, "comment_id": 52140806, "body": "You need to set up Haskell mode for emacs!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4861515"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1440158223, "post_id": 32115828, "comment_id": 52169006, "body": "@Carl Already happened! I believe the formal term is type constructor (by that I mean &quot;IO&quot; has to have a type parameter after it, even if that is just the () type). I used the term &quot;taint&quot; for mild tongue-in-cheek humor and because doing an unsafePerformIO or whatever would have made it far easier to port the lisp code I was working with."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4861515"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440158388, "post_id": 32115828, "comment_id": 52169103, "body": "@dfeuer I did set up haskell-mode and tried out approximately a dozen indentation schemes I found in melpa and marmalade, none of which worked for simple things, like spreading a function&#39;s parameters across multiple lines. I thought I might try a few standalone apps (particularly Leksah) before posting a standalone question."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440163998, "post_id": 32115828, "comment_id": 52172630, "body": "@flagrant2, terminology varies. <code>IO</code> is indeed a type constructor, but it is also correct to call it a type (of kind <code>* -&gt; *</code>), and I wouldn&#39;t think it odd to hear it called a type function either."}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 4, "last_activity_date": 1440067244, "creation_date": 1440067244, "answer_id": 32116052, "question_id": 32115828, "link": "https://stackoverflow.com/questions/32115828/idiomatic-haskell-syntax-without-do-blocks-or-accumulating-parentheses/32116052#32116052", "title": "Idiomatic Haskell syntax without do-blocks or accumulating parentheses?", "body": "<p>You can use <code>liftA2</code> (or <code>liftM2</code> from <code>Control.Monad</code>):</p>\n\n<pre><code>import Control.Applicative (liftA2)\nliftA2 g getLine getLine &gt;&gt;= putStrLn\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4861515"}, "edited": false, "score": 0, "creation_date": 1440076418, "post_id": 32116393, "comment_id": 52130829, "body": "Thanks for the thorough answer. Apparently the adaptation of the notation you mentioned was part of the so-called &quot;functor-applicative-monad proposal&quot; discussed at <a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"nofollow noreferrer\">wiki.haskell.org/Functor-Applicative-Monad_Proposal</a> ."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1440077150, "post_id": 32116393, "comment_id": 52131421, "body": "Yup, this has been introduced in GHC 7.10. See also <a href=\"http://stackoverflow.com/questions/23727768/which-parts-of-real-world-haskell-are-now-obsolete-or-considered-bad-practice/23733494#23733494\">this answer</a> if you&#39;re working with RWH."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1440091658, "post_id": 32116393, "comment_id": 52140910, "body": "@flagrant2, aside from that page, it&#39;s called the <code>Applicative =&gt; Monad</code> Proposal and abbreviated AMP."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 14, "last_activity_date": 1440068991, "last_edit_date": 1440068991, "creation_date": 1440068199, "answer_id": 32116393, "question_id": 32115828, "link": "https://stackoverflow.com/questions/32115828/idiomatic-haskell-syntax-without-do-blocks-or-accumulating-parentheses/32116393#32116393", "title": "Idiomatic Haskell syntax without do-blocks or accumulating parentheses?", "body": "<p>Note: This post is written in literate Haskell. You can save it as Main.lhs and try it in your GHCi.</p>\n\n<hr>\n\n<p>A short remark first: you can get rid of the semicolons and the braces in <code>do</code>. Also, <code>putStrLn</code> has type <code>IO ()</code>, so you don't need <code>return ()</code>:</p>\n\n<pre><code>interactiveConcat1 = do \n  x &lt;- getLine\n  y &lt;- getLine\n  putStrLn $ g x y\n</code></pre>\n\n<p>We're going to work with <code>IO</code>, so importing <code>Control.Applicative</code> or <code>Control.Monad</code> will come in handy: </p>\n\n<pre><code>&gt; module Main where\n&gt; import Control.Applicative\n\n&gt; -- Repeat your definition for completeness\n&gt; g :: [a] -&gt; [a] -&gt; [a]\n&gt; g = (++)\n</code></pre>\n\n<p>You're looking for something like this:</p>\n\n<pre><code>&gt; interactiveConcat :: IO ()\n&gt; interactiveConcat = magic g getLine getLine &gt;&gt;= putStrLn\n</code></pre>\n\n<p>What type does <code>magic</code> need? It returns a <code>IO String</code>, takes a function that returns an <code>String</code> and takes usual <code>String</code>s, and takes two <code>IO String</code>s:</p>\n\n<pre><code>magic :: (String -&gt; String -&gt; String) -&gt; IO String -&gt; IO String -&gt; IO String\n</code></pre>\n\n<p>We can probably generalize this type to</p>\n\n<pre><code>&gt; magic :: (a -&gt; b -&gt; c) -&gt; IO a -&gt; IO b -&gt; IO c\n</code></pre>\n\n<p>A <a href=\"https://www.haskell.org/hoogle/?hoogle=%28a%20-%3E%20b%20-%3E%20c%29%20-%3E%20IO%20a%20-%3E%20IO%20b%20-%3E%20IO%20c\">quick hoogle search</a> reveals that there are already two functions with almost that type: <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Applicative.html#v:liftA2\"><code>liftA2</code></a> from <code>Control.Applicative</code> and <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#v:liftM2\"><code>liftM2</code></a> from <code>Control.Monad</code>. They're defined for every <code>Applicative</code> and \u2013 in case of <code>liftM2</code> \u2013 <code>Monad</code>.  Since <code>IO</code> is an instance of both, you can choose either one:</p>\n\n<pre><code>&gt; magic = liftA2\n</code></pre>\n\n<p>If you use GHC 7.10 or higher, you can also use <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> without import and write <code>interactiveConcat</code> as</p>\n\n<pre><code>interactiveConcat = g &lt;$&gt; getLine &lt;*&gt; getLine &gt;&gt;= putStrLn\n</code></pre>\n\n<p>For completeness, lets add a <code>main</code> so that we can easily check this functionality via <code>runhaskell Main.lhs</code>:</p>\n\n<pre><code>&gt; main :: IO ()\n&gt; main = interactiveConcat\n</code></pre>\n\n<p>A simple check shows that it works as intended:</p>\n\n<pre>$ echo \"Hello\\nWorld\" | runhaskell Main.lhs\nHelloWorld</pre>\n\n<h3>References</h3>\n\n<ul>\n<li><a href=\"https://wiki.haskell.org/Typeclassopedia#Applicative\"><code>Applicative</code></a> in the Typeclassopedia</li>\n<li>The section \"Some useful monadic functions\" of <a href=\"http://learnyouahaskell.com/for-a-few-monads-more\">LYAH's chapter \"For a Few Monads More\"</a>.</li>\n</ul>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4861515"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 1, "accepted_answer_id": 32116393, "answer_count": 2, "score": 7, "last_activity_date": 1440167511, "creation_date": 1440066665, "last_edit_date": 1440167511, "question_id": 32115828, "link": "https://stackoverflow.com/questions/32115828/idiomatic-haskell-syntax-without-do-blocks-or-accumulating-parentheses", "title": "Idiomatic Haskell syntax without do-blocks or accumulating parentheses?", "body": "<p>I'm fairly new to Haskell and have been trying to find a way to pass multiple IO-tainted values to a function to deal with a C library. Most people seem to use the &lt;- operator inside a do block, like this: </p>\n\n<pre><code>g x y = x ++ y\ninteractiveConcat1 = do {x &lt;- getLine;\n                         y &lt;- getLine;\n                         putStrLn (g x y);\n                         return ()}\n</code></pre>\n\n<p>This makes me feel like I'm doing C, except emacs can't auto-indent. I tried to write this in a more Lispy style:</p>\n\n<pre><code>interactiveConcat2 = getLine &gt;&gt;= (\\x -&gt;\n                     getLine &gt;&gt;= (\\y -&gt;\n                     putStrLn (g x y) &gt;&gt;\n                     return () ))\n</code></pre>\n\n<p>That looks like a mess, and has a string of closed parentheses you have to count at the end (except again, emacs can reliably assist with this task in Lisp, but not in Haskell). Yet another way is to say</p>\n\n<pre><code>import Control.Applicative\ninteractiveConcat3 = return g &lt;*&gt; getLine &lt;*&gt; getLine &gt;&gt;= putStrLn\n</code></pre>\n\n<p>which looks pretty neat but isn't part of the base language. </p>\n\n<p>Is there any less laborious notation for peeling values out of the IO taint boxes? Perhaps there is a cleaner way using a lift* or fmap? I hope it isn't too subjective to ask what is considered \"idiomatic\"?</p>\n\n<p>Also, any tips for making emacs cooperate better than (Haskell Ind) mode would be greatly appreciated. Thanks!</p>\n\n<p>John</p>\n\n<p>Edit: I stumbled across <a href=\"https://wiki.haskell.org/Do_notation_considered_harmful\" rel=\"nofollow\">https://wiki.haskell.org/Do_notation_considered_harmful</a> and realized that the nested parentheses in the lambda chain I wrote is not necessary. However it seems the community (and ghc implementors) have embraced the Applicative-inspired style using , &lt;*>, etc, which seems to make the code easier to read in spite of the headaches with figuring out operator precedence.</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1440077264, "post_id": 32113297, "comment_id": 52131501, "body": "Related: <a href=\"http://stackoverflow.com/q/29310140/414413\">stackoverflow.com/q/29310140/414413</a>"}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1440083180, "post_id": 32120439, "comment_id": 52136021, "body": "<code>returnDownstream</code> looks more like <code>signalExhausted</code> when it&#39;s written as <code>returnDownstream p = p &#47;&#47;&gt; respond . Right &gt;&gt;= forever . respond . Left</code>"}, {"owner": {"reputation": 275, "user_id": 83704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P7DJg.jpg?s=128&g=1", "display_name": "jsk", "link": "https://stackoverflow.com/users/83704/jsk"}, "edited": false, "score": 0, "creation_date": 1440389001, "post_id": 32120439, "comment_id": 52234724, "body": "Thanks for taking the time to write this detailed and informative response. Cheers!"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 4, "last_activity_date": 1440082827, "last_edit_date": 1495541679, "creation_date": 1440079496, "answer_id": 32120439, "question_id": 32113297, "link": "https://stackoverflow.com/questions/32113297/signalling-to-downstream-that-upstream-is-exhausted/32120439#32120439", "title": "Signalling to downstream that upstream is exhausted", "body": "<p>A pipe like <code>signalExhausted</code> can't be defined, but a function equivalent to <code>(&gt;-&gt; signalExhausted)</code> can.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/pipes/docs/Pipes.html#v:-62--45--62-\" rel=\"nofollow noreferrer\"><code>&gt;-&gt;</code></a> is a specialized version of the <a href=\"http://hackage.haskell.org/package/pipes-4.1.6/docs/Pipes-Core.html#g:6\" rel=\"nofollow noreferrer\"><code>pull</code> category</a>. Execution is driven by the downstream proxies pulling data from upstream proxies. The downstream proxy sends an empty request <code>()</code> upstream and blocks until a response holding a value comes back from the upstream proxy. When the upstream proxy is exhausted and doesn't have any more values to send back, it <code>return</code>s. You can see the <code>return</code> that matters for these examples in the definition of <a href=\"https://hackage.haskell.org/package/pipes/docs/Pipes.html#v:each\" rel=\"nofollow noreferrer\"><code>each</code></a>.</p>\n\n<pre><code>each = F.foldr (\\a p -&gt; yield a &gt;&gt; p) (return ())\n-- what to do when the data's exhausted ^                       \n</code></pre>\n\n<p>The downstream proxy needs a value to continue running, but there's no value the pipes library can possibly provide it, so the downstream proxy never runs again. Since it never runs again, there's no way it can modify or react to the data.</p>\n\n<p>There are two solutions to this problem. The simplest is to <a href=\"https://hackage.haskell.org/package/pipes/docs/Pipes-Prelude.html#v:map\" rel=\"nofollow noreferrer\"><code>map</code></a> <code>Value</code> over the upstream pipe and  add a <code>yield Exhausted</code> after it's done.</p>\n\n<pre><code>import Pipes\nimport qualified Pipes.Prelude as P\n\ndata Value a = Value a | Exhausted\n    deriving (Show)\n\nsignalExhausted p = p &gt;-&gt; P.map Value &gt;&gt; yield Exhausted\n</code></pre>\n\n<p>This does exactly what you're looking for except the function <code>signalExhausted</code> takes the place of <code>(&gt;-&gt; signalExhausted)</code>.</p>\n\n<pre><code>let xs = words \"hubble bubble toil and trouble\"\nprint . P.toList . signalExhausted $ each xs\n\n[Value \"hubble\",Value \"bubble\",Value \"toil\",Value \"and\",Value \"trouble\",Exhausted]\n</code></pre>\n\n<p>The more general solution to this problem is to stop the upstream proxy from returning and instead signal downstream when it is exhausted. I demonstrated how to do so in an <a href=\"https://stackoverflow.com/a/29310747/414413\">answer to a related question</a>.</p>\n\n<pre><code>import Control.Monad\nimport Pipes.Core\n\nreturnDownstream :: Monad m =&gt; Proxy a' a b' b m r -&gt; Proxy a' a b' (Either r b) m r'\nreturnDownstream = (forever . respond . Left =&lt;&lt;) . (respond . Right &lt;\\\\)\n</code></pre>\n\n<p>This replaces each <code>respond</code> with <code>respond . Right</code> and replaces <code>return</code> with <code>forever . respond . left</code>, sending returns downstream along with responses.</p>\n\n<p><code>returnDownstream</code> is more general than what you are looking for. We can demonstrate how to use it to recreate <code>signalExhausted</code>. <code>returnDownstream</code> transforms a pipe that returns into one that never returns, and instead forwards its return value downstream as the <code>Left</code> value of an <code>Either</code>.</p>\n\n<pre><code>signalExhausted p = returnDownstream p &gt;-&gt; respondLeftOnce\n</code></pre>\n\n<p><code>respondLeftOnce</code> is an example downstream proxy. The downstream proxy can discern between regular values held in <code>Right</code> and the return value held in <code>Left</code>.</p>\n\n<pre><code>respondLeftOnce :: Monad m =&gt; Pipe (Either e a) (Value a) m ()\nrespondLeftOnce = go\n    where\n        go = do\n            ea &lt;- await\n            case ea of\n                Right a -&gt; yield (Value a) &gt;&gt; go                    \n                Left  _ -&gt; yield Exhausted       -- The upstream proxy is exhausted; do something else  \n</code></pre>\n"}], "owner": {"reputation": 275, "user_id": 83704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P7DJg.jpg?s=128&g=1", "display_name": "jsk", "link": "https://stackoverflow.com/users/83704/jsk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 32120439, "answer_count": 1, "score": 6, "last_activity_date": 1440082827, "creation_date": 1440059462, "last_edit_date": 1440068277, "question_id": 32113297, "link": "https://stackoverflow.com/questions/32113297/signalling-to-downstream-that-upstream-is-exhausted", "title": "Signalling to downstream that upstream is exhausted", "body": "<h1>Question</h1>\n\n<p>Using the Haskell <a href=\"https://hackage.haskell.org/package/pipes\" rel=\"nofollow\">pipes</a> library, I'm trying to define a <a href=\"https://hackage.haskell.org/package/pipes/docs/Pipes-Core.html#t:Pipe\" rel=\"nofollow\"><code>Pipe</code></a> with the following type:</p>\n\n<pre><code>signalExhausted :: Monad m =&gt; Pipe a (Value a) m r \n</code></pre>\n\n<p>where the <code>Value</code> data type is defined by:</p>\n\n<pre><code>data Value a = Value a | Exhausted\n</code></pre>\n\n<p>The pipe should obey the following laws:</p>\n\n<pre><code>toList (each [] &gt;-&gt; signalExhausted) ==                 [Exhausted]\ntoList (each xs &gt;-&gt; signalExhausted) == map Value xs ++ [Exhausted]\n</code></pre>\n\n<p>In other words, the pipe should be equivalent to <code>Pipes.Prelude.map Value</code>, except that it should yield an additional <code>Exhausted</code> after all upstream values have been processed, giving downstream a chance to perform some final action.</p>\n\n<p>Can such a <code>Pipe</code> be defined?</p>\n\n<h2>Example</h2>\n\n<pre><code>&gt; let xs = words \"hubble bubble toil and trouble\"\n&gt; toList $ each xs &gt;-&gt; signalExhausted\n[Value \"hubble\", Value \"bubble\", Value \"toil\", Value \"and\", Value \"trouble\", Exhausted]\n</code></pre>\n\n<h2>Notes</h2>\n\n<p>I'm aware that the <a href=\"https://hackage.haskell.org/package/pipes-parse\" rel=\"nofollow\"><code>pipes-parse</code></a> library provides the functions <code>draw</code> and <code>parseForever</code>. These look useful, but I can't quite see how to combine them into a <code>Pipe</code> that matches the specification above.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1440058552, "post_id": 32111753, "comment_id": 52119017, "body": "I think this is much about personal choice. I tend to write <code>f $ g x</code>. But with more functions I also write <code>f . g . h $ x</code>, moving <code>$</code> to the right. I could use <code>f . g $ x</code> if  find <code>f . g</code> &quot;meaningful&quot;. I know I am not 100% consistent in my own style."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1440060583, "post_id": 32111753, "comment_id": 52120202, "body": "Definitely a stylistic choice. Pick one and apply it consistently."}, {"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "edited": false, "score": 4, "creation_date": 1440062672, "post_id": 32111753, "comment_id": 52121651, "body": "This is not a very suitable question for StackOverflow - all are equally &quot;Haskell-like&quot;. There is no correct answer."}], "answers": [{"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 10, "last_activity_date": 1440056313, "creation_date": 1440056313, "answer_id": 32112253, "question_id": 32111753, "link": "https://stackoverflow.com/questions/32111753/func2-func1-arg-func2-func1-arg-or-func2-func1-arg/32112253#32112253", "title": "&quot;func2 (func1 arg)&quot;, &quot;(func2 . func1) arg&quot; or &quot;func2 $ func1 arg&quot;?", "body": "<pre><code>print randomNum\n</code></pre>\n\n<p>Since <code>print = putStrLn . show</code>, that's obvious. If you really want to use separate functions, compose then apply.</p>\n\n<pre><code>putStrLn . show $ randomNum\n</code></pre>\n"}], "owner": {"reputation": 1561, "user_id": 3235192, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/qgDTX.png?s=128&g=1", "display_name": "timakro", "link": "https://stackoverflow.com/users/3235192/timakro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 32112253, "answer_count": 1, "score": 2, "last_activity_date": 1440061618, "creation_date": 1440054755, "last_edit_date": 1440061618, "question_id": 32111753, "link": "https://stackoverflow.com/questions/32111753/func2-func1-arg-func2-func1-arg-or-func2-func1-arg", "title": "&quot;func2 (func1 arg)&quot;, &quot;(func2 . func1) arg&quot; or &quot;func2 $ func1 arg&quot;?", "body": "<p>I wonder which option would you choose?</p>\n\n<pre><code>putStrLn (show randomNum)\nputStrLn $ show randomNum\n(putStrLn . show) randomNum\n</code></pre>\n\n<p>All options are syntactically correct.</p>\n\n<ul>\n<li><p>The brackets ensure that <code>show</code> is executed first and <code>putStrLn</code> gets only one argument.</p></li>\n<li><p>The <code>$</code> operator takes the show function and the <code>randomNum</code> and executes <code>show</code> on <code>randomNum</code>, so <code>putStrLn</code> gets only one argument.</p></li>\n<li><p>The <code>.</code> operator takes the <code>putStrLn</code> function, the <code>show</code> function and the <code>randomNum</code> and executes first <code>show</code> on <code>randomNum</code> and then <code>putStrLn</code> on the result.</p></li>\n</ul>\n\n<p>But what would be more haskell-like or make more sense in this example?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1440045083, "post_id": 32109572, "comment_id": 52113091, "body": "Perhaps you can draw some inspiration from the <a href=\"http://hackage.haskell.org/package/units\" rel=\"nofollow noreferrer\">units</a> and <a href=\"http://hackage.haskell.org/package/dimensional\" rel=\"nofollow noreferrer\">dimensional</a> packages."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1440046082, "post_id": 32109572, "comment_id": 52113325, "body": "first: I know that this is probably not helping you - but if you are mainly interested in this stuff (and not Haskell) than maybe a look at F# is worth your time - it is a reasonable good FP language and is has <a href=\"http://fsharpforfunandprofit.com/posts/units-of-measure/\" rel=\"nofollow noreferrer\">units of measure</a> which is exactly what you are trying to do here"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1440092412, "post_id": 32109572, "comment_id": 52141314, "body": "Check out Adam Gundry&#39;s type checker plugin for this: <a href=\"https://hackage.haskell.org/package/uom-plugin\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/uom-plugin</a>"}, {"owner": {"reputation": 2288, "user_id": 515288, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9bb96df13b644d099178e0e2eb43f9b2?s=128&d=identicon&r=PG", "display_name": "GeneralBecos", "link": "https://stackoverflow.com/users/515288/generalbecos"}, "edited": false, "score": 0, "creation_date": 1440170640, "post_id": 32109572, "comment_id": 52177495, "body": "These are some excellent links. Thanks much!"}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 2, "last_activity_date": 1440048749, "creation_date": 1440048749, "answer_id": 32110229, "question_id": 32109572, "link": "https://stackoverflow.com/questions/32109572/handling-type-information-gracefully/32110229#32110229", "title": "Handling type information gracefully", "body": "<p>In your proposed <code>speed'</code>, indeed it is no clearer what units the result has. You can't just take in a <code>Distance a</code> and return an <code>a</code>, because then the unit information is gone. Instead you need something like </p>\n\n<pre><code>data DistanceUnit = Mile | Kilometer\ndata TimeUnit = Second | Hour\n\ndata Dist a = Dist a DistanceUnit\ndata Time a = Time a TimeUnit\n\nspeed'' :: Fractional a =&gt; Dist a -&gt; Time a -&gt; Dist (Time a)\nspeed'' (Dist d dUnit) (Time t tUnit) = Dist (Time (d / t) tUnit) dUnit\n\ninMiles :: Fractional a =&gt; Dist a -&gt; a\ninMiles (Dist d Mile) = d\ninMiles (Dist d Kilometer) = d / 1.6\n\ninHours :: Fractional a =&gt; Time a -&gt; a\n-- same pattern as above\n\ninMph :: Fractional a =&gt; Dist (Time a) -&gt; a\ninMph (Dist (Time s tUnit) dUnit) = inMiles (Dist s dUnit) / inHours (Time s tUnit)\n\nthrusterAmount :: Fractional a =&gt; Dist (Time a) -&gt; Int\nthrusterAmount dv = inMph dv / 2 -- rocket science goes here\n\ngoFaster :: Fractional a =&gt; Dist (Time a) -&gt; IO ()\ngoFaster dv = applyThrusters . thrusterAmount $ dv\n</code></pre>\n\n<p>This example I threw together is quite primitive and cobbled together, but I hope you can see the idea: keep the units around and write functions like <code>speed</code> in terms of generic \"distance expressed somehow, divided by time expressed somehow\". Then, when you really need to know a magnitude in order to do something external to the system, like fire the thrusters, you convert the dimensional quantity into a bare number, implicitly in whatever units are convenient for you. </p>\n\n<p>A more sophisticated units system than mine would have better ways to express compound units like m/s or m^2s, but at any rate each function has its dimensions (but not its units!) encoded into its type: <code>speed</code> takes a distance and a time, and returns a distance per time, <code>distanceTraveled</code> might take a starting speed, an acceleration, and a time; and return a distance. There's no chance to misinterpret any of these things except at the very boundaries to the system, where you can call <code>inMph dv</code> and then immediately treat it as if it were kph, but the proximity to the <code>inMph</code> call should make such errors pretty obvious.</p>\n"}], "owner": {"reputation": 2288, "user_id": 515288, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9bb96df13b644d099178e0e2eb43f9b2?s=128&d=identicon&r=PG", "display_name": "GeneralBecos", "link": "https://stackoverflow.com/users/515288/generalbecos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1440048749, "creation_date": 1440044848, "question_id": 32109572, "link": "https://stackoverflow.com/questions/32109572/handling-type-information-gracefully", "title": "Handling type information gracefully", "body": "<p>I've been impressed by haskell and its claims that it could avoid problems like the kind that crashed the mars orbiter (due to differences between conventions in two programs, miles vs kms: <a href=\"http://www.cnn.com/TECH/space/9909/30/mars.metric.02/\" rel=\"nofollow\">source</a>), by catching them at compile time.  Though I can't recollect where I read about this anymore.</p>\n\n<p>I assume the original program was of the form (in some other language):</p>\n\n<pre><code>speed :: Fractional a =&gt; a -&gt; a -&gt; a\nspeed distance time = distance * 1.0 / time\n</code></pre>\n\n<p>I tried writing a variant that would gracefully handle this bug in haskell (ignore division by zero for now):</p>\n\n<pre><code>data Dist a = KM a | Miles a deriving (Show)\n\nspeed' :: Fractional a =&gt; Dist a -&gt; a -&gt; a\nspeed' (KM dist) time = dist * 1.0 / time\nspeed' (Miles dist) time = dist * 1.6 / time\n</code></pre>\n\n<p>Now it still isn't obvious that the return type of speed' is KM/second</p>\n\n<p>Now I'm trying to answer the question; What would a nice haskell implementation that made the return type more obvious look like:</p>\n\n<p>So for I've attempted to write a few data types (and I've probably gone down the wrong path?).</p>\n\n<pre><code>data Distance a = Meter a | Inch a | Furlong a |  LightYear a | Fathom a deriving (Show)\n\ndata Time a = Second a | Hour a | Minute a | Year a deriving (Show)\n</code></pre>\n\n<p>[You can imagine many more values for Distance and Time ]</p>\n\n<p>For each of these data types we can implement the necessary conversions so you may perform operations on each of these types as follows:</p>\n\n<pre><code>instance Num a =&gt; Num (Time a) where\n  Second a + Second b = Second (a+b)\n  Minute a + Minute b = Minute (a+b)\n  Minute a + Second b = Second (a*60 + b)\n  Second a + Minute b = Second ( a + b*60)\n  Second a - Second b = Second (a-b)\n  Minute a - Minute b = Minute (a-b)\n  Minute a - Second b = Second (a*60 - b)\n  Second a - Minute b = Second ( a - b*60)\n  abs (Second a) = Second (abs a)\n  abs (Minute a) = Minute (abs a)\n  signum (Second a) = Second (signum a)\n  signum (Minute a) = Minute (signum a)\n  fromInteger a = Second (fromInteger a)\n-- I'm clearly not thinking along the right 'haskelly' lines for these :/\n-- These are to deal with concepts like acceleration distance/time squared\n--  Second a * Second b  = Second (Second (a*b)\n--  Second a * Minute b  = Second (Second (a*b*60))\n--  Minute a * Second b  = Second (Second (a*b*60))\n--  Minute a * Num b     = Minute (a*b)\n--  Second a * Num b     = Second (a*b)\n</code></pre>\n\n<p>[similarly for all conversions for Distance]</p>\n\n<p>At this point I'm lost on how I would implement speed in a reasonable manner using these new data types such that they may be operated upon [say for addition]. </p>\n"}, {"tags": ["haskell", "dictionary", "maybe"], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1440044098, "post_id": 32108989, "comment_id": 52112820, "body": "Eta expand once and you will see your map.  <code>var str m = M.lookup str m</code>. What <code>var str = M.lookup str</code> is defining is an equality between functions of one argument; similarly <code>var = M.lookup</code> is an equality between functions of two arguments.  These definitions are all just different ways of saying the same thing."}], "tags": [], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "is_accepted": false, "score": 1, "last_activity_date": 1440041027, "last_edit_date": 1440041027, "creation_date": 1440040620, "answer_id": 32108989, "question_id": 32108814, "link": "https://stackoverflow.com/questions/32108814/function-from-data-map-maybe-as-a-class-instance-confused-about-how-to-imple/32108989#32108989", "title": "Function from Data.Map -&gt; Maybe as a class instance. Confused about how to implement", "body": "<p>So, I've come up with something that at the very least compiles. I had unnecessarily caused myself some confusion when I was attempting to solve this by repeatedly using <code>Maybe</code> as a constructor, and staring blankly at the error message that it wasn't defined. <code>Just</code> is the constructor for <code>Maybe</code>, <code>Maybe</code> isn't a constructor; too many times...</p>\n\n<p>Secondly, I completely blanked by using <code>lookup ...</code> instead of <code>M.lookup ...</code>, leading to unexpected type results.</p>\n\n<p>Those stumblings aside, here's what I tried</p>\n\n<pre><code>instance HasVars (M.Map String Integer -&gt; Maybe Integer) where\n    var str = M.lookup str -- can be Eta-reduced\n</code></pre>\n\n<p>This compiles, but what doesn't make too much sense to me is that per the instance declaration, shouldn't I be providing a key-value <code>Map</code>? <code>M.lookup</code> will give back a <code>Maybe Integer</code>, but it just doesn't seem like I've given it enough to do that, because it needs a key <em>and</em> a <code>Map</code>, and I don't seem to have a <code>Map</code>. Perhaps my understanding of how class instances work is off.</p>\n"}, {"tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": true, "score": 4, "last_activity_date": 1440041158, "creation_date": 1440041158, "answer_id": 32109059, "question_id": 32108814, "link": "https://stackoverflow.com/questions/32108814/function-from-data-map-maybe-as-a-class-instance-confused-about-how-to-imple/32109059#32109059", "title": "Function from Data.Map -&gt; Maybe as a class instance. Confused about how to implement", "body": "<p>So when you have</p>\n\n<pre><code>class HasVars a where\n    var :: String -&gt; a\n</code></pre>\n\n<p>That means that, for any instance <code>a</code>, you have a function <code>var :: String -&gt; a</code>.</p>\n\n<p>So, if <code>Map String Integer -&gt; Maybe Integer</code> is an instance, then that means that you have to provide a function:</p>\n\n<pre><code>var :: String -&gt; (Map String Integer -&gt; Maybe Integer)\n</code></pre>\n\n<p>Remember that <code>(-&gt;)</code> associates from the right, so the parentheses here are optional --</p>\n\n<pre><code>var :: String -&gt; Map String Integer -&gt; Maybe Integer\n</code></pre>\n\n<p>So, <code>var</code> is a function that takes a <code>String</code> and a <code>Map</code> and returns a <code>Maybe Integer</code>.  Let's write it!</p>\n\n<pre><code>instance HasVars (Map String Integer -&gt; Maybe Integer) where\n    -- var :: String -&gt; Map String Integer -&gt; Maybe Integer\n    var str mp = M.lookup str mp\n</code></pre>\n\n<p>And this works!</p>\n\n<hr>\n\n<p><strong>edit</strong>: Question in answer</p>\n\n<p>I see that you're wondering why</p>\n\n<pre><code>var str = M.lookup str\n</code></pre>\n\n<p>works.  Remember that <code>M.lookup str</code> doesn't return a <code>Maybe Integer</code>.  It returns a <code>Map String Integer -&gt; Maybe Integer</code>.  Which is exactly what <code>a</code> should be...exactly what you want.  <code>var str</code> is now a function that takes a map and returns a <code>Maybe Integer</code>.</p>\n\n<p><code>M.lookup str</code> doesn't have a map, yes, so it can't return a <code>Maybe Integer</code>.  But it's a <code>Map String Integer -&gt; Maybe Integer</code>.  So <code>var \"hello\"</code> is now a <code>Map String Integer -&gt; Maybe Integer</code>.  <code>var \"hello\"</code> gives you a function that takes a map and returns a <code>Maybe Integer</code>.  So if you give <code>var \"hello\"</code> a map, like <code>var \"hello\" mp</code>, then you get a <code>Maybe Integer</code> :D</p>\n"}], "owner": {"reputation": 915, "user_id": 4883095, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/186dca84cf6c850ddeedf8318061e58d?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Monta&#241;o", "link": "https://stackoverflow.com/users/4883095/nicholas-monta%c3%b1o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 32109059, "answer_count": 2, "score": 2, "last_activity_date": 1440045283, "creation_date": 1440039262, "last_edit_date": 1440045283, "question_id": 32108814, "link": "https://stackoverflow.com/questions/32108814/function-from-data-map-maybe-as-a-class-instance-confused-about-how-to-imple", "title": "Function from Data.Map -&gt; Maybe as a class instance. Confused about how to implement", "body": "<p>As I was working through <a href=\"http://www.seas.upenn.edu/~cis194/spring13/lectures.html\" rel=\"nofollow\">cis 194 (week 5)</a> I came across a problem that introduced two new concepts to me at once, and I'm having difficulty making it, at the very least, output the correct type.</p>\n\n<p>My goal is to implement <code>var</code> in the instance declared at the bottom, however, I have never used an instance that was a function before, and nor have I used <code>Data.Map</code>, so I'm not very clear on what my solution syntax should even look like.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nimport qualified Data.Map as M\n\nclass HasVars a where\n    var :: String -&gt; a\n\n-- | This instance allows variables to be interpreted as functions from a\n--   mapping of variables to Integer values to (possibly) Integer values\ninstance HasVars (M.Map String Integer -&gt; Maybe Integer) where\n    -- not sure how to implement var here\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1440037091, "post_id": 32108353, "comment_id": 52111174, "body": "Are you sure about having an arbitrary <code>Num</code>?  What if I did <code>Seconds (1 :+ 2)</code> after <code>import Data.Complex</code>?  Would it make sense to allow complex time?  Would it instead be better to have multiple constructors, so <code>data Time = Seconds Int | Milliseconds Int | Microseconds Int | Minute Int | Hour Int</code>?"}, {"owner": {"reputation": 2288, "user_id": 515288, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9bb96df13b644d099178e0e2eb43f9b2?s=128&d=identicon&r=PG", "display_name": "GeneralBecos", "link": "https://stackoverflow.com/users/515288/generalbecos"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1440038205, "post_id": 32108353, "comment_id": 52111433, "body": "Based on Mr F and Ben it seems the standard isn&#39;t to have any constraint (let alone Num)."}], "answers": [{"comments": [{"owner": {"reputation": 2288, "user_id": 515288, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9bb96df13b644d099178e0e2eb43f9b2?s=128&d=identicon&r=PG", "display_name": "GeneralBecos", "link": "https://stackoverflow.com/users/515288/generalbecos"}, "edited": false, "score": 0, "creation_date": 1440037103, "post_id": 32108535, "comment_id": 52111175, "body": "Thank you! :-)... now to understand GADTs ;-)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2288, "user_id": 515288, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9bb96df13b644d099178e0e2eb43f9b2?s=128&d=identicon&r=PG", "display_name": "GeneralBecos", "link": "https://stackoverflow.com/users/515288/generalbecos"}, "edited": false, "score": 0, "creation_date": 1440038978, "post_id": 32108535, "comment_id": 52111620, "body": "@GeneralBecos, GADTs are great, but I don&#39;t think this is such a great application of them."}, {"owner": {"reputation": 2288, "user_id": 515288, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9bb96df13b644d099178e0e2eb43f9b2?s=128&d=identicon&r=PG", "display_name": "GeneralBecos", "link": "https://stackoverflow.com/users/515288/generalbecos"}, "edited": false, "score": 0, "creation_date": 1440039084, "post_id": 32108535, "comment_id": 52111649, "body": "Agreed. Mr F has given a good reason below on the why. Cheers!"}], "tags": [], "owner": {"reputation": 8858, "user_id": 186026, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/q1xfe.png?s=128&g=1", "display_name": "fjarri", "link": "https://stackoverflow.com/users/186026/fjarri"}, "is_accepted": true, "score": 2, "last_activity_date": 1440036957, "creation_date": 1440036957, "answer_id": 32108535, "question_id": 32108353, "link": "https://stackoverflow.com/questions/32108353/creating-custom-data-types-with-constraints/32108535#32108535", "title": "Creating custom data types with constraints", "body": "<p>There is a deprecated feature called Datatype Contexts that allows you to do that:</p>\n\n<pre><code>{-# LANGUAGE DatatypeContexts #-}\ndata Num a =&gt; Time a = Second a deriving (Show)\nt = Second (5 :: Int)\nmain = print t\n</code></pre>\n\n<p>This executes on GHC 7.8.3 (sorry, don't have 7.10 to check), but warns you about the deprecation:</p>\n\n<pre><code>t.hs:1:14: Warning:\n    -XDatatypeContexts is deprecated: It was widely considered a\nmisfeature, and has been removed from the Haskell language.\nSecond 5\n</code></pre>\n\n<p>A non-deprecated way to do it is to use <a href=\"https://wiki.haskell.org/Generalised_algebraic_datatype\" rel=\"nofollow\">Generalized Algebraic Datatypes</a> (GADTs) (and you'll need standalone <code>deriving</code> as well):</p>\n\n<pre><code>{-# LANGUAGE GADTs, StandaloneDeriving #-}\ndata Time a where\n    Second :: Num a =&gt; a -&gt; Time a\nderiving instance Show a =&gt; Show (Time a)\nt = Second (5 :: Int)\nmain = print t\n</code></pre>\n\n<p>If you try to create a variable with something non-<code>Num</code>, you'll get a compilation error:</p>\n\n<pre><code>t = Second \"a\"\n\nt.hs:12:5:\n    No instance for (Num [Char]) arising from a use of \u2018Second\u2019\n    In the expression: Second \"a\"\n    In an equation for \u2018t\u2019: t = Second \"a\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1440037821, "post_id": 32108566, "comment_id": 52111365, "body": "Your suggestion of leaving the data type unconstrained is absolutely the standard way to do it. Someone might even have a use for a differently constrained version of the data type some day (e.g. it might make sense to work with times that are merely addable, or something). If you <i>do</i> need to constrain the data structure itself, then GADTs are the correct way to do it, but be aware that then every single <code>Time</code> value contains a <code>Num</code> instance so functions know which implementation of the <code>Num</code> functions to call."}, {"owner": {"reputation": 2288, "user_id": 515288, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9bb96df13b644d099178e0e2eb43f9b2?s=128&d=identicon&r=PG", "display_name": "GeneralBecos", "link": "https://stackoverflow.com/users/515288/generalbecos"}, "edited": false, "score": 0, "creation_date": 1440038063, "post_id": 32108566, "comment_id": 52111408, "body": "Thanks, I&#39;m going to leave the type unconstrained."}], "tags": [], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "is_accepted": false, "score": 3, "last_activity_date": 1440037234, "creation_date": 1440037234, "answer_id": 32108566, "question_id": 32108353, "link": "https://stackoverflow.com/questions/32108353/creating-custom-data-types-with-constraints/32108566#32108566", "title": "Creating custom data types with constraints", "body": "<p>One of the best examples of why this might not be so desirable is <a href=\"https://en.wikibooks.org/wiki/Haskell/Classes_and_types#Other_uses\" rel=\"nofollow\">found here</a> at the Wikibooks section on Classes and Types. They say:</p>\n\n<blockquote>\n  <p>Type constraints in data declarations are less useful than it might seem at first. Consider:</p>\n\n<pre><code>data (Num a) =&gt; Foo a = F1 a | F2 a String\n</code></pre>\n  \n  <p>Here, Foo is a type with two constructors, both taking an argument of a type a which must be in Num. However, the (Num a) => constraint is only effective for the F1 and F2 constructors, and not for other functions involving Foo. Therefore, in the following example...</p>\n\n<pre><code>fooSquared :: (Num a) =&gt; Foo a -&gt; Foo a\nfooSquared (F1 x)   = F1 (x * x)\nfooSquared (F2 x s) = F2 (x * x) s\n</code></pre>\n  \n  <p>... even though the constructors ensure a will be some type in Num we can't avoid duplicating the constraint in the signature of fooSquared</p>\n</blockquote>\n\n<p>This suggests that a reasonable option for you is to just create <code>Time</code> with a generic parameter, and then later ensure that the module functions that operate on <code>Time</code> data always have the necessary constraint for <code>Num</code>. </p>\n\n<p>It won't be so much of a worry that someone goes off and foolishly makes <code>Time String</code> or something -- if they do, then none of the provided module functions are going to be helpful for them, so it doesn't matter so much.</p>\n\n<p>There are also options to look up with GADTs, the <code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}</code> pragma, and the <code>{-# LANGUAGE DatatypeContexts #-}</code> pragma. But usually these start to rope in unnecessary degrees of extra complexity, especially if you're a Haskell novice like me.</p>\n"}], "owner": {"reputation": 2288, "user_id": 515288, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9bb96df13b644d099178e0e2eb43f9b2?s=128&d=identicon&r=PG", "display_name": "GeneralBecos", "link": "https://stackoverflow.com/users/515288/generalbecos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 511, "favorite_count": 0, "accepted_answer_id": 32108535, "answer_count": 2, "score": 1, "last_activity_date": 1440061877, "creation_date": 1440035652, "last_edit_date": 1440061877, "question_id": 32108353, "link": "https://stackoverflow.com/questions/32108353/creating-custom-data-types-with-constraints", "title": "Creating custom data types with constraints", "body": "<p>I'm trying to create a custom data type. As an example</p>\n\n<pre><code>data Time  = Second Int deriving (Show)\n</code></pre>\n\n<p>However, this is too limiting (we could say later need milliseconds). I would like to instead define something like this:</p>\n\n<pre><code>data Time  = Second Num deriving (Show)\n</code></pre>\n\n<p>This doesn't compile because <code>Num</code> has kind <code>* -&gt; ghc-prim-0.4.0.0:GHC.Prim.Constraint</code></p>\n\n<p>How do I setup <code>Time</code> such that <code>Second</code> may contain any <code>Num</code>?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1440041612, "post_id": 32107706, "comment_id": 52112222, "body": "In what way is it wrong, and what is the definition of <code>GMySerialize</code>?"}, {"owner": {"reputation": 3832, "user_id": 2553416, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/3cb1756924bd03cc01d107852dd81acf?s=128&d=identicon&r=PG", "display_name": "LogicChains", "link": "https://stackoverflow.com/users/2553416/logicchains"}, "reply_to_user": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1440044212, "post_id": 32107706, "comment_id": 52112852, "body": "@JustinL. I edited it to explain why it&#39;s wrong and added the definition."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1440044688, "post_id": 32107706, "comment_id": 52112983, "body": "Yeah, you need to make sure that you can tell, when you deserialize, whether you added 0 or 1 -- i.e. which case you took.  One way to do that is to make sure that <code>rest</code> is always even, so if the number is odd you know you added 1.  Just a little math..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1440047405, "post_id": 32107706, "comment_id": 52113681, "body": "Alternately, instead of adding <code>1</code>, add the size of the type on the left."}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1440053221, "last_edit_date": 1440053221, "creation_date": 1440052116, "answer_id": 32110987, "question_id": 32107706, "link": "https://stackoverflow.com/questions/32107706/ghc-generics-how-to-write-an-implementation-of-that-converts-sum-types-fr/32110987#32110987", "title": "GHC Generics: How to write an implementation of (:+:) that converts sum types from/to integers?", "body": "<p>The trick is to make another class that counts the number of constructors</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE DefaultSignatures #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nimport Data.Functor ((&lt;$&gt;))\nimport Data.Tagged\n\nimport GHC.Generics\n\nclass GNumConstructors (f :: * -&gt; *) where\n    -- Is this close enough to CAF to get memoed in the dictionary?\n    gnumConstructors :: Tagged f Int\n\ninstance GNumConstructors (M1 C c f) where\n    gnumConstructors = Tagged 1\n\ninstance (GNumConstructors a, GNumConstructors b) =&gt; GNumConstructors (a :+: b) where\n    gnumConstructors = Tagged $ unTagged (gnumConstructors :: Tagged a Int) +  unTagged (gnumConstructors :: Tagged b Int)  \n</code></pre>\n\n<p>Then you can easily divide up the integers between those on the left side (less than the number of possibilities on the left) and those on the right side (any larger numbers).</p>\n\n<pre><code>type MyS = Int\n\nclass GMySerialize f where\n    gtoMyS :: f a -&gt; MyS\n    gfromMyS :: MyS -&gt; Maybe (f a)\n\ninstance (GNumConstructors a, GMySerialize a, GMySerialize b) =&gt; GMySerialize (a :+: b) where\n    gtoMyS (L1 l) = gtoMyS l\n    gtoMyS (R1 r) = unTagged (gnumConstructors :: Tagged a Int) + gtoMyS r\n\n    gfromMyS x = if x &lt; unTagged (gnumConstructors :: Tagged a Int)\n                 then L1 &lt;$&gt; gfromMyS x\n                 else R1 &lt;$&gt; gfromMyS (x - unTagged (gnumConstructors :: Tagged a Int))\n</code></pre>\n\n<p>Any individual constructor is represented by 0 and we peek straight through metadata.</p>\n\n<pre><code>instance GMySerialize U1 where\n    gtoMyS U1 = 0\n    gfromMyS 0 = Just U1\n    gfromMyS _ = Nothing\n\ninstance GMySerialize f =&gt; GMySerialize (M1 i c f) where\n    gtoMyS (M1 a) = gtoMyS a\n    gfromMyS ms = M1 &lt;$&gt; gfromMyS ms\n</code></pre>\n\n<p>Combined with a <code>MySerialize</code> class we can flesh out a complete example for <code>MyType</code> and test it</p>\n\n<pre><code>class MySerialize a where\n    toMyS :: a -&gt; MyS\n    fromMyS :: MyS -&gt; Maybe a\n\n    default toMyS :: (Generic a, GMySerialize (Rep a)) =&gt; a -&gt; MyS\n    toMyS a = gtoMyS $ from a\n\n    default fromMyS :: (Generic a, GMySerialize (Rep a)) =&gt; MyS -&gt; Maybe a\n    fromMyS a = to &lt;$&gt; gfromMyS a\n\ndata MyType = A | B | C | D | E | F\n    deriving (Generic, Show)\n\ninstance MySerialize MyType\n\nmain = do\n    print . map toMyS $ [A, B, C, D, E, F]\n    print . map (fromMyS :: MyS -&gt; Maybe MyType) $ [-1, 0, 1, 2, 3, 4, 5, 6]\n</code></pre>\n\n<p><code>A</code> through <code>F</code> are mapped to the numbers <code>0</code> through <code>5</code>. Reading in those numbers reproduces <code>A</code> through <code>F</code>. Trying to read in a number outside that range produces <code>Nothing</code>.</p>\n\n<pre><code>[0,1,2,3,4,5]\n[Nothing,Just A,Just B,Just C,Just D,Just E,Just F,Nothing]\n</code></pre>\n"}], "owner": {"reputation": 3832, "user_id": 2553416, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/3cb1756924bd03cc01d107852dd81acf?s=128&d=identicon&r=PG", "display_name": "LogicChains", "link": "https://stackoverflow.com/users/2553416/logicchains"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 32110987, "answer_count": 1, "score": 2, "last_activity_date": 1440053221, "creation_date": 1440030233, "last_edit_date": 1440044177, "question_id": 32107706, "link": "https://stackoverflow.com/questions/32107706/ghc-generics-how-to-write-an-implementation-of-that-converts-sum-types-fr", "title": "GHC Generics: How to write an implementation of (:+:) that converts sum types from/to integers?", "body": "<p>I would like to write an implementation of </p>\n\n<p><code>instance (GMySerialize a, GMySerialize b) =&gt; GMySerialize (a :+: b)</code></p>\n\n<p>Where GMySerialize is defined as:</p>\n\n<pre><code>class GMySerialize f where\n    gtoMyS :: f a -&gt; MySerialize\n    gfromMyS :: MySerialize -&gt; Maybe (f a)\n</code></pre>\n\n<p>That will, for any sum type consisting solely of nullary data constructors (such as <code>data MyType = A | B | C | D | E | f</code>), convert it to and from <code>MySerializeInt</code>, where <code>MySerializeInt</code> is a constructor for <code>MySerialize</code> that takes one int parameter.</p>\n\n<p>I started out with </p>\n\n<pre><code>instance (GMySerialize a, GMySerialize b) =&gt; GMySerialize (a :+: b) where\n   gtoMyS (L1 x) = MySerializeInt (0 + rest)\n     where rest = case gtoMyS x of\n             MySerializeInt n -&gt; n\n             MySerializeNil -&gt; 0\n             err -&gt; error $ show err\n   gtoMyS (R1 x) = MySerializeInt (1 + rest)\n     where rest = case gtoMyS x of\n             MySerializeInt n -&gt; n\n             MySerializeNil -&gt; 0\n             err -&gt; error $ show err\n</code></pre>\n\n<p>But realised that's horribly wrong, and am not sure how to fix it. How is it wrong? As an example, the following produce the same integer, but they should not as they represent different constructors:</p>\n\n<pre><code>M1 {unM1 = L1 (R1 (M1 {unM1 = U1}))}\nM1 {unM1 = R1 (L1 (M1 {unM1 = U1}))}\n</code></pre>\n\n<p>I'm also unsure how I'd go about writing the <code>gfromMyS</code> instances even if I got <code>gtoMyS</code> working.</p>\n\n<p>To phrase it another way, what I'm looking to do has an equivalent effect to writing a Template Haskell function that generates:</p>\n\n<pre><code>instance MySerialize t where\n  toMyS x = MySerializeInt (toEnum x)\n  fromMyS (MySerializeInt n) -&gt; Just (fromEnum n)\n  fromMyS _ -&gt; Nothing\n</code></pre>\n\n<p>For every single <code>t</code> where <code>t</code> is sum types with only nullary constructors that implement <code>Enum</code>. </p>\n"}]