[{"tags": ["performance", "haskell", "pattern-matching", "fold"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 6, "creation_date": 1529535673, "post_id": 50958138, "comment_id": 88913681, "body": "How are you running these? Compiler otimizations will make a big difference. Results from ghci would not be accurate."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1529537868, "post_id": 50958138, "comment_id": 88914162, "body": "<a href=\"https://stackoverflow.com/tags/haskell/info\">stackoverflow.com/tags/haskell/info</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1529594744, "post_id": 50958138, "comment_id": 88940830, "body": "I can&#39;t reproduce. I get an average of 87ms vs 82ms with Criterion and compiling with -O2. The difference is very small."}, {"owner": {"reputation": 31, "user_id": 8015160, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SLNwd_o10d8/AAAAAAAAAAI/AAAAAAAAA9g/GlIqU9Ky_gM/photo.jpg?sz=128", "display_name": "Ketan Kanishka", "link": "https://stackoverflow.com/users/8015160/ketan-kanishka"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1529642178, "post_id": 50958138, "comment_id": 88956945, "body": "@Rein Heinrichs Ah okay. This was timed with ghci."}, {"owner": {"reputation": 336, "user_id": 7236501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f52887fba37383964c102def911c9bc?s=128&d=identicon&r=PG&f=1", "display_name": "shinobi", "link": "https://stackoverflow.com/users/7236501/shinobi"}, "edited": false, "score": 1, "creation_date": 1530051399, "post_id": 50958138, "comment_id": 89095220, "body": "I reproduce the difference with compiled code (-O2) with GHC 7.10.3: ~130ms for <code>findKeyPatMatch</code> vs ~230ms for <code>findKeyFold</code>.  The numbers are pretty consistent across runs, varying only in the 3-rd digit."}, {"owner": {"reputation": 336, "user_id": 7236501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f52887fba37383964c102def911c9bc?s=128&d=identicon&r=PG&f=1", "display_name": "shinobi", "link": "https://stackoverflow.com/users/7236501/shinobi"}, "edited": false, "score": 0, "creation_date": 1530089516, "post_id": 50958138, "comment_id": 89107051, "body": "After some tinkering with the test bed, the difference is lost, somehow (could have been a mistake in my initial setup, though I&#39;m not sure how exactly copy &amp; paste could have gone wrong.)  Now I&#39;m getting ~90ms for both cases."}], "owner": {"reputation": 31, "user_id": 8015160, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SLNwd_o10d8/AAAAAAAAAAI/AAAAAAAAA9g/GlIqU9Ky_gM/photo.jpg?sz=128", "display_name": "Ketan Kanishka", "link": "https://stackoverflow.com/users/8015160/ketan-kanishka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1529543201, "creation_date": 1529535198, "last_edit_date": 1529543201, "question_id": 50958138, "link": "https://stackoverflow.com/questions/50958138/better-performance-of-pattern-matching-over-foldr", "title": "Better performance of pattern matching over foldr", "body": "<p>Both of these functions are implementations of a dictionary lookup picked out from <a href=\"http://learnyouahaskell.com/modules\" rel=\"nofollow noreferrer\">learnyouahaskell</a></p>\n\n<pre><code>findKeyPatMatch :: (Eq k) =&gt; k -&gt; [(k,v)] -&gt; Maybe v\nfindKeyPatMatch key [] = Nothing\nfindKeyPatMatch key ((k,v):xs)\n    | key == k      = Just v\n    | otherwise     = findKeyPatMatch key xs\n\nfindKeyFold :: (Eq k) =&gt; k -&gt; [(k,v)] -&gt; Maybe v\nfindKeyFold key = foldr (\\(k,v) acc -&gt; if k == key then Just v else acc) Nothing\n</code></pre>\n\n<p>Since the pattern in the first function is the exact idiom foldr is made for, I expected both of these functions to have the same performance. However, the pattern matching implementation is significantly faster.\n<code>foldr</code> short-circuits, so I can't think of any particular reason for this, except for <i>maybe</i> a function call overhead, at a stretch.</p>\n\n<pre><code>testKey = 10^7\ntestDict = [(i,i) | i &lt;- [1..]]\n\nfindKeyPatMatch testKey testDict    -- takes ~3.40 s\nfindKeyFold testKey testDict        -- takes ~4.10 s\n</code></pre>\n\n<p>So my question is - what's the reason for the performance difference, and is there any way to optimize the foldr expression.</p>\n"}, {"tags": ["javascript", "multithreading", "haskell", "asynchronous", "concurrency"], "comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1529539369, "post_id": 50958042, "comment_id": 88914511, "body": "&quot;The important point is: this is not CPS -- loadProfile() and loadImage() are not CPS functions.&quot; I&#39;m not sure what you mean. <code>loadAvatarImage</code> <i>is</i> CPS in your example. Sure, <code>loadProfile</code> and <code>loadImage</code> are not concurrent or CPS. But <code>fork</code> is both concurrent and CPS. And because <code>fork</code> provides its asynchronicity through CPS, <code>loadAvatarImage</code> also must. If <code>loadAvatarImage</code> was not CPS here, it would not be asynchronous."}, {"owner": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1529540720, "post_id": 50958042, "comment_id": 88914794, "body": "Great catch, @DarthFennec! I never thought <code>fork()</code> is CPS, and <code>loadAvatarImage()</code> is CPS actually. Interesting. Let me edit the question a little so that you can write your answer formally. Thank you for helping me understand it a little more!"}], "answers": [{"comments": [{"owner": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "edited": false, "score": 1, "creation_date": 1529680605, "post_id": 50978332, "comment_id": 88976632, "body": "It is very useful to have the scheduler example. This explains how non-blocking is achieved on one CPU core in the cooperative style. CPS helps to achieve it."}], "tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": true, "score": 4, "last_activity_date": 1529620651, "last_edit_date": 1592644375, "creation_date": 1529620651, "answer_id": 50978332, "question_id": 50958042, "link": "https://stackoverflow.com/questions/50958042/continuation-passing-style-and-concurrency/50978332#50978332", "title": "Continuation-Passing Style And Concurrency", "body": "<h3>A Brief Overview of Javascript</h3>\n<p>Javascript's concurrency model is <em>non-parallel</em> and <em>cooperative</em>:</p>\n<ul>\n<li>Javascript is <em>non-parallel</em> because it runs in a single thread; it achieves concurrency by <em>interleaving</em> multiple execution threads, rather than by actually running them at the same time.</li>\n<li>Javascript is <em>cooperative</em> because the scheduler only switches to a different thread when the current thread <em>asks it to</em>. The alternative would be <em>preemptive</em> scheduling, where the scheduler decides to arbitrarily switch threads whenever it feels like it.</li>\n</ul>\n<p>By doing these two things, Javascript avoids many problems that other languages don't. Parallel code, and non-parallel preemptively-scheduled code, cannot make the basic assumption that variables will not suddenly change their values in the middle of execution, since another thread might be working on the same variable at the same time, or the scheduler might decide to interleave another thread absolutely anywhere. This leads to mutual exclusion problems and confusing race condition bugs. Javascript avoids all of this because in a cooperatively-scheduled system, the <em>programmer</em> decides where all the interleaves happen. The main drawback of this is if the programmer decides not to create interleaves for long periods of time, other threads never have a chance to run. In a browser, even actions like polling for user input and drawing updates to the page run in the same single-threaded environment as the Javascript, so a long-running Javascript thread will cause the entire page to become unresponsive.</p>\n<p>In the beginning, CPS was most often used in Javascript for the purpose of <em>event-driven UI programming</em>: if you wanted some code to run every time someone pressed a button, you would register your callback function to the button's <code>'click'</code> event; when the button was clicked, the callback would run. As it turns out, this same approach could be used for other purposes as well. Say you want to wait one minute and then do a thing. The naive approach would be to stall the Javascript thread for sixty seconds, which (as stated above) would cause the page to crash for that duration. However, if the timer was exposed as a UI event, the thread could be suspended by the scheduler instead, allowing other threads to run in the meantime. Then, the timer would cause the callback to execute, in the same way a button press would. The same approach can be used to request a resource from the server, or to wait for the page to load fully, or a number of other things. The idea is that, to keep Javascript as <em>responsive</em> as possible, any built-in function that might take a long time to complete should be part of the event system; in other words, it should use CPS to enable concurrency.</p>\n<p>Most languages that support cooperative scheduling (often in the form of <em>coroutines</em>) have special keywords and syntax that must be used to tell the language to interleave. For example, Python has the <code>yield</code> keyword, C# has <code>async</code> and <code>await</code>, etc. When Javascript was first designed, it had no such syntax. It did, however, have support for closures, which is a really easy way to allow CPS. I expect the intention behind this was to support the event-driven UI system, and that it was never intended to become a general-purpose concurrency model (especially once Node.js came along and removed the UI aspect entirely). I don't know for sure, though.</p>\n<h3>Why does CPS provide concurrency?</h3>\n<p>To be clear, continuation-passing style is a method that <em>can be used</em> to enable concurrency. Not all CPS code is concurrent. CPS isn't the only way to create concurrent code. CPS is useful for things other than enabling concurrency. Simply put, CPS does not necessarily imply concurrency, and vice versa.</p>\n<p>In order to interleave threads, execution must be interrupted in such a way that it can be resumed later. This means the <em>context</em> of the thread must be preserved, and later re-instated. This context isn't generally accessible from inside of a program. Because of this, the only way to support concurrency (short of the language having special syntax for it) is to write the code in such a way that the <em>thread context is encoded as a value</em>. This is what CPS does: the context to be resumed is encoded as a function that can be called. This function being called is equivalent to a thread being resumed. This can happen any time: after an image is loaded, after a timer triggers, after other threads have had a chance to run for a while, or even immediately. Since the context is all encoded into the continuation closure, it doesn't matter, as long as it runs eventually.</p>\n<p>To better understand this, we can write a simple scheduler:</p>\n<pre><code>var _threadqueue = []\n\nfunction fork(cb) {\n    _threadqueue.push(cb)\n}\n\nfunction run(t) {\n    _threadqueue.push(t)\n    while (_threadqueue.length &gt; 0) {\n        var next = _threadqueue.shift()\n        next()\n    }\n}\n</code></pre>\n<p>An example of this in use:</p>\n<pre><code>run(function() {\n    fork(function() {\n        console.print(&quot;thread 1, first line&quot;)\n        fork(function() {\n            console.print(&quot;thread 1, second line&quot;)\n        })\n    })\n    fork(function() {\n        console.print(&quot;thread 2, first line&quot;)\n        fork(function() {\n            console.print(&quot;thread 2, second line&quot;)\n        })\n    })\n})\n</code></pre>\n<p>This should print the following to the console:</p>\n<pre><code>thread 1, first line\nthread 2, first line\nthread 1, second line\nthread 2, second line\n</code></pre>\n<p>The results are interleaved. While not particularly useful on its own, this logic is more or less the foundation of something like Javascript's concurrency system.</p>\n<h3>Can we write asynchronous code without CPS?</h3>\n<p>Only if you have access to the context through some other means. As previously stated, many languages do this through special keywords or other syntax. Some languages have special builtins: Scheme has the <code>call/cc</code> builtin, which will wrap the current context into a callable function-like object, and pass that object to its argument. Operating systems get concurrency by literally copying around the thread's callstack (the callstack contains all of the needed context to resume the thread).</p>\n<p>If you mean in Javascript specifically, then I'm fairly certain it's impossible to reasonably write asynchronous code without CPS. Or it would be, but newer versions of Javascript also come with the <code>async</code> and <code>await</code> keywords, as well as a <code>yield</code> keyword, so using those is becoming an option.</p>\n<h3>Conclusion: Given a set of synchronous APIs, someone coding following CPS will not magically create asynchronous functions.</h3>\n<p>Correct. If an API is synchronous, CPS alone will not make that API asynchronous. It may introduce a level of concurrency (as in the example code earlier), but that concurrency can only exist within the thread. Asynchronous loading in Javascript works because the loading itself runs in parallel to the scheduler, so the only way to make a synchronous API asynchronous is to run it in a separate system thread (which can't be done in Javascript). But even if you did do that, it still wouldn't be asynchronous unless you also used CPS.</p>\n<p>CPS doesn't cause asynchronicity. However, asynchronicity <em>does</em> require CPS, or some alternative to CPS.</p>\n<h3>Conclusion: If the underlying asynchronous/concurrent APIs are provided in the CPS style, then one can only code in CPS style</h3>\n<p>Correct. If the API is <code>loadImage(url, callback)</code> and you run <code>return loadImage(profile.avatarUrl)</code>, it will return <code>null</code> immediately and it will not give you the image. Most likely it will throw an error because <code>callback</code> is <code>undefined</code>, since you didn't pass it. Essentially, if the API is CPS and you decide not to use CPS, you're not using the API correctly.</p>\n<p>In general though, it is accurate to say that if you write a function that calls a CPS function, your function also needs to be CPS. This is actually a good thing. Remember what I said about the basic assumption that variables will not suddenly change their values in the middle of execution? CPS solves this issue by making it very clear to the programmer where exactly the interleave boundaries are; or rather, where values might arbitrarily change. But if you could hide CPS function calls inside of non-CPS functions, you would no longer be able to tell. This is also the reason the newer Javascript <code>async</code> and <code>await</code> keywords work the way they do: any function that uses <code>await</code> must be marked as <code>async</code>, and any call to an <code>async</code> function must be prefixed with the <code>await</code> keyword (there's more to it than that, but I don't want to get into how promises work just now). Because of this, you can always tell where your interleave boundaries are, because there will always be <code>await</code> keywords there.</p>\n"}], "owner": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 924, "favorite_count": 2, "accepted_answer_id": 50978332, "answer_count": 1, "score": 3, "last_activity_date": 1529620651, "creation_date": 1529534486, "last_edit_date": 1529541912, "question_id": 50958042, "link": "https://stackoverflow.com/questions/50958042/continuation-passing-style-and-concurrency", "title": "Continuation-Passing Style And Concurrency", "body": "<p>I find lots of blogs mention concurrent/non-blocking/asynchronous programming as a benefit of Continuation-Passing Style (CPS). I cannot figure out why CPS provides concurrency, e.g., people mention Node.js is implemented using CPS though JavaScript is a synchronous language. Would someone comment on my thoughts?</p>\n\n<p>First, my naive understanding of CPS is that <em>wrapping all subsequent code at a point into a function and pass that function explicitly as a parameter</em>. Some blogs name the continuation function as <code>return()</code>, Gabriel Gonzalez calls it a <a href=\"http://www.haskellforall.com/2012/12/the-continuation-monad.html\" rel=\"nofollow noreferrer\">hole</a>, both of which are brilliant explanations.</p>\n\n<p>My confusion mostly comes from a popular blog article <a href=\"http://2ality.com/2012/06/continuation-passing-style.html\" rel=\"nofollow noreferrer\"><em>Asynchronous programming and continuation-passing style in JavaScript</em></a>. At the beginning of the article, Dr. Axel Rauschmayer gives two code snippets, a synchronous program and an asynchronous one in CPS (pasted here for easy reading).</p>\n\n<p>The synchronous code:</p>\n\n<pre><code>function loadAvatarImage(id) {\n    var profile = loadProfile(id);\n    return loadImage(profile.avatarUrl);\n}\n</code></pre>\n\n<p>The asynchronous code:</p>\n\n<pre><code>function loadAvatarImage(id, callback) {\n    loadProfile(id, function (profile) {\n        loadImage(profile.avatarUrl, callback);\n    });\n}\n</code></pre>\n\n<p>I don't get it why the CPS one is asynchronous. After I read another article <em><a href=\"http://matt.might.net/articles/by-example-continuation-passing-style/\" rel=\"nofollow noreferrer\">By example: Continuation-passing style in JavaScript</a></em>, I think maybe there is an assumption to the code: the function <code>loadProfile()</code> and <code>loadImage()</code> are asynchronous functions by themselves. Then it is not CPS that makes it asynchronous. In <a href=\"http://matt.might.net/articles/by-example-continuation-passing-style/\" rel=\"nofollow noreferrer\">the second article</a>, the author actually shows an implementation of <code>fetch()</code>, which is similar to <code>loadProfile()</code> in the blog earlier. The <code>fetch()</code> function makes an explicit assumption of the underlying concurrent execution model by calling <code>req.onreadystatechange</code>. This leads me to think maybe it is not CPS that provides concurrency.</p>\n\n<p>Assume the underlying functions are asynchronous, then I go into my second question: can we write asynchronous code without CPS? Think of the implementation of the function <code>loadProfile()</code>. If it is asynchronous not because of CPS, why can't we just take the same mechanism to implement <code>loadAvatarImage()</code> asynchronously? Assume <code>loadProfile()</code> uses <code>fork()</code> to create a new thread to send the request and wait for the response while the main thread is executing in a non-blocking manner, we can possibly do the same for <code>loadAvatarImage()</code>.</p>\n\n<pre><code>function loadAvatarImage(id, updateDOM) {\n    function act () {\n        var profile = loadProfile(id);\n        var img = loadImage(profile.avatarUrl);\n        updateDOM (img);\n    }\n    fork (act());\n}\n</code></pre>\n\n<p>I give it a callback function <code>updateDOM()</code>. Without <code>updateDOM()</code>, it is not fair to compare it with the CPS version -- the CPS version has extra information about what to do after the image is fetched, i.e., the <code>callback</code> function, but the original synchronous <code>loadAvatarImage()</code> does not.</p>\n\n<p>Interestingly, @DarthFennec pointed out my new <code>loadAvatarImage()</code> is actually CPS: <code>fork()</code> is CPS, <code>act()</code> is CPS (if we explicitly give it <code>updateDOM</code>), and <code>loadAvatarImage()</code> is CPS. The chain makes <code>loadAvatarImage()</code> asynchronous. <code>loadProfile()</code> and <code>loadImage()</code> do not need to be asynchronous or CPS.</p>\n\n<p>If the reasoning up to here is correct, can I get these two conclusions?</p>\n\n<ol>\n<li>Given a set of synchronous APIs, someone coding following CPS will not magically create asynchronous functions.</li>\n<li>If the underlying asynchronous/concurrent APIs are provided in the CPS style, like CPS versions of <code>loadProfile()</code>, <code>loadImage()</code>, <code>fetch()</code>, or <code>fork()</code>, then one can only code in CPS style to ensure the asynchronous APIs are used asynchronously, e.g., <code>return loadImage(profile.avatarUrl)</code> will nullify the concurrency of <code>loadImage()</code>.</li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1529531930, "post_id": 50957654, "comment_id": 88912663, "body": "Well that is not really depending on the type of the function itself, but on the <i>semantics</i> of the function."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529532022, "post_id": 50957654, "comment_id": 88912708, "body": "@WillemVanOnsem what do you mean by semantics of the function?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1529532095, "post_id": 50957654, "comment_id": 88912730, "body": "well the task the function is supposed to do. <code>Int -&gt; Int -&gt; [Int]</code> says what kind of input the function expects, and what the output type is. But there can be an infinite number of different functions with this type."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529532136, "post_id": 50957654, "comment_id": 88912752, "body": "For example the type could also mean that you have two integers, <code>n</code> and <code>x</code>, and that you construct a list of <code>x</code>&#39;s that has length <code>n</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529532271, "post_id": 50957654, "comment_id": 88912798, "body": "Would one way be defining new functions and then call them within a single function within InttoIntList?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529532348, "post_id": 50957654, "comment_id": 88912826, "body": "So I have hard time thinking in the abstract when it comes to things like these.  Could you give me an example of what you mean?"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "edited": false, "score": 0, "creation_date": 1529533063, "post_id": 50957758, "comment_id": 88913056, "body": "Thank you.  What exactly did you do with the otherwise.  What did you exactly do with m with the con :"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 1, "last_activity_date": 1529533190, "last_edit_date": 1529533190, "creation_date": 1529532547, "answer_id": 50957758, "question_id": 50957654, "link": "https://stackoverflow.com/questions/50957654/what-do-you-use-for-base-case-for-int-int-int-in-haskell/50957758#50957758", "title": "What do you use for base case for Int -&gt; Int -&gt; [Int] in haskell?", "body": "<p>A base case is not determined by the type of the function. Yes frequently the type can give a hint. For example for a list, a base case is typically the empty list <code>[]</code>, but <em>not per se</em>.</p>\n\n<p>Furthermore it is a common misconception that functions take two or more parameters. In Haskell, every function takes <em>exactly</em> one parameter. It is however possible that the output is a function that again takes a parameter (which is the case here).</p>\n\n<p>With thes two issues solved, the question arises what the <em>base case</em> for <code>InttoIntList</code> is. Well a base case is a case with no recursion involved. If I understand your function correctly, you want to generate a list of numbers that each time increment from the first <code>Int</code> to the second <code>Int</code>.</p>\n\n<p>So a base case could be the case where the first <code>Int</code> is greater than the second <code>Int</code>. In that case, we probably would want to return an empty list, so:</p>\n\n<pre><code>intToIntList m n | m &gt; n = []  -- base case\n</code></pre>\n\n<p>and then the recursive case is when <code>m &lt;= n</code>. In that case we typically would want to return a list that starts with <code>m</code> followed by the list that arises from <code>intToIntList (m+1) n</code>, so:</p>\n\n<pre><code>                 | otherwise = m : intToInt (m+1) n\n</code></pre>\n\n<p>Here <code>(:) :: a -&gt; [a] -&gt; [a]</code> is a list constructor. It creates a list with <code>m</code> the <em>head</em> (first element) and <code>intToInt (m+1) n</code> the <em>tail</em> (remaining elements).</p>\n\n<p>or putting it together:</p>\n\n<pre><code>intToIntList :: Int -&gt; Int -&gt; [Int]\nintToIntList m n | m &gt;= n = []\n                 | otherwise = m : intToIntList (m+1) n\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7650973"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 50957758, "answer_count": 1, "score": 1, "last_activity_date": 1529533190, "creation_date": 1529531870, "last_edit_date": 1529532049, "question_id": 50957654, "link": "https://stackoverflow.com/questions/50957654/what-do-you-use-for-base-case-for-int-int-int-in-haskell", "title": "What do you use for base case for Int -&gt; Int -&gt; [Int] in haskell?", "body": "<p>Say for example you have </p>\n\n<pre><code>InttoIntList x y\n</code></pre>\n\n<p>And its Type conversion was </p>\n\n<pre><code>Int -&gt; Int -&gt; [Int] \n</code></pre>\n\n<p>How would you establish a base case for two inputs to another list type like <code>[Int]</code></p>\n"}, {"tags": ["haskell", "ghc", "ghc-api"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1550223831, "creation_date": 1550223831, "answer_id": 54706516, "question_id": 50956899, "link": "https://stackoverflow.com/questions/50956899/using-ghc-api-to-compile-a-program-with-optimisation/54706516#54706516", "title": "Using GHC API to compile a program with optimisation", "body": "<p>You need to turn on the optimizations you want to run in the <code>DynFlags</code>.</p>\n\n<p>You can do that either by specifying an optimization level (0..2) and setting optimizations based on that (<a href=\"https://hackage.haskell.org/package/ghc-lib-0.20190204/docs/DynFlags.html#v:updOptLevel\" rel=\"nofollow noreferrer\"><code>updOptLevel</code></a>), or by turning on individual optimizations such as <a href=\"https://hackage.haskell.org/package/ghc-lib-0.20190204/docs/DynFlags.html#t:GeneralFlag\" rel=\"nofollow noreferrer\"><code>Opt_Specialise</code></a>:</p>\n\n<pre><code>main = runGhc (Just libdir) $ do\n    setTargets []\n    dflags &lt;- getSessionDynFlags\n    setSessionDynFlags $ updOptLevel 2 $ dflags{hscTarget = HscNothing}\n</code></pre>\n"}], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 2, "accepted_answer_id": 54706516, "answer_count": 1, "score": 7, "last_activity_date": 1550223831, "creation_date": 1529528161, "question_id": 50956899, "link": "https://stackoverflow.com/questions/50956899/using-ghc-api-to-compile-a-program-with-optimisation", "title": "Using GHC API to compile a program with optimisation", "body": "<p>I want to compile a Haskell module to GHC Core, with optimisations applied, and use the resulting core output. However, when I use <code>compileToCoreSimplified</code> it doesn't seem to run all the normal optimisations. Taking the program:</p>\n\n<pre><code>{-# OPTIONS_GHC -O2 #-}\nmodule LensOpt(pick) where\nimport Control.Lens\ndata Record = Record {_field :: String}\nfield = lens _field $ \\r x -&gt; r{_field=x}\npick = Record \"test\" ^. field\n</code></pre>\n\n<p>When run through <code>ghc -ddump-simple</code> I get the optimal output:</p>\n\n<pre><code>LensOpt.pick1 :: GHC.Prim.Addr#\nLensOpt.pick1 = \"test\"#\n\npick :: String\npick = GHC.CString.unpackCString# LensOpt.pick1\n</code></pre>\n\n<p>However, when compiled using <code>compileToCoreSimplified</code> I get the output:</p>\n\n<pre><code>s1 :: Addr#\ns1 = \"test\"#\n\ns2 :: [Char]\ns2 = unpackCString# s1\n\ns3 :: Record\ns3 = Record s2\n\npick :: String\npick = case s3 of { Record ds -&gt; ds }\n</code></pre>\n\n<p>I am invoking <code>compileToCoreSimplified</code> with:</p>\n\n<pre><code>import GHC\nimport GhcPlugins\nimport GHC.Paths\n\nmain = runGhc (Just libdir) $ do\n    setTargets []\n    dflags &lt;- getSessionDynFlags\n    setSessionDynFlags dflags{hscTarget = HscNothing}\n    res &lt;- compileToCoreSimplified \"LensOpt.hs\"\n    liftIO $ writeFile \"lens_api.txt\" $ showSDoc dflags $ ppr res\n</code></pre>\n\n<p>How do I drive the GHC API to apply the full optimisations?</p>\n"}, {"tags": ["macos", "haskell", "haskell-platform"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1529528074, "post_id": 50956495, "comment_id": 88911167, "body": "You should probably file a bug against Haskell Platform as it seemingly requires gcc7 to be installed in <code>&#47;usr&#47;local</code> without mentioning it in the documentation. You may also try <code>stack</code> instead of Haskell Platform."}], "answers": [{"comments": [{"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1529592523, "post_id": 50963036, "comment_id": 88939364, "body": "for the record, this is because ghc on os x is built using a brew installed gcc rather than the system gcc (which is really clang), due to clang compiling the GC code into something much less efficient: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/7602\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/7602</a> -- it still might be possible to do after-the-fact fixup of the paths, but this at least explains how the situation arises."}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 1, "last_activity_date": 1529567029, "creation_date": 1529567029, "answer_id": 50963036, "question_id": 50956495, "link": "https://stackoverflow.com/questions/50956495/fresh-install-of-haskell-platform-not-working-on-macos-high-sierra/50963036#50963036", "title": "Fresh install of Haskell platform not working on MacOS High Sierra", "body": "<p>On the related platform ticket, the problem was solved: <a href=\"https://github.com/haskell/haskell-platform/issues/310\" rel=\"nofollow noreferrer\">https://github.com/haskell/haskell-platform/issues/310</a></p>\n\n<p>It turns out that <code>ghc</code> builds from ghchq (at least through 8.4.3) don't link against the correct location for <code>libgcc_s.1.dylib</code>, but with the standard <code>DYLD_FALLBACK_LIBRARY_PATH</code>, then libgcc is nonetheless discovered in <code>/usr/lib</code>. However, with a custom value for <code>DYLD_FALLBACK_LIBRARY_PATH</code> then the library may not be found. So the solution is to not set a custom value, or to ensure that the custom value includes <code>/usr/lib</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 3558, "user_id": 1732563, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b51d68c0232ecc9de87719a203ccb428?s=128&d=identicon&r=PG", "display_name": "Sean Perry", "link": "https://stackoverflow.com/users/1732563/sean-perry"}, "is_accepted": false, "score": 0, "last_activity_date": 1529567792, "creation_date": 1529567792, "answer_id": 50963267, "question_id": 50956495, "link": "https://stackoverflow.com/questions/50956495/fresh-install-of-haskell-platform-not-working-on-macos-high-sierra/50963267#50963267", "title": "Fresh install of Haskell platform not working on MacOS High Sierra", "body": "<p>It turned out I had a DYLD_FALLBACK_PATH set. The compiler looks for /usr/local even though the library is in /usr. Ticket has been submitted upstream.</p>\n"}], "owner": {"reputation": 3558, "user_id": 1732563, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b51d68c0232ecc9de87719a203ccb428?s=128&d=identicon&r=PG", "display_name": "Sean Perry", "link": "https://stackoverflow.com/users/1732563/sean-perry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 853, "favorite_count": 0, "accepted_answer_id": 50963036, "answer_count": 2, "score": 0, "last_activity_date": 1529567792, "creation_date": 1529526270, "question_id": 50956495, "link": "https://stackoverflow.com/questions/50956495/fresh-install-of-haskell-platform-not-working-on-macos-high-sierra", "title": "Fresh install of Haskell platform not working on MacOS High Sierra", "body": "<p>I downloaded and installed Platform 8.4.3 as a pkg from the <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\">https://www.haskell.org/platform/</a>. This is what I get when I try to run ghci immediately afterwards.</p>\n\n<p><code>$ ghci\ndyld: Library not loaded: /usr/local/lib/gcc/7/libgcc_s.1.dylib\n  Referenced from: /Library/Frameworks/GHC.framework/Versions/8.4.3-x86_64/usr/lib/ghc-8.4.3/bin/ghc\n  Reason: image not found\n</code></p>\n\n<p>What did I miss?</p>\n"}, {"tags": ["haskell", "opengl"], "comments": [{"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1529523695, "post_id": 50955493, "comment_id": 88909330, "body": "Screen coordinates are 2D coordinates. To get the 3D world coordinates you need the third coordinate."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1529524182, "post_id": 50955493, "comment_id": 88909500, "body": "Yes Ripi, but I want only the (x,y) coordinates. It looks like the x or y world coordinate I get is <code>0.5&#47;(h-0.5)</code> where <code>h</code> is the z coordinate of the camera position. I observed that for different values of <code>h</code>."}, {"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 1, "creation_date": 1529524458, "post_id": 50955493, "comment_id": 88909609, "body": "If the porjection is <i>orthogonal</i> then any z-value may suffix. With <i>perspective</i> projection this is not true. Draw a fustrum, join points with the camera and see where they intersect the near plane."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1529556293, "post_id": 50955493, "comment_id": 88917857, "body": "Thank you @Ripi2, I begin to understand. I will try with an orthographic projection (I don&#39;t know what it is yet, but I suppose it is an orthogonal projection? I will see later I&#39;m busy now)."}], "answers": [{"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1529556121, "post_id": 50960436, "comment_id": 88917815, "body": "Thank you. I&#39;m just waking up and I don&#39;t get everything but I see the rationale. How did you get the <code>1.2</code>?"}, {"owner": {"reputation": 924, "user_id": 5069540, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gijl_3OcPeM/AAAAAAAAAAI/AAAAAAAAAAA/5D0FtItLzPc/photo.jpg?sz=128", "display_name": "Harish", "link": "https://stackoverflow.com/users/5069540/harish"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1529634409, "post_id": 50960436, "comment_id": 88955431, "body": "@St&#233;phaneLaurent, Sorry for the error, I entered the vector instead of point value (now corrected to <code>-1.8</code>). I inserted the remaining known numbers into the linked form for line/plane intersection, camera(<code>0,0,-3</code>) and unproject_point(<code>0.2,0.2,z</code>) and for z=-1.8, the intersection point is (<code>0.5,0.5,0.0</code>) which is what I think is expected point on the X-Y plane at the origin in world space."}], "tags": [], "owner": {"reputation": 924, "user_id": 5069540, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gijl_3OcPeM/AAAAAAAAAAI/AAAAAAAAAAA/5D0FtItLzPc/photo.jpg?sz=128", "display_name": "Harish", "link": "https://stackoverflow.com/users/5069540/harish"}, "is_accepted": false, "score": 1, "last_activity_date": 1529634047, "last_edit_date": 1529634047, "creation_date": 1529555520, "answer_id": 50960436, "question_id": 50955493, "link": "https://stackoverflow.com/questions/50955493/opengl-world-coordinates-from-mouse-coordinates/50960436#50960436", "title": "OpenGL world coordinates from mouse coordinates", "body": "<p>I don't know Haskell, so I won't be able to provide the working code, but I think I understand your problem.</p>\n\n<p>You have a 2D screen position that you unProject into 3D and get a point. This point is a position on your camera's near plane in world space. That is what your \"0.2\" is. Now you haven't specified the z value but I can compute this to be around <code>-1.8</code>.</p>\n\n<p>When you click on corners you get (+/- 0.2, +/- 0.2) for a cube whose length in world is 1 so that corner should be (+/- 0.5, +/- 0.5).</p>\n\n<blockquote>\n  <p>Note that what you get is a point on camera's near plane in world\n  space, it is NOT a point on your cube.</p>\n</blockquote>\n\n<p>This point can be used along with your camera position to generate a ray and then intersect this ray with a plane to obtain the real position on that plane.</p>\n\n<p>From your code,</p>\n\n<pre><code>lookAt (Vertex3 0 0 (-3)) (Vertex3 0 0 0) (Vector3 0 1 0)\n</code></pre>\n\n<p>The camera is at <code>(0,0,-3)</code>.</p>\n\n<p>If we consider the top right corner of your cube, lets say the 3D point you obtain is <code>(0.2, 0.2, 1.2)</code>. Using these two points, a Ray can be constructed with the camera as the origin and the 3D point <code>(0.2, 0.2, -1.8)</code> as the second point. </p>\n\n<pre><code>Ray( (0.0, 0.0, -3.0), (0.2, 0.2, -1.8) )\n</code></pre>\n\n<p>This ray can then intersect the plane where your cube is to obtain the point you are looking for. As your cube is centered at the origin and you are looking straight at it, the plane can be defined by normal <code>(0,0,1)</code> and the origin <code>(0,0,0)</code>.</p>\n\n<pre><code>Plane(Normal (0.0, 0.0, 1.0), Point (0.0, 0.0, 0.0)).\n</code></pre>\n\n<p>Now if we intersect the Ray with the Plane, we get :</p>\n\n<blockquote>\n  <p>(0.5, 0.5, 0.0)</p>\n</blockquote>\n\n<p>Presumably the point you are looking for.</p>\n\n<p>PS : I used this link \"<a href=\"http://www.ambrsoft.com/TrigoCalc/Plan3D/PlaneLineIntersection_.htm\" rel=\"nofollow noreferrer\">Plane line intersection</a>\" to quickly test the ray/plane intersection.</p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 379, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1529634047, "creation_date": 1529522083, "question_id": 50955493, "link": "https://stackoverflow.com/questions/50955493/opengl-world-coordinates-from-mouse-coordinates", "title": "OpenGL world coordinates from mouse coordinates", "body": "<p>I'm using the Haskell code below to get the OpenGL world coordinates from the mouse coordinates (the code is a bit long but this is a minimal code to draw a cube). My expectation is that the function <code>worldFromScreen</code> given at the end returns the world coordinates from the mouse coordinates (given in pixels from the top-left corner). Thanks to the keyboard-mouse callback I defined, these supposed world coordinates are printed in the terminal when the user right-clicks the mouse. </p>\n\n<p>The code generates a cube of length 1 in front view: </p>\n\n<p><a href=\"https://i.stack.imgur.com/AXZgM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/AXZgM.png\" alt=\"enter image description here\"></a></p>\n\n<p>The cube has length 1 and is centered at the origin, so the (x,y) coordinates of the vertices of this face should be (+/-0.5,+/-0.5). However when I right-click on a vertex of this face, I get coordinates (+/-0.2,+/-0.2) approximately. What is this 0.2 ? Is it possible to get (+/-0.5,+/-0.5) by changing something in my code ?</p>\n\n<pre><code>module Basic\n  where\nimport           Graphics.Rendering.OpenGL\nimport           Graphics.UI.GLUT\n\nwhite,black,red :: Color4 GLfloat\nwhite      = Color4    1    1    1    1\nblack      = Color4    0    0    0    1\nred        = Color4    1    0    0    1\n\ndisplay :: DisplayCallback\ndisplay = do\n  clear [ColorBuffer, DepthBuffer]\n  loadIdentity\n  preservingMatrix $ do\n    materialDiffuse Front $= red\n    renderObject Solid $ Cube 1\n  swapBuffers\n\nresize :: Size -&gt; IO ()\nresize s@(Size w h) = do\n  viewport $= (Position 0 0, s)\n  matrixMode $= Projection\n  loadIdentity\n  perspective 45.0 (w'/h') 1.0 100.0\n  lookAt (Vertex3 0 0 (-3)) (Vertex3 0 0 0) (Vector3 0 1 0)\n  matrixMode $= Modelview 0\n  where\n    w' = realToFrac w\n    h' = realToFrac h\n\nkeyboardMouse :: KeyboardMouseCallback\nkeyboardMouse key state _ position@(Position x y) =\n  case (key,state) of\n    (MouseButton LeftButton, Down) -&gt; print (x,y)\n    (MouseButton RightButton, Down) -&gt; do\n      (sx, sy, sz) &lt;- worldFromScreen position\n      print (sx, sy, sz)\n    _                              -&gt; return ()\n\nmain :: IO ()\nmain = do\n  _ &lt;- getArgsAndInitialize\n  _ &lt;- createWindow \"\"\n  windowSize $= Size 500 500\n  initialDisplayMode $= [RGBAMode, DoubleBuffered, WithDepthBuffer]\n  clearColor $= black\n  materialAmbient FrontAndBack $= black\n  lighting $= Enabled\n  light (Light 0) $= Enabled\n  position (Light 0) $= Vertex4 200 200 (-500) 1\n  ambient (Light 0) $= white\n  diffuse (Light 0) $= white\n  specular (Light 0) $= white\n  depthFunc $= Just Less\n  shadeModel $= Smooth\n  displayCallback $= display\n  reshapeCallback $= Just resize\n  keyboardMouseCallback $= Just keyboardMouse\n  idleCallback $= Nothing\n  mainLoop\n\nworldFromScreen :: Position -&gt; IO (GLdouble, GLdouble, GLdouble)\nworldFromScreen (Position sx sy) = do\n  viewport@(_, Size _ viewSizeY) &lt;- get viewport\n  projectionMatrix &lt;- get (matrix $ Just Projection) :: IO (GLmatrix GLdouble)\n  modelviewMatrix &lt;- get (matrix $ Just $ Modelview 0) :: IO (GLmatrix GLdouble)\n  let screenPos = Vertex3 (fromIntegral sx) (fromIntegral ((viewSizeY - 1) - sy)) 0\n  (Vertex3 wx wy wz) &lt;- unProject screenPos projectionMatrix modelviewMatrix viewport\n  return (wx, wy, wz)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "declarative"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1529519120, "post_id": 50954808, "comment_id": 88907211, "body": "Is this homework?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1529520210, "post_id": 50954808, "comment_id": 88907726, "body": "What is the type of <code>myList = [last [1..], 2]</code>, assuming numeric literals are of type <code>Int</code>?"}, {"owner": {"reputation": 85, "user_id": 9969128, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DDwYKHYQEjA/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2LrtXu7gHuhynaqs9gbMun2p8gdg/mo/photo.jpg?sz=128", "display_name": "pepe22", "link": "https://stackoverflow.com/users/9969128/pepe22"}, "edited": false, "score": 0, "creation_date": 1529521417, "post_id": 50954808, "comment_id": 88908288, "body": "that would be [Int] but i cant see your point"}, {"owner": {"reputation": 85, "user_id": 9969128, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DDwYKHYQEjA/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2LrtXu7gHuhynaqs9gbMun2p8gdg/mo/photo.jpg?sz=128", "display_name": "pepe22", "link": "https://stackoverflow.com/users/9969128/pepe22"}, "edited": false, "score": 0, "creation_date": 1529521488, "post_id": 50954808, "comment_id": 88908326, "body": "And no, its not homework, its just a test question(i have the answer) i dont understand"}, {"owner": {"reputation": 3120, "user_id": 4402721, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WCNcL.jpg?s=128&g=1", "display_name": "drRobertz", "link": "https://stackoverflow.com/users/4402721/drrobertz"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1529521657, "post_id": 50954808, "comment_id": 88908406, "body": "@pepe22 hint: try your three statements on @chi &#39;s <code>myList</code> :-) Do it in your head or pen/paper first."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1529524845, "post_id": 50954808, "comment_id": 88909781, "body": "Your question is really ambiguous. The only reading that seems to make any sense is &quot;Choose all of the following sets of conditions for which an <code>e :: [Int]</code> exists that satisfies the condition&quot;. Can you clarify it? And maybe with Chi&#39;s comment you can answer it yourself now?"}, {"owner": {"reputation": 85, "user_id": 9969128, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DDwYKHYQEjA/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2LrtXu7gHuhynaqs9gbMun2p8gdg/mo/photo.jpg?sz=128", "display_name": "pepe22", "link": "https://stackoverflow.com/users/9969128/pepe22"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1529531020, "post_id": 50954808, "comment_id": 88912343, "body": "@chi and drRobertz thanks, it was a great example, couldnt see it at first ^^"}], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 3120, "user_id": 4402721, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WCNcL.jpg?s=128&g=1", "display_name": "drRobertz", "link": "https://stackoverflow.com/users/4402721/drrobertz"}, "edited": false, "score": 0, "creation_date": 1529530114, "post_id": 50956174, "comment_id": 88911981, "body": "@drRobertz I disagree, since 1) and 2) are contradictory, and 2) and 3) are contradictory. <a href=\"http://and_3_is_clearly_false.\" rel=\"nofollow noreferrer\">Spoiler, text in URL.</a> I don&#39;t see how you&#39;ve proven 1) and 3)? For the example that chi gave, <code>length [last [1..], 1] = 2</code>, at least in GHC v8.4.3. Furthermore, it is stated that &quot;I know 2 of these statements are true, but I dont know which&quot;"}, {"owner": {"reputation": 85, "user_id": 9969128, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DDwYKHYQEjA/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2LrtXu7gHuhynaqs9gbMun2p8gdg/mo/photo.jpg?sz=128", "display_name": "pepe22", "link": "https://stackoverflow.com/users/9969128/pepe22"}, "edited": false, "score": 0, "creation_date": 1529531526, "post_id": 50956174, "comment_id": 88912531, "body": "great answer and thanks for not just giving away the answer! also i think that chi&#39;s list is a better example for beginners since everyone will understand last of an infinity list but your definition of never is a bit &quot;advanced&quot;. Please consider editing it to show chi&#39;s list first :)"}, {"owner": {"reputation": 3120, "user_id": 4402721, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WCNcL.jpg?s=128&g=1", "display_name": "drRobertz", "link": "https://stackoverflow.com/users/4402721/drrobertz"}, "edited": false, "score": 2, "creation_date": 1529535791, "post_id": 50956174, "comment_id": 88913698, "body": "@AJFarmar You&#39;re right, I was too quick. But then the question should be rephrased to remove the ambiguity. As it stands it says for an expression <code>e</code>, two of the statements are true, which they cannot be. It should be something like, for each statement, there exists a statement <code>e</code>..."}], "tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 3, "last_activity_date": 1529562199, "last_edit_date": 1529562199, "creation_date": 1529524829, "answer_id": 50956174, "question_id": 50954808, "link": "https://stackoverflow.com/questions/50954808/length-vs-head-vs-last-in-haskell/50956174#50956174", "title": "length vs head vs last in Haskell", "body": "<p>Since this is a test question, I won't answer it directly, but instead, here are some hints; it'd be better if you work this out yourself.</p>\n\n<p>Since we're talking about computations that don't terminate, it might be useful to define one such computation. However, if this confuses you you can safely ignore this and refer only to examples that don't include this.</p>\n\n<pre><code>-- `never` never terminates when evaluated, and can be any type.\nnever :: a\nnever = never\n</code></pre>\n\n<hr>\n\n<h2>Question 1</h2>\n\n<p>Consider the list <code>[never, 1]</code>, or alternatively the list <code>[last [1..], 1]</code> as suggested by @chi.</p>\n\n<hr>\n\n<h2>Question 2</h2>\n\n<p>Consider the list <code>[1..]</code>, or alternatively the list <code>[1, never]</code>.</p>\n\n<hr>\n\n<h2>Question 3</h2>\n\n<p>Consider the definition of <code>length</code>:</p>\n\n<pre><code>length [] = 0\nlength (_:xs) = 1 + length xs\n</code></pre>\n\n<p>Under what conditions does <code>length</code> not terminate? How does this relate to <code>last</code>?</p>\n"}], "owner": {"reputation": 85, "user_id": 9969128, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DDwYKHYQEjA/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2LrtXu7gHuhynaqs9gbMun2p8gdg/mo/photo.jpg?sz=128", "display_name": "pepe22", "link": "https://stackoverflow.com/users/9969128/pepe22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 1, "accepted_answer_id": 50956174, "answer_count": 1, "score": 2, "last_activity_date": 1529571747, "creation_date": 1529519099, "last_edit_date": 1529571747, "question_id": 50954808, "link": "https://stackoverflow.com/questions/50954808/length-vs-head-vs-last-in-haskell", "title": "length vs head vs last in Haskell", "body": "<p>I know 2 of these statements are true, but I dont know which</p>\n\n<p>Let <code>e</code> be an expression of type <code>[Int]</code></p>\n\n<ol>\n<li><p>there exists <code>e</code> such that: Evaluation of <code>head e</code> won't finish but <code>last e</code> will</p></li>\n<li><p>there exists <code>e</code> such that: Evaluation of <code>last e</code> won't finish but <code>head e</code> will </p></li>\n<li><p>there exists <code>e</code> such that: Evaluation of <code>length e</code> won't finish but <code>last e</code> will</p></li>\n</ol>\n\n<p>Seems clear to me that 2 is true, but I can't see how 1 or 3 can be true. </p>\n\n<p>My thinking is that in order to calculate the length of a list you need to get to the last one, making 1 and 3 impossible</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 2, "last_activity_date": 1529532196, "last_edit_date": 1529532196, "creation_date": 1529528650, "answer_id": 50956995, "question_id": 50954470, "link": "https://stackoverflow.com/questions/50954470/indexed-lenses-for-nested-containers/50956995#50956995", "title": "Indexed lenses for nested containers", "body": "<p>Use <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Indexed.html#v:-60-.-62-\" rel=\"nofollow noreferrer\"><code>(&lt;.&gt;)</code></a>. It's just like <code>(.)</code>, except it preserves the indices on both the left and the right. <code>(.)</code> itself (and its alias <code>(.&gt;)</code>) preserves only the index of the RHS, unless the RHS is itself index-preserving, in which case the index comes from the LHS. The mnemonic is that the arrows point to the indices you'd like to save.</p>\n\n<pre><code>&gt;&gt;&gt; example^@..outerMap.ifolded&lt;.&gt;innerMap.ifolded.filtered odd\n[((\"A\",'a'),1),((\"A\",'c'),3),((\"C\",'a'),5),((\"C\",'b'),7),((\"C\",'c'),9)]\n</code></pre>\n"}], "owner": {"reputation": 3385, "user_id": 841562, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4cbb35380ef84f4f0f68061f578a4e73?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/841562/lemming"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 50956995, "answer_count": 1, "score": 1, "last_activity_date": 1529532196, "creation_date": 1529517746, "question_id": 50954470, "link": "https://stackoverflow.com/questions/50954470/indexed-lenses-for-nested-containers", "title": "Indexed lenses for nested containers", "body": "<p>How can I use lenses to obtain keys from multiple levels of nesting?</p>\n\n<p>Consider the following types</p>\n\n<pre><code>data Outer = Outer { _outerMap :: Map String Inner }\ndata Inner = Inner { _innerMap :: Map Char Int }\nmakeLenses ''Outer\nmakeLenses ''Inner\n</code></pre>\n\n<p>and assume the following example value</p>\n\n<pre><code>example :: Outer\nexample = Outer $ Map.fromList\n  [ (\"A\", Inner $ Map.fromList [ ('a', 1), ('b', 2), ('c', 3) ])\n  , (\"B\", Inner $ Map.fromList [ ('a', 4), ('b', 6), ('c', 8) ])\n  , (\"C\", Inner $ Map.fromList [ ('a', 5), ('b', 7), ('c', 9) ])\n  ]\n</code></pre>\n\n<p>Using lenses I can flatten <code>example</code> to a <code>[Int]</code> and filter the odd numbers as follows:</p>\n\n<pre><code>&gt;&gt;&gt; example^..outerMap.folded.innerMap.folded.filtered odd\n[1,3,5,7,9]\n</code></pre>\n\n<p>I can annotate the values with the inner key as follows:</p>\n\n<pre><code>&gt;&gt;&gt; example^@..outerMap.folded.innerMap.ifolded.filtered odd\n[('a',1),('c',3),('a',5),('b',7),('c',9)]\n</code></pre>\n\n<p>But how can I use lenses to annotate the values with both the outer and inner keys, to get the following result?</p>\n\n<pre><code>&gt;&gt;&gt; _whatHere example\n[((\"A\",'a'),1),((\"A\",'c'),3),((\"C\",'a'),5),((\"C\",'b'),7),((\"C\",'c'),9)]\n</code></pre>\n\n<p>The following attempt still only returns the inner keys:</p>\n\n<pre><code>&gt;&gt;&gt; example^@..outerMap.ifolded.innerMap.ifolded.filtered odd\n[('a',1),('c',3),('a',5),('b',7),('c',9)]\n</code></pre>\n\n<p>And the following attempt doesn't type-check</p>\n\n<pre><code>&gt;&gt;&gt; example^..outerMap.ifolded.withIndex.alongside id (innerMap.ifolded.filtered odd.withIndex)\n\nerror:\n    \u2022 No instance for (Applicative\n                         (Control.Lens.Internal.Getter.AlongsideRight\n                            (Const (Data.Monoid.Endo [([Char], (Char, Int))])) [Char]))\n</code></pre>\n\n<hr>\n\n<p>An implementation without lenses might look something like this:</p>\n\n<pre><code>nolens :: Outer -&gt; [((String, Char), Int)]\nnolens =\n  filter (odd . snd)\n  . foldMap (\\(k, i) -&gt; (map (first (k, )) . Map.toList . _innerMap) i)\n  . Map.toList\n  . _outerMap\n</code></pre>\n"}, {"tags": ["haskell", "show", "functor"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1529515811, "post_id": 50953822, "comment_id": 88905620, "body": "So how is this different from <a href=\"https://stackoverflow.com/questions/50946004/how-to-write-a-show-instance-for-mu-recursive-types\">your earlier question</a>, what merits asking a new one, and once again: <i>what have you tried</i>?"}], "answers": [{"comments": [{"owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "edited": false, "score": 0, "creation_date": 1529532049, "post_id": 50957599, "comment_id": 88912715, "body": "I&#39;m already using <code>showsPrec</code>, but because it was longer and less obvious, I changed it to the simpler <code>show</code> interface to post it here. Regarding your answer (very helpful), how will be the <code>instance (Show1 NatF)</code>? I tryied to implement it without success..."}, {"owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "edited": false, "score": 0, "creation_date": 1529533450, "post_id": 50957599, "comment_id": 88913157, "body": "Ok. I did it. Now I have problems understanding what is <code>fmap UnquotedString</code> doing and why when I remove it it doesn&#39;t type-checks."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "edited": false, "score": 0, "creation_date": 1529533879, "post_id": 50957599, "comment_id": 88913272, "body": "It doesn&#39;t typecheck without the <code>UnquotedString</code> wrapper because <code>ShowS</code> is a function type under the hood, and as such can&#39;t be shown directly."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1529531508, "creation_date": 1529531508, "answer_id": 50957599, "question_id": 50953822, "link": "https://stackoverflow.com/questions/50953822/how-to-write-a-show-instance-for-the-mu-recursive-type/50957599#50957599", "title": "How to write a Show instance for the Mu recursive type", "body": "<p>First let me rewrite your <code>Mu NatF</code> instance to define <code>showsPrec</code> instead of <code>show</code>, which is generally the preferred way (and will become important in a moment).</p>\n\n<pre><code>instance Show (Mu NatF) where\n  showsPrec p (Mu f) = showParen (p&gt;9) $ f alg where\n     alg :: NatF ShowS -&gt; ShowS\n     alg Zero = (\"Zero\"++)\n     alg (Succ n) = (\"(Succ \"++) . n . (\")\"++)\n</code></pre>\n\n<p>Nothing much changed here; I've basically just replaced the <code>++</code> concatenation operator with composition-concatenation of difference lists. (The reason these are preferred is mainly the annoying <em>O</em> (<em>n</em><sup>2</sup>) complexity of left-associative list concatenations; it's a bit of a historical embarrassment.)</p>\n\n<p>Now if you want to switch to other functors, the only thing that needs to change is the <code>alg</code> function. You need a generic</p>\n\n<pre><code>alg :: Show1 f =&gt; f ShowS -&gt; ShowS\n</code></pre>\n\n<p>Well, that's <em>almost</em> <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Functor-Classes.html#v:showsPrec1\" rel=\"nofollow noreferrer\">the function which the <code>Show1</code> class is about</a>:</p>\n\n<pre><code>showsPrec1 :: (Show1 f, Show a) =&gt; Int -&gt; f a -&gt; ShowS\n</code></pre>\n\n<p>(This is basically equivalent to <code>show1 :: (Show1 f, Show a) =&gt; f a -&gt; String</code>, which isn't shipped in the libraries though.)</p>\n\n<p>You just need to instead of <em>showing</em> the <code>a</code> argument simply paste in a <code>ShowS</code> as verbatim. I'd do this with a hack:</p>\n\n<pre><code>newtype UnquotedString = UnquotedString {getUnquotedString :: ShowS}\n\ninstance Show UnquotedString where\n  showsPrec _ (UnquotedString s) = s\n</code></pre>\n\n<p>We always want parentheses; this can be achieved by always giving 10 to the precedence argument.</p>\n\n<pre><code>alg = showsPrec1 10 . fmap UnquotedString\n</code></pre>\n\n<hr>\n\n<p>IMO, this whole approach with <code>Show1</code> is rather awkward though. That is an annoying-to-instantiate class, much different from <code>Show</code> which you can simply derive. Therefore, I actually find your approach with the <code>(Functor f, Show (f String))</code> neater. Don't care to much about <code>-XUndecidableInstances</code> \u2013 that's needed because you \u201cre-call\u201d the class in a way so the compiler won't end up in a loop while typechecking, but this isn't such a big concern.</p>\n\n<p>You still need to avoid the extra quotes with this approach, though.</p>\n"}], "owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1529531508, "creation_date": 1529515341, "last_edit_date": 1529530186, "question_id": 50953822, "link": "https://stackoverflow.com/questions/50953822/how-to-write-a-show-instance-for-the-mu-recursive-type", "title": "How to write a Show instance for the Mu recursive type", "body": "<p>Due to a <a href=\"https://stackoverflow.com/questions/50946004/how-to-write-a-show-instance-for-mu-recursive-types\">previous question</a>, I know how to write specialized instances for particular <code>Mu</code> recursive types like <code>Mu NatF</code> or <code>Mu (ListF a)</code>. Now I want to write a generic instance that works for all functors applied to <code>Mu</code>.</p>\n\n<p>Basically what I want to do is to fill the gap named <code>&lt;???&gt;</code> in the following Haskell snipet:</p>\n\n<pre><code>newtype Mu f = Mu (forall a. (f a -&gt; a) -&gt; a)\n\ninstance (Functor f, Show1 f) =&gt; Show (Mu f) where\n    showsPrec d (Mu f) = &lt;???&gt;\n</code></pre>\n\n<p>How can this be accomplished?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Imagine I want to define natural numbers using <code>Mu</code>. Like this:</p>\n\n<pre><code>data NatF r = Zero | Succ r\n\ninstance Functor NatF where\n  fmap f Zero = Zero\n  fmap f (Succ r) = Succ (f r)\n\ntype NatMu = Mu NatF\n</code></pre>\n\n<p>Now I want to show values of type <code>NatMu</code>, so I do this:</p>\n\n<pre><code>instance Show (Mu NatF) where\n    show (Mu f) = f alg where\n        alg Zero = \"Zero\"\n        alg (Succ n) = \"(Succ \" ++ n ++ \")\"\n</code></pre>\n\n<p>Everything works and everybody is happy, but... What if I want to define <code>data NatNu = Nu NatF</code> or <code>data ListMu a = Mu (ListF a)</code>? I will need to create a practically identical instance for each variation. Why not to abstract it so my definitions only grow linearly with number of functors and recursive schemes and not quadratically?</p>\n\n<p>I have no idea how to do it. I am just learning Haskell from a heavy assembly+C background (embedded programming and numerical code). My brain shortcuts with those abstractions, types, lifting... I am trying to understand it implementing most basic concepts from scratch, but I can solve this particular problem.</p>\n\n<p><strong>EDIT2</strong></p>\n\n<p>I managed to write something that works, but it looks odd to me. Moreover, it needs some ugly extensions like <code>UndecidableInstances</code>.</p>\n\n<pre><code>instance Show (NatF String) where\n    show Zero = \"Zero\"\n    show (Succ n) = \"(Succ \" ++ n ++ \")\"\n\ninstance (Functor f, Show (f String)) =&gt; Show (Mu f) where\n    show (Mu f) = f $ show\n</code></pre>\n\n<p>Is there a better way to do it (without the need of fancy Haskell extensions)?</p>\n"}, {"tags": ["performance", "haskell", "functional-programming", "execution-time", "sieve-of-eratosthenes"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 1, "creation_date": 1529511838, "post_id": 50952633, "comment_id": 88903464, "body": "I&#39;m no Haskell expert, but your <code>remove</code> looks like it has to go through all of the unremoved numbers. A real sieve of Eratosthenes gets to jump right to the flags for the numbers it&#39;s marking composite, which is a lot faster. Rule of thumb: if there&#39;s no array of boolean flags, it&#39;s probably not really a sieve of Eratosthenes."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1529548679, "post_id": 50952633, "comment_id": 88916277, "body": "@user2357112 that&#39;s debatable. I think the essence of SoE is its generation of composites from each prime by repeated increment. how these multiples are then skipped over is a matter of a specific implementation. OP&#39;s <code>remove</code> is <code>Data.List.Ordered.minus</code>. of course arrays have advantage of random access, but an implementation with ordered lists can be had for just an additional log factor in the complexity. more <a href=\"https://wiki.haskell.org/Prime_numbers\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1529549017, "post_id": 50952633, "comment_id": 88916345, "body": "<code>remove</code> does go through all the numbers, but the iteration is stopped early, at the sqrt of the top limit. so overall it&#39;s roughly <code>primesTo m = foldl minus [3,5..] [[p*p, p*p+2*p..m] | p &lt;- takeWhile ((&lt;= m) . (^2)) primes]</code>. Which as Melissa O&#39;Neill shows in her JFP paper has complexity just above n^1.5."}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1529558267, "post_id": 50952633, "comment_id": 88918485, "body": "@WillNess: Despite performing the same repeated increments as the SoE, I would consider this algorithm much closer to trial division, as it needs to consider each number once for every prime up to its first divisor instead of once for every prime divisor. Melissa O&#39;Neill also seems to feel strongly that performing increments instead of division doesn&#39;t turn trial division into the SoE in <a href=\"https://www.cs.hmc.edu/~oneill/papers/Sieve-JFP.pdf\" rel=\"nofollow noreferrer\">the paper</a> I think you&#39;re referring to. (Also, wow, you&#39;ve edited that wiki page 550 times over the course of a decade.)"}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1529558611, "post_id": 50952633, "comment_id": 88918592, "body": "That said, I don&#39;t consider the flag array strictly necessary for a sieve of Eratosthenes, but for the kind of code people write on their first attempt at a sieve, the rule of thumb works pretty well."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1529564914, "post_id": 50952633, "comment_id": 88921475, "body": "that paper was very confusing for me, except for the math in it. here of course there&#39;s no trial divisions. if this foldl-based code <code>(...(((xs -a)-b)-c)-...)</code> is turned into foldr-based one <code>(xs -(a+(b+(c+...))))</code>, and if, further, the sum is found as a tree, not as a list, the complexity is just one <code>log N</code> factor worse than the random-access sieve (same as PQ-based one in the paper, btw). Eratosthenes himself counted by 1s, for all we know. :) here at least each enumeration <i>directly</i> finds each next multiple by adding <code>2*p</code>, not adding <code>1</code> <i>2p</i> times. So I do consider it the true sieve."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1529566406, "post_id": 50952633, "comment_id": 88922324, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/173533/discussion-between-will-ness-and-user2357112\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1529511294, "creation_date": 1529511294, "answer_id": 50952794, "question_id": 50952633, "link": "https://stackoverflow.com/questions/50952633/sieve-of-eratosthenes-execution-time-in-haskell/50952794#50952794", "title": "Sieve of Eratosthenes execution time in haskell", "body": "<p>Try it with</p>\n\n<pre><code>main = print $ last $ primes 2000000\n</code></pre>\n\n<p>so it'll show you only the last found prime.</p>\n\n<p>Compile it with <code>-O2</code> and run with <code>+RTS -s</code> to see the overall timings and the memory stats.</p>\n\n<p>Be sure to measure it at several size points, to find out the <a href=\"http://en.wikipedia.org/wiki/Analysis_of_algorithms#Empirical_orders_of_growth\" rel=\"nofollow noreferrer\">empirical orders of growth</a>! True sieves run at about <code>~ n^1.1</code>, in <em>n</em> primes produced. Anything up to <code>~ n^1.5</code> is passable. <code>~ n^2</code> is bad, any slower than that is even worse. :)</p>\n\n<p>Yours should be all right, by the looks of it.</p>\n"}], "owner": {"reputation": 23, "user_id": 9618887, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213768237054859/picture?type=large", "display_name": "Awsaf Rahman Protic", "link": "https://stackoverflow.com/users/9618887/awsaf-rahman-protic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 50952794, "answer_count": 1, "score": 2, "last_activity_date": 1529651103, "creation_date": 1529510772, "last_edit_date": 1529651103, "question_id": 50952633, "link": "https://stackoverflow.com/questions/50952633/sieve-of-eratosthenes-execution-time-in-haskell", "title": "Sieve of Eratosthenes execution time in haskell", "body": "<p>I am newbie in Haskell and was writing code for solving the Sieve of Eratosthenes problem using lists. Here is the code</p>\n\n<pre><code>primes m = 2 : primes' m [3,5 ..m] [] where\nprimes' m integers@(p : xs) acc   | p*p&gt;m =  reverse acc ++ integers\n                                  | True  = primes' m (xs `remove` [p*p, p*p+2*p..m]) (p:acc)\n\nremove integers@(x:xs) multiples@(y:ys) | x &lt; y = x : remove xs multiples\n                                        | x == y =    remove xs ys\n                                        | x &gt; y =     remove integers ys\n\nremove integers multiples = integers\n</code></pre>\n\n<p>If I input m = 2000000, the code takes around 14 seconds to print out all the results. I think 90 percent of the time goes to printing and not actually executing the code. Is there a way to find the correct execution time for this particular program? </p>\n"}, {"tags": ["parsing", "haskell", "parsec", "happy", "megaparsec"], "comments": [{"owner": {"reputation": 8857, "user_id": 3414900, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/KlvbC.jpg?s=128&g=1", "display_name": "bartop", "link": "https://stackoverflow.com/users/3414900/bartop"}, "edited": false, "score": 3, "creation_date": 1529501166, "post_id": 50949118, "comment_id": 88896238, "body": "Here is ANSI C full grammar for yacc which is, as far as I know, compatible with Happy: <a href=\"https://www.lysator.liu.se/c/ANSI-C-grammar-y.html\" rel=\"nofollow noreferrer\">lysator.liu.se/c/ANSI-C-grammar-y.html</a>. I guess that is all that You need"}, {"owner": {"reputation": 2305, "user_id": 1058525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa0a21a08d4f80989ffb4fa1ffcbfa5e?s=128&d=identicon&r=PG", "display_name": "Bulat", "link": "https://stackoverflow.com/users/1058525/bulat"}, "reply_to_user": {"reputation": 8857, "user_id": 3414900, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/KlvbC.jpg?s=128&g=1", "display_name": "bartop", "link": "https://stackoverflow.com/users/3414900/bartop"}, "edited": false, "score": 0, "creation_date": 1529502921, "post_id": 50949118, "comment_id": 88897512, "body": "Thank you, but it still require Haskell lexer plus AST-building code, f.e. I need to add to rule &quot;Exp1  : Exp1 &#39;+&#39; Term&quot; the following Haskell code building AST - &quot;{ Plus $1 $3 }&quot;. May be, there are more ready-to-use-in-Haskell alternatives."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 3, "creation_date": 1529507314, "post_id": 50949118, "comment_id": 88900597, "body": "Does <a href=\"https://hackage.haskell.org/package/language-c\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/language-c</a> help?"}, {"owner": {"reputation": 2305, "user_id": 1058525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa0a21a08d4f80989ffb4fa1ffcbfa5e?s=128&d=identicon&r=PG", "display_name": "Bulat", "link": "https://stackoverflow.com/users/1058525/bulat"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1529508618, "post_id": 50949118, "comment_id": 88901437, "body": "@arrowd thank you. It&#39;s a perfect fit!!! Hope it will be able to parse just a few statements rather than entire program."}, {"owner": {"reputation": 2305, "user_id": 1058525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa0a21a08d4f80989ffb4fa1ffcbfa5e?s=128&d=identicon&r=PG", "display_name": "Bulat", "link": "https://stackoverflow.com/users/1058525/bulat"}, "edited": false, "score": 0, "creation_date": 1529509050, "post_id": 50949118, "comment_id": 88901717, "body": "But I still look for more variants, just for completeness. And BTW, language-c based on Happy grammar, so I may just end up ripping it."}, {"owner": {"reputation": 2305, "user_id": 1058525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa0a21a08d4f80989ffb4fa1ffcbfa5e?s=128&d=identicon&r=PG", "display_name": "Bulat", "link": "https://stackoverflow.com/users/1058525/bulat"}, "edited": false, "score": 0, "creation_date": 1529509509, "post_id": 50949118, "comment_id": 88902003, "body": "I&#39;m stupid! Just adding &quot;{}&quot; around statements will turn them into single statement for which we have a parser. So it can&#39;t be easier!"}], "answers": [{"tags": [], "owner": {"reputation": 2305, "user_id": 1058525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa0a21a08d4f80989ffb4fa1ffcbfa5e?s=128&d=identicon&r=PG", "display_name": "Bulat", "link": "https://stackoverflow.com/users/1058525/bulat"}, "is_accepted": false, "score": 1, "last_activity_date": 1529704983, "creation_date": 1529704983, "answer_id": 50996111, "question_id": 50949118, "link": "https://stackoverflow.com/questions/50949118/simple-c-grammar-for-haskell-parsec-megaparsec-or-happy/50996111#50996111", "title": "Simple C grammar for Haskell Parsec, MegaParsec or Happy", "body": "<p>There is Haskell library parsing C99 grammar (and C11 partially):</p>\n\n<p><a href=\"https://hackage.haskell.org/package/language-c\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/language-c</a></p>\n"}], "owner": {"reputation": 2305, "user_id": 1058525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa0a21a08d4f80989ffb4fa1ffcbfa5e?s=128&d=identicon&r=PG", "display_name": "Bulat", "link": "https://stackoverflow.com/users/1058525/bulat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1529704983, "creation_date": 1529500357, "question_id": 50949118, "link": "https://stackoverflow.com/questions/50949118/simple-c-grammar-for-haskell-parsec-megaparsec-or-happy", "title": "Simple C grammar for Haskell Parsec, MegaParsec or Happy", "body": "<p>I develop a preprocessor transpiling subset of C statements into gcc _asm statements. For this project, I will be happy to reuse existing C statements parser written with any popular Haskell technology, or just start with some simple C subset paser in order to avoid redoing existing work.</p>\n\n<p>Unfortunately, so far I found grammars just for everything but C. And while I can start with Parsec grammars for Java/Go, it seems that MegaParsec is preferable choice?</p>\n\n<p>I can quickly develop grammar for small C subset, but ready-to-use grammar for larger C subset will allow me to completely skip the development of C statement parser and focus on the meat of project - asm code generation.</p>\n\n<p>Eventually, it may turn into LLVM pass transpiling parts of C++ code, but for quick prototype, I prefer Haskell, especially if I can find ready-to-use parser.</p>\n"}, {"tags": ["haskell", "haskell-lens", "gadt"], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1529508333, "post_id": 50950983, "comment_id": 88901244, "body": "Thanks for your answer! In my use case I have an existential wrapper around <code>Value t</code>, this one: <code>data AnyValue = forall t . AnyValue (Value t)</code>. Will I be able to extract from this type using my prism?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1529516880, "post_id": 50950983, "comment_id": 88906178, "body": "@Shersh Sure, it should be quite easy to write a term of type e.g. <code>Prism AnyValue AnyValue Bool Bool</code>. For example, <code>Prism (\\s -&gt; case s of AnyValue (B b) -&gt; Right b; _ -&gt; Left s) (AnyValue . B)</code> will do."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1529551030, "post_id": 50950983, "comment_id": 88916754, "body": "Thanks a lot again for your suggestions! I&#39;ve implemented discussed approach in this PR if you&#39;re interested: <a href=\"https://github.com/kowainik/tomland/pull/65\" rel=\"nofollow noreferrer\">github.com/kowainik/tomland/pull/65</a>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1529506273, "last_edit_date": 1529506273, "creation_date": 1529505972, "answer_id": 50950983, "question_id": 50948583, "link": "https://stackoverflow.com/questions/50948583/how-to-implement-prism-for-gadt/50950983#50950983", "title": "How to implement prism for GADT?", "body": "<p>You'll need to change your second definition of <code>ValuePrism</code>.</p>\n\n<p>Your first <code>ValuePrism 'TBool Bool</code> does not contain a function of type <code>Bool -&gt; Value 'TInt</code>, but your second <code>ValuePrism 'TBool Bool</code> does (by specializing the <code>forall</code>'d <code>t</code> to <code>'TInt</code> and calling <code>review</code>). Such a function can be cooked up from scratch, but it will necessarily be what I would call \"unreasonable\". You could define</p>\n\n<pre><code>type ValuePrism tag a = Prism (Value tag) (Value tag) a a\n</code></pre>\n\n<p>instead; you will then find the translation much easier.</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 50950983, "answer_count": 1, "score": 3, "last_activity_date": 1529506273, "creation_date": 1529498635, "question_id": 50948583, "link": "https://stackoverflow.com/questions/50948583/how-to-implement-prism-for-gadt", "title": "How to implement prism for GADT?", "body": "<p>I have GADT data type like this:</p>\n\n<pre><code>data TValue = TInt | TBool\n\ndata Value (t :: TValue) where\n    I :: Int  -&gt; Value 'TInt\n    B :: Bool -&gt; Value 'TBool\n</code></pre>\n\n<p>And I want to have prisms for pattern matching on this data type. I'm using data prism approach for simplicity. So previously I had something like this:</p>\n\n<pre><code>data ValuePrism (tag :: TValue) a = ValuePrism\n    { matchValue :: forall t . Value t -&gt; Maybe a\n    , buildValue :: a -&gt; Value tag\n    }\n\nboolPrism :: ValuePrism 'TBool Bool\nboolPrism = ValuePrism matchBool B\n  where\n    matchBool :: Value t -&gt; Maybe Bool\n    matchBool (B b) = Just b\n    matchBool _     = Nothing\n</code></pre>\n\n<p>I want to fit this use case into prisms interface. I can specify type in the following way:</p>\n\n<pre><code>data Prism s t a b = Prism\n    { preview :: s -&gt; Either t a\n    , review  :: b -&gt; t\n    }\n\ntype ValuePrism (tag :: TValue) a = \n    forall t . Prism (Value t) (Value tag) a a\n</code></pre>\n\n<p>But I'm unable to write function which creates <code>ValuePrism</code> according to old interface:</p>\n\n<pre><code>mkValuePrism :: (forall t . Value t -&gt; Maybe a)\n             -&gt; (a -&gt; Value tag)\n             -&gt; ValuePrism tag a\nmkValuePrism = =&lt;&lt; (\u30c4) &gt;&gt;=\n</code></pre>\n\n<p>Is there some way to create prism for GADT?</p>\n"}, {"tags": ["haskell", "haskell-stack", "ghc-mod", "hlint"], "answers": [{"comments": [{"owner": {"reputation": 959, "user_id": 6531461, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LqPwA.jpg?s=128&g=1", "display_name": "Mo Hajr", "link": "https://stackoverflow.com/users/6531461/mo-hajr"}, "edited": false, "score": 0, "creation_date": 1529679158, "post_id": 50959857, "comment_id": 88975777, "body": "I had to uninstall stack and reinstall it again, and then use stack resolver nightly-2017-06-28 in order for it to work thanks a lot!"}, {"owner": {"reputation": 5527, "user_id": 136558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0d68c1fad9ba7588f4b50036a995dbd?s=128&d=identicon&r=PG", "display_name": "choonkeat", "link": "https://stackoverflow.com/users/136558/choonkeat"}, "edited": false, "score": 3, "creation_date": 1535328466, "post_id": 50959857, "comment_id": 91012794, "body": "For newbies like me, <i>\u201cchanging your Stack resolver to lts-8.24\u201d</i> meant to edit your <code>~&#47;.stack&#47;global-project&#47;stack.yaml</code> and changing the <code>resolver:</code> value. Re-run <code>stack install ghc-mod</code> and it worked"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 9, "last_activity_date": 1529550918, "creation_date": 1529550918, "answer_id": 50959857, "question_id": 50948485, "link": "https://stackoverflow.com/questions/50948485/stack-install-ghc-mod-fails-with-dependencies-conflicts-on-osx-10-13-4/50959857#50959857", "title": "stack install ghc-mod fails with dependencies conflicts on OSX 10.13.4", "body": "<p>The issue is that ghc-mod does not support newer versions of GHC, I believe the last supported version is GHC 8.0. You can try changing your Stack resolver to lts-8.24 or nightly-2017-06-28 (see the snapshots listed on <a href=\"https://www.stackage.org/package/ghc-mod\" rel=\"noreferrer\">ghc-mod's Stackage page</a>).</p>\n"}, {"comments": [{"owner": {"reputation": 75, "user_id": 2903534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78a5a4cdd8f3143f32017f10f309cddf?s=128&d=identicon&r=PG", "display_name": "Yuriy Yakovenko", "link": "https://stackoverflow.com/users/2903534/yuriy-yakovenko"}, "edited": false, "score": 0, "creation_date": 1548146802, "post_id": 54080942, "comment_id": 95428443, "body": "You&#39;re saved my live :)"}], "tags": [], "owner": {"reputation": 436, "user_id": 3137180, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/vWlsj.jpg?s=128&g=1", "display_name": "jundl77", "link": "https://stackoverflow.com/users/3137180/jundl77"}, "is_accepted": false, "score": 4, "last_activity_date": 1546890974, "creation_date": 1546890974, "answer_id": 54080942, "question_id": 50948485, "link": "https://stackoverflow.com/questions/50948485/stack-install-ghc-mod-fails-with-dependencies-conflicts-on-osx-10-13-4/54080942#54080942", "title": "stack install ghc-mod fails with dependencies conflicts on OSX 10.13.4", "body": "<p>Even easier, this worked for me:\n<code>stack install ghc-mod --resolver lts-8.24</code></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10092203, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QibJx.jpg?s=128&g=1", "display_name": "YiXuan Guo", "link": "https://stackoverflow.com/users/10092203/yixuan-guo"}, "is_accepted": false, "score": -1, "last_activity_date": 1551749570, "creation_date": 1551749570, "answer_id": 54994166, "question_id": 50948485, "link": "https://stackoverflow.com/questions/50948485/stack-install-ghc-mod-fails-with-dependencies-conflicts-on-osx-10-13-4/54994166#54994166", "title": "stack install ghc-mod fails with dependencies conflicts on OSX 10.13.4", "body": "<p>input command line:</p>\n\n<p>stack install ghc-mod --resolver lts-8.24</p>\n\n<p>it really helps.</p>\n"}], "owner": {"reputation": 959, "user_id": 6531461, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LqPwA.jpg?s=128&g=1", "display_name": "Mo Hajr", "link": "https://stackoverflow.com/users/6531461/mo-hajr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1824, "favorite_count": 1, "accepted_answer_id": 50959857, "answer_count": 3, "score": 7, "last_activity_date": 1551749570, "creation_date": 1529498321, "question_id": 50948485, "link": "https://stackoverflow.com/questions/50948485/stack-install-ghc-mod-fails-with-dependencies-conflicts-on-osx-10-13-4", "title": "stack install ghc-mod fails with dependencies conflicts on OSX 10.13.4", "body": "<p>When I try to install ghc-mod via stack I end up having these depencies conflicts</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for ghc-mod-5.8.0.0:\n    Cabal-2.0.1.1 from stack configuration does not match &gt;=1.18 &amp;&amp; &lt;1.25  (latest matching version is 1.24.2.0)\n    base-4.10.1.0 from stack configuration does not match &gt;=4.6.0.1 &amp;&amp; &lt;4.10  (latest matching version is 4.9.1.0)\n    cabal-helper must match &lt;0.8 &amp;&amp; &gt;=0.7.3.0, but the stack configuration has no specified version  (latest matching version is 0.7.3.0)\n    extra-1.6.8 from stack configuration does not match &lt;1.6 &amp;&amp; &gt;=1.4  (latest matching version is 1.5.3)\n    ghc-8.2.2 from stack configuration does not match &gt;=7.6 &amp;&amp; &lt;8.2\n    haskell-src-exts-1.20.2 from stack configuration does not match &lt;1.20 &amp;&amp; &gt;=1.18  (latest matching version is 1.19.1)\n    hlint-2.1.6 from stack configuration does not match &lt;2.1 &amp;&amp; &gt;=2.0.8  (latest matching version is 2.0.15)\n    monad-journal-0.8.1 from stack configuration does not match &lt;0.8 &amp;&amp; &gt;=0.4  (latest matching version is 0.7.2)\n    optparse-applicative-0.14.2.0 from stack configuration does not match &gt;=0.13.0.0 &amp;&amp; &lt;0.14  (latest matching version is 0.13.2.0)\nneeded since ghc-mod is a build target.\n\nSome different approaches to resolving this:\n\n  * Consider trying 'stack solver', which uses the cabal-install solver to attempt to find some working build configuration. This can be convenient when dealing with many complicated constraint\n    errors, but results may be unpredictable.\n\n  * Recommended action: try adding the following to your extra-deps in /Users/mo/.stack/global-project/stack.yaml:\n\n- Cabal-1.24.2.0\n- base-4.9.1.0\n- cabal-helper-0.7.3.0\n- extra-1.5.3\n- haskell-src-exts-1.19.1\n- hlint-2.0.15\n- monad-journal-0.7.2\n- optparse-applicative-0.13.2.0\n</code></pre>\n\n<p>if I try to add the suggested extra deps like so</p>\n\n<pre><code>extra-deps:\n- Cabal-1.24.2.0\n- base-4.9.1.0\n- cabal-helper-0.7.3.0\n- extra-1.5.3\n- haskell-src-exts-1.19.1\n- hlint-2.0.15\n- monad-journal-0.7.2\n- optparse-applicative-0.13.2.0\n- process-1.4.3.0\n- either-4.4.1.1\n- free-4.12.4\n</code></pre>\n\n<p>I end up having a loop like this </p>\n\n<pre><code>    Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for ghc-mod-5.8.0.0:\n    base-4.10.1.0 from stack configuration does not match &gt;=4.6.0.1 &amp;&amp; &lt;4.10  (latest matching version is 4.9.1.0)\n    ghc-8.2.2 from stack configuration does not match &gt;=7.6 &amp;&amp; &lt;8.2\nneeded since ghc-mod is a build target.\n\nIn the dependencies for haskell-src-exts-util-0.2.3:\n    haskell-src-exts-1.19.1 from stack configuration does not match &gt;=1.20.0  (latest matching version is 1.20.2)\nneeded due to ghc-mod-5.8.0.0 -&gt; haskell-src-exts-util-0.2.3\n\nIn the dependencies for hlint-2.0.15:\n    haskell-src-exts-1.19.1 from stack configuration does not match &gt;=1.20 &amp;&amp; &lt;1.21  (latest matching version is 1.20.2)\nneeded due to ghc-mod-5.8.0.0 -&gt; hlint-2.0.15\n\nSome different approaches to resolving this:\n\n  * Set 'allow-newer: true' to ignore all version constraints and build anyway.\n\n  * Consider trying 'stack solver', which uses the cabal-install solver to attempt to find some working build configuration. This can be convenient when dealing with many complicated constraint\n    errors, but results may be unpredictable.\n\n  * Recommended action: try adding the following to your extra-deps in /Users/mo/.stack/global-project/stack.yaml:\n\n- base-4.9.1.0\n- haskell-src-exts-1.20.2\n</code></pre>\n\n<p>if i put - haskell-src-exts-1.20.2 they ask me for - haskell-src-exts-1.19.1 back and vice versa I can't figure out what to do about this dependency conflict, and also I tried to run stack resolver but it doesn't get me anywhere </p>\n"}, {"tags": ["haskell", "yesod", "template-haskell"], "comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1529511448, "post_id": 50948308, "comment_id": 88903213, "body": "I assume you&#39;re importing <code>Text.Markdown</code> along with <code>Yesod.Text.Markdown</code>? The latter only defines an orphan instance, and as far as I can tell doesn&#39;t actually reexport the type."}, {"owner": {"reputation": 1381, "user_id": 1936416, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e7314f391870688f6808f07e859927ae?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/1936416/ben"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1529583922, "post_id": 50948308, "comment_id": 88933364, "body": "That was indeed an issue, however, after adding that, I get ` No instance for (blaze-markup-0.8.2.1:Text.Blaze.ToMarkup                          (Maybe Text.Markdown.Markdown))         arising from a use of \u2018toHtml\u2019` in my Handler. It seems like the conversion to HTML isn&#39;t going as smoothly as it should."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1529598523, "post_id": 50948308, "comment_id": 88943110, "body": "It doesn&#39;t look like <code>Maybe a</code> instantiates <code>ToMarkup</code>. Perhaps try <code>fmap toHtml</code>?"}], "owner": {"reputation": 1381, "user_id": 1936416, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e7314f391870688f6808f07e859927ae?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/1936416/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1529497764, "creation_date": 1529497764, "question_id": 50948308, "link": "https://stackoverflow.com/questions/50948308/how-to-use-a-custom-persistfield-in-templatehaskell-model-file", "title": "How to use a custom PersistField in TemplateHaskell model file?", "body": "<p>I have the following model in <code>config/models</code>:</p>\n\n<pre><code>Post json\n    title Text\n    intro Text\n    posted UTCTime default=now()\n    published Bool default=true\n    content Markdown Maybe\n    cvId CvItemId Maybe\n    projectId ProjectId Maybe\n</code></pre>\n\n<p>I have Yesod.Text.Markdown, which clearly defines a <a href=\"https://hackage.haskell.org/package/yesod-text-markdown-0.1.10/docs/Yesod-Text-Markdown.html#v:-36-fPersistFieldMarkdown\" rel=\"nofollow noreferrer\">PersistField</a> installed and imported in <code>src/Models.hs</code>. In this file, the models are generated using the following piece of code:</p>\n\n<pre><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"]\n    $(persistFileWith lowerCaseSettings \"config/models\")\n</code></pre>\n\n<p>On trying to build, I get the following error:</p>\n\n<pre><code>src/Model.hs:20:7: error:\n    \u2022 Not in scope: type constructor or class \u2018Markdown\u2019\n    \u2022 In the untyped splice:\n        $(persistFileWith lowerCaseSettings \"config/models\")\n   |\n20 |     $(persistFileWith lowerCaseSettings \"config/models\")\n   |\n</code></pre>\n\n<p>How do I make this work? I could probably make it work by avoiding TemplateHaskell, but I'd like to stick with this format, as it's much more elegant.</p>\n"}, {"tags": ["haskell", "show", "recursive-datastructures", "fixpoint-combinators"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "edited": false, "score": 0, "creation_date": 1529495752, "post_id": 50947092, "comment_id": 88892606, "body": "@user3368561 Yes, I think so."}, {"owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "edited": false, "score": 0, "creation_date": 1529509724, "post_id": 50947092, "comment_id": 88902152, "body": "It is possible to make it generic on the functor <code>f</code> given it provides a <code>Show</code> instance?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "edited": false, "score": 0, "creation_date": 1529513647, "post_id": 50947092, "comment_id": 88904457, "body": "@user3368561 I think it depends on the instance. As long as you can get an algebra as the one above you should be fine."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1529493833, "creation_date": 1529493833, "answer_id": 50947092, "question_id": 50946004, "link": "https://stackoverflow.com/questions/50946004/how-to-write-a-show-instance-for-mu-recursive-types/50947092#50947092", "title": "How to write a Show instance for Mu recursive types", "body": "<p>Define your own algebra first</p>\n\n<pre><code>showOneLayer :: Show a =&gt; ListF a String -&gt; String\nshowOneLayer ... = ...\n</code></pre>\n\n<p>Then,</p>\n\n<pre><code>instance Show a =&gt; Show (Mu (ListF a)) where\n   show (Mu f) = f showOneLayer\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 5, "last_activity_date": 1529680626, "last_edit_date": 1529680626, "creation_date": 1529505852, "answer_id": 50950944, "question_id": 50946004, "link": "https://stackoverflow.com/questions/50946004/how-to-write-a-show-instance-for-mu-recursive-types/50950944#50950944", "title": "How to write a Show instance for Mu recursive types", "body": "<p>The slogan, <em>\"Follow the types!\"</em>, works for us here, fulltime.</p>\n\n<p>From your code, with some renaming for easier comprehension,</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\ndata ListF a r = Nil | Cons a r deriving (Show)\nnewtype List a = Mu {runMu :: forall r. (ListF a r -&gt; r) -&gt; r}\n</code></pre>\n\n<p>So that we can have</p>\n\n<pre><code>fromList :: [a] -&gt; List a\nfromList (x:xs) = Mu $ \\g -&gt; g   -- g :: ListF a r -&gt; r\n                               (Cons x $                 -- just make all types fit\n                                  runMu (fromList xs) g)\nfromList []     = Mu $ \\g -&gt; g Nil\n\n{-   or, equationally,\nrunMu (fromList (x:xs)) g = g (Cons x $ runMu (fromList xs) g)\nrunMu (fromList [])     g = g Nil \n\n     such that (thanks, @dfeuer!)\nrunMu (fromList [1,2,3]) g = g (Cons 1 (g (Cons 2 (g (Cons 3 (g Nil))))))\n-}\n</code></pre>\n\n<p>and we want </p>\n\n<pre><code>instance (Show a) =&gt; Show (List a) where\n -- show :: List a -&gt; String\n show (Mu f) = \"(\" ++ f showListF ++ \")\"            -- again, just make the types fit\n</code></pre>\n\n<p>... we must produce a string; we can only <em>call</em> <code>f</code>; what could be its argument? According to its type,</p>\n\n<pre><code>  where\n  showListF :: Show a =&gt; ListF a String -&gt; String   -- so that, f showListF :: String !\n  showListF Nil        = ...\n  showListF (Cons x s) = ...\n</code></pre>\n\n<p>There doesn't seen to be any other way to connect the wires here.</p>\n\n<p>With this, <code>print $ fromList [1..5]</code> prints <code>(1 2 3 4 5 )</code>.</p>\n\n<p>Indeed this turned out to be a verbose version of <a href=\"https://stackoverflow.com/users/3234959/chi\">chi</a>'s <a href=\"https://stackoverflow.com/a/50947092/849891\">answer</a>.</p>\n\n<p><em>edit:</em> <code>g</code> is for \"algebra\" (thanks, @chi!) and <code>f</code> (in <code>Mu f</code>) is for \"folding\". Now the meaning of this type becomes clearer: given an \"algebra\" (a  reduction function), a <code>Mu f</code> value will use it in the folding of its \"inherent list\" represented by this \"folding function\". It represents the folding of a list with one-step reduction semantics, using it on <em>each</em> step of the folding. </p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1529623201, "post_id": 50958030, "comment_id": 88953172, "body": "this is nice. the <code>g</code>-juggling in your <code>fromList</code> was a bit of a mind bender, until I finally gave up and wrote down some sample expansion (for <code>[1,2,3]</code>) by hand. which actually clarified things for me. :) I could even simplify it a bit, as <code>fromList xs = List $ Mu $ \\g -&gt; foldr (g .: Cons) (g Nil) xs</code>. which also makes it lazier? (is this good?). and doing <code>Foldable</code> getting its <code>toList</code> for free is a great idea (I skipped over everything in the middle). :) seems obvious in retrospect, like all great ideas do."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1529635447, "post_id": 50958030, "comment_id": 88955619, "body": "@WillNess, what is lazier about that? Also, what is <code>.:</code>? My <code>fromList</code> is based directly on yours."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1529650382, "post_id": 50958030, "comment_id": 88959598, "body": "I thought <code>foldr ... _|_</code> would diverge but <code>\\g -&gt; foldr ... _|_</code> wouldn&#39;t. --- Yes after working through your version I realized it is the same as in my answer (I didn&#39;t try hard enough to expand it out, was content that the pieces fit... ). But after finally seeing that after series of applications we&#39;re left with this <code>g (Cons a (g (Cons b (g Nil))))</code> thing, I thought, why not just code it that way? --- re: <a href=\"https://hackage.haskell.org/package/composition-1.0.2.1/docs/Data-Composition.html#v:.:\" rel=\"nofollow noreferrer\"><code>.:</code></a> I thought it is part of common lore. :)"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1529635706, "last_edit_date": 1529635706, "creation_date": 1529534427, "answer_id": 50958030, "question_id": 50946004, "link": "https://stackoverflow.com/questions/50946004/how-to-write-a-show-instance-for-mu-recursive-types/50958030#50958030", "title": "How to write a Show instance for Mu recursive types", "body": "<p>As WillNess showed, you probably want a <code>newtype</code> to wrap your <code>List</code>:</p>\n\n<pre><code>newtype Mu f = Mu {reduce :: forall a. (f a -&gt; a) -&gt; a}\n-- I've added a field name for convenience.\n\ndata ListF a r = Nil | Cons a r\n  deriving (Show, Functor, Foldable, Traversable)\n  -- You'll probably want these other instances at some point.\n\nnewtype List a = List {unList :: Mu (ListF a)}\n</code></pre>\n\n<p>WillNess also wrote a useful <code>fromList</code> function; here's another version:</p>\n\n<pre><code>fromList :: Foldable f =&gt; f a -&gt; List a\nfromList xs =\n  List $ Mu $ foldr (\\a as g -&gt; g (Cons a (as g))) ($ Nil) xs\n</code></pre>\n\n<p>Now let's write a basic (not quite right) version. I'll turn on <code>ScopedTypeVariables</code> to add type signatures without annoying duplication.</p>\n\n<pre><code>instance Show a =&gt; Show (List a) where\n  showsPrec _ xs = reduce (unList xs) go\n    where\n      go :: ListF a ShowS -&gt; ShowS\n      go Nil = id\n      go (Cons x r) = (',':) . showsPrec 0 x . r\n</code></pre>\n\n<p>This will show a list, sort of:</p>\n\n<pre><code>show (fromList []) = \"\"\nshow (fromList [1]) = \",1\"\nshow (fromList [1,2]) = \",1,2\"\n</code></pre>\n\n<p>Hrm. We need to install the leading <code>[</code> and the trailing <code>]</code>, and somehow deal with the extra leading comma. One good way to do that is to keep track of whether we're on the first list element:</p>\n\n<pre><code>instance Show a =&gt; Show (List a) where\n  showsPrec _ (List xs) = ('[':) . reduce xs go False . (']':)\n    where\n      go :: ListF a (Bool -&gt; [Char] -&gt; [Char]) -&gt; Bool -&gt; [Char] -&gt; [Char]\n      go Nil _ = id\n      go (Cons x r) started =\n        (if started then (',':) else id)\n        . showsPrec 0 x\n        . r True\n</code></pre>\n\n<p>Now we actually show things properly!</p>\n\n<p>But actually, we've gone to quite a bit more trouble than necessary. All we really needed was a <code>Foldable</code> instance:</p>\n\n<pre><code>instance Foldable List where\n  foldr c n (List (Mu g)) = g $ \\case\n    Nil -&gt; n\n    Cons a as -&gt; c a as\n</code></pre>\n\n<p>Then we can write</p>\n\n<pre><code>instance Show a =&gt; Show (List a) where\n  showsPrec p xs = showsPrec p (toList xs)\n</code></pre>\n"}], "owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 50950944, "answer_count": 3, "score": 0, "last_activity_date": 1563169733, "creation_date": 1529490431, "last_edit_date": 1563169733, "question_id": 50946004, "link": "https://stackoverflow.com/questions/50946004/how-to-write-a-show-instance-for-mu-recursive-types", "title": "How to write a Show instance for Mu recursive types", "body": "<p>I want to write an instance of <code>Show</code> for lists of the following type:</p>\n\n<pre><code>newtype Mu f = Mu (forall a. (f a -&gt; a) -&gt; a)\ndata ListF a r = Nil | Cons a r deriving (Show)\ntype List a = Mu (ListF a)\n</code></pre>\n\n<p>Module <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.0.2/docs/Data-Functor-Foldable.html\" rel=\"nofollow noreferrer\">Data.Functor.Foldable</a> defines it, but it converting it to <code>Fix</code>, something I want to avoid.</p>\n\n<p>How can I define this <code>Show</code> instance?</p>\n"}, {"tags": ["haskell", "recursion", "grammar", "algebraic-data-types", "recursive-datastructures"], "comments": [{"owner": {"reputation": 705, "user_id": 2648019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wBjZ5.jpg?s=128&g=1", "display_name": "Daiwen", "link": "https://stackoverflow.com/users/2648019/daiwen"}, "edited": false, "score": 0, "creation_date": 1529485570, "post_id": 50944194, "comment_id": 88886022, "body": "You could try to input the type definition and the different values in <code>ghci</code> to figure it out by yourself"}, {"owner": {"reputation": 15, "user_id": 9158464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549bc7bfbaf4b8d96cecbb588a506ab3?s=128&d=identicon&r=PG", "display_name": "user9158464", "link": "https://stackoverflow.com/users/9158464/user9158464"}, "reply_to_user": {"reputation": 705, "user_id": 2648019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wBjZ5.jpg?s=128&g=1", "display_name": "Daiwen", "link": "https://stackoverflow.com/users/2648019/daiwen"}, "edited": false, "score": 0, "creation_date": 1529485766, "post_id": 50944194, "comment_id": 88886132, "body": "I use hugs but i can not identify"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 9158464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549bc7bfbaf4b8d96cecbb588a506ab3?s=128&d=identicon&r=PG", "display_name": "user9158464", "link": "https://stackoverflow.com/users/9158464/user9158464"}, "edited": false, "score": 0, "creation_date": 1529486183, "post_id": 50944453, "comment_id": 88886408, "body": "Thank you so much \u263a"}], "tags": [], "owner": {"reputation": 705, "user_id": 2648019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wBjZ5.jpg?s=128&g=1", "display_name": "Daiwen", "link": "https://stackoverflow.com/users/2648019/daiwen"}, "is_accepted": true, "score": 1, "last_activity_date": 1529485858, "creation_date": 1529485858, "answer_id": 50944453, "question_id": 50944194, "link": "https://stackoverflow.com/questions/50944194/haskell-data-types/50944453#50944453", "title": "Haskell Data Types", "body": "<p>By using <code>ghci</code> and simply inputing the code snippets you will see which of the values are accepted:</p>\n\n<pre><code>Prelude&gt; data Bin = B Bin | C [ Int]\nPrelude&gt; a = C [ ]\nPrelude&gt; b = B ( B C [ 2])\n\n&lt;interactive&gt;:3:9: error:\n    \u2022 Couldn't match expected type \u2018[Integer] -&gt; Bin\u2019\n                  with actual type \u2018Bin\u2019\n    \u2022 The function \u2018B\u2019 is applied to two arguments,\n      but its type \u2018Bin -&gt; Bin\u2019 has only one\n      In the first argument of \u2018B\u2019, namely \u2018(B C [2])\u2019\n      In the expression: B (B C [2])\n\n&lt;interactive&gt;:3:11: error:\n    \u2022 Couldn't match expected type \u2018Bin\u2019\n                  with actual type \u2018[Int] -&gt; Bin\u2019\n    \u2022 Probable cause: \u2018C\u2019 is applied to too few arguments\n      In the first argument of \u2018B\u2019, namely \u2018C\u2019\n      In the first argument of \u2018B\u2019, namely \u2018(B C [2])\u2019\n      In the expression: B (B C [2])\nPrelude&gt; c = B ( C [ 1..5])\nPrelude&gt; d = B (B (B (C[2,3])))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 15, "user_id": 9158464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549bc7bfbaf4b8d96cecbb588a506ab3?s=128&d=identicon&r=PG", "display_name": "user9158464", "link": "https://stackoverflow.com/users/9158464/user9158464"}, "edited": false, "score": 0, "creation_date": 1529512801, "post_id": 50952046, "comment_id": 88903985, "body": "Thank you so much \u263a"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 15, "user_id": 9158464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549bc7bfbaf4b8d96cecbb588a506ab3?s=128&d=identicon&r=PG", "display_name": "user9158464", "link": "https://stackoverflow.com/users/9158464/user9158464"}, "edited": false, "score": 0, "creation_date": 1529549206, "post_id": 50952046, "comment_id": 88916370, "body": "you&#39;re welcome. so, which is which? can you tell? which clause in the data type definition is recursive, and which isn&#39;t?"}, {"owner": {"reputation": 15, "user_id": 9158464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549bc7bfbaf4b8d96cecbb588a506ab3?s=128&d=identicon&r=PG", "display_name": "user9158464", "link": "https://stackoverflow.com/users/9158464/user9158464"}, "edited": false, "score": 0, "creation_date": 1529555559, "post_id": 50952046, "comment_id": 88917661, "body": "Recursive definitiom"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 15, "user_id": 9158464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549bc7bfbaf4b8d96cecbb588a506ab3?s=128&d=identicon&r=PG", "display_name": "user9158464", "link": "https://stackoverflow.com/users/9158464/user9158464"}, "edited": false, "score": 0, "creation_date": 1529564470, "post_id": 50952046, "comment_id": 88921223, "body": "yes but it has two clauses in it - one for B, the other for C. which of them is recursive, and which is base case?"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1529580544, "last_edit_date": 1529580544, "creation_date": 1529508995, "answer_id": 50952046, "question_id": 50944194, "link": "https://stackoverflow.com/questions/50944194/haskell-data-types/50952046#50952046", "title": "Haskell Data Types", "body": "<p>To easily answer such questions yourself, you need to comfortably understand Haskell's algebraic data type definitions:</p>\n\n<pre><code>  -- v  a type being defined\ndata Bin = \n           B  Bin \n        -- ^  ^ the type of the argument to the data constructor `B`\n        -- ^ the name of the data constructor function `B`:  B :: Bin -&gt; Bin\n        --          (read: B is of type Bin -&gt; Bin, i.e. a function\n        --                 taking a Bin type value and producing a Bin type value)\n         | C  [Int]\n        -- ^  ^ the type of the argument to the data constructor `C`\n        -- ^ the name of the data constructor function `C`:  C :: [Int] -&gt; Bin\n        --          (read: C is of type [Int] -&gt; Bin, i.e. a function\n        --                 taking a list of Int values and producing a Bin type value)\n</code></pre>\n\n<p>This means, we can create a piece of data of type <code>Bin</code> by using either one of two ways: </p>\n\n<ul>\n<li>First, we can call a function named <code>B</code> with one argument, a value of type <code>Bin</code>.</li>\n<li>Second, we can call a function named <code>C</code> with one argument, a value of type <code>[Int]</code>, a list of ints.</li>\n</ul>\n\n<p>The second way is simple and clear: just use any list of ints, like <code>C [1]</code> or <code>C [4,3,2]</code></p>\n\n<pre><code>x1 :: Bin        -- read: `x1` is of type `Bin`\nx1 = C [1]       -- or,\n</code></pre>\n\n<p>But what about the first? We need to use a value of type <code>Bin</code> as the argument:</p>\n\n<pre><code>x1 = B x2\n</code></pre>\n\n<p>but where can we get <code>x2</code>? We are creating a <code>Bin</code>, and it wants us to give it a <code>Bin</code>? Is this a vicious circle?</p>\n\n<p>No! For we have the second way of creating a <code>Bin</code> value:</p>\n\n<pre><code>x2 = C [2]    -- x1 = B (C [2])\n</code></pre>\n\n<p>But we could well use the first one here as well:</p>\n\n<pre><code>x2 = B x3     -- x1 = B (B x3)\n</code></pre>\n\n<p>and what about <code>x3</code>? By the same token,</p>\n\n<pre><code>x3 = C [3]    -- x1 = B (B (C [3]))   -- or,\nx3 = B x4     -- x1 = B (B (B x4))\n</code></pre>\n\n<p>and</p>\n\n<pre><code>x4 = C [4]    -- x1 = B (B (B (C [4])))   -- or,\nx4 = B x5     -- x1 = B (B (B (B x5)))\n</code></pre>\n\n<p>See? A valid value of the type <code>Bin</code> consists of a nested chain of <code>B</code> constructors, carrying a <code>C [...]</code>  inside, at the very bottom of the chain. Right? The data type definition serves as the grammar for producing valid terms of the type.</p>\n\n<p>Now it is easy to answer your questions:</p>\n\n<ul>\n<li><p><code>C [ ]</code> :   <em>- is this a chain of nested <code>B</code>'s with <code>C</code> at the bottom? :</em> __</p></li>\n<li><p><code>B (B C [2])</code> :  <em>- is this a chain of nested <code>B</code>'s with <code>C</code> at the bottom? :</em> __</p></li>\n<li><p><code>B (C [1..5])</code> :  <em>- is this a chain of nested <code>B</code>'s with <code>C</code> at the bottom? :</em> __</p></li>\n<li><p><code>B (B (B (C [2,3])))</code> :  <em>- is this a chain of nested <code>B</code>'s with <code>C</code> at the bottom? :</em> __</p></li>\n</ul>\n\n<p>This repeated application of the same rule is known as <em>recursion</em>, and this data type <code>Bin</code> is thus a <em>recursive</em> data type, with two clauses in its definition:  recursive clause, and the base clause.</p>\n\n<p>Which is which? </p>\n"}], "owner": {"reputation": 15, "user_id": 9158464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549bc7bfbaf4b8d96cecbb588a506ab3?s=128&d=identicon&r=PG", "display_name": "user9158464", "link": "https://stackoverflow.com/users/9158464/user9158464"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 50944453, "answer_count": 2, "score": -7, "last_activity_date": 1529580544, "creation_date": 1529485059, "last_edit_date": 1529509109, "question_id": 50944194, "link": "https://stackoverflow.com/questions/50944194/haskell-data-types", "title": "Haskell Data Types", "body": "<p>Which is not value of the Bin data types as defined below?</p>\n\n<pre><code>data Bin = B Bin | C [ Int]\n</code></pre>\n\n<p>a) <code>C [ ]</code></p>\n\n<p>b) <code>B ( B C [ 2])</code></p>\n\n<p>c) <code>B ( C [ 1..5])</code></p>\n\n<p>d) <code>B (B (B (C[2,3])))</code></p>\n"}, {"tags": ["sql", "haskell", "yesod", "persistent", "hamlet"], "answers": [{"comments": [{"owner": {"reputation": 1381, "user_id": 1936416, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e7314f391870688f6808f07e859927ae?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/1936416/ben"}, "edited": false, "score": 0, "creation_date": 1529497889, "post_id": 50948289, "comment_id": 88894131, "body": "This works, thanks! Isn&#39;t there a more elegant way though, like how you&#39;d define it in Django (with a related_name that you can use directly in your template)?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 1381, "user_id": 1936416, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e7314f391870688f6808f07e859927ae?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/1936416/ben"}, "edited": false, "score": 0, "creation_date": 1529498002, "post_id": 50948289, "comment_id": 88894195, "body": "What&#39;s unelegant there? A query should define what you fetch from the database. From my POV, that <code>related_name</code> thing of Django blurs the border between business logic and persistence layer. But maybe I just missing something, have 0 experience with Django."}, {"owner": {"reputation": 1381, "user_id": 1936416, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e7314f391870688f6808f07e859927ae?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/1936416/ben"}, "edited": false, "score": 0, "creation_date": 1529498910, "post_id": 50948289, "comment_id": 88894786, "body": "Convenient may have been a better term. In a sense, you&#39;re most certainly right, though this is such a common pattern that it&#39;s slightly cumbersome to explicitly write a query every time you need to do it."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 2, "last_activity_date": 1529497903, "last_edit_date": 1529497903, "creation_date": 1529497714, "answer_id": 50948289, "question_id": 50944126, "link": "https://stackoverflow.com/questions/50944126/how-to-get-related-fields-foreign-key-in-yesod/50948289#50948289", "title": "How to get related fields (foreign key) in Yesod?", "body": "<p>Change your query, something like</p>\n\n<pre><code>do\n  cvcategories &lt;- selectList [] [] --all cv categories\n  forM cvcategories $ \\cat -&gt; do -- for each category\n    cvitems &lt;- selectList [CvCategoryId .== entityKey cat] -- all items belonging to it\n    return (cat, cvitems) -- return tuple of category and its items\n</code></pre>\n\n<p>And then your Hamlet would look like</p>\n\n<pre><code>&lt;ul&gt;\n$forall (cvcategory, cvitems) &lt;- cvcategories\n    &lt;li&gt;$#{cvCategoryTitle cvcategory}\n         $forall cvitem &lt;- items\n         &lt;li&gt;#{cvItemTitle cvitem}\n</code></pre>\n"}], "owner": {"reputation": 1381, "user_id": 1936416, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e7314f391870688f6808f07e859927ae?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/1936416/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 50948289, "answer_count": 1, "score": 1, "last_activity_date": 1529497903, "creation_date": 1529484868, "last_edit_date": 1529497333, "question_id": 50944126, "link": "https://stackoverflow.com/questions/50944126/how-to-get-related-fields-foreign-key-in-yesod", "title": "How to get related fields (foreign key) in Yesod?", "body": "<p>I've defined the following models in  Yesod application:</p>\n\n<pre><code>CvCategory\n    title Text\n    order Int\n    UniqueCvCategory title\n\nCvItem\n    category CvCategoryId\n    title Text\n    fromYear Int\n    toYear Int Maybe\n    description Text Maybe\n    UniqueCvItem title\n</code></pre>\n\n<p>I have the following query in a handler:</p>\n\n<pre><code>cvcategories &lt;- selectList [] [] --all cv categories\n</code></pre>\n\n<p>In my hamlet template, I'd like to do something like:</p>\n\n<pre><code>&lt;ul&gt;\n$forall cvcategory &lt;- cvcategories\n    &lt;li&gt;$#{cvCategoryTitle cvcategory}\n         $forall cvitem &lt;- cvcategory --how?\n         &lt;li&gt;#{cvItemTitle cvitem}\n</code></pre>\n\n<p>In Django, you can easily define a <code>related_name</code>, and then use this to easily access all 'child objects'. Is this possible in Yesod too? How?</p>\n"}, {"tags": ["haskell", "theory"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1529490268, "post_id": 50944016, "comment_id": 88889128, "body": "N.B. functions are values in Haskell."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1529498329, "creation_date": 1529498329, "answer_id": 50948493, "question_id": 50944016, "link": "https://stackoverflow.com/questions/50944016/haskell-bindable-entities/50948493#50948493", "title": "Haskell Bindable entities?", "body": "<p>Haskell has three namespaces, one each for runtime computations, types, and modules.</p>\n\n<p>Any term representing a runtime computation may be named in the computation namespace. <code>data</code> and <code>newtype</code> declarations create new names in the computation namespace for constructing values of their new type and, if record syntax is used, for selecting fields from the new type. <code>class</code> declarations create new names in the computation namespace for their methods.</p>\n\n<p>Any monomorphic type may be named in the type namespace with a <code>type</code> declaration (see comments below for my predictions on confusing subtleties in this statement). <code>data</code> and <code>newtype</code> declarations create new names in the type namespace for constructing the type they declare. <code>class</code> declarations create new names in the type namespace for the constraint they create.</p>\n\n<p><code>module</code> declarations create new names in the module namespace.</p>\n\n<p>GHC extends Haskell, adding a variety of new ways to bind names (almost all in the type namespace); a comprehensive list is probably too large for this format but <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/\" rel=\"nofollow noreferrer\">the manual</a> is excellent and covers them all.</p>\n\n<p>Now, to the subtleties of <code>type</code>. One confusion that I predict will arise is this: I say only monomorphic types may be named. But one may object that I can certainly write, e.g.</p>\n\n<pre><code>type TypeOfIdMono a = a -&gt; a\nid :: TypeOfIdMono a\n</code></pre>\n\n<p>and that looks like it has named a polymorphic type. I claim that Haskell's penchant for making <code>forall</code>s implicit has instead confused the issue, and that <code>TypeOfId a</code> is in fact monomorphic. With explicit foralls, this has been written:</p>\n\n<pre><code>type TypeOfIdMono a = a -&gt; a\nid :: forall a. TypeOfIdMono a\n</code></pre>\n\n<p>That is: we have not actually named <code>id</code>'s type here, but rather the type of a monomorphic function which only operates on <code>a</code>s. <code>id</code> says additionally that the caller gets to choose <code>a</code> -- that is, that the function is polymorphic. Compare this declaration, which is not allowed in standard Haskell (though is available via GHC extensions, as alluded to above):</p>\n\n<pre><code>type TypeOfIdPoly = forall a. a -&gt; a\nid :: TypeOfIdPoly\n</code></pre>\n\n<p>Here we really have named a polymorphic type.</p>\n\n<p>In short: one can and should distinguish between three orthogonal concepts: \"parameterized types\" (e.g. <code>TypeOfIdMono</code> which expects an additional argument), types which mention a type variable (e.g. <code>TypeOfIdMono a</code>), and polymorphic types (e.g. <code>TypeOfIdPoly</code>) which necessarily have a <code>forall</code>.</p>\n"}], "owner": {"reputation": 21, "user_id": 9966379, "user_type": "registered", "profile_image": "https://graph.facebook.com/1899137053469715/picture?type=large", "display_name": "Jo&#227;o Vin&#237;cius", "link": "https://stackoverflow.com/users/9966379/jo%c3%a3o-vin%c3%adcius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 50948493, "answer_count": 1, "score": 1, "last_activity_date": 1529498329, "creation_date": 1529484524, "last_edit_date": 1529484768, "question_id": 50944016, "link": "https://stackoverflow.com/questions/50944016/haskell-bindable-entities", "title": "Haskell Bindable entities?", "body": "<p>I saw that, in the book, Programming Language Design Concepts by John Wiley, 2004, there is a definition for bindables:</p>\n\n<blockquote>\n  <p>\"A bindable entity is one that may be bound to an identifier.\n  Programming languages vary in the kinds of entity that are bindable:</p>\n  \n  <p>\u2022 C\u2019s bindable entities are types, variables, and function procedures.</p>\n  \n  <p>\u2022 JAVA\u2019s bindable entities are values, local variables, instance and\n  class variables, methods, classes, and packages.</p>\n  \n  <p>\u2022 ADA\u2019s bindable entities include types, values, variables,\n  procedures, exceptions, packages, and tasks.\"</p>\n</blockquote>\n\n<p>I'm curious, which bindable entities are in Haskell?</p>\n"}, {"tags": ["haskell", "operator-precedence", "syntactic-sugar", "cons"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 5, "creation_date": 1529473241, "post_id": 50940686, "comment_id": 88879647, "body": "<code>(:)</code> <b>must</b> be right-associative because if <code>1:2:[]</code> was parsed as <code>(1:2):[]</code> it would create a type error."}], "answers": [{"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 6, "last_activity_date": 1529472250, "creation_date": 1529472250, "answer_id": 50940791, "question_id": 50940686, "link": "https://stackoverflow.com/questions/50940686/is-the-cons-operation-cons-elements-from-right-to-left/50940791#50940791", "title": "Is the cons operation cons elements from right to left?", "body": "<p>Error message could be better. But <code>1 : 2</code> won't create list. You need:</p>\n\n<pre><code>1 : [2]\n</code></pre>\n\n<p>And <code>[2]</code> is a syntax sugar for <code>2:[]</code>. </p>\n\n<p>So now you could deduce that <code>1:2:[]</code> is expanded into <code>1 : (2 : [])</code>. You can also discover this behavior by using <code>:info</code> command in <code>ghci</code>:</p>\n\n<pre><code>Prelude&gt; :info (:)\ndata [] a = ... | a : [a]   -- Defined in \u2018GHC.Types\u2019\ninfixr 5 :\n</code></pre>\n\n<p>It says that <code>(:)</code> operator is right associative.</p>\n\n<p>Also, there exist <code>TemplateHaskell</code> trick which allows you to see how parenthesis will be specified in resulting expression:</p>\n\n<pre><code>$ ghci -ddump-splices -XTemplateHaskell\nPrelude&gt; $([| 1:2:[] |])  -- put expression with bunch of operators here\n&lt;interactive&gt;:1:3-14: Splicing expression\n    [| 1 : 2 : [] |] ======&gt; (1 GHC.Types.: (2 GHC.Types.: []))\n[1,2]\n</code></pre>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 50940791, "answer_count": 1, "score": 3, "last_activity_date": 1529472250, "creation_date": 1529471804, "last_edit_date": 1529472213, "question_id": 50940686, "link": "https://stackoverflow.com/questions/50940686/is-the-cons-operation-cons-elements-from-right-to-left", "title": "Is the cons operation cons elements from right to left?", "body": "<p>We know <code>1:2:[]</code> will returns <code>[1,2]</code>.</p>\n\n<p>I just tried <code>1:2</code>, this gives me an error.</p>\n\n<pre><code>&lt;interactive&gt;:48:1: error:\n    ? Non type-variable argument in the constraint: Num [a]\n      (Use FlexibleContexts to permit this)\n    ? When checking the inferred type\n        it :: forall a. (Num a, Num [a]) =&gt; [a]\n</code></pre>\n\n<p>I know this may be not a proper example since the <code>:</code> operation cons an element and a list. But I'm just wondering how it works in <code>1:2:[]</code></p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 0, "creation_date": 1529471107, "post_id": 50939658, "comment_id": 88878852, "body": "Edited above.  <code>stack install random</code> yields no response.  <code>stack ghci --package random</code> runs the program though."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 4, "last_activity_date": 1529464534, "creation_date": 1529464534, "answer_id": 50939658, "question_id": 50939333, "link": "https://stackoverflow.com/questions/50939333/trying-to-install-system-random-on-stack/50939658#50939658", "title": "Trying to install System.Random on stack", "body": "<p>Probably the most straightforward command is <code>stack ghci --package random</code>. But in theory <code>stack install random</code> should have worked as well. However, since you haven't included the output from that call, it's not clear what didn't work with it.</p>\n"}, {"comments": [{"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 0, "creation_date": 1529481747, "post_id": 50941722, "comment_id": 88883833, "body": "That works, my *.cabal looks like: `   build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5                      , random `"}], "tags": [], "owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "is_accepted": true, "score": 4, "last_activity_date": 1529476544, "creation_date": 1529476544, "answer_id": 50941722, "question_id": 50939333, "link": "https://stackoverflow.com/questions/50939333/trying-to-install-system-random-on-stack/50941722#50941722", "title": "Trying to install System.Random on stack", "body": "<p>You probably need to add <code>random</code> to the dependencies section in your <code>package.yaml</code> (or if you are not using hpack, to <code>build-depends</code> in <code>*.cabal</code>).  This tells stack that the package depends on the random package, which contains the <code>System.Random</code> module.</p>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2078, "favorite_count": 0, "accepted_answer_id": 50941722, "answer_count": 2, "score": 1, "last_activity_date": 1529476544, "creation_date": 1529461623, "last_edit_date": 1529465678, "question_id": 50939333, "link": "https://stackoverflow.com/questions/50939333/trying-to-install-system-random-on-stack", "title": "Trying to install System.Random on stack", "body": "<p>I'm using stack 1.6.1.  In <code>src/Main.hs</code> I start with</p>\n\n<pre><code>module Main where\n\nimport System.IO\nimport System.Random\n...\n</code></pre>\n\n<p>I do not use anything from System.Random at this time.</p>\n\n<p>When I run <code>stack ghci</code> I get</p>\n\n<pre><code>/Users/mkaravan/end2end/Music/music/src/Main.hs:4:1: error:\n    Could not find module \u2018System.Random\u2019\n    Use -v to see a list of the files searched for.\n  |\n4 | import System.Random\n  | ^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I've had no luck with any of the following commands:</p>\n\n<pre><code>stack install System.Random\nstack install system.random\nstack install random\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>&gt;&gt;&gt; stack install System.Random\nError parsing targets: Directory not found: System.Random\n</code></pre>\n\n<p>How do I get System.Random to run in Stack?</p>\n"}, {"tags": ["haskell", "cabal", "cabal-sandbox"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1529480999, "post_id": 50939023, "comment_id": 88883368, "body": "<code>base</code> package is a part of the compiler, so you&#39;d need to downgrade GHC itself. Or bump the required <code>base</code> version in <code>decafc</code> .cabal file."}, {"owner": {"reputation": 317, "user_id": 7370105, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/28a1d625330e0446be0e39e901f8b5b1?s=128&d=identicon&r=PG&f=1", "display_name": "handora", "link": "https://stackoverflow.com/users/7370105/handora"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1529482204, "post_id": 50939023, "comment_id": 88884095, "body": "Is there a solution for <code>cabal sandbox</code> to install a new <code>ghc</code> locally just like what <code>stack</code> do?"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1529903907, "post_id": 50939023, "comment_id": 89025814, "body": "No. If you want to install a new ghc, you just install a new ghc."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 2, "last_activity_date": 1529904102, "creation_date": 1529904102, "answer_id": 51016725, "question_id": 50939023, "link": "https://stackoverflow.com/questions/50939023/dependency-conflicts-of-base-in-haskell-cabal/51016725#51016725", "title": "Dependency conflicts of base in Haskell cabal", "body": "<p>The <code>base</code> dependency indicates that it only works with versions between 4.5 and 4.9. That means the latest GHC you can use this package with is 8.0.1, since <code>base</code> ships with GHC and can't be upgraded. You could bump the dependency yourself, but you would likely have to fix things that don't work anymore due to changes in <code>base</code>, or you could install an older version of GHC.</p>\n"}], "owner": {"reputation": 317, "user_id": 7370105, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/28a1d625330e0446be0e39e901f8b5b1?s=128&d=identicon&r=PG&f=1", "display_name": "handora", "link": "https://stackoverflow.com/users/7370105/handora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1176, "favorite_count": 0, "accepted_answer_id": 51016725, "answer_count": 1, "score": 0, "last_activity_date": 1529904102, "creation_date": 1529458732, "question_id": 50939023, "link": "https://stackoverflow.com/questions/50939023/dependency-conflicts-of-base-in-haskell-cabal", "title": "Dependency conflicts of base in Haskell cabal", "body": "<p>There comes up with a problem that cabal's <code>base</code> is conflicted with the dependency in <code>.cabal</code> file, it seems that my <code>base</code> version is too high, so is there a way to downgrade my <code>base</code> package version in the <code>cabal sandbox</code>.</p>\n\n<pre><code>Resolving dependencies...\ncabal: Could not resolve dependencies:\n[__0] trying: decafc-0.0.0 (user goal)\n[__1] next goal: base (dependency of decafc)\n[__1] rejecting: base-4.11.1.0/installed-4.1... (conflict: decafc =&gt; base&gt;=4.5\n&amp;&amp; &lt;=4.9)\n[__1] rejecting: base-4.11.1.0, base-4.11.0.0, base-4.10.1.0, base-4.10.0.0,\nbase-4.9.1.0, base-4.9.0.0, base-4.8.2.0, base-4.8.1.0, base-4.8.0.0,\nbase-4.7.0.2, base-4.7.0.1, base-4.7.0.0, base-4.6.0.1, base-4.6.0.0,\nbase-4.5.1.0, base-4.5.0.0, base-4.4.1.0, base-4.4.0.0, base-4.3.1.0,\nbase-4.3.0.0, base-4.2.0.2, base-4.2.0.1, base-4.2.0.0, base-4.1.0.0,\nbase-4.0.0.0, base-3.0.3.2, base-3.0.3.1 (constraint from non-upgradeable\npackage requires installed instance)\n[__1] fail (backjumping, conflict set: base, decafc)\nAfter searching the rest of the dependency tree exhaustively, these were the\ngoals I've had most trouble fulfilling: base, decafc\nNote: when using a sandbox, all packages are required to have consistent\ndependencies. Try reinstalling/unrstering the offending packages or\nrecreating the sandbox.\n</code></pre>\n\n<p>There is another problem that when using <code>stack</code>, how to add some flags to the <code>alex</code> if running <code>stack build</code>, for example, the cabal instruction is <code>cabal install --alex-options=\"--ghc --template=\\\"$TOP/alex\\\"\"</code>. So how to let the <code>stack</code> do the same things?</p>\n"}, {"tags": ["haskell", "binary-tree", "fold"], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 9687774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1e9084b3411f7c99c8d77d6c77ac246?s=128&d=identicon&r=PG&f=1", "display_name": "IPodFan", "link": "https://stackoverflow.com/users/9687774/ipodfan"}, "edited": false, "score": 1, "creation_date": 1529438880, "post_id": 50936082, "comment_id": 88870944, "body": "Thank you! It works perfectly + I understand how it works! :) Thank you"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1529438452, "creation_date": 1529438452, "answer_id": 50936082, "question_id": 50935919, "link": "https://stackoverflow.com/questions/50935919/find-all-leafes-of-a-binary-searchtree-by-folding/50936082#50936082", "title": "Find all leafes of a binary searchtree by folding", "body": "<p>Well typically the idea of a using a <code>fold</code> function is that it does <em>all</em> the work for you. So by writing a function that branches into an <code>Empty</code> case and a <code>tree</code> case, this is already a bit strange.</p>\n\n<h1>A <em>recursive</em> approach</h1>\n\n<p>But let us simply start with a recursive approach. Forget about folding, etc. for now. How would we generate a list of leaves in general?</p>\n\n<p>Well there are basically three cases here:</p>\n\n<ol>\n<li><p>in case we encounter an <code>Empty</code>, then we return the empty list, since <code>Empty</code> is <em>not</em> a leaf, and we are supposed to return all leaves, so:</p>\n\n<pre><code>leaves Empty = []\n</code></pre></li>\n<li><p>in case we encounter a <code>Tree</code> with <code>Empty</code> both as left and right subtree, we know that that <code>Tree</code> is a leaf, so we return the element it carries, as a list:</p>\n\n<pre><code>leaves (Tree Empty x Empty) = [x]\n</code></pre></li>\n<li><p>in case one of the two subtrees (or both) are not <code>Empty</code>, we recursively would call the <code>leaves</code> function, and concatenate the two together:</p>\n\n<pre><code>leaves (Tree l _ r) = leaves l ++ leaves r\n</code></pre></li>\n</ol>\n\n<p>So now in full we got:</p>\n\n<pre><code>leaves :: Bintree a -&gt; [a]\nleaves Empty = []\nleaves (Tree Empty x Empty) = [x]\nleaves (Tree l x r) = leaves l ++ leaves r\n</code></pre>\n\n<h1>How to detect through recursion that this <em>is</em> a leaf</h1>\n\n<p>We of course can not do that with the <code>binTreeFold</code> approach. But can't we detect whether a tree is in fact a leaf? In case the two recursive calls <em>both</em> result in an empty list, we know that the current <code>Bintree</code> is in fact a leaf. Indeed: if the left (and right) subtree are <code>Empty</code>, they result in empty lists. And in case these are not empty, then these either are leaves, that will recursively produce a singleton list, or those are not <code>Tree</code>s with descendants, that will eventually lead to leaves, and therefore to non-empty lists.</p>\n\n<h1>Encoding this in the <em>fold</em> function</h1>\n\n<p>So we an first take a look at the recursive calls, and then based on the fact whether these are <em>both</em> empty lists, either return a singleton list with the leaf element, or concatenate the two lists together, like:</p>\n\n<pre><code>f [] x [] = [x]\nf l _ r = l ++ r\n</code></pre>\n\n<p>Or using this in the <code>binTreeFold</code> function:</p>\n\n<pre><code>leavesWithFold :: Bintree a -&gt; [a]\nleavesWithFold = binTreeFold f []\n    where f [] x [] = [x]\n          f l _ r = l ++ r\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 9687774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1e9084b3411f7c99c8d77d6c77ac246?s=128&d=identicon&r=PG&f=1", "display_name": "IPodFan", "link": "https://stackoverflow.com/users/9687774/ipodfan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 50936082, "answer_count": 1, "score": 1, "last_activity_date": 1529438452, "creation_date": 1529437779, "question_id": 50935919, "link": "https://stackoverflow.com/questions/50935919/find-all-leafes-of-a-binary-searchtree-by-folding", "title": "Find all leafes of a binary searchtree by folding", "body": "<p>I got the task of getting all leafs from a binary tree of this datatype:</p>\n\n<pre><code>data Bintree el = Empty |\n                  Tree {left :: Bintree el, node :: el, right :: Bintree el} deriving Show\n</code></pre>\n\n<p>Now I have this Treefold function which works perfectly in tests:</p>\n\n<pre><code>binTreeFold :: (a -&gt; b -&gt; a -&gt; a) -&gt; a -&gt; Bintree b -&gt; a\nbinTreeFold f el Empty = el \nbinTreeFold f el tree@(Tree leftTree node rightTree) = f (binTreeFold f el leftTree) node (binTreeFold f el rightTree)\n</code></pre>\n\n<p>And I try to get all leafs but somehow it simply doesnt work (Compile issues mentioned below):</p>\n\n<pre><code>leavesWithFold :: Bintree a -&gt; [a]\nleavesWithFold Empty = []\nleavesWithFold tree =  binTreeFold (\\left -&gt; \\node -&gt; \\right -&gt; if (checkIfTreeIsLeaf node) then left ++ [node] ++ right else left ++ [] ++ right) [] tree\n</code></pre>\n\n<p>using the following function:</p>\n\n<pre><code>checkIfTreeIsLeaf :: Bintree a -&gt; Bool\ncheckIfTreeIsLeaf Empty = False\ncheckIfTreeIsLeaf (Tree Empty node Empty) = True\ncheckIfTreeIsLeaf _ = False\n</code></pre>\n\n<p>The compiler tells me </p>\n\n<pre><code>Couldn't match type `a' with `Bintree a0'\n</code></pre>\n\n<p>But in former functions the use of </p>\n\n<pre><code>left ++ [node] ++ right\n</code></pre>\n\n<p>Was working perfectly fine. Have you any idea what I did wrong and probably what I could change?</p>\n\n<p>Best Whishes</p>\n"}, {"tags": ["haskell", "category-theory", "traversable"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1529427094, "post_id": 50932412, "comment_id": 88865299, "body": "<code>sequence</code> (verb): turn a sequence (noun) of applicative &quot;actions&quot;  &quot;inside&quot; a traversable &quot;container&quot; into one applicative &quot;action&quot; producing the sequence of results. For lists, it can be defined as <code>sequenceA = foldr (liftA2 (:)) (pure [])</code>. <code>traverse</code> could be called <code>mapA</code> since it&#39;s parallel to <code>mapM</code>. I guess mapping is kind of a traversing."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1529475865, "post_id": 50932412, "comment_id": 88880664, "body": "also, for lists again, <code>sequence [] = return [] ; sequence (x:xs) = do { x &lt;- x; xs &lt;- sequence xs; return (x:xs) }</code> where all &quot;computations&quot; <code>xs</code> are known in advance, so full power of Monad&#39;s being able to create new computations based on results of previously-run computations (as in <code>y &lt;- foo x</code>) is actually <i>not</i> needed. Hence the Applicative Functor, a less powerful, more general Functor than Monadic Functor."}], "answers": [{"comments": [{"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529440530, "post_id": 50934028, "comment_id": 88871650, "body": "ok cool, it makes sense .. and then why traverse / traversal ?"}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529441713, "post_id": 50934028, "comment_id": 88872077, "body": "That&#39;s much harder for me to say. Try to look at the papers linked in <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Traversable.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.11.1.0/docs/&hellip;</a>?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1529475564, "post_id": 50934028, "comment_id": 88880539, "body": "&quot;traverse&quot; is straightforward English: &quot;travel across or through&quot;. i.e. enumerate in some kind of linear fashion all elements <code>a</code> inside a container <code>t a</code>. like enumerating nodes in a binary tree. or enumerating <a href=\"http://www.dreamsongs.com/10ideas.html\" rel=\"nofollow noreferrer\">a tree&#39;s fringe</a>."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1529494742, "post_id": 50934028, "comment_id": 88891935, "body": "What I dislike a bit is that <code>sequenceA</code> seems more basic (just look at the descriptions), but the class is still named for <code>traverse</code> :)"}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 3, "last_activity_date": 1529429706, "creation_date": 1529429706, "answer_id": 50934028, "question_id": 50932412, "link": "https://stackoverflow.com/questions/50932412/terminology-of-the-traversable-concept/50934028#50934028", "title": "Terminology of the Traversable concept", "body": "<p>It's \"<em>to</em> sequence\", not \"a\". I.e. <a href=\"https://en.oxforddictionaries.com/definition/sequence\" rel=\"nofollow noreferrer\">\"Arrange in a particular order\"</a>, here from left to right. And it is a generalization of <a href=\"http://hackage.haskell.org/package/base-4.0.0.0/docs/Control-Monad.html#v:sequence\" rel=\"nofollow noreferrer\"><code>sequence :: Monad m =&gt; [m a] -&gt; m [a]</code></a> (note the old <code>base</code> version), which may make the name more obvious.</p>\n"}, {"comments": [{"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529603025, "post_id": 50972558, "comment_id": 88945474, "body": "Thanks @duplode !"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 1, "creation_date": 1529614794, "post_id": 50972558, "comment_id": 88950694, "body": "@NicolasHenin You are welcome. Something I forgot to mention: the most popular name in Haskell for the dual &quot;flip of a structure&quot; is <a href=\"http://hackage.haskell.org/package/distributive-0.5.3/docs/Data-Distributive.html\" rel=\"nofollow noreferrer\"><code>distribute :: (Functor f, Distributive g) =&gt; f (g a) -&gt; g (f a)</code></a>. (Then again, one of the key papers about <code>Traversable</code> uses <code>dist</code> as a name for <code>sequenceA</code>, which, I guess, only shows how hard it can be to name things.)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1529618654, "last_edit_date": 1529618654, "creation_date": 1529595602, "answer_id": 50972558, "question_id": 50932412, "link": "https://stackoverflow.com/questions/50932412/terminology-of-the-traversable-concept/50972558#50972558", "title": "Terminology of the Traversable concept", "body": "<p>Let's begin by considering <code>fmap</code>:</p>\n\n<pre><code>fmap :: Functor t =&gt; (a -&gt; b) -&gt; t a -&gt; t b\n</code></pre>\n\n<p>We can describe what it does as finding all <code>a</code> values in a <code>t a</code> and applying a function to them. Note that, infinite structure shenanigans aside, the order in which the implementation of <code>fmap</code> reaches the <code>a</code> values to modify them doesn't matter as far as the final result is concerned.</p>\n\n<p>Now let's have a look at <code>traverse</code>:</p>\n\n<pre><code>traverse :: (Applicative f, Traversable t) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\n</code></pre>\n\n<p>Like <code>fmap</code>, <code>traverse</code> also involves applying a function to values found in a structure (it's no wonder <code>traverse</code>'s forerunner was called <code>mapM</code>). <code>traverse</code>, however, also produces applicative effects for each of the <code>a</code> values (the <code>f</code> in <code>a -&gt; f b</code>), and it involves combining those effects in some order to get the overall <code>f (t b)</code> result. In general (i.e. as long as <code>f</code> isn't a commutative applicative, such as <code>Maybe</code>), the order of effects affects the result. That being so, any <code>Traversable</code> instance corresponds to a specific order in which the values in the structure will be visited. The name \"traverse\" (that is, as Will Ness points out, \"travel across or through\") is meant to convey this sense of direction.</p>\n\n<p>On a related note, <code>traverse</code> can be decomposed into a plain mapping which produces effects followed by the sequencing of those effects...</p>\n\n<pre><code>sequenceA :: (Applicative f, Traversable t) =&gt; t (f a) -&gt; f (t a)\n\ntraverse f = sequenceA . fmap f\nsequenceA = traverse id\n</code></pre>\n\n<p>... ergo the \"sequence\" name.</p>\n\n<p>It is also worth emphasising that <code>traverse</code> does capture various ways of going through a structure and doing things at each stop (cf. <code>for</code> being the name for <code>flip traverse</code>). In particular, we recover <code>fmap</code> by picking <code>Identity</code> as the Applicative functor (i.e. by not actually generating any effects), and <code>foldMap</code> (that is, list-like folding) by picking <code>Monoid m =&gt; Const m</code> instead. Things we <em>can't</em> do with <code>traverse</code> include dropping, duplicating or rearranging elements -- it doesn't allow tearing down a data structure in arbitrary ways like a general fold/catamorphism does. With <code>traverse</code>, we can move through a <code>Traversable</code> structure, but we can't reshape it.</p>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 1, "accepted_answer_id": 50972558, "answer_count": 2, "score": 1, "last_activity_date": 1529618654, "creation_date": 1529423516, "last_edit_date": 1529458796, "question_id": 50932412, "link": "https://stackoverflow.com/questions/50932412/terminology-of-the-traversable-concept", "title": "Terminology of the Traversable concept", "body": "<p>Why are we calling a flip of structure a \"sequence\" and why are we talking about \"traverse\" and \"Traversal\" ?</p>\n\n<p>I'm adding the implementation in haskell of these concepts as a matter to discussion...</p>\n\n<pre><code>class (Functor t, Foldable t) =&gt; Traversable t where\n    {-# MINIMAL traverse | sequenceA #-}\n\n    -- | Map each element of a structure to an action, evaluate these actions\n    -- from left to right, and collect the results. For a version that ignores\n    -- the results see 'Data.Foldable.traverse_'.\n    traverse :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\n    traverse f = sequenceA . fmap f\n\n    -- | Evaluate each action in the structure from left to right, and\n    -- and collect the results. For a version that ignores the results\n    -- see 'Data.Foldable.sequenceA_'.\n    sequenceA :: Applicative f =&gt; t (f a) -&gt; f (t a)\n    sequenceA = traverse id\n</code></pre>\n"}, {"tags": ["haskell", "testing", "io", "interactive", "ghci"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529421347, "post_id": 50931355, "comment_id": 88862371, "body": "I&#39;m not a bash expert, but I think you might mean <code>cat my-data | .&#47;my-program</code>. I think that should work."}, {"owner": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529422045, "post_id": 50931355, "comment_id": 88862770, "body": "#UUOC Actually, <code>cat my-data | .&#47;my-program</code> and <code>.&#47;my-program &lt; .&#47;my-data</code> are equivalent but for spawning a useless <code>cat</code> process\u2026 cf. <a href=\"https://www.ibm.com/developerworks/aix/library/au-badunixhabits.html?ca=lnxw01GoodUnixHabits#ten\" rel=\"nofollow noreferrer\">Stop Piping Cats</a>"}, {"owner": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1529546851, "post_id": 50931355, "comment_id": 88915932, "body": "I wonder about the negative votes. Comments as to why would be helpful."}], "answers": [{"comments": [{"owner": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "edited": false, "score": 0, "creation_date": 1529422022, "post_id": 50931846, "comment_id": 88862760, "body": "My program doesn&#39;t use any arguments, so no."}], "tags": [], "owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "is_accepted": false, "score": -1, "last_activity_date": 1529421544, "creation_date": 1529421544, "answer_id": 50931846, "question_id": 50931355, "link": "https://stackoverflow.com/questions/50931355/how-can-i-test-a-program-reading-from-stdin-in-ghci/50931846#50931846", "title": "How can I test a program reading from stdin in GHCi?", "body": "<p>I think you want:</p>\n\n<pre><code>ghci&gt; :set args YOUR_ARG\nghci&gt; main\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>ghci&gt; :main YOUR_ARG\n</code></pre>\n\n<p>See here: <a href=\"https://stackoverflow.com/questions/8867350/how-to-set-a-programs-command-line-arguments-for-ghci#8867385\">How to set a program&#39;s command line arguments for GHCi?</a></p>\n"}, {"comments": [{"owner": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "edited": false, "score": 0, "creation_date": 1529424323, "post_id": 50932360, "comment_id": 88863982, "body": "<code>hDuplicateTo h System.IO.stdin</code>  gets me <code>getTerminalAttributes: illegal operation (Inappropriate ioctl for device)</code>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "edited": false, "score": 0, "creation_date": 1529427674, "post_id": 50932360, "comment_id": 88865552, "body": "@Nowhereman I have just tried this and it works for me from ghci (fixed some error in the code, so now it&#39;s a complete tested snippet). Are you on Windows per any chance? Did you implement a ghci :redir-style command?"}, {"owner": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "edited": false, "score": 0, "creation_date": 1529438742, "post_id": 50932360, "comment_id": 88870884, "body": "Your code only works if I replace GHC.Handle by GHC.IO.Handle. Also, it works if I load it as a file but not if I type it in GHCi (I get the same error). I did not try it as a command yet."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "edited": false, "score": 0, "creation_date": 1529471735, "post_id": 50932360, "comment_id": 88879063, "body": "Yes I replaced GHC.Handle in the final version too."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "edited": false, "score": 0, "creation_date": 1529475505, "post_id": 50932360, "comment_id": 88880507, "body": "This also worked for me when I typed a similar definition in ghci"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "edited": false, "score": 0, "creation_date": 1529550415, "post_id": 50932360, "comment_id": 88916626, "body": "Just defined <code>let runit real_main filename = ...</code> the rest is identical, then call <code>runit main &quot;myfile.txt&quot;</code>"}, {"owner": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "edited": false, "score": 0, "creation_date": 1529552480, "post_id": 50932360, "comment_id": 88917016, "body": "I wonder why this works as a function but not as a ghci command\u2026"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1567248303, "post_id": 50932360, "comment_id": 101913691, "body": "This gives me an error of <code>Exception: &lt;stdin&gt;: hDuplicate: illegal operation (cannot flush the read buffer: underlying device is not seekable)</code>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1567252703, "post_id": 50932360, "comment_id": 101914654, "body": "@ChrisStryczynski Works for me with ghc-8.6.5 and 8.8.1 on Ubuntu. Do you have Windows perhaps?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1567262486, "post_id": 50932360, "comment_id": 101917090, "body": "It seems to be an issue when using <code>ghcid</code> - it works correctly with <code>ghci</code>."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 4, "last_activity_date": 1529427828, "last_edit_date": 1529427828, "creation_date": 1529423339, "answer_id": 50932360, "question_id": 50931355, "link": "https://stackoverflow.com/questions/50931355/how-can-i-test-a-program-reading-from-stdin-in-ghci/50932360#50932360", "title": "How can I test a program reading from stdin in GHCi?", "body": "<p>You can try wrapping your program in something like this (tested, working code):</p>\n\n<pre><code>import qualified System.IO\nimport qualified GHC.IO.Handle\n\nfilename = \"/tmp/myfilename\"                                                                                                                                                                                                                                                      \n\nmain = do                                                                                                                                                                                                                                         \n      h &lt;- System.IO.openFile filename System.IO.ReadMode                                                                                                                                                                                         \n      old_stdin &lt;- GHC.IO.Handle.hDuplicate System.IO.stdin                                                                                                                                                                                       \n      GHC.IO.Handle.hDuplicateTo h System.IO.stdin                                                                                                                                                                                                \n      System.IO.hClose h\n      realMain\n      GHC.IO.Handle.hDuplicateTo old_stdin System.IO.stdin\n\nrealMain = ...\n</code></pre>\n\n<p>It should also be possible to define a user-defined GHCi command that does this for any GHCi command, but I haven't tried yet. See <a href=\"https://gist.github.com/maoe/424018\" rel=\"nofollow noreferrer\">here</a> for someone's .ghci that redirects command's <em>stdout</em> with a user-defined <code>:redir</code> command.</p>\n"}], "owner": {"reputation": 4755, "user_id": 400277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea12da4fb5d06d2e5da1c53b272f5ccd?s=128&d=identicon&r=PG", "display_name": "Nowhere man", "link": "https://stackoverflow.com/users/400277/nowhere-man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 457, "favorite_count": 0, "accepted_answer_id": 50932360, "answer_count": 2, "score": 1, "last_activity_date": 1529427828, "creation_date": 1529419964, "question_id": 50931355, "link": "https://stackoverflow.com/questions/50931355/how-can-i-test-a-program-reading-from-stdin-in-ghci", "title": "How can I test a program reading from stdin in GHCi?", "body": "<p>My program has a bug I want to see within GHCi:</p>\n\n<pre><code>$ ./my-program &lt; ./my-data\nPrelude.foldl1: empty list\n</code></pre>\n\n<p>I tried changing <code>stdin</code> or <code>getLine</code> in GHCi but it doesn't seem to affect the <code>getLine</code> my program uses, even if I load afterwards:</p>\n\n<pre><code>$ ghci\nPrelude&gt; import System.IO\nPrelude System.IO&gt; getLine &lt;- fmap hGetLine $ openFile \"my-data\" ReadMode\n:l \"my-program.hs\"\n:main\n</code></pre>\n\n<p>Do I need to rewrite all my IOs to take an explicit handle to be able to test them in GHCi?</p>\n"}, {"tags": ["haskell", "ghcjs", "reflex"], "comments": [{"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1529420981, "post_id": 50930584, "comment_id": 88862172, "body": "Does it help, to use the signature body:: Widget (), from Reflex.Dom.Main? Or to make main :: IO () ?"}, {"owner": {"reputation": 15, "user_id": 9256057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e7eb8495f74da9278f4701acd8a87f?s=128&d=identicon&r=PG&f=1", "display_name": "bongsun", "link": "https://stackoverflow.com/users/9256057/bongsun"}, "reply_to_user": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1529444406, "post_id": 50930584, "comment_id": 88873068, "body": "I&#39;m getting this instead:     \u2022 Expecting one more argument to \u2018Widget ()\u2019       Expected a type, but \u2018Widget ()\u2019 has kind \u2018* -&gt; *\u2019     \u2022 In the type signature:         body :: Widget ()"}], "answers": [{"tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 0, "last_activity_date": 1529446384, "creation_date": 1529446384, "answer_id": 50937637, "question_id": 50930584, "link": "https://stackoverflow.com/questions/50930584/how-to-make-monaderror-work-with-ghcjs-reflex/50937637#50937637", "title": "How to make MonadError work with ghcjs/reflex", "body": "<p>In the ghc version, <code>importString</code> is operating in the context of an <code>IO</code> monad do statement . <code>importString</code> is capable of returning a value in the <code>IO</code> monad so the compiler is happy</p>\n\n<p>In the ghcjs version, <code>importString</code> is operating in the context of an <code>m</code> monad do statement (<code>m</code> is specified in the declaration of <code>body</code> ).  <code>importString</code> has no way to return a value in the <code>m</code> monad so the compiler complains.</p>\n\n<p>You can get around this by using <code>liftIO</code> to change an <code>IO</code> monad value to a <code>m</code> monad value.  Here's your code with this change and a few other changes that I made to help myself understand the code.</p>\n\n<pre><code>import           Data.Maybe\nimport qualified Data.Text       as T\nimport           Data.URLEncoded as DU\nimport           Reflex.Dom\nimport           Control.Monad.Trans as CMT \n\nurl :: T.Text\nurl = T.pack \"parm1=one&amp;parm2=two\"\n\nmain = do\n  mainWidget body\n\nbody :: MonadWidget t m =&gt; m ()\nbody  = el (T.pack \"div\") $ do\n  let istr = CMT.liftIO $ DU.importString (T.unpack url)\n  t &lt;- fmap (T.pack . fromMaybe \"\" . DU.lookup \"parm2\") istr\n  text t\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 9256057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e7eb8495f74da9278f4701acd8a87f?s=128&d=identicon&r=PG&f=1", "display_name": "bongsun", "link": "https://stackoverflow.com/users/9256057/bongsun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 50937637, "answer_count": 1, "score": 0, "last_activity_date": 1529446384, "creation_date": 1529417590, "question_id": 50930584, "link": "https://stackoverflow.com/questions/50930584/how-to-make-monaderror-work-with-ghcjs-reflex", "title": "How to make MonadError work with ghcjs/reflex", "body": "<p>I'm struggling to compile the following program:</p>\n\n<pre><code>import           Data.Maybe\nimport qualified Data.Text       as T\nimport qualified Data.Text.IO    as T\nimport           Data.URLEncoded\nimport           Reflex.Dom\n\nurl :: T.Text\nurl = T.pack \"parm1=one&amp;parm2=two\"\n\nmain = do\n  mainWidget body\n\nbody :: MonadWidget t m =&gt; m ()\nbody  = el (T.pack \"div\") $ do\n  -- let t = (T.pack \"this program works if you replace the line below with this\")\n  t &lt;- fmap (T.pack . fromMaybe \"\" . Data.URLEncoded.lookup \"parm2\") (importString (T.unpack url))\n  text t\n</code></pre>\n\n<p>however this similar version works with vanilla ghc</p>\n\n<pre><code>import           Data.Maybe\nimport qualified Data.Text       as T\nimport qualified Data.Text.IO    as T\nimport           Data.URLEncoded\n\nurl :: T.Text\nurl = T.pack \"parm1=one&amp;parm2=two\"\n\nmain = do\n  body\n\nbody  = do\n  t &lt;- fmap (T.pack . fromMaybe \"\" . Data.URLEncoded.lookup \"parm2\") (importString (T.unpack url))\n  T.putStrLn t\n</code></pre>\n\n<p>The compiler says something is ambiguous and I'm not really sure how to implement these to work.</p>\n\n<pre><code>  The type variable \u2018e0\u2019 is ambiguous\n  Relevant bindings include body :: m () (bound at reflex.hs:14:1)\n  These potential instances exist:\n    instance [safe] Control.Monad.Error.Class.MonadError e (Either e)\n      -- Defined in \u2018Control.Monad.Error.Class\u2019\n    ...plus 13 instances involving out-of-scope types\n      instance [safe] Control.Monad.Error.Class.MonadError\n                        GHC.IO.Exception.IOException IO\n        -- Defined in \u2018Control.Monad.Error.Class\u2019\n      instance [safe] (Monad m, Control.Monad.Trans.Error.Error e) =&gt;\n                      Control.Monad.Error.Class.MonadError\n                        e (Control.Monad.Trans.Error.ErrorT e m)\n        -- Defined in \u2018Control.Monad.Error.Class\u2019\n</code></pre>\n\n<p>FYI: I haven't fully grasped Monads yet and easily get scared with these errors. Help!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1529414166, "post_id": 50929176, "comment_id": 88857652, "body": "Is the tuple always a 4-tuple?"}, {"owner": {"reputation": 63, "user_id": 9403534, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel D&#39;costa", "link": "https://stackoverflow.com/users/9403534/samuel-dcosta"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529479369, "post_id": 50929176, "comment_id": 88882406, "body": "@WillemVanOnsem no"}], "answers": [{"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": false, "score": 3, "last_activity_date": 1529414588, "last_edit_date": 1529414588, "creation_date": 1529414278, "answer_id": 50929510, "question_id": 50929176, "link": "https://stackoverflow.com/questions/50929176/how-to-convert-a-tuple-of-eithers-to-a-list-of-eithers/50929510#50929510", "title": "How to convert a tuple of Eithers to a list of Eithers?", "body": "<p>You can convert a tuple with exactly four values in it to a list with exactly four values in it like:</p>\n\n<pre><code>f :: (a, a, a, a) -&gt; [a]\nf (a1, a2, a3, a4) = [a1, a2, a3, a4]\n</code></pre>\n\n<p>You can then proceed to use <code>lefts :: [Either a b] -&gt; [a]</code> from <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Either.html#v:lefts\" rel=\"nofollow noreferrer\">Data.Either</a>.</p>\n\n<p>But as the answer to the opposite question, <a href=\"https://stackoverflow.com/questions/2921345/how-do-i-convert-a-list-to-a-tuple-in-haskell\">How do I convert a list to a tuple in Haskell?</a>, suggests, <em>in a general way, you can't</em>. Generally when you have a specific number of elements (a tuple), you should want to know what to do with them specifically.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 8, "last_activity_date": 1529414338, "creation_date": 1529414338, "answer_id": 50929526, "question_id": 50929176, "link": "https://stackoverflow.com/questions/50929176/how-to-convert-a-tuple-of-eithers-to-a-list-of-eithers/50929526#50929526", "title": "How to convert a tuple of Eithers to a list of Eithers?", "body": "<p>This question has nothing to do with <code>Either</code> \u2013 you could as well ask how to convert a tuple of characters into a list of characters.</p>\n\n<p>The answer is: there is no standard method for doing this, but you can just write a lambda / custom function</p>\n\n<pre><code>    \\(a,b,c,d) -&gt; [a,b,c,d]\n</code></pre>\n\n<p>You should ask yourself the question why you have such a tuple in the first place. Big-ish homogeneous tuples seem fishy; probably you should instead built a list right where it comes from instead.</p>\n"}, {"comments": [{"owner": {"reputation": 63, "user_id": 9403534, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel D&#39;costa", "link": "https://stackoverflow.com/users/9403534/samuel-dcosta"}, "edited": false, "score": 0, "creation_date": 1529479415, "post_id": 50929703, "comment_id": 88882434, "body": "what if i got something like this (Left &quot;Error1&quot;, Right 1, Left &quot;Error2&quot;, Right &quot;NameString&quot;)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 63, "user_id": 9403534, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel D&#39;costa", "link": "https://stackoverflow.com/users/9403534/samuel-dcosta"}, "edited": false, "score": 0, "creation_date": 1529496592, "post_id": 50929703, "comment_id": 88893175, "body": "@SamuelD&#39;costa Then you don&#39;t have an homogeneous tuple, and so you can&#39;t put all its elements in a list (as they have different types) unless you change them into something else."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 5, "last_activity_date": 1529417059, "last_edit_date": 1529417059, "creation_date": 1529414889, "answer_id": 50929703, "question_id": 50929176, "link": "https://stackoverflow.com/questions/50929176/how-to-convert-a-tuple-of-eithers-to-a-list-of-eithers/50929703#50929703", "title": "How to convert a tuple of Eithers to a list of Eithers?", "body": "<p>Bonus answer: if you were using <em>lens</em>, you could do it with the <code>each</code> traversal. \n<code>each</code> can handle tuples of various sizes because it relies on an <code>Each</code> class that has instances for them.</p>\n\n<pre><code>GHCi&gt; import Control.Lens\nGHCi&gt; toListOf each (Left \"Error1\", Right 1, Left \"Error2\", Right 2)\n[Left \"Error1\",Right 1,Left \"Error2\",Right 2]\n</code></pre>\n\n<p>Yet another possibility would be relying on <code>Foldable</code> instances for homogeneous tuples provided by the <a href=\"https://hackage.haskell.org/package/tuples-homogenous-h98-0.1.1.0/docs/Data-Tuple-Homogenous.html\" rel=\"nofollow noreferrer\"><em>tuples-homogenous-h98</em></a> package.</p>\n\n<pre><code>GHCi&gt; import Data.Foldable\nGHCi&gt; import Data.Tuple.Homogenous\nGHCi&gt; toList (Tuple4 (Left \"Error1\", Right 1, Left \"Error2\", Right 2))\n[Left \"Error1\",Right 1,Left \"Error2\",Right 2]\n</code></pre>\n\n<p>This digression aside, I subscribe to <a href=\"https://stackoverflow.com/a/50929526/2751851\">leftaroundabout's answer</a>.</p>\n"}], "owner": {"reputation": 63, "user_id": 9403534, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel D&#39;costa", "link": "https://stackoverflow.com/users/9403534/samuel-dcosta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1529479614, "creation_date": 1529413368, "last_edit_date": 1529479614, "question_id": 50929176, "link": "https://stackoverflow.com/questions/50929176/how-to-convert-a-tuple-of-eithers-to-a-list-of-eithers", "title": "How to convert a tuple of Eithers to a list of Eithers?", "body": "<p>I got a tuple with Either values in it,</p>\n\n<pre><code>(Left \"Error1\", Right 1, Left \"Error2\", Right 2) \n</code></pre>\n\n<p>How can i convert this to</p>\n\n<pre><code>[Left \"Error1\", Right 1, Left \"Error2\", Right 2]\n</code></pre>\n\n<p>?</p>\n\n<p>Since I want to do lefts on the list and get all Left values from</p>\n\n<pre><code>[Left \"Error1\", Right 1, Left \"Error2\", Right 2]\n</code></pre>\n\n<p>I have something like this with 38 values in the tuple, <code>(Left \"Error1\", Right 1, Left \"Error2\", Right \"NameString\")</code> is it possible to get only the left values from the tuple?</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 6, "last_activity_date": 1529904612, "creation_date": 1529904612, "answer_id": 51016806, "question_id": 50925938, "link": "https://stackoverflow.com/questions/50925938/what-is-cabal-hell/51016806#51016806", "title": "What is Cabal Hell?", "body": "<p>The only meaningful use of the term is the one given in the linked answer. Related are the follow-on problems from having lots of different packages in the global database, which can make encountering diamond dependencies more common, requiring destructive reinstalls to resolve, etc.</p>\n\n<p>The other usages of the term are not helpful and just mean \"problems somehow involving cabal.\"</p>\n\n<p>That said, let me answer your other questions.</p>\n\n<p>1) <code>ghc-pkg</code> is not a package manager, but rather a tool for managing ghc package databases. It is used by cabal to register packages into databases, and can be used by end-users to inspect the contents of the databases. Think of it as part of the underlying substrate provided by ghc, not a competing tool.</p>\n\n<p>2) <code>new-build</code> eliminates and replaces the standard notion of a packagedb entirely. Instead of saying that a db consists of packages and versions, with at most one of each pair, instead a db consists of potentially many copies of packages at any given version, each with potentially different versions of its dependencies, all of which are managed in part by hash-addressing, so marked by a unique \"fingerprint\". This is called the <code>store</code>. When you <code>new-build</code>, cabal calculates a build plan irrespective of any previously installed dependencies, from scratch. If a particular fingerprint (consisting of a package, version, and the versions of all its dependencies, certain flags, etc) already exists in the store, then it makes use of it. If it does not, it calculates it.</p>\n\n<p>As such, the only \"diamond dependencies\" that can occur are the <em>truly</em> insoluble ones, and not the ones occasioned by having fixed too-early (due to already-installed deps) some portion of the dependency tree.</p>\n\n<p>tldr; you write \"since GHC only allows one instance of a package with the same version\" but new-build partially lifts this restriction in the <code>store</code> which allows the solver to produce better, more reproducible plans more often.</p>\n"}], "owner": {"reputation": 2430, "user_id": 1525842, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95abedfeb09f68271233421d1aafb3be?s=128&d=identicon&r=PG", "display_name": "zeronone", "link": "https://stackoverflow.com/users/1525842/zeronone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1084, "favorite_count": 0, "accepted_answer_id": 51016806, "answer_count": 1, "score": 6, "last_activity_date": 1542186829, "creation_date": 1529403422, "last_edit_date": 1542186829, "question_id": 50925938, "link": "https://stackoverflow.com/questions/50925938/what-is-cabal-hell", "title": "What is Cabal Hell?", "body": "<p>I am a little bit confused while reading about Cabal Hell, as the term is overloaded. I guess originally Cabal Hell referred to the diamond dependency problem, which was solved by restricting the build plan to have only a single version of any package in each build plan (two different versions of a package can't exist in a single build plan) as explained in this <a href=\"https://stackoverflow.com/a/25870174/1525842\">answer</a>.</p>\n\n<p>However, the term is also used in various other contexts. Such as destructive re-installations, incorrect package dependency boundaries (lower/upper version bounds), inconsistent environments ... (or any other error reported by Cabal).</p>\n\n<p>Particular among these, I am confused about 1) destructive re-installations and 2) inconsistent environments? What do they mean, and how <code>cabal new-build</code> solves these problems (is it just sandboxing like <code>cabal sandbox</code>)? And what role <code>ghc-pkg</code> has to play here?</p>\n\n<p>Any references or a simple example where these problems could be reproduced would be very appreciated.</p>\n\n<p>Regarding \"destructive re-installations\": If I am not wrong, GHC has a package manager of itself (<code>ghc-pkg</code>), and the packages are installed as dynamically linkable libraries i.e: <code>base</code> depends on <code>ghc-prim</code>, so if <code>ghc-prim</code> is removed it will break <code>base</code>, am I right? And since GHC only allows one instance of a package with the same version, <code>cabal install</code> might register a newer build of the same <code>(package, version)</code> such that it breaks the dependents of the unregistered package. If the above understanding regarding \"destructive re-installations\" are correct; how does <code>cabal new-build</code> help here?</p>\n"}, {"tags": ["haskell", "intero"], "comments": [{"owner": {"reputation": 3706, "user_id": 2018455, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e75a41fc224930ef1fa9ddcc9c714174?s=128&d=identicon&r=PG", "display_name": "Neil Locketz", "link": "https://stackoverflow.com/users/2018455/neil-locketz"}, "edited": false, "score": 3, "creation_date": 1529380890, "post_id": 50920456, "comment_id": 88840429, "body": "I don&#39;t know if this is the &quot;right way&quot; to do it but i just run <code>intero-restart</code>"}, {"owner": {"reputation": 317, "user_id": 7370105, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/28a1d625330e0446be0e39e901f8b5b1?s=128&d=identicon&r=PG&f=1", "display_name": "handora", "link": "https://stackoverflow.com/users/7370105/handora"}, "reply_to_user": {"reputation": 3706, "user_id": 2018455, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e75a41fc224930ef1fa9ddcc9c714174?s=128&d=identicon&r=PG", "display_name": "Neil Locketz", "link": "https://stackoverflow.com/users/2018455/neil-locketz"}, "edited": false, "score": 0, "creation_date": 1529380986, "post_id": 50920456, "comment_id": 88840444, "body": "It completely solves my problem, thanks."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 3706, "user_id": 2018455, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e75a41fc224930ef1fa9ddcc9c714174?s=128&d=identicon&r=PG", "display_name": "Neil Locketz", "link": "https://stackoverflow.com/users/2018455/neil-locketz"}, "edited": false, "score": 0, "creation_date": 1529384214, "post_id": 50920456, "comment_id": 88841195, "body": "@NeilLocketz This should be an answer."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1529398735, "post_id": 50920456, "comment_id": 88847995, "body": "If you&#39;re running spacemacs, <code>intero-restart</code> is bound to <code>&lt;spc&gt; m i r</code>."}, {"owner": {"reputation": 3706, "user_id": 2018455, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e75a41fc224930ef1fa9ddcc9c714174?s=128&d=identicon&r=PG", "display_name": "Neil Locketz", "link": "https://stackoverflow.com/users/2018455/neil-locketz"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1529432274, "post_id": 50920456, "comment_id": 88867831, "body": "@Shersh, Done :P"}], "answers": [{"tags": [], "owner": {"reputation": 3706, "user_id": 2018455, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e75a41fc224930ef1fa9ddcc9c714174?s=128&d=identicon&r=PG", "display_name": "Neil Locketz", "link": "https://stackoverflow.com/users/2018455/neil-locketz"}, "is_accepted": true, "score": 3, "last_activity_date": 1529413069, "creation_date": 1529413069, "answer_id": 50929060, "question_id": 50920456, "link": "https://stackoverflow.com/questions/50920456/how-to-add-dependencies-and-make-it-visible-to-intero-in-haskell/50929060#50929060", "title": "How to add dependencies and make it visible to Intero in Haskell", "body": "<p>You can get it to show up by running <code>intero-restart</code>.</p>\n\n<p>There may be a \"more correct\" way, but this works.</p>\n"}], "owner": {"reputation": 317, "user_id": 7370105, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/28a1d625330e0446be0e39e901f8b5b1?s=128&d=identicon&r=PG&f=1", "display_name": "handora", "link": "https://stackoverflow.com/users/7370105/handora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 1, "accepted_answer_id": 50929060, "answer_count": 1, "score": 2, "last_activity_date": 1529413069, "creation_date": 1529380825, "question_id": 50920456, "link": "https://stackoverflow.com/questions/50920456/how-to-add-dependencies-and-make-it-visible-to-intero-in-haskell", "title": "How to add dependencies and make it visible to Intero in Haskell", "body": "<p>I want to use <code>System.Directory</code> in emacs with Haskell mode and Intero, While the on the fly check warns that <code>Couldn't find module System.Directory</code>. So I add some dependencies in my cabal file. And the warning doesn't disappear while the <code>stack build</code> successfully executed. </p>\n\n<p>Below is my cabal file:</p>\n\n<pre><code>-- This file has been generated from package.yaml by hpack version 0.28.2.\n--\n-- see: https://github.com/sol/hpack\n--\n-- hash: 536b5f6ecaaec7d4b7a9694c8f69bbe648a1d21d80fa721e533ac5b139955401\n\nname:           find\nversion:        0.1.0.0\ndescription:    Please see the README on GitHub at &lt;https://github.com/Handora/find#readme&gt;\nhomepage:       https://github.com/Handora/find#readme\nbug-reports:    https://github.com/Handora/find/issues\nauthor:         Handora\nmaintainer:     qcdsr970209@gmail.com\ncopyright:      Qian Chen\nlicense:        BSD3\nlicense-file:   LICENSE\nbuild-type:     Simple\ncabal-version:  &gt;= 1.10\nextra-source-files:\n    ChangeLog.md\n    README.md\n\nsource-repository head\n  type: git\n  location: https://github.com/Handora/find\n\nlibrary\n  exposed-modules:\n      Lib\n      RecursiveContents\n  other-modules:\n      Paths_find\n  hs-source-dirs:\n      src\n  build-depends:\n      base &gt;=4.7 &amp;&amp; &lt;5\n    , directory\n  default-language: Haskell2010\n\nexecutable find-exe\n  main-is: Main.hs\n  other-modules:\n      Paths_find\n  hs-source-dirs:\n      app\n  ghc-options: -threaded -rtsopts -with-rtsopts=-N\n  build-depends:\n      base &gt;=4.7 &amp;&amp; &lt;5\n    , find\n    , directory\n  default-language: Haskell2010\n\ntest-suite find-test\n  type: exitcode-stdio-1.0\n  main-is: Spec.hs\n  other-modules:\n      Paths_find\n  hs-source-dirs:\n      test\n  ghc-options: -threaded -rtsopts -with-rtsopts=-N\n  build-depends:\n      base &gt;=4.7 &amp;&amp; &lt;5\n    , find\n  default-language: Haskell2010\n</code></pre>\n\n<p>I add the <code>directory</code> into build dependencies and executable build dependencies. So my question is how to make the <code>System.Directory</code> visible to <code>Intero</code>, so the warnings can disappear.</p>\n"}, {"tags": ["haskell", "recursion", "matrix", "vector", "row-major-order"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529354574, "post_id": 50917150, "comment_id": 88834350, "body": "I think the transpose is rather &quot;inelegant&quot; and &quot;inefficient&quot; to be honest (since for every element, you run through the list to access that element, and for you furthermore append at the end of the list, hence for an <i>m x n</i> matrix, this will probably scale with <i>m^2 x n^2</i>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529354957, "post_id": 50917150, "comment_id": 88834526, "body": "Furthermore it is not really clear for me what you expect as an answer? A full solution? Then what is the point of the assignment?"}, {"owner": {"reputation": 43, "user_id": 9958654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zzEl0.png?s=128&g=1", "display_name": "janschill", "link": "https://stackoverflow.com/users/9958654/janschill"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529354995, "post_id": 50917150, "comment_id": 88834548, "body": "I don&#39;t have to use transpose. That was a helping function to wrap my head around the idea"}, {"owner": {"reputation": 43, "user_id": 9958654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zzEl0.png?s=128&g=1", "display_name": "janschill", "link": "https://stackoverflow.com/users/9958654/janschill"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529355054, "post_id": 50917150, "comment_id": 88834570, "body": "Well it&#39;s not an assignment, help in form of how I can tackle this problem any easier."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1529399738, "post_id": 50917150, "comment_id": 88848573, "body": "\u201cTime and space complexity does not matter\u201d \u2013 now I feel tempted to devise an <i>O</i> (<i>n</i>!) matrix multiplication algorithm..."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1529378529, "post_id": 50917605, "comment_id": 88839982, "body": "See also <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-List.html#v:transpose\" rel=\"nofollow noreferrer\"><code>Data.List.transpose</code></a>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1529356694, "creation_date": 1529356694, "answer_id": 50917605, "question_id": 50917150, "link": "https://stackoverflow.com/questions/50917150/matrix-multiplication-of-row-major-recursively/50917605#50917605", "title": "Matrix multiplication of row-major recursively", "body": "<p>First of all, I'm not really convinced that such linear list is a good idea. A list in Haskell is modelled as a <em>linked list</em>. So that means that typically accessing the <em>k</em>-th element, will run in <em>O(k)</em>. So for an <em>m&times;n</em>-matrix that means it takes <em>O(m n)</em> in order to access the last element. By using a 2d linked list: a linked list that contains linked lists, we scale that down to <em>O(m+n)</em>, which is typically faster. Yes there is some overhead since you use more \"cons\" data constructors, but the amount of traversing is typically lower. In case you really want fast access, you should use arrays, vectors, etc. But then there are other design decisions to make.</p>\n\n<p>So I propose we model the matrix as:</p>\n\n<pre><code>data Matrix a = M {\n  rows :: Int,\n  cols :: Int,\n  values :: <b>[</b>[a]<b>]</b>\n}</code></pre>\n\n<p>Now with this data constructor we can define a transpose as:</p>\n\n<pre><code>transpose' :: Matrix a -&gt; Matrix a\ntranspose' (M r c as) = M c r (trans as)\n    where trans [] = []\n          trans xs = map head xs : trans (map tail xs)\n</code></pre>\n\n<p>(here we assume that the list of lists is always rectangular)</p>\n\n<p>So now for the matrix multiplication. If <em>A</em> and <em>B</em> are two matrices, and <em>C = A &times; B</em>, then that basically means that <em>a<sub>i, j</sub></em> is the <em>dot product</em> of the <em>i</em>-th row of <em>A</em>, and the <em>j</em>-th column of <em>B</em>. Or the <em>i</em>-th row of <em>A</em>, and the <em>j</em>-th row of <em>B<sup>T</sup></em> (the transpose of <em>B</em>). We can thus define the dot product as:</p>\n\n<pre><code>dot_prod :: Num a =&gt; [a] -&gt; [a] -&gt; a\ndot_prod xs ys = sum (zipWith (*) xs ys)\n</code></pre>\n\n<p>and now it is only a matter of iterating through the rows and columns, and placing the elements in the right list. Like:</p>\n\n<pre><code>mat_mul :: Num a =&gt; Matrix a -&gt; Matrix a -&gt; Matrix a\nmat_mul (M r ca xss) m2 | ca /= ra = error \"Invalid matrix shapes\"\n                        | otherwise = M r c (matmul xss)\n    where (M c rb yss) = transpose m2\n          matmul [] = []\n          matmul (xs:xss) = generaterow yss xs : matmul xss\n          generaterow [] _ = []\n          generaterow (ys:yss) xs = dot_prod xs ys : generaterow yss xs\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 9958654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zzEl0.png?s=128&g=1", "display_name": "janschill", "link": "https://stackoverflow.com/users/9958654/janschill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 404, "favorite_count": 0, "accepted_answer_id": 50917605, "answer_count": 1, "score": 3, "last_activity_date": 1529356694, "creation_date": 1529354397, "last_edit_date": 1529355614, "question_id": 50917150, "link": "https://stackoverflow.com/questions/50917150/matrix-multiplication-of-row-major-recursively", "title": "Matrix multiplication of row-major recursively", "body": "<p>I'm programming my own matrix module for fun and practice (Time and space complexity does not matter).\nNow I want to implement matrix multiplication and I am struggling with it. It probably the reason I am using Haskell and I haven't had much experience with it.\nThis is my data type:</p>\n\n<pre><code>data Matrix a =\nM {\n  rows::Int,\n  cols::Int,\n  values::[a]\n}\n</code></pre>\n\n<p>Which stores a 3x2 Matrix like this in array:</p>\n\n<pre><code>1 2\n3 4\n5 6\n= [1,2,3,4,5,6]\n</code></pre>\n\n<p>I have a somewhat working transpose function</p>\n\n<pre><code>transpose::(Matrix a)-&gt;(Matrix a)\ntranspose (M rows cols values) = M cols rows (aux values 0 0 [])\n  where\n   aux::[a]-&gt;Int-&gt;Int-&gt;[a]-&gt;[a]\n   aux values row col transposed \n     | cols &gt; col =\n       if rows &gt; row then \n         aux values (row+1) col (transposed ++ [valueAtIndex (M rows cols values) (row,col)])\n       else aux values 0 (col+1) transposed\n     | otherwise = transposed\n</code></pre>\n\n<p>To index the elements in the array I am using this function</p>\n\n<pre><code>valueAtIndex::(Matrix a)-&gt;(Int, Int)-&gt;a\nvalueAtIndex (M rows cols values) (row, col) \n  | rows &lt;= row || cols &lt;= col = error \"indices too large for given Matrix\"\n  | otherwise = values !! (cols * row + col)\n</code></pre>\n\n<p>From my understanding, I have to get elements like this for m1: 2x3 and m2: 3x2</p>\n\n<pre><code>m1(0,0)*m2(0,0)+m1(0,1)*m2(0,1)+m1(0,2)*m2(0,2)\nm1(0,0)*m2(1,0)+m1(0,1)*m2(1,1)+m1(0,2)*m2(1,2)\nm1(1,0)*m2(0,0)+m1(1,1)*m2(0,1)+m1(1,2)*m2(0,2)\nm1(1,0)*m2(1,0)+m1(1,1)*m2(1,1)+m1(1,2)*m2(2,2)\n</code></pre>\n\n<p>Now I need a function that takes two matrices, with <code>rows m1 == cols m2</code> and then somehow recursively calculate the correct matrix.</p>\n\n<pre><code>multiplyMatrix::Num a=&gt;(Matrix a)-&gt;(Matrix a)-&gt;(Matrix a)\n</code></pre>\n"}, {"tags": ["linux", "bash", "haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 5, "creation_date": 1529351012, "post_id": 50916030, "comment_id": 88832900, "body": "Does <code>hash -r</code> fix the issue?"}, {"owner": {"reputation": 53, "user_id": 3076170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e18b9265d941833d438c780212857ae?s=128&d=identicon&r=PG&f=1", "display_name": "user3076170", "link": "https://stackoverflow.com/users/3076170/user3076170"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1529361869, "post_id": 50916030, "comment_id": 88836856, "body": "I went to lookup hash and inadvertently closed terminal. In a new terminal I ran <code>stack --version</code> and the updated version, 1.7.1, was reported. I&#39;m new to bash, is that a thing, not knowing the current state unless restarted? Thanks for the help Thomas. Should I leave it at that, answer my own question, or edit it?"}, {"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1529361946, "post_id": 50916030, "comment_id": 88836873, "body": "<a href=\"https://unix.stackexchange.com/q/5609/56041\">How do I clear Bash&#39;s cache of paths to executables?</a> on <a href=\"http://unix.stackexchange.com/\">Unix &amp; Linux Stack Exchange</a>, <a href=\"https://superuser.com/q/871854/173513\">Does Bash have cache of executables?</a> on <a href=\"http://superuser.com/\">Super User</a>, etc."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1529362912, "post_id": 50916030, "comment_id": 88837083, "body": "Feel free to answer your own question, that&#39;s entirely legitimate."}], "answers": [{"tags": [], "owner": {"reputation": 53, "user_id": 3076170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e18b9265d941833d438c780212857ae?s=128&d=identicon&r=PG&f=1", "display_name": "user3076170", "link": "https://stackoverflow.com/users/3076170/user3076170"}, "is_accepted": true, "score": 1, "last_activity_date": 1529524167, "creation_date": 1529524167, "answer_id": 50956012, "question_id": 50916030, "link": "https://stackoverflow.com/questions/50916030/why-does-stack-version-seem-to-show-a-different-version-than-was-installed/50956012#50956012", "title": "Why does `stack --version` seem to show a different version than was installed?", "body": "<p>As @Thomas M. DuBuisson commented this could well have been fixable with <code>hash -r</code>. After restarting terminal the newly installed executable was referenced by <code>stack --version</code>. I didn't run <code>hash -r</code>, but I did run <code>hash</code> in the new terminal and the cache had been cleared.</p>\n"}], "owner": {"reputation": 53, "user_id": 3076170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e18b9265d941833d438c780212857ae?s=128&d=identicon&r=PG&f=1", "display_name": "user3076170", "link": "https://stackoverflow.com/users/3076170/user3076170"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 50956012, "answer_count": 1, "score": 1, "last_activity_date": 1529524167, "creation_date": 1529348981, "question_id": 50916030, "link": "https://stackoverflow.com/questions/50916030/why-does-stack-version-seem-to-show-a-different-version-than-was-installed", "title": "Why does `stack --version` seem to show a different version than was installed?", "body": "<p>I ran <code>stack upgrade</code> and it seems to have worked. Output to the console says I have a new stack executable, but <code>stack --version</code> says differently. What am I missing?</p>\n\n<pre><code>~\n$ stack upgrade\nCurrent Stack version: 1.3.2, available download version: 1.7.1\nNewer version detected, downloading\nQuerying for archive location for platform: osx-x86_64-static\nQuerying for archive location for platform: osx-x86_64\nDownloading from: https://github.com/commercialhaskell/stack/releases/download/v1.7.1/stack-1.7.1-osx-x86_64.tar.gz\nDownload complete, testing executable\nVersion 1.7.1, Git revision 681c800873816c022739ca7ed14755e85a579565 (5807 commits) x86_64 hpack-0.28.2\nNew stack executable available at /Users/skissh/.local/bin/stack\n~\n$ which stack\n/Users/skissh/.local/bin/stack\n~\n$ stack --version\nVersion 1.3.2, Git revision 3f675146590da4f3edf768b89355f798229da2a5 (4395 commits) x86_64 hpack-0.15.0\n~\n$ cd ~/.local/bin\n~/.local/bin\n$ ls -l\ntotal 64040\n-rwxr-xr-x  1 skissh  staff  32788156 Jun 17 12:27 stack\n~/.local/bin\n</code></pre>\n"}, {"tags": ["haskell"], "owner": {"reputation": 1192, "user_id": 2376000, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/91b3523deec92f946d80e1b3e903bb1a?s=128&d=identicon&r=PG", "display_name": "chrimuelle", "link": "https://stackoverflow.com/users/2376000/chrimuelle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1529347715, "creation_date": 1529347715, "question_id": 50915737, "link": "https://stackoverflow.com/questions/50915737/cannot-reproduce-simple-example-form-the-hood-haskell-object-observation-debugg", "title": "Cannot reproduce simple example form the Hood (Haskell Object Observation Debugger) package documentation", "body": "<p>To get some more insight into the intermediate steps involved in the evaluation of expressions, I would like to give the hood (<a href=\"http://hackage.haskell.org/package/hood\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/hood</a>) package a try.</p>\n\n<p>On the home page (<a href=\"http://ku-fpg.github.io/software/hood/\" rel=\"nofollow noreferrer\">http://ku-fpg.github.io/software/hood/</a>) of the package, there are some examples of the capabilities of hood, namely this example:</p>\n\n<pre><code>import Debug.Hood.Observe\n\nex2 = print\n    . reverse\n    . (observe \"intermediate\")\n    . reverse\n    $ [1..9]\nn = runO ex2\n</code></pre>\n\n<p>When I try to run this example I get the following error:</p>\n\n<pre><code>hoodTests.hs:10:10: error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from the literal \u20181\u2019\n      prevents the constraint \u2018(Num a0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instances exist:\n        instance Num Integer -- Defined in \u2018GHC.Num\u2019\n        instance Num Double -- Defined in \u2018GHC.Float\u2019\n        instance Num Float -- Defined in \u2018GHC.Float\u2019\n        ...plus two others\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the expression: 1\n      In the second argument of \u2018($)\u2019, namely \u2018[1 .. 9]\u2019\n      In the expression:\n        print . reverse . (observe \"intermediate\") . reverse $ [1 .. 9] Failed, modules loaded: none.\n</code></pre>\n\n<p>I guess this means that [1..9] should have a clear Type like <code>Int</code> or <code>Float</code>.</p>\n\n<p>Then I change the script like this:</p>\n\n<pre><code>import Debug.Hood.Observe\n\nal :: [Int]\nal = [0..9]\n\nex2 = print\n    . reverse\n    . (observe \"intermediate\")\n    . reverse\n    $ al\nn = runO ex2\n</code></pre>\n\n<p>Now the error is gone, but the output is not as expected. Instead of </p>\n\n<pre><code>[0,1,2,3,4,5,6,7,8,9]\n\n-- intermediate\n  9 : 8 : 7 : 6 : 5 : 4 : 3 : 2 : 1 : 0 : []\n</code></pre>\n\n<p>the output is</p>\n\n<pre><code>*Main&gt; n\n[0,1,2,3,4,5,6,7,8,9]\n\n\n*Main&gt;\n</code></pre>\n\n<p>The package is old I think, it was last updated for ghc-6.x and I use ghc-8. Is this the reason that it does not work or am I missing something else?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1529405467, "post_id": 50915526, "comment_id": 88852200, "body": "I went ahead and edited the title of your question. Hope you don\u2019t mind!"}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 37, "last_activity_date": 1543251954, "last_edit_date": 1543251954, "creation_date": 1529351967, "answer_id": 50916648, "question_id": 50915526, "link": "https://stackoverflow.com/questions/50915526/what-are-prisms/50916648#50916648", "title": "What are Prisms?", "body": "<p><strong>Lenses characterise the <em>has-a</em> relationship; Prisms characterise the <em>is-a</em> relationship.</strong></p>\n\n<p>A <code>Lens s a</code> says \"<code>s</code> <em>has an</em> <code>a</code>\"; it has methods to get exactly one <code>a</code> from an <code>s</code> and to overwrite exactly one <code>a</code> in an <code>s</code>. A <code>Prism s a</code> says \"<code>a</code> <em>is an</em> <code>s</code>\"; it has methods to upcast an <code>a</code> to an <code>s</code> and to (attempt to) downcast an <code>s</code> to an <code>a</code>.</p>\n\n<p>Putting that intuition into code gives you the familiar \"get-set\" (or \"costate comonad coalgebra\") formulation of lenses,</p>\n\n<pre><code>data Lens s a = Lens {\n    get :: s -&gt; a,\n    set :: a -&gt; s -&gt; s\n}\n</code></pre>\n\n<p>and an \"upcast-downcast\" representation of prisms,</p>\n\n<pre><code>data Prism s a = Prism {\n    up :: a -&gt; s,\n    down :: s -&gt; Maybe a\n}\n</code></pre>\n\n<p><code>up</code> injects an <code>a</code> into <code>s</code> (without adding any information), and <code>down</code> tests whether the <code>s</code> is an <code>a</code>.</p>\n\n<p>In <code>lens</code>, <code>up</code> is spelled <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Review.html#v:review\" rel=\"noreferrer\"><code>review</code></a> and <code>down</code> is <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Fold.html#v:preview\" rel=\"noreferrer\"><code>preview</code></a>. There\u2019s no <code>Prism</code> constructor; you use <a href=\"https://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Prism.html#v:prism-39-\" rel=\"noreferrer\">the <code>prism'</code> smart constructor</a>.</p>\n\n<hr>\n\n<p>What can you do with a <code>Prism</code>? Inject and project sum types!</p>\n\n<pre><code>_Left :: Prism (Either a b) a\n_Left = Prism {\n    up = Left,\n    down = either Just (const Nothing)\n}\n_Right :: Prism (Either a b) b\n_Right = Prism {\n    up = Right,\n    down = either (const Nothing) Just\n}\n</code></pre>\n\n<p>Lenses don't support this - you can't write a <code>Lens (Either a b) a</code> because you can't implement <code>get :: Either a b -&gt; a</code>. As a practical matter, you <em>can</em> write a <code>Traversal (Either a b) a</code>, but that doesn't allow you to create an <code>Either a b</code> from an <code>a</code> - it'll only let you overwrite an <code>a</code> which is already there.</p>\n\n<blockquote>\n  <p><strong>Aside:</strong> I think this subtle point about <code>Traversal</code>s is the source of your confusion about partial record fields.</p>\n  \n  <blockquote>\n    <p><code>^?</code> with plain lenses allows getting <code>Nothing</code> if the field in question doesn't belong to the branch the entity represents</p>\n  </blockquote>\n  \n  <p>Using <code>^?</code> with a real <code>Lens</code> will never return <code>Nothing</code>, because a <code>Lens s a</code> identifies exactly one <code>a</code> inside an <code>s</code>.\n  When confronted with a partial record field,</p>\n\n<pre><code>data Wibble = Wobble { _wobble :: Int } | Wubble { _wubble :: Bool }\n</code></pre>\n  \n  <p><code>makeLenses</code> will generate a <code>Traversal</code>, not a <code>Lens</code>.</p>\n\n<pre><code>wobble :: Traversal' Wibble Int\nwubble :: Traversal' Wibble Bool\n</code></pre>\n</blockquote>\n\n<p>For an example of this how <code>Prism</code>s can be applied in practice, look to <a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Exception-Lens.html\" rel=\"noreferrer\"><code>Control.Exception.Lens</code></a>, which provides a collection of <code>Prism</code>s into Haskell's extensible <code>Exception</code> hierarchy. This lets you perform runtime type tests on <code>SomeException</code>s and inject specific exceptions into <code>SomeException</code>.</p>\n\n<pre><code>_ArithException :: Prism' SomeException ArithException\n_AsyncException :: Prism' SomeException AsyncException\n-- etc.\n</code></pre>\n\n<p>(These are slightly simplified versions of the actual types. In reality these prisms are overloaded class methods.)</p>\n\n<p>Thinking at a higher level, certain whole programs can be thought of as being \"basically a <code>Prism</code>\". Encoding and decoding data is one example: you can always convert structured data to a <code>String</code>, but not every <code>String</code> can be parsed back:</p>\n\n<pre><code>showRead :: (Show a, Read a) =&gt; Prism String a\nshowRead = Prism {\n    up = show,\n    down = listToMaybe . fmap fst . reads\n}\n</code></pre>\n\n<p>To summarise, <code>Lens</code>es and <code>Prism</code>s together encode the two core design tools of object-oriented programming, composition and subtyping. <code>Lens</code>es are a first-class version of Java's <code>.</code> and <code>=</code> operators, and <code>Prism</code>s are a first-class version of Java's <code>instanceof</code> and implicit upcasting.</p>\n\n<hr>\n\n<p>One fruitful way of thinking about <code>Lens</code>es is that they give you a way of splitting up a composite <code>s</code> into a focused value <code>a</code> and some context <code>c</code>. Pseudocode:</p>\n\n<pre><code>type Lens s a = exists c. s &lt;-&gt; (a, c)\n</code></pre>\n\n<p>In this framework, a <code>Prism</code> gives you a way to look at an <code>s</code> as being either an <code>a</code> or some context <code>c</code>.</p>\n\n<pre><code>type Prism s a = exists c. s &lt;-&gt; Either a c\n</code></pre>\n\n<p>(I'll leave it to you to convince yourself that these are isomorphic to the simple representations I demonstrated above. Try implementing <code>get</code>/<code>set</code>/<code>up</code>/<code>down</code> for these types!)</p>\n\n<p>In this sense a <code>Prism</code> is a <em>co-<code>Lens</code></em>. <code>Either</code> is the categorical dual of <code>(,)</code>; <code>Prism</code> is the categorical dual of <code>Lens</code>.</p>\n\n<p>You can also observe this duality in the <a href=\"http://www.cs.ox.ac.uk/people/jeremy.gibbons/publications/poptics.pdf\" rel=\"noreferrer\">\"profunctor optics\"</a> formulation - <a href=\"http://hackage.haskell.org/package/profunctors-5.2.2/docs/Data-Profunctor.html#t:Strong\" rel=\"noreferrer\"><code>Strong</code></a> and <a href=\"http://hackage.haskell.org/package/profunctors-5.2.2/docs/Data-Profunctor.html#t:Choice\" rel=\"noreferrer\"><code>Choice</code></a> are dual.</p>\n\n<pre><code>type Lens  s t a b = forall p. Strong p =&gt; p a b -&gt; p s t\ntype Prism s t a b = forall p. Choice p =&gt; p a b -&gt; p s t\n</code></pre>\n\n<p>This is more or less the representation which <code>lens</code> uses, because these <code>Lens</code>es and <code>Prism</code>s are very composable. You can compose <code>Prism</code>s to get bigger <code>Prism</code>s (\"<code>a</code> <em>is an</em> <code>s</code>, which <em>is a</em> <code>p</code>\") using <code>(.)</code>; composing a <code>Prism</code> with a <code>Lens</code> gives you a <code>Traversal</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 16, "last_activity_date": 1529355682, "creation_date": 1529355682, "answer_id": 50917397, "question_id": 50915526, "link": "https://stackoverflow.com/questions/50915526/what-are-prisms/50917397#50917397", "title": "What are Prisms?", "body": "<p>I just wrote a blog post, which might help build some intuition about Prisms: <em>Prisms are constructors</em> (Lenses are fields). <a href=\"http://oleg.fi/gists/posts/2018-06-19-prisms-are-constructors.html\" rel=\"noreferrer\">http://oleg.fi/gists/posts/2018-06-19-prisms-are-constructors.html</a></p>\n\n<hr>\n\n<p>Prisms could be introduced as <em>first-class pattern matching</em>, but that is a\none-sided view. I'd say they are <strong>generalised constructors</strong>, though maybe\nmore often used for pattern matching than for actual construction.</p>\n\n<p>The important property of constructors (and <em>lawful prisms</em>), is their\ninjectivity.  Though the usual prism laws don't state that directly,\ninjectivity property can be deduced.</p>\n\n<p>To quote <code>lens</code>-library documentation, the prisms laws are:</p>\n\n<p>First, if I <code>review</code> a value with a <code>Prism</code> and then <code>preview</code>, I will get it back:</p>\n\n<pre><code>preview l (review l b) \u2261 Just b\n</code></pre>\n\n<p>Second, if you can extract a value a using a <code>Prism</code> <code>l</code> from a value <code>s</code>, then\nthe value <code>s</code> is completely described by <code>l</code> and <code>a</code>:</p>\n\n<pre><code>preview l s \u2261 Just a \u21d2 review l a \u2261 s\n</code></pre>\n\n<p>In fact, the first law alone is enough to prove the injectivity of construction\nvia <code>Prism</code>:</p>\n\n<pre><code>review l x \u2261 review l y \u21d2 x \u2261 y\n</code></pre>\n\n<p>The proof is straight-forward:</p>\n\n<pre><code>review l x \u2261 review l y\n  -- x \u2261 y -&gt; f x \u2261 f y\npreview l (review l x) \u2261 preview l (review l y)\n  -- rewrite both sides with the first law\nJust x \u2261 Just y\n  -- injectivity of Just\nx \u2261 y\n</code></pre>\n\n<p>We can use injectivity property as an additional tool in the equational\nreasoning toolbox. Or we can use it as a easy property to check to decide\nwhether something is a lawful <code>Prism</code>.  The check is easy as we only the\n<code>review</code> side of <code>Prism</code>. Many <em>smart constructors</em>, which for example\nnormalise the input data, aren't lawful prisms.</p>\n\n<p>An example using <a href=\"https://hackage.haskell.org/package/case-insensitive-1.2.0.11\" rel=\"noreferrer\"><code>case-insensitive</code></a>:</p>\n\n<pre><code>-- Bad!\n_CI :: FoldCase s =&gt; Prism' (CI s) s\n_CI = prism' ci (Just . foldedCase)\n\n\u03bb&gt; review _CI \"FOO\" == review _CI \"foo\"\nTrue\n\n\u03bb&gt; \"FOO\" == \"foo\"\nFalse\n</code></pre>\n\n<p>The first law is also violated:</p>\n\n<pre><code>\u03bb&gt; preview _CI (review _CI \"FOO\")\nJust \"foo\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 10, "last_activity_date": 1529373781, "creation_date": 1529373781, "answer_id": 50919684, "question_id": 50915526, "link": "https://stackoverflow.com/questions/50915526/what-are-prisms/50919684#50919684", "title": "What are Prisms?", "body": "<p>In addition to the other excellent answers, I feel <code>Iso</code>s provide a nice vantage point for considering this matter.</p>\n\n<ul>\n<li><p>There being some <code>i :: Iso' s a</code> means if you have an <code>s</code> value you also (virtually) have an <code>a</code> value, and vice versa. The <code>Iso'</code> gives you two conversion functions, <code>view i :: s -&gt; a</code> and <code>review i :: a -&gt; s</code> which are both guaranteed to succeed and lossless.</p></li>\n<li><p>There being some <code>l :: Lens' s a</code> means if you have an <code>s</code> you also have an <code>a</code>, <em>but not vice versa</em>. <code>view l :: s -&gt; a</code> may drop information along the way, as the conversion isn't required to be lossless, and so you can't go the other way if all you have is an <code>a</code> (cf. <code>set l :: a -&gt; s -&gt; s</code>, which also requires an <code>s</code> in addition to the <code>a</code> value in order to provide the missing information).</p></li>\n<li>There being some <code>p :: Prism' s a</code> means if you have an <code>s</code> value you <em>might</em> also have an <code>a</code>, but there are no guarantees. The conversion <code>preview p :: s -&gt; Maybe a</code> is not guaranteed to succeed. Still, you do have the other direction, <code>review p :: a -&gt; s</code>.</li>\n</ul>\n\n<p>In other words, an <code>Iso</code> is invertible and always succeeds. If you drop the invertibility requirement, you get a <code>Lens</code>; if you drop the success guarantee, you get a <code>Prism</code>. If you drop both, you get an <a href=\"http://oleg.fi/gists/posts/2017-04-18-glassery.html#s:17\" rel=\"noreferrer\">affine traversal</a> (which is not in <em>lens</em> as a separate type), and if you go a step further and give up on having at most one target you end up with a <code>Traversal</code>. That is reflected in one of the diamonds of <a href=\"https://i.imgur.com/4fHw3Fd.png\" rel=\"noreferrer\">the <em>lens</em> subtype hierarchy</a>:</p>\n\n<pre><code> Traversal\n    / \\\n   /   \\\n  /     \\\nLens   Prism\n  \\     /\n   \\   /\n    \\ /\n    Iso\n</code></pre>\n"}], "owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2971, "favorite_count": 9, "accepted_answer_id": 50916648, "answer_count": 3, "score": 40, "last_activity_date": 1543251954, "creation_date": 1529346854, "last_edit_date": 1529405418, "question_id": 50915526, "link": "https://stackoverflow.com/questions/50915526/what-are-prisms", "title": "What are Prisms?", "body": "<p>I'm trying to achieve a deeper understanding of <code>lens</code> library, so I play around with the types it offers. I have already had some experience with lenses, and know how powerful and convenient they are. So I moved on to Prisms, and I'm a bit lost. It seems that prisms allow two things:</p>\n\n<ol>\n<li>Determining if an entity belongs to a particular branch of a sum type, and if it does, capturing the underlying data in a tuple or a singleton.</li>\n<li>Destructuring and reconstructing an entity, possibly modifying it in process.</li>\n</ol>\n\n<p>The first point seems useful, but usually one doesn't need all the data from an entity, and <code>^?</code> with plain lenses allows getting <code>Nothing</code> if the field in question doesn't belong to the branch the entity represents, just like it does with prisms.</p>\n\n<p>The second point... I don't know, might have uses?</p>\n\n<p>So the question is: what can I do with a Prism that I can't with other optics?</p>\n\n<p><strong>Edit</strong>: thank you everyone for excellent answers and links for further reading! I wish I could accept them all.</p>\n"}, {"tags": ["haskell", "functional-programming", "yesod"], "owner": {"reputation": 1038, "user_id": 5039732, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/91e2e94db1438fffba31086b97ddb9f3?s=128&d=identicon&r=PG&f=1", "display_name": "Neel0507", "link": "https://stackoverflow.com/users/5039732/neel0507"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 2, "answer_count": 0, "score": 2, "last_activity_date": 1529362226, "creation_date": 1529339641, "last_edit_date": 1529362226, "question_id": 50913908, "link": "https://stackoverflow.com/questions/50913908/yesod-integrating-yesod-auth-account-1-4-3-with-the-scaffolding-site", "title": "Yesod - Integrating Yesod-Auth-Account 1.4.3 with the scaffolding site", "body": "<p>I am trying to use Account authentication plugin of Yesod in the scaffolding site. The scaffolding site on its own works fine and plugin on its own works fine, however, when I try to integrate the plugin in the project either through by adding the extra dependency in the stack.yaml file (i.e. (extra-deps: [yesod-auth-account-1.4.3]) or without adding the dependency where I have to  make a lot of changes in my project, in both cases stack build fails with the following error coming from the Account.hs file:</p>\n\n<pre><code>Couldn't match type \u2018UserAccount db0\u2019 with \u2018UserAccount db\u2019\n      Expected type: UserAccount db\n                     -&gt; HandlerT Auth (HandlerT master IO) Html\n        Actual type: UserAccount db0\n                     -&gt; HandlerT Auth (HandlerT master0 IO) Html\n      NB: \u2018UserAccount\u2019 is a type function, and may not be injective\n      The type variable \u2018db0\u2019 is ambiguous\n    \u2022 In the ambiguity check for \u2018unregisteredLogin\u2019\n      To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\n      When checking the class method:\n        unregisteredLogin :: forall (db :: * -&gt; *) master.\n                             YesodAuthAccount db master =&gt;\n                             UserAccount db -&gt; HandlerT Auth (HandlerT master IO) Html\n      In the class declaration for \u2018YesodAuthAccount\u2019\n    |\n806 |     unregisteredLogin :: UserAccount db -&gt; HandlerT Auth (HandlerT master IO) Html\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I have seen some solutions online regarding adding \"liftHandler .\" for each runDB action and using \"Proxy master\", however they do not seem to work.</p>\n\n<p>My guess here is that there is a database conflict in the project, as the scaffolding site uses a sample database for dummy login which is not recommended for production version. As a result, I am looking for an efficient authentication plugin.</p>\n\n<p>Any type of help would be appreciated.</p>\n\n<p>Thanks in advance. </p>\n"}, {"tags": ["haskell", "type-theory", "fixpoint-combinators"], "comments": [{"owner": {"reputation": 2958, "user_id": 781723, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/mYIzP.png?s=128&g=1", "display_name": "D.W.", "link": "https://stackoverflow.com/users/781723/d-w"}, "edited": false, "score": 1, "creation_date": 1529341036, "post_id": 50911735, "comment_id": 88828517, "body": "Cross-posted: <a href=\"https://stackoverflow.com/q/50911735/781723\">stackoverflow.com/q/50911735/781723</a>, <a href=\"https://cs.stackexchange.com/q/93207/755\">cs.stackexchange.com/q/93207/755</a>.  Please <a href=\"https://meta.stackexchange.com/q/64068\">do not post the same question on multiple sites</a>. Each community should have an honest shot at answering without anybody&#39;s time being wasted."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1529430722, "post_id": 50911735, "comment_id": 88867089, "body": "You might try defining <a href=\"https://en.wikipedia.org/wiki/SKI_combinator_calculus\" rel=\"nofollow noreferrer\">SKI combinators</a> at the type level, which would allow you to express the type level function without a dedicated newtype.  Fun to play with, but it gets very messy."}, {"owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1529437494, "post_id": 50911735, "comment_id": 88870321, "body": "@luqui But if you are able to do that it means that type checking is not decidable. My goal in restricting myself to such a weak type theory is to get fully inferred types, so I don&#39;t need to add type definitions nor declarations and programs are simple strings of composed combinators without type declarations nor signatures."}], "answers": [{"comments": [{"owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "edited": false, "score": 0, "creation_date": 1529333624, "post_id": 50911956, "comment_id": 88824435, "body": "Are type level functions the only way? They are an overkill for what I&#39;m trying to do."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "edited": false, "score": 0, "creation_date": 1529335860, "post_id": 50911956, "comment_id": 88825893, "body": "@user3368561 The answer states that you <i>cannot</i> use type-level functions. What do you mean by this?"}, {"owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1529336291, "post_id": 50911956, "comment_id": 88826120, "body": "@AJFarmar Not in (current) Haskell, yes, but my question is more general and isn&#39;t strictly linked to it. I have no problem problem with theoretical answers."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "edited": false, "score": 0, "creation_date": 1529340294, "post_id": 50911956, "comment_id": 88828176, "body": "@user3368561 Well, how would you type <code>nilMu :: Mu ??</code> without a type level function?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1529351470, "post_id": 50911956, "comment_id": 88833090, "body": "Another angle on why Haskell doesn\u2019t allow type-level functions (and therefore also doesn\u2019t allow partially applied type synonyms) is that it would make higher-kinded polymorphism require higher-order unification to solve, which is not decidable in general; as it is, given <code>a x ~ b y</code>, the compiler can always deduce <code>a ~ b</code> and <code>x ~ y</code>, which is very convenient for both programmer reasoning and compiler performance."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1529333427, "last_edit_date": 1529333427, "creation_date": 1529332726, "answer_id": 50911956, "question_id": 50911735, "link": "https://stackoverflow.com/questions/50911735/define-lists-with-least-fixed-point-sum-and-product-types/50911956#50911956", "title": "Define lists with least fixed point, sum, and product types", "body": "<p>You can not do it without an additional <code>data</code> or <code>newtype</code>, in Haskell. </p>\n\n<p>To do it, one would need to write</p>\n\n<pre><code>nilMu :: Mu (\\l -&gt; S (P a l) ())\nconsMu :: a -&gt; Mu (\\l -&gt; S (P a l) ()) -&gt; Mu (\\l -&gt; S (P a l) ())\n</code></pre>\n\n<p>but Haskell does not allow type-level functions in this way. <code>Mu</code> can only be applied to a type constructor of kind <code>* -&gt; *</code>, not a type-level function of the same kind.</p>\n\n<pre><code>nilMu :: Mu (F a)\nconsMu :: a -&gt; Mu (F a) -&gt; Mu (F a)\n</code></pre>\n\n<p>where <code>F a</code> is defined as an additional type</p>\n\n<pre><code>newtype F a x = F (S (P a x) ())\n</code></pre>\n\n<hr>\n\n<p>For the reason why Haskell does not allow type level functions, consider</p>\n\n<pre><code>assuming foo :: f a -&gt; f Char\ninfer    foo True :: ???\n</code></pre>\n\n<p>One might argue that in <code>foo True</code>, <code>True</code> is a <code>Bool</code>, so we can infer <code>f = \\t-&gt;t</code> and <code>a = Bool</code>. The result is <code>foo True :: (\\t-&gt;t) Char = Char</code>.</p>\n\n<p>One might also argue that we can infer <code>f = \\t-&gt;Bool</code> and <code>a = String</code>, and that the result is <code>foo True :: (\\t-&gt;Bool) Char = Bool</code></p>\n\n<p>In general, we do not like that. We want type inference to proceed by pattern matching <code>f</code> and <code>a</code> against the actual type. For that, we want both <code>f</code> and <code>a</code> to have a correspondent \"obvious\" <em>name</em> in the actual type.</p>\n\n<p>For what it is worth, you <em>can</em> do this in dependently type languages, such as Coq, Agda, Idris, etc. There, type inference will not work on code like <code>foo True</code> above, since <code>f</code> can not be inferred. Worse, in these languages, if <code>bar ::  f a -&gt; ...</code> and we call <code>bar [True]</code>, then <code>f</code> could fail to be inferred to <code>[]</code> because this is not the only solution (they do have good heuristics, though, which often work anyway, even if the general problem is undecidable).</p>\n"}], "owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 50911956, "answer_count": 1, "score": 2, "last_activity_date": 1562457103, "creation_date": 1529332053, "last_edit_date": 1562457103, "question_id": 50911735, "link": "https://stackoverflow.com/questions/50911735/define-lists-with-least-fixed-point-sum-and-product-types", "title": "Define lists with least fixed point, sum, and product types", "body": "<p>I want to define lists using only this type definitions:</p>\n\n<pre><code>data Unit = Unit\ndata Prod a b = P a b\ndata Sum a b = L a | R b\nnewtype Mu f = Mu (forall a . (f a -&gt; a) -&gt; a)\n</code></pre>\n\n<p>I succeeded defining natural numbers as follows:</p>\n\n<pre><code>zeroMu = Mu $ \\f -&gt; f $ L Unit\nsuccMu (Mu g) = Mu $ \\f -&gt; f $ R $ g f\n</code></pre>\n\n<p>I know how to define lists with the help of an extra data type:</p>\n\n<pre><code>data ListF a x = NilF | ConsF a x\nnilMu' = Mu $ \\f -&gt; f $ NilF\nconsMu' x (Mu g) = Mu $ \\f -&gt; f $ ConsF x $ g f\n</code></pre>\n\n<p>The 'better' I can get is this, but it does not type-checks (intended type is \u00b5L.(1+(a*L))):</p>\n\n<pre><code>nilMu = Mu $ \\f -&gt; f $ L Unit\nconsMu x (Mu g) = Mu $ \\f -&gt; f $ R $ P x $ g f\n</code></pre>\n\n<p>How can I define <code>nilMu</code> and <code>consMu</code> using only previously defined types and their constructors?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>As @chi answer explains, it can be done defining a <code>newtype</code> as follows:</p>\n\n<pre><code>newtype F a x = F (Sum Unit (Prod a x))\nnilMu = Mu $ \\f -&gt; f $ F $ L Unit\nconsMu x (Mu g) = Mu $ \\f -&gt; f $ F $ R $ P x $ g f\n</code></pre>\n\n<p>It type-checks, but requires to define a new type.</p>\n\n<p>The intend of this question is to extend a simply typed combinatory logic with unit, product, sum, and recursive types. First three types are straightforward to implement introducing 7 new combinators (<code>unit</code>, <code>pair</code>, <code>first</code>, <code>second</code>, <code>left</code>, <code>right</code>, <code>case</code>). Recursive types seems easy to implement too, just add a type constructor combinator <code>mu</code>, but as this questoins shows is not flexible enough without additional language constructs.</p>\n\n<p>Is there a solution to this problem? Are there combinatory logics with recursive types to consult?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1529330000, "post_id": 50910255, "comment_id": 88822076, "body": "Wow! Thanks for your answer. I still need to learn a lot. I&#39;ll go with Data.Sequence. I didn&#39;t know Vectors must be copy when appending."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 6, "last_activity_date": 1529327242, "creation_date": 1529327242, "answer_id": 50910255, "question_id": 50909765, "link": "https://stackoverflow.com/questions/50909765/are-sequences-faster-than-vectors-for-searching-in-haskell/50910255#50910255", "title": "Are sequences faster than vectors for searching in haskell?", "body": "<p>No, sequences are not faster for searching. A <code>Vector</code> is just a flat chunk of memory, which gives generally the best lookup performance. If you want to optimise searching, use <code>Data.Vector.Unboxed</code>. (The normal, \u201cboxed\u201d variant is also pretty good, but it actually contains only <em>references</em> to the elements in the flat memory-chunk, so it's not quite as fast for lookups.)</p>\n\n<p>However, because of the flat memory layout, <code>Vector</code>s are <em>not</em> good for (pure-functional) appending: basically, whenever you add a new element, the whole array must be copied so as to not invalidate the old one (which somebody else might still be using). If you need to append, <code>Seq</code> is a pretty good choice, although it's not as fast as <em>destructive</em> appending: for maximum peformance, you'll want to pre-allocate an uninitialized <a href=\"http://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector-Unboxed-Mutable.html\" rel=\"noreferrer\"><code>Data.Vector.Unboxed.Mutable.MVector</code></a> of the required size, populate it using the <code>ST</code> monad, and freeze the result. But this is much more fiddly than purely-functional alternatives, so unless you need to squeeze out every bit of performance, <code>Data.Sequence</code> is the way to go. If you <em>only</em> want to append, but not look up elements, then a plain old list in reverse order would also do the trick.</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1529327943, "post_id": 50910389, "comment_id": 88820813, "body": "Right. Although I&#39;d remark that for small-ish sequences, even a brute-force search through an unboxed vector is often faster than a lookup in <code>Data.Map</code> due to its much better cache locality. And a binary search through an <i>ordered</i> vector gives the best of both worlds. The only real problem with vectors is the creation."}, {"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1529328675, "post_id": 50910389, "comment_id": 88821298, "body": "Interesting. Helpful for me, and intermediate Haskeler, but I think this might be a little much for someone new to haskell data structures."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1529330122, "post_id": 50910389, "comment_id": 88822156, "body": "Interesting approach. I wil give It a try!"}], "tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": true, "score": 4, "last_activity_date": 1529327967, "last_edit_date": 1529327967, "creation_date": 1529327682, "answer_id": 50910389, "question_id": 50909765, "link": "https://stackoverflow.com/questions/50909765/are-sequences-faster-than-vectors-for-searching-in-haskell/50910389#50910389", "title": "Are sequences faster than vectors for searching in haskell?", "body": "<p>I suggest using <code>Data.Sequence</code> in conjunction with <code>Data.Set</code>. The <code>Sequence</code> to hold the sequence of values and the <code>Set</code> to track the collection. </p>\n\n<p><code>Sequence</code>, <code>List</code>, and <code>Vector</code> are all structures for working with values where the position in the structure has primary importance when it comes to indexing. In lists we can manipulate elements at the front efficiently, in sequences we can manipulate elements based on the log of the distance the closest end, and in vectors we can access any element in constant time. Vectors however, are not that useful if the length keeps changing, so that rules out their use here.</p>\n\n<p>However, you also need to lookup a certain value within the list, which these structures don't help with. You have to search the whole of a list/sequence/vector to be certain that a new value isn't present. <code>Data.Map</code> and <code>Data.Set</code> are two of the structures for which you define an index value based on <code>Ord</code>, and let you lookup/insert in <code>log(n)</code>. So, at the cost of memory usage you can lookup the presence of <code>firstElem</code> in your Set in <code>log(n)</code> time and then add <code>newElem</code> to the end of the sequence in constant time. Just make sure to keep these two structures in synch when adding or taking new elements.</p>\n"}], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 0, "accepted_answer_id": 50910389, "answer_count": 2, "score": 3, "last_activity_date": 1529327967, "creation_date": 1529325605, "question_id": 50909765, "link": "https://stackoverflow.com/questions/50909765/are-sequences-faster-than-vectors-for-searching-in-haskell", "title": "Are sequences faster than vectors for searching in haskell?", "body": "<p>I am kind of new using data structures in haskell besides of Lists. My goal is to chose one container among <code>Data.Vector</code>, <code>Data.Sequence</code>, <code>Data.List</code>, etc ... My problem is the following:</p>\n\n<p>I have to create a sequence (mathematically speaking). The sequence starts at 0. In each iteration two new elements are generated but only one should be appended based in whether the first element is already in the sequence. So in each iteration there is a call to <code>elem</code> function (see the pseudo-code below).</p>\n\n<pre><code>appendNewItem :: [Integer] -&gt; [Integer]\nappendNewItem acc = let firstElem  = someFunc\n                        secondElem = someOtherFunc\n                        newElem    = if firstElem `elem` acc \n                                        then secondElem\n                                        else firstElem\n                    in  acc `append` newElem\n\nsequenceUptoN :: Int -&gt; [Integer]\nsequenceUptoN n = (iterate appendNewItem [0]) !! n\n</code></pre>\n\n<p>Where <code>append</code> and <code>iterate</code> functions vary depending on which colection you use (I am using lists in the type signature for simplicity).</p>\n\n<p>The question is: Which data structure should I use?. Is <code>Data.Sequence</code> faster for this task because of the Finger Tree inner structure? </p>\n\n<p>Thanks a lot!!</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "edited": false, "score": 0, "creation_date": 1529322504, "post_id": 50908800, "comment_id": 88817415, "body": "Could you elaborate on what you meant in the second context?"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "reply_to_user": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "edited": false, "score": 0, "creation_date": 1529322732, "post_id": 50908800, "comment_id": 88817553, "body": "Well, actually I have another <a href=\"https://stackoverflow.com/questions/50907117/how-does-lazy-evaluation-works-when-the-argument-is-a-list\">post</a> related to this question. And it should run on the second way. But I don&#39;t know why."}, {"owner": {"reputation": 4295, "user_id": 1916893, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/XTlc8.png?s=128&g=1", "display_name": "TobiMcNamobi", "link": "https://stackoverflow.com/users/1916893/tobimcnamobi"}, "edited": false, "score": 0, "creation_date": 1529323034, "post_id": 50908800, "comment_id": 88817752, "body": "How is <code>doubleMe</code> implemented?"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1529323187, "post_id": 50908800, "comment_id": 88817875, "body": "I don&#39;t have its implementation. It is simply stated in a haskell tutorial, just like what I put in my question."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529329409, "post_id": 50908800, "comment_id": 88821724, "body": "<code>1</code> is not a list (without some odd and unusual code lying around), so you certainly won&#39;t see <code>doubleMe(doubleMe(doubleMe(1)))</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1529322688, "creation_date": 1529322688, "answer_id": 50908905, "question_id": 50908800, "link": "https://stackoverflow.com/questions/50908800/will-lazy-function-pass-through-the-argument-at-once-when-the-argument-is-a-list/50908905#50908905", "title": "Will lazy function pass through the argument at once when the argument is a list?", "body": "<p>Assuming <code>doubleMe</code> is lazily implemented, it is evaluated like this:</p>\n\n<pre><code>doubleMe (doubleMe (1:2:3:[]))\n= doubleMe (2 : doubleMe (2:3:[]))\n= 4 : doubleMe (doubleMe (2:3:[]))\n= 4 : doubleMe (4 : doubleMe (3:[]))\n= 4 : 8 : doubleMe (doubleMe (3:[]))\n= 4 : 8 : doubleMe (6 : doubleMe [])\n= 4 : 8 : 12 : doubleMe (doubleMe [])\n= 4 : 8 : 12 : doubleMe []\n= 4 : 8 : 12 : []\n</code></pre>\n\n<p>With three nested calls, instead of two, the evaluation is analogous.</p>\n\n<p>Essentially, the evaluation strategy finds the <em>outermost</em> <code>doubleMe</code> call which has an argument in weak head normal form -- i.e., either <code>[]</code> or of the form <code>x : xs</code>. Then it applies the definition:</p>\n\n<pre><code>doubleMe [] =&gt; []\ndoubleMe (x:xs) =&gt; (2*x) : doubleMe xs\n</code></pre>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "closed_date": 1529323883, "accepted_answer_id": 50908905, "answer_count": 1, "score": 1, "last_activity_date": 1529322688, "creation_date": 1529322327, "question_id": 50908800, "link": "https://stackoverflow.com/questions/50908800/will-lazy-function-pass-through-the-argument-at-once-when-the-argument-is-a-list", "closed_reason": "Duplicate", "title": "Will lazy function pass through the argument at once when the argument is a list?", "body": "<p>Say you have an immutable list of numbers <code>xs = [1,2,3,4,5,6,7,8]</code> and a function <strong>doubleMe</strong> which multiplies every element by 2 and then returns a new list.</p>\n\n<p>When we call <code>doubleMe(doubleMe(doubleMe(xs)))</code>, how will the lazy function works?</p>\n\n<pre><code>doubleMe([1,2,3,4,5,6,7,8]) -&gt; doubleMe(doubleMe([1,2,3,4,5,6,7,8])) -&gt; doubleMe(doubleMe(doubleMe([1,2,3,4,5,6,7,8])))\n</code></pre>\n\n<p>or</p>\n\n<pre><code>doubleMe(doubleMe(doubleMe(1))) -&gt; doubleMe(doubleMe(doubleMe(2))) -&gt; ... -&gt; doubleMe(doubleMe(doubleMe(8)))\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1529326428, "post_id": 50908163, "comment_id": 88819915, "body": "This may <i>typecheck</i>, but I doubt that it actually <i>works</i>. The <code>Id</code> class as it&#39;s given in the question makes <code>getId :: Id b =&gt; a -&gt; b</code> basically impossible to implement."}], "tags": [], "owner": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "is_accepted": false, "score": 1, "last_activity_date": 1529320292, "creation_date": 1529320292, "answer_id": 50908163, "question_id": 50908083, "link": "https://stackoverflow.com/questions/50908083/typeclass-method-which-returns-another-typeclass-in-haskell/50908163#50908163", "title": "Typeclass method which returns another typeclass in Haskell", "body": "<p>You declared the return value to be a HKT <code>Id a</code>, but what you wanted is another type, constrained by the typeclass <code>Id</code>.</p>\n\n<p>What you need is not <code>getId :: a -&gt; Id a</code>, but <code>getId :: Id b =&gt; a -&gt; b</code></p>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 9956315, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--JwZRWL62ZI/AAAAAAAAAAI/AAAAAAAAACs/5k5bOx41xyI/photo.jpg?sz=128", "display_name": "izotop", "link": "https://stackoverflow.com/users/9956315/izotop"}, "edited": false, "score": 0, "creation_date": 1529336225, "post_id": 50909731, "comment_id": 88826094, "body": "Thank you for your expanded answer! Really appreciate your help. I actually need it for the test tomorrow so once again thank you very much :)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1529326333, "last_edit_date": 1529326333, "creation_date": 1529325530, "answer_id": 50909731, "question_id": 50908083, "link": "https://stackoverflow.com/questions/50908083/typeclass-method-which-returns-another-typeclass-in-haskell/50909731#50909731", "title": "Typeclass method which returns another typeclass in Haskell", "body": "<p>It's important to understand that a Haskell <code>class</code> is very different from a class in OO languages. It's a <em>type class</em>, i.e. it \u201cgroups together a collection of types\u201d, whereas an OO class groups together a collection of <em>values</em>. IOW, an OO class <em>is</em> a type (containing values), but a Haskell class is rather something like a type <em>of types</em>, as it were.</p>\n\n<p>Now, a function/method always takes values as argument and gives back values as results. But it can't give you back a type, nor a \u201cvalue of a typeclass\u201d because there's no such thing.</p>\n\n<p>Instead, the way to use type classes is this: you write a <em>polymorphic function</em>, i.e. a function that accepts or yields some value of unspecified type. That's what <em>type variables</em> are there for. Normally, a polymorphic signature means that the function can deal with values of <em>any</em> type, like with</p>\n\n<pre><code>length :: [a] -&gt; Int\n</code></pre>\n\n<p>which takes a list and doesn't care what type its elements have. But then you say that you do <em>care a bit</em> what types are used, namely, you require that they are in the class. That's a <em>constraint</em>, and it's written with the <code>=&gt;</code> notation. <code>toInt</code> actually has the signature (automatically generated by the class declaration)</p>\n\n<pre><code>toInt :: Id a =&gt; a -&gt; Int\n</code></pre>\n\n<p>Frankly, I doubt that this is really what you want. If all you can do with an <code>Id a</code> is converting it to an <code>Int</code>, then the result effectively <em>is</em> an <code>Int</code> (just with a type-annotation which indicates what kind of object this Id belongs to), regardless of the <code>a</code> parameter. So instead of the <code>Id</code> class, you should consider having an <em><code>Id</code> type</em></p>\n\n<pre><code>newtype Id' a = Id {toInt :: Int}  -- The prime ' symbol has no particular meaning,\n                                   -- I just use it for disambiguation.\n</code></pre>\n\n<p>Then, you have the more sensible type</p>\n\n<pre><code>toInt :: Id' a -&gt; Int\n</code></pre>\n\n<p>without needing any constraints.</p>\n\n<p><code>newtype</code> is much more similar to a OO class, in that it actually defines a concrete type which has values you can pass around.</p>\n\n<p>The <code>getId</code> method is also a constrained-polymorphic function, that can take something which &ldquo;has an <code>Id</code>&rdquo; and gives you back that Id. In this case, a class makes sense (because you can have different data structure that may store their Ids in different ways). This would now actually be</p>\n\n<pre><code>class HasId a where\n  getId :: a -&gt; Id' a\n</code></pre>\n\n<p>As per <a href=\"https://stackoverflow.com/a/50908163/745903\">Welperooni's answer</a>, it is indeed also conveivable to define <code>HasId</code> using your original <code>Id</code> class, just it doesn't really make much sense. <code>Id</code> is the <em>class of all types which can be used as identifyers</em>. You could express that <code>getId</code> can yield an Id of  any such type:</p>\n\n<pre><code>class HasId a where\n  getId :: Id b =&gt; a -&gt; b\n</code></pre>\n\n<p>Note that the result-Id type is now completely independent of the type of object whose Id you want to calculate. <code>b</code> can always be <em>any</em> Id-type. As I said this doesn't make sense: why would you need a whole lot of different types that represent Ids, but require all the <code>HasId</code> types to support <em>all of them</em>?</p>\n\n<p>In fact this cannot be implemented as it stands, because there's no mechanism that allows you to <em>generate</em> an Id of arbitrary <code>Id</code> type. This would require an additional method</p>\n\n<pre><code>class Id a where\n  toInt :: a -&gt; Int\n  fromInt :: Int -&gt; a\n</code></pre>\n\n<p>and now you could do</p>\n\n<pre><code>class HasId a where\n  getId :: Id b =&gt; a -&gt; b\n\ndata SomeObj { objName :: String\n             , objId :: Int }\n\ninstance HasId SomeObj where\n  getId (SomeObj _ i) = fromInt i\n</code></pre>\n\n<p>However, if you require that any <code>Id</code> type is convertible both from and to <code>Int</code>, then these types <em>must</em> be isomorphic to <code>Int</code> itself. Therefore, the <code>newtype Id' a</code> approach is almost certainly better.</p>\n"}], "owner": {"reputation": 31, "user_id": 9956315, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--JwZRWL62ZI/AAAAAAAAAAI/AAAAAAAAACs/5k5bOx41xyI/photo.jpg?sz=128", "display_name": "izotop", "link": "https://stackoverflow.com/users/9956315/izotop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 302, "favorite_count": 0, "accepted_answer_id": 50909731, "answer_count": 2, "score": 0, "last_activity_date": 1529355818, "creation_date": 1529319991, "last_edit_date": 1529355818, "question_id": 50908083, "link": "https://stackoverflow.com/questions/50908083/typeclass-method-which-returns-another-typeclass-in-haskell", "title": "Typeclass method which returns another typeclass in Haskell", "body": "<p>I have this task in which I have to define 2 typeclasses in Haskell. One is simple - it implements Ord and has one method which converts given type to an int. Something like this:</p>\n\n<pre><code>class (Ord a) =&gt; Id a where\n  toInt :: a -&gt; Int\n</code></pre>\n\n<p>But then I have another typeclass <i>HasId</i> which has a method <i>getId</i>. This method should return <i>Id</i> typeclass. So I wrote something like this:</p>\n\n<pre><code>class HasId a where\n  getId :: a -&gt; Id a \n</code></pre>\n\n<p>And I get an error I don't know how to solve. </p>\n\n<pre><code>\u2022 Expected kind \u2018* -&gt; Constraint\u2019, but \u2018Int\u2019 has kind \u2018*\u2019\n\u2022 In the class declaration for \u2018HasId\u2019\n |\n | class (Int a) =&gt; HasId a where     |        ^^^^^\n\n\u2022 Expected a type, but \u2018Id a\u2019 has kind \u2018Constraint\u2019\n\u2022 In the type signature: getId :: a -&gt; Id a\n  In the class declaration for \u2018HasId\u2019\n |\n |  getId :: a -&gt; Id a     |             \n</code></pre>\n\n<p>Can somebody tell me how can I return typeclass in another's typeclass method? \nShould I implement some instance of <i>Id</i> typeclass at first?</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1529318800, "post_id": 50907413, "comment_id": 88815252, "body": "I haven&#39;t tried but I think as you want <code>Ord a</code>, you need something along <code>AppT (ConstT (mkName &quot;Ord&quot;)) (VarT (nkName &quot;a&quot;))</code> ..."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1529346829, "post_id": 50907413, "comment_id": 88831024, "body": "If I recall correctly, from TH&#39;s perspective a constraint is just a <code>Type</code>. (Constraints and types have more or less the same syntax, and with <code>ConstraintKinds</code> turned on a constraint can appear syntactically pretty much anywhere a <code>Type</code> can.)"}], "answers": [{"tags": [], "owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "is_accepted": true, "score": 1, "last_activity_date": 1530652241, "creation_date": 1530652241, "answer_id": 51162858, "question_id": 50907413, "link": "https://stackoverflow.com/questions/50907413/template-haskell-generating-code-for-a-function-signature-with-the-type-class-c/51162858#51162858", "title": "Template Haskell: generating code for a function signature with the type class constraints", "body": "<p>I believe that, as was mentioned in the comments, TH does not draw a distinction between <code>Type</code>s and <code>Constraint</code>s (which kind of makes sense, especially now that <code>ConstraintKinds</code> is around).  I've generally found inspecting the quasiquoted AST for a specific, concrete, example of whatever I'm trying to implement to be useful when working on generating code with TH that the quasiquoters aren't good enough for. For example, in GHCI:</p>\n\n<pre><code>\u03bb&gt; :set -XTemplateHaskell\n\u03bb&gt; import Language.Haskell.TH\n\u03bb&gt; runQ $ [d|f :: Ord a =&gt; a -&gt; a; f = id|]\n[SigD f_1 (ForallT [] [AppT (ConT GHC.Classes.Ord) (VarT a_0)] (AppT (AppT ArrowT (VarT a_0)) (VarT a_0))),ValD (VarP f_1) (NormalB (VarE GHC.Base.id)) []]\n</code></pre>\n\n<p>This shows that the constraint portion is just the <code>Name</code> for <code>Ord</code> applied to the name that you use for the type variable. Note that, at least at this level, the <code>ForallT</code> parameter list is empty, since the <code>a</code> in the type signature wasn't written as an explicit <code>forall a.</code>.</p>\n"}], "owner": {"reputation": 331, "user_id": 5377701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/osnHj.jpg?s=128&g=1", "display_name": "O.Phillips", "link": "https://stackoverflow.com/users/5377701/o-phillips"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 1, "accepted_answer_id": 51162858, "answer_count": 1, "score": 2, "last_activity_date": 1530652241, "creation_date": 1529317640, "last_edit_date": 1529418153, "question_id": 50907413, "link": "https://stackoverflow.com/questions/50907413/template-haskell-generating-code-for-a-function-signature-with-the-type-class-c", "title": "Template Haskell: generating code for a function signature with the type class constraints", "body": "<p>I need to generate code for the function signature with type class constraints, for example:</p>\n\n<pre><code>fun :: (Ord a) =&gt; a -&gt; a\n</code></pre>\n\n<p>I'm using the following signature constructor:</p>\n\n<pre><code>SigD Name Type \n</code></pre>\n\n<p>So, I need to generate a type. My best guess is to use the following constructor:</p>\n\n<pre><code>ForallT [TyVarBndr] Cxt Type\n</code></pre>\n\n<p>It corresponds to the following declaration (as seen at <a href=\"http://hackage.haskell.org/package/template-haskell-2.13.0.0/docs/Language-Haskell-TH.html#t:Type\" rel=\"nofollow noreferrer\">Temaplate Haskell documentation</a>): </p>\n\n<pre><code>forall &lt;vars&gt;. &lt;ctxt&gt; =&gt; &lt;type&gt;\n</code></pre>\n\n<p>But <code>Cxt</code> is just a synonym for the list of <code>Type</code>'s, and I can't find an appropriate constructor of <code>Type</code> for generating a type class constraint. What should I do to generate code for a type class constraint?</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "answers": [{"comments": [{"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1529318773, "post_id": 50907609, "comment_id": 88815226, "body": "If I want the whole list, in which way it will runs? <code>doubleMe(doubleMe(doubleMe(xs)))</code> or <code>doubleMe(doubleMe(doubleMe(1)))</code> <code>doubleMe(doubleMe(doubleMe(2)))</code>...?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 1, "creation_date": 1529319277, "post_id": 50907609, "comment_id": 88815514, "body": "@user8314628 If you have another question, open another question elsewhere, not in the comments."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1529319418, "post_id": 50907609, "comment_id": 88815599, "body": "@user8314628 I agree with @AJFarmar that another question might be appropriate. If you decide to open a new question, we&#39;re going to need the definition of <code>doubleMe</code> if we&#39;re to have any chance of answering that question."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1529319556, "post_id": 50907609, "comment_id": 88815665, "body": "Ok, I thought this would be part of my original question."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1529324565, "post_id": 50907609, "comment_id": 88818751, "body": "@user8314628 I don&#39;t know how to answer that question when I don&#39;t know what <code>doubleMe</code> is, or how it&#39;s implemented."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 6, "last_activity_date": 1529318254, "creation_date": 1529318254, "answer_id": 50907609, "question_id": 50907117, "link": "https://stackoverflow.com/questions/50907117/how-does-lazy-evaluation-works-when-the-argument-is-a-list/50907609#50907609", "title": "How does lazy evaluation works when the argument is a list?", "body": "<p>A list like <code>[1,2,3,4,5,6,7,8]</code> is just syntactic sugar for this: <code>1:2:3:4:5:6:7:8:[]</code>.</p>\n\n<p>In this case, all the values in the list are numeric constants, but we could define another, smaller list like this:</p>\n\n<pre><code>1:1+1:[]\n</code></pre>\n\n<p>All Haskell lists are linked lists, which means that they have a <em>head</em> and a <em>tail</em>. In the above example, the head is <code>1</code>, and the tail is <code>1+1:[]</code>.</p>\n\n<p>If you only want the head of the list, there's no reason to evaluate the rest of the list:</p>\n\n<pre><code>(h:_) = 1:1+1:[]\n</code></pre>\n\n<p>Here, <code>h</code> refers to <code>1</code>. There's no reason to evaluate the rest of the list (<code>1+1:[]</code>) if <code>h</code> is all you need.</p>\n\n<p>That's how lists are lazily evaluated. <code>1+1</code> remains a <em>thunk</em> (an unevaluated expression) until the value is required.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 50907609, "answer_count": 1, "score": 2, "last_activity_date": 1529318322, "creation_date": 1529316646, "last_edit_date": 1529318322, "question_id": 50907117, "link": "https://stackoverflow.com/questions/50907117/how-does-lazy-evaluation-works-when-the-argument-is-a-list", "title": "How does lazy evaluation works when the argument is a list?", "body": "<p>From my understanding, lazy evaluation is the arguments are not evaluated before they are passed to a function, but only when their values are actually used. </p>\n\n<p>But in a haskell tutorial, I see an example.</p>\n\n<pre><code>xs = [1,2,3,4,5,6,7,8] \n\ndoubleMe(doubleMe(doubleMe(xs)))\n</code></pre>\n\n<p>The author said an imperative language would probably pass through the list once and make a copy and then return it. Then it would pass through the list another two times and return the result.</p>\n\n<p>But in a lazy language, it would first compute</p>\n\n<pre><code>doubleMe(doubleMe(doubleMe(1)))\n</code></pre>\n\n<p>This will give back a <code>doubleMe(1)</code>, which is <code>2</code>. Then <code>4</code>, and finally <code>8</code>.</p>\n\n<p>So it only does one pass through the list and only when you really need it. </p>\n\n<p>This makes me confused. Why don't lazy language take the list as a whole, but split it? I mean we can ignore what the list or the expression is before we use it. But we need to evaluate the whole thing when we use it, isn't it? </p>\n"}, {"tags": ["haskell", "gtk", "gtk2hs", "gdkpixbuf"], "comments": [{"owner": {"reputation": 1896, "user_id": 4226702, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-siukF5ObSUs/AAAAAAAAAAI/AAAAAAAAAEc/Qww5nEqBNDw/photo.jpg?sz=128", "display_name": "Alexander Dmitriev", "link": "https://stackoverflow.com/users/4226702/alexander-dmitriev"}, "edited": false, "score": 1, "creation_date": 1529426916, "post_id": 50902489, "comment_id": 88865222, "body": "How do you know it responds to mouse input?"}, {"owner": {"reputation": 195, "user_id": 2042053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8269ce33797e5d4b2fbb726b6e790328?s=128&d=identicon&r=PG", "display_name": "imalison", "link": "https://stackoverflow.com/users/2042053/imalison"}, "reply_to_user": {"reputation": 1896, "user_id": 4226702, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-siukF5ObSUs/AAAAAAAAAAI/AAAAAAAAAEc/Qww5nEqBNDw/photo.jpg?sz=128", "display_name": "Alexander Dmitriev", "link": "https://stackoverflow.com/users/4226702/alexander-dmitriev"}, "edited": false, "score": 0, "creation_date": 1529439781, "post_id": 50902489, "comment_id": 88871338, "body": "Because the application triggers external behaviors through EWMh (switches the window manager workspace in this case)"}, {"owner": {"reputation": 1896, "user_id": 4226702, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-siukF5ObSUs/AAAAAAAAAAI/AAAAAAAAAEc/Qww5nEqBNDw/photo.jpg?sz=128", "display_name": "Alexander Dmitriev", "link": "https://stackoverflow.com/users/4226702/alexander-dmitriev"}, "edited": false, "score": 0, "creation_date": 1529474597, "post_id": 50902489, "comment_id": 88880148, "body": "Are mouse event handler are part of the topmost GtkWidget? If yes, it&#39;s possible, that someone unrefs the 2nd widget. Thus nothing is displayed but handlers are still alive. <a href=\"https://developer.gnome.org/gobject/stable/tools-refdb.html\" rel=\"nofollow noreferrer\">Debugging reference count problems</a>"}, {"owner": {"reputation": 1896, "user_id": 4226702, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-siukF5ObSUs/AAAAAAAAAAI/AAAAAAAAAEc/Qww5nEqBNDw/photo.jpg?sz=128", "display_name": "Alexander Dmitriev", "link": "https://stackoverflow.com/users/4226702/alexander-dmitriev"}, "edited": false, "score": 0, "creation_date": 1529941025, "post_id": 50902489, "comment_id": 89046705, "body": "Also double-check whether you interact with gtk <i>not</i> from mainloop. I recently faced a bug with &#39;source I&#39;d not found&#39; and &#39;assertion x != null failed&#39; and it was caused by described reason"}, {"owner": {"reputation": 195, "user_id": 2042053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8269ce33797e5d4b2fbb726b6e790328?s=128&d=identicon&r=PG", "display_name": "imalison", "link": "https://stackoverflow.com/users/2042053/imalison"}, "reply_to_user": {"reputation": 1896, "user_id": 4226702, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-siukF5ObSUs/AAAAAAAAAAI/AAAAAAAAAEc/Qww5nEqBNDw/photo.jpg?sz=128", "display_name": "Alexander Dmitriev", "link": "https://stackoverflow.com/users/4226702/alexander-dmitriev"}, "edited": false, "score": 0, "creation_date": 1529967363, "post_id": 50902489, "comment_id": 89057807, "body": "Yes, that was the first thing I checked as it has been a source of issues in the past. It&#39;s still a possibility, but it seems somewhat unlikely."}], "answers": [{"tags": [], "owner": {"reputation": 195, "user_id": 2042053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8269ce33797e5d4b2fbb726b6e790328?s=128&d=identicon&r=PG", "display_name": "imalison", "link": "https://stackoverflow.com/users/2042053/imalison"}, "is_accepted": false, "score": 0, "last_activity_date": 1530758616, "creation_date": 1530758616, "answer_id": 51182734, "question_id": 50902489, "link": "https://stackoverflow.com/questions/50902489/gtk-window-stops-updating-even-though-application-appears-to-be-running-otherwi/51182734#51182734", "title": "gtk window stops updating, even though application appears to be running otherwise", "body": "<p>I believe that the cause of this issue was simply that some UI updates were not being performed on the main UI thread. I can't be 100% certain of this because I was never able to reproduce. See this comment for more details:</p>\n\n<p><a href=\"https://github.com/taffybar/taffybar/issues/228#issuecomment-402591159\" rel=\"nofollow noreferrer\">https://github.com/taffybar/taffybar/issues/228#issuecomment-402591159</a></p>\n"}], "owner": {"reputation": 195, "user_id": 2042053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8269ce33797e5d4b2fbb726b6e790328?s=128&d=identicon&r=PG", "display_name": "imalison", "link": "https://stackoverflow.com/users/2042053/imalison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1530758616, "creation_date": 1529294151, "last_edit_date": 1529537534, "question_id": 50902489, "link": "https://stackoverflow.com/questions/50902489/gtk-window-stops-updating-even-though-application-appears-to-be-running-otherwi", "title": "gtk window stops updating, even though application appears to be running otherwise", "body": "<p>I maintain a gtk3 (though a mixture of gtk2hs and gi-gtk) application that serves as a standalone status bar for tiling window managers called taffybar.</p>\n\n<p>Taffybar has a long standing bug where something happens that causes one of its windows (it can have multiple windows e.g. when displaying on multiple monitors) to stop updating completely (<a href=\"https://github.com/taffybar/taffybar/issues/228\" rel=\"nofollow noreferrer\">issue here</a>). I have verified through various logging mechanisms that the code that is supposed to be updating the window IS in fact continuing to run. Also, if taffybar is displaying on multiple windows, windows will become affected one at a time -- that is, the hang only seems to affect the window on which it occurs, which rules out anything strange happening on the UI thread or something like that.</p>\n\n<p>Unfortunately, I do not have a consistent way to reproduce the issue. What's worse is that I haven't even been able to come up with a way to detect the issue programmatically. With that said, it is relatively easy to get the issue to occur as it has gotten much worse recently with the new icon loading mechanisms that have been added (it seems to happen about once every 5 minutes in the latest version). This reminds me that another thing I should mention is that I am relatively certain that the issue has something to do with pixbufs and image display because I have never seen the issue occur when the workspace images module is not active.</p>\n\n<p>I hate to ask a question without even being able to provide a consistent way to reproduce the issue, but I'm simply at a loss as to how to go about tackling/debugging this issue. It's hard for me to imagine how the behavior that I have described is even possible, actually. I'm hoping that something about the idiosyncratic nature of the issue might be enough for someone more knowledgable about gtk than I to make some guesses as to what the issue might be.</p>\n\n<p>To make my questions as explicit as possible I'll phrase it as follows:</p>\n\n<p>What could cause a gtk application window to hang (stop updating) without crashing the application or the UI thread, or affecting any of the other windows created by the application?</p>\n\n<p>EDIT: One more interesting quirk of this bug is that even though the window stops updating, it still responds to mouse input.</p>\n\n<p>EDIT2: Another thing worth noting is that occasionally, I have gotten this message:</p>\n\n<pre><code>gtkicontheme.c:3956:proxy_pixbuf_destroy: assertion failed: (icon_info-&gt;proxy_pixbuf != NULL)\n</code></pre>\n\n<p>I have also gotten the following message when I attempt to destroy the hung window in code:</p>\n\n<pre><code>Source ID 363524 was not found when attempting to remove it\n</code></pre>\n\n<p>I am loading icons from the icon theme sometimes</p>\n"}, {"tags": ["haskell", "higher-rank-types"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1529317239, "last_edit_date": 1529317239, "creation_date": 1529279042, "answer_id": 50901305, "question_id": 50901254, "link": "https://stackoverflow.com/questions/50901254/illegal-polymorphic-or-qualified-type-in-haskell/50901305#50901305", "title": "Illegal polymorphic or qualified type in Haskell", "body": "<p>Haskell does not support impredicative types, and in particular does not allow <code>forall</code> to appear under any type constructor (except <code>-&gt;</code>).</p>\n\n<p>For example, <code>Maybe (forall a. a), [forall a. a-&gt;a], ((forall a. a), Bool)</code> are forbidden.</p>\n\n<p>Use a <code>newtype</code> wrapper if that's what you want.</p>\n\n<pre><code>newtype T = T (forall a. a-&gt;a)\nfoo :: [T] -- OK\nfoo = [T id]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 4, "last_activity_date": 1529292499, "creation_date": 1529292499, "answer_id": 50902357, "question_id": 50901254, "link": "https://stackoverflow.com/questions/50901254/illegal-polymorphic-or-qualified-type-in-haskell/50902357#50902357", "title": "Illegal polymorphic or qualified type in Haskell", "body": "<p>Out of curiosity, what are you trying to use this type for? It looks like the type of a concatenative combinator like <code>quote</code> such that <code>[X] quote == [[X]]</code> (sometimes called <code>unit</code>). In other words, it takes a value atop the stack and wraps it in a function which, when applied, pushes that value to the stack.</p>\n\n<p>Here\u2019s one representation I\u2019ve used in the past for such functions. The <code>Tupled</code> type family converts a list of types into a nested tuple to represent a stack.</p>\n\n<pre><code>-- Tupled '[t1, t2, ..., tn] s == (t1, (t2, (... (tn, s))))\ntype family Tupled ts t where\n  Tupled '[] t' = t'\n  Tupled (t ': ts) t' = (t, Tupled ts t')\n</code></pre>\n\n<p>Using a <code>newtype</code> wrapper we can make a function (of a certain input &amp; output arity) that\u2019s polymorphic in the \u201crest\u201d of the stack.</p>\n\n<pre><code>newtype as :-&gt; bs = Fun (forall s. Tupled as s -&gt; Tupled bs s)\n</code></pre>\n\n<p>This is the standard way of hiding <em>impredicative polymorphism</em>, that is, using <code>forall</code>-quantified types under a type constructor other than a function arrow <code>(-&gt;)</code>, as you did when you tried to write <code>(forall r. (r -&gt; (a, r)), s)</code>. Haskell doesn\u2019t support this directly, but if you use a <code>newtype</code> wrapper then the compiler knows exactly when to introduce and eliminate the <code>forall</code>.</p>\n\n<p>By unwrapping this <code>newtype</code> and applying it to the stack type, we can apply a wrapped function to a stack.</p>\n\n<pre><code>apply :: forall z as bs. (as :-&gt; bs) -&gt; Tupled as z -&gt; Tupled bs z\napply (Fun f) as = f @z as\n</code></pre>\n\n<p>The <code>quote</code> combinator wraps the top element of the stack in a function:</p>\n\n<pre><code>quote :: forall a s. (a, s) -&gt; ([] :-&gt; '[a], s)\nquote (a, s) = (Fun $ \\s' -&gt; (a, s'), s)\n</code></pre>\n\n<p><code>unquote</code> applies a function on the stack to the rest of the stack.</p>\n\n<pre><code>unquote\n  :: forall z as bs s\n  .  (Tupled as z ~ s)\n  =&gt; (as :-&gt; bs, s)\n  -&gt; Tupled bs z\nunquote (f, s) = apply @z f s\n</code></pre>\n\n<p>(Note the equality constraint <code>Tupled as z ~ s</code>, which means \u201cThe input stack type <code>s</code> must begin with the series of types <code>as</code>, and whatever remains is called <code>z</code>\u201d.)</p>\n\n<p><code>add</code> is the addition operator <code>(+)</code> lifted to stacks; it just adds the top two elements of the stack.</p>\n\n<pre><code>add :: forall a. (Num a) =&gt; '[a, a] :-&gt; '[a]\nadd = Fun $ \\ (x, (y, s)) -&gt; (x + y, s)\n</code></pre>\n\n<p>Now, quoting and unquoting an element leaves it unchanged:</p>\n\n<pre><code>unquote (quote (\"hello\", ()) == (\"hello\", ())\n</code></pre>\n\n<p>The addition function can be applied directly\u2026</p>\n\n<pre><code>apply add (1, (2, ())) == (3, ())\n</code></pre>\n\n<p>\u2026Or placed on the stack and then applied.</p>\n\n<pre><code>unquote (add, (1, (2, ()))) == (3, ())\n</code></pre>\n\n<p>This requires the following extensions:</p>\n\n<ul>\n<li><p><code>DataKinds</code> to allow type-level lists of types</p></li>\n<li><p><code>RankNTypes</code> and <code>ScopedTypeVariables</code> to allow explicit <code>forall</code>s and bring type variables into scope so we can refer to them with <code>TypeApplications</code>, because we need <code>AllowAmbiguousTypes</code> to defer specifying the \u201cstack\u201d type until a call site, as in <code>apply @z f as</code></p></li>\n<li><p><code>TypeFamilies</code> to enable the <code>Tupled</code> type family</p></li>\n<li><p><code>TypeOperators</code> to give the nice symbolic name <code>:-&gt;</code> to wrapped function types</p></li>\n</ul>\n"}], "owner": {"reputation": 759, "user_id": 3368561, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e982eee26ab62e30ac026a9479e6228d?s=128&d=identicon&r=PG&f=1", "display_name": "user3368561", "link": "https://stackoverflow.com/users/3368561/user3368561"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 0, "accepted_answer_id": 50901305, "answer_count": 2, "score": 2, "last_activity_date": 1529317239, "creation_date": 1529278268, "question_id": 50901254, "link": "https://stackoverflow.com/questions/50901254/illegal-polymorphic-or-qualified-type-in-haskell", "title": "Illegal polymorphic or qualified type in Haskell", "body": "<p>Why is Haskell complaining when trying to parse this type signature?</p>\n\n<pre><code>f :: (a,s) -&gt; (forall r.(r -&gt; (a,r)),s)\n</code></pre>\n"}, {"tags": ["haskell", "do-notation"], "comments": [{"owner": {"reputation": 2953, "user_id": 5133088, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d0efad94ced5dcd194c0a482cafd4f7b?s=128&d=identicon&r=PG&f=1", "display_name": "Jeroen Heier", "link": "https://stackoverflow.com/users/5133088/jeroen-heier"}, "edited": false, "score": 0, "creation_date": 1530071436, "post_id": 50901025, "comment_id": 89099349, "body": "how are &quot;insert_Producto&quot; and &quot;delete from producto&quot; related?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 6719940, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Xm9sli-2rgo/AAAAAAAAAAI/AAAAAAAAAC0/FelozVuN2K8/photo.jpg?sz=128", "display_name": "yens solis asto", "link": "https://stackoverflow.com/users/6719940/yens-solis-asto"}, "edited": false, "score": 0, "creation_date": 1529289971, "post_id": 50901978, "comment_id": 88804054, "body": "Thanks for your time answering, testing insert_Product2 throws me error:"}, {"owner": {"reputation": 1, "user_id": 6719940, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Xm9sli-2rgo/AAAAAAAAAAI/AAAAAAAAAC0/FelozVuN2K8/photo.jpg?sz=128", "display_name": "yens solis asto", "link": "https://stackoverflow.com/users/6719940/yens-solis-asto"}, "edited": false, "score": 0, "creation_date": 1529290095, "post_id": 50901978, "comment_id": 88804084, "body": "\u2022 Couldn&#39;t match expected type \u2018IO a0\u2019                   with actual type \u2018[p1] -&gt; IO OK\u2019     \u2022 Probable cause: \u2018execute\u2019 is applied to too few arguments       In a stmt of a &#39;do&#39; block: execute conn &quot;delete from producto&quot;        In the expression:         do conn &lt;- connect                      defaultConnectInfo                        {ciUser = &quot;root&quot;, ciPassword = &quot;&quot;, ciDatabase = &quot;prueba&quot;}            execute conn &quot;delete from producto&quot;            close conn       In an equation for \u2018delete_Producto\u2019:"}, {"owner": {"reputation": 31, "user_id": 1109611, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Wtomj.jpg?s=128&g=1", "display_name": "mhuesch", "link": "https://stackoverflow.com/users/1109611/mhuesch"}, "reply_to_user": {"reputation": 1, "user_id": 6719940, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Xm9sli-2rgo/AAAAAAAAAAI/AAAAAAAAAC0/FelozVuN2K8/photo.jpg?sz=128", "display_name": "yens solis asto", "link": "https://stackoverflow.com/users/6719940/yens-solis-asto"}, "edited": false, "score": 0, "creation_date": 1529290355, "post_id": 50901978, "comment_id": 88804122, "body": "What is the type of <code>executeMany</code>? It looks like it takes an additional list argument, which hasn\u2019t been supplied."}, {"owner": {"reputation": 1, "user_id": 6719940, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Xm9sli-2rgo/AAAAAAAAAAI/AAAAAAAAAC0/FelozVuN2K8/photo.jpg?sz=128", "display_name": "yens solis asto", "link": "https://stackoverflow.com/users/6719940/yens-solis-asto"}, "edited": false, "score": 0, "creation_date": 1529290829, "post_id": 50901978, "comment_id": 88804197, "body": "Esta es la sentencia:                                                                      executeMany :: QueryParam p =&gt; MySQLConn -&gt; Consulta -&gt; [[p]] -&gt; IO [OK]"}, {"owner": {"reputation": 31, "user_id": 1109611, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Wtomj.jpg?s=128&g=1", "display_name": "mhuesch", "link": "https://stackoverflow.com/users/1109611/mhuesch"}, "reply_to_user": {"reputation": 1, "user_id": 6719940, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Xm9sli-2rgo/AAAAAAAAAAI/AAAAAAAAAC0/FelozVuN2K8/photo.jpg?sz=128", "display_name": "yens solis asto", "link": "https://stackoverflow.com/users/6719940/yens-solis-asto"}, "edited": false, "score": 0, "creation_date": 1529291286, "post_id": 50901978, "comment_id": 88804274, "body": "Ah, ok. So it takes a list of query parameters. As background context: the way to read that type signatures is that the 3 types to the left of the last <code>-&gt;</code> are arguments, and the type on the right is the return type. So this function needs 3 arguments to be fully applied. You can pass <code>[]</code> if you don\u2019t have any query parameters. I\u2019ve just updated the above code blocks."}, {"owner": {"reputation": 1, "user_id": 6719940, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Xm9sli-2rgo/AAAAAAAAAAI/AAAAAAAAAC0/FelozVuN2K8/photo.jpg?sz=128", "display_name": "yens solis asto", "link": "https://stackoverflow.com/users/6719940/yens-solis-asto"}, "edited": false, "score": 0, "creation_date": 1529291672, "post_id": 50901978, "comment_id": 88804348, "body": "Next message :  \u2022 Ambiguous type variable \u2018p0\u2019 arising from a use of \u2018executeMany\u2019       prevents the constraint \u2018(QueryParam p0)\u2019 from being solved.       Probable fix: use a type annotation to specify what \u2018p0\u2019 should be.       These potential instances exist:         instance QueryParam MySQLValue           -- Defined in \u2018mysql-haskell-0.8.3.0:Database.MySQL.Query\u2019         instance QueryParam Param           -- Defined in \u2018mysql-haskell-0.8.3.0:Database.MySQL.Query\u2019"}], "tags": [], "owner": {"reputation": 31, "user_id": 1109611, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Wtomj.jpg?s=128&g=1", "display_name": "mhuesch", "link": "https://stackoverflow.com/users/1109611/mhuesch"}, "is_accepted": false, "score": 0, "last_activity_date": 1529291352, "last_edit_date": 1529291352, "creation_date": 1529288446, "answer_id": 50901978, "question_id": 50901025, "link": "https://stackoverflow.com/questions/50901025/haskell-error-load-module-with-mysql/50901978#50901978", "title": "Haskell error load module with mysql", "body": "<p>My understanding is that this is the code you are executing:</p>\n\n<pre><code>import Database.MySQL.Base\n\ninsert_Producto = do\n    conn &lt;- connect (defaultConnectInfo {ciUser = \"root\", ciPassword = \"\", ciDatabase = \"prueba\"})\n    oks &lt;- executeMany conn \"delete from producto\" []\n</code></pre>\n\n<p>The compiler is complaining because you bind <code>executeMany</code> to the variable <code>oks</code> in the final line of a <code>do</code> block. If you want your do block to return the output of <code>executeMany</code>, you could do this:</p>\n\n<pre><code>insert_Producto1 = do\n    conn &lt;- connect (defaultConnectInfo {ciUser = \"root\", ciPassword = \"\", ciDatabase = \"prueba\"})\n    executeMany conn \"delete from producto\" []\n</code></pre>\n\n<p>The reason why your code is problematic is that <code>do</code> notation is desugared to a series of binds (<code>&gt;&gt;=</code>). The code you wrote would be transformed to</p>\n\n<pre><code>insert_Producto2 = connect (defaultConnectInfo {ciUser = \"root\"\n                                               , ciPassword = \"\"\n                                               , ciDatabase = \"prueba\"})\n                       &gt;&gt;= \\conn -&gt;\n                           executeMany conn \"delete from producto\" []\n                               &gt;&gt;= \\oks -&gt;\n                                   &lt;???&gt;\n</code></pre>\n\n<p>As you can see, there is no body in the last lambda function, which causes the error. The code block I proposed above would desugar to:</p>\n\n<pre><code>insert_Producto1 = connect (defaultConnectInfo {ciUser = \"root\"\n                                               , ciPassword = \"\"\n                                               , ciDatabase = \"prueba\"})\n                       &gt;&gt;= \\conn -&gt;\n                           executeMany conn \"delete from producto\" []\n</code></pre>\n\n<p>The last lambda now had a complete body.</p>\n"}], "owner": {"reputation": 1, "user_id": 6719940, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Xm9sli-2rgo/AAAAAAAAAAI/AAAAAAAAAC0/FelozVuN2K8/photo.jpg?sz=128", "display_name": "yens solis asto", "link": "https://stackoverflow.com/users/6719940/yens-solis-asto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1529291352, "creation_date": 1529275098, "last_edit_date": 1529275549, "question_id": 50901025, "link": "https://stackoverflow.com/questions/50901025/haskell-error-load-module-with-mysql", "title": "Haskell error load module with mysql", "body": "<p>Haskell : Database.MySQL.Base</p>\n\n<pre><code>insert_Producto  = do\n    conn &lt;- connect\n    defaultConnectInfo {ciUser = \"root\", ciPassword = \"\", ciDatabase = \"prueba\"}\n    oks &lt;- executeMany conn \"delete from producto\"\n</code></pre>\n\n<p>load Module :</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Conexion.hs:27:5: error:\n    The last statement in a 'do' block must be an expression\n      oks &lt;- executeMany conn \"delete from producto\"\n   |\n27 |     oks &lt;- executeMany conn \"delete from producto\"\n   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I try to load the module, but it marks me error.\nDoes anyone know what would be the right way to do it?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529329005, "post_id": 50900863, "comment_id": 88821499, "body": "Sorry I don&#39;t understand how you are making these simplications to deduce that Endo . f :: A -&gt; Endo B from (f :: a -&gt; b -&gt; b), that&#39;s probably the knowledge I&#39;m missing, what are the rules ? can I find a place somewhere that explain how you do that ?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529329166, "post_id": 50900863, "comment_id": 88821591, "body": "<code>(.) :: forall a b c. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>. When giving <code>f</code> as <code>(.)</code>&#39;s right argument, the type checker unifies <code>(a -&gt; b)</code> with <code>(A -&gt; B -&gt; B)</code>, which gives you <code>a ~ A</code> and <code>b ~ B -&gt; B</code>. (Remember that functions are curried.) In other words, <code>f</code> takes an <code>A</code> and returns a <code>B -&gt; B</code>. <code>Endo</code> takes a <code>B -&gt; B</code> and returns an <code>Endo B</code>. So <code>Endo . f</code> plumbs <code>f</code>&#39;s return value (<code>B -&gt; B</code>) into the <code>Endo</code> constructor, to give you <code>A -&gt; Endo B</code>."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529330613, "post_id": 50900863, "comment_id": 88822489, "body": "first I was applying f to the first argument (b-&gt;c) not the second one (a-&gt;b), so are you saying that #. f is the sectionning (. f) and not ((.) f) as I was thinking?"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529330697, "post_id": 50900863, "comment_id": 88822538, "body": "Then from that point, It&#39;s really how you play with that signature that I don&#39;t get...it seems like I can do some kind of factorization with these elements so I get this <code>((B -&gt; B) -&gt; r) -&gt; (A -&gt; (B -&gt; B)) -&gt; A -&gt; r</code> then ((B -&gt; B) -&gt; r ) -&gt; ( A -&gt; ((B -&gt; B) -&gt; r) ) ..., but I don&#39;t get your result..."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529330703, "post_id": 50900863, "comment_id": 88822540, "body": "Yes. <code>Endo . f</code> means <code>(.) Endo f</code>; <code>(Endo .)</code> means <code>(.) Endo</code>; <code>(. f)</code> means <code>\\k -&gt; (.) k f</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529330861, "post_id": 50900863, "comment_id": 88822640, "body": "You&#39;re on the right track. Given <code>(.) :: forall a b c. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>, you can pick <code>b ~ (B -&gt; B)</code> to get <code>((B -&gt; B) -&gt; c) -&gt; (a -&gt; B -&gt; B) -&gt; a -&gt; c</code>, which is what you&#39;ve got. Then you can pick <code>c ~ Endo B</code> and <code>a ~ A</code> to get <code>((B -&gt; B) -&gt; Endo B) -&gt; (A -&gt; B -&gt; B) -&gt; A -&gt; Endo B</code>. Then the first argument matches the type of <code>Endo</code> and the second matches the type of <code>f</code>."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529331326, "post_id": 50900863, "comment_id": 88822930, "body": "holy... ok I see it now :-)"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529331827, "post_id": 50900863, "comment_id": 88823261, "body": "do you know a blog or something where all the knowdledge you&#39;ve used is explained ?... substitution , factorization and then realizing that you can end with something like Endo (.) f -&gt; A -&gt; Endo B... and that result means Endo (.) f ~ A -&gt; Endo B"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529332402, "post_id": 50900863, "comment_id": 88823617, "body": "Hmm, that&#39;s a good question... Personally speaking I don&#39;t think I learned how type inference works from any particular source, so I don&#39;t think I can point you anywhere specific. It&#39;s more just developing an innate sense for it, for which sadly there&#39;s no substitute for writing lots of code over a long period of time. (One minor correction: it&#39;s <code>Endo . f</code>, not <code>Endo (.) f</code>. The former is <code>(.)</code> applied to <code>Endo</code> and <code>f</code>, whereas the latter is <code>Endo</code> applied to <code>(.)</code> and <code>f</code> (which is of course ill-typed))."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 2, "last_activity_date": 1529330235, "last_edit_date": 1529330235, "creation_date": 1529273350, "answer_id": 50900863, "question_id": 50900352, "link": "https://stackoverflow.com/questions/50900352/explanation-of-foldr-implementation-in-foldable/50900863#50900863", "title": "Explanation of foldr implementation in Foldable", "body": "<blockquote>\n  <p>The part that I don't understand is that <code>(#. f)</code> that should provide an endofunction <code>x -&gt; x</code></p>\n</blockquote>\n\n<p>Remember that Haskell functions are curried. So <code>f :: a -&gt; b -&gt; b</code> is a one-argument function which takes an <code>a</code> and returns an endomorphism <code>b -&gt; b</code>. <code>Endo #. f</code> plumbs the result of <code>f</code>, which is a function <code>b -&gt; b</code>, into <code>Endo</code>, which expects a function as an argument.</p>\n\n<p>Here's how that works in detail:</p>\n\n<p>First of all, note that <code>(#.)</code> is basically a synonym for <code>(.)</code>. So you have</p>\n\n<pre><code>foldr f z t = appEndo (foldMap (Endo . f) t) z\n</code></pre>\n\n<p>After <a href=\"https://en.wikipedia.org/wiki/Skolem_normal_form\" rel=\"nofollow noreferrer\">Skolemnising</a> <code>a</code> and <code>b</code> (so <code>f :: A -&gt; B -&gt; B</code> for rigid types <code>A</code> and <code>B</code>), the expression <code>(. f)</code> has a type of</p>\n\n<pre><code>(. f) :: forall r. ((B -&gt; B) -&gt; r) -&gt; A -&gt; r\n</code></pre>\n\n<p>Setting <code>Endo :: forall a. (a -&gt; a) -&gt; Endo a</code> as <code>(.)</code>'s left argument, you get <code>r ~ Endo B</code>:</p>\n\n<pre><code>Endo . f :: A -&gt; Endo B\n</code></pre>\n\n<p>And because <code>foldMap :: Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m</code>,</p>\n\n<pre><code>foldMap (Endo . f) :: Foldable t =&gt; t A -&gt; Endo B\n</code></pre>\n\n<p>and the rest of the function writes itself.</p>\n\n<hr>\n\n<p>That's how the types work out. Let's break down your example.</p>\n\n<pre><code>foldr (:) [1, 2, 3] [4, 5]\nappEndo (foldMap (Endo . (:)) [1, 2, 3]) [4, 5]\nappEndo (((Endo . (:)) 1) &lt;&gt; ((Endo . (:)) 2) &lt;&gt; ((Endo . (:)) 3) ) [4, 5]\nappEndo (Endo (1:) &lt;&gt; Endo (2:) &lt;&gt; Endo (3:)) [4, 5]  -- beta reduce (.)\nappEndo (Endo $ (1:) . (2:) . (3:)) [4, 5]  -- definition of (&lt;&gt;) for Endo\n((1:) . (2:) . (3:)) [4, 5]  -- appEndo (Endo f) = f\n[1, 2, 3, 4, 5]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 1, "last_activity_date": 1529342539, "creation_date": 1529342539, "answer_id": 50914600, "question_id": 50900352, "link": "https://stackoverflow.com/questions/50900352/explanation-of-foldr-implementation-in-foldable/50914600#50914600", "title": "Explanation of foldr implementation in Foldable", "body": "<p>It's <em>not</em> <code>(. f)</code>, it's <code>(Endo . f)</code>. </p>\n\n<p><strong><code>#.</code></strong> is just like <strong><code>.</code></strong> (for our purposes here), and <code>Endo</code> is just like any other function. For instance,</p>\n\n<pre><code>(Endo . (:)) 1 = Endo ((:) 1) = Endo (1:)    -- by definition of (.), (f . g) x = f (g x)\n</code></pre>\n\n<p><code>(1:)</code> is indeed an endofunction, its type <code>Num a =&gt; [a] -&gt; [a]</code> is a more specialized version of <code>b -&gt; b</code>, so the expression <code>Endo (1:)</code> makes sense (or, \"has a type\", or \"is a well typed expression\" -- <code>Endo 1</code>, for example, is not).</p>\n\n<p>So, if you accept that <code>foldMap f [a,b,c] = f a &lt;&gt; f b &lt;&gt; f c</code>,</p>\n\n<pre><code>foldr (:) [4,5] [1,2,3] = appEndo (foldMap (Endo #. (:)) [1,2,3]) [4,5]\n                        = appEndo (((Endo #. (:)) 1) &lt;&gt; \n                                   ((Endo #. (:)) 2) &lt;&gt; \n                                   ((Endo #. (:)) 3) ) [4,5]\n                        = ??\n</code></pre>\n\n<p>then, from this point on, it's just a straightforward application of the appropriate definitions / equations:</p>\n\n<pre><code>   -- #. is like . \n                        = appEndo (((Endo  . (:)) 1) &lt;&gt; \n                                   ((Endo  . (:)) 2) &lt;&gt; \n                                   ((Endo  . (:)) 3) ) [4,5]\n   -- (f . g) x = f (g x)\n   -- (Endo . g) x = Endo (g x)\n                        = appEndo (( Endo  ((:)  1)) &lt;&gt; \n                                   ( Endo  ((:)  2)) &lt;&gt; \n                                   ( Endo  ((:)  3)) ) [4,5]\n                        = appEndo (( Endo  (1 :)   ) &lt;&gt; \n                                   ( Endo  (2 :)   ) &lt;&gt; \n                                   ( Endo  (3 :)   ) ) [4,5]\n   -- (Endo f) &lt;&gt; (End g) = Endo (f . g)\n                        = appEndo (( Endo  (1 :)   ) &lt;&gt; \n                                   ( Endo ((2 :) . (3 :)) )) [4,5]\n                        = appEndo (  Endo ((1 :) . ((2 :) . (3 :))) ) [4,5]\n   -- appendo (Endo f) = f\n                        =                 ((1 :) . ((2 :) . (3 :)))   [4,5]\n                        =                  (1 :) (  (2 :) ( (3 :)     [4,5] ))\n                        =                  (1 :     (2 :    (3 :      [4,5] )))\n                        =                   1 :      2 :     3 :      [4,5] \n                        = [1,2,3,4,5]\n</code></pre>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 1, "accepted_answer_id": 50914600, "answer_count": 2, "score": 1, "last_activity_date": 1529342539, "creation_date": 1529268372, "last_edit_date": 1529273787, "question_id": 50900352, "link": "https://stackoverflow.com/questions/50900352/explanation-of-foldr-implementation-in-foldable", "title": "Explanation of foldr implementation in Foldable", "body": "<p>Here is the implementaion of foldr :</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\nfoldr f z t = appEndo (foldMap (Endo #. f) t) z\n</code></pre>\n\n<p>The part that I don't understand is that <code>(#. f)</code> should provide an endofunction <code>x -&gt; x</code></p>\n\n<p>e.g foldr (:) [4,5] [1,2,3]</p>\n\n<pre><code>foldr (:) [4,5] [1,2,3] = appEndo (foldMap (Endo #. (:)) [1,2,3]) [4,5]\n                        = appEndo (((Endo #. (:)) 1) &lt;&gt; \n                                   ((Endo #. (:)) 2) &lt;&gt; \n                                   ((Endo #. (:)) 3) ) [4,5]\n                        = ???\n                        = [1,2,3,4,5]\n</code></pre>\n\n<p>Could someone decompose that example?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 13520, "user_id": 2315602, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/8rKPi.jpg?s=128&g=1", "display_name": "lisyarus", "link": "https://stackoverflow.com/users/2315602/lisyarus"}, "is_accepted": true, "score": 5, "last_activity_date": 1529266170, "creation_date": 1529266170, "answer_id": 50900087, "question_id": 50900042, "link": "https://stackoverflow.com/questions/50900042/understanding-the-signature-of-the-function/50900087#50900087", "title": "Understanding the signature of the function (.) (:)", "body": "<p>First, let's rename some things and put parenthesis:</p>\n\n<pre><code>(:) :: d -&gt; ([d] -&gt; [d])\n</code></pre>\n\n<p>Now, in the expresstion <code>(.) (:)</code> the <code>(:)</code> is the first argument of <code>(.)</code>. The first argument of <code>(.)</code> should have type <code>b -&gt; c</code>. Thus,</p>\n\n<pre><code>b -&gt; c = d -&gt; ([d] -&gt; [d])\n</code></pre>\n\n<p>which means</p>\n\n<pre><code>b = d\nc = [d] -&gt; [d]\n</code></pre>\n\n<p>The result of <code>(.) (:)</code> has type <code>(a -&gt; b) -&gt; a -&gt; c</code>. Putting our <code>b</code> and <code>c</code> in, we get</p>\n\n<pre><code>(a -&gt; d) -&gt; a -&gt; ([d] -&gt; [d])\n</code></pre>\n\n<p>This is exactly what ghci told you, except for the type variables renamed as <code>a1 = a</code> and <code>a2 = d</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1529267055, "last_edit_date": 1529267055, "creation_date": 1529266270, "answer_id": 50900110, "question_id": 50900042, "link": "https://stackoverflow.com/questions/50900042/understanding-the-signature-of-the-function/50900110#50900110", "title": "Understanding the signature of the function (.) (:)", "body": "<p>Well, let us do the type inference. We thus have two function:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n(:) :: d -&gt; [d] -&gt; [d]\n</code></pre>\n\n<p>We here use <code>d</code> since the <code>a</code> in <code>(.)</code> is not <em>per se</em> the <code>a</code> in <code>(:)</code>, so we avoid confusion by using two separate type variables.</p>\n\n<p>The type signatures in a more canonic form are:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; ((a -&gt; b) -&gt; (a -&gt; c))\n(:) :: d -&gt; ([d] -&gt; [d])\n</code></pre>\n\n<p>So now since <code>(:)</code> is the argument of a function application with <code>(.)</code> as function, we know that the type of <code>(:)</code> is the type of the <em>parameter</em> of <code>(.)</code>, so that means that <code>d -&gt; ([d] -&gt; [d]) ~ (b -&gt; c)</code> (here the tilde <code>~</code> means that it is the same type). So therefore we know that:</p>\n\n<pre><code>  b -&gt; c\n~ d -&gt; ([d] -&gt; [d])\n---------------------\nb ~ d, c ~ [d] -&gt; [d]\n</code></pre>\n\n<p>So that means that the <code>b</code> in the type signature of <code>(.)</code> is the same type as <code>d</code> in the type signature of <code>(:)</code>, and that <code>c ~ [d] -&gt; [d]</code>.</p>\n\n<p>So the as a result, we get:</p>\n\n<pre><code>  (.) (:) :: (a -&gt; b) -&gt; (a -&gt; c))\n= (.) (:) :: (a -&gt; d) -&gt; (a -&gt; ([d] -&gt; [d])))\n= (.) (:) :: (a -&gt; d) -&gt; (a -&gt; [d] -&gt; [d])\n= (.) (:) :: (a -&gt; d) -&gt; a -&gt; [d] -&gt; [d]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 0, "last_activity_date": 1530778693, "last_edit_date": 1530778693, "creation_date": 1529313602, "answer_id": 50906217, "question_id": 50900042, "link": "https://stackoverflow.com/questions/50900042/understanding-the-signature-of-the-function/50906217#50906217", "title": "Understanding the signature of the function (.) (:)", "body": "<p><code>(.)</code> is nothing to fear. It is a most natural thing.</p>\n\n<p>Imagine you define an <em>abstract</em> class of \"connections\":</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>class Connecting conn where\n    plug :: conn a b -&gt; conn b c -&gt; conn a c\n    noop :: conn a a\n</code></pre>\n\n<p><code>conn a b</code> is a type of <em>something</em> which is connecting a <em>point</em> <em>a</em> to a <em>point</em> <em>b</em>.  Given the possibility of connecting <em>a</em> to <em>b</em>, and <em>b</em> to <em>c</em>, it most naturally gives us the possibility of connecting <em>a</em> to <em>c</em> by just plugging the two <em>somethings</em> together. Also, any <em>point</em> which can be connected to another, and can get connected to, can obviously be considered connected to itself with absolutely no effort.</p>\n\n<p><em>Functions</em> are connecting. Just use the output of one as the input of another. If we have such two compatible functions, plugging them in that way gives us a combined connection.</p>\n\n<p>Functions <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/src/Control.Category.html#line-55\" rel=\"nofollow noreferrer\">are</a> <code>Connecting</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Connecting (-&gt;) where\n    -- plug :: (-&gt;) a b -&gt; (-&gt;) b c -&gt; (-&gt;) a c\n    (plug f g) x = g (f x)\n    -- noop :: (-&gt;) a a\n    noop x = x           -- what else? seriously. All we have is x.\n</code></pre>\n\n<p>Interesting thing about that <code>plug :: (-&gt;) a b -&gt; (-&gt;) b c -&gt; (-&gt;) a c</code>. That order of arguments is most fitting when we think about the types involved. But looking at its definition, we'd prefer it be defined as</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>    gulp :: (-&gt;) b c -&gt; (-&gt;) a b -&gt; (-&gt;) a c\n    (gulp g f) x = g (f x)\n</code></pre>\n\n<p>Now the definition makes most sense, but the type feels a bit tortured.</p>\n\n<p>Never mind that, we can have <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/src/Control.Category.html#%3C%3C%3C\" rel=\"nofollow noreferrer\">both</a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>   (f :: a -&gt; b)    &gt;&gt;&gt;     (g :: b -&gt; c)       ::    -- ...\n         a          -&gt;                 c\n\n   (g :: b -&gt; c)    &lt;&lt;&lt;     (f :: a -&gt; b)       ::    -- ...\n                                  a -&gt;\n              c\n</code></pre>\n\n<p>Coincidentally, <code>&lt;&lt;&lt;</code> is also known as <code>(.)</code>.   </p>\n\n<p>It is also clear that we have <code>(.) = (&lt;&lt;&lt;) = flip (&gt;&gt;&gt;)</code>, so <code>(g . f) x = g (f x) = (f &gt;&gt;&gt; g) x</code>.</p>\n\n<p>Presented with <code>g . f</code>, it is often easier to deal with the equivalent expression <code>f &gt;&gt;&gt; g</code>, types-wise. Just align the types, vertically,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(:)        ::        b -&gt; ([b] -&gt; [b])\nf          ::   a -&gt; b\nf &gt;&gt;&gt; (:)  ::   a -&gt;      ([b] -&gt; [b])\n</code></pre>\n\n<p>so that</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code> (&gt;&gt;&gt; (:)) ::  (a -&gt; b)                      -- = ((:) &lt;&lt;&lt;) = ((:) .) = (.) (:)\n             -&gt; a -&gt;      ([b] -&gt; [b])\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/questions/13139969/currying-3-arguments-in-haskell/13147064#13147064\">because</a> <code>(&gt;&gt;&gt; (:)) = (\\f -&gt; (f &gt;&gt;&gt; (:)))</code>.</p>\n\n<p>Which is <code>(\\f -&gt; ((:) &lt;&lt;&lt; f)) = (\\f -&gt; ((:) . f)) = ((:) .) = (.) (:)</code>.</p>\n\n<hr>\n\n<p><em>edit:</em> for instance, the type of <code>(Endo . (:)) = ((:) &gt;&gt;&gt; Endo)</code> is easily arrived at, with:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Endo         ::      ( b  -&gt;  b ) -&gt; Endo  b         \n(:)          :: a -&gt; ([a] -&gt; [a])                    -- b ~ [a]\n(:) &gt;&gt;&gt; Endo :: a -&gt;                 Endo [a]\n</code></pre>\n\n<p>For more about <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/src/Data.Semigroup.Internal.html#Endo\" rel=\"nofollow noreferrer\"><code>Endo</code></a>, try both <code>:t Endo</code> and <code>:i Endo</code> at GHCi prompt, and read up on <a href=\"https://en.wikibooks.org/wiki/Haskell/More_on_datatypes#Named_Fields_(Record_Syntax)\" rel=\"nofollow noreferrer\">Haskell's record syntax</a>, if you need to.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 0, "last_activity_date": 1529367081, "creation_date": 1529367081, "answer_id": 50919001, "question_id": 50900042, "link": "https://stackoverflow.com/questions/50900042/understanding-the-signature-of-the-function/50919001#50919001", "title": "Understanding the signature of the function (.) (:)", "body": "<p>Writing <code>(.) (:)</code> as an operator section, <code>((:) .)</code>, emphasises a bit that it postcomposes <code>(:)</code> with some other function (i.e. it modifies a function by applying <code>(:)</code> to its result -- <code>\\g -&gt; (g .)</code> is <code>fmap</code> for functions). Symmetrically, <code>(. (:))</code> precomposes <code>(:)</code> with some other function (<code>\\f -&gt; (. f)</code> is <code>contramap</code> for functions -- cf. <a href=\"http://hackage.haskell.org/package/contravariant-1.4.1/docs/Data-Functor-Contravariant.html#t:Op\" rel=\"nofollow noreferrer\">the <code>Op</code> newtype</a>).</p>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 1, "accepted_answer_id": 50900087, "answer_count": 4, "score": 2, "last_activity_date": 1530778693, "creation_date": 1529265830, "question_id": 50900042, "link": "https://stackoverflow.com/questions/50900042/understanding-the-signature-of-the-function", "title": "Understanding the signature of the function (.) (:)", "body": "<p>could you explain how we go from :</p>\n\n<pre><code>Prelude Data.Monoid&gt; :t (.)\n(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\nPrelude Data.Monoid&gt; :t (:)\n(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>to that :</p>\n\n<pre><code>Prelude Data.Monoid&gt; :t (.)(:)\n(.)(:) :: (a1 -&gt; a2) -&gt; a1 -&gt; [a2] -&gt; [a2]\n</code></pre>\n\n<p>More in general, I'm sometimes afraid of (.) like I don't feel it intuitively, if you have some tricks to share to better feel it, it's welcome :-)</p>\n"}, {"tags": ["haskell", "testing"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529260046, "post_id": 50899007, "comment_id": 88798515, "body": "What is the meaning of <code>MoveOnto (Block 1) (Block 0) (MoveOnto (Block 2) (Block 1) EmptyTable)</code>? What is the full relation of which blocks are on which other blocks for this <code>Stack</code>?"}, {"owner": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529260712, "post_id": 50899007, "comment_id": 88798681, "body": "@Daniel The term &#39;MoveOnto (Block 1) (Block 0) (MoveOnto (Block 2) (Block 1) EmptyTable)&#39; constructs a &#39;Stack&#39; where transitivity does not hold."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529261254, "post_id": 50899007, "comment_id": 88798817, "body": "Then I don&#39;t understand the question. Are you asking us to read your mind and figure out what properties you are expecting to hold?"}, {"owner": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529262076, "post_id": 50899007, "comment_id": 88799049, "body": "I am only concerned with stacks that are constructed in the context of isOn. It is the in this context I wish to test transitivity."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529262189, "post_id": 50899007, "comment_id": 88799088, "body": "I don&#39;t understand what &quot;constructed in the context of <code>isOn</code>&quot; means. In your code, <code>isOn</code> does not construct a stack (though it does consume one)."}, {"owner": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529263670, "post_id": 50899007, "comment_id": 88799479, "body": "You are of course correct! But I hope that <code>IsOn</code> at least offers a decision procedure for transitivity."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529264184, "post_id": 50899007, "comment_id": 88799590, "body": "What is the relation whose transitivity you believe is being checked by <code>isOn</code>?"}, {"owner": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1529266695, "post_id": 50899007, "comment_id": 88800213, "body": "I believe that <code>on</code> is the relation based on  <a href=\"http://www.inf.udec.cl/~andrea/papers/Cosit97.pdf\" rel=\"nofollow noreferrer\">paper</a>"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1529261791, "last_edit_date": 1529261791, "creation_date": 1529259375, "answer_id": 50899301, "question_id": 50899007, "link": "https://stackoverflow.com/questions/50899007/best-test-for-transitivity-using-haskells-quickcheck/50899301#50899301", "title": "Best test for transitivity using Haskell&#39;s Quickcheck", "body": "<p>I think the usual definition of transitivity <em>does</em> apply, even in this case.</p>\n\n<pre><code>prop_trans a b c s = (r a b &amp;&amp; r b c) ==&gt; r a c\n    where r x y = isOn x y s\n</code></pre>\n\n<p>Unfortunately checking this property will lead to <em>a lot</em> of discards. You can do a lot better just by drawing <code>a</code>, <code>b</code>, and <code>c</code> from blocks that appear in <code>s</code>:</p>\n\n<pre><code>listBlocks (MoveOnto b1 b2 s) = b1:b2:listBlocks s\nlistBlocks EmptyTable = []\n\nprop_trans2 s = do\n    [a,b,c] &lt;- replicateM 3 . elements . listBlocks $ s\n    return (prop_trans a b c s)\n</code></pre>\n\n<p>It's possible to do better still, but seems not to be necessary, as this gets me a counterexample pretty quickly:</p>\n\n<pre><code>&gt; quickCheckWith stdArgs { maxDiscardRatio = 1000 } prop_trans2\n*** Failed! Falsifiable (after 6 tests):  \nMoveOnto (Block 4) (Block (-2)) (MoveOnto (Block (-2)) (Block 4) (MoveOnto (Block 2) (Block 5) EmptyTable))\n</code></pre>\n"}], "owner": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1529261791, "creation_date": 1529257076, "question_id": 50899007, "link": "https://stackoverflow.com/questions/50899007/best-test-for-transitivity-using-haskells-quickcheck", "title": "Best test for transitivity using Haskell&#39;s Quickcheck", "body": "<p>Of the three tests below which is the best test for transitivity. This follows from my <a href=\"https://stackoverflow.com/questions/50896137/using-haskells-quickcheck-to-check-transitivity\">previous question</a>. The usual logical rule of transitivity (R(a,b) and R(b,c)) => R(a,c) does not seem  apply in this case.Hence, I think that <code>prop_trans3</code>  would be not be a good test,  because each of the three terms represents a different stack.\nBut  which of <code>prop_trans1</code> and <code>prop_trans2</code> are best suited to testing transitivity?</p>\n\n<pre><code>import Test.QuickCheck\ndata Block = Block Int deriving (Show,Eq)\n-- MoveOnto(bl,b2,s) is read as b2 is moved into and onto bl on stack or table.\ndata Stack = EmptyTable  |  MoveOnto Block Block Stack deriving  (Show,Eq) \nisOn :: Block -&gt; Block -&gt; Stack -&gt; Bool\nisOn b1 b2 (MoveOnto b3 b4 s) |  ((b1 == b3) &amp;&amp; (b4 == b2)) || (isOn b4 b2 s)   =  True\nisOn _ _ _  = False\n\ninstance Arbitrary (Block) where\n  arbitrary = fmap Block arbitrary\n\ninstance Arbitrary (Stack) where\n  arbitrary = oneof [return EmptyTable, MoveOnto &lt;$&gt; arbitrary &lt;*&gt; arbitrary &lt;*&gt; arbitrary]\n\nprop_trans1 b1 b2 s      =  isOn b1 b2 (MoveOnto b1 b2 s)\nprop_trans2 b1 b2 b3 s   =  isOn b3 b1 (MoveOnto b3 b2 (MoveOnto b2 b1 s))\nprop_trans3 b1 b2 b3 s   =  ((isOn b2 b1 (MoveOnto b2 b1 s)) &amp;&amp; (isOn b3 b2 (MoveOnto b3 b2 s))) &lt;=  (isOn b3 b1 (MoveOnto b3 b1 s))\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1529247799, "post_id": 50897840, "comment_id": 88795313, "body": "Well <code>$$</code> has lower priority, so you <code>fmap head</code> on <code>(many get)</code> not <code>many get $$ &quot;abc&quot;</code>. And <code>fmap id ...</code> makes no changes at all."}, {"owner": {"reputation": 2696, "user_id": 366553, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5a07b05ddc37550d0dd6311c4a4c31ca?s=128&d=identicon&r=PG", "display_name": "Peteris", "link": "https://stackoverflow.com/users/366553/peteris"}, "edited": false, "score": 0, "creation_date": 1529247935, "post_id": 50897840, "comment_id": 88795347, "body": "try <code>head (many get $$ &quot;abc&quot;)</code> or the equivalent <code>head $ many get $$ &quot;abc&quot;</code> to clarify your misunderstanding."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529247941, "post_id": 50897840, "comment_id": 88795349, "body": "If you however want the first match, it should be <code>head (many get $$ &quot;abc&quot;)</code>."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529248525, "post_id": 50897840, "comment_id": 88795507, "body": "@WillemVanOnsem This does not explain where is that empty list hidden. It does typecheck!"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529248580, "post_id": 50897840, "comment_id": 88795530, "body": "@IgnatInsarov: well a <code>ReadP</code> is the instance of a functor with <code>fmap h (R f) = R (\\k -&gt; f (k . h))</code>. So you take the head of the first element of the tuples. You can for example query the length of this list, and it will result in <code>4</code>. What you thus here are doing is processing the <i>first</i> item of every tuple."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529248686, "post_id": 50897840, "comment_id": 88795561, "body": "@IgnatInsarov: try for example <code>fmap (&#39;a&#39;:) (many get) $$ &quot;abc&quot;</code>, it will prepend the elements with <code>a</code>."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529248984, "post_id": 50897840, "comment_id": 88795641, "body": "@WillemVanOnsem Oh, thank you. This is somewhat unexpected. Could you take a look at the postscriptum I just added?"}, {"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 0, "creation_date": 1529253145, "post_id": 50897840, "comment_id": 88796783, "body": "I think you want <code>eof</code>.  Try using <code>many get &lt;* eof</code> as your parser and you should only get results that use the whole input."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 0, "creation_date": 1529298711, "post_id": 50897840, "comment_id": 88805642, "body": "@DavidFletcher Yes, I also arrived to this conclusion. Generally, the logically correct way to select one of the range of <code>many ...</code> matches is to have some end anchor \u2014 for instance, <code>eof</code>, rather than ad-hoc list slicing. It must also mean that there is no way to create a &quot;greedy&quot; parser in the usual &quot;regex&quot; sense. Would you like to compose a complete answer so that I may accept it? Including the results of Willem, if possible."}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1529248886, "creation_date": 1529247695, "last_edit_date": 1529248886, "question_id": 50897840, "link": "https://stackoverflow.com/questions/50897840/strange-behaviour-of-readp-with-regards-to-fmap-head", "title": "Strange behaviour of `ReadP` with regards to `fmap head`", "body": "<p>Consider the following repl session:</p>\n\n<pre><code>\u03bb import Text.ParserCombinators.ReadP\n\n\u03bb x $$ y = readP_to_S x y\n    -- This auxiliary function makes things tidier.\n\n\u03bb many get $$ \"abc\"\n[(\"\",\"abc\"),(\"a\",\"bc\"),(\"ab\",\"c\"),(\"abc\",\"\")]\n    -- This is reasonable.\n\n\u03bb fmap head (many get) $$ \"abc\"\n[(*** Exception: Prelude.head: empty list\n    -- Wut?\n\n\u03bb fmap last (many get) $$ \"abc\"\n[(*** Exception: Prelude.last: empty list\n    -- This works neither.\n\n\u03bb fmap id (many get) $$ \"abc\"\n[(\"\",\"abc\"),(\"a\",\"bc\"),(\"ab\",\"c\"),(\"abc\",\"\")]\n     -- The list is there until I try to chop its head!\n</code></pre>\n\n<p>My questions:</p>\n\n<ul>\n<li><p>What is happening here?</p></li>\n<li><p>How can I extract a single <em>(preferably longest)</em> parse result?</p></li>\n</ul>\n\n<p><strong>P.S.</strong> My goal is to construct a parser combinator that greedily returns the repetitive application of a given parser. <em>(<code>get</code> in this instance, but in actuality I have a more involved logic.)</em> Chopping the list of intermediate results is one approach I thought would do, but I am fine with any, except that it is preferable not to convert to <code>ReadS</code> and back.</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529246518, "post_id": 50897660, "comment_id": 88795027, "body": "Well for the second error, <code>n</code> is indeed not in scope, you should use <code>[0..i-1]</code>. Regardless of that, I do not see much benefit for this, since the constants will typically be calculated once, due to lazy programming anyway."}, {"owner": {"reputation": 858, "user_id": 4267929, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/98885eca3b83031612bef15ed5b21abc?s=128&d=identicon&r=PG&f=1", "display_name": "Henricus V.", "link": "https://stackoverflow.com/users/4267929/henricus-v"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1529246801, "post_id": 50897660, "comment_id": 88795089, "body": "@WillemVanOnsem If I manually type in the value for <code>dim</code> every time, it is error prone and difficult to change (say if a new category is added). But that value is needed at compile time for constructing <code>Network</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1529447399, "last_edit_date": 1529447399, "creation_date": 1529447005, "answer_id": 50937718, "question_id": 50897660, "link": "https://stackoverflow.com/questions/50897660/compile-time-constant-in-haskell/50937718#50937718", "title": "Compile time constant in Haskell", "body": "<p>Template Haskell is the correct approach, but you need to use it at the right spot and with a suitable TH constructor. The spot is where you want to use a type-level quantity that's dependent on a value-level computation. <code>dim</code> is still value-level, but the argument of <code>Grenade.FullyConnected</code> is type-level, so that's where you need the splice.</p>\n\n<p>Here's a full (simplified) example:</p>\n\n<pre><code>module Dimension where  -- No TH here, we just need a separate module\n                        -- to put the value-level code whose results\n                        -- are to be spliced into the type level\nimport Data.Map as Map\n\ndim :: Integer\ndim = fromIntegral $ Map.size cat1\n where catToMap li = Map.fromList $ zip [0..] li\n       cat1 = catToMap [\"aa\", \"bb\", \"cc\"]\n</code></pre>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, TypeOperators, DataKinds #-}\n\nmodule Main where    \n\nimport <a href=\"http://hackage.haskell.org/package/modular-arithmetic-1.2.1.3/docs/Data-Modular.html\" rel=\"nofollow noreferrer\">Data.Modular</a>\nimport Dimension\nimport <a href=\"http://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/Language-Haskell-TH.html#t:TyLit\" rel=\"nofollow noreferrer\">Language.Haskell.TH</a>\n\ntype F = \u2124 / $(pure . <a href=\"http://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/Language-Haskell-TH.html#t:Type\" rel=\"nofollow noreferrer\">LitT</a> $ <a href=\"http://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/Language-Haskell-TH.html#t:TyLit\" rel=\"nofollow noreferrer\">NumTyLit</a> dim) -- this is where you'd define your Network type\n\nmain :: IO ()\nmain = print [0::F ..]\n</code></pre>\n\n<pre><code>[0,1,2]\n</code></pre>\n"}], "owner": {"reputation": 858, "user_id": 4267929, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/98885eca3b83031612bef15ed5b21abc?s=128&d=identicon&r=PG&f=1", "display_name": "Henricus V.", "link": "https://stackoverflow.com/users/4267929/henricus-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1529447399, "creation_date": 1529246328, "question_id": 50897660, "link": "https://stackoverflow.com/questions/50897660/compile-time-constant-in-haskell", "title": "Compile time constant in Haskell", "body": "<p>I am trying to have precomputed data embedded in Haskell. That is</p>\n\n<pre><code>catToMap li = Map.fromList $ zip [0..] li\n\ncat1 = catToMap [\"aa\", \"bb\", \"cc\"]\n\ndim = Map.size cat1\n</code></pre>\n\n<p>I would like to use <code>dim</code> statically in a type definition:</p>\n\n<pre><code>type Network = Grenade.Network\n    '[Grenade.FullyConnected dim 20, Grenade.FullyConnected 20 1, Grenade.Logit]\n    '[Grenade.D1 dim, Grenade.D1 20, Grenade.D1 1, Grenade.D1 1]\n</code></pre>\n\n<p>(imported from <code>grenade</code> library)</p>\n\n<p>However, the above gives the error that <code>dim</code> is not in scope.</p>\n\n<p>I am also trying to create the function</p>\n\n<pre><code>import qualified Numeric.LinearAlgebra.Static as SA\n\n-- | ith standard basis in Rn\nstdbasis :: forall n . KnownNat n =&gt; Int -&gt; SA.R n\nstdbasis i = SA.vector [builder x| x &lt;- [0..n-1]]\nwhere\n    builder j = if i == j then 1 else 0\n</code></pre>\n\n<p>but this gives me the error that <code>n</code> is not in scope.</p>\n\n<p>My attempt to fix the first problem is with template Haskell:</p>\n\n<pre><code>catToMap = $(\\li -&gt; Map.fromList $ zip [0..] li)\n\ncat1 = $(catToMap [\"aa\", \"bb\", \"cc\"])\n\ndim = $(Map.size cat1)\n</code></pre>\n\n<p>but it gives me the error</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Q Exp\u2019\n              with actual type \u2018[a0] -&gt; Map.Map Integer a0\u2019\n\u2022 The lambda expression \u2018\\ li -&gt; (Map.fromList $ zip ... li)\u2019\n  has one argument,\n  but its type \u2018Language.Haskell.TH.Lib.ExpQ\u2019 has none\n  In the expression: \\ li -&gt; (Map.fromList $ zip [0 .. ] li)\n  In the untyped splice: $(\\ li -&gt; (Map.fromList $ zip [0 .. ] li))\n</code></pre>\n\n<p>What I am trying to achieve is similar to C++ templates:</p>\n\n<pre><code>template &lt;int size&gt; Vector&lt;n&gt;\nstdbasis(int i);\n</code></pre>\n"}, {"tags": ["haskell", "testing"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1529237971, "post_id": 50896137, "comment_id": 88792933, "body": "Since <code>Stack</code> is  a recursive data structure, and you&#39;ve used its <code>arbitrary</code> instance recursively, it&#39;s likely that QuickCheck is simply busy creating some crazy deeply nested values. Is your CPU close to 100%?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1529238133, "post_id": 50896137, "comment_id": 88792974, "body": "It looks to me that by defuning <code>arbitrary = arbitrary</code>, we have an infinite loop."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1529238346, "creation_date": 1529238346, "answer_id": 50896625, "question_id": 50896137, "link": "https://stackoverflow.com/questions/50896137/using-haskells-quickcheck-to-check-transitivity/50896625#50896625", "title": "Using Haskell&#39;s Quickcheck to check transitivity", "body": "<p>It hangs since in the attempt to construct an arbitrary <code>Block</code>, you perform endless recursion. Indeed:</p>\n\n<pre><code>instance Arbitrary (Block) where\n  <b>arbitrary = arbitrary</b></code></pre>\n\n<p>So here that means that you wrote that one can generate an arbitrary block by generating an arbitrary block. This will of course not work. You can define an arbitrary <code>Int</code>, and then construct a block for that with:</p>\n\n<pre><code>instance Arbitrary (Block) where\n  arbitrary = <b>fmap Block</b> arbitrary</code></pre>\n\n<p>Now that arbitrary blocks can be constructed, arbitrary stacks can be constructed as well, although there is strictly speeking a possibility that this will run for an infinite time as well (due to technical reasons), if we model the probabilities as uniform, we know that eventually the stack building will stop.</p>\n"}], "owner": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1529238346, "creation_date": 1529234453, "question_id": 50896137, "link": "https://stackoverflow.com/questions/50896137/using-haskells-quickcheck-to-check-transitivity", "title": "Using Haskell&#39;s Quickcheck to check transitivity", "body": "<p>How can I get Quickcheck to check the transitive property in the code below? The code represents a stack of physical blocks. Blocks can only be placed on an empty table or another block using the operation <code>MoveOnto bl b2 s</code>, which is read as <code>b2</code> is moved into and onto <code>bl</code> on stack or table <code>s</code>. My Quickcheck attempt just hangs and produces no result.</p>\n\n<pre><code>import Test.QuickCheck\ndata Block = Block Int deriving (Show,Eq)\ndata Stack = EmptyTable  |  MoveOnto Block Block Stack deriving  (Show,Eq) \nisOn :: Block -&gt; Block -&gt; Stack -&gt; Bool\nisOn b1 b2 (MoveOnto b3 b4 s) |  ((b1 == b3) &amp;&amp; (b4 == b2)) || (isOn b4 b2 s)   =  True\nisOn _ _ _  = False\n\nb1' = Block 1\nb2' = Block 2\nb3' = Block 3\nb4' = Block 4\nb5' = Block 5\nb6' = Block 6\nb7' = Block 7\nb8' = Block 8\n\n-- Hand made test\ntestTransitivityTrue b1 b2 b3 b4 b5  = isOn b1 b5 (MoveOnto b1 b2 (MoveOnto b2 b3 (MoveOnto b3 b4 (MoveOnto b4 b5 EmptyTable))))\n\ninstance Arbitrary (Block) where\n  arbitrary =  arbitrary\n\n\ninstance Arbitrary (Stack) where\n  arbitrary = oneof [return EmptyTable, MoveOnto &lt;$&gt; arbitrary &lt;*&gt; arbitrary &lt;*&gt; arbitrary]\n\nprop_pass b1 b2 s   = isOn b1 b2 (MoveOnto b1 b2 s)\n</code></pre>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1529252949, "post_id": 50895930, "comment_id": 88796734, "body": "Is the problem related to Aeson or pptable? I understand that you have problems with the <code>_source</code> object in the JSON. Is the table relevant to the question, though? Is the rest of the JSON structure important? What have you tried and where are you having problems? Are there irrelevant parts of the above data structures that you could remove and still reproduce the problem? Can you post <a href=\"https://stackoverflow.com/help/mcve\">an MVCE</a>?"}, {"owner": {"reputation": 642, "user_id": 2089343, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/63681b191138560e5d3b203e43927d55?s=128&d=identicon&r=PG", "display_name": "savior", "link": "https://stackoverflow.com/users/2089343/savior"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1529309632, "post_id": 50895930, "comment_id": 88810124, "body": "The content of the <code>_source</code> will change dynamicly . It dependent on the sql query.    So I can not define the <code>_source</code> constractor"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1529318466, "post_id": 50895930, "comment_id": 88815054, "body": "Does this help? <a href=\"https://stackoverflow.com/q/44514645/126014\">stackoverflow.com/q/44514645/126014</a>"}, {"owner": {"reputation": 642, "user_id": 2089343, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/63681b191138560e5d3b203e43927d55?s=128&d=identicon&r=PG", "display_name": "savior", "link": "https://stackoverflow.com/users/2089343/savior"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1529384079, "post_id": 50895930, "comment_id": 88841157, "body": "I guess you misunderstand what I means. My Input like <code>select * from table1</code> or <code>select id, name from tabble2</code>, so the <code>_resource</code> json with dynamic object with unknown keys and values. So I can not define a type , only I can do is use HashMap"}], "owner": {"reputation": 642, "user_id": 2089343, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/63681b191138560e5d3b203e43927d55?s=128&d=identicon&r=PG", "display_name": "savior", "link": "https://stackoverflow.com/users/2089343/savior"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1529232741, "creation_date": 1529232741, "question_id": 50895930, "link": "https://stackoverflow.com/questions/50895930/how-to-pptable-the-dynamic-json-string-useing-aeson-in-haskell", "title": "how to pptable the dynamic json String useing aeson in haskell", "body": "<p>I want to use the <code>pptable</code> and the <code>aeson</code> lib to change the json string to   table display in console.</p>\n\n<p>The json string come from the es table, it just like </p>\n\n<pre><code>{\n\"hits\": {\n \"hits\": [\n  {\n   \"_type\": \"tableName\", \n   \"_routing\": \"key\", \n   \"_source\": {\n    \"col1\": 1, \n    \"col2\": 0, \n    \"col3\": \"1\", \n    \"col4\": \"2\", \n    \"col5\": 2824, \n    \"col6\": \"2018-05-26 22:49:24\"\n   }, \n   \"_score\": 11.97, \n   \"_index\": \"mysql_\", \n   \"_id\": \"9\"\n  }\n ], \n \"total\": 1, \n \"max_score\": 11.97\n}, \n\"_shards\": {\n \"successful\": 30, \n \"failed\": 0, \n \"total\": 30\n}, \n\"took\": 60, \n\"timed_out\": false\n}\n</code></pre>\n\n<p>And I want to display a table just like </p>\n\n<pre><code>  +----------------------------------------------------------+\n  |col1|  col2 | col3 | col4 |   col5   |    col6            |\n  |  1 | 0     |  1   | 2    | 2824     | 2018-05-26 22:49:24|\n  +----------------------------------------------------------+\n</code></pre>\n\n<p>I can pase the json String to aeson Object and filter the <code>_source</code> sub object. But the Object type not deriving Generic. </p>\n\n<p>So I have no idea how to do with it.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1529229963, "post_id": 50895597, "comment_id": 88791186, "body": "You should add the <code>Num a</code> typeconstraint in the signature, like the error says."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1529229996, "post_id": 50895597, "comment_id": 88791197, "body": "Furthermore I have the idea that there is a semantical error in your code."}], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 4981613, "user_type": "registered", "profile_image": "https://graph.facebook.com/493228580842342/picture?type=large", "display_name": "Samuel Barkes", "link": "https://stackoverflow.com/users/4981613/samuel-barkes"}, "edited": false, "score": 0, "creation_date": 1529231348, "post_id": 50895657, "comment_id": 88791486, "body": "Many thanks for such a quick response! Just to clarify, why would the use of append be more inefficient than the cons constructor."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 29, "user_id": 4981613, "user_type": "registered", "profile_image": "https://graph.facebook.com/493228580842342/picture?type=large", "display_name": "Samuel Barkes", "link": "https://stackoverflow.com/users/4981613/samuel-barkes"}, "edited": false, "score": 0, "creation_date": 1529231471, "post_id": 50895657, "comment_id": 88791512, "body": "@SamuelBarkes: because <code>(:)</code> is a data constructor, so you use the constructor immediately, and then it is done. Using <code>(++)</code> is a function that uses recursion, it will require two recursive steps, and furthermore thus apply the cons <code>(:)</code> internally. You can here see its function definition: <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/src/GHC.Base.html#%2B%2B\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.11.1.0/docs/src/&hellip;</a>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1529230362, "creation_date": 1529230362, "answer_id": 50895657, "question_id": 50895597, "link": "https://stackoverflow.com/questions/50895597/haskell-error-no-instance-for-num-a-arising-from-the-literal-1/50895657#50895657", "title": "Haskell Error - No instance for (Num a) arising from the literal \u20181\u2019", "body": "<p>Well like the error says, you use <code>ins1</code>, and you write <code>[1] ++ [x] ++ ...</code>.</p>\n\n<p>Now <code>1</code> is a numerical literal, so it can take all <em>numerical types</em>. Hence <code>1</code> has type <code>Num b =&gt; b</code>, as a result <code>[1]</code> has type <code>Num b =&gt; [b]</code>.</p>\n\n<p>Later you append the list with <code>x</code> and recursion, hence we now know that <code>a ~ b</code> (<code>a</code> and <code>b</code> are the same type). So we have to add a type constraint to the signature for <code>a</code>:</p>\n\n<pre><code>ins1 :: <b>Num a =&gt;</b> [a] -&gt; [a]\nins1 [x] = [x]\nins1 (x:xs) = [1] ++ [x] ++ ins1(xs)</code></pre>\n\n<p>This solves the compile error, but probably will <em>not</em> generate what you want. Since now there is <em>no</em> case for the empty list. Indeed, both the <code>[x]</code> pattern and the <code>(x:xs)</code> pattern work with lists that respectively match with lists with <em>exactly one</em> element, and <em>at least</em> one element.</p>\n\n<p>Therefore I think that your first clause should actually match the empty list:</p>\n\n<pre><code>ins1 :: Num a =&gt; [a] -&gt; [a]\n<b>ins1 [] = []</b>\nins1 (x:xs) = [1] ++ [x] ++ ins1(xs)</code></pre>\n\n<p>There is also an inefficiency in the second clause: you append to a list of one element, so we can use the \"<em>cons</em>\" data cosntructor <code>(:)</code> here:</p>\n\n<pre><code>ins1 :: Num a =&gt; [a] -&gt; [a]\nins1 [] = []\nins1 (x:xs) = <b>1 : x : ins1 xs</b></code></pre>\n\n<p>This will insert a <code>1</code> for <em>every</em> element in the original list, so:</p>\n\n<pre><code>Prelude&gt; ins1 [1, 4, 2, 5]\n[1,1,1,4,1,2,1,5]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 1, "last_activity_date": 1529322967, "creation_date": 1529322967, "answer_id": 50908994, "question_id": 50895597, "link": "https://stackoverflow.com/questions/50895597/haskell-error-no-instance-for-num-a-arising-from-the-literal-1/50908994#50908994", "title": "Haskell Error - No instance for (Num a) arising from the literal \u20181\u2019", "body": "<p>If you give me a function of type <code>[a] -&gt; [a]</code>, you\u2019re saying that, <em>for all</em> types <code>a</code> that <em>I</em> choose, if I give you a list of values of type <code>a</code>, then you can give me back a list of elements of that type.</p>\n\n<p>So if I choose <code>a</code> to be <code>Int</code> by giving you <code>[2, 3, 4] :: [Int]</code>, then all is well: the literal <code>1</code> in the implementation of <code>ins1</code> is constrained from <code>Num t =&gt; t</code> by <code>t</code> = <code>Int</code> to <code>Num Int =&gt; Int</code>. That works because there is an <code>instance Num Int</code>.</p>\n\n<p>However, if I choose <code>a</code> to be <code>Char</code>, by giving you <code>['a', 'b', 'c']</code> (= <code>\"abc\"</code>), then <code>t</code> = <code>Char</code>, giving <code>Num Char =&gt; Char</code>, which is an error because there\u2019s no <code>instance Num Char</code>. Therefore, this is a <em>counterexample</em> for the type: your function doesn\u2019t work <em>for all</em> <code>a</code>, only those <code>a</code> that have an instance of <code>Num</code>. So you need to express this constraint in the type signature:</p>\n\n<pre><code>ins1 :: (Num a) =&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>The compiler can infer this for you, and will display a warning about a missing type signature if <code>-Wall</code> is enabled (or <code>-Wmissing-signatures</code> specifically). This will also warn about the fact that <code>ins1</code> is <em>non-exhaustive</em>: you don\u2019t handle the case of an empty input list. Alternatively, you can enter the definition into GHCi and ask for its type with <code>:type ins1</code> or <code>:t ins1</code>.</p>\n\n<p>Generic functions in Haskell are <em>parametrically polymorphic</em>, which means that if you have an unconstrained type variable like <code>a</code>, you know <em>nothing</em> about it, not even that it can be constructed from a number literal. So the <em>only</em> things a function of type <code>[a] -&gt; [a]</code> can do are copy, rearrange, or drop elements from the input, or fail to terminate (loop infinitely or raise an error)\u2014it can\u2019t construct new elements or perform any class-specific operations on those elements, such as <code>+</code> from <code>Num</code> or <code>&lt;</code> from <code>Ord</code>.</p>\n\n<p>This may sound limiting, but in fact it\u2019s incredibly useful: the less you know about a type, the fewer options you have for <em>misusing</em> it. And by a neat trick called the Curry\u2013Howard correspondence, you can examine a polymorphic function type like <code>head :: [a] -&gt; a</code> and think of it as a logical formula: does having a list of <code>a</code> imply you can get an <code>a</code>? No, because the list may be empty. So you know that a <code>head</code> function with this type <em>must</em> raise an error if the input is empty, because it has no generic way to construct an <code>a</code>.</p>\n"}], "owner": {"reputation": 29, "user_id": 4981613, "user_type": "registered", "profile_image": "https://graph.facebook.com/493228580842342/picture?type=large", "display_name": "Samuel Barkes", "link": "https://stackoverflow.com/users/4981613/samuel-barkes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 919, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1529322967, "creation_date": 1529229922, "last_edit_date": 1529230423, "question_id": 50895597, "link": "https://stackoverflow.com/questions/50895597/haskell-error-no-instance-for-num-a-arising-from-the-literal-1", "title": "Haskell Error - No instance for (Num a) arising from the literal \u20181\u2019", "body": "<p>I am trying to create a function which adds a 1 before each of the entries in a given list. I haven't quite grasped the syntax for Haskell and am wondering what is wrong with this code. For example, I would like this to return the list [1,1,1,2,1,3]</p>\n\n<pre><code>ins1 :: [a] -&gt; [a]\nins1 [x] = [x]\nins1 (x:xs) = [1] ++ [x] ++ ins1(xs)\n\nmain = print(ins1 [1,2,3])\n</code></pre>\n\n<p>I get the error:</p>\n\n<pre><code>\u2022 No instance for (Num a) arising from the literal \u20181\u2019\n  Possible fix:\n    add (Num a) to the context of\n      the type signature for:\n        ins1 :: [a] -&gt; [a]\n\u2022 In the expression: 1\n  In the first argument of \u2018(++)\u2019, namely \u2018[1]\u2019\n  In the expression: [1] ++ [x] ++ ins1 (xs)\n&lt;interactive&gt;:3:1: error:\n\u2022 Variable not in scope: main\n\u2022 Perhaps you meant \u2018min\u2019 (imported from Prelude)\n</code></pre>\n"}, {"tags": ["haskell", "haskell-beam"], "answers": [{"comments": [{"owner": {"reputation": 507, "user_id": 4966887, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b2d9b78341809c8b9b01ac9ae3f3c72?s=128&d=identicon&r=PG&f=1", "display_name": "Chirs", "link": "https://stackoverflow.com/users/4966887/chirs"}, "edited": false, "score": 0, "creation_date": 1529239528, "post_id": 50895977, "comment_id": 88793305, "body": "Thank you for your answer. Is there a way I could solve the ambiguity by using <code>TypeApplications</code>? I could not figure out how, but maybe instead of requiring <code>F</code>, I could pass <code>res0</code> via an explicit type application? I&#39;m not particularly set on this specific form of <code>runPaginatedQuery</code>; I&#39;m just trying to factor out a &quot;pagination&quot; pattern."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 507, "user_id": 4966887, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b2d9b78341809c8b9b01ac9ae3f3c72?s=128&d=identicon&r=PG&f=1", "display_name": "Chirs", "link": "https://stackoverflow.com/users/4966887/chirs"}, "edited": false, "score": 0, "creation_date": 1529245646, "post_id": 50895977, "comment_id": 88794802, "body": "@Chirs I don&#39;t think type applications can help here, it&#39;s not an ambiguity issue. One would need type-level lambdas for this, but Haskell does not have them. I think I see what you are trying to achieve, and I think it&#39;s a nice problem, but I can&#39;t see a solution at the moment."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1529233174, "creation_date": 1529233174, "answer_id": 50895977, "question_id": 50895362, "link": "https://stackoverflow.com/questions/50895362/rank2types-would-escape-its-scope-beam/50895977#50895977", "title": "Rank2Types, &quot;... would escape its scope&quot; (beam)", "body": "<p>Basically, <code>runPaginatedQuery</code> requires the result type <code>res</code> of the query not to depend on <code>s</code>. But yours does.</p>\n\n<pre><code> Expected type: Q SqliteSelectSyntax SchoolDb s res0\n    Actual type: Q SqliteSelectSyntax\n                   SchoolDb\n                   s\n                   (StudentT (QExpr\n                   (Database.Beam.Backend.SQL.SQL92.Sql92SelectTableExpressionSyntax\n                   (Database.Beam.Backend.SQL.SQL92.Sql92SelectSelectTableSyntax\n                   SqliteSelectSyntax))\n                   s))\n               -- ^^^\n</code></pre>\n\n<p>I can't see any easy fix. The type of <code>runPaginatedQuery</code> looks too restrictive. </p>\n\n<p>Intuitively, it should take something like <code>(forall s. Q SqliteSelectSyntax db s (F s))</code> where <code>F</code> is some type-level function, required to make <code>QExprToIdentity (F s)</code> to be independent from <code>s</code>. We can't however universally quantify on type-level functions <code>F</code> in Haskell.</p>\n\n<p>Your code is close to requiring this, but implicitly requires <code>F s</code> itself to be a type <code>res</code> which is independent from <code>s</code>, which is too much.</p>\n"}, {"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1571493433, "creation_date": 1571493433, "answer_id": 58464426, "question_id": 50895362, "link": "https://stackoverflow.com/questions/50895362/rank2types-would-escape-its-scope-beam/58464426#58464426", "title": "Rank2Types, &quot;... would escape its scope&quot; (beam)", "body": "<p>You can do what you ask for, in some specific cases:</p>\n\n<p>The problem, is that for general <code>res</code> it's hard to do anything.\nBut really, you'd aggregate over some <code>table</code>. So if you massage the type,\nit will type-check and work out, as we can get <code>s</code> into place where you had <code>res</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>runPaginatedQuery\n    :: (Beamable table, FromBackendRow Sqlite (table Identity))\n    =&gt; Connection -&gt; Int -&gt; Int\n    -&gt; (forall s. Q Sqlite db s (table (QExpr Sqlite s)))\n    -&gt; IO ([table Identity], Int)\n</code></pre>\n\n<p>This `runPaginatedQuery will accept your example</p>\n\n<pre><code>all_ (_students schoolDb)\n</code></pre>\n\n<p>query.</p>\n\n<p>But won't accept more interesting queries like, i.e. which don't return whole table as is</p>\n\n<pre><code>do s &lt;- all_ (_students schoolDb)\n   return (studentFoo s)\n</code></pre>\n\n<p>I still think it's possible to make it work:</p>\n\n<p>You'll need to define own type-class, with instances following\nthe structure of <a href=\"https://hackage.haskell.org/package/beam-core-0.8.0.0/docs/Database-Beam-Query.html#t:QExprToIdentity\" rel=\"nofollow noreferrer\"><code>QExprToIdentity</code></a> (and <a href=\"https://hackage.haskell.org/package/beam-core-0.8.0.0/docs/Database-Beam-Query-Internal.html#t:ThreadRewritable\" rel=\"nofollow noreferrer\"><code>ThreadRewritable</code></a> etc.).</p>\n\n<p>I'm not saying it's easy, but I'm quite sure it's possible.</p>\n\n<hr>\n\n<p>Btw, next time, please provide a more complete example so the people trying to help would start quickly:</p>\n\n<p>Here's complete example you can load into GHCi:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies #-}\n\nimport Database.Beam\nimport Database.Beam.Sqlite\nimport Database.Beam.Sqlite.Connection\nimport Database.Beam.Sqlite.Syntax\nimport Database.SQLite.Simple\n\n\nrunPaginatedQuery\n    :: (Beamable table, FromBackendRow Sqlite (table Identity))\n    =&gt; Connection -&gt; Int -&gt; Int\n    -&gt; (forall s. Q Sqlite db s (table (QExpr Sqlite s)))\n    -&gt; IO ([table Identity], Int)\nrunPaginatedQuery conn limit offset q = do\n  Just count &lt;- runBeamSqlite conn $ runSelectReturningOne $ select $ aggregate_ (const $ countAll_) q\n  l &lt;-  runBeamSqlite conn $ runSelectReturningList $ select q\n  return (l,count)\n\ndata StudentT f = Student\n    { studentId :: C f Int\n    }\n  deriving (Generic, Beamable)\n\ntype Student = StudentT Identity\n\ninstance Table StudentT where\n    newtype PrimaryKey StudentT f  = StudentId (C f Int)\n      deriving (Generic, Beamable)\n\n    primaryKey = StudentId . studentId\n\ndata SchoolDb f = SchoolDb\n    { _students :: f (TableEntity StudentT) }\n  deriving (Generic, Database be)\n\nschoolDb :: DatabaseSettings be SchoolDb\nschoolDb = defaultDbSettings\n\nmain = do\n  conn &lt;- open \"test.db\"\n  (ss :: [Student], n) &lt;- runPaginatedQuery conn 20 0 (all_ (_students schoolDb))\n  print (n :: Int)\n</code></pre>\n"}], "owner": {"reputation": 507, "user_id": 4966887, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b2d9b78341809c8b9b01ac9ae3f3c72?s=128&d=identicon&r=PG&f=1", "display_name": "Chirs", "link": "https://stackoverflow.com/users/4966887/chirs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 1, "accepted_answer_id": 50895977, "answer_count": 2, "score": 1, "last_activity_date": 1571493433, "creation_date": 1529227816, "last_edit_date": 1529263923, "question_id": 50895362, "link": "https://stackoverflow.com/questions/50895362/rank2types-would-escape-its-scope-beam", "title": "Rank2Types, &quot;... would escape its scope&quot; (beam)", "body": "<p>Currently I'm trying to use more of the composability of <code>beam</code>. Unfortunately I cannot figure out if what I am trying to do is even possible. What I am trying to do is write a function, that takes a <code>Q</code> query, and selects from the query twice, once unmodified and once wrapped into a \"count(*)\"-aggregate.</p>\n\n<p>So far I got this function:</p>\n\n<pre><code>runPaginatedQuery :: ( QExprToIdentity res ~ a\n                     , FromBackendRow Sqlite (QExprToIdentity res)\n                     , ProjectibleWithPredicate ValueContext SqliteExpressionSyntax res\n                     , ProjectibleWithPredicate AnyType SqliteExpressionSyntax res\n                     )\n                    =&gt; Connection -&gt; Int -&gt; Int\n                    -&gt; (forall s. Q SqliteSelectSyntax db s res)\n                    -&gt; IO ([a], Int)\nrunPaginatedQuery conn limit offset q = do\n  (Just count) &lt;- runBeamSqlite conn $ runSelectReturningOne $ select $ aggregate_ (const $ countAll_) q\n  l &lt;-  runBeamSqlite conn $ runSelectReturningList $ select q\n  return (l,count)\n</code></pre>\n\n<p>The function type checks, but if I try to use it, e.g.</p>\n\n<pre><code>main = do\n  conn &lt;- open \"test.db\"\n  (ss :: [Student], n) &lt;- runPaginatedQuery conn 20 0 (all_ (_students schoolDb))\n  print n\n</code></pre>\n\n<p>I get the following type error:</p>\n\n<pre><code>src/Main.hs:57:56: error:\n    \u2022 Couldn't match type \u2018res0\u2019\n                     with \u2018StudentT (QExpr SqliteExpressionSyntax s)\u2019\n        because type variable \u2018s\u2019 would escape its scope\n      This (rigid, skolem) type variable is bound by\n        a type expected by the context:\n          forall s. Q SqliteSelectSyntax SchoolDb s res0\n        at src/Main.hs:57:27-81\n      Expected type: Q SqliteSelectSyntax SchoolDb s res0\n        Actual type: Q SqliteSelectSyntax\n                       SchoolDb\n                       s\n                       (StudentT\n                          (QExpr\n                             (Database.Beam.Backend.SQL.SQL92.Sql92SelectTableExpressionSyntax\n                                (Database.Beam.Backend.SQL.SQL92.Sql92SelectSelectTableSyntax\n                                   SqliteSelectSyntax))\n                             s))\n    \u2022 In the fourth argument of \u2018runPaginatedQuery\u2019, namely\n        \u2018(all_ (_students schoolDb))\u2019\n      In a stmt of a 'do' block:\n        (ss :: [Student], n) &lt;- runPaginatedQuery\n                                  conn 20 0 (all_ (_students schoolDb))\n      In the expression:\n        do conn &lt;- open \"test.db\"\n           (ss :: [Student], n) &lt;- runPaginatedQuery\n                                     conn 20 0 (all_ (_students schoolDb))\n           print \"hi\"\n   |\n57 |   (ss :: [Student], n) &lt;- runPaginatedQuery conn 20 0 (all_ (_students schoolDb))\n   |                                                        ^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I'm having trouble understanding the error message. </p>\n\n<p><em>Edit:</em> It seems that what I am trying to achieve is currently not possible, hence I accepted @chi's answer as it has a good explanation <em>why</em> it is not possible.</p>\n"}, {"tags": ["haskell", "types", "ghc", "type-inference", "gadt"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1529227801, "post_id": 50895331, "comment_id": 88790742, "body": "I do not really follow why you think that it should use <code>G Char</code> in the first place? Deriving types typically happens by first using the most generic type, and subsequently replacing types based on elements in the head and body of the function."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1529229483, "post_id": 50895331, "comment_id": 88791083, "body": "By &quot;how does it do this&quot; what do you mean? Do you want an explanation of Hindley-Milner in this context?"}, {"owner": {"reputation": 5576, "user_id": 767632, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/75a05c23a398c887e8f085b9c870586c?s=128&d=identicon&r=PG", "display_name": "yeputons", "link": "https://stackoverflow.com/users/767632/yeputons"}, "edited": false, "score": 2, "creation_date": 1529232166, "post_id": 50895331, "comment_id": 88791678, "body": "<code>f</code> does not impose any restrictions on its input, except that it should be <code>G</code>. The function does not analyze <code>a</code> or <code>s</code> any further. The fact that in <code>B</code> can be used for <code>G Char</code> only is irrelevant for deducing <code>f</code>&#39;s type."}, {"owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 1, "creation_date": 1529232219, "post_id": 50895331, "comment_id": 88791687, "body": "I think the confusion stems from not knowing that the algorithm looks for the <b>most generic</b> matching type. E.g. when looking at <code>f (B s)</code> one could be tempted to think that the argument must have type <code>G Char</code> and not the more general <code>G a</code>."}, {"owner": {"reputation": 767, "user_id": 814796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZQemO.jpg?s=128&g=1", "display_name": "madgen", "link": "https://stackoverflow.com/users/814796/madgen"}, "reply_to_user": {"reputation": 5576, "user_id": 767632, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/75a05c23a398c887e8f085b9c870586c?s=128&d=identicon&r=PG", "display_name": "yeputons", "link": "https://stackoverflow.com/users/767632/yeputons"}, "edited": false, "score": 0, "creation_date": 1529234743, "post_id": 50895331, "comment_id": 88792224, "body": "@yeputons yes, I was under the impression that Char would constrain the type variable. Thanks!"}, {"owner": {"reputation": 767, "user_id": 814796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZQemO.jpg?s=128&g=1", "display_name": "madgen", "link": "https://stackoverflow.com/users/814796/madgen"}, "reply_to_user": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "edited": false, "score": 0, "creation_date": 1529234846, "post_id": 50895331, "comment_id": 88792250, "body": "@mschmidt @yeputon answers my question, but I do know it looks for the most generic matching type. I was under the impression that <code>G Char</code> on the left hand-side in HM would constrain the type variable to be <code>Char</code> which cannot be generalised to <code>a</code>."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1529232686, "creation_date": 1529232686, "answer_id": 50895925, "question_id": 50895331, "link": "https://stackoverflow.com/questions/50895331/how-does-ghc-infer-the-intended-type-for-this-gadt/50895925#50895925", "title": "How does GHC infer the intended type for this GADT?", "body": "<p><a href=\"https://stackoverflow.com/questions/28582210/type-inference-with-gadts-a0-is-untouchable/28582695#28582695\">GHC \u201cdisables\u201d Hindley-Milner in GADT pattern matching, so as to prevent dynamic type information from escaping its scope.</a></p>\n\n<p>Here's a more extreme example:</p>\n\n<pre><code>import Data.Void\n\ndata Idiotic :: * -&gt; * where\n  Impossible :: !Void -&gt; Idiotic Void\n  Possible :: a -&gt; Idiotic a\n</code></pre>\n\n<p>There don't exist any values of type <code>Void</code>, so it isn't possible to ever use the <code>Impossible</code> constructor. Thus, <code>Idiotic a</code> is actually isomorphic to <code>Identity a</code>, IOW to <code>a</code> itself. So, any function that takes an <code>Idiotic</code> value is fully described by just the <code>Possible</code> pattern match. Basically, it always boils down to</p>\n\n<pre><code>sobre :: Idiotic a -&gt; a\nsobre (Possible a) = a\n</code></pre>\n\n<p>which is easy usable in practice.</p>\n\n<p>But as far as the <em>type system</em> is concerned, the other constructor matches just as well, and is in fact required to disable the <code>incomplete pattern</code> warning:</p>\n\n<pre><code>sobre (Impossible a) = {- Here, a::Void -} a\n</code></pre>\n\n<p>But if the compiler propagated this type information outwards, your function would end up with the completely useless signature</p>\n\n<pre><code>sobre :: Idiotic Void -&gt; Void\n</code></pre>\n"}], "owner": {"reputation": 767, "user_id": 814796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZQemO.jpg?s=128&g=1", "display_name": "madgen", "link": "https://stackoverflow.com/users/814796/madgen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 50895925, "answer_count": 1, "score": 2, "last_activity_date": 1529232686, "creation_date": 1529227420, "last_edit_date": 1529231706, "question_id": 50895331, "link": "https://stackoverflow.com/questions/50895331/how-does-ghc-infer-the-intended-type-for-this-gadt", "title": "How does GHC infer the intended type for this GADT?", "body": "<p>My understanding of GHC type inference was that in the absence of type annotations, it will default to Hindley-Milner. However, to my pleasant surprise GHC infers <code>Num p =&gt; G a -&gt; p</code> for <code>f</code> as opposed to <code>Num p =&gt; G Char -&gt; p</code>.</p>\n\n<pre><code>data G a where\n  A :: a      -&gt; G a\n  B :: String -&gt; G Char\n\nf (A a) = 42\nf (B s) = 24\n</code></pre>\n\n<p>My question is how does it do this and under what other situations it will infer the correct type for a GADT?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 3, "creation_date": 1529205642, "post_id": 50893020, "comment_id": 88787141, "body": "<code>poly = zipWith $ \\x y -&gt; (*x) . (**y)</code> is a simpler way to write that function"}, {"owner": {"reputation": 709, "user_id": 7143310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/xrMna.jpg?s=128&g=1", "display_name": "Jader Martins", "link": "https://stackoverflow.com/users/7143310/jader-martins"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1529277706, "post_id": 50893020, "comment_id": 88802248, "body": "@4castle with your answer and @Victoria Ruiz I could solve, thx the final form is <code>poly = zipWith $ \\x y -&gt; (* (fromIntegral x)) . (** (fromIntegral y))</code>"}], "answers": [{"tags": [], "owner": {"reputation": 4533, "user_id": 1342581, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/3UuMS.jpg?s=128&g=1", "display_name": "Victoria Ruiz", "link": "https://stackoverflow.com/users/1342581/victoria-ruiz"}, "is_accepted": true, "score": 5, "last_activity_date": 1529222626, "last_edit_date": 1529222626, "creation_date": 1529199785, "answer_id": 50893037, "question_id": 50893020, "link": "https://stackoverflow.com/questions/50893020/casting-int-to-double-from-input/50893037#50893037", "title": "Casting [Int] to [Double] from input", "body": "<p>You can use <a href=\"https://www.haskell.org/hoogle/?hoogle=fromIntegral\" rel=\"nofollow noreferrer\"><code>fromIntegral</code></a>, which will convert from any Integral type into any Numeric type (Int, Integer, Rational, and Double).</p>\n\n<p>More here: <a href=\"https://wiki.haskell.org/Converting_numbers\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Converting_numbers</a></p>\n"}, {"tags": [], "owner": {"reputation": 709, "user_id": 7143310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/xrMna.jpg?s=128&g=1", "display_name": "Jader Martins", "link": "https://stackoverflow.com/users/7143310/jader-martins"}, "is_accepted": false, "score": 0, "last_activity_date": 1529277877, "creation_date": 1529277877, "answer_id": 50901231, "question_id": 50893020, "link": "https://stackoverflow.com/questions/50893020/casting-int-to-double-from-input/50901231#50901231", "title": "Casting [Int] to [Double] from input", "body": "<p>With @4castle and Victoria Ruiz I came up with the following:</p>\n\n<pre><code>poly :: [Int] -&gt; [Int] -&gt; [Double -&gt; Double]\npoly = zipWith $ \\x y -&gt; (* (fromIntegral x)) . (** (fromIntegral y))\n\napply ::  Double -&gt; [Double -&gt; Double] -&gt; Double\napply x b = sum $ ($x) &lt;$&gt; b\n-- l=left limiting, r=right limiting, a=coeficients, b=degrees\nsolve :: Int -&gt; Int -&gt; [Int] -&gt; [Int] -&gt; [Double]\nsolve l r a b =\n  let h        = 0.001\n      linspace = [fromIntegral l,fromIntegral l+h..fromIntegral r]\n      p = poly a b\n      area = sum $ map ((*h) . (`apply` p)) linspace\n      volume = h * (sum $ map ((*pi) . (**2) .(`apply` p)) linspace)\n  in [area,volume]\n</code></pre>\n\n<p>I think Haskell compiler with his strong type inference has some peculiarities that can't be directly solved by type cast.</p>\n"}], "owner": {"reputation": 709, "user_id": 7143310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/xrMna.jpg?s=128&g=1", "display_name": "Jader Martins", "link": "https://stackoverflow.com/users/7143310/jader-martins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 50893037, "answer_count": 2, "score": 1, "last_activity_date": 1604588361, "creation_date": 1529199583, "last_edit_date": 1604588361, "question_id": 50893020, "link": "https://stackoverflow.com/questions/50893020/casting-int-to-double-from-input", "title": "Casting [Int] to [Double] from input", "body": "<p>I have a list of constants and degrees of a polynomial equation and want to return a list of this composition for a value be applied and then summed. But this list comes as Int and my function expects a list of double.</p>\n\n<pre><code>poly :: [Double] -&gt; [Double] -&gt; [Double -&gt; Double]\npoly a b =\n  let f x y = (*x) . (**y)\n        in uncurry f &lt;$&gt; zip a b\n\n-- does not work\npoly ([1,2,3]:: [Double]) ([1,2,3]:: [Double])\n</code></pre>\n\n<p>How to cast a list of int to list of double?</p>\n"}, {"tags": ["json", "parsing", "haskell", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1529185233, "creation_date": 1529185233, "answer_id": 50891979, "question_id": 50891866, "link": "https://stackoverflow.com/questions/50891866/haskell-aeson-parse-mixed-elements-array/50891979#50891979", "title": "Haskell Aeson Parse Mixed Elements Array", "body": "<p>Yes, we can for example first construct a function that maps <code>Value</code>s (these are JSON objects) to <code>Maybe String</code>s:</p>\n\n<pre><code>import Data.Aeson(Value(String))\nimport Data.Text(unpack)\n\ngetString :: Value -&gt; Maybe String\ngetString (String t) = Just (unpack t)\ngetString _ = Nothing\n</code></pre>\n\n<p>We can then define a custom implementation of <code>FromJOSN</code> for <code>Adventurer</code> like:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Aeson(FromJSON(parseJSON), withObject, (.:))\nimport Data.Maybe(catMaybes)\n\ninstance FromJSON Adventurer where\n    parseJSON = withObject \"Adventurer\" $ \\v -&gt; Adventurer\n        &lt;$&gt; v .: \"name\"\n        &lt;*&gt; fmap (catMaybes . map getString) (v .: \"items\")\n</code></pre>\n\n<p>This then yields for example:</p>\n\n<pre><code>Main&gt; t = \"{\\n  \\\"name\\\" : \\\"Sam\\\",\\n  \\\"items\\\": [ \\\"sword\\\", \\\"shield\\\", [] ]\\n}\"\nMain&gt; decode t :: Maybe Adventurer \nJust (Adventurer {name = \"Sam\", items = [\"sword\",\"shield\"]})\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 6466670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0891fbdfa3e36da737793b4556a2f552?s=128&d=identicon&r=PG&f=1", "display_name": "oddbit", "link": "https://stackoverflow.com/users/6466670/oddbit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 50891979, "answer_count": 1, "score": 2, "last_activity_date": 1529185233, "creation_date": 1529184289, "question_id": 50891866, "link": "https://stackoverflow.com/questions/50891866/haskell-aeson-parse-mixed-elements-array", "title": "Haskell Aeson Parse Mixed Elements Array", "body": "<p>I have a json like:</p>\n\n<pre><code>{\n  \"name\" : \"Sam\",\n  \"items\": [ \"sword\", \"shield\", [] ]\n}\n</code></pre>\n\n<p>and a data type</p>\n\n<pre><code>data Adventurer = Adventurer {\n  name :: String,\n  items :: [String]\n} deriving (Generic, Show, FromJSON, ToJSON)\n</code></pre>\n\n<p>The problem is caused by the fact that the \"items\" field has the extra [] in the array and I get \"expected String, encountered Array\".</p>\n\n<p>I've been trying to fix this with custom data types for the elements of the \"items\" array, or trying make a custom parser to ignore the extra array.</p>\n\n<p>Is there a way to parse an array and only take the items which are of a certain type, dropping the rest?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 2, "creation_date": 1529183918, "post_id": 50891711, "comment_id": 88784344, "body": "Well, the <code>when&#39;</code> you are supposing is just <code>when&#39; p f x = if p x then f x else pure x</code> It&#39;s not defined in the standard library, but you can define it yourself (and perhaps use a different name, like conditionalBind or something similar, so you don&#39;t clash with <code>Control.Monad.when</code>). Not sure how much of an answer this is because you are looking for a <i>library</i> function, so I put this in as a comment."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1529188228, "post_id": 50891711, "comment_id": 88785174, "body": "If, as I think, <code>conditionN</code> can depend on all the previous values, this is hard to generalize."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1529196084, "creation_date": 1529196084, "answer_id": 50892804, "question_id": 50891711, "link": "https://stackoverflow.com/questions/50891711/conditionally-apply-functions-to-value-in-sequence/50892804#50892804", "title": "Conditionally apply functions to value in sequence", "body": "<p>So you have:</p>\n\n<pre><code>value :: a\nf1, f2, f3 :: a -&gt; a\ncond1,cond2,cond3 :: a -&gt; Bool\n</code></pre>\n\n<p>You said you can do it with a monad.  Why not use a monad?</p>\n\n<pre><code>import Control.Monad.Trans.State\nwhenM f op =\n       do s &lt;- f &lt;$&gt; get\n          if s then op else pure ()\nall3 :: a -&gt; a\nall3 val = flip execState val $\n    do whenM cond1 $ modify f1\n       whenM cond2 $ modify f2\n       whenM cond3 $ modify f3\n</code></pre>\n\n<p>Or don't and just make a helper or two:</p>\n\n<pre><code>all3again :: Int -&gt; Int\nall3again val =\n    ite cond1 f1 val\n    |&gt; ite cond2 f2\n    |&gt; ite cond3 f3\n\nite :: (a -&gt; Bool) -&gt; (a -&gt; a) -&gt; a -&gt; a\nite c a v | c v = a v\n          | otherwise = v\n\n(|&gt;) :: a -&gt; (a -&gt; b) -&gt; b\n(|&gt;) v f = f v\ninfixl 5 |&gt;\n</code></pre>\n"}], "owner": {"reputation": 158, "user_id": 3290534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d85b516af109d04f0709b3eac0607fa?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Campos", "link": "https://stackoverflow.com/users/3290534/ian-campos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 50892804, "answer_count": 1, "score": 1, "last_activity_date": 1529196084, "creation_date": 1529182895, "question_id": 50891711, "link": "https://stackoverflow.com/questions/50891711/conditionally-apply-functions-to-value-in-sequence", "title": "Conditionally apply functions to value in sequence", "body": "<p>If I have a value and I want to apply multiple transformations to it using monads, I can do this,</p>\n\n<pre><code>func3 =&lt;&lt; func2 =&lt;&lt; func1 value\n</code></pre>\n\n<p>but if I want each function to execute conditionally, this is the way I think it could be done.</p>\n\n<pre><code>applyFuncs value = do\n  if condition1\n    then value' &lt;- func1 value\n    else let value' = value\n  if condition2\n    then value'' &lt;- func2 value'\n    else let value'' = value'\n  if condition3\n    then value''' &lt;- func3 value''\n    else let value''' &lt;- value''\n  return value'''\n</code></pre>\n\n<p>However, writing this is tedious, so I looked for a solution online, but somehow I was unable to find anything of use. Is there maybe a library function that I can use like this?</p>\n\n<pre><code>when' condition3 func3 =&lt;&lt; when' condition2 func2 =&lt;&lt; when' condition1 func1\n</code></pre>\n"}, {"tags": ["haskell", "class-constants", "haskell-persistent", "haskell-spock"], "owner": {"reputation": 43, "user_id": 3821360, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb943717c5cf6e5af82a78bc4e90220f?s=128&d=identicon&r=PG&f=1", "display_name": "SJH", "link": "https://stackoverflow.com/users/3821360/sjh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1529177112, "creation_date": 1529177112, "question_id": 50891039, "link": "https://stackoverflow.com/questions/50891039/reduce-class-constraints-in-haskell-and-inspecting-persistent-tables", "title": "Reduce class constraints in haskell and inspecting persistent tables", "body": "<p>I'm trying to setup a basic endpoint which takes an id and goes through a join table to return all joined records using persistent and spock, a working implementation looks like this.</p>\n\n<pre><code>get (\"songs\" &lt;//&gt; var) $ \\id -&gt; do\n  song &lt;- getRecord404 $ SongKey id\n  tags &lt;- runSQL $ select $\n    from $ \\(tag `InnerJoin` songTag) -&gt; do\n      on (songTag ^. SongTagTagId ==. tag ^. TagId)\n      where_ (songTag ^. SongTagSongId ==. val (SongKey id))\n      return (tag)\n  json $ object [\"song\" .= song, \"tags\" .= tags]\n\ngetRecord404 :: (PersistEntity a, PersistEntityBackend a ~ SqlBackend, MonadIO m0, Monad m, ActionCtxT ctx m0 ~ m, HasSpock m, SpockConn m ~ SqlBackend) =&gt; Key a -&gt; m (Entity a)\ngetRecord404 k = do\n  res &lt;- getRecord k\n  guardNotFound res\n\nguardNotFound :: MonadIO m =&gt; Maybe (Entity a) -&gt; ActionCtxT ctx m (Entity a)\nguardNotFound Nothing = do\n  setStatus status404\n  text \"Not found\"\nguardNotFound (Just a) = return a\n</code></pre>\n\n<p>Question 1: Does the class constraints have to be so large on these functions? It seems like trying to compose these monads would get tiresome quickly with so many constraints. I've seen that I can use Constraint Kinds to setup constraint synonyms, but I feel like maybe I'm doing something wrong to need so many constraints.</p>\n\n<p>I also wanted to see if I could write a more generic method for performing the join operation.\nPresumably it would be sufficient information to have the input type, and the table used for the join, the could compiler could infer the output type and (at least in a language like ruby) you could inspect the join table type to find the proper columns to join on. Something like:</p>\n\n<pre><code>manyThrough :: (Monad m...) =&gt; Key a -&gt; [Somehow pass the information about which table to use] -&gt; m [Entity B]\n</code></pre>\n\n<p>Trying to implement such a function is beyond me though. I'm not sure what is the best way to pass the information about which table to use for the join. I implemented a version which passes the columns explicitly (below), which works but it again has a huge class constraint, and takes a larger method signature than I'd like. Is there an way to achieve something like the signature above?</p>\n\n<pre><code>manyThrough :: (PersistEntity t1, PersistEntity t2, PersistField (Key b) , PersistField (Key a), PersistEntityBackend t1 ~ SqlBackend, PersistEntityBackend t2 ~ SqlBackend, SpockConn m ~ SqlBackend, typ2 ~ Key b, typ1 ~ Key a, HasSpock m, SqlSelect (SqlExpr (Entity t2)) (Entity b)) =&gt; typ1 -&gt; EntityField t1 typ1 -&gt; EntityField t1 typ2 -&gt;  EntityField t2 typ2 -&gt; m [Entity b]\nmanyThrough key joinId1 joinId2 targetId= runSQL $ select $\n      from $ \\(joinTable `InnerJoin` target) -&gt; do\n        on (joinTable ^. joinId2 ==. target ^. targetId)\n        where_ (joinTable ^. joinId1 ==. val (key))\n        return (target)\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 1, "creation_date": 1529183694, "post_id": 50890044, "comment_id": 88784309, "body": "Great answer. One extra source of info on stack.yaml vs package.yaml: <a href=\"https://docs.haskellstack.org/en/stable/stack_yaml_vs_cabal_package_file/\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/&hellip;</a>"}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1529332802, "post_id": 50890044, "comment_id": 88823852, "body": "@Shersh, do you have any more examples of the usage of <code>Setup.hs</code>? We also use proto-lens and that sounds like a great way to use it, but I&#39;m still not 100% sure what you put in that file/how it generates modules, etc."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 2, "creation_date": 1529373083, "post_id": 50890044, "comment_id": 88839019, "body": "@jkeuhlen You can see usage example in this GitHub repository: <a href=\"https://github.com/holmusk/three-layer\" rel=\"nofollow noreferrer\">github.com/holmusk/three-layer</a>"}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 17, "last_activity_date": 1529169423, "creation_date": 1529169423, "answer_id": 50890044, "question_id": 50889497, "link": "https://stackoverflow.com/questions/50889497/what-is-package-yaml-stack-yaml-setup-hs-the-project-name-cabal-files/50890044#50890044", "title": "What is package.yaml &amp; stack.yaml &amp; Setup.hs &amp; the-project-name.cabal files?", "body": "<p>Those configuration files serve different purposes. It's not clear what is better: have single all-inclusive configuration file or different files for different build tools and different goals.</p>\n\n<h3>the-project-name.cabal</h3>\n\n<p>This file contains description of your package. Like, list of modules, library dependencies, compiler options, project metadata (author's name, package version, etc.). This description is specified in special for <code>cabal</code> format.</p>\n\n<h3>package.yaml</h3>\n\n<p>This configuration file is used by <a href=\"https://github.com/sol/hpack\" rel=\"noreferrer\"><code>hpack</code></a> tool. It allows to specify the same things you specify in <code>.cabal</code> file. But in YAML format instead of custom <code>cabal</code> format. Also it adds some features over <code>cabal</code>. If you don't want to dive into <code>hpack</code> for now you can safely delete <code>package.yaml</code> file. Note, that <code>.cabal</code> file is generated by <code>hpack</code> from <code>package.yaml</code> file so you <strong>mustn't</strong> edit <code>.cabal</code> file if you're using <code>hpack</code>.</p>\n\n<h3>stack.yaml</h3>\n\n<p>Configuration for <code>stack</code> build tool. Add some extra configuration parameters. Most important: name of the LTS resolver.</p>\n\n<h3>Setup.hs</h3>\n\n<p>Used to add some build-hooks. In almost all cases you can delete this file as well. But I can give you real-life usage example of this file from our work.</p>\n\n<p>We're writing service where different nodes should communicate using Protocol Buffers format. TL;DR pretty good format for describing message specifications. Those messages are written in files with extension <code>.proto</code>. But we actually want to work with Haskell types. There exist library <code>proto-lens</code> which can take files written in Protocol Buffers format, parse those files and generate Haskell modules containing data types representing those messages. This file generation should be done before project compilation. So this process is described in <code>Setup.hs</code> file.</p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1570, "favorite_count": 6, "accepted_answer_id": 50890044, "answer_count": 1, "score": 17, "last_activity_date": 1529169423, "creation_date": 1529164925, "last_edit_date": 1529169011, "question_id": 50889497, "link": "https://stackoverflow.com/questions/50889497/what-is-package-yaml-stack-yaml-setup-hs-the-project-name-cabal-files", "title": "What is package.yaml &amp; stack.yaml &amp; Setup.hs &amp; the-project-name.cabal files?", "body": "<p>I find that, when I use the <code>stack new the-project-name new-template</code> command, many files is generated into a new directory. and I notice the following 4 special files:</p>\n\n<pre><code>package.yaml\nstack.yaml\nSetup.hs\nthe-project-name.cabal\n</code></pre>\n\n<p>These 4 files seems intending to provide meta data for package-managing software, but they looks confusing, I mean, why there are 4 of them, why not just one, and what's the difference between them?</p>\n"}, {"tags": ["haskell", "programming-languages", "agda", "type-theory"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1529197393, "post_id": 50889455, "comment_id": 88786247, "body": "The answer I would\u2019ve written, \u201cit\u2019s the Kleisli category of the <code>Term</code> monad\u201d, has already been given below, so I\u2019ll just point you towards some further reading: <a href=\"https://gallais.github.io/pdf/cpp2017.pdf\" rel=\"nofollow noreferrer\"><i>Type- and Scope-Safe Programs and Their Proofs</i></a>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1529197820, "post_id": 50889455, "comment_id": 88786289, "body": "\u201cin the best case it will end up being a tower of closures\u201d - the function doesn\u2019t have to be built by composition. Nothing stopping you from just doing a <code>Map</code> lookup inside the function"}, {"owner": {"reputation": 2824, "user_id": 278132, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/90223794e61bfb997dc23e7300c76f12?s=128&d=identicon&r=PG", "display_name": "Jacques Carette", "link": "https://stackoverflow.com/users/278132/jacques-carette"}, "edited": false, "score": 0, "creation_date": 1571508235, "post_id": 50889455, "comment_id": 103267720, "body": "How do you understand that <code>Term node ()</code> is a context?  If I unravel that definition, I get a tree of <code>node</code>s. How is that a context?"}, {"owner": {"reputation": 513, "user_id": 1125434, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/82b90125633760405d3f95b1a2ab95a0?s=128&d=identicon&r=PG", "display_name": "taktoa", "link": "https://stackoverflow.com/users/1125434/taktoa"}, "edited": false, "score": 0, "creation_date": 1571600214, "post_id": 50889455, "comment_id": 103285885, "body": "When I say a &quot;context&quot;, I mean that in the sense of &quot;a term with exactly one free variable&quot;. Like an evaluation context; not like a typing context."}], "answers": [{"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1529258676, "post_id": 50892129, "comment_id": 88798116, "body": "&quot;indices of <code>Subst</code> are usually in swapped order&quot; -- do you know why this is the case?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 2, "creation_date": 1529574655, "post_id": 50892129, "comment_id": 88927281, "body": "@user3237465 A term is a single thing in a context, a substitution is zero or more things in a context. This suggests notation such as \u0393 \u22a2 t : A and \u0393 \u22a2 \u03c3 : \u0394, or people use (\u0393 \u21d2 \u0394) or (Sub \u0393 \u0394) etc. Also, if you take the standard set-semantics, \u27e6 Sub \u0393 \u0394 \u27e7 is \u27e6 \u0393 \u27e7 \u2192 \u27e6 \u0394 \u27e7, and I don&#39;t know of any semantics when the (generalized) arrow goes in the other direction. With polymorphic and dependent TT, the arrow generally <i>can&#39;t</i> go in the other direction because of A possibly depending on \u0393 in \u0393 \u22a2 t : A."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 6, "last_activity_date": 1534080228, "last_edit_date": 1534080228, "creation_date": 1529186512, "answer_id": 50892129, "question_id": 50889455, "link": "https://stackoverflow.com/questions/50889455/a-category-of-type-changing-substitutions/50892129#50892129", "title": "A category of type-changing substitutions", "body": "<blockquote>\n  <p>There is an obvious category for this type: the Kleisli category given\n  by the Monad instance on Term node. I am not sure if this actually\n  corresponds to the usual notion of substitution composition, however.</p>\n</blockquote>\n\n<p>It does correspond to that, and it's an all-around correct definition of parallel substitution for well-scoped terms. You may note that this substitution is <em>total</em>; this is a requirement if you want term substitution to be total, i. e. that it's a functor from the category of substitutions (<strong>Subst</strong>) to <strong>Set</strong>. For a simple example for why partial substitutions don't work, if you have an empty <code>SubstCat node () Void</code>, then you would have to invent arbitrary closed terms when hitting <code>VarTerm ()</code> in <code>subst</code> - and closed terms don't even exist if you choose <code>Void</code> for <code>node</code>. </p>\n\n<p>Hence, if you have <code>Map dom (Term node cod)</code> then you have partial term substitution, i. e. a functor from <strong>Subst</strong> to the Kleisli category for <code>Maybe</code> (disregarding for now formal complications from the <code>Ord</code> constraints):</p>\n\n<pre><code>type Subst node i j = Map i (Term node j)\n\nsubst :: Ord i =&gt; Subst node i j -&gt; Term node i -&gt; Maybe (Term node j)\nsubst sub (VarTerm x)    = Map.lookup x sub\nsubst sub (FunTerm f ts) = FunTerm f &lt;$&gt; traverse (subst sub) ts\n</code></pre>\n\n<hr>\n\n<p>Now, total term substitution along with your 1-5 desiderata for <code>SubstCat</code> is possible, but not with the current kinds for <code>SubstCat</code> and <code>Term</code>. As I mentioned, in this case substitutions must be total, but currently we can just have <code>SubstCat node dom cod</code> with some infinite <code>dom</code>, which makes equality of substitutions undecidable.</p>\n\n<p>So let's switch to a more precise formalization, which contains only what we care about here. We have well-scoped untyped terms, and we assume that terms are finite and live in finite variable contexts. </p>\n\n<p>Untyped terms imply that only sizes of variable contexts matter. So, <strong>Subst</strong> has natural numbers as objects:</p>\n\n<pre><code>data Nat = Z | S Nat deriving (Eq, Show)\n</code></pre>\n\n<p>Terms are indexed by <code>n :: Nat</code>, containing <code>n</code> possible values for variables:</p>\n\n<pre><code>-- {-# language TypeInType, GADTs, TypeFamilies, ScopedTypeVariables,\n--           FlexibleInstances, MultiParamTypeClasses, RankNTypes,\n--           TypeApplications, StandaloneDeriving #-}\n\ndata Fin n where\n  FZ :: Fin (S n)\n  FS :: Fin n -&gt; Fin (S n)\nderiving instance Eq (Fin n)\nderiving instance Ord (Fin n)\nderiving instance Show (Fin n)\n\ndata Term node (n :: Nat) where\n  VarTerm :: !(Fin n) -&gt; Term node n\n  FunTerm :: !node -&gt; !(Vector (Term node n)) -&gt; Term node n\n\nderiving instance Eq node =&gt; Eq (Term node n)\nderiving instance Ord node =&gt; Ord (Term node n)\nderiving instance Show node =&gt; Show (Term node n)\n</code></pre>\n\n<p>Substitutions (morphisms) are vectors of terms:</p>\n\n<pre><code>data Vec a n where\n  Nil  :: Vec a Z\n  (:&gt;) :: a -&gt; Vec a n -&gt; Vec a (S n)\ninfixr 5 :&gt;\n\nderiving instance Eq a =&gt; Eq (Vec a n)\nderiving instance Ord a =&gt; Ord (Vec a n)\nderiving instance Show a =&gt; Show (Vec a n)\n\ntype Subst node i j = Vec (Term node j) i\n</code></pre>\n\n<p>Term substitution is as follows:</p>\n\n<pre><code>subst :: Subst node i j -&gt; Term node i -&gt; Term node j\nsubst (t :&gt; _ ) (VarTerm FZ)     = t\nsubst (_ :&gt; ts) (VarTerm (FS x)) = subst ts (VarTerm x)\nsubst sub       (FunTerm f ts)   = FunTerm f (Vector.map (subst sub) ts)\n</code></pre>\n\n<p>Composition is just pointwise <code>subst</code>:</p>\n\n<pre><code>comp :: Subst node i j -&gt; Subst node j k -&gt; Subst node i k\ncomp Nil       sub2 = Nil\ncomp (t :&gt; ts) sub2 = subst sub2 t :&gt; comp ts sub2\n</code></pre>\n\n<p>Identity substitution is not so easy. We need to dispatch on a type-level <code>Nat</code>. For this, we use here a type class; <a href=\"http://hackage.haskell.org/package/singletons\" rel=\"nofollow noreferrer\"><code>singletons</code></a> would be a heavier but more principled solution. The implementation itself is also a bit mind-bending. It makes use of the fact that <code>Subst node n m</code> is isomorphic to <code>(Fin n -&gt; Term node m)</code>. In fact, we could just use the functional representation all the time, but then the <code>Eq, Ord and Show</code> instances would still effectively need the backwards conversion, and we would not have the spacetime boundedness guarantees of (strict) vectors.</p>\n\n<pre><code>class Tabulate n where\n  tabulate :: (Fin n -&gt; Term node m) -&gt; Subst node n m\n\ninstance Tabulate Z where\n  tabulate f = Nil\n\ninstance Tabulate n =&gt; Tabulate (S n) where\n  tabulate f = f FZ :&gt; tabulate (f . FS)\n\nidSubst :: Tabulate n =&gt; Subst node n n\nidSubst = tabulate VarTerm\n</code></pre>\n\n<p>That's it! Proofs of category laws for <code>Subst</code> and functor laws for <code>subst</code> are left as exercise.</p>\n\n<hr>\n\n<p>PS: I note that in literature and formal Agda/Coq developments, <code>Nat</code> indices of <code>Subst</code> are usually in swapped order, and <code>subst</code> has <em>contravariant</em> action.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1529188967, "creation_date": 1529188967, "answer_id": 50892329, "question_id": 50889455, "link": "https://stackoverflow.com/questions/50889455/a-category-of-type-changing-substitutions/50892329#50892329", "title": "A category of type-changing substitutions", "body": "<pre><code>{-# LANGUAGE TypeFamilies, TypeOperators #-}\n\nimport <a href=\"http://hackage.haskell.org/package/MemoTrie-0.6.9/docs/Data-MemoTrie.html\" rel=\"noreferrer\">Data.MemoTrie</a>\nimport <a href=\"http://hackage.haskell.org/package/constrained-categories-0.3.1.0/docs/Control-Category-Constrained.html\" rel=\"noreferrer\">Control.Category.Constrained</a>\n\nnewtype SubstCat node dom cod = SubstCat (dom :->: Term node cod)\n\ninstance Category (SubstCat node) where\n  type Object (SubstCat node) a = HasTrie a\n  id = SubstCat (trie VarTerm)\n  SubstCat f . SubstCat g = SubstCat $ fmap (untrie f =&lt;&lt;) g\n</code></pre>\n\n<p>The <a href=\"http://hackage.haskell.org/package/MemoTrie-0.6.9/docs/Data-MemoTrie.html#t::-45--62-:\" rel=\"noreferrer\">memo-trie type <code>:-&gt;:</code></a> is basically a map type, but the mappings are always total. I.e., they are proper functions, but in a memory-fixed representation \u2013 no closures needed. This only works for types that are not only orderable but also completely enumeratable, which is what the <a href=\"http://hackage.haskell.org/package/MemoTrie-0.6.9/docs/Data-MemoTrie.html#t:HasTrie\" rel=\"noreferrer\"><code>HasTrie</code> class</a> expresses; thus we can't define an instance for <code>Control.Category.Category</code> but we can define an instance for <a href=\"http://hackage.haskell.org/package/constrained-categories-0.3.1.0/docs/Control-Category-Constrained.html#t:Category\" rel=\"noreferrer\">its constrainable pendant</a>.</p>\n"}], "owner": {"reputation": 513, "user_id": 1125434, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/82b90125633760405d3f95b1a2ab95a0?s=128&d=identicon&r=PG", "display_name": "taktoa", "link": "https://stackoverflow.com/users/1125434/taktoa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 780, "favorite_count": 6, "accepted_answer_id": 50892129, "answer_count": 2, "score": 18, "last_activity_date": 1534080228, "creation_date": 1529164601, "question_id": 50889455, "link": "https://stackoverflow.com/questions/50889455/a-category-of-type-changing-substitutions", "title": "A category of type-changing substitutions", "body": "\n\n<h1>The setup</h1>\n\n<p>Consider a type of terms parameterized over a type of function symbols <code>node</code>\nand a type of variables <code>var</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Term node var\n  = VarTerm !var\n  | FunTerm !node !(Vector (Term node var))\n  deriving (Eq, Ord, Show)\n\ninstance Functor (Term node) where\n  fmap f (VarTerm var)  = VarTerm (f var)\n  fmap f (FunTerm n cs) = FunTerm n (Vector.map (fmap f) cs)\n\ninstance Monad (Term node) where\n  pure = VarTerm\n  join (VarTerm term) = term\n  join (FunTerm n cs) = FunTerm n (Vector.map join cs)\n</code></pre>\n\n<p>This is a useful type, since we encode open terms with <code>Term node Var</code>,\nclosed terms with <code>Term node Void</code>, and contexts with <code>Term node ()</code>.</p>\n\n<p>The goal is to define a type of substitutions on <code>Term</code>s in the most pleasant\npossible way. Here's a first stab:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype Substitution (node \u2237 Type) (var \u2237 Type)\n  = Substitution { fromSubstitution \u2237 Map var (Term node var) }\n  deriving (Eq, Ord, Show)\n</code></pre>\n\n<p>Now let's define some auxiliary values related to <code>Substitution</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>subst \u2237 Substitution node var \u2192 Term node var \u2192 Term node var\nsubst s (VarTerm var)  = fromMaybe (MkVarTerm var)\n                         (Map.lookup var (fromSubstitution s))\nsubst s (FunTerm n ts) = FunTerm n (Vector.map (subst s) ts)\n\nidentity \u2237 Substitution node var\nidentity = Substitution Map.empty\n\n-- Laws:\n--\n-- 1. Unitality:\n--    \u2200 s \u2237 Substitution n v \u2192 s \u2261 (s \u2218 identity) \u2261 (identity \u2218 s)\n-- 2. Associativity:\n--    \u2200 a, b, c \u2237 Substitution n v \u2192 ((a \u2218 b) \u2218 c) \u2261 (a \u2218 (b \u2218 c))\n-- 3. Monoid action:\n--    \u2200 x, y \u2237 Substitution n v \u2192 subst (y \u2218 x) \u2261 (subst y . subst x)\n(\u2218) \u2237 (Ord var)\n    \u21d2 Substitution node var\n    \u2192 Substitution node var\n    \u2192 Substitution node var\ns1 \u2218 s2 = Substitution\n          (Map.unionWith\n           (\u03bb _ _ \u2192 error \"this should never happen\")\n           (Map.map (subst s1) (fromSubstitution s2))\n           ((fromSubstitution s1) `Map.difference` (fromSubstitution s2)))\n</code></pre>\n\n<p>Clearly, <code>(Substitution n v, \u2218, identity)</code> is a monoid (ignoring the <code>Ord</code>\nconstraint on <code>\u2218</code>) and <code>(Term n v, subst)</code> is a monoid action of\n<code>Substitution n v</code>.</p>\n\n<p>Now suppose that we want to make this scheme encode substitutions\n<em>that change the variable type</em>. This would look like some type <code>SubstCat</code>\nthat satisfies the module signature below:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data SubstCat (node \u2237 Type) (domainVar \u2237 Type) (codomainVar \u2237 Type)\n  = \u2026 \u2237 Type\n\nsubst \u2237 SubstCat node dom cod \u2192 Term node dom \u2192 Term node cod\n\nidentity \u2237 SubstCat node var var\n\n(\u2218) \u2237 (Ord v1, Ord v2, Ord v3)\n    \u2192 SubstCat node v2 v3\n    \u2192 SubstCat node v1 v2\n    \u2192 SubstCat node v1 v3\n</code></pre>\n\n<p>This is almost a Haskell <code>Category</code>, but for the <code>Ord</code> constraints on <code>\u2218</code>.\nYou might think that if <code>(Substitution n v, \u2218, identity)</code> was a monoid before,\nand <code>subst</code> was a monoid action before, then <code>subst</code> should now be a category\naction, but in point of fact category actions are just functors (in this case,\na functor from a subcategory of Hask to another subcategory of Hask).</p>\n\n<p>Now there are some properties we'd hope would be true about <code>SubstCat</code>:</p>\n\n<ol>\n<li><code>SubstCat node var Void</code> should be the type of ground substitutions.</li>\n<li><code>SubstCat Void var var</code> should be the type of flat substitutions.</li>\n<li><code>instance (Eq node, Eq dom, Eq cod) \u21d2 Eq (SubstCat node dom cod)</code>\nshould exist (as well as similar instances for <code>Ord</code> and <code>Show</code>).</li>\n<li>It should be possible to compute the domain variable set, the image term\nset, and the introduced variable set, given a <code>SubstCat node dom cod</code>.</li>\n<li>The operations I have described should be about as fast/space-efficient\nas their equivalents in the <code>Substitution</code> implementation above.</li>\n</ol>\n\n<p>The simplest possible approach to writing <code>SubstCat</code> would be to simply\ngeneralize <code>Substitution</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype SubstCat (node \u2237 Type) (dom \u2237 Type) (cod \u2237 Type)\n  = SubstCat { fromSubstCat \u2237 Map dom (Term node cod) }\n  deriving (Eq, Ord, Show)\n</code></pre>\n\n<p>Unfortunately, this does not work because when we run <code>subst</code> it may be the\ncase that the term we are running substitution on contains variables that are\nnot in the domain of the <code>Map</code>. We could get away with this in <code>Substitution</code>\nsince <code>dom ~ cod</code>, but in <code>SubstCat</code> we have no way to deal with these\nvariables.</p>\n\n<p>My next attempt was to deal with this issue by also including a function of\ntype <code>dom \u2192 cod</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data SubstCat (node \u2237 Type) (dom \u2237 Type) (cod \u2237 Type)\n  = SubstCat\n    !(Map dom (Term node cod))\n    !(dom \u2192 cod)\n</code></pre>\n\n<p>This causes a few problems, however. Firstly, since <code>SubstCat</code> now contains a\nfunction, it can no longer have <code>Eq</code>, <code>Ord</code>, or <code>Show</code> instances. We cannot\nsimply ignore the <code>dom \u2192 cod</code> field when comparing for equality, since the\nsemantics of substitution change depending on its value. Secondly, it is now\nno longer the case that <code>SubstCat node var Void</code> represents a type of ground\nsubstitutions; in fact, <code>SubstCat node var Void</code> is <em>uninhabited</em>!</p>\n\n<p>\u00c9rdi Gerg\u0151 suggested on Facebook that I use the following definition:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype SubstCat (node \u2237 Type) (dom \u2237 Type) (cod \u2237 Type)\n  = SubstCat (dom \u2192 Term node cod)\n</code></pre>\n\n<p>This is certainly a fascinating prospect. There is an obvious category for this\ntype: the Kleisli category given by the <code>Monad</code> instance on <code>Term node</code>. I am\nnot sure if this actually corresponds to the usual notion of substitution\ncomposition, however. Unfortunately, this representation cannot have instances\nfor <code>Eq</code> et al. and I suspect it could be very inefficient in practice, since\nin the best case it will end up being a tower of closures of height <code>\u0398(n)</code>,\nwhere <code>n</code> is the number of insertions. It also doesn't allow computation of the\ndomain variable set.</p>\n\n<h1>The question</h1>\n\n<p>Is there a sensible type for <code>SubstCat</code> that fits my requirements? Can you prove\nthat one does not exist? If I give up having correct instances of <code>Eq</code>, <code>Ord</code>,\nand <code>Show</code>, is it possible?</p>\n"}, {"tags": ["haskell", "haskell-stack", "template-haskell"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1529160131, "post_id": 50888853, "comment_id": 88778990, "body": "You cannot specify <code>template-haskell</code> in extra-deps. It comes shipped with GHC (along with packages like base etc)"}, {"owner": {"reputation": 858, "user_id": 4267929, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/98885eca3b83031612bef15ed5b21abc?s=128&d=identicon&r=PG&f=1", "display_name": "Henricus V.", "link": "https://stackoverflow.com/users/4267929/henricus-v"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1529160218, "post_id": 50888853, "comment_id": 88779013, "body": "@Sibi Then how can I tell stack to use the corresponding ghc version?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1529160506, "post_id": 50888853, "comment_id": 88779078, "body": "Your resolver controls the ghc version.  You can get the proper one from the home page: <a href=\"https://www.stackage.org/\" rel=\"nofollow noreferrer\">stackage.org</a>"}], "answers": [{"tags": [], "owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "is_accepted": true, "score": 4, "last_activity_date": 1529160903, "creation_date": 1529160903, "answer_id": 50888981, "question_id": 50888853, "link": "https://stackoverflow.com/questions/50888853/stack-is-unable-to-resolve-the-correct-package-version/50888981#50888981", "title": "Stack is unable to resolve the correct package version", "body": "<p>That looks like a lot of extra-deps. I'd recommend figuring out a good resolver first. The best way to do that is use the original repo:</p>\n\n<pre><code>git clone git@github.com:HuwCampbell/grenade.git\ncd grenade\nstack init\n</code></pre>\n\n<p>Which gives you the following output:</p>\n\n<pre><code>Looking for .cabal or package.yaml files to use to init the project.\nUsing cabal packages:\n- ./\n- examples/\n\nSelecting the best among 13 snapshots...\n\n* Partially matches lts-11.13\n    criterion version 1.3.0.0 found\n        - grenade requires ==1.1.*\n\nDownloaded nightly-2018-06-16 build plan.    \n* Partially matches nightly-2018-06-16\n    criterion version 1.4.1.0 found\n        - grenade requires ==1.1.*\n    hmatrix version 0.19.0.0 found\n        - grenade requires ==0.18.*\n        - grenade-examples requires ==0.18.*\n    singletons version 2.4.1 found\n        - grenade requires &gt;=2.1 &amp;&amp; &lt;2.4\n\n* Partially matches lts-10.10\n    criterion version 1.2.6.0 found\n        - grenade requires ==1.1.*\n\nDownloaded lts-9.21 build plan.    \n* Matches lts-9.21\n\nSelected resolver: lts-9.21\nInitialising configuration using resolver: lts-9.21\nTotal number of user packages considered: 2\nWriting configuration to file: stack.yaml\nAll done.\n</code></pre>\n\n<p>So use the base resolver <code>lts-9.21</code>. And I'd open an issue on the repo of <code>grenade</code> to add it to stack.</p>\n"}], "owner": {"reputation": 858, "user_id": 4267929, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/98885eca3b83031612bef15ed5b21abc?s=128&d=identicon&r=PG&f=1", "display_name": "Henricus V.", "link": "https://stackoverflow.com/users/4267929/henricus-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 0, "accepted_answer_id": 50888981, "answer_count": 1, "score": 1, "last_activity_date": 1529160903, "creation_date": 1529159920, "last_edit_date": 1529160145, "question_id": 50888853, "link": "https://stackoverflow.com/questions/50888853/stack-is-unable-to-resolve-the-correct-package-version", "title": "Stack is unable to resolve the correct package version", "body": "<p>I am trying to use <code>grenade</code> in Haskell. Using <code>stack</code> as a configuration tool, I have</p>\n\n<pre><code># stack.yaml\n\nextra-deps:\n- diagrams-solve-0.1.1\n- dual-tree-0.2.2\n- SVGFonts-1.6.0.3\n- diagrams-core-1.4.1\n- diagrams-lib-1.4.2.2\n- diagrams-postscript-1.4.1\n- diagrams-svg-1.4.2\n- Chart-diagrams-1.8.3\n- hip-1.5.3.0\n- singletons-2.2\n- template-haskell-2.11.1.0\n- th-desugar-1.6\n- grenade-0.1.0\n</code></pre>\n\n<p>But when I execute <code>stack build</code>, it gives me the following error</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for th-desugar-1.6:\n    template-haskell-2.12.0.0 from stack configuration does not match &lt;2.12  (latest\n                              matching version is 2.11.1.0)\nneeded due to Brain-0.1.0.0 -&gt; th-desugar-1.6\n\nSome different approaches to resolving this:\n\n  * Set 'allow-newer: true' to ignore all version constraints and build anyway.\n\n  * Consider trying 'stack solver', which uses the cabal-install solver to attempt to\n    find some working build configuration. This can be convenient when dealing with\n    many complicated constraint errors, but results may be unpredictable.\n\n  * Recommended action: try adding the following to your extra-deps\n    in [Project directory]/stack.yaml:\n\n- template-haskell-2.11.1.0\n\nPlan construction failed.\n</code></pre>\n\n<p>Even if I put <code>- template-haskell-2.11.1.0</code> before <code>diagrams-solve</code>, stack still gives me the same error. Allowing newer versions is not viable since it breaks <code>th-desugar</code>.</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1529207196, "post_id": 50887091, "comment_id": 88787299, "body": "Related: <a href=\"https://stackoverflow.com/q/23092468/2751851\"><i>Lenses: Composing backwards and (.) in Lens context</i></a>"}], "answers": [{"tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": true, "score": 4, "last_activity_date": 1529224871, "last_edit_date": 1529224871, "creation_date": 1529146364, "answer_id": 50887255, "question_id": 50887091, "link": "https://stackoverflow.com/questions/50887091/how-can-the-type-of-a-composite-traversal-be-worked-out/50887255#50887255", "title": "How can the type of a composite Traversal be worked out?", "body": "<p>We have the following types for the functions:</p>\n\n<pre><code>traverse :: (Applicative f, Traversable t) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\nposts :: Functor f =&gt; ([Post] -&gt; f [Post]) -&gt; User -&gt; f User\n</code></pre>\n\n<p>Let's line up the types for <code>traverse</code> and <code>posts</code> (in that order) so we can see what's going on (I'll omit the type-class constraints for this), and let's add the implied parentheses around the results of the functions (<code>a -&gt; b -&gt; c</code> is a shortcut for <code>a -&gt; (b -&gt; c)</code>)  </p>\n\n<pre><code>                        (a    -&gt;   f b   ) -&gt; (t a -&gt; f (t b))\n([Post] -&gt; f [Post]) -&gt; (User -&gt;   f User)\n</code></pre>\n\n<p>From this we can see that <code>a ~ User</code>, <code>b ~ User</code> (<code>~</code> here means 'is identified with', or 'is equal to'), so let's specialize traverse and write down the types of the functions again:</p>\n\n<pre><code>                        (User -&gt;   f User) -&gt; (t User -&gt; f (t User))\n([Post] -&gt; f [Post]) -&gt; (User -&gt;   f User)\n</code></pre>\n\n<p>From this we can see that the composition will have the type (omitting the constraints for now, again)</p>\n\n<pre><code>([Post] -&gt; f [Post]) -&gt;                       (t User -&gt; f (t User))\n</code></pre>\n\n<p>Or without the optional parentheses</p>\n\n<pre><code>([Post] -&gt; f [Post]) -&gt; t User -&gt; f (t User)\n</code></pre>\n\n<p>Now what about the constraints? Well the use of <code>posts</code> gives us the <code>Functor f</code> constraint, and <code>traverse</code> gives us <code>Applicative f</code> and <code>Traversable t</code>, but because <code>Applicative</code> is a sub-class of <code>Functor</code> (it's defined as <code>class Functor f =&gt; Applicative f where -- ...</code>), we don't have to specify the <code>Functor f</code> constraint, it's already there.  </p>\n\n<p>So we are left with:  </p>\n\n<pre><code>traverse . posts :: (Applicative f, Traversable t) =&gt; \n                    ([Post] -&gt; f [Post]) -&gt; t User -&gt; f (t User)\n</code></pre>\n"}], "owner": {"reputation": 611, "user_id": 5180015, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4ecae9f07f674674799b10a14a1f186e?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/5180015/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 50887255, "answer_count": 1, "score": 2, "last_activity_date": 1529224871, "creation_date": 1529144961, "last_edit_date": 1529207753, "question_id": 50887091, "link": "https://stackoverflow.com/questions/50887091/how-can-the-type-of-a-composite-traversal-be-worked-out", "title": "How can the type of a composite Traversal be worked out?", "body": "<p>I'm following <a href=\"https://blog.jakuba.net/2014/08/06/lens-tutorial-stab-traversal-part-2.html\" rel=\"nofollow noreferrer\">a blog post on lens' traversals</a>. In it, there is a composition of</p>\n\n<pre><code>traverse.posts\n</code></pre>\n\n<p>and it ends up with type</p>\n\n<pre><code>(Traversable t, Applicative f) =&gt; \n   ([Post] -&gt; f [Post]) -&gt; t User -&gt; f (t User)\n</code></pre>\n\n<p>I understand that it is function composition., but I'm a bit confused on how it ends up with that type.</p>\n\n<p>Can anyone help me to walk through this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 4, "creation_date": 1529145310, "post_id": 50887054, "comment_id": 88775613, "body": "So ... you&#39;re done? As far as I can see your code is working. What&#39;s your question?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1529145840, "post_id": 50887054, "comment_id": 88775735, "body": "It looks fine. Perhaps, not as efficient as it could be, since I think using <code>Data.Map</code> could speed it up. But, without library support, this looks good."}], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1529156669, "post_id": 50887272, "comment_id": 88778183, "body": "You could be even more efficient by replacing <code>length ... &gt;= ... </code> by <code>not null . drop (min-1)</code>. That way you don&#39;t have to count ALL the elements of a group."}], "tags": [], "owner": {"reputation": 356, "user_id": 536342, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f354d52ac79638d5bc6b967981ef9945?s=128&d=identicon&r=PG", "display_name": "pikapika", "link": "https://stackoverflow.com/users/536342/pikapika"}, "is_accepted": true, "score": 0, "last_activity_date": 1529146475, "creation_date": 1529146475, "answer_id": 50887272, "question_id": 50887054, "link": "https://stackoverflow.com/questions/50887054/atleast-occurrences-in-list/50887272#50887272", "title": "AtLeast occurrences in list", "body": "<p>A more efficient way to write this which gives the result you specified is:</p>\n\n<pre><code>atLeast :: [Int] -&gt; Int -&gt; [Int]\natLeast list min = map head $ filter (\\list -&gt; length list &gt;= min) $ groupBy (==) $ sortBy (flip compare) list\n</code></pre>\n\n<p>eg.</p>\n\n<pre><code>&gt; atLeast [4,5,2,5,4,3,1,3,4] 2                                                                                                                                                                   \n[5,4,3]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 0, "last_activity_date": 1529343876, "creation_date": 1529343876, "answer_id": 50914881, "question_id": 50887054, "link": "https://stackoverflow.com/questions/50887054/atleast-occurrences-in-list/50914881#50914881", "title": "AtLeast occurrences in list", "body": "<h1>Composing standard functions</h1>\n\n<p>As <em>pikapika</em> points out in another answer, it's possible to achieve the desired result by composing functions from the base library.</p>\n\n<p>At first glance, a function like <code>group</code> from <code>Data.List</code> looks promising, but the problem is that it only groups consecutive runs:</p>\n\n<pre><code>Prelude Data.List&gt; group [4,5,2,5,4,3,1,3,4]\n[[4],[5],[2],[5],[4],[3],[1],[3],[4]]\nPrelude Data.List&gt; group [4,4,2,5,5,3,1,3,4]\n[[4,4],[2],[5,5],[3],[1],[3],[4]]\n</code></pre>\n\n<p>In order to get the desired behaviour, then, you first have to sort the input:</p>\n\n<pre><code>Prelude Data.List&gt; sort [4,5,2,5,4,3,1,3,4]\n[1,2,3,3,4,4,4,5,5]\n</code></pre>\n\n<p>That's better: now you can group it:</p>\n\n<pre><code>Prelude Data.List&gt; group $ sort [4,5,2,5,4,3,1,3,4]\n[[1],[2],[3,3],[4,4,4],[5,5]]\n</code></pre>\n\n<p>Note, however, that this entails two passes over the the data. The first pass over the list is when you <code>sort</code> it. The second pass is when you <code>group</code> the output of the first pass.</p>\n\n<p>Unfortunately, you aren't done yet. Now you need to filter that list of lists:</p>\n\n<pre><code>Prelude Data.List&gt; filter (\\xs -&gt; 2 &lt;= length xs) $ group $ sort [4,5,2,5,4,3,1,3,4]\n[[3,3],[4,4,4],[5,5]]\n</code></pre>\n\n<p>or, if you like point-free style better, you can <em>eta reduce</em> it:</p>\n\n<pre><code>Prelude Data.List&gt; filter ((2 &lt;=) . length) $ group $ sort [4,5,2,5,4,3,1,3,4]\n[[3,3],[4,4,4],[5,5]]\n</code></pre>\n\n<p>Finally, you need to extract the common value of each nested list. In general, while <code>head</code> is unsafe, we should feel confident that none of the lists are empty:</p>\n\n<pre><code>Prelude Data.List&gt; map head $ filter ((2 &lt;=) . length) $ group $ sort [4,5,2,5,4,3,1,3,4]\n[3,4,5]\n</code></pre>\n\n<p>One detail about this implementation is that values arrive in ascending order.</p>\n\n<p>This sort of implementation is probably good enough for most purposes, but it <em>could</em> be considered inefficient, with at least three list traversals. For lengthy lists, this could be a problem.</p>\n\n<p>To be clear, as always when the discussion is about performance: <em>measure!</em></p>\n\n<h1>Counting as a fold</h1>\n\n<p>For short lists, the following is hardly more efficient, but for long lists with few possible values, using fewer passes could be better. So let's see if we can do that.</p>\n\n<p>The strategy I'll use is to accumulate a list of tuples, where each tuple will contain the value, and the number of times it has been observed. For the OP input values <code>[4,5,2,5,4,3,1,3,4]</code>, we'll need something like this as an intermediary result:</p>\n\n<pre><code>[(4,3),(5,2),(2,1),(3,2),(1,1)]\n</code></pre>\n\n<p>First, we're going to need a function that adds a number to an accumulator like that. When accumulation starts, the list will be empty, but later, a number may already exist in the accumulator. One way to look up a number is to use the <code>partition</code> function:</p>\n\n<pre><code>*Q50887054&gt; partition ((5 ==) . fst) [(5,2),(2,1),(4,1)]\n([(5,2)],[(2,1),(4,1)])\n</code></pre>\n\n<p>Here you have a partially accumulated list of numbers, indicating that you've encountered <code>5</code> twice, and <code>2</code> and <code>4</code> once. Now you want to add another <code>5</code>, so you partition the list on the <code>fst</code> element of the tuple being equal to five. The result is a tuple where the first element is all the matches (or <em>hits</em>) and the second element is a list of those values that don't match.</p>\n\n<p>Using <code>import Data.Bifunctor</code>, you can map over the <code>first</code> element of that tuple. Inside that map, you have a list of tuples. In practice, this list will either be empty, or have exactly one element, but it's easy enough to deal with the general case where there's an arbitrary number of tuples: extract the <code>snd</code> element of all the <code>hits</code> and <code>sum</code> over the numbers, then add <code>1</code> for the new value you just found. Create a tuple of that new count, with the number to add as the key:</p>\n\n<pre><code>*Q50887054&gt; first (\\hits -&gt; (5, (sum $ snd &lt;$&gt; hits) + 1)) $ partition ((5 ==) . fst) [(5,2),(2,1),(4,1)]\n((5,3),[(2,1),(4,1)])\n</code></pre>\n\n<p>This returns a tuple where the first element is a value, and the second element is a list. You can uncurry the cons operator to make a single list out of that tuple:</p>\n\n<pre><code>import Data.List\nimport Data.Bifunctor\n\ntally :: (Num t, Eq a) =&gt; a -&gt; [(a, t)] -&gt; [(a, t)]\ntally k = uncurry (:) . first (\\hits -&gt; (k, sum (snd &lt;$&gt; hits) + 1)) . partition ((k ==) . fst)\n</code></pre>\n\n<p>Here's how you'd begin to <code>tally</code> the list <code>[4,5,2,5,4,3,1,3,4]</code>. You start with an empty accumulator and the first value in the list, <code>4</code>:</p>\n\n<pre><code>*Q50887054&gt; tally 4 []\n[(4,1)]\n</code></pre>\n\n<p>The accumulator is now <code>[(4,1)]</code>, indicating that you've seen <code>4</code> once. Moving on to the next element in the input list, <code>5</code>, you now <code>tally</code> that with the accumulator:</p>\n\n<pre><code>*Q50887054&gt; tally 5 [(4,1)]\n[(5,1),(4,1)]\n</code></pre>\n\n<p>You now continue using the new accumulator with other values of the list:</p>\n\n<pre><code>*Q50887054&gt; tally 2 [(5,1),(4,1)]\n[(2,1),(5,1),(4,1)]\n*Q50887054&gt; tally 5 [(2,1),(5,1),(4,1)]\n[(5,2),(2,1),(4,1)]\n</code></pre>\n\n<p>Notice that at this point, we've seen <code>5</code> twice.</p>\n\n<p>Instead of going through this manually, we can use <code>tally</code> with <code>foldl'</code>:</p>\n\n<pre><code>*Q50887054&gt; foldl' (\\acc x -&gt; tally x acc) [] [4,5,2,5,4,3,1,3,4]\n[(4,3),(3,2),(1,1),(5,2),(2,1)]\n</code></pre>\n\n<p>We're not quite done yet, but now we have a list that we can easily <code>filter</code> and <code>map</code>:</p>\n\n<pre><code>*Q50887054&gt; map fst $ filter ((2 &lt;=) . snd) $ foldl' (\\acc x -&gt; tally x acc) [] [4,5,2,5,4,3,1,3,4]\n[4,3,5]\n</code></pre>\n\n<p>Polishing up the code a bit, you can make that a function as well:</p>\n\n<pre><code>atLeast :: (Ord a, Num a, Eq b, Foldable t) =&gt; a -&gt; t b -&gt; [b]\natLeast n = map fst . filter ((n &lt;=) . snd) . foldl' (flip tally) []\n</code></pre>\n\n<p>Here's some examples:</p>\n\n<pre><code>*Q50887054&gt; atLeast 1 [4,5,2,5,4,3,1,3,4]\n[4,3,1,5,2]\n*Q50887054&gt; atLeast 2 [4,5,2,5,4,3,1,3,4]\n[4,3,5]\n*Q50887054&gt; atLeast 3 [4,5,2,5,4,3,1,3,4]\n[4]\n*Q50887054&gt; atLeast 4 [4,5,2,5,4,3,1,3,4]\n[]\n</code></pre>\n\n<p>Compared to the above solution made from composing standard functions, this implementations only passes over the input list twice: once to fold it, and once to map and filter it.</p>\n\n<p>On the other hand, the <code>tally</code> function passes over the accumulator multiple times, so which approach will be faster will most likely depend on the size and range of the input.</p>\n\n<p>I must admit that I've measured neither option...</p>\n"}], "owner": {"reputation": 23, "user_id": 7350634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca3689698124253954d2a6149803a582?s=128&d=identicon&r=PG&f=1", "display_name": "Elllla", "link": "https://stackoverflow.com/users/7350634/elllla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 748, "favorite_count": 0, "accepted_answer_id": 50887272, "answer_count": 2, "score": 0, "last_activity_date": 1529343876, "creation_date": 1529144555, "last_edit_date": 1529145164, "question_id": 50887054, "link": "https://stackoverflow.com/questions/50887054/atleast-occurrences-in-list", "title": "AtLeast occurrences in list", "body": "<p>I want to write a function that returns the list of elements that appeared at least n times in a list. It should work like this:</p>\n\n<pre><code>ghci&gt; atLeast [4,5,2,5,4,3,1,3,4] 2\n</code></pre>\n\n<p>output: <code>[5,3,4]</code></p>\n\n<p>My code:</p>\n\n<pre><code>count:: Eq a =&gt; a -&gt; [a] -&gt; Int\ncount n [] = 0\ncount n (h:t) | n == h = 1 + count n t\n              | otherwise = count n t\n\natLeast :: [Int] -&gt; Int -&gt; [Int]\natLeast list min = nub $ filter (\\b-&gt; count b list &gt;= min) list\n</code></pre>\n"}, {"tags": ["haskell", "types", "module", "io", "c-strings"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1529164630, "post_id": 50883977, "comment_id": 88780102, "body": "<code>merge (x:xs) ys = x : merge ys xs</code> is better."}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 4883798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09bb07175c327addfb5d0520f0d0cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Jakob Br&#248;gger", "link": "https://stackoverflow.com/users/4883798/jakob-br%c3%b8gger"}, "edited": false, "score": 0, "creation_date": 1529110129, "post_id": 50884078, "comment_id": 88770216, "body": "Ahh. I see. So IO is added again on the return. Must admit I  kinda thought that IO could only be added once - either it was in the IO domain or not. Must have misunderstood."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 15, "user_id": 4883798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09bb07175c327addfb5d0520f0d0cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Jakob Br&#248;gger", "link": "https://stackoverflow.com/users/4883798/jakob-br%c3%b8gger"}, "edited": false, "score": 3, "creation_date": 1529117250, "post_id": 50884078, "comment_id": 88771052, "body": "@JakobBr&#248;gger, in this way <code>IO</code> is just like any other type constructor.  Just like you can have a list of list of string, you can have an <code>IO</code> of <code>IO</code> string."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 5, "last_activity_date": 1529116933, "last_edit_date": 1529116933, "creation_date": 1529108822, "answer_id": 50884078, "question_id": 50883977, "link": "https://stackoverflow.com/questions/50883977/haskell-beginner-how-did-i-get-to-io-io-string/50884078#50884078", "title": "Haskell beginner how did I get to IO ( IO String )", "body": "<pre><code>                newCString :: String -&gt; IO String\n                    result :: String\n         newCString result ::           IO String\n                    return ::                   a -&gt; IO a\nreturn $ newCString result ::                        IO (IO String)\n</code></pre>\n\n<p>Simply stop when you already have the thing you want, <code>newCString result</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1529145701, "last_edit_date": 1529145701, "creation_date": 1529145283, "answer_id": 50887135, "question_id": 50883977, "link": "https://stackoverflow.com/questions/50883977/haskell-beginner-how-did-i-get-to-io-io-string/50887135#50887135", "title": "Haskell beginner how did I get to IO ( IO String )", "body": "<p>When you work inside the <code>IO</code> monad, in a function of type <code>foo :: .. -&gt; .. -&gt; IO T</code>\nthe last entry in a <code>do</code> block must have type <code>IO T</code>.</p>\n\n<p><code>return</code> exists so that, if you only have <code>T</code>, you can wrap it inside <code>IO</code>. Essentially, an expression of type <code>T</code> evaluates to a value of type <code>T</code> without any side effects (e.g. printing messages, or mutating <code>IORef</code>s). <code>return</code> turns that value into an IO computation of type <code>IO T</code>. The type <code>IO T</code> is for expressions that <em>could</em> have side effects before returning <code>T</code>. <code>return</code> creates a computation that does no side effects, as a trivial subcase of <code>IO T</code>.</p>\n\n<p><code>newCString result</code> is already of type <code>IO CString</code>, so if you use <code>return</code> you get it wrapped too many times, as something of type <code>IO (IO CString)</code>. This is a computation which does not return a string, but another computation to run (which will eventually produce a string).</p>\n\n<p>The obvious solution here is to remove the <code>return</code> to avoid the redundant wrapping.</p>\n\n<p>Another, not recommended, solution would be</p>\n\n<pre><code>do ...\n   ...\n   string &lt;- newCString result\n   return string\n</code></pre>\n\n<p>This would work since <code>string</code> would have type <code>String</code>, not <code>IO CString</code>. This is not recommended because it's redundant. Indeed, we could even add more redundancy as</p>\n\n<pre><code>do ...\n   ...\n   string &lt;- newCString result\n   string2 &lt;- return string\n   string3 &lt;- return string2\n   return string3\n</code></pre>\n\n<p>which would have the same effect. But this serves no purpose, and impacts readability.</p>\n\n<hr>\n\n<p>Your code is perfectly fine as it is. Perhaps you also want to  consider some alternatives using the \"applicative style\".</p>\n\n<pre><code>findshift :: CString -&gt; CString -&gt; CString -&gt; IO CString\nfindshift a s e = do\n    result &lt;- hs_findshift &lt;$&gt; peekCString a &lt;*&gt; peekCString s &lt;*&gt; peekCString e\n    newCString result\n</code></pre>\n\n<p>or even</p>\n\n<pre><code>findshift :: CString -&gt; CString -&gt; CString -&gt; IO CString\nfindshift a s e =\n    hs_findshift &lt;$&gt; peekCString a &lt;*&gt; peekCString s &lt;*&gt; peekCString e &gt;&gt;= newCString\n</code></pre>\n\n<p>(I'm not a fan of this last one, though.)</p>\n"}], "owner": {"reputation": 15, "user_id": 4883798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09bb07175c327addfb5d0520f0d0cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Jakob Br&#248;gger", "link": "https://stackoverflow.com/users/4883798/jakob-br%c3%b8gger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 50884078, "answer_count": 2, "score": 1, "last_activity_date": 1529145701, "creation_date": 1529107374, "question_id": 50883977, "link": "https://stackoverflow.com/questions/50883977/haskell-beginner-how-did-i-get-to-io-io-string", "title": "Haskell beginner how did I get to IO ( IO String )", "body": "<p>So I got it into my head to learn me some Haskell (boriing night shifts), and I put together a program that can ease my vacation planning by being able to calculate my shift for any giving period. </p>\n\n<pre><code>import System.Environment\nimport Data.List\nimport Data.List.Split\nimport Data.Time\nimport Data.Time.Calendar.WeekDate (toWeekDate)\n\n\n-- merge xs and ys lists alternating value from each [ xs(0),ys(0),(xs(1),ys(1)..xs(n),ys(n) ]\nmerge :: [a] -&gt; [a] -&gt; [a]\nmerge xs [] = xs\nmerge [] ys = ys\nmerge (x:xs) (y:ys) = x : y : merge xs ys     \n\n-- get part of list from index 'start' to 'stop'\nslice :: Int -&gt; Int -&gt; [a] -&gt; [a]\nslice start_from stop_at xs = fst $ splitAt (stop_at - start_from) (snd $ splitAt start_from xs)\n\ntimeFormat = \"%d-%m-%Y\"\ntimeFormatOut :: Day -&gt; String\ntimeFormatOut = formatTime defaultTimeLocale \"%d-%m-%Y\" \n-- parses Strings to DateTime Day1\nparseMyDate :: String -&gt; Day\nparseMyDate = parseTimeOrError True defaultTimeLocale timeFormat\n\n-- 8 week shift rotation\nshiftRotation = cycle [\"NAT\",\"NAT\",\"NAT\",\"NAT\",\"NAT\",\"NAT\",\"NAT\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"DAG\",\"DAG\",\"DAG\",\"DAG\",\"-\",\"AFT\",\"AFT\",\"-\",\"-\",\"DAG\",\"DAG\",\"DAG\",\"-\",\"-\",\"DAG\",\"DAG\",\"DAG\",\"-\",\"DAG\",\"DAG\",\"DAG\",\"DAG\",\"DAG\",\"-\",\"DAG\",\"DAG\",\"-\",\"-\",\"AFT\",\"AFT\",\"AFT\",\"AFT\",\"AFT\",\"-\",\"-\",\"DAG(r)\",\"DAG(r)\",\"DAG(r)\",\"DAG(r)\",\"DAG(r)\",\"(r)\",\"(r)\"]\n\nhs_findshift :: String -&gt; String -&gt; String -&gt; IO String\nhs_findshift anchor start end = do\n    let dayZero = parseMyDate anchor\n    let startDate = parseMyDate start\n    let endDate = parseMyDate end\n    let startPos = fromIntegral (diffDays startDate dayZero)\n    let endPos = fromIntegral (diffDays endDate dayZero) + 1\n    let period = slice startPos endPos shiftRotation\n    let dates = map (timeFormatOut) [startDate..endDate]\n    let listStr = (concat(intersperse \",\" (merge dates period)))\n    putStrLn listStr\n</code></pre>\n\n<p>This works nicely. Now I throught I'd try and export it to a C# app so I could make a nice interface. I'm having some trouble with the it. I added</p>\n\n<pre><code>module Shiftlib where\n\nimport Foreign.C.String\nimport Foreign.C.Types\n</code></pre>\n\n<p>to the top. Right under the imports I added a block to convert inputs and outputs to C types.</p>\n\n<pre><code>foreign export ccall findshift :: CString -&gt; CString -&gt; CString -&gt; IO CString\n\nfindshift :: CString -&gt; CString -&gt; CString -&gt; IO CString\nfindshift a s e = do\n    anchor &lt;- peekCString a\n    start &lt;- peekCString s\n    end &lt;- peekCString e\n    result &lt;- hs_findshift anchor start end\n    return $ newCString result\n</code></pre>\n\n<p>now it doesn't compile. It seems that \"return $ newCString result\" returns an IO ( IO CString ) which the \"foreign\" call wont accept. </p>\n\n<pre><code>:l shiftlib\n[1 of 1] Compiling Shiftlib         ( shiftlib.hs, interpreted )\nshiftlib.hs:53:1: error:\n    * Illegal foreign declaration: requires unregisterised, llvm (-fllvm) or native code generation (-fasm)\n    * When checking declaration:\n        foreign export ccall \"findshift\" findshift\n          :: CString -&gt; CString -&gt; CString -&gt; IO CString\n   |\n53 | foreign export ccall findshift :: CString -&gt; CString -&gt; CString -&gt; IO CString\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nshiftlib.hs:61:5: error:\n    * Couldn't match type `IO CString' with `GHC.Ptr.Ptr CChar'\n      Expected type: IO CString\n        Actual type: IO (IO CString)\n    * In a stmt of a 'do' block: return $ newCString result\n      In the expression:\n        do anchor &lt;- peekCString a\n           start &lt;- peekCString s\n           end &lt;- peekCString e\n           result &lt;- hs_findshift anchor start end\n           ....\n      In an equation for `findshift':\n          findshift a s e\n            = do anchor &lt;- peekCString a\n                 start &lt;- peekCString s\n                 end &lt;- peekCString e\n                 ....\n   |\n61 |     return $ newCString result\n   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^\nFailed, no modules loaded.\n</code></pre>\n\n<p>I cant seem to get around it. How can I return a CString from my little module?</p>\n"}, {"tags": ["haskell", "web-scraping"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1529098332, "post_id": 50882373, "comment_id": 88768001, "body": "Could you elaborate on how you compiled/ran your code and how did you measure the performance, just to make sure you didn&#39;t fall for common mistakes. Also I see the type signature uses StringLike - if you use it with String you&#39;ll probably get an easy boost by switching to Text"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1529098920, "creation_date": 1529095129, "last_edit_date": 1529098920, "question_id": 50882373, "link": "https://stackoverflow.com/questions/50882373/improve-scalpel-and-tagsoup-performance", "title": "Improve scalpel and tagsoup performance", "body": "<p>I have a scraper that selectively extracts links from HTML documents but it's very slow (about ten links per second on average web page).</p>\n\n<p>The cost centres show that most time and allocations are spent in various functions of <code>Text.HTML.TagSoup.Implementation</code> module.</p>\n\n<p>From user (my code) perspective it is this function using <a href=\"http://hackage.haskell.org/package/scalpel-0.5.1/docs/Text-HTML-Scalpel.html#v:scrapeStringLike\" rel=\"nofollow noreferrer\">scalpel</a> that applies a predicate to pick only specific links: </p>\n\n<pre><code>scrapeHrefs :: (Ord content, Show content, StringLike content) =&gt; content -&gt; Selector -&gt; [content]\nscrapeHrefs str s = (concat . maybeToList) $ scrapeStringLike str (chroots s (attr \"href\" anySelector))\n</code></pre>\n\n<p>My goal is to have >95% RTS productivity. This part of the program is at 30-50% and other parts are around 97% which (to me) is a starting point in order to compare with other languages.</p>\n\n<p>Relevant settings:</p>\n\n<pre><code>ghc-options: -rtsopts -fprof-auto -fprof-cafs\ncommand line: +RTS -p -RTS\n</code></pre>\n\n<p>Basic stats:</p>\n\n<pre><code>   9,075,850,544 bytes allocated in the heap\n   3,828,726,032 bytes copied during GC\n      78,951,768 bytes maximum residency (49 sample(s))\n         933,008 bytes maximum slop\n             222 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      2137 colls,     0 par    2.636s   2.602s     0.0012s    0.0059s\n  Gen  1        49 colls,     0 par    1.280s   1.463s     0.0299s    0.0591s\n\n  INIT    time    0.000s  (  0.002s elapsed)\n  MUT     time    4.664s  ( 12.874s elapsed)\n  GC      time    3.916s  (  4.065s elapsed)\n  RP      time    0.000s  (  0.000s elapsed)\n  PROF    time    0.000s  (  0.000s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    8.580s  ( 16.942s elapsed)\n\n  %GC     time      45.6%  (24.0% elapsed)\n\n  Alloc rate    1,945,937,080 bytes per MUT second\n\n  Productivity  54.4% of total user, 76.0% of total elapsed\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1529095316, "post_id": 50882284, "comment_id": 88767066, "body": "You&#39;re missing <code>else</code>. And the indentation is indeed incorrect."}], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 7671529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dbaf7b528af6b4fc322006a558d44000?s=128&d=identicon&r=PG&f=1", "display_name": "AleA", "link": "https://stackoverflow.com/users/7671529/alea"}, "edited": false, "score": 0, "creation_date": 1529096255, "post_id": 50882471, "comment_id": 88767392, "body": "It solved the problem but I get the exception <code>Exception: Prelude.head: empty list</code>"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 17, "user_id": 7671529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dbaf7b528af6b4fc322006a558d44000?s=128&d=identicon&r=PG&f=1", "display_name": "AleA", "link": "https://stackoverflow.com/users/7671529/alea"}, "edited": false, "score": 0, "creation_date": 1529096696, "post_id": 50882471, "comment_id": 88767524, "body": "@AleA That sounds like a new question (if it isn&#39;t a duplicate) :)"}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 1, "last_activity_date": 1529095683, "creation_date": 1529095683, "answer_id": 50882471, "question_id": 50882284, "link": "https://stackoverflow.com/questions/50882284/haskell-parse-error-incorrect-identation/50882471#50882471", "title": "haskell parse error incorrect identation?", "body": "<p>I can't begin to guess why the compiler gives you that error message, but in Haskell, all <code>if/then</code> expressions need an <code>else</code> case as well:</p>\n\n<pre><code>transpose xxs =\n  if (length xxs) &gt; 0\n  then map head xxs : prova (map tail xxs)\n  else [[]]\n</code></pre>\n\n<p>Here I just put <code>[[]]</code> in the <code>else</code> branch, as that was the simplest thing I could think of to satisfy the compiler.</p>\n"}], "owner": {"reputation": 17, "user_id": 7671529, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dbaf7b528af6b4fc322006a558d44000?s=128&d=identicon&r=PG&f=1", "display_name": "AleA", "link": "https://stackoverflow.com/users/7671529/alea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 50882471, "answer_count": 1, "score": 0, "last_activity_date": 1529096451, "creation_date": 1529094547, "last_edit_date": 1529096451, "question_id": 50882284, "link": "https://stackoverflow.com/questions/50882284/haskell-parse-error-incorrect-identation", "title": "haskell parse error incorrect identation?", "body": "<p>I'm trying to write a program that accepts in input a matrix made by list of list such as <code>[[1,2],[3,4],[5,6]]</code> and gives as output its transpose <code>[[1,3,5],[2,4,6]]</code>.</p>\n\n<p>This version works but it gives an error because it reaches the end of the list and doesn't stop.</p>\n\n<pre><code>transpose xxs = map head xxs : transpose (map tail xxs)\n</code></pre>\n\n<p>So I tried this one</p>\n\n<pre><code>transpose xxs = if ((length xxs)&gt;0) then \n            map head xxs : transpose (map tail xxs)\n</code></pre>\n\n<p>But I get the error </p>\n\n<blockquote>\n  <p>parse error (possibly incorrect indentation or mismatched brackets)</p>\n</blockquote>\n\n<p>So I tried writing the code without brackets, all in one line, without indentation but I didn't manage to solve this error.</p>\n\n<p>I'm starting to suspect it's not a problem of brackets or spaces.</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1529099355, "post_id": 50882958, "comment_id": 88768300, "body": "True, but I was hoping to allow arbitrary tokens, including overlapping patterns. Performance is not important here so backtracking is absolutely fine."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1529101274, "post_id": 50882958, "comment_id": 88768747, "body": "I doubt you&#39;d be happy with exponential-time backtracking, which can easily happen when you attempt to match text over-carelessly. Really a parser is just not well suited for extracting meaning from input with no structure. Why not just use a regex, if that&#39;s what you want?"}], "tags": [], "owner": {"reputation": 2570, "user_id": 4142266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rMCN5.png?s=128&g=1", "display_name": "mschmidt", "link": "https://stackoverflow.com/users/4142266/mschmidt"}, "is_accepted": false, "score": 0, "last_activity_date": 1529098592, "creation_date": 1529098592, "answer_id": 50882958, "question_id": 50881907, "link": "https://stackoverflow.com/questions/50881907/how-to-ignore-arbitrary-tokens-using-parsec/50882958#50882958", "title": "How to ignore arbitrary tokens using parsec?", "body": "<p>This cannot work, since <code>anyToken</code> accepts and consumes - as its names says - any token, including digits. And you apply it <code>many</code> times. Therefore the attempt to read digits with the second parser must fail. There simply cannot be any tokens left.</p>\n\n<p>Instead make your first parser accept any character, that is not a digit (using <code>isDigit</code> from module <code>Data.Char</code>):</p>\n\n<pre><code>parser :: Parsec String () Int\nparser = do\n    _ &lt;- many $ satisfy (not . isDigit)\n    x &lt;- read &lt;$&gt; many1 digit\n    _ &lt;- many anyToken\n    return x\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "edited": false, "score": 0, "creation_date": 1567558222, "post_id": 50890123, "comment_id": 101995003, "body": "Roman&#39;s library is really nice and definitely solves this problem. Just one note: I think Roman meant to use the non-greedy <code>few</code> combinator in this answer instead of <code>many</code>, like <code>_ &lt;- few anySym</code>."}, {"owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "reply_to_user": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "edited": false, "score": 0, "creation_date": 1567663906, "post_id": 50890123, "comment_id": 102031145, "body": "@JamesBrock on the contrary, I wanted to demonstrate that sevo&#39;s code would work with minimal modifications (so preserving their <code>many</code>), even despite the fact that <code>many</code> is greedy! The code will correctly extract 42 from sevo&#39;s example, which may be counterintuitive if you&#39;re used to Parsec&#39;s semantics. But regex-applicative will find the successful branch if it exists at all, even if a failing branch is prioritized by the greedy <code>many</code>. The difference between <code>many</code> and <code>few</code> is that if there are multiple numbers, <code>many</code> will find the last one whereas <code>few</code> will find the first one."}, {"owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "edited": false, "score": 0, "creation_date": 1567666527, "post_id": 50890123, "comment_id": 102032168, "body": "Maybe I&#39;m doing something wrong, but when I run your example code (the first one) on the example input, I get <code>Just 2</code>. When I change <code>many</code> to <code>few</code>, I get <code>Just 42</code>. @roman-cheplyaka"}, {"owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "edited": false, "score": 0, "creation_date": 1567687567, "post_id": 50890123, "comment_id": 102043235, "body": "I take your general point about <code>regex-applicative</code> being able to find successful branches without explicit backtracking though, which is cool."}, {"owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "reply_to_user": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "edited": false, "score": 1, "creation_date": 1567756636, "post_id": 50890123, "comment_id": 102066461, "body": "@JamesBrock ouch! That makes sense. I thought I&#39;d tested the code, but apparently not. I&#39;ve made the change; thank you for your comments."}], "tags": [], "owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "is_accepted": true, "score": 2, "last_activity_date": 1567756577, "last_edit_date": 1567756577, "creation_date": 1529169989, "answer_id": 50890123, "question_id": 50881907, "link": "https://stackoverflow.com/questions/50881907/how-to-ignore-arbitrary-tokens-using-parsec/50890123#50890123", "title": "How to ignore arbitrary tokens using parsec?", "body": "<p>This can be easily done with my library <a href=\"https://hackage.haskell.org/package/regex-applicative\" rel=\"nofollow noreferrer\">regex-applicative</a>. It gives you both the combinator interface and the features of regular expressions that you seem to want.</p>\n\n<p>Here's a working version that's closest to your example:</p>\n\n<pre><code>{-# LANGUAGE ApplicativeDo #-}\nimport Text.Regex.Applicative\nimport Text.Regex.Applicative.Common (decimal)\n\nparser :: RE Char Int\nparser = do\n    _ &lt;- few anySym\n    x &lt;- decimal\n    _ &lt;- many anySym\n    return x\n\nmain :: IO ()\nmain = interact (show . match parser)\n</code></pre>\n\n<p>Here's an even shorter version, using <code>findFirstInfix</code>:</p>\n\n<pre><code>import Text.Regex.Applicative\nimport Text.Regex.Applicative.Common (decimal)\n\nmain :: IO ()\nmain = interact (snd3 . findFirstInfix decimal)\n  where snd3 (_, r, _) = r\n</code></pre>\n\n<p>If you want to perform actual tokenization (e.g. skip <code>93</code> in <code>foo93bar</code>), then take a look at <a href=\"https://hackage.haskell.org/package/lexer-applicative\" rel=\"nofollow noreferrer\">lexer-applicative</a>, a tokenizer based on regex-applicative.</p>\n"}, {"tags": [], "owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "is_accepted": false, "score": 1, "last_activity_date": 1567176784, "creation_date": 1567176784, "answer_id": 57729041, "question_id": 50881907, "link": "https://stackoverflow.com/questions/50881907/how-to-ignore-arbitrary-tokens-using-parsec/57729041#57729041", "title": "How to ignore arbitrary tokens using parsec?", "body": "<p>Replacing <code>sed</code> and <code>awk</code> with parsers is what the\n<a href=\"https://hackage.haskell.org/package/replace-megaparsec/\" rel=\"nofollow noreferrer\">replace-megaparsec</a>\nlibrary is all about.</p>\n\n<p>Extract numbers from unstructured strings with the\n<a href=\"https://hackage.haskell.org/package/replace-megaparsec/docs/Replace-Megaparsec.html#v:sepCap\" rel=\"nofollow noreferrer\"><code>sepCap</code></a>\nparser combinator.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Replace.Megaparsec\nimport Text.Megaparsec\nimport Text.Megaparsec.Char.Lexer\n\nparseTest (sepCap (decimal :: Parsec Void String Int))\n  $ \"unknown structure but containing the number 42 and maybe some other stuff\"\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>[ Left \"unknown structure but containing the number \"\n, Right 42\n, Left \" and maybe some other stuff\"\n]\n</code></pre>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "accepted_answer_id": 50890123, "answer_count": 3, "score": 2, "last_activity_date": 1567756577, "creation_date": 1529092432, "last_edit_date": 1529096723, "question_id": 50881907, "link": "https://stackoverflow.com/questions/50881907/how-to-ignore-arbitrary-tokens-using-parsec", "title": "How to ignore arbitrary tokens using parsec?", "body": "<p>I wanted to replace <code>sed</code> and <code>awk</code> with Parsec. For example, extract number from strings like <code>unknown structure but containing the number 42 and maybe some other stuff</code>.</p>\n\n<p>I run into \"unexpected end of input\". I'm looking for equivalent of non-greedy <code>.*([0-9]+).*</code>.</p>\n\n<pre><code>module Main where\n\nimport Text.Parsec\n\nparser :: Parsec String () Int\nparser = do\n    _ &lt;- many anyToken\n    x &lt;- read &lt;$&gt; many1 digit\n    _ &lt;- many anyToken\n    return x\n\nmain :: IO ()\nmain = interact (show . parse parser \"STDIN\")\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "is_accepted": false, "score": 1, "last_activity_date": 1529115899, "last_edit_date": 1529115899, "creation_date": 1529087212, "answer_id": 50880953, "question_id": 50880786, "link": "https://stackoverflow.com/questions/50880786/cant-get-this-trivial-haskel-program-to-work/50880953#50880953", "title": "Can&#39;t get this trivial haskel program to work", "body": "<p>You cannot <code>(++)</code> a <code>String</code> and a numeral type. You should first use function <code>show</code> to convert the number to a <code>String</code> before you can connect it with another string. </p>\n\n<p>In your code, parameter <code>word</code> and <code>known</code> is of some type <code>Num a =&gt; a</code>, but <code>(++)</code> accepts only two <code>String</code> (i.e. <code>[Char]</code>) as a parameter (to be precise, it accept two lists of the same type of elements, and since you have already applied a <code>String</code> to it, the other parameter should also be a <code>String</code>). So you should replace <code>word</code> with <code>show word</code>, and the same for <code>known</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 20339, "user_id": 99692, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7aee58de3a50c13e688140bc06d60225?s=128&d=identicon&r=PG", "display_name": "Kevin Reid", "link": "https://stackoverflow.com/users/99692/kevin-reid"}, "is_accepted": false, "score": 2, "last_activity_date": 1529087221, "creation_date": 1529087221, "answer_id": 50880956, "question_id": 50880786, "link": "https://stackoverflow.com/questions/50880786/cant-get-this-trivial-haskel-program-to-work/50880956#50880956", "title": "Can&#39;t get this trivial haskel program to work", "body": "<p>You are getting errors because the types are inconsistent in the program.</p>\n\n<ul>\n<li><code>No instance for (Num X)</code> means that \"<code>X</code> is not any kind of number\".</li>\n<li><code>[Char]</code> is the type of a string (<code>String</code> is an alias for it).</li>\n<li>So your error means that something is being used as a string and as a number.</li>\n</ul>\n\n<p>Looking over your code I can see that in <code>play</code> you have</p>\n\n<ul>\n<li><code>\"You have \" ++ guesses ++ \"guesses left.\"</code> which means that <code>guesses</code> must be a string, in order to be concatenated with other strings.</li>\n<li><code>guesses == 0</code> which means that <code>guesses</code> must be a number.</li>\n</ul>\n\n<p>If you got this code from the tutorial, then it is a badly written tutorial and you should find a better one. If you wrote it yourself according to the tutorial, then you must have missed a step.</p>\n\n<p>In order to convert a number to a string for printing, you can use the <code>show</code> function:</p>\n\n<pre><code>\"You have \" ++ show guesses ++ \"guesses left.\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1529092435, "creation_date": 1529092435, "answer_id": 50881909, "question_id": 50880786, "link": "https://stackoverflow.com/questions/50880786/cant-get-this-trivial-haskel-program-to-work/50881909#50881909", "title": "Can&#39;t get this trivial haskel program to work", "body": "<p>Others already pointed out some issues in your code. Here, I only wanted to provide you a general suggestion.</p>\n\n<p>Most Haskellers, including \"experts\", always start writing any new top-level function (or binding, in general) from a <em>type annotation</em>. That is, by writing <code>foo :: Type1 -&gt; Type2 -&gt; ... -&gt; ReturnType</code>. Indeed, this is strongly recommended for several reasons.</p>\n\n<p>First, it helps the programmer focus their mind on what kind of data they have to process or produce. This might be obvious in the programmer's mind for simple programs, but it becomes less trivial in more serious, high-level code.</p>\n\n<p>Second, it prevents the type inference engine to infer unintended types. Consider this code, for instance.</p>\n\n<pre><code>foo x = \"hello\" ++ x   -- line A\n</code></pre>\n\n<p>This is accepted without problems, and <code>x</code> is inferred to be of type <code>String</code> by GHC.</p>\n\n<p>However, in the programmer's mind <code>x</code> should have been an integer, and so, later on, the programmer writes</p>\n\n<pre><code>let s = foo 42 in ...  -- line B\n</code></pre>\n\n<p>and GHC complains that <code>42</code> is not a <code>String</code>. Or even worse, that <code>Num String</code> can not be satisfied, meaning that a string in not a numeric type. Now the programmer is puzzled because GHC point to line B as the problem, but that code looks fine to the programmer. \"I'm passing an integer, <code>foo</code> expects an integer, where is this weird string error coming from?!?\"</p>\n\n<p>This is not the compiler's fault -- it has no way of knowing that the code in line A was wrong. However, if the programmer told the compiler, around line A, that <code>x</code> was intended to be an integer, then it would indeed have been the compiler fault! The compiler should now complain about the error in line A! And indeed, it does: here's a GHCi quick test.</p>\n\n<pre><code>&gt;  foo :: Int -&gt; String ; foo x = \"hello\" ++ x\nerror:\n    \u2022 Couldn't match expected type \u2018[Char]\u2019 with actual type \u2018Int\u2019\n    \u2022 In the second argument of \u2018(++)\u2019, namely \u2018x\u2019\n      In the expression: \"hello\" ++ x\n      In an equation for \u2018foo\u2019: foo x = \"hello\" ++ x\n</code></pre>\n\n<p>Ah-ha! <code>++</code> wants a string, but <code>x</code> is an integer. So we have to convert it</p>\n\n<pre><code>&gt; foo :: Int -&gt; String ; foo x = \"hello\" ++ show x\n</code></pre>\n\n<p>Now, no error arises.</p>\n\n<p>In general, when coding and making some mistake, GHC might be led to infer unintended types, leading to puzzling errors later on, pointing to seeming perfect code. In such cases, a common technique is to add more and more type annotations, informing the compiler about the programmer's intent, so that GHC can produce more meaningful errors. Eventually, GHC and the programmer agree that something is wrong, and the bug can be fixed.</p>\n"}], "owner": {"reputation": 13, "user_id": 9947894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90afc5e248d67096d131a7a88ce81751?s=128&d=identicon&r=PG&f=1", "display_name": "Kaliawsfate", "link": "https://stackoverflow.com/users/9947894/kaliawsfate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 50881909, "answer_count": 3, "score": 1, "last_activity_date": 1529115899, "creation_date": 1529086528, "question_id": 50880786, "link": "https://stackoverflow.com/questions/50880786/cant-get-this-trivial-haskel-program-to-work", "title": "Can&#39;t get this trivial haskel program to work", "body": "<p>I m still learning haskell and i found a tutorial that introduces the IO concepts using the following hangman simple programm</p>\n\n<pre><code>import System.IO\nimport System.Random\n\nmain = do\n  handle &lt;- openFile \"enable1.txt\" ReadMode \n  contents &lt;- hGetContents handle           \n  gen &lt;- getStdGen                          \n  let words = map init (lines contents)     \n      (n, _) = randomR(0, (length words) - 1) gen :: (Int, StdGen) \n      word = words !! n                                         \n  play word (map (\\x -&gt; '_') word) 6        \n  build the print the string\n  hClose handle                           \n\nplay word known guesses\n  | word == known = do\n      putStrLn known\n      putStrLn \"You win!!\"\n  | guesses == 0 = do\n      putStrLn known\n      putStrLn (\"You lose. the word was \" ++ word ++ \".\")\n  | otherwise    = do\n      putStrLn known\n      putStrLn (\"You have \" ++ guesses ++ \"guesses left.\")\n      line &lt;- getLine\n      let (newKnown, newGuesses) = handle (head line) word known guesses\n      play word newKnown newGuesses\n\n    --putStrLn (handle (head line) word)\n\nhandle letter word known guesses\n  | letter `elem` word = (zipWith (\\w k -&gt; if w == letter then w else k) word known, guesses)\n  | otherwise          = (known, guesses - 1)\n</code></pre>\n\n<p>enable1.txt is a local file that have lots of words.\nI run the file using runhaskill \nand i get the following error:</p>\n\n<pre><code>:~/Documents/atom/haskell$ runhaskell hangman.hs \n\nhangman.hs:22:36: error:\n    \u2022 No instance for (Num [Char]) arising from the literal \u20186\u2019\n    \u2022 In the third argument of \u2018play\u2019, namely \u20186\u2019\n      In a stmt of a 'do' block: play word (map (\\ x -&gt; '_') word) 6\n      In the expression:\n        do { handle &lt;- openFile \"enable1.txt\" ReadMode;\n             contents &lt;- hGetContents handle;\n             gen &lt;- getStdGen;\n             let words = map init (lines contents)\n                 (n, _) = ...\n                 ....;\n             .... }\n\nhangman.hs:30:16: error:\n    \u2022 No instance for (Num [Char]) arising from the literal \u20180\u2019\n    \u2022 In the second argument of \u2018(==)\u2019, namely \u20180\u2019\n      In the expression: guesses == 0\n      In a stmt of a pattern guard for\n                     an equation for \u2018play\u2019:\n        guesses == 0\n\nhangman.hs:37:36: error:\n    \u2022 No instance for (Num [Char]) arising from a use of \u2018handle\u2019\n    \u2022 In the expression: handle (head line) word known guesses\n      In a pattern binding:\n        (newKnown, newGuesses) = handle (head line) word known guesses\n      In the expression:\n        do { putStrLn known;\n             putStrLn (\"You have \" ++ guesses ++ \"guesses left.\");\n             line &lt;- getLine;\n             let (newKnown, newGuesses) = handle (head line) word known guesses;\n             .... }\n</code></pre>\n\n<p>Can anyone please help me understand the issue/ how to fix it.\nrunhaskell --version is runghc 8.0.2</p>\n"}, {"tags": ["haskell", "monads", "reader-monad"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1529077781, "post_id": 50878926, "comment_id": 88759957, "body": "Tangential note: &quot;Which is why, I want to avoid using monads (until the time I completely comprehend the idea behind monads).&quot; -- I suggest you just use them instead. The beautiful mathematics can wait."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1529079139, "post_id": 50878926, "comment_id": 88760632, "body": "In fact, <i>using</i> monads <a href=\"https://byorgey.wordpress.com/2009/01/12/abstraction-intuition-and-the-monad-tutorial-fallacy/\" rel=\"nofollow noreferrer\">may be the best path towards comprehending the beautiful mathematics</a>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 3, "creation_date": 1529080279, "post_id": 50878926, "comment_id": 88761117, "body": "Not all experienced haskellers prefer using <code>Reader</code> to passing arguments: <a href=\"https://www.reddit.com/r/haskell/comments/8p6rjv/guidelines_for_effect_handling_in_cardano_sl/e09eeao/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/8p6rjv/&hellip;</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1529081130, "post_id": 50878926, "comment_id": 88761516, "body": "@danidiaz is there any <i>W</i> such that <b>all</b> experienced users of <i>W</i> prefer using <i>X</i> for doing <i>Y</i>? Sure, most things have a tradeoff. IMO the benefits tend to be greater in case of <code>Reader</code>."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1529082319, "post_id": 50878926, "comment_id": 88762061, "body": "@leftaroundabout could you please write an answer with benefits/costs analysis? Actually &quot;using monads is the best path...&quot; is a good argument, though I wonder what are other benefits and drawbacks."}, {"owner": {"reputation": 393, "user_id": 2176528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/136af1bfd8b8c1582d2e56ac08bfcd94?s=128&d=identicon&r=PG", "display_name": "kishlaya", "link": "https://stackoverflow.com/users/2176528/kishlaya"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1529293785, "post_id": 50878926, "comment_id": 88804714, "body": "@duplode Yeah I can but I find it a little uncomfortable to use something which I don&#39;t fully understand"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1529387941, "post_id": 50878926, "comment_id": 88842325, "body": "@kishlaya While I sympathise, it is good to keep in mind that understanding isn&#39;t monolithic. At one level, <code>Monad</code> is just a programming interface that is applicable in many situations. While knowing about the theory lurking behind it will refine your appreciation and sharpen your intuition, the opposite is also true: theory tends to be easier to make sense of when motivated by concrete situations where it shows up. When it comes to learning Haskell, it tends to work better to pick up the mathematical underpinnings as you go, rather than taking them as prerequisites."}, {"owner": {"reputation": 393, "user_id": 2176528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/136af1bfd8b8c1582d2e56ac08bfcd94?s=128&d=identicon&r=PG", "display_name": "kishlaya", "link": "https://stackoverflow.com/users/2176528/kishlaya"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1529412297, "post_id": 50878926, "comment_id": 88856357, "body": "@duplode Yeah, I agree with that. I have started playing Monads already. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1529081795, "post_id": 50879778, "comment_id": 88761816, "body": "Just like with <code>Handler</code>, you can make <code>Connection</code> a type alias (e.g. <code>modify1 :: Handler -&gt; Int -&gt; IO</code>), so there is no benefits/costs in #2. And #1 is a bit vague, could you please elaborate."}, {"owner": {"reputation": 46, "user_id": 9947516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a217143dd8196e39202b9728763a868?s=128&d=identicon&r=PG&f=1", "display_name": "iu-guest", "link": "https://stackoverflow.com/users/9947516/iu-guest"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1529127198, "post_id": 50879778, "comment_id": 88772303, "body": "I agree about #2, except... it is okay to make alias to <code>Connection</code> if it was project-defined datatype. If data <code>Connection</code> comes from some library, making it alias would cause confusion: <code>type Connection = (Lib.Connection, Bar)</code> is rather incomprehensive."}], "tags": [], "owner": {"reputation": 46, "user_id": 9947516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a217143dd8196e39202b9728763a868?s=128&d=identicon&r=PG&f=1", "display_name": "iu-guest", "link": "https://stackoverflow.com/users/9947516/iu-guest"}, "is_accepted": true, "score": 3, "last_activity_date": 1529081303, "creation_date": 1529081303, "answer_id": 50879778, "question_id": 50878926, "link": "https://stackoverflow.com/questions/50878926/preferring-reader-monad-over-directly-passing-the-environment-as-parameters/50879778#50879778", "title": "Preferring Reader monad over directly passing the environment as parameters", "body": "<ol>\n<li><p>Monad Reader is just more convenient, when you want pass arguments several levels deeper into call stack.</p></li>\n<li><p>Monad Reader facilate code change/extension. Suppose you want to fetch some value of type <code>Foo</code> from database, update it (in impure way) and store it back. Here are two versions, with <code>Reader</code> and with explicit argument passing.</p>\n\n<pre><code>data Foo = ...\nmodifyFoo :: Foo -&gt; IO Foo\ntype Handler a = Reader Connection IO a\n\nfetch1 :: Connection -&gt; Int -&gt; IO Foo\nfetch2 :: Int -&gt; Handler Foo\n\nstore1 :: Connection -&gt; Foo -&gt; IO ()\nstore2 :: Foo -&gt; Handler ()\n\nmodify1 :: Connection -&gt; Int -&gt; IO ()\nmodify1 conn key = do\n  prev &lt;- fetch1 conn key\n  new  &lt;- modify prev\n  store1 conn new\n\nmodify2 :: Int -&gt; Handler ()\nmodify2 key = do\n  prev &lt;- fetch2 key\n  new  &lt;- liftIO $ modify prev\n  store2 new\n\n-- for brave souls\nmodify2' :: Int -&gt; Handler ()\nmodify2' = fetch2 &gt;=&gt; liftIO . modify &gt;=&gt; store2\n</code></pre></li>\n</ol>\n\n<p>Should some day <code>fetch2</code> and <code>store2</code> change argument from Connection to something else (or bigger), you would just update <code>Handler</code> type alias, <code>modify2</code> stays the same.\nIn case <code>modify1</code>, <code>Connection</code> is explicit in type signature, you would have to change it too.</p>\n\n<p>For another example of usage of <code>Reader</code>\nI would suggest <code>xmonad</code> window manager. There is <code>XConfig</code> datatype somewhere\nin internals of <code>X</code> monad, but most of the time I do not want to know it, leave alone pass it along.</p>\n"}], "owner": {"reputation": 393, "user_id": 2176528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/136af1bfd8b8c1582d2e56ac08bfcd94?s=128&d=identicon&r=PG", "display_name": "kishlaya", "link": "https://stackoverflow.com/users/2176528/kishlaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 0, "accepted_answer_id": 50879778, "answer_count": 1, "score": 3, "last_activity_date": 1529081303, "creation_date": 1529077582, "question_id": 50878926, "link": "https://stackoverflow.com/questions/50878926/preferring-reader-monad-over-directly-passing-the-environment-as-parameters", "title": "Preferring Reader monad over directly passing the environment as parameters", "body": "<p>I was writing a basic CRUD app in Haskell, using libraries Servant and Opaleye.</p>\n\n<p>Servant to setup the API endpoints and Opaleye to store the data in DB.</p>\n\n<p>Let's say there's an endpoint <code>GET /users</code> which returns the list of all users from DB and another endpoint <code>POST /user</code> which creates a new user and saves it in DB.</p>\n\n<p>The program beings by initiating a connection to the DB and then it passes around this connection as a parameter to these API endpoint functions (setup using Servant) as a parameter.</p>\n\n<p>Somebody recommended me that a better way is to use the Reader Monad and store the connection in the environment.</p>\n\n<p>I was able to do it but what I don't get is why is Reader Monad a preferred way of sharing environment rather than directly passing arguments.</p>\n\n<p>P.S. - Being a beginner in Haskell, I can use Monads, follow the tutorials and make my program run but I don't really know the beautiful hidden mathematics behind them. Which is why, I want to avoid using monads (until the time I completely comprehend the idea behind monads).</p>\n\n<p>Here's my <a href=\"https://github.com/kishlaya/servant-opaleye/commit/b65b49d5ea6326010080c35c69bdf79e1b33d0ba\" rel=\"nofollow noreferrer\">code</a>, btw.</p>\n"}, {"tags": ["haskell", "yesod", "subroutine", "web-development-server", "keter"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1529077658, "post_id": 50878325, "comment_id": 88759890, "body": "Sure, <code>forkIO</code> is your friend."}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1529089118, "post_id": 50878325, "comment_id": 88764828, "body": "@arrowd , please, can you give me a code example?"}], "answers": [{"tags": [], "owner": {"reputation": 223, "user_id": 8198583, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X2yJ0.png?s=128&g=1", "display_name": "ncaq", "link": "https://stackoverflow.com/users/8198583/ncaq"}, "is_accepted": false, "score": 0, "last_activity_date": 1529664333, "creation_date": 1529664333, "answer_id": 50986226, "question_id": 50878325, "link": "https://stackoverflow.com/questions/50878325/haskell-yesod-and-keter-how-can-i-run-a-routine-periodically-every-5-minutes/50986226#50986226", "title": "Haskell, Yesod and Keter - How can I run a routine periodically (every 5 minutes)?", "body": "<p>I moved from Yesod's issue.</p>\n\n<p><a href=\"https://github.com/yesodweb/yesod/issues/1529\" rel=\"nofollow noreferrer\">Run Handler code at a specific time within yesod \u00b7 Issue #1529 \u00b7 yesodweb/yesod</a></p>\n\n<hr>\n\n<p>I do not know your complete code.\nSo, this is proposal.</p>\n\n<pre><code>makeApplication :: App -&gt; IO Application\nmakeApplication foundation = do\n    unsafeHandler foundation $\n        forkHandler (\\_ -&gt; catchError) $ forever $ do -- catchError do not exist\n          waitUntil10AM         -- waitUntil10AM do not exist\n          getCheckupR\n    logWare &lt;- makeLogWare foundation\n    -- Create the WAI application and apply middlewares\n    appPlain &lt;- toWaiAppPlain foundation\n    return $ logWare $ (acceptOverride . autohead . gzip def) appPlain\n</code></pre>\n\n<p>This code point that use <code>unsafeHandler</code> and <code>forkHandler</code>.</p>\n\n<blockquote>\n  <p>waitUntil10AM</p>\n</blockquote>\n\n<p>I do not know your timezone, environment, database structure etc, so I want you to write the details yourself.\nFor example, if you put threadDelay in forever and check it once every ten minutes, put the date on which you sent the mail already in the database and call it if you do not send it and it exceeds 10AM.</p>\n\n<blockquote>\n  <p>catchError</p>\n</blockquote>\n\n<p>Please decide what kind of processing should be done at the time of error.</p>\n\n<blockquote>\n  <p>I would like to handle errors in a way that it would never stop</p>\n</blockquote>\n\n<p>You can name the function to be passed inside forkHandler and call it again on error.</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1529664333, "creation_date": 1529075418, "question_id": 50878325, "link": "https://stackoverflow.com/questions/50878325/haskell-yesod-and-keter-how-can-i-run-a-routine-periodically-every-5-minutes", "title": "Haskell, Yesod and Keter - How can I run a routine periodically (every 5 minutes)?", "body": "<p>There are some database queries I want to run periodically, and according to its state, send notifications to users email and change the state of their accounts. Can I do it within Yesod itself?</p>\n"}, {"tags": ["haskell", "types", "fold", "monoids"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 3, "creation_date": 1529072700, "post_id": 50877453, "comment_id": 88757068, "body": "&quot;Too permissive&quot; in what sense? Do you think the more general type of <code>foldr</code> makes it unsafe somehow?"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1529072893, "post_id": 50877453, "comment_id": 88757193, "body": "yeah like we could use a binary operation that is Open for example"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1529073313, "post_id": 50877453, "comment_id": 88757447, "body": "fold may be a bit easier to understand than foldr or foldl, but that doesn&#39;t make it better. E.g. most if if not all of the list functions that return a list can be written in terms of foldr, but are rather annoying to write in terms of fold (without introducing tons of appends)"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1529075589, "post_id": 50877453, "comment_id": 88758767, "body": "The <code>Monoid</code> constraint is on the elements of the <code>Foldable</code>, not the accumulating function. <code>fold</code> and <code>foldMap</code> can obtain an accumulating function for the items in the foldable from the <code>Monoid</code> instance (i.e. <code>mappend</code>). <code>foldr</code> is more general in that the accumulator type can be different from the element type. <code>(+)</code> and <code>(++)</code> are not monoids."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529075965, "post_id": 50877453, "comment_id": 88758963, "body": "- (+) is the summation for Num which is equivalent to the Sum data-type. So I disagree it is a monoid."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529076009, "post_id": 50877453, "comment_id": 88758984, "body": "- (++) is the concatenation for String, it&#39;s the default Monoid for the String data-type. So I disagree it is a monoid."}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529076110, "post_id": 50877453, "comment_id": 88759035, "body": "Regarding foldr vs FoldMap, you are supposed to get foldr if you define foldMap (and vice-versa) as  {-# MINIMAL foldMap | foldr #-} is written in the Foldable typeclass, so there are linked somehow. foldMap f = foldr (mappend . f) mempty"}, {"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529076271, "post_id": 50877453, "comment_id": 88759128, "body": "The answer is probably in that line of code : foldr f z t = appEndo (foldMap (Endo #. f) t) z, but I don&#39;t understand these concepts of Endo and appEndo yet..."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1529077189, "post_id": 50877453, "comment_id": 88759629, "body": "@NicolasHenin (1) While e.g. <code>Integer</code> forms a monoids with <code>(+)</code> and <code>0</code>, when it comes to the nuts and bolts of actual code you can&#39;t use it directly as a <code>Monoid</code>, as there is no instance -- that is  what the <code>Sum</code> newtype is there for. (2) You might find <a href=\"https://stackoverflow.com/a/23319967/2751851\">this answer of mine</a>, which covers similar ground to chi&#39;s answer here, helpful."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1529079792, "post_id": 50877453, "comment_id": 88760914, "body": "You can read <code>(#.)</code> as <code>(.)</code>, but with the special restriction that the first argument doesn&#39;t do anything except wrap and unwrap newtype constructors. If it does anything else, the behavior will likely be very surprising, because <code>(#.)</code> only looks at the type of the first argument and ignores its value altogether. <code>(#.) _ = coerce</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529075821, "post_id": 50877588, "comment_id": 88758886, "body": "&#39;you want a monoid at all costs&#39; @chi, I just want to understand the concepts behind, instead of just saying to myself that because type inference is working it&#39;s ok... foldr (:) [] [1,2,3] // (:) :: a -&gt; [a] -&gt; [a] is not a monoid... in the same typeclass you have foldMap which is more restrictive than foldr. And they are supposed to be equivalent because  {-# MINIMAL foldMap | foldr #-}, so there are some mysteries... I don&#39;t understand that Endo stuff btw so maybe the explanation is in it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 1, "creation_date": 1529076787, "post_id": 50877588, "comment_id": 88759423, "body": "@NicolasHenin I now realized that line sounded aggressive -- sorry for that :) Anyway, you are correct when you way that <code>a -&gt; [a] -&gt; [a]</code> is not a monoid, but we can write that (up to isomorphism) as <code>a -&gt; Endo [a]</code>, whose target <code>Endo [a]</code> is a monoid. I expanded a bit the definition of <code>Endo</code> above with a bit of comment. Is there any specific part about <code>Endo</code> where you&#39;d want more detail?"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1529079634, "last_edit_date": 1529079634, "creation_date": 1529072866, "answer_id": 50877588, "question_id": 50877453, "link": "https://stackoverflow.com/questions/50877453/why-does-foldr-have-a-b-type-variable/50877588#50877588", "title": "Why does foldr have a &#39;b&#39; type variable?", "body": "<p>I'll only consider lists as a concrete case.</p>\n\n<p>One way to understand why <code>b</code> is unconstrained is to consider the monoid:</p>\n\n<pre><code>newtype Endo b = Endo { appEndo :: b -&gt; b }\n\ninstance Monoid (Endo b) where\n   mempty = Endo id\n   mappend (Endo f) (Endo g) = Endo (f . g)\n</code></pre>\n\n<p>Note that this is the monoid formed by functions of the form <code>b -&gt; b</code>, where the monoid operation is composition, and the neutral element is the identity function.</p>\n\n<p>Crucially, this is a monoid no matter what <code>b</code> is!</p>\n\n<p>Then, up to isomorphism, we can write</p>\n\n<pre><code>foldr :: (a -&gt; Endo b) -&gt; b -&gt; [a] -&gt; b\nfoldr e n list = appEndo (mconcat (map e list)) n\n</code></pre>\n\n<p>so that most of the work is done in the <code>Endo</code> monoid.</p>\n\n<p>Reordering the arguments, we even get</p>\n\n<pre><code>foldr :: (a -&gt; Endo b) -&gt; [a] -&gt; b -&gt; b\n</code></pre>\n\n<p>or even, up to isomorphism,</p>\n\n<pre><code>foldr :: (a -&gt; Endo b) -&gt; [a] -&gt; Endo b\nfoldr e = mconcat . map e \n</code></pre>\n\n<p>(which is the usual implementation in terms of <code>foldMap</code>.)</p>\n\n<p>So, another justification for <code>b</code> being unrestricted in <code>foldr</code> is that <code>Endo b</code> does not require any condition on <code>b</code> to be a monoid.</p>\n\n<hr>\n\n<p>More low-level explanation through some examples:</p>\n\n<p>As an example, note that <code>foldr (:) [] list = list</code> for any <code>list :: [a]</code>.</p>\n\n<p>To obtain the above, we need to pick <code>b ~ [a]</code>. If we were limited to choose <code>b ~ a</code> we could not type check the above example.</p>\n\n<p>As another example, consider</p>\n\n<pre><code>any :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nany p = foldr (\\x acc -&gt; p x || acc) True\n</code></pre>\n\n<p>Above, <code>x :: a</code> and <code>acc :: b ~ Bool</code>, which are in general different types.</p>\n\n<p>Also, don't forget the definition of <code>foldr</code> on lists:</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldr c n [] = n\nfoldr c n (x:xs) = c x (foldr c n xs)\n</code></pre>\n\n<p>Here, there is no restriction that is needed on <code>b</code> to make <code>foldr</code> well-typed.</p>\n"}, {"comments": [{"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1529262487, "post_id": 50889355, "comment_id": 88799155, "body": "wow, thank you :-) Exactly the type of answer I was looking for !"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 3, "last_activity_date": 1583579561, "last_edit_date": 1583579561, "creation_date": 1529163921, "answer_id": 50889355, "question_id": 50877453, "link": "https://stackoverflow.com/questions/50877453/why-does-foldr-have-a-b-type-variable/50889355#50889355", "title": "Why does foldr have a &#39;b&#39; type variable?", "body": "<p>Looking at the <code>Foldable</code> class definition you quoted, the type of <code>foldr</code> just with its arguments re-ordered a bit, </p>\n\n<pre><code>    foldr' ::   Foldable t =&gt;     (a -&gt; (b -&gt; b)) -&gt; t a -&gt; (b -&gt; b)   , \n</code></pre>\n\n<p>actually <em>unifies</em> with (becomes the same as) the type of </p>\n\n<pre><code>    foldMap :: (Foldable t, Monoid m) =&gt; (a -&gt; m) -&gt; t a -&gt; m          , \n</code></pre>\n\n<p><em>provided</em> <code>b -&gt; b</code> is a <em>monoid</em>, <code>(b -&gt; b) ~ Monoid m =&gt; m</code> i.e. <code>Monoid (b -&gt; b)</code>, the type of so-called endofunctions (i.e. functions from a type going to the same type), which are associatively combined with functional composition just as you expected. </p>\n\n<p>Indeed they do form a monoid.</p>\n\n<p>What does that mean, endofunctions forming a monoid under functional composition (<code>(f . g) x = f (g x)</code>) ? Simply, that <em>any two endofunctions can be composed</em>, with functional composition being <em>associative</em> ( <code>(f . g) . h == f . (g . h)</code> -- you can check this out yourself by using its definition). Also it means  <em>the existence of</em> the special function <code>id</code> such that <code>id . f == f == f . id</code>; indeed <code>id x = x</code> fits the bill. That's all, believe it or not.</p>\n\n<p>Indeed <code>(:) :: a -&gt; [a] -&gt; [a]</code> (read: <code>(:)</code> has type <code>a -&gt; [a] -&gt; [a]</code>), which   is a kind of <code>a -&gt; b -&gt; b</code>; so, with <code>one :: Int ; one = 1</code> we have <code>(one :) :: [Int] -&gt; [Int]</code> which is a  kind of <code>b -&gt; b</code> as well. </p>\n\n<p>Also <code>(one +) :: Int -&gt; Int</code>, which is an even more specialized kind of <code>b -&gt; b</code>, but still. </p>\n\n<p>As a technicality, a <code>newtype</code> must be used to actually give this type its Monoid instance. This basically means, you can treat <code>Endo</code> / <code>appEndo</code> as syntactic noise, when reading the code. </p>\n\n<p>So <code>foldr'</code> is indeed <code>foldMap</code>, up to some newtype tagging (with <code>Endo</code>) and untagging (with <code>appEndo</code>) : <code>appEndo (Endo f) == f</code>, that's all:</p>\n\n<pre><code>Sum 1     &lt;&gt; Sum 2     = Sum (1 + 2)         -- Sum is a tag, saying \"we want (+)\"\nEndo (1:) &lt;&gt; Endo (2:) = Endo ((1:) . (2:))  -- Endo is a tag, saying \"we want (.)\"\n\nfoldMap Sum          [1,2,3] = Sum (1 + 2 + 3)\nfoldMap (Endo . (:)) [1,2,3] = Endo ((1:) . (2:) . (3:))\n\nfoldr' (:) [1,2,3] [4,5] = appEndo (foldMap (Endo . (:)) [1,2,3]) [4,5]\n                         = appEndo (Endo ((1:) . (2:) . (3:))) [4,5]\n                         = ((1:) . (2:) . (3:)) [4,5]\n                         = [1,2,3,4,5] =\nfoldr (:) [4,5] [1,2,3]\n</code></pre>\n\n<p>Notice the lack of inner parentheses in <code>(1 + 2 + 3)</code> as well as in <code>((1:) . (2:) . (3:))</code>. The associativity of <code>&lt;&gt;</code> (here, <code>+</code>, and <code>.</code>) means the actual parenthesization doesn't matter semantically, and can only matter operationally. Which is the whole point, because grouping the calculations as a tree opens them up for the possibility of being calculated in parallel:</p>\n\n<pre><code>(1 + 2 + 3 + 4 + 5 +  + ...)\n=\n( ( (1 + 2) + (3 + 4) ) + ( ( (5 + 6) + ... ) ... ) ... )\n=\n ......\n</code></pre>\n\n<p>Of course the actual order with <code>foldr</code> / <code>Endo</code> is linear:</p>\n\n<pre><code>foldr (:) [] [1,2,3,4]\n=\n1 : (2 : (3 : (4 : [] )))\n</code></pre>\n\n<hr>\n\n<p><sub>(copying here some content from the comments, as we are supposed to do, on SO.)</sub></p>\n\n<ul>\n<li>one trick I find helps me in understanding the tangled newtyped codes: when you see something like <code>Endo f &lt;&gt; Endo g = Endo $ x -&gt; (f . g) x</code>, write it instead as an <em>equational pseudocode</em>, like <code>appEndo (Endo f &lt;&gt; Endo g) x = (f . g) x</code> seen as the <em>definition</em> of <code>&lt;&gt;</code> &ndash; it's not a valid Haskell, but expresses the intent more clearly, for me. I.e. I tend to see the lambdas as implementation, and equations as, well, equations (<a href=\"https://stackoverflow.com/a/45516443/849891\">an example</a>) (\"tangled\" does not apply here, of course, but e.g., like, with Continuation monad, etc.) </li>\n</ul>\n\n<p>You're asking, </p>\n\n<blockquote>\n  <p>\"what <code>#.</code> does in <code>(Endo #. f)</code>?</p>\n</blockquote>\n\n<ul>\n<li>well, the explanation is <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/src/Data.Functor.Utils.html#%23.\" rel=\"nofollow noreferrer\">here</a>. it says, in our case, that <code>Endo #. (:) = coerce (:) `asTypeOf` (Endo . (:))</code>. this is the same as writing <code>let { g :: a -&gt; Endo [a] ; g = coerce (:) } in g</code>. <code>Endo b</code> is practically the same as <code>b -&gt; b</code>, save for the tag <code>Endo</code> which lets us define the Monoid instance for it. <code>instance Monoid (b-&gt;b) where ....</code> isn't valid Haskell. So we can read <code>Endo #. (:)</code> as just <code>Endo . (:)</code>. </li>\n<li>this has to do with what <code>newtype</code> is. it can be seen as compile-time tag. it disappears at run-time. (like, <code>Sum 2</code> is actually just <code>2</code> at run time, and <code>Product 2</code> is just <code>2</code> as well). But writing <code>Sum . (1+)</code> hides its ephemeral nature, which <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/src/Data.Functor.Utils.html#%23.\" rel=\"nofollow noreferrer\">apparently</a> \"can lead to very inefficient code\". IOW this stuff is for compiler, it's not for the language itself. language-wise, <code>#.</code> is just <code>.</code>. <code>#</code> is usually used in such situations.</li>\n</ul>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 1, "accepted_answer_id": 50889355, "answer_count": 2, "score": 2, "last_activity_date": 1583579561, "creation_date": 1529072367, "last_edit_date": 1529145996, "question_id": 50877453, "link": "https://stackoverflow.com/questions/50877453/why-does-foldr-have-a-b-type-variable", "title": "Why does foldr have a &#39;b&#39; type variable?", "body": "<p>Since a Monoid is closed (a -> a -> a), How can we get a second type 'b' along the way ? I have the impression foldr is too permissive, in the sense that I could use a function for folding that it's not closed. You'll notice as well that fold and foldMap only have 'a'.</p>\n\n<p>Below a snippet of the Foldable typeclass :</p>\n\n<pre><code>class Foldable t where\n    fold :: Monoid m =&gt; t m -&gt; m\n    foldMap :: Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m\n    foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>e.g : </p>\n\n<pre><code>foldr (+) 0 [1..5] // ok (+) is a monoid\nfoldr (++) \"\" [\"ab\", \" cd\"] // ok (++) is a monoid for String\nfoldr (:) [] [1,2,3] // (:) :: a -&gt; [a] -&gt; [a] is not a monoid...\n</code></pre>\n\n<p>I was thinking a Foldable should/could only fold with a monoid, is that statement wrong ? (e.g : In my head it was like reduce is using a commutative monoid and fold a simple monoid.. (see <a href=\"https://stackoverflow.com/questions/25158780/difference-between-reduce-and-foldleft-fold-in-functional-programming-particula/25158790#25158790\">Difference between reduce and foldLeft/fold in functional programming (particularly Scala and Scala APIs)?</a>))  </p>\n"}, {"tags": ["haskell", "xmonad", "xmobar"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9946735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b4daafa0be4f62f87721db0234b58fe?s=128&d=identicon&r=PG&f=1", "display_name": "biskulopty", "link": "https://stackoverflow.com/users/9946735/biskulopty"}, "edited": false, "score": 1, "creation_date": 1529152311, "post_id": 50880611, "comment_id": 88777215, "body": "Great, I got it working like this:   <code>mapM_ (\\handle -&gt; dynamicLogWithPP $ defaultPP { ppOutput = System.IO.hPutStrLn handle }) xmprocs </code>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1529085590, "creation_date": 1529085590, "answer_id": 50880611, "question_id": 50876381, "link": "https://stackoverflow.com/questions/50876381/how-to-spawn-xmobar-instance-for-each-screen/50880611#50880611", "title": "How to spawn XMobar instance for each screen?", "body": "<p>e.g. something like this:</p>\n\n<pre><code>import XMonad\nimport XMonad.Util.Run\nimport XMonad.Layout.IndependentScreens\n\nmain = do\n    n &lt;- countScreens\n    xmprocs &lt;- mapM (\\i -&gt; spawnPipe $ \"xmobar /home/biskulopty/.xmobarrc-\" ++ show i ++ \" -x \" ++ show i) [0..n-1]\n    xmonad def {\n        logHook = {- use xmprocs, which is a list of pipes of type [Handle] -}\n    }\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 9946735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b4daafa0be4f62f87721db0234b58fe?s=128&d=identicon&r=PG&f=1", "display_name": "biskulopty", "link": "https://stackoverflow.com/users/9946735/biskulopty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1175, "favorite_count": 0, "accepted_answer_id": 50880611, "answer_count": 1, "score": 1, "last_activity_date": 1529085590, "creation_date": 1529068355, "question_id": 50876381, "link": "https://stackoverflow.com/questions/50876381/how-to-spawn-xmobar-instance-for-each-screen", "title": "How to spawn XMobar instance for each screen?", "body": "<p><a href=\"https://stackoverflow.com/questions/46736192/how-to-put-an-instance-of-xmobar-on-each-screen-in-xmonad\">This question</a> has an appropriate answer, but it's hiding everything I found difficult inside \"spawn xmobar\" comment.<br>\n- How to spawn one instance of xmobar for different screens?<br>\n- If this is not an option, how to spawn multiple instances on multiple screens?<br>\n- How to setup logHook with multiple instances of xmobar?</p>\n"}, {"tags": ["haskell", "yesod", "monad-transformers", "haskell-persistent"], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1529054279, "creation_date": 1529054279, "question_id": 50872525, "link": "https://stackoverflow.com/questions/50872525/how-to-combine-persistents-sqlbackend-with-a-custom-monad", "title": "How to &quot;combine&quot; Persistent&#39;s SqlBackend with a custom monad?", "body": "<p>I have a custom monad stack for my Servant app, which I'd like to keep to a single <code>ReaderT</code> without making it an \"onion\" over <code>SqlPersistT</code> or suchlike. Problem is, I haven't been able to find any code samples that do this.</p>\n\n<p>It seems like most Persistent functions return an action in the following monad: <code>(MonadIO m, PersistRecordBackend record backend) =&gt; ReaderT backend m record</code></p>\n\n<p>Here's the definition of <code>PersistRecordBackend</code>:</p>\n\n<pre><code>type PersistRecordBackend record backend = (PersistEntity record, PersistEntityBackend record ~ BaseBackend backend)\n</code></pre>\n\n<p><code>BaseBackend</code> is part of the <code>HasPersistentBackend</code> type-class:</p>\n\n<pre><code>class HasPeristenBackend backend where\n  type BaseBackend backend\n  persistBackend :: backend -&gt; BaseBackend backend\n</code></pre>\n\n<p>So, if I'm on the right track, either my custom <code>AppM</code> or <code>Env</code> will have to implement this <code>HasPersistentBackend</code> type-class.</p>\n\n<pre><code>data Env = Env {envDbPool, envLogger, envOtherStuff}\ntype AppM = ReaderT Env IO\n</code></pre>\n\n<p>Any help with getting this working would be appreciated. Finally, I'd like to be able to call <code>runSqlPool</code> directly in <code>AppM</code> (i.e. without any form of <code>lift</code>)</p>\n"}, {"tags": ["csv", "haskell"], "comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 2, "creation_date": 1529017464, "post_id": 50866517, "comment_id": 88736364, "body": "Your list has a comma character, so it has to be quoted to keep it from being interpreted as multiple fields. If the quotes are the problem, you could always use a different delimiter inside your list, like spaces or something."}, {"owner": {"reputation": 1278, "user_id": 1185179, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/776f28ab850903865a90b52c2f90a220?s=128&d=identicon&r=PG", "display_name": "brittAnderson", "link": "https://stackoverflow.com/users/1185179/brittanderson"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1529086608, "post_id": 50866517, "comment_id": 88763853, "body": "Thank you. This may be the simplest thing to do, and then I can replace those on the R side with gsub or something similar."}], "answers": [{"comments": [{"owner": {"reputation": 1278, "user_id": 1185179, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/776f28ab850903865a90b52c2f90a220?s=128&d=identicon&r=PG", "display_name": "brittAnderson", "link": "https://stackoverflow.com/users/1185179/brittanderson"}, "edited": false, "score": 1, "creation_date": 1529086642, "post_id": 50872753, "comment_id": 88763879, "body": "Thanks for the excellent advice. I will try some of your suggestions and when I get one to work come back and accept the answer."}, {"owner": {"reputation": 1278, "user_id": 1185179, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/776f28ab850903865a90b52c2f90a220?s=128&d=identicon&r=PG", "display_name": "brittAnderson", "link": "https://stackoverflow.com/users/1185179/brittanderson"}, "edited": false, "score": 0, "creation_date": 1529165986, "post_id": 50872753, "comment_id": 88780373, "body": "I accepted this because of the json advice. I dreaded learning yet another haskell package, but aeson is pretty minimal, and ultimately I was able to write my own toJSON instances for my special data types, and with jsonlite on the R side, it seems a better solution than csv. I hope to come back some day soon and write a more complete version of the solution I used in case it will help someone to see details. If you end up before then, just write me."}], "tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": true, "score": 4, "last_activity_date": 1529054983, "creation_date": 1529054983, "answer_id": 50872753, "question_id": 50866517, "link": "https://stackoverflow.com/questions/50866517/how-to-handle-a-list-to-csv-record-field-in-haskell/50872753#50872753", "title": "How to handle a list to CSV record field in Haskell", "body": "<blockquote>\n  <p>Can anyone advise how I might approach this issue of a variable length list in a conversion to csv and how to make it maximally friendly on reading the CSV into another environment like R?</p>\n</blockquote>\n\n<p>Since this seems to be the core question, and the remainder of the post seems to be an X-Y problem that assumes CSV as the preferred format, here's an isolated answer to that:</p>\n\n<p>How about using JSON instead? You can write your data type to a JSON structure that is isomorphic to the one you've already got, and R supports JSON through <a href=\"https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html\" rel=\"nofollow noreferrer\"><code>jsonlite</code></a>. Then you can have your variable-length lists in R without needing to encode them into a column layout (and back again?).</p>\n\n<hr>\n\n<p>If, however, you'd prefer to <em>have</em> that column layout, here's an answer to that:</p>\n\n<blockquote>\n  <p>events will always have a trial number and time, but may have 0, 1, or more of other values, such as <code>Efix</code><em>[, <code>RewStart</code> and <code>RewEnd</code> [?]</em>] in this example.</p>\n</blockquote>\n\n<p>Then having</p>\n\n<pre><code>data Event = Trial { time :: Int, trialNum :: Int }\n           | Efix { eye :: Char, start :: Int, stop :: Int, x :: Int, y :: Int }\n           | RewStart { time :: Int }\n           | RewEnd { time :: Int }\n\ntype Events = [Event]\n</code></pre>\n\n<p>does not seem to quite model what you're saying. How about, instead,</p>\n\n<pre><code>data Event p = Trial { time :: Int, trialNum :: Int, points :: [p] }\ndata Point = Efix { eye :: Char, start :: Int, stop :: Int, x :: Int, y :: Int }\n           | RewStart { time :: Int }\n           | RewEnd { time :: Int }\n\ntype Events = [Event Point]\n</code></pre>\n\n<p>Then your records would look like</p>\n\n<pre><code>trialRecord1 = Trial { time = 123, trialNum = 1, points =\n                 [ Efix { eye = 'R', start = 123, stop = 234, x = 222, y = 123 }\n                 , RewStart { time = 234 }\n                 , RewEnd { time = 345 } ] }\n\ntrialRecord2 = Trial { time = 123, trialNum = 1, points =\n                 [ RewStart { time = 234 }\n                 , RewEnd { time = 345 } ] }\n\ntrialRecord3 = Trial { time = 123, trialNum = 1, points =\n                 [ Efix { eye = 'R', start = 123, stop = 234, x = 222, y = 123 }\n                 , Efix { eye = 'R', start = 223, stop = 334, x = 100, y = 222 }\n                 , RewStart { time = 234 }\n                 , RewEnd { time = 345 } ] }\n</code></pre>\n\n<blockquote>\n  <p>How do I generate a csv file from such data where I can have column heads such as <em>trialTime</em>, <em>trialNum</em>, <em>fixationStartTime</em>, ..., <em>rewStartTime</em>, and <em>rewEndTime</em>.</p>\n</blockquote>\n\n<p>Since you can only be sure of <em>trialTime</em> and <em>trialNum</em>, those are the only two columns you can hardcode. The rest of the columns have to be indented according to what points are present in the other events. For example, rendering <code>trialRecord1</code>, <code>trialRecord2</code> and <code>trialRecord3</code> in a table layout should (probably?) give something like</p>\n\n<pre><code>+-----------+-----------+----------+--------------+--------------------+-------------------+------------+------------+--------------+--------------------+-------------------+------------+------------+---------------+-------------+\n| recordNum | trialTime | trialNum | fixationEye1 | fixationStartTime1 | fixationStopTime1 | fixationX1 | fixationY1 | fixationEye2 | fixationStartTime2 | fixationStopTime2 | fixationX2 | fixationY2 | rewStartTime1 | rewEndTime1 |\n+-----------+-----------+----------+--------------+--------------------+-------------------+------------+------------+--------------+--------------------+-------------------+------------+------------+---------------+-------------+\n|         1 |       123 |        1 |            R |                123 |               234 |        222 |        123 |              |                    |                   |            |            |           234 |         345 |\n|         2 |       123 |        1 |              |                    |                   |            |            |              |                    |                   |            |            |           234 |         345 |\n|         3 |       123 |        1 |            R |                123 |               234 |        222 |        123 |            R |                223 |               334 |        100 |        222 |           234 |         345 |\n+-----------+-----------+----------+--------------+--------------------+-------------------+------------+------------+--------------+--------------------+-------------------+------------+------------+---------------+-------------+\n</code></pre>\n\n<p>You could write a function <code>align :: [Event Point] -&gt; [Event (Maybe Point)]</code> that inserts <code>Nothing</code>s in case of missing data points. (A <code>Nothing</code> may correspond to a variable amount of rows depending on what <code>Point</code> is being translated to columns, so you could also consider a function of type <code>[Event Point] -&gt; [Event (Either NumEmptyColumns Point)]</code> where <code>type NumEmptyColumns = Int</code>.)</p>\n\n<p>Running <code>align [ trialRecord1, trialRecord2, trialRecord3 ]</code> could then give the value</p>\n\n<pre><code>[ Trial { time = 123, trialNum = 1, points =\n    [ Just $ Efix { eye ='R', start = 123, stop = 234, x = 222, y = 123 }\n    , Nothing\n    , Just $ RewStart { time = 234 }\n    , Just $ RewEnd { time = 345 } ] }\n\n, Trial { time = 123, trialNum = 1, points =\n    [ Nothing\n    , Nothing\n    , Just $ RewStart { time = 234 }\n    , Just $ RewEnd { time = 345 } ] }\n\n, Trial { time = 123, trialNum = 1, points =\n    [ Just $ Efix { eye ='R', start = 123, stop = 234, x = 222, y = 123 }\n    , Just $ Efix { eye ='R', start = 223, stop = 334, x = 100, y = 222 }\n    , Just $ RewStart { time = 234 }\n    , Just $ RewEnd { time = 345 } ] }\n]\n</code></pre>\n\n<p>Turning this regular (non-jagged) list of lists into a regular csv should be more straight-forward.</p>\n\n<blockquote>\n  <p>with <code>pack $ show</code> I noticed I get quotes and escapes characters when the list is greater than length 1</p>\n\n<pre><code>\"123,234,\\\"[1,2]\\\",345,456\\r\\n\"\n</code></pre>\n</blockquote>\n\n<p>As @DarthFennec says, this is because the value <code>[1,2]</code> contains a comma which is a special character in your csv. The only kind of escape character you have here is the <code>\"</code>s -- the <code>\\</code>s are Haskell escape codes to show a string that contains a quote:</p>\n\n<pre><code>GHCi&gt; putStrLn \"123,234,\\\"[1,2]\\\",345,456\\r\\n\"\n123,234,\"[1,2]\",345,456\n</code></pre>\n\n<p>This is how the string actually looks like.</p>\n\n<p>But having multiple values in a Haskell-syntax list literal in a csv file is probably not \"maximally friendly\". If you're doing that, then perhaps JSON is a better alternative.</p>\n"}], "owner": {"reputation": 1278, "user_id": 1185179, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/776f28ab850903865a90b52c2f90a220?s=128&d=identicon&r=PG", "display_name": "brittAnderson", "link": "https://stackoverflow.com/users/1185179/brittanderson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 50872753, "answer_count": 1, "score": 1, "last_activity_date": 1529054983, "creation_date": 1529013542, "last_edit_date": 1529048370, "question_id": 50866517, "link": "https://stackoverflow.com/questions/50866517/how-to-handle-a-list-to-csv-record-field-in-haskell", "title": "How to handle a list to CSV record field in Haskell", "body": "<p>The goal is to read in a text file and convert it to a csv. The input text file lines will always have some fields, but there will be other fields that appear zero, 1, or more times. The problem is how to handle those fields with varying numbers of items.</p>\n\n<p>Example of the problem:</p>\n\n<p>I can parse the text file to get a list of \"events\" that might look like the following where each of the data constructors if for a particular type TrialEvents:</p>\n\n<p>For instance,</p>\n\n<pre><code>trialRecord1 = [ Trial {time = 123, trialNum = 1}\n               , Efix {eye ='R' ,start = 123, stop = 234, x = 222, y = 123}\n               , RewStart {time = 234}, RewEnd {time = 345} ]\n\ntrialRecord2 = [ Trial {time = 123, trialNum = 1}\n               , RewStart {time = 234}, RewEnd {time = 345} ]\n\ntrialRecord3 = [ Trial {time = 123, trialNum = 1}\n               , Efix {eye ='R' ,start = 123, stop = 234, x = 222, y = 123}\n               , Efix {eye ='R' ,start = 223, stop = 334, x = 100, y = 222}\n               , RewStart {time = 234}, RewEnd {time = 345} ]\n</code></pre>\n\n<p>These lists of events, one for each trial, will always have a trial number and time, but may have 0, 1, or more of other values, such as <code>Efix</code> in this example.</p>\n\n<p>My confusion is about how to generate a csv file from such data where I can have column heads such as trialTime, trialNumber, fixationStartTime, ... , rewStartTime, and RewEndTime. To be able to write the fixationStartTimes I thought I could use a list that could be empty, have one value, or have multiple values.</p>\n\n<p>But when using the cassava package and writing my own instance of <code>ToField</code> (just testing with a list of integers) with <code>pack $ show</code> I noticed I get quotes and escapes characters when the list is greater than length 1, but not for 1 or zero length lists.</p>\n\n<pre><code>\"123,234,\\\"[1,2]\\\",345,456\\r\\n\"\n\"123,234,[1],345,456\\r\\n\"\n</code></pre>\n\n<p>This will present problems when I try to read the csv file into an analysis program and I will have to handle these varying cases.</p>\n\n<p>Can anyone advise how I might approach this issue of a variable length list in a conversion to csv and how to make it maximally friendly on reading the CSV into another environment like R?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "tree", "gloss"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1529004085, "post_id": 50862498, "comment_id": 88731461, "body": "What do you mean by &#39;failing&#39;? Is its output wrong? Is there an error? Please elaborate on your problem."}], "answers": [{"tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": false, "score": 1, "last_activity_date": 1529014543, "creation_date": 1529014543, "answer_id": 50866677, "question_id": 50862498, "link": "https://stackoverflow.com/questions/50862498/pythagoras-tree-failling-on-level-2-and-more-why/50866677#50866677", "title": "Pythagoras Tree failling on level 2 and more, why?", "body": "<p>The problem lies solely in your <code>drawPTree</code> function, and I'll address the problems I found in it, into a working solution.  </p>\n\n<p>We start with your current solution:  </p>\n\n<pre><code>drawPTree :: PTree -&gt; [Picture]\ndrawPTree p = aux p (0,0) 0 where\n      aux :: PTree -&gt; (Float, Float) -&gt; Float -&gt; [Picture]\n      aux (Unit c) (x,y) ang = [Translate x y (Rotate ang (square c))]\n      aux (Comp c l r) (x,y) ang = [Translate x y (Rotate ang (square c))]++(aux l (x - somaX c,y + somaY c) (ang - 45)) ++ (aux r (x + somaX c,y + somaY c) (ang + 45)) \n                  where somaX c = c/2 \n                        somaY c = c + sqrt(((c * (sqrt 2))/4)^2 - ((sqrt (c^2 + c^2)) / 4)^2)   \n</code></pre>\n\n<p>First up, let's deal with <code>somaX</code> and <code>somaY</code>, which based on the implementation are the translations to <code>x</code> and <code>y</code> along the direction of the current branch.<br>\nNote that you can define them as variables instead of functions, since <code>c</code> is already in scope, also, <code>sqrt(((c * (sqrt 2))/4)^2 - ((sqrt (c^2 + c^2)) / 4)^2)=0</code> hence <code>somaY = c</code> (this can be seen from the diagram of Pythagoras Tree):  </p>\n\n<pre><code>drawPTree :: PTree -&gt; [Picture]\ndrawPTree p = aux p (0,0) 0 where\n      aux :: PTree -&gt; (Float, Float) -&gt; Float -&gt; [Picture]\n      aux (Unit c) (x,y) ang = [Translate x y (Rotate ang (square c))]\n      aux (Comp c l r) (x,y) ang = [Translate x y (Rotate ang (square c))] ++\n                                   (aux l (x - somaX,y + somaY) (ang - 45)) ++ \n                                   (aux r (x + somaX,y + somaY) (ang + 45)) \n                  where somaX = c/2 \n                        somaY = c\n</code></pre>\n\n<p>This code still won't give you the correct result, simply because <code>Translate</code> works on the global coordinate system, so we need to give it the correct points. Luckily we can easily get the correct transformation by simple trigonometry</p>\n\n<pre><code>drawPTree :: PTree -&gt; [Picture]\ndrawPTree p = aux p (0,0) 0 where\n      aux :: PTree -&gt; (Float, Float) -&gt; Float -&gt; [Picture]\n      aux (Unit c) (x,y) ang = [Translate x y (Rotate ang (square c))]\n      aux (Comp c l r) (x,y) ang = [Translate x y (Rotate ang (square c))] ++\n                                    (aux l (x + somaXLeft,y + somaYLeft) (ang - 45)) ++ \n                                    (aux r (x + somaXRight,y + somaYRight) (ang + 45)) \n                  where somaX = c/2\n                        somaY = c\n                        angRads = ang * pi / 180\n                        branchToGlobal angle (dx,dy) = \n                          (dx * cos angle + dy * sin angle, dy * cos angle - dx * sin angle)\n                        (somaXLeft, somaYLeft) = branchToGlobal angRads (-somaX, somaY)\n                        (somaXRight, somaYRight) = branchToGlobal angRads (somaX, somaY)\n</code></pre>\n\n<p>And this will indeed render the tree correctly.</p>\n"}], "owner": {"reputation": 21, "user_id": 9576125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f722618fdb2dd85ac85f2647731d390?s=128&d=identicon&r=PG&f=1", "display_name": "Jaime", "link": "https://stackoverflow.com/users/9576125/jaime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1529014543, "creation_date": 1528995387, "last_edit_date": 1528995816, "question_id": 50862498, "link": "https://stackoverflow.com/questions/50862498/pythagoras-tree-failling-on-level-2-and-more-why", "title": "Pythagoras Tree failling on level 2 and more, why?", "body": "<p>So we are trying to build a Pythagoras <code>Tree</code> using <code>gloss</code>, and it fails level 2 and next ones (only works level 0 and 1).</p>\n\n<p>Here is the code:</p>\n\n<pre><code>data FTree a b = Unit b | Comp a (FTree a b) (FTree a b) deriving (Eq,Show)\ntype PTree = FTree Square Square\ntype Square = Float\n\ngeneratePTree n = aux n 100 where \n   aux :: Int -&gt; Float -&gt; PTree \n   aux 0 x = Unit x\n   aux n x = Comp x (aux (n-1) (x * (sqrt(2)/2))) (aux (n-1) (x * (sqrt(2)/2))) \n\ndrawPTree :: PTree -&gt; [Picture]\ndrawPTree p = aux p (0,0) 0 where\n      aux :: PTree -&gt; (Float, Float) -&gt; Float -&gt; [Picture]\n      aux (Unit c) (x,y) ang = [Translate x y (Rotate ang (square c))]\n      aux (Comp c l r) (x,y) ang = [Translate x y (Rotate ang (square c))]++(aux l (x - somaX c,y + somaY c) (ang - 45)) ++ (aux r (x + somaX c,y + somaY c) (ang + 45)) \n                  where somaX c = c/2 \n                        somaY c = c + sqrt(((c * (sqrt 2))/4)^2 - ((sqrt (c^2 + c^2)) / 4)^2)   \n\nwindow = (InWindow \"CP\" (800,800) (0,0))\nsquare s = rectangleSolid s s\n\nmain = animate window white draw\n    where\n    pics = drawPTree (generatePTree 2)\n    draw t = Pictures $ pics\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "higher-order-functions", "fold"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528989170, "post_id": 50860733, "comment_id": 88723999, "body": "In terms of time complexity? If you do the pattern matching efficiently, no."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1528989264, "post_id": 50860733, "comment_id": 88724047, "body": "Frequently, <code>filter</code>, etc. however work a bit more efficient, due to for example list fusion, etc. But an effective implementation will typically yield a comparable result."}], "answers": [{"tags": [], "owner": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "is_accepted": false, "score": 5, "last_activity_date": 1528993112, "creation_date": 1528993112, "answer_id": 50861922, "question_id": 50860733, "link": "https://stackoverflow.com/questions/50860733/is-there-any-advantage-using-high-order-functions-filter-map-fold-instead-of/50861922#50861922", "title": "Is there any advantage using high-order functions (filter, map, fold) instead of pattern matching in Haskell?", "body": "<p>The main reason to use higher-order functions instead of pattern matching and manual recursion is that it makes your code more concise and way easier to read. </p>\n\n<p>Once you get the hang of them, you'll find that reading source code suddenly became way easier as those functions are amongst the most popular in all of Haskell.</p>\n\n<p>It's also considered a good practice, and many people appreciate that you abstract your code.</p>\n"}], "owner": {"reputation": 37, "user_id": 7503242, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-by8DgAPdX-c/AAAAAAAAAAI/AAAAAAAAADU/9HGVt4mLhGY/photo.jpg?sz=128", "display_name": "Fernando Zhapa", "link": "https://stackoverflow.com/users/7503242/fernando-zhapa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "closed_date": 1529003538, "answer_count": 1, "score": 0, "last_activity_date": 1528997383, "creation_date": 1528989101, "last_edit_date": 1528997383, "question_id": 50860733, "link": "https://stackoverflow.com/questions/50860733/is-there-any-advantage-using-high-order-functions-filter-map-fold-instead-of", "closed_reason": "Needs more focus", "title": "Is there any advantage using high-order functions (filter, map, fold) instead of pattern matching in Haskell?", "body": "<p>I have some code in Haskell that is using pattern matching. However, I think that I can use folds and filters. For me this would be more readable, but I want to know it there is any advantage in terms of complexity.</p>\n"}, {"tags": ["haskell", "matrix", "functional-programming", "transpose", "elm"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1528976539, "post_id": 50856706, "comment_id": 88715840, "body": "<code>foldl</code> takes as first parameter the accumulator, so probably <code>foldl (\\acc x -&gt; ...) ...</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 7, "creation_date": 1528978905, "post_id": 50856706, "comment_id": 88717253, "body": "All. Ways. Use. Type signatures!"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 14, "last_activity_date": 1528976761, "creation_date": 1528976761, "answer_id": 50856817, "question_id": 50856706, "link": "https://stackoverflow.com/questions/50856706/code-compiles-in-elm-but-not-in-haskell/50856817#50856817", "title": "Code compiles in Elm but not in Haskell", "body": "<p>The difference is the <em>semantics</em> of the <code>foldl</code> functions. In Elm the signature of <a href=\"http://package.elm-lang.org/packages/elm-lang/core/latest/List#foldl\" rel=\"noreferrer\"><strong><code>foldl</code></strong> [elm-doc]</a> function is:</p>\n\n<pre><code>foldl : <b>(a -&gt; b -&gt; b)</b> -&gt; b -&gt; List a -&gt; b</code></pre>\n\n<p>Whereas in Haskell, the signature of <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:foldl\" rel=\"noreferrer\"><strong><code>foldl</code></strong> [haskell-doc]</a> is:</p>\n\n<pre><code>foldl :: <b>(b -&gt; a -&gt; b)</b> -&gt; b -&gt; [a] -&gt; b</code></pre>\n\n<p>So in Haskell, the accumulator is the first parameter, and the second is an element of the list. In Elm it is the opposite. So it should probably work with:</p>\n\n<pre><code>trans matrix =\n  foldl (<b>\\acc x</b> -&gt; (addL x acc [])) [] matrix</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 6221906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4831a68cbc90735cd0ecb1b6d8853e4?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew834", "link": "https://stackoverflow.com/users/6221906/andrew834"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 50856817, "answer_count": 1, "score": 4, "last_activity_date": 1528976761, "creation_date": 1528976356, "question_id": 50856706, "link": "https://stackoverflow.com/questions/50856706/code-compiles-in-elm-but-not-in-haskell", "title": "Code compiles in Elm but not in Haskell", "body": "<p>Currently I am trying to learn Haskell, but I stumbled upon an error which I do not understand:</p>\n\n<pre><code>* Occurs check: cannot construct the infinite type: a ~ [a]\n  Expected type: [a]\n    Actual type: [[a]]\n* In the expression: (addL x acc [])\n  In the first argument of `foldl', namely\n    `(\\ x acc -&gt; (addL x acc []))'\n</code></pre>\n\n<p>As to what I was actually trying to do, is that I was trying to transpose a matrix (code provided below). And the weird part is that if I run the code in Elm (with little tweaks) it works perfectly fine. I would need some help as I do not understand what I am doing wrong.</p>\n\n<p>Elm code:</p>\n\n<pre><code>trans matrix =\n   List.foldl (\\x acc -&gt; addL x acc []) [] matrix\n\naddL x matrix solution =\n   case x of\n     []   -&gt; solution\n     h::t -&gt; case matrix of\n               []     -&gt; addL t matrix (solution++[[h]])\n               h2::t2 -&gt; addL t t2 (solution++[h2++[h]])\n</code></pre>\n\n<p>Haskell code:</p>\n\n<pre><code>trans matrix =\n  foldl (\\x acc -&gt; (addL x acc [])) [] matrix\n\naddL x matrix solution =\n  case x of\n    []  -&gt; solution\n    h:t -&gt; case matrix of\n              []    -&gt; (addL t matrix (solution++[[h]]))\n              h2:t2 -&gt; (addL t t2 (solution++[h2++[h]]))\n</code></pre>\n"}, {"tags": ["haskell", "floating-point"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1528972921, "post_id": 50855539, "comment_id": 88713677, "body": "use <code>div numer denom</code> instead of <code>floor (numer &#47; denom)</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1528989714, "post_id": 50855539, "comment_id": 88724322, "body": "The base case should be <code>counter</code>, not <code>-1</code>."}], "answers": [{"tags": [], "owner": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "is_accepted": true, "score": 2, "last_activity_date": 1528975254, "last_edit_date": 1528975254, "creation_date": 1528973254, "answer_id": 50855674, "question_id": 50855539, "link": "https://stackoverflow.com/questions/50855539/determine-factor-exponents/50855674#50855674", "title": "Determine factor exponents", "body": "<p>Your <code>numer</code> and <code>denom</code> have to be both an <code>Integral</code>, for <code>mod</code>, and a <code>Fractional</code>, for <code>/</code>. It's impossible.</p>\n\n<p>However, that's easily fixed by converting <code>fromIntegral</code> before the division, or by <code>truncate</code>'ing (or using <code>round</code>, <code>ceiling</code>, <code>floor</code>), before the <code>mod</code>.</p>\n\n<p>Or you could simply use <code>div</code> instead, like @Willem suggested.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 0, "last_activity_date": 1528999611, "creation_date": 1528999611, "answer_id": 50863478, "question_id": 50855539, "link": "https://stackoverflow.com/questions/50855539/determine-factor-exponents/50863478#50863478", "title": "Determine factor exponents", "body": "<p>Check it out</p>\n\n<pre><code>divisorCount numer denom counter\n    | (q, 0) &lt;- numer `divMod` denom = divisorCount q denom (counter+1)\n    | otherwise = -1\n</code></pre>\n"}], "owner": {"reputation": 183, "user_id": 2581199, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d73ec3d17f22435cfb35fd03ccaab721?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/2581199/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 50855674, "answer_count": 2, "score": 0, "last_activity_date": 1528999611, "creation_date": 1528972823, "last_edit_date": 1528972873, "question_id": 50855539, "link": "https://stackoverflow.com/questions/50855539/determine-factor-exponents", "title": "Determine factor exponents", "body": "<p>I am getting compiler problems with this code, but don't really know why.</p>\n\n<p>Any thoughts?   </p>\n\n<pre><code>--divisorCount :: Int -&gt; Int -&gt; Int -&gt; Int \n    divisorCount numer denom counter \n        | numer `mod` denom == 0 = divisorCount (floor(numer / denom)) denom (counter+1)\n        | otherwise = -1\n</code></pre>\n"}, {"tags": ["haskell", "state", "monads", "lenses"], "comments": [{"owner": {"reputation": 675, "user_id": 485482, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aIf9p.png?s=128&g=1", "display_name": "Csongor Kiss", "link": "https://stackoverflow.com/users/485482/csongor-kiss"}, "edited": false, "score": 0, "creation_date": 1528968431, "post_id": 50853564, "comment_id": 88710818, "body": "Your example works on my machine. Which version of lens are you using?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528971229, "post_id": 50853564, "comment_id": 88712675, "body": "I suspect you have multiple versions of <code>transformers</code> installed, and GHC tries using a different one from that which <code>lens</code> was built against. This kind of problem can be avoided by adding a <code>yourproject.cabal</code> file (easiest done with <code>cabal init</code>) and then using <code>cabal build</code> for compiling your file instead of GHC directly. Cabal-install will make sure the dependencies have matching versions."}, {"owner": {"reputation": 249, "user_id": 4643591, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206103105435558/picture?type=large", "display_name": "Marius Catalin", "link": "https://stackoverflow.com/users/4643591/marius-catalin"}, "edited": false, "score": 0, "creation_date": 1530007096, "post_id": 50853564, "comment_id": 89071206, "body": "I&#39;m using the E.K big lens library"}], "answers": [{"comments": [{"owner": {"reputation": 611, "user_id": 9367559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mgpFwCPW8cw/AAAAAAAAAAI/AAAAAAAAAH4/EdHgRBgrxoE/photo.jpg?sz=128", "display_name": "Welperooni", "link": "https://stackoverflow.com/users/9367559/welperooni"}, "edited": false, "score": 0, "creation_date": 1528969193, "post_id": 50854276, "comment_id": 88711347, "body": "<a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Setter.html#v:-45--61-\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/lens-4.16.1/docs/&hellip;</a> It&#39;s re-exported in <code>Control.Lens</code> as well"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1528971493, "post_id": 50854276, "comment_id": 88712851, "body": "<code>mtl</code> is irrelevant here, as it is also built upon the <code>transformers</code> library and using the <code>StateT</code> type from there. It merely adds the <code>MonadState</code> class, which <code>transformers</code> doesn&#39;t have at all."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1528969446, "last_edit_date": 1592644375, "creation_date": 1528969054, "answer_id": 50854276, "question_id": 50853564, "link": "https://stackoverflow.com/questions/50853564/how-can-i-compile-for-ghc-8-4-2-code-that-uses-lenses-inside-statet-monad/50854276#50854276", "title": "How can I compile for ghc-8.4.2 code that uses lenses inside StateT monad", "body": "<p>There is more than one version of <code>StateT</code>. To find out which one you need you have to go to the Haddock docs for the problematic function (in this case <a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Setter.html\" rel=\"nofollow noreferrer\"><code>(-=)</code></a> and follow the links from its definition.</p>\n<p>There are two monad transformer packages, called &quot;<a href=\"http://hackage.haskell.org/package/mtl\" rel=\"nofollow noreferrer\"><em>mtl</em></a>&quot; and &quot;<a href=\"http://hackage.haskell.org/package/transformers\" rel=\"nofollow noreferrer\"><em>transformers</em></a>&quot;, so my first thought was that you might be using the wrong one. However when I followed the links from the <code>(-=)</code> operator I found myself in the <a href=\"http://hackage.haskell.org/package/adjunctions-4.4\" rel=\"nofollow noreferrer\">adjunctions</a> library, which is also by lens author <a href=\"https://github.com/ekmett\" rel=\"nofollow noreferrer\">Edward Kmett</a>.</p>\n<p>So to get <code>(-=)</code> and it's relatives, it looks like you have to import <a href=\"http://hackage.haskell.org/package/adjunctions-4.4/docs/Control-Monad-Representable-State.html#t:MonadState\" rel=\"nofollow noreferrer\"><code>Control.Monad.Representable.State</code></a> from <em>adjunctions</em>.</p>\n<p><strong>Edit</strong> Looking through the source for <code>Control.Monad.Representable.State</code> it seems to be re-exporting the <code>MonadState</code> class from the <em>transformers</em> library. So make sure that you are using that one rather than the <em>mtl</em>.</p>\n"}], "owner": {"reputation": 249, "user_id": 4643591, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206103105435558/picture?type=large", "display_name": "Marius Catalin", "link": "https://stackoverflow.com/users/4643591/marius-catalin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1528969446, "creation_date": 1528966752, "question_id": 50853564, "link": "https://stackoverflow.com/questions/50853564/how-can-i-compile-for-ghc-8-4-2-code-that-uses-lenses-inside-statet-monad", "title": "How can I compile for ghc-8.4.2 code that uses lenses inside StateT monad", "body": "<p>I tried to compile this small program from Gabriel Gonzales 2013 blog post \"Program imperatively using Haskell lenses\":</p>\n\n<pre><code> {-# LANGUAGE TemplateHaskell #-}\n\n    import Control.Lens \n    import Control.Monad.Trans.Class\n    import Control.Monad.Trans.State\n\n    data Game = Game\n      { _score :: Int\n      , _units :: [Unit]\n      , _boss  :: Unit\n      } deriving (Show)\n\n    data Unit = Unit\n      { _health   :: Int\n      , _position :: Point\n      } deriving (Show)    \n\n    data Point = Point\n      { _x :: Double\n      , _y :: Double\n      } deriving (Show)     \n\n    makeLenses ''Game\n    makeLenses ''Unit\n    makeLenses ''Point    \n\n    strike :: StateT Game IO ()\n    strike = do\n      lift $ putStrLn \"*shink*\"\n      boss.health -= 10\n</code></pre>\n\n<p>I get error:  No instance for (Control.Monad.State.Class.MonadStat Game (StateT Game IO)) arising from a use of \u2018-=\u2019</p>\n\n<p>What imports are required these days?</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1528964399, "post_id": 50852592, "comment_id": 88708316, "body": "Rather than <code>Applicative</code>, these looks more like isomorphisms in the vein of <a href=\"http://hackage.haskell.org/package/newtype-0.2/docs/Control-Newtype.html\" rel=\"nofollow noreferrer\"><code>Control.Newtype</code></a> and/or <a href=\"http://hackage.haskell.org/package/lens-4.16.1/docs/Control-Lens-Wrapped.html\" rel=\"nofollow noreferrer\"><code>Control.Lens.Wrapped</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 0, "last_activity_date": 1528968388, "creation_date": 1528968388, "answer_id": 50854055, "question_id": 50852592, "link": "https://stackoverflow.com/questions/50852592/looking-for-a-function-similar-sequencea/50854055#50854055", "title": "Looking for a function similar sequenceA", "body": "<p>The function you want would need to be of type:</p>\n\n<pre><code>somefn :: Applicative' t =&gt; (a -&gt; b) -&gt; (t a -&gt; t b)\nsomefn :: Applicative' t =&gt; (a -&gt; b -&gt; c) -&gt; (t a -&gt; t b -&gt; t c)\nsomefn :: Applicative' t =&gt; (a -&gt; b -&gt; c -&gt; d) -&gt; (t a -&gt; t b -&gt; t b -&gt; t c -&gt; t d)\n</code></pre>\n\n<p>But these is no type which encompasses all of these so no such function exists. In particular there is no way to decide whether <code>somefn (\\x y -&gt; (x, y)) (Box 3)</code> should be <code>Box (\\y -&gt; (3,y))</code> or <code>\\(Box y) -&gt; Box (3,y)</code>.</p>\n\n<p>Look at eg <code>liftA2</code> or <code>liftA3</code> for normal <code>Applicative</code>s.</p>\n"}, {"tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": true, "score": 4, "last_activity_date": 1528972496, "last_edit_date": 1528972496, "creation_date": 1528968575, "answer_id": 50854111, "question_id": 50852592, "link": "https://stackoverflow.com/questions/50852592/looking-for-a-function-similar-sequencea/50854111#50854111", "title": "Looking for a function similar sequenceA", "body": "<p>You are looking for the family of <code>liftA*</code> functions:</p>\n\n<pre><code>liftA :: Applicative f =&gt; (a -&gt; b) -&gt; f a -&gt; fb\nliftA2 :: Applicative f =&gt; (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\nliftA3 :: Applicative f =&gt; (a -&gt; b -&gt; d -&gt; e) -&gt; f a -&gt; f b -&gt; f c -&gt; f d\n</code></pre>\n\n<p>In Haskell these functions are defined separated. But I guess you want to generalize it to one function. That's impossible in Haskell since it would require to change the signature of your function. The Haskell approach is to sequence the operators <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> as follows:</p>\n\n<pre><code>liftA f a = f &lt;$&gt; a \nliftA2 f a b = f &lt;$&gt; a &lt;*&gt; b\nliftA3 f a b c = f &lt;$&gt; a &lt;*&gt; b &lt;*&gt; c\nliftA4 f a b c d = f &lt;$&gt; a &lt;*&gt; b &lt;*&gt; c &lt;*&gt; d -- (actually not pre-defined in haskell)\n.\n.\n.\nand so on\n</code></pre>\n\n<p>What is happening here is that <code>f &lt;$&gt; a</code> is lifting (pushing) your function within the Applicative container and then you sequence that function throughout <code>a</code>, <code>b</code>, <code>c</code> and <code>d</code>.</p>\n\n<p>Hope it helps.</p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 0, "last_activity_date": 1528998260, "creation_date": 1528998260, "answer_id": 50863164, "question_id": 50852592, "link": "https://stackoverflow.com/questions/50852592/looking-for-a-function-similar-sequencea/50863164#50863164", "title": "Looking for a function similar sequenceA", "body": "<p>As already noted in other answers, you can't write a function with the signature you desire. Instead, you can do something similar to what Applicative does, by defining analogues to the <code>(&lt;$&gt;)</code> and <code>(&lt;*&gt;)</code> operators.</p>\n\n<p>You can easily enough define these functions:</p>\n\n<pre><code>(&lt;@&gt;) :: Applicative' f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nf &lt;@&gt; x = pack . f . unpack $ x\n\n(&lt;%&gt;) :: Applicative' f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\nf &lt;%&gt; x = pack . unpack f . unpack $ x\n</code></pre>\n\n<p>so that you can then write</p>\n\n<pre><code>(\\x y z-&gt;x+y+z) &lt;@&gt; Box 1 &lt;%&gt; Box 2 &lt;%&gt; Box 3 -- results in Box 6\n</code></pre>\n\n<p>Or, if you don't mind enabling a couple extensions, you could take a different approach. Your Applicative' is a stronger constraint than Applicative, and so you can automatically derive Functor and Applicative instances for every Applicative' instance, getting you <code>(&lt;$&gt;)</code> and <code>(&lt;*&gt;)</code> for free:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances #-}\n\ninstance Applicative' f =&gt; Functor f where\n  fmap f x = pack . f . unpack $ x\n\ninstance Applicative' f =&gt; Applicative f where\n  pure = pack\n  f &lt;*&gt; x = pack . unpack f . unpack $ x\n</code></pre>\n\n<p>Now we can write </p>\n\n<pre><code>(\\x y z-&gt;x+y+z) &lt;$&gt; Box 1 &lt;*&gt; Box 2 &lt;*&gt; Box 3 -- results in Box 6\n</code></pre>\n\n<p>and, happily, we also gain access to the <code>liftA</code> family of functions, meaning that for a reasonably small number of arguments, you can in fact use a function equivalent to the one you wanted:</p>\n\n<pre><code>import Control.Applicative (liftA3)\n\nliftA3 (\\x y z-&gt;x+y+z) (Box 1) (Box 2) (Box 3) -- results in Box 6\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1529214135, "creation_date": 1529214135, "answer_id": 50894024, "question_id": 50852592, "link": "https://stackoverflow.com/questions/50852592/looking-for-a-function-similar-sequencea/50894024#50894024", "title": "Looking for a function similar sequenceA", "body": "<p>You <em>can</em> unify these things. We'll need a heterogeneous list representing some type constructor mapped over a list of types:</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, PolyKinds, TypeOperators, PatternSynonyms #-}\n\nimport Data.Kind (Type)\nimport Data.Functor.Identity\n\ninfixr 4 :&lt;, ::&lt;\ndata Rec :: [k] -&gt; (k -&gt; Type) -&gt; Type where\n  Nil :: Rec '[] f\n  (:&lt;) :: f x -&gt; Rec xs f -&gt; Rec (x ': xs) f\n\n-- For convenience and clarity:\ntype HList xs = Rec xs Identity\n\npattern HNil :: () =&gt; xs ~ '[] =&gt; HList xs\npattern HNil = Nil\n\npattern (::&lt;) :: () =&gt; xxs ~ (x ': xs) =&gt; x -&gt; HList xs -&gt; HList xxs\npattern x ::&lt; xs = Identity x :&lt; xs\n\n{-# COMPLETE HNil, (::&lt;) #-}\n</code></pre>\n\n<p>Now we can express our version of <code>Applicative</code>:</p>\n\n<pre><code>class Appl f where\n  appl :: (HList xs -&gt; r) -&gt; Rec xs f -&gt; f r\n</code></pre>\n\n<p>We can define <code>appl</code> in terms of <code>Applicative</code>:</p>\n\n<pre><code>applApplic :: Applicative f =&gt; (Rec xs Identity -&gt; r) -&gt; Rec xs f -&gt; f r\napplApplic f xs0 = f &lt;$&gt; gather xs0\n  where\n    gather :: Applicative f =&gt; Rec xs f -&gt; f (Rec xs Identity)\n    gather Nil = pure HNil\n    gather (x :&lt; xs) = (\\y ys -&gt; y ::&lt; ys) &lt;$&gt; x &lt;*&gt; gather xs\n</code></pre>\n\n<p>We can also define the <code>Applicative</code> methods using <code>appl</code>:</p>\n\n<pre><code>fmapAppl :: Appl f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nfmapAppl f xs = appl (\\(q ::&lt; HNil) -&gt; f q) (xs :&lt; Nil)\n\npureAppl :: Appl f =&gt; a -&gt; f a\npureAppl x = appl (\\HNil -&gt; x) Nil\n\nliftA2Appl :: Appl f =&gt; (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\nliftA2Appl f xs ys = appl (\\(x ::&lt; y ::&lt; HNil) -&gt; f x y) (xs :&lt; ys :&lt; Nil)\n</code></pre>\n\n<p>You can use <code>appl</code> as a sort of n-ary lift:</p>\n\n<pre><code>appl (\\(x ::&lt; y ::&lt; z ::&lt; HNil) -&gt;\n       x : y ++ z) (readLn @Int :&lt; readLn @[Int] :&lt; readLn @[Int] :&lt; Nil)\n</code></pre>\n\n<p>Type inference, unfortunately, is not great here.</p>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 50854111, "answer_count": 4, "score": 0, "last_activity_date": 1529214135, "creation_date": 1528963678, "last_edit_date": 1528964107, "question_id": 50852592, "link": "https://stackoverflow.com/questions/50852592/looking-for-a-function-similar-sequencea", "title": "Looking for a function similar sequenceA", "body": "<p>Tying to learn more about applicatives. </p>\n\n<p>I have the following definitions:</p>\n\n<pre><code>class Applicative' f where\n    pack :: a -&gt; f a\n    unpack :: f a -&gt; a\n\ninstance Applicative' Box where\n    pack x = Box x\n    unpack (Box x) = x\n\ninstance Applicative' Bag where\n    pack x = Bag x\n    unpack (Bag x) = x\n\ninstance Applicative' Basket where\n    pack x = Basket x\n    unpack (Basket x) = x\n\npack1::(Applicative' f)=&gt;(a-&gt;b)-&gt;f a-&gt;f b\npack1 fn ta = pack (fn (unpack ta))\n\npack2::(Applicative' f)=&gt;(a-&gt;b-&gt;c)-&gt;f a-&gt;f b-&gt;f c\npack2 fn ta tb = pack(fn (unpack ta) (unpack tb))\n</code></pre>\n\n<p>What I am looking for is a way generalise this concept (something similar to sequenceA function), so it should possible to use this function (lets call it someFn) the following way:</p>\n\n<pre><code>somefn (\\x-&gt;x+1) (Box 2)\nBox 3\n\nsomefn (\\x-&gt;\\y-&gt;x+y) (Box 1) (Box 2)\nBox 3\n\nsomefn (\\x-&gt;\\y-&gt;\\z-&gt;x+y+z) (Box 1) (Box 2) (Box 3)\nBox 6\n</code></pre>\n\n<p>Not sure how I can achieve this in Haskell.</p>\n"}, {"tags": ["haskell", "pointfree"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1528963869, "post_id": 50852498, "comment_id": 88708000, "body": "Do you mean completely point-free? The only completely point-free example you have given is the last one."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1528963945, "post_id": 50852498, "comment_id": 88708049, "body": "Yes, can you do it completely point-free?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1528963977, "post_id": 50852498, "comment_id": 88708064, "body": "What are you intending the last three examples to do? They only take 2 arguments, according to the type signatures."}, {"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1528964054, "post_id": 50852498, "comment_id": 88708109, "body": "I edited i am sorry !"}], "answers": [{"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1528965409, "post_id": 50852623, "comment_id": 88708918, "body": "Thank you for your answer sir !"}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": false, "score": 3, "last_activity_date": 1528965465, "last_edit_date": 1528965465, "creation_date": 1528963796, "answer_id": 50852623, "question_id": 50852498, "link": "https://stackoverflow.com/questions/50852498/point-free-style-with-infix-notation/50852623#50852623", "title": "Point free style with infix notation", "body": "<p>You must compose <code>(+)</code> with <code>(+)</code> twice, for it to be completely point-free: <code>f = ((+) .) . (+)</code></p>\n\n<p>Recall that composition is defined as</p>\n\n<pre><code>(f . g) x = f (g x)\n</code></pre>\n\n<p>or, equivalently:</p>\n\n<pre><code>(f . g) = \\x -&gt; f (g x)\n</code></pre>\n\n<p>So, if you look at the composition <code>f = ((+) .) . (+)</code> and work backwards using the definition of <code>(.)</code>:</p>\n\n<pre><code>f       = ((+) .) . (+)\nf       = \\x -&gt; ((+) .) ((+) x)          -- definition of (.)\nf       = \\y -&gt; (\\x -&gt; (+) (((+) x) y))  -- definition of (.)\nf x y   = (+) (((+) x) y)                -- a simpler way to write this\nf x y z = (+) (((+) x) y) z              -- explicitly add in the final argument (eta expansion)\nf x y z = ((+) x y) + z                  -- rewrite as infix\nf x y z = (x + y) + z                    -- rewrite as infix\n</code></pre>\n\n<p>and you see we end up with what we started before we tried to make it point-free, so we know that this definition works. Going the other way through the steps above, roughly bottom-to-top, could give you an idea of how you might find such a point-free definition of a function like <code>f</code>.</p>\n\n<p>When you \"leave off\" multiple arguments from the \"end\" like this, you usually must compose multiple times. Working through a few similar functions should help build intuition for this.</p>\n\n<p>Note: I wouldn't generally recommend using this sort of point-free (when it complicates things) in production code.</p>\n"}, {"comments": [{"owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "edited": false, "score": 0, "creation_date": 1528965425, "post_id": 50852750, "comment_id": 88708928, "body": "Thank you for your answer !"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1528965454, "last_edit_date": 1528965454, "creation_date": 1528964254, "answer_id": 50852750, "question_id": 50852498, "link": "https://stackoverflow.com/questions/50852498/point-free-style-with-infix-notation/50852750#50852750", "title": "Point free style with infix notation", "body": "<p>Well since you need to pass <em>two</em> parameters, we can use what is known as the \"<em>surprised owl operator</em>\". This is basically a composition of parameters. So we can use:</p>\n\n<pre><code>f = <b>((.).(.))</b> (+) (+)</code></pre>\n\n<p>Or we can more inline the operator like:</p>\n\n<pre><code>f = ((+) .) . (+)</code></pre>\n\n<p>The owl operator <code>((.).(.)) f g</code> basically is short for <code>\\x y -&gt; f (g x y)</code></p>\n\n<p><strong>How does this work?</strong></p>\n\n<p>The canonical form of the \"<em>surprised owl operator</em>\" is:</p>\n\n<pre><code>= ((.) . (.))\n------------- (canonical form)\n  (.) (.) (.)\n</code></pre>\n\n<p>So we can now replace the <code>(.)</code>s with corresponding lambda expressions:</p>\n\n<pre><code>(\\f g x -&gt; f (g x)) (.) (.)\n</code></pre>\n\n<p>So now we can perform some replacements:</p>\n\n<pre><code>   (\\f g x -&gt; f (g x)) (.) (.)\n-&gt; (\\x -&gt; (.) ((.) x))\n-&gt; (\\x -&gt; (\\q r y -&gt; q (r y)) ((.) x))\n-&gt; (\\x -&gt; (\\r y -&gt; ((.) x) (r y)))\n-&gt; (\\x r y -&gt; ((.) x) (r y))\n-&gt; (\\x r y -&gt; ((\\s t u -&gt; s (t u)) x) (r y))\n-&gt; (\\x r y -&gt; (\\t u -&gt; x (t u)) (r y))\n-&gt; (\\x r y -&gt; (\\u -&gt; x ((r y) u)))\n-&gt; \\x r y u -&gt; x ((r y) u))\n-&gt; \\x r y u -&gt; x (r y u)\n</code></pre>\n\n<p>So basically it means that our surprised owl operator, is equal to:</p>\n\n<pre><code>surprised_owl :: (y -&gt; z) -&gt; (a -&gt; b -&gt; y) -&gt; a -&gt; b -&gt; z\nsurprised_owl f g x y = f (g x y)  -- renamed variables\n</code></pre>\n\n<p>And if we now specialize this with the fuctions provided (two times <code>(+)</code>), we get:</p>\n\n<pre><code>f = surprised_owl (+) (+)\n</code></pre>\n\n<p>so:</p>\n\n<pre><code>f x y = (+) ((+) x y)\n</code></pre>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 1, "accepted_answer_id": 50852750, "answer_count": 2, "score": 3, "last_activity_date": 1528965465, "creation_date": 1528963354, "last_edit_date": 1528964043, "question_id": 50852498, "link": "https://stackoverflow.com/questions/50852498/point-free-style-with-infix-notation", "title": "Point free style with infix notation", "body": "<p>Hello is there a way to write point free style when using infix notation?</p>\n\n<pre><code>f::Int-&gt;Int-&gt;Int-&gt;Int\nf a b=(+) (a+b)\n</code></pre>\n\n<p>Why you cannot do something like this ? <br></p>\n\n<pre><code> f::Int-&gt;Int-&gt;Int-&gt;Int\n f a b=(a+b) +\n\n      or\n\n f a b= (a+b) `+`\n</code></pre>\n\n<p>Can you not combine operators in point free style like e.g? </p>\n\n<pre><code>ptfree::Int-&gt;Int-&gt;Int-&gt;Int\nptfree=(+) (+)\n</code></pre>\n\n<p>I mean you can chop arguments of functions like <code>fold</code> but why not for operator arguments?</p>\n"}, {"tags": ["haskell", "asynchronous", "concurrency"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1528963152, "post_id": 50849206, "comment_id": 88707502, "body": "Unrelated: you should not import <code>Internal</code> modules. In this case, you can import <code>Data.List.Split</code> instead."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1529009169, "post_id": 50849206, "comment_id": 88733790, "body": "See this answer <a href=\"https://stackoverflow.com/a/29155440/1364288\">stackoverflow.com/a/29155440/1364288</a> for another approach that doesn&#39;t involve chunking."}], "answers": [{"tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": true, "score": 2, "last_activity_date": 1528958131, "last_edit_date": 1528958131, "creation_date": 1528957538, "answer_id": 50850901, "question_id": 50849206, "link": "https://stackoverflow.com/questions/50849206/a-list-of-actions-effected-concurrently-in-parts/50850901#50850901", "title": "A list of actions effected concurrently in parts", "body": "<p>I'm a bit curious as to what you tried with <code>waitFor</code>. Here's my first attempt:</p>\n\n<pre><code>import System.Process\n\ncommands = [\"./demo.sh \" ++ show n | n &lt;- [1..10]]\n\nchunksOf _ [] = []\nchunksOf n xs = take n xs : chunksOf n (drop n xs)\n\nspawn cmd = do\n  (_,_,_,proc) &lt;- createProcess (shell cmd)\n  return proc\n\nspawnAndAwaitGroup cmds = do\n  procs &lt;- mapM spawn cmds\n  mapM_ waitForProcess procs\n\nmain = do\n  mapM_ spawnAndAwaitGroup (chunksOf 3 commands)\n</code></pre>\n\n<p>Note how the IO actions are composed; the waits need to fit between spawns, so we apply both operations at a chunk level. We could have created the <code>spawn</code> actions en masse, but <code>waitForProcess</code> requires the returned handles. Thus I used <code>mapM</code> and the <code>do</code> <code>&lt;-</code>. </p>\n\n<p>Test run using this in <code>demo.sh</code>:</p>\n\n<pre><code>#!/bin/sh\necho $1 starting\nsleep 3\necho $1 ending\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2 starting\n1 starting\n3 starting\n3 ending\n1 ending\n2 ending\n4 starting\n5 starting\n6 starting\n4 ending\n5 ending\n6 ending\n7 starting\n8 starting\n9 starting\n7 ending\n8 ending\n9 ending\n10 starting\n10 ending\n</code></pre>\n\n<p>Of note, this is a purely sequential program, not concurrent at the Haskell level. It's equivalent to this shell script:</p>\n\n<pre><code>./demo.sh 1 &amp;\n./demo.sh 2 &amp;\n./demo.sh 3 &amp;\nwait\n./demo.sh 4 &amp;\n./demo.sh 5 &amp;\n./demo.sh 6 &amp;\nwait\n./demo.sh 7 &amp;\n./demo.sh 8 &amp;\n./demo.sh 9 &amp;\nwait\n./demo.sh 10 &amp;\nwait\n</code></pre>\n\n<p>All the concurrent behaviour happens at OS level, in the interaction of the spawned processes. </p>\n"}], "owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 50850901, "answer_count": 1, "score": 1, "last_activity_date": 1528958131, "creation_date": 1528947136, "question_id": 50849206, "link": "https://stackoverflow.com/questions/50849206/a-list-of-actions-effected-concurrently-in-parts", "title": "A list of actions effected concurrently in parts", "body": "<p>I have a list of strings that represent shell commands, and I would like to execute, say, 10 at a time concurrently.  This is my first real foray into concurrent programming in Haskell, and I'm having some trouble.  </p>\n\n<p>My thought was to chunk the list into sublists of ten elements, and then <code>mapM_</code> a function that spawns each of the ten commands at the same time, waiting for each to finish before moving on to the next group of ten.  Yet every different library/approach I use/take seems to just launch every command in the list at the same time.  </p>\n\n<p>Suppose I have the most simple function to execute a shell command:</p>\n\n<pre><code>import System.Process    \n\nexecShellCommand :: String -&gt; IO ()\nexecShellCommand cmd = void $ createProcess (shell cmd)\n</code></pre>\n\n<p>The naive approach</p>\n\n<pre><code>import Control.Monad\nimport Data.List.Split.Internals\n\nrunChunks :: [String] -&gt; IO ()\nrunChunks as = mapM_ (mapM_ execShellCommand) $ chunksOf 10 as\n</code></pre>\n\n<p>executes all the commands in the list at once (I've tried using the <code>waitFor</code> functions from Conduit.Process, with similar outcome).  Let's try to be a bit more thoughtful, and redefine the function <code>execShellCommand</code> to use <code>Control.Concurrent</code>:</p>\n\n<pre><code>import Control.Concurrent\n\nexecShellCommand :: String -&gt; IO ()\nexecShellCommand cmd = do\n  m &lt;- newEmptyMVar\n  r &lt;- void $ createProcess (shell cmd)\n  forkIO $ putMVar m r\n  takeMVar m\n\nrunChunks :: [String] -&gt; IO ()\nrunChunks [] = return ()\nrunChunks as = do\n  mapM_ execShellCommand $ take 10 as\n  runChunks $ drop 10 as\n</code></pre>\n\n<p>also does the same thing (runs all commands in the list at once).  Yet another library with the same outcome:</p>\n\n<pre><code>import Control.Concurrent.Async\n\nrunChunks :: [String] -&gt; IO ()\nrunChunks [] = return ()\nrunChunks as = do\n  ck &lt;- mapM (async . execShellCommand) $ take 10 as\n  mapM_ wait ck\n  runChunks $ drop 10 as\n</code></pre>\n\n<p>I'm either not grasping a concept here, in which case I would very much appreciate a clarifying explanation, or I've just not seen a library function that can achieve the effect I'm aiming for; for the latter, an example would be extremely helpful.  Thank you so much in advance.</p>\n"}]