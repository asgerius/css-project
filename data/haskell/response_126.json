[{"tags": ["haskell", "symbols", "declarative", "imperative-programming", "declarative-programming"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1496870409, "post_id": 44422837, "comment_id": 75844352, "body": "Oh yes, if you don&#39;t allow to promote the interface to monadic (as in your no. 2), then imperative languages can express all sorts of abstractions that declarative languages can&#39;t.  For example, the abstraction of a mutable variable."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 6, "creation_date": 1496871413, "post_id": 44422837, "comment_id": 75844805, "body": "observe that if you don&#39;t implement interning correctly, that you will lose referential transparency.  E.g. if you exposed the interned id, it will depend on evaluation order. Say, if you serialized your symbols, your file output might change due to what should have been correct refactors.  So when I&#39;m in rigorous mind, I say <i>that dependency must be modeled accurately</i> -- promote to a monad or other structure that captures those effects.  When I&#39;m in practical mind, sidestep transparency, throw caution to the wind, and use <code>unsafePerformIO</code>, hoping I did it right."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 9, "creation_date": 1496871585, "post_id": 44422837, "comment_id": 75844856, "body": "It seems as though you want to have your cake and eat it too -- you want to use an abstraction which is not guaranteed to be pure as if it were guaranteed to be pure."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1496876275, "post_id": 44422837, "comment_id": 75846514, "body": "See <a href=\"https://hackage.haskell.org/package/intern\" rel=\"nofollow noreferrer\">this package</a> for an example of packaging up the unsafe code in a safe interface. At the end of the day, strong type systems are supposed to <i>limit</i> the number of programs accepted by the compiler (even correct ones). The interesting followup question would really be: &quot;are there problems for which Haskell&#39;s type system prevents me from making a solution as efficient at runtime as language X&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1496876035, "creation_date": 1496876035, "answer_id": 44424010, "question_id": 44422837, "link": "https://stackoverflow.com/questions/44422837/interning-strings-in-declarative-programming/44424010#44424010", "title": "Interning strings in declarative programming", "body": "<p>The <a href=\"http://hackage.haskell.org/package/intern-0.9.1.4\" rel=\"nofollow noreferrer\">intern package</a> shows how. As discussed by @luqui, it uses <code>unsafePerformIO</code> at a few key moments, and is careful to hide the identifiers produced during interning.</p>\n"}], "owner": {"reputation": 396, "user_id": 3845125, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6024c284f7eaf2b21972554a44bc8f9f?s=128&d=identicon&r=PG&f=1", "display_name": "while1fork", "link": "https://stackoverflow.com/users/3845125/while1fork"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1496876035, "creation_date": 1496869891, "last_edit_date": 1496870299, "question_id": 44422837, "link": "https://stackoverflow.com/questions/44422837/interning-strings-in-declarative-programming", "title": "Interning strings in declarative programming", "body": "<p>The following scenario shows an abstraction that seems to me to be impossible to implement declaratively.</p>\n\n<p>Suppose that I want to create a Symbol object which allows you to create objects with strings that can be compared, like <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/for\" rel=\"nofollow noreferrer\">Symbol.for() in JavaScript</a>. A simple implementation in JS might look like this:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>function MySymbol(text){//Comparable symbol object class\n  this.text = text;\n  this.equals = function(other){//Method to compare to other MySymbol\n    return this.text == other.text;\n  }\n}\n</code></pre>\n\n<p>I could easily write this in a declarative language like Haskell:\n</p>\n\n<pre><code>data MySymbol = MySymbol String\n\nmakeSymbol :: String -&gt; MySymbol\nmakeSymbol s = MySymbol s\n\ncompareSymbol :: MySymbol -&gt; MySymbol -&gt; Bool\ncompareSymbol (MySymbol s1) (MySymbol s2) = s1 == s2\n</code></pre>\n\n<p>However, maybe in the future I want to improve efficiency by using a global registry <strong>without changing the interface</strong> to the MySymbol objects. (The user of my class doesn't need to know that I've changed it to use a registry)</p>\n\n<p>For example, this is easily done in Javascript:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>function MySymbol(text){\n  if (MySymbol.registry.has(text)){//check if symbol already in registry\n    this.id = MySymbol.registry.get(text);//get id\n  } else {\n    this.id = MySymbol.nextId++;\n    MySymbol.registry.set(text, this.id);//Add new symbol with nextId\n  }\n  this.equals = function(other){//To compare, simply compare ids\n    return this.id == other.id;\n  }\n}\n//Setup initial empty registry\nMySymbol.registry = new Map();//A map from strings to numbers\nMySymbol.nextId = 0;\n</code></pre>\n\n<p>However, it is impossible to create a mutable global registry in Haskell. (I can create a registry, but not without changing the interface to my functions.)</p>\n\n<hr>\n\n<p>Specifically, these three possible Haskell solutions all have problems:</p>\n\n<ol>\n<li>Force the user to pass a registry argument or equivalent, making the interface implementation dependent</li>\n<li>Use some fancy Monad stuff like Haskell's <a href=\"http://hackage.haskell.org/package/MonadRandom-0.1.1/docs/Control-Monad-Random.html\" rel=\"nofollow noreferrer\">Control.Monad.Random</a>, which would require either foreseeing the optimization from the start or changing the interface (and is basically just adding the concept of state into your program and therefore breaks referential transparency etc.)</li>\n<li>Have a slow implementation which might not be practical in a given application</li>\n</ol>\n\n<p>None of these solutions allow me to sufficiently abstract away implementation from my Haskell interface. </p>\n\n<p><strong>So, my question is:</strong> Is there a way to implement this optimization to a Symbol object in Haskell (or any declarative language) without causing one of the three problems listed above,\nand are there any other situations where an imperative language can express an abstraction (for example an optimization like above) that a declarative language can't?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1496869711, "post_id": 44422754, "comment_id": 75844053, "body": "does that typecheck?"}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496869738, "post_id": 44422754, "comment_id": 75844066, "body": "No, <code>singleItemLists :: [[t]] -&gt; [t]</code> can&#39;t be unified with <code>singleItemLists :: [[Int]] -&gt; [[Int]]</code>"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1496870023, "post_id": 44422754, "comment_id": 75844186, "body": "Now try <code>[p | p@[x] &lt;- xs]</code> on the right hand side."}], "tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 3, "last_activity_date": 1496869817, "last_edit_date": 1496869817, "creation_date": 1496869531, "answer_id": 44422754, "question_id": 44422753, "link": "https://stackoverflow.com/questions/44422753/filter-a-list-by-pattern-matching/44422754#44422754", "title": "Filter a list by pattern matching", "body": "<p>One way to do it is with a list comprehension</p>\n\n<pre><code>singleItemLists :: [[Int]] -&gt; [[Int]]\nsingleItemLists xs = [[x] | [x] &lt;- xs]\n</code></pre>\n\n<p>It can be argued that this isn't clear, as it's not explicit that lists of length other than 1 are dropped.</p>\n"}, {"tags": [], "owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "is_accepted": false, "score": 5, "last_activity_date": 1496870244, "creation_date": 1496870244, "answer_id": 44422916, "question_id": 44422753, "link": "https://stackoverflow.com/questions/44422753/filter-a-list-by-pattern-matching/44422916#44422916", "title": "Filter a list by pattern matching", "body": "<p>The idiomatic version based on explicit pattern matching and <code>filter</code> is:</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\n\nisSingleton :: [x] -&gt; Bool\nisSingleton = \\case [_] -&gt; True ; _ -&gt; False;\n\nsingletonLists :: [[x]] -&gt; [[x]]\nsingletonLists = filter isSingleton\n</code></pre>\n\n<p>I believe this is more readable. As an added advantage, we get <code>isSingleton</code>, which can be reused for other purposes.</p>\n\n<p><code>isSingleton</code> is lazy in the spine and elements of the inner lists.</p>\n"}, {"tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 0, "last_activity_date": 1496870526, "creation_date": 1496870526, "answer_id": 44422984, "question_id": 44422753, "link": "https://stackoverflow.com/questions/44422753/filter-a-list-by-pattern-matching/44422984#44422984", "title": "Filter a list by pattern matching", "body": "<p>You can use the list monad's <code>&gt;&gt;=</code> implementation to do this</p>\n\n<pre><code>singleItemLists :: [[Int]] -&gt; [[Int]]\nsingleItemLists xs = xs &gt;&gt;= (\\xs -&gt; case xs of [x] -&gt; [[x]]; _ -&gt; [])\n</code></pre>\n\n<p>As an example of filtering by pattern matching, this is a bit confusing, as it's not clear what that pattern is, and what's need to use the list monad's <code>&gt;&gt;=</code>.</p>\n\n<p>A example that might be clearer would be to filter a lists of <code>Maybe Int</code> to just keep the <code>Just</code> values</p>\n\n<pre><code>justJusts :: [Maybe Int] -&gt; [Maybe Int]\njustJusts xs = xs &gt;&gt;= \\x -&gt; case x of Just x -&gt; [Just x]; _ -&gt; []\n</code></pre>\n\n<hr>\n\n<p>Thanks to a comment from <a href=\"https://codereview.stackexchange.com/users/62002/centril\">https://codereview.stackexchange.com/users/62002/centril</a> at <a href=\"https://codereview.stackexchange.com/a/164380/34049\">https://codereview.stackexchange.com/a/164380/34049</a></p>\n"}], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1235, "favorite_count": 1, "answer_count": 3, "score": 2, "last_activity_date": 1496870526, "creation_date": 1496869531, "question_id": 44422753, "link": "https://stackoverflow.com/questions/44422753/filter-a-list-by-pattern-matching", "title": "Filter a list by pattern matching", "body": "<p>How can I filter a list, keeping the items that match a pattern, removing ones that don't?</p>\n\n<p>For example, if I have a list of lists, I would like a function...</p>\n\n<pre><code>singleItemLists :: [[Int]] -&gt; [[Int]]\n</code></pre>\n\n<p>... to remove all items that don't match the pattern <code>[x]</code>.</p>\n\n<p>Ideally, answers should be fairly straightforward to convert to other patterns.</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496862170, "post_id": 44420789, "comment_id": 75840050, "body": "Link to the article?"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496862291, "post_id": 44420789, "comment_id": 75840112, "body": "The article is from this book <a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">haskellbook.com</a>."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496862367, "post_id": 44420789, "comment_id": 75840161, "body": "I copied the article, please consider it."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1496862767, "post_id": 44420789, "comment_id": 75840372, "body": "&quot;Haskell has native recursion ability&quot; seems to be the key bit."}], "answers": [{"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1496865058, "creation_date": 1496865058, "answer_id": 44421615, "question_id": 44420789, "link": "https://stackoverflow.com/questions/44420789/support-native-recursion/44421615#44421615", "title": "Support native recursion", "body": "<blockquote>\n  <p>The above code does not conform to the <code>Y combinator</code> principle, because applyTimes is called in function body itself and it does not defined before.</p>\n</blockquote>\n\n<p>What about something like this?</p>\n\n<pre><code>fix :: (a -&gt; a) -&gt; a\nfix f = f (fix f)\n\napplyTimes :: (Eq a, Num a) =&gt; a -&gt; (b -&gt; b) -&gt; b -&gt; b\napplyTimes n f b = fix go n where\n\n  go rec n = if n == 0 then b\n             else f (rec (n - 1))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496888783, "post_id": 44422842, "comment_id": 75849625, "body": "&quot;Internally, the compiler could rewrite these using a fixed-point combinator (<code>fix</code>), for example as a simplification before typechecking, but I\u2019m not aware if it actually does this.&quot; That would be a considerable <i>complexification</i>, and I have no idea how it would work. Certainly, <code>let</code> cannot always be translated to lambda in <i>Haskell</i>, although it&#39;s likely possible in the impredicative System FC of GHC Core. GHC certainly doesn&#39;t perform such a translation anywhere; it uses <code>let</code> and <code>letrec</code> forms up until code generation."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1496901496, "post_id": 44422842, "comment_id": 75853310, "body": "Could you explain more about <code>let bindings</code>?"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 2, "last_activity_date": 1496870378, "last_edit_date": 1496870378, "creation_date": 1496869910, "answer_id": 44422842, "question_id": 44420789, "link": "https://stackoverflow.com/questions/44420789/support-native-recursion/44422842#44422842", "title": "Support native recursion", "body": "<p>\u201cNative recursion\u201d just means that Haskell has recursion as a \u201cnative\u201d (built-in) language feature, in the form of recursive definitions and <code>let</code> bindings:</p>\n\n<pre><code>-- Recursive definition\nmap f (x : xs) = f x : map f xs\n                       ---\nmap _ [] = []\n\n-- Recursive \u201clet\u201d binding\nmain = let ones = 1 : ones in print (take 10 ones)\n                      ----\n</code></pre>\n\n<p>Internally, the compiler <em>could</em> rewrite these using a fixed-point combinator (<code>fix</code>), for example as a simplification before typechecking, but I\u2019m not aware if it actually does this.</p>\n\n<pre><code>map f xs = let\n  map' k (x : xs) = f x : k xs\n  map' _ [] = []\n  in fix map' xs\n\nmain = let\n  ones = fix ones'\n  ones' k = 1 : k\n  in print (take 10 ones)\n</code></pre>\n\n<p>In Haskell, the fixed-point combinator is implemented using the native support for recursive bindings:</p>\n\n<pre><code>-- Na\u00efve implementation\nfix f = f (fix f)\n\n-- Optimisation to improve sharing\nfix f = let x = f x in x\n</code></pre>\n\n<p>And any recursive function can be expressed using <code>fix</code>:</p>\n\n<pre><code>applyTimes :: (Eq a, Num a) =&gt; a -&gt; (b -&gt; b) -&gt; b -&gt; b\napplyTimes 0 f b = b\napplyTimes n f b = f (applyTimes (n-1) f b)\n\napplyTimes n f b = let\n  applyTimes' _ 0 = b\n  applyTimes' k n = f (k (n - 1))\n  in fix applyTimes' n\n</code></pre>\n\n<p>Note that <em>without</em> native recursion, the Y combinator <code>\\ f -&gt; (\\ x -&gt; f (x x)) (\\ x -&gt; f (x x))</code> can\u2019t be expressed in simply typed lambda calculus because there is no type for <code>x</code> that would allow it to be a function taking <code>x</code> as an argument. Specifically, it fails the \u201coccurs check\u201d: if <code>x</code> is a function then it must have a type of the form <code>a -&gt; b</code>, but if <code>x</code> is passed as an argument to <code>x</code> then it must have the type <code>a</code>. Clearly <code>a</code> cannot equal <code>a -&gt; b</code> because <code>a</code> occurs in <code>a -&gt; b</code>, so it would expand infinitely: <code>a -&gt; b</code>, <code>(a -&gt; b) -&gt; b</code>, <code>((a -&gt; b) -&gt; b) -&gt; b</code>, and so on.</p>\n\n<p>While Haskell\u2019s type system is more powerful than STLC, it\u2019s typical for typed functional languages to offer recursion as a primitive part of the language rather than with a fixed-point combinator.</p>\n"}, {"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1496901390, "post_id": 44422877, "comment_id": 75853251, "body": "Could you please explain &quot;letrec&quot; and &quot;let&quot;?"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1496870053, "creation_date": 1496870053, "answer_id": 44422877, "question_id": 44420789, "link": "https://stackoverflow.com/questions/44420789/support-native-recursion/44422877#44422877", "title": "Support native recursion", "body": "<p>\"Native recursion\" means the language itself supports recursive definitions. Unlike the bare-bones lambda calculus, where all terms are anonymous, Haskell does have a way to name expressions; and moreover when giving a definition for a name, you may use that name itself. You observed this yourself: while defining <code>applyTimes</code> you used the name <code>applyTimes</code>, and consequently took advantage of Haskell's native support for recursion.</p>\n\n<p>You could also imagine a different language which supported named expressions but not recursion; indeed many functional languages have distinguished \"letrec\" and \"let\" forms for definitions which are recursive and which are not recursive, respectively. In such a language, your definition for <code>applyTimes</code> would be rejected if it used the \"let\" form, and accepted if it used the \"letrec\" form.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1496870378, "creation_date": 1496862024, "last_edit_date": 1496862340, "question_id": 44420789, "link": "https://stackoverflow.com/questions/44420789/support-native-recursion", "title": "Support native recursion", "body": "<p>I read an article about recursion in Haskell that says:  </p>\n\n<blockquote>\n  <p>But the lambda calculus does not appear on the surface to have any\n  means of recursion, because of the anonymity of expressions. How do\n  you call something without a name? Being able to write recursive\n  functions, though, is essential to Turing completeness. We use a\n  combinator \u2013 known as the Y combinator or fixed-point combinator \u2013 to\n  write recursive functions in the lambda calculus. Haskell has native\n  recursion ability based on the same principle as the Y combinator.</p>\n</blockquote>\n\n<p>What does native recursion mean?   </p>\n\n<p>Consider following code snippet: </p>\n\n<pre><code>applyTimes :: (Eq a, Num a) =&gt; a -&gt; (b -&gt; b) -&gt; b -&gt; b\napplyTimes 0 f b = b\napplyTimes n f b = f (applyTimes (n-1) f b)\n</code></pre>\n\n<p>The above code does not conform <code>Y combinator</code> principle, because <code>applyTimes</code> is called in function body itself and it does not defined before.<br>\nPlease proof my answer, if I wrong. </p>\n"}, {"tags": ["list", "haskell", "types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496861346, "post_id": 44420523, "comment_id": 75839584, "body": "Sort of... What is the type of <code>func</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 611, "user_id": 3698170, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a7bb9870ae150c48d6d20f9203675031?s=128&d=identicon&r=PG&f=1", "display_name": "FutureShocked", "link": "https://stackoverflow.com/users/3698170/futureshocked"}, "edited": false, "score": 0, "creation_date": 1496862404, "post_id": 44420768, "comment_id": 75840180, "body": "This is exactly what I was looking for! Thanks!"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 611, "user_id": 3698170, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a7bb9870ae150c48d6d20f9203675031?s=128&d=identicon&r=PG&f=1", "display_name": "FutureShocked", "link": "https://stackoverflow.com/users/3698170/futureshocked"}, "edited": false, "score": 0, "creation_date": 1496862786, "post_id": 44420768, "comment_id": 75840388, "body": "@FutureShocked I think Alec&#39;s answer is much better. You should accept it instead of mine."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 3, "last_activity_date": 1496861940, "creation_date": 1496861940, "answer_id": 44420768, "question_id": 44420523, "link": "https://stackoverflow.com/questions/44420523/can-i-build-a-list-of-strings-using-each-constructor-of-a-class/44420768#44420768", "title": "Can I build a list of Strings using each constructor of a class?", "body": "<p>You could, perhaps, do something like this:</p>\n\n<pre><code>data Class = Class1 | Class2 | Class3 deriving (Show, Eq, Enum)\n</code></pre>\n\n<p>GHCI:</p>\n\n<pre><code>Prelude&gt; fmap show $ enumFrom Class1\n[\"Class1\",\"Class2\",\"Class3\"]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 611, "user_id": 3698170, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a7bb9870ae150c48d6d20f9203675031?s=128&d=identicon&r=PG&f=1", "display_name": "FutureShocked", "link": "https://stackoverflow.com/users/3698170/futureshocked"}, "edited": false, "score": 0, "creation_date": 1496862390, "post_id": 44420810, "comment_id": 75840171, "body": "While your answer is more education, and perhaps more complete, I&#39;ve accept the other only because it accomplishes my needs more simply. Thanks for your reply though!"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1496862464, "post_id": 44420810, "comment_id": 75840217, "body": "I don&#39;t think the other answer satisfies the conditions set in the question.  If you can already use &quot;Class1&quot; why not use all others as well?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1496862679, "post_id": 44420810, "comment_id": 75840332, "body": "@karakfa Was your comment maybe intended for the other answer? I don&#39;t see how it applies here..."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1496862737, "post_id": 44420810, "comment_id": 75840355, "body": "This is much better than my answer, so I&#39;m going to delete it (my answer, that is)."}, {"owner": {"reputation": 611, "user_id": 3698170, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a7bb9870ae150c48d6d20f9203675031?s=128&d=identicon&r=PG&f=1", "display_name": "FutureShocked", "link": "https://stackoverflow.com/users/3698170/futureshocked"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1496863035, "post_id": 44420810, "comment_id": 75840549, "body": "@MarkSeemann I&#39;ll accept Alec&#39;s answer since you believe it to be better, but I think it&#39;s worth leaving yours up for posterity."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 611, "user_id": 3698170, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a7bb9870ae150c48d6d20f9203675031?s=128&d=identicon&r=PG&f=1", "display_name": "FutureShocked", "link": "https://stackoverflow.com/users/3698170/futureshocked"}, "edited": false, "score": 0, "creation_date": 1496863158, "post_id": 44420810, "comment_id": 75840620, "body": "@FutureShocked Okay, I&#39;ll leave my answer, then :)"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1496863829, "post_id": 44420810, "comment_id": 75841007, "body": "@Alec, I was suggesting that this answer is the right one and commenting to the OP&#39;s earlier choice and comment."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1496869536, "post_id": 44420810, "comment_id": 75843979, "body": "Minor quibble: since you don&#39;t actually use the <code>Proxy</code>, it&#39;s usually better to give a type like <code>... =&gt; proxy a -&gt; ...</code> (note the lower-case <code>p</code>) and a definition like <code>func _ = ...</code>. This lets the caller use any collection they may have lying around, which is often syntactically cheaper than cooking up an appropriate <code>Proxy</code>; e.g. if you have an <code>[a]</code> or <code>Set a</code> or <code>Map k a</code> or <code>IO a</code> or whatever lying around, you can just pass it rather than having to bring the type variable <code>a</code> into scope and then write the clumsy <code>(Proxy :: Proxy a)</code>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1496862111, "creation_date": 1496862111, "answer_id": 44420810, "question_id": 44420523, "link": "https://stackoverflow.com/questions/44420523/can-i-build-a-list-of-strings-using-each-constructor-of-a-class/44420810#44420810", "title": "Can I build a list of Strings using each constructor of a class?", "body": "<p>The answer is yes, but with a caveat. What is the type of <code>func</code>? It looks like its first argument would be a type, not a value. More on the later...</p>\n\n<hr>\n\n<p>Deriving <code>Enum</code> gets you get the ability to list off successive constructors and deriving <code>Bounded</code> gets you the ability to get the \"first\" and \"last\" elements of this enumeration.</p>\n\n<pre><code>data Class = Class1\n           | Class2\n           | Class3\n           deriving (Show, Eq, Enum, Bounded)\n</code></pre>\n\n<p>Then, we can get a list of all the elements via <code>enumFromTo minBound maxBound</code> (or just <code>[minBound .. maxBound]</code>).</p>\n\n<p>However, back to the initial question on the type of <code>func</code>. You need to pass in a type as an argument. The usual way of doing this is using <code>Proxy</code> and <code>ScopedTypeVariables</code>.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Proxy (Proxy(..))\n\nfunc :: forall a. (Enum a, Bounded a, Show a) =&gt; Proxy a -&gt; [String]\nfunc Proxy = map show $ enumFromTo minBound (maxBound :: a)\n</code></pre>\n\n<p>Try this out at GHCi:</p>\n\n<pre><code>ghci&gt; func (Proxy :: Proxy Class)\n[\"Class1\",\"Class2\",\"Class3\"]\nghci&gt; func (Proxy :: Proxy Bool)\n[\"True\",\"False\"]\n</code></pre>\n"}], "owner": {"reputation": 611, "user_id": 3698170, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a7bb9870ae150c48d6d20f9203675031?s=128&d=identicon&r=PG&f=1", "display_name": "FutureShocked", "link": "https://stackoverflow.com/users/3698170/futureshocked"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 44420810, "answer_count": 2, "score": 1, "last_activity_date": 1496862111, "creation_date": 1496861092, "question_id": 44420523, "link": "https://stackoverflow.com/questions/44420523/can-i-build-a-list-of-strings-using-each-constructor-of-a-class", "title": "Can I build a list of Strings using each constructor of a class?", "body": "<p>I have a simple data type such as:</p>\n\n<pre><code>data Class = Class1\n           | Class2\n           | Class3\n           deriving (Show, Eq)\n</code></pre>\n\n<p>Is there a simple way for me to build a list of Strings that contains the String version of each of these such that:</p>\n\n<pre><code>func Class = [\"Class1\", \"Class2\", \"Class3\"]\n</code></pre>\n"}, {"tags": ["haskell", "shared-libraries"], "answers": [{"comments": [{"owner": {"reputation": 331, "user_id": 3120835, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48c2c7ebc4561f431e104d799f6d4256?s=128&d=identicon&r=PG&f=1", "display_name": "andregps", "link": "https://stackoverflow.com/users/3120835/andregps"}, "edited": false, "score": 1, "creation_date": 1496923770, "post_id": 44419532, "comment_id": 75867839, "body": "Considering the last code, is it possible to create the executable for <code>ModuleB</code> if <code>ModuleA.hs</code> is moved to a  random directory? i.e. Is it always necessary to have the source code of <code>ModuleA</code> to compile <code>ModuleB.hs</code>? e.g. the following commands does not compile <code>ModuleB</code>: 1) <code>ghc -c ModuleA.hs</code> 2) <code>mv ModuleA.hs foo2</code> 3)<code>ghc ModuleB.hs -o ModuleB</code>. The error is: <code>Failed to load interface for ModuleA</code>."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 331, "user_id": 3120835, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48c2c7ebc4561f431e104d799f6d4256?s=128&d=identicon&r=PG&f=1", "display_name": "andregps", "link": "https://stackoverflow.com/users/3120835/andregps"}, "edited": false, "score": 0, "creation_date": 1496927641, "post_id": 44419532, "comment_id": 75870803, "body": "@andregps : Is there any reason you don&#39;t want to wrap ModuleA in a package? Building, installing, and using packages is easy."}, {"owner": {"reputation": 331, "user_id": 3120835, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48c2c7ebc4561f431e104d799f6d4256?s=128&d=identicon&r=PG&f=1", "display_name": "andregps", "link": "https://stackoverflow.com/users/3120835/andregps"}, "edited": false, "score": 0, "creation_date": 1496936439, "post_id": 44419532, "comment_id": 75877878, "body": "I am just researching what is the most flexible solution to update a library in Haskell, so that other developers can use the modules defined on it. Using packages, as far as i know, you need to reinstall it everytime it changes. I think that if i could only update the <code>.o</code> and <code>.hs</code> files, the update is easier. Is this kind of update possible?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 331, "user_id": 3120835, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48c2c7ebc4561f431e104d799f6d4256?s=128&d=identicon&r=PG&f=1", "display_name": "andregps", "link": "https://stackoverflow.com/users/3120835/andregps"}, "edited": false, "score": 0, "creation_date": 1496936569, "post_id": 44419532, "comment_id": 75877984, "body": "@andregps: ...what is updating <code>.o</code> files if not a form of reinstalling? packages can be installed globally to be accessible to multiple users, and they have the benefit of versioning, making it evident when the API changes."}, {"owner": {"reputation": 331, "user_id": 3120835, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48c2c7ebc4561f431e104d799f6d4256?s=128&d=identicon&r=PG&f=1", "display_name": "andregps", "link": "https://stackoverflow.com/users/3120835/andregps"}, "edited": false, "score": 0, "creation_date": 1496939273, "post_id": 44419532, "comment_id": 75879764, "body": "i agree about packages. But, just to make it clear, i think the answer to the question i did on my previous comment is: in order to import <code>ModuleA</code> without installing its package, it is necessary to have its source code (<code>ModuleA.hs</code>) on GHC&#39;s include directories when compiling. Is this answer right?"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 331, "user_id": 3120835, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48c2c7ebc4561f431e104d799f6d4256?s=128&d=identicon&r=PG&f=1", "display_name": "andregps", "link": "https://stackoverflow.com/users/3120835/andregps"}, "edited": false, "score": 0, "creation_date": 1496939359, "post_id": 44419532, "comment_id": 75879816, "body": "I don&#39;t know. I haven&#39;t been able to make it compile w/o the <code>.hs</code> file, but I can&#39;t say that it can&#39;t be done."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 4, "last_activity_date": 1496857656, "creation_date": 1496857656, "answer_id": 44419532, "question_id": 44419157, "link": "https://stackoverflow.com/questions/44419157/is-it-possible-in-a-haskell-source-code-to-import-a-module-that-has-already-be/44419532#44419532", "title": "Is it possible, in a Haskell source code, to import a module that has already been compiled in an object file (.o)?", "body": "<p>GHC should do this for modules in the current directory automatically:</p>\n\n<pre><code>$ echo \"module ModuleA where { a :: Int ; a = 1 }\" &gt; ModuleA.hs\n$ ghc -c ModuleA.hs\n$ echo \"module Main where { import ModuleA ; main :: IO () ; main = print a }\" &gt; ModuleB.hs\n$ ghc ModuleB.hs -o ModuleB\n[2 of 2] Compiling Main             ( ModuleB.hs, ModuleB.o )\nLinking ModuleB ...\n$ ./ModuleB\n1\n</code></pre>\n\n<p>(Note the lack of \"Compiling ModuleA\" line above)</p>\n\n<p>It should only recompile imported modules in the local directory if the source file has changed since\nit was last compiled:</p>\n\n<pre><code>$ echo \"module ModuleA where { a :: Int ; a = 2 }\" &gt;! ModuleA.hs\n$ ghc ModuleB.hs -o ModuleB\n[1 of 2] Compiling ModuleA          ( ModuleA.hs, ModuleA.o )\nLinking ModuleB ...\n$ ./ModuleB\n2\n</code></pre>\n\n<p>(Note the \"Compiling ModuleA\" line above, and the lack of \"Compiling Main\" line)</p>\n\n<p>The same goes for other locations on the import path:</p>\n\n<pre><code>$ rm ModuleA.*\n$ mkdir foo\n$ echo \"module ModuleA where { a :: Int ; a = 3 }\" &gt; foo/ModuleA.hs\n$ ghc -c foo/ModuleA.hs\n$ ghc ModuleB.hs -o ModuleB -ifoo\nLinking ModuleB ...\n$ ./ModuleB\n3\n</code></pre>\n"}], "owner": {"reputation": 331, "user_id": 3120835, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/48c2c7ebc4561f431e104d799f6d4256?s=128&d=identicon&r=PG&f=1", "display_name": "andregps", "link": "https://stackoverflow.com/users/3120835/andregps"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 1, "accepted_answer_id": 44419532, "answer_count": 1, "score": 1, "last_activity_date": 1496857656, "creation_date": 1496856350, "question_id": 44419157, "link": "https://stackoverflow.com/questions/44419157/is-it-possible-in-a-haskell-source-code-to-import-a-module-that-has-already-be", "title": "Is it possible, in a Haskell source code, to import a module that has already been compiled in an object file (.o)?", "body": "<p>Suppose that i have compiled a module called <code>ModuleA</code>. The GHC compiler generated the <code>.o</code> and <code>.hi</code> files.</p>\n\n<p>Now i want to import <code>ModuleA</code>  in another source file without re-compiling it or installing a new package, i.e. i want the GHC to detect that <code>ModuleA</code> was already compiled and is stored in an .o file.</p>\n\n<p>Is it possible? how?</p>\n\n<p>Until now, i tried to set some GHC flags in order to look at the directory that the <code>.o</code> and <code>.hi</code> files are stored, but the compilation fails because GHC can not find the interface of <code>ModuleA</code>.</p>\n"}, {"tags": ["algorithm", "sorting", "haskell"], "comments": [{"owner": {"reputation": 3, "user_id": 8126690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e52206db4b07e8b9960135e051127fa2?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/8126690/john-doe"}, "reply_to_user": {"reputation": 2679, "user_id": 1812322, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ab68ec41682314f87def370d3ddbac1f?s=128&d=identicon&r=PG", "display_name": "Bonifacio2", "link": "https://stackoverflow.com/users/1812322/bonifacio2"}, "edited": false, "score": 0, "creation_date": 1496851520, "post_id": 44417653, "comment_id": 75834150, "body": "It&#39;s defined in the where block"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1496852483, "post_id": 44417653, "comment_id": 75834763, "body": "Notice, after it&#39;s fixed, the algorithm appears to sort and deduplicate the list.  <code>sort [1,1,1,1] == [1]</code>.  This is because <code>remove</code> removes all matching elements instead of just one."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1496852918, "post_id": 44417653, "comment_id": 75835028, "body": "But you call <code>rest x</code>, but <code>rest</code> is defined without any arguments."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 8126690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e52206db4b07e8b9960135e051127fa2?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/8126690/john-doe"}, "edited": false, "score": 0, "creation_date": 1496851856, "post_id": 44417763, "comment_id": 75834356, "body": "Ok cool, progress. Now it compiles, but it prints an array with infinite &quot;1&quot;s"}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "reply_to_user": {"reputation": 3, "user_id": 8126690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e52206db4b07e8b9960135e051127fa2?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/8126690/john-doe"}, "edited": false, "score": 0, "creation_date": 1496851944, "post_id": 44417763, "comment_id": 75834419, "body": "With what input?"}, {"owner": {"reputation": 3, "user_id": 8126690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e52206db4b07e8b9960135e051127fa2?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/8126690/john-doe"}, "edited": false, "score": 0, "creation_date": 1496851979, "post_id": 44417763, "comment_id": 75834445, "body": "sort [100,99..1], it just takes the last element and repeats it"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1496852413, "post_id": 44417763, "comment_id": 75834727, "body": "JohnDoe, that&#39;s because you don&#39;t both removing the smallest element when its at the end: <code>remove a (x:[]) = x:[]</code>."}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "reply_to_user": {"reputation": 3, "user_id": 8126690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e52206db4b07e8b9960135e051127fa2?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/8126690/john-doe"}, "edited": false, "score": 0, "creation_date": 1496853270, "post_id": 44417763, "comment_id": 75835248, "body": "@JohnDoe updated my answer with a fix to the logic. Bear in mind that this algorithm is slow with complexity <code>O(n^2)</code>. A better solution is quicksort or mergesort. <a href=\"https://smthngsmwhr.wordpress.com/2012/11/09/sorting-algorithms-in-haskell/\" rel=\"nofollow noreferrer\">smthngsmwhr.wordpress.com/2012/11/09/&hellip;</a>"}], "tags": [], "owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "is_accepted": false, "score": 2, "last_activity_date": 1505757305, "last_edit_date": 1505757305, "creation_date": 1496851642, "answer_id": 44417763, "question_id": 44417653, "link": "https://stackoverflow.com/questions/44417653/my-sorting-algorithm-doesnt-work/44417763#44417763", "title": "My sorting algorithm doesn&#39;t work", "body": "<h2>Compile Error</h2>\n\n<p>If we look at the entire error message from ghci, which is:</p>\n\n<pre><code>    * Couldn't match expected type `[a] -&gt; [a]' with actual type `[a]'\n    * The function `rest' is applied to one argument,\n      but its type `[a]' has none\n      In the first argument of `sort', namely `(rest x)'\n      In the second argument of `(:)', namely `sort (rest x)'\n    * Relevant bindings include\n        rest :: [a]\n          (bound at ...)\n        x :: [a]\n          (bound at ...)\n        sort :: [a] -&gt; [a]\n          (bound at ...)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>We see that <code>rest :: [a]</code>.\nBut you are attempting to apply something to <code>rest</code> here:</p>\n\n<pre><code>sort x = smallest x : sort (rest x)\n</code></pre>\n\n<p>But you had already applied <code>x</code> here:</p>\n\n<pre><code>rest = remove (smallest x) x\n</code></pre>\n\n<p>So, simply change the former to:</p>\n\n<pre><code>sort x = smallest x : sort rest\n</code></pre>\n\n<p>And it will compile. That said, I haven't checked the logic of the algorithm itself.</p>\n\n<h2>Fixing the logic:</h2>\n\n<p>I rewrote the code with the <code>LambdaCase</code> extension which looks neater.\nI also renamed your sorting function to <code>sort'</code> so that it doesn't clash with <code>Data.List (sort)</code>.</p>\n\n<p>You had 2 problems in <code>sort'</code>. First, you didn't handle the case of a singleton list, which resulted in a non-exhaustive pattern match. I added the clause <code>[x] -&gt; [x]</code> for this. Second, you should use a <code>let</code> binding to evaluate <code>smallest xs</code> only once, I fixed that too. Third, you had the problem that Thomas M. DuBuisson described, which I fixed. And below is the code, with <code>quickCheck</code> and all.</p>\n\n<pre><code>remove :: Eq a =&gt; a -&gt; [a] -&gt; [a] \nremove a = \\case\n  []     -&gt; []\n  (x:xs) -&gt; if a == x then xs else x : remove a xs\n\nsmallest :: Ord a =&gt; [a] -&gt; a\nsmallest = \\case\n  (x:y:[]) -&gt; if x &lt; y then x else y\n  (x:y:xs) -&gt; if x &lt; y then smallest (x:xs) else smallest (y:xs)\n\nsort' :: Ord a =&gt; [a] -&gt; [a]\nsort' = \\case\n  [ ] -&gt; [ ]\n  [x] -&gt; [x]\n  xs  -&gt; let s = smallest xs in s : sort' (remove s xs)\n\nprop_sort :: Ord a =&gt; [a] -&gt; Bool\nprop_sort xs = sort xs == sort' xs\n</code></pre>\n\n<p>Running QuickCheck:</p>\n\n<pre><code>&gt; quickCheck prop_sort\n+++ OK, passed 100 tests.\n</code></pre>\n\n<p>With the alternate changes proposed by Willem Van Onsem, <code>smallest, sort</code> instead looks as:</p>\n\n<pre><code>smallest :: Ord a =&gt; [a] -&gt; a\nsmallest = \\case\n  [x]      -&gt; x\n  (x:y:xs) -&gt; if x &lt; y then smallest (x:xs) else smallest (y:xs)\n\nsort' :: Ord a =&gt; [a] -&gt; [a]\nsort' = \\case\n  [] -&gt; []\n  xs -&gt; let s = smallest xs in s : sort' (remove s xs)\n</code></pre>\n\n<p><code>smallest</code> can also be written as a fold:</p>\n\n<pre><code>import Data.List (foldl1)\n\nsmallest :: Ord a =&gt; [a] -&gt; a\nsmallest = foldl1 $ \\x y -&gt; if x &lt; y then x else y\n</code></pre>\n\n<p>and even shorter with by also using <code>min :: Ord a =&gt; a -&gt; a -&gt; a</code>:</p>\n\n<pre><code>import Data.List (foldl1)\n\nsmallest :: Ord a =&gt; [a] -&gt; a\nsmallest = foldl1 min\n</code></pre>\n\n<p>wherefore our solution can be written, in total as:</p>\n\n<pre><code>sort' :: Ord a =&gt; [a] -&gt; [a]\nsort' = \\case [] -&gt; [] ; xs -&gt; let s = foldl1 min xs in s : sort' (remove s xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1496853468, "creation_date": 1496853468, "answer_id": 44418347, "question_id": 44417653, "link": "https://stackoverflow.com/questions/44417653/my-sorting-algorithm-doesnt-work/44418347#44418347", "title": "My sorting algorithm doesn&#39;t work", "body": "<p>First of all, your <code>remove</code> function will error on the empty list, and never remove an element from a list with <em>one</em> element. You probably want to write:</p>\n\n<pre><code>remove :: <b>Eq a</b> =&gt; a -&gt; [a] -&gt; [a] \nremove a <b>[]</b> = <b>[]</b>\nremove a (x:xs) <b>| a == x = xs\n                | otherwise = x : remove a xs</b></code></pre>\n\n<p>Next your <code>smallest</code> behaves weird as well since it will not select the smallest from a list with <em>one</em> element (in that case the smallest element is that case). We can rewrite it like:</p>\n\n<pre><code>smallest :: Ord a =&gt; [a] -&gt; a\nsmallest <b>[x]</b> = <b>x</b>\nsmallest (x:y:xs) <b>| x &lt; y = smallest (x:xs)\n                  | otherwise = smallest (y:xs)</b></code></pre>\n\n<p>Now that we have fixed these, we can focus on the real sorting function. I do not really see why you want to use a helper function here to remove the element, you can use a variable <code>small</code> to store the smallest element in the list, and then simply use recursion, like:</p>\n\n<pre><code>sort :: Ord a =&gt; [a] -&gt; [a]\nsort [] = []\nsort x  = <b>small</b> : sort (<b>remove small x</b>)\n    <b>where small = smallest x</b></code></pre>\n\n<p>Now with this sorting algorithm, we obtain:</p>\n\n<pre><code>*Main&gt; sort [1,4,2,5]\n[1,2,4,5]\n*Main&gt; sort [1,4,2,5,1,3,0,2]\n[0,1,1,2,2,3,4,5]\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8126690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e52206db4b07e8b9960135e051127fa2?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/8126690/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 44418347, "answer_count": 2, "score": 0, "last_activity_date": 1505757305, "creation_date": 1496851233, "question_id": 44417653, "link": "https://stackoverflow.com/questions/44417653/my-sorting-algorithm-doesnt-work", "title": "My sorting algorithm doesn&#39;t work", "body": "<p>As homework, we were supposed to implement a few functions and then come up with a sorting algorithm potentially implementing those functions. first of all, these are the two needed functions:</p>\n\n<pre><code>remove :: (Ord a) =&gt; a -&gt; [a] -&gt; [a] \nremove a (x:[]) = x:[]\nremove a (x:xs) =\n  if a == x\n    then xs\n    else x:(remove a xs)\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>smallest :: (Ord a) =&gt; [a] -&gt; a\nsmallest (x:y:[]) =\n  if x &lt; y\n    then x\n    else y\nsmallest (x:y:xs) =\n  if x &lt; y\n    then smallest (x:xs)\n    else smallest (y:xs)\n</code></pre>\n\n<p>My sorting Algorithm is just supposed to take the smallest element and put it at the beginning of the list:</p>\n\n<pre><code>sort :: (Integral a) =&gt; [a] -&gt; [a]\nsort [] = []\nsort x = smallest x : sort (rest x)\n      where\n        rest = remove (smallest x) x\n</code></pre>\n\n<p>The Error I get is </p>\n\n<ul>\n<li>Couldn't match expected type \u2018[a] -> [a]\u2019 with actual type \u2018[a]\u2019</li>\n<li>The function \u2018rest\u2019 is applied to one argument,\nbut its type \u2018[a]\u2019 has none\nIn the first argument of \u2018sort\u2019, namely \u2018(rest x)\u2019\nIn the second argument of \u2018(:)\u2019, namely \u2018sort (rest x)\u2019</li>\n</ul>\n\n<p>I'm surely missing something obvious, but I can't figure out what it is. help me pls.</p>\n"}, {"tags": [".net", "haskell", "f#", "monads", "computation-expression"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1496849825, "post_id": 44416795, "comment_id": 75833052, "body": "You&#39;re going to have to explain what you&#39;re trying to do in much more detail. A fragment of Haskell code (missing critical pieces) doesn&#39;t seem to explain what you&#39;re trying to accomplish in F#."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 5, "creation_date": 1496849914, "post_id": 44416795, "comment_id": 75833114, "body": "F# isn&#39;t pure like Haskell and has mutable variables built-in. Or are you asking how to implement the state monad in F#?"}, {"owner": {"reputation": 28776, "user_id": 2314532, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/90ade367b50c6f2a4796a03c82b1a4a1?s=128&d=identicon&r=PG", "display_name": "rmunn", "link": "https://stackoverflow.com/users/2314532/rmunn"}, "edited": false, "score": 0, "creation_date": 1496851940, "post_id": 44416795, "comment_id": 75834417, "body": "@MiP - Since you&#39;ve read the Computation Expression series and you&#39;re wanting to figure out how to implement the State monad, the next series you read should almost certainly be <a href=\"https://fsharpforfunandprofit.com/series/handling-state.html\" rel=\"nofollow noreferrer\">fsharpforfunandprofit.com/series/handling-state.html</a>, in which Scott Wlaschin explains that particular pattern with humor, his usual excellent diagrams, and a very fun metaphor."}, {"owner": {"reputation": 4236, "user_id": 7821462, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/62a1c236b15ca034fa7d92bb5bcb2522?s=128&d=identicon&r=PG&f=1", "display_name": "MiP", "link": "https://stackoverflow.com/users/7821462/mip"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496853556, "post_id": 44416795, "comment_id": 75835417, "body": "@dfeuer you could see the code at the first link. Haskell seems so different comparing to F# so I don&#39;t fully know how to translate this code into F#."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 3, "creation_date": 1496857840, "post_id": 44416795, "comment_id": 75837659, "body": "What have you tried so far? Where are you stuck?"}], "answers": [{"comments": [{"owner": {"reputation": 4236, "user_id": 7821462, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/62a1c236b15ca034fa7d92bb5bcb2522?s=128&d=identicon&r=PG&f=1", "display_name": "MiP", "link": "https://stackoverflow.com/users/7821462/mip"}, "edited": false, "score": 0, "creation_date": 1497272177, "post_id": 44419625, "comment_id": 75993372, "body": "Although <code>mutable</code> can handle most of the use cases, my question is asking how to implement state monad in F# though."}], "tags": [], "owner": {"reputation": 224912, "user_id": 33518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d06834fe3fb105f62b2186aba4a430d5?s=128&d=identicon&r=PG", "display_name": "Tomas Petricek", "link": "https://stackoverflow.com/users/33518/tomas-petricek"}, "is_accepted": true, "score": 3, "last_activity_date": 1496857955, "creation_date": 1496857955, "answer_id": 44419625, "question_id": 44416795, "link": "https://stackoverflow.com/questions/44416795/re-assign-a-variable-in-a-function-with-computation-expression/44419625#44419625", "title": "Re-assign a variable in a function with computation expression", "body": "<p>F# has a first-class support for imperative programming constructs. You just need to mark your let bindings as <code>mutable</code>. There is no need for computation expressions in this case:</p>\n\n<pre><code>let mutable elephant = 0\nprintfn \"Elephant = %d\" elephant\nelephant &lt;- 2\nprintfn \"Elephant = %d\" elephant\n</code></pre>\n"}], "owner": {"reputation": 4236, "user_id": 7821462, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/62a1c236b15ca034fa7d92bb5bcb2522?s=128&d=identicon&r=PG&f=1", "display_name": "MiP", "link": "https://stackoverflow.com/users/7821462/mip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 1, "accepted_answer_id": 44419625, "answer_count": 1, "score": 1, "last_activity_date": 1496857955, "creation_date": 1496848962, "last_edit_date": 1496849960, "question_id": 44416795, "link": "https://stackoverflow.com/questions/44416795/re-assign-a-variable-in-a-function-with-computation-expression", "title": "Re-assign a variable in a function with computation expression", "body": "<p>Based on the question <a href=\"https://stackoverflow.com/q/43525193/7821462\">How can I re-assign a variable in a function in Haskell?</a>, there is a haskell solution to change the total congo elephant count <code>Congo 0</code> in a <code>function</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main' :: StateT Congo IO ()\nmain' =\n  do\n    printElephant\n    function 2\n    printElephant\n\n-- run program:\nmain :: IO ()\nmain = Congo 0 &amp; runStateT main' &amp; void\n-- outputs:\n0\n2\n</code></pre>\n\n<p>After reading the <a href=\"https://fsharpforfunandprofit.com/posts/computation-expressions-intro/\" rel=\"nofollow noreferrer\">Computation Expression series</a>, I still don't know how to write a CE builder for this problem correctly. How can I re-assign a variable in a function with F#'s CE?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1496848681, "post_id": 44415897, "comment_id": 75832254, "body": "the function will be get composed five times to once function right?"}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 2, "last_activity_date": 1496847462, "last_edit_date": 1496847462, "creation_date": 1496846695, "answer_id": 44415897, "question_id": 44415699, "link": "https://stackoverflow.com/questions/44415699/how-the-recursion-get-expanded/44415897#44415897", "title": "How the recursion get expanded", "body": "<pre><code>applyTimes 5 (+1) 5 =\n  (+1) . applyTimes 4 (+1) $ 5\n\napplyTimes 5 (+1) 5 =\n  (+1) . (\n    (+1) . applyTimes 3 (+1)\n  ) $ 5\n\n-- ...\n\napplyTimes 5 (+1) 5 =\n  (+1) . (                -- 4\n    (+1) . (              -- 3\n      (+1) . (            -- 2\n        (+1) . (          -- 1\n          (+1) . const    -- 0\n        )\n      )\n    )\n  ) $ 5\n</code></pre>\n\n<p>I put in <code>const</code> because that's what you get after last <code>applyTimes 0 f</code> is evaluated.</p>\n\n<p>Or, in flattened form:</p>\n\n<pre><code>applyTimes 5 (+1) 5 = (+1) . ((+1) . ((+1) . ((+1) . ((+1) . const))))) $ 5\n                    = (+1) .  (+1) .  (+1) .  (+1) .  (+1) . const      $ 5\n</code></pre>\n\n<p>The name can be kind of misleading, since the \"apply <code>f</code> n times\"<sup>1</sup>  is actually done by applying  a function composed of n repetitions of <code>f</code>, <em>once</em>.</p>\n\n<hr>\n\n<p>What I could also see as confusing is where the actual application happens; perhaps eta-reducing it makes it clearer:</p>\n\n<pre><code>applyTimes n f = f . applyTimes (n-1) f\n</code></pre>\n\n<hr>\n\n<p><sup>1</sup>You could imagine  a perhaps simpler implementation:</p>\n\n<pre><code>applyTimes 0 f x = x\napplyTimes n f x = f $ applyTimes (n-1) x\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 44415897, "answer_count": 1, "score": 1, "last_activity_date": 1496847462, "creation_date": 1496846238, "question_id": 44415699, "link": "https://stackoverflow.com/questions/44415699/how-the-recursion-get-expanded", "title": "How the recursion get expanded", "body": "<p>I have following function, that do the function composition:</p>\n\n<pre><code>applyTimes :: (Eq a, Num a) =&gt; a -&gt; (b -&gt; b) -&gt; b -&gt; b\napplyTimes 0 f b = b\napplyTimes n f b = f . applyTimes (n-1) f $ b\n</code></pre>\n\n<p>and I have following expression: </p>\n\n<pre><code>applyTimes 5 (+1) 5\n</code></pre>\n\n<p>Could someone please write out the evaluation?<br>\nIt is difficult to imaging, how it will be expanded.    </p>\n"}, {"tags": ["haskell", "haddock"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496846745, "post_id": 44415587, "comment_id": 75830753, "body": "Yes, but that doesn&#39;t get at <i>why</i>. It&#39;s pretty annoying."}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 2, "last_activity_date": 1496846372, "last_edit_date": 1496846372, "creation_date": 1496846013, "answer_id": 44415587, "question_id": 44415396, "link": "https://stackoverflow.com/questions/44415396/why-doesnt-haddock-generate-html-for-some-modules-in-base/44415587#44415587", "title": "Why doesn&#39;t haddock generate HTML for some modules in base?", "body": "<p>This is apparently intentional. It a result of <a href=\"https://github.com/ghc/ghc/blob/ef07010cf4f480d9f595a71cf5b009884522a75e/libraries/base/GHC/Show.hs#L4\" rel=\"nofollow noreferrer\">this line</a> in GHC/Show.hs:</p>\n\n<pre><code>{-# OPTIONS_HADDOCK hide #-}\n</code></pre>\n\n<p>Relevant excerpts from <a href=\"https://www.haskell.org/haddock/doc/html/module-attributes.html\" rel=\"nofollow noreferrer\">the haddock documentation</a>:</p>\n\n<blockquote>\n  <p>Certain attributes may be specified for each module which affects the way that Haddock generates documentation for that module. Attributes are specified in a comma-separated list in an <code>{-# OPTIONS_HADDOCK ... #-}</code> pragma at the top of the module, either before or after the module description.</p>\n  \n  <p>[...]</p>\n  \n  <p>The following attributes are currently understood by Haddock:</p>\n  \n  <ul>\n  <li>hide\n  \n  <blockquote>\n    <p>Omit this module from the generated documentation, but nevertheless propagate definitions and documentation from within this module to modules that re-export those definitions.</p>\n  </blockquote></li>\n  </ul>\n  \n  <p>[...]</p>\n</blockquote>\n"}], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1496846372, "creation_date": 1496845486, "question_id": 44415396, "link": "https://stackoverflow.com/questions/44415396/why-doesnt-haddock-generate-html-for-some-modules-in-base", "title": "Why doesn&#39;t haddock generate HTML for some modules in base?", "body": "<p>There are some modules in the <a href=\"https://hackage.haskell.org/package/base\" rel=\"nofollow noreferrer\">base</a> haddock that don't have documentation links. For example, <a href=\"https://github.com/ghc/ghc/blob/ef07010cf4f480d9f595a71cf5b009884522a75e/libraries/base/GHC/Show.hs\" rel=\"nofollow noreferrer\">GHC/Show.hs</a> has haddock comments, but there is no documentation for the <code>GHC.Show</code> module on Hackage. Why not? Is this a bug?</p>\n"}, {"tags": ["json", "haskell", "aeson", "to-json"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1496828682, "post_id": 44408359, "comment_id": 75816933, "body": "If you have objects with types the <code>Object</code> then it&#39;s just <code>HashMap</code>, so you can use <code>HashMap.union</code>, <code>mappend</code>, <code>(&lt;&gt;)</code> etc. But if you have objects with types the <code>Value</code>, how do you want to merge them? For example, you have a string and a number, what result must be?"}, {"owner": {"reputation": 849, "user_id": 1714059, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/95f887aedbff06d22b6cfebb4526468e?s=128&d=identicon&r=PG", "display_name": "Batou99", "link": "https://stackoverflow.com/users/1714059/batou99"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1496915896, "post_id": 44408359, "comment_id": 75862427, "body": "I just want the <code>unions</code> behavior. I want a Map with all keys and their values and if some key is duplicated I&#39;m happy to let the last one overwrite the others. Essentially the same behaviour you get on ruby when doing <code>hash1.merge(hash2)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1593006005, "post_id": 44409320, "comment_id": 110628315, "body": "The function retains the first (earliest) value in case of the same key in more than one of the merged records. First Wins strategy comes from the <code>Data.HashMap.Lazy</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1593006478, "post_id": 44409320, "comment_id": 110628606, "body": "@user855443: you can make use of  <code>foldl (unionsWith ...) empty</code> to specify a different strategy: <a href=\"https://hackage.haskell.org/package/unordered-containers-0.2.11.0/docs/Data-HashMap-Lazy.html#v:unionWith\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/unordered-containers-0.2.11.0/do&zwnj;&#8203;cs/&hellip;</a> you can for example use <code>const</code> to select the first (earliest) one, or <code>const id</code> to select the latter (latest). Or you can even implement a more sophisticated strategy"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1496838867, "last_edit_date": 1496838867, "creation_date": 1496829290, "answer_id": 44409320, "question_id": 44408359, "link": "https://stackoverflow.com/questions/44408359/how-to-merge-aeson-objects/44409320#44409320", "title": "How to merge Aeson objects?", "body": "<p>Given the list contains <em>only</em> of JSON objects (thus elements that have key-value pairs or elements with the <a href=\"https://hackage.haskell.org/package/aeson-1.2.0.0/docs/Data-Aeson.html#t:Value\" rel=\"noreferrer\"><code>Object</code> constructor</a>), you can write your own:</p>\n\n<pre><code>import Data.Aeson(Value(Object))\nimport qualified Data.HashMap.Lazy as HML\n\nmerge_aeson :: [Value] -&gt; Value\nmerge_aeson = Object . HML.unions . map (\\(Object x) -&gt; x)\n</code></pre>\n\n<p>If we test the above function with the given sample input, we obtain:</p>\n\n<pre><code>Prelude Data.Aeson HML&gt; merge_aeson [object [\"key1\" .= \"value1\"], object [\"key2\" .= \"value2\"]] \nObject (fromList [(\"key2\",String \"value2\"),(\"key1\",String \"value1\")])\n</code></pre>\n"}], "owner": {"reputation": 849, "user_id": 1714059, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/95f887aedbff06d22b6cfebb4526468e?s=128&d=identicon&r=PG", "display_name": "Batou99", "link": "https://stackoverflow.com/users/1714059/batou99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 729, "favorite_count": 0, "accepted_answer_id": 44409320, "answer_count": 1, "score": 5, "last_activity_date": 1496838867, "creation_date": 1496826759, "question_id": 44408359, "link": "https://stackoverflow.com/questions/44408359/how-to-merge-aeson-objects", "title": "How to merge Aeson objects?", "body": "<p>I have a list of aeson objects like this</p>\n\n<pre><code>[object [\"key1\" .= \"value1\"], object [\"key2\" .= \"value2\"]] \n</code></pre>\n\n<p>and I want to merge them as a single aeson object like this</p>\n\n<pre><code>object [\"key1\" .= \"value1\", \"key2\" .= \"value2\"]\n</code></pre>\n\n<p>This is quite standard when working with JSON data in other languages (merge operation) but I don't see anything similar in the Aeson library.</p>\n\n<p>Am I just missing something and can this be done with some standard haskell function? I tried using <code>sequence</code> but it seems that JSON <code>Value</code> is not a monad so I cannot do that.</p>\n\n<p>I don't need to deal with deep merging or duplicate keys, I just want to generate something like</p>\n\n<pre><code>{\n  \"key1\": value1,\n  \"key2\": value2\n}\n</code></pre>\n\n<p>from</p>\n\n<pre><code>[{ \"key1\": value1 }, { \"key2\": value2 }]\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 8, "creation_date": 1496821332, "post_id": 44406434, "comment_id": 75811847, "body": "You didn\u2019t change the value of <code>a</code>; you made a new thing also named <code>a</code>. When compiling, the name that appears last is the one that\u2019s selected."}, {"owner": {"reputation": 860, "user_id": 4533179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-KNh9ARuyfuU/AAAAAAAAAAI/AAAAAAAAAKU/c_6Cw3NzpP4/photo.jpg?sz=128", "display_name": "jdstaerk", "link": "https://stackoverflow.com/users/4533179/jdstaerk"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1496823211, "post_id": 44406434, "comment_id": 75813059, "body": "Ah alright. So I guess, that something like <code>let a = 3</code> (newline) <code>a = a *2</code> is not allowed?"}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1496823291, "post_id": 44406434, "comment_id": 75813120, "body": "Right. Your example would be like doing <code>let b = a * 2</code>. (Which works fine for some purposes, of course.)"}, {"owner": {"reputation": 860, "user_id": 4533179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-KNh9ARuyfuU/AAAAAAAAAAI/AAAAAAAAAKU/c_6Cw3NzpP4/photo.jpg?sz=128", "display_name": "jdstaerk", "link": "https://stackoverflow.com/users/4533179/jdstaerk"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1496823488, "post_id": 44406434, "comment_id": 75813248, "body": "Alright, thank you for your answer, got it!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1496823559, "post_id": 44406434, "comment_id": 75813291, "body": "You shouldn&#39;t think of it as the last one, but rather the innermost one. <code>let a = a * 2</code> is perfectly legal, but won&#39;t do what you expect. Try it and see!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1586801173, "post_id": 44406434, "comment_id": 108255805, "body": "in GHCi, <code>a &lt;- return (a*2)</code> at the prompt OTOH is also legal, and does do what would be expected of it to be doing. <i>or seem like it does.</i> :)"}], "answers": [{"comments": [{"owner": {"reputation": 860, "user_id": 4533179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-KNh9ARuyfuU/AAAAAAAAAAI/AAAAAAAAAKU/c_6Cw3NzpP4/photo.jpg?sz=128", "display_name": "jdstaerk", "link": "https://stackoverflow.com/users/4533179/jdstaerk"}, "edited": false, "score": 0, "creation_date": 1496826092, "post_id": 44407798, "comment_id": 75815013, "body": "Thanks for this! Getting started with functional programming does not seem to be that easy like OOP :D"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 860, "user_id": 4533179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-KNh9ARuyfuU/AAAAAAAAAAI/AAAAAAAAAKU/c_6Cw3NzpP4/photo.jpg?sz=128", "display_name": "jdstaerk", "link": "https://stackoverflow.com/users/4533179/jdstaerk"}, "edited": false, "score": 5, "creation_date": 1496830011, "post_id": 44407798, "comment_id": 75817941, "body": "@DDerTyp It&#39;s a matter of brain &quot;imprinting&quot;. If one were exposed to pure FP first, OOP would probably seem harder."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 860, "user_id": 4533179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-KNh9ARuyfuU/AAAAAAAAAAI/AAAAAAAAAKU/c_6Cw3NzpP4/photo.jpg?sz=128", "display_name": "jdstaerk", "link": "https://stackoverflow.com/users/4533179/jdstaerk"}, "edited": false, "score": 2, "creation_date": 1496830997, "post_id": 44407798, "comment_id": 75818690, "body": "@DDerTyp, I want to point out that the above is <i>very</i> uncommon in haskell, in case this answer is making you think this is working with immutability is like.  We almost never call two things by the same name in overlapping scopes like this."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1496844252, "post_id": 44407798, "comment_id": 75828644, "body": "@luqui true, except when fiddling around in GHCi/IHaskell. There I often \u201coverwrite\u201d variables. But the old, shadowed values are then not understood as parts of the program flow, but merely as obsolete/erroneous implementations of the same value."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 17, "last_activity_date": 1496825200, "creation_date": 1496825200, "answer_id": 44407798, "question_id": 44406434, "link": "https://stackoverflow.com/questions/44406434/haskell-what-is-immutable-data/44407798#44407798", "title": "Haskell: What is immutable data?", "body": "<p>Actually, <code>a</code> hasn't changed. Try this in <code>ghci</code> to see:</p>\n\n<pre><code>&gt; a = 123\n&gt; action = print a\n&gt; a = 456\n&gt; action\n123\n</code></pre>\n\n<p>Compare with a language that has mutable variables, e.g. python:</p>\n\n<pre><code>&gt;&gt;&gt; a = 123\n&gt;&gt;&gt; def action(): print a\n... \n&gt;&gt;&gt; a = 456\n&gt;&gt;&gt; action()\n456\n</code></pre>\n"}], "owner": {"reputation": 860, "user_id": 4533179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-KNh9ARuyfuU/AAAAAAAAAAI/AAAAAAAAAKU/c_6Cw3NzpP4/photo.jpg?sz=128", "display_name": "jdstaerk", "link": "https://stackoverflow.com/users/4533179/jdstaerk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 402, "favorite_count": 0, "accepted_answer_id": 44407798, "answer_count": 1, "score": 2, "last_activity_date": 1496825200, "creation_date": 1496821133, "question_id": 44406434, "link": "https://stackoverflow.com/questions/44406434/haskell-what-is-immutable-data", "title": "Haskell: What is immutable data?", "body": "<p>in most articles about Haskell you'll find a statement like \"Data in Haskell is immutable\". I don't quite understand why. For example:</p>\n\n<pre><code>let a = 123\nlet a = 456\n</code></pre>\n\n<p>in the main method works. I just changed the data of <code>a</code> from <code>123</code> to <code>456</code>. What am I missing? It's probably a stupid mistake in my train of thought :/</p>\n\n<p>Have a good day!</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496856331, "post_id": 44403888, "comment_id": 75836857, "body": "Be careful with using  <code>WriterT String</code>. First remember that <code>String = [Char]</code>, so the monoid instance for lists apply. For lists, <code>mappend = (++)</code>. And remember that <code>n ++ m</code> has runtime complexity: <code>O(n)</code>. When you do this over and over again, the complexity becomes <code>O(n^2)</code>. Therefore, you should use difference lists instead: <a href=\"https://kseo.github.io/posts/2014-01-14-difference-listfor-writer-monad.html\" rel=\"nofollow noreferrer\">kseo.github.io/posts/&hellip;</a>"}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496856594, "post_id": 44403888, "comment_id": 75837005, "body": "Also, given that <code>Either e a = Except e a = ExceptT e Identity a</code> do note that <code>WriterT w (Except e) &#47;= ExceptT e (Writer w)</code>. The former has no log when there&#39;s an exception, and the latter always has a log, even on exception."}], "tags": [], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "is_accepted": false, "score": 0, "last_activity_date": 1496811760, "creation_date": 1496811760, "answer_id": 44403888, "question_id": 44403404, "link": "https://stackoverflow.com/questions/44403404/combining-either-and-pair-monads-with-transformers/44403888#44403888", "title": "Combining Either and Pair monads with transformers", "body": "<p>Answering my own question here, I think the Pair monad transformer is <a href=\"https://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Writer-Lazy.html#t:WriterT\" rel=\"nofollow noreferrer\"><code>WriterT</code></a>. In the example above, the type you're looking for is</p>\n\n<pre><code>WriterT String (Either l) Int\n</code></pre>\n\n<p><code>String</code> should be replaced by whatever is on the right hand side of the pairs.<br>\n<code>l</code> should be whatever the type of <code>Left</code> is.<br>\n<code>Int</code> should be replaced by whatever the result type is.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1496821145, "creation_date": 1496821145, "answer_id": 44406440, "question_id": 44403404, "link": "https://stackoverflow.com/questions/44403404/combining-either-and-pair-monads-with-transformers/44406440#44406440", "title": "Combining Either and Pair monads with transformers", "body": "<p>An alternative:</p>\n\n<pre><code>&gt; liftA2 (+) &lt;$&gt; Right (\"a\",2) &lt;*&gt; Right (\"b\",3)\nRight (\"ab\",5)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1496992874, "last_edit_date": 1496992874, "creation_date": 1496868672, "answer_id": 44422545, "question_id": 44403404, "link": "https://stackoverflow.com/questions/44403404/combining-either-and-pair-monads-with-transformers/44422545#44422545", "title": "Combining Either and Pair monads with transformers", "body": "<p>In the example, we are combining actions in an \"applicative\" way, meaning that each action does not depend on the returning value of a previous action.</p>\n\n<p>Turns out that <code>Applicative</code>s compose better than <code>Monad</code>s: instead of needing a different \"transformer\" type for each <code>Applicative</code>, we can use a common <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Compose.html\" rel=\"nofollow noreferrer\"><code>Compose</code></a> newtype to create a composite effect for any two <code>Applicative</code>s:</p>\n\n<pre><code>ghci&gt; import Data.Functor.Compose\nghci&gt; getCompose $ (+) &lt;$&gt; Compose (Right (\"a\",2)) &lt;*&gt; Compose (Right (\"b\",3))\nRight (\"ab\",5)\n</code></pre>\n\n<p>The effects of the \"outermost\" <code>Applicative</code> (<code>Either</code> in this case) have priority.</p>\n\n<p>There is some noise in the wrapping/unwrapping of the newtype. If we want to avoid the newtype noise and the operators, we could also modify <em>chi</em>'s answer and do something like</p>\n\n<pre><code>liftA2 (liftA2 (+)) (Right (\"a\",2)) (Right (\"b\",3))\n</code></pre>\n\n<p>The \"outer\" <code>liftA2</code> works on the <code>Either</code>, the \"inner\" <code>liftA2</code> works on <code>(,) String</code>.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1496992874, "creation_date": 1496809088, "question_id": 44403404, "link": "https://stackoverflow.com/questions/44403404/combining-either-and-pair-monads-with-transformers", "title": "Combining Either and Pair monads with transformers", "body": "<p>I haven't used monad transformers before but I think it's what I need in my case. Here's some sample code below:</p>\n\n<pre><code>Prelude&gt; (+) &lt;$&gt; Right 2 &lt;*&gt; Right 3\nRight 5\n\nPrelude&gt; (+) &lt;$&gt; (['a'],2) &lt;*&gt; (['b'],3)\n(\"ab\",5)\n</code></pre>\n\n<p>But I want to combine these two behaviours like so:</p>\n\n<pre><code>Prelude&gt; (+) &lt;$&gt; Right (\"a\",2) &lt;*&gt; Right (\"b\",3)\nRight (\"ab\",5)\n</code></pre>\n\n<p>Naturally this fails to compile as numeric addition is not defined on <code>(String, Int)</code>.</p>\n\n<p>The <a href=\"https://en.wikibooks.org/wiki/Haskell/Monad_transformers\" rel=\"nofollow noreferrer\">Monad transformers Haskell wiki page</a> suggests I need to use a transformer for the inner monad, which is in this case a pair, but searching for PairT on <a href=\"http://hayoo.fh-wedel.de/?query=PairT\" rel=\"nofollow noreferrer\">Hayoo!</a> or <a href=\"https://www.haskell.org/hoogle/?hoogle=PairT\" rel=\"nofollow noreferrer\">Hoogle</a> didn't reveal anything relevant. </p>\n\n<p>Do I have to implement this transformer myself, or is there something on Hackage I've missed, or am I just misunderstanding how this should be done?</p>\n\n<p><strong>Note:</strong> </p>\n\n<p>The actual outer monad I'm using isn't <code>Either</code>, it's a custom monad I've detailed in this <a href=\"https://stackoverflow.com/questions/44403117/either-with-a-semigroup-on-the-left\">question</a>, which however is quite similar to <code>Either</code>.</p>\n"}, {"tags": ["haskell", "hackage"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496811565, "post_id": 44403117, "comment_id": 75806858, "body": "Your <code>Monad</code> instance doesn&#39;t match your <code>Applicative</code> one. I don&#39;t think it can. Not a <code>Monad</code>."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496811939, "post_id": 44403117, "comment_id": 75807016, "body": "I was a little worried about that, why doesn&#39;t the <code>Monad</code> instance match <code>Applicative</code>? What&#39;s the law I&#39;m breaking?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496812023, "post_id": 44403117, "comment_id": 75807041, "body": "You&#39;re breaking the law that <code>(&lt;*&gt;) = ap</code>."}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "closed_date": 1496811987, "answer_count": 0, "score": 0, "last_activity_date": 1496811008, "creation_date": 1496807133, "question_id": 44403117, "link": "https://stackoverflow.com/questions/44403117/either-with-a-semigroup-on-the-left", "closed_reason": "Duplicate", "title": "`Either` with a Semigroup on the left", "body": "<p>Does something like this already exist or should I package it up for Hackage (I find it useful for collecting errors):</p>\n\n<pre><code>module EitherSemigroup where\n\nimport Prelude hiding (Right, Left)\nimport Data.Semigroup (Semigroup)\n\ndata EitherSemigroup l r = Left l | Right r\n\ninstance Functor (EitherSemigroup l) where\n  fmap f (Right x) = Right (f x)\n  fmap _ (Left x) = Left x\n\ninstance Semigroup l =&gt; Applicative (EitherSemigroup l) where\n  pure = Right\n  (&lt;*&gt;) (Right f) (Right x) = Right (f x)\n  (&lt;*&gt;) (Right _) (Left x) = Left x\n  (&lt;*&gt;) (Left x) (Right _) = Left x\n  (&lt;*&gt;) (Left x1) (Left x2) = Left (x1 &lt;&gt; x2)\n\ninstance Semigroup l =&gt; Monad (EitherSemigroup l) where\n  (&gt;&gt;=) (Right x) f = f x\n  (&gt;&gt;=) (Left x) _ = Left x\n</code></pre>\n\n<p>It's worth noting that the <code>Applicative</code> and <code>Monad</code> instances for <code>(,)</code> are very similar to this but for a product type, which does the job for collecting \"warnings\". </p>\n\n<p>If I do package it up for Hackage I'd probably add more instances but if someone has already done this I don't want to reinvent the wheel. </p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "edited": false, "score": 0, "creation_date": 1496879747, "post_id": 44403313, "comment_id": 75847523, "body": "I don&#39;t see how I can build <code>slicep :: Prism&#39; [a] (Vector w a)</code> out of <code>getSliceW :: Vector w a -&gt; [a]</code> and <code>setSliceWpartial :: Vector w a -&gt; [a] -&gt; Maybe (Vector w a)</code>. They don&#39;t fit into <code>prism&#39; :: (b -&gt; s) -&gt; (s -&gt; Maybe a) -&gt; Prism s s a b</code>: <code>setSlice</code> has one extra argument."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "edited": false, "score": 0, "creation_date": 1496888008, "post_id": 44403313, "comment_id": 75849448, "body": "@AlexeyVagarenko, sorry, I was being a bit loose there. Stream of consciousness isn&#39;t always so exact. Rather than <code>setSliceWPartial</code>, I was really talking about a much more limited <code>fromList :: [a] -&gt; Maybe (Vector w a)</code>."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 1, "last_activity_date": 1496888140, "last_edit_date": 1496888140, "creation_date": 1496808486, "answer_id": 44403313, "question_id": 44401969, "link": "https://stackoverflow.com/questions/44401969/lens-lib-is-there-an-optic-for-this/44403313#44403313", "title": "Lens lib: Is there an optic for this?", "body": "<p>I don't think you can get exactly what you're looking for, but you can get some related things. This answer is going to take a rather roundabout path to get to what I think you most likely want; this is the path my mind took approaching a conclusion, and I think justifies what I ended up with. The general theme is that there are a few different legitimate optics you can apply to your situation and that can be useful in different ways.</p>\n\n<p>First, let's look at what sort of <code>Lens</code> you <em>can</em> get. The <code>i</code> and <code>l</code> <code>Nat</code>s mark out a \"window\" in the <code>Vector n</code>. You haven't indicated what you want to happen if the window doesn't lie entirely within the vector. One option is to simply require it to fit. Another option is to clip the window to the size of the vector:</p>\n\n<pre><code>-- Minimum\ntype Min m n = Min' (m &lt;=? n) m n\ntype family Min' m_le_n (m :: Nat) (n :: Nat) where\n  Min' 'True m _ = m\n  Min' 'False _ n = n\n\n-- Saturated subtraction\ntype SatMinus m n = SatMinus' (n &lt;=? m) m n\ntype family SatMinus' n_le_m m n where\n  SatMinus' 'True m n = m - n\n  SatMinus' 'False _ _ = 0\n\n-- Window clipping\ntype ClippedLength i l n = Min l (SatMinus n i)\n</code></pre>\n\n<p>Now you can certainly define (for each <code>n</code>, using a class; I'll ignore this detail in the rest of the post) a legitimate</p>\n\n<pre><code>vlCut :: (KnownNat i, KnownNat l)\n   =&gt; Proxy i -&gt; Proxy l\n   -&gt; Lens' (Vector n a) (Vector (ClippedLength i l n) a)\n</code></pre>\n\n<p>Or, if you only want to allow windows that fit,</p>\n\n<pre><code>vl :: (KnownNat i, KnownNat j, i + l &lt;= n)\n   =&gt; Proxy i -&gt; Proxy l\n   -&gt; Lens' (Vector n a) (Vector l a)\n</code></pre>\n\n<p>We can now work through one of these lenses without losing any generality (although we will lose efficiency; more on getting around that later). Doing so means we get to completely ignore everything outside of the window, so we needn't mention the proxies anymore. If we have any optic from <code>Vector w a</code> to <code>t</code>, then we can produce an optic from <code>Vector n a</code> to <code>t</code>.</p>\n\n<p>Reducing your slice-manipulating functions to the window, you get</p>\n\n<pre><code>getSliceW :: Vector w a -&gt; [a]\nsetSliceWpartial :: Vector w a -&gt; [a] -&gt; Maybe (Vector w a)\n</code></pre>\n\n<p>These don't make a <code>Lens</code>, as you discovered. But if you reduce just a bit further, replacing <code>setSliceWpartial</code> with</p>\n\n<pre><code>fromList :: [a] -&gt; Maybe (Vector w a)\n</code></pre>\n\n<p>you can make a lawful <code>Prism</code>:</p>\n\n<pre><code>slicep :: Prism' [a] (Vector w a)\n</code></pre>\n\n<p>Given a <code>Vector w a</code>, you can always produce a <code>[a]</code>, but the other way is only sometimes possible. You can certainly use this with <code>vl</code> or <code>vlCut</code> (if that's the problem you need to solve, that's a fine solution), but you can't <em>compose</em> it with them, because the types don't match up right. You can reverse the prism with <code>re</code>, but that only gives you a <code>Getter</code> in the end.</p>\n\n<hr>\n\n<p>Since your types don't seem to work out so nicely, let's try changing them:</p>\n\n<pre><code>getSliceW :: Vector w a -&gt; [a]\nsetSliceW :: Vector w a -&gt; [a] -&gt; Vector w a\n</code></pre>\n\n<p>Now we're cooking with bass! This has the <em>type</em> of the pieces of a <code>Lens' (Vector w a) [a]</code>, although it's not actually a lawful lens. It is, however, a very good clue. <code>Control.Lens.Traversal</code> offers</p>\n\n<pre><code>partsOf' :: ATraversal s t a a -&gt; Lens s t [a] [a]\n</code></pre>\n\n<p>which you can read, in this context, as</p>\n\n<pre><code>partsOf' :: Traversal' (Vector w a) a -&gt; Lens' (Vector w a) [a]\n</code></pre>\n\n<p>So (through the window), what we <em>really</em> want is</p>\n\n<pre><code>traverseVMono :: Traversal' (Vector w a) a\n</code></pre>\n\n<p>Of course, that generalizes immediately; just write a <code>Traversable</code> instance for <code>Vector n</code> and use its <code>traverse</code>.</p>\n\n<hr>\n\n<p>I mentioned earlier that working through a window <code>Lens</code> is inefficient. So how can you deal with that? Well, just don't bother actually constructing the window! What you want to go \"from end to end\" is just to <em>traverse the window</em>. So do that:</p>\n\n<pre><code>traverseWindow :: (KnownNat i, KnownNat l, Applicative f)\n               -- optionally require i + l &lt;= n\n               =&gt; proxy1 i\n               -&gt; proxy2 l\n               -&gt; (a -&gt; f a)\n               -&gt; Vector n a\n               -&gt; f (Vector n a)\n</code></pre>\n\n<p>You can recover your original partial <code>setSlice</code> if you like; you just have to use <code>traverseWindow</code> with something like <code>MaybeT (State [a])</code>:</p>\n\n<pre><code>foldMapWindow :: (KnownNat i, KnownNat l, Monoid m)\n  =&gt; proxy1 i\n  -&gt; proxy2 l\n  -&gt; (a -&gt; m)\n  -&gt; Vector n a\n  -&gt; m\nfoldMapWindow p1 p2 f = getConst . traverseWindow p1 p2 (Const . f)\n\nwindowToList :: (KnownNat i, KnownNat l)\n  =&gt; proxy1 i\n  -&gt; proxy2 l\n  -&gt; Vector n a\n  -&gt; [a]\nwindowToList p1 p2 = foldMapWindow p1 p2 (:[])\n\nsetSlice :: (KnownNat i, KnownNat l)\n         =&gt; proxy1 i -&gt; proxy2 l\n         -&gt; Vector n a -&gt; [a] -&gt; Maybe (Vector n a)\nsetSlice p1 p2 v xs = flip evalState (windowToList p1 p2 v) . runMaybeT $ flip (traverseWindow p1 p2) v $ \\_ -&gt; do\n  y : ys &lt;- get\n  put ys\n  pure y\n</code></pre>\n"}], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 44403313, "answer_count": 1, "score": 3, "last_activity_date": 1496888140, "creation_date": 1496797959, "question_id": 44401969, "link": "https://stackoverflow.com/questions/44401969/lens-lib-is-there-an-optic-for-this", "title": "Lens lib: Is there an optic for this?", "body": "<p>I have a family of fixed length vectors:</p>\n\n<pre><code>data family Vector (n :: Nat) a\ndata instance Vector 2 a = Vector2 a a\ndata instance Vector 3 a = Vector3 a a a\n-- and so on\n</code></pre>\n\n<p>and two functions to get and set a slice of a vector as a list:</p>\n\n<pre><code>getSlice :: Proxy i -&gt; Proxy l -&gt; Vector n a -&gt; [a]\nsetSlice :: Proxy i -&gt; Proxy l -&gt; Vector n a -&gt; [a] -&gt; Maybe (Vector n a)\n-- ^ setSlice is partial because list parameter may not have enough elements.\n</code></pre>\n\n<p>I thought I could combine these getter and setter into a lens like this:</p>\n\n<pre><code>slice :: Proxy i -&gt; Proxy l -&gt; Lens (Vector n a) (Maybe (Vector n a)) [a] [a]\nslice i l = lens (getSlice i l) (setSlice i l)\n</code></pre>\n\n<p>but this violates lens laws(<a href=\"http://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Lens.html#t:Lens\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Lens.html#t:Lens</a></p>\n\n<p>So I wonder if there is a structure for this?</p>\n"}, {"tags": ["haskell", "monoids", "recursion-schemes"], "comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 2, "creation_date": 1496797750, "post_id": 44401788, "comment_id": 75803603, "body": "<code>fail</code> counts the children of the top node of <code>expr</code>. In general, it gets nowhere near the leaves. It&#39;s not the <code>alg</code> of a suitable <code>cata</code>."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1496798335, "post_id": 44401788, "comment_id": 75803720, "body": "@pigworker I had the same suspicions. Now all I&#39;m looking for is an accumulating catamorphism which I don&#39;t have to write around 60 cases (one per constructor) for but rather use monoid properties on recursive cases. I feel like that should be possible but I have no idea how to go about this problem."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 2, "creation_date": 1496799004, "post_id": 44401788, "comment_id": 75803845, "body": "What characterises a leaf is that the sum of the leaf counts of its children is zero, because there are no children. Now, given the (sum of the) leaf counts of the children, can you compute the leaf count of the parent?"}], "answers": [{"tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 10, "last_activity_date": 1496847003, "last_edit_date": 1496847003, "creation_date": 1496827892, "answer_id": 44408780, "question_id": 44401788, "link": "https://stackoverflow.com/questions/44401788/monoidal-folds-on-fixed-points/44408780#44408780", "title": "Monoidal folds on fixed points", "body": "<p>Here's the essence of a solution. I've switched on</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor, DeriveFoldable, DeriveTraversable, PatternSynonyms #-}\n</code></pre>\n\n<p>Let's just recap fixpoints and catamorphisms.</p>\n\n<pre><code>newtype Fix f = In {out :: f (Fix f)}\n\ncata :: Functor f =&gt; (f t -&gt; t) -&gt; Fix f -&gt; t\ncata alg = alg . fmap (cata alg) . out\n</code></pre>\n\n<p>The algebra, <code>alg :: f t -&gt; t</code>, takes a node where the children have already been replaced by a <code>t</code> value, then returns the <code>t</code> for the parent. The <code>cata</code> operator works by unpacking the parent node, processing all its children recursively, then applying <code>alg</code> to finish the job.</p>\n\n<p>So, if we want to count leaves in such a structure, we can start like this:</p>\n\n<pre><code>leaves :: (Foldable f, Functor f) =&gt; Fix f -&gt; Integer\nleaves = cata sumOrOne where\n  -- sumOrOne :: f Integer -&gt; Integer\n</code></pre>\n\n<p>The algebra, <code>sumOrOne</code> can see the number of leaves in each child of the parent node. We can use <code>cata</code> because <code>f</code> is a <code>Functor</code>. And because <code>f</code> is <code>Foldable</code>, we can compute the total number of leaves in the children.</p>\n\n<pre><code>  sumOrOne fl = case sum fl of\n    ...\n</code></pre>\n\n<p>There are then two possibilities: if the parent has no children, its leaf sum will be <code>0</code>, which we can detect, but that means the parent is itself a leaf, so <code>1</code> should be returned. Otherwise, the leaf sum will be nonzero, in which case the parent is not a leaf, so its leaf sum is indeed the total leaf sum of its children. That gives us</p>\n\n<pre><code>leaves :: (Foldable f, Functor f) =&gt; Fix f -&gt; Integer\nleaves = cata sumOrOne where\n  sumOrOne fl{- number of leaves in each child-} = case sum fl of\n    0 -&gt; 1  -- no leaves in my children means I am a leaf\n    l -&gt; l  -- otherwise, pass on the total\n</code></pre>\n\n<p>A quick example, based on Hutton's Razor (the expression language with integers and addition, which is often the simplest thing that illustrates the point). The expressions are generated from Hutton's functor.</p>\n\n<pre><code>data HF h = Val Int | h :+: h deriving (Functor, Foldable, Traversable)\n</code></pre>\n\n<p>I introduce some pattern synonyms to recover the look and feel of a bespoke type.</p>\n\n<pre><code>pattern V x    = In (Val x)\npattern s :+ t = In (s :+: t)\n</code></pre>\n\n<p>I cook up a quick example expression, with some leaves that are three levels deep.</p>\n\n<pre><code>example :: Fix HF\nexample = (V 1 :+ V 2) :+ ((V 3 :+ V 4) :+ V 5)\n</code></pre>\n\n<p>Sure enough</p>\n\n<pre><code>Ok, modules loaded: Leaves.\n*Leaves&gt; leaves example\n5\n</code></pre>\n\n<p>An alternative approach is to be functorial and foldable in substructures of interest, in this case, stuff at leaves. (We get exactly the free monads.)</p>\n\n<pre><code>data Tree f x = Leaf x | Node (f (Tree f x)) deriving (Functor, Foldable)\n</code></pre>\n\n<p>Once you've made the leaf/node separation part of your basic construction, you can visit the leaves directly with <code>foldMap</code>. Throwing in a bit of <code>Control.Newtype</code>, we get</p>\n\n<pre><code>ala' Sum foldMap (const 1)  :: Foldable f =&gt; f x -&gt; Integer\n</code></pre>\n\n<p>which is below the Fairbairn Threshold (i.e., short enough not to need a name and all the clearer for not having one).</p>\n\n<p>The trouble, of course, is that data structures are often functorial in \"substructures of interest\" in multiple interesting but conflicting ways. Haskell isn't always the best at letting us access \"found functoriality\": we somehow have to predict the functoriality we need when we parametrise a data type at declaration time. But there's still time to change all that...</p>\n"}], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 3, "accepted_answer_id": 44408780, "answer_count": 1, "score": 5, "last_activity_date": 1496847003, "creation_date": 1496796294, "last_edit_date": 1496797369, "question_id": 44401788, "link": "https://stackoverflow.com/questions/44401788/monoidal-folds-on-fixed-points", "title": "Monoidal folds on fixed points", "body": "<p>Given an arbitrary datastructure with a fixed point, can we construct an monoidal algebra without manually specifying all cases?</p>\n\n<p>Assume we are given the datatype <code>Expr</code> as below. Using the <code>recursion-schemes</code> library, we can derive a base functor <code>ExprF</code>, which automatically also has <code>Functor</code>, <code>Foldable</code> and <code>Traversable</code> instances.</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>{-# LANGUAGE DeriveFunctor, DeriveFoldable, DeriveTraversable #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Data.Semigroup (Sum(..))\nimport Data.Functor.Foldable\nimport Data.Functor.Foldable.TH\n\nimport Prelude hiding (fail)\n\ndata Expr = Var String\n          | Const Int\n          | Add [Expr]\n          | Mult [Expr]\n          deriving Show\n\n$(makeBaseFunctor ''Expr)\n\nexpr :: Fix ExprF\nexpr = ana project $ Add [Const 1, Const 2, Mult [Const 3, Const 4], Var \"hello\"]\n</code></pre>\n\n<p>Now, let's say we want to count the number of leaves in <code>expr</code>. We can easily write an algebra for such a small datastructure:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>alg (ConstF _) = 1\nalg (VarF   _) = 1\nalg (AddF  xs) = sum xs\nalg (MulF  xs) = sum xs\n</code></pre>\n\n<p>Now, we can call <code>cata alg expr</code>, which returns <code>5</code>, the correct result.</p>\n\n<p>Let's assume <code>Expr</code> grows really big and complex and we don't want to manually write cases for all data constructors. How does <code>cata</code> know how to combine the results from all cases? I suspect that this is possible using <code>Monoid</code>s, possibly in conjunction with the <code>Const</code> functor (not entirely sure about that last part though).</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>fail = getSum $ foldMap (const (Sum 1) . unfix) $ unfix expr\n</code></pre>\n\n<p><code>fail</code> returns <code>4</code>, whereas we actually have <code>5</code> leaves. I assume that the problem lies in the fixed point, because we are only able to peel of one layer of <code>Fix</code>ing and therefore the <code>Mult [..]</code> is only counted as one leaf.</p>\n\n<p>Is it possible to somehow generically fold the entire fixed point and collecting the results in a <code>Monoid</code>-like structure <em>without</em> manually specifying all instances? What I want is kind of <code>foldMap</code> but in a more generic way.</p>\n\n<p>I have a feeling I am missing something really obvious.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 5, "creation_date": 1496783887, "post_id": 44399914, "comment_id": 75799808, "body": "What would the type of such a function be?"}, {"owner": {"reputation": 121, "user_id": 8122112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee2fe64f1576e0149a10f1e8d5a156f0?s=128&d=identicon&r=PG&f=1", "display_name": "Lucia Guzheim", "link": "https://stackoverflow.com/users/8122112/lucia-guzheim"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1496783990, "post_id": 44399914, "comment_id": 75799859, "body": "That&#39;s the point of asking this question. I cannot perceive how this is going to be possible. Tuples of different lengths will not share the same type, and I don&#39;t know how I may exploit creating a new data type to support the length function."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 8, "creation_date": 1496786035, "post_id": 44399914, "comment_id": 75800609, "body": "Out of curiosity, why do you want to do this? The length of a tuple is fixed at compile time, so there should be no need to \u201ccalculate\u201d anything. You could use a typeclass like <code>class TupLen a where tupLen :: a -&gt; Int</code> with <code>instance TupLen (a, b) where tupLen _ = 2</code>, &amp;c., but this isn\u2019t very useful."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1496785206, "post_id": 44400025, "comment_id": 75800328, "body": "Worth noting that this will give \u201clength info\u201d not just for tuples but also all kinds of other data structures, perhaps not always with the intended results."}], "tags": [], "owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "is_accepted": false, "score": 5, "last_activity_date": 1496784081, "creation_date": 1496784081, "answer_id": 44400025, "question_id": 44399914, "link": "https://stackoverflow.com/questions/44399914/how-to-count-the-length-of-a-tuple-in-haskell/44400025#44400025", "title": "How to count the length of a tuple in Haskell?", "body": "<p>One possible answer (using just the base library) is</p>\n\n<pre><code>import Data.Data\nimport Data.Functor.Const\n\nlength :: Data a =&gt; a -&gt; Int\nlength =\n  getConst .\n  gfoldl (\\(Const c) _ -&gt; Const (c+1)) (const 0)\n</code></pre>\n\n<p>I gave a whole talk on this subject at London Haskell recently. The slides are <a href=\"https://ro-che.info/docs/2017-05-17-generic-traversals.pdf\" rel=\"noreferrer\">here</a>, but the video has not been published yet.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 7, "last_activity_date": 1496784992, "creation_date": 1496784992, "answer_id": 44400207, "question_id": 44399914, "link": "https://stackoverflow.com/questions/44399914/how-to-count-the-length-of-a-tuple-in-haskell/44400207#44400207", "title": "How to count the length of a tuple in Haskell?", "body": "<p>The reason you don't find anything on this is that it doesn't make a lot of sense to count the length of a tuple:</p>\n\n<ul>\n<li>It is pre-determined a compile time (i.e. you might just as well hard-code it)</li>\n<li>There's not really much you could do with that information: unlike with e.g. a list, it's not possible to <em>index</em> specific entries in a generic tuple.</li>\n</ul>\n\n<p>That said, it is possible to achieve your goal, however this shouldn't be a normal function but a <em>type-level function</em>, aka type family. Using <a href=\"http://hackage.haskell.org/package/singletons-2.2\" rel=\"noreferrer\">singleton</a> type nats:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, DataKinds #-}\nimport Data.Singletons\nimport Data.Singletons.TypeLits\n\ntype family TupLength a :: Nat where\n  TupLength () = 0\n  TupLength (a,b) = 2\n  TupLength (a,b,c) = 3\n  TupLength (a,b,c,d) = 4\n  -- ...\n  TupLength x = 1\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>&gt; mapM_ print [ natVal (sing :: SNat (TupLength ()))\n              , natVal (sing :: SNat (TupLength (Int,String,Double)))\n              , natVal (sing :: SNat (TupLength Bool)) ]\n0\n3\n1\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 8122112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee2fe64f1576e0149a10f1e8d5a156f0?s=128&d=identicon&r=PG&f=1", "display_name": "Lucia Guzheim", "link": "https://stackoverflow.com/users/8122112/lucia-guzheim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1431, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1496784992, "creation_date": 1496783587, "question_id": 44399914, "link": "https://stackoverflow.com/questions/44399914/how-to-count-the-length-of-a-tuple-in-haskell", "title": "How to count the length of a tuple in Haskell?", "body": "<p>I tried searching in web and stackexchange, but surprisingly no one asked how to calculate length of a tuple in Haskell in the form below.</p>\n\n<p>So suppose you have tuple like (1,2,3,4) or (1,3,5,6,7) in Haskell and wish to write the length function that calculates length of a tuple. How can I do this? For list I know how I will be able to do so using recursion without explicitly invoking built-in functions. But tuple is different, and I can't use \"head\"-\"tail\" distinction.</p>\n\n<p>Will the method involve creating a new data type?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1496780265, "post_id": 44398214, "comment_id": 75798035, "body": "This could also horribly break parametricity. If something like this is ever available, it should require <code>Typeable a =&gt; ...</code> or some other mechanism to keep the type around at runtime (otherwise, after compilation they are normally erased.)"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496780610, "post_id": 44398214, "comment_id": 75798216, "body": "Good point. <a href=\"https://www.well-typed.com/blog/2015/05/parametricity/\" rel=\"nofollow noreferrer\">parametricity</a> for the lazy."}], "answers": [{"comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1496780155, "post_id": 44398811, "comment_id": 75797968, "body": "Fully willing to grant the correctness of the first part of this answer and the difficulty of altering GHC to allow such behaviour.  I&#39;m not terribly moved by the orphan instances argument, though. Orphan instances already have an associated warning and are (rightly) accused of weird effects. I don&#39;t see throwing one more on the pile as a reason to avoid implementing it.  I do appreciate the practical approach of the last section. It&#39;s a technique I&#39;ve used before, and though I don&#39;t think it&#39;s as easy as using <code>satisfies</code> would be, the language is what it is."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1496780469, "post_id": 44398811, "comment_id": 75798140, "body": "With <code>data Proof c where QED :: c =&gt; Proof c</code>, <code>type Claim c a = Maybe (Proof (c a))</code> one could also write <code>showAny :: (Claim Show a, Claim Typeable a) -&gt; a -&gt; String</code>, so I suppose I was looking for similar sugar for that situation."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 6, "last_activity_date": 1496779893, "last_edit_date": 1496779893, "creation_date": 1496779147, "answer_id": 44398811, "question_id": 44398214, "link": "https://stackoverflow.com/questions/44398214/checking-constraints-at-runtime/44398811#44398811", "title": "Checking constraints at runtime", "body": "<p>You can't dispatch on instance availability at runtime. Remember, a constraint is translated by the compiler into a <em>type class dictionary</em> - a record of functions that is passed around explicitly and accessed explicitly at runtime. The \"fat arrow\" <code>=&gt;</code> is represented at runtime by a \"thin arrow\" <code>-&gt;</code>, so the elaborator needs to know at compile time which dictionary to pass around.</p>\n\n<p>That is, the following crude example:</p>\n\n<pre><code>class Show a where\n    show :: a -&gt; String\n\ninstance Show String where\n    show = id\n\nshowTwice :: Show a =&gt; a -&gt; String\nshowTwice x = show x ++ show x\n\nmain = putStrLn $ showTwice \"foo\"\n</code></pre>\n\n<p>generates Core code which looks approximately like:</p>\n\n<pre><code>data Show_ a = Show_ { show :: a -&gt; String }\n\nshowString_ :: Show_ String\nshowString_ = Show_ { show = id }\n\nshowTwice :: Show_ a -&gt; a -&gt; String\nshowTwice show_ x = show show_ x ++ show show_ x\n\nmain = putStrLn $ showTwice showString_ \"foo\"\n</code></pre>\n\n<p>When generating code for <code>main</code>, the compiler needs to know where to find <code>showString_</code>.</p>\n\n<p>You can imagine a system wherein you can look up a type class dictionary at runtime with some sort of introspection mechanism, but this would produce weird behaviour from a language design perspective. The problem is orphan instances. If I write a function which attempts to look up a given instance in module <code>A</code>, and define such an instance in an unrelated module <code>B</code>, then the behaviour of that function when called from some client module <code>C</code> depends on whether <code>B</code> was imported by some other part of the program. Pretty strange!</p>\n\n<hr>\n\n<p>A more usual way of doing \"fully polymorphic functions that take advantage of specializations when possible\" would be to put the function in question into a type class itself and give it a default implementation (perhaps with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#default-method-signatures\" rel=\"nofollow noreferrer\">a <code>default</code> signature</a> if the default implementation depends on some superclass). Your <code>showAny</code> would then look like this:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\nimport Data.Typeable\n\nclass ShowAny a where\n    showAny :: a -&gt; String\n    default showAny :: Typeable a =&gt; a -&gt; String\n    showAny x = \"_ :: \" ++ show (typeOf x)\n</code></pre>\n\n<p>You'd need to implement <code>ShowAny</code> for all of the types with which you want to use <code>showAny</code>, but that's usually a single line of code,</p>\n\n<pre><code>instance (Typeable a, Typeable b) =&gt; ShowAny (a -&gt; b)\n</code></pre>\n\n<p>and you can specialise an implementation for a given type just by overriding <code>showAny</code>.</p>\n\n<pre><code>instance ShowAny String where\n    showAny = id\n</code></pre>\n\n<p>You see this approach quite frequently in libraries which do generic programming. <a href=\"https://hackage.haskell.org/package/aeson-1.2.0.0/docs/Data-Aeson.html\" rel=\"nofollow noreferrer\"><code>aeson</code></a>, for example, can use <code>GHC.Generics</code> to serialise a given type to and from JSON (all you have to do is derive <code>Generic</code> and write two lines <code>instance ToJSON MyType; instance FromJSON MyType</code>), but you can also write your own instances of <code>ToJSON</code> and <code>FromJSON</code> if the generic code isn't fast enough or you need to customise the output.</p>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 0, "last_activity_date": 1496781262, "creation_date": 1496781262, "answer_id": 44399367, "question_id": 44398214, "link": "https://stackoverflow.com/questions/44398214/checking-constraints-at-runtime/44399367#44399367", "title": "Checking constraints at runtime", "body": "<p>An alternate workaround to <a href=\"https://stackoverflow.com/a/44398811/9859\">the accepted answer</a> is to pass the dictionaries around manually.</p>\n\n<p>That is, given:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE TypeOperators #-}\nmodule Claim where\n\ndata Proof c where QED :: c =&gt; Proof c\ntype Claim c = Maybe (Proof c)\ntype c ? a = Maybe (Proof (c a))\n</code></pre>\n\n<p>One can write:</p>\n\n<pre><code>showAny :: (Show? a, Typeable? a) -&gt; a -&gt; String\nshowAny (Just QED, _) a = show a\nshowAny (_, Just QED) a = \"_ :: \" ++ showType a\nshowAny _ _ = \"_\"\n</code></pre>\n\n<p>Which works accepably well:</p>\n\n<pre><code>&gt;&gt;&gt; showAny (Nothing, Just QED) (id :: Int -&gt; Int)\n\"_ :: Int -&gt; Int\"\n&gt;&gt;&gt; showAny (Just QED, Just QED) (0 :: Int)\n\"0\"\n&gt;&gt;&gt; showAny (Nothing, Nothing) undefined\n\"_\"\n</code></pre>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 1, "accepted_answer_id": 44398811, "answer_count": 2, "score": 2, "last_activity_date": 1496781262, "creation_date": 1496776919, "question_id": 44398214, "link": "https://stackoverflow.com/questions/44398214/checking-constraints-at-runtime", "title": "Checking constraints at runtime", "body": "<p>I'm trying to define a function that detects whether the type of an input satisfies a given constraint:</p>\n\n<pre><code>satisfies :: (c a =&gt; a -&gt; b) -&gt; a -&gt; Maybe b\n\n-- or the more general\nclaim :: (c =&gt; a) -&gt; Maybe a\n</code></pre>\n\n<p>So the desired behaviour would be:</p>\n\n<pre><code>&gt;&gt;&gt; :t satisfies @Show show\nsatisfies @Show show :: a -&gt; Maybe String\n&gt;&gt;&gt; satisfies @Show show (0 :: Int)\nJust \"0\"\n&gt;&gt;&gt; satisfies @Show show (id :: Int -&gt; Int)\nNothing\n</code></pre>\n\n<p>The goal is to make it easy to define fully polymorphic functions that take\nadvantage of specializations when possible:</p>\n\n<pre><code>showAny :: a -&gt; String\nshowAny (satisfies @Show show -&gt; Just str) = str\nshowAny (satisfies @Typeable showType -&gt; Just str) = \"_ :: \" ++ str\nshowAny _ = \"_\"\n</code></pre>\n\n<p>As the easiest thing I could try, my first attempt tried using <code>-fdefer-to-runtime</code></p>\n\n<pre><code>{-# OPTIONS_GHC -fdefer-type-errors -Wno-deferred-type-errors #-}\n{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE RankNTypes #-}\nmodule Claim where\nimport System.IO.Unsafe (unsafePerformIO)\nimport System.IO.Error (catchIOError)\n\nsatisfies :: (c a =&gt; a -&gt; b) -&gt; a -&gt; Maybe b\nsatisfies f a = unsafePerformIO $\n  (return . Just $! f a) `catchIOError` \\_ -&gt; return Nothing\n</code></pre>\n\n<p>This failed because <code>-fdefer-type-errors</code> doesn't defer the checking to\nruntime, or allow further checking to be done in the context which it is\nactually used (as I had hoped), but instead at compile time replaces found\ntype errors with the equivalent of <code>error \"MESSAGE\"</code>.</p>\n\n<p>Now I'm out of ideas. Is implementing <code>satisfies</code> even possible?</p>\n"}, {"tags": ["haskell", "preprocessor"], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1496777105, "creation_date": 1496777105, "answer_id": 44398276, "question_id": 44397271, "link": "https://stackoverflow.com/questions/44397271/haskell-preprocessor-pound-sign-with-curly-braces/44398276#44398276", "title": "Haskell preprocessor - pound sign with curly braces", "body": "<p>That's <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/utils.html#writing-haskell-interfaces-to-c-code-hsc2hs\" rel=\"nofollow noreferrer\"><code>hsc2hs</code></a> syntax. The <code>const</code> directive says \"output the literal numeric value of this C expression into the generated <code>.hs</code> file\". <code>#</code> just invokes the preprocessor. The curly braces are optional - <code>hsc2hs</code> just reads to the end of the line if you omit the braces, so you could just as easily write</p>\n\n<pre><code>fromAudioFormat AudioS8 = #const AUDIO_S8\n</code></pre>\n\n<p>For more on the specific preprocessor directives see <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/utils.html#input-syntax\" rel=\"nofollow noreferrer\">the docs</a>.</p>\n"}], "owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 447, "favorite_count": 0, "accepted_answer_id": 44398276, "answer_count": 1, "score": 0, "last_activity_date": 1496777105, "creation_date": 1496773591, "question_id": 44397271, "link": "https://stackoverflow.com/questions/44397271/haskell-preprocessor-pound-sign-with-curly-braces", "title": "Haskell preprocessor - pound sign with curly braces", "body": "<p>Browsing sources of Haskell SDL bindings, I've stumbled upon the following piece:</p>\n\n<pre><code>#include \"SDL/SDl.h\"\n\nfromAudioFormat AudioS8 = #{const AUDIO_S8}\n</code></pre>\n\n<p>What does <code>#{const AUDIO_S8}</code> part actually do? At a glance, it extracts a symbol from <code>SDL.h</code>, but I'd like to know exactly what it does and how to construct similar things. I'm particularly curious about <code>const</code> modifier.</p>\n"}, {"tags": ["haskell", "typeclass", "abstraction", "cons"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1496766939, "post_id": 44394773, "comment_id": 75790567, "body": "Obviously more than you are looking for, but this sort of thinking usually ends up in <a href=\"https://hackage.haskell.org/package/mono-traversable-1.0.2/docs/Data-Sequences.html#t:IsSequence\" rel=\"nofollow noreferrer\"><code>IsSequence</code></a>."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 2, "creation_date": 1496767315, "post_id": 44394773, "comment_id": 75790797, "body": "I think <code>uncons :: f a -&gt; Maybe (a,f a)</code> as the inverse of <code>cons</code> seems natural and would allow you to write both <code>head</code> and <code>tail</code> depending on how <code>tail</code> is defined for an empty structure."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1496767736, "post_id": 44394773, "comment_id": 75791011, "body": "Thanks to everyone! Your comments are really useful and helpful. I just wasn&#39;t aware about all existing implementations of these concepts. Now things more clear for me."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496772108, "post_id": 44394773, "comment_id": 75793397, "body": "@Alec The real goal for me actually is not to implement some containers interface but to implement <code>(:)</code> pattern using <code>-XPatternSynonyms</code> for every data type. It requires <code>uncons</code> function mentioned by @ryachza ."}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "closed_date": 1496767766, "answer_count": 0, "score": 1, "last_activity_date": 1496766126, "creation_date": 1496764809, "last_edit_date": 1496766126, "question_id": 44394773, "link": "https://stackoverflow.com/questions/44394773/proper-abstraction-for-consing-and-unconsing-with-laws", "closed_reason": "Duplicate", "title": "Proper abstraction for cons&#39;ing and uncons&#39;ing with laws", "body": "<p>There exist several data structures that support <code>cons</code> operation \u2014 adding element at the beginning of this structure:</p>\n\n<ul>\n<li><code>(:)</code> for lists</li>\n<li><a href=\"http://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Sequence.html#v:-60--124-\" rel=\"nofollow noreferrer\"><code>(&lt;|)</code></a> for <code>Data.Sequence</code></li>\n<li><a href=\"http://hackage.haskell.org/package/text-1.2.2.2/docs/Data-Text.html#v:cons\" rel=\"nofollow noreferrer\"><code>cons</code></a> for <code>Data.Text</code></li>\n</ul>\n\n<p>All those data structures also have <code>head</code> and <code>tail</code>. So I want to create abstraction (using type class) that covers all such possible types with polymorphic operation in order to use use <code>head</code>, <code>(:)</code> and <code>tail</code> for any data type that implements this type class. Moreover, I want some laws for this type class. </p>\n\n<p>I wonder, is there any good existing abstraction that allows destructuring into <em>head</em> and <em>tail</em> and prepending an element?</p>\n\n<p>Something really close to this:</p>\n\n<pre><code>-- Foldable is used because I can have and may use\n-- head :: Foldable f =&gt; f a -&gt; Maybe a\n\nclass Foldable f =&gt; Prependable f where\n    (:)  :: a -&gt; f a -&gt; f a\n    tail :: f a -&gt; f a\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1496770789, "post_id": 44394478, "comment_id": 75792655, "body": "Your second idea is syntactically broken and should be <code>pointsForSeventy :: Real a =&gt; Int -&gt; a</code> meaning it is a function from <code>Int</code> to <code>a</code> where <code>a</code> is an instance of <code>Real</code>.  Notice the fat arrow after the constraint (<code>=&gt;</code> not <code>-&gt;</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 7945715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06dbe79bee2a8ced192e7b4698e3829?s=128&d=identicon&r=PG&f=1", "display_name": "cde33", "link": "https://stackoverflow.com/users/7945715/cde33"}, "edited": false, "score": 0, "creation_date": 1496764649, "post_id": 44394630, "comment_id": 75789099, "body": "Thanks for your answer, the problem is that I need to clarify it in this way pointsForSeventy ::  -&gt;"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 27, "user_id": 7945715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06dbe79bee2a8ced192e7b4698e3829?s=128&d=identicon&r=PG&f=1", "display_name": "cde33", "link": "https://stackoverflow.com/users/7945715/cde33"}, "edited": false, "score": 1, "creation_date": 1496764934, "post_id": 44394630, "comment_id": 75789267, "body": "@cde33 You can&#39;t fix that at the type level, unless you let <code>pointsForSeventy :: Double -&gt; Double</code> or something similar, involving the same floating point type for both input and output."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1496764809, "last_edit_date": 1496764809, "creation_date": 1496764331, "answer_id": 44394630, "question_id": 44394478, "link": "https://stackoverflow.com/questions/44394478/defining-the-type-of-a-function-int-and-float-on-haskell/44394630#44394630", "title": "defining the type of a function- int and float on haskell", "body": "<p>You need an explicit conversion:</p>\n\n<pre><code>pointsForSeventy 1 = 5.5\npointsForSeventy 10 = 0.5\npointsForSeventy 11 = 0.5\npointsForSeventy 12 = 0.5\npointsForSeventy a = fromIntegral a\n</code></pre>\n\n<p>Unlike several other programming languages, Haskell will never automatically perform automatic or implicit conversion between numeric types.</p>\n\n<p>On the other hand, numeric <em>literals</em> belong to any numeric type. E.g. <code>1/2*0.5 :: Double</code> will return <code>0.25</code> since all the three literals are <code>Double</code>s. In some languages like C, instead, <code>1/2*0.5</code> evaluates to <code>0</code> since <code>1/2</code> is integer division (!), and evaluates to <code>0</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1496764774, "last_edit_date": 1496764774, "creation_date": 1496764420, "answer_id": 44394666, "question_id": 44394478, "link": "https://stackoverflow.com/questions/44394478/defining-the-type-of-a-function-int-and-float-on-haskell/44394666#44394666", "title": "defining the type of a function- int and float on haskell", "body": "<p>Haskell is a statically typed language. So that means that the return type can <em>not</em> depend on the <em>value</em> of the input.</p>\n\n<p>An idea might be to convert the <code>Int</code> into a <code>Float</code> by using <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:fromIntegral\" rel=\"nofollow noreferrer\"><code>fromIntegral :: (Integral a, Num b) =&gt; a -&gt; b</code></a>:</p>\n\n<pre><code>pointsForSeventy :: Int -&gt; Float\npointsForSeventy 1 = 5.5\npointsForSeventy 10 = 0.5\npointsForSeventy 11 = 0.5\npointsForSeventy 12 = 0.5\npointsForSeventy a = <b>fromIntegral</b> a</code></pre>\n\n<p>In case you want to treat the <code>Int</code> case different from the <code>Float</code> case, you can also use <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#t:Either\" rel=\"nofollow noreferrer\"><code>Either</code></a>:</p>\n\n<pre><code>pointsForSeventy :: Int -&gt; <b>Either</b> Float <b>Int</b>\npointsForSeventy 1 = <b>Left</b> 5.5\npointsForSeventy 10 = <b>Left</b> 0.5\npointsForSeventy 11 = <b>Left</b> 0.5\npointsForSeventy 12 = <b>Left</b> 0.5\npointsForSeventy a = <b>Right</b> a</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 7945715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06dbe79bee2a8ced192e7b4698e3829?s=128&d=identicon&r=PG&f=1", "display_name": "cde33", "link": "https://stackoverflow.com/users/7945715/cde33"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 833, "favorite_count": 1, "accepted_answer_id": 44394630, "answer_count": 2, "score": 0, "last_activity_date": 1496764809, "creation_date": 1496763958, "question_id": 44394478, "link": "https://stackoverflow.com/questions/44394478/defining-the-type-of-a-function-int-and-float-on-haskell", "title": "defining the type of a function- int and float on haskell", "body": "<p>I have a problem with defining the type of a function. In the cases of 1, 10, 11 and 12, I insert an Int and return a float, but in the case in which I insert an Int and return an Int the types doesn't match.\nI tried with \npointsForSeventy:: Int->Float and also with pointsForSeventy:: Real a-> Int->a (I thought this one would work because Integrals and Fractionals are inside the Real numbers)</p>\n\n<pre><code>pointsForSeventy 1 = 5.5\npointsForSeventy 10 = 0.5\npointsForSeventy 11 = 0.5\npointsForSeventy 12 = 0.5\npointsForSeventy a = a\n</code></pre>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["multithreading", "haskell", "concurrency", "cluster-computing"], "answers": [{"comments": [{"owner": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 0, "creation_date": 1496836151, "post_id": 44395553, "comment_id": 75822366, "body": "While reading your answer, a question popped up to my mind. Is there a way in Haskell to automatically create as many OS threads equal to the number of cores available on one machine?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 1, "creation_date": 1496863286, "post_id": 44395553, "comment_id": 75840702, "body": "@securecurve By setting the RTS option <code>-N</code>, either as a command line argument to the executable or as a compiler flag. See <a href=\"https://stackoverflow.com/questions/3704430/why-do-you-have-to-use-both-a-compiler-flag-and-a-run-time-flag-to-get-multicore\" title=\"why do you have to use both a compiler flag and a run time flag to get multicore\">stackoverflow.com/questions/3704430/&hellip;</a>"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 1, "creation_date": 1496863379, "post_id": 44395553, "comment_id": 75840756, "body": "I should also mention that &#39;threads&#39; in (1) is really <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Scheduler#Capabilities\" rel=\"nofollow noreferrer\"><i>capabilities</i></a>, not green threads. Green threads are scheduled onto capabilities, which are in turn mapped onto cores."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 9, "last_activity_date": 1496768775, "last_edit_date": 1496768775, "creation_date": 1496767490, "answer_id": 44395553, "question_id": 44393439, "link": "https://stackoverflow.com/questions/44393439/how-haskell-handles-parallel-computing-on-a-multicore-machine-cluster/44395553#44395553", "title": "How Haskell handles parallel computing on a multicore machine/cluster", "body": "<ol>\n<li><p>GHC uses a pool of available work (called <em>sparks</em>) and a <a href=\"https://en.wikipedia.org/wiki/Work_stealing\" rel=\"noreferrer\">work-stealing</a> system: when a thread runs out of work, it will look for work in the pool or on the work queues of other threads that it can steal.</p></li>\n<li><p>There is no built-in support for distributed computing as there is in (say) Erlang. The semantics are whatever your implementation defines. There are existing implementations like <a href=\"http://haskell-distributed.github.io/\" rel=\"noreferrer\">Cloud Haskell</a> that you can look at for examples.</p></li>\n<li><p>Neither. Haskell will automatically do whatever work is necessary to provide a value that is demanded and no more.</p></li>\n<li><p>Haskell (and GHC in particular) does not do anything to automatically parallelize evaluation because there is no known universal strategy for parallelizing that is strictly better than not parallelizing. See <a href=\"https://stackoverflow.com/questions/15005670/why-is-there-no-implicit-parallelism-in-haskell\">Why is there no implicit parallelism in Haskell?</a> for more info.</p></li>\n<li><p>No. See (2).</p></li>\n<li><p>For the same machine, it uses the pool of sparks and the work-stealing system described above. There is no notion of \"clustering\".</p></li>\n</ol>\n\n<p>For an overview of parallel and concurrent programming in Haskell, see the <a href=\"http://chimera.labs.oreilly.com/books/1230000000929\" rel=\"noreferrer\">free book of the same name</a> by Simon Marlow, a primary author of GHC's runtime system.</p>\n"}, {"comments": [{"owner": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 0, "creation_date": 1496835118, "post_id": 44397886, "comment_id": 75821614, "body": "Thanks for the detailed answer :) ... regarding your final note, yes, you are true, concurrency is not parallelism, but I used the word concurrent here because I had in mind Golang technique when handling things concurrently on the same thread, while forwarding the next work to the free processor/thread when the first blocks."}, {"owner": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 0, "creation_date": 1496835485, "post_id": 44397886, "comment_id": 75821892, "body": "You said: <code>But laziness and parallelism are not incompatible; at least not if you make sure you have big enough \u201cchunks\u201d of strictness in it</code>, can elaborate more on this please? Who controls the <code>big enough chunk</code>? And, what makes it strict, you mean I should program the functions first hand as strict?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 0, "creation_date": 1496836441, "post_id": 44397886, "comment_id": 75822599, "body": "@securecurve no, you normally don&#39;t need to change the functions themselves. Just when you want two <i>results</i> computed in parallel, it may be necessary to <i>force</i> them to normal form before the spark thinks it&#39;s done with its work."}, {"owner": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 0, "creation_date": 1496836869, "post_id": 44397886, "comment_id": 75822961, "body": "How to force them in normal form (you mean strict?) ? Programmatically, using compiler directive or else?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 0, "creation_date": 1496838034, "post_id": 44397886, "comment_id": 75823795, "body": "Classically, with the <a href=\"http://hackage.haskell.org/package/parallel-3.2.1.1/docs/Control-Parallel.html#v:pseq\" rel=\"nofollow noreferrer\"><code>pseq</code> operator</a>, or its \u201cdeep\u201d pendants from the <a href=\"http://hackage.haskell.org/package/deepseq-1.4.2.0/docs/Control-DeepSeq.html#v:rnf\" rel=\"nofollow noreferrer\">deepseq library</a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 0, "creation_date": 1496838271, "post_id": 44397886, "comment_id": 75823992, "body": "For example, if you have some expensive computation that yields a list <code>exl</code> as its result, you would in principle just write <code>exl `par` otherStuff</code> to compute <code>exl</code> in parallel with some <code>otherStuff</code>. But now that computation might be lazy and only generate list elements <i>as needed</i>. In this case, the spark would fizzle before actually finishing the list, but you could force it to actually compute the whole list by writing <code>(rnf exl `pseq` ()) `par` otherStuff</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 0, "creation_date": 1496838433, "post_id": 44397886, "comment_id": 75824133, "body": "...it&#39;s not difficult, but definitely can be a bit confusing to think about, for instance I right now try to recall for what we need the distinction between <code>seq</code> and <code>pseq</code> again."}, {"owner": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 0, "creation_date": 1496839077, "post_id": 44397886, "comment_id": 75824597, "body": "Very much appreciated for the detailed explanation"}, {"owner": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 0, "creation_date": 1496914598, "post_id": 44397886, "comment_id": 75861457, "body": "The idea that you propose in <code>pipe dreams</code> section is very much like <code>work stealing notion</code> of Haskell on one computer (without hash broadcast), but we need to think of it in terms of computers-in-a-cluster rather than threads in one computer. Can Cloud Haskell do that job (or any other alternative)?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "edited": false, "score": 0, "creation_date": 1496918759, "post_id": 44397886, "comment_id": 75864335, "body": "Well, the big difference is memory. The sparks in the work-stealing system are all ploughing different, possibly overlapping regions of a single field, as it were. In fact, the threads generally <i>rely</i> on work already having been done by others: there&#39;s no explicit passing of information between threads, ever. In the end you just reap the harvest with a single IO action. \u2013 None of this works as such in a distributed setting. On a cluster, you could fake it with a parallel file system, but I doubt it would be a good idea."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1496781659, "last_edit_date": 1496781659, "creation_date": 1496775719, "answer_id": 44397886, "question_id": 44393439, "link": "https://stackoverflow.com/questions/44393439/how-haskell-handles-parallel-computing-on-a-multicore-machine-cluster/44397886#44397886", "title": "How Haskell handles parallel computing on a multicore machine/cluster", "body": "<h2>Multithreading</h2>\n\n<p>As far as SMP <sub><sup>p</sup></sub>arallelism<sup>\u2020</sup> is concerned, Haskell is very effective. It's <a href=\"https://stackoverflow.com/questions/15005670/why-is-there-no-implicit-parallelism-in-haskell\">not <em>quite</em> automatic</a>, but the <a href=\"http://hackage.haskell.org/package/parallel-3.2.1.1/docs/Control-Parallel-Strategies.html\" rel=\"noreferrer\">parallel library</a> makes it really easy to parallelise just about anything. Because the sparks are so cheap, you can be pretty careless and just ask for <em>lots</em> of parallelism; the runtime will then know what to do.<br>\nUnlike in most other languages, it is not a big problem if you have highly branched data structures, tricky dynamic algorithms etc. \u2013 thanks to the purely functional paradigm,  parallel Haskell <em>never needs to worry about locks</em> when accessed data is shared.</p>\n\n<p>I think the biggest caveat is memory: GHC's garbage collector is not concurrent, and the functional style is rather allocation-happy.\n<br>Apart from that, it's possible to write programs that <em>look</em> like they're parallel, but really don't do any work at all but just start and immediately return because of laziness. Some testing and experience is still necessary. But laziness and parallelism are not incompatible; at least not if you make sure you have big enough \u201cchunks\u201d of strictness in it. And forcing something strict is largely trivial.</p>\n\n<p>Simpler, common parallelism tasks (which could be expressed in a map-reduce manner, or the classic array-vector stuff \u2013 the ones which are also easy in many languages) can generally be handled even easier in Haskell with libraries that parallelise the <em>data structures</em>; the best-known of these is <a href=\"http://hackage.haskell.org/package/repa\" rel=\"noreferrer\">repa</a>.</p>\n\n<h2>Distributed computing</h2>\n\n<p>There has been quite some work on Cloud Haskell, which is basically Erlang in library form. This kind of task is less straightforward: the idea of any explicit message sending is a bit against Haskell's grain, and many aspects of the workflow become more cumbersome if the language is so heavily focused on its strong static typing (which is in Haskell otherwise often a huge bonus that doesn't just improve safety and performance but also makes it easier to write).</p>\n\n<p>I think it's not far off to use Haskell in a distributed concurrent manner, but we can't say it's mature in that role yet. For distributed concurrent tasks, Erlang itself is certainly the way to go.</p>\n\n<h2>Clusters</h2>\n\n<p>Honestly, Haskell won't help you much at all here. A cluster is of course in principle a special case of a distributed setup, so you <em>could</em> employ Cloud Haskell; but in practice the needs are very different. The HPC world today (and probably quite some time into the future) hinges on MPI, and though <a href=\"https://github.com/bjpop/haskell-mpi\" rel=\"noreferrer\">there is a bit of existing work on MPI bindings</a>, I haven't found them usable, at least not <em>just like that</em>.</p>\n\n<p>MPI is definitely also quite against Haskell's grain, what with it's FORTRAN-oriented array centrism, weird ways of handling types and so on. But unless you go nuts with Haskell's cool features (though often it is <em>so</em> tempting!) there is no reason you couldn't write typical number-crunching code also in Haskell. The only problem is again support/maturity, but it's a considerable problem; so for cluster computing I'd recommend C++, Python or Julia instead.</p>\n\n<p>An interesting alternative is to generate MPI-parallelised C or C++ code from Haskell. <a href=\"http://hackage.haskell.org/package/Paraiso\" rel=\"noreferrer\">Paraiso</a> is one nice project that does this.</p>\n\n<h2>Pipe dreams</h2>\n\n<p>I have often though about what could be done to make the distributed computing feasible in idiomatic Haskell. <em>In principle</em> I believe laziness could be a big help there. The model I'd envision is to let all machines compute <em>independently</em> the same program, but make use of the fact that Haskell evaluation has generally no predetermined order. The order would be <em>randomised</em> on each machine. Also the runtime would track how long some computation branch took to complete, and how big the result is. If a result is deemed both expensive and compact enough to warrant it, it would then be broadcast to the other nodes, together with some suitable hash that would allow them to shortcut that computation.</p>\n\n<p>Such a system would never be quite as efficient as a hand-optimised MPI application, but it could at least offer the same asymptotics in many cases. And it could handle vastly more complex algorithms with ease.</p>\n\n<p>But again, that's totally just my vague hopes for the not-so-near future.</p>\n\n<p><hr>\n<sup>\u2020</sup><sub>You said <em>concurrency</em> (which isn't so much about computation as about <em>interaction</em>), but it seems your question is in essence about pure computations?</sub></p>\n"}], "owner": {"reputation": 5000, "user_id": 829796, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ZNyzI.png?s=128&g=1", "display_name": "securecurve", "link": "https://stackoverflow.com/users/829796/securecurve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1659, "favorite_count": 3, "accepted_answer_id": 44397886, "answer_count": 2, "score": 5, "last_activity_date": 1496781659, "creation_date": 1496761151, "question_id": 44393439, "link": "https://stackoverflow.com/questions/44393439/how-haskell-handles-parallel-computing-on-a-multicore-machine-cluster", "title": "How Haskell handles parallel computing on a multicore machine/cluster", "body": "<p>I'm considering a new language to learn those days to be used in high performance computing on a cluster of computers we have, among those languages, I'm considering Haskell.</p>\n\n<p>I have read some about Haskell, but still have questions about using Haskell in high performance and distributed computing, which the language is known for, but I read some debates about Haskell is not good for those type of systems due to laziness, I can summarize my questions in the following lines:</p>\n\n<ol>\n<li><p>Haskell uses green threads, which is great for handling big number of concurrent connections, but what happens when one of tasks takes longer than average and blocks the rest, does the whole thread block (Node.js style), forward the next task to another processor/thread (Golang), use reductions technique (Erlang), which kicks the task out of processing context after a pre-determined number of ticks, or else?</p></li>\n<li><p>In a distributed computing environment, what happens to lazily-evaluated functions, do they have to be forced strict?</p></li>\n<li><p>If one function/module requires strict evaluation, but it depends on other lazy functions/modules, shall I modify the code of other functions/modules to make them strict as well, or the compiler will handle this to me and force everything in that chain to strict or lazy.</p></li>\n<li><p>When processing a very large sequence of data, how does Haskell handle parallel processing, is it by following some kind of implicit map-reduce technique, or I have do it by myself.</p></li>\n<li><p>Is there a clustering abstract in the language, that handles the computing power for me, that automatically forwards the next task to the free processor wherever it is, be it on the same computer or another computer in the same cluster.</p></li>\n<li><p>How does Haskell ensure fair-share of work is evenly distributed to all the available cores on the same computer or on the available cluster.</p></li>\n</ol>\n"}, {"tags": ["haskell", "stream", "lazy-evaluation", "infinite"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 5, "creation_date": 1496754730, "post_id": 44390868, "comment_id": 75781718, "body": "If you finish it it won&#39;t be infinite anymore, huh?"}], "answers": [{"comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 3, "creation_date": 1496761400, "post_id": 44391311, "comment_id": 75786812, "body": "While denotationally entirely reasonable, the last paragraph (about &quot;instantiat[ing] a full stream in memory&quot;) isn&#39;t correct operationally \u2013 that&#39;s exactly what knot-tying gives you!  For example, given the definition <code>ones = 1 :&gt; ones</code>, the stream will be represented by a single &quot;cons&quot; cell with a pointer back to itself (once the thunks are gone)."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 2, "creation_date": 1496769418, "post_id": 44391311, "comment_id": 75791928, "body": "A more realistic scenario is the stream of keys pressed by the user: you treat this as an infinite stream because there is never a key press that is known to be the last one (ignoring ctrl-D for now). Termination happens when the program ends, not when the stream ends."}, {"owner": {"reputation": 87, "user_id": 7307434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59b2bd1ab0cca1f85bdb3172bd01bc33?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Brandt", "link": "https://stackoverflow.com/users/7307434/jack-brandt"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1496943819, "post_id": 44391311, "comment_id": 75882315, "body": "@AntalSpector-Zabusky that would work well as an answer. Also, so all streams are circular then?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 87, "user_id": 7307434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59b2bd1ab0cca1f85bdb3172bd01bc33?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Brandt", "link": "https://stackoverflow.com/users/7307434/jack-brandt"}, "edited": false, "score": 0, "creation_date": 1496945404, "post_id": 44391311, "comment_id": 75883195, "body": "@JackBrandt  A loop is the only way to represent a conceptually infinite stream in finite memory (absent any other specific logic)."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 87, "user_id": 7307434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59b2bd1ab0cca1f85bdb3172bd01bc33?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Brandt", "link": "https://stackoverflow.com/users/7307434/jack-brandt"}, "edited": false, "score": 0, "creation_date": 1497220189, "post_id": 44391311, "comment_id": 75972761, "body": "@JackBrandt You <i>can</i> represent streams in finite memory, through that circular technique.  But you don&#39;t have to: the stream <code>nats = 0 :&gt; fmap (+1) nats</code> is the infinite stream <code>0 :&gt; 1 :&gt; 2 :&gt; \u2026</code>, but it would take infinite memory if you forced the whole thing.  (Unless, of course, you garbage-collected it along the way\u2026)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1497221007, "post_id": 44391311, "comment_id": 75972918, "body": "@AntalSpector-Zabusky Forcing the stream is what I&#39;ve been referring to; I just forgot the term."}, {"owner": {"reputation": 87, "user_id": 7307434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59b2bd1ab0cca1f85bdb3172bd01bc33?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Brandt", "link": "https://stackoverflow.com/users/7307434/jack-brandt"}, "edited": false, "score": 0, "creation_date": 1497331900, "post_id": 44391311, "comment_id": 76018743, "body": "Yeah, I was just a little still stuck in non-lazy ways. I just watched some video by George Wilson, in it he features &quot;non-empty lists&quot; which helped me understand streams a lot better."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 6, "last_activity_date": 1496755632, "creation_date": 1496755632, "answer_id": 44391311, "question_id": 44390868, "link": "https://stackoverflow.com/questions/44390868/haskell-streams-comonadic-infinite/44391311#44391311", "title": "Haskell Streams (Comonadic): Infinite?", "body": "<p>A stream is inherently infinite; you can't create a finite stream. Compare <code>Stream</code> and <code>List</code>:</p>\n\n<pre><code>data List   a = Empty | a :  List a\ndata Stream a =         a :&gt; Stream a\n</code></pre>\n\n<p>You can create a finite list because of <code>Empty</code> constructor; it is possible to create a <code>List</code> value without referring to another <code>List</code> value. A <code>Stream</code> value, on the other hand, can <em>only</em> be created by using <em>another</em> <code>Stream</code> value. <em>Any</em> time you pattern match on a <code>Stream</code>, you get a value of type <code>a</code> and another <code>Stream</code> value.</p>\n\n<p>\"Finishing\" a stream simply means you stop pulling values from it, not that you ever reach the \"end\" of the stream.</p>\n\n<p>In practice, this means you cannot instantiate a full stream in memory; you can only build it on-demand, typically by calling a function to generate remainder of the stream when pattern matching on the <code>:&gt;</code> constructor.</p>\n"}], "owner": {"reputation": 87, "user_id": 7307434, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/59b2bd1ab0cca1f85bdb3172bd01bc33?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Brandt", "link": "https://stackoverflow.com/users/7307434/jack-brandt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1496755632, "creation_date": 1496754504, "question_id": 44390868, "link": "https://stackoverflow.com/questions/44390868/haskell-streams-comonadic-infinite", "title": "Haskell Streams (Comonadic): Infinite?", "body": "<p>I've seen streams used as the default example of a comonad, but I can't quite figure how they're infinite, but not. </p>\n\n<p>Assume we have the data constructor (<a href=\"http://hackage.haskell.org/package/streams-3.3/docs/Data-Stream-Infinite.html\" rel=\"nofollow noreferrer\">from here</a>)</p>\n\n<pre><code>data Stream a = a :&gt; Stream a\n</code></pre>\n\n<p>How do we finally finish off a stream? Do we write it w/ an undefined at the end? I get that the language is lazy, but somewhere the knot must be cut, right? Am I just wrong?</p>\n"}, {"tags": ["haskell", "haskell-stack", "ghcjs"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1496739957, "post_id": 44385763, "comment_id": 75771293, "body": "Does <code>cabal install alex</code> in <code>~</code> work?"}, {"owner": {"reputation": 1094, "user_id": 1080014, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/302a4e07bfa2c3c09d6a2b68825ca180?s=128&d=identicon&r=PG", "display_name": "Leander", "link": "https://stackoverflow.com/users/1080014/leander"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1496740151, "post_id": 44385763, "comment_id": 75771425, "body": "Doesn&#39;t cabal automatically install into <code>~&#47;.cabal&#47;bin</code>? <code>cabal install alex</code> does work, but doesn&#39;t change the situation with stack. Is there a way to make stack aware of cabal-installed alex?"}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1496740402, "post_id": 44385763, "comment_id": 75771581, "body": "cabal installs into a sandbox by default if one is present, which is why I added that. Don\u2019t know about stack though, sorry."}, {"owner": {"reputation": 1094, "user_id": 1080014, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/302a4e07bfa2c3c09d6a2b68825ca180?s=128&d=identicon&r=PG", "display_name": "Leander", "link": "https://stackoverflow.com/users/1080014/leander"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1496754951, "post_id": 44385763, "comment_id": 75781885, "body": "ok, i installed alex globally via cabal without any sandbox and it unfortunately didn&#39;t work."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496933374, "post_id": 44385763, "comment_id": 75875514, "body": "I think you need to add <code>build-tools: alex</code> to your library in the cabal file."}], "owner": {"reputation": 1094, "user_id": 1080014, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/302a4e07bfa2c3c09d6a2b68825ca180?s=128&d=identicon&r=PG", "display_name": "Leander", "link": "https://stackoverflow.com/users/1080014/leander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 246, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1496739863, "creation_date": 1496739863, "question_id": 44385763, "link": "https://stackoverflow.com/questions/44385763/using-build-tools-alex-with-stack-and-ghcjs", "title": "Using Build-Tools (Alex) with Stack and GHCjs", "body": "<p>I depend on a package that needs alex to build, i also need ghcjs.</p>\n\n<p>When i try to run <code>stack ghci</code>:</p>\n\n<pre><code>language-java-0.2.8: configure (lib)\n\nError:\n--  While building package language-java-0.2.8 using:\n      &lt;long command&gt;\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /Users/LeanderK/Documents/Haskell/exemplator-java_parser/.stack-work/logs/language-java-0.2.8.log\n\nConfiguring language-java-0.2.8...\nCabal-simple_mPHDZzAJ_1.24.2.0_ghcjs-0.2.1.9007019_ghc-8.0.1: The program\n'alex' version &gt;=3.1.3 is required but it could not be found.\n\nWarning: Build failed, but optimistically launching GHCi anyway\nThe following GHC options are incompatible with GHCi and have not been passed to it: -threaded\nConfiguring GHCi with the following packages: exemplator-client\nUsing main module: 1. Package `exemplator-client' component exe:exemplator-client-exe with main-is file:         ..../app/Main.hs\nProgress: 1/2&lt;command line&gt;: cannot satisfy -package language-java-0.2.8\n(use -v for more information)\n</code></pre>\n\n<p>I've tried: <code>stack build alex</code> (just returns, don't have any output. Might work), <code>stack install alex</code> (doesn't work).</p>\n\n<p>Output of <code>stack install alex</code></p>\n\n<pre><code>Couldn't find executable alex in directory .../.stack/snapshots/x86_64-osx/lts-7.19/ghcjs-0.2.1.9007019_ghc-8.0.1/bin/\n</code></pre>\n\n<p>For reference: <a href=\"https://github.com/zyla/language-java/blob/2369019638881d8ea4c564cd1f3eb3b41149769b/language-java.cabal\" rel=\"nofollow noreferrer\">This</a> is the cabal file of the dependency, unfortunately only found on github. <a href=\"https://gist.github.com/LeanderK/abe9a3854ada35570aca5188f1711a84\" rel=\"nofollow noreferrer\">This</a> is my stack and my <a href=\"https://gist.github.com/LeanderK/d132905d57723183b1130d8e85dccf7e\" rel=\"nofollow noreferrer\">cabal</a> file. There is also a <a href=\"https://www.reddit.com/r/haskell/comments/6ew2kq/need_help_with_stack_setup/\" rel=\"nofollow noreferrer\">reddit</a> discussion that didn't go anywhere.</p>\n"}, {"tags": ["haskell", "gadt", "type-families"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1496723407, "post_id": 44380767, "comment_id": 75763046, "body": "I don&#39;t think you can do this with a <i>constructor</i> specifically, since the final codomain must be syntactically the data type you are defining.  But if you make a function which constructs <code>D</code>s I think you can, by making the codomain a type family"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1496735707, "post_id": 44380767, "comment_id": 75768642, "body": "This looks as if it would make type inference even harder than it is, for little gain. You can use <code>D :: F a -&gt; D a</code> where <code>F</code> returns a tuple type of different length depending on <code>a</code>. It requires more boxing, but not that much."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1496772062, "post_id": 44380767, "comment_id": 75793376, "body": "Why do you want to do this?"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1496769061, "creation_date": 1496769061, "answer_id": 44395954, "question_id": 44380767, "link": "https://stackoverflow.com/questions/44380767/constructors-with-variable-number-of-arguments/44395954#44395954", "title": "Constructors with variable number of arguments", "body": "<p>I'm not sure if this is exactly what @luqui had in mind in the comment above, but you can create a smart constructor in a type class that dispatches on the type of its first argument (or any fixed number of initial arguments) to determine the count and types of remaining arguments via a type family:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\ndata D = Int2 Int Int\n       | Double1 Double\n       deriving (Show)\n\nclass D1 a where\n  d :: a -&gt; T2 a\ntype family T2 a where\n  T2 Int = Int -&gt; D\n  T2 Double = D\n\ninstance D1 Int where\n  d x = \\y -&gt; Int2 x y     -- or just `d = Int2`\ninstance D1 Double where\n  d x = Double1 x          -- or just `d = Double1`\n</code></pre>\n\n<p>After which:</p>\n\n<pre><code>&gt; d (2 :: Int) 3\nInt2 2 3\n&gt; d (2 :: Double)\nDouble1 2.0\n&gt; \n</code></pre>\n\n<p>It's not clear to me how to generalize this to a situation that requires conditional dispatch:</p>\n\n<pre><code>data D = IntStringDouble Int String Double\n       | Int2 Int Int\n       | Double1 Double\n       deriving (Show)\n</code></pre>\n\n<p>since you'd need something like:</p>\n\n<pre><code>T2 Int = a -&gt; T3 a\n</code></pre>\n\n<p>with <code>T3</code> an additional type family for the next step in the dispatch, and I don't think there's any way to have the RHS of a type family be polymorphic.  Maybe someone else can see a way.</p>\n\n<p>Anyway, it's all probably more trouble than it's worth.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1496769061, "creation_date": 1496718408, "question_id": 44380767, "link": "https://stackoverflow.com/questions/44380767/constructors-with-variable-number-of-arguments", "title": "Constructors with variable number of arguments", "body": "<p>Using a few extensions, I can do something like this:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE DataKinds #-}\n\ntype family TF (a :: Bool) where\n  TF 'True = Int\n  TF 'False = Double\n\ndata D a where\n  D :: TF a -&gt; D a\n</code></pre>\n\n<p>Notice the constructor <code>D</code> can work in two ways. Either:</p>\n\n<pre><code>D :: Int -&gt; D 'True\n</code></pre>\n\n<p>or</p>\n\n<pre><code>D :: Double -&gt; D 'False\n</code></pre>\n\n<p>Using this pattern, I can completely change the arguments to the constructor depending on it's type, whilst reusing it's name.</p>\n\n<p>However, I'd also like the number of arguments to depend on it's name. </p>\n\n<p>I know I could just replace some arguments with <code>()</code> or <code>Void</code> but I'd rather remove them entirely.</p>\n\n<p>Is there anyway to do this?</p>\n"}, {"tags": ["haskell", "floating-point", "nan"], "comments": [{"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496709357, "post_id": 44379638, "comment_id": 75760153, "body": "One thing I found was that constraining <code>round $ 0&#47;0 :: Integral b =&gt; b</code> such that <code>b :: Int</code> yields <code>0</code>, while <code>b :: Integer</code> yields the negative number."}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 1, "creation_date": 1496711001, "post_id": 44379638, "comment_id": 75760429, "body": "The source of the issue is <code>properFraction</code> which is used to implement <code>round</code>, test it with: <code>fst $ properFraction $ (0&#47;0 :: Double) :: Integer</code>. If you test with <code>fst $ properFraction $ (0&#47;0 :: Float) :: Integer</code>, you get <code>-510423550381407695195061911147652317184</code> instead. <code>properFraction</code> is implemented here: <a href=\"https://github.com/ghc/ghc/blob/master/libraries/base/GHC/Float.hs#L320-L331\" rel=\"nofollow noreferrer\">github.com/ghc/ghc/blob/master/libraries/base/GHC/&hellip;</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1496711891, "post_id": 44379638, "comment_id": 75760611, "body": "Well... what is your definition of &quot;more sanely&quot;? What should it do instead? I honestly can&#39;t think of a good behavior for <code>round NaN</code>."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1496731368, "post_id": 44379638, "comment_id": 75766176, "body": "@DanielWagner an error would be more sane than returning an arbitrary number..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1496735930, "post_id": 44379638, "comment_id": 75768769, "body": "Perhaps it would be nice to also have a function <code>roundFP :: Double -&gt; Double</code> which 1) can perform rounding without an intermediate integral type, and 2) can map NaN to NaN."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496739876, "post_id": 44379638, "comment_id": 75771238, "body": "@chi the good news is that actually <code>round NaN &lt; -Infinity</code>, so it would be possible to just make <code>fromIntegral</code> yield NaN again for those cases."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1496744277, "post_id": 44379638, "comment_id": 75774328, "body": "@leftaroundabout the bad news is that <code>not (round NaN &gt; -Infinity)</code> ;)."}], "answers": [{"comments": [{"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 1, "creation_date": 1496808428, "post_id": 44387322, "comment_id": 75805976, "body": "As cool as this explanation is, I think it fails to capture the issue here. Bottom line: <code>round</code> is a partial function, and it&#39;s meaningless to return an answer. So, it should throw an error. Just like integer division by zero does."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1496809422, "post_id": 44387322, "comment_id": 75806208, "body": "It&#39;s worth remembering that when <code>round</code> was originally written the IEEE standard was not yet prevalent and many computers used other formats, lacking NaN."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 0, "creation_date": 1496824233, "post_id": 44387322, "comment_id": 75813739, "body": "@LeventErkok  why should <code>round</code> throw? Why shouldn&#39;t <code>0&#47;0</code> throw in order to make sure that a <code>Double</code> is never <code>NaN</code>? After all, that&#39;s the behaviour with <code>div x 0</code> or <code>x % 0</code>. IIRC, early floating point implementations even just HALTed in that case (greetings from the 90s).  That being said, the report isn&#39;t clear on the semantics of <code>Double</code>, it just tells us that it&#39;s a double precision floating point number, which <i>usually</i>  includes (silent) <code>NaN</code>, but an implementation might as well use signalling <code>NaN</code>s, which would remove the problem in <code>round</code> completely."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1496828176, "post_id": 44387322, "comment_id": 75816586, "body": "@augustss wasn&#39;t <code>round</code> written in a time when FPUs were still separately sold and not part of your usual CPU (yet), unless you had a lot of money to spend?"}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 1, "creation_date": 1496856533, "post_id": 44387322, "comment_id": 75836965, "body": "@Zeta: A double can be a <code>NaN</code>. If you buy into IEEE754, that <i>is</i> the semantics you have to support. There&#39;s neither a choice nor a question there. The issue here is that <code>round</code> says it&#39;ll give you an <code>Integral</code> value, and there&#39;s just no good value to map <code>NaN</code> to, as you aptly observed yourself. A better type of <code>round</code> would be to return a <code>Maybe</code> value; barring that, you have no option but to throw an exception. Also, Lennart is quite right that some of these functions do predate IEEE754 itself, so there&#39;s historical perspective here too. But that doesn&#39;t justify doing the wrong thing."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 0, "creation_date": 1496904168, "post_id": 44387322, "comment_id": 75854786, "body": "@LeventErkok I don&#39;t justify <code>round</code>&#39;s behaviour, I just try to explain it. I&#39;m aware of those issues and pointing to more. Even without <code>NaN</code>, <code>round</code> returns wrong results if the <code>Integral</code> is too small, e.g. <code>round 10e60 :: Int</code>. An exception in <code>round</code> would be adequate at the moment, since it follows the behaviour of <code>div x 0</code> or <code>succ maxBound</code> and other, seemingly total functions. But that leaves the domain of &quot;why do I get the result I get&quot; and enters the world of &quot;what should actually happen in a better implementation&quot; :)."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 9, "last_activity_date": 1496747449, "last_edit_date": 1496747449, "creation_date": 1496744217, "answer_id": 44387322, "question_id": 44379638, "link": "https://stackoverflow.com/questions/44379638/round-nan-in-haskell/44387322#44387322", "title": "Round NaN in Haskell", "body": "<p><strong>TL;DR:</strong> <code>NaN</code> have an arbitrary representation between <code>2 ^ 1024</code> and <code>2 ^ 1025</code> (bounds not included), and <code>- 1.5 * 2 ^ 1024</code> (which is <em>one possible</em>) <code>NaN</code> happens to be the one you hit.</p>\n\n<hr>\n\n<h1>Why any reasoning is off</h1>\n\n<blockquote>\n  <p>What is happening here?</p>\n</blockquote>\n\n<p>You're entering the region of undefined behaviour. Or at least that is what you would call it in some other languages. The report defines <code>round</code> as follows:</p>\n\n<blockquote>\n  <h3><a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch6.html#x13-1350006.4.6\" rel=\"noreferrer\"> 6.4.6 Coercions and Component Extraction</a></h3>\n  \n  <p>The <code>ceiling</code>, <code>floor</code>, <code>truncate</code>, and <code>round</code> functions each take a real fractional argument and return an integral result. \u2026 <code>round x</code> returns the nearest integer to <code>x</code>, the even integer if <code>x</code> is equidistant between two integers.</p>\n</blockquote>\n\n<p>In our case <code>x</code> does not represent a number to begin with. According to 6.4.6, <code>y = round x</code> should fulfil that any other <code>z</code> from <code>round</code>'s codomain has an equal or greater distance:</p>\n\n<pre><code>y = round x \u21d2 \u2200z : dist(z,x) &gt;= dist(y,x)\n</code></pre>\n\n<p>However, the distance (aka the subtraction) of numbers is defined only for, well, numbers. If we used</p>\n\n<pre><code>dist n d = fromIntegral n - d\n</code></pre>\n\n<p>we get in trouble soon: any operation that includes <code>NaN</code> will return <code>NaN</code> again, and comparisons on <code>NaN</code> fail, so our property above <strong>does not hold for any</strong> <code>z</code> if <code>x</code> was a <code>NaN</code> to begin with. If we check for <code>NaN</code>, we can return any value, but then our property <strong>holds for all pairs</strong>:</p>\n\n<pre><code>dist n d = if isNaN d then constant else fromIntegral n - d\n</code></pre>\n\n<p>So we're completely arbitrary in what <code>round x</code> shall return if <code>x</code> was not a number. </p>\n\n<h1>Why do we get that large number regardless?</h1>\n\n<p>\"OK\", I hear you say, \"that's all fine and dandy, but why do I get that number?\" That's a good question.</p>\n\n<blockquote>\n  <p>Is this behavior intended?</p>\n</blockquote>\n\n<p>Somewhat. It isn't really intended, but to be expected. First of all, we have to know how <code>Double</code> works. </p>\n\n<h2>IEE 754 double precision floating point numbers</h2>\n\n<p>A <code>Double</code> in Haskell is usually a IEEE 754 compliant double precision floating point number, that is a number that has 64 bits and is represented with</p>\n\n<pre><code>x = s * m * (b ^ e)\n</code></pre>\n\n<p>where <code>s</code> is a single bit, <code>m</code> is the mantissa (52 bits) and <code>e</code> is the exponent (11 bits, <code>floatRange</code>). <code>b</code> is the base, and its usually <code>2</code> (you can check with <code>floadRadix</code>). Since the value of <code>m</code> is normalized, every well-formed <code>Double</code> has a unique representation. </p>\n\n<h2>IEEE 754 NaN</h2>\n\n<p>Except <code>NaN</code>. <code>NaN</code> is represented as the e<sub>max</sub>+1, <strong><em>as well as a non-zero mantissa</em></strong>. So if the bitfield </p>\n\n<pre><code>SEEEEEEEEEEEMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\n</code></pre>\n\n<p>represents a <code>Double</code>, what's a valid way to represent <code>NaN</code>?</p>\n\n<pre><code>?111111111111000000000000000000000000000000000000000000000000000\n            ^\n</code></pre>\n\n<p>That is, a single <code>M</code> is set to <code>1</code>, the other are not necessary to set this notion. The sign is arbitrary. Why only a single bit? Because its sufficient.</p>\n\n<h2>Interpret NaN as <code>Double</code></h2>\n\n<p>Now, when we ignore the fact that this is a malformed <code>Double</code>\u2014a <code>NaN</code>\u2013 and really, <em>really</em>, <strong><em>really</em></strong> want to interpret it as number, what number would we get?</p>\n\n<pre><code>m = 1.5\ne = 1024\n\nx = 1.5 * 2 ^ 1024\n  = 3 * 2 ^ 1024 / 2\n  = 3 * 2 ^ 1023\n</code></pre>\n\n<p>And lo and behold, that's exactly the number you get for <code>round (0/0)</code>:</p>\n\n<pre><code>ghci&gt; round $ 0 / 0\n-269653970229347386159395778618353710042696546841345985910145121736599013708251444699062715983611304031680170819807090036488184653221624933739271145959211186566651840137298227914453329401869141179179624428127508653257226023513694322210869665811240855745025766026879447359920868907719574457253034494436336205824\nghci&gt; negate $ 3 * 2 ^ 1023\n-269653970229347386159395778618353710042696546841345985910145121736599013708251444699062715983611304031680170819807090036488184653221624933739271145959211186566651840137298227914453329401869141179179624428127508653257226023513694322210869665811240855745025766026879447359920868907719574457253034494436336205824\n</code></pre>\n\n<p>Which brings our small adventure to a halt. We have a <code>NaN</code>, which yields a <code>2 ^ 1024</code>, and we have some non-zero mantissa, which yields a result with absolute value between <code>2 ^ 1024 &lt; x &lt; 2 ^ 1025</code>.</p>\n\n<p>Note that this isn't the only way <code>NaN</code> can get represented:</p>\n\n<blockquote>\n  <p>In IEEE 754, NaNs are often represented as floating-point numbers with the exponent e<sub>max</sub> + 1 and nonzero significands. Implementations are free to put system-dependent information into the significand. Thus there is not a unique NaN, but rather a whole family of NaNs. </p>\n</blockquote>\n\n<p>For more information, see the <a href=\"https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html\" rel=\"noreferrer\">classic paper on floating point numbers by Goldberg</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": false, "score": 2, "last_activity_date": 1496808497, "last_edit_date": 1496808497, "creation_date": 1496800706, "answer_id": 44402285, "question_id": 44379638, "link": "https://stackoverflow.com/questions/44379638/round-nan-in-haskell/44402285#44402285", "title": "Round NaN in Haskell", "body": "<p>This has long been observed as a problem. Here're a few tickets filed against GHC on this very topic:</p>\n\n<ul>\n<li><a href=\"https://ghc.haskell.org/trac/ghc/ticket/3070\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/3070</a></li>\n<li><a href=\"https://ghc.haskell.org/trac/ghc/ticket/11553\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/11553</a></li>\n<li><a href=\"https://ghc.haskell.org/trac/ghc/ticket/3676\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/3676</a></li>\n</ul>\n\n<p>Unfortunately, this is a thorny issue with lots of ramifications. My personal belief is that this is a genuine bug and it should be fixed properly by throwing an error. But you can read the comments on these tickets to get an understanding of the tricky issues preventing GHC from implementing a proper solution. Essentially, it comes down to speed vs. correctness, and this is one point where (i) the Haskell report is woefully underspecified, and (ii) GHC compromises the latter for the former.</p>\n"}], "owner": {"reputation": 717, "user_id": 2905219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bde88eb92833e086844c9bf1a254c66?s=128&d=identicon&r=PG&f=1", "display_name": "echinodermata", "link": "https://stackoverflow.com/users/2905219/echinodermata"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1335, "favorite_count": 1, "answer_count": 2, "score": 16, "last_activity_date": 1496808497, "creation_date": 1496708886, "question_id": 44379638, "link": "https://stackoverflow.com/questions/44379638/round-nan-in-haskell", "title": "Round NaN in Haskell", "body": "<p>To my great surprise, I found that rounding a NaN value in Haskell returns a gigantic negative number:</p>\n\n<pre><code>round (0/0)\n-269653970229347386159395778618353710042696546841345985910145121736599013708251444699062715983611304031680170819807090036488184653221624933739271145959211186566651840137298227914453329401869141179179624428127508653257226023513694322210869665811240855745025766026879447359920868907719574457253034494436336205824\n</code></pre>\n\n<p>The same thing happens with floor and ceiling.</p>\n\n<p>What is happening here? Is this behavior intended? Of course, I understand that anyone who doesn't want this behavior can always write another function that checks isNaN - but are there existing alternative standard library functions that handle NaN more sanely (for some definition of \"more sanely\")?</p>\n"}, {"tags": ["haskell", "monads", "timing"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 4, "creation_date": 1496697304, "post_id": 44377763, "comment_id": 75756497, "body": "It&#39;s probably better to delegate benchmarking to a specialized tool, e.g.  <a href=\"http://www.serpentine.com/criterion/\" rel=\"nofollow noreferrer\">serpentine.com/criterion</a>"}, {"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1496697875, "post_id": 44377763, "comment_id": 75756700, "body": "Thank you for that link! It seems a little bit too difficult for me right now, so I think I still try to stick to a basic approach before using libraries like that one, as I want to learn how to do thinks like that."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1496699274, "post_id": 44377763, "comment_id": 75757253, "body": "It is difficult to do benchmarking properly and doubly so in a lazy language. If you want accurate results, I do not suggest rolling your own."}, {"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 1, "creation_date": 1496699413, "post_id": 44377763, "comment_id": 75757311, "body": "I should probably have emphasized more that this is not about getting accurate benchmarking results, but just an example I constructed in order to learn how to work with these monads, as they are still difficult to understand for me."}], "answers": [{"comments": [{"owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1496699868, "post_id": 44378200, "comment_id": 75757519, "body": "I have found snippets like that one so far, but I don&#39;t see how to apply this if you want to measure the times for all <code>n=1,2,...,max</code> and not for just a slinge <code>n</code>, so you&#39;d need some kind of <code>loop</code> over those <code>n</code>, but that is the point where I am stuck."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "edited": false, "score": 0, "creation_date": 1496700381, "post_id": 44378200, "comment_id": 75757719, "body": "@flawr But your own code does such a loop, using recursion. It&#39;s probably not the best style, but it works. I&#39;d introduce the calls to <code>getCurrentTime</code> in your code."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1496699150, "creation_date": 1496699150, "answer_id": 44378200, "question_id": 44377763, "link": "https://stackoverflow.com/questions/44377763/repeated-timing-of-function/44378200#44378200", "title": "Repeated timing of function", "body": "<p>You probably want something like this. Adapt the following basic example as needed for your recursive function.</p>\n\n<pre><code>import Data.Time.Clock\nimport Control.Exception (evaluate)\n\nmain :: IO ()\nmain = do\n  putStrLn \"Enter a number\"\n  n &lt;- readLn\n  start &lt;- getCurrentTime\n  let fact = product [1..n] :: Integer\n  evaluate fact  -- this is needed, otherwise laziness would postpone the evaluation\n  end &lt;- getCurrentTime\n  putStrLn $ \"Time elapsed: \" ++ show (diffUTCTime end start)\n  -- putStrLn $ \"The result was \" ++ show fact\n</code></pre>\n\n<p>Uncomment the last line to print the result (it gets very large very quickly).</p>\n"}, {"tags": [], "owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "is_accepted": true, "score": 0, "last_activity_date": 1497296762, "creation_date": 1497296762, "answer_id": 44507555, "question_id": 44377763, "link": "https://stackoverflow.com/questions/44377763/repeated-timing-of-function/44507555#44507555", "title": "Repeated timing of function", "body": "<p>I finally managed to find a solution. In this case we're measuring the \"real\" time in ms.</p>\n\n<pre><code>import Data.Time\nimport Data.Time.Clock.POSIX\n\nf n = sum[0..n]\n\ngetTime = getCurrentTime &gt;&gt;= pure . (1000*) . utcTimeToPOSIXSeconds &gt;&gt;= pure . round\n\nmain = do \n    maxns &lt;- getLine \n    let maxn = (read maxns)::Int\n    t0 &lt;- getTime \n    loop 1 maxn t0\n     where loop n maxn t0|n==maxn = return ()\n           loop n maxn t0\n             = do \n                 putStrLn $ \"fun eval: \" ++ (show n) ++ \", \" ++ (show $ (f n)) \n                 t &lt;- getTime\n                 putStrLn $ \"time: \" ++ show (t-t0); \n                 loop (n+1) maxn t0\n</code></pre>\n"}], "owner": {"reputation": 5481, "user_id": 2913106, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/cM7Yq.jpg?s=128&g=1", "display_name": "flawr", "link": "https://stackoverflow.com/users/2913106/flawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 44507555, "answer_count": 2, "score": 3, "last_activity_date": 1497296762, "creation_date": 1496697035, "question_id": 44377763, "link": "https://stackoverflow.com/questions/44377763/repeated-timing-of-function", "title": "Repeated timing of function", "body": "<p>I have a very simple function <code>f :: Int -&gt; Int</code> and I want to write a program that calls <code>f</code> for each <code>n = 1,2,...,max</code>. After each call of <code>f</code> the (cumulative) time that was used up to that point should be displayed (along with <code>n</code> and <code>f n</code>). How can this be implemented?</p>\n\n<p>I'm still really new to input/output in Haskell, so this is what I've tried so far (using some toy example function <code>f</code>)</p>\n\n<pre><code>f :: Int -&gt; Int\nf n = sum [1..n]\n\nevalAndTimeFirstN :: Int -&gt; Int -&gt; Int -&gt; IO()\nevalAndTimeFirstN n max time = \n  if n == max \n   then return () -- in the following we have to calculate the time difference from start to now\n   else let str =  (\"(\" ++ (show n) ++  \", \" ++ (show $ f n) ++ \", \"++ (show time)++ \")\\n\") \n         in putStrLn str &gt;&gt; evalAndTimeFirstN (n+1) max time -- here we have to calculate the time difference\n\nmain :: IO()\nmain = evalAndTimeFirstN 1 5 0\n</code></pre>\n\n<p>I don't quite see how I have to introduce the timing here. (The <code>Int</code> for <code>time</code> probably has to be replaced with something else.)</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 2, "last_activity_date": 1496695231, "creation_date": 1496695231, "answer_id": 44377331, "question_id": 44377330, "link": "https://stackoverflow.com/questions/44377330/repeat-state-until-it-doesnt-change-is-stable/44377331#44377331", "title": "Repeat state until it doesn&#39;t change / is stable", "body": "<p>You can roll-your-own higher level recursive transform, using <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-State-Strict.html#v:get\" rel=\"nofollow noreferrer\"><code>get</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#v:unless\" rel=\"nofollow noreferrer\"><code>unless</code></a></p>\n\n<pre><code>untilStable :: Eq s =&gt; State s () -&gt; State s ()\nuntilStable stateTransform = do\n  before &lt;- get\n  stateTransform\n  after &lt;- get\n  unless (before == after) $ untilStable stateTransform\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496699412, "post_id": 44378096, "comment_id": 75757310, "body": "This is a fair point in the case you only need to take a peek at the state, but if you want to do some additional side-effects, as in the case of <code>liftIO</code> this will not suffice. So +1 for side-stepping the issue, but... ;)"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496712154, "post_id": 44378096, "comment_id": 75760663, "body": "There&#39;s no <code>liftIO</code>ing to be done with <code>State s ()</code>."}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496712198, "post_id": 44378096, "comment_id": 75760673, "body": "I&#39;m generalizing to <code>StateT s m ()</code> ;)"}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 2, "creation_date": 1496774239, "post_id": 44378096, "comment_id": 75794645, "body": "Btw, you are computing <code>f a</code> twice, a let-binding would be nice here ;)"}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 5, "last_activity_date": 1496785236, "last_edit_date": 1496785236, "creation_date": 1496698716, "answer_id": 44378096, "question_id": 44377330, "link": "https://stackoverflow.com/questions/44377330/repeat-state-until-it-doesnt-change-is-stable/44378096#44378096", "title": "Repeat state until it doesn&#39;t change / is stable", "body": "<p>You can do this in <code>State</code>, but there's no particular benefit. Why not:</p>\n\n<pre><code>idempotently :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\nidempotently f a = if a' == a then a else idempotently f a' where a' = f a\n\nidempotentlyM :: Eq s =&gt; (s -&gt; s) -&gt; State s ()\nidempotentlyM f = modify (idempotently f)\n</code></pre>\n\n<p>If you start with a <code>State s ()</code>, you can <code>execState</code> it to get your <code>s -&gt; s</code> out.</p>\n\n<p>Of course, there's no guarantee that <code>f</code> doesn't diverge, so <code>idempotently f</code> may never terminate.</p>\n"}, {"comments": [{"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1496734919, "post_id": 44378173, "comment_id": 75768167, "body": "Would <code>fix</code> even be applicable if not in a monadic context? I&#39;m suspecting it&#39;s not quite what would be needed, as it doesn&#39;t seem to have any concept of comparing values of successive iterations."}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "reply_to_user": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1496771887, "post_id": 44378173, "comment_id": 75793268, "body": "<code>fix</code>, i.e, the non-monadic variant of <code>mfix</code> can be used to implement <code>idempotently</code>. I will update my answer to implement <code>idempotently</code> with it. By values, do you mean the value of the state, or the value of the computation? I also have to ask, why do you want to compute state-transforms until a fixed point? Is your only goal to live within <code>State</code> and not some <code>StateT s m a, m &#47;= Identity</code>? If you want to normalize terms, consider a normalization monad based on  <code>Writer Any</code> since it is inefficient to use <code>(==)</code> at every step."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496772602, "post_id": 44378173, "comment_id": 75793686, "body": "<code>Writer</code> is only efficient for lazy monoids. What are you trying to do?"}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496774090, "post_id": 44378173, "comment_id": 75794549, "body": "@dfeuer <code>(&lt;&gt;)</code> for <code>Any</code> should be lazy in the second argument if the first argument is <code>True</code> but strict in all arguments if the first is <code>False</code>. <code>Writer [a]</code> will be inefficient since <code>(++)</code> has <code>O(n)</code> complexity in the first argument. But for <code>Any</code>, the complexity is always <code>O(1)</code>. We can use <code>Any</code> with <code>True</code> representing a change, and <code>False</code> representing unique normal form, we can then keep applying the rule until we get <code>False</code>."}, {"owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "edited": false, "score": 0, "creation_date": 1496775618, "post_id": 44378173, "comment_id": 75795444, "body": "@Centril I see how <code>fix</code> can be used... thanks! My specific case: I&#39;m changing the stopping condition of the Sudoku solver at <a href=\"https://codereview.stackexchange.com/a/164380/34049\">codereview.stackexchange.com/a/164380/34049</a>. The state is a matrix of potential values for each cell, and when the potential values don&#39;t change between iterations, I want to stop iterating. As far as I can tell, I do just want to live in <code>State</code>."}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496781652, "post_id": 44378173, "comment_id": 75798757, "body": "OK, left you some comments there. The main idea behind <code>Writer Any</code> is that the part of your transformation that changes values knows if a change occurred or not. So why not let inform you of change instead of using <code>(==)</code>? We used this mechanism in our Bachelors thesis, see: <a href=\"https://github.com/DATX02-17-26/DATX02-17-26/blob/dev/libsrc/Norm/CompAssignment.hs\" rel=\"nofollow noreferrer\">github.com/DATX02-17-26/DATX02-17-26/blob/dev/libsrc/Norm/&hellip;</a> and: <a href=\"https://github.com/DATX02-17-26/DATX02-17-26/blob/dev/libsrc/Norm/NormM.hs\" rel=\"nofollow noreferrer\">github.com/DATX02-17-26/DATX02-17-26/blob/dev/libsrc/Norm/&hellip;</a>"}], "tags": [], "owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "is_accepted": false, "score": 4, "last_activity_date": 1496773299, "last_edit_date": 1496773299, "creation_date": 1496699048, "answer_id": 44378173, "question_id": 44377330, "link": "https://stackoverflow.com/questions/44377330/repeat-state-until-it-doesnt-change-is-stable/44378173#44378173", "title": "Repeat state until it doesn&#39;t change / is stable", "body": "<p>You are computing the fix-point of your state transform.\nBut we can't use <code>fix</code> since we are in a monadic context.\nSo let's use a monadic fix-point combinator instead.\nEnter <code>mfix</code>:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad (unless)\nimport Control.Monad.State (MonadState, StateT, get, put)\nimport Control.Monad.Fix (mfix)\nimport Control.Monad.IO.Class (liftIO)\n\nuntilStable :: MonadState s m =&gt; (s -&gt; s -&gt; Bool) -&gt; m a -&gt; m ()\nuntilStable p = mfix $ \\f st -&gt; p &lt;$&gt; get &lt;* st &lt;*&gt; get &gt;&gt;= (`unless` f)\n</code></pre>\n\n<p>I also took the liberty of generalizing your function to so that you can provide a user supplied binary predicate.</p>\n\n<p>Using ghci <code>runState (untilStable (==) $ modify (+1)) 2</code> will never terminate.\nBut with:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>comp :: StateT Int IO ()\ncomp = do\n  s1 &lt;- (+1) &lt;$&gt; get\n  liftIO $ print s1\n  let s2 = if s1 &gt;= 3 then 3 else s1\n  put s2\n</code></pre>\n\n<p>You get:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>&gt; runStateT (untilStable (==) comp) 0\n1\n2\n3\n4\n((),3)\n</code></pre>\n\n<p>This <code>untilStable</code> can be generalized further into:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>untilStable :: MonadState s m =&gt; (s -&gt; s -&gt; Bool) -&gt; m a -&gt; m a\nuntilStable p = mfix $ \\f st -&gt; do\n  before &lt;- get\n  a &lt;- st\n  after  &lt;- get\n  if p before after then pure a else f\n</code></pre>\n\n<p>Now we have freed up what types the computations can result in.</p>\n\n<p>Fix you want to implement <code>idempotently</code> with <code>fix</code>, you can do it like so:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Function (fix)\n\nidempotently :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\nidempotently = fix $ \\i f a -&gt;\n  let a' = f a\n  in if a' == a then a else i f a'\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1496726712, "post_id": 44381834, "comment_id": 75764020, "body": "I love the impenetrability of that <code>untilStable</code> implementation."}], "tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 1, "last_activity_date": 1496778136, "last_edit_date": 1496778136, "creation_date": 1496726100, "answer_id": 44381834, "question_id": 44377330, "link": "https://stackoverflow.com/questions/44377330/repeat-state-until-it-doesnt-change-is-stable/44381834#44381834", "title": "Repeat state until it doesn&#39;t change / is stable", "body": "<p>Taking inspiration from <a href=\"https://stackoverflow.com/a/44378096/1319998\">https://stackoverflow.com/a/44378096/1319998</a> and <a href=\"https://stackoverflow.com/a/23924238/1319998\">https://stackoverflow.com/a/23924238/1319998</a>, you can do this out of <code>State</code> but using some function monad magic...</p>\n\n<pre><code>untilStable :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\nuntilStable = until =&lt;&lt; ((==) =&lt;&lt;)\n</code></pre>\n\n<p>... extracting the <code>s -&gt; s</code> from a state using <code>execState</code></p>\n\n<pre><code>untilStable (execState stateTransformToRunRepeatedly) initialState\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 1, "last_activity_date": 1496778126, "creation_date": 1496778126, "answer_id": 44398547, "question_id": 44377330, "link": "https://stackoverflow.com/questions/44377330/repeat-state-until-it-doesnt-change-is-stable/44398547#44398547", "title": "Repeat state until it doesn&#39;t change / is stable", "body": "<p>Expanding on the answer from <a href=\"https://stackoverflow.com/a/44381834/1319998\">https://stackoverflow.com/a/44381834/1319998</a>, so keeping the iteration out of <code>State</code>, but avoiding the function monad magic with a clearer use of <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:until\" rel=\"nofollow noreferrer\"><code>until</code></a></p>\n\n<pre><code>untilStable :: Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a\nuntilStable f a = until (\\w -&gt; f w == w) f a\n</code></pre>\n\n<p>... and similarly extracting the s -> s from a state using execState</p>\n\n<pre><code>untilStable (execState stateTransformToRunRepeatedly) initialState\n</code></pre>\n\n<p>Point-free style isn't used, but to me it is clearer what's going on.</p>\n\n<p>Also, I wonder if this reveals an inefficiency of both this and <a href=\"https://stackoverflow.com/a/44381834/1319998\">https://stackoverflow.com/a/44381834/1319998</a>, where <code>f a</code> may be computed twice: once privately inside <code>until</code>, and once in the predicate used to test whether to stop.</p>\n"}], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 1, "accepted_answer_id": 44378096, "answer_count": 5, "score": 1, "last_activity_date": 1496785236, "creation_date": 1496695231, "last_edit_date": 1496697354, "question_id": 44377330, "link": "https://stackoverflow.com/questions/44377330/repeat-state-until-it-doesnt-change-is-stable", "title": "Repeat state until it doesn&#39;t change / is stable", "body": "<p>I'm trying to run a state transform repeatedly until the state doesn't change. I've <a href=\"https://www.haskell.org/hoogle/?hoogle=Eq+s+%3D%3E+State+s+%28%29+-%3E+State+s+%28%29\" rel=\"nofollow noreferrer\">searched Hoogle</a> for</p>\n\n<pre><code>Eq s =&gt; State s () -&gt; State s ()\n</code></pre>\n\n<p>but found nothing that looks appropriate.</p>\n\n<p>How can I run a state transform repeatedly until it doesn't change?</p>\n"}, {"tags": ["function", "haskell", "functional-programming", "semantics", "definition"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1496678018, "post_id": 44372763, "comment_id": 75746618, "body": "You can define a new variable of the same name <i>shadowing</i> the previous variable and with a different value, but you can&#39;t change the variable&#39;s value."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1496678051, "post_id": 44372763, "comment_id": 75746635, "body": "You can&#39;t reassign in a .hs file. In GHCi, the REPL lets you redefine a binding, much as if you wrote two nested bindings <code>let x= ... in let x= ... in ...</code>, but this is no reassignment, only shadowing of the outermost <code>x</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1496678163, "post_id": 44372763, "comment_id": 75746691, "body": "Try this in GHCi. <code>x = 10</code> and then <code>f y = x+y</code>. Then, try to &quot;reassign&quot; to <code>x</code>, and observe that <code>f</code> is not affected by that -- <code>f y</code> still returns <code>10+y</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1496681566, "post_id": 44372763, "comment_id": 75748626, "body": "<code>&quot;conanO&#39;Brian&quot; == &quot;conanO&#39;Brien&quot;</code> ==&gt; <code>False</code>."}], "owner": {"reputation": 51, "user_id": 4866770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e45b8a09580b4758a7e41362b41f6?s=128&d=identicon&r=PG", "display_name": "Reef Loretto", "link": "https://stackoverflow.com/users/4866770/reef-loretto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 1, "closed_date": 1496679505, "answer_count": 0, "score": 0, "last_activity_date": 1496677924, "creation_date": 1496677924, "question_id": 44372763, "link": "https://stackoverflow.com/questions/44372763/function-reassignment-in-learn-you-a-haskell-starting-out", "closed_reason": "Duplicate", "title": "Function reassignment in &#39;Learn You a Haskell: Starting Out&#39;", "body": "<p>We create this function:</p>\n\n<pre><code>conanO'Brien = \"It's a-me, Conan O'Brien!\"\n</code></pre>\n\n<p>The author then states, \"Because we can't change what names (and functions) mean once we've defined them, conanO'Brien and the string \"It's a-me, Conan O'Brien!\" can be used interchangeably.\"</p>\n\n<p>Yet, I can make the reassignment <code>conanO'Brian = 2</code> with no trouble. What does he mean by \"we can't change what names (and functions) mean\"?</p>\n"}, {"tags": ["haskell", "emacs", "intero"], "answers": [{"comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1512552979, "post_id": 47656910, "comment_id": 82300774, "body": "This is not an option, I want those options only in intero when I am developing. When I normally compile the project I do not want these to be enabled. Also I do not want to have them appear in any files that are actually tracked in the repo."}, {"owner": {"reputation": 657, "user_id": 1910286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/887d43a6eb4f2f169aebdfcfe0b01db2?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/1910286/matt"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1512568471, "post_id": 47656910, "comment_id": 82310765, "body": "Ah, I misunderstood. I don&#39;t know of a way to accomplish that."}], "tags": [], "owner": {"reputation": 657, "user_id": 1910286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/887d43a6eb4f2f169aebdfcfe0b01db2?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/1910286/matt"}, "is_accepted": false, "score": 0, "last_activity_date": 1512486845, "creation_date": 1512486845, "answer_id": 47656910, "question_id": 44372541, "link": "https://stackoverflow.com/questions/44372541/setting-compiler-options-for-intero-in-emacs/47656910#47656910", "title": "Setting compiler options for intero in emacs", "body": "<p>Updating your cabal file to specify the relevant extensions and ghc-options should work, i.e.:</p>\n\n<pre><code>...\nlib\n  hs-source-dirs:      src\n  ghc-options:         -fdefer-type-errors\n  extensions:          PartialTypeSignatures\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": true, "score": 0, "last_activity_date": 1531570774, "creation_date": 1531570774, "answer_id": 51338435, "question_id": 44372541, "link": "https://stackoverflow.com/questions/44372541/setting-compiler-options-for-intero-in-emacs/51338435#51338435", "title": "Setting compiler options for intero in emacs", "body": "<p>This can now be archived by setting <code>intero-extra-ghc-options</code> and <code>intero-extra-ghci-options</code>.</p>\n"}], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 51338435, "answer_count": 2, "score": 0, "last_activity_date": 1531570774, "creation_date": 1496677152, "question_id": 44372541, "link": "https://stackoverflow.com/questions/44372541/setting-compiler-options-for-intero-in-emacs", "title": "Setting compiler options for intero in emacs", "body": "<p>When I am developing I like to have <code>-fdefer-type-errors</code> and <code>-XPartialTypeSignatures</code> enabled. Currently I just add</p>\n\n<pre><code>{-# LANGUAGE PartialTypeSignatures #-}\n{-# OPTIONS_GHC -fdefer-type-errors #-}\n</code></pre>\n\n<p>to the top of the file I am working with. However this is not ideal as I often forget to remove these lines once I am done. Is there an option to pass these to intero in emacs?</p>\n"}, {"tags": ["haskell", "matrix", "linear-algebra"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1496695888, "creation_date": 1496695888, "answer_id": 44377485, "question_id": 44371591, "link": "https://stackoverflow.com/questions/44371591/decomposing-a-matrix-into-scale-rotation-and-translation-with-haskell/44377485#44377485", "title": "Decomposing a matrix into scale, rotation, and translation with haskell", "body": "<p>Your <code>decomposeMatrix</code> function seems fine (except the rotation matrix is transposed from what you want).</p>\n\n<p>The big problem is your test case:  the quaternion you're using (<code>LA.Quarternion 1 (LA.V3 1 2 3</code>) isn't a unit quaternion, so <code>LA.mkTransformation</code> isn't building a pure rotation.  It's building a combination of rotation and scaling.  Try the example:</p>\n\n<pre><code>decomposeMatrix $ LA.mkTransformation (LA.axisAngle (LA.V3 1 2 3) 1) \n                $ LA.V3 1 2 3\n</code></pre>\n\n<p>which uses <code>LA.axisAngle</code> to build a unit quaternion representing a pure rotation from a vector and angle, and it will work as expected.</p>\n"}], "owner": {"reputation": 347, "user_id": 7552087, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/012e376f941c38969adccc532ec3be94?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew P.", "link": "https://stackoverflow.com/users/7552087/andrew-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 381, "favorite_count": 0, "accepted_answer_id": 44377485, "answer_count": 1, "score": 1, "last_activity_date": 1496695888, "creation_date": 1496674041, "question_id": 44371591, "link": "https://stackoverflow.com/questions/44371591/decomposing-a-matrix-into-scale-rotation-and-translation-with-haskell", "title": "Decomposing a matrix into scale, rotation, and translation with haskell", "body": "<p>I am trying to decompose a matrix into a 3x3 rotation matrix, a scale vector, and a translation vector, using haskell. I am using the matrix from the <a href=\"https://hackage.haskell.org/package/linear\" rel=\"nofollow noreferrer\">linear</a> package. Unfortunately, the package only exports functions for making a matrix from scale, rotation, and translation, not extracting those from a matrix. Therefore, I decided to write a function to do it myself.</p>\n\n<p>However, even though I am using matrices without scaling in them, my function returns a scale vector other than <code>V3 1.0 1.0 1.0</code>.</p>\n\n<pre><code>import qualified Linear.Matrix     as LA\nimport qualified Linear.V4         as LA\nimport qualified Linear.V3         as LA\nimport qualified Linear.Vector     as LA\nimport qualified Linear.Quaternion as LA\n\nimport Control.Lens hiding (deep)\n\n...\n\ndecomposeMatrix :: LA.M44 Double -&gt; (LA.M33 Double, LA.V3 Double, LA.V3 Double)\ndecomposeMatrix m = (rot, scale, trans)\n    where trans = (m ^.LA.column LA._w ^. LA._xyz)\n          scale = LA.V3 sx sy sz\n          sx    = vecLength (m ^.(LA.column LA._x) ^. LA._xyz)\n          sy    = vecLength (m ^.(LA.column LA._y) ^. LA._xyz)\n          sz    = vecLength (m ^.(LA.column LA._z) ^. LA._xyz)\n          rot   = LA.V3 ((m ^. (LA.column LA._x) ^.LA._xyz) LA.^/ sx)\n                        ((m ^. (LA.column LA._y) ^.LA._xyz) LA.^/ sy)\n                        ((m ^. (LA.column LA._z) ^.LA._xyz) LA.^/ sz)\n\nvecLength :: LA.V3 Double -&gt; Double\nvecLength (LA.V3 a b c) = sqrt (a*a + b*b + c*c)\n</code></pre>\n\n<p>Here is how I am running this function in the ghci:</p>\n\n<pre><code>decomposeMatrix $ LA.mkTransformation (LA.Quaternion 1 (LA.V3 1 2 3)) $ LA.V3 1 2 3\n</code></pre>\n\n<p>And this is what I get as the outcome (formatted so you can read it easier): </p>\n\n<pre><code>(V3 (V3 (-0.9259259259259259) 0.37037037037037035 7.407407407407407e-2)\n    (V3 (-8.444006618414981e-2) (-0.8021806287494233) 0.5910804632890487) \n    (V3 0.5965499862718936 0.5965499862718936 (-0.5368949876447042)),\nV3 27.0 23.68543856465402 16.76305461424021,\nV3 1.0 2.0 3.0)\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell", "types", "ghci"], "comments": [{"owner": {"reputation": 574, "user_id": 1504029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/96a8e68ffdcc9aca971108c6a989b74c?s=128&d=identicon&r=PG", "display_name": "Paul Visschers", "link": "https://stackoverflow.com/users/1504029/paul-visschers"}, "edited": false, "score": 1, "creation_date": 1496682579, "post_id": 44371367, "comment_id": 75749178, "body": "I&#39;m pretty sure it&#39;s type defaulting as you suggest. I don&#39;t know enough about the inner workings of type defaulting to really explain why this is happening though."}], "answers": [{"comments": [{"owner": {"reputation": 474, "user_id": 4829993, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5d3b5dfdad633eb7291270e093d5f814?s=128&d=identicon&r=PG&f=1", "display_name": "Henry", "link": "https://stackoverflow.com/users/4829993/henry"}, "edited": false, "score": 0, "creation_date": 1496754210, "post_id": 44373642, "comment_id": 75781308, "body": "Not sure I fully understand, but makes some sense. Thanks!"}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 4, "last_activity_date": 1496691092, "last_edit_date": 1496691092, "creation_date": 1496680909, "answer_id": 44373642, "question_id": 44371367, "link": "https://stackoverflow.com/questions/44371367/how-come-ghci-doesnt-display-the-polymorphic-type-in-this-error-message/44373642#44373642", "title": "How come GHCi doesn&#39;t display the polymorphic type in this error message?", "body": "<p>This is indeed because of <a href=\"https://downloads.haskell.org/~ghc/8.0.2/docs/html/users_guide/ghci.html#type-defaulting-in-ghci\" rel=\"nofollow noreferrer\">GHCi's type defaulting</a>.</p>\n\n<p>The rules for this are described in <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-790004.3.4\" rel=\"nofollow noreferrer\">section 4.3.4 of the Haskell 2010 Report</a> and this part is especially relevant:</p>\n\n<blockquote>\n  <p>Each defaultable variable is replaced by the first type in the default list that is an instance of all the ambiguous variable\u2019s classes. It is a static error if no such type is found.</p>\n</blockquote>\n\n<p>Every variable that is defaultable is replaced by what it defaults to, which is the operation that occurs before the error message is produced.</p>\n\n<p>Type defaulting must occur before type checking, when there is an ambiguous type. In particular, if the type class constraint were kept around instead of defaulted, the expression <code>x :: Int</code> would have an ambiguous type in it as defined in</p>\n\n<blockquote>\n  <p>We say that an expression e has an ambiguous type if, in its type \u2200 u'. cx  \u21d2  t, there is a type variable u in u' that occurs in cx but not in t. Such types are invalid.</p>\n</blockquote>\n\n<p>(Taken from the Haskell 2010 Report, replacing u with an overbar with <code>u'</code>).</p>\n\n<p>Since, if the type were valid, the overall expression would have a type variable (the one constrained by <code>Num</code>) that does not appear in the resulting type (<code>Int</code>) (and the type variable cannot be unified away), the defaulting must occur here before the type checking.</p>\n\n<p>This can be made a bit more explicit by realizing that we are type checking</p>\n\n<pre><code>(x :: forall a. Num a =&gt; a -&gt; a) :: Int\n</code></pre>\n\n<p>It looks like, during unification, if the outermost type constructor does not match (<code>(-&gt;)</code> on the left-hand side and <code>Int</code> on the right-hand side), it must default because it cannot automatically go deeper into the unification (as it could if the outermost type constructor here on the right-hand side were also <code>(-&gt;)</code>).</p>\n\n<p>Here are a few more examples I've tested which follow this behavior:</p>\n\n<pre><code>ghci&gt; :set -XExplicitForAll\nghci&gt; (x :: forall a. Num a =&gt; a -&gt; a) :: Char -&gt; Char  -- Outermost constructor matches, so 'a' can get unified with Char and the 'a' type variable disappears\n\n&lt;interactive&gt;:5:2: error:\n    \u2022 No instance for (Num Char)\n        arising from an expression type signature\n    \u2022 In the expression:\n          (x :: forall a. Num a =&gt; a -&gt; a) :: Char -&gt; Char\n      In an equation for \u2018it\u2019:\n          it = (x :: forall a. Num a =&gt; a -&gt; a) :: Char -&gt; Char\nghci&gt; (x :: forall a. Num a =&gt; a -&gt; a) :: Maybe Char\n\n&lt;interactive&gt;:8:2: error:\n    \u2022 Couldn't match expected type \u2018Maybe Char\u2019\n                  with actual type \u2018Integer -&gt; Integer\u2019\n    \u2022 In the expression: (x :: forall a. Num a =&gt; a -&gt; a) :: Maybe Char\n      In an equation for \u2018it\u2019:\n          it = (x :: forall a. Num a =&gt; a -&gt; a) :: Maybe Char\nghci&gt; (x :: forall a. Num a =&gt; a -&gt; a) :: Either Char Bool\n\n&lt;interactive&gt;:10:2: error:\n    \u2022 Couldn't match expected type \u2018Either Char Bool\u2019\n                  with actual type \u2018Integer -&gt; Integer\u2019\n    \u2022 In the expression:\n          (x :: forall a. Num a =&gt; a -&gt; a) :: Either Char Bool\n      In an equation for \u2018it\u2019:\n          it = (x :: forall a. Num a =&gt; a -&gt; a) :: Either Char Bool\nghci&gt; (x :: forall a. Num a =&gt; (,) a a) :: Either Char Bool\n\n&lt;interactive&gt;:11:2: error:\n    \u2022 Couldn't match expected type \u2018Either Char Bool\u2019\n                  with actual type \u2018(Integer, Integer)\u2019\n    \u2022 In the expression:\n          (x :: forall a. Num a =&gt; (,) a a) :: Either Char Bool\n      In an equation for \u2018it\u2019:\n          it = (x :: forall a. Num a =&gt; (,) a a) :: Either Char Bool\nghci&gt; (x :: forall a. Num a =&gt; (,) a a) :: Char\n\n&lt;interactive&gt;:12:2: error:\n    \u2022 Couldn't match expected type \u2018Char\u2019\n                  with actual type \u2018(Integer, Integer)\u2019\n    \u2022 In the expression: (x :: forall a. Num a =&gt; (,) a a) :: Char\n      In an equation for \u2018it\u2019:\n          it = (x :: forall a. Num a =&gt; (,) a a) :: Char\n</code></pre>\n"}], "owner": {"reputation": 474, "user_id": 4829993, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5d3b5dfdad633eb7291270e093d5f814?s=128&d=identicon&r=PG&f=1", "display_name": "Henry", "link": "https://stackoverflow.com/users/4829993/henry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 44373642, "answer_count": 1, "score": 4, "last_activity_date": 1496691092, "creation_date": 1496673236, "question_id": 44371367, "link": "https://stackoverflow.com/questions/44371367/how-come-ghci-doesnt-display-the-polymorphic-type-in-this-error-message", "title": "How come GHCi doesn&#39;t display the polymorphic type in this error message?", "body": "<p>I am ascribing the type of a variable with type <code>Num a =&gt; a -&gt; a</code> to <code>Int</code>, which throws an error, as expected. However, the error isn't exactly as I expected. </p>\n\n<p><strong>GHCi</strong></p>\n\n<pre><code>\u03bb&gt; let x = typeInference 1\n\u03bb&gt; :t x\nx :: Num a =&gt; a -&gt; a\n\u03bb&gt; x :: Int\n\n&lt;interactive&gt;:141:1: error:\n    \u2022 Couldn't match expected type 'Int'\n                  with actual type 'Integer -&gt; Integer'\n    \u2022 Probable cause: 'x' is applied to too few arguments\n      In the expression: x :: Int\n      In an equation for 'it': it = x :: Int\n\u03bb&gt;\n</code></pre>\n\n<p><strong>typeInferance definition</strong></p>\n\n<pre><code>typeInference :: Num a =&gt; a -&gt; a -&gt; a\ntypeInference x y = x + y + 1\n</code></pre>\n\n<p>I expected the error message to say <code>with actual type 'Num a =&gt; a -&gt; a'</code>, which is the polymorphic type, why doesn't it? Does this have to do with GHCi's type defaulting?</p>\n"}, {"tags": ["haskell", "template-haskell"], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 9, "last_activity_date": 1496667439, "creation_date": 1496667439, "answer_id": 44369483, "question_id": 44369100, "link": "https://stackoverflow.com/questions/44369100/initialize-function-by-file-contents-at-compile-time/44369483#44369483", "title": "Initialize function by file contents at compile time", "body": "<p>Isn't this just</p>\n\n<pre><code>someText :: Text\nsomeText = $(embedStringFile \"path/to/file\")\n</code></pre>\n\n<p>Am I missing something?</p>\n\n<p>(It's the TH splice itself that turns <code>Q Exp</code> into some other type at run-time. You shouldn't need any typeclass instances or anything...)</p>\n"}, {"comments": [{"owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "edited": false, "score": 0, "creation_date": 1496669981, "post_id": 44369564, "comment_id": 75741556, "body": "Thanks! I like both answers, but I&#39;ll accept yours because it&#39;s more detailed."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "edited": false, "score": 0, "creation_date": 1496703261, "post_id": 44369564, "comment_id": 75758626, "body": "@wowofbob thanks, but MathematicalOrchid&#39;s suggestion is better \u2013 <code>embedStringFile</code>, which I wasn&#39;t aware of, is the standard version of <code>fileText</code> and therefore preferrable."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1496667662, "creation_date": 1496667662, "answer_id": 44369564, "question_id": 44369100, "link": "https://stackoverflow.com/questions/44369100/initialize-function-by-file-contents-at-compile-time/44369564#44369564", "title": "Initialize function by file contents at compile time", "body": "<pre class=\"lang-none prettyprint-override\"><code># foo.txt\nbarbazblub\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module FileText where\nimport Language.Haskell.TH\n\nfileText :: FilePath -&gt; Q Exp\nfileText fp = LitE . StringL &lt;$&gt; runIO (readFile fp)\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TemplateHaskell #-}\nmodule Foo where\n\nimport FileText\n\nmain = putStrLn $(fileText \"foo.txt\")\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ runhaskell Foo.hs \nbarbazblub\n</code></pre>\n"}], "owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 44369564, "answer_count": 2, "score": 2, "last_activity_date": 1496667662, "creation_date": 1496666260, "question_id": 44369100, "link": "https://stackoverflow.com/questions/44369100/initialize-function-by-file-contents-at-compile-time", "title": "Initialize function by file contents at compile time", "body": "<p>Is there a way to initialize a function</p>\n\n<pre><code>someText :: Text\n</code></pre>\n\n<p>which value will be stored in a file available at compile time?</p>\n\n<p>I thought I could use TH for that, but for now I just <a href=\"https://hackage.haskell.org/package/file-embed-0.0.10/docs/Data-FileEmbed.html\" rel=\"nofollow noreferrer\">found</a></p>\n\n<pre><code>embedFile :: FilePath -&gt; Q Exp\nrunQ :: Quasi m =&gt; Q a -&gt; m a\n</code></pre>\n\n<p>I can only unwrap <code>Q</code> into <code>IO</code>:</p>\n\n<pre><code>instance Quasi IO    \ninstance Quasi Q\n</code></pre>\n\n<p>I guess I need <code>Identity</code> instance of <a href=\"https://hackage.haskell.org/package/template-haskell-2.10.0.0/docs/Language-Haskell-TH-Syntax.html#t:Quasi\" rel=\"nofollow noreferrer\">Quasi</a>, but there is no one.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1496678014, "post_id": 44367138, "comment_id": 75746617, "body": "The key is that the function given to <code>foldr</code> is non-strict in its second argument."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1496665865, "last_edit_date": 1496665865, "creation_date": 1496659245, "answer_id": 44367138, "question_id": 44366540, "link": "https://stackoverflow.com/questions/44366540/maybe-bails-out-of-fold/44367138#44367138", "title": "Maybe bails out of fold", "body": "<p><code>Maybe</code> ,<code>Just</code>, and <code>Nothing</code> play no active role here. What we see is just laziness at work. Indeed, for any (total) function <code>f</code> and value <code>a</code>, this would also terminate:</p>\n\n<pre><code>foldr (\\x t -&gt; if x &gt; 5 then f x else t) a $ [1..]\n</code></pre>\n\n<p>This is perfectly equivalent to the plain recursion </p>\n\n<pre><code>foo [] = a\nfoo (x:xs) = if x &gt; 5 then f x else foo xs\n</code></pre>\n\n<p>when called as <code>foo [1..]</code>. Eventually, <code>x</code> becomes <code>6</code>, <code>f 6</code> is returned, and no more recursive calls are made.</p>\n"}], "owner": {"reputation": 4143, "user_id": 1034255, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/08361c2fe2bb01912c7a64ac848db2fd?s=128&d=identicon&r=PG", "display_name": "jupp0r", "link": "https://stackoverflow.com/users/1034255/jupp0r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1496665865, "creation_date": 1496657331, "question_id": 44366540, "link": "https://stackoverflow.com/questions/44366540/maybe-bails-out-of-fold", "title": "Maybe bails out of fold", "body": "<p>Why does computing the following expression terminate?</p>\n\n<pre><code>foldr (\\x t -&gt; if x &gt; 5 then Just x else t) Nothing $ [1..]\n</code></pre>\n\n<p>Is there anything special about <code>Maybe</code> (or one of the type classes it implements) that causes evaluation to stop after the lambda returns a <code>Just</code>?</p>\n"}, {"tags": ["haskell", "types", "deriving", "language-extension"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1496673537, "post_id": 44366489, "comment_id": 75743970, "body": "Could you add a minimized version of <code>Ast</code> along with some of the type parameters and typeclasses you want derived?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1496725398, "post_id": 44366489, "comment_id": 75763639, "body": "It&#39;s a neat idea.  My gut tells me you are beyond the automatic deriving mechanism&#39;s power, and it&#39;s time to start looking at <a href=\"https://wiki.haskell.org/Generics\" rel=\"nofollow noreferrer\">generics</a>."}, {"owner": {"reputation": 305, "user_id": 7581653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e2da68e74c8b7b89b6c98095e3292a?s=128&d=identicon&r=PG", "display_name": "Liarokapis Alexandros", "link": "https://stackoverflow.com/users/7581653/liarokapis-alexandros"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1496727771, "post_id": 44366489, "comment_id": 75764429, "body": "@luqui This is my conclusion too. The Deriving language extensions are there for a reason they don&#39;t seem to be powerful enough in this case."}], "answers": [{"tags": [], "owner": {"reputation": 305, "user_id": 7581653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e2da68e74c8b7b89b6c98095e3292a?s=128&d=identicon&r=PG", "display_name": "Liarokapis Alexandros", "link": "https://stackoverflow.com/users/7581653/liarokapis-alexandros"}, "is_accepted": false, "score": 1, "last_activity_date": 1496727308, "creation_date": 1496727308, "answer_id": 44382053, "question_id": 44366489, "link": "https://stackoverflow.com/questions/44366489/deriving-extensions-with-multiparameter-types/44382053#44382053", "title": "Deriving extensions with multiparameter types", "body": "<p>After fiddling around all day I came to the following conclusions:</p>\n\n<p>The Ast presented in the question turned out not to be very flexible.\nIn later stages I want to annotate different nodes in a way that can't\nbe expressed by just parameterizing the original Ast.</p>\n\n<p>So I changed the Ast in order to act as a base for writing new types:</p>\n\n<pre><code>Ast funcdef = Ast funcdef\n    deriving (Show)\n\nHeader id fpartype = Header id (Maybe Type) [fpartype]\n    deriving (Show)\n\nFuncDef header block = FuncDef header block\n    deriving (Show)\n\nBlock stmt = Block [stmt]\n    deriving (Show)\n\nStmt lvalue expr funccall = \n    StmtAssign lvalue expr |\n    StmtFuncCall funccall |\n    ..\n\nExpr expr intConst lvalue funccall =\n    ExprIntConst intConst |\n    ExprLvalue lvalue |\n    ExprFuncCall funccall |\n    expr :+ expr |\n    expr :- expr |\n    ..\n</code></pre>\n\n<p>Now I can simply define a chain of newtypes for each compiler stage.\nThe Ast at the stage of the renamer may be parameterized around the identifier type:</p>\n\n<pre><code>newtype RAst id = RAst { ast :: Ast (RFuncDef id) }\nnewtype RHeader id = RHeader { header :: Header id (RFparType id) }\nnewtype RFuncDef id = RFuncDef { \n    funcDef :: FuncDef (RHeader id) (RBlock id) \n}\n..\nnewtype RExpr id = RExpr { \n    expr :: Expr (RExpr id) RIntConst (RLvalue id) (RFuncCall id) \n}\n</code></pre>\n\n<p>During the typechecking stage the Ast may be parameterized by \nthe different internal types used in the nodes. </p>\n\n<p>This parameterization allows for constructing Asts with <code>Maybe</code> wrapped \nparameters in the middle of each stage.</p>\n\n<p>If everything is ok we can use <code>fmap</code> to remove the <code>Maybe</code>s and prepare the tree for the next stage. There are other ways <code>Functor, Foldable</code> and <code>Traversable</code> are useful so these are a must to have.</p>\n\n<p>At this point I figured that what I want is most likely not possible\nwithout metaprogramming so I searched for a template haskell solution.\nSure enough there is the <strong>genifunctors</strong> library which implements generic\n<code>fmap, foldMap</code> and <code>traverse</code> functions. Using these it's a simple matter\nof writing a few newtype wrappers to make different instances of the required typeclasses around the appropriate parameters:</p>\n\n<pre><code>fmapGAst = $(genFmap Ast)\nfoldMapGAst = $(genFoldMap Ast)\ntraverseGast = $(genTraverse Ast)\n\nnewtype OverT1 t2 t3 t1 = OverT1 {unwrapT1 :: Ast t1 t2 t3 }\nnewtype OverT2 t1 t3 t2 = OverT2 {unwrapT2 :: Ast t1 t2 t3 }\nnewtype OverT3 t1 t2 t3 = OverT3 {unwrapT3 :: Ast t1 t2 t3 }\n\ninstance Functor (OverT1 a b) where\n    fmap f w = OverT1 $ fmapGAst f id id $ unwrapT1 w\n\ninstance Functor (OverT2 a b) where\n    fmap f w = OverT2 $ fmapGAst id f id $ unwrapT2 w\n\ninstance Functor (OverT3 a b) where\n    fmap f w = OverT3 $ fmapGAst id id f $ unwrapT3 w\n\n..\n</code></pre>\n"}], "owner": {"reputation": 305, "user_id": 7581653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e2da68e74c8b7b89b6c98095e3292a?s=128&d=identicon&r=PG", "display_name": "Liarokapis Alexandros", "link": "https://stackoverflow.com/users/7581653/liarokapis-alexandros"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1496727308, "creation_date": 1496657161, "last_edit_date": 1496724539, "question_id": 44366489, "link": "https://stackoverflow.com/questions/44366489/deriving-extensions-with-multiparameter-types", "title": "Deriving extensions with multiparameter types", "body": "<p>I have an Ast type constructor, parameterized by the identifier type.\nUsing the DeriveFunctor, DeriveFoldable and DeriveTraversable extensions\nit is possible to automatically create the appropriate instances.</p>\n\n<p>Now I find it useful to introduce more type parameters but unfortunately\nthe above method doesn't scale. Ideally I would like to be able to\nwrap my Ast type in selection types which would allow me to fmap to\nthe appropriate type parameters. Is there some way to achieve a similar\neffect without having to define the instances myself?</p>\n\n<p>edit:</p>\n\n<p>Here is a small example of what the original Ast looked like:</p>\n\n<pre><code>Ast id = Ast (FuncDef id)\n    deriving (Show, Functor, Foldable, Traversable)\n\nFuncDef id = FuncDef id [Fparam id] (Block id)\n    deriving (Show, Functor, Foldable, Traversable)\n\nBlock id = Block [Stmt id]\n    deriving (Show, Functor, Foldable, Traversable)\n\n..\n</code></pre>\n"}, {"tags": ["haskell", "types", "typeclass"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1496618533, "post_id": 44359743, "comment_id": 75721351, "body": "You may be interested in <code>DataKinds</code> and <code>GHC.TypeLits</code>, which permit natural numbers at the type level."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 8, "last_activity_date": 1496627742, "last_edit_date": 1496627742, "creation_date": 1496627309, "answer_id": 44360654, "question_id": 44359743, "link": "https://stackoverflow.com/questions/44359743/how-to-abstract-from-data-type-parameters-in-class-instances/44360654#44360654", "title": "How to abstract from data type parameters in class instances?", "body": "<p>You must make the order of the cyclic group part of the type. One way of doing this is to use <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-TypeLits.html\" rel=\"noreferrer\">the builtin type level natural numbers GHC gives us</a>.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures, ScopedTypeVariables #-}\n\nimport GHC.TypeLits\nimport Data.Proxy (Proxy(..))\n\ndata Cyclic (n :: Nat) = Cyclic Integer deriving (Show, Eq)\n</code></pre>\n\n<p>Which lets us make the two instances pretty easily:</p>\n\n<pre><code>instance KnownNat n =&gt; Monoid (Cyclic n) where\n    mempty = Cyclic 0\n    Cyclic x `mappend` Cyclic y = Cyclic $ (x + y) `mod` natVal (Proxy :: Proxy n)\n\ninstance KnownNat n =&gt; Group (Cyclic n) where\n    minvert (Cyclic x) = Cyclic $ negate x `mod` natVal (Proxy :: Proxy n)\n</code></pre>\n\n<p>The <code>KnownNat</code> part of the signature basically says that whatever <code>n :: Nat</code> ends up being, it is something whose value we should be able to extract using <code>natVal</code>.</p>\n\n<p>Then, once loaded in GHCi:</p>\n\n<pre><code>ghci&gt; :set -XDataKinds\nghci&gt; type Z12 = Cyclic 12\nghci&gt; mappend (Cyclic 8 :: Z12) (Cyclic 7 :: Z12)\nCyclic 3\nghci&gt; minvert (Cyclic 4 :: Z12)\nCyclic 8\n</code></pre>\n\n<h3>Aside on extensions</h3>\n\n<ul>\n<li><code>DataKinds</code> lets us have a type parameter <code>n</code> which isn't a type. We say that its <em>kind</em> is not type (<code>*</code>). In this case, <code>n</code> has kind <code>Nat</code> (<code>n :: Nat</code>).</li>\n<li><code>KindSignatures</code> just lets us write <code>n :: Nat</code> where <code>::</code> means \"has kind\" (instead of \"has type\") when it makes sense.</li>\n<li><code>ScopedTypeVariables</code> makes it so that the <code>n</code> type variable in <code>Proxy :: Proxy n</code> is the same one as in the instance head <code>instance KnownNat m =&gt; Monoid (Cyclic n) where</code>.</li>\n</ul>\n"}], "owner": {"reputation": 97, "user_id": 1606665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e8a2d0e4814beb3585bce04c83f9ed5?s=128&d=identicon&r=PG", "display_name": "Krokeledocus", "link": "https://stackoverflow.com/users/1606665/krokeledocus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 1, "accepted_answer_id": 44360654, "answer_count": 1, "score": 4, "last_activity_date": 1496633006, "creation_date": 1496618307, "last_edit_date": 1496633006, "question_id": 44359743, "link": "https://stackoverflow.com/questions/44359743/how-to-abstract-from-data-type-parameters-in-class-instances", "title": "How to abstract from data type parameters in class instances?", "body": "<p>As a toy project, I would like to understand how to model mathematical groups in Haskell in general.</p>\n\n<p>To start us off, we begin by observing that a to be defined <code>Group</code> is just a <code>Monoid</code> with inversion.</p>\n\n<pre><code>class (Monoid m) =&gt; Group m where\n    minvert :: m -&gt; m\n</code></pre>\n\n<p>Next, we first restrict ourselves to cyclic groups and start by defining the cyclic group of order 12.</p>\n\n<pre><code>data Cyclic12 = Cyclic12 Int deriving (Show, Eq)\n</code></pre>\n\n<p>Finally, we instantiate both classes for <code>Cyclic12</code>.</p>\n\n<pre><code>instance Monoid Cyclic12 where\n    mempty = Cyclic12 0\n    mappend (Cyclic12 x) (Cyclic12 y) = Cyclic12 ((x + y) `mod` 12)\n\ninstance Group Cyclic12 where\n    minvert (Cyclic12 x) = Cyclic12 ((0 - x) `mod` 12)\n</code></pre>\n\n<p>How do I abstract the previous definition from the specific value of 12 to allow a more generic definition of different cyclic groups?</p>\n\n<p>Ideally, I would like to write definitions like</p>\n\n<pre><code>instance Monoid (Cyclic k) where\n    mempty = Cyclic k 0\n    mappend (Cyclic k x) (Cyclic k y) = Cyclic k ((x + y) `mod` k)\n\ninstance Group (Cyclic k) where\n    minvert (Cyclic k x) = Cyclic k ((0 - x) `mod` k)\n</code></pre>\n\n<p>But with a data definition like</p>\n\n<pre><code>data Cyclic = Cyclic Int Int deriving (Show, Eq)\n</code></pre>\n\n<p>we still don't get very far, because <code>k</code> is \"not in scope\". Regarding its apparent triviality I have a feeling to be missing out on some fundamental concept here. Thanks in advance for your help. </p>\n"}, {"tags": ["list", "haskell", "instance", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496632726, "post_id": 44359632, "comment_id": 75724156, "body": "I don&#39;t tend to see <code>UndecidableInstances</code> showing up in mistaken code; I tend to see it much more in perfectly good code that Haskell&#39;s extremely limited termination criteria are insufficient to prove good."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496638031, "post_id": 44359632, "comment_id": 75725319, "body": "@dfeuer, Once you&#39;re comfortable with typeclasses I agree, but often beginners tend to think of typeclass resolution backwards or as being much more powerful than it is (for example <code>instance Vector a =&gt; Num a</code> and the like), which quickly leads to these extensions being &quot;needed&quot; (though when they are enabled it still doesn&#39;t work as intended).  No?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496644319, "post_id": 44359632, "comment_id": 75727425, "body": "I tend to think that much more about <code>OverlappingInstances</code>, <code>IncoherentInstances</code>, <code>AllowAmbiguousTypes</code>, and (when not using multiparameter type classes) <code>FlexibleInstances</code>. But you may be right as well."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1496618499, "last_edit_date": 1496618499, "creation_date": 1496617271, "answer_id": 44359632, "question_id": 44359466, "link": "https://stackoverflow.com/questions/44359466/create-instance-for-list-of-data-types-haskell/44359632#44359632", "title": "Create instance for list of data types - Haskell", "body": "<p>It just requires a language extension, since this form of instance is not technically allowed by the Haskell 98 standard.  When the error message says to enable an extension, usually just do it[1]. <code>FlexibleInstances</code> is a very common and accepted extension, so just put</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n</code></pre>\n\n<p>at the top of the file.</p>\n\n<hr>\n\n<p>Alternatively, often times such instances can be defined \"recursively\", in which case you don't need the extension, but besides that you get more instances for free, and more guarantees because the type is more general. See if you can define</p>\n\n<pre><code>instance (Rename a) =&gt; Rename [a] where\n    findSub ...\n</code></pre>\n\n<p>instead, using only the fact that <code>a</code> is a <code>Rename</code> rather than it being specifically an <code>Atom</code>.  When you can define instances this way, it is a good sign that your design is on the right track.</p>\n\n<hr>\n\n<p>[1] There are a few exceptions, such as <code>UndecidableInstances</code> or <code>IncoherentInstances</code>, which sometimes indicates that you have a wrong idea about how typeclass resolution works. </p>\n"}], "owner": {"reputation": 77, "user_id": 5721097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e896909ec8aeb0d58787b6923962c0af?s=128&d=identicon&r=PG&f=1", "display_name": "Jeroen Bos", "link": "https://stackoverflow.com/users/5721097/jeroen-bos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 683, "favorite_count": 0, "accepted_answer_id": 44359632, "answer_count": 1, "score": 0, "last_activity_date": 1496618499, "creation_date": 1496615670, "question_id": 44359466, "link": "https://stackoverflow.com/questions/44359466/create-instance-for-list-of-data-types-haskell", "title": "Create instance for list of data types - Haskell", "body": "<p>I feel like this should be really easy, but i am stuck at this point for quite some time. </p>\n\n<p><strong>Is it possible in haskell to create an instance of a type class for a list of certain data types?</strong></p>\n\n<p>What i want to achieve is the following.</p>\n\n<pre><code>class Rename a where\n    findSub :: a -&gt; a\n\n-- A 'normal' instance would look like this\ninstance Rename Atom where\n    findSub ......\n\n-- Now i want to acchieve something like this\ninstance Rename ([] Atom) where\n    findSub ......\n</code></pre>\n\n<p>How ever when i write this i get the following error:</p>\n\n<pre><code>* Illegal instance declaration for `Rename [Atom]'\n        (All instance types must be of the form (T a1 ... an)\n         where a1 ... an are *distinct type variables*,\n         and each type variable appears at most once in the instance head.\n         Use FlexibleInstances if you want to disable this.)\n    * In the instance declaration for `Rename ([] Atom)'\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I would like to know how to fix this and why this is not allowed.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 3, "last_activity_date": 1496606616, "creation_date": 1496606616, "answer_id": 44358282, "question_id": 44358134, "link": "https://stackoverflow.com/questions/44358134/map-ing-over-conduitm/44358282#44358282", "title": "Map-ing over ConduitM?", "body": "<p>Looking at the docs, this is just <code>mapOutput</code>, right?</p>\n\n<p><a href=\"https://www.stackage.org/haddock/lts-8.13/conduit-1.2.10/Data-Conduit.html#t:mapOutput\" rel=\"nofollow noreferrer\">https://www.stackage.org/haddock/lts-8.13/conduit-1.2.10/Data-Conduit.html#t:mapOutput</a></p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 44358282, "answer_count": 1, "score": 0, "last_activity_date": 1496606616, "creation_date": 1496605595, "question_id": 44358134, "link": "https://stackoverflow.com/questions/44358134/map-ing-over-conduitm", "title": "Map-ing over ConduitM?", "body": "<p>How can I implement the following in <a href=\"https://www.stackage.org/haddock/lts-8.13/conduit-combinators-1.1.1/Conduit.html#v:decodeUtf8C\" rel=\"nofollow noreferrer\">Conduit</a>?</p>\n\n<p>Given a conduit whose input is of type <code>a</code> and output is of type <code>b</code>, output a new conduit that returns a type of <code>c</code>, i.e. rather than <code>b</code>.</p>\n\n<p><code>g :: Monad m =&gt; ConduitM a b m () -&gt; (b -&gt; c) -&gt; ConduitM a c m ()</code></p>\n"}, {"tags": ["haskell", "pattern-matching", "equality", "typeclass"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1496607065, "creation_date": 1496607065, "answer_id": 44358337, "question_id": 44358039, "link": "https://stackoverflow.com/questions/44358039/pattern-matching-for-alternate-instances-of-eq/44358337#44358337", "title": "Pattern Matching for Alternate instances of Eq", "body": "<p>An <code>Eq</code> instance has no bearing whatsoever on pattern matches. <code>==</code> is just a library function and checks a particular property that doesn't necessarily have much to do with implementation structure, whereas pattern matches are all about deconstructing a type in its actual ADT structure.</p>\n\n<p>That said, it is possible to fake something similar to what you asked, but I daresay it's not a very good idea to actually do this \u2013 doesn't scale and might lead to strange issues later on.</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms, ViewPatterns #-}\n\nmatchConstFactor :: Expr a -&gt; Maybe (a, Expr a)\nmatchConstFactor (Const a :*: b) = Just (a, b)\nmatchConstFactor (a :*: Const b) = Just (b, a)\nmatchConstFact _ = Nothing\n\npattern (:.*:) :: a -&gt; Expr a -&gt; Expr a\npattern a :.*: b &lt;- (matchConstFactor -&gt; Just (a, b))\n where a :.*: b = Const a :*: b\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 3, "last_activity_date": 1496647704, "last_edit_date": 1496647704, "creation_date": 1496607070, "answer_id": 44358338, "question_id": 44358039, "link": "https://stackoverflow.com/questions/44358039/pattern-matching-for-alternate-instances-of-eq/44358338#44358338", "title": "Pattern Matching for Alternate instances of Eq", "body": "<blockquote>\n  <p>Is there a way to write just one of the above to expressions and let the instance of (Eq) take care of the rest?</p>\n</blockquote>\n\n<p>No.</p>\n\n<blockquote>\n  <p>Does pattern matching even use or require an instance of (Eq)</p>\n</blockquote>\n\n<p>Only when matching against (number, character or string) literals. You can see the rules in 3.17.2 of <a href=\"https://www.haskell.org/onlinereport/exps.html#pattern-matching\" rel=\"nofollow noreferrer\">https://www.haskell.org/onlinereport/exps.html#pattern-matching</a> and note that case 7 is the only one which mentions <code>==</code>.</p>\n\n<p>But you can use view patterns:</p>\n\n<pre><code>const1 (Const 1 :*: a) = Just a\nconst1 (a :*: Const 1) = Just a\nconst1 _ = Nothing\n\nf (const1 -&gt; Just a) = ...\n</code></pre>\n\n<p>This may be too ugly if you need other symmetries in other cases and I can't think of a solution for this at the moment.</p>\n"}], "owner": {"reputation": 103, "user_id": 7087326, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FmwwcbQozgw/AAAAAAAAAAI/AAAAAAAACOI/9i0bxvfk1Mc/photo.jpg?sz=128", "display_name": "Ando Bando", "link": "https://stackoverflow.com/users/7087326/ando-bando"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1496647704, "creation_date": 1496604957, "last_edit_date": 1496609727, "question_id": 44358039, "link": "https://stackoverflow.com/questions/44358039/pattern-matching-for-alternate-instances-of-eq", "title": "Pattern Matching for Alternate instances of Eq", "body": "<p>So, I create a data type </p>\n\n<pre><code>data Expr a = Const a\n    | Expr a :*: Expr a\n</code></pre>\n\n<p>And I define an instance for <code>Eq</code> for this data type</p>\n\n<pre><code>instance (Eq m) =&gt; Eq (Expr m) where\n    Const a == Const b = a == b\n    (a :*: b) == (c :*: d) = ((a == c) &amp;&amp; (b == d)) || ((a == d) &amp;&amp; (b == c))\n</code></pre>\n\n<p>This definition means that order does not matter when comparing two expressions. However, when I use pattern matching to write a function that takes <code>Expr</code>s I cannot just write</p>\n\n<pre><code>f (Const 1 :*: a) = ...\n</code></pre>\n\n<p>but must also write</p>\n\n<pre><code>f (a :*: Const 1) = ...\n</code></pre>\n\n<p>in order to catch all cases, even though if I where to compare the two using <code>(==)</code> it would return true.</p>\n\n<p>Is there a way to write just one of the above to expressions and let the instance of <code>Eq</code> take care of the rest? Does pattern matching even use or require an instance of <code>Eq</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 689, "user_id": 6217179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/633461a7b7bd893feebbc9285d0fb049?s=128&d=identicon&r=PG&f=1", "display_name": "sapanoia", "link": "https://stackoverflow.com/users/6217179/sapanoia"}, "edited": false, "score": 0, "creation_date": 1496567910, "post_id": 44352467, "comment_id": 75707090, "body": "The <code>.</code> operator is called &quot;composition&quot;. The <code>$</code> is called &quot;application&quot;. Juxtaposition, e.g. <code>f x</code>, is also application. If you search for the operator names, you should find good explanations."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1496568875, "post_id": 44352467, "comment_id": 75707341, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/26538438/how-to-make-multiple-eta-reductions-in-haskell\">How to make multiple eta reductions in haskell</a>"}], "answers": [{"tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": true, "score": 3, "last_activity_date": 1496567792, "creation_date": 1496567792, "answer_id": 44352514, "question_id": 44352467, "link": "https://stackoverflow.com/questions/44352467/discard-variables-through-use-of-dot-and-dollar/44352514#44352514", "title": "Discard variables through use of dot and dollar", "body": "<p>This is called <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow noreferrer\">point-free notation</a>. For your example, it is:</p>\n\n<pre><code>example' = (length .) . filter\n</code></pre>\n\n<p>though it is harder to comprehend, in my opinion. </p>\n\n<p>There is a convenient tool to generate point-free version: <a href=\"http://pointfree.io/\" rel=\"nofollow noreferrer\">pointfree.io</a></p>\n"}, {"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1496570815, "post_id": 44352637, "comment_id": 75707820, "body": "For the first paragraph, I don&#39;t see how referential transparency is relevant (in this specific case)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1496578033, "post_id": 44352637, "comment_id": 75709678, "body": "@AlexeyRomanov: <a href=\"https://tio.run/##Zc5dC8IgFAbge3/FwQh0tNbqUvon3Qz1qFAuzMEg9ttNW6OvKz@e874cWRspU1o5L8@D0kBvUbl@aykhzkfAHSvHyOEedByCh7Hai2m29t8O2Z7IKuSFORxziZg/zW8A2ciXxKVzHlg2AjA32HeDAGga0LGrg1aD1AqwDxfoEQzJ81hmWlGu15AzyKhhbUmu3cnTDZQXFx9sv9gu/NorLzyl9AA\" rel=\"nofollow noreferrer\">tio.run/##Zc5dC8IgFAbge3/&hellip;</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 0, "creation_date": 1496578353, "post_id": 44352637, "comment_id": 75709772, "body": "Or if you prefer Python <a href=\"https://tio.run/##XctBCsMgFITh/TvFkBLQQiE2u0Jv0o2pPg00GsSCPb2J0C7S5fwfs36yj2GslQfc8dLLZDTKDeV8JVZ/aSTiPfFA5A7EokjyjYATbNaXZM37aQ04pgWR4b5XRbSmOWTROaHkXvr5ETr0aFP@zB@tTVnrBg\" rel=\"nofollow noreferrer\">tio.run/##XctBCsMgFITh/&hellip;</a>"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 6, "last_activity_date": 1496568683, "creation_date": 1496568683, "answer_id": 44352637, "question_id": 44352467, "link": "https://stackoverflow.com/questions/44352467/discard-variables-through-use-of-dot-and-dollar/44352637#44352637", "title": "Discard variables through use of dot and dollar", "body": "<p>You don't \u201cdiscard\u201d the variables there, you merely <em>don't mention</em> them. The process is called <a href=\"https://en.wikipedia.org/wiki/Lambda_calculus#.CE.B7-conversion\" rel=\"noreferrer\">eta-conversion</a>: thanks to referential transparency, when you define</p>\n\n<pre><code>g x = f x\n</code></pre>\n\n<p>you might just as well simply write <code>g = f</code>. This also works when <code>f</code> is not already a named function, like</p>\n\n<pre><code>last' xs = (head . reverse) xs\n \u21d2 last' =  head . reverse\n</code></pre>\n\n<p>But this requires that the variable actually turns up only as the final argument to a self-contained function, e.g. one that is already named or enclosed in parens. For instance, with your original <code>last</code> this is not possible because the <code>xs</code> occurs <em>in</em> the parenthesis <code>(reverse xs)</code>, hence you first need to transform <code>head (reverse xs) \u2261 (head . reverse) xs</code> before you can \u03b7-reduce it. Likewise,</p>\n\n<pre><code>length . filter p \u2261 length . (filter p)\n</code></pre>\n\n<p>so you can't just reduce the <code>p</code> because it's inside a parenthesis. You can however, as bereal suggests, consider the precomposition <code>(length .)</code> as a seperate function that's applied to the rest of the expression:</p>\n\n<pre><code>length . filter p\n  \u2261 (length .) (filter p)\n  \u2261 ((length .) . filter) p\nexample' = (length .) . filter\n</code></pre>\n\n<p>But I agree that this makes the code rather harder to read, hence I'd normally leave <code>example'</code> as it is.</p>\n"}], "owner": {"reputation": 27, "user_id": 6486746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8fd9738db73355bb1210c6e271bec3f?s=128&d=identicon&r=PG", "display_name": "user337258", "link": "https://stackoverflow.com/users/6486746/user337258"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 44352514, "answer_count": 2, "score": 0, "last_activity_date": 1496598124, "creation_date": 1496567441, "last_edit_date": 1496598124, "question_id": 44352467, "link": "https://stackoverflow.com/questions/44352467/discard-variables-through-use-of-dot-and-dollar", "title": "Discard variables through use of dot and dollar", "body": "<p>I'm a Haskell beginner and I want to know why we can discard certain variables when using certain operators, for example:</p>\n\n<pre><code>     last xs = head (reverse xs)\n     last'   = head . reverse\n</code></pre>\n\n<p>Another example:</p>\n\n<pre><code>     example p xs = length (filter p xs)\n     example' p = length . filter p\n</code></pre>\n\n<p>Why can't we toss the p in this function?</p>\n"}, {"tags": ["haskell", "generics"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1496565770, "post_id": 44352002, "comment_id": 75706539, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/36989329/why-does-this-function-that-uses-a-scoped-type-variable-in-a-where-clause-not-ty\">Why does this function that uses a scoped type variable in a where clause not typecheck?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496587183, "post_id": 44352175, "comment_id": 75712419, "body": "I&#39;ve tried this as well. Still doesn&#39;t work. I&#39;ve edited my question above to include the explicit <code>forall a</code> and the new error message."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496587343, "post_id": 44352175, "comment_id": 75712468, "body": "Strangely, the following compiles. I have no clue why!  <code>lookupTable = (zipWith (,) (conNames (undefined :: a))  genumDefault)</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496594499, "post_id": 44352175, "comment_id": 75714816, "body": "@SaurabhNanda Ah, you do have to pass <code>a</code> to <code>conNames</code> somehow. Image you were instead doing <code>conNames (undefined :: Bool)</code>, this would type check, and produce the list <code>[&quot;False&quot;, &quot;True&quot;]</code>, I guess. So, when you call <code>conNames</code>, you have to specify the wanted type -- it can not be deduced from the context."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496639228, "post_id": 44352175, "comment_id": 75725631, "body": "Shouldn&#39;t it be deducible from the context? Even you expected it, right?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1496648032, "post_id": 44352175, "comment_id": 75729158, "body": "@SaurabhNanda No, it can&#39;t be deduced, since <code>Bool</code> (or basically any other type) would be another choice which makes the code type check."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1496594513, "last_edit_date": 1496594513, "creation_date": 1496564922, "answer_id": 44352175, "question_id": 44352002, "link": "https://stackoverflow.com/questions/44352002/how-to-get-an-enum-constructor-from-a-string/44352175#44352175", "title": "How to get an enum constructor from a string?", "body": "<p>To make type variables in scope, leveraging the extension <code>ScopedTypeVariables</code>, you need an <em>explicit</em> <code>forall a.</code>.</p>\n\n<p>E.g.</p>\n\n<pre><code>gEnumFromString :: forall a. (Generic a, Enum' (Rep a), ConNames (Rep a))\n                =&gt; Options -&gt; String -&gt; Maybe a\ngEnumFromString opt s = lookup s lookupTable\n  where\n    lookupTable :: [(String, a)]\n    lookupTable = zipWith (,) (conNames (undefined :: a))  genumDefault\n</code></pre>\n\n<p>There is no need to repeat the type constraints, since these are \"carried\" by <code>a</code> anyway.</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 44352175, "answer_count": 1, "score": 0, "last_activity_date": 1496594513, "creation_date": 1496563389, "last_edit_date": 1496587041, "question_id": 44352002, "link": "https://stackoverflow.com/questions/44352002/how-to-get-an-enum-constructor-from-a-string", "title": "How to get an enum constructor from a string?", "body": "<p>Following up from my <a href=\"https://stackoverflow.com/questions/44193630/how-to-customise-show-read-instances-on-the-lines-of-fromjson-tojson/44195842\">previous question</a> I found the <a href=\"http://hackage.haskell.org/package/generic-deriving-1.11.2\" rel=\"nofollow noreferrer\">generic-deriving</a> package which seems to have a lot of the building blocks that I need. Implementing a <code>gEnumToString</code> function was reduced to a one-liner. However, I'm running into problems with the <code>gEnumFromString</code> function:</p>\n\n<pre><code>{-# LANGUAGE FunctionalDependencies #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE TypeFamilies #-}\n\nimport Text.Read\nimport GHC.Generics\nimport Generics.Deriving\nimport Control.Lens\nimport Data.Default as DD\nimport           Data.Aeson.Casing\nimport Data.Aeson.Types (camelTo2)\n\ndata Options = Options\n  {\n    optConstructorTagModifier :: String -&gt; String\n  } deriving (Generic)\n\ninstance DD.Default Options where\n  def = Options\n    {\n      optConstructorTagModifier = (camelTo2 '_')\n    }\n\nmakeLensesWith abbreviatedFields ''Options\n\ngEnumToString :: (ConNames (Rep a), Generic a) =&gt; Options -&gt; a -&gt; String\ngEnumToString opt x = (opt ^. constructorTagModifier) $ conNameOf x\n\ngEnumFromString :: forall a . (Generic a, Enum' (Rep a), ConNames (Rep a))\n                =&gt; Options -&gt; String -&gt; Maybe a\ngEnumFromString opt s = lookup s lookupTable\n  where\n    lookupTable :: [(String, a)]\n    lookupTable = (zipWith (,) (conNames undefined)  genumDefault)\n</code></pre>\n\n<p>This code doesn't compile with the following errors. Even though I've tried constraining the type of <code>conNames undefined</code> by using <code>ScopedTypeVariables</code> <strong>and explicitly providing a <code>forall a</code> (as mentioned by one of the suggestions given in the answers)</strong>. What am I doing wrong?</p>\n\n<pre><code>   168  33 error           error:\n     \u2022 Could not deduce (Generic a0) arising from a use of \u2018conNames\u2019\n       from the context: (Generic a, Enum' (Rep a), ConNames (Rep a))\n         bound by the type signature for:\n                    gEnumFromString :: (Generic a, Enum' (Rep a), ConNames (Rep a)) =&gt;\n                                       Options -&gt; String -&gt; Maybe a\n         at /Users/saurabhnanda/projects/vl-haskell/.stack-work/intero/intero784UVH.hs:(163,1)-(164,47)\n       The type variable \u2018a0\u2019 is ambiguous\n       These potential instances exist:\n         instance Generic (Either a b) -- Defined in \u2018GHC.Generics\u2019\n         instance forall a k (b :: k). Generic (Const a b)\n           -- Defined in \u2018Data.Functor.Const\u2019\n         instance Generic (Identity a) -- Defined in \u2018Data.Functor.Identity\u2019\n         ...plus 31 others\n         ...plus 201 instances involving out-of-scope types\n         (use -fprint-potential-instances to see them all)\n     \u2022 In the second argument of \u2018zipWith\u2019, namely\n         \u2018(conNames undefined)\u2019\n       In the expression: (zipWith (,) (conNames undefined) genumDefault)\n       In an equation for \u2018lookupTable\u2019:\n           lookupTable = (zipWith (,) (conNames undefined) genumDefault) (intero)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1496558775, "post_id": 44350759, "comment_id": 75705089, "body": "This doesn&#39;t look correct at all (it doesn&#39;t parse, for starters). You have defined data TExpTree but aren&#39;t using it, are you sure you want your parsers to be of type <code>Parser Ternary</code> rather than say <code>Parser TExpTree</code>?"}, {"owner": {"reputation": 87, "user_id": 3277930, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4bb748494176361f0455535b75be77ca?s=128&d=identicon&r=PG&f=1", "display_name": "user3277930", "link": "https://stackoverflow.com/users/3277930/user3277930"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1496801901, "post_id": 44350759, "comment_id": 75804532, "body": "I think you&#39;re right about the TExpTree.  What do you mean by it doesn&#39;t parse?  I thought this is how you set it up."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1496811200, "post_id": 44350759, "comment_id": 75806732, "body": "I get parse errors from the compiler."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1496811282, "post_id": 44350759, "comment_id": 75806765, "body": "What parser library are you using?"}, {"owner": {"reputation": 87, "user_id": 3277930, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4bb748494176361f0455535b75be77ca?s=128&d=identicon&r=PG&f=1", "display_name": "user3277930", "link": "https://stackoverflow.com/users/3277930/user3277930"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1496816300, "post_id": 44350759, "comment_id": 75808810, "body": "im using this file that was given to me. <a href=\"https://pastebin.com/0ZFGKLk4\" rel=\"nofollow noreferrer\">pastebin.com/0ZFGKLk4</a> and here is the rest of my code with things defined and the other test functions. <a href=\"https://pastebin.com/6spicVmK\" rel=\"nofollow noreferrer\">pastebin.com/6spicVmK</a>"}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 3277930, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4bb748494176361f0455535b75be77ca?s=128&d=identicon&r=PG&f=1", "display_name": "user3277930", "link": "https://stackoverflow.com/users/3277930/user3277930"}, "edited": false, "score": 0, "creation_date": 1496805000, "post_id": 44352457, "comment_id": 75805312, "body": "Hi, I&#39;m getting an error.  The error might be either ((:)) or ((|)), I cant tell because it looks like a colon but its probably ((|)) The error says variable not in scope: ((:))  :: Parser TExpTree -&gt; Parser TExpTree -&gt; t0 Perhaps you meant one of these: () (=) Variable not in scope: ((:)) :: t0-&gt; Parser TExpTree -&gt; TExpTree Perhaps you meant one of these: (*) (=) What does this mean?"}, {"owner": {"reputation": 689, "user_id": 6217179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/633461a7b7bd893feebbc9285d0fb049?s=128&d=identicon&r=PG&f=1", "display_name": "sapanoia", "link": "https://stackoverflow.com/users/6217179/sapanoia"}, "reply_to_user": {"reputation": 87, "user_id": 3277930, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4bb748494176361f0455535b75be77ca?s=128&d=identicon&r=PG&f=1", "display_name": "user3277930", "link": "https://stackoverflow.com/users/3277930/user3277930"}, "edited": false, "score": 0, "creation_date": 1497561983, "post_id": 44352457, "comment_id": 76143249, "body": "There is no <code>:</code> or <code>|</code> in the code. Perhaps you meant <code>&lt;|&gt;</code>? It is imported from <code>Control.Applicative</code>. <code>&lt;|&gt;</code> expresses an alternative. So <code>a &lt;|&gt; b</code> means: Try <code>a</code> first, and if it fails, try <code>b</code>."}], "tags": [], "owner": {"reputation": 689, "user_id": 6217179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/633461a7b7bd893feebbc9285d0fb049?s=128&d=identicon&r=PG&f=1", "display_name": "sapanoia", "link": "https://stackoverflow.com/users/6217179/sapanoia"}, "is_accepted": false, "score": 1, "last_activity_date": 1496567742, "last_edit_date": 1496567742, "creation_date": 1496567396, "answer_id": 44352457, "question_id": 44350759, "link": "https://stackoverflow.com/questions/44350759/how-do-i-define-a-parser-function-for-variables/44352457#44352457", "title": "How do I define a parser function for variables?", "body": "<p>You are implementing a parser and an evaluator in a single function. Because of that, you never use <code>TExpTree</code>. If you want to build a parser, change the type of your parser functions to <code>Parser TExpTree</code>. Then, let <code>tExp</code> return <code>(I e o)</code> instead of <code>(e==&gt;o)</code>, and so on.</p>\n\n<p>The implementation of the <code>tLit</code> function depends on the tools your parser offers. It could look like this (untested):</p>\n\n<pre><code>tLit :: Parser TExpTree\ntLit = (symbol \"T\" &gt;&gt; return (L T))\n   &lt;|&gt; (symbol \"F\" &gt;&gt; return (L F))\n   &lt;|&gt; (symbol \"M\" &gt;&gt; return (L M))\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 3277930, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4bb748494176361f0455535b75be77ca?s=128&d=identicon&r=PG&f=1", "display_name": "user3277930", "link": "https://stackoverflow.com/users/3277930/user3277930"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1496635024, "creation_date": 1496550388, "last_edit_date": 1496635024, "question_id": 44350759, "link": "https://stackoverflow.com/questions/44350759/how-do-i-define-a-parser-function-for-variables", "title": "How do I define a parser function for variables?", "body": "<p>I need help creating a parser for ternary expressions. I'm given this grammar for ternary expressions.</p>\n\n<pre><code>tExp :: tOpd ( '&lt;=&gt;' tExp | '==&gt;' tExp| e )\ntOpd :: tTerm ( '|||' tOpd | e )\ntTerm :: tFact ( '&amp;&amp;&amp;' tTerm | e)\ntFact :: '~' tPrim | tPrim\nprimary :: tVar | tLit | '('tExp')'\ntVar :: lowercase (Alphanumeric)*\ntLit :: T | F | M\n</code></pre>\n\n<p>I also have defined the data type Ternary and expression tree here.</p>\n\n<pre><code>data Ternary = T | F | M\n    deriving (Eq,  Show, Ord) \n\n   data TExpTree = L Ternary              -- Ternary literal (i.e. T, F or M)\n                  | V String               -- Variable \n                  | N TExpTree             -- Prefix not\n                  | A TExpTree TExpTree    -- And node\n                  | O TExpTree TExpTree    -- Or node\n                  | E TExpTree TExpTree    -- Equivalence node\n                  | I TExpTree TExpTree    -- Implication node\n        deriving (Show, Eq)\n</code></pre>\n\n<p>I know that first I need to create functions for each rule.</p>\n\n<pre><code>tExp:: Parser TExpTree\ntExp = do o &lt;- tOpd\n          (do symbol \"&lt;=&gt;\"\n              e &lt;- tExp\n              return (e&lt;=&gt;o)\n           +++ do synbol \"==&gt;\"\n              e &lt;- tExp\n              return (e==&gt;o)\n           +++ return o)\n\ntOpd :: Parser TExpTree\ntOpd = do t &lt;- tTerm\n          (do symbol \"|||\"\n              e &lt;- tOpd\n              return (t|||e)\n           +++ return t)\n\ntTerm :: Parser TExpTree\ntTerm = do f &lt;- tFact\n          (do symbol \"&amp;&amp;&amp;\"\n              e &lt;- tTerm\n              return (f+e)\n           +++ return f)\n\ntFact:: Parser TExpTree \ntFact = do m &lt;- tPrim\n           return m\n        +++\n           (do symbol \"~\"\n              m &lt;- tExp\n              return (~m))\n</code></pre>\n\n<p>So far, I have these, but I don't know how to go about creating them for primary, tLit, and tVar.</p>\n\n<p>Can someone help me figure out just tLit, so I can try doing the rest myself? I'm not sure how to go about this.</p>\n\n<p>I have this test function for tLit to confirm that it works as well.</p>\n\n<pre><code>testtLit :: Bool\ntesttLit = lt == (L T) &amp;&amp; lf == (L F) &amp;&amp; lm == (L M)  \n       where Just (lt, _) = parse tLit \" T \" \n             Just (lf, _) = parse tLit \" F \"\n             Just (lm, _) = parse tLit \" M \" \n</code></pre>\n"}, {"tags": ["ios", "haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 455, "user_id": 5252811, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/25f4662cd8d11abc2110cad00a9e2b52?s=128&d=identicon&r=PG&f=1", "display_name": "x4rkz", "link": "https://stackoverflow.com/users/5252811/x4rkz"}, "edited": false, "score": 0, "creation_date": 1496609723, "post_id": 44349608, "comment_id": 75719203, "body": "Thank you, it works. But oddly enough, it requires a &quot;;&quot; at the end of the &quot;x &lt;- ...&quot; line otherwise he thinks that it&#39;s only one statement, and the last statement needs to be an expression. Any hint why? I think this is because the nomad created can take more arguments"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 455, "user_id": 5252811, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/25f4662cd8d11abc2110cad00a9e2b52?s=128&d=identicon&r=PG&f=1", "display_name": "x4rkz", "link": "https://stackoverflow.com/users/5252811/x4rkz"}, "edited": false, "score": 1, "creation_date": 1496609892, "post_id": 44349608, "comment_id": 75719249, "body": "@x4rkz semicolons only help if you have the wrong indentation. Check if every entry in the <code>do</code> block is indented at the same level. If I indented <code>blaze $ ...</code> more, for instance, that would be a part of the previous entry, which would trigger the error you mention."}, {"owner": {"reputation": 455, "user_id": 5252811, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/25f4662cd8d11abc2110cad00a9e2b52?s=128&d=identicon&r=PG&f=1", "display_name": "x4rkz", "link": "https://stackoverflow.com/users/5252811/x4rkz"}, "edited": false, "score": 0, "creation_date": 1496609976, "post_id": 44349608, "comment_id": 75719267, "body": "I&#39;ve done that already, removed the indentation and make sure I put the same."}, {"owner": {"reputation": 455, "user_id": 5252811, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/25f4662cd8d11abc2110cad00a9e2b52?s=128&d=identicon&r=PG&f=1", "display_name": "x4rkz", "link": "https://stackoverflow.com/users/5252811/x4rkz"}, "edited": false, "score": 0, "creation_date": 1496610031, "post_id": 44349608, "comment_id": 75719291, "body": "I did it again, and it works, I should have done it wrong, thank you!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1496534432, "creation_date": 1496534432, "answer_id": 44349608, "question_id": 44349534, "link": "https://stackoverflow.com/questions/44349534/extraction-io-data-inside-other-monad/44349608#44349608", "title": "Extraction IO data inside other Monad", "body": "<p>I'm not familiar with that specific library, but typically one injects an IO action into another monad with <code>liftIO</code>. This is indeed what you hint at in your question.</p>\n\n<p>I would try something like</p>\n\n<pre><code>get \"/\" $ do\n  x &lt;- liftIO $ quickQuery' conn \"SELECT * from definitions\" []\n  blaze $ Mathskell.Views.Read.render conn\n</code></pre>\n\n<p>This should work as long as the outer monad has a <code>MonadIO</code> instance.</p>\n"}], "owner": {"reputation": 455, "user_id": 5252811, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/25f4662cd8d11abc2110cad00a9e2b52?s=128&d=identicon&r=PG&f=1", "display_name": "x4rkz", "link": "https://stackoverflow.com/users/5252811/x4rkz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 44349608, "answer_count": 1, "score": 0, "last_activity_date": 1496534432, "creation_date": 1496533650, "question_id": 44349534, "link": "https://stackoverflow.com/questions/44349534/extraction-io-data-inside-other-monad", "title": "Extraction IO data inside other Monad", "body": "<p>I am using HDBC-Sqlite3, I would like to make queries depending on the page I am in. And I would like to get the data out of the IO Monad. It should be possible because \"get\" is already not pure. How is it done in Haskell in general?</p>\n\n<pre><code>  main = do\n  conn &lt;- connectSqlite3 \"test.db\"\n  scotty 3000 $ do\n    get \"/\" $ do\n      x &lt;- quickQuery' conn \"SELECT * from definitions\" [] -- Here, how to do it?\n      blaze $ Mathskell.Views.Read.render conn\n</code></pre>\n\n<p>The problem is that I'm in a \"do\" where the Monad is ActionM and not IO.</p>\n\n<p>I thought about constructing an ActionM from the IO, and then using the x &lt;- ... syntax, is it a good solution?\nI also saw the existence of liftIO/liftM but I didn't understand how/when to use it either.</p>\n"}, {"tags": ["haskell", "monads", "delimited-continuations"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1496533394, "post_id": 44349434, "comment_id": 75701450, "body": "I doubt the idea of a \u201chard-to-type monad\u201d makes sense. If it doesn&#39;t clearly unify types before and after sequencing-composition, it&#39;s not really a monad."}, {"owner": {"reputation": 1392, "user_id": 264985, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3b3c809cbec8cc5c62a918d57e90b553?s=128&d=identicon&r=PG", "display_name": "Corbin", "link": "https://stackoverflow.com/users/264985/corbin"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1496533549, "post_id": 44349434, "comment_id": 75701481, "body": "I was admittedly thinking about corner cases like <code>Cont</code>, which only admits a delimited <code>callCC</code> operation in Haskell&#39;s type system but for which Scheme (and Monte, via experiments, as of this morning) is perfectly happy to allow an undelimited variant."}], "owner": {"reputation": 1392, "user_id": 264985, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3b3c809cbec8cc5c62a918d57e90b553?s=128&d=identicon&r=PG", "display_name": "Corbin", "link": "https://stackoverflow.com/users/264985/corbin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 183, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1496532515, "creation_date": 1496532515, "question_id": 44349434, "link": "https://stackoverflow.com/questions/44349434/are-there-interesting-single-shot-monads-besides-maybe-and-either", "title": "Are there interesting single-shot monads besides Maybe and Either?", "body": "<p>In the <a href=\"http://monte.readthedocs.io/en/latest/\" rel=\"nofollow noreferrer\">Monte</a> programming language, as well as in its ancestor <a href=\"http://erights.org/\" rel=\"nofollow noreferrer\">E</a>, there is syntax for <strong>single-shot delimited continuations</strong>, called \"ejectors,\" which are continuations that are effectively only usable once within a syntactic boundary. For example, here is an ejector that is not called:</p>\n\n<pre><code>escape ej { 42 }\n</code></pre>\n\n<p>And an ejector that is called:</p>\n\n<pre><code>escape ej { ej(42); \"After 10,000 years, I'm free!\" }\n</code></pre>\n\n<p>Both evaluate to <code>42</code>. We can also attach an action to the case where the ejector is called:</p>\n\n<pre><code>escape ej { ej(2) } catch result { result + 4 }\n</code></pre>\n\n<p>That's about all of this syntax. It's not hard to imagine how this mimics <code>Maybe</code> or <code>Either</code>. I'll transcribe the example from the <a href=\"https://wiki.haskell.org/Maybe\" rel=\"nofollow noreferrer\">Haskell Wiki on Maybe</a> into idiomatic Monte:</p>\n\n<pre><code>def f(x, ej):\n    return if (x == 0) { ej() } else { x }\n\ndef g(x, ej):\n    return if (x == 100) { ej() } else { x }\n\ndef h(x, ej):\n    return g(f(x, ej), ej)\n\n# Monte permits Unicode identifiers but not for free.\ndef ::\"h\u00b4\"(x, ej):\n    def n := f(x, ej)\n    return g(n, ej)\n</code></pre>\n\n<p>(Note how we must bear the burden of passing <code>ej</code>. Monte lacks the \"programmable semicolon\" of do-notation.)</p>\n\n<p>I won't do <code>Either</code>, but it's largely the same; the ability to add a <code>catch</code> clause provides the required type discrimination. Delimited continuations are well-known to compose, so it's possible to build complex tools:</p>\n\n<pre><code>def trying(f, g, ej):\n    return escape innerEj { f(innerEj) } catch _ { g(ej) }\n</code></pre>\n\n<p>These kinds of gadgets are used in Monte to build hand-written parser combinators, for example. So, in <a href=\"http://blog.sigfpe.com/2008/12/mother-of-all-monads.html\" rel=\"nofollow noreferrer\">The Mother of all Monads</a>, Dan Piponi explains that <code>Cont</code> is, in a certain sense, a very primal <code>Monad</code> upon which many other <code>Monad</code>s can be built. We can attempt to do this in Monte, too. Let's use Moggi's style for encoding monads in object-based languages:</p>\n\n<pre><code>object identity:\n    to unit(x):\n        return x\n\n    # \"bind\" is a Monte keyword; we may still use it, but not for free.\n    # NB this is `x &gt;&gt;= f` in Haskell.\n    to \"bind\"(x, f):\n        return f(x)\n</code></pre>\n\n<p>And let's encode the binding helper <code>i</code>, to get an idea of what it looks like:</p>\n\n<pre><code>def i(m, x, ej):\n    return m.\"bind\"(x, ej)\n</code></pre>\n\n<p>...This isn't helpful. This isn't looking like good syntax.</p>\n\n<pre><code># Haskell: runIdentity $ do { x &lt;- return 32; return $ x // 4 }\nescape ej { i(identity, i(identity, identity.unit(32), fn x { identity.unit(x // 4) }), ej) }\n</code></pre>\n\n<p>The future was supposed to have cool robots, not this. There's another problem, though; let's encode another traditional <code>Monad</code>, <code>List</code>:</p>\n\n<pre><code>object list:\n    to unit(x) { return [x] }\n\n    to \"bind\"(action, f):\n        var rv := []\n        for x in (action) { rv += f(x) }\n        return rv\n</code></pre>\n\n<p>And let's do a traditional Cartesian product. First, let's do a direct computation; instead of passing a continuation, we'll just bind directly using the list monad:</p>\n\n<pre><code>\u25b2&gt; i(list, [1, 2, 3], fn x { i(list, [4, 5, 6], fn y { [x * y] }) })\nResult: [4, 5, 6, 8, 10, 12, 12, 15, 18]\n</code></pre>\n\n<p>And now with an ejector:</p>\n\n<pre><code>\u25b2&gt; escape ej { i(list, i(list, [1, 2, 3], fn x { i(list, [4, 5, 6], fn y { [x * y] }) }), ej) }\nResult: 4\n</code></pre>\n\n<p>So! That's pretty interesting. The complete list monad computation is being run, but the ejector only sees the first item in the list. I suspect that, since ejectors are composable, there's a way to build a more sophisticated logic monad which does a better job of not computing so many intermediate results.</p>\n\n<p>My question, then, is this: When we transform <code>Maybe</code> and <code>Either</code> into idiomatic Monte, we can clearly see that ejector syntax applies elegantly. What other monads are out there which would have interesting single-shot behavior like this? Don't feel limited to Haskell; Monte is untyped, so nobody will shun you for hard-to-type monads!</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1496523022, "post_id": 44348398, "comment_id": 75699294, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/36989329/why-does-this-function-that-uses-a-scoped-type-variable-in-a-where-clause-not-ty\">Why does this function that uses a scoped type variable in a where clause not typecheck?</a>"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1496523152, "post_id": 44348398, "comment_id": 75699331, "body": "On second glance, maybe not an exact duplicate, but related. You need to bring <code>a</code> into scope using a <code>forall</code> somewhere, but since this is an instance method, I think you also need <code>InstanceSigs</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1496523176, "post_id": 44348398, "comment_id": 75699340, "body": "You&#39;re on the right track with <code>ScopedTypeVariables</code> (which puts <code>r</code> in scope in the instance), but you need to bind <code>a</code> also with <code>InstanceSigs</code> extension, giving the signature for <code>(&gt;&gt;=)</code>.  You could also avoid the extension by giving <code>(&gt;&gt;=) = bind</code> and then providing a signature for <code>bind</code> in a <code>where</code> clause.  But I rather like <code>InstanceSigs</code> and am not sure why they are not normally allowed."}], "answers": [{"comments": [{"owner": {"reputation": 1317, "user_id": 2496293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/00f8e804a4fc2e35e44f88aae73100d9?s=128&d=identicon&r=PG", "display_name": "Sam De Meyer", "link": "https://stackoverflow.com/users/2496293/sam-de-meyer"}, "edited": false, "score": 0, "creation_date": 1496524285, "post_id": 44348530, "comment_id": 75699626, "body": "Yep, this compiles and totally makes sense. I didn&#39;t know about <code>InstanceSigs</code> but it&#39;s a really useful extenstion in my opinion. It makes intance declerations clearer too if you don&#39;t remember the exact type signature of the function being implemented. There is no Dragonball joke however :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1317, "user_id": 2496293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/00f8e804a4fc2e35e44f88aae73100d9?s=128&d=identicon&r=PG", "display_name": "Sam De Meyer", "link": "https://stackoverflow.com/users/2496293/sam-de-meyer"}, "edited": false, "score": 0, "creation_date": 1496535682, "post_id": 44348530, "comment_id": 75701807, "body": "@SamDeMeyer I didn&#39;t know about the extension before today, either! Turns out if you toss in the type signatures, GHC helpfully says &quot;Illegal type signature in instance declaration (Use InstanceSigs to allow this)&quot;."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1496523772, "creation_date": 1496523772, "answer_id": 44348530, "question_id": 44348398, "link": "https://stackoverflow.com/questions/44348398/seemingly-correct-type-signature-refused-in-where-block/44348530#44348530", "title": "Seemingly correct type signature refused in where block", "body": "<p>Makes sense. After all, where did those <code>a</code>s and <code>b</code>s come from? We have no way to know they're connected to the polymorphism of <code>(&gt;&gt;=)</code> and <code>return</code>. It's easy to fix, though, as mentioned in the comments: give <code>(&gt;&gt;=)</code> and <code>return</code> type signatures that mention <code>a</code> and <code>b</code>, toss in the requisite language extension, and hey presto:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE InstanceSigs #-}\n\nimport Control.Monad (ap)\n\n\nnewtype Cont r a = Cont {runCont :: (a -&gt; r) -&gt; r}\n\ninstance Functor (Cont r) where\n  fmap f ka = ka &gt;&gt;= pure . f\n\ninstance Applicative (Cont r) where\n  (&lt;*&gt;) = ap\n  pure = return\n\ninstance Monad (Cont r) where\n\n  (&gt;&gt;=) :: forall a b. Cont r a -&gt; (a -&gt; Cont r b) -&gt; Cont r b\n  ka &gt;&gt;= kab = Cont kb'\n    where\n      kb' :: (b -&gt; r) -&gt; r\n      kb' hb = ka' ha\n        where\n          ha :: (a -&gt; r)\n          ha a = (kab' a) hb\n\n      ka' :: (a -&gt; r) -&gt; r\n      ka' = runCont ka\n\n      kab' :: a -&gt; (b -&gt; r) -&gt; r\n      kab' a = runCont (kab a)\n\n\n  return :: forall a. a -&gt; Cont r a\n  return a = Cont ka'\n    where\n      ka' :: (a -&gt; r) -&gt; r\n      ka' ha = ha a\n</code></pre>\n\n<p>I feel like there's a Dragonball joke in all these <code>ka</code>s and <code>ha</code>s, but the joke escapes <code>me</code>.</p>\n"}], "owner": {"reputation": 1317, "user_id": 2496293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/00f8e804a4fc2e35e44f88aae73100d9?s=128&d=identicon&r=PG", "display_name": "Sam De Meyer", "link": "https://stackoverflow.com/users/2496293/sam-de-meyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 44348530, "answer_count": 1, "score": 1, "last_activity_date": 1496524678, "creation_date": 1496522759, "last_edit_date": 1496524678, "question_id": 44348398, "link": "https://stackoverflow.com/questions/44348398/seemingly-correct-type-signature-refused-in-where-block", "title": "Seemingly correct type signature refused in where block", "body": "<p>I have been messing around with continuation passing style in Haskell. Taking the <code>Cont</code> monad apart and removing the type wrappers helped me in understanding the implementation. Here is the code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Control.Monad (ap)\n\n\nnewtype Cont r a = Cont {runCont :: (a -&gt; r) -&gt; r}\n\ninstance Functor (Cont r) where\n  fmap f ka = ka &gt;&gt;= pure . f\n\ninstance Applicative (Cont r) where\n  (&lt;*&gt;) = ap\n  pure = return\n\ninstance Monad (Cont r) where\n\n  ka &gt;&gt;= kab = Cont kb'\n    where\n      -- kb' :: (b -&gt; r) -&gt; r\n      kb' hb = ka' ha\n        where\n          -- ha :: (a -&gt; r)\n          ha a = (kab' a) hb\n\n      -- ka' :: (a -&gt; r) -&gt; r\n      ka' = runCont ka\n\n      -- kab' :: a -&gt; (b -&gt; r) -&gt; r\n      kab' a = runCont (kab a)\n\n\n  return a = Cont ka'\n    where\n      -- ka' :: (a -&gt; r) -&gt; r\n      ka' ha = ha a\n</code></pre>\n\n<p>This code compiles (using GHC 8.0.2) and everything seems fine. However, as soon as I uncomment any of the (now commented) type signatures in the where block I get an error. For exapmle, if I uncomment the line</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>      -- ka' :: (a -&gt; r) -&gt; r\n</code></pre>\n\n<p>I get:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>    \u2022 Couldn't match type \u2018a\u2019 with \u2018a1\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          (&gt;&gt;=) :: forall a b. Cont r a -&gt; (a -&gt; Cont r b) -&gt; Cont r b\n        at cont.hs:19:6\n      \u2018a1\u2019 is a rigid type variable bound by\n        the type signature for:\n          ka' :: forall a1. (a1 -&gt; r) -&gt; r\n        at cont.hs:27:14\n      Expected type: (a1 -&gt; r) -&gt; r\n        Actual type: (a -&gt; r) -&gt; r\n    \u2022 In the expression: runCont ka\n      In an equation for \u2018ka'\u2019: ka' = runCont ka\n      In an equation for \u2018&gt;&gt;=\u2019:\n          ka &gt;&gt;= kab\n            = Cont kb'\n            where\n                kb' hb\n                  = ka' ha\n                  where\n                      ha a = (kab' a) hb\n                ka' :: (a -&gt; r) -&gt; r\n                ka' = runCont ka\n                kab' a = runCont (kab a)\n    \u2022 Relevant bindings include\n        ka' :: (a1 -&gt; r) -&gt; r (bound at cont.hs:28:7)\n        kab' :: a -&gt; (b -&gt; r) -&gt; r (bound at cont.hs:31:7)\n        kab :: a -&gt; Cont r b (bound at cont.hs:19:10)\n        ka :: Cont r a (bound at cont.hs:19:3)\n        (&gt;&gt;=) :: Cont r a -&gt; (a -&gt; Cont r b) -&gt; Cont r b\n          (bound at cont.hs:19:3)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>So I tried using a type wildcard to let the compiler tell me what type signature I should put there. As such I tried the following signature:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>      ka' :: _\n</code></pre>\n\n<p>Which gave the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>    \u2022 Found type wildcard \u2018_\u2019 standing for \u2018(a -&gt; r) -&gt; r\u2019\n      Where: \u2018r\u2019 is a rigid type variable bound by\n               the instance declaration at cont.hs:15:10\n             \u2018a\u2019 is a rigid type variable bound by\n               the type signature for:\n                 (&gt;&gt;=) :: forall a b. Cont r a -&gt; (a -&gt; Cont r b) -&gt; Cont r b\n               at cont.hs:19:6\n      To use the inferred type, enable PartialTypeSignatures\n    \u2022 In the type signature:\n        ka' :: _\n      In an equation for \u2018&gt;&gt;=\u2019:\n          ka &gt;&gt;= kab\n            = Cont kb'\n            where\n                kb' hb\n                  = ka' ha\n                  where\n                      ha a = (kab' a) hb\n                ka' :: _\n                ka' = runCont ka\n                kab' a = runCont (kab a)\n      In the instance declaration for \u2018Monad (Cont r)\u2019\n    \u2022 Relevant bindings include\n        ka' :: (a -&gt; r) -&gt; r (bound at cont.hs:28:7)\n        kab' :: a -&gt; (b -&gt; r) -&gt; r (bound at cont.hs:31:7)\n        kab :: a -&gt; Cont r b (bound at cont.hs:19:10)\n        ka :: Cont r a (bound at cont.hs:19:3)\n        (&gt;&gt;=) :: Cont r a -&gt; (a -&gt; Cont r b) -&gt; Cont r b\n          (bound at cont.hs:19:3)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Now I am really confused, the compiler tells me the type of <code>ka'</code> is <code>(a -&gt; r) -&gt; r</code> but as soon as I try to explicitely annotate <code>ka'</code> with this type,\ncompiling fails. First I thought I was missing <code>ScopedTypeVariables</code> but it does not seem to make a difference.</p>\n\n<p>What is going on here?</p>\n\n<p><strong>EDIT</strong>\nThis is similar to the question \" <a href=\"https://stackoverflow.com/q/36989329/2496293\">Why does this function that uses a scoped type variable in a where clause not typecheck?</a> \" in that it requires an explicit <code>forall</code> to bind type variables. However it is not a duplicate since the answer to this question also requires the <code>InstanceSigs</code> extension.</p>\n"}, {"tags": ["haskell", "show", "trace"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1496517608, "post_id": 44347665, "comment_id": 75697997, "body": "What if <code>a</code> is indeed an unshowable type? Either you add a <code>Show</code> constraint, or you need to avoid to print <code>first</code>. Possibly, the <code>input</code> sans the <code>second</code> suffix is already a good representation of <code>first</code>, anyway."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1496517727, "post_id": 44347665, "comment_id": 75698036, "body": "Not with <code>Debug.Trace</code>, and I&#39;m not aware of any modules that can do this (it would be very tricky to implement, since we would have to fabricate <code>Show</code> dictionaries with very little information -- types are not stored at runtime).  But you might want to check out <a href=\"https://downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/ghci-debugger.html\" rel=\"nofollow noreferrer\"><code>ghci</code>&#39;s debugging features</a>."}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 8028266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7df4a53c886b04901f81ccaaf3e16d65?s=128&d=identicon&r=PG&f=1", "display_name": "\u03c9-inconsistent", "link": "https://stackoverflow.com/users/8028266/%cf%89-inconsistent"}, "edited": false, "score": 0, "creation_date": 1496607738, "post_id": 44348486, "comment_id": 75718689, "body": "Your suggestion worked for me ... thanks. ... <code>ghci my_script.hs ...  *Main&gt; parse nextChar &quot;ABCD&quot; parse maps ABCD -&gt; [(&#39;A&#39;,&quot;BCD&quot;)] [(&#39;A&#39;,&quot;BCD&quot;)]</code>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1496523345, "creation_date": 1496523345, "answer_id": 44348486, "question_id": 44347665, "link": "https://stackoverflow.com/questions/44347665/when-tracing-in-haskell-how-does-one-show-a-value-whose-data-type-is-not-know/44348486#44348486", "title": "When tracing in Haskell, how does one `show` a value whose data type is not known at compile-time?", "body": "<p>Yes, sure, just follow the instructions in the error:</p>\n\n<pre><code>parse :: Show a =&gt; Parser a -&gt; String -&gt; [(a,String)]\n</code></pre>\n\n<p>Once you're done debugging, you can delete the call to <code>trace</code> and the <code>Show</code> constraint; then you'll be able to parse un-<code>Show</code>able things again.</p>\n"}], "owner": {"reputation": 37, "user_id": 8028266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7df4a53c886b04901f81ccaaf3e16d65?s=128&d=identicon&r=PG&f=1", "display_name": "\u03c9-inconsistent", "link": "https://stackoverflow.com/users/8028266/%cf%89-inconsistent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 1, "accepted_answer_id": 44348486, "answer_count": 1, "score": 1, "last_activity_date": 1496523345, "creation_date": 1496517097, "question_id": 44347665, "link": "https://stackoverflow.com/questions/44347665/when-tracing-in-haskell-how-does-one-show-a-value-whose-data-type-is-not-know", "title": "When tracing in Haskell, how does one `show` a value whose data type is not known at compile-time?", "body": "<p>I am using GHC version 8.0.2 on Windows 7, &amp; module <code>Debug.Trace</code>. \n In the trace of the <code>parse</code> function below, my insertion of <code>++ show first</code> results in the following error:</p>\n\n<ul>\n<li>No instance for (Show a) arising from a use of `show'\nPossible fix:\nadd (Show a) to the context of\n  the type signature for:\n    parse :: Parser a -> String -> [(a, String)]</li>\n<li>In the first argument of <code>(++)', namely</code>show first'\nIn the second argument of <code>(++)', namely\n</code>show first ++ \",\" ++ show second ++ \")]\"'\nIn the second argument of <code>(++)', namely\n</code>\" -> [(\" ++ show first ++ \",\" ++ show second ++ \")]\"' </li>\n</ul>\n\n<p>My question: is there a way to show the first element of the ordered pair <code>(a,String)</code> even though its type is not known at compile-time?</p>\n\n<p>My source code is shown below:</p>\n\n<pre><code>{-# LANGUAGE MonomorphismRestriction #-}\n\nimport Data.Typeable\nimport Data.Char\nimport Debug.Trace\n\nnewtype Parser a = P ( String -&gt; [(a,String)] )\n\nparse :: Parser a -&gt; String -&gt; [(a,String)]\nparse (P p) input | trace\n  ( let result  = (p input)\n        element = head result\n        first   = fst element\n        second  = snd element\n    in  (\"parse maps \" ++ input ++ \" -&gt; [(\" ++ show first ++ \",\" ++ show second ++ \")]\")\n  ) False = undefined\nparse (P p) input = p input\n\nnextChar :: Parser Char\nnextChar = P ( \\input -&gt; case input of { [] -&gt; [] ; (c:cs) -&gt; [(c,cs)] } )\n</code></pre>\n\n<p>I am hoping to trace evaluation of <code>parse nextChar \"ABCD\"</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1496511214, "post_id": 44346685, "comment_id": 75696182, "body": "I know I can write <code>stepRow :: [Cell] -&gt; [Cell]</code> that I can use to process a row at a time, then add those row-wise to the new board recursively (<code>step (row:rest) = [stepRow row] ++ step rest</code> or something similar), but since I know I can do it that way, and I don&#39;t know how I could do it this way, I&#39;d rather avoid that arbitrarily"}], "answers": [{"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1496514833, "post_id": 44347097, "comment_id": 75697235, "body": "This is great, thanks so much! Haskell is (so far) breaking my brain..."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 4, "last_activity_date": 1496513353, "creation_date": 1496513353, "answer_id": 44347097, "question_id": 44346685, "link": "https://stackoverflow.com/questions/44346685/conways-game-of-life-recursive-step-function/44347097#44347097", "title": "Conway&#39;s Game of Life recursive step function", "body": "<p>The last equation for <code>step'</code> is wrong.</p>\n\n<pre><code>step' (((coord, cell):restrow):rest) = [(coord, newCell (numNeighbors board coord) cell)] : (step' (restrow:rest))\n</code></pre>\n\n<p>For each cell in each row, you produce a new single-cell row as output. If you insist on writing all your recursion by hand, you can fix this by consing onto the first row returned by the recursive call, rather than creating a new row each time:</p>\n\n<pre><code>step' :: IndexedBoard -&gt; IndexedBoard\nstep' [] = []\nstep' ([]:rest) = [] : step' rest\nstep' (((coord, cell):restrow):rest) = \n  let (row:more) = step' (restrow:rest)\n  in ((coord, newCell (numNeighbors board coord) cell) : row) : more\n</code></pre>\n\n<p>However, there is a much better approach: all you are doing is trying to apply a function to each of the <code>(Coord, Cell)</code> pairs in your nested list, while maintaining the list's structure. But that's exactly what <code>map</code> is for! You should define a much simpler function that updates a single entry in the list, and then map it over all of them:</p>\n\n<pre><code>updateCell :: (Coord, Cell) -&gt; (Coord, Cell)\nupdateCell (coord, cell) = (coord, newCell (numNeighbors board coord) cell)\n\nstep' :: IndexedBoard -&gt; IndexedBoard\nstep' = map (map updateCell)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1496518399, "post_id": 44347557, "comment_id": 75698202, "body": "boy I don&#39;t grok any of that code. I&#39;ll have to take some time to figure out what <code>mapInEnvi</code> is doing, because I don&#39;t get it."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1496516381, "creation_date": 1496516381, "answer_id": 44347557, "question_id": 44346685, "link": "https://stackoverflow.com/questions/44346685/conways-game-of-life-recursive-step-function/44347557#44347557", "title": "Conway&#39;s Game of Life recursive step function", "body": "<p>For the actual question see amalloy's answer. This is a too-long-for-comment...</p>\n\n<p>The whole idea of <em>adding indices and then random-accessing other cells</em> (as <code>numNeighbours</code> does) is pretty unidiomatic in Haskells. Indices always forget a lot of structural information, are unsafe, and in particular for lists very inefficient. And pretty unnecessary: all you're ever accessing is <em>direct neighbours</em>.</p>\n\n<p>A much nicer approach is to generalise this idea of <em>mapping elements in their immediate environment</em>.</p>\n\n<pre><code>mapInEnvi :: (a -&gt; a -&gt; a -&gt; r) -&gt; [a] -&gt; [r]\nmapInEnvi f (a:b:c:l) = f a b c : mapInEnvi\n...  \u2020\n</code></pre>\n\n<p>The nice thing is how such a higher-order function composes: in your case you have a two-dimensional list, but you can basically just map in each direction independently:</p>\n\n<pre><code>step :: Board -&gt; Board\nstep = mapInEnvi modRow\n where modRow above row below = mapInEnvi modCell $ zip3 above row below\n       modCell (ne,e,se)\n               (n ,m, s)\n               (nw,w,sw) = case length $ filter (==On) [ne,e,se,n,s,nw,w,sw] of\n          0 -&gt; Off\n          1 -&gt; Off\n          2 -&gt; m\n          3 -&gt; On\n          _ -&gt; Off\n</code></pre>\n\n<p>Unlike the solution you were aiming for, this doesn't need to perform any direct position lookups, therefore the complexity is just <em>O</em> (<em>h</em> \u00b7 <em>w</em>) instead of <em>O</em> (<em>h</em> \u00b7 <em>w</em> \u00b7 (<em>h</em> + <em>w</em>)) where <em>h</em> and <em>w</em> are the height and width of the board.</p>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>In case of a finite-sized board it's a bit trickier \u2013 you'll need to decide what to do on the boundaries.</sub></p>\n"}], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "accepted_answer_id": 44347097, "answer_count": 2, "score": 2, "last_activity_date": 1496516381, "creation_date": 1496510588, "last_edit_date": 1496511499, "question_id": 44346685, "link": "https://stackoverflow.com/questions/44346685/conways-game-of-life-recursive-step-function", "title": "Conway&#39;s Game of Life recursive step function", "body": "<p>To help me begin to understand Haskell, I'm implementing Conway's Game of Life and ran into a snag in my step function trying to build a 2D list. Relevant definitions below:</p>\n\n<pre><code>data Cell = On | Off deriving (Eq, Show)\n\ntype Board = [[Cell]]\ntype Coord = (Int, Int)\ntype IndexedBoard = [[(Coord, Cell)]]\n\ntestBoard =     [[On, On,  On]\n                ,[On, Off, On]\n                ,[On, On,  On]]\n\nnumNeighbors :: Board -&gt; Coord -&gt; Int\n-- Returns the number of live neighbors given a Board and a Coord on that board\n-- assume this is implemented correctly, because it's a bunch of code\n-- that you don't otherwise need to read, and it passes tests.\n\naddIndexes :: Board -&gt; IndexedBoard\naddIndexes xs = [[((x,y), el) | (x,el) &lt;- zip [0..] row] | (y,row) &lt;- zip [0..] xs]\nremoveIndexes :: IndexedBoard -&gt; Board\nremoveIndexes = map (map snd)\n-- addIndexes testBoard is\n-- [ [((0, 0), On), ((1, 0), On),  ((2, 0), On)]\n--   ,((0, 1), On), ((1, 1), Off), ((2, 1), On)]\n--   ,((0, 2), On), ((1, 2), On),  ((2, 2), On)] ]\n-- and removeIndexes . addIndexes = id\n</code></pre>\n\n<p>My step function is where I'm having trouble. I'm not sure how to build the 2D list I expect without mutual recursion (which I'm trying to avoid arbitrarily).</p>\n\n<pre><code>step :: Board -&gt; Board\nstep board = removeIndexes . step' . addIndexes $ board where\n    step' :: IndexedBoard -&gt; IndexedBoard\n    step' [] = []\n    step' ([]:rest) = step' rest\n    step' (((coord, cell):restrow):rest) = [(coord, newCell (numNeighbors board coord) cell)] : (step' (restrow:rest))\n    newCell :: Int -&gt; Cell -&gt; Cell\n    newCell 2 On = On\n    newCell 3 _ = On\n    newCell _ _ = Off\n</code></pre>\n\n<p>I expect the follow output from <code>step testBoard</code>:</p>\n\n<pre><code>[[On,  Off, On ]\n,[Off, Off, Off]\n,[On,  Off, On ]]\n</code></pre>\n\n<p>But am instead getting:</p>\n\n<pre><code>[[On],  [Off], [On]\n,[Off], [Off], [Off]\n,[On],  [Off], [On]]\n</code></pre>\n\n<p>I understand that's because my recursive case of <code>step'</code> gives <code>[(coord, newCell (numNeighbors board coord) cell)] : ...</code>, but if I pull that out of the list I get the following error:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( gameoflife.hs, interpreted )\n\ngameoflife.hs:51:44: error:\n    \u2022 Couldn't match type \u2018(Coord, Cell)\u2019 with \u2018[(Coord, Cell)]\u2019\n      Expected type: IndexedBoard\n        Actual type: [(Coord, Cell)]\n    \u2022 In the expression:\n        (coord, newCell (numNeighbors board coord) cell)\n        : (step' (restrow : rest))\n      In an equation for \u2018step'\u2019:\n          step' (((coord, cell) : restrow) : rest)\n            = (coord, newCell (numNeighbors board coord) cell)\n              : (step' (restrow : rest))\n      In an equation for \u2018step\u2019:\n          step board\n            = removeIndexes . step' . addIndexes $ board\n            where\n                step' :: IndexedBoard -&gt; IndexedBoard\n                step' [] = []\n                step' ([] : rest) = step' rest\n                step' (((coord, cell) : restrow) : rest)\n                  = (coord, newCell (numNeighbors board coord) cell)\n                    : (step' (restrow : rest))\n                newCell :: Int -&gt; Cell -&gt; Cell\n                newCell 2 On = On\n                newCell 3 _ = On\n                newCell _ _ = Off\n\ngameoflife.hs:51:96: error:\n    \u2022 Couldn't match type \u2018[(Coord, Cell)]\u2019 with \u2018(Coord, Cell)\u2019\n      Expected type: [(Coord, Cell)]\n        Actual type: IndexedBoard\n    \u2022 In the second argument of \u2018(:)\u2019, namely\n        \u2018(step' (restrow : rest))\u2019\n      In the expression:\n        (coord, newCell (numNeighbors board coord) cell)\n        : (step' (restrow : rest))\n      In an equation for \u2018step'\u2019:\n          step' (((coord, cell) : restrow) : rest)\n            = (coord, newCell (numNeighbors board coord) cell)\n              : (step' (restrow : rest))\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1496530403, "post_id": 44346435, "comment_id": 75700915, "body": "To switch to the latest LTS snapshot (which currently uses GHC-8.0.2), you can run <code>stack config set resolver lts</code>."}], "answers": [{"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 1, "creation_date": 1496510651, "post_id": 44346588, "comment_id": 75695992, "body": "When I  want to start <code>stack ghci</code> without a project I want to use version 8.0.2 not 8.0.1, how can I switch the version?"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 3, "last_activity_date": 1496509900, "creation_date": 1496509900, "answer_id": 44346588, "question_id": 44346435, "link": "https://stackoverflow.com/questions/44346435/change-ghci-version-on-stack/44346588#44346588", "title": "Change ghci version on stack", "body": "<p><code>stack</code> is a build tool that coordinates building projects with different versions of GHC and sets of dependencies. So you can upgrade <code>stack</code> independently of ghc.</p>\n\n<p>I'm not quite sure what the expected behavior of <code>stack ghci</code> is when it's run outside of a project directory. Presumably you con configure the default version of <code>ghc</code> to use in that case in your <code>~/.stack/config.yaml</code>. See: <a href=\"http://docs.haskellstack.org/en/stable/yaml_configuration/\" rel=\"nofollow noreferrer\">http://docs.haskellstack.org/en/stable/yaml_configuration/</a></p>\n\n<p>You should also be able to do:</p>\n\n<pre><code>$ stack ghci --with-ghc ghc-7.10.3\n</code></pre>\n\n<p>But usually the version of ghc is determined by the stackage snapshot you've configured for your project, for instance if you have a <code>stack.yaml</code> with:</p>\n\n<pre><code>resolver: lts-3.3\n</code></pre>\n\n<p>...you will be using ghc-7.10.3</p>\n"}, {"tags": [], "owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "is_accepted": false, "score": 4, "last_activity_date": 1545015415, "last_edit_date": 1545015415, "creation_date": 1518246458, "answer_id": 48718204, "question_id": 44346435, "link": "https://stackoverflow.com/questions/44346435/change-ghci-version-on-stack/48718204#48718204", "title": "Change ghci version on stack", "body": "<p>According to <a href=\"https://docs.haskellstack.org/en/stable/faq/#what-version-of-ghc-is-used-when-i-run-something-like-stack-ghci\" rel=\"nofollow noreferrer\">https://docs.haskellstack.org/en/stable/faq/#what-version-of-ghc-is-used-when-i-run-something-like-stack-ghci</a>, </p>\n\n<blockquote>\n  <p>The version of GHC, as well as which packages can be installed, are specified by the <em>resolver</em>.</p>\n</blockquote>\n\n<p>So, to change the version of GHC used when executing <code>stack ghci</code> <em>outside</em> stack projects, do:</p>\n\n<ol>\n<li><p>Find an existing resolver in <code>~/.stack/build-plan</code>, e.g. <code>lts-10.4</code>, or download a new resolver you need;</p></li>\n<li><p>Execute <code>stack config set resolver lts-10.4</code>. Yes it updates <code>~/.stack/global-project/stack.yaml</code>.</p></li>\n</ol>\n\n<p>As thus, <code>stack ghci</code> outside stack projects will use GHC 8.2.2, which is the GHC version specified by resolver <code>lts-10.4</code> (This relationship can be found at <a href=\"https://www.stackage.org/lts-10.4\" rel=\"nofollow noreferrer\">https://www.stackage.org/lts-10.4</a>, or in file <code>~/.stack/build-plan/lts-10.4.yaml</code> which says <code>ghc-version: '8.2.2'</code>).</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3954, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1545015415, "creation_date": 1496509114, "last_edit_date": 1496511126, "question_id": 44346435, "link": "https://stackoverflow.com/questions/44346435/change-ghci-version-on-stack", "title": "Change ghci version on stack", "body": "<p>I have stack installed on my computer for haskell:</p>\n\n<pre><code>Developers-MacBook-Pro:~ developer$ stack ghci\nConfiguring GHCi with the following packages:\nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from /private/var/folders/2x/t_2cl03x2092dkzvc702d7lc0000gn/T/ghci2170/ghci-script\nPrelude&gt;  \n</code></pre>\n\n<p>As you can see version is still 8.0.1. Then I upgraded the stack as follow:</p>\n\n<pre><code>Developers-MacBook-Pro:~ developer$ stack upgrade\nCurrent Stack version: 1.3.2, available download version: 1.4.0\nNewer version detected, downloading\nQuerying for archive location for platform: osx-x86_64-static\nQuerying for archive location for platform: osx-x86_64\nDownloading from: https://github.com/commercialhaskell/stack/releases/download/v1.4.0/stack-1.4.0-osx-x86_64.tar.gz\nDownload complete, testing executable\nVersion 1.4.0, Git revision e714f1dd3fade19496d91bd6a017e435a96a6bcd (4640 commits) x86_64 hpack-0.17.0\nNew stack executable available at /Users/developer/.local/bin/stack \n</code></pre>\n\n<p>After I start <code>stack ghci</code> again and I've got still version 8.0.1, what am I doing wrong?</p>\n\n<p>The image shows, that <code>ghci</code> version 8.0.2 has successfully installed:<br>\n<a href=\"https://i.stack.imgur.com/URjOv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/URjOv.png\" alt=\"enter image description here\"></a></p>\n\n<p>The path is <code>/Users/developer/.stack/programs/x86_64-osx/</code></p>\n\n<p><strong>Update</strong>\nIn the path <code>/Users/developer/.stack/</code>, there is a folder called <code>global-project</code> and I change the yaml as follow:   </p>\n\n<p><a href=\"https://i.stack.imgur.com/vPvnn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vPvnn.png\" alt=\"enter image description here\"></a></p>\n\n<p>Now stack ghci run on version 8.0.2:</p>\n\n<pre><code>Developers-MBP:~ developer$ stack ghci\nConfiguring GHCi with the following packages:\nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from /private/var/folders/2x/t_2cl03x2092dkzvc702d7lc0000gn/T/ghci526/ghci-script\n</code></pre>\n"}, {"tags": ["haskell", "intellij-idea", "terminal", "intellij-plugin", "scotty"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1496509215, "post_id": 44345860, "comment_id": 75695557, "body": "Is something in the scotty stack redirecting stdout? Maybe capturing it for logging and emitting it on stderr? I&#39;m not familiar with intellij"}, {"owner": {"reputation": 171, "user_id": 5067835, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/11287daae7bde8f53445471d428122c6?s=128&d=identicon&r=PG&f=1", "display_name": "Enis", "link": "https://stackoverflow.com/users/5067835/enis"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1496510959, "post_id": 44345860, "comment_id": 75696101, "body": "You were right, it was. Just answered my own question. So annoying..."}], "answers": [{"tags": [], "owner": {"reputation": 171, "user_id": 5067835, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/11287daae7bde8f53445471d428122c6?s=128&d=identicon&r=PG&f=1", "display_name": "Enis", "link": "https://stackoverflow.com/users/5067835/enis"}, "is_accepted": true, "score": 0, "last_activity_date": 1496510934, "creation_date": 1496510934, "answer_id": 44346745, "question_id": 44345860, "link": "https://stackoverflow.com/questions/44345860/how-to-log-to-terminal-using-scotty-with-intellij-haskell-plugin/44346745#44346745", "title": "How to log to terminal using scotty with Intellij (Haskell plugin)?", "body": "<p>Figured it out. Needed to make a logger as follows:</p>\n\n<pre><code> logger &lt;- mkRequestLogger def {\n   outputFormat = CustomOutputFormat (\\_ _ _ _ -&gt; \"\")\n   }\n</code></pre>\n\n<p>so that the resulting code would look like:</p>\n\n<pre><code>main :: IO ()\nmain\n = do\n     logger &lt;- mkRequestLogger def {\n       outputFormat = CustomOutputFormat (\\_ _ _ _ -&gt; \"\")\n       }\n     scotty 8000 $ do\n       middleware logger\n       -- do stuff here\n</code></pre>\n\n<p>The CustomOutputFormat ignores all other incoming information, focusing only on what you want to print to the console.</p>\n"}], "owner": {"reputation": 171, "user_id": 5067835, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/11287daae7bde8f53445471d428122c6?s=128&d=identicon&r=PG&f=1", "display_name": "Enis", "link": "https://stackoverflow.com/users/5067835/enis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 44346745, "answer_count": 1, "score": 1, "last_activity_date": 1496510934, "creation_date": 1496505613, "question_id": 44345860, "link": "https://stackoverflow.com/questions/44345860/how-to-log-to-terminal-using-scotty-with-intellij-haskell-plugin", "title": "How to log to terminal using scotty with Intellij (Haskell plugin)?", "body": "<p>So I'm having something odd happen. Here's an illustrative code example:</p>\n\n<pre><code>main :: IO ()\nmain\n = do\n     scotty 8000 $ do\n       get \"/\" serve\n where\n  serve :: ActionM ()\n  serve = do\n    liftIO $ print \"I'm about to serve a request!\"\n</code></pre>\n\n<p>My message should print to the IntelliJ console whenever I type in \"localhost:8000/\", but it doesn't. Yet when I comment out the scotty stuff and just have:</p>\n\n<pre><code>main :: IO ()\nmain\n = do print \"Hello World!\"\n</code></pre>\n\n<p>IntelliJ has no problem printing this out. What am I doing wrong? When I use the Windows command prompt to run the executable (e.g. ghc --make to create it, then running it), everything works fine - \"I'm about to serve a request!\" prints to the command prompt terminal everytime I Type in \"localhost:8000/\"</p>\n"}, {"tags": ["haskell", "monoids"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 8, "creation_date": 1496501057, "post_id": 44344821, "comment_id": 75693013, "body": "Yet another alternative: <code>appEndo $ foldMap Endo [id,id,id,id]</code>"}, {"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1529827530, "post_id": 44344821, "comment_id": 89009091, "body": "So, <code>Monoid Endo</code> has <code>mempty = id ; mappend = (.)</code>, if I understand correctly?"}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 11, "last_activity_date": 1496499188, "creation_date": 1496499188, "answer_id": 44344821, "question_id": 44344706, "link": "https://stackoverflow.com/questions/44344706/how-do-i-use-a-monoid-instance-of-a-function/44344821#44344821", "title": "How do I use a monoid instance of a function?", "body": "<p>You're using this instance:</p>\n\n<pre><code>instance Monoid b =&gt; Monoid (a -&gt; b) where\n    mempty _ = mempty\n    mappend f g x = f x `mappend` g x\n</code></pre>\n\n<p>which is more general because it doesn't require endomorphisms (i.e. <code>a -&gt; a</code>). To get the instance you were expecting, you can wrap your functions in <code>Endo</code>:</p>\n\n<pre><code>appEndo (mconcat [Endo id, Endo id, Endo id, Endo id])\n</code></pre>\n\n<p>or</p>\n\n<pre><code>appEndo $ mconcat $ fmap Endo [id, id, id, id]\n</code></pre>\n"}], "owner": {"reputation": 1069, "user_id": 5923374, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bd4f47d4ba513ba8ed316520a12f94a9?s=128&d=identicon&r=PG&f=1", "display_name": "Ford O.", "link": "https://stackoverflow.com/users/5923374/ford-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 796, "favorite_count": 1, "accepted_answer_id": 44344821, "answer_count": 1, "score": 6, "last_activity_date": 1496558263, "creation_date": 1496498390, "last_edit_date": 1496558263, "question_id": 44344706, "link": "https://stackoverflow.com/questions/44344706/how-do-i-use-a-monoid-instance-of-a-function", "title": "How do I use a monoid instance of a function?", "body": "<p>Today I tried to reduce a list of functions trough monoid typeclass but the resulting function expects its argument to be an instance of Monoid for some reason.</p>\n\n<p>GHCI tells me that the type of <code>mconcat [id, id, id, id]</code> is <code>Monoid a =&gt; a -&gt; a</code>. Yet I would expect it to be <code>a -&gt; a</code>.</p>\n\n<p>What is happening?</p>\n"}, {"tags": ["git", "haskell", "github", "travis-ci", "hackage"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1496502548, "post_id": 44341596, "comment_id": 75693423, "body": "I have seen travis scripts that automatically release to hackage. For example, if they are building a tag. In that case, the workflow would be to tag in git, and that\u2019s it."}], "answers": [{"tags": [], "owner": {"reputation": 621, "user_id": 2192313, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OBQF9.jpg?s=128&g=1", "display_name": "Hawkins", "link": "https://stackoverflow.com/users/2192313/hawkins"}, "is_accepted": true, "score": 2, "last_activity_date": 1529884144, "creation_date": 1529884144, "answer_id": 51014834, "question_id": 44341596, "link": "https://stackoverflow.com/questions/44341596/managing-hackage-releases/51014834#51014834", "title": "Managing hackage releases", "body": "<p>Travis CI docs make this pretty simple these days, you can follow their docs for <a href=\"https://docs.travis-ci.com/user/deployment#Conditional-Releases-with-on%3A\" rel=\"nofollow noreferrer\">deployment</a> to set up conditional deployment (i.e., when a git tag is made). You can configure it to deploy straight to hackage as well, <a href=\"https://docs.travis-ci.com/user/deployment/hackage/\" rel=\"nofollow noreferrer\">per travis docs</a>.</p>\n\n<p>Here's a semi-complete example config:</p>\n\n<pre><code>deploy:\n  provider: hackage\n  username: \"Hackage User Name\"\n  password: \"Hackage Password\"\n  on:\n    tags: true\n</code></pre>\n\n<p>Note per Travis docs, \"it is recommended to encrypt password. Assuming you have the Travis CI command line client installed, you can do it like this: <code>travis encrypt --add deploy.password</code>\". See their <a href=\"https://docs.travis-ci.com/user/encryption-keys/\" rel=\"nofollow noreferrer\">docs on encryption</a> for more help on that, since unfortunately I haven't done that part before.</p>\n\n<p>This changes your workflow just a little bit; the end result would be:</p>\n\n<ol>\n<li>Tag and push changes to GitHub</li>\n<li>Wait for Travis to test, if all is well, Travis will upload to Hackage for you</li>\n<li>If all is not well, fix the bug, and pick a new tag. You may be able to re-use the tag by deleting and re-tagging, but I'm not sure if Travis will accept it</li>\n</ol>\n\n<p>So if you can run any tests locally, be reasonably sure that all is well, you can tag a release and push and Travis will do the rest.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 5, "accepted_answer_id": 51014834, "answer_count": 1, "score": 5, "last_activity_date": 1529884144, "creation_date": 1496475474, "question_id": 44341596, "link": "https://stackoverflow.com/questions/44341596/managing-hackage-releases", "title": "Managing hackage releases", "body": "<p>Currently, when I want to update one of my hackage packages, I go through this process.</p>\n\n<ol>\n<li>Push the changes to github</li>\n<li>Wait for travis-ci to run on the changes, to ensure I'm not getting any build errors.</li>\n<li>Upload to hackage</li>\n<li>Tag the release in git.</li>\n</ol>\n\n<p>Naturally, each of these steps I only want to do if the previous step is successful.</p>\n\n<p>I presume other people have a similar workflow, is there something that does all these steps? I could probably do (1), (3) and (4) in a script, although (2) I'm not so sure about (that is, checking the results of travis-ci) but as this seems to be a common problem I was wondering if someone has already solved it so I don't reinvent the wheel.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 4, "last_activity_date": 1496451161, "last_edit_date": 1496451161, "creation_date": 1496450727, "answer_id": 44339202, "question_id": 44339079, "link": "https://stackoverflow.com/questions/44339079/multiple-conditions-when-using-guards-in-haskell/44339202#44339202", "title": "Multiple conditions when using guards in haskell", "body": "<p>You could move the test for a vacant location to a helper function (<code>vacant</code>, say) and write your other conditions in <code>valid</code>, such as with an additional <code>score</code> function:</p>\n\n<pre><code>valid :: Piece -&gt; Pieces -&gt; Bool\nvalid p xs = vacant p xs &amp;&amp; score p xs &gt; 0\n\nvacant :: Piece -&gt; Pieces -&gt; Bool\nvacant p [] = True\nvacant p (x:xs)\n  | getPos p == getPos x = False\n  | otherwise = vacant p xs\n\nscore :: Piece -&gt; Pieces -&gt; Int\nscore p xs = error \"TODO\"\n</code></pre>\n\n<p>You can also express <code>vacant</code> more simply, avoiding explicit recursion:</p>\n\n<pre><code>import Data.List (notElem)\n\nvacant p xs = getPos p `notElem` map getPos xs\n</code></pre>\n\n<p>However, I would guess that computing the score relies on the fact that the move was possible. So you might find that it\u2019s an improvement to roll this into a single function that tests for a valid move with a positive score and returns a <code>Maybe</code>:</p>\n\n<pre><code>score :: Piece -&gt; Pieces -&gt; Maybe Int\nscore p xs\n  | getPos p `notElem` map getPos xs = let\n    computedScore = error \"TODO\"\n    in if computedScore &gt; 0\n      then Just computedScore\n      else Nothing\n\n  | otherwise = Nothing\n</code></pre>\n\n<p>Now you can pattern-match on the result of <code>score</code>: if you get <code>Nothing</code>, then the move was invalid or didn\u2019t result in a positive score; if you get <code>Just s</code>, then the move was valid and resulted in the score <code>s</code>.</p>\n"}], "owner": {"reputation": 83, "user_id": 8076776, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fef6962545947b51ea6008f0308330f7?s=128&d=identicon&r=PG&f=1", "display_name": "Dave", "link": "https://stackoverflow.com/users/8076776/dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2171, "favorite_count": 0, "accepted_answer_id": 44339202, "answer_count": 1, "score": 0, "last_activity_date": 1496451161, "creation_date": 1496449531, "question_id": 44339079, "link": "https://stackoverflow.com/questions/44339079/multiple-conditions-when-using-guards-in-haskell", "title": "Multiple conditions when using guards in haskell", "body": "<p>I'm trying to determine a valid move. A move must meet two conditions to make it a valid move. The first condition is making sure there is no existing piece already in the position where I want to move, the second condition is making sure I will score a point when I make this move.</p>\n\n<p>I have completed the code for the first condition, but I don't know how to follow this on with the second condition. Perhaps the reason why its difficult is because it returns a Bool, which needs to be set at True or False when one of the other conditions is met. For example</p>\n\n<pre><code>valid :: Piece -&gt; Pieces -&gt; Bool\nvalid p [] = True\nvalid p (x:xs) | getPos(p) == getPos(x) = False\n                       | otherwise = valid p xs\n</code></pre>\n\n<p>So as you can see, I have done the code for the first condition, now how do I add in the second condition?</p>\n\n<p>Something like</p>\n\n<pre><code>valid :: Piece -&gt; Pieces -&gt; Bool\nvalid p [] = True\nvalid p (x:xs) | getPos(p) == getPos(x) = False\n                       | otherwise = valid p xs\n                       &amp;&amp; ...\n</code></pre>\n\n<p>But then again, this function will stop if the first condition either fails or passes. Whats the work around for this?</p>\n\n<p>EDIT: Declarations</p>\n\n<pre><code>data Piece = Piece Position Player\ntype Pieces = [Piece]\n</code></pre>\n\n<p>EDIT: getPos</p>\n\n<p>getPos is a function that retrieves the position of a piece</p>\n"}, {"tags": ["haskell", "yesod", "persistent"], "owner": {"reputation": 427, "user_id": 7941330, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/u7jCJ.jpg?s=128&g=1", "display_name": "F&#225;bio Roberto Teodoro", "link": "https://stackoverflow.com/users/7941330/f%c3%a1bio-roberto-teodoro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1496447968, "creation_date": 1496447968, "question_id": 44338925, "link": "https://stackoverflow.com/questions/44338925/how-to-make-migrations-silent-in-a-scaffolded-application", "title": "How to make migrations silent in a scaffolded application", "body": "<p>My application was scaffolded with the yesod-sqlite stack template. What is the best way to configure it to not show the SQL executed by the migration? Ideally redirect it to some file.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1496439048, "post_id": 44337541, "comment_id": 75679343, "body": "It&#39;s not totally clear what you want. Can you provide a few type signatures for the different cases of <code>match</code> you&#39;d like to abstract? e.g. <code>matchRegExp :: RegExp Char -&gt; [Char] -&gt; Bool</code>, <code>matchComplexReg :: ComplexRegex ...</code> etc."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1496439160, "post_id": 44337541, "comment_id": 75679369, "body": "you likely want either associated types (newer, more verbose) or fundeps (older, less verbose) but it&#39;s hard to say without actual code"}, {"owner": {"reputation": 9281, "user_id": 569183, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7a5501609561c72703bb74bbf88ca800?s=128&d=identicon&r=PG", "display_name": "tekknolagi", "link": "https://stackoverflow.com/users/569183/tekknolagi"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1496445571, "post_id": 44337541, "comment_id": 75681097, "body": "@jberryman and haoformayor see Alec&#39;s answer -- pretty much exactly that"}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1496439984, "post_id": 44337716, "comment_id": 75679628, "body": "N.B. You probably want at least <code>(Eq a) =&gt; b a -&gt; [a] -&gt; Bool</code>, otherwise <code>match</code> doesn&#39;t have any structure to work with in <code>a</code>."}, {"owner": {"reputation": 9281, "user_id": 569183, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7a5501609561c72703bb74bbf88ca800?s=128&d=identicon&r=PG", "display_name": "tekknolagi", "link": "https://stackoverflow.com/users/569183/tekknolagi"}, "edited": false, "score": 0, "creation_date": 1496445427, "post_id": 44337716, "comment_id": 75681076, "body": "This is excellent -- thank you! Is there a way to put the type constraint <code>Eq a</code> in the class as opposed to the function <code>match</code>?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1496446667, "post_id": 44337716, "comment_id": 75681292, "body": "@tokknoiagi, I suppose you could add a method <code>matchableEq :: b a -&gt; Dict (Eq a)</code> to the class (where <code>Dict</code> is from <a href=\"https://hackage.haskell.org/package/constraints-0.9.1/docs/Data-Constraint.html#t:Dict\" rel=\"nofollow noreferrer\">constraints</a>), which says that if <code>b</code> is <code>Matchable</code> then <code>b a</code> always comes with an <code>Eq a</code> dictionary.  But this would be pretty unorthodox design (fun to play with though).  <code>match :: (Eq a) =&gt; ...</code> seems completely reasonable."}, {"owner": {"reputation": 9281, "user_id": 569183, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7a5501609561c72703bb74bbf88ca800?s=128&d=identicon&r=PG", "display_name": "tekknolagi", "link": "https://stackoverflow.com/users/569183/tekknolagi"}, "edited": false, "score": 0, "creation_date": 1496447087, "post_id": 44337716, "comment_id": 75681374, "body": "Thanks! I agree; this seems quite clean cut."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 6, "last_activity_date": 1496439148, "creation_date": 1496439148, "answer_id": 44337716, "question_id": 44337541, "link": "https://stackoverflow.com/questions/44337541/match-against-type-in-haskell-typeclass/44337716#44337716", "title": "Match against type in Haskell typeclass", "body": "<p>Keeping things simple, why not just make the class variable of <code>Matchable</code> have kind <code>* -&gt; *</code>? (See <code>Functor</code>, <code>Applicative</code>, <code>Monad</code>, <code>Foldable</code>, <code>Traversable</code> for other examples of higher-kinder classes).</p>\n\n<pre><code>class Matchable b where\n  --   regex, input, success\n  match :: b a -&gt; [a] -&gt; Bool\n\ninstance Matchable ComplexRegex where\n  -- match :: ComplexRegex a -&gt; [a] -&gt; Bool\n  match = error \"unimplemented\"\n\ninstance Matchable RegExp where\n  -- match :: RegExp a -&gt; [a] -&gt; Bool\n  match = error \"unimplemented\"\n</code></pre>\n\n<p>Then, you can match against a <code>String ~ [Char]</code> with either a <code>ComplexRegex Char</code> or a <code>RegExp Char</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1496440094, "post_id": 44337738, "comment_id": 75679662, "body": "This is a strange class.  There is no loss of expressivity to just use the simple <code>match :: r -&gt; String -&gt; Bool</code> at this point, because the type argument isn&#39;t being used in a polymorphic way."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1496440234, "post_id": 44337738, "comment_id": 75679706, "body": "@luqui I agree that having <code>match :: r a -&gt; [a] -&gt; Bool</code> function may be more useful as a more polymorphic variant. But probably for beginner it&#39;s easier to start with less polymorphic version if this type of solution will be accepted."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496441113, "post_id": 44337738, "comment_id": 75679990, "body": "@Shersh Why not go all the way and have <code>match :: r -&gt; String -&gt; Bool</code> and just turn on <code>FlexibleInstances</code>? Seems like that, if anything, would be simpler."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496485565, "post_id": 44337738, "comment_id": 75688760, "body": "@Alec If you care about only <code>Char</code> then <code>match :: r -&gt; String -&gt; Bool</code> may be a reasonable alternative. I can&#39;t argue which approach is better, just trying to avoid some extensions if possible :) But <code>r Char</code> is one step closer to the more polymorphic version which is eventually will be the right choice. Answer was about higher-kinded types which solves problem."}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 1, "last_activity_date": 1496439288, "creation_date": 1496439288, "answer_id": 44337738, "question_id": 44337541, "link": "https://stackoverflow.com/questions/44337541/match-against-type-in-haskell-typeclass/44337738#44337738", "title": "Match against type in Haskell typeclass", "body": "<p>You're probably looking for higher-kinded types. If you only interested in <code>Char</code> and <code>String</code> and behavior of function depends only on whether it's <code>RegExp</code> or <code>ComplexRegex</code> then you can define next type class:</p>\n\n<pre><code>class Matchable r where\n  --   regex, input, success\n  match :: r Char -&gt; String -&gt; Bool\n</code></pre>\n\n<p>Here <code>r</code> is type variable that has kind <code>* -&gt; *</code>. In simple words, it's an <em>incomplete type</em>. Like <code>Maybe</code>. Your function can't have type <code>Maybe -&gt; Int</code> because <code>Maybe</code> is incomplete type but <code>Maybe Bool</code> is complete type. Similar with regular expressions: <code>RegExp</code> and <code>ComplexRegex</code> are both incomplete types. Thanks to Haskell reach type system your functions can be parametrized over incomplete types as well. So later when you define instances, you will write them in the next way:</p>\n\n<pre><code>instance Matchable RegExp where\n   ... -- implementation for RegExp goes here\n\ninstance Matchable ComplexRegex where\n   ... -- implementation for CompltexRegex goes here\n</code></pre>\n\n<p>You can find <code>-XKindSignatures</code> and <code>-XInstanceSigs</code> language extensions helpful when specifying types of functions and types of types explicitly.</p>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496501791, "post_id": 44341135, "comment_id": 75693227, "body": "I think this answer could benefit from another instance example such as <code>instance Matchable StringRegex where { type Target StringRegex = Char ... }</code>."}, {"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496504919, "post_id": 44341135, "comment_id": 75694228, "body": "@Alec Yes, I neglected it originally."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1496505372, "post_id": 44341135, "comment_id": 75694382, "body": "Another small detail: this approach lets you have different constraints on the <code>Target</code> type for each instance - not just on the class."}], "tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 2, "last_activity_date": 1496504829, "last_edit_date": 1496504829, "creation_date": 1496472113, "answer_id": 44341135, "question_id": 44337541, "link": "https://stackoverflow.com/questions/44337541/match-against-type-in-haskell-typeclass/44341135#44341135", "title": "Match against type in Haskell typeclass", "body": "<p>As an alternative to Alec's solution, you could use <a href=\"https://wiki.haskell.org/GHC/Type_families#An_associated_data_type_example\" rel=\"nofollow noreferrer\">associated types</a>. This allows types which don't have kind <code>* -&gt; *</code>, but if it isn't necessary, I'd go with the simpler solution. E.g. imagine that in addition to <code>RegExp a</code> and <code>ComplexRegex a</code> you have <code>StringRegex</code> with is not parametrized, or maybe you can only implement <code>match</code> for <code>ComplexRegex Char</code> and not <code>ComplexRegex a</code>:</p>\n\n<pre><code>class Matchable b where\n  type Target b :: *\n  --   regex, input, success\n  match :: b -&gt; [Target b] -&gt; Bool\n\ninstance Eq a =&gt; Matchable (ComplexRegex a) where\n  type Target (ComplexRegex a) = a\n  -- match :: ComplexRegex a -&gt; [a] -&gt; Bool\n  match = error \"unimplemented\"\n\ninstance Matchable StringRegex where\n  type Target StringRegex = Char\n  -- match :: StringRegex -&gt; [Char] -&gt; Bool\n  match = error \"unimplemented\"\n\n-- requires FlexibleInstances\ninstance Matchable (ComplexRegex Char) where\n  type Target (ComplexRegex Char) = Char\n  -- match :: ComplexRegex Char -&gt; [Char] -&gt; Bool\n  match = error \"unimplemented\"\n</code></pre>\n\n<p>Another difference is that your instances can ensure <code>Eq (Target b)</code>, instead of putting it into type of <code>match</code> (and you can also make it a requirement: <code>class Eq (Target b) =&gt; Matchable b where ...</code>).</p>\n"}], "owner": {"reputation": 9281, "user_id": 569183, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7a5501609561c72703bb74bbf88ca800?s=128&d=identicon&r=PG", "display_name": "tekknolagi", "link": "https://stackoverflow.com/users/569183/tekknolagi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 44337716, "answer_count": 3, "score": 2, "last_activity_date": 1496504829, "creation_date": 1496438181, "last_edit_date": 1496439231, "question_id": 44337541, "link": "https://stackoverflow.com/questions/44337541/match-against-type-in-haskell-typeclass", "title": "Match against type in Haskell typeclass", "body": "<p>I'm not sure how to phrase this exactly so if someone has a good name for it please let me know.</p>\n\n<p>I'm trying to write a typeclass called <code>Matchable</code>. The idea is a couple different types of regular expressions that I have (<code>RegExp a</code>, <code>ComplexRegex a</code>) should be able to match on input.</p>\n\n<p>So I tried this:</p>\n\n<pre><code>class Matchable a where\n  --   regex, input, success\n  match :: a -&gt; b -&gt; Bool\n</code></pre>\n\n<p>But what I really want is to deconstruct the constructor in the typeclass with a type constructor variable or something:</p>\n\n<pre><code>class Matchable a where\n  --   regex, input, success\n  match :: (B a) -&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>That way I can have a <code>RegExp Char</code> and a <code>ComplexRegex Char</code> both match on a <code>String</code>. Is there any way to do this? Thanks.</p>\n"}, {"tags": ["haskell", "design-patterns", "maybe"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1496437429, "post_id": 44336324, "comment_id": 75678717, "body": "<code>Date</code> is isomorphic to a tuple, which already knows how to perform the type of lexicographic comparison you want: <code>isOlder2 (Date x y z) (Just (Date a b c)) = (x, y, z) &lt; (a, b, c)</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1496437532, "post_id": 44336324, "comment_id": 75678757, "body": "In fact, you don&#39;t even need to define <code>isOlder2</code>; <code>data Date = Date Int Int Int deriving (Eq, Ord)</code> will allow you to write <code>Date 1 2 3 &lt; Date 4 5 6</code>, for example."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1496478459, "post_id": 44336324, "comment_id": 75686868, "body": "The signature <code>Date -&gt; Maybe Date -&gt; Bool</code> is strange.  What is the significance of using <code>Maybe</code>  for the second argument?  Why not just <code>Date -&gt; Date -&gt; Bool</code> ?"}], "answers": [{"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 5, "last_activity_date": 1496478376, "last_edit_date": 1496478376, "creation_date": 1496433773, "answer_id": 44336612, "question_id": 44336324, "link": "https://stackoverflow.com/questions/44336324/haskell-non-exhaustive-patterns-in-function-error-in-maybe/44336612#44336612", "title": "Haskell Non-exhaustive patterns in function error in Maybe?", "body": "<p>And what should happen when the second argument here is <code>Nothing</code>?:</p>\n\n<pre><code>isOlder2 :: Date -&gt; Maybe Date -&gt; Bool\nisOlder2 (Date x y z) (Just (Date a b c)) = ...\n</code></pre>\n\n<p>Asking ghci to tell us about the <code>Maybe</code> type:</p>\n\n<pre><code>*Main&gt; :info Maybe\ndata Maybe a = Nothing | Just a     -- Defined in \u2018GHC.Base\u2019\n</code></pre>\n\n<p>This tells us that a value of type <code>Maybe Date</code> can be either <code>Nothing</code> or <code>Just (Date ...)</code>.  So you need to add another equation to handle the <code>Nothing</code> case:</p>\n\n<pre><code>isOlder2 (Date x y z) Nothing = ...\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 7783162, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/6e62c4e6b65938a046b006528860b30b?s=128&d=identicon&r=PG&f=1", "display_name": "Vic", "link": "https://stackoverflow.com/users/7783162/vic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1496478376, "creation_date": 1496432488, "question_id": 44336324, "link": "https://stackoverflow.com/questions/44336324/haskell-non-exhaustive-patterns-in-function-error-in-maybe", "title": "Haskell Non-exhaustive patterns in function error in Maybe?", "body": "<p>I am writing a function that takes a list of Dates and evaluates to an (Int, Int, Int).  If the list is empty is evaluates to Nothing and evaluates to Just d where d is the oldest Date in the list.  My Date data structure is below: </p>\n\n<pre><code>data Date = Date Int Int Int\n deriving (Show)\n</code></pre>\n\n<p>Here is a helper function that I use to determine if a Date is older: </p>\n\n<pre><code>isOlder2 :: Date -&gt; Maybe Date -&gt; Bool\nisOlder2 (Date x y z) (Just (Date a b c))\n  | x &lt; a = True\n  | x &gt; a = False\n  | (x == a)&amp;&amp;(y &lt; b) = True\n  | (x == a)&amp;&amp;(y &gt; b) = False\n  | (x == a) &amp;&amp; (y ==b) &amp;&amp;(z &lt; c) =True\n  | (x == a) &amp;&amp; (y ==b) &amp;&amp;(z &gt; c) = False\n  | (x == a) &amp;&amp; (y ==b) &amp;&amp;(z == c) = False \n</code></pre>\n\n<p>and my actual method, oldest, is the following: </p>\n\n<pre><code>oldest :: [Date] -&gt; Maybe Date \noldest [] = Nothing\noldest (x : xs)\n  | isOlder2 x oldestTail = Just x\n  | otherwise = oldestTail \n    where oldestTail = oldest xs\n</code></pre>\n\n<p>I think that the issue is somewhere in the Maybe, but I'm not familiar with the structure and how it works.  Any thoughts?</p>\n"}, {"tags": ["haskell", "record", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 5335, "user_id": 2309862, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/8xjCJ.jpg?s=128&g=1", "display_name": "vamsiampolu", "link": "https://stackoverflow.com/users/2309862/vamsiampolu"}, "edited": false, "score": 0, "creation_date": 1496433042, "post_id": 44336260, "comment_id": 75676719, "body": "I am trying <code>greet2 c@(CompanyR { .. }) = &quot;hello &quot; ++ (firstName $ person c) ++ &quot; &quot; ++ (lastName $ person c) </code> to get person out of the <code>CompayR</code> type using <code>RecordWildCards</code>."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 1, "last_activity_date": 1496433874, "last_edit_date": 1496433874, "creation_date": 1496432228, "answer_id": 44336260, "question_id": 44336095, "link": "https://stackoverflow.com/questions/44336095/error-when-using-recordwildcards-extension-from-ghci/44336260#44336260", "title": "Error when using RecordWildCards extension from GHCi", "body": "<p>You do it right in your first case here (although I fixed a <code>++</code> where you had <code>+</code>):</p>\n\n<pre><code>greet2 :: ClientR -&gt; String\ngreet2 IndividualR { person = PersonR { .. } } = \"hi\" ++ firstName ++ \" \" ++ lastName ++ \" \"\n</code></pre>\n\n<p>But here <code>firstName</code> etc are not records in <code>CompanyR</code> so <code>CompanyR { .. }</code> does not bring them into scope:</p>\n\n<pre><code>greet2 CompanyR { .. } = \"hello \" ++ firstName ++ \" \" ++ lastName ++ \"who works as a \" ++ duty ++ \" \" ++ clientRName + \" \"\n</code></pre>\n\n<p>You have to do something like you did in the first case of <code>greet2</code>, just above:</p>\n\n<pre><code>greet2 CompanyR {person = PersonR { .. }, .. } = \"hello \" ++ firstName ++ \" \" ++ lastName ++ \"who works as a \" ++ duty ++ \" \" ++ clientRName ++ \" \"\n</code></pre>\n"}], "owner": {"reputation": 5335, "user_id": 2309862, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/8xjCJ.jpg?s=128&g=1", "display_name": "vamsiampolu", "link": "https://stackoverflow.com/users/2309862/vamsiampolu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 44336260, "answer_count": 1, "score": 0, "last_activity_date": 1496435274, "creation_date": 1496431452, "last_edit_date": 1496435274, "question_id": 44336095, "link": "https://stackoverflow.com/questions/44336095/error-when-using-recordwildcards-extension-from-ghci", "title": "Error when using RecordWildCards extension from GHCi", "body": "<p>I have created a function that uses the <code>RecordWildCards</code> syntax for pattern matching on a Haskell record type:</p>\n\n<p><strong>Pragmas</strong></p>\n\n<p>I have placed the pragmas at the top of the file. I have also tried adding it with <code>:set -XRecordWildCards</code>.</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\n{-# LANGUAGE NamedFieldPuns #-}\n{-# LANGUAGE RecordWildCards #-}\n</code></pre>\n\n<p><strong>Type definitions</strong></p>\n\n<pre><code>data ClientR = GovOrgR { clientRName :: String }\n                | CompanyR { clientRName :: String,\n                            companyId   :: Integer,\n                            person      :: PersonR,\n                            duty        :: String\n                          }\n                | IndividualR { person :: PersonR }\n                deriving Show\n\ndata PersonR = PersonR {\n                          firstName :: String,\n                          lastName  :: String\n                       } deriving Show\n</code></pre>\n\n<p><strong>Function</strong></p>\n\n<pre><code>greet2 :: ClientR -&gt; String\ngreet2 IndividualR { person = PersonR { .. } } = \"hi\" ++ firstName ++ \" \" ++ lastName + \" \"\ngreet2 CompanyR { .. } = \"hello \" ++ firstName ++ \" \" ++ lastName ++ \"who works as a \" ++ duty ++ \" \" ++ clientRName + \" \"\ngreet2 GovOrgR {} = \"Welcome\"\n</code></pre>\n\n<p><strong>Error</strong></p>\n\n<pre><code>    \u2022 Couldn't match expected type \u2018[Char]\u2019\n                  with actual type \u2018PersonR -&gt; String\u2019\n    \u2022 Probable cause: \u2018lastName\u2019 is applied to too few arguments\n      In the first argument of \u2018(++)\u2019, namely \u2018lastName\u2019\n      In the second argument of \u2018(++)\u2019, namely\n        \u2018lastName ++ \"who works as a \" ++ duty ++ \" \" ++ clientRName + \" \"\u2019\n      In the second argument of \u2018(++)\u2019, namely\n        \u2018\" \"\n         ++\n           lastName ++ \"who works as a \" ++ duty ++ \" \" ++ clientRName + \" \"\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>When I use this function on <code>CompanyR</code> to match the <code>PersonR</code> using <code>as pattern</code>, I get:</p>\n\n<p><strong>Function</strong></p>\n\n<pre><code>greet2 c@(CompanyR { .. }) = \"hello \" ++ (firstName $ person c) ++ \" \" ++ (lastName $ person c) \n</code></pre>\n\n<p><strong>Error</strong></p>\n\n<pre><code>Couldn't match expected type \u2018ClientR -&gt; PersonR\u2019\n                  with actual type \u2018PersonR\u2019\n    \u2022 The function \u2018person\u2019 is applied to one argument,\n      but its type \u2018PersonR\u2019 has none\n      In the second argument of \u2018($)\u2019, namely \u2018person c\u2019\n      In the first argument of \u2018(++)\u2019, namely \u2018(firstName $ person c)\u2019\n\n    \u2022 Couldn't match expected type \u2018ClientR -&gt; PersonR\u2019\n                  with actual type \u2018PersonR\u2019\n    \u2022 The function \u2018person\u2019 is applied to one argument,\n      but its type \u2018PersonR\u2019 has none\n      In the second argument of \u2018($)\u2019, namely \u2018person c\u2019\n      In the second argument of \u2018(++)\u2019, namely \u2018(lastName $ person c)\u2019\n</code></pre>\n"}, {"tags": ["postgresql", "haskell", "vinyl", "opaleye"], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 2, "last_activity_date": 1496437431, "creation_date": 1496437431, "answer_id": 44337406, "question_id": 44335833, "link": "https://stackoverflow.com/questions/44335833/how-to-generalize-an-opaleye-query-in-haskell-using-vinyl/44337406#44337406", "title": "How to generalize an Opaleye Query in Haskell (Using Vinyl)?", "body": "\n\n<p>Drop the extraneous <code>Default Constant f (Column PGTest)</code> constraint and you should be good to go:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack --resolver lts-8.11 --install-ghc exec ghci --package aeson --package composite-base --package composite-aeson --package text --package string-conversions --package vinyl --package composite-opaleye -}\n{-# LANGUAGE Arrows, DataKinds, OverloadedStrings, PatternSynonyms, TypeOperators, TemplateHaskell, FlexibleContexts, RankNTypes, ConstraintKinds, TypeSynonymInstances, FlexibleInstances, MultiParamTypeClasses #-}\n\nimport Composite.Opaleye (defaultRecTable)\nimport Composite.Record (Record, (:-&gt;))\nimport Composite.TH (withOpticsAndProxies)\nimport Control.Arrow (returnA)\nimport Control.Lens (view)\nimport Data.Profunctor.Product.Default (Default)\nimport Data.Text (Text)\nimport Data.Vinyl (RElem)\nimport Data.Vinyl.TypeLevel (RIndex)\nimport Opaleye.Internal.TableMaker (ColumnMaker)\n\nimport Opaleye\n\n\nnewtype ClearPassword a = ClearPassword a\n\nwithOpticsAndProxies [d|\n  type FEmail = \"email\" :-&gt; Text\n  type CEmail = \"email\" :-&gt; Column PGText\n\n  type FAge = \"age\" :-&gt; Text\n  type CAge = \"age\" :-&gt; Column PGText\n\n  type FClearPassword = \"clearpass\" :-&gt; ClearPassword Text\n  type CHashPassword = \"hashpass\" :-&gt; Column PGText\n  |]\n\ntype DbUser = '[CEmail, CAge]\ntype DbPassword = '[CEmail, CHashPassword]\n\nprintSql :: Default Unpackspec a a =&gt; Query a -&gt; IO ()\nprintSql = putStrLn . maybe \"Empty query\" id . showSqlForPostgres\n\nqueryByEmail :: (RElem CEmail rs (RIndex CEmail rs), Default ColumnMaker (Record rs) (Record rs)) =&gt; Table a (Record rs) -&gt; Text -&gt; QueryArr () (Record rs)\nqueryByEmail table email = proc () -&gt; do\n  u &lt;- queryTable table -&lt; ()\n  let uEmail = view cEmail u\n  restrict -&lt; uEmail .=== constant email\n  returnA -&lt; u\n\nuserTable :: Table (Record DbUser) (Record DbUser)\nuserTable = Table \"user\" defaultRecTable\n\npasswordTable :: Table (Record DbPassword) (Record DbPassword)\npasswordTable = Table \"password\" defaultRecTable\n\nqueryUserTest = printSql $ queryByEmail userTable \"hi\"\nqueryPasswordTest = printSql $ queryByEmail passwordTable \"hi\"\n</code></pre>\n\n<p>The <code>constant email</code> call uses the (already extant) <code>Default Constant Text (Column PGText)</code> constraint; were <code>email</code> to have type <code>CEmail</code> instead you would need a non-trivial non-undefined-using instance.</p>\n"}], "owner": {"reputation": 3057, "user_id": 3884713, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/57f1298138a8935d5bf982478e47f23d?s=128&d=identicon&r=PG&f=1", "display_name": "Josh.F", "link": "https://stackoverflow.com/users/3884713/josh-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 44337406, "answer_count": 1, "score": 2, "last_activity_date": 1496437431, "creation_date": 1496430295, "last_edit_date": 1496435896, "question_id": 44335833, "link": "https://stackoverflow.com/questions/44335833/how-to-generalize-an-opaleye-query-in-haskell-using-vinyl", "title": "How to generalize an Opaleye Query in Haskell (Using Vinyl)?", "body": "\n\n<p><strong>My question is between the huge banners in the code block below.</strong></p>\n\n<p>Forgive the code dump, this is all pasted here for anyone wanting to replicate, and this code <em>does work</em> as expected, although it's a bit strange. Notice the last two lines, they print proper SQL.</p>\n\n<p><strong>Goal:</strong></p>\n\n<p>I have tables with primary keys of type <code>Text</code>, specifically, emails. Instead of writing a new query function for each table, I took upon the task of generalizing the function, so that I could type-safely query <em>any</em> table that has emails.</p>\n\n<p><strong>Problem:</strong></p>\n\n<p>In order to get this to work, I had to include:</p>\n\n<pre><code>instance Default Constant CEmail (Column PGText) where\n  def = undefined\n</code></pre>\n\n<p>Which makes me think I'm doing something wrong. Any advice for building a query that can find records from any table that has Emails?</p>\n\n<pre><code>{- stack\n--resolver lts-8.2\n--install-ghc\nexec ghci\n--package aeson\n--package composite-base\n--package composite-aeson\n--package text\n--package string-conversions\n--package postgres-simple\n--package vinyl\n-}\n\n{-# LANGUAGE\nArrows\n, DataKinds\n, OverloadedStrings\n, PatternSynonyms\n, TypeOperators\n, TemplateHaskell\n, FlexibleContexts\n, RankNTypes\n\n, ConstraintKinds\n, TypeSynonymInstances\n, FlexibleInstances\n, MultiParamTypeClasses\n#-}\n\nimport Data.Vinyl (RElem)\nimport Data.Functor.Identity (Identity)\nimport Data.Vinyl.TypeLevel (RIndex)\nimport Composite.Aeson (JsonFormat, defaultJsonFormatRec, recJsonFormat, toJsonWithFormat)\nimport Composite.Opaleye (defaultRecTable)\n\nimport Composite.Record (Record, Rec(RNil), (:-&gt;), pattern (:*:))\nimport Composite.TH (withOpticsAndProxies)\nimport Control.Arrow (returnA)\nimport Control.Lens (view)\nimport Data.Int (Int64)\nimport Data.Proxy (Proxy(Proxy))\nimport Data.Text (Text)\nimport Opaleye\nimport Opaleye.Internal.TableMaker (ColumnMaker)\nimport Data.String.Conversions (cs)\nimport qualified Data.Aeson as Aeson\n\nimport qualified Database.PostgreSQL.Simple as PGS -- used for printSql\nimport Data.Profunctor.Product.Default (Default(def))\n\n\n--------------------------------------------------\n-- | Types\n\n\n-- | Newtype ClearPassword so it can't be passed around as ordinary Text\nnewtype ClearPassword a = ClearPassword a\n\nwithOpticsAndProxies [d|\n  type FEmail = \"email\" :-&gt; Text\n  type CEmail = \"email\" :-&gt; Column PGText\n\n  type FAge = \"age\" :-&gt; Text\n  type CAge = \"age\" :-&gt; Column PGText\n\n  type FClearPassword = \"clearpass\" :-&gt; ClearPassword Text\n  type CHashPassword = \"hashpass\" :-&gt; Column PGText\n  |]\n\n\n--------------------------------------------------\n-- | Db Setup\n\n-- | Helper Fn\nprintSql :: Default Unpackspec a a =&gt; Query a -&gt; IO ()\nprintSql = putStrLn . maybe \"Empty query\" id . showSqlForPostgres\n\n-- | Db Records\ntype DbUser = '[CEmail, CAge]\ntype DbPassword = '[CEmail, CHashPassword]\n\n\n--------------------------------------------------\n--------------------------------------------------\n--\n-- LOOK HERE vvvvvvvvvvvvvvvvvvvvvvvv\n--\n--------------------------------------------------\n--------------------------------------------------\n\ntype RecWith f rs = (Default ColumnMaker (Record rs) (Record rs),\n                     Default Constant f (Column PGText),\n                     RElem f rs (RIndex f rs))\n\n-- | queryByEmail needs this, but totally works if `def` is declared\n-- as `undefined` ???\ninstance Default Constant CEmail (Column PGText) where\n  def = undefined\n\nqueryByEmail :: (RecWith CEmail rs) =&gt;\n                Table a (Record rs) -&gt; Text -&gt; QueryArr () (Record rs)\nqueryByEmail table email = proc () -&gt; do\n  u &lt;- queryTable table -&lt; ()\n  let uEmail = view cEmail u\n  restrict -&lt; uEmail .=== constant email\n  returnA -&lt; u\n\n--------------------------------------------------\n--------------------------------------------------\n--\n-- LOOK UP ^^^^^^^^^^^^^^^^^^^^^^^^\n--\n--------------------------------------------------\n--------------------------------------------------\n\nuserTable :: Table (Record DbUser) (Record DbUser)\nuserTable = Table \"user\" defaultRecTable\n\n-- | Password\npasswordTable :: Table (Record DbPassword) (Record DbPassword)\npasswordTable = Table \"password\" defaultRecTable\n\n-- SELECT ... FROM \"user\" ...\nqueryUserTest = printSql $ queryByEmail userTable \"hi\"\n\n-- SELECT ... FROM \"password\" ...\nqueryPasswordTest = printSql $ queryByEmail passwordTable \"hi\"\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 2407899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/697fb97f8fee57e826af99ef49224128?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/2407899/ben"}, "edited": false, "score": 0, "creation_date": 1496429625, "post_id": 44335645, "comment_id": 75675207, "body": "Ahh, I see now! Adding map seemed to fix the issue. Thanks for the quick response! :)"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 3, "user_id": 2407899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/697fb97f8fee57e826af99ef49224128?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/2407899/ben"}, "edited": false, "score": 2, "creation_date": 1496432485, "post_id": 44335645, "comment_id": 75676443, "body": "@Ben why are you converting characters to <code>Int</code>s when it&#39;s entirely acceptable to compare the characters in the first place?  In other words, if you already have a string representation of the number then it suffices to check if the string is a palindrome."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 3, "user_id": 2407899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/697fb97f8fee57e826af99ef49224128?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/2407899/ben"}, "edited": false, "score": 0, "creation_date": 1496432593, "post_id": 44335645, "comment_id": 75676485, "body": "@Ben now that you see what&#39;s going on in this case, I would suggest reading the error message again carefully. I think you&#39;ll find it&#39;s pretty clear (if a little verbose), and it&#39;s the sort of error you&#39;re going to encounter again and again. Also be sure to mark this question as answered"}, {"owner": {"reputation": 3, "user_id": 2407899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/697fb97f8fee57e826af99ef49224128?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/2407899/ben"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1496433517, "post_id": 44335645, "comment_id": 75676931, "body": "@ThomasM.DuBuisson I see what you mean. There&#39;s really no reason for me to convert the characters to Ints. I was just working out the Project Euler problems and one of the requirements for it was to check if a number was a palindrome. I guess I didn&#39;t realize that the conversion was unnecessary in this case. Thanks for pointing that out!"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 3, "last_activity_date": 1496429446, "creation_date": 1496429446, "answer_id": 44335645, "question_id": 44335576, "link": "https://stackoverflow.com/questions/44335576/figuring-out-if-a-number-is-a-palindrome/44335645#44335645", "title": "Figuring out if a number is a palindrome", "body": "<p>It doesn't compile because <code>digitToInt</code> takes a <code>Char</code> and returns an <code>Int</code>.</p>\n\n<p>You're giving it a list (<code>s :: [Char]</code>) and treating the result as another list (<code>helper</code> takes a list).</p>\n"}], "owner": {"reputation": 3, "user_id": 2407899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/697fb97f8fee57e826af99ef49224128?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/2407899/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 44335645, "answer_count": 1, "score": 0, "last_activity_date": 1496429446, "creation_date": 1496429221, "question_id": 44335576, "link": "https://stackoverflow.com/questions/44335576/figuring-out-if-a-number-is-a-palindrome", "title": "Figuring out if a number is a palindrome", "body": "<p>I'm relatively new at Haskell and I have no idea why this won't compile. What I'm trying to do is create a function that checks if a number in string form is a palindrome by creating a helper function that does that. Thanks!</p>\n\n<pre><code>isPalindrome :: [Char] -&gt; Bool\nisPalindrome s = (helper . Char.digitToInt) s\n    where helper [] = True\n          helper [x] = True\n          helper (x:xs) = x == (last xs) &amp;&amp; (helper . init) xs\n</code></pre>\n\n<p>Errors:</p>\n\n<pre><code>euler.hs:29:28: error:\n\u2022 Couldn't match type \u2018Int\u2019 with \u2018[a0]\u2019\n  Expected type: Char -&gt; [a0]\n    Actual type: Char -&gt; Int\n\u2022 In the second argument of \u2018(.)\u2019, namely \u2018Char.digitToInt\u2019\n  In the expression: helper . Char.digitToInt\n  In the expression: (helper . Char.digitToInt) s\neuler.hs:29:45: error:\n\u2022 Couldn't match expected type \u2018Char\u2019 with actual type \u2018[Char]\u2019\n\u2022 In the first argument of \u2018helper . Char.digitToInt\u2019, namely \u2018s\u2019\n  In the expression: (helper . Char.digitToInt) s\n  In an equation for \u2018isPalindrome\u2019:\n      isPalindrome s\n        = (helper . Char.digitToInt) s\n        where\n            helper [] = True\n            helper [x] = True\n            helper (x : xs) = x == (last xs) &amp;&amp; (helper . init) xs\n</code></pre>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1496426589, "post_id": 44334510, "comment_id": 75673724, "body": "I don&#39;t understand what you&#39;re asking. Is there a particular function you&#39;re having trouble writing?"}, {"owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1496427450, "post_id": 44334510, "comment_id": 75674145, "body": "@melpomene I edited my question to include something more specific, I&#39;m having trouble writing <code>playing</code>"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1496428191, "post_id": 44334510, "comment_id": 75674490, "body": "@moondaisy Where are your <code>Move</code>s coming from? Your iteration will be based on that source. Do you want <code>playing</code> to check the board state and return an indication of whether the game is over, or will <code>playing</code> simply update the board state and the caller will decide whether to apply another move or terminate?"}, {"owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1496428623, "post_id": 44334510, "comment_id": 75674689, "body": "@ryachza I could get the moves by reading a <code>Char</code> from the console using. I guess I could write a caller that uses <code>IO</code> starts <code>playing</code> and gets the moves and shows the resulting <code>Board</code> until it decides the game has ended, in that case <code>playing</code> could return an indicator."}, {"owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1496431015, "post_id": 44334510, "comment_id": 75675822, "body": "@ryachza I just included a more detailed pseudo code of what <code>playing</code> should do, but I don&#39;t know how to handle the State Monad part nor what the firm of <code>playing</code> should be"}], "answers": [{"comments": [{"owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "edited": false, "score": 0, "creation_date": 1496446286, "post_id": 44336034, "comment_id": 75681216, "body": "Thanks, it definitely works. What I don&#39;t understand is what does <code>pure</code> does?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "edited": false, "score": 2, "creation_date": 1496447703, "post_id": 44336034, "comment_id": 75681491, "body": "@moondaisy: With <code>pure :: Applicative f =&gt; a -&gt; f a</code>, <code>pure x</code> is an action that just returns <code>x</code>. It has the same meaning as <code>return :: Monad m =&gt; a -&gt; m a</code>, which exists for historical reasons: <code>Applicative</code> didn\u2019t use to be a superclass of <code>Monad</code>. You can use whichever one you prefer. I tend to use <code>pure</code> because it has a more general type: <code>pure</code> works works for either <code>Applicative</code> or <code>Monad</code>, but <code>return</code> only works for <code>Monad</code>."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 2, "last_activity_date": 1496431744, "last_edit_date": 1496431744, "creation_date": 1496431207, "answer_id": 44336034, "question_id": 44334510, "link": "https://stackoverflow.com/questions/44334510/state-monad-to-save-board-in-game/44336034#44336034", "title": "State Monad to save board in game", "body": "<p>If you swap the order of arguments to <code>play</code>, you have a function of type:</p>\n\n<pre><code>Move -&gt; Board -&gt; Board\n</code></pre>\n\n<p>Which you can partially apply with a <code>Move</code> to get one of type:</p>\n\n<pre><code>Board -&gt; Board\n</code></pre>\n\n<p>You can convert this to an action on <code>State</code> using <code>modify :: (s -&gt; s) -&gt; State s ()</code> to modify the board:</p>\n\n<pre><code>playing :: Move -&gt; State Board ()\nplaying move = modify (play move)\n</code></pre>\n\n<p>One solution here is monad transformers\u2014sounds scarier than it is. You could use <code>StateT</code> over <code>IO</code>, the <code>StateT</code> to store the game state and the <code>IO</code> to prompt the user for moves. For example:</p>\n\n<pre><code>import Control.Monad.Trans.Class (lift)\nimport Control.Monad.Trans.State (evalStateT, gets, modify)\n\n-- Get a move from the user.\ngetMove :: IO Move\ngetMove = do\n  line &lt;- getLine\n  -- (Your implementation of parsing moves here.)\n\n-- The initial state of the board.\ninitialBoard :: Board\ninitialBoard = -- ...\n\n-- Whether the board represents a completed game.\nboardDone :: Board -&gt; Bool\nboardDone board = -- ...\n\n-- Main game loop.\ngameLoop :: IO ()\ngameLoop = evalStateT loop initialBoard\n  where\n    loop = do\n      move &lt;- lift getMove\n      modify (play move)\n      done &lt;- gets boardDone\n      if done then pure () else loop\n</code></pre>\n\n<p>You use <code>lift</code> to convert a normal <code>IO</code> action into a <code>StateT Board IO</code> action, <code>modify :: (Monad m) =&gt; (s -&gt; s) -&gt; StateT s m ()</code> to modify the state, and <code>gets :: (Monad m) =&gt; (s -&gt; a) -&gt; StateT s m a</code> to read properties of the current state. <code>loop</code> either tail-calls itself to continue playing, or else returns.</p>\n\n<p>Using the structure and names in your edited question:</p>\n\n<pre><code>playing :: IO ()\nplaying = evalStateT loop initialBoard\n  where\n\n    loop :: StateT Board IO ()\n    loop = do\n      printBoard\n      move &lt;- lift promptMove\n      modify (play move)\n      ended &lt;- gets gameEnded\n      if ended\n        then lift $ putStrLn \"You win!\"\n        else loop\n\n    printBoard :: StateT Board IO ()\n    printBoard = do\n      lift $ putStrLn $ \"The board looks like:\"\n      board &lt;- get\n      lift $ putStrLn $ showBoard board\n\n    promptMove :: IO Move\n    promptMove = do\n      putStr \"Indicate a move: \"\n      move &lt;- getLine\n      if validMove move\n        then pure $ getMove move\n        else do\n          putStrLn \"Invalid move.\"\n          promptMove\n</code></pre>\n"}], "owner": {"reputation": 3627, "user_id": 3695939, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d75f41bcfc1d3f20c084ec7e87d82012?s=128&d=identicon&r=PG&f=1", "display_name": "moondaisy", "link": "https://stackoverflow.com/users/3695939/moondaisy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 709, "favorite_count": 0, "accepted_answer_id": 44336034, "answer_count": 1, "score": 2, "last_activity_date": 1496559511, "creation_date": 1496424900, "last_edit_date": 1496559511, "question_id": 44334510, "link": "https://stackoverflow.com/questions/44334510/state-monad-to-save-board-in-game", "title": "State Monad to save board in game", "body": "<p>I have a module <code>Game</code> that defines a method play like this <code>play :: Board -&gt; Move - &gt; Board</code>.</p>\n\n<p>I want to use State Monad in another module called <code>Playing</code> that imports the <code>Game</code> module so that I can call <code>play</code> from there on a loop until the <code>Board</code> reaches a certain state.</p>\n\n<p>I want to call the method with play with the <code>Board</code> that I get from the State Monad and then update the State Monad value with the <code>Board</code> returned by <code>play</code>.</p>\n\n<p>So while the loop is going on I want to receive moves to apply to the <code>play</code> method and my current state.</p>\n\n<p>But I'm quite lost as in how achieving this in a way that the module <code>Game</code> has no idea that I'm using a State Monad. </p>\n\n<p>I have been looking at quite a few tutorials and examples (like <a href=\"https://acm.wustl.edu/functional/state-monad.php\" rel=\"nofollow noreferrer\">this</a>, <a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_monads/State\" rel=\"nofollow noreferrer\">this</a>, <a href=\"http://brandon.si/code/the-state-monad-a-tutorial-for-the-confused/\" rel=\"nofollow noreferrer\">this</a>, etc) and I feel like I understand the way in which State Monad it's applied there but apparently not well enough as to abstract it to this particular implementation.</p>\n\n<pre><code>playing :: IO ()\nplaying = do\n            putStr $ \"The board looks like:\"\n            board &lt;- get\n            putStr $ showBoard  board \n            putStr $ \"Indicate a move:\"\n            move &lt;- getLine\n            if validMove move then do\n                newBoard &lt;- play board (getMove move)\n                if gameEnded newBoard then do\n                    putStr $ \"You win!\" --stop the execution\n                else do\n                    put newBoard\n            else do\n               putStr $ \"Invalid move\"\n</code></pre>\n\n<p>I want <code>playing</code> to be on a loop until it gets a particular <code>Board</code> that means the game ended. And use the State Monad to send the current <code>Board</code> to <code>play</code> and to the other methods in the <code>Game</code> module like <code>gameEnded :: Board -&gt; Bool</code>, <code>showBoard :: Board -&gt; String</code> and 'getMove :: String -> Move'.</p>\n\n<p>Any help is welcome</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1496419687, "post_id": 44333166, "comment_id": 75670192, "body": "Can&#39;t reproduce with GHC 8.0.1. The below code compiles file for me."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1496419992, "post_id": 44333166, "comment_id": 75670351, "body": "...it seems utterly useless though, but I suppose your actual use case is less trivial?"}], "answers": [{"comments": [{"owner": {"reputation": 15620, "user_id": 596361, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b7219254970581e53d3b2b162f7f50f8?s=128&d=identicon&r=PG", "display_name": "Mirzhan Irkegulov", "link": "https://stackoverflow.com/users/596361/mirzhan-irkegulov"}, "edited": false, "score": 0, "creation_date": 1496420506, "post_id": 44333336, "comment_id": 75670598, "body": "Thanks! But what is the motivation for such a restriction?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 15620, "user_id": 596361, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b7219254970581e53d3b2b162f7f50f8?s=128&d=identicon&r=PG", "display_name": "Mirzhan Irkegulov", "link": "https://stackoverflow.com/users/596361/mirzhan-irkegulov"}, "edited": false, "score": 1, "creation_date": 1496420634, "post_id": 44333336, "comment_id": 75670665, "body": "Well, as it seems, it wasn&#39;t intentional. It was just a bug that previous version compiled perfectly. See this ticket for details: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12784\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/12784</a> My guess is that it&#39;s easier for type inference algorithm solve constraints and choose appropriate signature. Another useful example of this feature: <a href=\"http://chrisdone.com/posts/haskell-constraint-trick\" rel=\"nofollow noreferrer\">chrisdone.com/posts/haskell-constraint-trick</a>"}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 7, "last_activity_date": 1509887710, "last_edit_date": 1509887710, "creation_date": 1496420206, "answer_id": 44333336, "question_id": 44333166, "link": "https://stackoverflow.com/questions/44333166/why-doesnt-defaultsignatures-allow-concrete-types/44333336#44333336", "title": "Why doesn&#39;t DefaultSignatures allow concrete types?", "body": "<p>If you're using GHC 8.0.2 then you should write it in different way because there was type checker regression for those kinds of types. See notes:</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/8.0.2/docs/html/users_guide/8.0.2-notes.html\" rel=\"nofollow noreferrer\">https://downloads.haskell.org/~ghc/8.0.2/docs/html/users_guide/8.0.2-notes.html</a></p>\n\n<p>So you need to write it like this:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\n{-# LANGUAGE TypeFamilies #-}\n\nclass C a where\n  f :: [a]\n  default f :: (a ~ Int) =&gt; [a]\n  f = [1,2,3,4,5]\n</code></pre>\n\n<p>Instead of saying that <code>f</code> has type of list of <code>Int</code>s, you need to say, that <code>f</code> has type of lists of some type <code>a</code> where <code>a</code> is <code>Int</code>. <code>{-# LANGUAGE TypeFamilies #-}</code> language extension is needed to enable type equalities. It's not what it's used for but it is required. Compiles for GHC 8.0.2</p>\n"}], "owner": {"reputation": 15620, "user_id": 596361, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b7219254970581e53d3b2b162f7f50f8?s=128&d=identicon&r=PG", "display_name": "Mirzhan Irkegulov", "link": "https://stackoverflow.com/users/596361/mirzhan-irkegulov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 2, "accepted_answer_id": 44333336, "answer_count": 1, "score": 6, "last_activity_date": 1569226172, "creation_date": 1496419533, "last_edit_date": 1569226172, "question_id": 44333166, "link": "https://stackoverflow.com/questions/44333166/why-doesnt-defaultsignatures-allow-concrete-types", "title": "Why doesn&#39;t DefaultSignatures allow concrete types?", "body": "<pre><code>{-# LANGUAGE DefaultSignatures #-}\nclass C a where\n  f :: [a]\n  default f :: (Num a) =&gt; [a]\n  f = [1,2,3,4,5]\n</code></pre>\n\n<p>The above works, the below doesn't. It seems <code>DefaultSignatures</code> extension only allows specifying constraints, but not substituting a concrete type. Section <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#default-method-signatures\" rel=\"nofollow noreferrer\"><em>Default Method Signatures</em></a> of the <em>GHC Users Guide</em> doesn't explain this. Why doesn't <code>DefaultSignatures</code> allow me to substitute a concrete type? What is the rationale? Where can I read more on how and why <code>DefaultSignatures</code> are implemented?</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\nclass C a where\n  f :: [a]\n  default f :: [Int]\n  f = [1,2,3,4,5]\n</code></pre>\n"}, {"tags": ["haskell", "xmonad"], "answers": [{"tags": [], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "is_accepted": true, "score": 2, "last_activity_date": 1496425789, "creation_date": 1496425789, "answer_id": 44334752, "question_id": 44332590, "link": "https://stackoverflow.com/questions/44332590/remove-borders-from-windows-of-specific-class/44334752#44334752", "title": "Remove borders from windows of specific class", "body": "<p>Turns out the main logic was fine except for not accounting for floating windows. Changing the <code>Excludes</code> instance as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Excludes [ExcludeProp] where\n  excludes qs wset mst _wrs =\n    let ws = integrate' mst ++ [w | (w, _) &lt;- Map.toList . floating $ wset]\n    in flip filterM ws $ \\w -&gt;\n         fmap (getAny . mconcat) .\n         sequenceA . map (fmap Any . flip runQuery w . toQuery) $\n         qs\n</code></pre>\n\n<p>makes it work for my use case.</p>\n"}, {"tags": [], "owner": {"reputation": 113, "user_id": 1663197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7c055b7bb6a0bbbbd3e71fd90e1a346?s=128&d=identicon&r=PG", "display_name": "AleXoundOS", "link": "https://stackoverflow.com/users/1663197/alexoundos"}, "is_accepted": false, "score": 1, "last_activity_date": 1539594868, "creation_date": 1539594868, "answer_id": 52813360, "question_id": 44332590, "link": "https://stackoverflow.com/questions/44332590/remove-borders-from-windows-of-specific-class/52813360#52813360", "title": "Remove borders from windows of specific class", "body": "<p>It seems this feature has been recently added to the XMonad.Layout.NoBorders module:</p>\n\n<p><a href=\"http://hackage.haskell.org/package/xmonad-contrib-0.15/docs/XMonad-Layout-NoBorders.html#v:hasBorder\" rel=\"nofollow noreferrer\"><code>hasBorder :: Bool -&gt; ManageHook</code></a>.</p>\n\n<p>ManageHook for sending HasBorder messages:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>   className =? \"foo\" --&gt; hasBorder True\n</code></pre>\n"}], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 374, "favorite_count": 0, "accepted_answer_id": 44334752, "answer_count": 2, "score": 2, "last_activity_date": 1539594868, "creation_date": 1496417644, "last_edit_date": 1496422733, "question_id": 44332590, "link": "https://stackoverflow.com/questions/44332590/remove-borders-from-windows-of-specific-class", "title": "Remove borders from windows of specific class", "body": "<p>I'm trying to write a layout modifier very similar that would allow me to remove borders based on class name property of the windows. The code is largely based on  <a href=\"https://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Layout-NoBorders.html\" rel=\"nofollow noreferrer\">XMonad.Layout.NoBorders</a> with the exception of the logic executing in the X monad to allow filtering based on <a href=\"https://hackage.haskell.org/package/xmonad-0.13/docs/XMonad-ManageHook.html#v:className\" rel=\"nofollow noreferrer\">className</a>. The code I've got so far is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nmodule  XMonad.Layout.ExcludeBorders  where\n\nimport           Control.Monad\nimport           Data.Monoid\nimport           XMonad\nimport           XMonad.Layout.LayoutModifier\nimport           XMonad.StackSet hiding (filter)\n\nsetBorders :: [Window] -&gt; Dimension -&gt; X ()\nsetBorders ws bw =\n  withDisplay $ \\d -&gt; mapM_ (\\w -&gt; io $ setWindowBorderWidth d w bw) ws\n\ndata ExcludeBorders p a =\n  ExcludeBorders p\n                 [a]\n  deriving (Eq, Read, Show)\n\nexcludeBorders :: p -&gt; l a -&gt; ModifiedLayout (ExcludeBorders p) l a\nexcludeBorders qs = ModifiedLayout (ExcludeBorders qs [])\n\ninstance (Show p, Read (ExcludeBorders p Window), Excludes p) =&gt;\n         LayoutModifier (ExcludeBorders p) Window where\n  unhook (ExcludeBorders _p s) = asks (borderWidth . config) &gt;&gt;= setBorders s\n  redoLayout (ExcludeBorders p _s) _ mst wrs = do\n    ws &lt;- withWindowSet (\\wset -&gt; excludes p wset mst wrs)\n    setBorders ws 0\n    return (wrs, Just $ ExcludeBorders p ws)\n\nclass Excludes p where\n  excludes ::\n       p\n    -&gt; WindowSet\n    -&gt; Maybe (Stack Window)\n    -&gt; [(Window, Rectangle)]\n    -&gt; X [Window]\n\ndata ExcludeProp =\n  ExcludeClassName String\n  deriving (Eq, Read, Show)\n\ninstance Excludes [ExcludeProp] where\n  excludes qs _wset mst _wrs =\n    flip filterM (integrate' mst) $ \\w -&gt;\n      fmap (getAny . mconcat) .\n      sequenceA . map (fmap Any . flip runQuery w . toQuery) $\n      qs\n\ntoQuery :: ExcludeProp -&gt; Query Bool\ntoQuery (ExcludeClassName s) = className =? s\n</code></pre>\n\n<p>which can be used in the layout hook as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>excludeBorders [ExcludeClassName \"Krunner\", ExcludeClassName \"plasmashell\"]\n</code></pre>\n\n<p>Unfortunately as is it doesn't have the desired effect, or any effect at all.. Being completely new to writing layout modifiers I'm not sure what I'm doing wrong, and perhaps I misunderstand how the <code>redoLayout</code> function is supposed to work. Any pointers would be appreciated.</p>\n\n<hr />\n\n<p><strong>EDIT</strong>: Some further testing shows this may be a peculiarity of KDE / plasma windows and / or issue with my config rather that anything to do with my code.</p>\n"}, {"tags": ["haskell", "threepenny-gui"], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": false, "score": 0, "last_activity_date": 1496417358, "creation_date": 1496417358, "answer_id": 44332507, "question_id": 44327890, "link": "https://stackoverflow.com/questions/44327890/update-list-of-n-ui-values/44332507#44332507", "title": "Update list of n UI values", "body": "<p>I'm not familiar with pretty much anything you mentioned, but would you be able to make use of the monadic structure and some standard functions to do something like this:</p>\n\n<pre><code>textboxes &lt;- do\n  tbs &lt;- replicateM 3 UI.input\n  forM_ tbs $ \\tbX -&gt; do\n    update &lt;- stepper \"_\" $ UI.valueChange tbX\n    forM_ tbs $ \\tbY -&gt; do\n      element tbY # sink value (fmap reverse update)\n  return $ column (map return tbs)\n</code></pre>\n\n<p>The <code>stepper</code> argument is static and I think you would need a way to skip the triggering control when updating, but in terms of generalizing from two controls to a list of controls I think this might be the right direction?</p>\n"}], "owner": {"reputation": 301, "user_id": 3474009, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/100002407097868/picture?type=large", "display_name": "user3474009", "link": "https://stackoverflow.com/users/3474009/user3474009"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 162, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1496417358, "creation_date": 1496403142, "last_edit_date": 1496416971, "question_id": 44327890, "link": "https://stackoverflow.com/questions/44327890/update-list-of-n-ui-values", "title": "Update list of n UI values", "body": "<p>I'm looking for a way to update an arbitrary number of UI.inputs based on a valueChange in any of the inputs.</p>\n\n<p>Here is a toy example with just two inputs:</p>\n\n<pre><code>import qualified Graphics.UI.Threepenny as UI\nimport Graphics.UI.Threepenny.Core\nimport Graphics.UI.Threepenny.JQuery\n\nmain :: IO ()\nmain = do \n     startGUI defaultConfig setup\n     return ()\n\nsetup ::  Window -&gt; UI ()\nsetup w = do \n            textboxes &lt;- do\n              tb1 &lt;- UI.input \n              tb2 &lt;- UI.input\n              update1 &lt;- stepper \"red\" $ UI.valueChange tb1\n              update2 &lt;- stepper \"green\" $ UI.valueChange tb2\n              element tb1 # sink value (fmap reverse update2)\n              element tb2 # sink value (fmap reverse update1)\n              return $ column [return tb1, return tb2]\n\n            getBody w #+ [textboxes]\n            return ()\n</code></pre>\n\n<p>Whatever is written in one of the textboxes is copied (reversed) into the other text box.</p>\n\n<p>Now, what if I wanted to have a list of an arbitrary length of input UIs, and any thing written into any of the inputs is copied into all of the other ones? I can create a list of UIs easily enough, but how do I read them all, apply a function to their input (like reverse) and then sink the change into all the other ones?</p>\n\n<p>Any thoughts?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1496406074, "post_id": 44327727, "comment_id": 75661741, "body": "IIRC, you had a similar problem in your recent CR question. Please use proper source files with type annotations when you encounter problems like this. You will often notice that GHCi works a little bit different when you use <code>IO</code>. If you add type annotations, GHC will yell at you that the result of <code>runConduit $ \u2026</code> is <i>not</i> a <code>IO [()]</code>, but a <code>IO [IO ()]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 6, "last_activity_date": 1496405993, "creation_date": 1496405993, "answer_id": 44328823, "question_id": 44327727, "link": "https://stackoverflow.com/questions/44327727/understanding-conduit-output/44328823#44328823", "title": "Understanding `conduit` Output", "body": "<p>The result of the conduit is a list of <code>IO ()</code> in a monad, not a single <code>IO ()</code>:</p>\n\n<pre><code>Prelude Conduit&gt; :t runConduit $ yieldMany [1..10] .| mapC show .| mapC print .| sinkList\nrunConduit $ yieldMany [1..10] .| mapC show .| mapC print .| sinkList\n  :: Monad m =&gt; m [IO ()]\n</code></pre>\n\n<p>Even if you set <code>m</code> to <code>IO</code>, you end up with <code>IO [IO ()]</code> as result, which doesn't get shown because <code>[IO ()]</code> does not have a <code>Show</code> instance. You can fix that if you add <code>&gt;&gt;= sequence_</code>:</p>\n\n<pre><code>(runConduit $ yieldMany [1..10] .| mapC show .| mapC print .| sinkList) &gt;&gt;= sequence_\n</code></pre>\n\n<p>However, the real problem is that you use <code>mapC print</code> instead of <code>mapMC print</code>:</p>\n\n<pre><code>Prelude Conduit&gt; :t mapC\nmapC :: Monad m =&gt; (a -&gt; b) -&gt; Conduit a m b\nPrelude Conduit&gt; :t mapMC\nmapMC :: Monad m =&gt; (a -&gt; m b) -&gt; Conduit a m b\n</code></pre>\n\n<p>If you use <code>mapC print</code>, you end up with <code>Conduit a m (IO ())</code>. If you use <code>mapMC print</code>, you end up with <code>Conduit a IO ()</code>. The latter sets <code>m</code> to <code>IO</code>, the first does not.</p>\n\n<p>So use the correct combinator for monadic functions:</p>\n\n<pre><code>runConduit $ yieldMany [1..10] .| mapC show .| mapMC print .| sinkNull\n--                                                ^\n</code></pre>\n\n<p>Also, check the type of <code>it</code> in GHCi if you don't get the expected result.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1496405993, "creation_date": 1496402617, "question_id": 44327727, "link": "https://stackoverflow.com/questions/44327727/understanding-conduit-output", "title": "Understanding `conduit` Output", "body": "<p>Using Conduit, given:</p>\n\n<pre><code>Prelude&gt; :t (yieldMany [1..10] .| mapC show .| mapC print .| sinkList)\n(yieldMany [1..10] .| mapC show .| mapC print .| sinkList)\n  :: Monad m =&gt; ConduitM a c m [IO ()]\n</code></pre>\n\n<p>Why doesn't any output get logged?</p>\n\n<pre><code>Prelude&gt; runConduit $ yieldMany [1..10] .| mapC show .| mapC print .| sinkList\nPrelude&gt;\n</code></pre>\n\n<p>My expectation was that, for a stream of <code>[1..10]</code>, each element's <code>String</code>, i.e. <code>show</code>, value would be printed.</p>\n\n<p>Please explain this output.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1496407019, "post_id": 44327686, "comment_id": 75662335, "body": "If you&#39;re going to talk about &quot;confusing compile errors&quot; you should really actually include them."}, {"owner": {"reputation": 105, "user_id": 6280084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b862bc2dc3e5138f5125e96db61fa6dd?s=128&d=identicon&r=PG&f=1", "display_name": "SolventGren", "link": "https://stackoverflow.com/users/6280084/solventgren"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1496409841, "post_id": 44327686, "comment_id": 75664115, "body": "Good point. The answer below was pretty perfect, but for posterity ill include the errors I got compiling P3."}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 6280084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b862bc2dc3e5138f5125e96db61fa6dd?s=128&d=identicon&r=PG&f=1", "display_name": "SolventGren", "link": "https://stackoverflow.com/users/6280084/solventgren"}, "edited": false, "score": 0, "creation_date": 1496409729, "post_id": 44329181, "comment_id": 75664047, "body": "Thanks, great answer."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1496407439, "last_edit_date": 1496407439, "creation_date": 1496407106, "answer_id": 44329181, "question_id": 44327686, "link": "https://stackoverflow.com/questions/44327686/how-do-i-correctly-format-a-function-using-control-lens/44329181#44329181", "title": "How do I correctly format a function using Control.Lens?", "body": "<ol>\n<li><p>Because parsing rules. Your code is of the form</p>\n\n<pre><code>abc = def %~ ghi jkl\n</code></pre>\n\n<p>Function application binds tighter than any infix operator, so this is parsed as</p>\n\n<pre><code>abc = def %~ (ghi jkl)\n</code></pre>\n\n<p>i.e. what other languages would write <code>def %~ ghi(jkl)</code>.</p></li>\n<li><p>You want <code>(def %~ ghi) jkl</code> instead. This is commonly accomplished with <code>$</code> in Haskell, i.e.</p>\n\n<pre><code>dmg myCard otherCard = health %~ ((-) (otherCard^.damage)) $ myCard\n</code></pre></li>\n<li><p>First I'd eliminate unnecessary parentheses. Operator sections are usually nicer than infix-applied-to expressions, i.e.</p>\n\n<pre><code>dmg myCard otherCard = health %~ ((otherCard^.damage) -) $ myCard\n</code></pre>\n\n<p>...where the inner parens can be omitted due to</p>\n\n<pre><code>Prelude&gt; :info Control.Lens.^.\n...\ninfixl 8 Control.Lens.Getter.^.\nPrelude&gt; :i -\n...\ninfixl 6 -\n</code></pre>\n\n<p>i.e. <code>^.</code> binds more tightly than <code>-</code> anyway, giving</p>\n\n<pre><code>dmg myCard otherCard = health %~ (otherCard^.damage -) $ myCard\n</code></pre>\n\n<p>Next I'd try \u03b7-reduction. This would be easy if the arguments are swapped, which is probably the more Haskell-idiomatic argument order:</p>\n\n<pre><code>dmg otherCard myCard = health %~ (otherCard^.damage -) $ myCard\ndmg otherCard = health %~ (otherCard^.damage -)\n</code></pre>\n\n<p>And that's probably the most elegant solution.</p></li>\n</ol>\n\n<p>That is, assuming your code is actually correct. I don't know what <code>dmg</code> is supposed to do, but perhaps more common is the situation where you want to subtract the other card's damage from yours. I.e. basically not <code>(otherCard^.damage -)</code> but <code>(- otherCard^.damage)</code>, except that's parsed as an unary minus and would therefore need to be written <code>subtract (otherCard^.damage)</code>. Lens has dedicated operators for adding and subtracting, giving you</p>\n\n<pre><code>dmg otherCard = health -~ otherCard^.damage\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 6280084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b862bc2dc3e5138f5125e96db61fa6dd?s=128&d=identicon&r=PG&f=1", "display_name": "SolventGren", "link": "https://stackoverflow.com/users/6280084/solventgren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 44329181, "answer_count": 1, "score": 0, "last_activity_date": 1496558560, "creation_date": 1496402455, "last_edit_date": 1496558560, "question_id": 44327686, "link": "https://stackoverflow.com/questions/44327686/how-do-i-correctly-format-a-function-using-control-lens", "title": "How do I correctly format a function using Control.Lens?", "body": "<p>I'm currently learning the lens library by writing some simple functions using the library. Unfortunately, I'm rather confused by the compiler errors generated, and so I'm struggling to determine why, in the function <code>dmg</code> below, the first two functions compile correctly, but the last fails.</p>\n\n<pre><code>import Control.Lens\n\ntype Health = Int\ntype Damage = Int \n\ndata Card = Card {\n    _health :: Int,\n    _damage :: Int\n} deriving (Show,Eq)\n\nhealth :: Lens' Card Health\nhealth = lens _health (\\card h -&gt; card { _health = h })\ndamage :: Lens' Card Damage\ndamage = lens _damage (\\card d -&gt; card { _damage = d })\n\ncardDead :: Card -&gt; Bool\ncardDead c = c^.health &lt;= 0\n\nduel :: (Card,Card) -&gt; (Card,Card)\nduel (c,c2) = ((dmg c c2),(dmg c2 c))\n</code></pre>\n\n<p>The real meat of the matter. </p>\n\n<pre><code>dmg :: Card -&gt; Card -&gt; Card\ndmg myCard otherCard = over health ((-) (otherCard^.damage)) myCard --compiles\ndmg myCard otherCard = myCard &amp; health %~ ((-) (otherCard^.damage)) --compiles\ndmg myCard otherCard = health %~ ((-) (otherCard^.damage)) myCard    --compile error\n</code></pre>\n\n<p>My question comes in three parts. </p>\n\n<ol>\n<li><p>Why does the third dmg function fail to compile?</p></li>\n<li><p>How could I write dmg to still use the <code>(%~)</code> operator, not use <code>(&amp;)</code>, and still compile?</p></li>\n<li><p>What is the most beautiful, idiomatically lens way of writing <code>dmg</code>?</p></li>\n</ol>\n\n<p>--</p>\n\n<p>For reference, here is one way you could would write dmg without lens</p>\n\n<pre><code>dmg myCard otherCard = \n    let \n        damageTaken = _damage otherCard\n        oldHealth = _health myCard\n        newHealth = oldHealth - damageTaken\n    in myCard {_health = newHealth}\n</code></pre>\n\n<p>edit: For reference, here is the error message I was having trouble understanding with the (incorrectly written) line 3.</p>\n\n<pre><code>*Main GHC.Arr Control.Applicative Control.Lens&gt; :l Doom.hs\n[1 of 1] Compiling Main             ( Doom.hs, interpreted )\n\nDoom.hs:26:24:\n    Couldn't match expected type `Card' with actual type `Card -&gt; Card'\n    In the expression: health %~ ((-) (otherCard ^. damage)) myCard\n    In an equation for `dmg':\n        dmg myCard otherCard = health %~ ((-) (otherCard ^. damage)) myCard\n\nDoom.hs:26:51:\n    Couldn't match type `Health -&gt; Health' with `Int'\n    Expected type: Getting (Health -&gt; Health) Card (Health -&gt; Health)\n      Actual type: (Damage -&gt; Const (Health -&gt; Health) Damage)\n                   -&gt; Card -&gt; Const (Health -&gt; Health) Card\n    In the second argument of `(^.)', namely `damage'\n    In the first argument of `(-)', namely `(otherCard ^. damage)'\n\nDoom.hs:26:60:\n    Couldn't match expected type `Health -&gt; Health'\n                with actual type `Card'\n    In the second argument of `(-)', namely `myCard'\n    In the second argument of `(%~)', namely\n      `((-) (otherCard ^. damage)) myCard'\nFailed, modules loaded: none.\nPrelude GHC.Arr Control.Applicative Control.Lens&gt;\n</code></pre>\n"}, {"tags": ["haskell", "hakyll"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": true, "score": 1, "last_activity_date": 1496396633, "creation_date": 1496396633, "answer_id": 44325764, "question_id": 44325251, "link": "https://stackoverflow.com/questions/44325251/how-to-combine-multiple-pattern-for-match/44325764#44325764", "title": "How to combine multiple Pattern for match?", "body": "<p>Try</p>\n\n<pre><code>let postFiles :: Pattern\n    postFiles = fromGlob \"posts/*.md\" .||. fromGlob \"posts/*.tex\"\n\nmatch postFiles $ do\n    route $ setExtension \"html\"\n    compile $ pandocCompiler\n</code></pre>\n\n<p>you can read \"Composing patterns\" from <a href=\"https://jaspervdj.be/hakyll/reference/Hakyll-Core-Identifier-Pattern.html\" rel=\"nofollow noreferrer\">documentation</a>\nwhat different functions there are to compose multiple <code>Pattern</code> values.</p>\n\n<p><code>pattern1 .||. pattern2</code> creates a pattern, that matches if <code>pattern1</code> or <code>pattern2</code> or both matches (this is what you want).</p>\n\n<p><code>pattern1 .&amp;&amp;. pattern2</code> creates a pattern that matches, if <code>pattern1</code> and <code>pattern2</code> match (you don't want this but it illustrates what can be done, too).</p>\n"}], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 44325764, "answer_count": 1, "score": 0, "last_activity_date": 1496396633, "creation_date": 1496395213, "question_id": 44325251, "link": "https://stackoverflow.com/questions/44325251/how-to-combine-multiple-pattern-for-match", "title": "How to combine multiple Pattern for match?", "body": "<p>I want to match files with extensions <code>*.md</code> and <code>*.tex</code> in <code>posts</code> directory.</p>\n\n<p>The reason I can't use <code>\"posts/*\" :: Pattern</code> is because there are files <code>*.tex.metadata</code> in the posts directory. And <code>site</code> will give error on that files.</p>\n\n<pre><code>[ERROR] Hakyll.Web.readPandocWith: I don't know how to read a file of the type Binary for: posts/2017-06-02-tex.metadata\n</code></pre>\n\n<p>Try following code and fail with empty match (no html output).</p>\n\n<pre><code>match (fromList [\"posts/*.md\", \"posts/*.tex\"]) $ do\n    route $ setExtension \"html\"\n    compile $ pandocCompiler\n\nlet postFiles :: Pattern\n    postFiles = fromGlob \"posts/*.md\" `mappend` fromGlob \"posts/*.tex\"\n\nmatch postFiles $ do\n    route $ setExtension \"html\"\n    compile $ pandocCompiler\n</code></pre>\n\n<p>Maybe I should use <code>fromRegex</code> but I have no idea how to write regex for that.</p>\n\n<p>Addition learning resource is very much welcome. The <a href=\"https://jaspervdj.be/hakyll/reference/Hakyll-Core-Identifier-Pattern.html\" rel=\"nofollow noreferrer\">documentation</a> is lack of sample.</p>\n"}, {"tags": ["haskell", "happy"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1496384896, "post_id": 44320709, "comment_id": 75649378, "body": "TL;DR from the duplicate: there was a <a href=\"https://github.com/simonmar/happy/pull/46\" rel=\"nofollow noreferrer\">PR</a> for this which has been merged and is in the latest Happy version. Although the documentation has not been built recently, it is kept up to date. Looks like <code>%errorhandlertype explist</code> is what you need to be able to get more of this information. I haven&#39;t found a working example of this feature though."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1505498483, "post_id": 44320709, "comment_id": 79454632, "body": "With Happy 1.19.7 or newer, <a href=\"https://github.com/harpocrates/language-rust/blob/0e02e21c389cb56c77f71b902288b195ed273af6/src/Language/Rust/Parser/Internal.y#L74\" rel=\"nofollow noreferrer\">here</a> is a working grammar that uses this feature."}, {"owner": {"reputation": 685, "user_id": 9470078, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-FA8PnJ768P8/AAAAAAAAAAI/AAAAAAAAARQ/9QBFMw1uCfA/photo.jpg?sz=128", "display_name": "Monolith", "link": "https://stackoverflow.com/users/9470078/monolith"}, "edited": false, "score": 0, "creation_date": 1616360393, "post_id": 44320709, "comment_id": 117971436, "body": "By the way, here&#39;s a <a href=\"https://monlih.github.io/happy-docs\" rel=\"nofollow noreferrer\">newer documentation</a> of Happy that I built recently. It includes the added documentation for the <code>%errorhandlertype</code> option."}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 0, "closed_date": 1496384625, "answer_count": 0, "score": 0, "last_activity_date": 1496377131, "creation_date": 1496377131, "question_id": 44320709, "link": "https://stackoverflow.com/questions/44320709/generating-expected-style-error-messages-from-happy", "closed_reason": "Duplicate", "title": "Generating &quot;expected&quot; style error messages from Happy", "body": "<p>As Happy generates a state machine and runs through it upon parsing, I presume when hitting a parse error it will be able to tell what tokens it was expecting.</p>\n\n<p>Is there anyway to get this information as part of printing the error? Currently I'm just printing out the location in the source of the failing token and what sort of token is failing, but it would be good to tell the user what sort of token is expected.</p>\n\n<p>Can I get this sort of information and feed it into my error handling function, and if so how?</p>\n"}, {"tags": ["algorithm", "haskell", "graph", "topological-sort"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1496388517, "post_id": 44319589, "comment_id": 75651240, "body": "How is this different than a topological sort of a directed acyclic graph?"}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1496388782, "post_id": 44319589, "comment_id": 75651392, "body": "The point of a topsort of a DAG is to create an ordering such that a vertex only occurs once. Since the directed multigraph has parallel edges with weights modelling a dependency relation which are the inverse of each other, this is really a directed cyclic graph, and to linearize that, duplicates must be included."}], "answers": [{"comments": [{"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496420430, "post_id": 44333151, "comment_id": 75670564, "body": "For there to be strongly connected components, the directed cyclic graph representation must be used and not the directed multigraph one... correct? Also does <code>[1..n] ++ [n-1..1]</code> now form a vertex in a new DAG to be topologically sorted? Do you have any Haskell specific pointers for <code>FGL</code> or any other graph library? Many thanks!"}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496445122, "post_id": 44333151, "comment_id": 75681015, "body": "Tried the idea - but unfortunately, it doesn&#39;t produce a valid ordering, and it doesn&#39;t seem to be minimal either... Perhaps I didn&#39;t explain the problem sufficiently well... I updated my question in: &quot;Using DCG, SCC, and topsort&quot; with a test of your suggested algorithm."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496447697, "post_id": 44333151, "comment_id": 75681490, "body": "@Centril I definitely don&#39;t understand the problem then. How is a palindrome not a valid linear ordering for every strongly connected graph?"}, {"owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "edited": false, "score": 0, "creation_date": 1496448915, "post_id": 44333151, "comment_id": 75681729, "body": "Hmm... I&#39;ll try a different route to explain the problem... my concrete use case is that I have a graph of normalisation rules <code>:: a -&gt; Norm a</code>. A rule <code>r1</code> can depend on another rule <code>r2</code> having been run on a term before it: <code>req r1 r2</code>. A rule <code>r1</code> can also invalidate that another rule has <code>r2</code> has fully normalised a term: <code>inv r1 r2</code>. I then need to find a linear ordering, which then is composed with <code>foldl (&gt;=&gt;) pure</code>. This linear ordering is then run until a fixed point on a term. Thus, the ordering must also hold however you shift it. See the examples of valid and minimal orderings..."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 1, "last_activity_date": 1496419474, "creation_date": 1496419474, "answer_id": 44333151, "question_id": 44319589, "link": "https://stackoverflow.com/questions/44319589/linear-ordering-of-directed-multigraph-of-dependencies-allowing-for-duplicates/44333151#44333151", "title": "Linear ordering of directed multigraph of dependencies allowing for duplicates", "body": "<p>I believe the following algorithm will find a minimal string of vertices in linear time:</p>\n\n<ol>\n<li><p>Decompose the graph into its strongly connected components. Existing algorithms do this in linear time.</p></li>\n<li><p>In each strongly connected component each node needs to be listed both before and after every other node. List the nodes <code>[1..n]</code> of each strongly connected component in the following order <code>[1..n] ++ [n-1..1]</code></p></li>\n<li><p>Concatenate the strongly connected components together in order by a topological sort. Existing algorithms topologically sort directed acylic graphs like this in linear time.</p></li>\n</ol>\n"}], "owner": {"reputation": 2204, "user_id": 1063961, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/s9gRK.png?s=128&g=1", "display_name": "Centril", "link": "https://stackoverflow.com/users/1063961/centril"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1496448704, "creation_date": 1496367856, "last_edit_date": 1496448704, "question_id": 44319589, "link": "https://stackoverflow.com/questions/44319589/linear-ordering-of-directed-multigraph-of-dependencies-allowing-for-duplicates", "title": "Linear ordering of directed multigraph of dependencies allowing for duplicates", "body": "<h1>Problem description</h1>\n\n<ol>\n<li><p>Given vertices <code>V</code> which can be seen as named \"propositions\".</p></li>\n<li><p>Given weights:</p></li>\n</ol>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data W\n  = Requires     -- ^ Denotes that a \"proposition\" depends on another.\n  | Invalidates  -- ^ Denotes that a \"proposition\" invalidates another.\n</code></pre>\n\n<p>In a linear ordering, if A requires B, then B must come before A, conversely, if A invalidates B, then B must come after A.</p>\n\n<ol start=\"3\">\n<li>Given a weighted directed multigraph (multidigraph) with at most 2 parallel edges... Where a vertex can only require the inclusion of another vertex once, and only invalidates another vertex once...</li>\n</ol>\n\n<pre class=\"lang-hs prettyprint-override\"><code>G = (V, E)\nE = (V, V, W)\n</code></pre>\n\n<ol start=\"4\">\n<li>Or alternatively represented as a directed <strong>cyclic</strong> graph with no self-loops and where the only cycles form directly between one vertex and another. With weights changed to:</li>\n</ol>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data W\n  = Requires      -- ^ Denotes that a \"proposition\" depends on another.\n  | InvalidatedBy -- ^ Denotes that a \"proposition\" is invalidated by another.\n</code></pre>\n\n<p>Given that vertices may occur more than once in the ordering...\n<strong>How can a linear ordering be constructed from such a graph?</strong></p>\n\n<p>Additionally, if the tail of the linear ordering ends with a vertex V which was included due to being InvalidatedBy another vertex, then it may be omitted if the head of the ordering starts with V.</p>\n\n<p>Some desired properties are:</p>\n\n<ol>\n<li>Minimality - there should be as little duplication of vertices as possible</li>\n<li>Stability - the ordering should be as similar as possible to the order between vertices on the same \"level\" in which the graph was constructed</li>\n<li>Run-time complexity - The number of vertices are not that high, but still... the run-time complexity should be as low as possible.</li>\n</ol>\n\n<p>If various algorithms fulfill these to varying degrees, I'd love to see all of them with their trade offs.</p>\n\n<p>Algorithms written in any language, or pseudocode, are welcome.</p>\n\n<h2>Example graphs:</h2>\n\n<p>Example graph 1:</p>\n\n<pre><code>B `requires`    A\nC `requires`    A\nD `requires`    A\nE `invalidates` A\nF `invalidates` A\nG `invalidates` A\n</code></pre>\n\n<p>With minimal linear ordering: [A, B, C, D, E, F, G]</p>\n\n<p>Example graph 2:</p>\n\n<pre><code>C `requires`    A\nC `invalidates` A\nB `requires`    A\n</code></pre>\n\n<p>With minimal linear ordering: [A, B, C]</p>\n\n<p>Example graph 3:</p>\n\n<pre><code>B `requires`    A\nB `invalidates` A\nC `requires`    A\nC `invalidates` A\n</code></pre>\n\n<p>With minimal linear ordering: [A, B, A, C]</p>\n\n<h1>Naive implementation</h1>\n\n<p>A naive implementation constructs a linear ordering by starting with all nodes with no incoming edges and for all of those nodes:</p>\n\n<ol>\n<li>fetches all outgoing edges</li>\n<li>partitions those by requires/invalidates</li>\n<li>constructs the linear ordering of \"requires\" and puts that first</li>\n<li>adds the current node</li>\n<li>constructs the linear ordering of \"invalidates\" and adds that.</li>\n</ol>\n\n<p>Here's a Haskell implementation of this description:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.List (partition)\nimport Data.Maybe (fromJust)\nimport Control.Arrow ((***))\nimport Data.Graph.Inductive.Graph\n\nfboth :: Functor f =&gt; (a -&gt; b) -&gt; (f a, f a) -&gt; (f b, f b)\nfboth f = fmap f *** fmap f\n\nouts :: Graph gr =&gt; gr a b -&gt; Node -&gt; (Adj b, a)\nouts gr n = let (_, _, l, o) = fromJust $ fst $ match n gr in (o, l)\n\nstarts :: Graph gr =&gt; gr a b -&gt; [(Adj b, a)]\nstarts gr = filter (not . null . fst) $ outs gr &lt;$&gt; nodes gr\n\npartW :: Adj W -&gt; (Adj W, Adj W)\npartW = partition ((Requires ==) . fst)\n\nlinearize :: Graph gr =&gt; gr a W -&gt; [a]\nlinearize gr = concat $ linearize' gr &lt;$&gt; starts gr\n\nlinearize' :: Graph gr =&gt; gr a W -&gt; (Adj W, a) -&gt; [a]\nlinearize' gr (o, a) = concat req ++ [a] ++ concat inv\n  where (req, inv) = fboth (linearize' gr . outs gr . snd) $ partW o\n</code></pre>\n\n<p>The ordering can then be optimized by removing equal consecutive like so:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- | Remove consecutive elements which are equal to a previous element.\n-- Runtime complexity: O(n), space: O(1)\nremoveConsequtiveEq :: Eq a =&gt; [a] -&gt; [a]\nremoveConsequtiveEq = \\case\n  []    -&gt; []\n  [x]   -&gt; [x]\n  (h:t) -&gt; h : ug h t\n  where\n    ug e = \\case\n      []     -&gt; []\n      (x:xs) | e == x    -&gt;     ug x xs\n      (x:xs) | otherwise -&gt; x : ug x xs\n</code></pre>\n\n<h1>Edit: Using DCG, SCC, and topsort</h1>\n\n<p>With the algorithm described by @Cirdec :</p>\n\n<ol>\n<li><p>Given a directed cyclic graph (DCG) where edges of form: <code>(f, t)</code> denote that <code>f</code> must come before <code>t</code> in the ordering.</p></li>\n<li><p>Compute the <code>condensation</code> of the DCG in 1.</p></li>\n<li><p>Turn each SSC in the <code>condensation</code> in 2. into a palindrome.</p></li>\n<li><p>Compute the topsort of the graph in 3.</p></li>\n<li><p>Concatenate the computed ordering.</p></li>\n</ol>\n\n<p>In Haskell:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE LambdaCase #-}\n\nimport Data.List (nub)\nimport Data.Maybe (fromJust)\nimport Data.Graph.Inductive.Graph\nimport Data.Graph.Inductive.PatriciaTree\nimport Data.Graph.Inductive.NodeMap\nimport Data.Graph.Inductive.Query.DFS\n\ndata MkEdge = MkEdge Bool Int Int\nreq = MkEdge True\ninv = MkEdge False\n\ntoGraph :: [MkEdge] -&gt; [(Int, Int, Bool)] -&gt; Gr Int Bool\ntoGraph edges es = run_ empty nm\n  where ns = nub $ edges &gt;&gt;= \\(MkEdge _ f t) -&gt; [f, t]\n        nm = insMapNodesM ns &gt;&gt; insMapEdgesM es\n\n-- | Make graph into a directed cyclic graph (DCG).\n-- \"Requires\"    denotes a forward  edge.\n-- \"Invalidates\" denotes a backward edge.\ntoDCG :: [MkEdge] -&gt; Gr Int Bool\ntoDCG edges = toGraph edges $\n  (\\(MkEdge w f t) -&gt; if w then (t, f, w) else (f, t, w)) &lt;$&gt; edges\n\n-- | Make a palindrome of the given list by computing: [1 .. n] ++ [n - 1 .. 1].\n-- Runtime complexity: O(n).\npalindrome :: [a] -&gt; [a]\npalindrome = \\case\n  [] -&gt; []\n  xs -&gt; xs ++ tail (reverse xs)\n\nlinearize :: Gr Int a -&gt; [Int]\nlinearize dcg = concat $ topsort' scc2\n  where scc  = nmap (fmap (fromJust . lab dcg)) $ condensation dcg\n        scc2 = nmap palindrome scc\n</code></pre>\n\n<p>For the graph <code>g2</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>g2 = [ 2 `req` 1\n     , 2 `inv` 1\n     , 3 `req` 1\n     , 3 `inv` 1\n     , 4 `req` 1\n     , 5 `inv` 1\n     ]\n\n&gt; prettyPrint $ toDCG g2\n1:2-&gt;[(False,2)]\n2:1-&gt;[(True,1),(True,3),(True,4)]\n3:3-&gt;[(False,2)]\n4:4-&gt;[]\n5:5-&gt;[(False,2)]\n\n&gt; prettyPrint $ condensation $ toDCG g2\n1:[5]-&gt;[((),2)]\n2:[1,2,3]-&gt;[((),3)]\n3:[4]-&gt;[]\n\n&gt; linearize $ toDCG g2\n[5,2,1,3,1,2,4]\n</code></pre>\n\n<p>This ordering is neither minimal nor valid since the ordering violates the dependencies. <code>5</code> invalidates <code>1</code>, which <code>2</code> depends on. <code>2</code> invalidates <code>1</code> which <code>4</code> depends on.</p>\n\n<p>A valid and minimal ordering is: <code>[1,4,2,1,3,5]</code>. By shifting the list to the right, we get <code>[5,1,4,2,1,3]</code> which is also a valid ordering.</p>\n\n<p>If the direction of the graph is flipped, the ordering becomes: <code>[4,2,1,3,1,2,5]</code>. This is not a valid ordering either... At the boundaries, <code>5</code> can happen, and then <code>4</code>, but <code>5</code> invalidates <code>1</code> which <code>4</code> depends on.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1496363063, "post_id": 44318911, "comment_id": 75643462, "body": "I started to write an answer to the &quot;How could that be possible?&quot; part of the question, but then got stuck a bit. Can you say why you think it should be impossible? That would help guide explanations, I think."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1496362781, "creation_date": 1496362781, "answer_id": 44318979, "question_id": 44318911, "link": "https://stackoverflow.com/questions/44318911/im-confused-about-the-type-of-function-foldr-in-haskell/44318979#44318979", "title": "I&#39;m confused about the type of function `foldr` in haskell", "body": "<p><code>foldr f v</code> maps the list</p>\n\n<pre><code>x1 : x2 : ... : []\n-- i.e., in prefix notation\n(:) x1 ((:) x2 (...  []))\n</code></pre>\n\n<p>into the value</p>\n\n<pre><code>f x1 (f x2 (... v))\n</code></pre>\n\n<p>Informally, it \"replaces\" (or \"interprets\") the <code>(:)</code> constructor with <code>f</code>, and the <code>[]</code> constructor with <code>v</code>.</p>\n\n<p>From the formula above, we can see that the result of <code>f</code> is used (many times) as the second argument of <code>f</code>. Hence they must have the same type (<code>b</code>, in your question). The final result of <code>foldr</code> is the result of the outermost <code>f</code>, hence it is the same <code>b</code> as well.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1496363001, "creation_date": 1496363001, "answer_id": 44319016, "question_id": 44318911, "link": "https://stackoverflow.com/questions/44318911/im-confused-about-the-type-of-function-foldr-in-haskell/44319016#44319016", "title": "I&#39;m confused about the type of function `foldr` in haskell", "body": "<p>If you admit <code>v</code> has type <code>b</code>, then the result of the <code>foldr</code> <em>has</em> to have type <code>b</code>, because <code>v</code> is a possible result of <code>foldr</code>:</p>\n\n<pre><code>foldr f v [] = v\n</code></pre>\n\n<p>And then since the result of <code>foldr</code> has to be <code>b</code>, then the result of <code>f</code> has to be <code>b</code> as well, since an <code>f</code> result is a possible <code>foldr</code> result:</p>\n\n<pre><code>-- f and foldr have to return the same type!\nfoldr f v (x:xs) = f x (foldr f v xs)\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 5448549, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/55e09f85241547a3d2332a1c53862be9?s=128&d=identicon&r=PG&f=1", "display_name": "wxw", "link": "https://stackoverflow.com/users/5448549/wxw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 1, "accepted_answer_id": 44318979, "answer_count": 2, "score": 1, "last_activity_date": 1496363001, "creation_date": 1496362287, "last_edit_date": 1496362836, "question_id": 44318911, "link": "https://stackoverflow.com/questions/44318911/im-confused-about-the-type-of-function-foldr-in-haskell", "title": "I&#39;m confused about the type of function `foldr` in haskell", "body": "<p>In the book \"Programming in Haskell\", the definition of foldr is:</p>\n\n<pre><code>foldr :: (a -&gt; b -&gt;b) -&gt; b -&gt; [a] -&gt; b\nfoldr f v [] = v\nfoldr f v (x:xs) = f x (foldr f v xs)\n</code></pre>\n\n<p>I can't understand <code>f</code> very well.</p>\n\n<p>Cause <code>f</code> is applied to <code>[a]</code>, the argument <code>a</code> in <code>(a -&gt; b -&gt; b)</code> is obvious.\nThe argument <code>v</code> has type <code>b</code>, but the last <code>b</code> in (a -> b -> <strong>b</strong>) and (a -> b -> b) -> b -> [a] -> <strong>b</strong> is weird.</p>\n\n<p>Does it mean the results of functions <code>f</code> and <code>foldr</code> have type <code>b</code>? How could that be possible?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 1147, "user_id": 1498618, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iOfuB.png?s=128&g=1", "display_name": "Reed Oei", "link": "https://stackoverflow.com/users/1498618/reed-oei"}, "is_accepted": true, "score": 3, "last_activity_date": 1496358492, "creation_date": 1496358492, "answer_id": 44318420, "question_id": 44318370, "link": "https://stackoverflow.com/questions/44318370/determining-if-a-card-is-a-certain-suit/44318420#44318420", "title": "Determining if a card is a certain suit", "body": "<p>The problem is that you wrote</p>\n\n<pre><code>suitOf (Card _ s) = s\n</code></pre>\n\n<p>You don't write the equals sign on the first line of the function, only after each guard. If you change that line to</p>\n\n<pre><code>suitOf (Card _ s)\n</code></pre>\n\n<p>it should work. Additionally, this will only work if Suit is a type synonym for <code>[Char]</code> (which I assume it is, but just something to check).</p>\n"}, {"tags": [], "owner": {"reputation": 1603, "user_id": 225292, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/139dd92ae95a2075a124e552c1299d54?s=128&d=identicon&r=PG", "display_name": "paul", "link": "https://stackoverflow.com/users/225292/paul"}, "is_accepted": false, "score": 4, "last_activity_date": 1496359179, "creation_date": 1496359179, "answer_id": 44318516, "question_id": 44318370, "link": "https://stackoverflow.com/questions/44318370/determining-if-a-card-is-a-certain-suit/44318516#44318516", "title": "Determining if a card is a certain suit", "body": "<p>You're looking for the <code>case</code> expression (sometimes called <code>match</code> in other languages):</p>\n\n<pre><code>data Suit = Diamond | Spade | Club | Heart deriving (Eq, Ord)\ndata Card = Card CardValue Suit deriving (Eq)\n\nsuitOf :: Card -&gt; Suit\nsuitOf (Card _ s) =\n  case s of\n    Diamond -&gt; Diamond\n    Spade -&gt; Spade\n    _ -&gt; error \"Invalid\"\n</code></pre>\n\n<p>where the <code>_</code> pattern matches all non-matched input -- IIRC case expressions require all patterns to be matched or it'll error, but check me on that.</p>\n\n<p>Note that this works with string literals as the case match patterns too:</p>\n\n<pre><code>toSuit :: String -&gt; Suit\ntoSuit s =\n  case s of\n    \"Diamond\" -&gt; Diamond\n    \"Spade\" -&gt; Spade\n    _ -&gt; error \"Invalid\"\n</code></pre>\n\n<p>Of course if you weren't going to test for just those two cases you'd merely return the suit directly:</p>\n\n<pre><code>suitOf :: Card -&gt; Suit\nsuitOf (Card _ s) = s\n</code></pre>\n\n<p>:)</p>\n\n<p><a href=\"https://www.haskell.org/tutorial/patterns.html\" rel=\"nofollow noreferrer\">Reference</a></p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1496359511, "creation_date": 1496359511, "answer_id": 44318558, "question_id": 44318370, "link": "https://stackoverflow.com/questions/44318370/determining-if-a-card-is-a-certain-suit/44318558#44318558", "title": "Determining if a card is a certain suit", "body": "<p>I'm not sure why there would be an invalid case, but for only three possibilities, I would just write separate equations for each.</p>\n\n<pre><code>suitOf :: Card -&gt; Suit\nsuitOf (Card _ D) = D\nsuitOf (Card _ S) = S\nsuitOf (Card _ _) = error \"Invalid\"\n</code></pre>\n\n<p>Without the error case, it is of course just</p>\n\n<pre><code>suitOf :: Card -&gt; Suit\nsuitOf (Card _ s) = s\n</code></pre>\n\n<p>and with record syntax you don't even need to define the function yourself:</p>\n\n<pre><code>data Card = Card { rankOf :: CardValue, suitOf :: Suit } deriving (Eq)\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 8076776, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fef6962545947b51ea6008f0308330f7?s=128&d=identicon&r=PG&f=1", "display_name": "Dave", "link": "https://stackoverflow.com/users/8076776/dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 44318420, "answer_count": 3, "score": 1, "last_activity_date": 1496558749, "creation_date": 1496358232, "last_edit_date": 1496558749, "question_id": 44318370, "link": "https://stackoverflow.com/questions/44318370/determining-if-a-card-is-a-certain-suit", "title": "Determining if a card is a certain suit", "body": "<pre><code>data Card = Card CardValue Suit deriving (Eq)\n</code></pre>\n\n<p>If I'm given a Card I want to determine which Suit this card is</p>\n\n<p>I have tried using guards, but I'm still unsure on how to use them correctly. If I were to write pseudocode of the kind of thing I'm trying to do it would be along the lines of</p>\n\n<pre><code>if s == D\n   then D\nelse if s == D\n   then D\n</code></pre>\n\n<p>This is how much I've done, like I said I tried to use guards, but I got an error \"parse error on input '|' when I used the following code</p>\n\n<pre><code>suitOf :: Card -&gt; Suit\nsuitOf (Card _ s) = s\n   | s == D = D\n   | s == S = S\n   | otherwise = error \"Invalid\"\n</code></pre>\n\n<p>What is it that I'm doing wrong? The logic is fairly simple, I'm just not familiar with the syntax of haskell yet</p>\n"}, {"tags": ["haskell", "list-comprehension"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8008566"}, "edited": false, "score": 0, "creation_date": 1496358716, "post_id": 44318402, "comment_id": 75642451, "body": "Thank you! so if the <b>yield part was <code>a</code> and the filter was <code>not a</code> the result would be <code>[TRUE]</code></b> right ?. Also why &quot;A filter only retains the values for which the predicate is <code>True</code> &quot;? Is it a rule because if its just <code>a</code> what first came to my mind is that it can be any value. Can you explain that <b>filter</b> part please"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1496358795, "post_id": 44318402, "comment_id": 75642477, "body": "@Snxby: no because if the filter is <code>not a</code>, then only <code>a = False</code> would be allowed, and we thus would yield <code>a</code> and thus that would again result in <code>[False]</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1496360418, "post_id": 44318402, "comment_id": 75642830, "body": "@Snxby You ask why list comprehension filters only retain values where the predicate gives <code>True</code>. There are two possible answers here, depending on what question you intended to ask. If you intended to ask &quot;how do you know that this is the behavior&quot;, the answer is to <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-420003.11\" rel=\"nofollow noreferrer\">look in the Report</a>. If you intended to ask &quot;why was this behavior chosen&quot;, the answer is because keeping just some elements of a list is a common need, and this is a natural and simple way to address that need."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1496360552, "post_id": 44318402, "comment_id": 75642863, "body": "@Snxby You propose that &quot;if its just <code>a</code> it can be any value&quot;. But that&#39;s not so, for two reasons: first, <code>a</code> is defined by drawing an element from the list <code>[x, not x]</code>, and since <code>not</code> always returns a <code>Bool</code>, we can know that <code>a</code> is definitely a <code>Bool</code>; and second, because <code>a</code> is used as a filter and filters are always <code>Bool</code>-valued expressions, we can again know that <code>a</code> is a <code>Bool</code> (and report an error if this is in conflict with how <code>a</code> was defined!)."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1496358864, "last_edit_date": 1496358864, "creation_date": 1496358383, "answer_id": 44318402, "question_id": 44318360, "link": "https://stackoverflow.com/questions/44318360/how-does-this-list-comprehension-produces-this-output/44318402#44318402", "title": "How does this list comprehension produces this output?", "body": "<p>This list comprehension consists out of three parts:</p>\n\n<pre><code>   [ not a | a &lt;- [x, not x], a ]\n--   ^ yield ^ generator      ^ filter\n</code></pre>\n\n<p>The <strong><em>generator</em></strong> thus lets <code>a</code> <em>iterate</em> over a list with two elements. Those elements are <code>[True,False]</code> or <code>[False,True]</code> (depending on the value of <code>x</code>). But thus always the same values (only the order of the elements is different).</p>\n\n<p>Next the <strong><em>filter</em></strong> part comes in <code>a</code>. A filter <em>retains the values for which the predicate is <code>True</code></em>. Here the predicate is simply <code>a</code>: so it retains configurations for which <code>a = True</code>. Since both <code>True</code> and <code>False</code> for <code>a</code> are enumerated, it means that we will only take <em>one</em> item into account: the one where <code>a</code> is <code>True</code>.</p>\n\n<p>For that value, we <strong><em>yield</em></strong> <code>not a</code>. Now <code>not True</code> is of course <code>False</code>. So as a result, regardless of the value of <code>x</code> (as long as it is <code>True</code> or <code>False</code>), we will always generate <code>[False]</code>.</p>\n\n<p>So as a result:</p>\n\n<pre><code>Prelude&gt; let f x = [not a | a&lt;-[x,not x], a]\nPrelude&gt; f True\n[False]\nPrelude&gt; f False\n[False]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 1, "last_activity_date": 1496390673, "creation_date": 1496390673, "answer_id": 44323803, "question_id": 44318360, "link": "https://stackoverflow.com/questions/44318360/how-does-this-list-comprehension-produces-this-output/44323803#44323803", "title": "How does this list comprehension produces this output?", "body": "<p>You can also understand this with equational reasoning. Start with the list comprehension:</p>\n\n<pre><code>f x = [not a | a &lt;- [x, not x], a]\n</code></pre>\n\n<p>Desugar to the list monad:</p>\n\n<pre><code>f x = do\n  a &lt;- [x, not x]\n  guard a\n  pure (not a)\n</code></pre>\n\n<p>Desugar <code>do</code> notation:</p>\n\n<pre><code>f x = [x, not x] &gt;&gt;= \\ a -&gt; guard a &gt;&gt; return (not a)\n</code></pre>\n\n<p>Inline the definition of <code>&gt;&gt;=</code> for lists:</p>\n\n<pre><code>f x = concatMap (\\ a -&gt; guard a &gt;&gt; return (not a)) [x, not x]\n</code></pre>\n\n<p>Inline <code>guard</code>/<code>&gt;&gt;</code>:</p>\n\n<pre><code>f x = concatMap (\\ a -&gt; if a then return (not a) else []) [x, not x]\n</code></pre>\n\n<p>Inline <code>return</code>:</p>\n\n<pre><code>f x = concatMap (\\ a -&gt; if a then [not a] else []) [x, not x]\n</code></pre>\n\n<p>Expand <code>concatMap g xs</code> to <code>concat (map g xs)</code>:</p>\n\n<pre><code>f x = concat (map (\\ a -&gt; if a then [not a] else []) [x, not x])\n</code></pre>\n\n<p>Inline <code>map</code>:</p>\n\n<pre><code>f x = concat\n  [ if x then [not x] else []\n  , if not x then [not (not x)] else []\n  ]\n</code></pre>\n\n<p>Note that <code>if x then [not x] else []</code> evaluates to <code>[False]</code> if <code>x</code> is <code>True</code> and <code>[]</code> if <code>x</code> is <code>False</code>, and that <code>if not x then [not (not x)] else []</code> evaluates to <code>[]</code> if <code>x</code> is <code>True</code> and <code>[False]</code> if <code>x</code> is <code>False</code>. Therefore you have:</p>\n\n<pre><code>f x = if x then [False] ++ [] else [] ++ [False]\n</code></pre>\n\n<p>And since <code>[False] ++ [] == [] ++ [False] == [False]</code>, you get:</p>\n\n<pre><code>f x = [False]\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8008566"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 44318402, "answer_count": 2, "score": 2, "last_activity_date": 1532083116, "creation_date": 1496358109, "last_edit_date": 1532083116, "question_id": 44318360, "link": "https://stackoverflow.com/questions/44318360/how-does-this-list-comprehension-produces-this-output", "title": "How does this list comprehension produces this output?", "body": "<p>I was dealing with some Haskell function examples but I didn't understand this particular function:</p>\n\n<pre><code>f x = [not a | a&lt;-[x,not x], a]\n</code></pre>\n\n<p>and it produces <code>[False]</code> as output but I didn't understand why. Can one please explain this in detail?</p>\n"}, {"tags": ["linux", "haskell", "directory", "lazy-evaluation", "tar"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1496354925, "post_id": 44317767, "comment_id": 75641410, "body": "&quot;I don&#39;t want to generate the tar file strictly because it could be fairly large and I don&#39;t want to store it all in memory.&quot; are you trying write the tar file to disk as well? You&#39;re probably looking for a proper streams library (pipes, conduit, streaming, io-streams, etc etc), possibly someone has already wrapped tar operations in a stream interface"}, {"owner": {"reputation": 383, "user_id": 5042505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0ed02dd88cc3939bfcb62dbf18116aa?s=128&d=identicon&r=PG&f=1", "display_name": "Program man", "link": "https://stackoverflow.com/users/5042505/program-man"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1496355739, "post_id": 44317767, "comment_id": 75641663, "body": "I do imagine that one of these libraries will resolve this issue, but it&#39;ll take me a while to read through all the documentation and understand what&#39;s going on. It&#39;s a bit confusing, never having dealt with streaming in Haskell before."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1496363575, "creation_date": 1496363575, "answer_id": 44319096, "question_id": 44317767, "link": "https://stackoverflow.com/questions/44317767/the-directory-is-being-deleted-too-early/44319096#44319096", "title": "The directory is being deleted too early", "body": "<p>The simplest solution is to invert control of your <code>listFile</code> function.  Instead of having it return a lazy <code>ByteString</code> (which will be useless once the directory is removed), have it take an IO action to consume the <code>ByteString</code> and actually <em>do</em> something with it before removing the directory.  For example:</p>\n\n<pre><code>import System.Directory\nimport qualified Codec.Archive.Tar as T\nimport qualified Data.ByteString.Lazy as LB\nimport System.IO\n\nlistFileTo :: (LB.ByteString -&gt; IO ()) -&gt; IO ()\nlistFileTo sink = do createDirectory \"dir\"\n                     createDirectory \"dir/dir2\"\n                     tarfile &lt;- fmap T.write $ T.pack \"dir\" [\"dir2\"]\n                     sink tarfile\n                     removeDirectoryRecursive \"dir\"\n\nmain :: IO ()\nmain = listFileTo (\\tarcontents -&gt; withBinaryFile \"my.tar\" WriteMode\n                    (\\h -&gt; LB.hPut h tarcontents))\n</code></pre>\n\n<p>Here, <code>listFileTo</code> takes a \"sink\", a function that takes a lazy <code>ByteString</code> and performs an IO action with it.  For example, the above version of <code>main</code> writes it to a tarfile.</p>\n\n<p>You could also generalize this to something that can return a value from the sink:</p>\n\n<pre><code>listFileTo :: (LB.ByteString -&gt; IO a) -&gt; IO a\nlistFileTo sink = do createDirectory \"dir\"\n                     createDirectory \"dir/dir2\"\n                     tarfile &lt;- fmap T.write $ T.pack \"dir\" [\"dir2\"]\n                     result &lt;- sink tarfile\n                     removeDirectoryRecursive \"dir\"\n                     return result\n</code></pre>\n\n<p>This would allow you to, for example, determine the size of the resulting tarfile without actually doing anything with it, though you have to take care to strictly evaluate the result in the <code>sink</code>:</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nmain :: IO ()\nmain = do size &lt;- listFileTo (\\tarcontents -&gt;\n                                let !size = LB.length tarcontents in return size)\n          print size\n</code></pre>\n"}], "owner": {"reputation": 383, "user_id": 5042505, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0ed02dd88cc3939bfcb62dbf18116aa?s=128&d=identicon&r=PG&f=1", "display_name": "Program man", "link": "https://stackoverflow.com/users/5042505/program-man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 44319096, "answer_count": 1, "score": 2, "last_activity_date": 1496558958, "creation_date": 1496354390, "last_edit_date": 1496558958, "question_id": 44317767, "link": "https://stackoverflow.com/questions/44317767/the-directory-is-being-deleted-too-early", "title": "The directory is being deleted too early", "body": "<p>I'm trying to create a tar file from a directory's contents using <code>Codec.Archive.Tar</code>, but I also want to clean up the directory once the tar file has been created. Here's a small example which demonstrates my issue:</p>\n\n<pre><code>import System.Directory\nimport qualified Codec.Archive.Tar as T\n\nlistFile = do createDirectory \"dir\"\n              createDirectory \"dir/dir2\"\n              tarfile &lt;- fmap T.write $ T.pack \"dir\" [\"dir2\"]\n              removeDirectoryRecursive \"dir\"\n              return tarfile\n</code></pre>\n\n<p>When I call the function <code>listFile</code> e.g. from within ghci, I get back</p>\n\n<pre><code>\"*** Exception: dir/dir2: getModificationTime:getFileTimes:getFileStatus: does not exist (No such file or directory)\n</code></pre>\n\n<p>which I'm guessing is caused by the tar file being generated lazily and the directory being cleaned up strictly. Thus the directory is deleted before the tar file is actually created.</p>\n\n<p>First, am I correct in my analysis of why this is failing? If so, what can I do to fix this? I don't want to generate the tar file strictly because it could be fairly large and I don't want to store it all in memory. What's the \"idiomatic\" way to delay deleting the directory until the tar file has been generated?</p>\n"}, {"tags": ["list", "haskell", "list-comprehension", "enumerate"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1496352828, "post_id": 44317409, "comment_id": 75640637, "body": "More generally: in Python we talk about something being &quot;Pythonic&quot; if it&#39;s well-written and idiomatic. Is there a similar term here for a &quot;Haskellion&quot; construct?"}], "answers": [{"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1496355986, "post_id": 44317848, "comment_id": 75641740, "body": "This is perfect. Not sure why I didn&#39;t think of this myself -- thanks!"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 4, "last_activity_date": 1496354865, "creation_date": 1496354865, "answer_id": 44317848, "question_id": 44317409, "link": "https://stackoverflow.com/questions/44317409/throwing-away-element-in-index-element-tuples/44317848#44317848", "title": "Throwing away element in index,element tuples", "body": "<p>Your final \"write it like Python\" suggestion is almost good, but you are unnecessarily throwing away the rows of the board, and then re-creating them with <code>(!!)</code>. Writing it like this instead would be perfectly fine:</p>\n\n<pre><code>board :: [[Char]]\nboard = [\"abc\", \"def\", \"ghi\"]\n\nboard' :: [[(Int, Int)]]\nboard' = [[(x, y) | (x, _) &lt;- zip [0..] row]\n                  | (y, row) &lt;- zip [0..] board]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1496355385, "last_edit_date": 1496355385, "creation_date": 1496355031, "answer_id": 44317884, "question_id": 44317409, "link": "https://stackoverflow.com/questions/44317409/throwing-away-element-in-index-element-tuples/44317884#44317884", "title": "Throwing away element in index,element tuples", "body": "<p>Well usually the <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:-33--33-\" rel=\"nofollow noreferrer\"><code>(!!) :: [a] -&gt; Int -&gt; a</code></a> is not really a nice operator: it requires <em>O(k)</em> time to access the <em>k</em>-th element. For your small example that is of course not really an issue, but it can turn some algorithms from <em>O(n)</em> into <em>O(n<sup>2</sup>)</em>.</p>\n\n<p>Usually in Haskell, one aims to avoid it by writing clever algorithms that can <em>iterate</em> through the list, instead of <em>obtaining a (random) index</em>.</p>\n\n<p>In Python you can rewrite your:</p>\n\n<pre><code>[[(x,y) for (x,_) in enumerate(board[y])] for (y,_) in enumerate(board)]\n</code></pre>\n\n<p>into:</p>\n\n<pre><code>[[(x,y) for (x,_) in enumerate(<b>by</b>)] for (y,<b>by</b>) in enumerate(board)]</code></pre>\n\n<p>and the equivalent in Haskell would be:</p>\n\n<pre><code>[ [ (x,y) | (x,_) &lt;- zip [0..] by ] | (y,by) &lt;- zip [0..] board ]\n</code></pre>\n\n<p>Or we can make the code cleaner by first introducing an <code>enumerate :: (Enum a, Num a) =&gt; [b] -&gt; [(a, b)]</code> function in Haskell:</p>\n\n<pre><code>enumerate :: (Enum a, Num a) =&gt; [b] -&gt; [(a, b)]\nenumerate = zip [0..]\n</code></pre>\n\n<p>and then write:</p>\n\n<pre><code>[ [ (x,y) | (x,_) &lt;- enumerate by ] | (y,by) &lt;- enumerate board ]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1496379070, "last_edit_date": 1496379070, "creation_date": 1496356053, "answer_id": 44318060, "question_id": 44317409, "link": "https://stackoverflow.com/questions/44317409/throwing-away-element-in-index-element-tuples/44318060#44318060", "title": "Throwing away element in index,element tuples", "body": "<p>Your aside seems to suggest you might be interested in the following function, sometimes called <code>mapWithIndex</code> (e.g., <a href=\"https://hackage.haskell.org/package/containers-0.5.10.2/docs/Data-Sequence.html#v:mapWithIndex\" rel=\"nofollow noreferrer\">in <code>containers</code></a>) and sometimes called <code>imap</code> (<a href=\"https://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Indexed.html#t:FunctorWithIndex\" rel=\"nofollow noreferrer\">in <code>lens</code></a>).</p>\n\n<pre><code>mapWithIndex :: (Int -&gt; a -&gt; b) -&gt; [a] -&gt; [b]\nmapWithIndex f = go 0\n  where\n    go !_i [] = []\n    go i (x : xs) = f i x : go (i + 1) xs\n</code></pre>\n\n<p>So <code>mapWithIndex (\\i -&gt; mapWithIndex (\\j y -&gt; (i,j,y)))</code> will take a list of lists and annotate each element with its position. Of course, rather than annotating, you can perform an arbitrary calculation.</p>\n"}], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 44317848, "answer_count": 3, "score": 2, "last_activity_date": 1496379070, "creation_date": 1496352807, "last_edit_date": 1496357849, "question_id": 44317409, "link": "https://stackoverflow.com/questions/44317409/throwing-away-element-in-index-element-tuples", "title": "Throwing away element in index,element tuples", "body": "<p>New to Haskell, and trying to construct an <code>[[(Int, Int)]]</code> where each element is its corresponding grid position, constructed from another board <code>[[a]]</code>. Therefore a square <code>[[a]]</code> of side length 3 would create</p>\n\n<pre><code>[[(0, 0), (1, 0), (2, 0)]\n,[(0, 1), (1, 1), (2, 1)]\n,[(0, 2), (1, 2), (2, 2)]]\n</code></pre>\n\n<p>(eventually I'll be iterating over this with a <code>map (map ...)</code> into a function of type <code>[[a]] -&gt; (Int, Int) -&gt; b</code> to create a <code>[[b]]</code>, so if I'm missing something massively easier, let me know!)</p>\n\n<p>In Python I might do something like:</p>\n\n<pre><code>[[(x,y) for (x,_) in enumerate(board[y])] for (y,_) in enumerate(board)]\n</code></pre>\n\n<p>That is to say, I'd use the <code>enumerate</code> builtin to construct <code>(index, element)</code> tuples and throw away the element.</p>\n\n<p>I know in Haskell I can do:</p>\n\n<pre><code>[[(x,y) | x &lt;- [0..length (board!!y)-1]] | y &lt;- [0..length board-1]]\n</code></pre>\n\n<p>but those sorts of constructions in Python (<code>for foo in range(len(bar))</code>) are a bit of an anti-pattern and heavily discouraged. Is that true in Haskell, as well?</p>\n\n<p>If I were to write the Haskell like I'd write the Python, I'd do:</p>\n\n<pre><code>[[(x,y) | (x,_) &lt;- zip [0..] (board!!y)] | (y,_) &lt;- zip [0..] board]\n</code></pre>\n\n<p>Is that frowned upon?</p>\n"}, {"tags": ["haskell", "cairo", "haskell-stack", "nix", "nixpkgs"], "comments": [{"owner": {"reputation": 2373, "user_id": 3335288, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qfxhh.jpg?s=128&g=1", "display_name": "Zimm i48", "link": "https://stackoverflow.com/users/3335288/zimm-i48"}, "edited": false, "score": 0, "creation_date": 1496406875, "post_id": 44314060, "comment_id": 75662254, "body": "I am far from being an expert in Haskell development with Nix but generally to use library packages with Nix, you must open a nix-shell: <code>nix-shell -p pkg-config cairo</code>."}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 6369219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81c6a95ee9fc2d1c15749257cd90dc4f?s=128&d=identicon&r=PG", "display_name": "saylu", "link": "https://stackoverflow.com/users/6369219/saylu"}, "is_accepted": true, "score": 0, "last_activity_date": 1496342446, "creation_date": 1496342446, "answer_id": 44314836, "question_id": 44314060, "link": "https://stackoverflow.com/questions/44314060/haskell-stack-nix-build-fails-requiring-pkg-config-0-9-0-and-cairo-1/44314836#44314836", "title": "Haskell / Stack / Nix build fails, requiring pkg-config &gt;= 0.9.0 and cairo &gt;= 1.2.0, but latest versions are pkg-config 0.29.2 and cairo 1.15.4", "body": "<p>By installing Homebrew and then cairo with <code>brew install cairo</code>, I was able to build the project.</p>\n\n<p>However, this installed Cairo version 1.14 \u2014 the same that Nix installed! When I inspect  with <code>brew info cairo</code>, I see some more information:</p>\n\n<pre><code>cairo: stable 1.14.8 (bottled), devel 1.15.4, HEAD\n\n==&gt; Dependencies\nBuild: pkg-config \u2718\nRequired: freetype \u2714, fontconfig \u2714, libpng \u2714, pixman \u2714, glib \u2714\n</code></pre>\n\n<p>I tried installing these dependencies with Nix, and uninstalling Homebrew. No luck -- got a ton of linking errors. And so I re-installed Homebrew and it works again.</p>\n\n<p>This isn't the nice, clean solution I was looking for (had to install an external package manager), but it does solve the problem for now.</p>\n"}, {"tags": [], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "is_accepted": false, "score": 7, "last_activity_date": 1503493362, "creation_date": 1503493362, "answer_id": 45840553, "question_id": 44314060, "link": "https://stackoverflow.com/questions/44314060/haskell-stack-nix-build-fails-requiring-pkg-config-0-9-0-and-cairo-1/45840553#45840553", "title": "Haskell / Stack / Nix build fails, requiring pkg-config &gt;= 0.9.0 and cairo &gt;= 1.2.0, but latest versions are pkg-config 0.29.2 and cairo 1.15.4", "body": "<p>The issue is not the library version, <code>1.14.8</code> is greater than <code>1.2.0</code>. The problem is that the cairo development files don't get linked into your environment, that is, <code>$PKG_CONFIG_PATH</code> is not set.</p>\n\n<p>Three solutions:</p>\n\n<ol>\n<li><p>Find the cairo-dev directory in <code>/nix/store</code>, and add it to <code>PKG_CONFIG_PATH</code>. E.g.,</p>\n\n<pre><code> $ cairodev=$(nix-store --query --outputs $(nix-instantiate '&lt;nixpkgs&gt;' -A cairo) | grep dev$)\n $ export PKG_CONFIG_PATH=$cairodev:$PKG_CONFIG_PATH\n</code></pre></li>\n<li><p>Run stack from within a nix shell, <code>nix-shell -p pkgconfig cairo</code>.</p></li>\n<li><p>Use stack's nix support, by adding the following to <code>stack.yml</code>:</p>\n\n<pre><code>nix:\n  enable: true\n  packages: [pkgconfig, cairo]\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 31, "user_id": 6369219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81c6a95ee9fc2d1c15749257cd90dc4f?s=128&d=identicon&r=PG", "display_name": "saylu", "link": "https://stackoverflow.com/users/6369219/saylu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1357, "favorite_count": 1, "accepted_answer_id": 44314836, "answer_count": 2, "score": 3, "last_activity_date": 1503493362, "creation_date": 1496339340, "question_id": 44314060, "link": "https://stackoverflow.com/questions/44314060/haskell-stack-nix-build-fails-requiring-pkg-config-0-9-0-and-cairo-1", "title": "Haskell / Stack / Nix build fails, requiring pkg-config &gt;= 0.9.0 and cairo &gt;= 1.2.0, but latest versions are pkg-config 0.29.2 and cairo 1.15.4", "body": "<p>I'm building a Haskell project using Stack and Nix and depending on the <code>cairo</code> library from Hackage.</p>\n\n<p>When I build the project, I get an error: unable to find <code>pkg-config &gt;= 0.9.0</code> or <code>cairo &gt;= 1.2.0</code>. However, the latest versions according to their websites are <code>pkg-config 0.29.2</code> and <code>cairo-1.15.4</code>, and this is reflected in the Nix package manager as well.</p>\n\n<p>On the other hand, there's \n<a href=\"https://www.cairographics.org/news/cairo-1.2.0/\" rel=\"nofollow noreferrer\">this article from 2006 announcing the release of Cairo 1.2.0</a>, which further confuses the issue.</p>\n\n<h2>Questions</h2>\n\n<blockquote>\n  <ol>\n  <li><p>Why are the expected versions so wildly different from the published versions on <code>nixpkgs</code> and the <code>pkg-config</code> / <code>cairo</code> websites?</p></li>\n  <li><p>What advice do you have to get <code>cairo</code> to build on macOS (best case scenario: using Nix for system packages and Stack for Haskell packages)</p></li>\n  </ol>\n</blockquote>\n\n<p>Steps to reproduce:</p>\n\n<pre><code>&gt; stack new cairo-test simple &amp;&amp; cd cairo-test\n\n# Now, to get Cairo\n&gt; stack install cairo\n\ncairo-0.13.3.1: configure ...\nProcess exited with code: ExitFailure 1\nConfiguring cairo-0.13.3.1...\nsetup: The program 'pkg-config' version &gt;=0.9.0 is required but it could not be found.\n\n# This version doesn't seem to exist (not on the pkg-config website, either).\n&gt; nix-env -qaP pkg-config\nnixpkgs.pkgconfig          pkg-config-0.29.2\nnixpkgs.pkgconfigUpstream  pkg-config-0.29.2\n\n# However, if installed, a new error:\n&gt; nix-env -i pkg-config\ninstalling \u2018pkg-config-0.29.2\u2019\nbuilding path(s) \u2018/nix/store/m4ks2si7b78757c1rc43r0833pxkvjb3-user-environment\u2019\ncreated 102 symlinks in user environment\n&gt; stack install cairo\nsetup: The pkg-config package 'cairo' version &gt;=1.2.0 is required but \nit could not be found.\n\n# Again, this version doesn't seem to exist, either on the site on in `nixpkgs`\n&gt; nix-env -qaP cairo\nnixpkgs.cairo  cairo-1.14.8\n\n# Installing it anyway, to see what the next error is\n&gt; nix-env -i cairo\ninstalling \u2018cairo-1.14.8\u2019\nbuilding path(s) \u2018/nix/store/dcx0in96wcd7yd8q71y93jd5306vag8g-user-environment\u2019\ncreated 112 symlinks in user environment\n\n# Get the same version error now that Cairo is installed\nsetup: The pkg-config package 'cairo' version &gt;=1.2.0 is required but it could not be found.\n</code></pre>\n"}, {"tags": ["haskell", "process"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 1, "creation_date": 1496335123, "post_id": 44312491, "comment_id": 75631374, "body": "I could be way off but my understanding is that on modern systems there&#39;s no feasible way to pass and use a pointer between processes as each get&#39;s it&#39;s own [virtualized] address space. I think you would need to set up a communication channel where read/write requests are transmitted and executed within the owner of that memory. If both processes do not need access to the data structure, can you serialize the contents? Have you looked into something like: <a href=\"https://wiki.haskell.org/GHC/As_a_library\" rel=\"nofollow noreferrer\">wiki.haskell.org/GHC/As_a_library</a> instead of spawning a different process?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1496342316, "post_id": 44312491, "comment_id": 75635169, "body": "You can create a shared-memory region, and the OS will ensure that the two processes&#39; virtual memory spaces map that region to the same physical memory. If you can convince the C code to accept a pointer and initialize itself there, rather than letting C create the pointer with malloc and give it back to you, this could be a possible solution."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1496351191, "post_id": 44312491, "comment_id": 75639939, "body": "Kind of a hack, but can you pass <code>:l MyFancyModule</code> and <code>ptr &lt;- myFancyInitializationRoutine</code> to ghci&#39;s stdin?"}, {"owner": {"reputation": 171, "user_id": 4533142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-UHBT7UZiono/AAAAAAAAAAI/AAAAAAAAAD4/CPCEzXGieb4/photo.jpg?sz=128", "display_name": "Xiangyu Zhu", "link": "https://stackoverflow.com/users/4533142/xiangyu-zhu"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1496360346, "post_id": 44312491, "comment_id": 75642816, "body": "@ryachza Initially I was looking for some features like tab completion in a relative easy way, that&#39;s why I went to invoking ghci. For the ptr problem maybe ghc API (or hint) is the way to go. I will look into the doc in detail."}, {"owner": {"reputation": 171, "user_id": 4533142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-UHBT7UZiono/AAAAAAAAAAI/AAAAAAAAAD4/CPCEzXGieb4/photo.jpg?sz=128", "display_name": "Xiangyu Zhu", "link": "https://stackoverflow.com/users/4533142/xiangyu-zhu"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1496360894, "post_id": 44312491, "comment_id": 75642968, "body": "@amalloy Unfortunately I can&#39;t. The haskell program is actually acting like a &quot;language plugin&quot; for the original c program. It will be compiled to a shared library and exposing a &quot;plugin&quot; structure defining functions like init, prompt, run, etc. The C program will <code>dlopen</code> it at runtime and call those functions at some time."}, {"owner": {"reputation": 171, "user_id": 4533142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-UHBT7UZiono/AAAAAAAAAAI/AAAAAAAAAD4/CPCEzXGieb4/photo.jpg?sz=128", "display_name": "Xiangyu Zhu", "link": "https://stackoverflow.com/users/4533142/xiangyu-zhu"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1496361151, "post_id": 44312491, "comment_id": 75643027, "body": "@DanielWagner Yes I can but from my understanding ghci can&#39;t still access the memory area even if it gets the value of the pointer. (Actually I tried casting it to <code>IntPtr</code> and pass the int value, then convert back to <code>Ptr a</code> in ghci. This doesn&#39;t work, as expected...)"}], "owner": {"reputation": 171, "user_id": 4533142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-UHBT7UZiono/AAAAAAAAAAI/AAAAAAAAAD4/CPCEzXGieb4/photo.jpg?sz=128", "display_name": "Xiangyu Zhu", "link": "https://stackoverflow.com/users/4533142/xiangyu-zhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1496334061, "creation_date": 1496333538, "last_edit_date": 1496334061, "question_id": 44312491, "link": "https://stackoverflow.com/questions/44312491/how-to-spawn-ghci-and-pass-a-pointer-to-it-where-it-can-access-later", "title": "How to spawn ghci and pass a pointer to it where it can access later?", "body": "<p>In my haskell program I invoke ghci via <code>createProcess</code> in System.Process module. I want to run some initialization code in ghci before entering in a forever loop which gets user input and passes to ghci for evaluation. One of the value is a <code>Ptr a</code> which is created using FFI from c code. Another is a function which is imported from shared lib which needs the pointer to do all useful stuffs. I can \"create\" this function directly in ghci or make ghci load a module file, but the pointer is the key problem.</p>\n\n<p>That pointer actually points to a large struct and is volatile. Ideally to make it works ghci should be able to access the memory at any time. I'm not familiar with Linux process and don't know if it's possible in this scenario. Or is there any better way to achieve the same effect? (create a repl environment with additional helper functions ready for the user to use interactively)</p>\n\n<p>I prefer not to write my own repl code and not use hint.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1496330714, "post_id": 44311542, "comment_id": 75628679, "body": "Usually pure functions should return always the same answer given the same input. So you can only achieve that with a monad."}, {"owner": {"reputation": 41, "user_id": 4749691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b684d4dadecb6268f18bdd580a9377a1?s=128&d=identicon&r=PG&f=1", "display_name": "Coozekoek", "link": "https://stackoverflow.com/users/4749691/coozekoek"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1496330825, "post_id": 44311542, "comment_id": 75628786, "body": "I tried google&#39;ing for how to do it with monads, but I couldn&#39;t find very much. Do you have an idea/example of how to do it?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 9, "creation_date": 1496331036, "post_id": 44311542, "comment_id": 75628961, "body": "This looks as a bad idea to me. The whole point of programming in a pure functional programming language is to avoid such side effects, and achieve referential transparency."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1496331915, "post_id": 44311765, "comment_id": 75629575, "body": "It is also possible to use <code>IORef</code> (or similar) for this. Let me know if you are interested in how this would look."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1496337258, "post_id": 44311765, "comment_id": 75632478, "body": "I agree that in most cases using State for this is silly, and the question as asked does suggest that this is one of those cases. But certainly there are cases where it will be easier to work with the State &quot;function&quot; than working with the infinite list directly. For example, <a href=\"https://stackoverflow.com/q/41941740/625403\">stackoverflow.com/q/41941740/625403</a> is a question similar to this one but in a different context, and my answer <a href=\"https://stackoverflow.com/a/41942347/625403\">stackoverflow.com/a/41942347/625403</a> uses State to keep track of position in the infinite list."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1496331520, "last_edit_date": 1496331520, "creation_date": 1496331204, "answer_id": 44311765, "question_id": 44311542, "link": "https://stackoverflow.com/questions/44311542/haskell-function-that-gives-next-element-of-a-list/44311765#44311765", "title": "Haskell: function that gives next element of a list", "body": "<p>You could do a <code>State</code>ful thing like this:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nimport Control.Monad.State\nimport Data.List\nimport Data.Maybe\n\n-- This is not a function! The misleading name func comes from the question text.\nfunc :: MonadState [a] m =&gt; m a\nfunc = state (fromJust . uncons)\n\nexampleUsage :: State [Int] (Int, Int)\nexampleUsage = do\n    x &lt;- func\n    y &lt;- func\n    return (x, y)\n</code></pre>\n\n<p>You can try it in ghci:</p>\n\n<pre><code>&gt; evalState exampleUsage [1..]\n(1, 2)\n</code></pre>\n\n<p>However, at a high level, I would suggest rethinking your requirements. <code>func</code> is not very idiomatic at all; simply working with the infinite list directly is generally going to be much clearer, have lower (syntactic) overhead, and lead to better generated code. For example:</p>\n\n<pre><code>exampleUsage' :: [a] -&gt; (a, a)\nexampleUsage' (x:y:_) = (x,y)\n</code></pre>\n\n<p>N.B. this is two lines of code with no extensions or imports, compared to the previous 11 lines of code including a language extension and three imports. Usage is also simplified; you can drop the call to <code>evalState</code> entirely and be done.</p>\n\n<pre><code>&gt; exampleUsage' [1..]\n(1, 2)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 4, "last_activity_date": 1496352301, "creation_date": 1496352301, "answer_id": 44317320, "question_id": 44311542, "link": "https://stackoverflow.com/questions/44311542/haskell-function-that-gives-next-element-of-a-list/44317320#44317320", "title": "Haskell: function that gives next element of a list", "body": "<p>You can use mutable references and the <code>IO</code> monad (or other stateful monad).  This can be made rather pretty via partial application:</p>\n\n<pre><code>Prelude&gt; import Data.IORef\nPrelude Data.IORef&gt; ref &lt;- newIORef 0\nPrelude Data.IORef&gt; let func = readIORef ref &gt;&gt;= \\r -&gt; writeIORef ref (r+1) &gt;&gt; return r\nPrelude Data.IORef&gt; func\n0\nPrelude Data.IORef&gt; func\n1\n</code></pre>\n\n<p>Or closer to what you requested:</p>\n\n<pre><code>Prelude Data.IORef&gt; ref2 &lt;- newIORef [0..]\nPrelude Data.IORef&gt; let func2 = readIORef ref2 &gt;&gt;= \\(x:xs) -&gt; writeIORef ref2 xs &gt;&gt; return x\nPrelude Data.IORef&gt; func2\n0\nPrelude Data.IORef&gt; func2\n1\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7054, "user_id": 1313611, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ee895c4ad3fa29cf3aaa4abddda289f?s=128&d=identicon&r=PG", "display_name": "pyrospade", "link": "https://stackoverflow.com/users/1313611/pyrospade"}, "is_accepted": false, "score": 2, "last_activity_date": 1496363060, "creation_date": 1496363060, "answer_id": 44319023, "question_id": 44311542, "link": "https://stackoverflow.com/questions/44311542/haskell-function-that-gives-next-element-of-a-list/44319023#44319023", "title": "Haskell: function that gives next element of a list", "body": "<p>It sounds like you are looking for something like other languages' <code>Iterator</code> or <code>Generator</code> constructs.  If so, this seems like a good use case for the <a href=\"http://hackage.haskell.org/package/conduit\" rel=\"nofollow noreferrer\">conduit</a> library.  Note that there are options (e.g. <a href=\"http://hackage.haskell.org/package/pipes\" rel=\"nofollow noreferrer\">pipes</a>); however, conduit may be a good starting point for you.</p>\n\n<p>If you are trying to operate only over lists, using the <code>State</code> Monad may be a simpler answer (as Daniel suggests); however, if you are looking for a more general solution, conduit (or the like) may indeed be the answer.</p>\n\n<p>The <code>func</code> you are searching for is therefore most likely the <a href=\"http://hackage.haskell.org/package/conduit-1.2.10/docs/Data-Conduit.html#v:await\" rel=\"nofollow noreferrer\">await</a> function.</p>\n\n<p>Here's a simple example -</p>\n\n<pre><code>import Prelude\nimport Conduit\nimport Data.MonoTraversable\n\nmain :: IO ()\nmain = runConduit (source .| consume) &gt;&gt;= print\n\nsource :: Monad m =&gt; Producer m (Element [Integer])\nsource = yieldMany [0..]\n\nconsume :: Monad m =&gt; ConduitM i o m (Maybe (i, i))\nconsume = do\n  mx &lt;- await\n  my &lt;- await\n  return $ (,) &lt;$&gt; mx &lt;*&gt; my\n</code></pre>\n\n<p>And its output -</p>\n\n<pre><code>\u03bb main\nJust (0,1)\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 4749691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b684d4dadecb6268f18bdd580a9377a1?s=128&d=identicon&r=PG&f=1", "display_name": "Coozekoek", "link": "https://stackoverflow.com/users/4749691/coozekoek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 0, "accepted_answer_id": 44317320, "answer_count": 3, "score": 0, "last_activity_date": 1496363060, "creation_date": 1496330562, "last_edit_date": 1496330687, "question_id": 44311542, "link": "https://stackoverflow.com/questions/44311542/haskell-function-that-gives-next-element-of-a-list", "title": "Haskell: function that gives next element of a list", "body": "<p>I was wondering if it is possible in Haskell to define a function which upon calling gives the next element of an (infinite) list, so for example:</p>\n\n<pre><code>Prelude&gt; func\n1\nPrelude&gt; func\n2\n</code></pre>\n\n<p>Is it possible to have such a function in Haskell, and if there is, can you give me an example?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 1634, "user_id": 1779275, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/SgEYI.png?s=128&g=1", "display_name": "Evan Sebastian", "link": "https://stackoverflow.com/users/1779275/evan-sebastian"}, "edited": false, "score": 4, "creation_date": 1496330556, "post_id": 44311460, "comment_id": 75628560, "body": "Read <a href=\"https://en.wikipedia.org/wiki/Church_encoding\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Church_encoding</a>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1496330867, "post_id": 44311460, "comment_id": 75628822, "body": "What thoughts have you had about the problem? What have you tried? Where did it go wrong?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1496331962, "post_id": 44311460, "comment_id": 75629606, "body": "Try with <code>zero f x = x</code> and <code>next n f x = f (n f x)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 57, "user_id": 8098197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/caff740b353f29a8ac3b2f402a1af5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Stamford", "link": "https://stackoverflow.com/users/8098197/alex-stamford"}, "is_accepted": false, "score": 4, "last_activity_date": 1496333523, "creation_date": 1496333523, "answer_id": 44312488, "question_id": 44311460, "link": "https://stackoverflow.com/questions/44311460/implementing-natural-numbers/44312488#44312488", "title": "Implementing natural numbers", "body": "<p>Thank you Evan and Bergi, after reading Church encoding, I found the answer.</p>\n\n<pre><code>zero :: Number t\nzero f x = x\n\nnext :: Number t -&gt; Number t\nnext n f x = f (n f x)\n\nplus :: Number t -&gt; Number t -&gt; Number t\nplus m n f x = m f (n f x)\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 8098197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/caff740b353f29a8ac3b2f402a1af5d0?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Stamford", "link": "https://stackoverflow.com/users/8098197/alex-stamford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1496559154, "creation_date": 1496330350, "last_edit_date": 1496559154, "question_id": 44311460, "link": "https://stackoverflow.com/questions/44311460/implementing-natural-numbers", "title": "Implementing natural numbers", "body": "<p>I'm new to Haskell and functional-programming. I'm trying to implement Natural numbers with functions and a \"plus\" function. I have a given type that can't be changed.</p>\n\n<pre><code>type Number t = (t -&gt; t) -&gt; t -&gt; t\n</code></pre>\n\n<p>Therefor I have to implement a \"zero\" function that represents number 0, a \"next\"\nfunction that returns next number and a \"plus\" function. </p>\n\n<pre><code>zero :: Number t\nzero x = ???\n\nnext :: Number t -&gt; Number t\nnext n = \\f z -&gt; ???\n\nplus :: Number t -&gt; Number t -&gt; Number t\nplus x y = ???\n</code></pre>\n\n<p>After implementing those I should be able to test this:</p>\n\n<pre><code>one :: Number t\none = next zero\ntesOne = one (+ 1) 0\n\ntwo :: Number t\ntwo = plus (next zero) (next zero)\ntestTwo = (+ 5) 0 \n</code></pre>\n\n<p>In this code \"testOne\" should be 1 and \"testTwo\" should be 10. \nThank you for taking time to look ! </p>\n\n<p>I tried this, but i guess i don't quite understand functional-programming yet.</p>\n\n<pre><code>zero :: Number t\nzero x = (\\f -&gt;f) x\n\n\nnext :: Number t -&gt; Number t\nnext n = \\f z -&gt; f z\n\nplus :: Number t -&gt; Number t -&gt; Number t\nplus x y = (\\f x y -&gt; x + y) x y\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1496397924, "post_id": 44310458, "comment_id": 75656661, "body": "Aren&#39;t the simplified signatures at the bottom enough? e.g. <code>partsOf :: Lens&#39; s a -&gt; Lens&#39; s [a]</code>, <code>holesOf :: Lens&#39; s a -&gt; s -&gt; [Pretext&#39; (-&gt;) a s]</code>, <code>singular :: Traversal s t a a -&gt; Lens s t a a</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1973, "user_id": 1716999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a58106c9a1013f1ca791c46579d664?s=128&d=identicon&r=PG", "display_name": "rubystallion", "link": "https://stackoverflow.com/users/1716999/rubystallion"}, "edited": false, "score": 1, "creation_date": 1497523064, "post_id": 44532921, "comment_id": 76119191, "body": "Thank you very much for tackling my thorny question! I&#39;ll need some time to fully process all of this, but from what I&#39;ve read so far it&#39;s very understandable!"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 7, "last_activity_date": 1497395052, "creation_date": 1497395052, "answer_id": 44532921, "question_id": 44310458, "link": "https://stackoverflow.com/questions/44310458/what-are-simple-definitions-for-control-lens-traversals-partsof-holesof-and-si/44532921#44532921", "title": "What are simple definitions for Control.Lens.Traversal&#39;s partsOf, holesOf and singular?", "body": "<p>This is a rather large and thorny question. I profess that I myself do not fully understand how <code>holesOf</code> and <code>partsOf</code> work, and I didn't understand how <code>singular</code> worked until a couple of minutes ago, but I wanted to write down an answer that might help you.</p>\n\n<p>I want to tackle a more general problem: how to read the <code>lens</code> source code. Because if you keep in mind a couple of simplifying assumptions, you can often simplify crazy definitions like</p>\n\n<pre><code>singular :: (Conjoined p, Functor f)\n         =&gt; Traversing p f s t a a\n         -&gt; Over p f s t a a\nsingular l = conjoined\n  (\\afb s -&gt; let b = l sell s in case ins b of\n    (w:ws) -&gt; unsafeOuts b . (:ws) &lt;$&gt; afb w\n    []     -&gt; unsafeOuts b . return &lt;$&gt; afb (error \"singular: empty traversal\"))\n  (\\pafb s -&gt; let b = l sell s in case pins b of\n    (w:ws) -&gt; unsafeOuts b . (:Prelude.map extract ws) &lt;$&gt; cosieve pafb w\n    []     -&gt; unsafeOuts b . return                    &lt;$&gt; cosieve pafb (error \"singular: empty traversal\"))\n\nunsafeOuts :: (Bizarre p w, Corepresentable p) =&gt; w a b t -&gt; [b] -&gt; t\nunsafeOuts = evalState `rmap` bazaar (cotabulate (\\_ -&gt; state (unconsWithDefault fakeVal)))\n  where fakeVal = error \"unsafePartsOf': not enough elements were supplied\"\n\nins :: Bizarre (-&gt;) w =&gt; w a b t -&gt; [a]\nins = toListOf (getting bazaar)\n\nunconsWithDefault :: a -&gt; [a] -&gt; (a,[a])\nunconsWithDefault d []     = (d,[])\nunconsWithDefault _ (x:xs) = (x,xs)\n</code></pre>\n\n<h2>But I Am Getting Ahead of Myself</h2>\n\n<p>These are the rules I try to apply in my ahead when I read the <code>lens</code> source code:</p>\n\n<h3>Dumber Optics</h3>\n\n<p>Optics generally follow the <code>s-t-a-b</code> form throughout the library, which allows you to modify the type of the \"target\" (an overloaded word, at best). But many optics can be implemented with just <code>s</code> and <code>a</code>, and there is often no point in keeping track of the <code>t</code>s and <code>b</code>s when you are just trying to read a definition.</p>\n\n<p>For example, when I was trying to reverse-engineer <code>singular</code>, I used these types in my scratch file:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE NoImplicitPrelude #-}\n\nimport BasePrelude hiding (fold)\n\ntype Lens big small =\n  forall f. (Functor f) =&gt; (small -&gt; f small) -&gt; (big -&gt; f big)\n\ntype Traversal big small =\n  forall ap. (Applicative ap) =&gt; (small -&gt; ap small) -&gt; (big -&gt; ap big)\n\nmakeLens :: (big -&gt; small) -&gt; (big -&gt; small -&gt; big) -&gt; Lens big small\nmakeLens getter setter =\n  \\liftSmall big -&gt; setter big &lt;$&gt; liftSmall (getter big)\n</code></pre>\n\n<p>And the combinators look like this:</p>\n\n<pre><code>set :: ((small -&gt; Identity small) -&gt; big -&gt; Identity big) -&gt; small -&gt; big -&gt; big\nset setter new big =\n  runIdentity (setter (\\_ -&gt; Identity new) big)\n\nview :: ((small -&gt; Const small small) -&gt; big -&gt; Const small big) -&gt; big -&gt; small\nview getter big =\n  getConst (getter Const big)\n</code></pre>\n\n<h3>Get Out of Here, Indexes and Prisms</h3>\n\n<p>Prisms and indexed optics are tremendously useful as a consumer of lens but they are responsible for some of the more eye-clawing pieces of code. In order to unify prisms and indexed optics, the <code>lens</code> developers use <strong>profunctors</strong> (e.g. <code>Choice</code> and <code>Conjoined</code>) and its attendant helper functions (<code>dimap</code>, <code>rmap</code>).</p>\n\n<p>When reading <code>lens</code> code I find it helpful to pretty much always assume <code>p ~ (-&gt;)</code> (the function type) whenever I see a profunctor variable. This lets me excise the <code>Representable</code>, <code>Conjoined</code>, <code>Bizarre</code>, and <code>Over</code> typeclasses from the signatures in the above code snippet.</p>\n\n<h2>A Lot of Type Holes</h2>\n\n<p>With this and the aid of GHC's type holes we can start trying to build our own <code>singular</code> on top our simpler, dumber types.</p>\n\n<pre><code>singular :: Traversal big small -&gt; Lens big small\nsingular = _\n</code></pre>\n\n<p>The general strategy, as <a href=\"http://comonad.com/reader/2015/domains-sets-traversals-and-applicatives/\" rel=\"noreferrer\">alluded to briefly on this comonad.com's blog post</a>, is to traverse the <code>big</code> value to obtain a list of smalls (<code>[small]</code>) using <code>Const</code> and then <em>put them back</em> where we got them from using <code>State</code>.</p>\n\n<p>Traversing to get a list can be done with our re-implementation of <code>toListOf</code>:</p>\n\n<pre><code>toListOf :: Traversal big small -&gt; big -&gt; [small]\ntoListOf traversal = foldrOf traversal (:) []\n\n-- | foldMapOf with mappend/mzero inlined\nfoldrOf :: Traversal big small -&gt; (small -&gt; r -&gt; r) -&gt; r -&gt; big -&gt; r\nfoldrOf traversal fold zero =\n  \\big -&gt; appEndo (foldMapOf traversal (Endo . fold) big) zero\n\n-- | Traverses a value of type big, accumulating the result in monoid mon\nfoldMapOf :: Monoid mon =&gt; Traversal big small -&gt; (small -&gt; mon) -&gt; big -&gt; mon\nfoldMapOf traversal fold =\n  getConst . traversal (Const . fold)\n</code></pre>\n\n<p>A nesting doll of monoids here: lists from <code>Endo</code>s from <code>Const</code>s.</p>\n\n<p>Now we have:</p>\n\n<pre><code>singular :: Traversal big small -&gt; Lens big small\nsingular traversal liftSmall big = do\n  case toListOf traversal big of\n    (x:xs) -&gt; _\n    [] -&gt; _\n</code></pre>\n\n<p>Putting the values <em>back</em> is a little brain-bending. There's this kind of insane function that we have been avoiding talking about:</p>\n\n<pre><code>unsafeOuts :: (Bizarre p w, Corepresentable p) =&gt; w a b t -&gt; [b] -&gt; t\nunsafeOuts = evalState `rmap` bazaar (cotabulate (\\_ -&gt; state (unconsWithDefault fakeVal)))\n  where fakeVal = error \"unsafePartsOf': not enough elements were supplied\"\n</code></pre>\n\n<p>Which, in our simplified universe, becomes</p>\n\n<pre><code>newtype Bazaar' small small' big =\n  Bazaar { unBazaar :: forall ap. Applicative ap =&gt; (small -&gt; ap small') -&gt; ap big }\n  deriving Functor\n\ninstance Applicative (Bazaar' small small') where\n  pure big =\n    Bazaar (\\_ -&gt; pure big)\n  Bazaar lhs &lt;*&gt; Bazaar rhs =\n    Bazaar (\\liftSmall -&gt; lhs liftSmall &lt;*&gt; rhs liftSmall)\n\ntype Bazaar small big = Bazaar' small small big\n\ngobble :: StateT Identity [a] a\ngobble = state (unconsWithDefault (error \"empty!\"))\n\nunsafeOuts :: Bazaar small big -&gt; [small] -&gt; big\nunsafeOuts (Bazaar bazaar) smalls =\n  evalState (bazaar (\\_ -&gt; gobble)) smalls\n</code></pre>\n\n<p>Here we have inlined <code>rmap = (.)</code> and <code>cotabulate f = f . Identity</code>, and we were able to do so because we assumed <code>p ~ (-&gt;)</code>.</p>\n\n<h3>A Half-Hearted Attempt at Puzzling Out Bazaars</h3>\n\n<p>Bazaars are weird, and scant seems to have been written about them. The <code>lens</code> documentation mentions that it's like a traversal that's already been applied to a structure. Indeed a bazaar is what you get if you take the <code>Traversal</code> type and apply it to a <code>big</code> value that you already have.</p>\n\n<p>It is also something like a <a href=\"http://comonad.com/reader/2015/domains-sets-traversals-and-applicatives/\" rel=\"noreferrer\">fancy free applicative</a>, but I do not know if that helps or hurts.</p>\n\n<p>On the <a href=\"https://twanvl.nl/blog/haskell/non-regular1\" rel=\"noreferrer\">last comment of this blog post about a seeming unrelated <code>FunList</code> datatype</a>, the user Zemyla works out an equivalence between</p>\n\n<pre><code>data FunList a b t\n    = Done t\n    | More a (FunList a b (b -&gt; t))\n\ninstance Functor (FunList a b) where ...\ninstance Applicative (FunList a b) where ...\ninstance Profunctor (FunList a) where ...\n\n-- example values:\n-- * Done (x :: t)\n-- * More (a1 :: a) (Done (x :: a -&gt; t))\n-- * More (a1 :: a) (More (a2 :: a) (Done (x :: a -&gt; a -&gt; t))\n</code></pre>\n\n<p>and the <code>lens</code> Bazaar. I find this representation to be a little more helpful in intuiting what's going on.</p>\n\n<h3>Dat State Monad</h3>\n\n<p>The gem here is <code>gobble</code>, which pops off the head of the list from the state each time it runs. Our <code>bazaar</code> is able to upgrade the <code>gobble :: StateT Identity [small] small</code> value into a <code>bazaar (\\_ -&gt; gobble) :: StateT Identity [small] big</code>. Very much like a traversal we are able to take an effectful action acting on a part of a small value and upgrade it to an action that acts on the whole value. This all happens very quickly and with seemingly not enough code; it sort of makes my head spin.</p>\n\n<p>(Something that might be helpful is to play with bazaars in GHCi using this helper function:</p>\n\n<pre><code>bazaarOf :: Traversal big small -&gt; big -&gt; Bazaar small big\nbazaarOf traversal =\n  traversal (\\small -&gt; Bazaar (\\liftSmall -&gt; liftSmall small))\n\n-- See below for `ix`.\n\n\u03bb&gt; unBazaar (bazaarOf (ix 3) [1,2,3,4]) Right\nRight [1,2,3,4]\n\n\u03bb&gt; unBazaar (bazaarOf (ix 3) [1,2,3,4]) (\\_ -&gt; Right 10)\nRight [1,2,3,100]\n\n\u03bb&gt; unBazaar (bazaarOf (ix 1) [1,2,3,4]) Left\nLeft 2\n</code></pre>\n\n<p>In simple cases it seems to approximately be a \"deferred\" version of <code>traverse</code>.)</p>\n\n<h2>In Any Case</h2>\n\n<p><code>unsafeOuts</code> gives us a way to retrieve a second <code>big</code> value given a list of <code>small</code> values and a bazaar constructed from the first <code>big</code> value. Now we need to construct a bazaar from the original traversal we were passed in:</p>\n\n<pre><code>singular :: Traversal big small -&gt; Lens big small\nsingular traversal liftSmall big = do\n  let bazaar = traversal (\\small -&gt; Bazaar ($ small)) big\n  case toListOf traversal big of\n    (x:xs) -&gt; _\n    [] -&gt; _\n</code></pre>\n\n<p>Here we do two things:</p>\n\n<ul>\n<li><p>First we mint ourselves a <code>Bazaar small small</code>. Since we plan on traversing over <code>big</code>, we can take each <code>x :: small</code> value we get and construct a <code>Bazaar (\\f -&gt; f x) :: Bazaar small small</code>. This suffices!</p></li>\n<li><p>The traversal type then smoothly upgrades our <code>Bazaar small small</code> into a <code>bazaar :: Bazaar small big</code>.</p></li>\n</ul>\n\n<p>The original <code>lens</code> code does this with <code>b = traversal sell big</code>, using <code>sell</code> from the <code>Sellable (-&gt;) (Bazaar (-&gt;))</code> instace. If you inline that definition you should end up with the same result.</p>\n\n<p>In the <code>x:xs</code> case the <code>x</code> is the value we want to act on. It is the first value targeted by the traversal we were given, which now becomes the first value targeted the lens we return. We call <code>liftSmall x</code> to get a <code>f small</code> for some functor <code>f</code>; then we append <code>xs</code> inside the functor to get a <code>f [small]</code>; then we call <code>unsafeOuts bazaar</code> inside the functor to turn the <code>f [small]</code> back into a <code>f big</code>:</p>\n\n<pre><code>singular :: Traversal big small -&gt; Lens big small\nsingular traversal liftSmall big = do\n  let bazaar = traversal (\\small -&gt; Bazaar ($ small)) big\n  case toListOf traversal big of\n    (x:xs) -&gt; fmap (\\y -&gt; unsafeOuts bazaar (y:xs)) &lt;$&gt; liftSmall x\n    [] -&gt; _\n</code></pre>\n\n<p>In the case of the empty of list, we act the same way except we stuff a bottom value in:</p>\n\n<pre><code>singular :: Traversal big small -&gt; Lens big small\nsingular traversal liftSmall big = do\n  let bazaar = traversal (\\small -&gt; Bazaar ($ small)) big\n  case toListOf traversal big of\n    (x:xs) -&gt; fmap (\\y -&gt; unsafeOuts bazaar (y:xs)) &lt;$&gt; liftSmall x\n    [] -&gt; fmap (\\y -&gt; unsafeOuts bazaar [y]) &lt;$&gt; liftSmall (error \"singularity\")\n</code></pre>\n\n<p>Let's define some basic optics so we can play with our definition:</p>\n\n<pre><code>-- | Constructs a Traversal that targets zero or one\nmakePrism :: (small -&gt; big) -&gt; (big -&gt; Either big small) -&gt; Traversal big small\nmakePrism constructor getter =\n  \\liftSmall big -&gt; case (fmap liftSmall . getter) big of\n    Left big' -&gt; pure big'\n    Right fsmall -&gt; fmap constructor fsmall\n\n_Cons :: Traversal [a] (a, [a])\n_Cons = makePrism (uncurry (:)) (\\case (x:xs) -&gt; Right (x, xs); [] -&gt; Left [])\n\n_1 :: Lens (a, b) a\n_1 = makeLens fst (\\(_, b) a' -&gt; (a', b))\n\n_head :: Traversal [a] a\n_head = _Cons . _1\n\nix :: Int -&gt; Traversal [a] a\nix k liftSmall big =\n  if k &lt; 0 then pure big else go big k\n  where\n    go [] _ = pure []\n    go (x:xs) 0 = (:xs) &lt;$&gt; liftSmall x\n    go (x:xs) i = (x:) &lt;$&gt; go xs (i - 1)\n</code></pre>\n\n<p>These are all stolen from the <code>lens</code> library.</p>\n\n<p>As expected, it helps us shoo the annoying <code>Monoid</code> typeclass away:</p>\n\n<pre><code>\u03bb&gt; :t view _head\nview _head :: Monoid a =&gt; [a] -&gt; a\n\u03bb&gt; :t view (singular _head)\nview (singular _head) :: [small] -&gt; small\n\n\u03bb&gt; view _head [1,2,3,4]\n    [snip]\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018print\u2019\n      prevents the constraint \u2018(Show a0)\u2019 from being solved.\n    [snip]\n\u03bb&gt; view (singular _head) [1,2,3,4]\n1\n</code></pre>\n\n<p>And it does nothing, as expected, with setters (since traversals are already setters):</p>\n\n<pre><code>\u03bb&gt; set (ix 100) 50 [1,2,3]\n[1,2,3]\n\u03bb&gt; set (singular (ix 100)) 50 [1,2,3]\n[1,2,3]\n\u03bb&gt; set _head 50 [1,2,3,4]\n[50,2,3,4]\n\u03bb&gt; set (singular _head) 50 [1,2,3,4]\n[50,2,3,4]\n</code></pre>\n\n<h2><code>partsOf</code> and <code>holesOf</code></h2>\n\n<pre><code>-- | A type-restricted version of 'partsOf' that can only be used with a 'Traversal'.\npartsOf' :: ATraversal s t a a -&gt; Lens s t [a] [a]\npartsOf' l f s = outs b &lt;$&gt; f (ins b) where b = l sell s\n</code></pre>\n\n<p>Pure conjecture follows: as far as I can tell, <code>partsOf</code> is exceedingly similar to <code>singular</code> in that it first constructs a bazaar <code>b</code>, calls <code>f (ins b)</code> on the bazaar, and then \"puts the values back where it found it.\"</p>\n\n<pre><code>holesOf :: forall p s t a. Conjoined p =&gt; Over p (Bazaar p a a) s t a a -&gt; s -&gt; [Pretext p a a t]\nholesOf l s = unTagged\n  ( conjoined\n     (Tagged $ let\n        f [] _ = []\n        f (x:xs) g = Pretext (\\xfy -&gt; g . (:xs) &lt;$&gt; xfy x) : f xs (g . (x:))\n      in f (ins b) (unsafeOuts b))\n     (Tagged $ let\n        f [] _ = []\n        f (wx:xs) g = Pretext (\\wxfy -&gt; g . (:Prelude.map extract xs) &lt;$&gt; cosieve wxfy wx) : f xs (g . (extract wx:))\n      in f (pins b) (unsafeOuts b))\n    :: Tagged (p a b) [Pretext p a a t]\n  ) where b = l sell s\n</code></pre>\n\n<p><code>holesOf</code> is also making a bazaar (<code>l sell s</code> for the third time!)) and once again suffers from conjunctivitis: by assuming <code>p ~ (-&gt;)</code> you can delete the second branch of the <code>conjoined</code>. But then you are left with a pile of <code>Pretext</code>s and comonads and I am not entirely sure how it all hangs together. It warrants further exploration!</p>\n\n<p><a href=\"https://gist.github.com/hlian/50970261802b572c2c669c7cb5b4fcf7\" rel=\"noreferrer\">Here is a gist of all the code I had in my scratch file at the time I hit Submit on this wall of text.</a></p>\n"}], "owner": {"reputation": 1973, "user_id": 1716999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a58106c9a1013f1ca791c46579d664?s=128&d=identicon&r=PG", "display_name": "rubystallion", "link": "https://stackoverflow.com/users/1716999/rubystallion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 1, "accepted_answer_id": 44532921, "answer_count": 1, "score": 7, "last_activity_date": 1497395052, "creation_date": 1496327751, "last_edit_date": 1496328584, "question_id": 44310458, "link": "https://stackoverflow.com/questions/44310458/what-are-simple-definitions-for-control-lens-traversals-partsof-holesof-and-si", "title": "What are simple definitions for Control.Lens.Traversal&#39;s partsOf, holesOf and singular?", "body": "<p>I'm trying to learn more about the lens library. I already understand the lenses in the <a href=\"https://hackage.haskell.org/package/lens-family\" rel=\"noreferrer\" title=\"lens-family\">lens-family</a> package and their derivation and also grasp the two type parameter versions of Store, Pretext and Bazaar, but I'm having trouble understanding <code>Control.Lens.Traversal</code>'s <a href=\"http://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Traversal.html#v:partsOf\" rel=\"noreferrer\"><code>partsOf</code></a>, <a href=\"http://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Traversal.html#v:holesOf\" rel=\"noreferrer\"><code>holesOf</code></a> and <a href=\"http://hackage.haskell.org/package/lens-4.15.2/docs/Control-Lens-Traversal.html#v:singular\" rel=\"noreferrer\"><code>singular</code></a> functions, which are defined with complex types and many auxiliary functions. Can these functions also be expressed in a simpler way for learning?</p>\n"}, {"tags": ["css", "haskell", "rss", "hxt"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1496325337, "post_id": 44308813, "comment_id": 75624347, "body": "I am a bit confused why you are using css in an rss-file, I think you are going it the wrong direction. If I recall correctly <code>itunes</code> is the schema name in the xml file, and has nothing to do with css (i.e. formatting colors and so on)."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1496325472, "post_id": 44308813, "comment_id": 75624452, "body": "it would be nice to see what you would like to get from a given input."}, {"owner": {"reputation": 67, "user_id": 5070562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77b8e62d56412ca5a2929f0ce4f8685b?s=128&d=identicon&r=PG&f=1", "display_name": "calopter", "link": "https://stackoverflow.com/users/5070562/calopter"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1496404479, "post_id": 44308813, "comment_id": 75660689, "body": "Still not sure what was going wrong, but I got the desired result (extracting the contents of the tag) with <code>doc &gt;&gt;&gt; multi ( hasName &quot;itunes:duration&quot;) &#47;&gt; getText</code>"}], "owner": {"reputation": 67, "user_id": 5070562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77b8e62d56412ca5a2929f0ce4f8685b?s=128&d=identicon&r=PG&f=1", "display_name": "calopter", "link": "https://stackoverflow.com/users/5070562/calopter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1496323536, "creation_date": 1496323536, "question_id": 44308813, "link": "https://stackoverflow.com/questions/44308813/selecting-rss-tags-containing-with-hxt", "title": "Selecting rss tags containing &#39;:&#39; with hxt", "body": "<p>I'm trying to parse some rss that looks like</p>\n\n<pre><code>&lt;itunes:duration&gt;01:57:45&lt;/itunes:duration&gt;   \n</code></pre>\n\n<p>When I try</p>\n\n<pre><code>doc &gt;&gt;&gt; css \"itunes:duration\" /&gt; getText\n</code></pre>\n\n<p>I get </p>\n\n<pre><code>*** Exception: src/Text/HandsomeSoup.hs:(79,9)-(84,35): Non-exhaustive patterns in function makePseudo\n</code></pre>\n\n<p>I feel like it's probably something to do with hxt reading the colon as a HandsomeSoup css selector, but I know very little about css. Is there some way to escape it or something I'm missing?</p>\n"}, {"tags": ["haskell", "proxy", "phantom-types"], "comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1496319851, "post_id": 44306334, "comment_id": 75620032, "body": "FYI, check <code>tagged</code> package, your <code>Phantom</code> is mono-kinded <code>Tagged</code>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1496322087, "post_id": 44306334, "comment_id": 75621762, "body": "ah - nice - but I don&#39;t think I will change the type - in the existing project I have a <code>DB schema a</code> type that represents the schema I am querying - for I compare the data of two schemata that have the same tables but different data. there I use the schema tag so I do not compare a data set with itself and make sure the comparison &quot;objects&quot; have different schema but same content type."}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1496319630, "post_id": 44306472, "comment_id": 75619870, "body": "Thanks - this just helped to simplify a lot of functions by removing a (now) unnecessary <code>Proxy</code>-parameter for each of them!"}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 5, "last_activity_date": 1496317075, "creation_date": 1496317075, "answer_id": 44306472, "question_id": 44306334, "link": "https://stackoverflow.com/questions/44306334/phantoms-and-proxies-lead-to-ghostly-error/44306472#44306472", "title": "Phantoms and Proxies - lead to ghostly error", "body": "<p>Short answer: add <code>forall</code></p>\n\n<pre><code>withoutProxy :: forall test. (KnownSymbol test) =&gt; Phantom test ()\nwithoutProxy = withProxy (Proxy :: Proxy test)\n</code></pre>\n\n<p>Without it <code>test</code> on the second row, is different from the one above.</p>\n\n<hr>\n\n<p>Or, don't add type-annotation at all:</p>\n\n<pre><code>withoutProxy :: (KnownSymbol test) =&gt; Phantom test ()\nwithoutProxy = withProxy Proxy\n</code></pre>\n\n<hr>\n\n<p>Or you could add <code>{-# LANGUAGE PolyKinds #-}</code>, and then things will unify also, as <code>Proxy :: Proxy test</code> will be <code>forall k (test :: k). Proxy k test</code>, where <code>k</code> is a kind.</p>\n"}], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 44306472, "answer_count": 1, "score": 2, "last_activity_date": 1496317075, "creation_date": 1496316674, "question_id": 44306334, "link": "https://stackoverflow.com/questions/44306334/phantoms-and-proxies-lead-to-ghostly-error", "title": "Phantoms and Proxies - lead to ghostly error", "body": "<p>I am working on a project where I keep track of the db-schema I use via a phantom type - that has a <code>KnownSymbol</code> - which is the schema name.</p>\n\n<p>Just the other day I came upon the following problem - which I don't understand:</p>\n\n<p>Why is it impossible to define <code>withoutProxy</code> or to rephrase it - why does GHC assume that <code>test</code> is of kind <code>*</code> instead of <code>Symbol</code> in <code>(Proxy :: Proxy test)</code>, although the type signature says otherwise and <code>ScopedTypeVariables</code> is enabled.</p>\n\n<pre><code>{-# LANGUAGE DataKinds           #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE KindSignatures      #-}\nmodule T where\n\nimport GHC.TypeLits\nimport Data.Proxy\n\nnewtype Phantom (x :: Symbol) y = Phantom y\n\nwithProxy :: (KnownSymbol test) =&gt; Proxy test -&gt; Phantom test ()\nwithProxy _ = Phantom ()\n\nwithoutProxy :: (KnownSymbol test) =&gt; Phantom test ()\nwithoutProxy = withProxy (Proxy :: Proxy test)\n</code></pre>\n\n<p>The error I get is most confusing</p>\n\n<pre><code>&gt; ghci test.hs\nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling T                ( test.hs, interpreted )\n\ntest.hs:14:27: error:\n    \u2022 Couldn't match type \u2018*\u2019 with \u2018Symbol\u2019\n      Expected type: Proxy test\n        Actual type: Proxy test\n      Use -fprint-explicit-kinds to see the kind arguments\n    \u2022 In the first argument of \u2018withProxy\u2019, namely\n        \u2018(Proxy :: Proxy test)\u2019\n      In the expression: withProxy (Proxy :: Proxy test)\n      In an equation for \u2018withoutProxy\u2019:\n          withoutProxy = withProxy (Proxy :: Proxy test)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Then enabling <code>-fprint-explicit-kinds</code></p>\n\n<pre><code>Prelude&gt; :set -fprint-explicit-kinds \nPrelude&gt; :r\n[1 of 1] Compiling T                ( test.hs, interpreted )\n\ntest.hs:15:27: error:\n    \u2022 Couldn't match type \u2018*\u2019 with \u2018Symbol\u2019\n      Expected type: Proxy Symbol test\n        Actual type: Proxy * test\n    \u2022 In the first argument of \u2018withProxy\u2019, namely\n        \u2018(Proxy :: Proxy test)\u2019\n      In the expression: withProxy (Proxy :: Proxy test)\n      In an equation for \u2018withoutProxy\u2019:\n          withoutProxy = withProxy (Proxy :: Proxy test)\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["scala", "haskell"], "comments": [{"owner": {"reputation": 7455, "user_id": 2311362, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/D80AB.png?s=128&g=1", "display_name": "OlivierBlanvillain", "link": "https://stackoverflow.com/users/2311362/olivierblanvillain"}, "edited": false, "score": 0, "creation_date": 1496320416, "post_id": 44304532, "comment_id": 75620470, "body": "Could you please update your question to make it useful for others? (Searchable title, link to the blog post...)"}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "reply_to_user": {"reputation": 7455, "user_id": 2311362, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/D80AB.png?s=128&g=1", "display_name": "OlivierBlanvillain", "link": "https://stackoverflow.com/users/2311362/olivierblanvillain"}, "edited": false, "score": 0, "creation_date": 1496324365, "post_id": 44304532, "comment_id": 75623553, "body": "maybe better now?"}], "answers": [{"comments": [{"owner": {"reputation": 19421, "user_id": 3795501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaeec79535337d9a96f63f2d6ef3e49d?s=128&d=identicon&r=PG", "display_name": "Luka Jacobowitz", "link": "https://stackoverflow.com/users/3795501/luka-jacobowitz"}, "edited": false, "score": 0, "creation_date": 1496313572, "post_id": 44304725, "comment_id": 75615628, "body": "How would this work with regards to runtime exceptions? I think the question was about the type representation, no? I.e. <code>parse</code> would return an <code>Either Error User</code>, while <code>findByIdOrFail</code> might return an <code>IO (WithId User)</code>"}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "edited": false, "score": 0, "creation_date": 1496313955, "post_id": 44304725, "comment_id": 75615919, "body": "both should return IO (sth), one is <code>IO (User)</code> the other is <code>IO (WithId User)</code> , the  main point is how to handle model where <code>id</code> might exits and may doesn t . for more information you can read the below article <a href=\"http://blog.originate.com/blog/2015/04/06/managing-data-classes-with-ids/\" rel=\"nofollow noreferrer\">blog.originate.com/blog/2015/04/06/&hellip;</a>"}, {"owner": {"reputation": 19421, "user_id": 3795501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaeec79535337d9a96f63f2d6ef3e49d?s=128&d=identicon&r=PG", "display_name": "Luka Jacobowitz", "link": "https://stackoverflow.com/users/3795501/luka-jacobowitz"}, "edited": false, "score": 0, "creation_date": 1496314949, "post_id": 44304725, "comment_id": 75616610, "body": "I disagree <code>parse</code> should not be of type <code>IO</code> unless it performs some side effect, attempting to parse a json String and returning an <code>Either</code> or a <code>Maybe</code> does not warrant the <code>IO</code> type."}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "edited": false, "score": 0, "creation_date": 1496316740, "post_id": 44304725, "comment_id": 75617785, "body": "It would make more sense <code>parse &lt;$&gt; getUserFromClient</code>, but here the code does not matter, the example is to illustrate how to model with <code>id</code>"}], "tags": [], "owner": {"reputation": 7455, "user_id": 2311362, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/D80AB.png?s=128&g=1", "display_name": "OlivierBlanvillain", "link": "https://stackoverflow.com/users/2311362/olivierblanvillain"}, "is_accepted": true, "score": 3, "last_activity_date": 1496311962, "creation_date": 1496311962, "answer_id": 44304725, "question_id": 44304532, "link": "https://stackoverflow.com/questions/44304532/manage-data-type-with-ids-scala-and-haskell/44304725#44304725", "title": "Manage data type with Ids (Scala and haskell)", "body": "<pre><code>data WithId a = W { id :: Id, model :: a }\n\n-- Receive data for a new user from the client\nuserId = parse json\n\n-- Receive data from the database\nuser = findByIdOrFail userId\n</code></pre>\n"}], "owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 44304725, "answer_count": 1, "score": 1, "last_activity_date": 1496398985, "creation_date": 1496311401, "last_edit_date": 1496398985, "question_id": 44304532, "link": "https://stackoverflow.com/questions/44304532/manage-data-type-with-ids-scala-and-haskell", "title": "Manage data type with Ids (Scala and haskell)", "body": "<p>I have been reading a nice article about how to manage data type or model with <code>id</code>, sometime we need the same model with <code>id</code> and the same model without <code>id</code> and the  following\n<a href=\"http://blog.originate.com/blog/2015/04/06/managing-data-classes-with-ids/\" rel=\"nofollow noreferrer\">article</a> describe how to model types to handle this issue.\nthe below example is written in Scala and I  want its Haskell representation for better understanding </p>\n\n<pre><code>case class WithId[A](id: Id, model: A)\n\n// receive data for a new user from the client\nval user: User = Json.parse[User](json)\n\n// receive data from the database\nval user: WithId[User] = UserService.findByIdOrFail(userId)\n</code></pre>\n\n<p>what matters for me is the type respresenation, suppose we have the function <code>findByIdOrFail</code> and <code>parse</code> ...</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1496313087, "post_id": 44299107, "comment_id": 75615315, "body": "What is the definition of the <code>Position</code> type?"}], "answers": [{"comments": [{"owner": {"reputation": 66318, "user_id": 3510736, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/kVtHP.jpg?s=128&g=1", "display_name": "Ami Tavory", "link": "https://stackoverflow.com/users/3510736/ami-tavory"}, "reply_to_user": {"reputation": 83, "user_id": 8076776, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fef6962545947b51ea6008f0308330f7?s=128&d=identicon&r=PG&f=1", "display_name": "Dave", "link": "https://stackoverflow.com/users/8076776/dave"}, "edited": false, "score": 0, "creation_date": 1496296059, "post_id": 44299258, "comment_id": 75604106, "body": "@Dave You also have another error, in using <code>&#39;elem&#39;</code> instead of <code>`elem`</code>, and another one besides that. See updated answer."}, {"owner": {"reputation": 66318, "user_id": 3510736, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/kVtHP.jpg?s=128&g=1", "display_name": "Ami Tavory", "link": "https://stackoverflow.com/users/3510736/ami-tavory"}, "reply_to_user": {"reputation": 83, "user_id": 8076776, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fef6962545947b51ea6008f0308330f7?s=128&d=identicon&r=PG&f=1", "display_name": "Dave", "link": "https://stackoverflow.com/users/8076776/dave"}, "edited": false, "score": 3, "creation_date": 1496296728, "post_id": 44299258, "comment_id": 75604404, "body": "@Dave As you seem new to the site (at least by your rep), note that you can accept a single answer, but, independently upvote whatever answers helped you. JonPurdy seems to have answered your question too correctly, so you might want to upvote it as thanks."}], "tags": [], "owner": {"reputation": 66318, "user_id": 3510736, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/kVtHP.jpg?s=128&g=1", "display_name": "Ami Tavory", "link": "https://stackoverflow.com/users/3510736/ami-tavory"}, "is_accepted": true, "score": 2, "last_activity_date": 1496306501, "last_edit_date": 1496306501, "creation_date": 1496295438, "answer_id": 44299258, "question_id": 44299107, "link": "https://stackoverflow.com/questions/44299107/haskell-parse-error-in-pattern/44299258#44299258", "title": "Haskell Parse error in pattern", "body": "<p>In </p>\n\n<pre><code>    | x 'elem' ['a'..'h'] &amp;&amp; y 'elem' [1..8] = True\n</code></pre>\n\n<p><code>x</code> is unbound. It doesn't appear at all in </p>\n\n<pre><code>isValid Position(_ y) = y\n</code></pre>\n\n<p>in particular. Also, you probably meant to use <code>`elem`</code>, and not <code>'elem'</code>.</p>\n\n<blockquote>\n  <p>I am trying to write a function that tells me whether a given poisition is valid or not. Where x is ['a'..'h'] and y is [1..8]</p>\n</blockquote>\n\n<p>You didn't write the definition of <code>Position</code>, but it seems like this would be something like </p>\n\n<pre><code>data Position = Position Int Int                                                                                                                                     \n\nisValid :: Position -&gt; Bool\nisValid (Position x y) = x `elem` ['a'..'h'] &amp;&amp; y `elem` [1..8]\n</code></pre>\n\n<p>(which builds for me).</p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 3, "last_activity_date": 1496295479, "creation_date": 1496295479, "answer_id": 44299266, "question_id": 44299107, "link": "https://stackoverflow.com/questions/44299107/haskell-parse-error-in-pattern/44299266#44299266", "title": "Haskell Parse error in pattern", "body": "<p>As explained here: <a href=\"https://stackoverflow.com/questions/24543686/syntax-error-on-mod-haskell/24544188#24544188\">Syntax error on &#39;mod&#39; Haskell</a></p>\n\n<p>The syntax for using a named function as an infix operator uses backticks (grave accents, U+0060), not apostrophes:</p>\n\n<pre><code>    | x `elem` ['a'..'h'] &amp;&amp; y `elem` [1..8] = True\n        ------                 ------\n    | otherwise = False\n</code></pre>\n\n<p>In addition, <code>Position(x _)</code> and <code>Position(_ y)</code> are not valid patterns\u2014you probably intended to use <code>(Position x _)</code> and <code>(Position x y)</code>. Note the <code>x</code>, since <code>x</code> is not in scope in the equation you wrote for <code>(Position _ y)</code>.</p>\n\n<p><code>(Position x _)</code> will match all positions, so I suspect you intended:</p>\n\n<pre><code>isValid :: Position -&gt; Bool\nisValid (Position x y)\n    | x `elem` ['a'..'h'] &amp;&amp; y `elem` [1..8] = True\n    | otherwise = False\n</code></pre>\n\n<p>Or more simply:</p>\n\n<pre><code>isValid :: Position -&gt; Bool\nisValid (Position x y) = x `elem` ['a'..'h'] &amp;&amp; y `elem` [1..8]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1496357491, "last_edit_date": 1496357491, "creation_date": 1496304760, "answer_id": 44302035, "question_id": 44299107, "link": "https://stackoverflow.com/questions/44299107/haskell-parse-error-in-pattern/44302035#44302035", "title": "Haskell Parse error in pattern", "body": "<blockquote>\n  <p>I keep getting this error error: Parse error in pattern: <code>x</code> I am trying to write a function that tells me whether a given position is valid or not. Where <code>x</code> is <code>['a'..'h']</code> and <code>y</code> is <code>[1..8]</code>.</p>\n</blockquote>\n\n<p>The other answers already discussed what is wrong: you used a guard in the clause where there is no bounded <code>x</code>:</p>\n\n<pre><code>isValid Position(<b>_</b> y) = y</code></pre>\n\n<p>and furthermore you use quotes instead of backticks with the <code>elem</code> function:</p>\n\n<pre><code>x 'elem' ['a'..'h']\n</code></pre>\n\n<p>So a rigorous fix would be:</p>\n\n<pre><code>isValid :: Position -&gt; Bool\nisValid (Position x <b>y</b>)\n    | x <b>`</b>elem` ['a'..'h'] && y <b>`</b>elem<b>`</b> [1..8] = True\n    | otherwise = False</code></pre>\n\n<p>Since we actually return the result of the guard, we do not need to use guards and can collapse the guards into one expression:</p>\n\n<pre><code>isValid :: Position -&gt; Bool\nisValid (Position x y) = x `elem` ['a'..'h'] && y `elem` [1..8]</code></pre>\n\n<p>Nevertheless since we here work with <em>ranges</em> and the second range are integers, we do not have to use <code>elem</code> on a range, we can use:</p>\n\n<pre><code>isValid :: Position -&gt; Bool\nisValid (Position x y) = <b>'a' &lt;= x && x &lt;= 'h' && 1 &lt;= y && y &lt;= 8</b></code></pre>\n\n<p>For such small ranges, there will probably not be that much impact on performance, but <code>elem</code> works in <em>O(n)</em> worst case, whereas the two bounds checks work in <em>O(1)</em>.</p>\n"}], "owner": {"reputation": 83, "user_id": 8076776, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fef6962545947b51ea6008f0308330f7?s=128&d=identicon&r=PG&f=1", "display_name": "Dave", "link": "https://stackoverflow.com/users/8076776/dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1027, "favorite_count": 0, "accepted_answer_id": 44299258, "answer_count": 3, "score": 1, "last_activity_date": 1496357491, "creation_date": 1496294606, "question_id": 44299107, "link": "https://stackoverflow.com/questions/44299107/haskell-parse-error-in-pattern", "title": "Haskell Parse error in pattern", "body": "<pre><code>isValid :: Position -&gt; Bool\nisValid Position(x _) = x\nisValid Position(_ y) = y\n    | x 'elem' ['a'..'h'] &amp;&amp; y 'elem' [1..8] = True\n    | otherwise = False\n</code></pre>\n\n<p>I keep getting this error <code>error: Parse error in pattern: x</code>\nI am trying to write a function that tells me whether a given poisition is valid or not. Where <code>x</code> is <code>['a'..'h']</code> and <code>y</code> is <code>[1..8]</code></p>\n"}]