[{"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1518649307, "post_id": 48797644, "comment_id": 84597869, "body": "Is the type being represented at runtime?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1518649361, "post_id": 48797644, "comment_id": 84597890, "body": "You can&#39;t quite say it in Haskell because it&#39;s not dependently typed (you can&#39;t put types in a value-level list) but the Idris definition you gave is functionally equivalent to <code>data List = forall a. Cons a List | Nil</code> because types are opaque in Idris."}], "answers": [{"comments": [{"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 1, "creation_date": 1518691200, "post_id": 48797766, "comment_id": 84613108, "body": "Is the <code>Typeable t</code> constraint inside the <code>CList</code> GADT meant to be a <code>c t</code> constraint? Otherwise wouldn&#39;t we be just tagging the list with a phantom parameter of kind <code>* -&gt; Constraint</code>?"}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 8, "last_activity_date": 1518652647, "last_edit_date": 1518652647, "creation_date": 1518649937, "answer_id": 48797766, "question_id": 48797644, "link": "https://stackoverflow.com/questions/48797644/is-it-possible-to-express-the-type-of-type-value-pairs-on-haskell/48797766#48797766", "title": "Is it possible to express the type of (Type,Value) pairs on Haskell?", "body": "<p>Note that if you construct such <code>List</code> you cannot do anything with the\nelements, as you cannot pattern match on the types.</p>\n\n<p>However it's entirely possible in Haskell usign <code>GADTs</code></p>\n\n<pre><code>data List where\n    Cons :: t -&gt; List -&gt; List\n    Nil  :: List\n\nexample :: List\nexample = Cons (3 :: Int) (Cons True Nil)\n</code></pre>\n\n<p>You <em>can</em> extend that with a constraint, e.g. <code>Typeable</code> so you get\nrun-time type information to do things on elements in the list:</p>\n\n<pre><code>data CList (c :: * -&gt; Constraint) where\n    CCons :: Typeable t =&gt; t -&gt; List c -&gt; List c\n    CNil  :: CList c\n\nexampleC :: CList Typeable\nexampleC = CCons (3 :: Int) (CCons True CNil)\n</code></pre>\n\n<p>Or you can use <code>HList</code></p>\n\n<pre><code>data HList (xs :: [*]) where\n    HCons :: x -&gt; List xs -&gt; List (x ': xs)\n    HNil  :: '[]\n\nexampleH :: HList '[Int, Bool]\nexampleH = HCons 3 (HConst True HNil)\n</code></pre>\n\n<hr>\n\n<p>In particular dependent pairs (or sums!) (<a href=\"http://docs.idris-lang.org/en/latest/tutorial/typesfuns.html#dependent-pairs\" rel=\"noreferrer\">Idris docs</a>) are possible with in Haskell to,\nYet we have to make a GADT for a function!\nThe <a href=\"http://hackage.haskell.org/package/dependent-sum\" rel=\"noreferrer\">http://hackage.haskell.org/package/dependent-sum</a> is one many use</p>\n\n<p>If Idris version is</p>\n\n<pre><code>data DPair : (a : Type) -&gt; (P : a -&gt; Type) -&gt; Type where\n   MkDPair : {P : a -&gt; Type} -&gt; (x : a) -&gt; P x -&gt; DPair a P\n</code></pre>\n\n<p>the Haskell is not that much different when <code>a = Type</code>:</p>\n\n<pre><code>data DPair (p :: * -&gt; *) where\n   MkDPair :: p a -&gt; DPair p\n</code></pre>\n\n<p>and <code>p</code> is encoded with a <code>GADT</code>. In examples above, it's sliced into the\ndefinitions.</p>\n\n<p>You can also make dependent pairs with something else than a type as a first\n  element. But then you have to read about\n<a href=\"https://hackage.haskell.org/package/singletons\" rel=\"noreferrer\">singletons</a>.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "accepted_answer_id": 48797766, "answer_count": 1, "score": 5, "last_activity_date": 1518652647, "creation_date": 1518649126, "question_id": 48797644, "link": "https://stackoverflow.com/questions/48797644/is-it-possible-to-express-the-type-of-type-value-pairs-on-haskell", "title": "Is it possible to express the type of (Type,Value) pairs on Haskell?", "body": "<p>Lists of (Type,Value) pairs can be expressed on Idris as:</p>\n\n<pre><code>data List : Type where\n  Cons : (t : Type ** t) -&gt; List -&gt; List\n  Nil  : List\n\nexample : List\nexample = Cons (Nat ** 3) (Cons (Bool ** True) Nil)\n</code></pre>\n\n<p>What is the syntax to express those on Haskell?</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1518649257, "post_id": 48797597, "comment_id": 84597855, "body": "When you benchmark it should be with compiled code that uses at least <code>-O1</code>.  Anything else, particularly using ghci, is meaningless."}, {"owner": {"reputation": 107, "user_id": 3925436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf9a6edd82ce618bfb3a69a9ab3214cd?s=128&d=identicon&r=PG&f=1", "display_name": "vvebik", "link": "https://stackoverflow.com/users/3925436/vvebik"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1518649879, "post_id": 48797597, "comment_id": 84598099, "body": "@ThomasM.DuBuisson I agree. But I&#39;m more interested in the ratio of these times. Why is the strict version so slower here?  This is not the only test. I constantly get about this ratio."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 6, "last_activity_date": 1518650138, "creation_date": 1518650138, "answer_id": 48797793, "question_id": 48797597, "link": "https://stackoverflow.com/questions/48797597/why-strictness-makes-performance-worse-in-haskell/48797793#48797793", "title": "Why strictness makes performance worse in Haskell", "body": "<p>If you really want to work to improve the performance of GHCi then I commend that, but a benchmark in GHCi is not something you can use to reason about the performance of the code in basically any other setting.  The performance numbers you see are only meaningful in your one narrow context.</p>\n\n<p>For example, when you translate your code into a criterion benchmark and comipile with optimization you'll see the strict version performing better, not worse:</p>\n\n<pre><code>benchmarking first\ntime                 5.808 s    (4.995 s .. 6.718 s)\n                     0.996 R\u00b2   (0.995 R\u00b2 .. 1.000 R\u00b2)\nmean                 5.237 s    (4.931 s .. 5.452 s)\nstd dev              325.5 ms   (0.0 s .. 374.0 ms)\nvariance introduced by outliers: 19% (moderately inflated)\n\nbenchmarking second\ntime                 5.276 s    (4.576 s .. 6.089 s)\n                     0.997 R\u00b2   (0.990 R\u00b2 .. 1.000 R\u00b2)\nmean                 5.070 s    (4.817 s .. 5.212 s)\nstd dev              224.0 ms   (0.0 s .. 244.9 ms)\nvariance introduced by outliers: 19% (moderately inflated)\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 3925436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf9a6edd82ce618bfb3a69a9ab3214cd?s=128&d=identicon&r=PG&f=1", "display_name": "vvebik", "link": "https://stackoverflow.com/users/3925436/vvebik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 48797793, "answer_count": 1, "score": 1, "last_activity_date": 1518650138, "creation_date": 1518648927, "question_id": 48797597, "link": "https://stackoverflow.com/questions/48797597/why-strictness-makes-performance-worse-in-haskell", "title": "Why strictness makes performance worse in Haskell", "body": "<p>I played with strict evaluations, vectors and matrices and got a rather strange result. There is the following code:</p>\n\n<pre><code>module Test where\n\nimport qualified Data.Vector as V\nimport qualified Data.Matrix as M\n\nimport Control.DeepSeq\n\nmatrixCtor :: Int -&gt; Int -&gt; Int -&gt; M.Matrix Int\nmatrixCtor x y size = M.matrix size size $ \\(i,j) -&gt; x*i+y*j\n\nf :: M.Matrix Int -&gt; M.Matrix Int\nf b = c\n  where\n    n = M.nrows b\n    bt' = V.generate n $ \\j -&gt; M.getCol (j+1) b\n    c = M.matrix n n $ \\(i,j) -&gt; V.sum  (V.unsafeIndex bt' (j-1))\n</code></pre>\n\n<p>I load it into ghci and perform the following actions:</p>\n\n<pre><code>*Main Test&gt; :set +s\n*Main Test&gt; a = matrixCtor 1 2 800\n(0.02 secs, 0 bytes)\n*Main Test&gt; f a `deepseq` 1\n1\n(6.69 secs, 8,684,393,584 bytes)\n</code></pre>\n\n<p>Then I tried so:</p>\n\n<pre><code>*Main Test&gt; a = matrixCtor 1 2 800\n(0.00 secs, 0 bytes)\n*Main Test&gt; a `deepseq` 1\n1\n(0.35 secs, 220,646,904 bytes)\n*Main Test&gt; f a `deepseq` 1\n1\n(9.72 secs, 8,484,723,352 bytes)\n*Main Test&gt;\n</code></pre>\n\n<p>In the second version, I calculate the matrix in advance and it seemed to me that the execution of the function <code>f</code> should be accelerated, but this did't happen. I can't understand why.</p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1518644714, "post_id": 48796444, "comment_id": 84595943, "body": "I&#39;d say the intuition is correct. In general <code>Just x1 &lt;*&gt; Just x2 ... &lt;*&gt; Just xN = Just (x1 x2 ... xN)</code>. Since <code>(.)</code> only composes two functions, it can&#39;t work on three. It would work if you used <code>(\\f g h -&gt; f.g.h)</code> instead of <code>(.)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1731, "user_id": 780350, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/afaa8b1a1e2fe1b53755564e5fa34568?s=128&d=identicon&r=PG", "display_name": "melston", "link": "https://stackoverflow.com/users/780350/melston"}, "edited": false, "score": 0, "creation_date": 1518646703, "post_id": 48796910, "comment_id": 84596791, "body": "Thanks, so much. This is a great way of looking at it.  I should have thought of applying the parentheses as well."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 1731, "user_id": 780350, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/afaa8b1a1e2fe1b53755564e5fa34568?s=128&d=identicon&r=PG", "display_name": "melston", "link": "https://stackoverflow.com/users/780350/melston"}, "edited": false, "score": 2, "creation_date": 1518646802, "post_id": 48796910, "comment_id": 84596844, "body": "Those parentheses are important, and they&#39;ll get ya if you&#39;re not careful.  Especially when you&#39;re working with an associative law the parens are very important, as order of operation is what is truly being explored with the law."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 4, "last_activity_date": 1518645391, "creation_date": 1518645391, "answer_id": 48796910, "question_id": 48796444, "link": "https://stackoverflow.com/questions/48796444/the-composition-law-of-applicative-in-the-typeclassopedia/48796910#48796910", "title": "The composition law of Applicative in the Typeclassopedia", "body": "<p>This is just a case of not applying the substitution rule correctly, and forgetting the importance of parentheses in these substitutions (although some of them can be dropped later). The rule should be expressed as</p>\n\n<pre><code>u &lt;*&gt; (v &lt;*&gt; w) == (pure (.) &lt;*&gt; u &lt;*&gt; v) &lt;*&gt; w\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>Just (+1) &lt;*&gt; (Just (+2) &lt;*&gt; Just 34)\n    -- u = Just (+1)\n    -- v = Just (+2)\n    -- w = Just 34\n =&gt; (pure (.) &lt;*&gt; u &lt;*&gt; v) &lt;*&gt; w\n =&gt; (pure (.) &lt;*&gt; Just (+1) &lt;*&gt; Just (+2)) &lt;*&gt; Just 34\n</code></pre>\n\n<p>To add another layer on this, you have to use another <code>pure (.)</code>:</p>\n\n<pre><code>Just (+3) &lt;*&gt; (Just (+1) &lt;*&gt; (Just (+2) &lt;*&gt; Just 34))\n    -- u = Just (+3)\n    -- v = Just (+1)\n    -- w = Just (+2) &lt;*&gt; Just 34\n =&gt; (pure (.) &lt;*&gt; u &lt;*&gt; v) &lt;*&gt; w\n =&gt; pure (.) &lt;*&gt; Just (+3) &lt;*&gt; Just (+1) &lt;*&gt; (Just (+2) &lt;*&gt; Just 34)\n</code></pre>\n\n<p>If you wanted to work off of the <code>pure</code> form from the first stage, you'd have</p>\n\n<pre><code>Just (+3) &lt;*&gt; ((pure (.) &lt;*&gt; Just (+1) &lt;*&gt; Just (+2)) &lt;*&gt; Just 34)\n    -- u = Just (+3)\n    -- v = pure (.) &lt;*&gt; Just (+1) &lt;*&gt; Just (+2)\n    -- w = Just 34\n =&gt; (pure (.) &lt;*&gt; u &lt;*&gt; v) &lt;*&gt; w\n =&gt; pure (.) &lt;*&gt; Just (+3) &lt;*&gt; (pure (.) &lt;*&gt; Just (+1) &lt;*&gt; Just (+2)) &lt;*&gt; Just 34\n</code></pre>\n\n<p>Which isn't nearly as pretty as one would hope, I'm afraid.</p>\n"}, {"comments": [{"owner": {"reputation": 1731, "user_id": 780350, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/afaa8b1a1e2fe1b53755564e5fa34568?s=128&d=identicon&r=PG", "display_name": "melston", "link": "https://stackoverflow.com/users/780350/melston"}, "edited": false, "score": 0, "creation_date": 1518649893, "post_id": 48797365, "comment_id": 84598106, "body": "Very nice.  I still have a lot to learn about the language and how to use it effectively but gems like this help smooth the way."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 4, "last_activity_date": 1518647821, "creation_date": 1518647821, "answer_id": 48797365, "question_id": 48796444, "link": "https://stackoverflow.com/questions/48796444/the-composition-law-of-applicative-in-the-typeclassopedia/48797365#48797365", "title": "The composition law of Applicative in the Typeclassopedia", "body": "<p>As chi points out, your intuition is now correct. Quoting <a href=\"https://stackoverflow.com/questions/48796444/applicative-in-typeclassopedia#comment84595943_48796444\">their comment</a>:</p>\n\n<blockquote>\n  <p>Since <code>(.)</code> only composes two functions, it can't work on three.</p>\n</blockquote>\n\n<p>This form of the composition law (i.e. in terms of <code>(&lt;*&gt;)</code>) is rather headache-inducing, specially if you want to work out further results using it (for a small example, cf. the latter part of <a href=\"https://stackoverflow.com/a/48796910/2751851\">bheklilr's answer</a>). It gets a little easier to scan if we apply (<code>pure f &lt;*&gt; x = f &lt;$&gt; x</code>) to it:</p>\n\n<pre><code>u &lt;*&gt; (v &lt;*&gt; w) = ((.) &lt;$&gt; u &lt;*&gt; v) &lt;*&gt; w\n</code></pre>\n\n<p>Now the associativity in question is a little more obvious: applying <code>v</code> and then <code>u</code> to <code>w</code> through the functor is the same as composing <code>u</code> and <code>v</code> through the functor and then applying to <code>w</code>. For a major improvement, though, we have to switch to the so-called <em>static arrow</em> presentation:</p>\n\n<pre><code>idA :: Applicative f =&gt; f (a -&gt; a)\nidA = pure id\n\n(.*) :: Applicative f =&gt; f (b -&gt; c) -&gt; f (a -&gt; b) -&gt; f (a -&gt; c)\nu .* v = (.) &lt;$&gt; u &lt;*&gt; v -- This looks familiar...\n\n-- Conversely:\n-- pure x = ($ x) &lt;$&gt; idA -- Alternatively: const x &lt;$&gt; idA\n-- u &lt;*&gt; v = ($ ()) &lt;$&gt; (u .* (const &lt;$&gt; v))\n</code></pre>\n\n<p>In terms of <code>(.*)</code>, the composition law becomes...</p>\n\n<pre><code>u .* (v .* w) = (u .* v) .* w\n</code></pre>\n\n<p>... which is transparently an associativity law.</p>\n"}], "owner": {"reputation": 1731, "user_id": 780350, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/afaa8b1a1e2fe1b53755564e5fa34568?s=128&d=identicon&r=PG", "display_name": "melston", "link": "https://stackoverflow.com/users/780350/melston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 48796910, "answer_count": 2, "score": 2, "last_activity_date": 1518647821, "creation_date": 1518643334, "last_edit_date": 1518645780, "question_id": 48796444, "link": "https://stackoverflow.com/questions/48796444/the-composition-law-of-applicative-in-the-typeclassopedia", "title": "The composition law of Applicative in the Typeclassopedia", "body": "<p>I am reading <a href=\"https://wiki.haskell.org/Typeclassopedia\" rel=\"nofollow noreferrer\">Typeclassopedia</a> and I was having trouble in the section on Applicatives.  I think I (sort of) have it figured out but I want to see if my understanding is correct.</p>\n\n<p>The laws for applicative made sense right up until the Composition law.  I just couldn't parse the right-hand side of this:</p>\n\n<pre><code>u &lt;*&gt; (v &lt;*&gt; w) = pure (.) &lt;*&gt; u &lt;*&gt; v &lt;*&gt; w\n</code></pre>\n\n<p>So, I fired up GHCI and ran some experiments.</p>\n\n<pre><code>Prelude&gt; pure (.) &lt;*&gt; Just (+1) &lt;*&gt; Just (+2) &lt;*&gt; Just 34\nJust 37\n</code></pre>\n\n<p>So this verifies the law, but I still didn't understand it.  I tried some variations to see if I could get some insight:</p>\n\n<pre><code>Prelude&gt; pure (.) &lt;*&gt; Just (+1) &lt;*&gt; Just (+2) &lt;*&gt; Just (+3) &lt;*&gt; Just 34\n\n&lt;interactive&gt;:26:1: error:\n    * Non type-variable argument in the constraint: Num (b -&gt; b)\n      (Use FlexibleContexts to permit this)\n    * When checking the inferred type\n        it :: forall b. (Num (b -&gt; b), Num b) =&gt; Maybe b\n</code></pre>\n\n<p>So, composition works for two functions but not for three?  I didn't understand why.</p>\n\n<p>I then verified that <code>&lt;*&gt;</code> worked as I thought it would for a simple expression:</p>\n\n<pre><code>Prelude&gt; Just (+1) &lt;*&gt; Just 1\nJust 2\n</code></pre>\n\n<p>However, the following didn't work:</p>\n\n<pre><code>Prelude&gt;  Just (+1) &lt;*&gt; Just (+2) &lt;*&gt; Just 34\n\n&lt;interactive&gt;:15:2: error:\n    * Non type-variable argument in the constraint: Num (b -&gt; b)\n      (Use FlexibleContexts to permit this)\n    * When checking the inferred type\n        it :: forall b. (Num (b -&gt; b), Num b) =&gt; Maybe b\n</code></pre>\n\n<p>So, application isn't the same as composition.  I had thought that <code>Just (+2) &lt;*&gt; Just 34</code> would have resulted in <code>Just 36</code> and <code>Just (+1) &lt;*&gt; Just 36</code> would have resulted in <code>Just 37</code>.  The composition operator, <code>(.)</code>, is needed, but it only works for two functions.  I just didn't understand why it was needed or how it worked.</p>\n\n<p>And, just to throw more dirt into this water, I tried the following:</p>\n\n<pre><code>Prelude&gt; Just (,) &lt;*&gt; Just 2\n</code></pre>\n\n<p>which failed because there was no instance of <code>Show</code> for the result.  So I tried:</p>\n\n<pre><code>Prelude&gt; :t Just (,) &lt;*&gt; Just 2\nJust (,) &lt;*&gt; Just 2 :: Num a =&gt; Maybe (b -&gt; (a, b))\n</code></pre>\n\n<p>This gave me a bit of insight.  I needed to pass a second value to get a <code>tuple</code> returned.  I tried:</p>\n\n<pre><code>Prelude&gt; Just (,) &lt;*&gt; Just 2 Just 34\n</code></pre>\n\n<p>but that failed, and the error message really didn't help me figure out just where the error was.  So, looking at the type of the above code I realized that it was the same as if I had entered <code>Just (2, )</code> (or something like it, anyway).  So, I tried:</p>\n\n<pre><code>Prelude&gt; Just (,) &lt;*&gt; Just (2) &lt;*&gt; Just 34\nJust (2,34)\n</code></pre>\n\n<p>I was actually surprised that this worked.  But in that surprise came the germ of understanding (I think).</p>\n\n<p>I went back to the definition of <code>(&lt;*&gt;)</code> in Typeclassopedia and discovered it is defined as <strong>left</strong> associative.  I hadn't even considered associativity before this.  So the above expression would actually evaluate something like this:</p>\n\n<pre><code>Prelude&gt; Just (,) &lt;*&gt; Just (2) &lt;*&gt; Just 34\n-- Apply the 2 as the first parameter of (,) leaving a function\n-- that takes the second parameter\nJust (2,) &lt;*&gt; Just 34\n-- Now apply the 34 as the parameter to the resulting function\nJust (2,34)\n</code></pre>\n\n<p>If this is correct then the example of the Composition law that worked evaluates like this:</p>\n\n<pre><code>Prelude&gt; pure (.) &lt;*&gt; Just (+1) &lt;*&gt; Just (+2) &lt;*&gt; Just 34\npure (+1 . ) &lt;*&gt; Just (+2) &lt;*&gt; Just 34\npure (+1 . +2) &lt;*&gt; Just 34\nJust 37\n</code></pre>\n\n<p>This also explains why three functions cannot be composed this way:</p>\n\n<pre><code>Prelude&gt; pure (.) &lt;*&gt; Just (+1) &lt;*&gt; Just (+2) &lt;*&gt; Just (+3) &lt;*&gt; Just 34\npure (+1 . ) &lt;*&gt; Just (+2) &lt;*&gt; Just (+3) &lt;*&gt; Just 34\npure (+1 . +2) &lt;*&gt; Just (+3) &lt;*&gt; Just 34\n</code></pre>\n\n<p>And, at this point we have a composed function expecting an instance of the <code>Num</code> typeclass but are, instead, passing it a function, which fails.</p>\n\n<p>In a similar manner:</p>\n\n<pre><code>Prelude&gt;  Just (+1) &lt;*&gt; Just (+2) &lt;*&gt; Just 34\n</code></pre>\n\n<p>fails because <code>&lt;*&gt;</code> isn't composition and is trying to apply a function, <code>(+2)</code> to another function, <code>(+1)</code>, and running into a type constraint.</p>\n\n<p>So, is my intuition correct here?  Have I finally figured this out?  Or is my (somewhat) educated guess still off base?</p>\n"}, {"tags": ["haskell", "grammar", "bison", "happy"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518638432, "post_id": 48795117, "comment_id": 84592873, "body": "are you sure about this <code>ClassAttributes: (...) ClassAttributes ClassAttribute {ClassAttributes $1 $2}</code> usually it is a bad idea to have rules like <code>S -&gt; S a</code>, usually it is done the opposite way with <code>S -&gt; a S</code>."}, {"owner": {"reputation": 37, "user_id": 1559094, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/9j9m7.jpg?s=128&g=1", "display_name": "Eddtothefullest", "link": "https://stackoverflow.com/users/1559094/eddtothefullest"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518638600, "post_id": 48795117, "comment_id": 84592942, "body": "you are totally right, however, since Happy builds an LALR parser it&#39;s actually better to do it with left recursion rules."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 1, "creation_date": 1518640041, "post_id": 48795117, "comment_id": 84593647, "body": "This is not the full grammar and does not provide enough information to diagnose the problem. Where is TypeFuncParams?"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1518640430, "post_id": 48795117, "comment_id": 84593873, "body": "@willem: avoiding left recursion is only important for LL parsing. &quot;Usually&quot; depends a lot on your context; in mine, top-down parsing is unusual."}, {"owner": {"reputation": 37, "user_id": 1559094, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/9j9m7.jpg?s=128&g=1", "display_name": "Eddtothefullest", "link": "https://stackoverflow.com/users/1559094/eddtothefullest"}, "edited": false, "score": 0, "creation_date": 1518644003, "post_id": 48795117, "comment_id": 84595637, "body": "I didn&#39;t add the other rules because they are not part of the problem (according to Happy)."}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 1559094, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/9j9m7.jpg?s=128&g=1", "display_name": "Eddtothefullest", "link": "https://stackoverflow.com/users/1559094/eddtothefullest"}, "edited": false, "score": 0, "creation_date": 1518670053, "post_id": 48797716, "comment_id": 84602918, "body": "Sorry for not making it clear enough, I tried to simplify it but didn&#39;t know there was a guide for that. Thank you very much for the detailed explanation and for the elegant solution!"}], "tags": [], "owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "is_accepted": true, "score": 4, "last_activity_date": 1518674708, "last_edit_date": 1518674708, "creation_date": 1518649584, "answer_id": 48797716, "question_id": 48795117, "link": "https://stackoverflow.com/questions/48795117/solving-this-shift-reduce-conflict-in-happy-bison/48797716#48797716", "title": "Solving this Shift/Reduce Conflict in Happy/Bison", "body": "<p>Below is a simplified grammar which exhibits the same problem.</p>\n\n<p>To construct it, I removed</p>\n\n<ul>\n<li>all actions</li>\n<li>the prefix \"Class\" from all nonterminal names</li>\n</ul>\n\n<p>I also simplified most of the rules. I did this as an illustration of how you can construct a <a href=\"https://stackoverflow.com/help/mcve\">minimal, complete, verifiable example</a>, as suggested by the StackOverflow guidelines, which makes it easier to focus on the problem while still permitting an actual trial. (I used bison, not happy, but the syntax is very similar.)</p>\n\n<pre><code>Block      : \"{\" Attributes Constructor Functions \"}\"\nAttributes : {- empty -} | Attributes Attribute\nConstructor: {- empty -} | \"constructor\"\nFunctions  : {- empty -} | Functions Function\nAttribute  : \"[+]\" \"attribute\"\nFunction   : \"[+]\" \"function\"\n</code></pre>\n\n<p>Now, let's play parser, and suppose that we've (somehow) identified a prefix which could match <code>Attributes</code>. (<code>Attributes</code> can match the empty string, so we could be right at the beginning of the input.) And suppose the next token is <code>[+]</code>.</p>\n\n<p>At this point, we cannot tell if the <code>[+]</code> will later turn out to be the beginning of an <code>Attribute</code> or if it is the start of a <code>Function</code> which follows an empty <code>Constructor</code>. However, we need to know that in order to continue the parse.</p>\n\n<p>If we've finished with the Attributes and about to start on the Functions, this is the moment where we have to reduce the empty nonterminal <code>Constructor</code>. Unless we do that now, we cannot then go on to recognize a <code>Function</code>. On the other hand, if we haven't seen the last <code>Attribute</code> but we do reduce a <code>Constructor</code>, then the parse will eventually fail because the next <code>Attribute</code> cannot follow the <code>Constructor</code> we just reduced.</p>\n\n<p>In cases like this, it is often useful to remove the empty production by factoring the options into the places where the non-terminal is used:</p>\n\n<pre><code>Block      : \"{\" Attributes \"constructor\" Functions \"}\"\n           | \"{\" Attributes Functions \"}\"\nAttributes : {- empty -} | Attributes Attribute\nFunctions  : {- empty -} | Functions Function\nAttribute  : \"[+]\" \"attribute\"\nFunction   : \"[+]\" \"function\"\n</code></pre>\n\n<p>But just removing <code>Constructor</code> isn't enough here. In order to start parsing the list of Functions, we need to first reduce an empty <code>Functions</code> to provide the base case of the <code>Functions</code> recursion, so we still need to guess where the <code>Functions</code> start in order to find the correct parse. And if we wrote the two lists as right-recursions instead of left-recursions, we'd instead need an empty <code>Attributes</code> to terminate the recursion of the <code>Attributes</code> recursion.</p>\n\n<p>What we could do, in this particular case, is use a cunning combination of left- and right-recursion:</p>\n\n<pre><code>Block      : \"{\" Attributes \"constructor\" Functions \"}\"\n           | \"{\" Attributes Functions \"}\"\nAttributes : {- empty -} | Attributes Attribute\nFunctions  : {- empty -} | Function Functions\nAttribute  : \"[+]\" \"attribute\"\nFunction   : \"[+]\" \"function\"\n</code></pre>\n\n<p>By making the first list left-recursive and the second list right-recursive, we avoid the need to reduce an empty non-terminal between the two lists. That, in turn, allows the parser to decide whether a phrase was an <code>Attribute</code> or a <code>Function</code> after it has seen the phrase, at which point it is no longer necessary to consult an oracle.</p>\n\n<p>However, that solution is not very pretty for a number of reasons, not the least of which being that it only works for the concatenation of two optional lists. If we wanted to add another list of a different kind of item which could also start with the <code>[+]</code> token, a different solution would be needed..</p>\n\n<p>The simplest one, which is used by a number of languages, is to allow the programmer to intermingle the various list elements. You might consider that bad style, but it is not always necessary to castigate bad style by making it a syntax error.</p>\n\n<p>A simple solution would be:</p>\n\n<pre><code>Block      : \"{\" Things \"}\"\nThings     : {- empty -} | Things Attribute | Things Function | Things Constructor\nAttribute  : \"[+]\" \"attribute\"\nConstructor: \"constructor\"\nFunction   : \"[+]\" \"function\"\n</code></pre>\n\n<p>but that doesn't limit a Block to at most one Constructor, which seems to be a syntactic requirement. However, as long as <code>Constructor</code> cannot start with a <code>[+]</code>, you could implement the \"at most one Constructor\" limitation with:</p>\n\n<pre><code>Block      : \"{\" Things Constructor Things \"}\"\n           | \"{\" Things \"}\"\nThings     : {- empty -} | Things Attribute | Things Function\nAttribute  : \"[+]\" \"attribute\"\nConstructor: \"constructor\"\nFunction   : \"[+]\" \"function\"\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 1559094, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/9j9m7.jpg?s=128&g=1", "display_name": "Eddtothefullest", "link": "https://stackoverflow.com/users/1559094/eddtothefullest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 48797716, "answer_count": 1, "score": 1, "last_activity_date": 1518674708, "creation_date": 1518637841, "last_edit_date": 1518644054, "question_id": 48795117, "link": "https://stackoverflow.com/questions/48795117/solving-this-shift-reduce-conflict-in-happy-bison", "title": "Solving this Shift/Reduce Conflict in Happy/Bison", "body": "<p>I am making a simple parser in Happy (Bison equivalent for Haskell) and I stumbled upon a shift/reduce conflict in these rules:</p>\n\n<pre><code>ClassBlock :\n        \"{\" ClassAttributes  ClassConstructor ClassFunctions \"}\" {ClassBlock $2 $3 $4}\n\nClassAttributes :\n        {- empty -} { ClassAttributesEmpty }\n      | ClassAttributes ClassAttribute {ClassAttributes $1 $2}\n\nClassAttribute :\n        \"[+]\" Variable {ClassAttributePublic $2 }\n      | \"[-]\" Variable {ClassAttributePrivate $2 }\n\nClassFunctions :\n        {- empty -} { ClassFunctionsEmpty }\n      | ClassFunctions ClassFunction {ClassFunctions $1 $2}\n\nClassFunction :\n        \"[+]\" Function {ClassFunctionPublic $2}\n      | \"[-]\" Function {ClassFunctionPrivate $2}\n\nClassConstructor :\n       {- empty -} { ClassConstructorEmpty }\n      | TypeFuncParams var_identifier Params Block {ClassConstructor $1 $2 $3 $4}\n\nTypeFuncParams :\n      Primitive ClosingBracketsNoIdentifier { TypeFuncParamsPrimitive $1 $2}\n    | class_identifier ClosingBracketsNoIdentifier { TypeFuncParamsClassId $1 $2}\n    | ListType {TypeFuncParamsList $1}\n</code></pre>\n\n<p>The info file states the shift/reduce conflict:</p>\n\n<pre><code>ClassBlock -&gt; \"{\" ClassAttributes . ClassConstructor ClassFunctions \"}\"    (rule 52)\n    ClassAttributes -&gt; ClassAttributes . ClassAttribute    (rule 54)\n\n    \"[+]\"          shift, and enter state 85\n            (reduce using rule 61)\n\n    \"[-]\"          shift, and enter state 86\n            (reduce using rule 61)\n</code></pre>\n\n<p>Rule 61 is this one:</p>\n\n<pre><code>ClassConstructor :\n   {- empty -} { ClassConstructorEmpty }\n</code></pre>\n\n<p>I am not really sure how to solve this problem. I tried using precedence rules to silence the warning, but it didn't work out as I expected.</p>\n"}, {"tags": ["haskell", "vim"], "answers": [{"comments": [{"owner": {"reputation": 39152, "user_id": 438329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4b5b093781b8d97da6b9c21cf2706d7?s=128&d=identicon&r=PG", "display_name": "Peter Rincker", "link": "https://stackoverflow.com/users/438329/peter-rincker"}, "edited": false, "score": 4, "creation_date": 1518635891, "post_id": 48794539, "comment_id": 84591544, "body": "Newer Vim (8+) and NeoVim both support the <code>:terminal</code> command. In Vim you can bring up a terminal window/split with <code>:terminal ghci</code>. See <code>:h terminal</code> &amp; <code>:h :terminal</code>"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1518635894, "post_id": 48794539, "comment_id": 84591546, "body": "On the topic of Conque, I&#39;d look specifically at <a href=\"https://github.com/vim-scripts/Conque-GDB\" rel=\"nofollow noreferrer\">github.com/vim-scripts/Conque-GDB</a>.  It includes a forked version of Conque that included improvements to the Conque side such as allowing the conque shell to scroll even when it is not the active buffer.  And then also has the benefit of having GDB integration."}, {"owner": {"reputation": 934, "user_id": 1136236, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5c4f2b250d57a1ebf233426012487539?s=128&d=identicon&r=PG", "display_name": "Jonathan Dewein", "link": "https://stackoverflow.com/users/1136236/jonathan-dewein"}, "reply_to_user": {"reputation": 39152, "user_id": 438329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4b5b093781b8d97da6b9c21cf2706d7?s=128&d=identicon&r=PG", "display_name": "Peter Rincker", "link": "https://stackoverflow.com/users/438329/peter-rincker"}, "edited": false, "score": 0, "creation_date": 1518636309, "post_id": 48794539, "comment_id": 84591734, "body": "@PeterRincker :terminal ghci is pretty much exactly what I was looking for, thanks!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 39152, "user_id": 438329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4b5b093781b8d97da6b9c21cf2706d7?s=128&d=identicon&r=PG", "display_name": "Peter Rincker", "link": "https://stackoverflow.com/users/438329/peter-rincker"}, "edited": false, "score": 1, "creation_date": 1518636364, "post_id": 48794539, "comment_id": 84591770, "body": "@PeterRincker Nice, I didn&#39;t know about that! I&#39;ll add it to the answer."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "reply_to_user": {"reputation": 39152, "user_id": 438329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4b5b093781b8d97da6b9c21cf2706d7?s=128&d=identicon&r=PG", "display_name": "Peter Rincker", "link": "https://stackoverflow.com/users/438329/peter-rincker"}, "edited": false, "score": 0, "creation_date": 1518636464, "post_id": 48794539, "comment_id": 84591814, "body": "@PeterRincker I hadn&#39;t realized that was added in vim8.  I&#39;ll have to experiment with that as Conque can be quite finicky (still like it for GDB, though)."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1518636593, "post_id": 48794539, "comment_id": 84591878, "body": "@DanielWagner You could probably put your previous answer as a &quot;pre-Vim8 solution&quot; rather than &quot;should be ignored&quot;."}, {"owner": {"reputation": 39152, "user_id": 438329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4b5b093781b8d97da6b9c21cf2706d7?s=128&d=identicon&r=PG", "display_name": "Peter Rincker", "link": "https://stackoverflow.com/users/438329/peter-rincker"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 1, "creation_date": 1518636651, "post_id": 48794539, "comment_id": 84591903, "body": "@ChristianGibbons, You may want to take a look at <code>:Termdebug</code> for GDB, which is shipped with Vim 8+ as well. See <code>:h terminal-debug</code>"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "reply_to_user": {"reputation": 39152, "user_id": 438329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4b5b093781b8d97da6b9c21cf2706d7?s=128&d=identicon&r=PG", "display_name": "Peter Rincker", "link": "https://stackoverflow.com/users/438329/peter-rincker"}, "edited": false, "score": 0, "creation_date": 1518636836, "post_id": 48794539, "comment_id": 84592004, "body": "@PeterRincker I&#39;ll do that, thanks.  Always looking for ways to improve my workflow in vim."}, {"owner": {"reputation": 934, "user_id": 1136236, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5c4f2b250d57a1ebf233426012487539?s=128&d=identicon&r=PG", "display_name": "Jonathan Dewein", "link": "https://stackoverflow.com/users/1136236/jonathan-dewein"}, "edited": false, "score": 0, "creation_date": 1518636997, "post_id": 48794539, "comment_id": 84592088, "body": "One more thing: How do i change the order of the windows? For example, if I want my Haskell file on top, and my ghci session on bottom?  There is a nice series of commands for moving vim windows: <a href=\"https://stackoverflow.com/questions/4556184/vim-move-window-left-right\" title=\"vim move window left right\">stackoverflow.com/questions/4556184/vim-move-window-left-rig&zwnj;&#8203;ht</a>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1518636478, "last_edit_date": 1518636478, "creation_date": 1518635360, "answer_id": 48794539, "question_id": 48794422, "link": "https://stackoverflow.com/questions/48794422/how-do-i-use-vim-split-to-open-ghci-and-a-haskell-file/48794539#48794539", "title": "How do I use vim :split to open ghci and a Haskell file?", "body": "<p>You can use the <code>:terminal</code> command (thanks, @PeterRincker!) to create a terminal emulator split. Add the command you want to run; e.g. <code>:terminal ghci</code>.</p>\n\n<p>My previous advice, which was predicated on the non-existence of <code>:terminal</code> (and should therefore probably be ignored), is included below for completeness rather than helpfulness.</p>\n\n<p>If you actually mean vim (and not gvim), you can use <a href=\"https://github.com/tmux/tmux/wiki\" rel=\"nofollow noreferrer\">tmux</a> or similar. <a href=\"https://github.com/isovector/ghci.vim\" rel=\"nofollow noreferrer\">This vim plugin</a> might be nice for automating interactions between the two tmux panes.</p>\n\n<p>Otherwise you'll need to use a plugin for doing terminal stuff from within gvim. <a href=\"https://github.com/Shougo/vimshell.vim\" rel=\"nofollow noreferrer\">vimshell</a> and <a href=\"https://code.google.com/archive/p/conque/\" rel=\"nofollow noreferrer\">conque</a> look relevant in this space.</p>\n"}], "owner": {"reputation": 934, "user_id": 1136236, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5c4f2b250d57a1ebf233426012487539?s=128&d=identicon&r=PG", "display_name": "Jonathan Dewein", "link": "https://stackoverflow.com/users/1136236/jonathan-dewein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 4, "accepted_answer_id": 48794539, "answer_count": 1, "score": 4, "last_activity_date": 1518636478, "creation_date": 1518634911, "question_id": 48794422, "link": "https://stackoverflow.com/questions/48794422/how-do-i-use-vim-split-to-open-ghci-and-a-haskell-file", "title": "How do I use vim :split to open ghci and a Haskell file?", "body": "<p>I am currently studying <a href=\"https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours/First_Steps\" rel=\"nofollow noreferrer\">Write yourself a Scheme</a>.</p>\n\n<p>I love vim and want to use :split to have my top file be my Haskell file, and the bottom split to be ghci, repl.</p>\n\n<p>However, split just opens files. Is this true? How do I open my top split and my Haskell file and my bottom split as ghci?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1518630390, "post_id": 48793039, "comment_id": 84588663, "body": "Terminology note: <code>[a]</code> is the type of lists, not of arrays."}], "answers": [{"comments": [{"owner": {"reputation": 232, "user_id": 5202572, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b90339fcc33f2a548a97397f861151d1?s=128&d=identicon&r=PG&f=1", "display_name": "hisoka", "link": "https://stackoverflow.com/users/5202572/hisoka"}, "edited": false, "score": 0, "creation_date": 1518635233, "post_id": 48793250, "comment_id": 84591166, "body": "Thank you for pointing out the other mistake with regards to the parameters! It works!"}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 8, "last_activity_date": 1518630198, "creation_date": 1518630198, "answer_id": 48793250, "question_id": 48793039, "link": "https://stackoverflow.com/questions/48793039/haskell-function-signatures/48793250#48793250", "title": "Haskell - Function signatures", "body": "<p><code>(a b c)</code> applies function <code>a</code> to arguments <code>b</code> and <code>c</code>, when it looks like you want to provide <code>a</code> <code>b</code> and <code>c</code> as arguments to <code>Map.insert</code>. You can't provide <code>b</code> directly since it has the wrong type (<code>x</code> instead of <code>[x]</code>) but you can create a singleton list to insert:</p>\n\n<pre><code>foo :: Ord x =&gt; x -&gt; x -&gt; Stuff x -&gt; Stuff x\nfoo a b (Stuff c) = Stuff (Map.insert a [b] c)\n</code></pre>\n"}], "owner": {"reputation": 232, "user_id": 5202572, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b90339fcc33f2a548a97397f861151d1?s=128&d=identicon&r=PG&f=1", "display_name": "hisoka", "link": "https://stackoverflow.com/users/5202572/hisoka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 48793250, "answer_count": 1, "score": 1, "last_activity_date": 1518635115, "creation_date": 1518629431, "last_edit_date": 1518635115, "question_id": 48793039, "link": "https://stackoverflow.com/questions/48793039/haskell-function-signatures", "title": "Haskell - Function signatures", "body": "<p>I am having difficulties understanding the issues with implementing certain functions. I have a general data type defined as follow :</p>\n\n<pre><code>import qualified Data.Map.Strict as Map\ndata Stuff x = Stuff (Map.Map x [x])\n</code></pre>\n\n<p>When I try to implement a function such as this :</p>\n\n<pre><code>foo :: Ord x =&gt; x -&gt; x -&gt; Stuff x -&gt; Stuff x\nfoo a b (Stuff c) = Stuff (Map.insert (a b c))\n</code></pre>\n\n<p>I get an error:</p>\n\n<pre><code>Couldn't match expected type \u2018Map.Map x [x]\u2019\n            with actual type \u2018a0 -&gt; Map.Map k0 a0 -&gt; Map.Map k0 a0\u2019\n</code></pre>\n\n<p>However, when I verify the signature in the Haskell docs:</p>\n\n<blockquote>\n  <p>insert :: Ord k => k -> a -> Map k a -> Map k a</p>\n</blockquote>\n\n<p>If it's returning a \"Map k a\", can't type \"a\" be a list? How could I turn \"a\" into \"[a]\"?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1518629384, "post_id": 48793018, "comment_id": 84588177, "body": "I think you&#39;re going to need to give more context about what you&#39;re asking about. What doesn&#39;t work?"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1518629943, "post_id": 48793018, "comment_id": 84588439, "body": "It works, but if I put <code>densityTrimorficos 10</code> doesn&#39;t do anything. But if you compile, it doesn&#39;t recognize a error"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518630656, "post_id": 48793018, "comment_id": 84588798, "body": "@mathandtic: well there is no error in a slow function. But what Carcigenicate means is that you should explain what the function is supposed to do. What problem does it aim to solve?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1518630913, "post_id": 48793018, "comment_id": 84588931, "body": "Related: <a href=\"https://stackoverflow.com/q/35958831/2751851\"><i>infinite lists, lazy evaluation and length</i></a>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1518630992, "post_id": 48793018, "comment_id": 84588972, "body": "Shouldn&#39;t <code>filter</code> be replaced with <code>takeWhile</code>, since <code>trimorficos</code> only increases."}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518631206, "post_id": 48793018, "comment_id": 84589080, "body": "the density of trimorphs up to n, in other words, trimorphs up to n <code>div</code> n"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1518634698, "creation_date": 1518634698, "answer_id": 48794359, "question_id": 48793018, "link": "https://stackoverflow.com/questions/48793018/haskell-efficient-program/48794359#48794359", "title": "Haskell Efficient Program", "body": "<p><code>trimorficos</code> is an infinite list.</p>\n\n<p><code>filter (&lt;=10) trimorficos</code> will never produce the end-of-list <code>[]</code> at the very end. To do so, it should verify that, from a certain point onward, <code>trimorficos</code> contains only numbers >10, but that would require infinite time.\nBasically, <code>filter</code> will returns something like <code>a:b:c:nonTerminating</code> instead of <code>a:b:c:[] = [a,b,c]</code>.</p>\n\n<p>Consequently, <code>genericLength</code> fails to terminate, since it tries to evaluate <code>nonTerminating</code> into either <code>d:...</code> or <code>[]</code> but that requires infinite time.</p>\n\n<p>As pointed out above in the comments, you probably want <code>takeWhile (&lt;=10) trimorficos</code> instead, which will produce <code>[]</code> as soon as the first >10 number is encountered. Note that this will not check the rest of the list, unlike <code>filter</code>.</p>\n"}], "owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518634698, "creation_date": 1518629326, "question_id": 48793018, "link": "https://stackoverflow.com/questions/48793018/haskell-efficient-program", "title": "Haskell Efficient Program", "body": "<p>I have this code:</p>\n\n<pre><code>trimorficos :: [Integer]\ntrimorficos = filter (trim) [0..]\n\ntrim :: Integer -&gt; Bool\ntrim x = (show x) `isSuffixOf` (show (x^3))\n      where a = show x\n            b = show (x^3)\n\ndensityTrimorficos :: Integer -&gt; Double\ndensityTrimorficos n = fromInteger (n - (genericLength (filter (&lt;=10) trimorficos))) / fromInteger n\n</code></pre>\n\n<p>Why the last function  <code>densityTrimorficos</code> doesn't work?</p>\n"}, {"tags": ["haskell", "types", "typechecking", "dependent-type"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1518629585, "post_id": 48791549, "comment_id": 84588261, "body": "&quot;Can I be certain that these two definitions are equivalent in all regards, or are there corner cases?&quot; A type checker like Haskell&#39;s is concerned with <i>definitional equality</i> - &quot;do these two types match syntactically&quot;? Often the way you set up your specifications has an impact on how easy or difficult it is to write code which implements those specifications. Try writing &quot;<code>++</code>-on-vectors&quot; using your second definition of <code>+</code>."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1518668284, "post_id": 48791549, "comment_id": 84602512, "body": "@BenjaminHodgson Like this one? <code>data V (n :: Nat) i = V [i] deriving Show; (%%) :: V n i -&gt; V m i -&gt; V (n + m) i; (V xs) %% (V ys) = V (xs ++ ys)</code> I think it works."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1518692632, "post_id": 48791549, "comment_id": 84614046, "body": "With that definition you have no guarantee that the vector in question is in fact the length it says it is. See @KABuhr\u2019s answer"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1518701915, "post_id": 48791549, "comment_id": 84620221, "body": "@BenjaminHodgson How is it that I haven&#39;t if I clearly said <code>... -&gt; V (n + m)</code> ?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1518702886, "post_id": 48791549, "comment_id": 84620927, "body": "That function would type check even if you gave it a return type of <code>V (Succ m) i</code> or <code>V (n * m) i</code> or <code>V Zero i</code>. No guarantees about the length"}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1518628466, "post_id": 48792410, "comment_id": 84587710, "body": "What you&#39;re saying is that the second definition is preferable because it is &quot;more definite&quot; or &quot;more specific&quot; in cases where <code>n</code> is not &quot;ground&quot;? Also, can you put a definition of &quot;ground&quot; types somewhere in the answer? It is kind of obvious but still I think it&#39;s better to write down that <code>Succ</code> and <code>Zero</code> are &quot;ground&quot; while <code>a</code> is not because it can be some other, unrelated type constructor. (Can it? That would mean there are other type constructors of kind <code>Nat</code> that the function does not cover, but it is not possible as <code>Nat</code>&#39;s definition is closed?)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1518629026, "post_id": 48792410, "comment_id": 84588006, "body": "@Kindaro In computer science, a &quot;ground&quot; term (or expression) is simply one without free type variables (like <code>a</code>). So, <code>Zero, Succ Zero, Succ (Succ Zero), ...</code> are all the ground type-terms of kind <code>Nat</code>. Instead, <code>n + Zero</code> is not ground. It is generally hard to state which definition is preferable -- it depends on how they will be used. Above, I only show they are not equivalent, in general."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1518655614, "post_id": 48792410, "comment_id": 84599689, "body": "Typically a type family definition whose RHS is constructor-headed is better than one which is not. This is simply because GHC knows many things about constructors (like they are injective and generative) but knows nothing about type families (except how to evaluate them, so if a type family application is stuck, then GHC knows nothing about it)."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1518685663, "last_edit_date": 1518685663, "creation_date": 1518627283, "answer_id": 48792410, "question_id": 48791549, "link": "https://stackoverflow.com/questions/48791549/is-there-any-practical-difference-between-these-two-definitions-of-type-level-pe/48792410#48792410", "title": "Is there any practical difference between these two definitions of type-level Peano Natural number summation?", "body": "<p>Suppose</p>\n\n<pre><code>foo :: T (Succ n) -&gt; Bool\nbar :: T n -&gt; T m -&gt; T (n + m)\n</code></pre>\n\n<p>Then,</p>\n\n<pre><code>baz :: T (Succ a) -&gt; String\nbaz x | foo (bar x x) = \"A\"\n      | otherwise     = \"B\"\n</code></pre>\n\n<p>will only type-check if <code>+</code> was defined using</p>\n\n<pre><code>Succ n + m = Succ (n + m)\n</code></pre>\n\n<p>If instead we used</p>\n\n<pre><code>Succ n + m = n + Succ m\n</code></pre>\n\n<p>then, during the type-checking of <code>baz</code>, we would discover that <code>bar x x :: a + Succ (Succ a)</code>, but that is not of the right form to be an argument of <code>foo</code>.</p>\n\n<p>Summing up: it not enough to think about \"<a href=\"https://en.wikipedia.org/wiki/Ground_expression\" rel=\"nofollow noreferrer\">ground</a>\" <code>Nat</code> types. During type checking we also meet with type expressions with free type variables (i.e., non ground) like <code>Succ a + Succ a</code>, which will be simplified according to the equational rules. We need rules that work on such cases, too.</p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1518672214, "creation_date": 1518672214, "answer_id": 48800424, "question_id": 48791549, "link": "https://stackoverflow.com/questions/48791549/is-there-any-practical-difference-between-these-two-definitions-of-type-level-pe/48800424#48800424", "title": "Is there any practical difference between these two definitions of type-level Peano Natural number summation?", "body": "<p>As others have noted, the two definitions are not equivalent.  Neither is particularly more general than the other, and it would be a stretch to argue that one or the other was clearly superior.</p>\n\n<p>As @Benjamin Hodgson notes, the choice of definition affects the ease with which you can write code, but I'd add that typically each choice will make some code easier and other code harder.</p>\n\n<p>Here's a concrete example.  Suppose you have a vector type:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n\ndata Nat = Zero | Succ Nat\n\n-- A vector type\ndata Vec n a where\n  V0 :: Vec Zero a\n  (:&gt;) :: a -&gt; Vec n a -&gt; Vec (Succ n) a\ninfixr 5 :&gt;\n</code></pre>\n\n<p>and let's start by working with the \"nice\" version of <code>(+)</code>, the one that doesn't require undecidable instances.  Note that I've switched the order of <code>m</code> and <code>n</code> because I get confused otherwise:</p>\n\n<pre><code>type family m + n where\n  Zero + m = m\n  Succ m + n = Succ (m + n)\n</code></pre>\n\n<p>If we try to implement a <code>(++)</code> for vectors, we find it's straightforward:</p>\n\n<pre><code>vappend :: Vec m a -&gt; Vec n a -&gt; Vec (m + n) a\nvappend V0 ys = ys\nvappend (x :&gt; xs) ys = x :&gt; vappend xs ys\n</code></pre>\n\n<p>On the other hand, consider the following list function:</p>\n\n<pre><code>rev :: [a] -&gt; [a] -&gt; [a]\nrev ys [] = ys\nrev ys (x:xs) = rev (x:ys) xs\n</code></pre>\n\n<p>which might be used to define a version of <code>reverse</code>:</p>\n\n<pre><code>reverse' = rev []\n</code></pre>\n\n<p>If we try to implement <code>vrev</code>, we run into trouble:</p>\n\n<pre><code>vrev :: Vec m a -&gt; Vec n a -&gt; Vec (n + m) a\nvrev ys V0 = ys\nvrev ys (x :&gt; xs) = vrev (x :&gt; ys) xs\n</code></pre>\n\n<p>The first case type-checks okay, but the second fails with the complaint that GHC can't deduce:</p>\n\n<pre><code>(n1 + 'Succ m) ~ 'Succ (n1 + m)\n</code></pre>\n\n<p>even though this statement is \"obviously\" true.</p>\n\n<p>Replacing <code>n + m</code> with <code>m + n</code> in the signature makes things worse -- neither case will type-check.</p>\n\n<p>On the other hand, if you replace the <code>+</code> definition with the undecidable version:</p>\n\n<pre><code>Succ m + n = m + Succ n\n</code></pre>\n\n<p>you'll find that <code>vrev</code> type-checks fine while <code>vappend</code> doesn't!</p>\n\n<p>So, what's the solution?  Well, typically people choose a definition that seems the most convenient in the most number of cases and then use various techniques to handle the \"hard\" cases.  If you choose the:</p>\n\n<pre><code>Succ m + n = Succ (m + n)\n</code></pre>\n\n<p>definition, you'll be in good company.  That's the one used in the <a href=\"http://homepages.inf.ed.ac.uk/slindley/papers/hasochism.pdf\" rel=\"nofollow noreferrer\">Hasochism paper</a> and the <code>singletons-nats</code> package, for example.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1518685663, "creation_date": 1518624601, "question_id": 48791549, "link": "https://stackoverflow.com/questions/48791549/is-there-any-practical-difference-between-these-two-definitions-of-type-level-pe", "title": "Is there any practical difference between these two definitions of type-level Peano Natural number summation?", "body": "<p>I'm new to type level programming, and I am facing inability to reason about even very simple type level programs.</p>\n\n<p>I have this code:</p>\n\n<pre><code>data Nat = Zero | Succ Nat\n\ntype family n + m where\n    Zero + m = m  -- This is the base case of my type level recursive function.\n</code></pre>\n\n<p>Now, I have two variants of going about recursive case, and only one of them typechecks without <code>UndecidableInstances</code>:</p>\n\n<pre><code>    Succ n + m = n + Succ m  -- Typechecks with UndecidableInstances.\n\n    Succ n + m = Succ (n + m)  -- Typechecks without UndecidableInstances.\n</code></pre>\n\n<p>I understand that <code>UndecidableInstances</code> allow me to use general recursion on type level, rather than structural recursion alone, which would guarantee typechecker termination. But in actuality both definitions seem to compile equally well, and give sane types when verified with <code>:kind!</code> in repl, for small numbers.</p>\n\n<p>Can I be certain that these two definitions are equivalent in all regards, or are there corner cases? Should I test these implementations of <code>+</code> against each other, or use some theory?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1518624555, "post_id": 48791515, "comment_id": 84585030, "body": "No, the pattern match matches a <i>cons</i> list object. Furthermore for infinite lists, that would be completely impossible anyway."}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1518625527, "post_id": 48791695, "comment_id": 84585750, "body": "You might want to add that <code>unsnoc</code> means &quot;get the last element&quot;, that&#39;s not particularly obvious to a non-native speaker or someone who isn&#39;t familiar with the terminology (uncons is already bad enough, inverting the cons makes it quite difficult to parse)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1518626906, "post_id": 48791695, "comment_id": 84586736, "body": "@Cubic Good idea. I&#39;ve edited to reduce the answer&#39;s reliance on jargon."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1518626887, "last_edit_date": 1518626887, "creation_date": 1518625041, "answer_id": 48791695, "question_id": 48791515, "link": "https://stackoverflow.com/questions/48791515/can-we-read-a-list-as-it-was-inverted-in-haskell/48791695#48791695", "title": "Can we read a list as it was inverted in Haskell?", "body": "<p>When using lists, no: reading from the end of a list efficiently requires reversing the list or something analogous. However, not all data structures are so picky. <a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Sequence.html#t:Seq\" rel=\"nofollow noreferrer\">Data.Sequence</a> offers a type which, like lists, offers O(1) element insertion at the front (though this O(1) is amortized O(1), meaning any particular insertion can be arbitrarily expensive but averaging across many insertions gives very predictable performance), but unlike lists also offers (amortized) O(1) viewing and removal at the back.</p>\n"}], "owner": {"reputation": 683, "user_id": 6317571, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a00fafb7b33701cf164a53531a1231d1?s=128&d=identicon&r=PG&f=1", "display_name": "elena", "link": "https://stackoverflow.com/users/6317571/elena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 48791695, "answer_count": 1, "score": 0, "last_activity_date": 1518626887, "creation_date": 1518624484, "question_id": 48791515, "link": "https://stackoverflow.com/questions/48791515/can-we-read-a-list-as-it-was-inverted-in-haskell", "title": "Can we read a list as it was inverted in Haskell?", "body": "<p>In Haskell, when we pass a list to a function we can read its elements one by one as in the following case: </p>\n\n<pre><code>check_acceptance :: Automaton -&gt; Int -&gt; [Char] -&gt; Bool\ncheck_acceptance a i (cs:c) = get_next_state c new_state (transitions a) where new_state = get_next_state cs i (transitions a)  \n</code></pre>\n\n<p>Would it be possible to read it as it was inverted (but actually avoiding to invert it) by doing: </p>\n\n<pre><code>check_acceptance a i (c:cs) = ...\n</code></pre>\n\n<p>Thank you very much for your help!</p>\n"}, {"tags": ["haskell", "ghc", "type-families", "injective-function"], "answers": [{"comments": [{"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1518630582, "post_id": 48793155, "comment_id": 84588757, "body": "How would I match on the structure of <code>func</code> that way?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1518631278, "post_id": 48793155, "comment_id": 84589122, "body": "I added instances to my answer."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1518631486, "post_id": 48793155, "comment_id": 84589221, "body": "Ah, thanks. Actually, there&#39;s <a href=\"https://github.com/sgraf812/datafix/blob/66a5236791c81249c0e5dd8c682d9a3013d2163b/src/Datafix/Utils/TypeLevel.hs#L136\" rel=\"nofollow noreferrer\">one more case</a> I&#39;d like to optimize for. Is that still possible that way? I imagine that leads to three tiers of overlaps.  Anyway, the axiom approach works just fine, too."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1518631877, "post_id": 48793155, "comment_id": 84589411, "body": "Hmm.. come to think of it, I&#39;m not sure if can really use <code>Currying func</code> in my code, because I do stuff like <a href=\"https://github.com/sgraf812/datafix/blob/66a5236791c81249c0e5dd8c682d9a3013d2163b/src/Datafix/Description.hs#L83\" rel=\"nofollow noreferrer\">this</a>, where I return non-<code>Base</code> types and the selected <code>Currying</code> would not <a href=\"https://github.com/sgraf812/datafix/blob/66a5236791c81249c0e5dd8c682d9a3013d2163b/src/Datafix/Description.hs#L234\" rel=\"nofollow noreferrer\">do the right thing here</a>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1518632732, "post_id": 48793155, "comment_id": 84589875, "body": "For the three-case situation, you can define three instances <code>(IsBase b ~ &#39;True) =&gt; Currying b</code>, <code>(IsBase b ~ &#39;True) =&gt; Currying (a -&gt; b)</code>, <code>Currying (a2 -&gt; b) =&gt; Currying (a1 -&gt; a2 -&gt; b)</code>."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1518632833, "post_id": 48793155, "comment_id": 84589920, "body": "Exactly, but I&#39;m not sure which instance should overlap which."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 1, "creation_date": 1518633162, "post_id": 48793155, "comment_id": 84590064, "body": "The first two should be <code>OVERLAPPABLE</code>. <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#instance-overlap\" rel=\"nofollow noreferrer\">This chapter of the GHC manual</a> explains how these pragmas affect the selection algorithm. There are different combinations that also work, but  <code>OVERLAPPABLE</code> is almost always sufficient in my experience."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1518633216, "post_id": 48793155, "comment_id": 84590095, "body": "Great. Thank you!"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1518633697, "post_id": 48793155, "comment_id": 84590342, "body": "As for the more general problem, I don&#39;t see a good way to extend my approach (having considered 1) indexing <code>Currying</code> by the number of arguments to take, 2) matching on the desired result type). I guess it depends on what information is more readily available. The simplest solution with the original class may be to just let the type equality float into the toplevel constraints."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1518632607, "last_edit_date": 1518632607, "creation_date": 1518629819, "answer_id": 48793155, "question_id": 48791117, "link": "https://stackoverflow.com/questions/48791117/how-to-help-ghc-infer-that-arrows-domains-func-codomain-func-func/48793155#48793155", "title": "How to help GHC infer that `Arrows (Domains func) (CoDomain func) ~ func`", "body": "<p>Would it be better for you to change <code>Currying</code> to be indexed by <code>func</code>?</p>\n\n<pre><code>class Currying func where\n  curries :: (Products (Domains func) -&gt; CoDomain func) -&gt; func\n  uncurries :: func -&gt; Products (Domains func) -&gt; CoDomain func\n\ninstance Currying b =&gt; Currying (a -&gt; b) where\n  curries f a = curries (f . (,) a)\n  uncurries f (a, as) = uncurries (f a) as\n\ninstance {-# OVERLAPPABLE #-} (IsBase b ~ 'True) =&gt; Currying b where\n  curries f = f ()\n  uncurries b _ = b\n</code></pre>\n\n<hr>\n\n<p>We can also assert axioms in this way, though I'm not even sure this one is safe:</p>\n\n<pre><code>arrowAxiom :: forall func. func :~: Arrows (Domains func) (CoDomain func)\narrowAxiom = unsafeCoerce Refl\n</code></pre>\n\n<p>The equality can be put in scope by pattern matching on the axiom.</p>\n"}], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 48793155, "answer_count": 1, "score": 0, "last_activity_date": 1518632607, "creation_date": 1518623285, "question_id": 48791117, "link": "https://stackoverflow.com/questions/48791117/how-to-help-ghc-infer-that-arrows-domains-func-codomain-func-func", "title": "How to help GHC infer that `Arrows (Domains func) (CoDomain func) ~ func`", "body": "<p>Consider the <code>Arrows</code>, <code>Domains</code> and <code>CoDomain</code> type-families defined <a href=\"https://github.com/agda/agda/blob/master/src/full/Agda/Utils/TypeLevel.hs#L72-L93\" rel=\"nofollow noreferrer\">in the <code>agda</code> codebase</a>.</p>\n\n<p>Obvious to the programmer, it holds that <code>Arrows (Domains func) (CoDomain func) ~ func</code>. But I can't get <code>curries (Proxy :: Proxy (Domains func)) (Proxy :: Proxy (CoDomain func)) undefined :: func</code> through GHC's type-checker. That's because GHC isn't smart enough to infer that the combination of <code>Domains</code> and <code>CoDomain</code> is injective. Is there a way to teach GHC nonetheless? I'd imagine some case split over the <code>IsBase</code> predicate.</p>\n"}, {"tags": ["haskell", "io", "file-copying"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518614004, "post_id": 48788028, "comment_id": 84577748, "body": "You override it, by specifying your own <code>copyFile</code>, it should be <code>main</code>. But even then, the result of <code>copyFile</code> is not the content, the type is <code>FilePath -&gt; FilePath -&gt; IO ()</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1518614271, "post_id": 48788135, "comment_id": 84577922, "body": "I.e. if you were to write <code>printLn (show contents)</code> on the next line (assuming the type returned by copyFile derives from show) you would get rid of this error as the function would now conform to the expected type <code>IO</code>."}], "tags": [], "owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "is_accepted": false, "score": 1, "last_activity_date": 1518614040, "creation_date": 1518614040, "answer_id": 48788135, "question_id": 48788028, "link": "https://stackoverflow.com/questions/48788028/haskell-copying-a-file/48788135#48788135", "title": "Haskell: Copying a file", "body": "<p>Firstly, you're not actually using c_name.</p>\n\n<p>Secondly, your issue is caused by the last line: <code>contents &lt;- copyFile name</code> is equivelant to <code>copyFile name &gt;&gt;= \\contents -&gt;</code> which is using the monadic bind operation to pipe the result of <code>copyFile name</code> to another function. You don't actually do anything with the result and therefore it's not a complete expression. </p>\n"}, {"comments": [{"owner": {"reputation": 19, "user_id": 8863334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab38d2ef8fd5564b21653289447123bc?s=128&d=identicon&r=PG&f=1", "display_name": "Nasser", "link": "https://stackoverflow.com/users/8863334/nasser"}, "edited": false, "score": 0, "creation_date": 1518634155, "post_id": 48788177, "comment_id": 84590589, "body": "Oh yes I see that I have used &quot;copyFile&quot; in a wrong way and I forget that it needs two parameters. Thanks for the clarification and help."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1518614195, "creation_date": 1518614195, "answer_id": 48788177, "question_id": 48788028, "link": "https://stackoverflow.com/questions/48788028/haskell-copying-a-file/48788177#48788177", "title": "Haskell: Copying a file", "body": "<p>You <em>define</em> a <code>copyFile</code> function, and then call the <code>copyFile</code> function (of <code>System.Directory</code> I assume?). So Haskell thinks you make a recursive call. We can thus rename the function to <code>main</code>.</p>\n\n<p>But this will not fully solve the problem. <a href=\"http://hackage.haskell.org/package/directory-1.3.2.0/docs/System-Directory.html#v:copyFile\" rel=\"nofollow noreferrer\"><strong><code>copyFile :: FilePath -&gt; FilePath -&gt; IO ()</code></strong></a> is a function that takes two <code>FilePath</code>s, and then copies it from the source to the destionation, so writing <code>contents &lt;- copyFile name</code> is rather weird, since (1) it lacks a second parameter; and (2) the result is a <code>()</code>, so `contents has no sense here.</p>\n\n<p>So we can fix it by writing:</p>\n\n<pre><code><b>import System.Directory(copyFile)</b>\n\n<b>main</b> :: IO ()\n<b>main</b> = do \n    putStr \"Enter the filename:\" \n    name &lt;- getLine \n    putStr \"Enter the copy name:\" \n    c_name &lt;- getLine\n    <b>copyFile name c_name</b></code></pre>\n"}], "owner": {"reputation": 19, "user_id": 8863334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab38d2ef8fd5564b21653289447123bc?s=128&d=identicon&r=PG&f=1", "display_name": "Nasser", "link": "https://stackoverflow.com/users/8863334/nasser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 828, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1518652849, "creation_date": 1518613695, "last_edit_date": 1518652849, "question_id": 48788028, "link": "https://stackoverflow.com/questions/48788028/haskell-copying-a-file", "title": "Haskell: Copying a file", "body": "<p>I am trying to make a haskell program using I/O that prompts the user the filename and the name of the copy. This is my current code: </p>\n\n<pre><code>copyFile :: IO ()\ncopyFile = do \n putStr \"Enter the filename:\" \n name &lt;- getLine \n putStr \"Enter the copy name:\" \n c_name &lt;- getLine\n contents &lt;- copyFile name\n</code></pre>\n\n<p>But I am getting this error: </p>\n\n<pre><code> The last statement in a 'do' block must be an expression\n  contents &lt;- copyFile name\n    |\n 73 |  contents &lt;- copyFile name \n    |  ^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Any help please on what I did wrong and how to fix it?</p>\n"}, {"tags": ["haskell", "formal-verification", "equivalence", "lava"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1518613878, "post_id": 48787300, "comment_id": 84577667, "body": "There&#39;s no good way to fix the first error; indeed, a <code>[Bit]</code> is not finite. You&#39;ll have to rethink your approach. The second error is easier; define an instance <code>Fresh a =&gt; Fresh [a]</code>"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1533177126, "post_id": 48787300, "comment_id": 90253440, "body": "Can you tighten the type of <code>circuit1</code> and <code>circuit2</code> to express the fact that they both require 64 <code>Bit</code>s of input, not an arbitrary number? E.g. using <a href=\"https://hackage.haskell.org/package/vector-sized\" rel=\"nofollow noreferrer\"><code>vector-sized</code></a>? Then it shouldn&#39;t be too difficult to make an <code>instance (Finite a, KnownNat n) =&gt; Finite (Vector n a)</code>."}, {"owner": {"reputation": 101, "user_id": 4911399, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jEpYo.jpg?s=128&g=1", "display_name": "Balkis", "link": "https://stackoverflow.com/users/4911399/balkis"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1542269836, "post_id": 48787300, "comment_id": 93510186, "body": "@Cactus yes that&#39; what I am trying to do, as I am not familier with Haskell, I couln&#39;t figure out what was the problem when I use vector.sized. Thank you for your response."}], "owner": {"reputation": 101, "user_id": 4911399, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jEpYo.jpg?s=128&g=1", "display_name": "Balkis", "link": "https://stackoverflow.com/users/4911399/balkis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1533176827, "creation_date": 1518611465, "last_edit_date": 1533176827, "question_id": 48787300, "link": "https://stackoverflow.com/questions/48787300/equivalence-verification-using-lava", "title": "Equivalence verification using Lava", "body": "<p>I've been trying to verify equivalence property between two circuits in Chalmers Lava. I have declared a type bit:</p>\n\n<pre><code>type Bit = Signal Bool   \n</code></pre>\n\n<p>And I have two circuits each has a list of bits as input and a tuple of lists of bits, and a function that checks their equivalence:</p>\n\n<pre><code>circuit1:: [Bit] -&gt;([Bit],[Bit])\ncircuit2:: [Bit] -&gt;([Bit],[Bit])\npropEquiv input = ok\n    where \n        out1 = circuit1 input \n        out2 = circuit2 input \n        ok = out1 &lt;==&gt; out2 \n</code></pre>\n\n<p>These two circuits take inputs as lists of 64 elements. \nI was able to simulate them with one input using simulate, ans simulate them with multiple using simulateSeq, but for the hole domain i wasn't able and I got this error: </p>\n\n<pre><code>&lt;interactive&gt;:7:20:\n    No instance for (Finite [Bit]) arising from a use of `domain'\n    In the second argument of `simulateSeq', namely `domain'\n    In the expression: simulateSeq ipSpec domain\n    In an equation for `it': it = simulateSeq ipSpec domain\n</code></pre>\n\n<p>(in line 7 i have the type declaration)</p>\n\n<p>Also for the propEquiv, I can simulate it, but I couldn't verify it using satzoo, and i got this error: </p>\n\n<pre><code>*Main&gt; satzoo propEquiv \n&lt;interactive&gt;:9:1:\n    No instance for (Fresh [Bit]) arising from a use of `satzoo'\n    In the expression: satzoo propEquiv\n    In an equation for `it': it = satzoo propEquiv\n*Main&gt; \n</code></pre>\n\n<p>I counldn't understand both of them neither find anything when searching on the web, can someone help me with this? i tried to define the circuits with 64 elemnts in stand of a list , but it didn't work. </p>\n\n<p>Regards.</p>\n"}, {"tags": ["list", "haskell", "stream", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1518613446, "post_id": 48787082, "comment_id": 84577408, "body": "It models infinite computations in which you can observe individual steps of the computation."}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 2, "creation_date": 1518616267, "post_id": 48787412, "comment_id": 84579276, "body": "Can you elaborate a bit? It&#39;s hard for me to understand how exactly do you see <code>ask&#39; :: a</code> defined here."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 3, "creation_date": 1518618822, "post_id": 48787412, "comment_id": 84581097, "body": "The <code>Reader</code> is another name for the type of functions (I should have said that from the start): <code>type Reader r a = r -&gt; a</code>. I added an explanation of what it means for these types to be isomorphic."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 14, "last_activity_date": 1557612283, "last_edit_date": 1557612283, "creation_date": 1518611818, "answer_id": 48787412, "question_id": 48787082, "link": "https://stackoverflow.com/questions/48787082/what-effects-are-modeled-by-the-stream-infinite-list-monad/48787412#48787412", "title": "What effects are modeled by the stream (infinite list) monad?", "body": "<p>The <code>Stream</code> monad is isomorphic to <code>Reader Natural</code> (<code>Natural</code>: natural numbers), meaning that there is a bijection between <code>Stream</code> and <code>Reader Natural</code> which preserves their monadic structure.</p>\n\n<h3>Intuitively</h3>\n\n<p>Both <code>Stream a</code> and <code>Reader Natural a</code> (<code>Natural -&gt; a</code>) can be seen as representing infinite collections of <code>a</code> indexed by integers.</p>\n\n<pre><code>fStream = Cons a0 (Cons a1 (Cons a2 ...))\n\nfReader = \\i -&gt; case i of\n  0 -&gt; a0\n  1 -&gt; a1\n  2 -&gt; a2\n  ...\n</code></pre>\n\n<p>Their <code>Applicative</code> and <code>Monad</code> instances both compose elements index-wise. It's easier to show the intuition for <code>Applicative</code>. Below, we show a stream <code>A</code> of <code>a0, a1, ...</code>, and <code>B</code> of <code>b0, b1, ...</code>, and their composition <code>AB = liftA2 (+) A B</code>, and an equivalent presentation of functions.</p>\n\n<pre><code>fStreamA  = Cons  a0     (Cons  a1     ...)\nfStreamB  = Cons     b0  (Cons     b1  ...)\nfStreamAB = Cons (a0+b0) (Cons (a1+b1) ...)\nfStreamAB = liftA2 (+) fStreamA fStreamB\n\n-- lambda case \"\\case\" is sugar for \"\\x -&gt; case x of\"\nfReaderA = \\case 0 -&gt; a0    ; 1 -&gt; a1    ; ...\nfReaderB = \\case 0 -&gt;    b0 ; 1 -&gt; b1    ; ...\nfReaderC = \\case 0 -&gt; a0+b0 ; 1 -&gt; a1+b1 ; ...\nfReaderC = liftA2 (+) fReaderA fReaderB = \\i -&gt; fReaderA i + fReaderB i\n</code></pre>\n\n<h3>Formally</h3>\n\n<p>The bijection:</p>\n\n<pre><code>import Numeric.Natural  -- in the base library\n\n-- It could also be Integer, there is a bijection Integer &lt;-&gt; Natural\ntype ReaderN a = Natural -&gt; a\n\ntailReader :: ReaderN a -&gt; ReaderN a\ntailReader r = \\i -&gt; r (i+1)\n\ntoStream :: ReaderN a -&gt; Stream a\ntoStream r = Cons (r 0) (toStream (tailReader r))\n\nfromStream :: Stream a -&gt; ReaderN a\nfromStream (Cons a s) = \\i -&gt; case i of\n  0 -&gt; a\n  i -&gt; fromStream s (i-1)\n</code></pre>\n\n<p><code>toStream</code> and <code>fromStream</code> are bijections, meaning that they satisfy these equations:</p>\n\n<pre><code>toStream (fromStream s) = s :: Stream a\nfromStream (toStream r) = r :: ReaderN a\n</code></pre>\n\n<p>\"Isomorphism\" is a general notion; two things being isomorphic usually means that there is a bijection satisfying certain equations, which depend on the structure or interface being considered. In this case, we are talking about the structure of monads, and we say that two monads are isomorphic if there is a bijection which satisfies these equations:</p>\n\n<pre><code>toStream (return a) = return a\ntoStream (u &gt;&gt;= k) = toStream u &gt;&gt;= (toStream . k)\n</code></pre>\n\n<p>The idea is that we get the same result whether we apply the functions <code>return</code> and <code>(&gt;&gt;=)</code> \"before or after\" the bijection. (The similar equations using <code>fromStream</code> can then be derived from these two equations and the other two above).</p>\n"}, {"comments": [{"owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "edited": false, "score": 1, "creation_date": 1518690232, "post_id": 48792806, "comment_id": 84612430, "body": "I&#39;ve found your observation that the <code>Monad</code> and <code>Applicative</code> instances of the <code>Stream</code> are similar in power very enlightening. Thank you!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1557683505, "post_id": 48792806, "comment_id": 98838419, "body": "re your &quot;the Applicative instance appl[ies] a sequence of <i>given</i> functions [emphasis mine] to a sequence of values&quot;, but what about <code>xs = liftA2 (+) (Cons 0 (Cons 1 xs)) (Cons 1 xs)</code>? there&#39;s no (fully) given functions there, i.e. though Applicative it is an essentially <i>sequential</i> computation. maybe what&#39;s a &quot;fully given function&quot; can be debated but the essentially sequential nature of that computation I think is totally self-evident. (see <a href=\"https://stackoverflow.com/a/11951590/849891\">this</a> for the background). could you clarify?"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 3, "last_activity_date": 1518629094, "last_edit_date": 1518629094, "creation_date": 1518628512, "answer_id": 48792806, "question_id": 48787082, "link": "https://stackoverflow.com/questions/48787082/what-effects-are-modeled-by-the-stream-infinite-list-monad/48792806#48792806", "title": "What effects are modeled by the stream (infinite list) monad?", "body": "<p>@Li-yao Xia's answer pretty much covers it, but if it helps your intuition, think of the <code>Stream</code> monad as modeling an infinite sequence of parallel computations.   A <code>Stream</code> value itself is an (infinite) sequence of values, and I can use the <code>Functor</code> instance to apply the same function in parallel to all values in the sequence; the <code>Applicative</code> instance to apply a <em>sequence</em> of given functions to a sequence of values, pointwise with each function applied to the corresponding value; and the <code>Monad</code> instance to apply a computation to each value in the sequence with a result that can depend on both the value and its position within the sequence.</p>\n\n<p>As an example of some typical operations, here are some sample sequences plus a Show-instance</p>\n\n<pre><code>instance (Show a) =&gt; Show (Stream a) where\n  show = show . take 10 . toList\nnat = go 1 where go x = Cons x (go (x+1))\nodds = go 1 where go x = Cons x (go (x+2))\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>&gt; odds\n[1,3,5,7,9,11,13,15,17,19]\n&gt; -- apply same function to all values\n&gt; let evens = fmap (1+) odds\n&gt; evens\n[2,4,6,8,10,12,14,16,18,20]\n&gt; -- pointwise application of functions to values\n&gt; (+) &lt;$&gt; odds &lt;*&gt; evens\n[3,7,11,15,19,23,27,31,35,39]\n&gt; -- computation that depends on value and structure (position)\n&gt; odds &gt;&gt;= \\val -&gt; fmap (\\pos -&gt; (pos,val)) nat\n[(1,1),(2,3),(3,5),(4,7),(5,9),(6,11),(7,13),(8,15),(9,17),(10,19)]\n&gt; \n</code></pre>\n\n<p>The difference between the <code>Applicative</code> and <code>Monad</code>ic computations here is similar to other monads:  the applicative operations have a static structure, in the sense that each result in <code>a &lt;*&gt; b</code> depends only on the values of the corresponding elements in <code>a</code> and <code>b</code> independent of how they fit in to the larger structure (i.e., their positions in the sequence); in contrast, the monadic operations can have a structure that depends on the underlying values, so that in the expression <code>as &gt;&gt;= f</code>, for a given value <code>a</code> in <code>as</code>, the corresponding result can depend both on the specific value <code>a</code> and structurally on its position within the sequence (since this will determine which element of the sequence <code>f a</code> will provide the result).</p>\n\n<p>It turns out that in this case the apparent additional generality of monadic computations doesn't translate into any <em>actual</em> additional generality, as you can see by the fact that the last example above is equivalent to the purely applicative operation:</p>\n\n<pre><code>(,) &lt;$&gt; nat &lt;*&gt; odds\n</code></pre>\n\n<p>More generally, given a monadic action <code>f :: a -&gt; Stream b</code>, it will always be possible to write it as:</p>\n\n<pre><code>f a = Cons (f1 a) (Cons (f2 a) ...))\n</code></pre>\n\n<p>for appropriately defined <code>f1 :: a -&gt; b</code>, <code>f2 :: a -&gt; b</code>, etc., after which we'll be able to express the monadic action as an application action:</p>\n\n<pre><code>as &gt;&gt;= f = (Cons f1 (Cons f2 ...)) &lt;*&gt; as\n</code></pre>\n\n<p>Contrast this with what happens in the <code>List</code> monad:  Given <code>f :: a -&gt; List b</code>, <strong>if</strong> we could write:</p>\n\n<pre><code>f a = [f1 a, f2 a, ..., fn a]\n</code></pre>\n\n<p>(meaning in particular that the number of elements in the result would be determined by <code>f</code> alone, regardless of the value of <code>a</code>), then we'd have the same situation:</p>\n\n<pre><code>as &gt;&gt;= f = as &lt;**&gt; [f1,...,fn]\n</code></pre>\n\n<p>and every monadic list operation would be a fundamentally applicative operation.</p>\n\n<p>So, the fact that not all finite lists are the same length makes the <code>List</code> monad more powerful than its applicative, but because all (infinite) sequences <em>are</em> the same length, the <code>Stream</code> monad adds nothing over the applicative instance.</p>\n"}], "owner": {"reputation": 938, "user_id": 474311, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aad241f867909f119502ffbff53849af?s=128&d=identicon&r=PG", "display_name": "Dan Onea\u021b\u0103", "link": "https://stackoverflow.com/users/474311/dan-onea%c8%9b%c4%83"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 1, "accepted_answer_id": 48787412, "answer_count": 2, "score": 9, "last_activity_date": 1557612283, "creation_date": 1518610789, "question_id": 48787082, "link": "https://stackoverflow.com/questions/48787082/what-effects-are-modeled-by-the-stream-infinite-list-monad", "title": "What effects are modeled by the stream (infinite list) monad?", "body": "<p>Various instances of monads model different type of effects: for example, <code>Maybe</code> models partiality, <code>List</code> non-determinism, <code>Reader</code> read-only state. I would like to know if there is such an intuitive explanation for the monad instance of the stream data type (or infinite list or co-list), <code>data Stream a = Cons a (Stream a)</code> (see below its monad instance definition). I've stumbled upon the stream monad on a <a href=\"http://strictlypositive.org/Idiom.pdf\" rel=\"noreferrer\">few</a> <a href=\"http://zenzike.com/posts/2010-10-21-streams-and-monad-laws\" rel=\"noreferrer\">different</a> <a href=\"https://patternsinfp.wordpress.com/2010/12/31/stream-monad/\" rel=\"noreferrer\">occasions</a> and I would like to understand better its uses.</p>\n\n<pre><code>data Stream a = Cons a (Stream a)\n\ninstance Functor Stream where\n    fmap f (Cons x xs) = Cons (f x) (fmap f xs)\n\ninstance Applicative Stream where\n    pure a                      = Cons a (pure a)\n    (Cons f fs) &lt;*&gt; (Cons a as) = Cons (f a) (fs &lt;*&gt; as)\n\ninstance Monad Stream where\n    xs &gt;&gt;= f = diag (fmap f xs)\n\ndiag :: Stream (Stream a) -&gt; Stream a\ndiag (Cons xs xss) = Cons (hd xs) (diag (fmap tl xss))\n    where\n        hd (Cons a _ ) = a\n        tl (Cons _ as) = as\n</code></pre>\n\n<p>P.S.: I'm not sure if I'm very precise in my language (especially when using the word \"effect\"), so feel free to correct me.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518607038, "post_id": 48785842, "comment_id": 84573015, "body": "As far as I know there is no solution. A type system specifies the <i>type</i> of the elements, it says nothing about the values. Usually you aim to define types such that invalid values are not possible (or at least most of them). You can also define code contracts, but there are <i>no</i> hard constraints, you can only hope that a contract prover <i>can</i> proof that the contracts are satisfied (but this is in general an undecidable problem)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518611550, "post_id": 48785842, "comment_id": 84576104, "body": "I wish this was doable in general -- I was looking for something like this a long time ago. It would provide a sort of subtyping which Haskell lacks. I am aware of no general solution, though."}], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518611850, "post_id": 48787159, "comment_id": 84576316, "body": "A problem with this is that if there are five options (like <code>A + B + C + D + E</code>) we get those nice christmas trees like <code>Left (Left (Right C))</code>, and <code>Left (Left (Left (Left A))))</code>, etc."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518616499, "post_id": 48787159, "comment_id": 84579449, "body": "Nothing magical prisms and the total library can&#39;t solve! <a href=\"http://lpaste.net/362494\" rel=\"nofollow noreferrer\">lpaste.net/362494</a> (I&#39;ll add an explanation to my answer a bit later)"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1518646005, "last_edit_date": 1518646005, "creation_date": 1518610988, "answer_id": 48787159, "question_id": 48785842, "link": "https://stackoverflow.com/questions/48785842/model-selective-usage-of-sum-type/48787159#48787159", "title": "Model selective usage of sum type", "body": "<h3>Modular sums</h3>\n\n<p>How about using the generic sum type <code>Either</code>:</p>\n\n<pre><code>data A = A\ndata B = B\ndata C = C\n\ntype (+) = Either\n\ndata Foo = Foo\n  { name :: String\n  , choice :: A + B\n  }\n\ndata Bar = Bar\n  { name :: String\n  , choice = B + C\n  }\n</code></pre>\n\n<p>Modularity is good, but it's not really convenient to have to remember to use the right combination of <code>Left</code> and <code>Right</code> when constructing and pattern-matching values. Furthermore, adding a case requires changing previously existing patterns.</p>\n\n<p>However there are variants of this technique that address this problem.\nBasically, use a typeclass to select/inject a variant in a sum. See for example <a href=\"https://hackage.haskell.org/package/vinyl-0.7.0/docs/Data-Vinyl-CoRec.html\" rel=\"nofollow noreferrer\"><code>Data.Vinyl.CoRec</code></a> in vinyl, where in particular, the <a href=\"https://hackage.haskell.org/package/vinyl-0.7.0/docs/Data-Vinyl-CoRec.html#v:match\" rel=\"nofollow noreferrer\"><code>match</code></a> function makes it possible to pattern-match variants without worrying about order or nesting. In the comments I have a snippet that does something similar with prisms and the <a href=\"https://hackage.haskell.org/package/total\" rel=\"nofollow noreferrer\">total</a> library.</p>\n\n<h3>Flat parameterized sum</h3>\n\n<p>Another approach, which seems closer to your initial idea, is to declare a single sum type, but with type parameters that can forbid some constructors selectively.</p>\n\n<p>chi already gave an example using GADTs. Here's one with regular ADTs.</p>\n\n<pre><code>data Choice a b c\n  = A a\n  | B b\n  | C c\n</code></pre>\n\n<p>For there to be no <code>A</code> choice, just set <code>a ~ Void</code> (from <code>Data.Void</code>), which is an empty type.</p>\n\n<pre><code>data Foo = Foo\n  { name :: String\n  , choice :: Choice () () Void\n    -- Two inhabitants: (A ()), (B ())\n  }\n</code></pre>\n\n<p>We must still pattern-match on <code>C</code> to avoid warnings, but the case is systematically dispatched using <code>-XEmptyCase</code> or <code>Data.Void.absurd</code>.</p>\n\n<pre><code>case c :: Choice () () Void of\n  A () -&gt; 1\n  B () -&gt; 2\n  C v -&gt; case v of {}\n  -- or  absurd v\n</code></pre>\n\n<p>This technique also allows some subtyping.</p>\n\n<pre><code>A () :: forall b c. Choice () b c\n     :: Choice () () ()\n     :: Choice () Void Void\n     :: Choice () () Void\n</code></pre>\n\n<p>The downside is that to support a new (optional) choice means to change the number of type parameters, which is cumbersome.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1518613468, "last_edit_date": 1518613468, "creation_date": 1518611430, "answer_id": 48787284, "question_id": 48785842, "link": "https://stackoverflow.com/questions/48785842/model-selective-usage-of-sum-type/48787284#48787284", "title": "Model selective usage of sum type", "body": "<p>A possible approach is to use a GADT as follows. It is not that general, though, since a constructor can be associated to either a single type (e.g. <code>ForFoo,ForBar</code>), or to any type (using <code>forAny</code> as a type variable).</p>\n\n<pre><code>data Purpose = ForFoo | ForBar\n\ndata Choice (p :: Purpose) where\n    A :: Choice 'ForFoo\n    B :: Choice forAny  -- can be any Purpose\n    C :: Choice 'ForBar\n\ndata Foo where\n    Foo :: { nameF :: String , choiceF :: Choice 'ForFoo } -&gt; Foo\n\ndata Bar where\n    Bar :: { nameB :: String , choiceB :: Choice 'ForBar } -&gt; Bar\n</code></pre>\n\n<p>If we need to express that a choice is for <code>Foo,Bar</code> but not <code>Baz</code>, this approach can not be used.</p>\n\n<hr>\n\n<p>A more general approach could be:</p>\n\n<pre><code>data Choice2 (a::Bool) (b::Bool) (c::Bool) where\n    A2 :: Choice2 'True 'False 'False\n    B2 :: Choice2 'False 'True 'False\n    C2 :: Choice2 'False 'False 'True\n\ndata Foo2 where\n    Foo2 :: { nameF2 :: String\n            , choiceF2 :: Choice2 b1 b2 'False  } -&gt; Foo2\n\ndata Bar2 where\n    Bar2 :: { nameB2 :: String\n            , choiceB2 :: Choice2 'False b1 b2 } -&gt; Bar2\n\ndata Baz2 where\n    Baz2 :: { nameZ2 :: String\n            , choiceZ2 :: Choice2 b1 'False b2 } -&gt; Baz2\n</code></pre>\n\n<p>This, in principle, allows one to express any \"subset\" requirement. We only need to require <code>False</code> in those cases we do not want, and use (existentially quantified) variables for the other cases.</p>\n\n<p>It is still not completely general, and has its shortcomings. For instance, we should be able to write a constant-time implementation for</p>\n\n<pre><code>coerce :: [Choice2 'True b1 b2] -&gt; [Choice2 'True 'False 'False]\n</code></pre>\n\n<p>but we can not, since we do not really have subtypes.</p>\n"}], "owner": {"reputation": 8049, "user_id": 2718064, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jEp0E.jpg?s=128&g=1", "display_name": "marcosh", "link": "https://stackoverflow.com/users/2718064/marcosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1518646005, "creation_date": 1518606915, "question_id": 48785842, "link": "https://stackoverflow.com/questions/48785842/model-selective-usage-of-sum-type", "title": "Model selective usage of sum type", "body": "<p>I'm not sure how to model correctly something. Consider a sum type</p>\n\n<pre><code>data Choice\n    = A\n    | B\n    | C\n</code></pre>\n\n<p>and two types</p>\n\n<pre><code>data Foo = Foo\n    { name : String\n    , choice : Choice\n    }\n\ndata Bar = Bar\n    { name : String\n    , choice : Choice\n    }\n</code></pre>\n\n<p>As it is they are equal. I would like to impose that <code>Foo</code> could use only <code>A</code> and <code>B</code> as <code>Choice</code>, while <code>Bar</code> could use just <code>B</code> and <code>C</code>.</p>\n\n<p>For the moment I solved this splitting <code>Choice</code> in two, like</p>\n\n<pre><code>data ChoiceFoo\n    = FooA\n    | FooB\n\ndata ChoiceBar\n    = BarB\n    | BarC\n</code></pre>\n\n<p>but it doesn't look a very scalable approach. Is there a better and/or more elegant solution?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 683, "user_id": 6317571, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a00fafb7b33701cf164a53531a1231d1?s=128&d=identicon&r=PG&f=1", "display_name": "elena", "link": "https://stackoverflow.com/users/6317571/elena"}, "edited": false, "score": 0, "creation_date": 1518605780, "post_id": 48785258, "comment_id": 84572246, "body": "Thank you very much for your explanation. Another question if you have time. Now I can add my transaction to the automaton by doing <code>a1 = insert_transaction tr a</code> nevertheless when I try to print a (by simply typing a on the terminal) the program freezes and does not show it. Do you know why does this happen?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 683, "user_id": 6317571, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a00fafb7b33701cf164a53531a1231d1?s=128&d=identicon&r=PG&f=1", "display_name": "elena", "link": "https://stackoverflow.com/users/6317571/elena"}, "edited": false, "score": 0, "creation_date": 1518605857, "post_id": 48785258, "comment_id": 84572294, "body": "That seems to be an unrelated question you should ask in a separate thread. (Be sure to include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>!)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1518606322, "last_edit_date": 1518606322, "creation_date": 1518605244, "answer_id": 48785258, "question_id": 48785072, "link": "https://stackoverflow.com/questions/48785072/add-element-to-a-list-which-is-part-of-a-type-in-haskell/48785258#48785258", "title": "Add element to a list which is part of a type in Haskell", "body": "<p><code>transactions</code> is not really a value of type <code>[Transaction]</code>, it's by itself<sup>&dagger;</sup> only a record field accessor <em>to a field</em> of type <code>[Transaction]</code>. I.e., it's a function. GHCi could have told you:</p>\n\n<pre><code>Main*&gt; :t transactions\ntransactions :: Automaton -&gt; Transactions\n</code></pre>\n\n<p>So, to access those transactions, you need to be explicit <em>what automaton from</em>, by just giving it as an argument:</p>\n\n<pre><code>insertTransaction :: Transaction -&gt; Automaton -&gt; Automaton\ninsertTransaction t a = a{ transactions =  t : transactions a }\n</code></pre>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>&ldquo;By itself&rdquo; meaning: when you use it in a normal Haskell expression without special record syntax like <code>a{transactions = ...}</code>. There, the <code>transactions</code> isn't really an independent entity at all.</sub></p>\n\n<hr>\n\n<p>There are a couple of alternatives you could consider:</p>\n\n<ul>\n<li><p>You can &ldquo;partially pattern match&rdquo; on the fields of a record you pass as a function argument.</p>\n\n<pre><code>insertTransaction t a{transactions = oldTransactions}\n        = a{ transactions =  t : oldTransactions }\n</code></pre></li>\n<li><p>The <code>RecordWildCards</code> extension can bring an entire record's fields in scope as overloaded variables, somewhat like as if you're in an OO method of the class containing those fields. This allows you to write essentially what you had originally:</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\ninsertTransaction t a{..} = a{ transactions =  t : transactions }        \n</code></pre>\n\n<p>I would <strong>not</strong> recommend this: <code>RecordWildCards</code> is an unidiomatic hack around the limitations of Haskell98' record types.</p></li>\n<li><p><a href=\"http://lens.github.io/\" rel=\"nofollow noreferrer\">Lenses</a> are the modern and consequent way to use records in Haskell. You can get them most easily by slightly changing your data definition:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nimport Control.Lens\ndata Automaton = Automaton {\n   _initialState :: Int\n , _states :: Set.Set Int\n , _transactions :: [Transaction]\n , _finalStates :: Set.Set Int\n } deriving (Show)\nmakeLenses ''Automaton  -- Generates `transactions` etc. not as plain accessor\n                        -- functions, but as \u201coptics\u201d which can both get\n                        -- and set field values.\n\ninsertTransaction :: Transaction -&gt; Automaton -&gt; Automaton\ninsertTransaction t = transactions %~ (t:)\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 683, "user_id": 6317571, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/a00fafb7b33701cf164a53531a1231d1?s=128&d=identicon&r=PG&f=1", "display_name": "elena", "link": "https://stackoverflow.com/users/6317571/elena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 48785258, "answer_count": 1, "score": 0, "last_activity_date": 1518606322, "creation_date": 1518604669, "question_id": 48785072, "link": "https://stackoverflow.com/questions/48785072/add-element-to-a-list-which-is-part-of-a-type-in-haskell", "title": "Add element to a list which is part of a type in Haskell", "body": "<p>I am trying to add a new element of type Transaction as defined: </p>\n\n<pre><code>--Build type Transaction--\ndata Transaction = Transaction {\n     start_state :: Int, \n     symbol :: Char, \n     end_state :: Int\n} deriving Show\n</code></pre>\n\n<p>to the list of transactions which is part of the following type: </p>\n\n<pre><code>--Build type Automaton--\ndata Automaton = Automaton {\n     initial_state :: Int, \n     states :: Set.Set Int,\n     transactions :: [Transaction],\n     final_states :: Set.Set Int\n} deriving Show \n</code></pre>\n\n<p>I have tried to implement the following function: </p>\n\n<pre><code>--Add to the automaton a transaction \ninsert_transaction :: Transaction -&gt; Automaton -&gt; Automaton\ninsert_transaction t a = a{transactions =  t : transactions }\n</code></pre>\n\n<p>but it returns the following error: </p>\n\n<pre><code>automaton.hs:25:48: error:\n    \u2022 Couldn't match expected type \u2018[Transaction]\u2019\n                  with actual type \u2018Automaton -&gt; [Transaction]\u2019\n    \u2022 Probable cause: \u2018transactions\u2019 is applied to too few arguments\n      In the second argument of \u2018(:)\u2019, namely \u2018transactions\u2019\n      In the \u2018transactions\u2019 field of a record\n      In the expression: a {transactions = t : transactions}\n   |\n25 | insert_transaction t a = a{transactions =  t : transactions }\n   |                                                ^^^^^^^^^^^^\n</code></pre>\n\n<p>How can I implement this? \nThank you!</p>\n"}, {"tags": ["haskell", "reflex", "reflex-dom"], "answers": [{"tags": [], "owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "is_accepted": true, "score": 2, "last_activity_date": 1518770063, "creation_date": 1518770063, "answer_id": 48822846, "question_id": 48784560, "link": "https://stackoverflow.com/questions/48784560/updating-a-record-from-a-text-input/48822846#48822846", "title": "Updating a record from a text input", "body": "<p>Found the cause of my problem in the docs of <code>tagDyn</code>, ultimately: \"Additionally, this means that the output Event may not be used to directly change the input Dynamic, because that would mean its value depends on itself. When creating cyclic data flows, generally <code>tag (current d) e</code> is preferred.\"</p>\n\n<p>Somehow I expected this to magically work...</p>\n\n<p>So, using the <code>Behavior</code> for the update event instead of the <code>Dynamic</code> (and <code>attachWith</code> instead of <code>attachPromptlyDynWith</code>) works fine.</p>\n\n<p>Here is the working code:</p>\n\n<pre><code>updateFieldFromTextInput :: Reflex t =&gt;\n                            (Client -&gt; T.Text -&gt; Client) -&gt;\n                            Behavior t Client -&gt;\n                            Event t T.Text -&gt;\n                            Event t Client\nupdateFieldFromTextInput setter bClient evInput = attachWith setter bClient evInput\n\n-- the input event is the one to set a client on the widget\n-- the output event is when a client is saved\nclientEditWidget :: MonadWidget t m =&gt; Event t Client -&gt; m (Event t Client)\nclientEditWidget eClient = mdo\n  (editClient, eSaveButton) &lt;- elClass \"div\" \"client-edit\" $ mdo\n\n    -- fires an Event t Client when the input field is changed\n    let eNameInput = (nameInput ^. textInput_input)\n        nameSetter = flip (clientName .~)\n        eNameUpdate = updateFieldFromTextInput nameSetter (current editClient) eNameInput\n        eClear = mkClient \"\" &lt;$ eClearButton\n        eClientReplaced = leftmost [eClient, eClear]\n        eClientModified = leftmost [eNameUpdate]\n\n    -- the currently edited client\n    editClient &lt;- holdDyn (mkClient \"\") eClientModified\n\n    -- lay out the widgets\n    text \"edit client\"\n    nameInput &lt;- textInput $\n                 def &amp; setValue .~\n                 ((view clientName) &lt;$&gt; eClientReplaced)\n\n    contactsInput &lt;- textArea $\n                     def &amp; setValue .~\n                     ((T.concat . view contacts) &lt;$&gt; eClientReplaced)\n    eSaveButton &lt;- button \"Save\"\n    eClearButton &lt;- button \"Clear\"\n    dynText =&lt;&lt; holdDyn \"updated client will appear here\" (T.pack . show &lt;$&gt; eClientModified)\n    return (editClient, eSaveButton)\n  return $ tagPromptlyDyn editClient eSaveButton\n</code></pre>\n"}], "owner": {"reputation": 663, "user_id": 659685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b48936f512ad14a013bd1caf5640aa5e?s=128&d=identicon&r=PG", "display_name": "RecencyEffect", "link": "https://stackoverflow.com/users/659685/recencyeffect"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 48822846, "answer_count": 1, "score": 2, "last_activity_date": 1518770063, "creation_date": 1518603181, "last_edit_date": 1518768441, "question_id": 48784560, "link": "https://stackoverflow.com/questions/48784560/updating-a-record-from-a-text-input", "title": "Updating a record from a text input", "body": "<p>relative Haskell and reflex noob here. Decided to get my feet wet with a real-world application.</p>\n\n<p>I am having a problem with triggering an update to a Dynamic containing my record once the user enters text in a <code>textInput</code>.</p>\n\n<p>The code compiles in GHCJS, but once I open up the web page it shows up blank.\nIf I remove the line marked as problematic (which creates the update event) it works fine (i.e. setting the record from <code>eClient</code> and from the clear button works).</p>\n\n<pre><code>data Client = Client\n        { _clientName :: Text\n        , _contacts :: [Text] -- TODO make a new type for this\n        , _balance :: Int -- this is calculated\n        , _notes :: [Text] -- free text notes, might come in handy\n        } deriving (Show, Eq)\n\nupdateFieldFromTextInput :: Reflex t =&gt;\n                            (Client -&gt; T.Text -&gt; Client) -&gt;\n                            Dynamic t Client -&gt;\n                            Event t T.Text -&gt;\n                            Event t Client\nupdateFieldFromTextInput setter dynClient evInput = attachPromptlyDynWith setter dynClient evInput\n\n-- the input event is the one to set a client on the widget\n-- the output event is when a client is saved\nclientEditWidget :: MonadWidget t m =&gt; Event t Client -&gt; m (Event t Client)\nclientEditWidget eClient = mdo\n  (editClient, eSaveButton) &lt;- elClass \"div\" \"client-edit\" $ mdo\n\n    -- fires an Event t Client when the input field is changed\n    let eNameInput = (nameInput ^. textInput_input)\n        nameSetter = flip (clientName .~)\n        eNameUpdate = updateFieldFromTextInput nameSetter editClient eNameInput\n        eClear = mkClient \"\" &lt;$ eClearButton\n        eClientReplaced = leftmost [eClient, eClear]\n        eClientModified = leftmost [eNameUpdate]\n\n    -- the currently edited client\n    -- using eClientModified causes a blank screen\n    -- editClient &lt;- holdDyn (mkClient \"\") eClientModified\n    editClient &lt;- holdDyn (mkClient \"\") eClientReplaced\n\n    -- lay out the widgets\n    text \"edit client\"\n    nameInput &lt;- textInput $\n                 def &amp; setValue .~\n                 ((view clientName) &lt;$&gt; eClientReplaced)\n\n    contactsInput &lt;- textArea $\n                     def &amp; setValue .~\n                     ((T.concat . view contacts) &lt;$&gt; eClientReplaced)\n    eSaveButton &lt;- button \"Save\"\n    eClearButton &lt;- button \"Clear\"\n    dynText =&lt;&lt; holdDyn \"updated client will appear here\" (T.pack . show &lt;$&gt; eClientModified)\n    return (editClient, eSaveButton)\n  return $ tagPromptlyDyn editClient eSaveButton\n</code></pre>\n\n<p>Edit: I thought I might be introducing an infinite loop somewhere, so tried a couple of things:</p>\n\n<ul>\n<li>don't hook up <code>setEvent</code> of the input field and the <code>textInput_input</code> event to the same <code>Dynamic</code>. This did not help</li>\n<li>set <code>setValue</code> to <code>eClient</code> instead of <code>eUpdatedClient</code> - this is the <code>Event Client</code> that we are receiving from outside (e.g. when a row in a table is clicked). Did not help.</li>\n<li>trigger the <code>Dynamic</code> update from <code>textInput_keypress</code> instead of <code>textInput_input</code> again to avoid a potential loop (although I think this is not the case here. Did not help.</li>\n</ul>\n\n<p>An infinite loop may well be the problem, though.</p>\n\n<p>Edit: Added another <code>dynText</code> which shows that the event <code>eClientModified</code> fires a perfectly good <code>Client</code>. So it is really in updating the <code>editClient</code> Dynamic that it fails.</p>\n"}, {"tags": ["haskell", "cloud-haskell"], "comments": [{"owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "edited": false, "score": 0, "creation_date": 1518592990, "post_id": 48781465, "comment_id": 84564666, "body": "I do now createTransport (host app) (port app) (_ -&gt; (host app, port app)) defaultTCPParameters. Is it correct?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1518593020, "post_id": 48781465, "comment_id": 84564681, "body": "You should <a href=\"https://stackoverflow.com/posts/48781465/edit\">edit</a> additional information into your question."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1518593463, "creation_date": 1518593463, "answer_id": 48781822, "question_id": 48781465, "link": "https://stackoverflow.com/questions/48781465/how-to-use-createtransport-with-new-version-of-network-transport-tcp/48781822#48781822", "title": "How to use createTransport with new version of Network.Transport.TCP?", "body": "<p>When you choose a <code>port</code>, <code>createTransport</code> might not use the given port. For example, you might use the port <code>\"0\"</code>, which means that <em>any</em> port might get used. Depending on the used port, the external host name or service can differ vastly. For example, your firewall will only forward the ports 1000-2000 on <code>a.qspider</code>, and 2000-3000 on <code>b.qspider</code>. Therefore, if you bind on 1320, your external host and service name would be <code>a.qspider:1320</code>.</p>\n\n<p>Alternatively, you have configured your ports to forward <code>8080</code> to <code>80</code> externally, so the <code>ServiceName</code> <code>8080</code> would result in <code>80</code> + external address.</p>\n\n<p>All in all the additional parameter provides you a method to handle external port forwardings and host names correctly. If you don't have any external networks at that point, you can simply use</p>\n\n<pre><code>createTransport host port (\\port' -&gt; (host, port')) ...\n</code></pre>\n"}], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 3, "accepted_answer_id": 48781822, "answer_count": 1, "score": 4, "last_activity_date": 1518593463, "creation_date": 1518591949, "question_id": 48781465, "link": "https://stackoverflow.com/questions/48781465/how-to-use-createtransport-with-new-version-of-network-transport-tcp", "title": "How to use createTransport with new version of Network.Transport.TCP?", "body": "<p>I used the network-transport-tcp-0.5.1 for creatipn TCP transport.</p>\n\n<pre><code>resultCT &lt;- createTransport host port defaultTCPParameters\n</code></pre>\n\n<p>But now I'm using the package  network-transport-tcp-0.6.0 and getting an error because of the new type:</p>\n\n<pre><code>createTransportExposeInternals\n  :: N.HostName\n  -&gt; N.ServiceName\n  -&gt; (N.ServiceName -&gt; (N.HostName, N.ServiceName))\n  -&gt; TCPParameters\n  -&gt; IO (Either IOException (Transport, TransportInternals))\n</code></pre>\n\n<p>How can I use default value for (N.ServiceName -> (N.HostName, N.ServiceName))?\nMaybe there are some examples?\nThank you!</p>\n"}, {"tags": ["haskell", "perfect-numbers"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1518566702, "post_id": 48777656, "comment_id": 84556950, "body": "Do you know how list comprehension works in Haskell?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518566713, "post_id": 48777656, "comment_id": 84556952, "body": "<a href=\"https://wiki.haskell.org/List_comprehension\" rel=\"nofollow noreferrer\">wiki.haskell.org/List_comprehension</a>"}, {"owner": {"reputation": 1, "user_id": 9357570, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35f05e19b1f1664b5852a46857655ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Marcus_M", "link": "https://stackoverflow.com/users/9357570/marcus-m"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518567820, "post_id": 48777656, "comment_id": 84557258, "body": "I&#39;m afraid not :("}, {"owner": {"reputation": 1, "user_id": 9357570, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35f05e19b1f1664b5852a46857655ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Marcus_M", "link": "https://stackoverflow.com/users/9357570/marcus-m"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518567915, "post_id": 48777656, "comment_id": 84557277, "body": "Gonna give it a read now. I understand &#39;mod&#39; and that&#39;s about it."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1518568622, "creation_date": 1518568622, "answer_id": 48777944, "question_id": 48777656, "link": "https://stackoverflow.com/questions/48777656/testing-if-an-inputted-int-is-a-perfect-number/48777944#48777944", "title": "Testing if an inputted Int is a perfect number", "body": "<blockquote>\n<pre><code>[i | i &lt;- [1..n-1], n `mod` i == 0]\n</code></pre>\n</blockquote>\n\n<p>Starting from the middle, you can read it like this: for each element <code>i</code> of the <code>[1..n-1]</code> list, check if <code>n `mod` i</code> equals <code>0</code>. If it does, include <code>i</code> in the result list (that's the part to the left of the <code>|</code>. Without using the list comprehension syntax, that might be written using the <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><code>filter</code></a> function:</p>\n\n<pre><code>filter (\\i -&gt; n `mod` i == 0)\n</code></pre>\n\n<p>The elements of the resulting list are then added with <code>sum</code>, and, finally, the sum is tested for equality with <code>n</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 7, "last_activity_date": 1518569772, "creation_date": 1518569772, "answer_id": 48778097, "question_id": 48777656, "link": "https://stackoverflow.com/questions/48777656/testing-if-an-inputted-int-is-a-perfect-number/48778097#48778097", "title": "Testing if an inputted Int is a perfect number", "body": "<pre><code>n == sum [i | i &lt;- [1..n-1], n `mod` i == 0]\n              ^^^^^^^^^\n</code></pre>\n\n<p>For <code>i</code> from <code>1</code> to <code>n-1</code> (that is, <code>[1, 2, 3, 4 ... n-1]</code>)</p>\n\n<pre><code>n == sum [i | i &lt;- [1..n-1], n `mod` i == 0]\n                              ^^^^^^\n</code></pre>\n\n<p>And only for those values where <code>i</code> evenly divides <code>n</code>. Discarding values that do not match this requirement.</p>\n\n<pre><code>n == sum [i | i &lt;- [1..n-1], n `mod` i == 0]\n         ^^^\n</code></pre>\n\n<p>Include <code>i</code> in the result list.</p>\n\n<pre><code>n == sum [i | i &lt;- [1..n-1], n `mod` i == 0]\n     ^^^^\n</code></pre>\n\n<p>Add the elements of this list together.</p>\n\n<pre><code>n == sum [i | i &lt;- [1..n-1], n `mod` i == 0]\n^^^^\n</code></pre>\n\n<p>And return <code>True</code> iff the total equals <code>n</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 9357570, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35f05e19b1f1664b5852a46857655ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Marcus_M", "link": "https://stackoverflow.com/users/9357570/marcus-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 522, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1518569772, "creation_date": 1518566628, "last_edit_date": 1518566896, "question_id": 48777656, "link": "https://stackoverflow.com/questions/48777656/testing-if-an-inputted-int-is-a-perfect-number", "title": "Testing if an inputted Int is a perfect number", "body": "<p>I've been looking into perfect numbers, and I found this interesting bit of code on rosettacode:</p>\n\n<pre><code>perfect n = n == sum [i | i &lt;- [1..n-1], n `mod` i == 0]\n</code></pre>\n\n<p>Now, I understand what a perfect number is, and I know which numbers are considered perfect, however I'm struggling to work out which parts of this code do what. </p>\n\n<p>I understand that it's working out the factors of the inputted number, and combining them together to see if it matches the input itself, but I'm not sure how it's doing this.</p>\n\n<p>If anyone could possibly break down this bit of code in a beginner-friendly manner I'd be very appreciative.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1518562149, "post_id": 48776809, "comment_id": 84555594, "body": "On this line, <code>getUrl&#39; :: (RenderUrlComponent u b) Int =&gt; u -&gt; String</code>,  I think you mean <code>getUrl&#39; :: (RenderUrlComponent u Int) =&gt; u -&gt; String</code>."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1518572028, "post_id": 48777024, "comment_id": 84558358, "body": "I would consider also dropping the <code>PublicUrl</code> and <code>PlaceHolderUrl</code> data types, and just writing <code>data Url = PublicUrl (RouteUrl Int) | PlaceholderUrl (RouteUrl String)</code>."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 4, "last_activity_date": 1518562438, "creation_date": 1518562438, "answer_id": 48777024, "question_id": 48776809, "link": "https://stackoverflow.com/questions/48776809/how-do-i-create-a-typeclass-that-will-account-for-different-container-types/48777024#48777024", "title": "How do I create a typeclass that will account for different container types?", "body": "<p>Just make a helper function that abstracts out the commonality, no need (or justification) for a class here.</p>\n\n<pre><code>module Routes where\n\ndata RouteUrl a = Dashboard\n              | CreatePost\n              | ListPost\n              | EditPost a\n              | DeletePost a\n              | Register\n              | Login deriving Show\n\ndata PublicUrl = PublicUrl (RouteUrl Int)\ndata PlaceHolderUrl = PlaceHolderUrl (RouteUrl String)\n\ndata UrlSum = UrlPub PublicUrl | UrlPla PlaceHolderUrl\n\ngetUrlRU :: (Show a) =&gt; (String -&gt; String) -&gt; RouteUrl a -&gt; String\ngetUrlRU prefix ru =\n  case ru of\n    Dashboard  -&gt; \"/dashboard\"\n    EditPost x -&gt; \"/editpost/\" ++ prefix (show x)\n    ....\n\ngetUrl :: UrlSum -&gt; String\ngetUrl (UrlPub (PublicUrl x)) = getUrlRU id x\ngetUrl (UrlPla (PlaceHodlerUrl x)) = getUrlRU (\"(abcxyz)\" ++) x\n</code></pre>\n\n<p>You don't have to pass a function if you don't want to, you could make prefix a string and <code>prefix ++ (show x)</code>. Passing a function gives you a bit of flexibility which might be helpful if you were over-simplifying your question somehow.</p>\n"}, {"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 0, "last_activity_date": 1518613711, "creation_date": 1518613711, "answer_id": 48788036, "question_id": 48776809, "link": "https://stackoverflow.com/questions/48776809/how-do-i-create-a-typeclass-that-will-account-for-different-container-types/48788036#48788036", "title": "How do I create a typeclass that will account for different container types?", "body": "<p>Looking back it seems I over complicated things, however just for fun I've managed to get it working with typeclasses, essentially it uses a phantom type and you also need to pass the <code>RouteUrl</code> to the parameter modifier function <code>f</code>, although it is ignored, the compiler can infer which instance to use...</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# OPTIONs -Wno-incomplete-patterns #-}\n\nmodule Routes where\n\ndata RouteUrl a b = Dashboard\n              | CreatePost\n              | ListPost\n              | EditPost a\n              | DeletePost a\n              | Register\n              | Login deriving Show\n\ndata PublicUrl\ndata PlaceHolderUrl\ndata NormalizedUrl\n\nclass Show a =&gt; RouteParam a b where\n  f :: RouteUrl a b -&gt; String -&gt; String\n  normalParam :: RouteUrl a b -&gt; RouteUrl String NormalizedUrl\n  normalParam (Dashboard) = Dashboard\n  normalParam (CreatePost) = CreatePost\n  normalParam (ListPost) = ListPost\n  normalParam (EditPost x ) = EditPost $ show x\n  normalParam (DeletePost x ) = DeletePost $ show x\n  normalParam (Register) = Register\n  normalParam (Login) = Login\n\ninstance RouteParam Int PublicUrl where\n  f _ = id\n\ninstance RouteParam String PlaceHolderUrl where\n  f _ = (\"(abcxyz)\" ++)\n\nrenderUrl :: RouteParam a b =&gt; RouteUrl a b -&gt; String\nrenderUrl r = case normalParam  r of\n      Dashboard -&gt; \"/dashboard/\"\n      EditPost x -&gt; \"/editpost/\" ++ (f r x)\n\nrenderPublicUrl:: RouteUrl Int PublicUrl -&gt; String\nrenderPublicUrl r = renderUrl r\n\nrenderPlaceHolderUrl :: RouteUrl String PlaceHolderUrl -&gt; String\nrenderPlaceHolderUrl r = renderUrl r\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 48777024, "answer_count": 2, "score": 0, "last_activity_date": 1518613711, "creation_date": 1518561285, "question_id": 48776809, "link": "https://stackoverflow.com/questions/48776809/how-do-i-create-a-typeclass-that-will-account-for-different-container-types", "title": "How do I create a typeclass that will account for different container types?", "body": "<p>I've been struggling with this issue for an hour or two already, I'm finding it difficult in my mind to translate the mental concept into actual code. It feels like I'm missing some knowledge relating to typeclasses - but I'm not sure what. </p>\n\n<p>So essentially we have the following code:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE AllowAmbiguousTypes #-}\n\nmodule Routes where\n\ndata RouteUrl a = Dashboard\n              | CreatePost\n              | ListPost\n              | EditPost a\n              | DeletePost a\n              | Register\n              | Login deriving Show\n\ndata PublicUrl = PublicUrl (RouteUrl Int)\ndata PlaceHolderUrl = PlaceHolderUrl (RouteUrl String)\n\ndata UrlSum = UrlPub PublicUrl | UrlPla PlaceHolderUrl\n\ngetUrl :: UrlSum -&gt; String\ngetUrl (UrlPub (PublicUrl (Dashboard))) =       \"/dashboard\"\ngetUrl (UrlPla (PlaceHolderUrl (Dashboard))) =  \"/dashboard\"\ngetUrl (UrlPub (PublicUrl (EditPost x))) =      \"/editpost/\" ++ show x\ngetUrl (UrlPla (PlaceHolderUrl (EditPost x))) = \"/editpost/(abcxyz)\" ++ show x\n</code></pre>\n\n<p>The above works fine, but I'm trying to find a way to avoid the duplication of the <code>\"/dashboard\"</code>, <code>\"/editpost/...\"</code> parts.</p>\n\n<p>The only difference in output should be that for <code>PlaceHolderUrl</code> we should prepend <code>(abcxyz)</code> to the parameter.</p>\n\n<p>So in my mental model I'm just thinking \"look at the outer type (PublicUrl or PlaceHolderUrl), and just use the appropriate function assigned for that type\"\nI was thinking I could just make something along the lines of:</p>\n\n<pre><code>getUrl' :: (RenderUrlComponent u b) Int =&gt; u -&gt; String\ngetUrl' u = case (getRouteUrl u) of\n  Dashboard -&gt; \"/dashboard\"\n  (EditPost x) -&gt; \"/editpost/\" ++ renderUrlComponent u\n\nclass RenderUrlComponent a b where\n  renderUrlComponent :: a -&gt; String\n  getRoute :: a -&gt; RouteUrl b\n\ninstance RenderUrlComponent PublicUrl Int where\n  renderUrlComponent publicUrl = getRoute publicUrl :: RouteUrl Int\n  getRoute (PublicUrl x) = x\n</code></pre>\n\n<p>However in addition to the above having the following error:</p>\n\n<blockquote>\n<pre><code>\u2022 Expecting one fewer arguments to \u2018RenderUrlComponent u b\u2019\n  Expected kind \u2018* -&gt; Constraint\u2019,\n    but \u2018RenderUrlComponent u b\u2019 has kind \u2018Constraint\u2019\n\u2022 In the type signature:\n    getUrl' :: (RenderUrlComponent u b) Int =&gt; u -&gt; String    | 26 |\n</code></pre>\n</blockquote>\n\n<p>I can't figure out how I would get the Int out of <code>getRoute publicUrl :: RouteUrl Int</code>, without having to resort to pattern matching, in which case I'm back with the problem I started with.</p>\n\n<hr>\n\n<p>It seems I'm looking for something along the lines of:</p>\n\n<p>x is an instance for y, if it is contained in z.</p>\n"}, {"tags": ["haskell", "gadt", "singleton-type"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1518561460, "creation_date": 1518561460, "answer_id": 48776842, "question_id": 48776182, "link": "https://stackoverflow.com/questions/48776182/algebraic-data-types-using-nat-singleton-library/48776842#48776842", "title": "Algebraic Data Types using Nat (singleton library)", "body": "<p>From the README I gather that this is not possible directly because of the special status of <code>Nat</code>, but it also links to a possible workaround (see the last comment in the Github issue below): wrap Nat in some datatypes that singletons can handle.</p>\n\n<p><a href=\"https://github.com/goldfirere/singletons/issues/76\" rel=\"nofollow noreferrer\">https://github.com/goldfirere/singletons/issues/76</a></p>\n"}], "owner": {"reputation": 1199, "user_id": 1744344, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/1e64cde3a7667b8b2ee69af9a7aea5aa?s=128&d=identicon&r=PG", "display_name": "helq", "link": "https://stackoverflow.com/users/1744344/helq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1518605997, "creation_date": 1518558406, "last_edit_date": 1518605997, "question_id": 48776182, "link": "https://stackoverflow.com/questions/48776182/algebraic-data-types-using-nat-singleton-library", "title": "Algebraic Data Types using Nat (singleton library)", "body": "<p>I've been trying to declare an Algebraic Data Type to operate at the level of types using the singletons library. I can do it without much trouble if I don't use in the constructors <code>Nat</code>, <code>Symbol</code>, <code>Integer</code> or <code>String</code>. For example:</p>\n\n<pre><code>{-# LANGUAGE GADTs                #-}\n{-# LANGUAGE ScopedTypeVariables  #-}\n{-# LANGUAGE TemplateHaskell      #-}\n{-# LANGUAGE TypeFamilies         #-}\n{-# LANGUAGE TypeInType           #-}\n\nimport           Data.Singletons\nimport           Data.Singletons.TH\n\n$(singletons [d|\n  data Dim where\n    NS :: Dim -- no size\n    D  :: Bool -&gt; Dim\n   deriving (Eq, Show)\n  |])\n\nmain :: IO ()\nmain = do\n  let b = case toSing (D True) of\n            (SomeSing d) -&gt; show $ fromSing d\n  putStrLn b\n</code></pre>\n\n<p>But it fails if I change <code>Bool</code> for either <code>Nat</code> or <code>Integer</code>.</p>\n\n<p>How can I define an Algebraic Data Type to work with constructors that take <code>Nat</code> or <code>Integer</code> at the type level?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 4032862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d0dc7b2d21065cd40272893a40d927c?s=128&d=identicon&r=PG&f=1", "display_name": "lhcopetti", "link": "https://stackoverflow.com/users/4032862/lhcopetti"}, "edited": false, "score": 0, "creation_date": 1518650724, "post_id": 48774632, "comment_id": 84598365, "body": "I had no idea I could use class constraints in that context!  That explanation about the caller of the function is particularly helpful way to reason about the problem as well. Thanks!"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 6, "last_activity_date": 1518551785, "creation_date": 1518551785, "answer_id": 48774632, "question_id": 48773888, "link": "https://stackoverflow.com/questions/48773888/is-there-a-way-to-inform-haskell-to-unwrap-a-type-class-inside-a-sum-type/48774632#48774632", "title": "Is there a way to inform Haskell to unwrap a type class inside a sum type", "body": "<p>Your <code>runOnTransformable</code> function is not possible to write as specified, because its type signature is wrong.</p>\n\n<pre><code>runOnTransformable :: Transformable a =&gt; (a -&gt; IO ()) -&gt; Shape -&gt; IO ()\n</code></pre>\n\n<p>means that for any <code>a</code>, which the <em>caller</em> of <code>runOnTransformable</code> chooses, they can provide you a function taking that specific <code>a</code>, and you will call that function with an <code>a</code> of the right type, which you will produce somehow from the Shape object you have. Now, that is clearly not possible, because they may pass you a function of type <code>TSquareShape -&gt; IO ()</code> but a Shape which has no <code>TSquareShape</code> in it. Worse, GHC will worry that someone may define <code>instance Transformable Integer where {...}</code>, and you need to be able to handle that case too even though your Shape type doesn't have any way to guess what Integer to give to this function.</p>\n\n<p>You don't want to say that your function works for any <code>Transformable a =&gt; a</code>, but rather that the <em>caller</em>'s function must work for any <code>Transformable a =&gt; a</code>, so that it will be willing to accept whatever value happens to live in your Shape type. You will need the <code>RankNTypes</code> extension to enable you to write the correct signature:</p>\n\n<pre><code>runOnTransformable :: (forall a. Transformable a =&gt; a -&gt; IO ()) -&gt; Shape -&gt; IO ()\n</code></pre>\n\n<p>Sadly, after you've done this I still don't know an automated way to implement this function for all of the various constructors of <code>Shape</code>. I think something ought to be possible with Generic or Data, or Template Haskell or something, but that's beyond my knowledge. Hopefully what I've written here is enough to get you moving in the right direction.</p>\n"}, {"comments": [{"owner": {"reputation": 47, "user_id": 4032862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d0dc7b2d21065cd40272893a40d927c?s=128&d=identicon&r=PG&f=1", "display_name": "lhcopetti", "link": "https://stackoverflow.com/users/4032862/lhcopetti"}, "edited": false, "score": 0, "creation_date": 1518651050, "post_id": 48777614, "comment_id": 84598466, "body": "I have used the accepted answer approach but what you have pointed out with data families is really interesting. I will dig into that as soon as I have some time because taking advantage of having specific data containers for each data type would be a nice addition to my functional programmer toolbox. Thanks!"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1518566349, "creation_date": 1518566349, "answer_id": 48777614, "question_id": 48773888, "link": "https://stackoverflow.com/questions/48773888/is-there-a-way-to-inform-haskell-to-unwrap-a-type-class-inside-a-sum-type/48777614#48777614", "title": "Is there a way to inform Haskell to unwrap a type class inside a sum type", "body": "<p><em>Warning: Speculative answer, proceed with care.</em></p>\n\n<p>Here is an alternative approach that uses data families. A data family is, in essence, a type-level function which introduces brand new types for their results. In this case, the data families <code>ShapeData</code> and <code>TShape</code> are used to produce the types of the <code>Shape</code> fields.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE EmptyDataDecls #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE UndecidableInstances #-}\n\ndata Circle'\ndata Square'\n\ndata family ShapeData s\n\nnewtype instance ShapeData Circle' = DCircle Float\n    deriving (Eq, Show)\ndata instance ShapeData Square' = DSquare Float String\n    deriving (Eq, Show)\n\ndata family TShape s\n\ndata instance TShape Circle' = TCircle\ndata instance TShape Square' = TSquare \n\nclass Transformable a where\n    setAngle' :: Float -&gt; a -&gt; IO ()\n\ninstance Transformable (TShape Circle') where \n    setAngle' _ _ = putStrLn (\"Setting a circle angle is a no-op\")\n\ninstance Transformable (TShape Square') where \n    setAngle' x _ = putStrLn (\"Setting the square angle to \" ++ show x)\n\ndata Shape a = Shape (ShapeData a) (TShape a)\n\ninstance Transformable (TShape a) =&gt; Transformable (Shape a) where \n    setAngle' x (Shape _ t) = setAngle' x t\n</code></pre>\n\n<p>Additional remarks:</p>\n\n<ul>\n<li><p>In addition to data families, <a href=\"https://stackoverflow.com/q/39707115/2751851\">there are also <em>type</em> families</a>, which result in preexisting types rather than newly introduced ones. Since here we would have to define <code>TCircleShape</code>, <code>TSquareShape</code> etc. separately, we might as well do that through a data family.</p></li>\n<li><p>I replaced your <code>Shape</code> constructors with empty data types, which are then used to fill in the gaps of a now parametric <code>Shape</code> type. One significant difference in relation to your sum type approach is that the set of possible shapes is now open to extension. If you needed it to be closed, I believe it would be possible by reaching to something even fancier: <a href=\"https://stackoverflow.com/questions/45235710/haskell-singletons-what-do-we-gain-with-snat\">singletons</a> -- you would define a sum type <code>data Shape' = Circle' | Square'</code>, then use e.g. the <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow noreferrer\"><em>singletons machinery</em></a> to promote the constructors to type level and using the resulting types as parameters to <code>Shape</code>.</p></li>\n</ul>\n"}], "owner": {"reputation": 47, "user_id": 4032862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d0dc7b2d21065cd40272893a40d927c?s=128&d=identicon&r=PG&f=1", "display_name": "lhcopetti", "link": "https://stackoverflow.com/users/4032862/lhcopetti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 48774632, "answer_count": 2, "score": 2, "last_activity_date": 1518566349, "creation_date": 1518548768, "last_edit_date": 1518551884, "question_id": 48773888, "link": "https://stackoverflow.com/questions/48773888/is-there-a-way-to-inform-haskell-to-unwrap-a-type-class-inside-a-sum-type", "title": "Is there a way to inform Haskell to unwrap a type class inside a sum type", "body": "<p>I will briefly explain my chain of thought before the example so that if any of it does not make sense we are able to fix that as well.</p>\n\n<p>Suppose that for each type constructor of my data declaration (a sum of product types) there is one parameter that has an instance to a given type class. In my head, that means that I would be able to explain to GHC/Haskell how to get to that specific type so that my type would end up behaving like an instance of that type class.</p>\n\n<p>For example:</p>\n\n<pre><code>data Vector\n\n-- The class type I talked about\nclass Transformable a where\n    setPosition' :: Vector -&gt; a -&gt; IO ()\n    setOrigin'   :: Vector -&gt; a -&gt; IO ()\n    setAngle'     :: Float  -&gt; a -&gt; IO ()\n    -- ... this goes a long way\n\n\ndata TCircleShape\ndata TSquareShape\ndata TTriangleShape\ndata TConvexShape\n-- Large sum type that defines different types of Shape\ndata Shape  = Circle Float TCircleShape\n            | Square Float String TSquareShape\n            | Triangle Float TTriangleShape\n            | Convex [Vector] Float TConvexShape\n            -- ...\n\n-- Almost all of the the Shape constructors have at least one\n-- parameter that has an instance of the Transformable typeclass:\ninstance Transformable TCircleShape\ninstance Transformable TSquareShape\ninstance Transformable TTriangleShape\ninstance Transformable TConvexShape\n\n-- What I would like to write then is:\nrunOnTransformable :: Transformable a =&gt; (a -&gt; IO ()) -&gt; Shape -&gt; IO ()\nrunOnTransformable = undefined -- (???)\n\n-- What I am doing right now is simply expanding Shape manually:\nsetShapePosition :: Vector -&gt; Shape -&gt; IO ()\nsetShapePosition v (Circle _ ptr)   = setPosition' v ptr\nsetShapePosition v (Square _ _ ptr) = setPosition' v ptr\n-- and so on...\n\nsetShapeAngle' :: Float -&gt; Shape -&gt; IO ()\nsetShapeAngle' f (Circle _ ptr)   = setAngle' f ptr\nsetShapeAngle' f (Convex _ _ ptr) = setAngle' f ptr\n-- and so on...\n</code></pre>\n\n<p><em>There is a clear pattern in my eyes and I would like to have some way of abstracting this unwrapping somehow.</em></p>\n\n<p>One might try to have an instance for the data type itself:</p>\n\n<pre><code>instance Transformable Shape where\n    setPosition' v (Circle _ ptr) = setPosition' v ptr\n    -- [...]\n\n    setAngle' f (Convex _ _ ptr) = setAngle' f ptr\n    -- [...]\n</code></pre>\n\n<p>The downside is that I would have to 'reimplement' all the methods by manually unwrapping the type classes again, except it is in an instance declaration. Right?</p>\n\n<p>Coming back to my question: Is there a way to inform Haskell how to unwrap and act upon a type class from a sum type?</p>\n\n<p>I have a really thin familiarity with Lens and none with TemplateHaskell, however, if using said features would be a probable solution, by all means, go for it.</p>\n"}, {"tags": ["haskell", "polymorphism", "parametric-polymorphism", "hindley-milner"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1518545602, "post_id": 48773028, "comment_id": 84547647, "body": "You may find <code>djinn-lib</code> and/or <code>djinn-ghc</code> somewhat helpful. See also <code>djinn</code>. See also <a href=\"http://www.hedonisticlearning.com/djinn/\" rel=\"nofollow noreferrer\">hedonisticlearning.com/djinn</a> and note that lambdabot known how to use djinn as well."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1518545799, "post_id": 48773028, "comment_id": 84547752, "body": "Cf. also <a href=\"https://stackoverflow.com/q/10205793/2751851\"><i>Given a Haskell type signature, is it possible to generate the code automatically?</i></a> and <a href=\"https://stackoverflow.com/q/10217931/2751851\"><i>How does Djinn work?</i></a>"}], "answers": [{"comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1518561193, "post_id": 48773220, "comment_id": 84555285, "body": "As it stands, this isn&#39;t really a self-contained answer to the question. Could you summarize some of the important points of the link? In the case of link-rot, there won&#39;t be anything helpful for future readers here."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1518562192, "post_id": 48773220, "comment_id": 84555610, "body": "Thanks for pointing that out. I added a link to the package itself on Hackage, and a short description of what it does."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 7, "last_activity_date": 1518562123, "last_edit_date": 1518562123, "creation_date": 1518546112, "answer_id": 48773220, "question_id": 48773028, "link": "https://stackoverflow.com/questions/48773028/can-i-verify-whether-a-given-function-type-signature-has-a-potential-implementat/48773220#48773220", "title": "Can I verify whether a given function type signature has a potential implementation?", "body": "<p><a href=\"https://hackage.haskell.org/package/ghc-justdoit\" rel=\"nofollow noreferrer\">Here's a recent implementation of that as a GHC plugin</a> that unfortunately requires GHC HEAD currently.</p>\n\n<hr>\n\n<p>It consists of a type class with a single method</p>\n\n<pre><code>class JustDoIt a where\n  justDoIt :: a\n</code></pre>\n\n<p>Such that <code>justDoIt</code> typechecks whenever the plugin can find an inhabitant of its inferred type.</p>\n\n<pre><code>foo :: (r -&gt; Either e a) -&gt; (a -&gt; (r -&gt; Either e b)) -&gt; (r -&gt; Either e (a,b))\nfoo = justDoIt\n</code></pre>\n\n<p>For more information, read Joachim Breitner's <a href=\"https://www.joachim-breitner.de/blog/735-The_magic_%E2%80%9CJust_do_it%E2%80%9D_type_class\" rel=\"nofollow noreferrer\">blogpost</a>, which also mentions a few other options: <a href=\"http://hackage.haskell.org/package/djinn\" rel=\"nofollow noreferrer\">djinn</a> (already in other comments here), <a href=\"http://hackage.haskell.org/package/exference\" rel=\"nofollow noreferrer\">exference</a>, <a href=\"https://github.com/Chymyst/curryhoward\" rel=\"nofollow noreferrer\">curryhoward</a> for Scala, <a href=\"https://github.com/joom/hezarfen\" rel=\"nofollow noreferrer\">hezarfen</a> for Idris.</p>\n"}, {"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1518567989, "post_id": 48773525, "comment_id": 84557292, "body": "&quot;There are algorithms which can decide provability in intuitionistic logic&quot; Can you provide a reference? Keen to read about how this works; my gut tells me that provability seems like the sort of thing that might be undecidable, so will probably be fertile learning ground for me :)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1518595757, "post_id": 48773525, "comment_id": 84565973, "body": "I was seeking for a quick algorithmic solution and found a whole special field to study. I think to check if something is not a classical tautology is good enough for the time being. Thank you!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1518601436, "post_id": 48773525, "comment_id": 84569345, "body": "@BenjaminHodgson Above I am implicitly referring to simple types / propositional intuitionistic logic, where it is decidable. Once you start adding e.g. rank-2 polymorphism, GADTs, etc. things are no longer decidable, I believe. Anyway, for simple types you can take the Gentzen&#39;s LJ inference rules (without CUT) and do a proof search bottom-up, trying all the possible rules non-deterministically. Conveniently, going bottom-up, LJ rules only involve subformulas of the goal formula, which are finite, so we either find a proof, or we visit the same state again (allowing us to prune the search)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1518602419, "post_id": 48773525, "comment_id": 84569982, "body": "@BenjaminHodgson You can try to play with the rules in this <a href=\"http://logitext.mit.edu/Intuitionistic/main\" rel=\"nofollow noreferrer\">cool online demo</a>. At every step in the bottom-up search, we only have a finite number of choices, and the search space is finite because of the subformula property. So, we either find a proof or revisit a previous state (so we can detect we are running in circles and prune the search branch)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1518614383, "post_id": 48773525, "comment_id": 84577989, "body": "@chi I checked if <code>fix</code> for strictly evaluated languages <code>((a -&gt; b) -&gt; a -&gt; b) -&gt; a -&gt; b</code> is not a tautology for <code>a == True</code> and <code>b == False</code> and the result is positive, because the implication <code>((a -&gt; b) -&gt; a -&gt; b)</code> yields <code>True</code> (considering <code>-&gt;</code> is right associative) and <code>a -&gt; b</code> yields <code>False</code> and <code>True -&gt; False</code> yields <code>False</code> and this means <code>fix</code> is not a tautology. Is there a mistake in my reasoning, because <code>fix</code> is of course inhabited?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1518615020, "post_id": 48773525, "comment_id": 84578403, "body": "@ftor <code>fix</code> (and anything that involves general recursion) is disallowed, since otherwise <code>fix id :: T</code> for any <code>T</code>, and all types are inhabited, which is not interesting. Basically, the Curry-Howard correspondence holds in the language without recursion. (some form of recursion could be allowed, e.g. primitive recursion)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1518561627, "last_edit_date": 1518561627, "creation_date": 1518547308, "answer_id": 48773525, "question_id": 48773028, "link": "https://stackoverflow.com/questions/48773028/can-i-verify-whether-a-given-function-type-signature-has-a-potential-implementat/48773525#48773525", "title": "Can I verify whether a given function type signature has a potential implementation?", "body": "<blockquote>\n  <p>Goal is to sort out all or at least a subset of invalid type signatures like ones above. I am grateful for every hint.</p>\n</blockquote>\n\n<p>You might want to have a look at the <a href=\"https://en.wikipedia.org/wiki/Curry%E2%80%93Howard_correspondence\" rel=\"nofollow noreferrer\">Curry-Howard correspondence</a>.</p>\n\n<p>Basically, types in functional programs correspond to logical formulas.\nJust replace <code>-&gt;</code> with implication, <code>(,)</code> with conjunction (AND), and <code>Either</code> with disjunction (OR). Inhabited types are exactly those having a corresponding formula which is a tautology in intuitionistic logic.</p>\n\n<p>There are algorithms which can decide provability in intuitionistic logic (e.g. exploiting cut-elimination in Gentzen's sequents), but the problem is PSPACE-complete, so in general we can't work with very large types. For medium-sized types, though, the cut-elimination algorithm works fine.</p>\n\n<p>If you only want a subset of not-inhabited types, you can restrict to those having a corresponding formula which is NOT a tautology in classical logic. This is correct, since intuitionistic tautologies are also classical ones. Checking whether a formula <code>P</code> is not a classical tautology can be done by asking whether <code>not P</code> is a satisfiable formula. So, the problem is in NP. Not much, but better than PSPACE-complete.</p>\n\n<p>For instance, both the above-mentioned types</p>\n\n<pre><code>a -&gt; b\n(a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>are clearly NOT tautologies! Hence they are not inhabited.</p>\n\n<p>Finally, note that in Haskell <code>undefined :: T</code> and <code>let x = x in x :: T</code> for any type <code>T</code>, so technically every type is inhabited. Once one restricts to <em>terminating</em> programs which are free from runtime errors, we get a more meaningful notion of \"inhabited\", which is the one addressed by the Curry-Howard correspondence.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 1, "accepted_answer_id": 48773525, "answer_count": 2, "score": 6, "last_activity_date": 1518562123, "creation_date": 1518545436, "question_id": 48773028, "link": "https://stackoverflow.com/questions/48773028/can-i-verify-whether-a-given-function-type-signature-has-a-potential-implementat", "title": "Can I verify whether a given function type signature has a potential implementation?", "body": "<p>In case of explicit type annotations Haskell checks whether the inferred type is at least as polymorphic as its signature, or in other words, whether the inferred type is a subtype of the explicit one. Hence, the following functions are ill-typed:</p>\n\n<pre><code>foo :: a -&gt; b\nfoo x = x\n\nbar :: (a -&gt; b) -&gt; a -&gt; c\nbar f x = f x\n</code></pre>\n\n<p>In my scenario, however, I only have a function signature and need to verify, whether it is \"inhabited\" by a potential implementation - hopefully, this explanation makes sense at all!</p>\n\n<p>Due to the parametricity property I'd assume that for both <code>foo</code> and <code>bar</code> there don't exist an implementation and consequently, both should be rejected. But I don't know how to conclude this programmatically.</p>\n\n<p>Goal is to sort out all or at least a subset of invalid type signatures like ones above. I am grateful for every hint.</p>\n"}, {"tags": ["haskell", "types", "constraints", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1518548427, "post_id": 48772200, "comment_id": 84549060, "body": "Btw, do you have an example for this plugin usage? Like, some minimal project with steps to build and use? And explanation, if possible..."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1518560446, "post_id": 48772200, "comment_id": 84554991, "body": "I added some example code (and an alternative solution). There&#39;s not much to do, install the plugin like any other package, enable some command line options and that&#39;s it."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1518560268, "last_edit_date": 1518560268, "creation_date": 1518542118, "answer_id": 48772200, "question_id": 48771847, "link": "https://stackoverflow.com/questions/48771847/how-to-avoid-having-to-explicitly-write-composite-knownnat-constraints/48772200#48772200", "title": "How to avoid having to explicitly write composite KnownNat constraints?", "body": "<p>Yes there is such a plugin! <a href=\"https://hackage.haskell.org/package/ghc-typelits-knownnat\" rel=\"nofollow noreferrer\">ghc-typelits-knownnat</a></p>\n\n<p>Example usage:</p>\n\n<pre><code>-- Install ghc-typelits-knownnat via your favorite build tool like any other package\n-- then only this line needs to be added to enable the plugin\n{-# OPTIONS_GHC -fplugin GHC.TypeLits.KnownNat.Solver #-}\n\n-- Nothing special to be done otherwise, type-level programming as usual.\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nmodule Card where\n\nimport GHC.TypeLits\n\nclass KnownNat (Card a) =&gt; HasFin a where\n  type Card a :: Nat\n\ninstance HasFin () where\n  type Card () = 1\n\ninstance (HasFin a, HasFin b) =&gt; HasFin (Either a b) where\n  type Card (Either a b) = Card a + Card b\n</code></pre>\n\n<hr>\n\n<p>Here's another technique without plugins, using the <a href=\"https://hackage.haskell.org/package/constraints-0.10/docs/Data-Constraint-Nat.html\" rel=\"nofollow noreferrer\">constraints</a> library. It defines GADT to capture constraints and entailment as value-level dictionaries, and provides a few axioms, including the <code>(KnownNat a, KnownNat b) :- KnownNat (a + b)</code> entailment.</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE TypeApplications #-}\n\nmodule Card where\n\nimport Data.Constraint\nimport Data.Constraint.Nat\nimport GHC.TypeLits\n\nclass HasFin a where\n  type Card a :: Nat\n  card :: Dict (KnownNat (Card a))\n\ninstance HasFin () where\n  type Card () = 1\n  card = Dict\n\ninstance (HasFin a, HasFin b) =&gt; HasFin (Either a b) where\n  type Card (Either a b) = Card a + Card b\n  card =\n    case (card @a, card @b, plusNat @(Card a) @(Card b)) of\n      (Dict, Dict, Sub Dict) -&gt; Dict\n</code></pre>\n"}], "owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 48772200, "answer_count": 1, "score": 4, "last_activity_date": 1518560268, "creation_date": 1518540903, "question_id": 48771847, "link": "https://stackoverflow.com/questions/48771847/how-to-avoid-having-to-explicitly-write-composite-knownnat-constraints", "title": "How to avoid having to explicitly write composite KnownNat constraints?", "body": "<p>I have a typeclass, which imposes a <code>KnownNat</code> constraint:</p>\n\n<pre><code>class KnownNat (Card a) =&gt; HasFin a where\n  type Card a :: Nat\n  ...\n</code></pre>\n\n<p>And, I have instances of this class for several basic \"building block\" types:</p>\n\n<pre><code>instance HasFin () where\n  type Card () = 1\n  ...\n\ninstance HasFin Bool where\n  type Card Bool = 2\n  ...\n</code></pre>\n\n<p>I plan to build many \"composite\" types out of these building block types, using sums and products. Currently, I'm having to explicitly write a composite <code>KnownNat</code> constraint, when I instance <code>HasFin</code> for one of these composite types:</p>\n\n<pre><code>instance (HasFin a, HasFin b, KnownNat (Card a + Card b)) =&gt; HasFin (Either a b) where\n  type Card (Either a b) = Card a + Card b\n  ...\n</code></pre>\n\n<p>I would really like to <em>not</em> have to write: <code>KnownNat (Card a + Card b)</code>, in the code above.</p>\n\n<p><strong>Is there any type checker plug-in, which is capable of automatically extrapolating from <code>(HasFin a, HasFin b) =&gt;</code> to <code>(KnownNat (Card a + Card b)) =&gt;</code> ?</strong></p>\n\n<p>Failing that, can I write an entailment, which provides the same extrapolation?</p>\n"}, {"tags": ["haskell", "visual-studio-code", "intero", "haskero"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518539189, "post_id": 48770086, "comment_id": 84543676, "body": "Are warnings enabled? I just tried running intero, and I had to turn them on editing the cabal file. I guess <code>stack.yaml</code> and an <code>OPTIONS</code> pragma should work too."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518539429, "post_id": 48770086, "comment_id": 84543818, "body": "@chi In one of my &#39;real&#39; Stack projects, I&#39;ve tried editing the <code>.cabal</code> file like this: <code>ghc-options: -threaded -rtsopts -with-rtsopts=-N -Wall</code> (I added <code>-Wall</code>). This definitely causes <code>stack build</code> or <code>stack test</code> to display the desired warning, but Haskero doesn&#39;t, even after a restart..."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1518568793, "post_id": 48770086, "comment_id": 84557524, "body": "If I recall correctly from when I tried Haskero years ago, you need to install Intero separately. Damned if I can remember the right way to do that though. If you commit an error (rather than a warning) do you get an error from Haskero?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1518591586, "post_id": 48770086, "comment_id": 84564045, "body": "@BenjaminHodgson According to the Haskero documentation, one has to run <code>stack build intero</code> in the project folder, which I&#39;ve also done in my &#39;actual&#39; projects (I just didn&#39;t include this above, as it doesn&#39;t seem to be required in order to reproduce the issue). If I write invalid code, Haskero immediately reports this."}], "answers": [{"comments": [{"owner": {"reputation": 9946, "user_id": 467754, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3rEtR.png?s=128&g=1", "display_name": "Nikos Baxevanis", "link": "https://stackoverflow.com/users/467754/nikos-baxevanis"}, "edited": false, "score": 0, "creation_date": 1518673458, "post_id": 48800504, "comment_id": 84603899, "body": "I would suggest to also keep an eye on <a href=\"https://langserver.org/\" rel=\"nofollow noreferrer\">langserver.org</a>, and <a href=\"https://github.com/haskell/haskell-ide-engine\" rel=\"nofollow noreferrer\">haskell-ide-engine</a> in particular, and if that doesn&#39;t work out of the box either, I would give <a href=\"https://github.com/mvoidex/hsdev\" rel=\"nofollow noreferrer\">hsdev</a> 0.3.1.2 a shot."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1518678362, "post_id": 48800504, "comment_id": 84605751, "body": "I can confirm that adding <code>-Werror</code> to my options behaves in the way described here. I haven&#39;t tried the Sublime Haskell option yet, as I must admit that I&#39;m beginning to experience Haskell tool stack fatigue..."}, {"owner": {"reputation": 9946, "user_id": 467754, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3rEtR.png?s=128&g=1", "display_name": "Nikos Baxevanis", "link": "https://stackoverflow.com/users/467754/nikos-baxevanis"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1518703742, "post_id": 48800504, "comment_id": 84621577, "body": "That&#39;s nothing compared to string interpolation in Haskell ;)"}, {"owner": {"reputation": 9946, "user_id": 467754, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3rEtR.png?s=128&g=1", "display_name": "Nikos Baxevanis", "link": "https://stackoverflow.com/users/467754/nikos-baxevanis"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1539253830, "post_id": 48800504, "comment_id": 92438863, "body": "@MarkSeemann Do you still have issue(s) with Haskero or those are fixed in later versions of it? (It looks like you currently <a href=\"https://stackoverflow.com/q/52754334/467754\">use</a> Haskero.)"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1539254991, "post_id": 48800504, "comment_id": 92439509, "body": "Those issues remain. I don&#39;t think Haskero has been updated in more than a year, but I also haven&#39;t found anything that works better..."}, {"owner": {"reputation": 9946, "user_id": 467754, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3rEtR.png?s=128&g=1", "display_name": "Nikos Baxevanis", "link": "https://stackoverflow.com/users/467754/nikos-baxevanis"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1539319625, "post_id": 48800504, "comment_id": 92466786, "body": "Pretty much same here. Eventually, I realized that the only reliable Haskell &#39;IDE&#39; can be the command-line. One window edits text. One window displays type errors using <code>ghcid</code>. One window tests the Haskell code I write in a REPL. In addition to those, for an IDE-like experience, I would try <a href=\"https://github.com/alexwl/haskell-code-explorer\" rel=\"nofollow noreferrer\">haskell-code-explorer</a>, and <a href=\"https://github.com/ndmitchell/debug\" rel=\"nofollow noreferrer\">debug</a> (both are on my list of things to try)."}], "tags": [], "owner": {"reputation": 9946, "user_id": 467754, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3rEtR.png?s=128&g=1", "display_name": "Nikos Baxevanis", "link": "https://stackoverflow.com/users/467754/nikos-baxevanis"}, "is_accepted": false, "score": 2, "last_activity_date": 1518674177, "last_edit_date": 1518674177, "creation_date": 1518672709, "answer_id": 48800504, "question_id": 48770086, "link": "https://stackoverflow.com/questions/48770086/how-to-get-haskero-to-warn-on-non-exhaustive-pattern-matches/48800504#48800504", "title": "How to get Haskero to warn on non-exhaustive pattern matches", "body": "<p>It looks like you have to tell Haskero to make any warning into a fatal error (note the <code>-Werror</code> flag):</p>\n\n<pre><code>\"haskero.intero.ghciOptions\": [\n    \"-Wall\",\n    \"-Werror\"\n]\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/j7aGQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/j7aGQ.png\" alt=\"enter image description here\"></a></p>\n\n<hr>\n\n<p>However, I can't really understand why we would have to do this, since this works out of the box:</p>\n\n<pre><code>stack ghci --with-ghc intero \"--ghci-options=-Wall\" --no-build --no-load\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/jp29o.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jp29o.png\" alt=\"enter image description here\"></a></p>\n\n<p>That seems to be the way Haskero launches Intero in Visual Studio Code, and in GHCi I can see the warning without passing <code>-Werror</code>...</p>\n\n<hr>\n\n<p>Out of curiosity, I've tried the same with hsdev <a href=\"https://hackage.haskell.org/package/hsdev-0.3.1.2\" rel=\"nofollow noreferrer\">0.3.1.2</a>, and Sublime Haskell <a href=\"https://github.com/SublimeHaskell/SublimeHaskell/commit/91e0d29a609de091f6adc548be37b1faaf404888\" rel=\"nofollow noreferrer\"><code>91e0d29</code></a>, and seems to be working straight out of the box:</p>\n\n<p><a href=\"https://i.stack.imgur.com/rhwEY.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/rhwEY.png\" alt=\"enter image description here\"></a></p>\n\n<p>Hope that helps.</p>\n"}], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1518674177, "creation_date": 1518535319, "question_id": 48770086, "link": "https://stackoverflow.com/questions/48770086/how-to-get-haskero-to-warn-on-non-exhaustive-pattern-matches", "title": "How to get Haskero to warn on non-exhaustive pattern matches", "body": "<p>I'm currently evaluating <a href=\"https://marketplace.visualstudio.com/items?itemName=Vans.haskero\" rel=\"nofollow noreferrer\">Haskero</a> in <em>Visual Studio Code</em> as an alternative Haskell editor instead of <em>Atom</em> with <a href=\"https://atom-haskell.github.io\" rel=\"nofollow noreferrer\">Atom-Haskell</a>. So far, <em>Haskero</em> seems promising, but I miss the compiler warnings I'd usually get from <em>Atom-Haskell</em>.</p>\n\n<p>As a way to illustrate the problem, consider this simple repro:</p>\n\n<h1>Steps to reproduce</h1>\n\n<ol>\n<li>Open <em>Visual Studio Code</em> with <em>Haskero</em> already installed</li>\n<li>Add a new Haskell file: <code>Repro.hs</code></li>\n<li>Add the following content to the file</li>\n<li>Press <em>Save</em></li>\n</ol>\n\n<p>File contents:</p>\n\n<pre><code>module Repro where\n\nfoo :: Maybe a -&gt; a\nfoo (Just x) = x\n</code></pre>\n\n<h1>Expected behaviour</h1>\n\n<p>The editor should give a warning to the effect of:</p>\n\n<pre><code>Pattern match(es) are non-exhaustive\nIn an equation for `foo': Patterns not matched: Nothing\n</code></pre>\n\n<p><em>Atom-Haskell</em> does this.</p>\n\n<h1>Actual behaviour</h1>\n\n<p>Nothing happens. The <em>Problems</em> view just states that:</p>\n\n<blockquote>\n  <p>No problems have been detected in the workspace so far.</p>\n</blockquote>\n\n<h1>More details</h1>\n\n<p>The above steps to reproduce are the simplest ones I could think of, but I see the same (lack of) behaviour when I create a full Stack project and make sure that I've run <code>stack build intero</code> in the root of my project directory.</p>\n\n<p>My environment is:</p>\n\n<ul>\n<li>Windows 10 Pro x64</li>\n<li>Stack version 1.6.3, Git revision b27e629b8c4ce369e3b8273f04db193b060000db (5454 commits) x86_64 hpack-0.20.0</li>\n<li>Visual Studio Code version 1.20.0</li>\n<li>Haskero version 1.3.1</li>\n<li>Atom version 1.23.3 x64</li>\n<li><em>language-haskell</em> version 1.17.3</li>\n</ul>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1518532551, "post_id": 48769196, "comment_id": 84539190, "body": "First, come up with a good algorithm.  A brute-force search isn&#39;t going to work, but a simple greedy algorithm will be very fast.  The two examples from your homework should make it pretty clear what that algorithm is."}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1518532705, "post_id": 48769196, "comment_id": 84539295, "body": "I have tried find a relation between the numbers, but I don&#39;t find anything"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518532762, "post_id": 48769196, "comment_id": 84539349, "body": "Hint: when is a number divisable by 10^n?"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518532848, "post_id": 48769196, "comment_id": 84539409, "body": "When it&#39;s divisible by 10"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1518533034, "post_id": 48769196, "comment_id": 84539539, "body": "(&quot;When it&#39;s divisible by 10&quot; -- No, the implication would go other way round: if a number is divisible by 10^n, then it is divisible by 10.)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1518533044, "post_id": 48769196, "comment_id": 84539546, "body": "@mathandtic: yes, but that will not give you much speedup, it means the last <i>n</i> digits are zeros."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1518533111, "post_id": 48769196, "comment_id": 84539604, "body": "As a side note, your <code>minor</code> calls <code>minimum</code> on an infinite list, so it can&#39;t possibly terminate."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518533180, "post_id": 48769196, "comment_id": 84539644, "body": "Indeed, <code>minimum</code> should be <code>head</code>, since it is guaranteed that <code>x</code> increases."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1518534784, "post_id": 48769196, "comment_id": 84540831, "body": "First, make a function that produces the smallest number whose digits add up to <code>n</code>, then multiply the result by <code>10^n</code>."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1518537050, "post_id": 48769196, "comment_id": 84542282, "body": "Hint: <code>n `div` 9</code> tells you the number of nines that will be in the output."}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1518541693, "post_id": 48769196, "comment_id": 84545354, "body": "@4castle I don&#39;t understand your hiny"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1518541876, "post_id": 48769196, "comment_id": 84545486, "body": "<code>5 `div` 9</code> is <code>0</code>, so there are zero nines in the output <code>500000</code>. <code>20 `div` 9</code> is <code>2</code>, so there are two nines in <code>29900000000000000000000</code>."}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1518543164, "post_id": 48769196, "comment_id": 84546291, "body": "Ahh, but can I put that in the code? I get stuck on that @4castle"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518543768, "post_id": 48769196, "comment_id": 84546659, "body": "@mathandtic: not directly, Haskell is not a <i>constraint programming</i> language (and even if it was, it would still require some tricks)."}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518544433, "post_id": 48769196, "comment_id": 84547023, "body": "@WillemVanOnsem What would you do?"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518544712, "post_id": 48769196, "comment_id": 84547183, "body": "I get stuck, I&#39;ve been dealing with the problem for three hours."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518544863, "post_id": 48769196, "comment_id": 84547271, "body": "@mathandtic: perhaps a first way to speed up this algorithm enourmously (at least compared with the current appoach), is taking hops of 10^n."}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518545159, "post_id": 48772912, "comment_id": 84547403, "body": "<code>smallest_sum</code> calcules the minimum number that his digits sum <code>n</code>, isn&#39;t it?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518545192, "post_id": 48772912, "comment_id": 84547422, "body": "@mathandtic: yes."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1518545340, "post_id": 48772912, "comment_id": 84547510, "body": "...but this trick will still be insufficient for computing <code>length . show . minor $ 67^53 + 3</code>. For that you need one more tweak to compute <code>length . show . minor</code> directly instead of computing the intermediate value produced by <code>minor</code>."}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1518545550, "post_id": 48772912, "comment_id": 84547623, "body": "@DanielWagner Can you think of anything?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1518545586, "post_id": 48772912, "comment_id": 84547642, "body": "@DanielWagner: well I did not notice that we had to calculate the length :)"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518545634, "post_id": 48772912, "comment_id": 84547657, "body": "Okay, don&#39;t worry :)"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518545673, "post_id": 48772912, "comment_id": 84547680, "body": "The last thing I don&#39;t really understand this <code>d + 10 * smallest_sum (x - d)</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 1, "creation_date": 1518546171, "post_id": 48772912, "comment_id": 84547939, "body": "@mathandtic: well <code>d</code> is the last digit, but it is possible that there are more digits to the left, so we subtract <code>d</code> from <code>x</code>, and perform a recursive call to calculate the remaining digits, to get these before the current digit, we multiply with 10."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1518546546, "last_edit_date": 1518546546, "creation_date": 1518544964, "answer_id": 48772912, "question_id": 48769196, "link": "https://stackoverflow.com/questions/48769196/smallest-number-divisible-by-10n-with-digits-totaling-n-haskell/48772912#48772912", "title": "Smallest number divisible by 10^n with digits totaling n -- Haskell", "body": "<h1>Calculating the smallest number</h1>\n\n<p>Instead of using a brute force algorithm, we first better think how we can find such number.</p>\n\n<p>A number that is dividably by <em>10<sup>n</sup></em> has <em>n</em> tailing zeros. For example for <em>n=3</em>, then the numbers are 1000, 2000, 3000, etc.</p>\n\n<p>Next we want to find the <em>smallest</em> this means that the digits we have control over (the ones before the last <em>n</em> should be as large as possible at the tail, in order to be small at the lead). The digits are limited between zero and nine.</p>\n\n<p>So we can look for the smallest number where the sum of the digits is <em>n</em> with:</p>\n\n<pre><code>smallest_sum :: (Num n, Ord n) =&gt; n -&gt; n\nsmallest_sum 0 = 0\nsmallest_sum x = d + 10 * smallest_sum (x - d)\n    where d = min 9 x\n</code></pre>\n\n<p>So here <code>d = min 9 x</code> is the digit we calculate, and the digits before are calculated with recursion.</p>\n\n<p>So now the smallest number that satisfies these constraints is:</p>\n\n<pre><code>minor :: Integral i =&gt; i -&gt; i\nminor n = smallest_sum n * 10 ^ n\n</code></pre>\n\n<p>So this works in <em>linear</em> time with the <em>value</em> of <code>n</code>.</p>\n\n<p>Examples:</p>\n\n<pre><code>Prelude&gt; minor 5\n500000\nPrelude&gt; minor 20\n29900000000000000000000\nPrelude&gt; minor 0\n0\nPrelude&gt; minor 1\n10\nPrelude&gt; minor 2\n200\nPrelude&gt; minor 3\n3000\nPrelude&gt; minor 4\n40000\nPrelude&gt; minor 5\n500000\nPrelude&gt; minor 6\n6000000\nPrelude&gt; minor 7\n70000000\nPrelude&gt; minor 8\n800000000\nPrelude&gt; minor 9\n9000000000\nPrelude&gt; minor 10\n190000000000\n</code></pre>\n\n<h1>The length of that number</h1>\n\n<p>But this will, like @DanielWagner says, not suffice to calculate the length, since that number will be gigantic: for <code>67^35+3</code> it will contain approximately 10^64 digits, this can not be stored in memory. The point is that we do <em>not</em> have to calculate the number itself in order to calculate the length, we can derive the length with:</p>\n\n<pre><code>length_minor :: Integral i =&gt; i -&gt; i\nlength_minor n = length_smallest_sum n + n\n    where length_smallest_sum n = div (n+8) 9\n</code></pre>\n\n<p>So a very compact function that calculates it is:</p>\n\n<pre><code>length_minor :: Integral i =&gt; i -&gt; i\nlength_minor n = div (n+8) 9 + n\n</code></pre>\n\n<p>or even more compact (but if we use a small integer representation, a bit dangerous for overflow):</p>\n\n<pre><code>length_minor :: Integral i =&gt; i -&gt; i\nlength_minor n = div (10*n+8) 9\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1518547014, "post_id": 48773131, "comment_id": 84548367, "body": "The question doesn&#39;t just ask about finding the number of digits, it asks about calculating the number&#39;s minor directly."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1518547422, "post_id": 48773131, "comment_id": 84548559, "body": "@4castle <code>length (show (minor 67^35+3)) == a</code> is a direct quote from the question. I took it to be the main computation of interest; this required some human judgment rather than a direct, literal reading of the question, but that is common in SO questions."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1518546455, "last_edit_date": 1518546455, "creation_date": 1518545820, "answer_id": 48773131, "question_id": 48769196, "link": "https://stackoverflow.com/questions/48769196/smallest-number-divisible-by-10n-with-digits-totaling-n-haskell/48773131#48773131", "title": "Smallest number divisible by 10^n with digits totaling n -- Haskell", "body": "<p>You can compute the number of digits in the minor of a number without ever computing the number's minor directly, and this is important if you want to know the number of digits in the minors of large inputs.</p>\n\n<p>Willem describes the main first trick: the minor of a number is a single digit, followed by a bunch of 9s, followed by a bunch of 0s. Since we only care <em>how many</em> there are, we can compute those things directly.</p>\n\n<pre><code>numLeadingDigits n = signum (n `mod` 9)\nnum9s n = n `div` 9\nnum0s n = n\n</code></pre>\n\n<p>Now the complete length is just the sum of these.</p>\n\n<pre><code>numDigitsInMinor n = numLeadingDigits n + num9s n + num0s n\n</code></pre>\n\n<p>This can indeed be run on enormous inputs:</p>\n\n<pre><code>&gt; numDigitsInMinor (67^35 + 3)\n9086059680492581695084814449385436459012675694436486492711692052\n</code></pre>\n\n<p>Computing this minor explicitly would have required 10^63 bytes of memory, many orders of magnitude over the total amount of storage ever produced by the human race in all of history.</p>\n"}, {"tags": [], "owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "is_accepted": true, "score": 4, "last_activity_date": 1518552713, "last_edit_date": 1518552713, "creation_date": 1518546378, "answer_id": 48773290, "question_id": 48769196, "link": "https://stackoverflow.com/questions/48769196/smallest-number-divisible-by-10n-with-digits-totaling-n-haskell/48773290#48773290", "title": "Smallest number divisible by 10^n with digits totaling n -- Haskell", "body": "<p>There are 2 key observations which can be made for this problem:</p>\n\n<ol>\n<li>The number always ends with <code>n</code> zeros.</li>\n<li>The rest of the digits are all <code>9</code> (except maybe the first digit).</li>\n</ol>\n\n<p>This means you can find the number of nines by dividing by <code>9</code>, and you can find the left-most digit by using the remainder from that division.</p>\n\n<pre><code> 20 = 2 + (2 * 9) = 2 + 9 + 9      \u21d2 299\n 35 = 8 + (3 * 9) = 8 + 9 + 9 + 9  \u21d2 8999\n</code></pre>\n\n<p>In Haskell, you can use <code>quotRem</code> to divide by <code>9</code> and get both the quotient and remainder at the same time. You can then use these numbers to construct the output number.</p>\n\n<pre><code>minor :: Integer -&gt; Integer\nminor n = ((r + 1) * (10 ^ q) - 1) * (10 ^ n)\n    where (q, r) = n `quotRem` 9\n</code></pre>\n\n<hr>\n\n<p>If you're only interested in calculating the number of digits in the output, you can find that out by observing the parts of <code>minor</code> that serve as exponents to <code>10</code>, namely <code>q</code> and <code>n</code>. If <code>r</code> isn't <code>0</code>, you can add <code>1</code> more digit.</p>\n\n<pre><code>minorLength :: Integer -&gt; Integer\nminorLength n = signum r + q + n\n   where (q, r) = n `quotRem` 9\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 48773290, "answer_count": 3, "score": 1, "last_activity_date": 1518556607, "creation_date": 1518532390, "last_edit_date": 1518556607, "question_id": 48769196, "link": "https://stackoverflow.com/questions/48769196/smallest-number-divisible-by-10n-with-digits-totaling-n-haskell", "title": "Smallest number divisible by 10^n with digits totaling n -- Haskell", "body": "<p>I need to do this program:</p>\n\n<pre><code>minor :: Integer -&gt; Integer\n</code></pre>\n\n<p>such that (minor n) is the smallest number divisible by 10^n whose digits add up to n. For example,</p>\n\n<pre><code>minor 5   ==  500000\nminor 20  ==  29900000000000000000000\nlength (show (minor 67^35+3)) == a\n</code></pre>\n\n<p>I have tried this</p>\n\n<pre><code>minor :: Integer -&gt; Integer\nminor n = minimum [x | x &lt;- [n*10^n..], rem x 10^n == 0, sum (digits x) == n]\n\ndigits :: Integer -&gt; [Integer]\ndigits n = [read[d] | d &lt;- show n]\n</code></pre>\n\n<p>But it's very inefficient, because the computer gets stuck. How would they do that? Thanks.</p>\n"}, {"tags": ["haskell", "ssl", "certbot", "happstack"], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1518529133, "creation_date": 1518529133, "question_id": 48768131, "link": "https://stackoverflow.com/questions/48768131/happstack-ssl-error-wrong-tag", "title": "Happstack SSL error - wrong tag", "body": "<p>I am trying to run happstack-tls server using certificate generated by certbot, however, when I run it I get <code>user error (error:0D0680A8:asn1 encoding routines:asn1_check_tlen:wrong tag)</code> and program ends. I tried to use both pem and der versions of certificate, but without success. </p>\n\n<p>Here is the code:</p>\n\n<pre><code>conf :: TLSConf\nconf = nullTLSConf\n  { tlsCert = \"csr-certbot.der\"\n  , tlsKey = \"key-certbot.pem\"\n  , tlsPort = 8000\n  }\n\nmain :: IO ()\nmain = do\n  putStrLn \"Server running...\"\n  simpleHTTPS conf app\n</code></pre>\n\n<p>What may be wrong? Should I provide some more informations?</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1518519432, "post_id": 48764131, "comment_id": 84530666, "body": "What do you want to do with the  <code>Maybe Graph</code> that you get? Why not just put the line <code>print (parseInput contents)</code> in your <code>do</code>-block?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1518519504, "post_id": 48764131, "comment_id": 84530710, "body": "You can just pass the <code>contents</code> in your example code to your parseInput function <code>let maybeGraph = parseInput contents</code>. Are you sure your problem is the IO? Because the IO in your example is fine. If you&#39;re asking how to write a parser in Haskell, that&#39;s an entirely different question.  As an aside, Haskell is lazy but IO isn&#39;t necessarily lazy, <code>bytestring</code> especially can be used for strict IO."}], "answers": [{"comments": [{"owner": {"reputation": 398, "user_id": 6269159, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3FIh8.png?s=128&g=1", "display_name": "Mat&#250;\u0161 Bako", "link": "https://stackoverflow.com/users/6269159/mat%c3%ba%c5%a1-bako"}, "edited": false, "score": 1, "creation_date": 1518609424, "post_id": 48767895, "comment_id": 84574634, "body": "So, tldr, because I performed IO operation (and result is unknown before performing it), my Graph is stuck with IO prefix (also called monad?) and I can&#39;t go back. Thanks for the intuition. I&#39;m trying to code it right now so I&#39;ll probably post my code soon."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 398, "user_id": 6269159, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3FIh8.png?s=128&g=1", "display_name": "Mat&#250;\u0161 Bako", "link": "https://stackoverflow.com/users/6269159/mat%c3%ba%c5%a1-bako"}, "edited": false, "score": 0, "creation_date": 1518615715, "post_id": 48767895, "comment_id": 84578870, "body": "@Mat&#250;\u0161Bako Not only is it unknown, you may not even get the file at all. For example, if the previously valid file gets removed by someone else just before your program tries to access it. Pure things always do their job, yet IO things you should expect to fail you any moment."}], "tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": true, "score": 1, "last_activity_date": 1518530307, "last_edit_date": 1518530307, "creation_date": 1518528349, "answer_id": 48767895, "question_id": 48764131, "link": "https://stackoverflow.com/questions/48764131/intuition-in-parsing-graph-dimacs-format-in-haskell/48767895#48767895", "title": "Intuition in parsing Graph Dimacs format in Haskell", "body": "<p>You can think of it as two different worlds:</p>\n\n<ul>\n<li>the deterministic, <strong>ordinary world</strong> where all <strong>pure functions</strong> live, and</li>\n<li>the <strong>magical IO world</strong> where <strong>files</strong> live, and where you don't really know what could happen.</li>\n</ul>\n\n<p>When someone says <code>IO</code> is a monad, you can understand it thus: you can make anything a magical IO thing, but once the spell is cast, there's no way back to the ordinary.</p>\n\n<p>So, functions of type <code>IO</code> are your spells, and the <code>parseInput</code> is an ordinary, totally predictable mechanical device: for any given input, you may always know what the output will be. Once you have your mechanics in place, you have to <em>conjure</em> some <code>contents</code> with <code>readFile</code>, and then move your ordinary function to the magical IO world as well with <code>fmap</code>:</p>\n\n<pre><code>parseInput :: String -&gt; Maybe Graph\nparseInput = ...\n\nmagicallyGetContents :: IO String\nmagicallyGetContents = readFile ...\n\nparseMagicalInput :: IO String -&gt; IO (Maybe Graph)\nparseMagicalInput = fmap parseInput\n</code></pre>\n\n<p>By this point, you can apply your parser:</p>\n\n<pre><code>\u03bb :t parseInput magicallyGetContents\n    -- This won't work because of the interworld barrier.\n\n&lt;interactive&gt;... error:\n    \u2022 Couldn't match type ...\n      Expected type: String\n        Actual type: IO String\n...\n\n\u03bb :t parseMagicalInput magicallyGetContents\n    -- This is fine, because both things are on the magical side.\nparseMagicalInput  magicallyGetContents :: IO (Maybe Graph)\n</code></pre>\n\n<p>There are several spells at your disposal that can help you cross to the magical side. The simplest would be:</p>\n\n<pre><code>return :: a -&gt; IO a\n</code></pre>\n\n<p><em>(The name suggests the magical world is actually the home of all things in Haskell.)</em></p>\n\n<p>Notice that once you apply this fairly simple spell, there is no way back. Though you theoretically could hack your way through the RAM and retrieve the bytes, it will not be straightforward. For example, this won't do:</p>\n\n<pre><code>\u03bb print $ (unsafeCoerce (return 2 :: IO Int) :: Int)\n1099511628032\n</code></pre>\n\n<hr>\n\n<p>So, your way is to <em>assume</em> you have the contents in the pure world, and build your machine that would then work, then cross the interworld barrier with it and apply it to any number of DIMACS graph files there on the other side.</p>\n\n<p>Happy adventures!</p>\n\n<p><strong>p.s.</strong> You may also check <a href=\"https://stackoverflow.com/a/48413048\">this answer</a> for a more down-to-earth point of view.</p>\n"}], "owner": {"reputation": 398, "user_id": 6269159, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3FIh8.png?s=128&g=1", "display_name": "Mat&#250;\u0161 Bako", "link": "https://stackoverflow.com/users/6269159/mat%c3%ba%c5%a1-bako"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 48767895, "answer_count": 1, "score": 1, "last_activity_date": 1518609454, "creation_date": 1518516464, "last_edit_date": 1518609454, "question_id": 48764131, "link": "https://stackoverflow.com/questions/48764131/intuition-in-parsing-graph-dimacs-format-in-haskell", "title": "Intuition in parsing Graph Dimacs format in Haskell", "body": "<p>I'm a beginner in Haskell, and I'm trying to learn few concenpts so I would appretiate your help. I read few books and guides but I can't understand how can I use IO operations. I'm trying to parse file in <a href=\"http://lpsolve.sourceforge.net/5.5/DIMACS_maxf.htm\" rel=\"nofollow noreferrer\">this</a> format and create graph object. So far I have this code: (nodes are identified by positive integer)</p>\n\n<pre><code>data Edge = Edge Int Int deriving(Show)\n\ndata Graph = Graph {\n                nodeCount :: Int,\n                edges :: [Edge]\n            }   deriving (Show)     \n\nparseInput :: String -&gt; IO ()\nparseInput filePath = do\n    handle &lt;- openFile filePath ReadMode\n    contents &lt;- hGetContents handle\n    putStrLn contents\n    hClose handle\n</code></pre>\n\n<p>I understand that haskell is lazy. I want to create function with signature </p>\n\n<pre><code>parseInput :: String -&gt; Maybe Graph\n</code></pre>\n\n<p>so I either get <code>Nothing</code> on error or Graph. My problem is that I can't simply read the file and create the graph in one function. As far as I understand, I'm supposed to get IO String, create the object and then close the file using handle? Could anyone point me in the right direction? I'm having a hard time with this because it's very different from imperative languages.</p>\n\n<p>Thanks for any suggestions.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 3, "creation_date": 1518507272, "post_id": 48761178, "comment_id": 84523487, "body": "Add <code>vector</code> as a dependency in your <code>.cabal</code> file."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1518510453, "post_id": 48761178, "comment_id": 84525043, "body": "Is the package installed? Maybe you need to install it using <code>cabal</code>? A package installed for one version of GHC is not automatically available for other versions."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1518528096, "post_id": 48761178, "comment_id": 84535957, "body": "I wonder if this is in any way related to this (unresolved) problem of mine... <a href=\"https://stackoverflow.com/q/48083426/126014\">stackoverflow.com/q/48083426/126014</a>"}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 1, "creation_date": 1518528933, "post_id": 48761178, "comment_id": 84536555, "body": "Probably irrelevant, but: on my Arch the recently installed ghc 8.2.2 whined about exactly the same kind of &quot;Could not find module&quot;-errors and required <code>ghc -dynamic</code> option to be passed."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 1, "creation_date": 1518530735, "post_id": 48761178, "comment_id": 84537868, "body": "@AndreyTyukin Good reminder. From what I&#39;ve heard about such issues, it is probably best to avoid the distro packages when installing the Haskell toolchain on Arch, which is unfortunate."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1518532936, "post_id": 48761178, "comment_id": 84539471, "body": "As you can probably tell from the other comments, the <code>vector</code> package is still available with GHC 8.2.2, but it&#39;s hard to tell what&#39;s going on without more information: (1) How did you install GHC (<code>stack</code>, your Linux distribution&#39;s packages, etc.)?  (2) What command are you using to build your project?  (3) Does it have a <code>.cabal</code> file, and if so what are the contents?"}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1518542675, "post_id": 48770782, "comment_id": 84545994, "body": "I&#39;d go further and say <i>most</i> packages are not &quot;automatically available&quot; (bundled) with the compiler.  GHC ships with around a dozen packages and there are thousands out there."}, {"owner": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "edited": false, "score": 1, "creation_date": 1541879669, "post_id": 48770782, "comment_id": 93371126, "body": "Why a down vote? The answer needed a clarifiction, not a downvote."}, {"owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "reply_to_user": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "edited": false, "score": 0, "creation_date": 1541881473, "post_id": 48770782, "comment_id": 93371620, "body": "@EPo Lmao I was actually being really stupid when I asked and answered this. I can&#39;t believe it was less than a year ago."}, {"owner": {"reputation": 3079, "user_id": 1758363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hBUXs.jpg?s=128&g=1", "display_name": "Evgeny", "link": "https://stackoverflow.com/users/1758363/evgeny"}, "edited": false, "score": 1, "creation_date": 1541890958, "post_id": 48770782, "comment_id": 93373874, "body": "2013 actually. I thing both the question and answer are useful, the haskell beginners like myself always stumble on whta is installed and what not in haskell. One departing from python expects basic things to be in a &#39;standard library&#39; or already installed in a bundle like Anaconda, but they are not in ghci above-mentioned mentioned dozen."}], "tags": [], "owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "is_accepted": false, "score": 0, "last_activity_date": 1518537563, "creation_date": 1518537563, "answer_id": 48770782, "question_id": 48761178, "link": "https://stackoverflow.com/questions/48761178/ghc-8-2-2-wont-import-data-vector/48770782#48770782", "title": "GHC 8.2.2 won&#39;t import Data.Vector?", "body": "<p>I was unaware that certain packages weren't automatically available to all versions of ghc, but it does makes sense.</p>\n\n<p>Thanks to chi's comment, I ran <code>cabal install vector</code> as well as <code>cabal install parallel</code> and the project is compiling once again.</p>\n"}], "owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 895, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1518537563, "creation_date": 1518505397, "question_id": 48761178, "link": "https://stackoverflow.com/questions/48761178/ghc-8-2-2-wont-import-data-vector", "title": "GHC 8.2.2 won&#39;t import Data.Vector?", "body": "<p>I've been using ghc 8.0.2 and I recently installed ghc 8.2.2. I tried compiling my project and got the following error message:</p>\n\n<pre><code>Could not find module \u2018Data.Vector\u2019\nPerhaps you meant Data.Functor (from base-4.10.1.0)\nUse -v to see a list of the files searched for.\n   |\n17 | import qualified Data.Vector as V\n</code></pre>\n\n<p>I checked the <a href=\"https://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector.html\" rel=\"nofollow noreferrer\">docs</a> for Data.Vector and it doesn't say anything about the whole library becoming unavailable. Why did this happen and how can I fix it?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 1, "last_activity_date": 1518598095, "last_edit_date": 1518598095, "creation_date": 1518524325, "answer_id": 48766696, "question_id": 48760201, "link": "https://stackoverflow.com/questions/48760201/zooming-statet-with-return-value-in-indexed-container/48766696#48766696", "title": "Zooming StateT with return value in indexed container", "body": "<p>What do you want it to do? Crash? <code>zoom (players . singular (ix i))</code> will do that.</p>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1519212551, "last_edit_date": 1519212551, "creation_date": 1518524474, "answer_id": 48766732, "question_id": 48760201, "link": "https://stackoverflow.com/questions/48760201/zooming-statet-with-return-value-in-indexed-container/48766732#48766732", "title": "Zooming StateT with return value in indexed container", "body": "<p>It sounds like you have a handle on what the underlying semantic issue is, but let me restate it for clarity.</p>\n\n<p><code>at i</code> is a <code>Lens</code> into a container which returns a <code>Maybe</code>, because the item may be missing from the container (perhaps the index is beyond the end of the list). Composing such a <code>Lens</code> with a <code>Prism</code> like <code>_Just</code> turns the whole thing into a <code>Traversal</code>:</p>\n\n<pre><code>players . at i . _Just :: Traversal' Game Player\n</code></pre>\n\n<p>Now, <code>zoom</code> does work with <code>Traversal</code>s, but it needs a <code>Monoid</code> for the return value of the stateful action. From <a href=\"https://hackage.haskell.org/package/lens-4.16/docs/Control-Lens-Zoom.html#v:zoom\" rel=\"nofollow noreferrer\">the docs</a>:</p>\n\n<blockquote>\n  <p>When applied to a <code>Traversal'</code> over multiple values, the actions for each target are executed sequentially and the results are aggregated.</p>\n</blockquote>\n\n<p>A <code>Traversal</code> may return zero-or-many results, so <code>zoom</code> will execute the monadic action zero-or-many times, filling in <code>mempty</code> as a default value and combining multiple results with <code>mappend</code>. The docs also feature the following specialised type signature for <code>zoom</code>, which demonstrates the <code>Monoid</code> constraint:</p>\n\n<pre><code>zoom :: (Monad m, Monoid c) =&gt; Traversal' s t -&gt; StateT t m c -&gt; StateT s m c\n</code></pre>\n\n<p>That\u2019s why your error message says \u201cCould not deduce <code>(Monoid Action)</code>\u201d: <code>playerAction</code> returns an <code>Action</code> and <code>zoom</code> needs a <code>Monoid</code> for <code>Action</code> because you handed it a <code>Traversal</code>.</p>\n\n<p>So the fix is to pick a <code>Monoid</code> to return from the stateful action. We know that the <code>Traversal</code> will either hit one or zero targets - <code>at i</code> never returns multiple results - so the correct semantics for the <code>Monoid</code> we\u2019re looking for are \u201cfirst-result-or-failure\u201d.  That <code>Monoid</code> is <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Monoid.html#t:First\" rel=\"nofollow noreferrer\"><code>First</code></a>. (We don\u2019t need to worry about throwing away extra results because there won\u2019t be any.)</p>\n\n<pre><code>action &lt;- getFirst &lt;$&gt; zoom (players . at i . _Just) (fmap (First . Just) playerAction)\n-- here action :: Maybe Action\n</code></pre>\n\n<p>(I\u2019m on my phone so I haven\u2019t tested this code!) You might be able to clean this up a bit using <code>ala</code>.</p>\n"}], "owner": {"reputation": 67, "user_id": 9341175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/105c6aa16f689099e18a3ec34952131b?s=128&d=identicon&r=PG&f=1", "display_name": "Bob", "link": "https://stackoverflow.com/users/9341175/bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 48766732, "answer_count": 2, "score": 3, "last_activity_date": 1519212551, "creation_date": 1518500771, "question_id": 48760201, "link": "https://stackoverflow.com/questions/48760201/zooming-statet-with-return-value-in-indexed-container", "title": "Zooming StateT with return value in indexed container", "body": "<p>I'm having trouble figuring out the cleanest way of zooming an effect like StateT that returns a value into an indexed container like a vector or a map.</p>\n\n<p>For example let's say I have some structures for a card game:</p>\n\n<pre><code>data Card = Card\n    { cardValue :: Int\n    } deriving (Show, Eq)\nmakeFields ''Card\n\ndata Player = Player\n    { playerCards :: [Card]\n    } deriving (Show, Eq)\nmakeFields ''Player\n\ndata Game = Game\n    { gamePlayers :: M.Map Int Player\n    } deriving (Show, Eq)\nmakeFields ''Game\n\ndata Action = GiveCard Card | DoNothing\n</code></pre>\n\n<p>And a function that handles a player's move in a turn with a StateT effect:</p>\n\n<pre><code>playerAction :: (MonadIO m) =&gt; StateT Player m Action\nplayerAction = do\n    cards' &lt;- use cards\n    case cards' of\n        (c:rest) -&gt; GiveCard c &lt;$ (cards .= rest)\n        _        -&gt; return DoNothing\n</code></pre>\n\n<p>What I want to do is to index inside a player in the game and apply this StateT to that player. Something that looks like this:</p>\n\n<pre><code>gameAction :: (MonadIO m) =&gt; Int -&gt; StateT Game m ()\ngameAction i = do\n    Just action &lt;- zoom (players . at i . mapJust) playerAction\n    case action of\n        GiveCard c -&gt; liftIO $ print c\n        DoNothing  -&gt; liftIO $ putStrLn \"Doing nothing\"\n</code></pre>\n\n<p>Adding <code>_Just</code> in the traversal or replacing <code>at i</code> with <code>ix i</code> results in this compile error:</p>\n\n<pre><code>    \u2022 Could not deduce (Monoid Action) arising from a use of \u2018_Just\u2019\n      from the context: MonadIO m\n        bound by the type signature for:\n                   gameAction :: forall (m :: * -&gt; *).\n                                 MonadIO m =&gt;\n                                 Int -&gt; StateT Game m ()\n        at src/MainModule.hs:36:1-52\n    \u2022 In the second argument of \u2018(.)\u2019, namely \u2018_Just\u2019\n      In the second argument of \u2018(.)\u2019, namely \u2018at i . _Just\u2019\n      In the first argument of \u2018zoom\u2019, namely \u2018(players . at i . _Just)\u2019\n   |\n38 |     action &lt;- zoom (players . at i . _Just) playerAction\n   |                                      ^^^^^\n</code></pre>\n\n<p>I could use <code>non</code> with a dummy Player value but if the index doesn't exist then it silently runs the function on the dummy value which is not what I want:</p>\n\n<pre><code>emptyPlayer :: Player\nemptyPlayer = Player []\n\ngameAction :: (MonadIO m) =&gt; Int -&gt; StateT Game m ()\ngameAction i = do\n    action &lt;- zoom (players . at i . non emptyPlayer) playerAction\n    case action of\n        GiveCard c -&gt; liftIO $ print c\n        DoNothing  -&gt; liftIO $ putStrLn \"Doing nothing\"\n</code></pre>\n\n<p>I could grab the player out with <code>preuse</code>, modify it and set the modified value. Calling the function that does this is pretty verbose since it has to take in the runMonad function and the getter and setter lenses.</p>\n\n<pre><code>prezoom run get set m = do\n    maybeS &lt;- preuse get\n    case maybeS of\n        Just s -&gt; do\n            (r, s') &lt;- lift $ run m s\n            set .= s'\n            return $ Just r\n        Nothing -&gt; return Nothing\n\ngameAction :: (MonadIO m) =&gt; Int -&gt; StateT Game m ()\ngameAction i = do\n    Just action &lt;- prezoom runStateT (players . ix i) (players . ix i) playerAction\n    case action of\n        GiveCard c -&gt; liftIO $ print c\n        DoNothing  -&gt; liftIO $ putStrLn \"Doing nothing\"\n</code></pre>\n\n<p>I don't really like the above ways of zooming into an indexed container. Is there an easier and cleaner way to do this?</p>\n"}, {"tags": ["haskell", "trie", "custom-data-type"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1518500756, "post_id": 48760138, "comment_id": 84520873, "body": "<a href=\"https://stackoverflow.com/q/48739665/2751851\">A nearly identical question</a> was posted yesterday, and then deleted. Please refrain from doing that -- it is not a nice way of trying to attract attention."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1518501878, "post_id": 48760138, "comment_id": 84521255, "body": "<code>charMapLookup</code> returns a <code>Maybe</code>, but you&#39;re passing it as second argument of <code>trieLookup</code>, which is declared as <code>Trie</code>. <code>Maybe &#47;= Trie</code>, so type mismatch. Same with the other two errors."}, {"owner": {"reputation": 1, "user_id": 9353227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a98e130da32ebc4eff96e681b1f5ae6?s=128&d=identicon&r=PG&f=1", "display_name": "Quentin Hughes", "link": "https://stackoverflow.com/users/9353227/quentin-hughes"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1518502460, "post_id": 48760138, "comment_id": 84521521, "body": "@FyodorSoikin I get that, but I&#39;m not sure how I&#39;d get around it. I tried adding a check for Nothing, but in the otherwise case, how would I get the Trie out?"}, {"owner": {"reputation": 19681, "user_id": 4751173, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Haz6W.jpg?s=128&g=1", "display_name": "Glorfindel", "link": "https://stackoverflow.com/users/4751173/glorfindel"}, "edited": false, "score": 1, "creation_date": 1518527951, "post_id": 48760138, "comment_id": 84535871, "body": "Please don&#39;t vandalize your posts."}, {"owner": {"reputation": 28036, "user_id": 4826457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXT0U.jpg?s=128&g=1", "display_name": "Suraj Rao", "link": "https://stackoverflow.com/users/4826457/suraj-rao"}, "edited": false, "score": 1, "creation_date": 1518527969, "post_id": 48760138, "comment_id": 84535881, "body": "Welcome to Stack Overflow! Please do not vandalize your posts.  By posting on the Stack Exchange network, you&#39;ve granted a non-revocable right for SE to distribute that content (under the <a href=\"https://creativecommons.org/licenses/by-sa/3.0/\" rel=\"nofollow noreferrer\">CC BY-SA 3.0 license</a>). By SE policy, any vandalism will be reverted."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9353227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a98e130da32ebc4eff96e681b1f5ae6?s=128&d=identicon&r=PG&f=1", "display_name": "Quentin Hughes", "link": "https://stackoverflow.com/users/9353227/quentin-hughes"}, "edited": false, "score": 0, "creation_date": 1518502912, "post_id": 48760460, "comment_id": 84521690, "body": "<code>trieLookup (c:cs) t = fmap (trieLookup cs) (charMapLookup c t)</code> doesn&#39;t work since it tells me it&#39;s expecting &#39;IntMap (Trie a0)&#39; with actual type &#39;Trie a&#39;. I tried replacing the line with <code>trieLookup (c:cs) (TrieOf b t) = fmap (trieLookup cs) (charMapLookup c t)</code>, but that gives me the same error as before"}, {"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "reply_to_user": {"reputation": 1, "user_id": 9353227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a98e130da32ebc4eff96e681b1f5ae6?s=128&d=identicon&r=PG&f=1", "display_name": "Quentin Hughes", "link": "https://stackoverflow.com/users/9353227/quentin-hughes"}, "edited": false, "score": 0, "creation_date": 1518503269, "post_id": 48760460, "comment_id": 84521796, "body": "Sure, the first-character lookup should be done in the IntMap field of the Trie, it&#39;s extremely hard to post answers from the Android app, sorry."}], "tags": [], "owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "is_accepted": false, "score": 2, "last_activity_date": 1518511523, "last_edit_date": 1518511523, "creation_date": 1518502105, "answer_id": 48760460, "question_id": 48760138, "link": "https://stackoverflow.com/questions/48760138/haskell-type-errors-with-intmap-and-data-type/48760460#48760460", "title": "Haskell - Type Errors with IntMap and Data type", "body": "<p>Consder the frst error message. It happens in trieLookup, when you take the branch corresponding to the first symbol and continue looking up the rest of the key. The problem is, this branch is not a <code>Trie a</code> but rather a <code>Maybe (Trie a)</code> (the first character can be unmapped in the root). To continue the lookup, you need to flatmap into that possibly-unfound branch:</p>\n\n<pre><code>trieLookup (x:xs) (TrieOf _ t) = (charMapLookup x t) &gt;&gt;= trieLookup xs\n</code></pre>\n\n<p>(or use <code>case</code> instead of <code>&gt;&gt;=</code>, that would handle both <code>Nothing</code> and <code>Just branch</code> possible results of <code>charMapLookup</code>).</p>\n\n<p>Note that your code contains more errors besides type mistmatches, unlisted in the compiler output:</p>\n\n<ol>\n<li>In trieInsert you don't actually store the mapped value:</li>\n</ol>\n\n<p><code>trieInsert [] a (Trie c t) = Trie c t</code></p>\n\n<p>The RHS of this match is the same original trie, unchanged.</p>\n\n<ol start=\"2\">\n<li>The otherwise clause in trieInsert should actually read:</li>\n</ol>\n\n<pre>trieInsert (x:xs) a (TrieOf c t) | isNothing (charMapLookup x t) = trieInsert xs a (charMapInsert x Nothing t)\n                                 | otherwise = trieInsert xs a (charMapLookup x t)</pre>\n"}], "owner": {"reputation": 1, "user_id": 9353227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a98e130da32ebc4eff96e681b1f5ae6?s=128&d=identicon&r=PG&f=1", "display_name": "Quentin Hughes", "link": "https://stackoverflow.com/users/9353227/quentin-hughes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1519032149, "creation_date": 1518500388, "last_edit_date": 1518527943, "question_id": 48760138, "link": "https://stackoverflow.com/questions/48760138/haskell-type-errors-with-intmap-and-data-type", "title": "Haskell - Type Errors with IntMap and Data type", "body": "<p>We're implementing <a href=\"https://en.wikipedia.org/wiki/Trie\" rel=\"nofollow noreferrer\">Tries</a> in Haskell using IntMaps. However, I can't seem to figure IntMaps out.</p>\n\n<p>Here's what I have:</p>\n\n<pre><code>charMapLookup :: Char -&gt; IntMap a -&gt; Maybe a\ncharMapLookup c dict = IntMap.lookup (ord c) dict\n\ncharMapInsert :: Char -&gt; a -&gt; IntMap a -&gt; IntMap a\ncharMapInsert c v dict = IntMap.insert (ord c) v dict\n\n-- Question 1.\ndata Trie a = TrieOf (Maybe a) (IntMap (Trie a))\n    deriving Show\n\ntrieLookup :: [Char] -&gt; Trie a -&gt; Maybe a\n-- My code\ntrieLookup [] (TrieOf a t) = a\ntrieLookup (x:xs) (TrieOf _ t) = trieLookup xs (charMapLookup x t)\n\ntrieInsert :: [Char] -&gt; a -&gt; Trie a -&gt; Trie a\ntrieInsert [] a (TrieOf c t)= TrieOf c t\ntrieInsert (x:xs) a (TrieOf c t) | isNothing (charMapLookup x t) = trieInsert xs a (charMapInsert x Nothing t)\n                                 | trieInsert xs a (charMapLookup x t)\n</code></pre>\n\n<p>This seems to make sense to me, since if there's nothin left in the string, you return the value of the node, else search for the tail of the string in the relevant subtree, and similar for insert However, when I try to run it:</p>\n\n<pre><code> Couldn't match expected type \u2018Trie a\u2019\n                    with actual type \u2018Maybe (Trie a)\u2019\n        Relevant bindings include\n          t :: IntMap (Trie a)\n          trieLookup :: [Char] -&gt; Trie a -&gt; Maybe a \n        In the second argument of \u2018trieLookup\u2019, namely\n          \u2018(charMapLookup x t)\u2019\n        In the expression: trieLookup xs (charMapLookup x t)\n    Failed, modules loaded: none.   \n\nCouldn't match expected type \u2018Trie a\u2019\n                with actual type \u2018IntMap (Maybe a0)\u2019\n    Relevant bindings include\n      t :: IntMap (Trie a) \n      c :: Maybe a \n      a :: a \n      trieInsert :: [Char] -&gt; a -&gt; Trie a -&gt; Trie a\n    In the third argument of \u2018trieInsert\u2019, namely\n      \u2018(charMapInsert x Nothing t)\u2019\n    In the expression: trieInsert xs a (charMapInsert x Nothing t)\n\nCouldn't match type \u2018Trie a\u2019 with \u2018Maybe a0\u2019\n    Expected type: IntMap (Maybe a0)\n      Actual type: IntMap (Trie a)\n    Relevant bindings include\n      t :: IntMap (Trie a) \n      c :: Maybe a \n      a :: a\n      trieInsert :: [Char] -&gt; a -&gt; Trie a -&gt; Trie a\n    In the third argument of \u2018charMapInsert\u2019, namely \u2018t\u2019\n    In the third argument of \u2018trieInsert\u2019, namely\n      \u2018(charMapInsert x Nothing t)\u2019 \n</code></pre>\n\n<p>I'm not sure how to fix the error, I know it says there's a type mismatch, but a the <code>t</code> is supposed to be an IntMap of Tries (right?) so I don't know how else to approach this. I've spent an embarrassingly long time trying to figure this out, any code that could fix the problem would be appreciated greatly. Thanks!</p>\n"}, {"tags": ["list", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 3, "creation_date": 1518489153, "post_id": 48757506, "comment_id": 84518153, "body": "You seem to be asking repeated, minor variations of the same problem (like <a href=\"https://stackoverflow.com/questions/48739022/haskell-filtering-a-nested-list-with-specific-data-constructors\" title=\"haskell filtering a nested list with specific data constructors\">stackoverflow.com/questions/48739022/&hellip;</a> and <a href=\"https://stackoverflow.com/questions/48739861/haskell-filtering-a-nested-list-with-data-constructors\" title=\"haskell filtering a nested list with data constructors\">stackoverflow.com/questions/48739861/&hellip;</a>).   Some earlier comments (&quot;I cannot change this definition or work around it in any way&quot;) suggest that this is a homework assignment.  What&#39;s going on?"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "edited": false, "score": 0, "creation_date": 1518483510, "post_id": 48757672, "comment_id": 84516930, "body": "Nevermind, I think I figured it out. Thanks for the help again, your explanation really helped!"}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 4, "last_activity_date": 1518482319, "last_edit_date": 1518482319, "creation_date": 1518481076, "answer_id": 48757672, "question_id": 48757506, "link": "https://stackoverflow.com/questions/48757506/haskell-filtering-data-constructor-in-nested-lists/48757672#48757672", "title": "Haskell filtering data constructor in nested lists", "body": "<p>This looks like a great case for a list comprehension, in this case a nested one.</p>\n\n<pre><code>data Particle = Foo String | Goo String\n  deriving (Eq, Show)\n\nfunc :: [[Particle]] -&gt; [[Particle]]\nfunc []        = []\nfunc xss@(x:_) = [[y | y &lt;- ys, y /= badParticle] | ys &lt;- xss, worseParticle `notElem` ys]\n  where\n  (badParticle: _) = x\n  worseParticle    = case badParticle of\n                     Foo s -&gt; Goo s\n                     Goo s -&gt; undefined  -- what do you do in this case?\n</code></pre>\n\n<p>Let me break down the comprehension, <code>where</code> clause first.</p>\n\n<pre><code>(badParticle: _) = x\n-- this is equivalent to `badParticle = head x`\n\nworseParticle    = case badParticle of\n                   Foo s -&gt; Goo s\n                   Goo s -&gt; undefined\n-- Just some case matching to go Foo -&gt; Goo\n</code></pre>\n\n<p>then the list comprehension itself.</p>\n\n<pre><code>[ [y | y &lt;- ys, y /= badParticle]\n  {- a list of every y from ys, where y is not the bad particle\n     this is equivalent to `filter (/= badParticle) ys` -}\n  | ys &lt;- xss\n  {- where ys draws from xss -}\n  , worseParticle `notElem` ys\n  {- and worseParticle is not an element of ys -}\n]\n</code></pre>\n\n<hr>\n\n<p><a href=\"https://repl.it/repls/RichSlategrayCommand\" rel=\"nofollow noreferrer\">Try it here</a></p>\n"}], "owner": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 48757672, "answer_count": 1, "score": -4, "last_activity_date": 1518491842, "creation_date": 1518479939, "last_edit_date": 1518491842, "question_id": 48757506, "link": "https://stackoverflow.com/questions/48757506/haskell-filtering-data-constructor-in-nested-lists", "title": "Haskell filtering data constructor in nested lists", "body": "<p>I have the following custom data type:</p>\n\n<pre><code>data Particle = Foo String | Goo String\n</code></pre>\n\n<p>with the following call:</p>\n\n<pre><code>func [[Foo \"a\"], [Goo \"b\", Foo \"a\"], [Goo \"a\"], [Foo \"d\"]]\n</code></pre>\n\n<p>The function definition is:</p>\n\n<pre><code>func :: [[Particle]] -&gt; [[Particle]]\n</code></pre>\n\n<p>I want to filter the Nested list of Particle so that my output is the following:</p>\n\n<pre><code>[[], [Goo \"b\"], [Foo \"d\"]]\n</code></pre>\n\n<p><strong>To explain in words what func is doing, it takes a look at the first Particle in the first list, which is determined to be Foo \"a\". It removes Foo \"a\" from all the lists, and if it happens to find a Goo \"a\" in any list (including the first one), it completely destroys the list that contains it.</strong> </p>\n\n<p>But my output appears to be wrong. I'm getting</p>\n\n<pre><code>[[Goo \"a\"], [Foo \"d\"]] \n</code></pre>\n\n<p>when I should be getting</p>\n\n<pre><code>[[], [Goo \"b\"], [Foo \"d\"]]\n</code></pre>\n\n<p><strong>(this is because Foo \"a\" is deleted from the first and second list, Goo \"a\" destroys the third list, and the fourth list remains unchanged, see the list below)</strong></p>\n\n<p><em>Copy of the list for readability</em></p>\n\n<pre><code>    [[Foo \"a\"], [Goo \"b\", Foo \"a\"], [Goo \"a\"], [Foo \"d\"]]\n</code></pre>\n\n<p>Any help? I know filter and elem are required (I've been playing around with them, but can't get the right ordering), but I can't seem to implement this correctly.</p>\n\n<p>EDIT: Resolved. I had to invest more time into list comprehension. Thank you.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1518475531, "post_id": 48756758, "comment_id": 84514694, "body": "No, if you want to <code>div</code> every element, you need <code>map (`div` 7) [13, 6, 19]</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1518475650, "post_id": 48756758, "comment_id": 84514734, "body": "<code>foldr div 7 [13, 6, 19]</code> means you calculate <code>div 13 (div 6 (div 19 7)) == div 13 (div 6 2) == div 13 3 == 4</code>, for <code>foldl</code> it is the opposite: <code>div (div (div 7 13) 6) 19 == div (div 0 6) 19 == div 0 19 == 0</code>."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518476908, "post_id": 48756758, "comment_id": 84515140, "body": "Also, <code>div</code> is integer division, so it rounds down (you can get the remainder with <code>rem</code>). Your <code>foldl</code> example rounds 7/13 down to 0 and then 0/6 and 0/19 are zero.  Your <code>foldr</code> example rounds 19/7 to 2, then 6/2 is 3, and 13/3 rounds down to 4."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1518480000, "post_id": 48756758, "comment_id": 84516000, "body": "Note that you didn&#39;t get a list where each element was summed with <code>0</code> in the first example."}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1518544524, "post_id": 48756758, "comment_id": 84547068, "body": "Kind-of similar, with <code>(&#47;)</code> instead of <code>div</code>: <a href=\"https://stackoverflow.com/questions/48611896/foldr-and-foldr1-haskell\" title=\"foldr and foldr1 haskell\">stackoverflow.com/questions/48611896/foldr-and-foldr1-haskel&zwnj;&#8203;l</a>"}], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 9352258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b100d925f0e40f31be756df634035ae?s=128&d=identicon&r=PG&f=1", "display_name": "frihetskampen", "link": "https://stackoverflow.com/users/9352258/frihetskampen"}, "is_accepted": false, "score": 6, "last_activity_date": 1518476816, "last_edit_date": 1518476816, "creation_date": 1518476043, "answer_id": 48756884, "question_id": 48756758, "link": "https://stackoverflow.com/questions/48756758/foldr-and-foldl-function-applied-on-div-function-in-haskell/48756884#48756884", "title": "foldr and foldl function applied on div function in Haskell", "body": "<p><code>foldr</code> looks like this:</p>\n\n<pre><code>foldr f z [x1, x2, ..., xn] == x1 `f` (x2 `f` ... (xn `f` z)...)\n</code></pre>\n\n<p>So in your case:</p>\n\n<pre><code>foldr div 7 [13, 6, 19] == 13 `div` (6 `div` (19 `div` 7))\n</code></pre>\n\n<p>You can look stuff like this up on <a href=\"http://www.haskell.org/hoogle\" rel=\"noreferrer\">Hoogle</a>! If you want a list with all numbers divided by 7, use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:map\" rel=\"noreferrer\"><code>map</code></a>.</p>\n"}], "owner": {"reputation": 169, "user_id": 8606156, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/32ed1a7af959d4336bdc6107c1eb83a0?s=128&d=identicon&r=PG&f=1", "display_name": "Pape Sow Traore", "link": "https://stackoverflow.com/users/8606156/pape-sow-traore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 428, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1518476816, "creation_date": 1518475395, "question_id": 48756758, "link": "https://stackoverflow.com/questions/48756758/foldr-and-foldl-function-applied-on-div-function-in-haskell", "title": "foldr and foldl function applied on div function in Haskell", "body": "<p>I am really confused on how foldr and foldl works. Like for example using like this on the list [1,2,3]</p>\n\n<pre><code>foldr (+) 0 =&gt; 1 : (2 :(3:([])) \n             =&gt; 1 + (2 +(3+0)) = 6\n</code></pre>\n\n<p>And this makes sense because each : is replaced  by the + sign and the empty set by 0. </p>\n\n<p>But when I type the following two lines in the ghci I get: </p>\n\n<pre><code>foldr div 7 [13,6,19]   -- gives me 4 \nfoldl div 7 [13,6,19]   -- gives me 0\n</code></pre>\n\n<p>I thought I would get a list in which each element was divided by 7 but instead I just get one element. \nCan someone please walk me through how the ghci calculates this.</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack"], "comments": [{"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 0, "creation_date": 1518474051, "post_id": 48756089, "comment_id": 84514075, "body": "For comparison, how much disk space would be consumed by a copy of <code>pom.xml</code> for every version of every package in Maven Central?"}, {"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 1, "creation_date": 1518474467, "post_id": 48756089, "comment_id": 84514254, "body": "A packed git repository as used by <code>cargo</code> can achieve a 10x compression ratio on this sort of package registry data (and still support random access and incremental updates, unlike a <code>.tar.gz</code>), but that&#39;s of course not an answer ;)"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1518476903, "post_id": 48756089, "comment_id": 84515137, "body": "It&#39;s probably not the index; There are quite a few haskell packages, but not <i>that</i> many. GHC itself is quite big because it includes several versions of the base libraries for different debug levels IIRC.  Note also that &quot;small&quot; and &quot;beautiful&quot; have nothing to do with <i>executable</i> sizes; Haskell executables aren&#39;t enormous, but a statically linked Hello World will still probably be over 1MB."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 16, "last_activity_date": 1518484617, "creation_date": 1518484617, "answer_id": 48758099, "question_id": 48756089, "link": "https://stackoverflow.com/questions/48756089/why-is-a-fresh-install-of-haskell-stack-and-ghc-so-large-big/48758099#48758099", "title": "Why is a fresh install of Haskell-Stack and GHC so large/big?", "body": "<p>As you can probably see by inspection, it is a combination of:</p>\n\n<ul>\n<li>three flavors (static, dynamic, and profiled) of the GHC runtime (about 400 megs total) and the core GHC libraries (another 700 megs total) plus 100 megs of interface files and another 200 megs of documentation and 120 megs of compressed source (1.5 gigs total, all under <code>programs/x86_64-linux/ghc-8.2.2*</code> or similar)</li>\n<li>two identical copies of the uncompressed Hackage index <code>00-index.tar</code> and <code>01-index.tar</code>, each containing the <code>.cabal</code> file for every version of every package ever published in the Hackage database, each about 457 megs, plus a few other files to bring the total up to 1.0 gigs</li>\n</ul>\n\n<p>The first of these is installed when you run <code>stack setup</code>; the second when you run <code>stack update</code>.</p>\n\n<p>To answer your questions:</p>\n\n<ol>\n<li>It's so big because clearly no one has made any effort to make it smaller, as evidenced by the whole <code>00-index.tar</code>, <code>00-index.tar.gz</code>, and <code>01-index.tar</code> situation.</li>\n<li>That's a normal size for a minimum install.</li>\n<li>You can remove the profile versions (the <code>*_p.a</code> files) if you never want to compile a program with profiling.  I haven't tested this extensively, but it seems to work.  I guess this'll save you around 800 megs.  You can also remove the static versions (all <code>*.a</code> files) if you <em>only</em> want to dynamically link programs (i.e., using <code>ghc -dynamic</code>).  Again, I haven't tested this extensively, but it seems to work.  Removing the dynamic versions would be very difficult -- you'd have to find a way to remove only those <code>*.so</code> files that GHC itself doesn't need, and anything you did remove would no longer be loadable in the interpreter.</li>\n<li>Several things are cached and you can remove them.  For example, you can remove <code>00-index.tar</code> and <code>00-index.tar.gz</code> (saving about half a gigabyte), and Stack seems to run fine.  It'll recreate them the next time you run <code>stack update</code>, though.  I don't think this is documented anywhere, so it'll be a lot of trial and error determining what can be safely removed.</li>\n<li>I think this question has already been covered above.</li>\n</ol>\n\n<p><em>A propos</em> of nothing, the other day, I saw a good deal on some 3-terabyte drives, and in my excitement I ordered two before realizing I didn't really have anything to put on them.  It kind of puts a few gigabytes in perspective, doesn't it?</p>\n\n<p>I guess I wouldn't expend a lot of effort trying to trim down your <code>.stack</code> directory, at least on a beefy desktop machine.  If you're working on a laptop with a relatively small SSD, think about maybe putting your <code>.stack</code> directory on a filesystem that supports transparent compression (e.g., Btrfs), if you think it's likely to get out of hand.</p>\n"}], "owner": {"reputation": 559, "user_id": 9345990, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d3C7D.png?s=128&g=1", "display_name": "Klorax", "link": "https://stackoverflow.com/users/9345990/klorax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1825, "favorite_count": 4, "accepted_answer_id": 48758099, "answer_count": 1, "score": 18, "last_activity_date": 1518484617, "creation_date": 1518472196, "last_edit_date": 1518472899, "question_id": 48756089, "link": "https://stackoverflow.com/questions/48756089/why-is-a-fresh-install-of-haskell-stack-and-ghc-so-large-big", "title": "Why is a fresh install of Haskell-Stack and GHC so large/big?", "body": "<p>When doing a fresh install of Haskell Stack through the install script from <a href=\"https://docs.haskellstack.org/en/stable/install_and_upgrade/\" rel=\"noreferrer\">here</a>:</p>\n\n<pre><code>wget -qO- https://get.haskellstack.org/ | sh\n</code></pre>\n\n<p>Followed by:</p>\n\n<pre><code>stack setup\n</code></pre>\n\n<p>you will end up with a <code>$HOME/.stack/</code> directory of 1.5 GB size (from just a 120+ MB download). Further if you run:</p>\n\n<pre><code>stack update\n</code></pre>\n\n<p>the size increases to 2.5 GB.</p>\n\n<p>I am used to Java which is usually considered large/big (covers pretty much everything and has deprecated alternatives for backwards compatibility), but as a comparison: an IDE including a JDK, a stand alone JDK, and the JDK source is probably around 1.5 GB in size.</p>\n\n<p>On the other hand, that Haskell which is a \"small beautiful\" language (from what I have heard and read, this is probably referring mostly to the syntax and semantics, but still), is that large/big, seems strange to me.</p>\n\n<ol>\n<li>Why is it so big (is it related to this <a href=\"https://stackoverflow.com/questions/4858585/why-is-ghc-so-large-big\">question</a>?)?</li>\n<li>Is this size normal or have I installed something extra?</li>\n<li>If there are several (4?, 5?) <em>flavors</em> of everything, then can I remove all but one?</li>\n<li>Are some of the data cache/temporary that can be removed?</li>\n<li>The largest directories are: <code>.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.2.2/lib/ghc-8.2.2</code> (1.3 GB) and <code>.stack/indices/Hackage</code> (980 MB). I assume the first one are installed packages (and related to <code>stack setup</code>) and the latter is some index over the Hackage package archive (and related to <code>stack update</code>)? Can these be reduced (as above in <strong>3</strong> or grabbing needed Hackage information online)?</li>\n</ol>\n"}, {"tags": ["dictionary", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "edited": false, "score": 0, "creation_date": 1518473583, "post_id": 48756290, "comment_id": 84513861, "body": "Exactly what I wanted, I appreciate your help."}], "tags": [], "owner": {"reputation": 2090, "user_id": 6214495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/30oWo.png?s=128&g=1", "display_name": "nicodp", "link": "https://stackoverflow.com/users/6214495/nicodp"}, "is_accepted": true, "score": 2, "last_activity_date": 1518473905, "last_edit_date": 1518473905, "creation_date": 1518473159, "answer_id": 48756290, "question_id": 48755975, "link": "https://stackoverflow.com/questions/48755975/haskell-call-function-inside-another-on-every-tuple-in-a-list/48756290#48756290", "title": "Haskell: call function inside another on every tuple in a list", "body": "<p>What you can do is leaving aside <code>Map</code> in <code>specialFunction</code> and think if they were just lists of tuples:</p>\n\n<pre><code>specialFunction :: Ord m -&gt; (m, m) -&gt; [(m, m)]\nspecialFunction (a, b) = [(a, b), (b, a)]\n</code></pre>\n\n<p>And then, I'm not quite sure what your <code>generalFunction</code> does, but you can use <code>specialFunction</code> likewise:</p>\n\n<pre><code>generalFunction :: Ord m -&gt; [(m, m)] -&gt; Map m m\ngeneralFunction = Map.fromList . concat . map specialFunction\n</code></pre>\n\n<p>If you want to apply some function over a list of values, you can always use <code>map</code> (also, you have a <code>map</code> for the <code>Map</code> datatype).</p>\n\n<p>Hence, you get:</p>\n\n<pre><code>Prelude Data.Map&gt; generalFunction [(10,20),(30,40),(50,60)]\nfromList [(10,20),(20,10),(30,40),(40,30),(50,60),(60,50)]\n</code></pre>\n"}], "owner": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 48756290, "answer_count": 1, "score": 0, "last_activity_date": 1518473905, "creation_date": 1518471734, "question_id": 48755975, "link": "https://stackoverflow.com/questions/48755975/haskell-call-function-inside-another-on-every-tuple-in-a-list", "title": "Haskell: call function inside another on every tuple in a list", "body": "<p>I have a general list of tuple like so Map.fromList [(10,20),(30,40),(50,60)]</p>\n\n<pre><code>-- takes list of tuples and produce another list of tuples  \nGeneralFunction ::Ord m -&gt; [(m,m)] -&gt; Map m [m] -&gt; Map m [m]\n\n-- takes a tuple (x,y) and produce [(x,y),(y,x)] for each tuple in the general list \nspecialFunction ::Ord m -&gt; (m,m) -&gt; Map m [m]\n</code></pre>\n\n<p>I have generalFunction in which I want to call a special function which takes a tuple (x,y) and insert in (x,y) (y,x) for each tuple of the general list <strong>depending on its length</strong> </p>\n\n<p>Eg : when I call <code>GeneralFunction</code> with <code>Map.fromList [(10,20),(30,40),(50,60)]</code>\nthe final result will be like so <code>Map.fromList [(10,20),(20,10),(30,40),(40,30),(50,60),(60,50)]</code></p>\n\n<p>I know how to use insertWith key value and how to use list.</p>\n\n<p><strong>Question:</strong></p>\n\n<p>I'm more stack with the process of iterating tuple by tuple</p>\n\n<p>Any indications, ideas or hints are welcomed.</p>\n"}, {"tags": ["haskell", "type-inference", "fold"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1518470090, "post_id": 48755594, "comment_id": 84512200, "body": "No it is not, this is a result of lazy evaluation. A program can not know if the list has infinite size, since that would result in the <i>halting problem</i> being acceptable."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1518470213, "post_id": 48755594, "comment_id": 84512252, "body": "<code>(:)</code> is a list constructor, just like <code>[]</code>, so it doesn&#39;t need a <code>[]</code> in order to know that the code deals with lists."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518470340, "post_id": 48755594, "comment_id": 84512315, "body": "@\uae40\uc9c4\uc131: what is your point?"}, {"owner": {"reputation": 83, "user_id": 2378162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/67af844c92f0d2c884b93cbdb98ee955?s=128&d=identicon&r=PG", "display_name": "J. Kim", "link": "https://stackoverflow.com/users/2378162/j-kim"}, "edited": false, "score": 0, "creation_date": 1518470590, "post_id": 48755594, "comment_id": 84512416, "body": "take 3 $ foldr (:) [] [1..] = take 3 $ 1:(2:(3:(...:[]))) = take 3 $ 1:2:3:...:[]. you mean, 1:2:3:...:[] is already [1,2,3,...] whatever comes after 3:, right? And [1..] == [1..] is not possible concept like \u221e = \u221e. I think i almost got this. Appreciated."}], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 2378162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/67af844c92f0d2c884b93cbdb98ee955?s=128&d=identicon&r=PG", "display_name": "J. Kim", "link": "https://stackoverflow.com/users/2378162/j-kim"}, "edited": false, "score": 0, "creation_date": 1518473016, "post_id": 48755837, "comment_id": 84513568, "body": "misunderstood the concept of <code>functional</code> something like <code>symbolic</code>. thanks!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1518513212, "last_edit_date": 1518513212, "creation_date": 1518471127, "answer_id": 48755837, "question_id": 48755594, "link": "https://stackoverflow.com/questions/48755594/haskell-foldr-on-infinite-list/48755837#48755837", "title": "Haskell, foldr on infinite list", "body": "<blockquote>\n  <p>I want to know what actually happens when GHCi recognizes it is <code>[1..]</code> before evaluating <code>\u221e:[]</code>.</p>\n</blockquote>\n\n<p>GHCi does <em>not</em> recognizes that it is <code>[1...]</code>, this is only the consequence of <em>lazy</em> evaluation.</p>\n\n<p><code>foldr</code> is implemented as:</p>\n\n<pre><code>foldr _ z [] = z\nfoldr f z (x:xs) = f x (foldr f z xs)\n</code></pre>\n\n<p>If you write something like <code>foldr (:) [] [1..]</code>, then Haskell does <em>not</em> evalautes this (directly), it only stores that you want to calculate that.</p>\n\n<p>Now say you for instance want to <code>print (take 3 (foldr (:) [] [1..]))</code> that list, then Haskell is forced to evaluate that, and it will do so by calculating:</p>\n\n<pre><code>take 3 (foldr (:) [] [1..])\n-&gt; take 3 ((:) 1 (foldr (:) [] [2..]))\n-&gt; (:) 1 (take 2 (foldr (:) [] [2..]))\n-&gt; (:) 1 (take 2 ((:) 2 (foldr (:) [] [3..]))\n-&gt; (:) 1 ((:) 2 (take 1 (foldr (:) [] [3..])))\n-&gt; (:) 1 ((:) 2 (take 1 ((:) 3 (foldr (:) [] [4..]))))\n-&gt; (:) 1 ((:) 2 ((:) 3 (take 0 (foldr (:) [] [4..]))))\n-&gt; (:) 1 ((:) 2 ((:) 3 [])\n</code></pre>\n\n<p>so it derives <code>[1, 2, 3]</code>, and due to Haskell's lazyness, it is not interested in what <code>foldr (:) [] [4..]</code> is. Even if that list would eventually stop, it is simply not evaluated.</p>\n\n<p>If you calculate something like <code>[1..] = foldr (:) [] [1..]</code>, then Haskell will check for list equality, list equality is defined as:</p>\n\n<pre><code>[] == [] = True\n(x:xs) == (y:ys) = x == y &amp;&amp; xs == ys\n[] == (_:_) = False\n(_:_) == [] = False\n</code></pre>\n\n<p>So Haskell is forced to <em>unwind</em> the list of the right <code>foldr</code>, but it will keep doing so, until it finds items that are not equal, or one of the list reaches the end. But since each time the elements <em>are</em> equal, and both lists never end, it will never finish, si it will evaluate it like:</p>\n\n<pre><code>   (==) [1..] (foldr (:) [] [1..])\n-&gt; (==) ((:) 1 [2..])  ((:) 1 (foldr (:) [] [2..]))\n</code></pre>\n\n<p>It sees that both are equal, so it recursively calls:</p>\n\n<pre><code>-&gt; (==) ((:) 1 [2..])  ((:) 1 (foldr (:) [] [2..]))\n-&gt; (==) [2..] foldr (:) [] [2..])\n-&gt; (==) ((:) 2 [3..])  ((:) 2 (foldr (:) [] [3..]))\n-&gt; (==) [3..] foldr (:) [] [3..])\n-&gt; ...\n</code></pre>\n\n<p>But as you can see, it will never stop evaluation. Haskell does not <em>know</em> that <code>foldr (:) [] [1..]</code> is equal to <code>[1..]</code>, it aims to evaluate it, and since equality forces it to evaluate the entire list, it will get stuck in an infinite loop.</p>\n\n<p>Yes it would be possible to add a certain pattern in the compiler, such that <code>foldr (:) [] x</code> is replaced with <code>x</code>, and so in the future perhaps a Haskell compiler could return <code>True</code> for these, but this would not solve the problems <em>fundamentally</em>, since if Haskell could derive such things for any type of function (here <code>(:)</code>, then it would solve an undecidable problem, hence it is not possible).</p>\n"}, {"comments": [{"owner": {"reputation": 83, "user_id": 2378162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/67af844c92f0d2c884b93cbdb98ee955?s=128&d=identicon&r=PG", "display_name": "J. Kim", "link": "https://stackoverflow.com/users/2378162/j-kim"}, "edited": false, "score": 0, "creation_date": 1518472637, "post_id": 48755922, "comment_id": 84513372, "body": "Much appreciated for your <code>strict</code> explanation. It made my brain function correctly again. :D"}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 2, "last_activity_date": 1518471497, "creation_date": 1518471497, "answer_id": 48755922, "question_id": 48755594, "link": "https://stackoverflow.com/questions/48755594/haskell-foldr-on-infinite-list/48755922#48755922", "title": "Haskell, foldr on infinite list", "body": "<p>Ghc (at least in theory) doesn\u2019t know the difference between a finite list and an infinite list. It can tell that a list is finite by calculating its length. If you try to find the length of an infinite list, you\u2019re going to have a bad time as your program will never terminate.</p>\n\n<p>This question is really about lazy evaluation. In a strict language like C or python, you need to know the whole value of something at every step. If you want to add up the elements of a list, you already need to know what things are in it and how many there are before you start.</p>\n\n<p>All data in Haskell has the following form:</p>\n\n<ol>\n<li>A primitive fully known thing like an int (not necessarily integer)</li>\n<li>A data type constructor and its arguments, e.g <code>True</code>, <code>Left 7</code>, <code>(,) 5 'f'</code> (which is the same as <code>(5,'f')</code>), or <code>(:) 3 []</code></li>\n</ol>\n\n<p>But in Haskell values come in two \u201cshapes\u201d</p>\n\n<ul>\n<li>known and fully evaluated (like in C or python)</li>\n<li>not yet evaluated\u2014a function \u201cthunk\u201d that when you call will return the value in a more evaluated way</li>\n</ul>\n\n<p>In Haskell there is a concept called <em>weak head normal form</em> in which:</p>\n\n<ul>\n<li>anything primitive is fully evaluated</li>\n<li>for anything with a constructor, the constructor is known and the arguments may not have been evaluated yet.</li>\n</ul>\n\n<p>Let\u2019s look at the evaluation process for <code>foldr (:) [] [1..]</code>. First the definition of <code>foldr</code></p>\n\n<pre><code>foldr f a [] = a\nfoldr f a (x:xs) = f x (foldr xs)\n</code></pre>\n\n<p>Now what is <code>foldr (:) [] [1..]</code>?</p>\n\n<pre><code>foldr (:) [] [1..]\n</code></pre>\n\n<p>It seems it\u2019s just a thunk. We don\u2019t know anything about it yet. So let\u2019s evaluate it into WHNF. First we need to convert the argument <code>[1..]</code> (which is actually <code>enumFrom 1</code>) to WHNF so we can pattern match on it:</p>\n\n<pre><code>foldr (:) [] (1:[2..])\n</code></pre>\n\n<p>And now we can evaluate foldr:</p>\n\n<pre><code>(:) 1 (foldr [] [2..])\n1 : (foldr [] [2..])\n</code></pre>\n\n<p>Thus we have calculated the first element of the list without having to look at its whole infinite length. Similarly we can work out the second element and so on.</p>\n\n<p>So what happens if we do <code>[1..] == [1..]</code>? Well the definition for <code>==</code> for lists is (omitting three cases)</p>\n\n<pre><code>(x:xs) == (y:ys) = x == y &amp;&amp; xs == ys\n</code></pre>\n\n<p>So trying to reduce to WHNF we get:</p>\n\n<pre><code>[1..] == [1..]\n(1 == 1) &amp;&amp; ([2..] == [2..])\nTrue &amp;&amp; ([2..] == [2..])\n[2..] == [2..]\n... and so on\n</code></pre>\n\n<p>Thus we keep on going forever and never get to a constructor which we can use to pattern match (ie inspect) the result on.</p>\n\n<p>Note that we can cancel out <code>True &amp;&amp; ...</code> because the definition of <code>&amp;&amp;</code> doesn\u2019t look at its second argument:</p>\n\n<pre><code>True &amp;&amp; x = x\nFalse &amp;&amp; _ = False\n</code></pre>\n\n<p>If we defined <code>&amp;&amp;</code> with a full four way truth table, the program could run out of memory much faster (provided the compiler didn\u2019t do anything clever) than the above where instead you will just run out of patience (or a cosmic ray hits your ram and makes your program return <code>False</code>)</p>\n"}], "owner": {"reputation": 83, "user_id": 2378162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/67af844c92f0d2c884b93cbdb98ee955?s=128&d=identicon&r=PG", "display_name": "J. Kim", "link": "https://stackoverflow.com/users/2378162/j-kim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 640, "favorite_count": 0, "accepted_answer_id": 48755837, "answer_count": 2, "score": 1, "last_activity_date": 1518513212, "creation_date": 1518469949, "last_edit_date": 1518470055, "question_id": 48755594, "link": "https://stackoverflow.com/questions/48755594/haskell-foldr-on-infinite-list", "title": "Haskell, foldr on infinite list", "body": "<p>I got a question while reading LYAH.</p>\n\n<p>Here is my thought of foldr on infinite list:</p>\n\n<pre><code>foldr (:) [] [1..] = 1:2:...:**\u221e:[]**\n</code></pre>\n\n<p>I think GHCi does not know it is list before evaluating <strong>\u221e:[]</strong>.</p>\n\n<p>But GHCi do know.</p>\n\n<p>So i thought it can recognize foldr (:) [] [infinite list] = [infinite list itself].</p>\n\n<pre><code>Prelude&gt; [1..10] == (take 10 $ foldr (:) [] [1..])\nTrue\nPrelude&gt; [1..] == (foldr (:) [] [1..])\nInterrupted.\n</code></pre>\n\n<p>However It wasn't.</p>\n\n<p>I want to know what actually happens when GHCi recognizes it is [1..] before evaluating \u221e:[].</p>\n\n<p>Just type inference prior to that evaluation?</p>\n"}, {"tags": ["haskell", "types", "syntax", "typeclass"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1518470032, "post_id": 48755488, "comment_id": 84512184, "body": "Oh dear, that question you linked is a bit outdated. There&#39;s a language extension for this now."}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1518470076, "post_id": 48755488, "comment_id": 84512196, "body": "@HTNW If it&#39;s solvable by a one-line simple language extension, I&#39;ll take it ;) It&#39;s quite possible that my Haskell is not quite up-to-date, I&#39;m currently just investigating whether a very specific piece of code could be converted from Scala to Haskell without too much pain."}], "answers": [{"comments": [{"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1518470847, "post_id": 48755650, "comment_id": 84512539, "body": "That seems to be exactly what I was looking for. Nice trick with the flipped type arguments; Thank you!"}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 10, "last_activity_date": 1518470251, "creation_date": 1518470251, "answer_id": 48755650, "question_id": 48755488, "link": "https://stackoverflow.com/questions/48755488/haskell-function-that-takes-a-type-argument-and-returns-a-value-depending-on-th/48755650#48755650", "title": "Haskell: function that takes a type argument and returns a value depending on that type?", "body": "<p>Use the <code>TypeApplications</code> language extension, which allows you to explicitly instantiate individual type variables. The following code seems to have the flavor you want, and it typechecks:</p>\n\n<pre><code>{-# LANGUAGE ExplicitForAll, FlexibleInstances, MultiParamTypeClasses, TypeApplications #-}\n\nclass Transform a b where\n  transform :: a -&gt; b\n\ninstance Transform String Double where\n  transform = read\n\ninstance Transform String Rational where\n  transform = read\n\ninstance Transform Double Int where\n  transform = round\n\ninstance Transform Rational Int where\n  transform = round\n\ntransformTo :: forall b a. Transform a b =&gt; a -&gt; b\ntransformTo = transform\n\nstringToInt1 :: String -&gt; Int\nstringToInt1 = transform . transformTo @Double\n\nstringToInt2 :: String -&gt; Int\nstringToInt2 = transform . transformTo @Rational\n</code></pre>\n\n<p>The definition <code>transformTo</code> uses an explicit use of <code>forall</code> to flip <code>b</code> and <code>a</code> so that <code>TypeApplications</code> will instantiate <code>b</code> first.</p>\n"}, {"comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1518470635, "post_id": 48755664, "comment_id": 84512431, "body": "You can use an explicit <code>forall</code> to set the order of arguments. I also think that should be mandatory for any function meant to be used with <code>TypeApplications</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1518470715, "post_id": 48755664, "comment_id": 84512477, "body": "@Li-yaoXia Sure, or just give the typeclass arguments in the other order in the first place. On the other hand, knowing the type-hole application syntax is handy anyway, since it&#39;s not obvious to me why return type is obviously the correct thing to disambiguate for <code>transform</code>. One might just as well want to disambiguate input type in some other part of the code as far as I can tell."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1518470316, "creation_date": 1518470316, "answer_id": 48755664, "question_id": 48755488, "link": "https://stackoverflow.com/questions/48755488/haskell-function-that-takes-a-type-argument-and-returns-a-value-depending-on-th/48755664#48755664", "title": "Haskell: function that takes a type argument and returns a value depending on that type?", "body": "<p>Use the type applications syntax extension.</p>\n\n<pre><code>&gt; :set -XTypeApplications\n&gt; transform @_ @Int (transform @_ @Double \"9007199254740993\")\n9007199254740992\n&gt; transform @_ @Int (transform @_ @Rational \"9007199254740993%1\")\n9007199254740993\n</code></pre>\n\n<p>Inputs carefully chosen to give the lie to your \"turns out to be the same as for <code>Double</code>\" comment, even after correcting for syntax differences in the input.</p>\n"}], "owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1559, "favorite_count": 0, "accepted_answer_id": 48755650, "answer_count": 2, "score": 3, "last_activity_date": 1518470316, "creation_date": 1518469479, "last_edit_date": 1518469958, "question_id": 48755488, "link": "https://stackoverflow.com/questions/48755488/haskell-function-that-takes-a-type-argument-and-returns-a-value-depending-on-th", "title": "Haskell: function that takes a type argument and returns a value depending on that type?", "body": "<p>The question is basically: how do I write a function <code>f</code> in Haskell that takes a value <code>x</code> and a type argument <code>T</code>, and then returns a value <code>y = f x T</code>  which depends both on <code>x</code> and <code>T</code>, without explicitly ascribing the type of the entire expression <code>f x T</code>? (The <code>f x T</code> is not valid Haskell, but a placeholder-pseudo-syntax).</p>\n\n<p>Consider the following situation. Suppose that I have a typeclass <code>Transform a b</code> which provides a single function <code>transform :: a -&gt; b</code>. Suppose that I also have a bunch of <code>instances</code> of <code>Transform</code> for various combinations of types <code>a b</code>. Now I'd like to chain multiple <code>transform</code>-functions together. However, I want the <code>Transform</code>-instance to be selected depending on the previosly constructed chain and on the <em>next</em> type in the chain of transformations. Ideally, this would give me something like this (with hypothetical functions <code>source</code> and <code>migrate</code> and invalid syntax <code>&lt;&lt; &gt;&gt;</code> for \"passing type parameters\"; <code>migrate</code> is used as infix-operation):</p>\n\n<pre><code>z = source&lt;&lt;A&gt;&gt; migrate &lt;&lt;B&gt;&gt; ... migrate &lt;&lt;Z&gt;&gt;\n</code></pre>\n\n<p>Here, <code>source</code> somehow generates values of type <code>A</code>, and each <code>migrate&lt;&lt;T&gt;&gt;</code> is supposed to find an instance <code>Transform S T</code> and append it to the chain.</p>\n\n<p><strong>What I came up with so far:</strong> It actually (almost) works in Haskell using type ascriptions. Consider the following (compilable) example:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE ExistentialQuantification #-}\n\n-- compiles with: \n-- The Glorious Glasgow Haskell Compilation System, version 8.2.2\n\n-- A typeclass with two type-arguments\nclass Transform a b where\n  transform :: a -&gt; b\n\n-- instances of `T` forming a \"diamond\"\n--\n--            String\n--              / \\ \n--             /   \\ \n--            /     \\\n--           /       \\\n--     Double         Rational\n--           \\       /\n--            \\     /\n--             \\   /\n--              \\ /\n--              Int\n--\ninstance Transform String Double where\n  transform = read\n\ninstance Transform String Rational where\n  transform = read -- turns out to be same as fo `Double`, but pretend it's different\n\ninstance Transform Double Int where\n  transform = round\n\ninstance Transform Rational Int where\n  transform = round -- pretend it's different from `Double`-version\n\n\n-- A `MigrationPath` to `b` is\n-- essentially some data source and\n-- a chain of transformations \n-- supplied by typeclass `T`\n-- \n-- The `String` here is a dummy for a more\n-- complex operation that is roughly `a -&gt; b`\ndata MigrationPath b = Source b \n                     | forall a . Modify (MigrationPath a) (a -&gt; b)\n\n-- A function that appends a transformation `T` from `a` to `b`\n-- to a `MigrationPath a`\nmigrate :: Transform a b =&gt; MigrationPath a -&gt; MigrationPath b\nmigrate mpa = Modify mpa transform\n\n\n-- Build two paths along the left and right side \n-- of the diamond\nleftPath :: MigrationPath Int\nleftPath = migrate ((migrate ((Source \"3.333\") :: (MigrationPath String))) :: (MigrationPath Double))\n\nrightPath :: MigrationPath Int\nrightPath = migrate((migrate ((Source \"10/3\") :: (MigrationPath String))) :: (MigrationPath Rational))\n\nmain = putStrLn \"it compiles, ship it\"\n</code></pre>\n\n<p>In this example, we define <code>Transform</code> instances such that they form two possible <code>MigrationPath</code>s from <code>String</code> to <code>Int</code>. Now, we (as a human beings) want to exercise our free will, and force the compiler to pick either the left path, or the right path in this chain of transformations.</p>\n\n<p>This is even kind-of possible in this case. We can force the compiler to create the right chain by constructing an \"onion\" of constraints from type ascriptions:</p>\n\n<pre><code>leftPath :: MigrationPath Int\nleftPath = migrate ((migrate ((Source \"3.333\") :: (MigrationPath String))) :: (MigrationPath Double))\n</code></pre>\n\n<p>However, I find it very sub-optimal for two reasons:</p>\n\n<ul>\n<li>The AST <code>(migrate ... (Type))</code> grows to both sides around the <code>Source</code> (this is a minor issue, it probably can be rectified using infix operators with left-associativity).</li>\n<li>More severe: if the type of <code>MigrationPath</code> stored not only the target type, but also the source type, with the type-ascription approach we would have to repeat every type in the chain <em>twice</em>, which would make the entire approach too awkward to use.</li>\n</ul>\n\n<p><strong>Question:</strong> is there any way to construct the above chain of transformations in such a way that only \"the next type\", and not the entire \"type of the <code>MigrationPath T</code>\" has to be ascribed?</p>\n\n<p><strong>What I'm not asking:</strong> It is clear to me that in the above toy-example, it would be easier to define functions <code>transformStringToInt :: String -&gt; Int</code> etc, and then just chain them together using <code>.</code>. This is not the question. The question is: how do I force the compiler to <em>generate</em> the expressions corresponding to <code>transformStringToInt</code> when I specify <em>just the type</em>. In the actual application, I want to specify only the types, and use a set of rather complicated rules to derive an appropriate instance with the right <code>transform</code>-function.</p>\n\n<hr>\n\n<p><strong>(Optional):</strong> Just to give an impression of what I'm looking for. Here is a completely analogous example from <code>Scala</code>:</p>\n\n<pre><code> // typeclass providing a transformation from `X` to `Y`\n trait Transform[X, Y] {\n   def transform(x: X): Y\n }\n\n // Some data migration path ending with `X`\n sealed trait MigrationPath[X] {\n   def migrate[Y](implicit t: Transform[X, Y]): MigrationPath[Y] = Migrate(this, t)\n }\n case class Source[X](x: X) extends MigrationPath[X]\n case class Migrate[A, X](a: MigrationPath[A], t: Transform[A, X]) extends MigrationPath[X]\n\n\n // really bad implementation of fractions\n case class Q(num: Int, denom: Int) {\n   def toInt: Int = num / denom\n }\n\n // typeclass instances for various type combinations\n implicit object TransformStringDouble extends Transform[String, Double] {\n   def transform(s: String) = s.toDouble\n }\n\n implicit object TransformStringQ extends Transform[String, Q] {\n   def transform(s: String) = Q(s.split(\"/\")(0).toInt, s.split(\"/\")(1).toInt)\n }\n\n implicit object TransformDoubleInt extends Transform[Double, Int] {\n   def transform(d: Double) = d.toInt\n }\n\n implicit object TransformQInt extends Transform[Q, Int] {\n   def transform(q: Q) = q.toInt\n }\n\n // constructing migration paths that yield `Int`\n val leftPath = Source(\"3.33\").migrate[Double].migrate[Int]\n val rightPath = Source(\"10/3\").migrate[Q].migrate[Int]\n</code></pre>\n\n<p>Notice how <code>migrate</code>-method requires nothing but the \"next type\", not the type ascription for the entire expression constructed so far.</p>\n\n<hr>\n\n<p><strong>Related:</strong> I want to note that this question is not an exact duplicate of <a href=\"https://stackoverflow.com/questions/10039274/pass-types-as-arguments-to-a-function-in-haskell\">\"Pass Types as arguments to a function in Haskell?\"</a>. My use case is a bit different. I also tend to disagree with the answers there that \"it's not possible / you don't need it\", because I actually <em>do have a solution</em>, it's just rather ugly from the purely syntactical point of view.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1518466480, "post_id": 48754141, "comment_id": 84510354, "body": "<a href=\"http://hackage.haskell.org/package/list-t-1.0.0.1/docs/ListT.html\" rel=\"nofollow noreferrer\">ListT</a> is probably relevant here."}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 9261858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df1d12f9e960a7d9227643a8570fbdd?s=128&d=identicon&r=PG&f=1", "display_name": "Retired Writing Code for Fun", "link": "https://stackoverflow.com/users/9261858/retired-writing-code-for-fun"}, "edited": false, "score": 0, "creation_date": 1518470251, "post_id": 48754809, "comment_id": 84512266, "body": "Many thanks. I was aware that the list comprehension could be written in do notation. I was mesmerised by the nested lists - the code of my real problem has a third level of nesting - and I had not understood that the monadic function should be written to return a ListT (Writer [String]) MyType rather than a Writer [String] [MyType]. I was aware that ListT has problems, and will look at Wagner&#39;s proposal. The log will only be useful if the entries are in order. In this toy example they are, but I don&#39;t yet know whether the real code will be different."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 6, "last_activity_date": 1518468926, "last_edit_date": 1518468926, "creation_date": 1518466492, "answer_id": 48754809, "question_id": 48754141, "link": "https://stackoverflow.com/questions/48754141/is-there-a-more-readable-way-of-rewriting-this-pure-function-to-use-the-writer-m/48754809#48754809", "title": "Is there a more readable way of rewriting this pure function to use the Writer Monad?", "body": "<p>It is often awkward to equip pure Haskell functions, which are structured in an algebraic, highly branched tree manner, with a monadic feature such as logging, which requires a more &ldquo;imperative&rdquo; structure. However, sometimes it is actually quite natural to write even pure computations using monadic combinators, and yours is in fact one of these. Namely, the list comprehension that's at the heart of <code>fNonMonadic</code> is already basically using the <em>list monad</em>; it can be written thus:</p>\n\n<pre><code>type ListM = []   -- Just to distinguish where I use list as a monad\n\nfNonMonadic :: [[Int]] -&gt; ListM [Int]\nfNonMonadic [] = return []\nfNonMonadic (first : rest) = do\n    e &lt;- first\n    s &lt;- fNonMonadic $ fun e rest\n    return $ first ++ s\n</code></pre>\n\n<p>Starting from that, it is much easier to add the writer functionality, by using it as the base of a <em>monad transformer stack</em>. The list must then be used in transformer shape, too:</p>\n\n<pre><code>import Control.Monad.Trans.List\n\nfMonTrafo :: [[Int]] -&gt; ListT (Writer [String]) [Int]\nfMonTrafo [] = do\n    lift $ tell [\"base case\"]\n    return []\nfMonTrafo (first : rest) = do\n    e &lt;- ListT $ pure first\n    lift $ tell [\"recursive case \" ++ show e]\n    s &lt;- fMonTrafo $ fun e rest\n    return $ first ++ s\n</code></pre>\n\n<p>You may notice that the documentation of <code>ListT</code> warns that the base monad should be <em>commutative</em>, which <code>Writer</code> actually isn't &ndash; the order of log entries may get messed up. I don't know if this matters here. If yes, check out <a href=\"http://hackage.haskell.org/package/list-t-1.0.0.1/docs/ListT.html\" rel=\"nofollow noreferrer\">the alternative implementation suggested by Daniel Wagner</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 161, "user_id": 9261858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df1d12f9e960a7d9227643a8570fbdd?s=128&d=identicon&r=PG&f=1", "display_name": "Retired Writing Code for Fun", "link": "https://stackoverflow.com/users/9261858/retired-writing-code-for-fun"}, "is_accepted": false, "score": 2, "last_activity_date": 1518519309, "creation_date": 1518519309, "answer_id": 48765142, "question_id": 48754141, "link": "https://stackoverflow.com/questions/48754141/is-there-a-more-readable-way-of-rewriting-this-pure-function-to-use-the-writer-m/48765142#48765142", "title": "Is there a more readable way of rewriting this pure function to use the Writer Monad?", "body": "<p>I looked at several alternatives to Control.Monad.Trans.List, and soon settled on module ListT from Volkov's list-t package.</p>\n\n<p>This gives the same result as my ugly fMonadic function, but more readable code. It also works correctly, and leads to readable code, in the real problem I want to solve.</p>\n\n<p>In the real problem, the ListT-based code runs slightly more slowly than the ugly code, but the difference isn't enough to matter.</p>\n\n<p>Many thanks again for leftaroundabout's help with this.</p>\n\n<p>For reference, here is the revised version of the toy example, doing the computation the three different ways and showing that the answer is the same:</p>\n\n<pre><code>import Control.Monad (forM)\nimport ListT (ListT, fromFoldable, toList)\nimport Control.Monad.Writer (Writer, lift, runWriter, tell)\n\nfun :: Int -&gt; [[Int]] -&gt; [[Int]]\nfun a b = map (map (a +)) b\n\nfNonMonadic :: [[Int]] -&gt; [[Int]]\nfNonMonadic [] = [[]]\nfNonMonadic (first : rest) = do\n    e &lt;- first\n    s &lt;- fNonMonadic $ fun e rest\n    return $ first ++ s\n    -- The above do notation means the same as this list comprehension:\n    -- [ first ++ s\n    -- | e &lt;- first\n    -- , s &lt;- fNonMonadic $ fun e rest]\n\nfMonadic :: [[Int]] -&gt; Writer [String] [[Int]]\nfMonadic [] = do\n    tell [\"base case\"]\n    return [[]]\nfMonadic (first : rest) =\n    fmap concat . forM first $ \\ e -&gt; do\n        tell [\"recursive case \" ++ show e]\n        fmap (map (first ++)) $ fMonadic $ fun e rest\n\nfMonTrafo :: [[Int]] -&gt; ListT (Writer [String]) [Int]\nfMonTrafo [] = do\n    lift $ tell [\"base case\"]\n    return []\nfMonTrafo (first : rest) = do\n    e &lt;- fromFoldable first\n    lift $ tell [\"recursive case \" ++ show e]\n    s &lt;- fMonTrafo $ fun e rest\n    return $ first ++ s\n\nmain = do\n    let arg = [[0, 1], [20, 30], [400, 500]]\n    let x = fNonMonadic arg\n    print x\n    let (a, b) = runWriter $ fMonadic arg\n    print a\n    mapM_ putStrLn b\n    let (c, d) = runWriter $ toList $ fMonTrafo arg\n    print c\n    mapM_ putStrLn d\n    putStrLn $ if x == a then \"fNonMonadic == fMonadic\" else error \"\"\n    putStrLn $ if x == c then \"fNonMonadic == fMonTrafo\" else error \"\"\n    putStrLn $ if b == d then \"fMonadic log == fMonTrafo log\" else error \"\"\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 9261858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df1d12f9e960a7d9227643a8570fbdd?s=128&d=identicon&r=PG&f=1", "display_name": "Retired Writing Code for Fun", "link": "https://stackoverflow.com/users/9261858/retired-writing-code-for-fun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1518519309, "creation_date": 1518463906, "question_id": 48754141, "link": "https://stackoverflow.com/questions/48754141/is-there-a-more-readable-way-of-rewriting-this-pure-function-to-use-the-writer-m", "title": "Is there a more readable way of rewriting this pure function to use the Writer Monad?", "body": "<p>I wrote a recursive algorithm using a list comprehension to perform the recursion. I thought my code was clear and easy to read, and the results it produced were correct.</p>\n\n<p>However, I found it difficult to understand the performance of my code on certain inputs. I thought it would be useful to use the Writer monad to put some logging into my code.</p>\n\n<p>I found it quite difficult to convert my non-monadic code to monadic. Eventually I got it to compile and run correctly, but the monadic code is much less understandable than the original.</p>\n\n<p>The original problem is too complex to explain here, so I have written a toy example that shows the non-monadic and monadic approaches, but doesn't actually calculate anything useful!</p>\n\n<p>So my question is: is there a better way to write the function fMonadic, such that it is more readable?</p>\n\n<pre><code>import Control.Monad (forM)\nimport Control.Monad.Writer (Writer, runWriter, tell)\n\nfun :: Int -&gt; [[Int]] -&gt; [[Int]]\nfun a b = map (map (a +)) b\n\nfNonMonadic :: [[Int]] -&gt; [[Int]]\nfNonMonadic [] = [[]]\nfNonMonadic (first : rest) =\n    [ first ++ s\n    | e &lt;- first\n    , s &lt;- fNonMonadic $ fun e rest]\n\nfMonadic :: [[Int]] -&gt; Writer [String] [[Int]]\nfMonadic [] = do\n    tell [\"base case\"]\n    return [[]]\nfMonadic (first : rest) =\n    fmap concat . forM first $ \\ e -&gt; do\n        tell [\"recursive case \" ++ show e]\n        fmap (map (first ++)) $ fMonadic $ fun e rest\n\nmain = do\n    let arg = [[0, 1], [20, 30], [400, 500]]\n    print $ fNonMonadic arg\n    let (a, b) = runWriter $ fMonadic arg\n    print a\n    mapM_ putStrLn b\n</code></pre>\n"}, {"tags": ["linux", "haskell", "haskell-stack"], "owner": {"reputation": 89, "user_id": 1445227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BS2xD.jpg?s=128&g=1", "display_name": "Josh Taylor", "link": "https://stackoverflow.com/users/1445227/josh-taylor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1518461230, "creation_date": 1518461230, "question_id": 48753415, "link": "https://stackoverflow.com/questions/48753415/running-with-packet-capture-permissions-under-stack", "title": "Running with Packet Capture Permissions under Stack", "body": "<p>Not sure if this is more appropriate for <a href=\"https://serverfault.com/\">Server Fault</a> so apologies if this is the case.</p>\n\n<p>I am currently trying to capture packets using the <a href=\"https://hackage.haskell.org/package/pcap-0.4.5.2/docs/Network-Pcap.html\" rel=\"nofollow noreferrer\">Network.Pcap</a> library and have written this wrapper function around it:</p>\n\n<pre><code>getRawPacket :: IO B.ByteString\ngetRawPacket = do\n    deviceName &lt;- lookupDev\n    handle &lt;- openLive deviceName 2048 False (-1) \n    setDirection handle Out\n    nextBS handle &gt;&gt;= (\\(_,p) -&gt; return p)\n</code></pre>\n\n<p>I am using <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">stack</a> to manage the build process. When trying to run <code>getRawPacket</code> in ghci, starting it using <code>sudo stack ghci --allow-different-user</code>, I get expected packet data back. However while running as a normal user e.g. <code>testuser</code> in this example,\nI get back the following message:</p>\n\n<pre><code>*Main Pcs.Capture&gt; getRawPacket\n*** Exception: user error (enp0s25: You don't have permission to capture on that device (socket: Operation not permitted))\n</code></pre>\n\n<p>I have followed the steps on <a href=\"http://daydreamer66.blogspot.co.uk/2014/06/rhel-how-can-non-root-users-can-run.html\" rel=\"nofollow noreferrer\">this blog post</a> but these haven't made any difference. Is it possible to give linux permissions to stack(/testuser/ghc?) to allow it to perform packet operations through ghci?</p>\n\n<p>Also when producing a standalone executable with stack, how can I ensure that the executable can carry out packet capture? How could I apply these permissions as part of the build process?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1518461345, "last_edit_date": 1592644375, "creation_date": 1518460277, "answer_id": 48753174, "question_id": 48752973, "link": "https://stackoverflow.com/questions/48752973/number-of-leaves-is-one-greater-than-number-of-nodes-in-haskell/48753174#48753174", "title": "number of leaves is one greater than number of nodes in Haskell", "body": "<p>The tractable way to do this &quot;by induction&quot; is not using <a href=\"https://en.wikipedia.org/wiki/Mathematical_induction\" rel=\"nofollow noreferrer\"><em>induction on natural numbers</em></a> but rather using <a href=\"https://en.wikipedia.org/wiki/Structural_induction\" rel=\"nofollow noreferrer\"><em>structural induction</em></a>. The proof breaks down like this:</p>\n<h3>Base case</h3>\n<p>The base case is for <code>Leaf x</code>, where <code>x</code> is an <code>Int</code>. So you have to prove that for any <code>x</code></p>\n<pre><code>leaves (Leaf x) = 1 + nodes (Leaf x)\n</code></pre>\n<h3>Inductive step</h3>\n<p>In the inductive step, you assume two inductive hypotheses:</p>\n<ol>\n<li><code>leaves t = 1 + nodes t</code></li>\n<li><code>leaves u = 1 + nodes u</code></li>\n</ol>\n<p>to prove that</p>\n<pre><code>leaves (Node t u) = 1 + nodes (Node t u)\n</code></pre>\n<p>I'll let you fill in the actual proofs.</p>\n<hr />\n<h3>Side note:</h3>\n<p>Structural induction is a generalization of induction on natural numbers. In particular, you can define the natural numbers as</p>\n<pre><code>data Nat = Z | S Nat\n</code></pre>\n<p>You can now do induction with a base case of <code>p Z</code>, and an inductive step that assumes <code>p n</code> and proves <code>p (S n)</code>.</p>\n<p>Structural induction can itself be generalized further, to <a href=\"https://en.wikipedia.org/wiki/Well-founded_relation#Induction_and_recursion\" rel=\"nofollow noreferrer\"><em>well-founded induction</em></a>, which is the most general mathematical notion of induction of which I am aware. Note that the Wikipedia page is based on a classical notion of well-foundedness; <a href=\"https://ncatlab.org/nlab/show/well-founded+relation\" rel=\"nofollow noreferrer\">nLab</a> gives a constructive version that is more tightly tied to well-founded induction.</p>\n"}], "owner": {"reputation": 169, "user_id": 8606156, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/32ed1a7af959d4336bdc6107c1eb83a0?s=128&d=identicon&r=PG&f=1", "display_name": "Pape Sow Traore", "link": "https://stackoverflow.com/users/8606156/pape-sow-traore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 544, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1518464523, "creation_date": 1518459486, "last_edit_date": 1518464523, "question_id": 48752973, "link": "https://stackoverflow.com/questions/48752973/number-of-leaves-is-one-greater-than-number-of-nodes-in-haskell", "title": "number of leaves is one greater than number of nodes in Haskell", "body": "<p>I have to prove that given a binary tree, the number of leaves is equal to the number of nodes plus one using induction in Haskell. \nGiven the following type called Tree: </p>\n\n<pre><code>data Tree = Leaf Int | Node Tree Tree \n</code></pre>\n\n<p>I defined two functions called leaves and nodes which return the number of leaves and nodes respectively:</p>\n\n<p>With induction, I know that I need to prove the base case which is when the number of nodes is 0 and for the induction step, I need to use the induction hypothesis. But that's throwing me off here is that there are two functions and I don't really know to proceed.In the base case, am I supposed to show that if the number of nodes is 0, the number of leaves is 1 or?</p>\n"}, {"tags": ["haskell", "blaze-html"], "answers": [{"comments": [{"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 0, "creation_date": 1518453008, "post_id": 48749673, "comment_id": 84502654, "body": "Awesome. Although could you explain a little more why are <code>link</code> and <code>href</code> broken up like that?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 1, "creation_date": 1518453369, "post_id": 48749673, "comment_id": 84502887, "body": "@Jono: I added a short explanation."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1518453359, "last_edit_date": 1518453359, "creation_date": 1518448747, "answer_id": 48749673, "question_id": 48749558, "link": "https://stackoverflow.com/questions/48749558/iterating-over-lists-in-haskell-do-block/48749673#48749673", "title": "Iterating over lists in Haskell do block?", "body": "<p>You can use <code>mapM_</code> here:</p>\n\n<pre><code><b>thelinks :: [AttributeValue]\nthelinks = [\"list\", \"of\", \"hrefs\"]</b>\n\ndefaultTemplateRaw :: Html\ndefaultTemplateRaw = html $ do\n    H.head $ do\n        meta ! httpEquiv \"Content-Type\" ! content \"text/html; charset=UTF-8\"\n        H.title \"My Hakyll Blog - $title$\"\n        <b>mapM_ ((link ! rel \"stylesheet\" ! type_ \"text/css\" !) . href) thelinks</b></code></pre>\n\n<p>So here we use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:mapM_\" rel=\"nofollow noreferrer\"><strong><code>mapM_ :: Monad m =&gt; (a -&gt; m b) -&gt; t a -&gt; m ()</code></strong></a> to process the monadic function <code>((link ! rel \"stylesheet\" ! type_ \"text/css\" !) . href)</code> for every element of the list <code>thelinks</code>.</p>\n\n<p>We construct the function by using <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow noreferrer\"><em>operator section</em></a>, so:</p>\n\n<pre><code>(link ! rel \"stylesheet\" ! type_ \"text/css\" !)\n</code></pre>\n\n<p>is equivalent with:</p>\n\n<pre><code>\\x -&gt; link ! rel \"stylesheet\" ! type_ \"text/css\" ! x\n</code></pre>\n\n<p>But we can not directly pass an <code>AttributeValue</code> as <code>x</code> to that function: we need to use the <code>href</code> attribute, we do so by using <code>. href</code>, thus thus means that:</p>\n\n<pre><code>  (link ! rel \"stylesheet\" ! type_ \"text/css\" !) . href\n-----------------------------------------------------------------------\n= (\\x -&gt; link ! rel \"stylesheet\" ! type_ \"text/css\" ! x) . href\n-----------------------------------------------------------------------\n= \\y -&gt; (\\x -&gt; link ! rel \"stylesheet\" ! type_ \"text/css\" ! x) (href y)\n-----------------------------------------------------------------------\n= \\y -&gt; (link ! rel \"stylesheet\" ! type_ \"text/css\" ! (href y))\n</code></pre>\n\n<p>So it is a more syntactically convenient way to call the <code>href</code> function on the item of the list, and that result in the structure of <code>link ! ...</code>.</p>\n\n<p>For the given sample list, this produces:</p>\n\n<pre><code>Main L R&gt; putStrLn $ L.unpack $ R.renderHtml defaultTemplateRaw\n&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt;&lt;title&gt;My Hakyll Blog - $title$&lt;/title&gt;&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"list\"&gt;&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"of\"&gt;&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"hrefs\"&gt;&lt;/head&gt;&lt;/html&gt;\n</code></pre>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "accepted_answer_id": 48749673, "answer_count": 1, "score": 3, "last_activity_date": 1518453359, "creation_date": 1518448378, "last_edit_date": 1518452867, "question_id": 48749558, "link": "https://stackoverflow.com/questions/48749558/iterating-over-lists-in-haskell-do-block", "title": "Iterating over lists in Haskell do block?", "body": "<p>I apologize for the bad title, but I don't quite know how to summarize this. </p>\n\n<p>I'm a Haskell beginner, making a website in Haskell (Hakyll) using templates in Blaze-HTML, which uses do notation to make HTML. Here's part of my template: </p>\n\n<pre><code>defaultTemplateRaw :: Html\ndefaultTemplateRaw = html $ do\n    H.head $ do\n        meta ! httpEquiv \"Content-Type\" ! content \"text/html; charset=UTF-8\"\n        H.title \"My Hakyll Blog - $title$\"\n        link ! rel \"stylesheet\" ! type_ \"text/css\" ! href \"/css/main.css\"\n        link ! rel \"stylesheet\" ! type_ \"text/css\" ! href \"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css\"\n        link ! rel \"stylesheet\" ! type_ \"text/css\" ! href \"https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\" \n</code></pre>\n\n<p>Now let's say I wanted to be DRY here, so I wouldn't have all the <code>link</code>s, just a list of URLs in some kind of list comprehension. How would I do that? </p>\n"}, {"tags": ["haskell", "data-structures", "cartesian-product"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1518431151, "post_id": 48743657, "comment_id": 84488252, "body": "Would an instance if <a href=\"https://hackage.haskell.org/package/array-0.5.2.0/docs/Data-Array-IArray.html#t:IArray\" rel=\"nofollow noreferrer\"><code>IArray</code></a> work for you? You can choose its index (<a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Ix.html#t:Ix\" rel=\"nofollow noreferrer\"><code>Ix</code></a>) to be a tuple, but as arrays are stored linearly, you have simple <code>Traversable</code> etc. instances for them."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1518431246, "post_id": 48743657, "comment_id": 84488317, "body": "@PetrPudl&#225;k I&#39;m thinking of using exactly an array, decorated with dimensions of the input. If that&#39;s the best that can be done..."}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1518435149, "post_id": 48743657, "comment_id": 84490678, "body": "Forgive me a possibly really stupid question, but what do you mean by a &quot;cortege&quot;? <code>[[1,2], [&#39;a&#39;, &#39;b&#39;]]</code> doesn&#39;t seem to compile in Haskell? (I&#39;m asking because I have a solution in Scala for a similar problem, and I wonder whether it could be useful in Haskell, but I&#39;m not sure whether I understand correctly what you want.)"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1518435443, "post_id": 48743657, "comment_id": 84490852, "body": "@AndreyTyukin Whoops, looks like <a href=\"https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D1%80%D1%82%D0%B5%D0%B6_(%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B0)\" rel=\"nofollow noreferrer\">this term</a> is not in use in English. What I meant is a totally ordered collection. I will edit it to &quot;sequence&quot;. In English, the corresponding term is, actually, <i>tuple</i>, which is exactly what I was trying to emphasize against. Such things can be represented in Haskell using a <a href=\"https://wiki.haskell.org/Heterogenous_collections\" rel=\"nofollow noreferrer\">heterogenous collection</a>, but it has very boring properties."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1518436582, "post_id": 48743657, "comment_id": 84491564, "body": "This seems to be an interesting question, but I don&#39;t find it easy to understand what it&#39;s about precisely. Could you add some more code/pseudocode/pseudo-signatures? In particular, what&#39;s the relation to tuples \u2013 what would be the closest you could get with them, and why is this not satisfying for you?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518438891, "post_id": 48743657, "comment_id": 84492984, "body": "@leftaroundabout I added two paragraphs of dreams, is it helpful?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518440638, "post_id": 48743657, "comment_id": 84494131, "body": "Yeah, but I still find it too handwaved to answer this. And I still don&#39;t see why tuples don&#39;t fit the bill. \u2014 If you think this would be easy with duck typing, why not add one concrete Python example?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518440740, "post_id": 48743657, "comment_id": 84494197, "body": "@leftaroundabout I&#39;ll think about it and edit further tomorrow then."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1518444790, "post_id": 48743657, "comment_id": 84496812, "body": "This sounds very much like a (fairly famous I think) paper, whose title I can&#39;t remember, about constructing an extensible expression type using typeclasses and type combinators.  Basically, it&#39;s a model of an open coproduct.  You could do the same thing, but instead construct an open product.  I hope somebody else here can help me with the name of the paper"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1518444957, "post_id": 48743657, "comment_id": 84496924, "body": "Ah, here it is, <a href=\"http://www.cs.ru.nl/~W.Swierstra/Publications/DataTypesALaCarte.pdf\" rel=\"nofollow noreferrer\">Data Types A La Carte</a>.  I think you can use analogous techniques to solve your problem."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1518451579, "post_id": 48743657, "comment_id": 84501696, "body": "Perhaps a stupid suggestion but if all you want is to go from some lists to lists of tuples and you have a fixed number of each you can use applicative stuff: <code>f = liftA2 (,)</code> then <code>f [1,2] [T, F]</code> is <code>[(1,T),(1,F),(2,T),(2,F)]</code> and you can also do eg <code>liftA3 (,,)</code>. Obviously this doesn\u2019t work if you want to do this with arbitrary <code>d</code>."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1518466884, "post_id": 48743657, "comment_id": 84510574, "body": "@leftaroundabout I redid it from scratch; is it any better now?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518471370, "post_id": 48743657, "comment_id": 84512796, "body": "Definitely better. What I don&#39;t understand yet \u2013 do you actually want to enforce that the values form a \u201crectangular grid\u201d (i.e., that in a <code>Cartesian a b</code> structure, there exists exactly the same number of <code>b</code> values for each <code>a</code> value, vice versa)? In that case <code>fmap</code> seems very dubious, since you can easily destroy that property by passing in a harmless-looking function. If not, then what should be the semantics of the monoid operation? Some examples would be useful."}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 1, "creation_date": 1518474406, "post_id": 48743657, "comment_id": 84514226, "body": "@Kindaro Just some nitpicking on nomenclature ;) : &quot;Cartesian is monoid&quot; sounds weird. You could say: <code>Sets</code> is a monoidal category with the cartesian product, but then you have to deal with the coherence somehow (you seem to want to &quot;flatten&quot; everything immediately and not distinguish between <code>(A x B) x C</code> and <code>A x (B x C)</code>). It&#39;s somewhat mysterious to me what the &quot;initial Cartesian&quot; is supposed to be. <code>Sets</code> has one initial object: the empty set, it is not a monoid because it&#39;s empty, and therefore lacks an identity element."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518496175, "post_id": 48743657, "comment_id": 84519613, "body": "@leftaroundabout I think it would be great if the rectangularity was preserved. I don&#39;t really get how you plan to destroy it, though; I thought <code>fmap</code> would not change the number of elements? I hope we can simply provide an abstract type to the user, and prove that all internall functions preserve rectangulalrity, rather than type-enforcing it."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1518503585, "post_id": 48743657, "comment_id": 84521913, "body": "@AndreyTyukin I&#39;m not sure I understand the part about coherence."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518522050, "post_id": 48743657, "comment_id": 84532130, "body": "@Kindaro but <code>fmap</code> can easily change what it would <i>mean</i> to be rectangular. For a literal example, you could start with a 2D rectangular grid of float numbers and perform a coordinate rotation by 45&#176;. The result isn&#39;t rectangular WRT to the new coordinate system. Or, simply consider <code>fmap (\\x -&gt; (x,x))</code> on a 1D int grid. The result is diagonal instead of rectangular."}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1518467100, "post_id": 48754450, "comment_id": 84510692, "body": "I remade the question; is it less vague now?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1518470801, "post_id": 48754450, "comment_id": 84512515, "body": "@Kindaro, no, I&#39;m still pretty lost."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1518485628, "last_edit_date": 1518485628, "creation_date": 1518465095, "answer_id": 48754450, "question_id": 48743657, "link": "https://stackoverflow.com/questions/48743657/how-can-i-best-represent-a-cartesian-product-of-some-fixed-dimension/48754450#48754450", "title": "How can I best represent a cartesian product of some fixed dimension?", "body": "<p>The question is fairly vague, but it looks like you might be interested in <code>vinyl</code>-style records. My definitions are a bit different from <code>vinyl</code> proper; use what you like.</p>\n\n<pre><code>{-# language DataKinds, PolyKinds, TypeOperators, GADTs #-}\nmodule Cart where\nimport Data.Kind (Type)\nimport Data.Functor.Identity\n\ninfixr 4 :&lt;\ndata Rec :: [k] -&gt; (k -&gt; Type) -&gt; Type where\n  Nil :: Rec '[] f\n  (:&lt;) :: f a -&gt; Rec as f -&gt; Rec (a ': as) f\n\nnewtype HList xs = HList (Rec xs Identity)\n\nprod :: Rec as [] -&gt; [HList as]\nprod = map HList . go\n  where\n    go :: Rec as [] -&gt; [Rec as Identity]\n    go Nil = [Nil]\n    go (xs :&lt; xss) = [ Identity x :&lt; r | x &lt;- xs, r &lt;- go xss]\n</code></pre>\n\n<p>With appropriate <code>Show</code> instances (straightforward but a bit annoying), you'll get something like</p>\n\n<pre><code>&gt; prod $ [3,4,5] :&lt; [\"hello\", \"goodbye\"] :&lt; ['x'] :&lt; Nil\n\n[ H[3,\"hello\",'x'], H[3,\"goodbye\",'x'], H[4,\"hello\",'x']\n, H[4,\"goodbye\",'x'], H[5,\"hello\",'x'], H[5,\"goodbye\",'x'] ]\n</code></pre>\n\n<p>This version of <code>prod</code> is perhaps a tad too specific, since it only works with <code>Identity</code> and lists. Here's a straightforward generalization, where the traversal function \"splits\" the base functor of the <code>Rec</code> and we use an arbitrary <code>Applicative</code> rather than just <code>[]</code>:</p>\n\n<pre><code>class Trav (t :: (k -&gt; Type) -&gt; Type) where\n  trav :: Applicative g =&gt; (forall a. f a -&gt; g (h a)) -&gt; t f -&gt; g (t h)\n\ninstance Trav (Rec as) where\n  trav f Nil = pure Nil\n  trav f (xs :&lt; xss) = (:&lt;) &lt;$&gt; f xs &lt;*&gt; trav f xss\n</code></pre>\n\n<p>This is just analogous to <a href=\"https://hackage.haskell.org/package/vinyl-0.7.0/docs/Data-Vinyl-Core.html#v:rtraverse\" rel=\"nofollow noreferrer\"><code>Data.Vinyl.rtraverse</code></a>, as I finally bumbled my way into recognizing.</p>\n\n<hr>\n\n<p>Records of this sort don't form a <code>Monoid</code>, because <code>mappend</code> couldn't be typed. But you can certainly append them:</p>\n\n<pre><code>type family (++) xs ys where\n  '[] ++ ys = ys\n  (x ': xs) ++ ys = x ': xs ++ ys\n\n(&gt;&lt;) :: Rec xs f -&gt; Rec ys f -&gt; Rec (xs ++ ys) f\nNil &gt;&lt; ys = ys\n(x :&lt; xs) &gt;&lt; ys = x :&lt; (xs &gt;&lt; ys)\n</code></pre>\n\n<p>This behaves well. In particular, you can append the records and then traverse them, or traverse them and then append the results.</p>\n\n<pre><code>trav f (xs &gt;&lt; ys) = (&gt;&lt;) &lt;$&gt; trav f xs &lt;*&gt; trav f ys\n</code></pre>\n\n<hr>\n\n<p>You can also rearrange them in principled ways (analogous to your bubble device). The type</p>\n\n<pre><code>forall f k (as :: [k]) (bs :: [k]). Rec as f -&gt; Rec bs f\n</code></pre>\n\n<p>can be given to any function that rearranges a <code>Rec</code> without caring what's in it.</p>\n\n<hr>\n\n<p>Since you mention mapping:</p>\n\n<pre><code>class Functor1 (t :: (k -&gt; Type) -&gt; Type) where\n  map1 :: (forall x. f x -&gt; g x) -&gt; t f -&gt; t g\n\ninstance Functor1 (Rec as) where\n  map1 f = runIdentity . trav (\\x -&gt; Identity (f x))\n</code></pre>\n\n<p>Zipping also works:</p>\n\n<pre><code>rzip :: (forall x. f x -&gt; g x -&gt; h x)\n     -&gt; Rec as f -&gt; Rec as g -&gt; Rec as h\nrzip f Nil Nil = Nil\nrzip f (x :&lt; xs) (y :&lt; ys) = f x y :&lt; rzip f xs ys\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": false, "score": 0, "last_activity_date": 1518469523, "last_edit_date": 1518469523, "creation_date": 1518469036, "answer_id": 48755393, "question_id": 48743657, "link": "https://stackoverflow.com/questions/48743657/how-can-i-best-represent-a-cartesian-product-of-some-fixed-dimension/48755393#48755393", "title": "How can I best represent a cartesian product of some fixed dimension?", "body": "<p>Some of the pain may be taken away by a type like this one:</p>\n\n<pre><code>type A e = Array Int e\n\ndata Cartesian v = Cartesian\n    { _dimensions :: [Int]\n    , _values :: A v\n    } deriving (Show, Eq, Ord, Functor, Foldable, Traversable)\n\n-- # Some helper functions.\n\nautoListArray :: [a] -&gt; A a\nautoListArray xs = listArray (0, pred (length xs)) xs\n\n-- | Get elements of an array such that they all belong to the\n--   congruence class c modulo n.\ngetByCongruentIndices :: Int -&gt; Int -&gt; A v -&gt; [v]\ngetByCongruentIndices n c arr =\n    let (low, high) = bounds arr\n    in  (arr !) &lt;$&gt; [low + c, low + c + n.. high]\n\narr :: [v] -&gt; A v\narr = autoListArray\n\nunarr :: A v -&gt; [v]\nunarr = elems\n\ncongr :: Int -&gt; Int -&gt; A v -&gt; [v]\ncongr = getByCongruentIndices\n\ncongr0 :: Int -&gt; A v -&gt; [v]\ncongr0 n = congr n 0\n</code></pre>\n\n<p>I will now go checking boxes about it.</p>\n\n<ul>\n<li><p>Functor, Foldable, Traversable: Magically derivable out of the box.</p></li>\n<li><p>Creating: You may create any Cartesian you wish by incrementally growing a <code>uni</code> with <code>cons</code>.</p>\n\n<pre><code>-- | Consruct a uni-dimensional Cartesian.\nuni :: [v] -&gt; Cartesian v\nuni vs = Cartesian { _dimensions = [length vs], _values = arr vs }\n\n-- | Dimension increment.\ncons :: (u -&gt; v -&gt; w) -&gt; [u] -&gt; Cartesian v -&gt; Cartesian w\ncons f xs Cartesian{..} = Cartesian\n    { _dimensions = length xs: _dimensions\n    , _values = arr [ x `f` y | x &lt;- xs, y &lt;- unarr _values ]\n    }\n</code></pre></li>\n<li><p>Destroying: You may peel off layers of a Cartesian with <code>uncons</code>.</p>\n\n<pre><code>-- | Dimension decrement.\nuncons :: (u -&gt; (v, w)) -&gt; Cartesian u -&gt; Maybe ([v], Cartesian w)\nuncons _ Cartesian { _dimensions = [] } = Nothing\nuncons f Cartesian { _dimensions = (_: ds), _values = xs } =\n    let ys = fmap (fst . f) . congr0 (product ds) $ xs\n        zs = fmap (snd . f) . take (product ds) . unarr $ xs\n    in  Just (ys, Cartesian { _dimensions = ds, _values = arr zs })\n</code></pre></li>\n<li><p>Transpositions: You may change the order of dimensions with the <code>(\u2191)</code>\n<em>bubble</em> device. I don't have a proof, but I'm next to certain you can obtain any transposition you wish. In particular, <code>(\u2191) x 1</code> is equivalent to <code>Data.List.traverse</code>.</p>\n\n<pre><code>-- | Bubble: apply a cycle from 0 to (i - 1) to the dimensions. That is, make the i-th dimension \n--   the first. I believe bubbles to be the generators of the symmetric group.\n(\u2191) :: Cartesian u -&gt; Int -&gt; Cartesian u\nCartesian{..} \u2191 i =\n    let d  = product . drop i $ _dimensions\n        ds = take i _dimensions ++ drop (succ i) _dimensions  -- Delete the i-th.\n    in  Cartesian\n            { _dimensions = ds\n            , _values = arr . concat $ ($ _values) &lt;$&gt; (congr d &lt;$&gt; [0..pred d])\n            }\n</code></pre></li>\n<li><p><code>cons</code>, <code>uncons</code> and <code>(\u2191)</code> allow you to slice and combine again any two Cartesians, or parts thereof. But there is also a way to combine Cartesians directly:</p>\n\n<pre><code>appendWith :: (u -&gt; v -&gt; w) -&gt; Cartesian u -&gt; Cartesian v -&gt; Cartesian w\nappendWith f x y = Cartesian { _dimensions = _dimensions x ++ _dimensions y\n                             , _values = arr [ x `f` y | x &lt;- unarr (_values x), y &lt;- unarr (_values y) ]\n                             }\n</code></pre></li>\n<li><p>You can also zip things:</p>\n\n<pre><code>glue f x y | _dimensions x == _dimensions y\n                = Cartesian\n                    { _dimensions = _dimensions x\n                    , _values = arr $ zipWith f (unarr $ _values x) (unarr $ _values y)\n                    }\n           | otherwise = undefined\n</code></pre></li>\n</ul>\n\n<p>On the downside of this, you have to explicitly provide a binary function that could combine the types you have in your Cartesians, everywhere. This would usually be a tuple constructor, but you are not limited to it.</p>\n\n<p>I had trouble defining an instance of Monoid, particularly the <code>mempty</code> part, and the <em>initial</em> thing is not even near here.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1518485628, "creation_date": 1518429427, "last_edit_date": 1518467231, "question_id": 48743657, "link": "https://stackoverflow.com/questions/48743657/how-can-i-best-represent-a-cartesian-product-of-some-fixed-dimension", "title": "How can I best represent a cartesian product of some fixed dimension?", "body": "<p><em>This question was severely rewritten as per suggestion from @leftaroundabout. An earlier version may be seen in the edit history.</em></p>\n\n<p>Haskell is famous for the fact that it facilitates thought, allowing more direct encoding of mathematical abstractions. Cartesian product is a very basic mental object many are familiar with since the very childhood. Yet, there is barely a type for it in Haskell. I think I need one, to enable my thinking to flow, if nothing else. (Although this post is actually inspired by some down-to-earth code I have at hand.) Let us then form a common understanding of what this Cartesian thing (I'll be calling it just <em>Cartesian</em> for short) is.</p>\n\n<p>Given a sequence of length <code>d :: Int</code> of collections (e.g. <code>[[1,2], ['a', 'b']]</code>), I'd like to have all the combinations of their elements at short reach. That means operating on them as though they were in a usual Functor, Foldable, Traversable, Monoid, and so on. Indeed, we may represent any Cartesian as a suitably nested list of tuples:</p>\n\n<pre><code>type Lattice = [[(x, y)]]\n\ntype WeightedLattice = [[(x, y, w)]]\n\nzipWith2 :: (a -&gt; b -&gt; c) -&gt; [[a]] -&gt; [[b]] -&gt; [[c]]\nzipWith2 f = zipWith (zipWith f)\n\nfmap2 :: (Functor f, Functor g) =&gt; (a -&gt; b) -&gt; g (f a) -&gt; g (f b)\nfmap2 = fmap . fmap\n\nsequence2 :: (Traversable s, Traversable t, Monad m) =&gt; t (s (m a)) -&gt; m (t (s a))\nsequence2 = sequence . fmap sequence\n</code></pre>\n\n<p>Similar constructions can be writ out by hand for any depth of nesting.</p>\n\n<p>We now introduce a distinction between <em>a</em> Cartesian and the <em>initial</em> Cartesian:</p>\n\n<ul>\n<li><p>An n-dimensional Cartesian is constructed from a heterogeneous sequence of collections by taking one element from each collection and combining them, orderly, with a suitably typed function. This, a Cartesian of signature [Int, Char, Bool] may be formed by a function such as:</p>\n\n<pre><code>f :: Int -&gt; Char -&gt; Bool -&gt; Either Char Int\nf i c b = if b then Left c else Right i \n</code></pre></li>\n<li><p>The initial Cartesian is formed with the tuple constructor of matching arity:</p>\n\n<pre><code>initial :: Int -&gt; Char -&gt; Bool -&gt; (Int, Char, Bool)\ninitial = (,,)\n</code></pre></li>\n</ul>\n\n<p>It is easy to see that we may convert the initial Cartesian, represented as a nested list, to any other Cartesian of the like nesting depth, with a function akin to:</p>\n\n<pre><code>    (fmap . ... . fmap) (uncurryN f)\n</code></pre>\n\n<p>However, we may not always come back; indeed, would be hard to recover the right <code>Char</code> from a <code>Right 3</code>. So, the initial Cartesian can be used in place of any particular Cartesian, but not always the other way around.</p>\n\n<p>As an example, we can use the <code>Lattice</code> type defined above to visualize a field, computing its values for some regularly distributed points in space. We would do it with a function that assigns to coordinates a value. There may be any number of such functions, describing different fields in the same points, to each corresponding a Lattice of like dimensions. But there will only be one initial Lattice that contains nothing but coordinates.</p>\n\n<p>However, our nested list encoding has its drawbacks. Besides inducing the ennuy of spelling out all the necessary functions for every next dimension, it is insecure: there is nothing to save you from mistaking an 128 x 64 matrix with a 64 x 128 one and zipping them together, ending up with a 64 x 64 one instead; the order of things in the tuple may or may not correspond to the order of list nesting. On the other hand, the type system works hard against you, not allowing things like <code>foldr (.) id [replicate d concat]</code> that could have saved some pain. Not haskelly at all.</p>\n\n<p>But the deepest source of disappointment with this system is that it does not support in any obvious way the very fundamental intuition of the Cartesian: its Monoid instance. It's a property that allows us to think of a point as having not one, not some, but any number <code>p</code> of properties, easily adding, combining or throwing them away -- like elements of a list, indeed. Being nailed to a certain depth of nesting and a certain tuple arity is having your wings cut. That Cartesian product is a Monoid in the category of <strong>Set</strong> is a basic fact from category theory, but can we define a Monoid over arbirarily nested lists of arbitrarily typed tuples?</p>\n\n<p>So, the challenge of writing a <em>Cartesian done right</em> involves such goals as:</p>\n\n<ul>\n<li><p>Any dimension. A list, a matrix, and any other finite-dimensional space should have like interface. Some selection of the usual <code>Data.List</code> functions should be implementable.</p></li>\n<li><p>Type safety. That is, having the types and the dimensions of a given Cartesian encoded in the type system. For example, if I form a space like <code>[1..3] x ['a', 'b']</code>, and another like <code>[1,2] x ['a'..'c']</code>, they should have distinct readable type, and not zip together.</p></li>\n<li><p>As the Cartesian is determined by the selection of the dimensions, any two Cartesians may be combined just as the lists of their dimensions. For example:</p>\n\n<pre><code>Cartesian [[1..3], ['a', 'b']] &lt;&gt; Cartesian [[True, False]]\n</code></pre>\n\n<p>-- should be the same thing as:</p>\n\n<pre><code>Cartesian [[1..3], ['a', 'b'], [True, False]]\n</code></pre>\n\n<p>-- Just the same as their generating lists would.</p></li>\n<li><p>There should be some notion of the initial Cartesian and the decorations placed over it, so that the coordinates of points are never lost unless the loss is forced. For example, the coordinates of the points of a <code>Lattice</code> should be stored separately of the derived properties of the field it describes. We may then, say, obtain a superposition of fields if the Lattices describing them \"match\".</p></li>\n<li><p>The initial Cartesian should be a Monoid.</p></li>\n</ul>\n\n<p>I sketched some poor thing of a type that's at least somewhat usable and I will post it as an answer in a moment, but for most of the above points I'm at loss. It must take some type trickery. I appreciate any ideas on how to make it.</p>\n"}, {"tags": ["dictionary", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "edited": false, "score": 0, "creation_date": 1518422055, "post_id": 48740729, "comment_id": 84482996, "body": "I have a type error with this function. Couldn&#39;t match  expected type Map Int [Int] with actual type [(Int,[Int])] after loading my file.hs. Yes I&#39;ll edit my question after getting it to work."}, {"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "reply_to_user": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "edited": false, "score": 0, "creation_date": 1518438442, "post_id": 48740729, "comment_id": 84492703, "body": "@DavidEdgar hmm, are you calling it like above? It should compile fine."}, {"owner": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "edited": false, "score": 0, "creation_date": 1518438630, "post_id": 48740729, "comment_id": 84492821, "body": "I have put every thing from import to were in one file.hs and when I do :l error ."}, {"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "reply_to_user": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "edited": false, "score": 0, "creation_date": 1518438984, "post_id": 48740729, "comment_id": 84493054, "body": "@DavidEdgar Ah sorry my bad, was calling <code>fromList</code> twice. Try it now. Their might be some logic inaccuracies but the overall idea is fine."}, {"owner": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "edited": false, "score": 0, "creation_date": 1518439415, "post_id": 48740729, "comment_id": 84493350, "body": "I appreciate your help, it works fine now as expected."}], "tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": true, "score": 3, "last_activity_date": 1518438950, "last_edit_date": 1518438950, "creation_date": 1518417174, "answer_id": 48740729, "question_id": 48740383, "link": "https://stackoverflow.com/questions/48740383/haskell-insert-or-append-value-inside-associative-list/48740729#48740729", "title": "Haskell: insert or append value inside associative list", "body": "<p>You can try using <a href=\"http://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Map-Lazy.html#v:insertWith\" rel=\"nofollow noreferrer\"><code>insertWith</code></a> instead:</p>\n\n<pre><code>Prelude Data.Map&gt; let myList = fromList [(10,[11,12]),(11,[10,12]),(12,[10])]\nPrelude Data.Map&gt; insertWith (++) 12 [11] myList\nfromList [(10,[11,12]),(11,[10,12]),(12,[11,10])]\n</code></pre>\n\n<p>As for your second requirement, you can try this:</p>\n\n<pre><code>import Prelude hiding (null)\nimport Data.Map\n\ninsertEmpty :: Int -&gt; Int -&gt; Map Int [Int] -&gt; Map Int [Int]\ninsertEmpty x y hmap\n\n    -- If map is empty, return the paired tuples\n    | null hmap = pairs\n\n    -- If the map is the same as pairs, return it unchanged\n    | hmap == pairs = hmap\n\n    -- Otherwise insert into map\n    | otherwise = insertWith (++) x [y] hmap\n\n    where pairs = fromList [(x, [y]), (y, [x])]\n</code></pre>\n\n<p>Which works as follows:</p>\n\n<pre><code>*Main&gt; let myList = fromList [(11,[12]),(12,[11])]\n*Main&gt; insertEmpty 11 12 myList\nfromList [(11,[12]),(12,[11])]\n*Main&gt; let myList = fromList []\n*Main&gt; insertEmpty 11 12 myList\nfromList [(11,[12]),(12,[11])]\n*Main&gt; let myList = fromList [(10,[11,12]),(11,[10,12]),(12,[10])]\n*Main&gt; insertEmpty 11 12 myList\nfromList [(10,[11,12]),(11,[12,10,12]),(12,[10])]\n</code></pre>\n"}], "owner": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 884, "favorite_count": 0, "accepted_answer_id": 48740729, "answer_count": 1, "score": 2, "last_activity_date": 1518438950, "creation_date": 1518415329, "question_id": 48740383, "link": "https://stackoverflow.com/questions/48740383/haskell-insert-or-append-value-inside-associative-list", "title": "Haskell: insert or append value inside associative list", "body": "<p>I have an associative list with dynamic size of type Map k [v] like this</p>\n\n<pre><code>myList = fromList [(10,[11,12]),(20,[21,22]),(12,[10,11])]\n</code></pre>\n\n<p>in which I want to insert values depending on the key like so</p>\n\n<pre><code>-- insert value 13 in tuple (10,[11,12]) ==&gt; (10,[11,12,13]) \n</code></pre>\n\n<p>I'm getting more familiar with manipulation list but I'm really stack her. When I use insert like this :</p>\n\n<pre><code>--insert value 11 where key equals to 12\ninsert 12 [11] (fromList [(10,[11,12]),(11,[10,12]),(12,[10])]) == fromList [(10,[11,12]),(11,[10,12]),(12,[11])]\n</code></pre>\n\n<p>It does not produce [10,11] but rather replace [10] by [11].</p>\n\n<p>And if my list is empty. <code>myList = fromList Map.empty</code>and I want to insert a tuple (10,11) to my list. I want to expect this behavior as a result</p>\n\n<pre><code>myList = insert 10 11 Map.empty ==&gt; [(10,[11]),(11,[10]))]\n</code></pre>\n\n<p>Any indications, ideas or hints are welcomed.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 868, "user_id": 5485014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b581a2d3ec981221fd4fec5118766e9?s=128&d=identicon&r=PG&f=1", "display_name": "Anis Jonischkeit", "link": "https://stackoverflow.com/users/5485014/anis-jonischkeit"}, "edited": false, "score": 0, "creation_date": 1518412587, "post_id": 48739861, "comment_id": 84479419, "body": "It is unclear to me for what condition you are trying to filter. what makes just <code>[Positive 10, Negative 1]</code> get removed. To me it would seem that in your example you would still end with <code>[[]]</code>"}, {"owner": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "reply_to_user": {"reputation": 868, "user_id": 5485014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b581a2d3ec981221fd4fec5118766e9?s=128&d=identicon&r=PG&f=1", "display_name": "Anis Jonischkeit", "link": "https://stackoverflow.com/users/5485014/anis-jonischkeit"}, "edited": false, "score": 0, "creation_date": 1518412752, "post_id": 48739861, "comment_id": 84479469, "body": "[Positive 10, Negative 1] is removed because removePos [[Positive 10, Negative 1], [Positive 2, Negative 2, Positive 1], [Positive 1]] removes any list that contains Positive 10. The idea is that the function checks the first element in the first list. If it is Positive, remove all lists that contain Positive x."}, {"owner": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "reply_to_user": {"reputation": 868, "user_id": 5485014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b581a2d3ec981221fd4fec5118766e9?s=128&d=identicon&r=PG&f=1", "display_name": "Anis Jonischkeit", "link": "https://stackoverflow.com/users/5485014/anis-jonischkeit"}, "edited": false, "score": 0, "creation_date": 1518413085, "post_id": 48739861, "comment_id": 84479537, "body": "For further examples, lets say I have a basket with bowls of fruits in it. The basket is the nested list, the bowls are lists within it. Now, I take a look in the basket. I check the first bowl. I look at the first fruit in the bowl, and determine that I don&#39;t want to eat that fruit from any of the bowls. So I throw out all bowls that contain that fruit, and give you back your basket."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1518413091, "post_id": 48739861, "comment_id": 84479541, "body": "Look at <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><code>filter</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:elem\" rel=\"nofollow noreferrer\"><code>elem</code></a>"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1518413527, "post_id": 48740057, "comment_id": 84479661, "body": "P.S.: <code>not (elem x)</code> is a more straightforward way of writing the test than what I had suggested in <a href=\"https://stackoverflow.com/q/48739022/2751851\">your previous question</a>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1518441644, "last_edit_date": 1518441644, "creation_date": 1518413520, "answer_id": 48740057, "question_id": 48739861, "link": "https://stackoverflow.com/questions/48739861/haskell-filtering-a-nested-list-with-data-constructors/48740057#48740057", "title": "Haskell filtering a nested list with data constructors", "body": "<p>One way is pattern matching on the nested list to peek at the first element of the first list to figure out what you need to filter:</p>\n\n<pre><code>-- Note you could give this the more general type Eq a =&gt; [[a]] -&gt; [[a]]\n-- (as well as a more appropriate name)\nremovePos :: [[Number]] -&gt; [[Number]]\nremovePos [] = [] -- Empty list case.\nremovePos xss@[[]:_] = xss -- If the first inner list is empty,\n                           -- return the whole thing unchanged\nremovePos ((x:_):xss) = filter (notElem x) xss\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 48740057, "answer_count": 1, "score": -3, "last_activity_date": 1518441644, "creation_date": 1518412149, "last_edit_date": 1518413823, "question_id": 48739861, "link": "https://stackoverflow.com/questions/48739861/haskell-filtering-a-nested-list-with-data-constructors", "title": "Haskell filtering a nested list with data constructors", "body": "<p>Let's say I have the following data type</p>\n\n<pre><code>data Number = Positive Integer | Negative Integer\n     deriving (Eq, Show)\n</code></pre>\n\n<p>I have a function definition of (NOTE THAT I CANNOT CHANGE THIS DEFINITION, OR WORK AROUND IT IN ANY WAY. I have to work with the nested list and modify it in some way)</p>\n\n<pre><code>removePos :: [[Number]] -&gt; [[Number]]\n</code></pre>\n\n<p>So we have a nested list of Number. An example would be</p>\n\n<pre><code>[[Positive 1, Negative 1], [Positive 2, Negative 2, Positive 1], [Positive 1]]\n</code></pre>\n\n<p>How can I write removePos so that it removes all lists in the nested list that contain Positive x, where x is A SPECIFIC Integer? The function is essentially looking at the first element in the first list, if it is Positive then remove all lists that contain Positive x.</p>\n\n<p>Essentially, if we took a look at the example above, the output would be</p>\n\n<pre><code>[[]]\n</code></pre>\n\n<p>Note that the user performs the following function call</p>\n\n<pre><code>removePos [[Positive 1, Negative 1], [Positive 2, Negative 2, Positive 1], [Positive 1]]\n</code></pre>\n\n<p>Since each list in the nested list above contains Positive 1, the output is simply an empty nested list (All lists with Positive x are removed). However, if the first element in the first list was Positive 10, the output would be</p>\n\n<pre><code>[[Positive 2, Negative 2, Positive 1], [Positive 1]]\n</code></pre>\n\n<p>(Because the first list would have [Positive 10, Negative 1], which would get removed)</p>\n\n<p>Any ideas?</p>\n\n<p>EDIT:</p>\n\n<p>For further examples, lets say I have a basket with bowls of fruits in it. The basket is the nested list, the bowls are lists within it. Now, I take a look in the basket. I check the first bowl. I look at the first fruit in the bowl, and determine that I don't want to eat that fruit from any of the bowls. So I throw out all bowls that contain that fruit, and give you back your basket.</p>\n"}, {"tags": ["list", "haskell", "recursion", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "edited": false, "score": 0, "creation_date": 1518407723, "post_id": 48739282, "comment_id": 84478275, "body": "How would I do it without deriving Eq? Also, for the pattern matching, you wrote the function excludeHaha = filter (all (/= Funny &quot;Haha&quot;)). But, you hardcoded the value &quot;Haha&quot;, how would I do it for the general case? For example, if the String said &quot;X&quot;, the function would destroy all the lists that are Funny &quot;X&quot;. Or if the String was &quot;Y&quot;, the function would destroy all lists that had Funny &quot;Y&quot;."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "edited": false, "score": 0, "creation_date": 1518408860, "post_id": 48739282, "comment_id": 84478541, "body": "@Lol I added that to the answer as well."}, {"owner": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "edited": false, "score": 0, "creation_date": 1518409728, "post_id": 48739282, "comment_id": 84478730, "body": "I guess what I&#39;m trying to do is: Given a nested list, check the first list, and then check the first element. If it is Funny, then remove all lists in the nested list that contain Funny x, and return the updated nested list. But the problem is the user is inputting only [[Joke]], so I&#39;m never explicitly given a string s."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "edited": false, "score": 0, "creation_date": 1518410056, "post_id": 48739282, "comment_id": 84478816, "body": "@Lol I&#39;m not sure what you mean with the last part -- do you know in advance the string you would give to <code>excludeAFunnyJoke</code>?"}, {"owner": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "edited": false, "score": 0, "creation_date": 1518410118, "post_id": 48739282, "comment_id": 84478828, "body": "a string x*****"}, {"owner": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "edited": false, "score": 0, "creation_date": 1518410172, "post_id": 48739282, "comment_id": 84478838, "body": "No, I&#39;m only given a [[Joke]] so I have to determine what the string is. So, user inputs [[Funny &quot;lol&quot;, Lame &quot;lol&quot;], [Funny &quot;hi&quot;, Lame &quot;yes&quot;]] and only that. So I have to check the first list, and see if the joke is Funny. If it is, then remove all lists with Funny &quot;lol&quot; in it - the string is &quot;lol&quot; but I don&#39;t know this, I have to find out somehow."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "edited": false, "score": 0, "creation_date": 1518410819, "post_id": 48739282, "comment_id": 84478985, "body": "@Lol One way is using pattern matching on the <code>[[Joke]]</code> to get hold of the first element of the first list (just don&#39;t forget to handle all cases, including the empty list ones!), and then call <code>excludeAFunnyJoke</code> in the appropriate case."}, {"owner": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "edited": false, "score": 0, "creation_date": 1518411179, "post_id": 48739282, "comment_id": 84479092, "body": "Yeah, I figured. I tried to use pattern matching but it didn&#39;t compile when I used the filter command you provided. I edited my post above, can you please take a look?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "edited": false, "score": 0, "creation_date": 1518411511, "post_id": 48739282, "comment_id": 84479155, "body": "@Lol Could you please move the &quot;Part 2&quot; you just added, together with the explanation of your requirements in these comments, to a new question? It gets confusing to other readers (and answerers) if multiple questions are rolled into one."}, {"owner": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "edited": false, "score": 0, "creation_date": 1518412360, "post_id": 48739282, "comment_id": 84479364, "body": "@duploade Sure, I created a new thread. Really appreciate your help! <a href=\"https://stackoverflow.com/questions/48739861/haskell-filtering-a-nested-list-with-data-constructors\" title=\"haskell filtering a nested list with data constructors\">stackoverflow.com/questions/48739861/&hellip;</a>"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 4, "last_activity_date": 1518441736, "last_edit_date": 1518441736, "creation_date": 1518407417, "answer_id": 48739282, "question_id": 48739022, "link": "https://stackoverflow.com/questions/48739022/haskell-filtering-a-nested-list-with-specific-data-constructors/48739282#48739282", "title": "Haskell filtering a nested list with specific data constructors", "body": "<p>As a preliminary step, let's derive <code>Eq</code> and <code>Show</code> instances for your type:</p>\n\n<pre><code>data Joke = Funny String | Lame String\n    deriving (Eq, Show)\n</code></pre>\n\n<p><code>Eq</code> makes it possible to test the (in)equality of <code>Joke</code>s, while <code>Show</code> makes it possible to display the results of your tests in GHCi.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><code>filter</code></a> is the right tool here:</p>\n\n<pre><code>excludeHaha :: [[Joke]] -&gt; [[Joke]]\nexcludeHaha = filter (notElem (Funny \"Haha\"))\n</code></pre>\n\n<p>This filters the (outer) list so that only inner lists with all elements different from <code>Funny \"Haha\"</code> are kept.</p>\n\n<p>Trying it out:</p>\n\n<pre><code>GHCi&gt; excludeHaha [[Funny \"Haha\", Lame \"boo\"], [Funny \"Haha\"], [Lame \"BOO\"]]\n[[Lame \"BOO\"]]\n</code></pre>\n\n<p>If you don't want to hardcode <code>\"Haha\"</code>, add a parameter and pass it on to the test:</p>\n\n<pre><code>excludeAFunnyJoke :: String -&gt; [[Joke]] -&gt; [[Joke]]\nexcludeAFunnyJoke s = filter (notElem (Funny s))\n</code></pre>\n\n\n\n<pre><code>GHCi&gt; excludeAFunnyJoke \"LOL\" [[Funny \"LOL\", Lame \"boo\"], [Funny \"Haha\"], [Lame \"BOO\"]]\n[[Funny \"Haha\"],[Lame \"BOO\"]]\n</code></pre>\n\n<p>If you wanted instead to exclude all <code>Funny</code> jokes, regardless of what the contained <code>String</code> is, you could use pattern matching to define an appropriate test:</p>\n\n<pre><code>excludeFunny :: [[Joke]] -&gt; [[Joke]]\nexcludeFunny = filter (all (not . isFunny))\n    where\n    isFunny :: Joke -&gt; Bool\n    isFunny joke = case joke of\n        Funny _ -&gt; True\n        _ -&gt; False\n</code></pre>\n\n<p>The filtering test here uses <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:any\" rel=\"nofollow noreferrer\"><code>all</code></a>, which applies its own test (here, <code>(/= Funny \"Haha\")</code>) to the elements of the (inner) list and then folds the resulting <code>[Bool]</code> with <code>(&amp;&amp;)</code>.</p>\n\n<p>(You might as well define <code>isLame</code> and use it instead of <code>not . isFunny</code> -- note, though, that that would only work because you happen to have just two constructors.)</p>\n\n<pre><code>GHCi&gt; excludeFunny [[Funny \"LOL\", Lame \"boo\"], [Funny \"Haha\"], [Lame \"BOO\"]]\n[[Lame \"BOO\"]]\n</code></pre>\n\n<hr>\n\n<p>P.S.: A manual implementation of the <code>Eq</code> instance would look like this:</p>\n\n<pre><code>instance Eq Joke where\n    Funny x == Funny y = x == y\n    Lame x == Lame y = x == y\n    Funny _ == Lame _ = False\n    Lame _ == Funny _ = False\n</code></pre>\n\n<p>You might replace the last two cases by a catch-all (<code>_ == _ = False</code>), saving one line at the cost of making it a little easier to forget updating the instance if you ever add more constructors to <code>Joke</code>. In any case, such definitions are boring busywork, so we avoid it with <code>deriving</code> unless there is a need for a non-obvious equality test.</p>\n"}], "owner": {"reputation": 23, "user_id": 8972313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/471dcc2f89e1220cd828fc3a54591953?s=128&d=identicon&r=PG&f=1", "display_name": "Lol", "link": "https://stackoverflow.com/users/8972313/lol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 526, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1518441736, "creation_date": 1518404859, "last_edit_date": 1518413797, "question_id": 48739022, "link": "https://stackoverflow.com/questions/48739022/haskell-filtering-a-nested-list-with-specific-data-constructors", "title": "Haskell filtering a nested list with specific data constructors", "body": "<p>Suppose I have the data type</p>\n\n<pre><code>data Joke = Funny String | Lame String\n</code></pre>\n\n<p>and say I have the following nested list </p>\n\n<pre><code>[[Funny \"Haha\", Lame \"boo\"], [Funny \"Haha\"], [Lame \"BOO\"]]\n</code></pre>\n\n<p>How would I go about filtering such a nested list so that any list within the nested list that contains <code>Funny \"Haha\"</code> is removed? In other words, I'm trying to filter the list so that I receive the following result:</p>\n\n<pre><code>[[Lame \"BOO\"]] \n</code></pre>\n\n<p>Any list that contains <code>Funny \"Haha\"</code> is removed.</p>\n\n<p>Would appreciate any help, I'm having a terrible time learning Haskell and how to do things with lists and custom data types.</p>\n"}, {"tags": ["haskell", "happstack", "hdbc"], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 7261242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd3fbb96a69be29d333a5f518ea175b?s=128&d=identicon&r=PG&f=1", "display_name": "asp", "link": "https://stackoverflow.com/users/7261242/asp"}, "edited": false, "score": 0, "creation_date": 1518608769, "post_id": 48739859, "comment_id": 84574177, "body": "Thanks alot and sorry for being late accepting your answer. (I had hard time trying to logging in to my account!!)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 47, "user_id": 7261242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd3fbb96a69be29d333a5f518ea175b?s=128&d=identicon&r=PG&f=1", "display_name": "asp", "link": "https://stackoverflow.com/users/7261242/asp"}, "edited": false, "score": 0, "creation_date": 1518613892, "post_id": 48739859, "comment_id": 84577675, "body": "@asp No worries :)"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1518412140, "creation_date": 1518412140, "answer_id": 48739859, "question_id": 48738375, "link": "https://stackoverflow.com/questions/48738375/whats-the-syntax-of-using-multiple-handlers-in-happstack/48739859#48739859", "title": "What&#39;s the syntax of using multiple handlers in Happstack?", "body": "<p><code>fileServing</code>, <code>myGetData</code>, <code>msum [fileServing]</code>, <code>msum [myGetData]</code> and <code>handlers</code> all have <code>ServerPart Response</code> type, which is the type of what you are passing to <code>simpleHTTP nullConf</code> in <code>mainFunc</code>. That being so, you probably want...</p>\n\n<pre><code>mainFunc = simpleHTTP nullConf handlers\n\n-- etc.\n\nhandlers :: ServerPart Response\nhandlers =\n    do decodeBody myPolicy\n       msum [ fileServing\n            , myGetData\n            ]\n</code></pre>\n\n<p><code>msum</code> here combines a list of handlers into a single handler (note that also means <code>msum</code> on a list with a single handler is redundant).</p>\n"}], "owner": {"reputation": 47, "user_id": 7261242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd3fbb96a69be29d333a5f518ea175b?s=128&d=identicon&r=PG&f=1", "display_name": "asp", "link": "https://stackoverflow.com/users/7261242/asp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 48739859, "answer_count": 1, "score": 1, "last_activity_date": 1518412140, "creation_date": 1518398941, "last_edit_date": 1518400479, "question_id": 48738375, "link": "https://stackoverflow.com/questions/48738375/whats-the-syntax-of-using-multiple-handlers-in-happstack", "title": "What&#39;s the syntax of using multiple handlers in Happstack?", "body": "<p>Sorry for my basic question, but I'm new to Haskell.</p>\n\n<p>I'm following <a href=\"http://happstack.com/docs/crashcourse/RqData.html#rqdatapost\" rel=\"nofollow noreferrer\">this example</a> to receive some values from a request body, but my server also serves static files from a directory using the following code:</p>\n\n<pre><code>fileServing :: ServerPart Response\nfileServing = serveDirectory EnableBrowsing [\"index.html\"] \"./Path/\"\n\nmainFunc = simpleHTTP nullConf $ msum [ \n                                        fileServing                                     \n                                      ]\n</code></pre>\n\n<p>I added the below code to my library but I'm not sure where to use the <code>handlers</code> function, because I already have an <code>msum</code> in the <code>mainFunc</code>.</p>\n\n<pre><code>handlers :: ServerPart Response\nhandlers =\n    do decodeBody myPolicy\n       msum [ \n               myGetData\n            ]\n\nmyGetData :: ServerPart Response\nmyGetData =\n    do method POST\n       username &lt;- look \"username\"\n       password &lt;- look \"password\"\n       ok $ toResponse (username ++ \", \" ++ password)\n</code></pre>\n"}, {"tags": ["haskell", "concurrency", "conduit"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1518393236, "post_id": 48737541, "comment_id": 84475102, "body": "What thread does the client run in?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1518393253, "post_id": 48737541, "comment_id": 84475112, "body": "Why use an <code>MVar</code> instead of something like a <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Concurrent-Chan.html\" rel=\"nofollow noreferrer\"><code>Chan</code></a>?"}, {"owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1518395426, "post_id": 48737541, "comment_id": 84475597, "body": "Thanks @Cirdec, I was spawning the client in the same thread :) Also, switched from the MVar to Chan, didnt know about it. Much more useful for this case."}, {"owner": {"reputation": 329, "user_id": 6755672, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JR7mu01Cnio/AAAAAAAAAAI/AAAAAAAAAHo/Gg_4gGFpnkU/photo.jpg?sz=128", "display_name": "MadNat", "link": "https://stackoverflow.com/users/6755672/madnat"}, "edited": false, "score": 0, "creation_date": 1518464748, "post_id": 48737541, "comment_id": 84509388, "body": "there is already a library for creating conduits from concurrent channels: <a href=\"https://hackage.haskell.org/package/stm-conduit\" rel=\"nofollow noreferrer\">stm-conduit</a>"}, {"owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "reply_to_user": {"reputation": 329, "user_id": 6755672, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JR7mu01Cnio/AAAAAAAAAAI/AAAAAAAAAHo/Gg_4gGFpnkU/photo.jpg?sz=128", "display_name": "MadNat", "link": "https://stackoverflow.com/users/6755672/madnat"}, "edited": false, "score": 0, "creation_date": 1518534891, "post_id": 48737541, "comment_id": 84540892, "body": "Yep, but I&#39;m currently doing so from <a href=\"https://eta-lang.org/\" rel=\"nofollow noreferrer\">Eta</a>, it&#39;d require to port stm-conduit @MadNat . Thank you :D"}], "answers": [{"tags": [], "owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "is_accepted": true, "score": 1, "last_activity_date": 1518395581, "creation_date": 1518395581, "answer_id": 48737999, "question_id": 48737541, "link": "https://stackoverflow.com/questions/48737541/conduit-source-depending-on-mvar/48737999#48737999", "title": "Conduit Source depending on MVar", "body": "<p>Thanks to the comments that Cirdec made, I've managed to fix the issue.</p>\n\n<p>The problem was that I was spawning the client in the same thread.</p>\n\n<p><code>hookToChan</code> was the responsible of doing so, and I was subscribing to the queue on the same thread. I've just added a <code>forkIO</code> to the <code>hookToChan</code> function, and the issue went away.</p>\n"}], "owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 48737999, "answer_count": 1, "score": 2, "last_activity_date": 1518395581, "creation_date": 1518391240, "question_id": 48737541, "link": "https://stackoverflow.com/questions/48737541/conduit-source-depending-on-mvar", "title": "Conduit Source depending on MVar", "body": "<p>I am implementing a Conduit Source for some client that subscribes to a queue and puts all the arriving messages into an MVar.</p>\n\n<p>The problem is that I cannot read from that MVar to <code>yield</code> those messages through the Conduit Source, as it reports an exception on runtime: <code>thread blocked indefinitely in an MVar operation</code></p>\n\n<pre><code>mqttSource :: (Monad m, MonadIO m, MonadResource m) =&gt; MqttOptions -&gt; Source m String\nmqttSource MqttOptions {..} = do\n  bracketP mkConsumer cleanConsumer runHandler\n where\n  mkConsumer = do\n    chan &lt;- liftIO $ newEmptyMVar\n    client &lt;- liftIO.hookToChan $ chan\n    return (chan, client)\n\n  cleanConsumer (_, client) =\n    liftIO.disconnectClient $ client\n\n  runHandler (chan, client) = do\n    newMsg &lt;- liftIO $ readMVar chan\n    yield newMsg\n    runHandler (chan, client)\n</code></pre>\n\n<p>(<code>hookToChan</code> just tells the client to subscribe to the queue using this function: <code>\\topic msg -&gt; putMVar chan (show msg)</code>)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518388144, "post_id": 48737149, "comment_id": 84473844, "body": "The code you posted doesn&#39;t cause such an error, that apparently happens somewhere else in whatever code you&#39;re trying to compile. Make it an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> please, and post error messages in full."}, {"owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518388550, "post_id": 48737149, "comment_id": 84473962, "body": "Should mention its first haskell project, so could well be something simple I&#39;ve done wrong."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1518388769, "post_id": 48737149, "comment_id": 84474021, "body": "What is <code>Fold</code>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1518389270, "post_id": 48737149, "comment_id": 84474158, "body": "Frankly, I don&#39;t think that&#39;s a good edge of Haskell to start with. Existential quantification is a somewhat advanced topic (and indeed often considered not very idiomatic, though this particular use is rather nice)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518389373, "post_id": 48737149, "comment_id": 84474192, "body": "Doesn&#39;t <code>tally x = HVF x</code> need an additional argument after <code>HVF x</code>?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1518389675, "post_id": 48737149, "comment_id": 84474273, "body": "Why did you change your code after I already posted my answer?"}, {"owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "edited": false, "score": 0, "creation_date": 1518389759, "post_id": 48737149, "comment_id": 84474304, "body": "I just updated after chi pointed out"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1518389830, "post_id": 48737149, "comment_id": 84474320, "body": "Your update changes nothing about <code>tally</code>. It still takes two arguments where it should only take one. However, you also changed the type of <code>hvf</code> and the definition of <code>summarize</code> (along with its type)."}, {"owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "edited": false, "score": 0, "creation_date": 1518389952, "post_id": 48737149, "comment_id": 84474363, "body": "Ok I think I understand what you&#39;re saying about tally now"}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 3, "last_activity_date": 1518389482, "creation_date": 1518389482, "answer_id": 48737342, "question_id": 48737149, "link": "https://stackoverflow.com/questions/48737149/creating-a-parameterized-type-with-multiple-parameters-in-haskell/48737342#48737342", "title": "Creating a parameterized Type with multiple parameters in Haskell", "body": "<p><code>Fold</code> takes two values, a <code>tally</code> function that injects an input value into some monoid, and a <code>summarize</code> function that extracts a result from the monoid.</p>\n\n<p>Informally:</p>\n\n<pre><code>tally :: i -&gt; m\nsummarize :: m -&gt; o\n</code></pre>\n\n<p>where <code>m</code> is some <code>Monoid</code>.</p>\n\n<p>In your code you have</p>\n\n<pre><code>hvf :: (Num a, Ord a) =&gt; Fold a (HVF a b)\nhvf = Fold tally summarize\n  where\n    tally x = HVF x\n\n    summarize (HVF x y) = (HVF x y)\n</code></pre>\n\n<p>Your <code>tally</code> has type <code>a -&gt; Int -&gt; HVF a b</code>, which (because <code>-&gt;</code> in types is right associative) is equivalent to <code>a -&gt; (Int -&gt; HVF a b)</code>. Thus the type checker assumes that your input type <code>i</code> is <code>a</code> and your monoid type <code>m</code> is <code>Int -&gt; HVF a b</code>.</p>\n\n<p>Your <code>summarize</code> has type <code>HVF a b1 -&gt; HVF a b2</code>. However, to be used with <code>Fold tally</code>, it needs to have type <code>m -&gt; o</code> where <code>m</code> is <code>Int -&gt; HVF a b</code>. This is what the error message is complaining about: The type of <code>summarize</code>'s argument is <code>HVF a b1</code>, but <code>summarize</code> is used in a context where it needs to accept an <code>Int -&gt; HVF a b</code>.</p>\n\n<p>I don't understand the rest of your code, but I think you forgot an argument to <code>HVF</code> in <code>tally</code>. Maybe something like <code>tally x = HVF x 0</code>?</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1518389547, "creation_date": 1518389547, "answer_id": 48737347, "question_id": 48737149, "link": "https://stackoverflow.com/questions/48737149/creating-a-parameterized-type-with-multiple-parameters-in-haskell/48737347#48737347", "title": "Creating a parameterized Type with multiple parameters in Haskell", "body": "<p>The error actually lies in <code>tally</code>. That is supposed to have type <code>a -&gt; m</code>, where the monoid is in this case <code>HVF a b</code>, i.e.</p>\n\n<pre><code>tally :: a -&gt; HVF a b\n</code></pre>\n\n<p>but what you've implemented</p>\n\n<pre><code>tally x = HVF x\n</code></pre>\n\n<p>actually has type <code>a -&gt; Int -&gt; HVF a b</code>, because <code>HVF x</code> is still lacking the <code>Int</code> field, i.e. you've only <em>partially</em> applied the <code>HVF</code> value constructor, and due to the way Haskell works in <em>curried mode</em>, that lacking argument is automatically deferred as an extra argument to the <code>tally</code> function.</p>\n\n<p>Somewhat curiously though, this in itself is <em>not</em> a type error: the signature <code>a -&gt; Int -&gt; HVF a b</code> has in fact <em>also</em> the form <code>a -&gt; m</code>, but <code>m</code> is in this case the function type <code>Int -&gt; HVF a b</code>. Indeed, that function type has a <code>Monoid</code> instance too!</p>\n\n<p>But this then means that you'd also need the type</p>\n\n<pre><code>summarise :: (Int -&gt; HVF a b) -&gt; HVF a b\n</code></pre>\n\n<p>...but that isn't the type of <code>summarise</code>, it's just</p>\n\n<pre><code>summarise :: HVF a b -&gt; HVF a b\n</code></pre>\n\n<p>hence the rather misleading error message.</p>\n"}], "owner": {"reputation": 2293, "user_id": 259567, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1b7fef03e1f15f2cfd76eee5b0830d3f?s=128&d=identicon&r=PG", "display_name": "ktec", "link": "https://stackoverflow.com/users/259567/ktec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 48737342, "answer_count": 2, "score": 0, "last_activity_date": 1518389981, "creation_date": 1518387995, "last_edit_date": 1518389981, "question_id": 48737149, "link": "https://stackoverflow.com/questions/48737149/creating-a-parameterized-type-with-multiple-parameters-in-haskell", "title": "Creating a parameterized Type with multiple parameters in Haskell", "body": "<p>I've got the following datatype:</p>\n\n<pre><code>data HVF a b = HVF { h1 :: !a\n                   , l1 :: !Int\n                   } deriving (Show, Eq)\n\ninstance Monoid (HVF a b) where {...}\n</code></pre>\n\n<p>And I try to write a function:</p>\n\n<pre><code>hvf :: (Num a, Ord a) =&gt; Fold a (HVF a b)\nhvf = Fold tally summarize\n  where\n    tally x = HVF x\n\n    summarize (HVF x y) = (HVF x y)\n</code></pre>\n\n<p>with</p>\n\n<pre><code>data Fold i o = forall m . Monoid m =&gt; Fold (i -&gt; m) (m -&gt; o)\n</code></pre>\n\n<p>but I get the error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018Int -&gt; HVF a b0\u2019 with \u2018HVF a b1\u2019\n  Expected type: (Int -&gt; HVF a b0) -&gt; HVF a b\n    Actual type: HVF a b1 -&gt; HVF a b\n\u2022 In the second argument of \u2018Fold\u2019, namely \u2018summarize\u2019\n  In the expression: Fold tally summarize\n  In an equation for \u2018hvf\u2019:\n      hvf\n        = Fold tally summarize\n        where\n            tally x = HVF x\n            summarize (HVF x y) = (HVF x y)\n\u2022 Relevant bindings include\n    hvf :: Fold a (HVF a b) (bound at src/Data/HVFScanner/HVF.hs:119:1)\n    |\n119 | hvf = Fold tally summarize\n    |  \n</code></pre>\n\n<p>which I don't understand, can anyone explain in english?</p>\n\n<p>Additional info...</p>\n\n<p><code>Fold</code> is from <a href=\"https://github.com/Gabriel439/slides/blob/master/munihac/foldmap.md#-in-one-slide\" rel=\"nofollow noreferrer\">https://github.com/Gabriel439/slides/blob/master/munihac/foldmap.md#-in-one-slide</a></p>\n"}, {"tags": ["list", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1518383170, "post_id": 48736458, "comment_id": 84472268, "body": "<code>flatten2set = nub . flatten</code>, and <code>flatten = concat</code>."}, {"owner": {"reputation": 11, "user_id": 9347253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93923fe5b519f29a30fbecdb88ef83a8?s=128&d=identicon&r=PG&f=1", "display_name": "KScheer", "link": "https://stackoverflow.com/users/9347253/kscheer"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518383263, "post_id": 48736458, "comment_id": 84472299, "body": "I am sorry, you&#39;re right, but I forgot to add that I want to do this without any predefined libraries."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1518383455, "post_id": 48736458, "comment_id": 84472361, "body": "Try just implementing <code>nub</code>, then, and you\u2019ll be safe to define <code>flatten2set = nub . flatten</code>."}, {"owner": {"reputation": 11, "user_id": 9347253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93923fe5b519f29a30fbecdb88ef83a8?s=128&d=identicon&r=PG&f=1", "display_name": "KScheer", "link": "https://stackoverflow.com/users/9347253/kscheer"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1518384482, "post_id": 48736458, "comment_id": 84472722, "body": "@Ryan, I have tried implementing my own nub, and trying to call the function like you did is giving me an error, can you help out?"}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1518384977, "post_id": 48736458, "comment_id": 84472893, "body": "Can you edit your attempt and the error into your question?"}, {"owner": {"reputation": 11, "user_id": 9347253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93923fe5b519f29a30fbecdb88ef83a8?s=128&d=identicon&r=PG&f=1", "display_name": "KScheer", "link": "https://stackoverflow.com/users/9347253/kscheer"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1518385240, "post_id": 48736458, "comment_id": 84472985, "body": "@Ryan, I have made some edits. I would appreciate any help"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518385316, "post_id": 48736458, "comment_id": 84473014, "body": "You\u2019re matching the parameter <code>[x]</code>, but then writing <code>mynub. flatten</code> rather than <code>(mynub . flatten) [x]</code>. Hence the type error."}, {"owner": {"reputation": 11, "user_id": 9347253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93923fe5b519f29a30fbecdb88ef83a8?s=128&d=identicon&r=PG&f=1", "display_name": "KScheer", "link": "https://stackoverflow.com/users/9347253/kscheer"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518385738, "post_id": 48736458, "comment_id": 84473158, "body": "@Davislor, after adding your edit and trying again I have gotten another error. I have edited the question to reflect that, can you help?"}, {"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1518386998, "post_id": 48736458, "comment_id": 84473516, "body": "Your latest error is basically the compiler telling you that your myNub function expects Eq a, but you&#39;re calling it from flatten2set, which doesn&#39;t make any guarantees about the parameter being a member of the Eq typeclass.  You can follow the instructions from the compiler and add an Eq a =&gt; constraint to your function..."}, {"owner": {"reputation": 11, "user_id": 9347253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93923fe5b519f29a30fbecdb88ef83a8?s=128&d=identicon&r=PG&f=1", "display_name": "KScheer", "link": "https://stackoverflow.com/users/9347253/kscheer"}, "reply_to_user": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 0, "creation_date": 1518387457, "post_id": 48736458, "comment_id": 84473652, "body": "@MarcTalbot, you are right. That took care of it! Now I am getting an error about having non exhaustive patters in flatten2set."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518387503, "post_id": 48736458, "comment_id": 84473665, "body": "That\u2019s because your pattern guards have to match every possible list, and <code>[x]</code> only matches singletons."}, {"owner": {"reputation": 11, "user_id": 9347253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93923fe5b519f29a30fbecdb88ef83a8?s=128&d=identicon&r=PG&f=1", "display_name": "KScheer", "link": "https://stackoverflow.com/users/9347253/kscheer"}, "edited": false, "score": 0, "creation_date": 1518387558, "post_id": 48736458, "comment_id": 84473678, "body": "Do I need a third guard for something such as (x:xs)?"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518395814, "post_id": 48736458, "comment_id": 84475675, "body": "Typically you might match <code>[]</code> and  then <code>(x:xs)</code>, since every list either has no elements or at least one element. So those two guards are, between them, exhaustive."}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 3, "last_activity_date": 1518393268, "creation_date": 1518393268, "answer_id": 48737741, "question_id": 48736458, "link": "https://stackoverflow.com/questions/48736458/how-to-remove-duplicate-items-in-nested-list/48737741#48737741", "title": "How to remove duplicate items in nested list?", "body": "<p>You have an excellent implementation of <code>myNub</code></p>\n\n<pre><code>myNub :: Eq a =&gt; [a] -&gt; [a]\nmyNub (x:xs) = x : filter (/=x) (myNub xs)\nmyNub [] = []\n</code></pre>\n\n<p>Then you try to call it</p>\n\n<pre><code>flatten2set :: [[a]] -&gt; [a]\nflatten2set = myNub . flatten\n</code></pre>\n\n<p>But you've declared that <code>flatten2set</code> works for <em>any</em> <code>a</code>. The compiler is simply pointing out that that cannot be. What if we tried to call <code>flatten2set</code> with a list of lists of functions? It won't work because <code>myNub</code> requires <code>Eq</code> and functions are not comparable. Since we call a function that requires <code>Eq a</code>, we too must require <code>Eq a</code>.</p>\n\n<pre><code>flatten2set :: Eq a =&gt; [[a]] -&gt; [a]\nflatten2set = myNub . flatten\n</code></pre>\n\n<p>I took the liberty of removing the <code>[x]</code>, which had no purpose. If you really want to have an argument, you just name the argument. There's no need to pattern match on it.</p>\n\n<pre><code>flatten2set :: Eq a =&gt; [[a]] -&gt; [a]\nflatten2set x = (myNub . flatten) x\n</code></pre>\n\n<p>Using <code>[x]</code> is an assertion that, in this case, the list will contain exactly one element, and we want <code>flatten2set</code> to work on lists containing any number of elements.</p>\n"}], "owner": {"reputation": 11, "user_id": 9347253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93923fe5b519f29a30fbecdb88ef83a8?s=128&d=identicon&r=PG&f=1", "display_name": "KScheer", "link": "https://stackoverflow.com/users/9347253/kscheer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1518393268, "creation_date": 1518383127, "last_edit_date": 1518385709, "question_id": 48736458, "link": "https://stackoverflow.com/questions/48736458/how-to-remove-duplicate-items-in-nested-list", "title": "How to remove duplicate items in nested list?", "body": "<p>I have a Haskel function called flatten that works as such:</p>\n\n<pre><code>flatten :: [[a]] -&gt; [a] \nflatten []            = []\nflatten ([]:vs)       = flatten vs\nflatten ((x:xs):vs)   = x:flatten (xs:vs)\n</code></pre>\n\n<p>It takes a list of lists and combines it into one list. How can I make another function called flatten2set that works exactly like flatten (or calls flatten), but removes all duplicates, if any? I want to try and do this without tools like nub.</p>\n\n<p>An example would be:</p>\n\n<pre><code>flatten2set [[1],[5,1,4],[9,1,3],[2,5]] --&gt; [1,5,4,9,3,2]\n</code></pre>\n\n<p>I have attempted to implement a nub function:</p>\n\n<pre><code>nub:: Eq a =&gt; [a] -&gt; [a]\nnub (x:xs) = x : filter (/=x) (myNub xs)\nnub [] = []\n</code></pre>\n\n<p>And when I have tried to use it like this:</p>\n\n<pre><code>flatten2set :: [[a]] -&gt; [a]\nflatten2set[x] = (myNub . flatten) [x]\n</code></pre>\n\n<p>I receive this error:</p>\n\n<p>testing.hs:20:18: error:</p>\n\n<pre><code>\u2022 No instance for (Eq a) arising from a use of \u2018myNub\u2019\n  Possible fix:\n    add (Eq a) to the context of\n      the type signature for:\n        flatten2set :: forall a. [[a]] -&gt; [a]\n\u2022 In the first argument of \u2018(.)\u2019, namely \u2018myNub\u2019\n  In the expression: myNub . flatten\n  In the expression: (myNub . flatten) [x]\n</code></pre>\n\n<p>Any help would be appreciated!</p>\n"}, {"tags": ["function", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 5, "creation_date": 1518377224, "post_id": 48735389, "comment_id": 84470312, "body": "Why avoid <code>let</code> and <code>where</code>? What about guards?"}, {"owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 4, "creation_date": 1518377399, "post_id": 48735389, "comment_id": 84470381, "body": "<code>listAfterFinalKey xs x = tail $ dropWhile (&#47;=x) xs</code>. Why &quot;avoiding built-in libraries&quot;?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 4, "creation_date": 1518377536, "post_id": 48735389, "comment_id": 84470420, "body": "The resulting list should have no <code>x</code> left. It&#39;s still a one-liner though `listAfterFinalKey xs x = (reverse . takeWhile (/= x) . reverse) xs"}, {"owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1518377830, "post_id": 48735389, "comment_id": 84470524, "body": "@Li-yaoXia My bad. You&#39;re right. Please @ me to let me know it the next time :D"}, {"owner": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "edited": false, "score": 1, "creation_date": 1518378496, "post_id": 48735389, "comment_id": 84470757, "body": "I am avoiding let and where to try and get a better grasp on functional programming. I just did not know if it was possible to condense this down into one or two functions."}, {"owner": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "reply_to_user": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 1, "creation_date": 1518378666, "post_id": 48735389, "comment_id": 84470831, "body": "@SnowOnion I am avoiding built in libraries because I want to do it without anything that is already made, so I understand how it works a little better. I want to understand what is going on instead of calling already made functions and libraries (even though I am sure it would make this much easier)."}, {"owner": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "reply_to_user": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 1, "creation_date": 1518379073, "post_id": 48735389, "comment_id": 84470970, "body": "@SnowOnion, that worked super well! Is there anyway to be able to just return an empty list if the int is not found? Also, if you want to post that as an answer, I can select it as the correct one."}, {"owner": {"reputation": 406, "user_id": 1738086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44ffd4d27d01bce9b3425f88d83975a3?s=128&d=identicon&r=PG", "display_name": "Simon Courtenage", "link": "https://stackoverflow.com/users/1738086/simon-courtenage"}, "reply_to_user": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 0, "creation_date": 1518432127, "post_id": 48735389, "comment_id": 84488868, "body": "@SnowOnion - exactly my thoughts, although you need to make sure the result of the dropWhile is non-empty or tail will throw an exception."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 1, "last_activity_date": 1518448435, "creation_date": 1518448435, "answer_id": 48749576, "question_id": 48735389, "link": "https://stackoverflow.com/questions/48735389/combine-multiple-haskell-functions/48749576#48749576", "title": "Combine multiple Haskell functions", "body": "<p>If you really want to get a good feel for functional programming, it's fine to not immediately jump into using all sorts of built-in functions. Many of those functions, however, <em>are</em> the embodiment of functional programming, so it's useful to learn to use them, and perhaps learn how to replicate them.</p>\n\n<p>The built-in Haskell modules (and, in fact, all Haskell modules I've ever encountered) are open source, so you can easily go and have a look at how they're implemented.</p>\n\n<p>In order to reproduce the above behaviour, you can implement your own versions of <code>elem</code>, <code>dropWhile</code> and <code>tail</code>:</p>\n\n<pre><code>elem' :: Eq a =&gt; a -&gt; [a] -&gt; Bool\nelem'      _    [] = False\nelem' target (x:xs) | target == x = True\nelem' target (_:xs) = elem' target xs\n\ndropWhile' :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\ndropWhile' _ [] = []\ndropWhile' p (x:xs) | p x = dropWhile' p xs\ndropWhile' _ xs = xs\n\ntail' :: [a] -&gt; [a]\ntail' (_:xs) = xs\n</code></pre>\n\n<p>These three functions work pretty much like their 'official' counterparts - I've just added a <code>'</code> as a suffix to all three.</p>\n\n<p>You can now easily implement <code>listAfterFinalKey</code> using those three building blocks:</p>\n\n<pre><code>listAfterFinalKey :: Eq a =&gt; [a] -&gt; a -&gt; [a]\nlistAfterFinalKey xs target | not (elem' target xs) = xs\nlistAfterFinalKey xs target = tail' (dropWhile' (/= target) xs)\n</code></pre>\n\n<p>As far as I can tell, it behaves like the OP version:</p>\n\n<pre><code>*Q48735389&gt; listAfterFinalKey [0..9] 3\n[4,5,6,7,8,9]\n*Q48735389&gt; listAfterFinalKey [0..9] 11\n[0,1,2,3,4,5,6,7,8,9]\n*Q48735389&gt; listAfterFinalKey [0..9] (-1)\n[0,1,2,3,4,5,6,7,8,9]\n*Q48735389&gt; listAfterFinalKey [1,2,3,2,1] 2\n[3,2,1]\n</code></pre>\n\n<p>Not only does it drop all elements before it encounters the <code>target</code>, it also returns the original list if the <code>target</code> isn't present at all. This is, AFAICT, also the behaviour of the OP function.</p>\n\n<p>In general, <code>head</code> (and <code>head'</code>) is unsafe, because it'll throw an exception when passed an empty list. In this simple function, however, this should never happen because <code>tail'</code> is only called in the case where we <em>know</em> that there's at least one occurrence of <code>target</code> in <code>xs</code>.</p>\n\n<p>Note also that the type of <code>listAfterFinalKey</code> is more general than the OP version.</p>\n"}], "owner": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 379, "favorite_count": 0, "accepted_answer_id": 48749576, "answer_count": 1, "score": 1, "last_activity_date": 1518448475, "creation_date": 1518376456, "last_edit_date": 1518448475, "question_id": 48735389, "link": "https://stackoverflow.com/questions/48735389/combine-multiple-haskell-functions", "title": "Combine multiple Haskell functions", "body": "<p>I am wondering if there is an easy way to combine some of these functions together to make it a little more clean. The purpose of the function is to take an int list, and return a list containing all elements that occur after the given occurrence of an int.</p>\n\n<pre><code>listAfterFinalKey:: [Int] -&gt; Int -&gt; [Int]\n</code></pre>\n\n<p>My code works, I was just wondering if there was a better way of writing it. I would ideally like to have it all be in one function (<code>listAfterFinalKey</code>), but I don't know how to make it work other than having three separate functions. I am also avoiding any build in libraries, and things such as let, and where. I would appreciate if someone could show me how to combine or condense some of this code (if possible).</p>\n\n<pre><code>listAfterFinalKey:: [Int] -&gt; Int -&gt; [Int]\nlistAfterFinalKey [] x = []\nlistAfterFinalKey x y = helperFunction1 x y (checker x y 0)\n\nchecker:: [Int] -&gt; Int -&gt; Int -&gt; Int\nchecker [] tracker count = count\nchecker (x:xs) tracker count = if tracker == x\n    then checker xs tracker (count+1)\n    else checker xs tracker count\n\n\nhelperFunction1:: [Int] -&gt; Int -&gt; Int -&gt; [Int]\nhelperFunction1 [] tracker count = []\nhelperFunction1 x tracker count = if (count == 0)\n    then take 1 x ++ helperFunction1 (drop 1 x) tracker count\n    else if (count /= 0) &amp;&amp; (tracker == (head x))\n    then helperFunction1 (drop 1 x) tracker (count-1)\n    else helperFunction1 (drop 1 x) tracker count\n</code></pre>\n"}, {"tags": ["haskell", "dependency-management", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "is_accepted": true, "score": 6, "last_activity_date": 1520285042, "last_edit_date": 1520285042, "creation_date": 1518712110, "answer_id": 48811952, "question_id": 48734530, "link": "https://stackoverflow.com/questions/48734530/external-dependencies-haskell-stack-should-i-modify-something-or-import-sup/48811952#48811952", "title": "External dependencies, Haskell, stack: should I modify something or &#39;import&#39; suppose to be sufficient?", "body": "<blockquote>\n  <p>[Do] I need to specify external dependencies manually [...]?</p>\n</blockquote>\n\n<p>Yes.</p>\n\n<p>Since you are using Stack, it is easy to specify the dependent packages you import in your code. Depend on your Stack version, the default configuration might be a little bit different:</p>\n\n<ol>\n<li><p>If you created your project with the latest version of Stack, you will see <code>package.yaml</code> in the root of your project (<code>hpack</code> is used in this case to specify the configurations). You need to add package dependencies there, e.g., <code>containers</code> for <code>Data.Set</code>. Here's an example of a dependencies section in one of my projects:</p>\n\n<pre><code>dependencies:\n- base &gt;= 4.7 &amp;&amp; &lt; 5\n- containers\n- time\n- network\n- bytestring\n</code></pre></li>\n<li><p>If you are using an older version of <code>stack</code> and do not see <code>package.yaml</code>, you need to edit <code>your-project-name.cabal</code> to add the dependencies. Here's the complete document telling you how to do it: <a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#adding-dependencies\" rel=\"noreferrer\">https://docs.haskellstack.org/en/stable/GUIDE/#adding-dependencies</a></p></li>\n</ol>\n\n<p>Personally, I prefer the new system with <code>hpack</code> (<code>package.yaml</code>). Basically, it is simpler, and it saves you time declaring all modules you have (not about dependency). If you have <code>package.yaml</code>, do not edit <code>.cabal</code>, which is automatically generated by <code>hpack</code>.</p>\n"}], "owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 487, "favorite_count": 0, "accepted_answer_id": 48811952, "answer_count": 1, "score": 0, "last_activity_date": 1531268072, "creation_date": 1518371386, "last_edit_date": 1520284754, "question_id": 48734530, "link": "https://stackoverflow.com/questions/48734530/external-dependencies-haskell-stack-should-i-modify-something-or-import-sup", "title": "External dependencies, Haskell, stack: should I modify something or &#39;import&#39; suppose to be sufficient?", "body": "<p>I am pretty new to Haskell as well as stack. </p>\n\n<pre><code>import Data.Set\nimport Data.Stack\n</code></pre>\n\n<p>The statements above trigger compilation error: <code>Could not find module 'Data.Set'. Perhaps you meant 'Data.Int'</code>. I tried to google and found nothing similar.</p>\n\n<p>Hence, my question is: do I need to specify external dependencies manually or just my <code>stack build</code> command somewhy fails to grab appropriate modules from somewhat cache or repository? </p>\n\n<p>In case I have to specify my dependencies manually, should I prefer <code>.cabal</code> or <code>.yaml</code>? What's the correct way to deal with versioning? </p>\n"}, {"tags": ["linux", "haskell", "cabal", "haskell-stack", "haskell-platform"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1518383542, "post_id": 48736476, "comment_id": 84472393, "body": "My personal favorite is &quot;just use cabal-install yourself, it&#39;s way easier than the horror stories would have you believe&quot;.  It doesn&#39;t ever involve the platform, which is a rather poor idea in my experience."}, {"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1518385354, "post_id": 48736476, "comment_id": 84473027, "body": "@Carl I seem to remember a couple horror stories relating to cabal and cabal sandboxes from before I switched to stack and later to nix. To be fair that was before new-build though. Anyway hope I&#39;m not exaggerating too much then."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1518587877, "post_id": 48736476, "comment_id": 84562530, "body": "@Carl the minimal platform, which is the recommended one these days, is just a one-stop-shop installer for ghc, cabal-install, stack, and the happy and alex tools."}], "tags": [], "owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "is_accepted": false, "score": 8, "last_activity_date": 1518383272, "creation_date": 1518383272, "answer_id": 48736476, "question_id": 48733970, "link": "https://stackoverflow.com/questions/48733970/how-to-install-haskell-platform-or-stack-in-2018-on-linux/48736476#48736476", "title": "How to install Haskell (Platform or Stack) in 2018 on Linux?", "body": "<p>You have three choices.</p>\n\n<h3>Haskell Platform</h3>\n\n<p>It is a possibility but not a popular choice for many reasons which you will discover in due time if you choose to go this way. You will have a much better experience and get <em>much</em> better support with either Stack or Nix. Which of those two people use seems to be mostly about personal preference. They are different beasts but to a beginner the differences will not be immediately obvious so there's little hope that you will be able to make an \"informed decision\". Just pick one and reevaluate later.</p>\n\n<h3>Stack</h3>\n\n<p>This is what I would suggest to anyone (not familiar with Nix) wanting to get started with Haskell quickly. Period. You do not need to separately install anything, Stack will handle all the Haskell stuff for you. You don't normally ever use cabal directly with Stack. <code>stack build</code> uses cabal internally but you don't need to worry about that. One thing to note, Stack is not a package manager. It's a build tool. It doesn't normally <em>install</em> anything. It does however fetch all the dependencies that it needs and stores them in <code>~/.stack</code> together with other things.</p>\n\n<h3>Nix</h3>\n\n<p>This is what I use personally so I may be biased but I think this is the best solution overall in the long term. The caveat is that there is a rather steep learning curve and you are given many chances to shoot yourself in the foot when starting out.</p>\n\n<p>I highly recommend starting with Stack but keeping an open mind about Nix as your journey with Haskell continues.</p>\n"}, {"comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 559, "user_id": 9345990, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d3C7D.png?s=128&g=1", "display_name": "Klorax", "link": "https://stackoverflow.com/users/9345990/klorax"}, "edited": false, "score": 0, "creation_date": 1518389600, "post_id": 48736576, "comment_id": 84474256, "body": "I added notes (marked with <i>Updated</i>) to the answer to address your questions about the PATH and <code>stack ghci</code>.  With respect to question 4, a brand new Stack installation includes the core platform packages (e.g., <code>containers</code>, which <i>does</i> seem to be available in the global project without further installation), but is missing most of the libraries available with the Full Platform (e.g., including some very popular ones like <code>random</code>, <code>text</code>, and <code>mtl</code>)."}, {"owner": {"reputation": 2491, "user_id": 121095, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8c6a071678da71840e6e72f7a46170a4?s=128&d=identicon&r=PG", "display_name": "Alexandre Rademaker", "link": "https://stackoverflow.com/users/121095/alexandre-rademaker"}, "edited": false, "score": 0, "creation_date": 1604178466, "post_id": 48736576, "comment_id": 114269330, "body": "This answer was amazing and made me learn a lot. But it is 2 years-old. I wonder if as Haskell beginner is it still up-to-date."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 40, "last_activity_date": 1546466136, "last_edit_date": 1546466136, "creation_date": 1518383924, "answer_id": 48736576, "question_id": 48733970, "link": "https://stackoverflow.com/questions/48733970/how-to-install-haskell-platform-or-stack-in-2018-on-linux/48736576#48736576", "title": "How to install Haskell (Platform or Stack) in 2018 on Linux?", "body": "<p>Here's a (long) alternative answer.  Note that I used to recommend Stack for beginners, too, but I've since changed my mind.</p>\n\n<p><strong>TL;DR:</strong>  Either Haskell Platform or a pure Stack installation can provide you with everything you need, and you won't be \"missing\" anything by choosing one or the other.  You'll probably find it easiest to skip Stack and install Haskell Platform using the \"Generic\" Linux installer, because it comes with everything you need and the setup will more closely matched what's described in the LYAH book.  You can install Stack later when you're doing more serious development on multiple projects.  If you prefer to stick with a pure Stack installation, I'd suggest starting with a \"global project only\" workflow.  Either way, you can use \"haskell-mode\" with some configuration fixes suggested below (including a key setting that will be required if you're working in the global project of a Stack-only installation).</p>\n\n<p>Here's the long answer...</p>\n\n<h2>Stack vs. Platform vs. Cabal</h2>\n\n<p>The LYAH book pre-dates Stack, which is certainly the main reason it doesn't mention it.  At haskell.org, they recommend using either a minimal installer, Stack, or the Haskell Platform.  All three methods are perfectly reasonable ways in 2018 to set up a working Haskell environment.  They differ both in the ways they choose to isolate different versions of the compiler and/or libraries into \"sandboxes\" for development work, and in how much they install <em>initially</em>, but there's nothing \"missing\" from any one of them that can't be installed on demand.  Depending on which you choose, there will be some differences in your workflow (see below).</p>\n\n<p>Both Stack and Cabal are combined package managers and build tools.  (Stack has the added ability to actually bootstrap an entire Haskell installation, which is why it's also an installation method in its own right.)  While you're working through LYAH, you won't actually be using the \"build tool\" functionality directly on your own projects.  (The built-in build facilities of GHC are more than adequate for building small, multi-module projects.)  You'll just need the package manager functionality to install additional libraries.</p>\n\n<p>Since Stack and Cabal manage their packages separately, if you're using Stack, you'll have no particular need to use Cabal directly.  You can install it if you want (and in fact, Stack makes use of Cabal for some esoteric functionality, like \"stack solver\", and will require it to be installed in those cases):</p>\n\n\n\n<pre class=\"lang-none prettyprint-override\"><code>$ stack install cabal-install\n</code></pre>\n\n<p>But, even though this will put \"cabal\" into \"$HOME/.local/bin\" (and you'll want to make sure this is in your path), you'll find that you need to jump through hoops to run it:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ stack exec --no-ghc-package-path cabal -- list\n</code></pre>\n\n<p>and it doesn't really do anything useful as far as your Stack environment is concerned.</p>\n\n<p><strong>Update:</strong>  A note on the \"$HOME/.local/bin\" path.  It looks like the installation script from <a href=\"https://get.haskellstack.org/\" rel=\"noreferrer\">https://get.haskellstack.org/</a> may install Stack itself to <code>/usr/local/bin/stack</code> by default if there's no existing installation.  However, it should display a warning to put <code>$HOME/.local/bin</code> in your path.  If you upgrade Stack in the future with <code>stack upgrade</code>, it'll install the new version of <code>stack</code> there, and that directory will also be used if you install packages that include binaries.  For example, <code>stack install hlint</code> will install the Haskell Lint program <code>hlint</code> to that directory.  So, it's a good idea to have it in your path and somewhere before <code>/usr/local/bin</code>.</p>\n\n<h2>What's Missing with Stack</h2>\n\n<p>I think that covers your first three questions.  For your last, the main thing you're missing having installed Stack instead of the Haskell Platform is that, by design, Stack doesn't really install anything globally other than \"stack\" itself.  So, all your Haskell work including running the Haskell interpreter (\"ghci\") or compiler (\"ghc\"), all needs to be done within a Stack environment, either using a specific corresponding Stack command:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ echo 'main = putStrLn \"Hello, world!\"' &gt; Hello.hs\n$ stack ghc -- Hello.hs\n[1 of 1] Compiling Main             ( Hello.hs, Hello.o )\nLinking Hello ...\n$ ./Hello \nHello, world!\n$ \n</code></pre>\n\n<p>or else using \"stack exec\" to run a generic program within an appropriate Stack environment.  For example, it can sometimes be helpful to run a Bash shell under stack, after which things behave sort of like a globally installed Haskell Platform environment:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ stack exec bash\n$ ghci\nGHCi, version 8.2.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :quit\n$ ghc -O2 Hello.hs\n[1 of 1] Compiling Main             ( Hello.hs, Hello.o ) [flags changed]\nLinking Hello ...\n$ exit\n$ ghc\nThe program 'ghc' is currently not installed. ...\n$\n</code></pre>\n\n<p>The other thing you're missing is that the Haskell Platform installs a whole bunch of common libraries by default, while a fresh Stack environment starts with almost nothing (not even the compiler, before you run <code>stack setup</code>).  While working through LYAH, you may find you need to periodically install additional libraries.  For example, in the <em>Input and Output</em> chapter, the examples using random numbers (module <code>System.Random</code>) will require you to run:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ stack install random\n</code></pre>\n\n<p>and restart your interpreter.</p>\n\n<h2>Recommendation to Use Haskell Platform</h2>\n\n<p>Because Stack is a little complicated and you won't really need the facilities it provides at the beginning, you may find the Haskell Platform easier to use when you're starting out.  (The \"Generic\" installer should work fine on your distribution.)  It comes with everything installed, and the way you use it will more closely match the way things are described in LYAH.  Together with <code>haskell-mode</code>, you should have a pretty decent Haskell environment.</p>\n\n<p>In general, there should be no issue having Stack and the Haskell Platform installed side-by-side (as evidenced by the fact that Haskell Platform actually <em>includes</em> Stack).  Stack will maintain everything separately under the \"$HOME/.stack\" subdirectory, so there will be no interference between compilers or packages or anything.  Note that in this setup, you'll use <code>cabal</code> to manage the packages installed on the Platform side of things, and <code>stack</code> -- obviously -- to manage packages on the Stack side.</p>\n\n<h2>Beginner Workflow for a Pure Stack Installation</h2>\n\n<p>If you want to stick with your pure Stack installation, I might suggest the following workflow when you're starting out:</p>\n\n<p>You will see references to Stack projects, created with \"stack new\" or \"stack init\".  Avoid these at the beginning, and stick with the stack \"global project\".  This is the implicit project that will be in effect when you run \"stack\" in a directory that doesn't have a \"stack.yaml\" file (directly or in a parent directory):</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ cd\n$ stack path --project-root\n/u/buhr/.stack/global-project\n$\n</code></pre>\n\n<p>When you're working in the global project (i.e., not somewhere under a <code>stack.yaml</code> file), you can invoke the interpreter and compiler with:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ stack exec ghci\n$ stack ghc -- -O2 Hello.hs\n</code></pre>\n\n<p>and they will both have access to any additional libraries (packages) you've installed using commands like:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ stack install random\n</code></pre>\n\n<p><strong>Updated:</strong> A note on the difference between <code>stack ghci</code> and <code>stack exec ghci</code>.  The former is intended to run GHCi within the context of a local project (i.e., working under a <code>stack.yaml</code> file).  It passes some additional flags to hide globally installed packages and to automatically make available modules from your package.  When working in the global project, I don't think there's any practical difference except that <code>stack ghci</code> generates a warning; and no matter which you use, you'll need to load your own modules explicitly with <code>:load Whatever.hs</code>.   There's a little more info on the difference on <a href=\"https://docs.haskellstack.org/en/stable/ghci/\" rel=\"noreferrer\">this Stack documentation page</a>, particularly at the bottom where it tries to explain the difference.</p>\n\n<p>Eventually, you may switch to a workflow that uses Stack projects.  This will involve using <code>stack new</code> to create a new Stack project directory, <code>stack setup</code> to install/link a private compiler version into that directory, and then modifying the project's <code>xxx.cabal</code> file (and possibly its <code>stack.yaml</code> file) to indicate which additional packages are required, instead of using <code>stack install</code>.  It's all a little complicated when you just want to get started writing code.</p>\n\n<p>You may also see reference to Intero, an Emacs mode designed specifically for Stack.  Intero is very nice, but it doesn't work very well when working on files in the global project.  It'll tend to want to start up the interpreter in the directory \"~/.stack/global-project\", which is pretty useless.  (I use Intero, but I've patched it to behave better in this respect.)</p>\n\n<h2>Configuring Haskell-Mode (for Either Platform or Stack)</h2>\n\n<p>It's probably best to stick with \"haskell-mode\" instead, and think about Intero when you start using non-global projects.  I'd suggest installing \"haskell-mode\" from MELPA as per the instructions, but adding the following to your <code>.emacs</code> file instead of what's suggested in the documentation:</p>\n\n<pre class=\"lang-lisp prettyprint-override\"><code>(require 'haskell)\n\n;; add capability to submit code to interpreter and mark errors\n(add-hook 'haskell-mode-hook 'interactive-haskell-mode)\n\n;; add missing keybindings for navigating errors\n(define-key interactive-haskell-mode-map (kbd \"M-n\") 'haskell-goto-next-error)\n(define-key interactive-haskell-mode-map (kbd \"M-p\") 'haskell-goto-prev-error)\n(define-key interactive-haskell-mode-map (kbd \"C-c M-p\") \n 'haskell-goto-first-error)\n\n;; merge this with your existing custom-set-variables\n(custom-set-variables\n\n ;; NOTE: include following line to work around haskell-mode\n ;; bug if using GHC &gt;= 8.2.1.\n ;; See: https://github.com/haskell/haskell-mode/issues/1553\n '(haskell-process-args-stack-ghci \n   '(\"--ghci-options=-ferror-spans -fshow-loaded-modules\"\n     \"--no-build\" \"--no-load\"))\n\n ;; some options suggested in the haskell-mode documentation\n '(haskell-process-auto-import-loaded-modules t)\n '(haskell-process-log t)\n '(haskell-process-suggest-remove-import-lines t)\n\n ;; make sure \"stack ghci\" is used, even in the global project\n '(haskell-process-type 'stack-ghci))\n</code></pre>\n\n<p>I've tested this with a pure Stack installation using \"haskell-mode-20171022.26\", and it seems to work fine.  I can load a new Haskell file in the global project, submit it to an interactive session with \"C-c C-l\", and browse highlighted errors in the source file with \"M-n\" and \"M-p\".  (The errors appear in the mini-buffer.)</p>\n\n<p>If you decide to use the Haskell Platform instead, I think all of this \"haskell-mode\" configuration will still apply, except you should remove the very last customization line.  (The default <code>haskell-process-type</code> of <code>auto</code> will pick something appropriate.)</p>\n\n<p>Hope that helps!</p>\n"}], "owner": {"reputation": 559, "user_id": 9345990, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d3C7D.png?s=128&g=1", "display_name": "Klorax", "link": "https://stackoverflow.com/users/9345990/klorax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10822, "favorite_count": 13, "accepted_answer_id": 48736576, "answer_count": 2, "score": 25, "last_activity_date": 1546466136, "creation_date": 1518368072, "last_edit_date": 1518400222, "question_id": 48733970, "link": "https://stackoverflow.com/questions/48733970/how-to-install-haskell-platform-or-stack-in-2018-on-linux", "title": "How to install Haskell (Platform or Stack) in 2018 on Linux?", "body": "<p>I am trying to learn Haskell from the book <a href=\"http://learnyouahaskell.com/\" rel=\"noreferrer\">Learn You a Haskell</a> by Miran Lipova\u010da. Both the book and haskell.org recommends installing the <a href=\"https://www.haskell.org/platform/\" rel=\"noreferrer\">Haskell Platform</a> but there is no download for Manjaro Linux (Arch based) which I use.</p>\n\n<p>I found this <a href=\"http://sapiengames.com/2014/04/05/install-haskell-platform-arch-linux/\" rel=\"noreferrer\">guide</a> from 2014 and decided to install the packages from Manjaro's repository. This worked fine until I wanted to use haskell-mode in Emacs. I troubleshooted this and found out that it was a problem with the packages (Stack mainly).</p>\n\n<p>Looking for ways to fix this I found this <a href=\"https://www.reddit.com/r/archlinux/comments/7hanz7/whats_the_current_state_of_haskell_on_arch/\" rel=\"noreferrer\">Reddit</a> thread, which describes ways to install Haskell (not the Platform), and problems with the packages. I followed one of the comments and ended up installing Stack (and GHC) with the script as described <a href=\"https://docs.haskellstack.org/en/stable/install_and_upgrade/\" rel=\"noreferrer\">here</a>:</p>\n\n<pre><code>wget -qO- https://get.haskellstack.org/ | sh\nstack setup\nstack update\n</code></pre>\n\n<p>My questions are related to this:</p>\n\n<ol>\n<li>Is this the recommended starter way to install a functioning Haskell (Platform) on Linux (Manjaro) in 2018? If not: what is the/a way to do it?</li>\n<li>Haskell Platform contains: GHC, Cabal, Stack, and some packages. GHC and Stack are installed, how do I install Cabal through Stack?</li>\n<li>Do I need Cabal (Stack seems to have overlapping functionality)?</li>\n<li>Looking at the packages of the <a href=\"https://www.haskell.org/platform/contents.html\" rel=\"noreferrer\">Haskell Platform</a>, what, if anything, am I missing by installing Stack as described above? Looking in <code>$HOME/.stack/programs/x86_64-linux/ghc-tinfo6-nopie-8.2.2/lib/ghc-8.2.2</code> many of these seems installed already.</li>\n</ol>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518361966, "post_id": 48732614, "comment_id": 84464967, "body": "No, it is an error"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 2, "creation_date": 1518362671, "post_id": 48732614, "comment_id": 84465185, "body": "A function of type <code>[Integer] -&gt; ([Integer], [Integer])</code> can&#39;t return <code>Nothing</code>. It would need to have the return type <code>Maybe</code> for that."}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518362724, "post_id": 48732614, "comment_id": 84465196, "body": "Yes, of course. I have forgotten it."}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1518363181, "post_id": 48732614, "comment_id": 84465372, "body": "Why is the second example <code>[1,3,3],[4,3]</code> and not <code>[1,3,3],[3,4]</code>? Does the specification specifically talk about longest prefix and suffix with equal sums?"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1518363675, "post_id": 48732614, "comment_id": 84465522, "body": "Because the elements have to be arranged in the same way as in the original list. @SebastianRedl"}, {"owner": {"reputation": 20860, "user_id": 2034787, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/78471a5b1bfa8b48d2056ff99a875f50?s=128&d=identicon&r=PG", "display_name": "\u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df", "link": "https://stackoverflow.com/users/2034787/%d7%92%d7%9c%d7%a2%d7%93-%d7%91%d7%a8%d7%a7%d7%9f"}, "edited": false, "score": 0, "creation_date": 1518369886, "post_id": 48732614, "comment_id": 84467685, "body": "@mathandtic <code>[1,3,3],[3,4]</code> <i>is</i> the same order as the original list."}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518370825, "post_id": 48732614, "comment_id": 84468021, "body": "Yes, it is true, so in this case it could be 2 lists. @ \u05d2\u05dc\u05e2\u05d3 \u05d1\u05e8\u05e7\u05df"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518377273, "post_id": 48732614, "comment_id": 84470333, "body": "I have upload what I want in precisely way"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1518377779, "post_id": 48732614, "comment_id": 84470507, "body": "@mathandtic I still don&#39;t think the instructions are clear. By &quot;can be divided into two parts&quot;, I would think that all the elements of the original list have to be used, but your second example doesn&#39;t meet this criteria."}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518378216, "post_id": 48732614, "comment_id": 84470665, "body": "Yes, I agree with you. I have put a bad example"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1518378256, "post_id": 48732614, "comment_id": 84470684, "body": "For this reason, I have changed it. @SebastianRedl"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 2, "creation_date": 1518378437, "post_id": 48732614, "comment_id": 84470742, "body": "Ok, now the instructions are clear, but you haven&#39;t actually asked a question. You posted your attempt and said &quot;it doesn&#39;t work&quot;, but that&#39;s not a question. And the question &quot;how do I do this&quot; is too broad. (Hint for solving it: make use of the built-in <code>splitAt</code> function.)"}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518378525, "post_id": 48735701, "comment_id": 84470768, "body": "It doesn&#39;t homework, it is an exercise that I saw in a web for learning Haskell, but I can&#39;t know how to do it. So, I have asked in order to you could help to me. Sorry, it is unexplained."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 2, "creation_date": 1518378588, "post_id": 48735701, "comment_id": 84470801, "body": "My apologies.  Shouldn\u2019t have jumped to conclusions."}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 3, "last_activity_date": 1518378540, "last_edit_date": 1518378540, "creation_date": 1518378331, "answer_id": 48735701, "question_id": 48732614, "link": "https://stackoverflow.com/questions/48732614/splitting-lists-in-haskell/48735701#48735701", "title": "Splitting lists in Haskell", "body": "<p>Not a complete answer, since this is a learning exercise and you want hints, but if you want to use <code>subsequences</code> from <code>Data.List</code>, you could then remove each element of the subsequence you are checking from the original list with <code>\\\\</code>, to get the difference, and compare the sums.  You were on the right track, but you need to either find the first subsequence that works and return <code>Just (ys, zs)</code>, or else <code>Nothing</code>.</p>\n\n<p>You can make the test for some given subsequence a predicate and search with <code>find</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": true, "score": 1, "last_activity_date": 1518436009, "last_edit_date": 1518436009, "creation_date": 1518434851, "answer_id": 48745399, "question_id": 48732614, "link": "https://stackoverflow.com/questions/48732614/splitting-lists-in-haskell/48745399#48745399", "title": "Splitting lists in Haskell", "body": "<p>What you could also do is create a function that gives all possible splittings of a list:</p>\n\n<pre><code>splits :: [a] -&gt; [([a], [a])]\nsplits xs = zipWith splitAt [1..(length xs)-1] $ repeat xs\n</code></pre>\n\n<p>Which works as follows:</p>\n\n<pre><code>*Main&gt; splits [1,2,3,4,5,15]\n[([1],[2,3,4,5,15]),([1,2],[3,4,5,15]),([1,2,3],[4,5,15]),([1,2,3,4],[5,15]),([1,2,3,4,5],[15])]\n</code></pre>\n\n<p>Then you could just use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:find\" rel=\"nofollow noreferrer\"><code>find</code></a> from <code>Data.List</code> to find the first pair of splitted lists that have equal sums:</p>\n\n<pre><code>import Data.List\n\nsplitSum :: [Integer] -&gt; Maybe ([Integer], [Integer])\nsplitSum xs = find (\\(x, y) -&gt; sum x == sum y) $ splits xs\n</code></pre>\n\n<p>Which works as intended:</p>\n\n<pre><code>*Main&gt; splitSum [1,2,3,4,5,15]\nJust ([1,2,3,4,5],[15])\n</code></pre>\n\n<p>Since <code>find</code> returns <code>Maybe a</code>, the types automatically match up. </p>\n"}], "owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 1, "accepted_answer_id": 48745399, "answer_count": 2, "score": 0, "last_activity_date": 1518436009, "creation_date": 1518359797, "last_edit_date": 1518378596, "question_id": 48732614, "link": "https://stackoverflow.com/questions/48732614/splitting-lists-in-haskell", "title": "Splitting lists in Haskell", "body": "<p>In Haskell I need to perform a function, whose declaration of types is as follows:</p>\n\n<pre><code>split ::[Integer] -&gt; Maybe ([Integer],[Integer])\n</code></pre>\n\n<p>Let it work as follows:</p>\n\n<pre><code>split [1,2,3,4,5,15] = Just ([1,2,3,4,5],[15])\n</code></pre>\n\n<p>Because, 1 + 2 + 3 + 4 + 5 = 15</p>\n\n<pre><code>split [1,3,3,4,3] = Just ([1,3,3],[4,3])\n</code></pre>\n\n<p>Because, 1 + 3 + 3 = 7 = 4 + 3</p>\n\n<pre><code>split [1,5,7,8,0] = Nothing\n</code></pre>\n\n<p>I have tried this, but it doesn't work:</p>\n\n<pre><code>split :: [Integer] -&gt; ([Integer], [Integer])\nsplit xs = (ys, zs)\n where\n   ys &lt;- subsequences xs,  ys isInfixOf xs, sum ys == sum zs\n   zs == xs \\\\ ys\n</code></pre>\n\n<hr>\n\n<p><strong>Determines whether the list of positive integers xs can be divided into two parts (without rearranging its elements) with the same sum. If possible, its value is the pair formed by the two parts. If it's not, its value is Nothing.</strong>\nHow can I do it?</p>\n"}, {"tags": ["bash", "haskell", "autocomplete", "cabal", "cabal-install"], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1518612371, "post_id": 48780602, "comment_id": 84576685, "body": "Thanks a lot for this script! Could you please provide exact command? I&#39;m not a <code>bash</code> expert... Won&#39;t something like this work: <code>curl https:&#47;&#47;raw.githubusercontent.com&#47;haskell&#47;cabal&#47;master&#47;cabal&zwnj;&#8203;-install&#47;bash-comple&zwnj;&#8203;tion&#47;cabal | source</code>?"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1518652508, "post_id": 48780602, "comment_id": 84598838, "body": "I mean just download the file and put it into the directory I suggested..."}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 2, "last_activity_date": 1518588095, "creation_date": 1518588095, "answer_id": 48780602, "question_id": 48732256, "link": "https://stackoverflow.com/questions/48732256/how-to-make-bash-autocompletion-work-with-cabal/48780602#48780602", "title": "How to make bash autocompletion work with cabal?", "body": "<p>There's a <code>cabal-install</code> autocomplete script here. You just need to source it somewhere in your shell: <a href=\"https://github.com/haskell/cabal/blob/master/cabal-install/bash-completion/cabal\" rel=\"nofollow noreferrer\">https://github.com/haskell/cabal/blob/master/cabal-install/bash-completion/cabal</a></p>\n\n<p>For ubuntu, you should be able to do it by just tossing it in <code>/etc/bash_completion.d</code></p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 1, "accepted_answer_id": 48780602, "answer_count": 1, "score": 4, "last_activity_date": 1518588095, "creation_date": 1518357386, "last_edit_date": 1518357512, "question_id": 48732256, "link": "https://stackoverflow.com/questions/48732256/how-to-make-bash-autocompletion-work-with-cabal", "title": "How to make bash autocompletion work with cabal?", "body": "<p>With <code>stack</code> build tool I need to add the following line to my system config and autocompletion works:</p>\n\n<pre><code>eval \"$(stack --bash-completion-script stack)\"\n</code></pre>\n\n<p>But autocompletion for <code>cabal-install</code> doesn't work out of the box and I can't find a way to do this. How can I enable bash autocompletion for <code>cabal-install</code> (my <code>cabal-install</code> version: <code>2.1.0.0</code>)?</p>\n\n<p>My OS: Ubuntu 16.04.03 LTS</p>\n"}, {"tags": ["haskell", "haskell-stack", "stm", "conduit"], "answers": [{"tags": [], "owner": {"reputation": 329, "user_id": 6755672, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JR7mu01Cnio/AAAAAAAAAAI/AAAAAAAAAHo/Gg_4gGFpnkU/photo.jpg?sz=128", "display_name": "MadNat", "link": "https://stackoverflow.com/users/6755672/madnat"}, "is_accepted": true, "score": 1, "last_activity_date": 1518529009, "creation_date": 1518529009, "answer_id": 48768104, "question_id": 48731094, "link": "https://stackoverflow.com/questions/48731094/cant-pass-data-via-stdin-to-process-spawned-with-conduit-extra/48768104#48768104", "title": "Can&#39;t pass data via stdin to process spawned with conduit-extra", "body": "<p>So the issue was that default behaviour of <code>sinkHandle</code> was <a href=\"https://github.com/snoyberg/conduit/pull/324\" rel=\"nofollow noreferrer\">changed</a> to not flush after every chunk of data.</p>\n\n<p>I've fixed the issue by first porting to <code>Data.Conduit.Process.Typed</code> and then rolling my own variant of <code>createSink</code> that is using <a href=\"https://hackage.haskell.org/package/conduit-extra-1.3.0/docs/Data-Conduit-Binary.html#v:sinkHandleFlush\" rel=\"nofollow noreferrer\">sinkHandleFlush</a> instead of <code>sinkHandle</code>.</p>\n"}], "owner": {"reputation": 329, "user_id": 6755672, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JR7mu01Cnio/AAAAAAAAAAI/AAAAAAAAAHo/Gg_4gGFpnkU/photo.jpg?sz=128", "display_name": "MadNat", "link": "https://stackoverflow.com/users/6755672/madnat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 48768104, "answer_count": 1, "score": 1, "last_activity_date": 1518529009, "creation_date": 1518349242, "question_id": 48731094, "link": "https://stackoverflow.com/questions/48731094/cant-pass-data-via-stdin-to-process-spawned-with-conduit-extra", "title": "Can&#39;t pass data via stdin to process spawned with conduit-extra", "body": "<p>In my program I am starting external process and communicate with it via <code>stdin</code> and <code>stdout</code>. I'm feeding the input through conduit (producer) started from <code>STM</code>s <code>TQueue</code>. It worked like a charm until I've decided to bump lts version. It worked great with lts &lt;= 8.24.</p>\n\n<p>Here is the minimized program that reproduces my problem:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-10.4 --install-ghc runghc --package conduit-extra --package stm-conduit\n{-# LANGUAGE OverloadedStrings #-}\nimport Control.Concurrent\nimport Control.Monad.STM\nimport Control.Concurrent.STM.TQueue\n\nimport           Data.Conduit\nimport qualified Data.Conduit.Binary       as CB\nimport qualified Data.Conduit.List         as CL\nimport           Data.Conduit.Process     (CreateProcess (..),\n                                           proc, sourceProcessWithStreams)\nimport qualified Data.Conduit.TQueue       as CTQ\n\nimport qualified Data.ByteString.Char8     as BS\nimport           Data.Monoid              ((&lt;&gt;))\n\nmain :: IO ()\nmain = do\n  putStrLn \"Enter \\\"exit\\\" to exit.\"\n\n  q &lt;- open\n  putStrLn \"connection opened\"\n\n  loop q\n  where loop q = do\n          s &lt;- BS.getLine\n          case s of\n            \"exit\" -&gt; return ()\n            req -&gt; do\n              atomically $ writeTQueue q req\n              loop q\n\nopen :: IO (TQueue BS.ByteString)\nopen = do\n  req &lt;- atomically newTQueue\n  let chat :: CreateProcess\n      chat = proc \"cat\" []\n\n      input :: Producer IO BS.ByteString\n      input = toProducer\n            $ CTQ.sourceTQueue req\n           -- .| CL.mapM_ (\\bs -&gt; BS.putStrLn ((\"queue: \" :: BS.ByteString) &lt;&gt; bs))\n\n      output :: Consumer BS.ByteString IO ()\n      output = toConsumer\n             $ CL.mapM_ BS.putStrLn\n\n  _ &lt;- forkIO (sourceProcessWithStreams chat input output output &gt;&gt; pure ())\n  pure req\n</code></pre>\n\n<p>With newer lts it seems like the problem is <em>not</em> with communication via <code>TQueue</code>, as uncommenting the line which prints content from input conduit gives shows data from the queue. It looks like the spawned process never receives anything on it's <code>stdin</code>.</p>\n\n<p>Furthermore writing to spawned cat <code>stdin</code> from console, like so:</p>\n\n<pre><code>echo \"test\" &gt; /proc/&lt;pid of spawned cat&gt;/fd/0\n</code></pre>\n\n<p>produces output in my program.</p>\n\n<p>Am I missing something that changed between versions?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 0, "creation_date": 1518347359, "post_id": 48730834, "comment_id": 84460652, "body": "What is the expected output to that? All the lists that contain ones in them?"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 0, "creation_date": 1518347393, "post_id": 48730834, "comment_id": 84460661, "body": "Yes, it is a binary list"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "edited": false, "score": 0, "creation_date": 1518347803, "post_id": 48730834, "comment_id": 84460773, "body": "Only has list of ones and zeros @RoadRunner"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1518348153, "post_id": 48730834, "comment_id": 84460874, "body": "<code>filter (all odd) xss</code>? Or do you want <code>map (filter odd) xss</code>?"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1518348192, "post_id": 48730834, "comment_id": 84460884, "body": "<code>filter (all odd) xss</code>  @DanRobertson"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1518348351, "post_id": 48730834, "comment_id": 84460937, "body": "What should you get if <code>xss=[[0,0],[0,1],[1,1]]</code>?"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518348648, "post_id": 48730834, "comment_id": 84461018, "body": "I couldn&#39;t get this because the list came from <code>group</code> so <code>xss = [[0,0,0], [1,1,1]]</code>  I have the list of digits binary and apply <code>group</code> to get xss"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1518349368, "post_id": 48730834, "comment_id": 84461244, "body": "I have changed for explained better @DanRobertson"}], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 6, "last_activity_date": 1518351879, "last_edit_date": 1518351879, "creation_date": 1518349666, "answer_id": 48731145, "question_id": 48730834, "link": "https://stackoverflow.com/questions/48730834/filter-list-from-a-list-of-lists/48731145#48731145", "title": "Filter list from a list of lists", "body": "<p>Let\u2019s first state the problem:</p>\n\n<blockquote>\n  <p>input is a list of lists. Each of those lists is nonempty and consists of either all 0 or all 1. The output should be those lists which are all 0.</p>\n</blockquote>\n\n<p>So we want to filter out the lists which are all 0. The simplest way to do this is:</p>\n\n<pre><code>filter (all (==0)) xss\n</code></pre>\n\n<p>This requires us to examine all elements of the lists of 0\u2019s and only a single element of the lists of 1\u2019s. We can do better by examining the first element only:</p>\n\n<pre><code>filter ((==0) . head) xss\n</code></pre>\n\n<p>Now our assumption is that no list is empty. We can be robust to that by also removing empty lists:</p>\n\n<pre><code>filter (\\xs -&gt; not (null xs) &amp;&amp; head xs == 0) xss\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 549, "favorite_count": 0, "accepted_answer_id": 48731145, "answer_count": 1, "score": 0, "last_activity_date": 1518351879, "creation_date": 1518347245, "last_edit_date": 1518349348, "question_id": 48730834, "link": "https://stackoverflow.com/questions/48730834/filter-list-from-a-list-of-lists", "title": "Filter list from a list of lists", "body": "<p>In Haskell, I have the following problem:</p>\n\n<pre><code>toBin :: Integer -&gt; Integer\ntoBin n = read (showIntAtBase 2 intToDigit n \"\")\n\n-- \u03bb&gt; toBin 558745840\n-- 100001010011011100100011110000\n-- (0.01 secs, 117,680 bytes)\n\ndigitosAgrupados :: Integer -&gt; [[Integer]]\ndigitosAgrupados n = group [read[d] | d &lt;- show n]\n\n-- \u03bb&gt; digitosAgrupados (toBin 558745840)\n-- [[1],[0,0,0,0],[1],[0],[1],[0,0],[1,1],[0],[1,1,1],[0,0],[1],[0,0,0],[1,1,1,1],[0,0,0,0]]\n-- (0.01 secs, 288,624 bytes)\n</code></pre>\n\n<hr>\n\n<p>I have to drop the list of ones that cames from <code>digitosAgrupados n</code></p>\n\n<pre><code>[[1],[0,0,0,0],[1],[0],[1],[0,0],[1,1],[0],[1,1,1],[0,0],[1],[0,0,0],[1,1,1,1],[0,0,0,0]] --&gt; [[0,0,0,0],[0],[0,0],[0],[0,0],[0,0,0],[0,0,0,0]]\n</code></pre>\n\n<p>That is to say, from a list made up of lists of ones and zeros, to extract the lists of some ones.I have tried <code>filter (all odd) xss</code></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 2, "creation_date": 1518337759, "post_id": 48729684, "comment_id": 84458316, "body": "How would one ever decide that an arbitrary infinite list <i>never</i> breaks the pattern, after the finite part of it we were able to check in finite time?"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518338382, "post_id": 48729684, "comment_id": 84458446, "body": "Well, if the same pattern is repeated three times, we already know (or I know enough to know) that it is periodic.  @Davislor"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1518338495, "post_id": 48729684, "comment_id": 84458468, "body": "@mathandtic: but if the list is <code>[1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 6, 3, 4]</code>, then the pattern was repeated three times, but not an inifinite amount of tims."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518338558, "post_id": 48729684, "comment_id": 84458478, "body": "This would work if I piped in <code>map (fromIntegral . fromEnum) &lt;$&gt; getContents</code> and adversarially tried to break the algorithm?"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1518338689, "post_id": 48729684, "comment_id": 84458501, "body": "What I really want is a function that gets a periodic part of the Fibonacci module n succession. But, I have thought that it is better to do <code>periodicity</code> and then apply `map&#39; to that list.  <a href=\"https://en.wikipedia.org/wiki/Pisano_period\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Pisano_period</a>   @Davislor"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518339142, "post_id": 48729684, "comment_id": 84458609, "body": "In that special case, any sequence of length 2 or greater that repeats itself even once is guaranteed to repeat infinitely. (I think; it\u2019s after midnight.)"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518339233, "post_id": 48729684, "comment_id": 84458639, "body": "I think so, but I&#39;m not able to write the correct code"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518339355, "post_id": 48729684, "comment_id": 84458666, "body": "Or any single value (mod <code>n</code>) that repeats 3 times is guaranteed to repeat forever."}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518339606, "post_id": 48729684, "comment_id": 84458727, "body": "Yes, but if for example it is <code>mod 17</code> the period size will be bigger than <code>mod 3</code>, how can I create the function that gives me the period list for $\\forall$ n"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1518340611, "post_id": 48729684, "comment_id": 84458975, "body": "As for that <code>periodo</code> function, <code>ps</code> is just the fibonacci sequence mod n.  <code>f</code> is a recursive function that walks through the list.  <code>pi</code> keeps track of the current index.  Can you figure out the rest?"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518340962, "post_id": 48729684, "comment_id": 84459065, "body": "I could do it more or less"}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "edited": false, "score": 0, "creation_date": 1518341004, "post_id": 48729684, "comment_id": 84459076, "body": "<code>(\\u v -&gt; (u + v) </code>mod` n) ` can I write ussing <code>map</code>?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1518345597, "post_id": 48729684, "comment_id": 84460201, "body": "@mathandtic I assume you mean the whole <code>zipWith (\\u v -&gt; (u + v) `mod` n) (tail ps) ps</code> bit.  No, you can&#39;t write it using <code>map</code>, unless you <i>also</i> <code>zip</code>, because you need to combine two lists."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518375262, "post_id": 48729684, "comment_id": 84469592, "body": "In one special case (<i>m</i> = 5 is one example), you can determine that the period is 2\u200a<i>i</i> after checking <i>i</i>\u200a+\u200a1 elements, and you can classify this special case using the first <i>m</i>\u200a&#178;/2+1 elements. The check takes only constant memory. See the edit to my answer."}], "answers": [{"comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1518340119, "post_id": 48729929, "comment_id": 84458847, "body": "Nice reduction to the halting problem!"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 5, "last_activity_date": 1518339827, "creation_date": 1518339827, "answer_id": 48729929, "question_id": 48729684, "link": "https://stackoverflow.com/questions/48729684/periodicity-fibonacci-mod-sequence-in-infinites-list-haskell/48729929#48729929", "title": "Periodicity (Fibonacci mod sequence) in infinites list Haskell", "body": "<p>The function you want, as you have stated it, is impossible<sup>1</sup>.</p>\n\n<p>But since you said you are really after is the Pisano period, it's enough to notice that two successive numbers is enough to determine the remainder of a fibonacci sequence (mod n or otherwise).  So you are really looking for the first reoccurrence of an adjacent pair, e.g.</p>\n\n<pre><code>0, 1, 1, 2, 0, 2, 2, 1, 0, 1, 1, 2, 0, 2, 2, 1, 0, 1, 1, 2, 0, 2, 2, 1, 0\n^^^^                    ^^^^\n[--------- 8 -----------)\n</code></pre>\n\n<p>I am not much for coding people's problems for them, but I can sketch the way I would solve this.  One thing to keep in mind is that the periodicity might have a prefix that does not repeat -- I don't know whether this actually occurs in Fibonacci sequences mod n, but it occurs in general.  So we need to be prepared to throw away a prefix.</p>\n\n<p>First, <code>zip</code> the list with its tail to get a list of adjacent pairs</p>\n\n<pre><code>    [ 0,     1,     1,     2,     0,     2,    2,     1 ...]\n -&gt; [(0,1), (1,1), (1,2), (2,0), (0,2), (2,2), (2,1), ... ]\n</code></pre>\n\n<p>From this, fold through the list building a <code>Data.Map</code> keyed on this pair, where the value is the index it first occurred.  You could do this with <code>foldr</code> but I'd probably just use a recursive function with an accumulator.   For the above example the map at each step would look like:</p>\n\n<pre><code>{(0,1): 0}\n{(0,1): 0, (1,1): 1}\n{(0,1): 0, (1,1): 1, (1,2): 2}\n{(0,1): 0, (1,1): 1, (1,2): 2, (2,0): 3}\n...\n</code></pre>\n\n<p>When you reach a point in the list where the key is already present, you can then subtract the current index from the one in the map, and there's your period.</p>\n\n<hr>\n\n<p><sup>1</sup> Here's a proof.  Let's say you have the specification for a Turing machine, and you make a list <code>steps</code> of the steps of its execution.  This list will be finite if it halts, infinite otherwise.  Now construct this list:</p>\n\n<pre><code>bad = zipWith const (cycle [1,2,3]) steps ++ cycle [1,2,3,4]\n</code></pre>\n\n<p>This list cycles with period 3 as long as the machine runs, and with period 4 afterward.  So if the Turing machine halts, <code>periodicity bad = 4</code>, otherwise <code>periodicity bad = 3</code>.  That is, <code>periodicity</code> can decide the halting problem, which is impossible.</p>\n"}, {"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1518375679, "last_edit_date": 1518375679, "creation_date": 1518339910, "answer_id": 48729940, "question_id": 48729684, "link": "https://stackoverflow.com/questions/48729684/periodicity-fibonacci-mod-sequence-in-infinites-list-haskell/48729940#48729940", "title": "Periodicity (Fibonacci mod sequence) in infinites list Haskell", "body": "<p>What you are asking for is impossible for an arbitrary infinite list.  We can only examine a finite sublist in finite time, and the next element of the list might, for all we know, break the pattern.</p>\n\n<p>In your comments, you clarify that you really are looking for a periodic part of the Fibonacci sequence, modulo <em>m</em>.  In that special case, it is possible, if I understand you correctly.</p>\n\n<p>The Fibonacci sequence (mod <em>m</em>) is periodic after a certain point if either the same value repeats three times: the previous two values are both equal to their predecessors, so the function becomes periodic with a period of 1.  It is also periodic after a certain point if any sequence of two or more numbers repeats even once, as then we know that the this value and its predecessor are repeats of the ones <em>k</em> and <em>k</em>-1 terms ago, and the function will generate the same subsequence again with period <em>k</em>.  There is no shorter period, or we would have detected it, going left to right.</p>\n\n<p>Furthermore, any sequence that repeats infinitely will repeat once first, so this detects all such sequences.</p>\n\n<p>Therefore, a better way to calculate this than I originally wrote would be to search for the current number and its predecessor earlier in the list.  (You can use luqui\u2019s strategy of building a list of consecutive pairs, or search the same data structure recursively instead of building a new one.)  If a match exists, the sequence is guaranteed to repeat with a period equal to the distance between the two appearances of the same pair.</p>\n\n<p>That takes time quadratic in the length of the non-periodic initial subsequence, since you search each initial subsequence from the beginning.  To do it in linear time with an upper bound of <em>m</em>\u200a\u00b2+2 steps: we know there are only <em>m</em> possible values, meaning only <em>m</em>\u200a\u00b2 possible pairs of values, a sequence of <em>k</em> numbers contains <em>k</em>-1 consecutive pairs of numbers, and therefore by the pigeonhole principle the first <em>m</em>\u200a\u00b2+2 elements of the sequence must contain some pair of consecutive values in two different places, and become periodic from the first instance of the pair onward. So searching that fixed-length initial subsequence suffices, and we can build a table of the index (if any) of each of the <em>n</em>\u200a\u00b2 potential pairs in the list until we encounter the first duplicate.  (That said, we would need to use a mutable array, so we sacrifice either speed or functional purity.)</p>\n\n<p>This is similar to lugui\u2019s algorithm, but with a faster lookup.</p>\n\n<h3>Conjecture</h3>\n\n<p>The sequence is periodic iff <code>0:1</code> appears more than once. If every Fibonacci sequence (mod <em>m</em>) is periodic, then the period is simply the position of the second occurrence of <code>[0,1]</code>.</p>\n\n<p><code>0:1</code> would be generated only by a preceding <code>-1:1</code>, which would be generated by a preceding <code>-3:2</code>, which would be generated by a preceding <code>-8:5</code>, and so on.  [...,-8,5,-3,2,-1,1,0] is exactly the fibonacci sequence, backwards, with alternating sign, mod <em>m</em>, and if any two consecutive numbers appear in the original sequence, it is periodic.  Thus, iff [0,1,1] would ever be generated by this pattern, it will eventually generate <code>0:1</code> in the Fibonacci sequence mod <em>m</em>.  This occurs iff <em>m</em>-1 and 1 occur consecutively in Fibo mod <em>m</em>, in either order.</p>\n\n<h3>Two Special Cases</h3>\n\n<p>If Fibo mod <em>m</em> contains <code>m-1:1</code> at position <em>i</em>, the sequence has period <em>i</em>+2, and if it contains <code>1:m-1</code>, the sequence has period 2\u200a<em>i</em>+4. (If the sequence contains <code>1:-1</code>, the next position is <em>i</em>+2 and the next <em>i</em>+2 steps are: {0,-1,-1,-2,-3,-5,...,-1,1}). So this lets us shortcut a bit; when we see <code>1,4</code> at position 8 of Fibo mod 5, we know the sequence has a period of 20. In this special case, the scan needs fewer than half the elements on average, has an upper bound of <em>m</em>\u200a\u00b2/2+1 elements to scan in order to rule the case out, and uses constant memory.</p>\n"}], "owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 48729929, "answer_count": 2, "score": 2, "last_activity_date": 1518375679, "creation_date": 1518337476, "last_edit_date": 1518340283, "question_id": 48729684, "link": "https://stackoverflow.com/questions/48729684/periodicity-fibonacci-mod-sequence-in-infinites-list-haskell", "title": "Periodicity (Fibonacci mod sequence) in infinites list Haskell", "body": "<p>I need to create a function in Haskell, which works as follows</p>\n\n<pre><code>periodicity ::[Integer] -&gt;[Integer]\nperiodicity [1,2,3,3,4,1,2,3,3,4...] = [1,2,3,4]\nperiodicity [0,1,2,2,5,4,3,3,0,1,2,5,4...] = [0,1,2,5,4,3]\n</code></pre>\n\n<p>That is to say, that from a list you get the part that is always repeated, what in Mathematical Sciences would be called period of a function.</p>\n\n<p>I've tried this, but I doesn't work like I want for the reason that I want that work with infinites list</p>\n\n<pre><code>periodicty :: Eq a =&gt; [a] -&gt; [a]\nperiodicity xs = take n xs\n    where l = length xs\n          n = head [m | m &lt;- divisors l, \n                        concat (replicate (l `div` m) (take m xs)) == xs]\n</code></pre>\n\n<p>I have found this function that gives me the length of period, I could have solved the problem, but I don't understand the code after where:</p>\n\n<pre><code>periodo 1 = 1\nperiodo n = f 1 ps 0\n  where\n   f 0 (1 : xs) pi = pi\n   f _ (x : xs) pi = f x xs (pi + 1)\n   ps = 1 : 1 : zipWith (\\u v -&gt; (u + v) `mod` n) (tail ps) ps \n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1518328418, "post_id": 48728742, "comment_id": 84456372, "body": "It needs to be able to determine when the value is <code>== 0</code> to check against your pattern, since <code>0</code> is a <code>Num a =&gt; a</code> and not a data constructor."}], "answers": [{"comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518331112, "post_id": 48728916, "comment_id": 84456948, "body": "Now I\u2019m curious: is there any <code>Num</code> instance <i>without</i> equality? Or are they just keeping that typeclass optional, just in case? Is that so you could, choose between different equivalence relations: <code>1&#47;2 == 2&#47;4</code>, or not, <code>Expr 1 + Expr 1 == Expr 2</code> or not?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 2, "creation_date": 1518332036, "post_id": 48728916, "comment_id": 84457144, "body": "@Davislor The example I&#39;ve seen quoted all over the place is &quot;you can make a sensiblish instance for functions&quot; (e.g. <a href=\"https://wiki.haskell.org/Num_instance_for_functions\" rel=\"nofollow noreferrer\">wiki.haskell.org/Num_instance_for_functions</a>), and functions <i>can&#39;t</i> have a good <code>Eq</code> instance. But that usually comes with the caveat &quot;you probably shouldn&#39;t use that <code>Num</code> instance&quot;. Another possibility that springs to mind is a data type representing expressions with variables. The operations in <code>Num</code> really don&#39;t have anything to do with the operations in <code>Eq</code>, so saying when you couldn&#39;t have one without providing the other it was less useful than it is now."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518336631, "post_id": 48728916, "comment_id": 84458039, "body": "But <i>surely</i> Haskell can represent equality over the Church numerals? All those professors of computer science can\u2019t have overlooked that."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518336878, "post_id": 48728916, "comment_id": 84458106, "body": "And more seriously, since GHC can pass function pointers around, I\u2019m pretty sure there has to be a way to coerce it to implement some form of identity. But this is veering off onto a tangent. Thanks for the great examples!"}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 2, "creation_date": 1518370173, "post_id": 48728916, "comment_id": 84467796, "body": "@Davislor GHC does let you peer into the runtime internals; check out the <code>unsafeAddr</code> function defined in <a href=\"https://stackoverflow.com/a/18563789/402884\">this answer</a>. But even if you do compare functions by the memory addresses at which they are represented, it still isn&#39;t a <i>good</i> equality test, because it will produce <code>False</code> in a lot of cases where you&#39;re comparing two different representations of what is really the same function. If you want  &quot;reference equality,&quot; the proper way is to use <code>IORef</code> (which does have an <code>Eq</code> instance) or something similar."}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 5, "last_activity_date": 1518330826, "last_edit_date": 1518330826, "creation_date": 1518330099, "answer_id": 48728916, "question_id": 48728742, "link": "https://stackoverflow.com/questions/48728742/haskell-pattern-matching-on-num-types/48728916#48728916", "title": "Haskell: pattern matching on Num types", "body": "<p>From the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html\" rel=\"noreferrer\">Haskell 2010 Report</a>, the section entitled <em>Informal Semantics of Pattern Matching</em>:</p>\n\n<blockquote>\n  <p>Matching a numeric, character, or string literal pattern <em>k</em> against a value <em>v</em> succeeds if <em>v</em> <code>==</code> <em>k</em></p>\n</blockquote>\n\n<p>So when you use a literal (such as <code>0</code>) as a pattern, its meaning depends upon <code>==</code> (a method of the <code>Eq</code> class).</p>\n\n<p>For example, your function <code>h</code></p>\n\n<pre><code>h 0 = -1\nh x = x + 1\n</code></pre>\n\n<p>can be rewritten as</p>\n\n<pre><code>h x | x == 0 = -1\nh x          = x + 1\n</code></pre>\n\n<p>You are (implicitly) using the <code>==</code> method, therefore you need an <code>Eq</code> constraint.</p>\n\n<p>There are two important observations here about how Haskell differs from a lot of other languages:</p>\n\n<ol>\n<li><strong>The notion of equality is not defined for all types.</strong> One cannot ask whether <code>x == y</code> unless the type of <code>x</code> and <code>y</code> has an <code>Eq</code> instance.</li>\n<li><strong>The set of numeric types is not fixed.</strong> A numeric literal can take on <em>any type that has an instance of <code>Num</code></em>. You can define your own type and make it an instance of <code>Num</code>, and it doesn't necessarily have to also have an instance of <code>Eq</code>. So not all \"numbers\" can be compared for equality.</li>\n</ol>\n\n<p>So it is insufficient for the context of your function <code>h</code> to be \"<code>a</code> has to be  a number.\" The context must be, more specifically, \"<code>a</code> has to be a number with an equality test\" to ensure that there is a way to check whether <code>x</code> is equal to <code>0</code> in order to perform the pattern match.</p>\n"}], "owner": {"reputation": 1676, "user_id": 869764, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/cAQKD.jpg?s=128&g=1", "display_name": "Guillaume", "link": "https://stackoverflow.com/users/869764/guillaume"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 651, "favorite_count": 0, "accepted_answer_id": 48728916, "answer_count": 1, "score": 4, "last_activity_date": 1518330826, "creation_date": 1518328297, "question_id": 48728742, "link": "https://stackoverflow.com/questions/48728742/haskell-pattern-matching-on-num-types", "title": "Haskell: pattern matching on Num types", "body": "<p>Why can't Haskell perform pattern matching on <code>Num</code> types, without us specifying <code>Eq</code> as a type class?</p>\n\n<p>For instance:</p>\n\n<pre><code>h :: Num a =&gt; a -&gt; a\nh 0 = -1\nh x = x + 1\n</code></pre>\n\n<p>When compiling this function, <code>ghci</code> complains:</p>\n\n<pre><code>    * Could not deduce (Eq a) arising from the literal `0'\n      from the context: Num a\n        bound by the type signature for:\n                   h :: forall a. Num a =&gt; a -&gt; a\n        at functions.hs:9:1-20\n      Possible fix:\n        add (Eq a) to the context of\n          the type signature for:\n            h :: forall a. Num a =&gt; a -&gt; a\n    * In the pattern: 0\n      In an equation for `h': h 0 = - 1\n   |\n10 | h 0 = -1\n   |   ^\n</code></pre>\n\n<p>Changing the function definition as following compiles and runs perfectly:</p>\n\n<pre><code>h :: (Num a, Eq a) =&gt; a -&gt; a\nh 0 = -1\nh x = x + 1\n\n*Main&gt; h 0\n-1\n*Main&gt;\n</code></pre>\n"}, {"tags": ["haskell", "lexicographic"], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 6, "last_activity_date": 1518318170, "creation_date": 1518318170, "answer_id": 48727871, "question_id": 48727762, "link": "https://stackoverflow.com/questions/48727762/what-is-an-elegant-idiom-for-a-lexicographic-ord-instance/48727871#48727871", "title": "What is an elegant idiom for a lexicographic Ord instance?", "body": "<p>Use <code>deriving</code>:</p>\n\n<pre><code>data Event a = Event { start :: Time\n                     , duration :: Time\n                     , payload :: Maybe a } deriving (Show, Eq, Ord)\n</code></pre>\n\n<p>The derived instance is automatically lexicographic.</p>\n"}, {"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 4, "creation_date": 1518322513, "post_id": 48727904, "comment_id": 84455407, "body": "If you want to save keystrokes, you can use <code>Data.Function.on</code>: <code>(&lt;=) = (&lt;=) `on` order</code>. You can also make it a one (well, two)-liner: <code>(&lt;=) = on (&lt;=) $ (,,) &lt;$&gt; start &lt;*&gt; duration &lt;*&gt; payload</code>"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1518318518, "creation_date": 1518318518, "answer_id": 48727904, "question_id": 48727762, "link": "https://stackoverflow.com/questions/48727762/what-is-an-elegant-idiom-for-a-lexicographic-ord-instance/48727904#48727904", "title": "What is an elegant idiom for a lexicographic Ord instance?", "body": "<p>As @HTNW notes, the automatically derived <code>Ord</code> instance will work.  In more general situations, if you need to sort lexicographically on multiple items each with existing <code>Ord</code> instances, you can use the automatic tuple <code>Ord</code> instance:</p>\n\n<pre><code>instance Ord a =&gt; Ord (Event a) where\n  (&lt;=) a b = order a &lt;= order b\n    where order x = (start x, duration x, payload x)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1518321912, "post_id": 48727943, "comment_id": 84455308, "body": "Nice. Now I feel foolish for having written <code>applyCmp f x y = mconcat (f &lt;*&gt; pure x &lt;*&gt; pure y)</code> a week ago."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1518319450, "last_edit_date": 1518319450, "creation_date": 1518319138, "answer_id": 48727943, "question_id": 48727762, "link": "https://stackoverflow.com/questions/48727762/what-is-an-elegant-idiom-for-a-lexicographic-ord-instance/48727943#48727943", "title": "What is an elegant idiom for a lexicographic Ord instance?", "body": "<p><a href=\"https://stackoverflow.com/a/48727871/2751851\">As HTNW suggests</a>, use <code>deriving</code> if you can. If you can't (e.g. the record fields aren't in the appropriate order, or you aren't actually writing an instance), a very nice option is doing it in terms of <code>compare</code> (or <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Ord.html#v:comparing\" rel=\"nofollow noreferrer\"><code>comparing</code></a>, which adds extra convenience in your case) rather than <code>(&lt;=)</code> and then taking advantage of the <code>Monoid</code> instance for <code>Ordering</code>, which amounts to lexicographic order:</p>\n\n<pre><code>import Data.Ord (comparing)\nimport Data.Monoid ((&lt;&gt;))\n\ninstance Ord a =&gt; Ord (Event a) where\n    compare a b = comparing start a b\n        &lt;&gt; comparing duration a b\n        &lt;&gt; comparing payload a b\n</code></pre>\n\n<p>As functions have a <code>Monoid</code> instance which acts on the results, you might take it even further:</p>\n\n<pre><code>instance Ord a =&gt; Ord (Event a) where\n    compare = comparing start &lt;&gt; comparing duration &lt;&gt; comparing payload\n</code></pre>\n"}], "owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 48727904, "answer_count": 3, "score": 4, "last_activity_date": 1518319450, "creation_date": 1518316875, "question_id": 48727762, "link": "https://stackoverflow.com/questions/48727762/what-is-an-elegant-idiom-for-a-lexicographic-ord-instance", "title": "What is an elegant idiom for a lexicographic Ord instance?", "body": "<p>This code works, but it's verbose, and I'm sure there's a more concise way.</p>\n\n<pre><code>import qualified Data.Vector as V\n\ndata Event a = Event { start :: Time\n                     , duration :: Time\n                     , payload :: Maybe a } deriving (Show, Eq)\n\ninstance Ord a =&gt; Ord (Event a) where\n  (&lt;=) a b = start a &lt; start b\n    || start a == start b &amp;&amp; duration a &lt; duration b\n    || start a == start b &amp;&amp; duration a == duration b &amp;&amp; payload a &lt;= payload b\n</code></pre>\n\n<p>The idea behind it is that if one thing starts before the other, you should call it the lesser, and don't even look at the other two fields. Similarly, if they start at the same time but one is more brief, then that briefer one is the lesser, and you can ignore the third field.</p>\n"}, {"tags": ["haskell", "category-abstractions"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1518303331, "post_id": 48726435, "comment_id": 84451809, "body": "&quot;the types don&#39;t work out&quot; is an incomplete write statement. Can you say more?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1518303499, "post_id": 48726435, "comment_id": 84451839, "body": "The types work out for me, after importing a couple modules."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1518304743, "post_id": 48726435, "comment_id": 84452107, "body": "Could you give an example instance or say more about the intent of this abstraction?"}, {"owner": {"reputation": 1008, "user_id": 2302508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/t3O8C.png?s=128&g=1", "display_name": "BlackCap", "link": "https://stackoverflow.com/users/2302508/blackcap"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1518305401, "post_id": 48726435, "comment_id": 84452255, "body": "@luqui It is a little bit lengthy, but I have included a minimal version of my two instances"}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 2, "last_activity_date": 1518322448, "last_edit_date": 1518322448, "creation_date": 1518322099, "answer_id": 48728168, "question_id": 48726435, "link": "https://stackoverflow.com/questions/48726435/common-functionality-for-different-types/48728168#48728168", "title": "Common functionality for different types", "body": "<p>I think there is a subtle inconsistency in your two instances -- that is, <code>Opt</code> and <code>Machine</code> do not quite have enough in common to share this much structure.  For example, the methods</p>\n\n<pre><code>yes :: f a a\n(..&gt;) :: f a b -&gt; f b c -&gt; f a c\n</code></pre>\n\n<p>are essentially a <code>Category</code>, as you have noticed (though I would simply make <code>Category</code> a superclass of <code>Binary</code> instead of duplicating those methods).  But <code>Machine</code> is not a category as it does not support composition.   Also, <code>Opt</code> is a profunctor (contravariant in its first argument, covariant in its second), whereas <code>Machine</code> is instead invariant on its first argument.  These are my hints that something needs to be changed before you try to abstract over these types.</p>\n\n<p>My suspicion is that there is a missing parameter to <code>Machine</code>, and the state parameter is actually external to the <code>Binary</code> abstraction. Try using the <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Arrow.html#t:Kleisli\" rel=\"nofollow noreferrer\">Kleisli category</a> of your monad.</p>\n\n<pre><code>newtype Machine s a b = Machine { unMachine :: a -&gt; MaybeT (State (Tape s)) b }\n</code></pre>\n\n<p>Now <code>Machine s</code> is a <code>Category</code> and the same sort of <code>Binary</code> that <code>Opt</code> is, and you don't need any of the primed combinators, and you can express any old <code>Machine a b</code>s as <code>Machine a () b</code> if you need to, but you can also probably generalize them.</p>\n\n<p>In fact, the abstraction you are looking for may simply be <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Arrow.html#t:ArrowZero\" rel=\"nofollow noreferrer\"><code>ArrowZero</code></a>.  <code>Arrow</code> has a bit more structure than <code>Category</code>, so you should consider whether the rest of <code>Arrow</code> is applicable to your problem. If so, you have just opened a new toolbox of combinators, and you don't need to write any instances by hand because they are all covered by:</p>\n\n<pre><code> type Opt = Kleisli Maybe\n type Machine s = Kleisli (MaybeT (State s))\n</code></pre>\n\n<p>(or in <code>newtype</code> style with <code>GeneralizedNewtypeDeriving</code> if you prefer)</p>\n"}], "owner": {"reputation": 1008, "user_id": 2302508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/t3O8C.png?s=128&g=1", "display_name": "BlackCap", "link": "https://stackoverflow.com/users/2302508/blackcap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 48728168, "answer_count": 1, "score": 2, "last_activity_date": 1559485382, "creation_date": 1518303220, "last_edit_date": 1559485382, "question_id": 48726435, "link": "https://stackoverflow.com/questions/48726435/common-functionality-for-different-types", "title": "Common functionality for different types", "body": "<p>I have identified some common functionality in two of my datatypes, so like any programmer worth his salt I tried to factor it out:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Binary where\n\nimport Control.Applicative\nimport Data.Function\nimport Control.Monad\n\n\nclass Binary f where\n  yes :: f a a\n  no  :: f a b\n  (..&gt;) :: f a b -&gt; f b c -&gt; f a c\n\n  yes' :: f a ()\n  (~.&gt;) :: f a b -&gt; f a c -&gt; f a c\n\n\ntry :: (Binary f, Alternative (f a)) =&gt; f a a -&gt; f a a\ntry = (&lt;|&gt; yes)\n\ntry' :: (Binary f, Alternative (f a)) =&gt; f a () -&gt; f a ()\ntry' = (&lt;|&gt; yes')\n\n(.&gt;) :: (Binary f, Alternative (f c)) =&gt; f a c -&gt; f c c -&gt; f a c\na .&gt; b = a ..&gt; try b\n\n(~&gt;) :: (Binary f, Alternative (f a)) =&gt; f a b -&gt; f a () -&gt; f a ()\na ~&gt; b = a ~.&gt; try' b\n\ngreedy :: (Binary f, Alternative (f a)) =&gt; f a a -&gt; f a a\ngreedy = fix $ ap (.&gt;)\n\ngreedy' :: (Binary f, Alternative (f a)) =&gt; f a () -&gt; f a ()\ngreedy' = fix $ ap (~&gt;)\n</code></pre>\n\n<p>As you can see, the types of <code>yes</code> and <code>yes'</code>, and <code>..&gt;</code> and <code>~.&gt;</code> are slightly different - they need to be for me to write instances - and so I end up with duplicate functions.</p>\n\n<p>Is there a way I can get rid of <code>yes'</code> and <code>~.&gt;</code>, and still make an instance of Binary with those types?</p>\n\n<p>Here are my two instances:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Example where\n\nimport Binary\n\nimport Prelude hiding ((.), id)\nimport Control.Category\nimport Data.List.Zipper as Z\nimport Control.Monad.Trans.Maybe\nimport Control.Monad.State\n\n\nnewtype Opt a b = Opt { runOpt :: a -&gt; Maybe b }\n\ninstance Category Opt where\n  id = yes\n  (Opt f) . (Opt g) = Opt $ g &gt;=&gt; f\n\ninstance Binary Opt where\n  yes = Opt Just\n  no = Opt $ const Nothing\n  (..&gt;) = (&gt;&gt;&gt;)\n\n---------\n\ntype Tape = Zipper\nnewtype Machine a b = Machine { unMachine :: MaybeT (State (Tape a)) b }\n\ninstance Functor (Machine a) where\n  fmap f (Machine x) = Machine $ f &lt;$&gt; x\n\ninstance Applicative (Machine a) where\n  pure = Machine . pure\n  (Machine f) &lt;*&gt; (Machine x) = Machine $ f &lt;*&gt; x\n\ninstance Monad (Machine a) where\n  (Machine a) &gt;&gt;= f = Machine $ a &gt;&gt;= unMachine &lt;$&gt; f\n\ninstance Binary Machine where\n  no = Machine mzero\n  yes' = pure ()\n  a ~.&gt; b = a &gt;&gt; b\n</code></pre>\n"}, {"tags": ["haskell", "optimization"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1518296348, "post_id": 48725329, "comment_id": 84449964, "body": "You can usually flatten arrow code with <code>Maybe</code> or <code>Either</code>, or one of the corresponding transformers (<code>MaybeT</code> or <code>EitherT</code>)."}, {"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 1, "creation_date": 1518307452, "post_id": 48725329, "comment_id": 84452702, "body": "FWIW, I think the flagging of this as a duplicate is inappropriate.  It&#39;s certainly not &quot;an exact duplicate of an existing question&quot;, though the question that it is linked to certainly provides useful feedback for solving this specific question."}], "owner": {"reputation": 4113, "user_id": 4601931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4785004388498e25bc6794fe1d9d4a38?s=128&d=identicon&r=PG&f=1", "display_name": "user4601931", "link": "https://stackoverflow.com/users/4601931/user4601931"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "closed_date": 1518296549, "answer_count": 0, "score": 1, "last_activity_date": 1518313518, "creation_date": 1518295005, "last_edit_date": 1518313518, "question_id": 48725329, "link": "https://stackoverflow.com/questions/48725329/idiomatic-way-to-sequence-actions-with-effects-in-haskell", "closed_reason": "Duplicate", "title": "Idiomatic way to sequence actions with effects in Haskell", "body": "<p>I have a workflow where I execute a list of shell commands, followed by a single shell command, and then followed by another list of shell commands.  The requirement is that if any of the commands fail, the subsequent ones are never executed.  Additionally, upon failure of any command, I'd like to do certain things based on which group of commands failed.  Specifically, if the list of \"pre-actions\" fails, the program should push log files accumulated to that point to some location (similarly with the list of \"post-actions\").  If the single command in the middle fails, though, I'd like to parse its log file, creating a separate log file, and then push all the log files that have been created up until that point.  </p>\n\n<p>Now, I have a function</p>\n\n<pre><code>import System.Exit (ExitCode (..))\n\nsequenceActions :: String   -- log file prefix\n                -&gt; [String] -- list of shell commands\n                -&gt; IO ExitCode \n</code></pre>\n\n<p>that executes a list of shell commands in order, writing its stdout/stderr to a log file with the given prefix, and returns failure immediately if any one command fails.  This function is built from a function that runs one command and logs its stdout/stderr:</p>\n\n<pre><code>runAction :: FilePath -- log file\n          -&gt; String   -- the shell command\n          -&gt; IO ExitCode\n</code></pre>\n\n<p>The main program is then</p>\n\n<pre><code>main :: IO ()\nmain = do\n  exitCode' &lt;- sequenceActions \"preactions_\" listOfPreactions\n\n  case exitCode' of\n    ExitSuccess -&gt; do\n      runAction mainLogFile mainShellCommand &gt;&gt;= \\exitCode -&gt; case exitCode of\n        ExitSuccess -&gt; do\n          exitCode'' &lt;- sequenceActions \"postactions_\" listOfPostactions\n          pushLogFiles logDestination\n          exitWith exitCode''\n        fail        -&gt; parseLogFile mainLogFile -- parse out exception and create a separate log file\n                    &gt;&gt; pushLogFiles logDestination\n                    &gt;&gt; exitWith fail\n    -- unable to run preactions\n    fail        -&gt; pushLogFiles logDestination &gt;&gt; exitWith fail\n</code></pre>\n\n<p>What bothers me about this is the nested <code>do</code> blocks and <code>case</code> statements, and I feel that there must be a more readable and idiomatic way to achieve the same thing.  Experienced Haskellers, is there a more concise and clean way to do this?</p>\n"}, {"tags": ["parsing", "haskell", "megaparsec"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1518295812, "post_id": 48725002, "comment_id": 84449812, "body": "I think you should better open issue on <code>megaparsec</code> github. To me it looks like better place to report errors. Also, <code>megaparsec</code> maintainer cares about his package, so you will receive decent answer there."}, {"owner": {"reputation": 1375, "user_id": 1795592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/456afa63d062cb01041348a6eaf49aa4?s=128&d=identicon&r=PG", "display_name": "Brian Magnuson", "link": "https://stackoverflow.com/users/1795592/brian-magnuson"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1518296357, "post_id": 48725002, "comment_id": 84449967, "body": "@Shersh - Yes, I considered that.  I thought it best to try here first though since I figured it more likely something I was doing wrong rather than a bug in megaparsec and didn&#39;t want to treat their github issue tracker as a support forum."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1518297589, "post_id": 48725002, "comment_id": 84450367, "body": "It might not be exactly bug but lack of documentation. To me it&#39;s completely okay to ask for explanations and then enhance documentation."}], "owner": {"reputation": 1375, "user_id": 1795592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/456afa63d062cb01041348a6eaf49aa4?s=128&d=identicon&r=PG", "display_name": "Brian Magnuson", "link": "https://stackoverflow.com/users/1795592/brian-magnuson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1518292729, "creation_date": 1518292729, "question_id": 48725002, "link": "https://stackoverflow.com/questions/48725002/megaparsec-reports-incorrect-location-on-parse-error", "title": "megaparsec reports incorrect location on parse error", "body": "<p>For this project I'm parsing in two stages.  The first stage handles include/ifdef/define directives and chunks the input up into <code>[Span]</code> items which define their start/end points in the original inputs along with the body text.  This stream is then parsed by the second stage into my AST for subsequent processing.</p>\n\n<p>Each element of the AST carries it's source position and any semantic error caught after parsing prints the <strong>correct</strong> error position regardless of include depth.  This part is crucial since it comes after the stage that has the problem.</p>\n\n<p>The problem is given a parse error in the second stage from an included file it reports a bogus error with a location at the top level rule in the input.  A parse error in the initial file works fine.  The presence of any directives will divide even the initial file into multiple chunks so it's not a 'single chunk' vs. 'multiple chunks' issue.</p>\n\n<p>Given the fact that the AST is getting the locations correct I'm stumped as to how Megaparsec is reporting bad info when parse errors are encountered.</p>\n\n<p>I'm included my stream instance and (set|get)(Position|Input) code since these seem like the relevant bits.  i feel like there must be some bit of megaparsec housekeeping that I'm not doing or that my Stream instance is invalid for some reason.</p>\n\n<pre><code>data Span = Span\n  { spanStart :: SourcePos\n  , spanEnd   :: SourcePos\n  , spanBody  :: T.Text\n  } deriving (Eq, Ord, Show)\n\ninstance Stream [Span] where\n  type Token  [Span] = Span\n  type Tokens [Span] = [Span]\n  tokenToChunk  Proxy = pure\n  tokensToChunk Proxy = id\n  chunkToTokens Proxy = id\n  chunkLength   Proxy = foldl1 (+) . map (T.length . spanBody)\n  chunkEmpty    Proxy = all ((== 0) . T.length . spanBody)\n\n  positionAt1 Proxy pos (Span start _ _) = trace (\"pos1\" ++ show start) start\n  positionAtN Proxy pos [] = pos\n  positionAtN Proxy _ (Span start _ _:_) = trace (\"posN\" ++ show start) start\n\n  advance1 Proxy _ _ (Span _ end _) = end\n  advanceN Proxy _ pos [] = pos\n  advanceN Proxy _ _ ts = let Span _ end _ = last ts in end\n\n  take1_ []     = Nothing\n  take1_ s      = case takeN_ 1 s of\n                    Nothing -&gt; Nothing\n                    Just (sp, s') -&gt; Just (head sp, s')\n\n  takeN_ _ [] = Nothing\n  takeN_ n s@(t:ts)\n    | s == [] = Nothing\n    | n &lt;= 0 = Just ([t {spanEnd = spanStart t, spanBody = \"\"}], s)\n    | n &lt;  (T.length . spanBody) t = let (l, r) = T.splitAt n (spanBody t)\n                                         sL = spanStart t\n                                         eL = foldl (defaultAdvance1 (mkPos 3)) sL (T.unpack (T.tail l))\n                                         sR = defaultAdvance1 (mkPos 3) eL (T.last l)\n                                         eR = spanEnd t\n                                         l' = [Span sL eL l]\n                                         r' = (Span sR eR r):ts\n                                     in Just (trace (show n) l', r')\n    | n == (T.length . spanBody) t = Just ([t], ts)\n    | otherwise = case takeN_ (n - T.length (spanBody t)) ts of\n                     Nothing -&gt; Just ([t], [])\n                     Just (t', ts') -&gt; Just (t:t', ts')\n\n\n  takeWhile_ p s = fromJust $ takeN_ (go 0 s) s\n    where go n s = case take1_ s of\n                      Nothing -&gt; n\n                      Just (c, s') -&gt; if p c\n                                      then go (n + 1) s'\n                                      else n\n</code></pre>\n\n<p>Find include and swap to it:</p>\n\n<pre><code>\"include\" -&gt; do\n     file &lt;- between dquote dquote (many (alphaNumChar &lt;|&gt; char '.' &lt;|&gt; char '/' &lt;|&gt; char '_'))\n     s    &lt;- liftIO (Data.Text.IO.readFile file)\n     p    &lt;- getPosition\n     i    &lt;- getInput\n     pushPosition p\n     stack %= (:) (p, i)\n     setPosition (initialPos file)\n     setInput s\n</code></pre>\n\n<p>And if we reach the end of input pop stack and continue:</p>\n\n<pre><code>parseStream' :: StreamParser [Span]\nparseStream' = concat &lt;$&gt; many p\n   where p = do\n          b &lt;- tick &lt;|&gt; block\n          end &lt;- option False (True &lt;$ hidden eof)\n          h &lt;- use stack\n          when (end &amp;&amp; (h /= [])) $ do\n            popPosition\n            setInput (h ^?! ix 0 . _2)\n            stack %= tail\n          return b\n</code></pre>\n"}, {"tags": ["list", "haskell", "ghc", "ghci"], "comments": [{"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1518284181, "post_id": 48723119, "comment_id": 84446095, "body": "I can reproduce it. <a href=\"https://gist.github.com/max630/657566ff4fc0fd082bf12099d685a1d7\" rel=\"nofollow noreferrer\">gist.github.com/max630/657566ff4fc0fd082bf12099d685a1d7</a>  Debian Jessie x64, stack lts-9.21. To me looks like some runtime leak. Note that gc does not report big memory residency."}, {"owner": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 5, "creation_date": 1518284839, "post_id": 48723119, "comment_id": 84446300, "body": "If you use &quot;<b>let</b> len = length [1..10^8]&quot; there is no leak. Might be related to that the assignment without let is a new feature of ghci."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 7268, "user_id": 2303202, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iT9aU.png?s=128&g=1", "display_name": "max630", "link": "https://stackoverflow.com/users/2303202/max630"}, "edited": false, "score": 0, "creation_date": 1518285439, "post_id": 48723119, "comment_id": 84446475, "body": "@max630 oh, interesting, I hadn&#39;t even considered that and wrote <code>let</code> in all tests. Without <code>let</code>, this indeed runs out of memory in GHC-8.2.1 and 8.3. Bug or just obscure difference in the evaluation strategy? Would be very strange this this were intended."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1518285823, "post_id": 48723119, "comment_id": 84446597, "body": "Using GHC 8.2.2 I can reproduce the leak and I can confirm it isn&#39;t there via <code>let</code>.    It is probably unrelated, but I see omitting <code>let</code> and using <code>:show bindings</code> reveals an additional binding that isn&#39;t there otherwise, namely <code>$trModule :: GHC.Types.Module = _</code>."}, {"owner": {"reputation": 25744, "user_id": 2089675, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/sBz5q.jpg?s=128&g=1", "display_name": "smac89", "link": "https://stackoverflow.com/users/2089675/smac89"}, "edited": false, "score": 0, "creation_date": 1518287707, "post_id": 48723119, "comment_id": 84447281, "body": "Ghci version 7 won&#39;t even let me do that i.e. declare a variable without using <code>let</code> keyword"}], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1518289321, "post_id": 48724086, "comment_id": 84447835, "body": "I&#39;m pretty sure list fusion doesn&#39;t happen at <code>-O0</code>. I seem to recall it being implemented in terms of rewrite rules, and those require <code>-O1</code> or higher."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1518298741, "post_id": 48724086, "comment_id": 84450663, "body": "Huh, you&#39;re right.  I was thrown off because the <code>-O0</code> version still runs in small, constant memory.  I&#39;ve tried to update the answer."}, {"owner": {"reputation": 145, "user_id": 2630827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fb024f7b59a96ae41723576edbc0759?s=128&d=identicon&r=PG", "display_name": "Carsten S", "link": "https://stackoverflow.com/users/2630827/carsten-s"}, "edited": false, "score": 0, "creation_date": 1518311281, "post_id": 48724086, "comment_id": 84453437, "body": "(1) is not an optimization, it is just how the language works."}, {"owner": {"reputation": 2652, "user_id": 5445670, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xrwS2.png?s=128&g=1", "display_name": "Solomon Ucko", "link": "https://stackoverflow.com/users/5445670/solomon-ucko"}, "edited": false, "score": 0, "creation_date": 1554461619, "post_id": 48724086, "comment_id": 97770659, "body": "I wonder why it doesn&#39;t optimize <code>length [a..b]</code> to a subtraction and increment.... Not implemented yet?"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 19, "last_activity_date": 1518298738, "last_edit_date": 1518298738, "creation_date": 1518286795, "answer_id": 48724086, "question_id": 48723119, "link": "https://stackoverflow.com/questions/48723119/binding-len-length-xs-and-then-calculating-len-causes-ghc-to-consume-lots/48724086#48724086", "title": "Binding `len = length xs` and then calculating `len` causes GHC to consume lots of RAM", "body": "<p><em>Update:</em> The optimization performed by <code>-O0</code> is a little different than I first understood.  Also, added a note about filing a new Trac bug.</p>\n\n<p>I can reproduce this in GHC 8.2.2.  Directly evaluating the expression (or using <code>let</code> to bind it to a variable and then evaluating it) both complete quickly:</p>\n\n<pre><code>Prelude&gt; length [1..10^8]\n10000000    -- pretty fast\nPrelude&gt; let len = length [1..10^8]\nPrelude&gt; len\n10000000    -- pretty fast\nPrelude&gt;\n</code></pre>\n\n<p>However, using the <code>let</code>-free syntax:</p>\n\n<pre><code>Prelude&gt; len = length [1..10^8]\nPrelude&gt; len\n10000000\nPrelude&gt;\n</code></pre>\n\n<p>takes longer and allocates a lot of memory which isn't freed until the session ends.</p>\n\n<p>Note that this is specific to GHCi and interactive mode -- in a real, compiled Haskell program, there would be no issue.  Compiling the following will run quickly and not consume excess memory:</p>\n\n<pre><code>len = length [1..10^8]\nmain = print len\n</code></pre>\n\n<p>To understand what's going on, you should understand that Haskell is capable of performing two potential optimizations of this code:</p>\n\n<ol>\n<li>It can explicitly create a lazy list and start computing its length but determine that once the beginning of the list has been counted, those elements will not be needed again allowing them to be immediately garbage collected.</li>\n<li>It can determine that no list needs to be created at all, and via a process known as \"list fusion\", create compiled code that counts directly from 1 up to 10^8 without trying to put those numbers in any kind of data structure.</li>\n</ol>\n\n<p>When this code is compiled with optimizations (<code>-O1</code> or <code>-O2</code>), GHC will perform optimization #2.  The compiled version will run quickly in a small amount of constant memory (a couple of megabytes resident for the runtime).  If you run this with:</p>\n\n<pre><code>$ time ./Length +RTS -s\n</code></pre>\n\n<p>to collect statistics, you'll find that GHC is still allocating about 1.6 gigabytes of heap, but this is actually to store the individual <code>Integer</code> values as they are being incremented.  (Since values in Haskell are immutable, a new <code>Integer</code> must be allocated for every increment.)  If you force the type to be <code>Int</code>:</p>\n\n<pre><code>len = length [(1::Int)..10^8]\n</code></pre>\n\n<p>then the program will allocate only a few kilobytes of heap, and you can see that truly there's no list being allocated.</p>\n\n<p>It turns out that when this code is compiled without optimizations (<code>-O0</code>), GHC only performs optimization #1 (as pointed out by @Carl), but it manages to do a really good job of it, so much so that even though the GHC statistics show lots of heap allocation, the program <em>still</em> runs quite quickly with a very small memory footprint.</p>\n\n<p>However, when this code is compiled to byte-code in GHCi, not only is just optimization #1 used, but GHC doesn't do quite so good a job of garbage collecting the list.  A huge multi-gigabyte list is generated, and the beginning is garbage collected <em>nearly</em> as fast as it's being generated.  Memory use ends up being quite large, but at least it's relatively constant.</p>\n\n<p>You can see this by turning on timing/memory stats:</p>\n\n<pre><code>&gt; :set +s\n&gt; length [1..10^8]\n100000000\n(1.54 secs, 7,200,156,128 bytes)\n&gt;\n</code></pre>\n\n<p>This means that this code actually allocates a 7.2 gigabyte list; fortunately, it can be thrown away almost as fast as it's generated, so the memory in use by the GHCi process after this computation will still be reasonably modest.</p>\n\n<p>You'll see that:</p>\n\n<pre><code>&gt; let len = length [1..10^8]\n&gt; len\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>&gt; len = length [1..10^8]\n&gt; len\n</code></pre>\n\n<p>chew through exactly the same enormous amount of memory (about 7.2 gigs).</p>\n\n<p>The difference is that, for some reason, the <code>let</code> version allows the list to be garbage collected as it's counted, and the non-<code>let</code> version doesn't.</p>\n\n<p>In the end, this is almost certainly a GHCi bug.  It might be related to one of the existing space-leak bugs that have been reported (e.g., Trac <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12848\" rel=\"noreferrer\">#12848</a> or <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14336\" rel=\"noreferrer\">#14336</a>), or maybe it's a new one.  I decided to file it as <a href=\"https://ghc.haskell.org/trac/ghc/ticket/14789\" rel=\"noreferrer\">#14789</a>, so maybe someone will take a look at it.</p>\n"}], "owner": {"reputation": 1067, "user_id": 4769035, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/27f6dfcd5cee3d8f265be617bb83049e?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4769035/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 426, "favorite_count": 2, "accepted_answer_id": 48724086, "answer_count": 1, "score": 27, "last_activity_date": 1518298738, "creation_date": 1518281084, "question_id": 48723119, "link": "https://stackoverflow.com/questions/48723119/binding-len-length-xs-and-then-calculating-len-causes-ghc-to-consume-lots", "title": "Binding `len = length xs` and then calculating `len` causes GHC to consume lots of RAM", "body": "<p>I found a strange thing about GHCi and lists.</p>\n\n<p>This command takes some time to execute and just returns the right answer.</p>\n\n<pre><code>ghci&gt; length [1..10^8]\n100000000\n</code></pre>\n\n<p>However, binding this to a variable and executing causes GHC to consume about 5 GiB of RAM without releasing until the GHCi session is over. Typing <code>:quit</code> after it consumes 3 GiB more before actually exiting.</p>\n\n<pre><code>ghci&gt; len = length [1..10^8]\nghci&gt; len\n-- Consumes 5 GiB\n100000000\nghci&gt; :quit\n-- Consumes 3 GiB\n-- Exits\n</code></pre>\n\n<p>Is this normal? What is the difference between the commands?</p>\n\n<p>GHC version is 8.2.2.</p>\n"}, {"tags": ["haskell", "associative", "associativity"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1518273149, "post_id": 48721373, "comment_id": 84442556, "body": "Also noteworthy - the default fixity is <code>infixl 9</code>, where 9 is the highest precedence offered to infix operators at 0 is the lowest. Also, you can specify the fixity of a normal function used infix by putting the name in backticks, the same as you do when actually using it infix."}, {"owner": {"reputation": 149, "user_id": 9315361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2986379ea47d8e73acfcba86c9059b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrik Iselind", "link": "https://stackoverflow.com/users/9315361/patrik-iselind"}, "edited": false, "score": 0, "creation_date": 1518280838, "post_id": 48721373, "comment_id": 84444859, "body": "As i understand it then, your <code>.+.</code>, <code>.-.</code>, and <code>.=.</code> represent the operators in your examples there. Are the dots part of the operator or the fixity syntax?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 149, "user_id": 9315361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2986379ea47d8e73acfcba86c9059b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrik Iselind", "link": "https://stackoverflow.com/users/9315361/patrik-iselind"}, "edited": false, "score": 0, "creation_date": 1518281191, "post_id": 48721373, "comment_id": 84444994, "body": "@PatrikIselind They are part of the name of the operator. <code>infixl 5 %*+</code> would also be OK, for operator <code>%*+</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1518269634, "creation_date": 1518269634, "answer_id": 48721373, "question_id": 48721203, "link": "https://stackoverflow.com/questions/48721203/what-in-the-implementation-needs-to-change-in-order-for-a-left-associative-opera/48721373#48721373", "title": "What in the implementation needs to change in order for a left associative operator to become right associative?", "body": "<p>To state that an operator is left- or right-associative, one can use a <a href=\"https://www.haskell.org/tutorial/functions.html\" rel=\"nofollow noreferrer\">fixity declaration</a>.</p>\n\n<p>For instance</p>\n\n<pre><code>infixl 5 .+.                  -- left associative\ninfixr 5 .-.                  -- right associative\ninfix  5 .=.                  -- not associative\n</code></pre>\n\n<p>The last one causes <code>x .=. y .=. z</code> to be a parse error, requiring explicit parentheses.</p>\n\n<p>The number <code>5</code> above is the precedence level, and should be chosen following the level of other operators (e.g. <code>(+)</code> is level 6, while <code>($)</code> has level 0).</p>\n"}], "owner": {"reputation": 149, "user_id": 9315361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2986379ea47d8e73acfcba86c9059b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrik Iselind", "link": "https://stackoverflow.com/users/9315361/patrik-iselind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 48721373, "answer_count": 1, "score": 1, "last_activity_date": 1518269634, "creation_date": 1518268649, "question_id": 48721203, "link": "https://stackoverflow.com/questions/48721203/what-in-the-implementation-needs-to-change-in-order-for-a-left-associative-opera", "title": "What in the implementation needs to change in order for a left associative operator to become right associative?", "body": "<p>I'm reading up on Haskell and as expected there are some operators that are left associative and others that are right associative. That got me thinking, how would the implementation differ for a new operator \u00a4, when comparing the left associative version versus the right associative version?</p>\n\n<p>So given <code>[1,2] \u00a4 [3,4] \u00a4 [5,6]</code>, what changes in the implementation if I want this to be interpreted as <code>(([1,2] \u00a4 [3,4]) \u00a4 [5,6])</code> versus <code>([1,2] \u00a4 ([3,4] \u00a4 [5,6]))</code>?</p>\n"}, {"tags": ["haskell", "polymorphism", "typeclass", "higher-rank-types", "adhoc-polymorphism"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1518299154, "post_id": 48721105, "comment_id": 84450779, "body": "Having just one available dictionary has another advantage besides &quot;the compiler can infer it for you&quot;: consider <code>Data.Set</code>, for which most operations demand an <code>Ord</code> dictionary. Having just one dictionary possible means you can&#39;t introduce bugs by matching up dictionaries and sets in the wrong way. And storing the dictionary in the set doesn&#39;t really help much, either, because there are operations that take two sets as arguments, and you <i>really</i> want them to have been constructed using the same dictionary."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1518299509, "post_id": 48721105, "comment_id": 84450862, "body": "Oh, and to comment on the last question: &quot;are there any advantages to explicit dictionaries?&quot;. Yes, definitely; in particular, it can often be convenient to have different instances of a given class for a given type. A standard example in the Haskell hierarchy are the <code>Product</code> and <code>Sum</code> newtypes, which exist solely to give two different <code>Monoid</code> instances to a single type. With explicit dictionaries, you could just have two dictionaries and not introduce the newtypes."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1518310567, "post_id": 48721105, "comment_id": 84453322, "body": "Another advantage of explicit dictionaries is that you can construct instances at runtime. So you can eg express arithmetic modulo p when you don\u2019t know p at compile time. This can actually be done in Haskell by using <code>reflect</code> which essentially allows one to create instances at runtime using some horrific GHC internals magic."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1518299473, "last_edit_date": 1518299473, "creation_date": 1518267957, "answer_id": 48721105, "question_id": 48720939, "link": "https://stackoverflow.com/questions/48720939/can-type-classes-at-the-type-level-be-simulated-with-higher-rank-types/48721105#48721105", "title": "Can type classes at the type level be simulated with higher-rank types?", "body": "<p>The idea of representing a class by a data type is basically a <em>dictionary</em>, which is in fact pretty much how GHC implements type classes anyway: a constrained-polymorphic function/value</p>\n\n<pre><code>f :: Functor f =&gt; Y\n</code></pre>\n\n<p>is at runtime represented by a function</p>\n\n<pre><code>_f_ :: FunctorDict f -&gt; Y\n</code></pre>\n\n<p>where <code>FunctorDict</code> is essentially your <code>Functor</code> Rank2-ADT (or GADT).</p>\n\n<p>The main thing that's special about actual type classes is that these dictionaries have the <em>singleton property</em>: for every type constructor <code>F</code>, there can only ever be exactly one <code>instance Functor F</code>, whereas you can in principle have multiple different <code>FunctorDict F</code> values. That can at times actually be an an advantage, but often it's just a burden because you need to explicitly carry those dictionaries around (GHC can just pick them automatically, because the choice is unambiguous), and it's harder to state laws.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 48721105, "answer_count": 1, "score": 6, "last_activity_date": 1518299473, "creation_date": 1518266900, "question_id": 48720939, "link": "https://stackoverflow.com/questions/48720939/can-type-classes-at-the-type-level-be-simulated-with-higher-rank-types", "title": "Can type classes at the type level be simulated with higher-rank types?", "body": "<p>I have a pluggable runtime type checker that supports parametric but no ad-hoc polymorphism, because there is no compiling step and type information are erased as soon as the type checker is deactivated.</p>\n\n<p>Now I recently came up with the idea to reify type classes with an explicit type, so that I gain some of their advantages without having to fully incorporate the underlying mechanism into the type checker:</p>\n\n<pre><code>data Functor f = Functor {fmap :: forall a b. (a -&gt; b) -&gt; f a -&gt; f b}\n\nmapList = Functor map\nfmap (mapList) (+1) [1,2,3]\n</code></pre>\n\n<p>It seems as if type classes can be simulated with rank-2 types, at least at the type level, since, of course, there is still no static dispatching.</p>\n\n<p>Is my assumption right and since I am a Haskell rookie, does my explicit functor type involves any advantages over just using <code>map</code> directly?</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "matrix-multiplication"], "comments": [{"owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "edited": false, "score": 0, "creation_date": 1518513756, "post_id": 48720747, "comment_id": 84527049, "body": "Did you try <a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/users_guide/profiling.html\" rel=\"nofollow noreferrer\">profiling?</a>"}, {"owner": {"reputation": 107, "user_id": 3925436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf9a6edd82ce618bfb3a69a9ab3214cd?s=128&d=identicon&r=PG&f=1", "display_name": "vvebik", "link": "https://stackoverflow.com/users/3925436/vvebik"}, "reply_to_user": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "edited": false, "score": 0, "creation_date": 1518646859, "post_id": 48720747, "comment_id": 84596868, "body": "@YotamOhad yes, but I got almost same call stacks. Only different percentages of time for some internal functions."}], "owner": {"reputation": 107, "user_id": 3925436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf9a6edd82ce618bfb3a69a9ab3214cd?s=128&d=identicon&r=PG&f=1", "display_name": "vvebik", "link": "https://stackoverflow.com/users/3925436/vvebik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1518272695, "creation_date": 1518265522, "last_edit_date": 1518272695, "question_id": 48720747, "link": "https://stackoverflow.com/questions/48720747/performance-of-lazy-and-strict-evaluations-in-haskell", "title": "Performance of lazy and strict evaluations in Haskell", "body": "<p>I implemented the Winograd algorithm on Haskell and, trying to improve it, decided to make it more strict. I did this, but I do not understand why it started to work faster. <a href=\"https://stackoverflow.com/questions/48714703/comparison-of-lazy-and-strict-evaluations-in-haskell\">Yesterday</a> I asked a similar question, but posted not quite correct code.</p>\n\n<p>Since that code does not show a problem, I post the code completely.</p>\n\n<pre><code>module Main where\n\nimport qualified Data.Vector as V\nimport qualified Data.Matrix as M\n\nimport Control.DeepSeq\nimport Control.Exception\nimport System.Clock\nimport System.Mem\nimport Data.Time\n\nmatrixCtor :: Int -&gt; Int -&gt; Int -&gt; M.Matrix Int\nmatrixCtor x y size = M.matrix size size $ \\(i,j) -&gt; x*i+y*j\n\nwinogradLazy :: M.Matrix Int -&gt; M.Matrix Int -&gt; M.Matrix Int\nwinogradLazy a b = c\n  where\n    n = M.nrows a\n    p = M.ncols a\n    m = M.ncols b\n\n\n    -- Translate into vectors, since indexing in matrices takes longer.\n    -- Matrix b is also transposed\n    a' = V.generate n $ \\i -&gt; M.getRow (i+1) a\n    bt' = V.generate m $ \\j -&gt; M.getCol (j+1) b\n\n    rows = V.generate n $ \\i -&gt; group $ V.unsafeIndex a' i\n    cols = V.generate m $ \\j -&gt; group $ V.unsafeIndex bt' j\n\n    group x = foldl (groupHelper x) 0 [0,2..p-1]\n    groupHelper x acc i = let\n                            x1 = V.unsafeIndex x (i)\n                            x2 = V.unsafeIndex x (i+1)\n                          in\n                            acc - x1 * x2\n\n    c = M.matrix n m $ \\(i,j) -&gt;\n          let\n            a = V.unsafeIndex rows (i-1) + V.unsafeIndex cols (j-1)\n            b = wsum (V.unsafeIndex a' (i-1)) (V.unsafeIndex bt' (j-1))\n          in\n            a + b\n\n\n    wsum r c = foldl (wsumHelper r c) 0 [0,2..p-1]\n    wsumHelper r c acc i =  let\n                              x1 = V.unsafeIndex r (i)\n                              x2 = V.unsafeIndex r (i+1)\n                              y1 = V.unsafeIndex c (i)\n                              y2 = V.unsafeIndex c (i+1)\n                            in\n                              acc +(x1+y2)*(x2+y1)\n\n\nwinogradStrict :: M.Matrix Int -&gt; M.Matrix Int -&gt; M.Matrix Int\nwinogradStrict a b = c\n  where\n    n = M.nrows a\n    p = M.ncols a\n    m = M.ncols b\n\n    -- Translate into vectors, since indexing in matrices takes longer.\n    -- Matrix b is also transposed\n    a' = V.generate n $ \\i -&gt; M.getRow (i+1) a\n    bt' = V.generate m $ \\j -&gt; M.getCol (j+1) b\n\n\n    rows = V.generate n $ \\i -&gt; group $ V.unsafeIndex a' i\n    cols = V.generate m $ \\j -&gt; group $ V.unsafeIndex bt' j\n\n\n    group x = foldl (groupHelper x) 0 [0,2..p-1]\n    groupHelper x acc i = let\n                            x1 = V.unsafeIndex x (i)\n                            x2 = V.unsafeIndex x (i+1)\n                          in\n                            acc - x1 * x2\n\n    c = a' `deepseq` bt' `deepseq` M.matrix n m $ \\(i,j) -&gt;\n          let\n            a = V.unsafeIndex rows (i-1) + V.unsafeIndex cols (j-1)\n            b = wsum (V.unsafeIndex a' (i-1)) (V.unsafeIndex bt' (j-1))\n          in\n            a + b\n\n    wsum r c = foldl (wsumHelper r c) 0 [0,2..p-1]\n    wsumHelper r c acc i =  let\n                              x1 = V.unsafeIndex r (i)\n                              x2 = V.unsafeIndex r (i+1)\n                              y1 = V.unsafeIndex c (i)\n                              y2 = V.unsafeIndex c (i+1)\n                            in\n                              acc + (x1+y2)*(x2+y1)\n\n\n\nlazyTest :: IO ()\nlazyTest = do\n  let a = matrixCtor 2 (-1) 500\n  let b = matrixCtor 2 (-3) 500\n  evaluate $ force a\n  evaluate $ force b\n  start &lt;- getCurrentTime\n  let c = winogradLazy a b\n  evaluate $ force c\n  end &lt;- getCurrentTime\n  print (diffUTCTime end start)\n\n\nstrictTest :: IO ()\nstrictTest = do\n  let a = matrixCtor 2 (-1) 500\n  let b = matrixCtor 2 (-3) 500\n  evaluate $ force a\n  evaluate $ force b\n  start &lt;- getCurrentTime\n  let c = winogradStrict a b\n  evaluate $ force c\n  end &lt;- getCurrentTime\n  print (diffUTCTime end start)\n\n\nmain :: IO ()\nmain = do\n  performMajorGC\n  lazyTest\n  performMajorGC\n  strictTest\n</code></pre>\n\n<p>in the strict version before computing the matrix <code>c</code>, I do the following: </p>\n\n<pre><code>a' `deepseq` bt' `deepseq` \n</code></pre>\n\n<p>and because of this I get the following results</p>\n\n<pre><code>2.083201s --lazyTest\n0.613508s --strictTest\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 2, "creation_date": 1518254889, "post_id": 48718868, "comment_id": 84437357, "body": "Consider using the <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow noreferrer\">right section</a> <code>(&gt; 0)</code> instead of <code>((&lt;) 0)</code> - it reads more naturally."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1518260150, "post_id": 48718868, "comment_id": 84438861, "body": "you can sidestep the whole conversion problem with <code>isprime&#39;&#39; n = all (0 &lt;)  [n `rem` k | k &lt;- takeWhile (\\i -&gt; i*i &lt;= n) [2..] ]</code>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1518260443, "post_id": 48718868, "comment_id": 84438934, "body": "by the way you need to add a special case for <code>isprime* 1 = False</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1246, "user_id": 3878013, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lRPxj.png?s=128&g=1", "display_name": "clocker", "link": "https://stackoverflow.com/users/3878013/clocker"}, "edited": false, "score": 0, "creation_date": 1518271638, "post_id": 48718999, "comment_id": 84442109, "body": "Ok thanks, that helps a lot. I did start with an initial type annotation isprime::Integer &lt;- Bool, but a different error showed up, presumably because of the contradiction you mentioned."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1518253021, "creation_date": 1518253021, "answer_id": 48718999, "question_id": 48718868, "link": "https://stackoverflow.com/questions/48718868/using-ceiling-sqrt-in-range-causes-error/48718999#48718999", "title": "Using (ceiling . sqrt) in range causes error", "body": "<p>Use an explicit conversion, instead:</p>\n\n<pre><code>[2..(ceiling . sqrt . fromIntegral) n]\n</code></pre>\n\n<p>Otherwise, you are calling <code>sqrt</code> on the type of <code>n</code>, forcing that type to be a <code>Floating</code>. The rest of the code already requires <code>n</code> to have some <code>Integral</code> type. </p>\n\n<p>These two requirements can not be satisfied: standard numeric types are either floating point, or fixed point (<code>Integral</code>, roughly).</p>\n\n<p>It would also greatly help if you started to write your functions from their type annotations. This prevents GHC to infer a type which was not intended -- when that happens errors are detected much later on, causing confusion.</p>\n"}], "owner": {"reputation": 1246, "user_id": 3878013, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lRPxj.png?s=128&g=1", "display_name": "clocker", "link": "https://stackoverflow.com/users/3878013/clocker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 48718999, "answer_count": 1, "score": 0, "last_activity_date": 1518253021, "creation_date": 1518252048, "question_id": 48718868, "link": "https://stackoverflow.com/questions/48718868/using-ceiling-sqrt-in-range-causes-error", "title": "Using (ceiling . sqrt) in range causes error", "body": "<p>I just started learning Hasekll a few days ago and was playing around with ranges when I ran into a cryptic error while trying a quick and dirty prime number checker. </p>\n\n<pre><code>isprime n = all ((&lt;) 0)  [n `rem` k | k &lt;- [2..n-1]] -- okay\nisprime' n = all ((&lt;) 0)  [n `rem` k | k &lt;- [2..(ceiling . sqrt) n]] -- compiles but busted\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>Prelude&gt; isprime 19\nTrue\n\nPrelude&gt; isprime' 19\n\n&lt;interactive&gt;:46:1: error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018isprime'\u2019\n      prevents the constraint \u2018(Floating a0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instances exist:\n        instance Floating Double -- Defined in \u2018GHC.Float\u2019\n        instance Floating Float -- Defined in \u2018GHC.Float\u2019\n    \u2022 In the expression: isprime' 19\n      In an equation for \u2018it\u2019: it = isprime' 19\n\n&lt;interactive&gt;:46:10: error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from the literal \u201819\u2019\n      prevents the constraint \u2018(Num a0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instances exist:\n        instance Num Integer -- Defined in \u2018GHC.Num\u2019\n        instance Num Double -- Defined in \u2018GHC.Float\u2019\n        instance Num Float -- Defined in \u2018GHC.Float\u2019\n        ...plus two others\n        ...plus one instance involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    \u2022 In the first argument of \u2018isprime'\u2019, namely \u201819\u2019\n      In the expression: isprime' 19\n      In an equation for \u2018it\u2019: it = isprime' 19\n</code></pre>\n\n<p>So I checked the following, and both turn out as expected. </p>\n\n<pre><code>Prelude&gt; [rem 19 k | k &lt;- [2.. 19-1]] \n[1,1,3,4,1,5,3,1,9,8,7,6,5,4,3,2,1]\n\nPrelude&gt; [rem 19 k | k &lt;- [2..(ceiling . sqrt) 19]] \n[1,1,3,4]\n</code></pre>\n\n<p>Can anyone help me understand the issue? If there is a good section in the online Haskell tutorials, would appreciate a pointer. Thanks!</p>\n"}, {"tags": ["haskell", "types", "gadt"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 3, "creation_date": 1518242993, "post_id": 48717804, "comment_id": 84434706, "body": "Haskell is not (currently) dependently typed. You cannot use the value-level function <code>nAdd</code> in a type signature. <code>Natty (nAdd n m)</code> just treats <code>nAdd</code> as a unique, curiously-named type variable. Perhaps you want to use a closed type family instead? Alternatively, the <code>singletons</code> library can promote the function to a type family for you."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 5, "last_activity_date": 1518244333, "creation_date": 1518244333, "answer_id": 48717963, "question_id": 48717804, "link": "https://stackoverflow.com/questions/48717804/why-cant-haskell-deduce-that-this-type-is-correct/48717963#48717963", "title": "Why can&#39;t Haskell deduce that this type is correct?", "body": "<p>As @AlexisKing notes, the <code>nAdd</code> in the type signature for <code>foo</code> is just treated as another type variable (like <code>m</code> or <code>n</code>) and Haskell doesn't tie it back to the definition of the function <code>nAdd</code>.</p>\n\n<p>In Haskell, you can't apply term-level functions (like <code>nAdd</code>) to types.  Instead, you need to use type families.  If you define a type-level \"function\" <code>NAdd</code> as a type family:</p>\n\n<pre><code>type family NAdd (a :: Nat) (b :: Nat) :: Nat\ntype instance NAdd n Zero = n\ntype instance NAdd n (Suc m) = Suc (NAdd n m)\n</code></pre>\n\n<p>then you can use this function in your <code>foo</code> signature:</p>\n\n<pre><code>foo :: Natty n -&gt; Natty m -&gt; Natty (NAdd n m)\nfoo x  Zy    = x\nfoo x (Sy y) = Sy $ foo x y \n</code></pre>\n\n<p>This requires a number of additional extensions to work, and the complete working example (running under GHC 8.2.2) looks like this:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeInType #-}\n\nimport Data.Kind\n\ndata Nat :: * where \n    Zero :: Nat\n    Suc  :: Nat -&gt; Nat\n\ndata Natty :: Nat -&gt; * where\n    Zy :: Natty Zero\n    Sy :: Natty n -&gt; Natty (Suc n)\n\ntype family NAdd (a :: Nat) (b :: Nat) :: Nat\ntype instance NAdd n Zero = n\ntype instance NAdd n (Suc m) = Suc (NAdd n m)\n\nnAdd :: Nat -&gt; Nat -&gt; Nat\nnAdd x  Zero    = x\nnAdd x (Suc y)  = Suc $ nAdd x y\n\nfoo :: Natty n -&gt; Natty m -&gt; Natty (NAdd n m)\nfoo x  Zy    = x\nfoo x (Sy y) = Sy $ foo x y \n\ntest1 = foo (Sy Zy) (Sy $ Sy Zy)\ntest2 = Sy $ Sy $ Sy Zy\n</code></pre>\n"}], "owner": {"reputation": 333, "user_id": 5863981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TU6uQ.jpg?s=128&g=1", "display_name": "TheJohnMajor01", "link": "https://stackoverflow.com/users/5863981/thejohnmajor01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 48717963, "answer_count": 1, "score": 1, "last_activity_date": 1518244333, "creation_date": 1518242859, "question_id": 48717804, "link": "https://stackoverflow.com/questions/48717804/why-cant-haskell-deduce-that-this-type-is-correct", "title": "Why can&#39;t Haskell deduce that this type is correct?", "body": "<p>I have a simple definition for a Nat and a definition for types indexed by Nat's, Natty.</p>\n\n<pre><code>data Nat :: * where \n    Zero :: Nat\n    Suc  :: Nat -&gt; Nat\n\ndata Natty :: Nat -&gt; * where\n    Zy :: Natty Zero\n    Sy :: Natty n -&gt; Natty (Suc n)\n</code></pre>\n\n<p>My goal is to create a function that, given a type indexed by Nat n and a type indexed by Nat m, will produce a type indexed by type Nat n + m.</p>\n\n<p>For example, foo (Sy Zy) (Sy $ Sy Zy) = Sy $ Sy $ Sy Zy</p>\n\n<p>Nat addition is simple and is defined as such:</p>\n\n<pre><code>nAdd :: Nat -&gt; Nat -&gt; Nat\nnAdd x  Zero    = x\nnAdd x (Suc y)  = Suc $ nAdd x y\n</code></pre>\n\n<p>I had thought that foo would be defined similarly in the following way:</p>\n\n<pre><code>foo :: Natty n -&gt; Natty m -&gt; Natty (nAdd n m)\nfoo x  Zy    = x\nfoo x (Sy y) = Sy $ foo x y \n</code></pre>\n\n<p>But this leads to an interesting error:</p>\n\n<pre><code>Could not deduce: n ~ nAdd n 'Zero\nfrom the context: m ~ 'Zero\n</code></pre>\n\n<p><strong>Why can't haskell deduce that n ~ nAdd n 'Zero? Is there a simple way to fix this or will a different approach be needed?</strong></p>\n\n<p>Thanks, any input would be greatly appreciated. The following extensions are also used.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, KindSignatures, GADTs #-} \n</code></pre>\n"}, {"tags": ["haskell", "monad-transformers", "haskell-lens", "ioref"], "answers": [{"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 1, "last_activity_date": 1518286931, "creation_date": 1518286931, "answer_id": 48724116, "question_id": 48717004, "link": "https://stackoverflow.com/questions/48717004/zoom-instance-for-readert-ioref/48724116#48724116", "title": "Zoom instance for ReaderT IORef", "body": "<p>My suggestion would be:</p>\n\n<pre><code>type instance Zoomed (MyStateT s m) = Focusing m\n\ninstance (MonadIO m) =&gt; Zoom (MyStateT s m) (MyStateT t m) s t where\n    zoom l (MyStateT r) =\n        MyStateT $ ReaderT $ \\ref -&gt; do\n            s &lt;- liftIO $ readIORef ref\n            (v', s') &lt;- unfocusing . flip l s $ \\t -&gt; Focusing $ do\n                ref' &lt;- liftIO (newIORef t)\n                v &lt;- runReaderT r ref'\n                t' &lt;- liftIO (readIORef ref')\n                return (v, t')\n            liftIO $ writeIORef ref s'\n            return v'\n    {-# INLINE zoom #-}\n</code></pre>\n\n<p>The problem you were having with <code>(^.)</code> and <code>(.~)</code> is that they work for <code>Lens</code>, which is polymorphic in the functor. But here the functor is fixed to be <code>Zoomed (MyState s m) c</code>, which is <code>Focusing m c</code>. So you need to apply <code>l</code> directly using function application.</p>\n\n<p>Note: You need to be a bit careful with this implementation. <code>IORef</code> ins't atomic, unless you use <code>atomicModifyIORef</code> on a pure function (which doesn't seem possible in <code>zoom</code>). So it might make sense to use <code>MVar</code> with <code>takeMVar</code> and <code>putMVar</code> instead, to make sure your computations work correctly when running in a multi-threaded environment.</p>\n"}], "owner": {"reputation": 67, "user_id": 9341175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/105c6aa16f689099e18a3ec34952131b?s=128&d=identicon&r=PG&f=1", "display_name": "Bob", "link": "https://stackoverflow.com/users/9341175/bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 48724116, "answer_count": 1, "score": 1, "last_activity_date": 1526819289, "creation_date": 1518234410, "last_edit_date": 1526819289, "question_id": 48717004, "link": "https://stackoverflow.com/questions/48717004/zoom-instance-for-readert-ioref", "title": "Zoom instance for ReaderT IORef", "body": "<p>I'm new to lens and having trouble implementing the Zoom instance for this type:</p>\n\n<pre><code>newtype MyStateT s m a = MyStateT\n    { unMyStateT :: ReaderT (IORef s) m a\n    } deriving (Functor, Applicative, Monad, MonadIO)\n\ninstance (MonadIO m) =&gt; MonadState s (MyStateT s m) where\n    get = MyStateT $ ReaderT $ liftIO . readIORef\n    put x = MyStateT $ ReaderT $ \\ref -&gt; liftIO $ writeIORef ref x\n</code></pre>\n\n<p>I've been trying to make a new IORef with the lens substate, run the ReaderT on that substate, and then grab the changed substate and replace it in the main IORef:</p>\n\n<pre><code>type instance Zoomed (MyStateT s m) = Focusing m\ninstance (Monad m) =&gt; Zoom (MyStateT s m) (MyStateT t m) s t where\n    zoom l (MyStateT r) =\n        MyStateT $ ReaderT $ \\ref -&gt; do\n            s &lt;- liftIO $ readIORef ref\n            ref' &lt;- liftIO $ newIORef $ s ^. l\n            let v = runReader r ref'\n            subS' &lt;- liftIO $ readIORef ref'\n            let s' = s &amp; l .~ subS'\n            liftIO $ writeIORef ref s'\n            return v\n</code></pre>\n\n<p><code>l</code> seems to be different from a normal lens so <code>^.</code> and <code>.~</code> doesn't compile with it and I get errors like this:</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018Focusing m c t\u2019 with \u2018Const s t\u2019\n  Expected type: Getting s t s\n    Actual type: LensLike' (Zoomed (MyStateT s m) c) t s\n   \u2022 Couldn't match type \u2018Focusing m c t\u2019 with \u2018Identity t\u2019\n  Expected type: ASetter t t s s\n    Actual type: LensLike' (Zoomed (MyStateT s m) c) t s\n</code></pre>\n\n<p>Can anyone help me get this Zoom instance to work properly? Thanks!</p>\n"}, {"tags": ["haskell", "recursion", "fixpoint-combinators", "denotational-semantics"], "comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518227061, "post_id": 48716364, "comment_id": 84432118, "body": "Uh, I think that means least according to some <i>ordering</i>."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1518227125, "post_id": 48716364, "comment_id": 84432128, "body": "Here it\u2019s the least function <code>f</code> such that <code>\\x -&gt; if x &gt; 7 then f (x - 1) else x</code> is equivalent to <code>f</code>. So I don\u2019t think that says anything about picking between those two functions <code>f1</code> and <code>f2</code> you\u2019ve given."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1518227303, "post_id": 48716364, "comment_id": 84432159, "body": "&quot;The latter is &quot;least defined &quot;&quot; - this is not true (nor is it actually relevant to the definition of <code>fix</code> - that talks about the defindedness of <code>fix f</code> and not of <code>f</code>). If two terms contain no bottoms then they are equally defined. &quot;There is some ambiguity here still as undefined may mean either &quot;will throw an error&quot; (the better) or &quot;will never terminate&quot; (the worse).&quot; - there is no ambiguity, because you may not observe the difference in pure code."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1518227477, "post_id": 48716364, "comment_id": 84432192, "body": "@user2407038 For all practical purposes though, there is a life and death difference inside this purely unambiguous undefinedness. And we may as well infer it from code analysis. I&#39;d even say we must."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518228251, "post_id": 48716364, "comment_id": 84432308, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/4787421/how-do-i-use-fix-and-how-does-it-work\">How do I use fix, and how does it work?</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1518228339, "post_id": 48716364, "comment_id": 84432325, "body": "@Kindaro &quot;For all practical purposes though, there is a life and death difference inside this purely unambiguous undefinedness.&quot; - I cannot parse this sentence. I don&#39;t believe it matters though; when you read &quot;least defined&quot; in this context it is explicitly referring to a semantics in which non-termination and errors are equally defined. You may talk of a different semantics and what <code>fix</code> means in a language with such different semantics; but that language is not Haskell."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 3, "creation_date": 1518228444, "post_id": 48716364, "comment_id": 84432344, "body": "In this context, \u201cleast defined\u201d does not mean \u201cmost-undefined,\u201d it means, \u201cdefined and lowest in a particular ordering of the domain.\u201d Also, it applies to the argument, not the function."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 3, "creation_date": 1518228602, "post_id": 48716364, "comment_id": 84432373, "body": "The ordering to which @Davislor refers to is detailed <a href=\"https://en.wikibooks.org/wiki/Haskell/Denotational_semantics\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518229949, "post_id": 48716364, "comment_id": 84432619, "body": "@Davislor I think it would be great to have some answer that details on this <i>ordering</i> rather than hinting upon it. I will be reading the link on denotational semantics, but still I&#39;d rather have an (hopefully more practical) answer here as well."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518230386, "post_id": 48716364, "comment_id": 84432686, "body": "I\u2019m not sure whether that\u2019s a request for me specifically, or to the better-informed readers here on SX, but unfortunately, I\u2019m not qualified to do it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1518260464, "post_id": 48716364, "comment_id": 84438942, "body": "Check out <code>fix (1:)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 6, "last_activity_date": 1518246127, "creation_date": 1518246127, "answer_id": 48718154, "question_id": 48716364, "link": "https://stackoverflow.com/questions/48716364/in-what-sense-is-one-function-less-defined-than-another/48718154#48718154", "title": "In what sense is one function &quot;less defined&quot; than another?", "body": "<p>In Haskell, functions are pure. They take input and yield output. So the natural question arises: what about functions that don't terminate?</p>\n\n<pre><code>f x = 1 + f x\n</code></pre>\n\n<p>This function will lock your interpreter in an infinite loop. But mathematically, we have to say it \"returns\" something, or else it's not a function. We call this special \"something went wrong\" value the \"bottom\" value  and we denote it with the symbol <code>\u22a5</code>.</p>\n\n<p>So, mathematically speaking, the Haskell <code>Int</code> type contains every integer, plus an additional special element: <code>\u22a5</code>. We call a type which contains <code>\u22a5</code> a \"lifted\" type, and pretty much all types you'll use in Haskell are lifted.<sup>[1]</sup> As it turns out, an infinite loop is not the only way to invoke <code>\u22a5</code>. We can also do so by \"crashing\" the interpreter in other ways. The most common way you'll see is with <code>undefined</code>, a built-in function which halts the program with a generic error.</p>\n\n<p>But there's another problem. Specifically, the halting problem. If <code>\u22a5</code> is supposed to represent infinite loops and other unpredictable issues, there are certain functions we can't write in Haskell. For example, the following pseudocode is nonsensical.</p>\n\n<pre><code>doesItHalt :: a -&gt; Bool\ndoesItHalt \u22a5 = False\ndoesItHalt _ = True\n</code></pre>\n\n<p>This would check if the resulting value is <code>\u22a5</code> or not, which would solve the halting problem. Clearly, we can't do this in Haskell. So what functions can we define in Haskell? We can define those which are monotonic with respect to the definedness ordering. We define <code>\u2291</code> to be this ordering. We say <code>\u22a5</code> is the least-defined value, so <code>\u22a5 \u2291 x</code> for all <code>x</code>. <code>\u2291</code> is a partial ordering, so some elements cannot be compared. While <code>1 \u2291 1</code>, it is not true that either <code>1 \u2291 2</code> <em>or</em> <code>2 \u2291 1</code>. In pure English, we're saying that <code>1</code> is certainly less-than-or-equally-defined-as <code>1</code> (clearly; they're the same value), but it doesn't make sense to say <code>1</code> is more or less defined than <code>2</code>. They're just... different values.</p>\n\n<p>In Haskell, we can only define functions which are monotonic with respect to this ordering. So we can only define functions for which, for all values <code>a</code> and <code>b</code>, if <code>a \u2291 b</code> then <code>f a \u2291 f b</code>. Our above <code>doesItHalt</code> fails, since, for instance, <code>\u22a5 \u2291 \"foo\"</code> but <code>f \u22a5 = False</code> and <code>f \"foo\" = True</code>. Like we said before, two fully defined but non-equal values are not comparable. So this function fails to work.</p>\n\n<p>In simple terms, the reason we define the ordering to be this way is because, when we \"inspect\" a value using pattern matching, that acts as an assertion that it must be at least defined enough for us to see the parts we matched on. If it's not, then we'll <em>always</em> get <code>\u22a5</code>, since the program will crash.</p>\n\n<p>It's worth noting, before we discuss <code>fix</code>, that there are \"partially defined\" values. For example, <code>1 : \u22a5</code> (in Haskell, we could write this as <code>1 : undefined</code>) is a list whose first element is defined but for which the tail of the list is undefined. In some sense, this value is \"more defined\" than a simple <code>\u22a5</code>, since we can at least pattern match and extract the first value. So we would say <code>\u22a5 \u2291 (1 : \u22a5) \u2291 (1 : [])</code>. Thus, we end up with a hierarchy of \"definedness\".</p>\n\n<p>Now, <code>fix</code> says it returns the least-defined fixed point. A fixed point of a function <code>f</code> is a value <code>x</code> such that <code>x = f x</code>. Let's try it out with a few examples and see if we can figure out why it says it that way. Let's define a function</p>\n\n<pre><code>f 0 = 1\nf x = x\n</code></pre>\n\n<p>This function has a lot of fixed points. For any <code>x</code> other than zero, <code>f x = x</code>. By our \"least-defined\" principle, which one will be returned? <code>\u22a5</code> will, actually, since <code>f \u22a5</code> will return <code>\u22a5</code>. If we pass <code>undefined</code> to <code>f</code>, the first pattern match will cause the program to crash, since we're comparing an undefined value against <code>0</code>. So <code>\u22a5</code> is a fixed-point, and since it's the least possible defined value, it will be returned by <code>fix f</code>. Internally, <code>fix</code> works by applying the function to itself infinitely, so this makes some amount of sense. Applying <code>f (f (f ...))</code> will keep trying to compare the inner argument against <code>0</code> and will never terminate. Now let's try a different function.</p>\n\n<pre><code>g x = 0\n</code></pre>\n\n<p>Applying this function to itself infinitely gives <code>0</code>. As it turns out, <code>fix g = 0</code>. Why was <code>0</code> returned in this case and not <code>\u22a5</code>? As it turns out, <code>\u22a5</code> fails to be a fixed-point of this function. <code>g \u22a5 = 0</code>. Since the argument is never inspected and Haskell is a non-strict language, <code>g</code> will return <code>0</code>, even if you pass <code>undefined</code> or <code>error \"Oops!\"</code> or some absurd infinitely recursing value as an argument. Thus, the <em>only</em> fixed point of <code>g</code>, even over a lifted type, is <code>0</code>, since <code>g 0 = 0</code>. Thus, <code>0</code> is truly the least-defined fixed point of <code>g</code>.</p>\n\n<p>So, in summary, we define a mathematical framework in order to rigorously describe the notion that certain functions don't terminate. \"least-defined\" is just a very mathematically precise way of saying that <code>fix</code> won't work on functions which are always completely strict in their argument. If <code>f \u22a5</code> is going to return <code>\u22a5</code> then <code>fix f</code> is also going to return <code>\u22a5</code>.</p>\n\n<hr>\n\n<p>* Most of this answer was paraphrased and summarized from <a href=\"https://en.wikibooks.org/wiki/Haskell/Denotational_semantics\" rel=\"noreferrer\">the wiki page on Denotational Semantics</a>. I encourage reading that page for more information; it's written to be very understandable to non-mathematicians and is very informative.</p>\n\n<p>[1] A few primitive types are unlifted. For example, GHC-specific <code>Int#</code> is an integer type that does not contain <code>\u22a5</code> and is used internally in some places.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1590208227, "creation_date": 1518226341, "last_edit_date": 1590208227, "question_id": 48716364, "link": "https://stackoverflow.com/questions/48716364/in-what-sense-is-one-function-less-defined-than-another", "title": "In what sense is one function &quot;less defined&quot; than another?", "body": "<p>What I mean is that, from <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Function.html#v:fix\" rel=\"nofollow noreferrer\">definition</a>:</p>\n\n<blockquote>\n  <p><code>fix f</code> is the least fixed point of the function <code>f</code></p>\n</blockquote>\n\n<p>In other words:</p>\n\n<blockquote>\n  <p>the least defined <code>x</code> such that <code>f x = x</code>.</p>\n</blockquote>\n\n<p>The least defined value of any <em>nullary</em> type is <code>undefined</code>. There is some ambiguity here still as <code>undefined</code> may mean either \"will throw an error\" (the better) or \"will never terminate\" (the worse). As both reasoning and trial show, <code>fix (+1)</code> and <code>fix pred :: Word</code> both never seem to approach termination (even though <code>pred 0</code> is an error), so the worse one of \"never terminate\" likely always gets chosen between these two alternatives. (What can escape <code>fix</code> is the boring <code>const 1</code>, but on that later.)</p>\n\n<p>This is not the useful way of applying <code>fix</code>.</p>\n\n<p>The useful way of applying <code>fix</code> is something along the lines of: </p>\n\n<pre><code>fix (\\f x -&gt; if x &gt; 7 then f (x - 1) else x)\n</code></pre>\n\n<p>-- That is, using <code>fix</code> to magically produce a <em>recursive function</em>. (This never ceases to amaze me.) This may be regarded as choosing between 2 functions: <code>\\f x -&gt; f (x - 1)</code> and <code>\\_ x -&gt; x</code>, one of which does never evaluate its first bound variable. This is a dangerous toy, as we may still obtain a function that is non-terminating for half its domain as easily as by accidentally flipping <code>&gt;</code> to <code>&lt;</code> or <code>-</code> to <code>+</code>.</p>\n\n<p>So, somehow, of these two functions:</p>\n\n<pre><code>f1 = \\f x -&gt; f (x - 1)\n\nf2 = \\_ x -&gt; x\n</code></pre>\n\n<p>-- The latter is \"<em>least defined</em> \". If we squint hard, we can actually recognise our boring fellow <code>const</code> in it, just <code>flip</code>'d.</p>\n\n<p>Now, this is counter-intuitive. <code>f2</code> is actually more fault tolerant, so, in a sense, it's defined for <em>more</em> input values than <code>f1</code>. (In particular, this is what lets it escape the otherwise infinite loop of <code>fix</code>). Specifically, <code>f2</code> is defined for all the same pairs <code>(f, x)</code> of input as <code>f1</code> plus the <code>(undefined, x)</code>. Along the same line, <code>const 1</code> is the most fault tolerant of all unary functions.</p>\n\n<p>So, how do I understand <em>definedness</em> now?</p>\n\n<hr>\n\n<p><em>some justification for the question</em></p>\n\n<p>There is <a href=\"https://stackoverflow.com/a/4787577/2108477\">this answer nearby</a> that kind of offers a different intuition for <code>fix</code> than the one proposed in this question. It also emphasizes that for a full understanding one must pass to an external tutorial on denotational semantics.</p>\n\n<p>I would like to have an answer that either supports, or explains the wrongs of, the intuition proposed here, and also, if domain theory really is behind that cursive <em>ordering</em> put forward in the comments, includes at least some rules of thumb that allow, however limited, but practical application of domain theory. One particular part of the question that I'd like to see light shed upon is whether a <code>fix</code>able function can always be decomposed on a constant function and a reduction function, and what would the definition of these classes of functions be.</p>\n\n<p>My wish is for an actual, practical answer on building useful and safe <code>fix</code>-encoded recursion, backed by solid mathematical reasoning.</p>\n"}, {"tags": ["haskell", "types", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 18156, "user_id": 127335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765a0d6880973a0e95e2700e11786c3a?s=128&d=identicon&r=PG", "display_name": "Conal", "link": "https://stackoverflow.com/users/127335/conal"}, "is_accepted": true, "score": 6, "last_activity_date": 1518214929, "creation_date": 1518214929, "answer_id": 48714965, "question_id": 48714798, "link": "https://stackoverflow.com/questions/48714798/why-non-exhaustive-patterns-warning-when-using-bool-and-finite-2/48714965#48714965", "title": "Why non-exhaustive patterns warning, when using Bool and Finite 2?", "body": "<p>I think it's at least in part because there's nothing in the definition of <code>Finite</code> that restricts the contained <code>Integer</code> to be within the assumed bounds (<code>0</code> to <code>n-1</code>): <code>newtype Finite (n :: Nat) = Finite Integer</code>.</p>\n"}], "owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 48714965, "answer_count": 1, "score": 0, "last_activity_date": 1518290213, "creation_date": 1518213983, "last_edit_date": 1518290213, "question_id": 48714798, "link": "https://stackoverflow.com/questions/48714798/why-non-exhaustive-patterns-warning-when-using-bool-and-finite-2", "title": "Why non-exhaustive patterns warning, when using Bool and Finite 2?", "body": "<p>I'm hoping to define an instance of a new class, for <code>Bool</code>, without creating partial functions, via <code>Finite 2</code>, but it isn't working.</p>\n\n<p>My code:</p>\n\n<pre><code>-- SO test case, re: my HasFin instance for Bool.\n--\n-- David Banas &lt;capn.freako@gmail.com&gt;\n-- February 9, 2018\n\n{-# OPTIONS_GHC -Wall #-}\n\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE LambdaCase #-}\n{-# LANGUAGE TypeFamilies #-}\n\nmodule Bogus.BoolHasFin where\n\nimport GHC.TypeLits\nimport Data.Finite\nimport Data.Finite.Internal (Finite(..))\n\nclass KnownNat (Card a) =&gt; HasFin a where\n  type Card a :: Nat\n  toFin :: a -&gt; Finite (Card a)\n  unFin :: Finite (Card a) -&gt; a\n\ninstance HasFin Bool where\n  type Card Bool = 2\n\n  toFin False = finite 0\n  toFin True  = finite 1\n\n  unFin = \\case\n    Finite 0 -&gt; False\n    Finite 1 -&gt; True\n</code></pre>\n\n<p>And the GHC compilation results:</p>\n\n<pre><code>Davids-Air-2:test dbanas$ stack ghc -- -c so_BoolHasFin.hs \n\nso_BoolHasFin.hs:30:11: warning: [-Wincomplete-patterns]\n    Pattern match(es) are non-exhaustive\n    In a case alternative:\n        Patterns not matched: (Finite p) where p is not one of {1, 0}\n</code></pre>\n\n<p>Can anyone help me understand why I'm getting this warning?\nIt seems like, having bounded the argument to <code>unFin</code>, via <code>Finite 2</code>, ought to have been sufficient.</p>\n\n<p>Added on 2018-02-10:</p>\n\n<p>As per a suggestion made privately by Conal, this code:</p>\n\n<pre><code>unFin (Finite 0) = False\nunFin _          = True\n</code></pre>\n\n<p>eliminates the warning.</p>\n"}, {"tags": ["algorithm", "haskell", "matrix", "lazy-evaluation"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1518214140, "post_id": 48714703, "comment_id": 84428812, "body": "It think it&#39;s due to your use of <code>foldl</code>; any thunks present in the computation of <code>c</code> are magnified due to the the laziness of <code>foldl</code>. Play around with using <code>foldl&#39;</code> instead."}, {"owner": {"reputation": 107, "user_id": 3925436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf9a6edd82ce618bfb3a69a9ab3214cd?s=128&d=identicon&r=PG&f=1", "display_name": "vvebik", "link": "https://stackoverflow.com/users/3925436/vvebik"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1518214494, "post_id": 48714703, "comment_id": 84428933, "body": "@chepner unfortunately, it did not help"}], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 3925436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf9a6edd82ce618bfb3a69a9ab3214cd?s=128&d=identicon&r=PG&f=1", "display_name": "vvebik", "link": "https://stackoverflow.com/users/3925436/vvebik"}, "edited": false, "score": 0, "creation_date": 1518215752, "post_id": 48714933, "comment_id": 84429319, "body": "Yes .. Apparently the code I submitted does not contain an algorithm problem ... Because in the algorithm with control GC is still a solid difference. For example, for matrices 500x500 the time is as follows: 1.81 s and 622.84 ms"}], "tags": [], "owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": true, "score": 3, "last_activity_date": 1518214760, "creation_date": 1518214760, "answer_id": 48714933, "question_id": 48714703, "link": "https://stackoverflow.com/questions/48714703/comparison-of-lazy-and-strict-evaluations-in-haskell/48714933#48714933", "title": "Comparison of lazy and strict evaluations in Haskell", "body": "<p>Pardon the non-answer, but make sure to control for GC: it appears that the second function may be burdened with the GC from the previous one, thereby inflating the difference.</p>\n\n<p>I can reproduce what you're seeing:</p>\n\n<pre><code>$ ghc -O3 --make foo.hs &amp;&amp; ./foo\n[1 of 1] Compiling Main             ( foo.hs, foo.o )\nLinking foo ...\n1.471109207s\n2.001165795s\n</code></pre>\n\n<p>However, when I flipped the order of the test, the result was different:</p>\n\n<pre><code>main = do\n  testWithoutForce \n  testWithForce\n\n$  ghc -O3 --make foo.hs &amp;&amp; ./foo\n1.626452918s\n1.609818958s\n</code></pre>\n\n<p>So I made <code>main</code> GC between each test:</p>\n\n<pre><code>import System.Mem\n\nmain = do\n  performMajorGC\n  testWithForce\n  performMajorGC\n  testWithoutForce\n</code></pre>\n\n<p>The forced one is still faster, but the difference was massively reduced:</p>\n\n<pre><code>1.460686986s\n1.581715988s\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 3925436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf9a6edd82ce618bfb3a69a9ab3214cd?s=128&d=identicon&r=PG&f=1", "display_name": "vvebik", "link": "https://stackoverflow.com/users/3925436/vvebik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 48714933, "answer_count": 1, "score": 2, "last_activity_date": 1518265267, "creation_date": 1518213494, "last_edit_date": 1518265267, "question_id": 48714703, "link": "https://stackoverflow.com/questions/48714703/comparison-of-lazy-and-strict-evaluations-in-haskell", "title": "Comparison of lazy and strict evaluations in Haskell", "body": "<p>I implemented the Winograd algorithm on Haskell and tried to speed up the algorithm due to strict calculations. In this I succeeded, but I completely did not understand why, adding strictness, it starts to work faster. Since my code for this algorithm is large enough, I wrote two small functions that demonstrate this problem.</p>\n\n<pre><code>module Main where\nimport qualified Data.Vector as V\nimport qualified Data.Matrix as M\n\nimport Control.DeepSeq\nimport Control.Exception\nimport System.Clock\nimport Data.Time\n\nmatrixCtor x y size = M.matrix size size $ \\(i,j) -&gt; x*i+y*j\n\ngroup v s = foldl (\\acc i -&gt;acc + V.unsafeIndex v i * V.unsafeIndex v (i+1)) 0 [0,2..s-1]\n\nsize = 3000 :: Int\n\ntestWithForce :: IO ()\ntestWithForce = do\n  let a = matrixCtor 2 1 size\n  evaluate $ force a\n\n  start &lt;- getCurrentTime\n\n  let c = V.generate size $ \\j -&gt; M.getCol (j+1) a\n  evaluate $ force c\n  let d = foldl (\\acc i -&gt;acc + group (V.unsafeIndex c i) size) 0 [0,1..(size-1)]\n  evaluate $ force d\n\n  end &lt;- getCurrentTime\n  print (diffUTCTime end start)\n\n\ntestWithoutForce :: IO ()\ntestWithoutForce = do\n  let a = matrixCtor (-2) 1 size\n  evaluate $ force a\n\n  start &lt;- getCurrentTime\n\n  let c = V.generate size $ \\j -&gt; M.getCol (j+1) a\n  let d = foldl (\\acc i -&gt;acc + group (V.unsafeIndex c i) size) 0 [0,1..(size-1)]\n  evaluate $ force d\n\n  end &lt;- getCurrentTime\n  print (diffUTCTime end start)\n\nmain :: IO ()\nmain = do\n  testWithForce\n  testWithoutForce\n</code></pre>\n\n<p>In the implementation of the algorithm, the matrices are computed before use, just like here. In the function <code>testWithForce</code> I calculate the value <code>c</code> before it is used. In this case, the function <code>testWithForce</code> works faster than the function <code>testWithoutForce</code>. I got the following results:</p>\n\n<pre><code>0.945078s --testWithForce\n1.785158s --testWithoutForce\n</code></pre>\n\n<p>I just can not understand why strictness in this case speeds up the work so much.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1518216382, "post_id": 48714662, "comment_id": 84429556, "body": "<code>import Data.Monoid</code>"}, {"owner": {"reputation": 11, "user_id": 4432640, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-le2MXBNkv4Y/AAAAAAAAAAI/AAAAAAAAAV4/WDPzRf2Bmsc/photo.jpg?sz=128", "display_name": "Thanasis Koutras", "link": "https://stackoverflow.com/users/4432640/thanasis-koutras"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1518218236, "post_id": 48714662, "comment_id": 84430087, "body": "Simple as that! Thanks a lot!"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1521646983, "post_id": 48714662, "comment_id": 85822992, "body": "@ThomasM.DuBuisson since your answer resolved the question, can you post it as an answer?"}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1521652605, "creation_date": 1521652605, "answer_id": 49412724, "question_id": 48714662, "link": "https://stackoverflow.com/questions/48714662/variable-not-in-scope-cabal-build-error/49412724#49412724", "title": "Variable not in scope - cabal build error", "body": "<p>The <code>(&lt;&gt;)</code> operator and other common ones are in <code>Data.Monoid</code> so just</p>\n\n<pre><code>import Data.Monoid\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 4432640, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-le2MXBNkv4Y/AAAAAAAAAAI/AAAAAAAAAV4/WDPzRf2Bmsc/photo.jpg?sz=128", "display_name": "Thanasis Koutras", "link": "https://stackoverflow.com/users/4432640/thanasis-koutras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 289, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1521652605, "creation_date": 1518213339, "question_id": 48714662, "link": "https://stackoverflow.com/questions/48714662/variable-not-in-scope-cabal-build-error", "title": "Variable not in scope - cabal build error", "body": "<p>I'm trying to compile hemotik (<a href=\"https://github.com/nh2/hemokit\" rel=\"nofollow noreferrer\">https://github.com/nh2/hemokit</a>) using cabal on opensuse tumbleweed and get the following error:</p>\n\n<pre><code>Variable not in scope: (&lt;&gt;)\n</code></pre>\n\n<p>in different parts of the program code such as:</p>\n\n<pre><code>-- | Command line parser for EEG selection. See `EmotivArgs`.\nemotivArgsParser :: Parser EmotivArgs\nemotivArgsParser = EmotivArgs\n  &lt;$&gt; option (eitherReader parseModel)\n      ( long \"model\" &lt;&gt; metavar \"MODEL\"\n        &lt;&gt; value Consumer\n        &lt;&gt; help \"Consumer or Developer model, Consumer by default\" )\n  &lt;*&gt; (optional . option (maybeReader makeSerialNumberFromString \"Serial number of has invalid format\"))\n      ( long \"serial\" &lt;&gt; metavar \"SERIALNUMBER\"\n        &lt;&gt; help \"The serial to use. If no --from-file is given, this will select the device\" )\n  &lt;*&gt; (optional . strOption)\n      ( long \"from-file\" &lt;&gt; metavar \"PATH\"\n        &lt;&gt; help \"The file path to read from (e.g. /dev/hidraw0 or myfile.dump)\" )\n  where\n    maybeReader :: (String -&gt; Maybe a) -&gt; String -&gt; ReadM a\n    maybeReader mbFn msg = eitherReader (maybe (fail msg) pure . mbFn)\n</code></pre>\n\n<p>Any suggestions? </p>\n"}, {"tags": ["string", "list", "haskell", "recursion", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "edited": false, "score": 0, "creation_date": 1518211027, "post_id": 48714081, "comment_id": 84427496, "body": "That would be perfect without using where... is it possible to do it without? Also, would you mind explaining a bit more on what acc is here? Or how it is working throughout? I am a bit confused with it."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1518211102, "post_id": 48714081, "comment_id": 84427528, "body": "You don\u2019t even need the extra length argument. If the accumulator is non-empty, the head is (in a tie for) the longest string encountered, so you can take <code>(length . head) acc</code>. Then it could just be a <code>fold</code>."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518211248, "post_id": 48714081, "comment_id": 84427610, "body": "@Davislor good call RE: fold. I was just trying to build an overly-complicated Stateful action to do the same."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "edited": false, "score": 0, "creation_date": 1518211307, "post_id": 48714081, "comment_id": 84427631, "body": "@PushedCrayon <code>where</code> is not something you should be avoiding if you&#39;re writing Haskell at any level. <code>acc</code> is the accumulator, or the list that gets built as you find more strings that count."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "edited": false, "score": 1, "creation_date": 1518211330, "post_id": 48714081, "comment_id": 84427640, "body": "@PushedCrayon One way to avoid <code>where</code> is to write the helper as a lambda, but I\u2019d say that would be more complex. The helper has a different signature than the original function, so it\u2019s got to be separate, and it\u2019s used only inside this function, so it should be nested."}, {"owner": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "edited": false, "score": 1, "creation_date": 1518211490, "post_id": 48714081, "comment_id": 84427725, "body": "@AdamSmith, I am trying to avoid using where because I am trying to get more familiar with functional programming in general, and I have read a lot that using things such as where and let are too close to imperative programming. So I am trying to think of how I could create two separate functions here to get rid of the where. Do you have any ideas? Also, thank you for clarifying acc, it makes much more sense now."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 2, "creation_date": 1518211590, "post_id": 48714081, "comment_id": 84427767, "body": "Oh no, <code>where</code> is totally good functional style. I\u2019m tempted now to write another example."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "edited": false, "score": 0, "creation_date": 1518211616, "post_id": 48714081, "comment_id": 84427782, "body": "@PushedCrayon &quot;I have read a lot that using things such as where and let are too close to imperative programming.&quot; Stop reading things from those places, that&#39;s nonsense :)"}, {"owner": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518211843, "post_id": 48714081, "comment_id": 84427884, "body": "@Davislor could you possibly write one without using where or anything? I am curious as to what it would look like. But I understand if you don&#39;t feel like it."}, {"owner": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "edited": false, "score": 1, "creation_date": 1518211880, "post_id": 48714081, "comment_id": 84427896, "body": "@AdamSmith I appreciate all of your help! Its hard to know what is or isn&#39;t good to read when it comes to new languages and such. But thank you for your insight :)"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "edited": false, "score": 0, "creation_date": 1518211881, "post_id": 48714081, "comment_id": 84427897, "body": "@PushedCrayon you&#39;d just write <code>go</code> (or <code>f</code> in my new example) as a toplevel function, but since it serves no purpose whatsoever at top level, that makes worse code not better."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "edited": false, "score": 0, "creation_date": 1518212081, "post_id": 48714081, "comment_id": 84427976, "body": "@PushedCrayon this comment section is getting crowded. If you have any other questions I should be around for another half hour or so in <a href=\"https://chat.stackoverflow.com/rooms/164861/https-stackoverflow-com-questions-48713997-how-to-compare-multiple-strings-with\">this chat room</a> give a holler."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 5, "last_activity_date": 1518211821, "last_edit_date": 1518211821, "creation_date": 1518210367, "answer_id": 48714081, "question_id": 48713997, "link": "https://stackoverflow.com/questions/48713997/how-to-compare-multiple-strings-within-in-the-same-list-in-haskell/48714081#48714081", "title": "How to compare multiple strings within in the same list in Haskell", "body": "<p>you could trivially keep track of the longest length string and an accumulator of values of that length.</p>\n\n<pre><code>longestStrings :: [String] -&gt; [String]\nlongestStrings = go [] 0\n  where\n  go acc _ []       = acc  -- base case\n  go acc n (x:xs)\n    | length x &gt; n  = go [x] (length x) xs\n    -- if x is longer than the previously-seen longest string, then set\n    -- accumulator to the list containing only x, set the longest length\n    -- to length x, and keep looking\n    | length x == n = go (x:acc) n xs\n    -- if x is the same length as the previously-seen longest string, then\n    -- add it to the accumulator and keep looking\n    | otherwise     = go acc n xs\n    -- otherwise, ignore it\n</code></pre>\n\n<p>or, as Davislor rightly mentions in the comments, this can be implemented as a fold by teaching the helper function to determine its own longest length</p>\n\n<pre><code>longestStrings :: [String] -&gt; [String]\nlongestStrings = foldr f []\n  where\n  f x []        = [x]\n  f x yss@(y:_) =\n    case compare (length x) (length y) of\n      GT -&gt; [x]\n      EQ -&gt; x : yss\n      LT -&gt; yss\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1518216236, "last_edit_date": 1518216236, "creation_date": 1518214537, "answer_id": 48714886, "question_id": 48713997, "link": "https://stackoverflow.com/questions/48713997/how-to-compare-multiple-strings-within-in-the-same-list-in-haskell/48714886#48714886", "title": "How to compare multiple strings within in the same list in Haskell", "body": "<p>As requested, here\u2019s a version with and without the use of <code>where</code>.  I think this is a good demonstration of why the advice not to use <code>where</code> is bad advice.  I think the first version is a lot easier to understand.</p>\n\n<p>Keep in mind, functional programming isn\u2019t a monastic vow to forswear certain keywords out of masochism.  Nor is it a checklist of fashion tips (<code>where</code> is <em>so</em> last season!).  \u201cYou should avoid that construct arbitrarily because it\u2019s not the \u2018functional\u2019 thing to do\u201d really is not how it works.  So you shouldn\u2019t uglify your code for the sake of a tip like that.</p>\n\n<p>It <em>is</em> often a good idea to follow the same coding style as other programmers so they will find it easier to understand you.  (For example, Adam Smith was subtly trying to train you that <code>acc</code> is a common name for an accumulator and <code>go</code> a common name for a recursive helper function, and they help other programmers figure out the pattern he\u2019s using.)  But in fact Haskell programmers do use <code>where</code>, a lot.</p>\n\n<p>Anyway, the code:</p>\n\n<pre><code>longeststrings :: [String] -&gt; [String]\n{- Filters all strings as long as any other in the list. -}\nlongeststrings = foldr go []\n  where\n    go x [] = [x]\n    go x leaders | newlength &gt; record  = [x]\n                 | newlength == record = x:leaders\n                 | otherwise           = leaders\n      where\n        record = (length . head) leaders\n        newlength = length x\n\nlongestStringsUsingLambda :: [String] -&gt; [String]\nlongestStringsUsingLambda = foldr\n    (\\x leaders -&gt;\n       if leaders == [] then [x]\n       else case compare (length x) (length $ head leaders) of\n         GT -&gt; [x]\n         EQ -&gt; x:leaders\n         LT -&gt; leaders )\n    []\n\nmain :: IO ()\nmain = let testcases = [ [\"meow\",\"cats\",\"dog\",\"woof\"],\n                         [\"foo\",\"bar\",\"baz\"],\n                         [\"meep\",\"foo\",\"bar\",\"baz\",\"fritz\",\"frotz\"]\n                       ]\n       in foldMap print $\n          map longestStringsUsingLambda testcases\n</code></pre>\n\n<p>You can try eliminating the <code>let testcases =</code> ... and see if you consider that an improvement.</p>\n"}], "owner": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "accepted_answer_id": 48714081, "answer_count": 2, "score": 2, "last_activity_date": 1518220464, "creation_date": 1518209929, "question_id": 48713997, "link": "https://stackoverflow.com/questions/48713997/how-to-compare-multiple-strings-within-in-the-same-list-in-haskell", "title": "How to compare multiple strings within in the same list in Haskell", "body": "<p>I am trying to write a Haskell function that takes in a list of strings, compares all the strings in the list, and outputs a list of strings that are of the longest length. I want to do this without any predefined functions or imports, I want to try and figure it out all recursively. For example:</p>\n\n<pre><code>    longeststrings[\"meow\",\"cats\",\"dog\",\"woof\"] -&gt; [\"meow\",\"cats\",\"woof\"]\n</code></pre>\n\n<p>I know it is a silly example, but I think it proves the point.</p>\n\n<p>I want to do something like</p>\n\n<pre><code>    longeststrings:: [string] -&gt; [string]\n    longeststrings []          = []\n    longeststrings [x:xs]      = if (x &gt; xs) x:longeststrings[xs]\n</code></pre>\n\n<p>But I don't know how to only take the largest size strings out of the list, or remove the smallest ones. I would appreciate any help.</p>\n"}, {"tags": ["list", "haskell", "types", "add"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1518209745, "post_id": 48713834, "comment_id": 84426972, "body": "What&#39;s your question? This is quite broad. Are you just asking how to add to a list?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1518209804, "post_id": 48713834, "comment_id": 84427003, "body": "It&#39;s also quite trivial (<code>add = (:)</code>), unless you want to avoid adding a duplicate entry."}, {"owner": {"reputation": 3, "user_id": 7600869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b01afec8b17ee735ffa4b2007c9be280?s=128&d=identicon&r=PG&f=1", "display_name": "ron evans", "link": "https://stackoverflow.com/users/7600869/ron-evans"}, "edited": false, "score": 0, "creation_date": 1518210686, "post_id": 48713834, "comment_id": 84427357, "body": "I&#39;m looking to create a function which pretty much adds every PhoneBook entered to a beginning of a list."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1518210309, "post_id": 48714000, "comment_id": 84427211, "body": "Minor nit: a tuple <i>is</i> a product type, and necessary if one wants to treat <code>PhoneBook</code> as an association list for use with functions like <code>lookup :: a -&gt; [(a,b)] -&gt; Maybe b</code>."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1518210416, "post_id": 48714000, "comment_id": 84427247, "body": "@chepner how would I better-define that, then? &quot;You should be using an <i>explicit</i> product type&quot; or etc?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1518210466, "post_id": 48714000, "comment_id": 84427264, "body": "@ronevans I think you can figure that out -- try something yourself and ask if you can&#39;t come up with the answer after some effort."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1518211266, "post_id": 48714000, "comment_id": 84427620, "body": "I would just call it a custom data type. However, in this case, I think a simple tuple is the right choice, at least in the sense that a <code>PhoneBook</code> is mapping of names to numbers, rather than a collection of people."}, {"owner": {"reputation": 3, "user_id": 7600869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b01afec8b17ee735ffa4b2007c9be280?s=128&d=identicon&r=PG&f=1", "display_name": "ron evans", "link": "https://stackoverflow.com/users/7600869/ron-evans"}, "edited": false, "score": 0, "creation_date": 1518212358, "post_id": 48714000, "comment_id": 84428079, "body": "@AdamSmith I understand what you mean thank you. What if I wanted to view the list of entries of the PhoneBook? So I can actually add an entry using the function &#39;add&#39;. Something like E.g. add a b = ... where a b take the input of the name and phone number from terminal"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 3, "user_id": 7600869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b01afec8b17ee735ffa4b2007c9be280?s=128&d=identicon&r=PG&f=1", "display_name": "ron evans", "link": "https://stackoverflow.com/users/7600869/ron-evans"}, "edited": false, "score": 0, "creation_date": 1518212504, "post_id": 48714000, "comment_id": 84428156, "body": "@ronevans Then you&#39;ll be muddling in the <code>IO</code> monad since you&#39;re taking input, so you&#39;ll stop having a <code>PhoneBook</code> and start having an <code>IO PhoneBook</code>. This is not as trivial as it is in most programming languages."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 1, "last_activity_date": 1518211374, "last_edit_date": 1518211374, "creation_date": 1518209940, "answer_id": 48714000, "question_id": 48713834, "link": "https://stackoverflow.com/questions/48713834/haskell-using-list-type-function/48714000#48714000", "title": "haskell using list type function", "body": "<p>This is trivially the cons operator <code>(:)</code></p>\n\n<pre><code>add :: Person -&gt; PhoneBook -&gt; PhoneBook\nadd = (:)\n</code></pre>\n\n<p>However I think you're abusing tuples here in <code>Person</code>. You should consider using a custom data type rather than a tuple in most cases. Using record syntax makes life easy for you:</p>\n\n<pre><code>data Person = Person { getName        :: Name\n                     , getPhoneNumber :: PhoneNumber }\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 7600869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b01afec8b17ee735ffa4b2007c9be280?s=128&d=identicon&r=PG&f=1", "display_name": "ron evans", "link": "https://stackoverflow.com/users/7600869/ron-evans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "closed_date": 1518224110, "answer_count": 1, "score": -2, "last_activity_date": 1518211374, "creation_date": 1518209179, "question_id": 48713834, "link": "https://stackoverflow.com/questions/48713834/haskell-using-list-type-function", "closed_reason": "Needs details or clarity", "title": "haskell using list type function", "body": "<p>Hi I'm trying to use list types in haskell.</p>\n\n<p>I have the following types in my .hs file:</p>\n\n<pre><code>type Name = String\ntype PhoneNumber = Int\ntype Person = (Name, PhoneNumber)\ntype PhoneBook = [Person]\n</code></pre>\n\n<p>I'm looking to add the function </p>\n\n<pre><code>add::Person -&gt; PhoneBook -&gt; PhoneBook\nadd ........ \n</code></pre>\n\n<p>that adds an entry to the phone book at the beginning of the list. Testing it would be done through the terminal </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "edited": false, "score": 2, "creation_date": 1518206855, "post_id": 48713056, "comment_id": 84425720, "body": "I don&#39;t think scrapeStringLike works the way you think it does. You&#39;re passing it a URL, and it&#39;s trying to scrape the literal URL.  It&#39;s expecting a string that represents HTML.  You could verify this by feeding that function some HTML that contains something you think you could scrape..."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1518212354, "post_id": 48713056, "comment_id": 84428078, "body": "This seems like consistent behavior. Scraping a webpage from the internet involves touching the impure outside world, so it has to be tainted with the IO monad. It can scrape HTML happily enough if you provide it, but if you only go and tell it where the HTML lives, then it has to be IO."}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 157, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1518205572, "creation_date": 1518205572, "question_id": 48713056, "link": "https://stackoverflow.com/questions/48713056/collecting-data-without-io-in-scalpel", "title": "Collecting data without IO in Scalpel", "body": "<p>I'm using Haskell's <a href=\"https://hackage.haskell.org/package/scalpel-0.5.1/docs/Text-HTML-Scalpel.html\" rel=\"nofollow noreferrer\">Scalpel library</a> as an intro to web scraping in Haskell.  I can call a function <code>scrapeURL</code> which allows me to scrape a page and output it to IO, but I can't find a function that just allows me to simply return the output of the call.</p>\n\n<pre><code>import Text.HTML.Scalpel\n\ndata WikiImg\n    =  Src String\n    deriving (Show, Eq)\n\n...\n\nrembrantImagesIO :: IO (Maybe [WikiImg])\nrembrantImagesIO = scrapeURL \"https://en.wikipedia.org/wiki/Rembrandt\" wikimgs\n\nrembrantImages :: Maybe [WikiImg]\nrembrantImages = scrapeStringLike \"https://en.wikipedia.org/wiki/Rembrandt\" wikimgs\n\nwikimgs :: Scraper String [WikiImg]\nwikimgs = chroots (\"div\" @: [hasClass \"thumbinner\"]) wikimg\n  where\n    wikimg :: Scraper String WikiImg\n    wikimg =  do\n     src   &lt;- attr \"src\" $ \"img\"\n     return $ Src src\n</code></pre>\n\n<p><code>rembrantImagesIO</code> will output a list of img src's</p>\n\n<pre><code>Just [Src \"//upload.wikimedia.org/wikipedia/commons/thumb/a/ae/Rembrandt_-_Rembrandt_and_Saski...\n</code></pre>\n\n<p>...but <code>rembrantImages</code> seems to fail.</p>\n\n<p><code>Just []</code></p>\n\n<p>How can I simply return a <code>Maybe [WikiImg]</code> that actually returns something?</p>\n\n<p>(Side note: I see little on StackOverflow about Scalpel...if you are experienced with web scraping in Haskell, please let me know if there is a better place to start.)</p>\n"}, {"tags": ["json", "haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1518203827, "post_id": 48712601, "comment_id": 84424408, "body": "That&#39;s not a typeclass. You mean, <i>How can one turn a <b>value of a record type</b> into a JSON string</i>?"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 7, "last_activity_date": 1518204477, "last_edit_date": 1518204477, "creation_date": 1518204152, "answer_id": 48712747, "question_id": 48712601, "link": "https://stackoverflow.com/questions/48712601/how-can-one-turn-a-value-of-a-record-type-into-a-json-string-in-haskell/48712747#48712747", "title": "How can one turn a value of a record type into a JSON String in Haskell?", "body": "<p>You can easily do this with <a href=\"https://hackage.haskell.org/package/aeson-1.2.4.0/docs/Data-Aeson.html\" rel=\"noreferrer\">the Aeson library</a>. In fact, this is <em>exactly</em> the example they give... interesting...</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric, OverloadedStrings #-}\n\nimport Data.Aeson\nimport GHC.Generics\n\ndata Person = Person {\n      name :: String\n    , age  :: Int\n    } deriving (Generic)\ninstance ToJSON Person\n\nmain :: IO ()\nmain = print $ encode (Person \"Luke Morgenstern\" 734)\n</code></pre>\n\n<p>Note: if you do this <em>only for the purpose of calculating a hash</em>, then JSON is an unneeded and inefficient detour. Better go directly</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nimport Data.Hashable\nimport GHC.Generics\n\ndata Person = Person {\n      name :: String\n    , age  :: Int\n    } deriving (Generic)\ninstance Hashable Person\n\nmain :: IO ()\nmain = print $ hash (Person \"Luke Morgenstern\" 734)\n</code></pre>\n"}], "owner": {"reputation": 265, "user_id": 6815822, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh3.googleusercontent.com/-qkDbJWc-cz0/AAAAAAAAAAI/AAAAAAAABpI/NK0z5UCdS5A/photo.jpg?sz=128", "display_name": "Luke Morgenstern", "link": "https://stackoverflow.com/users/6815822/luke-morgenstern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 48712747, "answer_count": 1, "score": 1, "last_activity_date": 1518204477, "creation_date": 1518203553, "last_edit_date": 1518203867, "question_id": 48712601, "link": "https://stackoverflow.com/questions/48712601/how-can-one-turn-a-value-of-a-record-type-into-a-json-string-in-haskell", "title": "How can one turn a value of a record type into a JSON String in Haskell?", "body": "<p>Let's say I have record type that looks like this</p>\n\n<pre><code>data Person = Person\n  { name :: String,\n    age\n  } deriving (Show)\n</code></pre>\n\n<p>How would I go around turning this into a JSON Object or even String? (I'd like to hash it followingly)</p>\n"}, {"tags": ["haskell", "types", "proxy", "ghc", "existential-type"], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 1, "last_activity_date": 1518228067, "last_edit_date": 1518228067, "creation_date": 1518206828, "answer_id": 48713348, "question_id": 48712224, "link": "https://stackoverflow.com/questions/48712224/how-to-extend-ghc-typelits-natnormalise-to-check-relationships-between-universal/48713348#48713348", "title": "How to extend ghc-typelits-natnormalise to check relationships between universally and existentially quantified types?", "body": "<p><code>reifyNat</code> takes as an argument a function which works for <em>any</em> natural. A function of type <code>forall m. (KnownNat m, n `CmpNat` m ~ 'GT) =&gt; Proxy m -&gt; r</code> doesn't work on any natural; it only works on naturals less than some other <code>n</code>. </p>\n\n<p>Since you are calling <code>getFinite</code> to produce the actual value, you know that value is less than <code>n</code>. Unfortunately, you have no way to prove this to the typechecker. Fortunately, you are allowed to tell the typechecker to trust you:</p>\n\n<pre><code>import Type.Reflection ((:~:)(..))\nimport Unsafe.Coerce\n\n...\n\ngetFinite'' :: KnownNat n =&gt; Finite n -&gt; (forall m. (KnownNat m) =&gt; Proxy m -&gt; n `CmpNat` m :~: 'GT -&gt; r) -&gt; r\ngetFinite'' x f = reifyNat (getFinite x) $ \\p -&gt; f p (unsafeCoerce Refl)\n\ngetFinite' :: forall n r . KnownNat n =&gt; Finite n -&gt; (forall m. (KnownNat m, n `CmpNat` m ~ 'GT) =&gt; Proxy m -&gt; r) -&gt; r\ngetFinite' x f = getFinite'' x $ \\p Refl -&gt; f p\n</code></pre>\n"}], "owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 48713348, "answer_count": 1, "score": 2, "last_activity_date": 1518228067, "creation_date": 1518201833, "question_id": 48712224, "link": "https://stackoverflow.com/questions/48712224/how-to-extend-ghc-typelits-natnormalise-to-check-relationships-between-universal", "title": "How to extend ghc-typelits-natnormalise to check relationships between universally and existentially quantified types?", "body": "<p>I'm trying to make my use of <code>Finite</code>s completely safe and non-partial, by using <code>Proxy</code>s in place of <code>Integer</code>s like so:</p>\n\n<pre><code>-- SO test case, re: my use of ghc-typelits-natnormalise package.\n--\n-- David Banas &lt;capn.freako@gmail.com&gt;\n-- February 9, 2018\n\n{-# OPTIONS_GHC -Wall #-}\n{-# OPTIONS_GHC -fplugin GHC.TypeLits.Normalise #-}\n\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE TypeOperators #-}\n\nmodule Bogus.NewFin where\n\nimport GHC.TypeLits\nimport Data.Proxy\nimport Data.Finite\nimport Data.Finite.Internal (Finite(..))\nimport Data.Reflection\n\n-- A safer form of `finite`.\nfinite' :: (KnownNat n, KnownNat m, n `CmpNat` m ~ 'GT) =&gt; Proxy m -&gt; Finite n\nfinite' p = Finite $ natVal p\n\n-- A safer form of `getFinite`.\ngetFinite' :: KnownNat n =&gt; Finite n -&gt; (forall m. (KnownNat m, n `CmpNat` m ~ 'GT) =&gt; Proxy m -&gt; r) -&gt; r\ngetFinite' x f = reifyNat (getFinite x) f\n</code></pre>\n\n<p>And I'm getting this compiler error:</p>\n\n<pre><code>Davids-Air-2:test dbanas$ stack ghc -- -c so_natnorm.hs \n\nso_natnorm.hs:28:41: error:\n    \u2022 Couldn't match type \u2018CmpNat n n1\u2019 with \u2018'GT\u2019\n        arising from a use of \u2018f\u2019\n    \u2022 In the second argument of \u2018reifyNat\u2019, namely \u2018f\u2019\n      In the expression: reifyNat (getFinite x) f\n      In an equation for \u2018getFinite'\u2019:\n          getFinite' x f = reifyNat (getFinite x) f\n    \u2022 Relevant bindings include\n        f :: forall (m :: Nat).\n             (KnownNat m, CmpNat n m ~ 'GT) =&gt;\n             Proxy m -&gt; r\n          (bound at so_natnorm.hs:28:14)\n        x :: Finite n (bound at so_natnorm.hs:28:12)\n        getFinite' :: Finite n\n                      -&gt; (forall (m :: Nat).\n                          (KnownNat m, CmpNat n m ~ 'GT) =&gt;\n                          Proxy m -&gt; r)\n                      -&gt; r\n          (bound at so_natnorm.hs:28:1)\n</code></pre>\n\n<p>I'm guessing that my problem is trying to relate a universally and an existentially quantified type, through the mechanisms provided by the <em>ghc-typelits-natnormalise</em> package. Is that correct?</p>\n\n<p>It seems to me that this ought to be allowed, since the caller is responsible for assigning both:</p>\n\n<ul>\n<li>the value of <code>n</code>, and</li>\n<li>the maximum value of <code>m</code>.</li>\n</ul>\n\n<p>Where is my reasoning about this faulty?</p>\n"}, {"tags": ["haskell", "haskell-turtle"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1518198118, "post_id": 48710957, "comment_id": 84421650, "body": "It seems like you want a function <code>subshell :: Shell a -&gt; Shell a</code> which runs a <code>Shell</code> in a subshell; unfortunately this doesn&#39;t really make sense. When you run <code>(..)</code> in bash, what you have is an outer bash program starting an inner bash program, which executes the specified commands. But <code>x :: Shell X</code> is a haskell program, not a bash program; it doesn&#39;t make sense to ask bash to start a Haskell program in a subshell (unless, of course, you compile that program to an executable or or intepret the script directly - but this isn&#39;t the same as starting an arbitrary computation in a subshell)"}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 1, "creation_date": 1518199468, "post_id": 48710957, "comment_id": 84422325, "body": "Do you actually want a subshell in this specific case? In a traditional Unix shell you&#39;d use one because that&#39;s basically the only way to implement scopes, but in Haskell/Turtle you have the faster and more fine grained <code>using</code>"}, {"owner": {"reputation": 357, "user_id": 2044007, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1e076a5182f4a83e5307ac2ecf2b0e0e?s=128&d=identicon&r=PG", "display_name": "Carlos Morera", "link": "https://stackoverflow.com/users/2044007/carlos-morera"}, "reply_to_user": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1518205272, "post_id": 48710957, "comment_id": 84425074, "body": "@thatotherguy you are right, ultimately what I was really trying to do is to execute a bunch of commands in an isolated scope, e.g. cding into a directory to run a command in there, without having to cd back in the outer scope.  P.S. could you please send a link to the <code>using</code> you are referring to? I thought it was part of turtle but I can&#39;t find it."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1518206195, "post_id": 48710957, "comment_id": 84425439, "body": "I was just looking at the <a href=\"https://hackage.haskell.org/package/turtle-1.5.2/docs/Turtle-Shell.html\" rel=\"nofollow noreferrer\">docs for Turtle.Shell</a>, and it lists <code>using</code> which seemed like Control.Exception <code>bracket</code> style resource management. In this case it could presumably <code>cd</code> back to the original directory when &quot;released&quot;."}], "owner": {"reputation": 357, "user_id": 2044007, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1e076a5182f4a83e5307ac2ecf2b0e0e?s=128&d=identicon&r=PG", "display_name": "Carlos Morera", "link": "https://stackoverflow.com/users/2044007/carlos-morera"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 148, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1522252802, "creation_date": 1518196585, "last_edit_date": 1522252802, "question_id": 48710957, "link": "https://stackoverflow.com/questions/48710957/how-to-run-compose-multiple-commands-in-a-haskell-turtle-subshell", "title": "How to run/compose multiple commands in a haskell turtle subshell", "body": "<p>I'm trying to execute several commands in a subshell, e.g. <code>(cd ~ &amp;&amp; pwd)</code> in bash. I can do <code>home &gt;&gt;= cd</code> in the current shell to combine some operations, but I can't figure out how I can do the same in a subshell. </p>\n\n<p>I went through the documentation and couldn't find something that looked promising, however, I was able to do it in this way <code>inshell \"cd ~ &amp;&amp; pwd\" mempty</code>. </p>\n\n<p>Even though this works, it does not compose as nicely and when needing to execute a bunch of commands it gets ugly.</p>\n\n<p>Does anyone know how to achieve the composition of several operations in a subshell with the same style as done in the current shell?</p>\n"}, {"tags": ["haskell", "shake-build-system"], "answers": [{"tags": [], "owner": {"reputation": 10089, "user_id": 1850340, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/bdef220f4272ab4796c6ae65621481cf?s=128&d=identicon&r=PG", "display_name": "adius", "link": "https://stackoverflow.com/users/1850340/adius"}, "is_accepted": false, "score": 3, "last_activity_date": 1518196491, "creation_date": 1518196491, "answer_id": 48710924, "question_id": 48710923, "link": "https://stackoverflow.com/questions/48710923/how-can-forp-be-executed-in-an-action/48710924#48710924", "title": "How can `forP` be executed in an action?", "body": "<p>If the return value is irrelevant it can simply be ignored:</p>\n\n<pre><code>void $ forP commands runCommand\n</code></pre>\n\n<p>Otherwise it can be bound to a variable and used afterwards:</p>\n\n<pre><code>values &lt;- forP commands runCommand\nreturn (fold values)\n</code></pre>\n"}], "owner": {"reputation": 10089, "user_id": 1850340, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/bdef220f4272ab4796c6ae65621481cf?s=128&d=identicon&r=PG", "display_name": "adius", "link": "https://stackoverflow.com/users/1850340/adius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1518196491, "creation_date": 1518196491, "question_id": 48710923, "link": "https://stackoverflow.com/questions/48710923/how-can-forp-be-executed-in-an-action", "title": "How can `forP` be executed in an action?", "body": "<p>An action expects a return value of <code>Action ()</code>, but <code>forP</code> returns an <code>Action[()]</code>.\nHow can it be executed in an action?</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1518197346, "post_id": 48710847, "comment_id": 84421245, "body": "If you are writing e.g. a compiler which processes many files at once, this setting is relevant for parse error reporting - obviously one wants to know what file an error occurs in."}], "answers": [{"comments": [{"owner": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "edited": false, "score": 0, "creation_date": 1518290466, "post_id": 48712922, "comment_id": 84448212, "body": "Excellent answer! Thank you, Tikhon! In summary, if my parser reads from a single source, e.g., STDIN, or a file, it actually does not matter much."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 3, "last_activity_date": 1518204912, "creation_date": 1518204912, "answer_id": 48712922, "question_id": 48710847, "link": "https://stackoverflow.com/questions/48710847/understanding-sourcename-in-parsec/48712922#48712922", "title": "Understanding SourceName in Parsec", "body": "<p>In Parsec, <code>SourceName</code> is a <code>String</code> that's used for generating error messages. When in the REPL, this is not very important:</p>\n\n<pre><code>\u03bb&gt; parse expression \"&lt;stdin&gt;\" \")\"\nLeft \"&lt;stdin&gt;\" (line 1, column 1):\nunexpected \")\"\nexpecting expression\n</code></pre>\n\n<p>If we used <code>\"foo\"</code> instead of <code>\"&lt;stdin&gt;\"</code>, if would look like this instead:</p>\n\n<pre><code>Left \"foo\" (line 1, column 1):\nunexpected \")\"\nexpecting expression\n</code></pre>\n\n<p>This is useful when writing a program that takes multiple files as input, like a compiler or interpreter. For example, in my interpreter, I have the following function:</p>\n\n<pre><code>runFile :: FilePath -&gt; IO ()\nrunFile path = do code  &lt;- readFile path\n                  start &lt;- prelude\n                  evalString path start code &gt;&gt;= putStrLn\n</code></pre>\n\n<p>Here I'm passing <code>path</code>\u2014the path of the file you're running\u2014into the function which parses the expression. This way, the error message will tell you <em>which</em> file has the parse error, along with the line numbers.</p>\n\n<pre><code>\u03bb&gt; runFile \"/Users/tikhon/tmp/foo.tpl\"\nError: \"/Users/tikhon/tmp/foo.tpl\" (line 1, column 1):\nunexpected ')'\nexpecting expression or end of input!\n</code></pre>\n"}], "owner": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 48712922, "answer_count": 1, "score": 4, "last_activity_date": 1518204912, "creation_date": 1518196240, "question_id": 48710847, "link": "https://stackoverflow.com/questions/48710847/understanding-sourcename-in-parsec", "title": "Understanding SourceName in Parsec", "body": "<p>I have a question regarding the meaning of <code>SourceName</code> in <code>parse</code> function in <code>Parsec</code>. It seems that all books/blogs/tutorials I read just skip what it is and use <code>\"stdin\"</code>, <code>\"(stdin)\"</code> or an arbitrary string such as <code>\"test parser\"</code>. Does it make any difference what is specified as a <code>SourceName</code>?</p>\n\n<p>I tried to read the <a href=\"https://github.com/haskell/parsec\" rel=\"nofollow noreferrer\">source code</a> of <code>Parsec</code> and it seems that it is used for creating a position. But why does it matter what source it is (as a <code>String</code> indeed). It sounds that I do not need to worry about it in most cases.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1518195962, "post_id": 48710718, "comment_id": 84420490, "body": "Oof, this question needs work. At very least, please include sample input/output from <code>&#39;calculator</code> (it&#39;s not clear what it is your function is trying to do). Preferably give an outline of what&#39;s using <code>&#39;calculator</code> too, because lines like <code>isNothing (readMaybe (head (tail (words x))))</code> don&#39;t read as very Haskell-y, and can probably be improved elsewhere, too."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1518195997, "post_id": 48710718, "comment_id": 84420514, "body": "Hello and welcome to stackoverflow. When providing a code example, the example should ideally be complete (i.e. compile as is). That doesn&#39;t mean you have to dump all of your code here; It&#39;s ok to find a small example that exhibits the same problem you&#39;re having.  Also, a problem description should always include the actual problem. &quot;It does not work&quot; does not tell us what does not work.  That being said, this doesn&#39;t even compile. <code>&#39;calculator</code> is not valid function name in Haskell."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518206326, "post_id": 48710718, "comment_id": 84425496, "body": "A general comment: if your code involves <code>head,tail,isNothing,fromJust</code> it is likely that you are doing something wrong. You should use pattern matching instead, which is simpler, safer, and more readable."}], "answers": [{"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 1, "last_activity_date": 1518202669, "last_edit_date": 1518202669, "creation_date": 1518198776, "answer_id": 48711526, "question_id": 48710718, "link": "https://stackoverflow.com/questions/48710718/test-input-with-readmaybe/48711526#48711526", "title": "Test input with readMaybe", "body": "<p>The error message you're getting is because you haven't told GHC what type it's supposed to be reading the string into. Compare with, in GHCI:</p>\n\n<pre><code>Prelude&gt; read \"3.2\"\n*** Exception: Prelude.read: no parse\nPrelude&gt; read \"3.2\" :: Float\n3.2\n</code></pre>\n\n<hr>\n\n<p>However, the better solution would be to make a product type that encompasses both possibilities, and a function that can evaluate either case to a <code>Num</code>.</p>\n\n<pre><code>data Term = Name  String\n          | Value Float\n\neval :: Memory -&gt; Term -&gt; Float\neval _   (Value n) = n\neval mem (Name  s) = find mem s  -- presumably?\n                                 -- though this should probably give a Maybe Float\n</code></pre>\n\n<p>then you can use <code>readMaybe</code> to implement a parser.</p>\n\n<pre><code>parseTerm :: String -&gt; Term\nparseTerm s = case (readMaybe s :: Maybe Float) of\n              Just v  -&gt; Value v\n              Nothing -&gt; Name  s\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9339510, "user_type": "registered", "profile_image": "https://graph.facebook.com/2424356780923916/picture?type=large", "display_name": "Joao Henrique", "link": "https://stackoverflow.com/users/9339510/joao-henrique"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1518202669, "creation_date": 1518195700, "last_edit_date": 1518196607, "question_id": 48710718, "link": "https://stackoverflow.com/questions/48710718/test-input-with-readmaybe", "title": "Test input with readMaybe", "body": "<p>I'm trying to develop a calculator for a project in college.\nIn the project and I can use the internal memory of it to execute operations. That's the problem. I am not able to separate the entries, when it is a String and when it is a Float. If it is a string I need to look for that string in memory, in case it is a float I need to transform from String that it came to Float and then use in the calculation. The solution I found so far was this:</p>\n\n<pre><code>   'calculator :: Memory -&gt; IO Memory\n   'calculator mem = do\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 x &lt;- getLine\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 let k = if isNothing (readMaybe (head (tail (words x))))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 then find mem (head (tail (words x)))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 else getVar1 x\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 j = if isNothing (readMaybe (head (tail (words (x)))))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 then find mem (head (tail (tail (words x))))\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 else getVar2 x'\n</code></pre>\n\n<p>\u00a0\ni have a memory wich is the type of [Conteudo] and Conteudo is equal to (String,Float).\nwhen using the calculator, for example, you want to add 5 and 9, you type add 5 9\nthe result is printed on the screen and the value is saved in a position of my Memory as (\"ans\", 14). You have the possibility to put another command that would be put A. It will store in an A position of Memory the value of ans example :( \"A\", 14). My problem would be that I can not mix the two inputs. for example add A 8.</p>\n\n<p>it prints this error</p>\n\n<pre><code>Ambiguous type variable `a0' arising from a use of `readMaybe'\n  prevents the constraint `(Read a0)' from being solved.\n  Probable fix: use a type annotation to specify what `a0' should be.\n  These potential instances exist:\n    instance Read Lexeme -- Defined in `GHC.Read'\n    instance Read Ordering -- Defined in `GHC.Read'\n    instance Read Integer -- Defined in `GHC.Read'\n    ...plus 23 others\n    ...plus six instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n* In the first argument of `isNothing', namely\n    `(readMaybe (head (tail (tail (words x)))))'\n  In the expression:\n    isNothing (readMaybe (head (tail (tail (words x)))))\n  In the expression:\n    if isNothing (readMaybe (head (tail (tail (words x))))) then\n        find mem (head (tail (tail (words x))))\n    else\n        getVar2 x\n</code></pre>\n\n<p>If anyone can help me thank you</p>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1518194549, "post_id": 48709079, "comment_id": 84419659, "body": "It should be possible, indeed even trivial, but it isn&#39;t (possible to do automatically)."}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1519468896, "post_id": 48951074, "comment_id": 84929801, "body": "That&#39;s indeed really interesting!"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1519399333, "creation_date": 1519399333, "answer_id": 48951074, "question_id": 48709079, "link": "https://stackoverflow.com/questions/48709079/how-to-convert-any-type-to-symbol-using-type-families/48951074#48951074", "title": "How to convert any type to Symbol using type families?", "body": "<p>There isn't a general solution for all types. But maybe you'll find the following interesting.</p>\n\n<p>You can get the name of a type constructor with an instance of <code>Generic</code>, although that excludes primitive types like <code>Int</code> and <code>Float</code>. Two different ways are given below:</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes#-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeApplications #-}\n\nimport Data.Proxy\nimport GHC.Generics\nimport GHC.TypeLits\n\n-- Solution 1: Defines a type family that extracts the type\n-- constructor name as a Symbol from a generic Rep.\n-- Then it can be reified via GHC.TypeLits.symbolVal.\n\ntype family TyConName (f :: * -&gt; *) :: Symbol where\n  TyConName (M1 D ('MetaData name _mdl _pkg _nt) _f) = name\n\ntyConName\n  :: forall a s\n  .  (Generic a, s ~ TyConName (Rep a), KnownSymbol s) =&gt; String\ntyConName = symbolVal (Proxy @s)\n\n-- Solution 2: Uses the GHC.Generics.datatypeName helper\n-- (value-level string only).\n\ntyConName'\n  :: forall a d f p\n  .  (Generic a, Rep a ~ D1 d f, Datatype d) =&gt; String\ntyConName' = datatypeName (from @a undefined)\n\nmain = do\n  print (tyConName @(Maybe Int))   -- \"Maybe\"\n  print (tyConName' @(Maybe Int))  -- \"Maybe\"\n</code></pre>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1519399333, "creation_date": 1518190092, "question_id": 48709079, "link": "https://stackoverflow.com/questions/48709079/how-to-convert-any-type-to-symbol-using-type-families", "title": "How to convert any type to Symbol using type families?", "body": "<p>I want to convert any type to type-level string using some type families.</p>\n\n<p>Of course, I can write something like this:</p>\n\n<pre><code>type family ShowType (t :: Type) :: Symbol where\n    ShowType Int    = \"Int\"\n    ShowType String = \"String\"\n    ...\n</code></pre>\n\n<p>But I wonder is there some existing mechanism for this? I can do this in runtime using <code>Typeable</code> techniques. But how can I automatically convert any type to <code>Symbol</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1518189362, "post_id": 48708805, "comment_id": 84416467, "body": "Where did you see this function? I cannot find it in Hoogle."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1518189410, "post_id": 48708805, "comment_id": 84416499, "body": "The obvious example would be <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Monoid.html#t:Endo\" rel=\"nofollow noreferrer\"><code>Endo</code></a>. But, is it really sensible to call this \u201cinvariant functor\u201d?"}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1518189498, "post_id": 48708805, "comment_id": 84416556, "body": "here we go <a href=\"https://hackage.haskell.org/package/invariant-0.5/docs/Data-Functor-Invariant.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/invariant-0.5/docs/&hellip;</a>"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1518189895, "post_id": 48708805, "comment_id": 84416829, "body": "@zero_coding have you tried reading the docs you&#39;re linking to? Seems like <code>invmap</code> is just <code>xmap</code> from the article."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518192826, "post_id": 48708805, "comment_id": 84418608, "body": "@leftaroundabout please provide an example."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1518196622, "post_id": 48710624, "comment_id": 84420861, "body": "\u201cEach invariant functor can be expressed in terms of a <code>Profunctor</code>\u201d&#91;Citation needed&#93;"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1518203973, "post_id": 48710624, "comment_id": 84424485, "body": "@leftroundabout, does that need a citation? It&#39;s just generalizing the type of <code>invmap</code> to a two-argument data type and getting <code>dimap</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1518206220, "post_id": 48710624, "comment_id": 84425450, "body": "@Carl, I suspect leftaroundabout means that I should support the claim that <i>every</i> <code>Invariant</code> instance can be split like that. I&#39;m quite confident of that, but I don&#39;t have a citation or a proof. A related claim I also have no idea how to prove is that <code>Invariant</code> instances are unique. I will try to add some explanation of why it&#39;s true."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 7, "last_activity_date": 1518219342, "last_edit_date": 1518219342, "creation_date": 1518195296, "answer_id": 48710624, "question_id": 48708805, "link": "https://stackoverflow.com/questions/48708805/how-to-use-data-functor-invariant/48710624#48710624", "title": "How to use Data.Functor.Invariant?", "body": "<p>Mostly, people <em>don't</em> use <code>Invariant</code>. The reason you'd want to is if you're working with a type in which a variable appears in both covariant and contravariant positions.</p>\n\n<pre><code>newtype Endo a = Endo {appEndo :: a -&gt; a}\nnewtype Foo a = Foo (Maybe a -&gt; IO a)\ndata Bar a = Bar [a] (a -&gt; Bool)\n</code></pre>\n\n<p>None of these are instances of <code>Functor</code> or <code>Contravariant</code>, but they can all be instances of <code>Invariant</code>.</p>\n\n<p>The reason people rarely bother is that if you need to do a lot of mapping over such a type, you're typically better off factoring it out into covariant and contravariant parts. Each invariant functor can be expressed in terms of a <code>Profunctor</code>:</p>\n\n<pre><code>newtype FooP x y = FooP (Maybe x -&gt; IO y)\ndata BarP x y = Bar [y] (x -&gt; Bool)\n</code></pre>\n\n<p>Now</p>\n\n<pre><code>Endo a ~= (-&gt;) a a\nFoo a ~= FooP a a\nBar a ~= BarP a a\n-- So we'd likely write newtype Bar a = Bar (BarP a a)\n</code></pre>\n\n<p>It's generally easier to see what's going on if you unwrap the <code>newtype</code>, <code>dimap</code> over the underlying <code>Profunctor</code>, and then wrap it up again rather than messing around with <code>invmap</code>.</p>\n\n<hr>\n\n<p>How can we transform an <code>Invariant</code> functor into a <code>Profunctor</code>? First, let's dispose of sums and products. If we can turn <code>f</code> and <code>g</code> into profunctors <code>fp</code> and <code>gp</code>, then we can surely turn <code>f :+: g</code> and <code>f :*: g</code> into equivalent profunctor sums and products.</p>\n\n<p>What about compositions? It's slightly trickier, but not much. Suppose that we can turn <code>f</code> and <code>g</code> into profunctors <code>fp</code> and <code>gp</code>. Now define</p>\n\n<pre><code>-- Compose f g a ~= ComposeP fp gp a a\nnewtype ComposeP p q a b = ComposeP (p (q b a) (q a b))\ninstance (Profunctor p, Profunctor q) =&gt; Profunctor (ComposeP p q) where\n  dimap f g (ComposeP p) = ComposeP $ dimap (dimap g f) (dimap f g) p\n</code></pre>\n\n<p>Now suppose you have a function type; <code>f a -&gt; g a</code>. This looks like <code>fp b a -&gt; gp a b</code>.</p>\n\n<p>I think that should cover most of the interesting cases.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1518219342, "creation_date": 1518189209, "question_id": 48708805, "link": "https://stackoverflow.com/questions/48708805/how-to-use-data-functor-invariant", "title": "How to use Data.Functor.Invariant?", "body": "<p>Could someone please provide me an example of</p>\n\n<pre><code>invmap :: (a -&gt; b) -&gt; (b -&gt; a) -&gt; f a -&gt; f b  \n</code></pre>\n\n<p>and for what is Invariant good for?   </p>\n"}, {"tags": ["string", "haskell", "recursion"], "comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 2, "creation_date": 1518190079, "post_id": 48708736, "comment_id": 84416934, "body": "Why are you calling your function recursively with <code>n = 3*n-2</code>? What was the purpose of that?"}, {"owner": {"reputation": 11, "user_id": 9339027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9032b4bc329eee3c6a7bbfaa135bb285?s=128&d=identicon&r=PG&f=1", "display_name": "akh22697", "link": "https://stackoverflow.com/users/9339027/akh22697"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1518190171, "post_id": 48708736, "comment_id": 84417005, "body": "I was told to use 3n-2 so I thought that was what was meant."}, {"owner": {"reputation": 11, "user_id": 9339027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9032b4bc329eee3c6a7bbfaa135bb285?s=128&d=identicon&r=PG&f=1", "display_name": "akh22697", "link": "https://stackoverflow.com/users/9339027/akh22697"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1518190253, "post_id": 48708736, "comment_id": 84417070, "body": "Honestly I just tried anything because it just did not make sense."}, {"owner": {"reputation": 11, "user_id": 9339027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9032b4bc329eee3c6a7bbfaa135bb285?s=128&d=identicon&r=PG&f=1", "display_name": "akh22697", "link": "https://stackoverflow.com/users/9339027/akh22697"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1518190583, "post_id": 48708736, "comment_id": 84417275, "body": "Somewhat fixed code to look better but still not there.                            series :: Int -&gt; Int -&gt; [Int] series n item   | n &lt;= 0    = []   | otherwise = item : series (n-1) item   doubleCount :: Int -&gt; [[Int]] doubleCount n             |n &lt;= 0        = [ ]             |otherwise     = helper 1            where             helper :: Int -&gt; [[Int]]             helper i                    |i &gt; n      = [ ]                    |otherwise  = (series i n) : helper(i+1)"}, {"owner": {"reputation": 11, "user_id": 9339027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9032b4bc329eee3c6a7bbfaa135bb285?s=128&d=identicon&r=PG&f=1", "display_name": "akh22697", "link": "https://stackoverflow.com/users/9339027/akh22697"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1518190693, "post_id": 48708736, "comment_id": 84417333, "body": "gives me: *Main&gt; doubleCount 6 [[6],[6,6],[6,6,6],[6,6,6,6],[6,6,6,6,6],[6,6,6,6,6,6]]"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6306428"}, "is_accepted": false, "score": 0, "last_activity_date": 1518697526, "creation_date": 1518697526, "answer_id": 48807252, "question_id": 48708736, "link": "https://stackoverflow.com/questions/48708736/haskell-recursion-with-chars/48807252#48807252", "title": "Haskell Recursion with Chars", "body": "<p>A quick and dirty implementation</p>\n\n<pre><code>module Test where\n\nmerge :: [a] -&gt; [a] -&gt; [a]\nmerge xs [] = xs\nmerge [] ys = ys\nmerge (x:xs) (y:ys) = x : y : y : merge xs ys\n\nmakeString :: Int -&gt; Char -&gt; Char -&gt; String\nmakeString 0 _ _ = []\nmakeString n ch1 ch2 = take ((3 * n) - 2) $ merge (replicate (3 * n) ch1) (replicate (3 * n) ch2)\n</code></pre>\n\n<p>The <code>replicate</code> creates long enough lists for <code>merge</code> to do its work. Works for all positive <code>n</code>s</p>\n"}, {"tags": [], "owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "is_accepted": false, "score": 0, "last_activity_date": 1518733443, "creation_date": 1518733443, "answer_id": 48817295, "question_id": 48708736, "link": "https://stackoverflow.com/questions/48708736/haskell-recursion-with-chars/48817295#48817295", "title": "Haskell Recursion with Chars", "body": "<p>Here is my solution:</p>\n\n<pre><code>makeString :: Int -&gt; Char -&gt; Char -&gt; String\nmakeString n ch1 ch2\n  | n &lt;= 0 = \"\"\n  | n == 1 = [ch1]\n  | otherwise = [ch1, ch2, ch2] ++ makeString (n-1) ch1 ch2\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9339027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9032b4bc329eee3c6a7bbfaa135bb285?s=128&d=identicon&r=PG&f=1", "display_name": "akh22697", "link": "https://stackoverflow.com/users/9339027/akh22697"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 262, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1518733443, "creation_date": 1518188971, "last_edit_date": 1518189864, "question_id": 48708736, "link": "https://stackoverflow.com/questions/48708736/haskell-recursion-with-chars", "title": "Haskell Recursion with Chars", "body": "<p>Write a recursive Haskell function</p>\n\n<pre><code>makeString :: Int -&gt; Char -&gt; Char -&gt; String\n</code></pre>\n\n<p>such that <code>makeString n ch1 ch2</code> returns a string as follows:</p>\n\n<ul>\n<li>When n is positive, the string has length 3n-2 and contains n copies\nof ch1, each copy separated by two copies of ch2.</li>\n<li>When n is less than or equal to zero, the string is the empty string.</li>\n</ul>\n\n<p>For example, the function has the following behavior:</p>\n\n<pre><code>Main &gt; makeString 5 'a' '!'\n\"a!!a!!a!!a!!a\"\nMain &gt; makeString 1 'a' '!'\n\"a\"\nMain &gt; makeString 10 '6' '#'\n\"6##6##6##6##6##6##6##6##6##6\"\n</code></pre>\n\n<p>So far I have:</p>\n\n<pre><code>makeString :: Int -&gt; Char -&gt; Char -&gt; String\nmakeString n ch1 ch2\n           |n &lt;= 0        = [ ]\n           |otherwise     = ch1: makeString(3*n-2)(ch2)(ch1)\n\nMain&gt; makeString 5 'a' '!'\n\"a!a!a!a!a!a!a!a!a!a!a!a!a!a!a!a!a!a!a!a\"\n</code></pre>\n"}, {"tags": ["performance", "haskell", "recursion", "optimization", "benchmarking"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 5, "creation_date": 1518186934, "post_id": 48707239, "comment_id": 84414955, "body": "Note that <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.0.2/docs/src/Data-Functor-Foldable.html#Recursive\" rel=\"nofollow noreferrer\"><i>recursion-schemes</i> defines <code>cata</code></a> as <code>cata f = c where c = f . fmap c . project</code>  (as opposed to <code>cata f = f . fmap (cata f) . project</code>) due to, I presume, the same issue discussed in the postscript link. Cf. also <a href=\"https://stackoverflow.com/q/31168743/2751851\"><i>why pipes defines inner functions</i></a>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1518636391, "post_id": 48707239, "comment_id": 84591786, "body": "Note that for the longer input, the <code>fix</code> variants only outperform their non-fix counterparts by a factor of 5 to 6."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1518636789, "post_id": 48707239, "comment_id": 84591984, "body": "FWIW, allocations are similar for <code>-O0</code> (the non-<code>fix</code> variants have only 1.31x the allocations) but quite different for <code>-O2</code> (the non-<code>fix</code> variants have 2.75x the allocations). That seems to support the hypothesis that the non-<code>fix</code> variant might be recomputing some things instead of sharing them."}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1519181974, "post_id": 48894927, "comment_id": 84800617, "body": "Well, but there is still the recursive call to <code>go</code>. That it is not a top-level binding does not mean it is not a lambda abstraction. According to benchmarks, it must be the case that top-level recursion causes tenfold performance loss comparing to <code>let</code>-recursion, but I will still be seeking the explanation of the underlying <i>computational</i> differences, be they lying on the STG level or even deeper. After all, <code>cata2</code> is no less recursive than <code>cata</code>, in that it conains recursion, &quot;encapsulated&quot; in <code>go</code> but nevertheless."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1519183069, "post_id": 48894927, "comment_id": 84800837, "body": "In any way, it&#39;s great that we can now stop talking about particular functions and move on to researching why GHC optimizes top-level and <code>let</code>-level recursion differently."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1519201310, "post_id": 48894927, "comment_id": 84807454, "body": "@Kindaro Well, <code>go</code> takes no arguments, while <code>cata</code> takes one. Recursions like <code>go = 1 : go</code> create an infinite list n constant space, while <code>f () = 1 : f ()</code> do the same in unbounded space."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1519203112, "post_id": 48894927, "comment_id": 84808399, "body": "It kinda seems plausible, but I find it hard to wrap my mind around it. For one, I see no reason GHC cound not optimize this, if it is so easily done by hand."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1519203766, "post_id": 48894927, "comment_id": 84808800, "body": "@Kindaro It is not always an optimization, space wise. <code>let f () = ... in print (f ()) &gt;&gt; print somethingElse &gt;&gt; print (f ())</code> could free memory during the middle step, and reallocate it for the third step. Using <code>let x = ... in print x &gt;&gt; print somethingElse &gt;&gt; print x</code> will keep <code>x</code> in memory for the whole computation. This is useful to achieve memoization (which is what we need in the <code>fix</code>) example, but that is not always desirable. Sometimes, we do want to throw away precomputed results (especially large ones) and recompute them later when needed."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1519211386, "post_id": 48894927, "comment_id": 84814275, "body": "Well, if it gives tenfold speedup on any recursive function, I&#39;d say it&#39;s a worthy tradeoff."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1519164255, "last_edit_date": 1519164255, "creation_date": 1519163926, "answer_id": 48894927, "question_id": 48707239, "link": "https://stackoverflow.com/questions/48707239/why-do-these-fixpoint-cata-ana-morphism-definitions-outperform-the-recursive-o/48894927#48894927", "title": "Why do these fixpoint cata / ana morphism definitions outperform the recursive ones?", "body": "<p>This is due to <a href=\"https://stackoverflow.com/q/12999385/2108477\">how the fixed point is computed by <code>fix</code></a>.\nThis was pointed out by @duplode above (and by myself in a <a href=\"https://stackoverflow.com/questions/48705438/can-one-express-catamorphism-through-data-function-fix\">related question</a>). Anyway, we can summarize the issue as follows.</p>\n\n<p>We have that</p>\n\n<pre><code>fix f = f (fix f)\n</code></pre>\n\n<p>works, but makes a <code>fix f</code> new call at every recursion. Instead,</p>\n\n<pre><code>fix f = go\n   where go = f go\n</code></pre>\n\n<p>computes the same fixed point avoiding that call. In the libraries <code>fix</code> is implemented in this more efficient way.</p>\n\n<p>Back to the question, consider the following <em>three</em> implementations of <code>cata</code>:</p>\n\n<pre><code>cata :: Functor f =&gt; Algebra f b -&gt; Fix f -&gt; b\ncata alg' = alg' . fmap (cata alg') . unFix\n\ncata2 :: Functor f =&gt; Algebra f b -&gt; Fix f -&gt; b\ncata2 alg' = go\n   where\n   go = alg' . fmap go . unFix\n\nfixcata :: Functor f =&gt; Algebra f b -&gt; Fix f -&gt; b\nfixcata alg' = fix $ \\f -&gt; alg' . fmap f . unFix\n</code></pre>\n\n<p>The first one makes a call <code>cata alg'</code> at every recursion. The second one does not. The third one also does not since the library <code>fix</code> is efficient.</p>\n\n<p>And indeed, we can use Criterion to confirm this, even using the same test used by the OP:</p>\n\n<pre><code>benchmarking cata/short input/cata\ntime                 16.58 us   (16.54 us .. 16.62 us)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 16.62 us   (16.58 us .. 16.65 us)\nstd dev              111.6 ns   (89.76 ns .. 144.0 ns)\n\nbenchmarking cata/short input/cata2\ntime                 1.746 us   (1.742 us .. 1.749 us)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 1.741 us   (1.736 us .. 1.744 us)\nstd dev              12.69 ns   (10.50 ns .. 17.31 ns)\n\nbenchmarking cata/short input/fixcata\ntime                 2.010 us   (2.003 us .. 2.016 us)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 2.006 us   (2.001 us .. 2.011 us)\nstd dev              16.40 ns   (14.05 ns .. 19.27 ns)\n</code></pre>\n\n<p>Long inputs also show the improvement.</p>\n\n<pre><code>benchmarking cata/long input/cata\ntime                 119.3 ms   (113.4 ms .. 125.8 ms)\n                     0.996 R\u00b2   (0.992 R\u00b2 .. 1.000 R\u00b2)\nmean                 119.8 ms   (117.7 ms .. 121.7 ms)\nstd dev              2.924 ms   (2.073 ms .. 4.064 ms)\nvariance introduced by outliers: 11% (moderately inflated)\n\nbenchmarking cata/long input/cata2\ntime                 17.89 ms   (17.43 ms .. 18.36 ms)\n                     0.996 R\u00b2   (0.992 R\u00b2 .. 0.999 R\u00b2)\nmean                 18.02 ms   (17.49 ms .. 18.62 ms)\nstd dev              1.362 ms   (853.9 us .. 2.022 ms)\nvariance introduced by outliers: 33% (moderately inflated)\n\nbenchmarking cata/long input/fixcata\ntime                 18.03 ms   (17.56 ms .. 18.50 ms)\n                     0.996 R\u00b2   (0.992 R\u00b2 .. 0.999 R\u00b2)\nmean                 18.17 ms   (17.57 ms .. 18.72 ms)\nstd dev              1.365 ms   (852.1 us .. 2.045 ms)\nvariance introduced by outliers: 33% (moderately inflated)\n</code></pre>\n\n<p>I also experimented with <code>ana</code>, observing that the performance of a similarly improved <code>ana2</code> agrees with <code>fixana</code>. No surprises there as well.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "accepted_answer_id": 48894927, "answer_count": 1, "score": 10, "last_activity_date": 1519164255, "creation_date": 1518183777, "last_edit_date": 1518228097, "question_id": 48707239, "link": "https://stackoverflow.com/questions/48707239/why-do-these-fixpoint-cata-ana-morphism-definitions-outperform-the-recursive-o", "title": "Why do these fixpoint cata / ana morphism definitions outperform the recursive ones?", "body": "<p>Consider these definitions from <a href=\"https://stackoverflow.com/q/48705438/2108477\">a previous question</a>:</p>\n\n<pre><code>type Algebra f a = f a -&gt; a\n\ncata :: Functor f =&gt; Algebra f b -&gt; Fix f -&gt; b\ncata alg = alg . fmap (cata alg) . unFix\n\nfixcata :: Functor f =&gt; Algebra f b -&gt; Fix f -&gt; b\nfixcata alg = fix $ \\f -&gt; alg . fmap f . unFix\n\ntype CoAlgebra f a = a -&gt; f a\n\nana :: Functor f =&gt; CoAlgebra f a -&gt; a -&gt; Fix f\nana coalg = Fix . fmap (ana coalg) . coalg\n\nfixana :: Functor f =&gt; CoAlgebra f a -&gt; a -&gt; Fix f\nfixana coalg = fix $ \\f -&gt; Fix . fmap f . coalg\n</code></pre>\n\n<p>I ran some benchmarks and the results are surprising me. <code>criterion</code> reports something like a tenfold speedup, specifically when <code>O2</code> is enabled. I wonder what causes such massive improvement, and begin to seriously doubt my benchmarking abilities.</p>\n\n<p>This is the exact <code>criterion</code> code I use:</p>\n\n<pre><code>smallWord, largeWord :: Word\nsmallWord = 2^10\nlargeWord = 2^20\n\nshortEnv, longEnv :: Fix Maybe\nshortEnv = ana coAlg smallWord\nlongEnv = ana coAlg largeWord\n\nbenchCata = nf (cata alg)\nbenchFixcata = nf (fixcata alg)\n\nbenchAna = nf (ana coAlg)\nbenchFixana = nf (fixana coAlg)\n\nmain = defaultMain\n    [ bgroup \"cata\"\n        [ bgroup \"short input\"\n            [ env (return shortEnv) $ \\x -&gt; bench \"cata\"    (benchCata x)\n            , env (return shortEnv) $ \\x -&gt; bench \"fixcata\" (benchFixcata x)\n            ]\n        , bgroup \"long input\"\n            [ env (return longEnv) $ \\x -&gt; bench \"cata\"    (benchCata x)\n            , env (return longEnv) $ \\x -&gt; bench \"fixcata\" (benchFixcata x)\n            ]\n        ]\n    , bgroup \"ana\"\n        [ bgroup \"small word\"\n            [ bench \"ana\" $ benchAna smallWord\n            , bench \"fixana\" $ benchFixana smallWord\n            ]\n        , bgroup \"large word\"\n            [ bench \"ana\" $ benchAna largeWord\n            , bench \"fixana\" $ benchFixana largeWord\n            ]\n        ]\n    ]\n</code></pre>\n\n<p>And some auxiliary code:</p>\n\n<pre><code>alg :: Algebra Maybe Word\nalg Nothing = 0\nalg (Just x) = succ x\n\ncoAlg :: CoAlgebra Maybe Word\ncoAlg 0 = Nothing\ncoAlg x = Just (pred x)\n</code></pre>\n\n<p>Compiled with <code>O0</code>, the digits are pretty even. With <code>O2</code>, <code>fix~</code> functions seem to outperform the plain ones:</p>\n\n<pre><code>benchmarking cata/short input/cata\ntime                 31.67 \u03bcs   (31.10 \u03bcs .. 32.26 \u03bcs)\n                     0.999 R\u00b2   (0.998 R\u00b2 .. 1.000 R\u00b2)\nmean                 31.20 \u03bcs   (31.05 \u03bcs .. 31.46 \u03bcs)\nstd dev              633.9 ns   (385.3 ns .. 1.029 \u03bcs)\nvariance introduced by outliers: 18% (moderately inflated)\n\nbenchmarking cata/short input/fixcata\ntime                 2.422 \u03bcs   (2.407 \u03bcs .. 2.440 \u03bcs)\n                     1.000 R\u00b2   (1.000 R\u00b2 .. 1.000 R\u00b2)\nmean                 2.399 \u03bcs   (2.388 \u03bcs .. 2.410 \u03bcs)\nstd dev              37.12 ns   (31.44 ns .. 47.06 ns)\nvariance introduced by outliers: 14% (moderately inflated)\n</code></pre>\n\n<p>I would appreciate if someone can confirm or spot a flaw.</p>\n\n<p>*I compiled things with <code>ghc 8.2.2</code> on this occasion.)</p>\n\n<hr>\n\n<p><strong>postscriptum</strong></p>\n\n<p><a href=\"https://stackoverflow.com/q/12999385/2108477\">This post from back in 2012</a> elaborates on the performance of <code>fix</code> in quite a fine detail. (Thanks to <code>@chi</code> for the link.)</p>\n"}, {"tags": ["haskell", "recursion", "optimization", "fixpoint-combinators", "catamorphism"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1518178970, "post_id": 48705438, "comment_id": 84409815, "body": "I don&#39;t understand. What happens if you try the analogous <code>fixcata f = fix $ \\g -&gt; f . fmap g . unFix</code> ?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518179775, "post_id": 48705438, "comment_id": 84410309, "body": "@chi Oh. Defeated again. I&#39;m poor with fixpoints. I should probably delete this question to avoid embarrassment."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1518180519, "post_id": 48705438, "comment_id": 84410794, "body": "SO is not a game when one gets &quot;defeated&quot; :) There&#39;s nothing wrong in asking a question without knowing the answer beforehand -- indeed that&#39;s the whole point of asking!"}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1518182263, "post_id": 48706181, "comment_id": 84411943, "body": "Thank you! Can you also take a look at the updated post?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 2, "creation_date": 1518182860, "post_id": 48706181, "comment_id": 84412322, "body": "@Kindaro you should make that update (which I rolled back for now) a separate question, since it doesn&#39;t directly relate to the original question&#39;s title."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1518184818, "post_id": 48706181, "comment_id": 84413590, "body": "@Kindaro Also see <a href=\"https://stackoverflow.com/questions/12999385/why-does-ghc-make-fix-so-confounding\">this</a> first. I think it&#39;s exactly the same issue which improves performance."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1518180381, "creation_date": 1518180381, "answer_id": 48706181, "question_id": 48705438, "link": "https://stackoverflow.com/questions/48705438/can-one-express-catamorphism-through-data-function-fix/48706181#48706181", "title": "Can one express catamorphism through Data.Function.fix?", "body": "<p>Actually, this has nothing to do with catamorphisms.</p>\n\n<p>Whenever a function is defined as</p>\n\n<pre><code>f = (... f ...)   -- some expression involving f\n</code></pre>\n\n<p>one can rewrite it using <code>fix</code> as</p>\n\n<pre><code>f = fix $ \\g -&gt; (... g ...)\n</code></pre>\n\n<p>In the posted code we have a slight variant</p>\n\n<pre><code>f x = (... (f x) ...)\n</code></pre>\n\n<p>We can regard the above as <code>f</code> being defined recursively. However, it's simpler if we regard <code>f x</code> (rather than <code>f</code>) being defined recursively.</p>\n\n<pre><code>f x = fix $ \\g -&gt; (... g ...)\n</code></pre>\n\n<p>This should be more efficient than the plain translation</p>\n\n<pre><code>f = fix $ \\g x -&gt; (... (g x) ...)\n</code></pre>\n\n<p>since we don't need to call <code>g</code> over and over again with the same argument <code>x</code>.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 48706181, "answer_count": 1, "score": 2, "last_activity_date": 1563168118, "creation_date": 1518177907, "last_edit_date": 1563168118, "question_id": 48705438, "link": "https://stackoverflow.com/questions/48705438/can-one-express-catamorphism-through-data-function-fix", "title": "Can one express catamorphism through Data.Function.fix?", "body": "<p>I have this lovely <code>fixana</code> function here that performs about 5 times faster than her sister <code>ana</code>. <em>(i have a <code>criterion</code> report to back me on this)</em></p>\n\n<pre><code>ana alg = Fix . fmap (ana alg) . alg\n\nfixana alg = fix $ \\f -&gt; Fix . fmap f . alg\n</code></pre>\n\n<p>Can I express their cousin <code>cata</code> in the same fashion?</p>\n\n<pre><code>cata f = f . fmap (cata f) . unFix\n</code></pre>\n\n<p>It seems to me that I cannot, but I have been humbled by my S.O. fellows quite a few times in the past.</p>\n"}, {"tags": ["haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518172536, "post_id": 48703805, "comment_id": 84406062, "body": "Your <code>return</code> suggests that the monad is <code>Maybe</code>, and this does not match with the <code>(&gt;&gt;=)</code> which should have type <code>(a -&gt; Maybe b) -&gt; Maybe a -&gt; Maybe b</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1518179321, "post_id": 48703805, "comment_id": 84410017, "body": "Your <code>&gt;&gt;=</code> should be named <code>&gt;&gt;</code>, at best. For a propoer monad you need to have <code>(&gt;&gt;=) :: Movement a -&gt; (a -&gt; Movement b) -&gt; Movement b</code>."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 6, "last_activity_date": 1518187707, "creation_date": 1518187707, "answer_id": 48708384, "question_id": 48703805, "link": "https://stackoverflow.com/questions/48703805/is-what-i-wrote-an-actual-monad/48708384#48708384", "title": "Is what I wrote an actual monad?", "body": "<p>Your <code>Movement</code> type is a lot like a combination of the <code>Maybe</code> monad (to allow for failed movements) plus the <code>State</code> monad with the current <code>Zipper a</code> as the state:</p>\n\n<pre><code>State (Zipper a) b  =  Zipper a -&gt; (b, Zipper a)\n</code></pre>\n\n<p>I'm cheating with the <code>=</code> here .  This isn't the precise definition of the <code>State</code> type, but these types are isomorphic, so you can think of <code>State</code> as being equal to this type.</p>\n\n<p>In other words, you've come close to reinventing the transformer-based monad:</p>\n\n<pre><code>type Movement' a b = StateT (Zipper a) Maybe b\n</code></pre>\n\n<p>The main difference is that <code>Movement' a b</code> is isomorphic to:</p>\n\n<pre><code>Zipper a -&gt; Maybe (b, Zipper a)\n</code></pre>\n\n<p>so it's got that extra <code>b</code> value that you haven't included.</p>\n\n<p>Sooo....</p>\n\n<p>If you were to rewrite your <code>Movement</code> type as:</p>\n\n<pre><code>type Movement a b = Zipper a -&gt; Maybe (b, Zipper a)\n</code></pre>\n\n<p>you'd be on to something.  Here, <code>Movement</code> isn't a monad -- instead, <code>Movement a</code> is a monad which can be applied to an underlying type <code>Movement a b</code>.</p>\n\n<p>If you're familiar with <code>Either</code> as a monad, it's the same thing:  <code>Either</code> by itself isn't a monad, but <code>Either String</code> is a monad that can be applied to another type like <code>Either String Double</code> to represent, say, a computation that returns either a <code>Double</code> result or a <code>String</code> error message. </p>\n\n<p>Similarly, your <code>Movement a</code> is a monad that can be applied to another type <code>Movement a b</code> to represent a computation that returns a <code>b</code> while maintaining a <code>Zipper a</code> as an internal state and allowing failure by returning <code>Nothing</code>.</p>\n\n<p>Moving on, your <code>turnLeft</code>, <code>turnRight</code>, and <code>goAhead</code> are pure effects:  they modify the state (the <code>State</code> part of the monad), signalling error if an impossible move is made (the <code>Maybe</code> part of the monad), but they don't need to return anything.  That's okay, because they can return <code>()</code>.  Here's how <code>goAhead</code> would work:</p>\n\n<pre><code>goAhead :: Movement a ()\n-- same as:  goAhead :: Zipper a -&gt; Maybe ((), Zipper a)\ngoAhead (t, Passage v a) = Just ((), (StraightAhead v:t, a))\ngoAhead _                = Nothing\n</code></pre>\n\n<p>and you can make analogous changes to <code>turnLeft</code> and <code>turnRight</code>.</p>\n\n<p>Now, redefining <code>return</code> is relatively easy.  It should pack an arbitrary value of type <code>b</code> into your <code>Movement a</code> monad without having any \"effects\".  See if you can fill in the blank:</p>\n\n<pre><code>return :: b -&gt; Movement a b\n-- same as:  return :: b -&gt; Zipper a -&gt; Maybe (b, Zipper a)\n-- in definitino below, right hand side should be:\n--     Movement a b = Zipper a -&gt; Maybe (b, Zipper a)\nreturn b = \\z -&gt; _\n</code></pre>\n\n<p>Of course, <code>(&gt;&gt;=)</code> is a little harder.  See if you can figure it out:</p>\n\n<pre><code>(&gt;&gt;=) :: Movement a b -&gt; (b -&gt; Movement a c) -&gt; Movement a c\n-- in definition below, right-hand side is a:\n--   Movement a c = Zipper a -&gt; Maybe (b, Zipper a)\nmb &gt;&gt;= bToMc = \\z1 -&gt; case mb z1 of ...\n</code></pre>\n\n<p>If you give up, I've included the answers below.</p>\n\n<p>With this monad, things can get a little more interesting.  For example, you can can introduce an action that <em>does</em> return something.  How about the set of valid moves?</p>\n\n<pre><code>data Move = LeftOk | RightOk | StraightOk\n\nvalidMoves :: Movement a [Move]\nvalidMoves z@(t, n) = case n of\n  (Fork _ _ _)  -&gt; Just ([LeftOk, RightOk], z)\n  (Passage _ _) -&gt; Just ([StraightOk], z)\n  (DeadEnd _)   -&gt; Just ([], z)\n</code></pre>\n\n<p>or the element at the current position:</p>\n\n<pre><code>peek :: Movement a a\npeek z@(_, n) = case n of\n  Fork a _ _  -&gt; Just (a, z)\n  Passage a _ -&gt; Just (a, z)\n  DeadEnd a   -&gt; Just (a, z)\n</code></pre>\n\n<p>Using this, you can construct a monadic action that walks the zipper, always using the first valid move, and returns the value at the dead end:</p>\n\n<pre><code>findDeadEnd :: Movement a a\nfindDeadEnd =\n    validMoves &gt;&gt;= \\moves -&gt;\n    case moves of [] -&gt; peek\n                  (mv:_) -&gt; (case mv of StraightOk -&gt; goAhead\n                                        LeftOk     -&gt; turnLeft\n                                        RightOk    -&gt; turnRight)\n                            &gt;&gt;= \\() -&gt; findDeadEnd\n</code></pre>\n\n<p>If this was a real monad instance, you could write the above more cleanly in <code>do</code> notation.</p>\n\n<p>Not bad, huh?</p>\n\n<p>Anyway, the full code with the answers for <code>return</code> and <code>&gt;&gt;=</code> is below.  Next, you might want to try wrapping your <code>Movement</code> into a newtype so you can define instances:</p>\n\n<pre><code>newtype Movement a b \n  = Movement { runMovement :: Zipper a -&gt; Maybe (b, Zipper a) }\ninstance Functor (Movement a) where\ninstance Applicative (Movement a) where\ninstance Monad (Movement a) where\n</code></pre>\n\n<p>and see if you can rewrite everything to make it a real <code>Monad</code>.</p>\n\n<p>The full example:</p>\n\n<pre><code>module MonadZipper where\n\nimport Prelude hiding (return, (&gt;&gt;=))\n\ndata Node a = Fork a (Node a) (Node a)\n            | Passage a (Node a)\n            | DeadEnd a\n              deriving (Show)\n\ndata Branch a = TurnLeft a (Node a)\n              | TurnRight a (Node a)\n              | StraightAhead a\n                deriving (Show)\n\ntype Trace a = [Branch a]\ntype Zipper a = (Trace a, Node a)\n\ntype Movement a b = Zipper a -&gt; Maybe (b, Zipper a)\n\n(&gt;&gt;=) :: Movement a b -&gt; (b -&gt; Movement a c) -&gt; Movement a c\nmb &gt;&gt;= bToMc = \\z1 -&gt; case mb z1 of\n                        Nothing -&gt; Nothing\n                        Just (b, z2) -&gt; bToMc b z2\n\nreturn :: b -&gt; Movement a b\nreturn b z = Just (b, z)\n\nturnLeft :: Movement a ()\nturnLeft (t, (Fork v l r)) = Just ((), (TurnLeft v r:t, l))\nturnLeft _                 = Nothing\n\nturnRight :: Movement a ()\nturnRight (t, (Fork v l r)) = Just ((), (TurnRight v l:t, r))\nturnRight _                 = Nothing\n\ngoAhead :: Movement a ()\ngoAhead (t, Passage v a) = Just ((), (StraightAhead v:t, a))\ngoAhead _                = Nothing\n\ndata Move = LeftOk | RightOk | StraightOk\n\nvalidMoves :: Movement a [Move]\nvalidMoves z@(t, n) = case n of\n  (Fork _ _ _)  -&gt; Just ([LeftOk, RightOk], z)\n  (Passage _ _) -&gt; Just ([StraightOk], z)\n  (DeadEnd _)   -&gt; Just ([], z)\n\npeek :: Movement a a\npeek z@(_, n) = case n of\n  Fork a _ _  -&gt; Just (a, z)\n  Passage a _ -&gt; Just (a, z)\n  DeadEnd a   -&gt; Just (a, z)\n\nfindDeadEnd :: Movement a a\nfindDeadEnd =\n    validMoves &gt;&gt;= \\moves -&gt;\n    case moves of [] -&gt; peek\n                  (mv:_) -&gt; (case mv of StraightOk -&gt; goAhead\n                                        LeftOk     -&gt; turnLeft\n                                        RightOk    -&gt; turnRight)\n                            &gt;&gt;= \\() -&gt; findDeadEnd\n\ntest = case findDeadEnd ([], (Fork 1 (Fork 2 (Passage 3 (DeadEnd 4))\n                                             (DeadEnd 5))\n                                     (Passage 6 (DeadEnd 7)))) of\n         Just (v, _) -&gt; print v\n</code></pre>\n"}], "owner": {"reputation": 229, "user_id": 7188330, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3b1faff19f7efae6ee99dae9344c322f?s=128&d=identicon&r=PG&f=1", "display_name": "nek28", "link": "https://stackoverflow.com/users/7188330/nek28"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 48708384, "answer_count": 1, "score": 5, "last_activity_date": 1518187707, "creation_date": 1518172226, "question_id": 48703805, "link": "https://stackoverflow.com/questions/48703805/is-what-i-wrote-an-actual-monad", "title": "Is what I wrote an actual monad?", "body": "<p>I have been trying to understand monads and since I recently understood what zippers are I thought I might try to combine both ideas. (>>=) does what I think monads should do, namely it lets me combine movements around the zipper in the form of <code>moveRight &gt;&gt;= moveLeft &gt;&gt;= goAhead &gt;&gt;= return</code> but I feel like I'm missing something because, among other things, I can't seem to fit its type to what a monad should be, namely <code>Ma -&gt; (a -&gt; Mb) -&gt; Mb</code>. Any help would be welcome. </p>\n\n<pre><code>module MonadZipper where\n\nimport Prelude hiding (return, (&gt;&gt;=))\n\ndata Node a = Fork a (Node a) (Node a)\n            | Passage a (Node a)\n            | DeadEnd a\n              deriving (Show)\n\ndata Branch a = TurnLeft a (Node a)\n              | TurnRight a (Node a)\n              | StraightAhead a\n                deriving (Show)\n\ntype Trace a = [Branch a]\ntype Zipper a = (Trace a, Node a)\n\n\ntype Movement a = Zipper a -&gt; Maybe (Zipper a)\n--not sure whether this wrapping makes sense\n\nturnLeft :: Zipper a -&gt; Maybe (Zipper a)\nturnLeft (t, (Fork v l r)) = Just (TurnLeft v r:t, l)\nturnLeft _                 = Nothing\n\nturnRight :: Zipper a -&gt; Maybe (Zipper a)\nturnRight (t, (Fork v l r)) = Just (TurnRight v l:t, r)\nturnRight _                 = Nothing\n\ngoAhead :: Zipper a -&gt; Maybe (Zipper a)\ngoAhead (t, Passage v a) = Just (StraightAhead v:t, a)\ngoAhead _                = Nothing\n\n(&gt;&gt;=) :: Movement a -&gt; Movement a -&gt; Movement a\n(&gt;&gt;=) turner func = \\zippo -&gt;\n                      case turner zippo of\n                        Nothing -&gt; Nothing\n                        Just tree -&gt; func tree\n\nreturn :: Zipper a -&gt; Maybe (Zipper a)\nreturn tree = Just tree\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1518155485, "post_id": 48699422, "comment_id": 84397522, "body": "Where\u2019s <code>listDirectory</code> from?"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1518155670, "post_id": 48699422, "comment_id": 84397597, "body": "@Ryan From the modern <a href=\"https://hackage.haskell.org/package/directory-1.3.2.0/docs/System-Directory.html\" rel=\"nofollow noreferrer\"><code>directory</code></a>. (&quot;<i>Since: 1.2.5.0</i>&quot;!)"}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1518155863, "post_id": 48699422, "comment_id": 84397682, "body": "<a href=\"https://hackage.haskell.org/package/directory-1.3.2.0/docs/System-Directory.html#v:listDirectory\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/directory-1.3.2.0/docs/&hellip;</a> \u2013 catch <code>NoSuchThing</code> and <code>InappropriateType</code>?"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 2, "creation_date": 1518156134, "post_id": 48699422, "comment_id": 84397787, "body": "<code>POSIX</code> in fact can get into a lot of race conditions where an operation a program selects is no longer valid moments later. One example they did something about eventually was how <code>tmpnam()</code> returned a valid name for a file that did not already exist\u2014at some point in time, but that wasn\u2019t guaranteed to <i>still</i> be valid when you tried to actually create the temporary file. A later version of <code>POSIX</code> added a new function that created a temporary file as a single operation."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1518156230, "post_id": 48699422, "comment_id": 84397820, "body": "@Ryan I am kind of suspicious because it can apparently say <code>NoSuchThing</code> in case of both <code>ENOENT</code> and <code>ENOTDIR</code>. The description is scarce, the behaviour is not spelled out, and I don&#39;t want to read any guarantees into it."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1518156829, "post_id": 48699422, "comment_id": 84398057, "body": "I don\u2019t know that this is The RIght Way, but if you\u2019ve got a sequence of operations that could fail due to a race condition, but it can be restarted if that happens, one elegant solution is to wrap them all in a function that restarts itself and tail-recurses if necessary until if it succeeds. If there\u2019s an unrecoverable error, treat it as an exception.  Or if you need multiple resources at once, but one could otherwise be claimed, that\u2019s what a mutex is for."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518157038, "post_id": 48699422, "comment_id": 84398132, "body": "@Davislor I kind of dig that idea of retrying, but it&#39;s rather grim and convoluted to write by hand every time, isn&#39;t it? And a mistake would be expensive, and testing next to impossible. There should be a library for such things?.. About mutexes, I don&#39;t know how to use them at all, short of using them in Haskell."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1518158067, "post_id": 48699422, "comment_id": 84398494, "body": "A next-best alternative might be a function that returns failure and cleans up if <i>any</i> operation fails, so it appears to the rest of the program like a single operation that either succeeds or fails, and it can choose to retry or not. There might or might not be a function in the API to perform several small operations at once, or to lock the resource you need. Check on a case-by-case basis?"}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1518162708, "post_id": 48699422, "comment_id": 84400435, "body": "@Kindaro: I don\u2019t have time right now, but I think you should look into exactly when <code>NoSuchThing</code> and <code>InappropriateType</code> are thrown, contribute appropriate docs back (it may be a platform difference, symlink thing, or docs mistake), and use them. Starting points: <a href=\"https://hackage.haskell.org/package/directory-1.3.2.0/docs/src/System-Directory.html#getDirectoryContents\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/directory-1.3.2.0/docs/src/&hellip;</a>, <a href=\"https://hackage.haskell.org/package/unix-2.7.2.1/docs/src/System.Posix.Directory.html#openDirStream\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/unix-2.7.2.1/docs/src/&hellip;</a>, <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Foreign-C-Error.html#v:throwErrno\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.10.1.0/docs/&hellip;</a>"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1518166878, "post_id": 48699422, "comment_id": 84402516, "body": "@Ryan It shall be done."}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1518171081, "post_id": 48700377, "comment_id": 84405126, "body": "Isn&#39;t the usual recommendation <i>not</i> to do checks before trying to do IO operations, precisely because the state could change between doing the check and doing the operations, and instead just try and catch the error (if any)?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1518189374, "post_id": 48700377, "comment_id": 84416476, "body": "Yes. However, this is a stack overflow question and I assume it&#39;s a simplified version of what they want.  Also checking (at some point) gives you helpful info for error messages to the user."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 5, "last_activity_date": 1518159861, "creation_date": 1518159861, "answer_id": 48700377, "question_id": 48699422, "link": "https://stackoverflow.com/questions/48699422/whats-the-right-way-of-performing-several-operations-on-a-filesystem-at-once/48700377#48700377", "title": "What&#39;s the right way of performing several operations on a filesystem at once?", "body": "<blockquote>\n  <p>But I wonder: what would happen if the node gets unlinked along the way, say just before the last \"do\" block?</p>\n</blockquote>\n\n<p>You'll get an exception, and that's no big deal in this context.  You are performing IO and can handle it.  I don't think you'll find a fail-proof platform agnostic solution.</p>\n\n<p>How about you make a useful wrapper monad to keep the code readable?  It might be more boilerplate than you like (in which case just wrap the whole function call with <code>catch</code>) but for larger portions of code can be quite nice:</p>\n\n<pre><code>data MyErr = CaughtException SomeException\n                             -- ^ You might want to just catch\n                             --   specific types of exceptions here\n          | MyErr String\n\ntype M = ExceptT MyErr IO\n\nmyErr :: String -&gt; M a\nmyErr = throwE . MyErr\n\nmyIO :: IO a -&gt; M a\nmyIO io = ExceptT (catch (Right &lt;$&gt; io) (pure . Left . CaughtException))\n</code></pre>\n\n<p>The <code>M</code> monad allows you to capture all the ugly exceptions along with your program logic and bundle it up into a single <code>Either</code> result.  You'd use it as such:</p>\n\n<pre><code>browseSimple :: FilePath -&gt; IO (Either MyErr [FilePath])\nbrowseSimple x = runExceptT $ do\n    isAvailable &lt;- myIO $ doesPathExist x\n    when (not isAvailable) (myErr $ \"File not found: \" ++ x)\n    isFile &lt;- myIO $ doesFileExist x\n    when isFile (myErr x)\n    isDirectory &lt;- myIO $ doesDirectoryExist x\n    when (not isDirectory) (myErr $ \"Unknown filesystem node: \" ++ x)\n    listing &lt;- myIO $ listDirectory x\n    return ((x &lt;/&gt;) &lt;$&gt; listing)\n</code></pre>\n\n<p>You could enhance things, such as provide <code>myIO</code> with more information so if/when things fail you can tie the result to where in your operation things took a nose dive but that's usually overkill.</p>\n\n<p>We could clean things up further with whenM (typed not tested):</p>\n\n<pre><code>whenM io m = myIO io &gt;&gt;= \\b -&gt; when b m\n\nbrowseSimple2 :: FilePath -&gt; IO (Either MyErr [FilePath])\nbrowseSimple2 x = runExceptT $ do\n    whenM (not &lt;$&gt; doesPathExist x)\n          (myErr $ \"File not found: \" ++ x)\n    whenM (doesFileExist x)\n          (myErr x)\n    whenM (not &lt;$&gt; doesDirectoryExist x)\n          (myErr $ \"Unknown filesystem node: \" ++ x)\n    myIO $ (x &lt;/&gt;) &lt;$&gt; listDirectory x\n</code></pre>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1518159861, "creation_date": 1518155019, "last_edit_date": 1518158581, "question_id": 48699422, "link": "https://stackoverflow.com/questions/48699422/whats-the-right-way-of-performing-several-operations-on-a-filesystem-at-once", "title": "What&#39;s the right way of performing several operations on a filesystem at once?", "body": "<p>Suppose I want to know whether a file exists, and if it's a directory, additionally retrieve its contents. I may go as follows:</p>\n\n<pre><code>browseSimple :: FilePath -&gt; IO (Either FilePath [FilePath])\nbrowseSimple x = do\n    isAvailable &lt;- doesPathExist x\n    if not isAvailable then error $ \"File not found: \" ++ x else do\n        isFile &lt;- doesFileExist x\n        if isFile then return $ Left x else do\n            isDirectory &lt;- doesDirectoryExist x\n            if not isDirectory then error $ \"Unknown filesystem node: \" ++ x else do\n                listing &lt;- listDirectory x\n                return $ Right ((x &lt;/&gt;) &lt;$&gt; listing)\n-- ^\n-- \u03bb browseSimple  \".\"\n-- Right [...\"./Filesystem.hs\"...]\n</code></pre>\n\n<p>-- And it kinda works. But I wonder: what would happen if the node gets unlinked along the way, say just before the last \"do\" block?</p>\n\n<p>I don't know C, but my guess is that all this iffiness would be replaced by 1 (one) POSIX system call: <code>opendir</code> will either let me read the directory contents or return a meaningful error I could pattern match against. That's only for POSIX-compliant systems, though.</p>\n\n<p>What is the correct, idiomatic, professional way of doing things like this in Haskell? Do I address it with the stuff from <code>System.Posix.Files</code>? What is the state of the art around this?</p>\n\n<hr>\n\n<p><strong>postscriptum</strong></p>\n\n<p>I could have just casted <code>listDirectory</code>, and pattern matched on the error (as per suggestion from @Ryan), but I am kind of suspicious because it can apparently say <code>NoSuchThing</code> in case of both <code>ENOENT</code> and <code>ENOTDIR</code>. The description is scarce, the behaviour is not spelled out, and I don't want to read any guarantees into it.</p>\n"}, {"tags": ["haskell", "esqueleto"], "answers": [{"tags": [], "owner": {"reputation": 4970, "user_id": 1726797, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a76b9e0b9a393201d9897082bf70bf07?s=128&d=identicon&r=PG", "display_name": "nnnmmm", "link": "https://stackoverflow.com/users/1726797/nnnmmm"}, "is_accepted": true, "score": 0, "last_activity_date": 1518171309, "creation_date": 1518171309, "answer_id": 48703514, "question_id": 48698940, "link": "https://stackoverflow.com/questions/48698940/how-do-i-filter-just-field-in-esqueleto/48703514#48703514", "title": "How do I filter Just field in Esqueleto?", "body": "<p>You tried to use the <code>(?.)</code> operator to get a non-<code>Maybe</code> Value from a <code>Maybe</code> field in a non-<code>Maybe</code> entity, but what it does is to get you a <code>Maybe</code> Value from a non-<code>Maybe</code> field in a <code>Maybe</code> entity. Here, your entity actually isn't <code>Maybe</code> because it isn't the result of an outer join.</p>\n\n<p>I don't think returning a <code>Value Text</code> is possible without unsafe functions, since filtering with <code>where_</code> doesn't change the type of the nullable field to be non-nullable. (There ought to be a projection operator that does what you want to do, in my opinion.)</p>\n\n<p>So you could do this</p>\n\n<pre><code>previews :: SqlPersistT Handler [(Value (Key Picture), Value (Maybe Text))]\npreviews = select $ from $ \\pics -&gt; do\n  where_ $ not_ . isNothing $ pics ^. PictureDesc\n  return ( pics ^. PictureId\n         , pics ^. PictureDesc\n         )\n</code></pre>\n\n<p>or remove the <code>Maybe</code>, using Control.Arrow's <code>second</code> and Data.Maybe's <code>fromJust</code>, although there might be a more elegant way:</p>\n\n<pre><code>previews' :: SqlPersistT Handler [(Value (Key Picture), Value Text)]\npreviews' = do\n  xs &lt;- select $ from $ \\pics -&gt; do\n    where_ $ not_ . isNothing $ pics ^. PictureDesc\n    return ( pics ^. PictureId\n           , (pics ^. PictureDesc)\n           )\n  return (map (second $ fmap fromJust) xs)\n</code></pre>\n\n<p>I haven't run this code, only compiled it.</p>\n"}], "owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 48703514, "answer_count": 1, "score": 1, "last_activity_date": 1518171309, "creation_date": 1518152009, "question_id": 48698940, "link": "https://stackoverflow.com/questions/48698940/how-do-i-filter-just-field-in-esqueleto", "title": "How do I filter Just field in Esqueleto?", "body": "<p>With the following Persistent schema,</p>\n\n<pre><code>Picture\n  bytes ByteString\n  desc Text Maybe\n</code></pre>\n\n<p>I want to query <code>SELECT id, desc FROM picture WHERE desc IS NOT NULL</code>. But</p>\n\n<pre><code>previews :: SqlPersistT Handler [(E.Value (Key Picture), E.Value Text)]\npreviews = E.select $ from $ \\pics -&gt; do\n  where_ $ pics ?. PictureDesc E.!=. nothing\n  return ( pics ^. PictureId\n         , pics ?. PictureDesc\n         )\n\n\u2022 Couldn't match type \u2018Maybe (Entity Picture)\u2019\n                 with \u2018Entity Picture\u2019\n  Expected type: SqlExpr (Entity Picture)\n    Actual type: SqlExpr (Maybe (Entity Picture))\n\u2022 In the first argument of \u2018(^.)\u2019, namely \u2018pics\u2019\n</code></pre>\n\n<p>How do I achieve the <code>previews</code>' signature?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 811, "user_id": 605690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b80f25d1101931a7a7b92d642647359d?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya Rezvov", "link": "https://stackoverflow.com/users/605690/ilya-rezvov"}, "edited": false, "score": 3, "creation_date": 1518134352, "post_id": 48696720, "comment_id": 84392266, "body": "You do not need last where expression. You already have x from pattern-matching pattern in function definition. all you need is call your function again in otherwise case"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 2, "creation_date": 1518134750, "post_id": 48696720, "comment_id": 84392391, "body": "Call <code>isElement 2 [1,2,3,4]</code> and imagine what happens (with a vague model of how evaluation happens in Haskell). line 3: <code>a=2, x=1, xs=[2,3,4]</code>. Line 4: <code>2==1</code> returns False so move on. Line 5: <code>otherwise</code> evaluates to True so we evaluate the expression to the right of the equals sign. Now <code>x=head [2,3,4]</code> so <code>x=2</code> (if you ever evaluate it) but you evaluate the expression <code>False</code> to get <code>False</code> and return that."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1518134961, "post_id": 48696720, "comment_id": 84392446, "body": "<code>isElement a (x:xs) = a == x || isElement a xs</code>"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 2, "creation_date": 1518143334, "post_id": 48696720, "comment_id": 84394445, "body": "Also, while you\u2019re doing this as an exercise, this already exists as <code>elem</code>."}], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 4, "last_activity_date": 1518139536, "creation_date": 1518139536, "answer_id": 48697398, "question_id": 48696720, "link": "https://stackoverflow.com/questions/48696720/checking-to-see-if-an-element-exists-in-a-list-in-haskell/48697398#48697398", "title": "Checking to see if an element exists in a list in Haskell", "body": "<p>There are a couple of issues. First off, your <code>where</code> block is not accomplishing anything. <code>x</code> is already known to be the head of the list because it's part of the <code>(x:xs)</code> construct, which destructures the list directly into the variables. So that line can be entirely removed. Second, there's no actual recursion here. You need to call <code>isElement</code> in the false case to check the rest of the list, rather than simply returning <code>False</code>.</p>\n\n<pre><code>isElement :: Eq a =&gt; a -&gt; [a] -&gt; Bool\nisElement a [] = False\nisElement a (x:xs)\n  | a == x = True\n  | otherwise = isElement a xs\n</code></pre>\n\n<p>Note that compiling your program with <code>-Wall</code> will give you warnings about a lot of things, including unused variables. In particular, the fact that, in your example (after removing the <code>where</code> block), <code>xs</code> was an unused variable should be a red flag and, in this case, gives us some insight into the problem: you never used the rest of the list, so the rest of the list gets ignored.</p>\n"}], "owner": {"reputation": 109, "user_id": 9036068, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z6aq3.jpg?s=128&g=1", "display_name": "wawaloo_17", "link": "https://stackoverflow.com/users/9036068/wawaloo-17"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4376, "favorite_count": 0, "accepted_answer_id": 48697398, "answer_count": 1, "score": 1, "last_activity_date": 1518139536, "creation_date": 1518134174, "last_edit_date": 1518138249, "question_id": 48696720, "link": "https://stackoverflow.com/questions/48696720/checking-to-see-if-an-element-exists-in-a-list-in-haskell", "title": "Checking to see if an element exists in a list in Haskell", "body": "<p>I'm trying to create a recursive function that checks to see whether or not \"a\" is in an array. I'm trying to take the head of the tail and compare it to \"a\". However, it doesn't return the correct boolean value every time because it only take the head of the tail once. how do i make this recursive?</p>\n\n<pre><code>isElement :: Eq a =&gt; a -&gt; [a] -&gt; Bool\nisElement a [] = False\nisElement a (x:xs)\n  | a == x = True\n  | otherwise = False\n  where x = head(xs)\n</code></pre>\n"}, {"tags": ["haskell", "haskell-turtle"], "comments": [{"owner": {"reputation": 7287, "user_id": 258848, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/2Ckug.jpg?s=128&g=1", "display_name": "dimsuz", "link": "https://stackoverflow.com/users/258848/dimsuz"}, "edited": false, "score": 0, "creation_date": 1518119994, "post_id": 48693720, "comment_id": 84386086, "body": "You could do <code>(lineToText &lt;$&gt; expectArg)</code> probably. See <a href=\"https://hackage.haskell.org/package/turtle-1.5.2/docs/Turtle-Line.html#v:lineToText\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/turtle-1.5.2/docs/&hellip;</a>"}, {"owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "reply_to_user": {"reputation": 7287, "user_id": 258848, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/2Ckug.jpg?s=128&g=1", "display_name": "dimsuz", "link": "https://stackoverflow.com/users/258848/dimsuz"}, "edited": false, "score": 0, "creation_date": 1518121207, "post_id": 48693720, "comment_id": 84386704, "body": "@dimsuz Thanks, I didn&#39;t see that documentation for <code>Line</code> before. The type checker is looking for <code>Shell Line</code> and not <code>Shell Text</code> though. There are functions that almost do what&#39;s required, but the argument for <code>expect</code> contains newlines and <code>textToLine</code> is Nothing if the text contains newlines."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1518123342, "post_id": 48693720, "comment_id": 84387752, "body": "A <code>Line</code> is a <code>Text</code> which is guaranteed to have no newlines. If you have <code>x :: Text</code> and <code>x</code> contains newlines then there is no value of type <code>Line</code> which represents the same string as <code>x</code>, by definition. You must split your text into a list of lines, using <a href=\"https://hackage.haskell.org/package/turtle-1.5.2/docs/Turtle-Line.html#v:textToLines\" rel=\"nofollow noreferrer\"><code>textToLines</code></a>"}, {"owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1518123678, "post_id": 48693720, "comment_id": 84387937, "body": "@user2407038 Indeed! But that causes another problem: <code>inproc</code> does not want a <code>Shell (NonEmpty Line)</code>. I have no idea what to do about this."}], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "edited": false, "score": 0, "creation_date": 1518146535, "post_id": 48696999, "comment_id": 84395219, "body": "This is a great answer, I&#39;ll check whether it works in a bit and (assuming it does) mark it accepted. Thank you so much for all the extra detail, I really appreciate it. &#39;...the lack of a sensible way of going from NonEmpty Line to Line (concatenating the elements or picking the first one, for instance, wouldn&#39;t help at all) was a signal that a change of approach was necessary.&#39;  Yes, exactly! I could tell there was something fundamentally wrong with my approach, but didn&#39;t know where to go next."}, {"owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "edited": false, "score": 0, "creation_date": 1518208389, "post_id": 48696999, "comment_id": 84426408, "body": "Everything in this answer works, including replacing the recursive algorithm with functions from <code>Data.Maybe</code> and using <code>Pattern Text</code> instead of just <code>Text</code> (I like this solution in particular). Thank you."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1518136486, "creation_date": 1518136486, "answer_id": 48696999, "question_id": 48693720, "link": "https://stackoverflow.com/questions/48693720/how-can-a-shell-text-be-converted-to-shell-line/48696999#48696999", "title": "How can a `Shell Text` be converted to `Shell Line`?", "body": "<p>While I can't try out your code right now, it seems roundtripping your commands through <code>Text</code> (as <code>T.unlines</code> forces you to) is causing unnecessary trouble. According <a href=\"https://hackage.haskell.org/package/turtle-1.5.2/docs/Turtle-Shell.html#t:Shell\" rel=\"noreferrer\">to the documentation</a> (emphasis mine):</p>\n\n<blockquote>\n  <p>A <code>(Shell a)</code> is a protected <em>stream</em> of <code>a</code>'s with side effects</p>\n</blockquote>\n\n<p>As a <code>Shell Line</code> is a stream, it can supply multiple <code>Line</code>s. And sure enough, there is a function called <a href=\"https://hackage.haskell.org/package/turtle-1.5.2/docs/Turtle-Shell.html#v:select\" rel=\"noreferrer\"><code>select</code></a>...</p>\n\n<blockquote>\n  <p><code>select :: Foldable f =&gt; f a -&gt; Shell a</code></p>\n</blockquote>\n\n<p>... which will convert a list (or any other <code>Foldable</code>) to a <code>Shell</code>. You can use it to get the <code>Shell Line</code> you need directly:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n-- etc.\n    let expectArg = do\n        ml &lt;- grep (contains (text str)) pwds\n        -- unsafeTextToLine is presumably safe here,\n        -- as ml was a Line to begin with.\n        let pass = unsafeTextToLine . getPwd $ cut tab (format l ml)\n        select [ \"&lt;&lt; EOF\"\n            , \"spawn ssh-add\"\n            , \"expect \\\"Enter passphrase\\\"\"\n            , \"send \" &lt;&gt; pass\n            , \"expect eof\"\n            , \"EOF\"\n            ]\n    view (inproc \"expect\" [] expectArg)\n</code></pre>\n\n<hr>\n\n<p>Side questions:</p>\n\n<blockquote>\n  <p>Not sure why <code>(text str)</code> is needed here, but it won't typecheck without it (despite OverloadedStrings).</p>\n</blockquote>\n\n<p>The only thing <code>OverloadedStrings</code> does automatically is handling string literals. It won't silently convert <code>Text</code> values to other instances of <code>IsString</code>. An alternative to using <code>text</code> would be changing your signature so that the type of <code>str</code> is <code>Pattern Text</code> rather than <code>Text</code>.</p>\n\n<blockquote>\n  <p>Safely get the third item <code>cut</code> from the list.</p>\n</blockquote>\n\n<p>Here is one way of writing <code>getPwd</code> without writing the recursive algorithm explicitly, using a few functions from <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Maybe.html\" rel=\"noreferrer\"><code>Data.Maybe</code></a>:</p>\n\n<pre><code>getPwd = fromMaybe \"\" . listToMaybe . drop 2\n</code></pre>\n\n<p>You might also like the <a href=\"https://hackage.haskell.org/package/safe-0.3.16/docs/Safe.html#v:atNote\" rel=\"noreferrer\"><code>atDef</code></a> from the <em>safe</em> package:</p>\n\n<pre><code>getPwd xs = atDef \"\" xs 2\n</code></pre>\n\n<blockquote>\n  <p>But that causes another problem: <code>inproc</code> does not want a <code>Shell (NonEmpty Line)</code>. I have no idea what to do about this.</p>\n</blockquote>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List-NonEmpty.html\" rel=\"noreferrer\"><code>NonEmpty</code></a> is a type for lists that are guaranteed to have at least one element. In your case, the lack of a sensible way of going from <code>NonEmpty Line</code> to <code>Line</code> (concatenating the elements or picking the first one, for instance, wouldn't help at all) was a signal that a change of approach was necessary.</p>\n"}], "owner": {"reputation": 147, "user_id": 4301448, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3f0f317c8f0211d406091f5b8353988b?s=128&d=identicon&r=PG&f=1", "display_name": "user4301448", "link": "https://stackoverflow.com/users/4301448/user4301448"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "accepted_answer_id": 48696999, "answer_count": 1, "score": 1, "last_activity_date": 1518136486, "creation_date": 1518119606, "question_id": 48693720, "link": "https://stackoverflow.com/questions/48693720/how-can-a-shell-text-be-converted-to-shell-line", "title": "How can a `Shell Text` be converted to `Shell Line`?", "body": "<p>In a Turtle script for getting passwords from a keyring, calling <code>ssh-add</code> with those passwords so they don't have to be filled out manually, is the following function:</p>\n\n<pre><code>processKey :: (T.Text, T.Text) -&gt; Shell Line -&gt; IO ()\nprocessKey (kn, str) pwds = do\n    -- Not sure why (text str) is needed here, but it won't typecheck without\n    -- it (despite OverloadedStrings).\n    let expectArg = do\n        ml &lt;- grep (contains (text str)) pwds\n        let pass = getPwd $ cut tab (format l ml)\n        return $ T.unlines [ \"&lt;&lt; EOF\"\n                  , \"spawn ssh-add\"\n                  , \"expect \\\"Enter passphrase\\\"\"\n                  , \"send \" &lt;&gt; pass\n                  , \"expect eof\"\n                  , \"EOF\"\n                  ]\n    view (inproc \"expect\" [] expectArg)\n    where\n       -- Safely get the third item `cut` from the list.\n       getPwd xs = getPwd' 0 xs\n       getPwd' _ []     = \"\"\n       getPwd' n (x:xs) = if n == 2\n                          then x\n                          else getPwd' (n+1) xs\n</code></pre>\n\n<p>This function takes a tuple of (SSH key file name, string to search for in the text stored in the keyring), and <code>pwds :: Shell Line</code> that is the entire contents of the keyring taken from a shell command.</p>\n\n<p>The purpose of the function is to <code>grep</code> the passwords, and call <code>ssh-add</code> with the key filename and password.</p>\n\n<p>The problem is this function doesn't type check:</p>\n\n<pre><code>sshkeys-autopass.hs:45:30: error:\n    \u2022 Couldn't match type \u2018Text\u2019 with \u2018Line\u2019\n      Expected type: Shell Line\n        Actual type: Shell Text\n    \u2022 In the third argument of \u2018inproc\u2019, namely \u2018expectArg\u2019\n      In the first argument of \u2018view\u2019, namely\n        \u2018(inproc \"expect\" [] expectArg)\u2019\n      In a stmt of a 'do' block: view (inproc \"expect\" [] expectArg)\n   |\n45 |     view (inproc \"expect\" [] expectArg)\n   |                              ^^^^^^^^^\n</code></pre>\n\n<p>It seems like <code>Shell Line</code> needs to become <code>Shell Text</code>, how can this be done, please? I am open to the possibility this is structured badly or is not idiomatic Haskell (it does smell), if so please advise how this function could be better.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1518117292, "post_id": 48692783, "comment_id": 84384612, "body": "How about you solve this in two steps - 1. Make a new list that is a tuple of the element, left neighbor, and right neighbor. 2. Filter that list for tuples where the middle elements is largest and project out the middle element."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1518117337, "post_id": 48692783, "comment_id": 84384644, "body": "Also, what happens with <code>[0,1]</code> do we get <code>[1]</code> or <code>[]</code> or something else?"}, {"owner": {"reputation": 11, "user_id": 9334915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b065207417ca9afc4fb12609cc55c0f?s=128&d=identicon&r=PG&f=1", "display_name": "dziulis", "link": "https://stackoverflow.com/users/9334915/dziulis"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1518117664, "post_id": 48692783, "comment_id": 84384824, "body": "for [0,1] it should return [1]"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518118390, "post_id": 48692783, "comment_id": 84385215, "body": "@dziulis: then shouldn&#39;t <code>[0,1,5,2,3,7,8,4]</code> result in <code>[5,8,4]</code>."}, {"owner": {"reputation": 11, "user_id": 9334915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b065207417ca9afc4fb12609cc55c0f?s=128&d=identicon&r=PG&f=1", "display_name": "dziulis", "link": "https://stackoverflow.com/users/9334915/dziulis"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518118487, "post_id": 48692783, "comment_id": 84385264, "body": "@WillemVanOnsem no, because 4 is smaller than 8"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1518169807, "post_id": 48692783, "comment_id": 84404263, "body": "Hint: look what <code>let (x:y:ls) = [0,1,5,2,3,7,8,4] in zip3 (x:y:ls) (y:ls) ls</code> gives in the command line."}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1518187216, "post_id": 48693709, "comment_id": 84415115, "body": "I think you meant to use <code>largest (x2 : x3 : xs)</code> in your example of the last case? A way to structure the code to avoid this issue is to phrase the last pattern as <code>x1 : xs@(x2 : x3 : _)</code> then recur with just <code>largest xs</code>."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1518200912, "post_id": 48693709, "comment_id": 84423003, "body": "@JonPurdy No, the idea there is that we need to add the first element if it is larger than the second, but in the recursive helper, we never add the first element <code>x1</code>. The recursive helper compares <code>x2</code> to both <code>x1</code> and <code>x3</code>, and never adds <code>x1</code>. So we call it on the <i>original</i> list."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1518200967, "post_id": 48693709, "comment_id": 84423029, "body": "@JonPurdy However, the <code>x1:@xs(x2:x3:_)</code> syntax works fine, and might be less error-prone. Good suggestion."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1518245944, "post_id": 48693709, "comment_id": 84435278, "body": "Ah, I see what you\u2019re getting at, that was my mistake."}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1518121085, "last_edit_date": 1518121085, "creation_date": 1518119562, "answer_id": 48693709, "question_id": 48692783, "link": "https://stackoverflow.com/questions/48692783/haskell-how-to-get-list-of-numbers-which-are-higher-then-their-neighbours-in-a/48693709#48693709", "title": "haskell: how to get list of numbers which are higher then their neighbours in a starting list", "body": "<p>One thing you might try is lookahead.  (Thomas M. DuBuisson suggested a different one that will also work if you handle the final one or two elements correctly.) Since it sounds like this is a problem you want to solve on your own as a learning exercise, I\u2019ll write a skeleton that you can take as a starting-point if you want:</p>\n\n<pre><code>largest :: [Integer] -&gt; [Integer]\nlargest [] = _\nlargest [x] = _ -- What should this return?\nlargest [x1,x2] | x1 &gt; x2   = _\n                | x1 &lt; x2   = _\n                | otherwise = _\nlargest [x1,x2,x3] | x2 &gt; x1 &amp;&amp; x2 &gt; x3 = _\n                   | x3 &gt; x2 = _\n                   | otherwise = _\nlargest (x1:x2:x3:xs) | x2 &gt; x1 &amp;&amp; x2 &gt; x3 = _\n                      | otherwise          = _\n</code></pre>\n\n<p>We need the special case of <code>[x1,x2,x3]</code> in addition to <code>(x1:x2:x3:[])</code> because, according to the clarification in your comment, <code>largest [3,3,2]</code> should return <code>[]</code>. but <code>largest [3,2]</code> should return <code>[3]</code>. Therefore, the final three elements require special handling and cannot simply recurse on the final two.</p>\n\n<p>If you also want the result to include the head of the list if it is greater than the second element, you\u2019d make this a helper function and your <code>largest</code> would be something like <code>largest (x1:x2:xs) = (if x1&gt;x2 then [x1] else []) ++ largest' (x1:x2:xs)</code>.  That is, you want some special handling for the first elements of the original list, which you don\u2019t want to apply to all the sublists when you recurse.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1518125734, "last_edit_date": 1518125734, "creation_date": 1518125287, "answer_id": 48695065, "question_id": 48692783, "link": "https://stackoverflow.com/questions/48692783/haskell-how-to-get-list-of-numbers-which-are-higher-then-their-neighbours-in-a/48695065#48695065", "title": "haskell: how to get list of numbers which are higher then their neighbours in a starting list", "body": "<p>I would solve this as outlined by Thomas M. DuBuisson. Since we want the ends of the list to \"count\", we'll add negative infinities to each end before creating triples. The <a href=\"https://hackage.haskell.org/package/monoid-extras-0.4.2/docs/Data-Monoid-Inf.html#t:NegInf\" rel=\"nofollow noreferrer\">monoid-extras</a> package provides a suitable type for this.</p>\n\n<pre><code>import Data.Monoid.Inf\n\npad :: [a] -&gt; [NegInf a]\npad xs = [negInfty] ++ map negFinite xs ++ [negInfty]\n\ntriples :: [a] -&gt; [(a, a, a)]\ntriples (x:rest@(y:z:_)) = (x,y,z) : triples rest\ntriples _ = []\n\nisBig :: Ord a =&gt; (a,a,a) -&gt; Bool\nisBig (x,y,z) = y &gt; x &amp;&amp; y &gt; z\n\nscnd :: (a, b, c) -&gt; b\nscnd (a, b, c) = b\n\nfinites :: [Inf p a] -&gt; [a]\nfinites xs = [x | Finite x &lt;- xs]\n\nlargest :: Ord a =&gt; [a] -&gt; [a]\nlargest = id\n    . finites\n    . map scnd\n    . filter isBig\n    . triples\n    . pad\n</code></pre>\n\n<p>It seems to be working appropriately; in ghci:</p>\n\n<pre><code>&gt; largest [0,1,5,2,3,7,8,4]\n[5,8]\n&gt; largest [10,1,10]\n[10,10]\n&gt; largest [3]\n[3]\n&gt; largest []\n[]\n</code></pre>\n\n<p>You might also consider merging <code>finites</code>, <code>map scnd</code>, and <code>filter isBig</code> in a single list comprehension (then eliminating the definitions of <code>finites</code>, <code>scnd</code>, and <code>isBig</code>):</p>\n\n<pre><code>largest :: Ord a =&gt; [a] -&gt; [a]\nlargest xs = [x | (a, b@(Finite x), c) &lt;- triples (pad xs), a &lt; b, c &lt; b]\n</code></pre>\n\n<p>But I like the decomposed version better; the <code>finites</code>, <code>scnd</code>, and <code>isBig</code> functions may turn out to be useful elsewhere in your development, especially if you plan to build a few variants of this for different needs.</p>\n"}, {"tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 0, "last_activity_date": 1518175063, "creation_date": 1518175063, "answer_id": 48704653, "question_id": 48692783, "link": "https://stackoverflow.com/questions/48692783/haskell-how-to-get-list-of-numbers-which-are-higher-then-their-neighbours-in-a/48704653#48704653", "title": "haskell: how to get list of numbers which are higher then their neighbours in a starting list", "body": "<p>As suggested in the comments, one approach would be to first group the list into tuples of length 3 using Preludes <a href=\"https://www.haskell.org/hoogle/?hoogle=zip3\" rel=\"nofollow noreferrer\"><code>zip3</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:tail\" rel=\"nofollow noreferrer\"><code>tail</code></a>:</p>\n\n<pre><code>*Main&gt; let xs = [0,1,5,2,3,7,8,4]\n*Main&gt; zip3 xs (tail xs) (tail (tail xs))\n[(0,1,5),(1,5,2),(5,2,3),(2,3,7),(3,7,8),(7,8,4)]\n</code></pre>\n\n<p>Which is of type: <code>[a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]</code> and <code>[a] -&gt; [a]</code> respectively. </p>\n\n<p>Next you need to find a way to filter out the tuples where the middle element is bigger than the first and last element. One way would be to use Preludes <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:filter\" rel=\"nofollow noreferrer\"><code>filter</code></a> function:</p>\n\n<pre><code>*Main&gt; let xs = [(0,1,5),(1,5,2),(5,2,3),(2,3,7),(3,7,8),(7,8,4)]\n*Main&gt; filter (\\(a, b, c) -&gt; b &gt; a &amp;&amp; b &gt; c) xs\n[(1,5,2),(7,8,4)]\n</code></pre>\n\n<p>Which is of type: <code>(a -&gt; Bool) -&gt; [a] -&gt; [a]</code>. This filters out elements of a list based on a Boolean returned from the predicate passed. </p>\n\n<p>Now for the final part, you need to extract the middle element from the filtered tuples above. You can do this easily with Preludes <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:map\" rel=\"nofollow noreferrer\"><code>map</code></a> function:</p>\n\n<pre><code>*Main&gt; let xs = [(1,5,2),(7,8,4)]\n*Main&gt; map (\\(_, x, _) -&gt; x) xs\n[5,8]\n</code></pre>\n\n<p>Which is of type: <code>(a -&gt; b) -&gt; [a] -&gt; [b]</code>. This function maps elements from a list of type <code>a</code> to <code>b</code>. </p>\n\n<p>The above code stitched together would look like this:</p>\n\n<pre><code>largest :: (Ord a) =&gt; [a] -&gt; [a]\nlargest xs = map (\\(_, x, _) -&gt; x) $ filter (\\(a, b, c) -&gt; b &gt; a &amp;&amp; b &gt; c) $ zip3 xs (tail xs) (tail (tail xs))\n</code></pre>\n\n<p>Note here I used typeclass <code>Ord</code>, since the above code needs to compare with <code>&gt;</code> and <code>&lt;</code>. It's fine to keep it as <code>Integer</code> here though. </p>\n"}], "owner": {"reputation": 11, "user_id": 9334915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b065207417ca9afc4fb12609cc55c0f?s=128&d=identicon&r=PG&f=1", "display_name": "dziulis", "link": "https://stackoverflow.com/users/9334915/dziulis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 609, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1518175063, "creation_date": 1518115877, "question_id": 48692783, "link": "https://stackoverflow.com/questions/48692783/haskell-how-to-get-list-of-numbers-which-are-higher-then-their-neighbours-in-a", "title": "haskell: how to get list of numbers which are higher then their neighbours in a starting list", "body": "<p>I am trying to learn Haskell and I want to solve one task. I have a list of Integers and I need to add them to another list if they are bigger then both of their neighbors. For Example:\nI have a starting list of [0,1,5,2,3,7,8,4] and I need to print out a list which is [5, 8]</p>\n\n<p>This is the code I came up but it returns an empty list:</p>\n\n<pre><code>largest :: [Integer]-&gt;[Integer]\nlargest n\n   | head n &gt; head (tail n) = head n : largest (tail n)\n   | otherwise = largest (tail n)\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1518116813, "last_edit_date": 1518116813, "creation_date": 1518115963, "answer_id": 48692803, "question_id": 48692501, "link": "https://stackoverflow.com/questions/48692501/importing-sub-packages-with-stack/48692803#48692803", "title": "Importing sub-packages with stack", "body": "<p><a href=\"https://www.stackage.org/haddock/lts-10.4/conduit-extra-1.2.3.2/Data-Conduit-Binary.html\" rel=\"nofollow noreferrer\"><code>Data.Conduit.Binary</code></a> is a <em>module</em>. It is part of a <em>package</em> called <a href=\"https://www.stackage.org/lts-10.4/package/conduit-extra-1.2.3.2\" rel=\"nofollow noreferrer\"><code>conduit-extra</code></a>. Packages are what Stack (and cabal-install, were you using that instead) installs, and what you should add to the <code>build-depends</code> of the .cabal file:</p>\n\n<pre><code>  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5,\n                       conduit,\n                       conduit-extra\n</code></pre>\n\n<p>As for <a href=\"https://www.stackage.org/haddock/lts-10.4/conduit-1.2.13/Data-Conduit-List.html\" rel=\"nofollow noreferrer\"><code>Data.Conduit.List</code></a>, it is part of the <code>conduit</code> package, so you don't need another entry for it. One quick way of clarifying such things is <a href=\"https://www.stackage.org/lts-10.4/hoogle?q=Data.Conduit.List\" rel=\"nofollow noreferrer\">doing a Hoogle search for the module</a> (the package it belongs to will be pointed out in the top bar of the documentation page).</p>\n\n<p>See also: <a href=\"https://stackoverflow.com/q/16997950/2751851\"><em>What's the difference between module, package and library in Haskell?</em></a>; <a href=\"https://stackoverflow.com/q/5480982/2751851\"><em>Packages, modules and import in Haskell</em></a>.</p>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 48692803, "answer_count": 1, "score": 0, "last_activity_date": 1518116813, "creation_date": 1518114775, "question_id": 48692501, "link": "https://stackoverflow.com/questions/48692501/importing-sub-packages-with-stack", "title": "Importing sub-packages with stack", "body": "<p>I don't understand how to import \"sub-packages\" in stack (if this is not the correct term, please let me know so I can edit).</p>\n\n<p>Here's the top of a simple file: </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Conduit where\n\nimport Data.Conduit\nimport qualified Data.Conduit.List as CL\nimport qualified Data.Conduit.Binary as CB\n</code></pre>\n\n<p>Two dependencies are listed.  In myproject.cabal, I have:</p>\n\n<pre><code>executable myproject\n  hs-source-dirs:      src\n  main-is:             Main.hs\n  default-language:    Haskell2010\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5,\n                       conduit\n</code></pre>\n\n<p><code>stack build -v</code> gives me this error:</p>\n\n<pre><code>2018-02-08 13:28:06.923836: [warn] 7 | import qualified Data.Conduit.Binary as CB\n</code></pre>\n\n<p>I am not sure what to include in the cabal executable directive, each of these throws errors:</p>\n\n<pre><code>  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5,\n                       conduit,\n                       conduit.list,\n                       conduit.binary\n\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5,\n                       conduit,\n                       conduit-list\n                       conduit-binary\n</code></pre>\n"}, {"tags": ["haskell", "continuation-passing", "higher-rank-types", "scott-encoding"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1518115987, "post_id": 48692480, "comment_id": 84383856, "body": "I think you want <code>id f x = f x</code>, not <code>id f x = x</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1518126067, "post_id": 48692480, "comment_id": 84389078, "body": "It&#39;s probably useful to define a helper <code>runReader&#39; = flip runReader id</code> to get rid of the continuation."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1518116195, "last_edit_date": 1518116195, "creation_date": 1518114732, "answer_id": 48692480, "question_id": 48692129, "link": "https://stackoverflow.com/questions/48692129/how-to-use-a-reader-type-encoded-with-continuation-passing-style/48692480#48692480", "title": "How to use a Reader type encoded with continuation passing style", "body": "<pre><code>reader f = Reader (\\k -&gt; k f) -- where is f's argument?\n</code></pre>\n\n<p>We don't have to pass a second argument now. This is very similar to the regular <code>data Reader e a = Reader (e-&gt;a)</code> and <code>reader f = Reader f</code> which do not involve a second argument.</p>\n\n<pre><code>runReader (reader id) -- what is the 2nd argument?\n</code></pre>\n\n<p>The general equation is</p>\n\n<pre><code>runReader (reader f) k = k f\n</code></pre>\n\n<p>so,</p>\n\n<pre><code>runReader (reader f) id x = id f x = f x\n</code></pre>\n\n<p>You can use <code>f = id</code> (which acts like <code>ask</code> in the real reader monad), but don't confuse it with the other <code>id</code> which is provided as a continuation <code>k</code>, and which recovers the original <code>f</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 48692480, "answer_count": 1, "score": 1, "last_activity_date": 1518116195, "creation_date": 1518113531, "question_id": 48692129, "link": "https://stackoverflow.com/questions/48692129/how-to-use-a-reader-type-encoded-with-continuation-passing-style", "title": "How to use a Reader type encoded with continuation passing style", "body": "<p>I was under the impression that every value of type <code>a</code> can be described with a rank-2 polymorphic type <code>newtype Id a = Id {runId :: forall r. (a -&gt; r) -&gt; r }</code> in continuation passing style. So I derived the following type to define the <code>Reader</code> accordingly:</p>\n\n<pre><code>newtype Reader e a = Reader {runReader :: forall r. ((e -&gt; a) -&gt; r) -&gt; r}\n</code></pre>\n\n<p>Then I tried to construct a value of this type and run it:</p>\n\n<pre><code>reader f = Reader (\\k -&gt; k f) -- where is f's argument?\nrunReader (reader id) -- what is the 2nd argument?\n</code></pre>\n\n<p>Provided that <code>Reader</code>'s encoding in CPS and its type are valid, how would I use it?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1518132320, "post_id": 48690442, "comment_id": 84391574, "body": "I would <i>really</i> recommend not to work on numbers whose decimal representation represents a binary pattern. Either work on lists of booleans (or of chars, if you must - i.e. the string that <code>showIntAtBase 2</code> returns) or just use the number directly as binary."}, {"owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1518186190, "post_id": 48690442, "comment_id": 84414455, "body": "I don&#39;t understand what you`re sayinh"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 2, "creation_date": 1518193043, "post_id": 48690442, "comment_id": 84418740, "body": "I&#39;m saying that using the value <code>100\u2081\u2080</code> (hundred) to represent <code>100\u2082</code> (four) is an absolutely horrible idea. Do not use that <code>toBin</code> function you posted."}], "owner": {"reputation": 149, "user_id": 9256626, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dcb1a0790421478fd071f2f34f3a7a53?s=128&d=identicon&r=PG&f=1", "display_name": "mathandtic", "link": "https://stackoverflow.com/users/9256626/mathandtic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1518338518, "creation_date": 1518107769, "last_edit_date": 1518338518, "question_id": 48690442, "link": "https://stackoverflow.com/questions/48690442/highest-number-of-continuous-zeros-in-haskell", "title": "Highest number of continuous zeros in Haskell", "body": "<p>In Haskell, I have this:</p>\n\n<pre><code>import Numeric\nimport Data.Char\nimport Data.List\n\n   toBin :: Integer -&gt; Integer\n   toBin n = read (showIntAtBase 2 intToDigit n \"\")\n\n    -- \u03bb&gt; toBin 558745840\n    -- 100001010011011100100011110000\n    -- (0.01 secs, 117,680 bytes)\n\n    digits :: Integer -&gt; [[Integer]]\n    digits n = group [read[d] | d &lt;- show n]\n\n    -- \u03bb&gt; digits (toBin 558745840)\n    -- [[1],[0,0,0,0],[1],[0],[1],[0,0],[1,1],[0],[1,1,1],[0,0],[1],[0,0,0],[1,1,1,1],[0,0,0,0]]\n    -- (0.01 secs, 288,624 bytes)\n</code></pre>\n\n<p>And, I have to generate a function that says the highest number of zeros in a row that has the binary number, but I don't know how to do it. In other words,</p>\n\n<pre><code>f :: Integer -&gt; Integer\nf 558745840 = 4\nf 2018 = 3\nf 529 = 4\n</code></pre>\n\n<p><code>f 558745840 = 4</code> because 1<strong>0000</strong>101001101110010001111<strong>0000</strong>, it has 4 (maximum number of) ceros in row.</p>\n\n<p>Could you help me please? Maybe the title of the question could be changed, bit I don't know to summary in a question, sorry.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1518106391, "post_id": 48688510, "comment_id": 84377968, "body": "I have deleted my answer (I didn&#39;t notice that you already had the <code>extra-deps</code> entry, and <code>git@</code> vs. <code>https:</code> for the GitHub link should make no difference, as you noted). It is a strange error indeed."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1518106479, "post_id": 48688510, "comment_id": 84378024, "body": "Please include all relevant code here, rather than just a link to the repo on github."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1518107151, "post_id": 48688510, "comment_id": 84378475, "body": "It appears to be a typo: you have <code>ifctx</code> rather than <code>ifcxt</code> in <code>package.yaml</code>/the <code>.cabal</code> file. (It&#39;s an easy typo to make: I did the same thing the first few times I tried hoogling it, and even so it took me a while to notice it in the files :))"}, {"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1518120746, "post_id": 48688510, "comment_id": 84386429, "body": "@duplode thank you! That thing was driving me nuts :)"}], "answers": [{"tags": [], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "is_accepted": false, "score": 2, "last_activity_date": 1518120856, "creation_date": 1518120856, "answer_id": 48694021, "question_id": 48688510, "link": "https://stackoverflow.com/questions/48688510/package-must-match-any-but-the-stack-configuration-has-no-specified-version/48694021#48694021", "title": "Package &quot;must match -any, but the stack configuration has no specified version&quot; on github dependency", "body": "<p>The correct answer was provided by @duplode in the comment.</p>\n\n<blockquote>\n  <p>It appears to be a typo: you have ifctx rather than ifcxt in package.yaml/the .cabal file. (It's an easy typo to make: I did the same thing the first few times I tried hoogling it, and even so it took me a while to notice it in the files :)) \u2013 duplode 3 hours ago</p>\n</blockquote>\n"}], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 699, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1518120856, "creation_date": 1518102109, "question_id": 48688510, "link": "https://stackoverflow.com/questions/48688510/package-must-match-any-but-the-stack-configuration-has-no-specified-version", "title": "Package &quot;must match -any, but the stack configuration has no specified version&quot; on github dependency", "body": "<p>Getting this error on my repository where I tried to use a dependency from GitHub:</p>\n\n<pre><code>$ stack build\n\nError: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for quickcheck-fail-0.1.0.0:\n    ifctx must match -any, but the stack configuration has no specified version\nneeded since quickcheck-fail is a build target.\n\nSome potential ways to resolve this:\n\n  * Set 'allow-newer: true' to ignore all version constraints and build anyway.\n\n  * You may also want to try using the 'stack solver' command.\n\nPlan construction failed.\n</code></pre>\n\n<p>I'm out of ideas what exactly is wrong here. Please see the repo to reproduce: <a href=\"https://github.com/k-bx/quickcheck-fail\" rel=\"nofollow noreferrer\">https://github.com/k-bx/quickcheck-fail</a></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 0, "creation_date": 1518101506, "post_id": 48688094, "comment_id": 84374402, "body": "That makes the function work (although readFile is in Data.Text.Lazy.IO) but then when I try to use it somewhere, it gives me <code>expected type: Html; actual type: IO Html</code>. How can I make it just Html, and not IO Html?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 2, "creation_date": 1518101737, "post_id": 48688094, "comment_id": 84374592, "body": "You can&#39;t. If you read an external file, that&#39;s an IO action, no way around it. (That&#39;s not strictly speaking true, there are ways around it, but these are unidiomatic hacks that you don&#39;t want to use.) The real question you could well ask is: \u201chow to <i>invoke</i> such an <code>IO</code> action to actually use the generated Html in my program?\u201d"}, {"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 0, "creation_date": 1518102016, "post_id": 48688094, "comment_id": 84374804, "body": "I just want to import the contents of my README.md so I don&#39;t have to copy and paste the contents into my haskell file. There&#39;s no way to import the contents of an external file? Does a website&#39;s contents always have to be in an .hs file for it to be displayed using Blaze?"}, {"owner": {"reputation": 7577, "user_id": 5638835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fba9e7db4baba416a82c4277758d886?s=128&d=identicon&r=PG&f=1", "display_name": "puhlen", "link": "https://stackoverflow.com/users/5638835/puhlen"}, "reply_to_user": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 1, "creation_date": 1518102112, "post_id": 48688094, "comment_id": 84374883, "body": "@Jono there are other ways to do this, read the file outside of this function, and pass the contents in as an argument to the function.  That way you don&#39;t need to do IO within the function."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 0, "creation_date": 1518102495, "post_id": 48688094, "comment_id": 84375131, "body": "@Jono it&#39;s possible to read in a file <i>at compile time</i> using Template Haskell, i.e. basically you let the compiler paste the contents into your <code>.hs</code> file. But, in fact I&#39;d argue it <i>is</i> best to write everything in <code>.hs</code> files yourself, this way you&#39;re not bound to the limitation of formats like Markdown."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 0, "creation_date": 1518102563, "post_id": 48688094, "comment_id": 84375173, "body": "@Jono The issue is that the <code>readme :: Html</code> type promises that this is a constant value, not depending on external files/user input/network/etc. If you want to read a file, you need a different type. Doing otherwise requires either including the file inside the source code (possibly using Template Haskell?) or using ugly fragile hacks to lie to the compiler (&quot;trust me, this is indeed a constant!&quot;). Such lying is greatly discouraged, since unless used with great care, it can cause real disasters. In almost all cases, it also not needed at all."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518123538, "post_id": 48688094, "comment_id": 84387855, "body": "If you want to take your <code>IO Html</code> as an argument to a pure function and have it return something else, like maybe <code>countWords :: Html -&gt; Int</code>, you\u2019d need to lift that function to one of type <code>:: IO Html -&gt; IO Int</code>.  <code>Control.Monad.LiftM</code> might help, so you could write <code>liftM countWords</code>, or you could write a wrapper that calls the pure function with <code>do</code> notation: <code>do page &lt;- iopage; return (countWords page)</code>"}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518123995, "post_id": 48688094, "comment_id": 84388101, "body": "But what you really want to do is bind the result to a variable inside <code>main</code>, using <code>&lt;-</code>, and then use it within that <code>do</code> block as though it were a pure variable.  That\u2019s a lot better than propagating <code>IO</code> through the program to everything it touches."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1518124194, "post_id": 48688094, "comment_id": 84388184, "body": "@Davislor perhaps you should make that an answer...?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1518101915, "last_edit_date": 1518101915, "creation_date": 1518100925, "answer_id": 48688094, "question_id": 48687921, "link": "https://stackoverflow.com/questions/48687921/how-can-i-read-a-file-to-a-string-in-haskell/48688094#48688094", "title": "How can I read a file to a string in Haskell?", "body": "<p>If you declare the type <code>readme :: Html</code>, it means that <code>readme</code> will be a <em>pure value</em>, i.e. a proper constant. This is thus guaranteed to be the same each time you run the program &ndash; nice guarantee, but this also means you can't make it dependent on an external file, which could after all change at any time.</p>\n\n<p>So what you want is probably this:</p>\n\n<pre><code>mkReadme :: IO Html\nmkReadme = do\n  readmeFile &lt;- readFile \"../README.md\"\n  return $ markdown def readmeFile\n</code></pre>\n\n<p>which works almost. Not quite because <code>readFile</code> generates an old-fashioned <code>String</code> while <code>markdown</code> wants the more efficient <code>Text</code> type. Easy to fix: just use the corresponding <code>readFile</code> function from the <code>text</code> library.</p>\n\n<pre><code>import qualified Data.Text.Lazy.IO as Txt\n\n...\n\nmkReadme :: IO Html\nmkReadme = do\n  readmeFile &lt;- Txt.readFile \"../README.md\"\n  return $ markdown def readmeFile\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1518187496, "post_id": 48699243, "comment_id": 84415310, "body": "Worth noting that the common pattern of <code>mkReadme &gt;&gt;= return . renderHtml</code> is usually written with <code>fmap</code>/<code>&lt;$&gt;</code>, i.e., <code>renderHtml &lt;$&gt; mkReadme</code>."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1518202250, "post_id": 48699243, "comment_id": 84423634, "body": "@JonPurdy Good point!  I was trying to do a direct line-by-line translation that used only <code>Monad</code> operations, because that\u2019s closer to what <code>do</code> notation represents, but you could use applicative style or the <code>Functor</code> instance of <code>IO</code> as well. I mean, <code>do</code> notation exists because writing with <code>Monads</code> is otherwise pretty clunky!"}], "tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 1, "last_activity_date": 1518155211, "last_edit_date": 1518155211, "creation_date": 1518154040, "answer_id": 48699243, "question_id": 48687921, "link": "https://stackoverflow.com/questions/48687921/how-can-i-read-a-file-to-a-string-in-haskell/48699243#48699243", "title": "How can I read a file to a string in Haskell?", "body": "<p>You\u2019ve already accepted an answer, but you asked a follow-up question in the comments, and leftroundabout, who knows a lot more about this site than me, suggested I make my reply an answer.</p>\n\n<p>You ask about how to use the result of <code>mkReadme</code>, which has type <code>IO Html</code>, in the program.  That threw me for a loop the first time I ran into the same problem, and that program ended up a real mess because of it.  Here\u2019s what I figured out.</p>\n\n<p>One way you can think about the <code>IO</code> monad\u2014not the details of how it works, but why it exists, and when you need it\u2014is that it wraps results that come from the outside world, and therefore need to be synchronized.  So <code>readFile</code> needs to read from the outside world, and its result is an <code>IO Text</code>, then <code>markdown</code> depends on that result and returns a <code>Html</code> parse tree, so that result depends on information from outside, and needs to be an <code>IO Html</code>.  Then whatever depends on that result ends up being <code>IO</code> something-or-other too, and the monad propagates through the entire program.</p>\n\n<p>So here\u2019s how you stop that from happening and keep it confined to <code>main</code>.  Here\u2019s a <code>main</code> routine we could add to leftroundabout\u2019s answer:</p>\n\n<pre><code>{- Needs: text, markdown -}\n\nimport qualified Data.Text.Lazy.IO as TIO\nimport Text.Blaze.Html (Html)\nimport Text.Blaze.Html.Renderer.Text (renderHtml)\nimport Text.Markdown (def, markdown)\n\nmkReadme :: IO Html\nmkReadme = do\n  readmeFile &lt;- TIO.readFile \"../README.md\"\n  return $ markdown def readmeFile\n\nmain :: IO ()\nmain = do\n  htmlVersion &lt;- mkReadme -- Type signature is :: IO Html\n  let plainText = renderHtml htmlVersion -- Type is :: Html -&gt; Text\n  TIO.putStrLn plainText -- Type signature is :: Text -&gt; IO ()\n</code></pre>\n\n<p>The first line of <code>main</code> binds an <code>IO Html</code> variable.  The second uses it in a pure function that accepts a <code>Html</code> and returns a <code>Text</code>, which is actually <em>lifted</em> to the <code>IO</code> monad between the lines thanks to the <code>do</code> notation.  The third passes the <code>Text</code> to a function that takes <code>Text</code> and returns <code>IO ()</code>.</p>\n\n<p>If you need to turn a pure function into a monadic one, use <code>Control.Monad.LiftM</code>, and if you need to wrap a pure variable as a monadic value, use <code>return</code>.</p>\n\n<p>If you want to know what the compiler is really doing, here\u2019s another way to write it:</p>\n\n<pre><code>main = mkReadme &gt;&gt;=\n       return . renderHtml &gt;&gt;=\n       TIO.putStrLn\n</code></pre>\n\n<p>Each <code>&gt;&gt;=</code> operator passes the output of the previous function, wrapped in an <code>IO</code> monad, to the next function in the chain.  The <code>return</code> wraps the output of a pure function in an <code>IO</code> monad so it can be bound.</p>\n\n<p>That program dumps the converted Markdown file as HTML to standard output.  Replace the last line with whatever you want to do with the <code>Html</code> value you get back from <code>Markdown</code>, and you can pretend it isn\u2019t <code>IO</code>.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1542, "favorite_count": 0, "accepted_answer_id": 48688094, "answer_count": 2, "score": 1, "last_activity_date": 1518155211, "creation_date": 1518100417, "question_id": 48687921, "link": "https://stackoverflow.com/questions/48687921/how-can-i-read-a-file-to-a-string-in-haskell", "title": "How can I read a file to a string in Haskell?", "body": "<p>I'm a Haskell beginner. I'm trying to use the <code>markdown</code> library to convert mardown and insert it into a web page made with Blaze. I can do this: </p>\n\n<pre><code>readme :: Html\nreadme = do\n  markdown def \"#test\"\n</code></pre>\n\n<p>Which works fine. But I can't do this: </p>\n\n<pre><code>readme :: Html\nreadme = do\n  readmeFile &lt;- readFile \"../README.md\"\n  markdown def readmeFile\n</code></pre>\n\n<p>Because I get the errors: </p>\n\n<pre><code>Views/Home.hs:55:17: error:\n    \u2022 Couldn't match type \u2018IO\u2019 with \u2018Text.Blaze.Internal.MarkupM\u2019\n      Expected type: Text.Blaze.Internal.MarkupM String\n        Actual type: IO String\n    \u2022 In a stmt of a 'do' block: readmeFile &lt;- readFile \"../README.md\"\n      In the expression:\n        do { readmeFile &lt;- readFile \"../README.md\";\n             markdown def readmeFile }\n      In an equation for \u2018readme\u2019:\n          readme\n            = do { readmeFile &lt;- readFile \"../README.md\";\n                   markdown def readmeFile }\n\nViews/Home.hs:56:16: error:\n    \u2022 Couldn't match type \u2018[Char]\u2019 with \u2018Data.Text.Internal.Lazy.Text\u2019\n      Expected type: Data.Text.Internal.Lazy.Text\n        Actual type: String\n    \u2022 In the second argument of \u2018markdown\u2019, namely \u2018readmeFile\u2019\n      In a stmt of a 'do' block: markdown def readmeFile\n      In the expression:\n        do { readmeFile &lt;- readFile \"../README.md\";\n             markdown def readmeFile }\n</code></pre>\n\n<p>I know there's something simple to fix this, but I don't know where to start. <a href=\"https://github.com/JonathanReeve/corpus-db/blob/9d64273a719b418a47e6d59835625d5325eae292/Views/Home.hs\" rel=\"nofollow noreferrer\">Here's the rest of my script</a>, if it helps to contextualize it. (It uses OverloadedStrings.)</p>\n"}, {"tags": ["function", "haskell", "position"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1518096230, "post_id": 48686527, "comment_id": 84370550, "body": "You can define a function that specifies one moment, and then use <code>scanl</code>."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 7021677, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1284149428276098/picture?type=large", "display_name": "Pinelopi Constantinou", "link": "https://stackoverflow.com/users/7021677/pinelopi-constantinou"}, "edited": false, "score": 0, "creation_date": 1518097099, "post_id": 48686635, "comment_id": 84371212, "body": "yes i do have a move function but when im trying to define the scanl i have the error &quot;  The type signature for \u2018scanl\u2019 lacks an accompanying binding       (The type signature must be given where \u2018scanl\u2019 is declared)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 25, "user_id": 7021677, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1284149428276098/picture?type=large", "display_name": "Pinelopi Constantinou", "link": "https://stackoverflow.com/users/7021677/pinelopi-constantinou"}, "edited": false, "score": 0, "creation_date": 1518097343, "post_id": 48686635, "comment_id": 84371407, "body": "@PinelopiConstantinou: you do not need to define <code>scanl</code>, <code>scanl</code> is a prelude function."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1518097344, "post_id": 48686635, "comment_id": 84371408, "body": "Why are you trying to define <code>scanl</code>? It&#39;s a library function."}, {"owner": {"reputation": 25, "user_id": 7021677, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1284149428276098/picture?type=large", "display_name": "Pinelopi Constantinou", "link": "https://stackoverflow.com/users/7021677/pinelopi-constantinou"}, "edited": false, "score": 0, "creation_date": 1518102898, "post_id": 48686635, "comment_id": 84375467, "body": "oh okay now i understand what is happening! thank you very much! :D"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1518097364, "last_edit_date": 1518097364, "creation_date": 1518096474, "answer_id": 48686635, "question_id": 48686527, "link": "https://stackoverflow.com/questions/48686527/haskell-recording-positions-function/48686635#48686635", "title": "haskell recording positions function", "body": "<p>Your code suggests that you thus already defined a function <code>move :: Step -&gt; Position -&gt; Position</code>, we can then use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:scanl\" rel=\"nofollow noreferrer\"><strong><code>scanl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]</code></strong></a>:</p>\n\n<pre><code>positions :: [Step] -&gt; Position -&gt; [Position]\npositions = flip (scanl (flip move))\n</code></pre>\n\n<p><code>scanl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]</code> takes thus as input a function (here <code>flip move</code>) that is given the initial accumulator (here a <code>Position</code>) and an element of the list (the list of moves), and calculates the updated accumulator. We then give it the initial accumulator and the list of positions.</p>\n\n<p>Since our <code>move :: Step -&gt; Position -&gt; Position</code> and <code>positions :: [Step] -&gt; Position -&gt; [Position]</code> function have flipped arguments (w.r.t. <code>scanl</code>), we both flip the <code>move</code> function, and the function that we constructed with <code>scanl (flip move)</code>.</p>\n"}], "owner": {"reputation": 25, "user_id": 7021677, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/1284149428276098/picture?type=large", "display_name": "Pinelopi Constantinou", "link": "https://stackoverflow.com/users/7021677/pinelopi-constantinou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518097364, "creation_date": 1518096175, "question_id": 48686527, "link": "https://stackoverflow.com/questions/48686527/haskell-recording-positions-function", "title": "haskell recording positions function", "body": "<p>im trying to write a function which will return  a list with all the positions from the starting point. For example if i write \n\"positions [L,R,L,L,U] (0,0)\" the out come must be \"[(0,0),(-1,0),(0,0),(-1,0),(-2,0),(-2,1)]\" . </p>\n\n<p>with the following function i only get the ending position. Can anyone help me?</p>\n\n<pre><code>type Position = (Int,Int)\ndata Step = L | R | U | D\n\ntype Route = [Step]\n\npositions :: Route -&gt; Position-&gt; [Position]\npositions [] p = p:[]\npositions (m:ms) p = positions ms (move m p)\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1518094919, "post_id": 48685397, "comment_id": 84369656, "body": "The definitions of <code>justify{Left&#47;Right}</code> are so simple that I would just copy them and change them slightly to work for strings."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 2, "last_activity_date": 1518092457, "creation_date": 1518092457, "answer_id": 48685397, "question_id": 48685257, "link": "https://stackoverflow.com/questions/48685257/pad-with-zeros-showhex-output/48685397#48685397", "title": "pad with zeros showHex output", "body": "<p>Nothing wrong with that. If you are doing it in more than one place then make it a separate function. If you want, you can use Data.Text, which has <a href=\"https://hackage.haskell.org/package/text-1.2.3.0/docs/Data-Text.html#g:10\" rel=\"nofollow noreferrer\">left and right justify</a>. However that would mean packing your String into Text first.</p>\n"}], "owner": {"reputation": 639, "user_id": 5715485, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6cb679baae60c79d57ea33ee91424a96?s=128&d=identicon&r=PG&f=1", "display_name": "limitless", "link": "https://stackoverflow.com/users/5715485/limitless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1518092457, "creation_date": 1518092060, "last_edit_date": 1518092093, "question_id": 48685257, "link": "https://stackoverflow.com/questions/48685257/pad-with-zeros-showhex-output", "title": "pad with zeros showHex output", "body": "<p>Is there a way to pad the output of <code>showHex</code> with zeros?\nfor example I want <code>showHex 11599274 \"\"</code> will output <code>00b0fdaa</code>.\nmy naive solution is:</p>\n\n<pre><code>take (8-l) ['0','0'..] ++ hex \n    where hex = showHex 11599274 \"\"\n          l = length hex\n</code></pre>\n\n<p>(I know I can do it with <code>printf \"%08x\" 5</code>)</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1518085976, "post_id": 48682283, "comment_id": 84363644, "body": "This is actually a fairly outdated user guide linked here."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518090302, "post_id": 48682584, "comment_id": 84366530, "body": "Can you also confirm that this sped up compilation? (By how much?)"}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1518092714, "post_id": 48682584, "comment_id": 84368154, "body": "@chi Kindly see edit!"}], "tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": true, "score": 6, "last_activity_date": 1518092465, "last_edit_date": 1518092465, "creation_date": 1518083980, "answer_id": 48682584, "question_id": 48682283, "link": "https://stackoverflow.com/questions/48682283/is-there-a-way-to-only-compile-haskell-source-to-interface-file-not-further/48682584#48682584", "title": "Is there a way to only compile Haskell source to interface file, not further?", "body": "<p>Actually, there is a flag <code>-fno-code -fwrite-interface</code> that does this. It actually cuts compilation time for even a simplistic example by about a quarter.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 1, "closed_date": 1518538070, "accepted_answer_id": 48682584, "answer_count": 1, "score": 6, "last_activity_date": 1518092465, "creation_date": 1518083215, "question_id": 48682283, "link": "https://stackoverflow.com/questions/48682283/is-there-a-way-to-only-compile-haskell-source-to-interface-file-not-further", "closed_reason": "Duplicate", "title": "Is there a way to only compile Haskell source to interface file, not further?", "body": "<p>Usually, when <code>ghc</code> is compiling a source code, it will produce at least an <code>.o</code> (object) and a <code>.hi</code> (interface) file.</p>\n\n<p>In the interest of diminishing compilation time, if I only need an interface file, can I somehow order <code>ghc</code> to abandon everything else and just give me said interface file? Or, otherwise, obtain that interface by any kind of lowly guile?</p>\n\n<p>I found <a href=\"https://downloads.haskell.org/~ghc/7.0.1/docs/html/users_guide/separate-compilation.html\" rel=\"noreferrer\">this <code>ghc</code> user guide part</a> and it says nothing of such. <a href=\"https://downloads.haskell.org/~ghc/7.0.1/docs/html/users_guide/options-phases.html\" rel=\"noreferrer\">This one</a> doesn't even mention \"<em>interface</em>\" anywhere in its text. (In particular, <code>-fno-code</code> doesn't generate it.) It must mean there's no easy way. In <a href=\"https://stackoverflow.com/q/14306934/2108477\">this question from five years ago</a>, nothing floated up, but by chance things are different now?</p>\n\n<p>Most likely, I expect it to take a hack to <code>ghc</code>. If so, I'd like directions:</p>\n\n<ul>\n<li>Is it reasonable to submit a feature request to <a href=\"https://ghc.haskell.org/trac/ghc\" rel=\"noreferrer\">trac</a>, or (likely) I should rather go for it myself? </li>\n<li>How is <code>.hi</code> file distinct from something like <code>-ddump-types</code>, just binary?</li>\n<li>Is there certainty that composing a <code>.hi</code> file takes strictly less compilation stages than a complete <code>.o</code> file? (For example, if there are hashes of machine code fragments within <code>.hi</code>, the corresponding code will probably have to be generated, which means nothing is to be gained here.)</li>\n</ul>\n\n<p>Otherwise, perhaps I can just extract related parts from <code>ghc</code> code so that I can then compile a <code>.hi</code> file from the output of <code>-ddump-types</code> or the like?</p>\n"}]