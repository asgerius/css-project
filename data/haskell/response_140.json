[{"tags": ["haskell", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 8099, "user_id": 2797476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcf9561473705b0e781edb4525bed2ac?s=128&d=identicon&r=PG", "display_name": "Christian Ternus", "link": "https://stackoverflow.com/users/2797476/christian-ternus"}, "is_accepted": false, "score": 1, "last_activity_date": 1505342772, "creation_date": 1505342772, "answer_id": 46207935, "question_id": 46207887, "link": "https://stackoverflow.com/questions/46207887/parse-error-possibly-incorrect-indentation-or-mismatched-brackets-for-haskell/46207935#46207935", "title": "parse error (possibly incorrect indentation or mismatched brackets) for Haskell", "body": "<p>You forgot to close the paren on this line:</p>\n\n<pre><code>rng &lt;- (randomRS (5 :: Int, 7 :: Int)\n</code></pre>\n\n<p>It should be:</p>\n\n<pre><code>rng &lt;- (randomRS (5 :: Int, 7 :: Int))\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 8566256, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3c79cd07c6ade981058759288c6abfcf?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/8566256/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 608, "favorite_count": 0, "closed_date": 1505355709, "answer_count": 1, "score": 0, "last_activity_date": 1505342772, "creation_date": 1505342553, "question_id": 46207887, "link": "https://stackoverflow.com/questions/46207887/parse-error-possibly-incorrect-indentation-or-mismatched-brackets-for-haskell", "closed_reason": "Not suitable for this site", "title": "parse error (possibly incorrect indentation or mismatched brackets) for Haskell", "body": "<p>I've been writing some code in haskell, and I just ran into the error above. I've looked on here for the answer, but couldn't find an answer that fixed my problem.</p>\n\n<pre><code>makeCtordecls :: RandomGen g =&gt; String -&gt; RandomState g [Ctordecl]\nmakeCtordecls tp = do\n  rng &lt;- (randomRS (5 :: Int, 7 :: Int)\n  let listOfCtordecl = replicateCountM rng (makeCtordecl (tp))\n  return listOfCtordecl\n\nreplicateCountM :: (Applicative m) =&gt; Int -&gt; (Int -&gt; m a) -&gt; m [a]\nreplicateCountM cnt0 f =\n    loop cnt0\n  where\n    loop cnt\n        | cnt &lt;= 0  = pure []\n        | otherwise = liftA2 (:) (f cnt) (loop (cnt - 1))\n</code></pre>\n\n<p>it is saying it is failing to parse at \"let listOfCtordecl....\"</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1505340421, "post_id": 46207513, "comment_id": 79378408, "body": "What does that function do exactly? I can&#39;t tell from that example alone."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1505341072, "post_id": 46207513, "comment_id": 79378648, "body": "seems like <code>groupIncDec</code> could wrap a pair of co-recursive <code>([[a]], [a]) -&gt; ([[a]], [a])</code> functions, which call themselves while <code>x</code> is going in the same direction, call each other when <code>x</code> goes in the opposite direction, and base cases out when <code>xs</code> is <code>[]</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1505341818, "post_id": 46207513, "comment_id": 79378873, "body": "You cannot use <code>groupBy</code> because it doesn&#39;t have memory, it can only look at two adjacent elements at a time."}], "answers": [{"tags": [], "owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "is_accepted": false, "score": 2, "last_activity_date": 1505350006, "creation_date": 1505350006, "answer_id": 46208843, "question_id": 46207513, "link": "https://stackoverflow.com/questions/46207513/haskell-higher-order-function-to-use-to-group-an-increasing-decreasing-list/46208843#46208843", "title": "Haskell: Higher Order function to use to group an increasing decreasing list", "body": "<p><code>groupBy</code> is meant to group by <strong>equality</strong>, not a general binary relation. For example:</p>\n\n<pre><code>Prelude Data.List&gt; groupBy (&lt;) [1,3,2]\n[[1,3,2]]\n</code></pre>\n\n<p>it is a span of first element <code>1</code> (as <code>1&lt;3</code>, <code>1&lt;2</code>).</p>\n\n<hr>\n\n<p>I came up with a solution of <code>foldl</code>, but this is not a very clean solution.</p>\n\n<pre><code>groupIncDec :: Ord a =&gt; [a] -&gt; [[a]]\ngroupIncDec = map reverse . reverse . foldl f []\n  where f []                 x = [[x]]\n        f ([y]:ys)           x = [x,y]:ys\n        f (ys@(y1:y2:_):yss) x = if x &lt; y1 &amp;&amp; y1 &lt; y2 || x &gt; y1 &amp;&amp; y1 &gt; y2\n                                 then (x:ys):yss\n                                 else [x]:ys:yss\n</code></pre>\n\n<p><code>f</code> is of type <code>[[a]] -&gt; a -&gt; [[a]]</code>, i.e. the accumulation part.</p>\n\n<p>Because Haskell List is good at dealing the head element (with help of <code>:</code>), so the results are stored backward. Thus <code>map reverse . reverse</code> is needed.</p>\n\n<hr>\n\n<ol>\n<li><a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:groupBy\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:groupBy</a></li>\n<li><a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:foldl\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-List.html#v:foldl</a></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1505360389, "creation_date": 1505360389, "answer_id": 46210141, "question_id": 46207513, "link": "https://stackoverflow.com/questions/46207513/haskell-higher-order-function-to-use-to-group-an-increasing-decreasing-list/46210141#46210141", "title": "Haskell: Higher Order function to use to group an increasing decreasing list", "body": "<p>Here's another approach.  For the moment, let's assume that the list has no adjacent equal elements, like your example.  If the list <code>lst</code> is compared with its own tail, element-by-element:</p>\n\n<pre><code>&gt; let lst = [1,2,31,23,22,1,43]\n&gt; let dir = zipWith compare lst (tail lst)\n&gt; dir\n[LT,LT,GT,GT,GT,LT]\n</code></pre>\n\n<p>then <code>dir</code> represents whether adjacent elements are increasing or decreasing.  If we were to repeat the head of this list:</p>\n\n<pre><code>&gt; let dir' = head dir : dir\n&gt; dir'\n[LT,LT,LT,GT,GT,GT,LT]\n</code></pre>\n\n<p>then <code>dir'</code> corresponds to how the list <code>[1,2,31,23,22,1,43]</code> should be grouped.  By zipping <code>dir'</code> with <code>lst</code> and grouping by the <code>dir'</code> elements, we get:</p>\n\n<pre><code>&gt; import Data.Function  -- for `on`\n&gt; let groups = groupBy ((==) `on` fst) (zip dir' lst)\n&gt; groups \n[[(LT,1),(LT,2),(LT,31)],[(GT,23),(GT,22),(GT,1)],[(LT,43)]]\n</code></pre>\n\n<p>which we can filter to:</p>\n\n<pre><code>&gt; map (map snd) groups\n[[1,2,31],[23,22,1],[43]]\n</code></pre>\n\n<p>So, putting this all together, we get a higher-order solution:</p>\n\n<pre><code>groupIncDec' :: Ord a =&gt; [a] -&gt; [[a]]\ngroupIncDec' lst =\n  let dir = zipWith compare lst (tail lst)\n  in  map (map snd)\n      $ groupBy ((==) `on` fst)\n      $ zip (head dir : dir) lst\n</code></pre>\n\n<p>This doesn't work properly on lists with adjacent duplicate elements, but we can take such a list:</p>\n\n<pre><code>lst' = [1,2,31,31,23,22,22,1,43]\n</code></pre>\n\n<p>and group it:</p>\n\n<pre><code>group lst' = [[1],[2],[31,31],[23],[22,22],[1],[43]]\n</code></pre>\n\n<p>and then effectively apply the above algorithm before \"ungrouping\" it again to get the final result.  That looks like this:</p>\n\n<pre><code>groupIncDec :: Ord a =&gt; [a] -&gt; [[a]]\ngroupIncDec xs =\n  let ys = group xs\n      dir = zipWith (comparing head) ys (tail ys)\n  in  map (concatMap snd)\n      $ groupBy ((==) `on` fst)\n      $ zip (head dir : dir) ys\n</code></pre>\n\n<p>which works like so:</p>\n\n<pre><code>&gt; groupIncDec [1,2,31,23,22,1,43]\n[[1,2,31],[23,22,1],[43]]\n&gt; groupIncDec [1,2,31,31,23,22,22,1,43]\n[[1,2,31,31],[23,22,22,1],[43]]\n</code></pre>\n"}], "owner": {"reputation": 1247, "user_id": 3169543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7416c0dca5630ff1c31b955e185e955b?s=128&d=identicon&r=PG&f=1", "display_name": "user3169543", "link": "https://stackoverflow.com/users/3169543/user3169543"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "accepted_answer_id": 46210141, "answer_count": 2, "score": 1, "last_activity_date": 1505360389, "creation_date": 1505340297, "last_edit_date": 1505340811, "question_id": 46207513, "link": "https://stackoverflow.com/questions/46207513/haskell-higher-order-function-to-use-to-group-an-increasing-decreasing-list", "title": "Haskell: Higher Order function to use to group an increasing decreasing list", "body": "<p>Given a list <code>[1,2,31,23,22,1,43]</code> Would like to use a higher order function to group elements <code>[[1,2,31], [23,22,1], [43]]</code> . increasing / decreasing list, where the elements initially the elements are in increasing order and then in decreasing order. </p>\n\n<pre><code>groupIncDec :: Ord a =&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>Each element in the output list <code>[[a]]</code> should be either all increasing or all decreasing, like in the example above, first element <code>[1,2,31]</code> is all increasing, second <code>[23,22,1]</code> all decreasing and because the there is a single element left and the previous state was all decreasing, <code>[43]</code> can be classified as all increasing.</p>\n\n<p>Could not figure out if/how to use <code>groupBy</code> . Any hints would be appreciated. </p>\n\n<p>Thanks.</p>\n\n<p>[Edit: added some more description, which will hopefully clarify the question further.]</p>\n"}, {"tags": ["haskell", "ghc", "type-families", "associated-types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1505407101, "post_id": 46206079, "comment_id": 79411715, "body": "Data families <i>must</i> not be overlapping. Type safety no longer holds otherwise... Interesting idea though."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1505407461, "post_id": 46206079, "comment_id": 79411951, "body": "Why so? Are there situations in which overlaps with associated types are unsafe where overlapping methods alone are still safe? I.o.w. when are overlapping type families &#39;more unsafe&#39; than overlapping type classes?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1505408511, "post_id": 46206079, "comment_id": 79412617, "body": "Overlapping associated <i>type</i> families are fine, just not <i>data</i> families. Polymorphism breaks down with overlapping data families. <a href=\"https://gist.github.com/harpocrates/8e9c5d693f312e39fff4c7ae1df09f41\" rel=\"nofollow noreferrer\">Here&#39;s a sketch.</a>"}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1505413227, "post_id": 46206079, "comment_id": 79415252, "body": "(Continuing discussion in that gist)"}], "answers": [{"tags": [], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "is_accepted": true, "score": 2, "last_activity_date": 1505334715, "last_edit_date": 1505334715, "creation_date": 1505334124, "answer_id": 46206226, "question_id": 46206079, "link": "https://stackoverflow.com/questions/46206079/associated-data-families-and-overlapping-instances/46206226#46206226", "title": "Associated data families and overlapping instances", "body": "<p>One solution that relinquishes overlapping instances is to use a default associated injective type family (quite a mouthful). I also attached some methods with default implementations for the default <code>MMap</code> synonym:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures      #-}\n{-# LANGUAGE TypeFamilies           #-}\n{-# LANGUAGE TypeFamilyDependencies #-}\n\nmodule MapKey where\n\nimport           Data.Map.Strict    (Map)\nimport qualified Data.Map.Strict    as Map\n\nclass MapKey k where\n  type MMap k v = r | r -&gt; k v\n  type MMap k v = Map k v\n  empty :: MMap k v\n  default empty :: (MMap k v ~ Map k v) =&gt; MMap k v\n  empty = Map.empty\n  insert :: k -&gt; v -&gt; MMap k v -&gt; MMap k v\n  default insert :: (MMap k v ~ Map k v, Ord k) =&gt; k -&gt; v -&gt; MMap k v -&gt; MMap k v\n  insert = Map.insert\n  lookupLE :: k -&gt; MMap k v -&gt; [(k, v)]\n  default lookupLE :: (MMap k v ~ Map k v, Ord k) =&gt; k -&gt; MMap k v -&gt; [(k, v)]\n  lookupLE k m =\n    case Map.lookupLE k m of\n      Nothing -&gt; []\n      Just e -&gt; [e]\n\ninstance MapKey () where\n  type MMap () v = Maybe v\n  empty = Nothing\n  insert _ v _ = Just v\n  lookupLE _ m =\n    case m of\n      Nothing  -&gt; []\n      (Just v) -&gt; [((), v)]\n</code></pre>\n\n<p>This means that client code still has to define boilerplate orphan instances like</p>\n\n<pre><code>instance MapKey Int\n</code></pre>\n\n<p>I'd rather see a solution that uses overlapping instances instead.</p>\n"}], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 46206226, "answer_count": 1, "score": 3, "last_activity_date": 1505334715, "creation_date": 1505333489, "question_id": 46206079, "link": "https://stackoverflow.com/questions/46206079/associated-data-families-and-overlapping-instances", "title": "Associated data families and overlapping instances", "body": "<p>I'd like a 'generic' map data structure that can be efficiently specialized by providing custom instances, much like in <a href=\"http://ghc.readthedocs.io/en/latest/glasgow_exts.html#type-families\" rel=\"nofollow noreferrer\">the GHC manual section on type families</a>.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances    #-}\n{-# LANGUAGE TypeFamilies         #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nmodule MapKey where\n\nimport           Data.Map.Strict    (Map)\nimport qualified Data.Map.Strict    as Map\n\nclass MapKey k where\n  data MMap k :: * -&gt; *\n\ninstance {-# OVERLAPPING #-} MapKey () where\n  newtype MMap () v = UnitMap (Maybe v)\n\ninstance {-# OVERLAPPABLE #-} Ord k =&gt; MapKey k where\n  newtype MMap k v = OrdMap (Map k v)\n</code></pre>\n\n<p>Sadly, this doesn't work. GHC (8.2.1) complains:</p>\n\n<pre><code>    Conflicting family instance declarations:\n      MMap () = UnitMap (Maybe v)\n      MMap = OrdMap (Map k v)\n   |\n14 |   newtype MMap () v = UnitMap (Maybe v)\n   |\n</code></pre>\n\n<p>Is there some language extension which allows this?\nOtherwise is there another way to make it easy for users to define a 'default' instance for <code>Ord</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14830, "user_id": 3757232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/kLzML.jpg?s=128&g=1", "display_name": "Jared Smith", "link": "https://stackoverflow.com/users/3757232/jared-smith"}, "edited": false, "score": 0, "creation_date": 1505325128, "post_id": 46203879, "comment_id": 79370900, "body": "co is a function that takes a function from b-&gt;c and returns a function that takes a function from a-&gt;b and returns a function that takes an a and returns a c. Meaning that you can define any function that matches that type signature."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 11, "creation_date": 1505325932, "post_id": 46203879, "comment_id": 79371349, "body": "No, it doesn&#39;t compile. See also <a href=\"https://stackoverflow.com/q/940382/791604\">difference between . and $</a>."}], "answers": [{"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1505417161, "post_id": 46205856, "comment_id": 79417329, "body": "Thanks a lot. I figured that I could do with studying types and typeclasses again, just to make sure I get the routine in. Thanks for answering this. Appreciate the help!"}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1505585789, "post_id": 46205856, "comment_id": 79477541, "body": "Following your answer I distilled the following and it typechecks!!! co :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c  co = a where       b = a       c = b       a = a"}, {"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "reply_to_user": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1505676669, "post_id": 46205856, "comment_id": 79498681, "body": "@Madderote While that will typecheck, It won&#39;t evaluate to anything because you have defined <code>a</code> to be equal to itself and <code>co</code> to be equal to <code>a</code>. <code>a</code> being equal to itself means you have formed an infinite loop (or possibly an exception explaining it otherwise would be an infinite loop)."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 3, "last_activity_date": 1505332561, "creation_date": 1505332561, "answer_id": 46205856, "question_id": 46203879, "link": "https://stackoverflow.com/questions/46203879/haskell-first-principles-get-function-with-type-declaration-dont-understand-an/46205856#46205856", "title": "Haskell first principles get function with type declaration, don&#39;t understand answer on GitHub", "body": "<blockquote>\n  <p>Yes it compiles but</p>\n</blockquote>\n\n<p>It doesn't compile because it is not type correct:</p>\n\n<pre><code>/tmp/so.hs:2:6: error:\n    \u2022 Couldn't match type \u2018c\u2019 with \u2018a -&gt; c\u2019\n      \u2018c\u2019 is a rigid type variable bound by\n        the type signature for:\n          co :: forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n        at /tmp/so.hs:1:1-36\n      Expected type: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n        Actual type: ((a -&gt; b) -&gt; a -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n    \u2022 In the expression: ($)\n      In an equation for \u2018co\u2019: co = ($)\n    \u2022 Relevant bindings include\n        co :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c (bound at /tmp/so.hs:2:1)\n  |\n2 | co = ($)\n</code></pre>\n\n<p>Informally, <code>co</code>'s first argument is a function that transforms values of type <code>b</code> to values of type <code>c</code>.  The second is a function that transforms values of type <code>a</code> to values of type <code>b</code>.  The final argument is a value of type <code>a</code>.  From here it is apparent you can apply the second argument to the third, obtaining a <code>b</code> and then apply the first argument, obtaining a value of type <code>c</code>.</p>\n\n<p>So long as you understand the syntax of function application things should be apparent from here.</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 46205856, "answer_count": 1, "score": 0, "last_activity_date": 1505332561, "creation_date": 1505324871, "last_edit_date": 1505325266, "question_id": 46203879, "link": "https://stackoverflow.com/questions/46203879/haskell-first-principles-get-function-with-type-declaration-dont-understand-an", "title": "Haskell first principles get function with type declaration, don&#39;t understand answer on GitHub", "body": "<p>Studying Haskell. Like it. Like the book, but stuck on types, typeclasses.\ngiven type declaration</p>\n\n<pre><code>co :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\nco = undefined  -- (obviously)\n</code></pre>\n\n<p>Question in book: Design function (answer on GitHub)</p>\n\n<pre><code>co = ($)\n</code></pre>\n\n<p>Yes it compiles but</p>\n\n<p>1) Why?</p>\n\n<p>2) What does this function do and why does it typecheck as it does. Just want to understand rather than just remember. </p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 0, "creation_date": 1505322274, "post_id": 46203173, "comment_id": 79369283, "body": "<code>String</code> is an alias for <code>[Char]</code>. You can concatenate with a separator via <code>intercalate &quot;,&quot; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</code> to get <code>&quot;a,b,c&quot;</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1505322574, "post_id": 46203173, "comment_id": 79369470, "body": "<code>type String = [Char]</code>, so <code>String</code> is an alias of <code>[Char]</code>. This thus means that <code>[[Char]]</code> is equal to <code>[String]</code>."}, {"owner": {"reputation": 37, "user_id": 8566256, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3c79cd07c6ade981058759288c6abfcf?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/8566256/hawkeye"}, "edited": false, "score": 0, "creation_date": 1505322889, "post_id": 46203173, "comment_id": 79369625, "body": "@everyone I&#39;ve update my question, so hopefully its more thorough. My apologies."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1505322976, "post_id": 46203173, "comment_id": 79369676, "body": "Please do not use <code>return</code>. It does not do what you think it does, it is a monadic function."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1505323059, "post_id": 46203173, "comment_id": 79369719, "body": "@hawkeye: It is not clear what your <code>concatenateList</code> is supposed to do. What is <code>InformationList</code>?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1505323475, "post_id": 46203173, "comment_id": 79369929, "body": "How do you want to produce a string out of the <code>InformationList</code>? How do you want to represent such <code>(String, [String])</code> instance?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1505328117, "post_id": 46203173, "comment_id": 79372603, "body": "Never use <code>do</code> and <code>return</code> if you are not working inside a monad. Never use <code>[x]</code> as a list variable: <code>let [x] = exp</code> roughly means &quot;please crash my program if <code>exp</code> is a list whose length differs from 1; otherwise define <code>x</code> to be the single element in the list&quot;. This is not what you want."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1505326809, "post_id": 46203357, "comment_id": 79371858, "body": "Might be worth mentioning <code>unwords :: [String] -&gt; String</code> which basically does what <code>intercalate &quot; &quot;</code> does, but with a more specialized signature and directly from the Prelude."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1505322896, "creation_date": 1505322896, "answer_id": 46203357, "question_id": 46203173, "link": "https://stackoverflow.com/questions/46203173/is-there-a-way-to-map-a-function-that-will-read-a-list-of-strings-and-concatenat/46203357#46203357", "title": "Is there a way to map a function that will read a list of strings and concatenate them into one big string?", "body": "<p>A <code>String</code> is a <strong>list of <code>Char</code>s</strong>. A <code>String</code> is a type alias defined as:</p>\n\n<pre><code>type String = [Char]\n</code></pre>\n\n<p>If you want to concatenate a list of <code>String</code>s without any separators, you can use <strong><code>concat :: Foldable t =&gt; t [a] -&gt; [a]</code></strong>:</p>\n\n<pre><code>Prelude&gt; concat [\"foo\", \"bar\", \"qux\"]\n\"foobarqux\"\n</code></pre>\n\n<p>In case you want to insert a <strong>string</strong> as delimiter, you can use <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-List.html#v:intercalate\" rel=\"nofollow noreferrer\"><strong><code>intercalate :: [a] -&gt; [[a]] -&gt; [a]</code></strong></a>:</p>\n\n<pre><code>Prelude&gt; import Data.List(intercalate)\nPrelude Data.List&gt; intercalate \",\" [\"foo\",\"bar\",\"qux\"]\n\"foo,bar,qux\"\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 8566256, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3c79cd07c6ade981058759288c6abfcf?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/8566256/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505323065, "creation_date": 1505322125, "last_edit_date": 1505323065, "question_id": 46203173, "link": "https://stackoverflow.com/questions/46203173/is-there-a-way-to-map-a-function-that-will-read-a-list-of-strings-and-concatenat", "title": "Is there a way to map a function that will read a list of strings and concatenate them into one big string?", "body": "<p>Can I get a quick explanation on how I would concatenate a list of strings into one string using map? I was trying to use intercalate but I realized that this is used to combine lists and not strings. i.e. [[char]] instead of [String]</p>\n\n<pre><code>type InformationList = (String , [String] )\n\nconcatenateList :: String -&gt; [InformationList] -&gt; String\nconcatenateList n cs = do\n  let [informationlist] =  intercalate \" \" cs\n  let toWrite = n ++ [informationList]\n  return toWrite\n</code></pre>\n\n<p>I updated this so that you can see the code I've been working with. It is saying that [[char]] is not the same as [informationlist] but that should be the same as [String]</p>\n"}, {"tags": ["haskell", "ghc", "type-families", "partial-application", "type-synonyms"], "answers": [{"comments": [{"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1505325438, "post_id": 46203962, "comment_id": 79371083, "body": "Thanks! So I&#39;m stuck with specializing <code>MapReturnType</code> to <code>MkT</code>, aren&#39;t I?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1505346843, "last_edit_date": 1505346843, "creation_date": 1505325203, "answer_id": 46203962, "question_id": 46203009, "link": "https://stackoverflow.com/questions/46203009/partial-application-of-type-synonyms/46203962#46203962", "title": "Partial application of type synonyms", "body": "<p><code>LiberalTypeSynonyms</code> works by inlining all \u201cobvious\u201d type definitions. To make your example work, it would have to</p>\n\n<ol>\n<li>Treat <code>MapReturnType (MkT (CollectArgTypes t)) t</code> first as some <code>MapReturnType \u310a t</code></li>\n<li>Inline this to <code>\u310a t</code>, using the definition <code>MapReturnType f r = f r</code></li>\n<li>At this point, invoking <code>\u310a</code> again would give <code>MkT (CollectArgTypes t) t</code> which is a perfectly fine fully-applied synonym and hence no problem.</li>\n</ol>\n\n<p>But step 2 isn't possible, because <code>MapReturnType</code> is <em>not</em> just a synonym. To use <code>MapReturnType f r = f r</code>, the compiler would first have to be sure that <code>r</code> isn't a function type, but it really can't know this \u2013 it's after all a completely free parameter.</p>\n\n<p>So what the compiler would actually need to do there is, defer the resolution of <code>MapReturnType</code> and thus also of <code>BuryT</code> to concrete use sites. Now, that might be quite useful, but it would open up quite a can of worms. Namely, it would then be very easy to intertwine Turing-complete programs anywhere in the types of your program. I don't think this is worth it.</p>\n"}], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 46203962, "answer_count": 1, "score": 1, "last_activity_date": 1505346843, "creation_date": 1505321527, "last_edit_date": 1505322286, "question_id": 46203009, "link": "https://stackoverflow.com/questions/46203009/partial-application-of-type-synonyms", "title": "Partial application of type synonyms", "body": "<p>I'm having trouble with unsaturated type synonyms in the following example:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE LiberalTypeSynonyms #-}\n\nmodule TypeFamilyHackery where\n\ndata T k v a = T\n\ntype family CollectArgTypes arr where\n  CollectArgTypes (a -&gt; b) = (a, CollectArgTypes b)\n  CollectArgTypes _ = ()\n\ntype family MapReturnType f t where\n  MapReturnType f (a -&gt; b) = a -&gt; MapReturnType f b\n  MapReturnType f r = f r\n\ntype MkT k v = T k v v\n\n-- | Goal:\n-- @\n--   BuryT Int = T () Int Int\n--   BuryT (Bool -&gt; Int) = Bool -&gt; T (Bool, ()) Int Int\n--   BuryT (a -&gt; b -&gt; c) = a -&gt; b -&gt; T (a,(b,())) c c\n-- @\ntype BuryT t = MapReturnType (MkT (CollectArgTypes t)) t\n</code></pre>\n\n<p>But this complains with <code>The type synonym 'MkT' should have 2 arguments, but has been given 1</code>. I could specialize <code>MapReturnType</code> for <code>MkT (CollectArgTypes t)</code>, but I rather like it how it is.</p>\n\n<p>Since <code>-XLiberalTypeSynonyms</code> doesn't seem to deliver (why?), what are my options to get <code>BuryT</code> working?</p>\n"}, {"tags": ["haskell", "functional-programming", "frp", "nix", "reflex"], "answers": [{"tags": [], "owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "is_accepted": false, "score": 1, "last_activity_date": 1505477948, "creation_date": 1505477948, "answer_id": 46239428, "question_id": 46203002, "link": "https://stackoverflow.com/questions/46203002/using-reflex-platform-to-compile-a-stack-project-with-local-packages/46239428#46239428", "title": "Using Reflex Platform to compile a stack project with local packages", "body": "<p>You can add <code>my_package</code> using the package overriding mechanism in <code>haskellPackages</code>, as described in the <a href=\"https://nixos.org/nixpkgs/manual/#how-to-build-projects-that-depend-on-each-other\" rel=\"nofollow noreferrer\" title=\"NixPkgs Manual\">NixPkgs Manual</a></p>\n\n<p>The <code>cabal.project</code> file, as used for this purpose, is roughly equivalent to a set of overrides added to <code>haskellPackages</code>. If you're switching entirely to Nix, you can delete the <code>cabal.project</code> when you're done, because it will be obsolete. NixPkgs' <code>haskellPackages</code> does not have a use for it. It only uses cabal-install to build single packages at a time.</p>\n"}], "owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1505477948, "creation_date": 1505321467, "question_id": 46203002, "link": "https://stackoverflow.com/questions/46203002/using-reflex-platform-to-compile-a-stack-project-with-local-packages", "title": "Using Reflex Platform to compile a stack project with local packages", "body": "<p>I would like to use the work-on script in reflex-platform to compile a project that has been managed using stack until now as explained <a href=\"https://github.com/reflex-frp/reflex-platform/blob/develop/HACKING.md\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>In the stack.yaml's package list I have a reference to a package located in a local path, something like:</p>\n\n<pre><code>packages:\n- '.'\n- ../&lt;my_package&gt;\n</code></pre>\n\n<p>When I run the script I get a strange nix error saying that an anonymous function has been called without a required argument (with the name of the local package).</p>\n\n<blockquote>\n  <p>error: anonymous function at\n  /nix/store/sci0xi7jjwl9krpsp051iry1blz0jaw0-cabal2nix-for-unknown-package/default.nix:1:1\n  called without required argument \u2018my_package\u2019, at\n  /nix/store/wgg4rzg3hyywfd7b0917qmj4617rza7k-nixpkgs-32833c010ecf868826aaa3b60d322bf697f37134-src/pkgs/development/haskell-modules/make-package-set.nix:69:27</p>\n</blockquote>\n\n<p>How can I tell nix where to find it?         </p>\n"}, {"tags": ["haskell", "io", "ghci"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1505314162, "post_id": 46200596, "comment_id": 79363972, "body": "It is simply waiting for you to enter a <code>hawkID</code> in the stdin... Enter an id and hit ENTER."}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 8566256, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3c79cd07c6ade981058759288c6abfcf?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/8566256/hawkeye"}, "edited": false, "score": 0, "creation_date": 1505314503, "post_id": 46200697, "comment_id": 79364230, "body": "Ah I wasn&#39;t I thought it would read it like :main Biehl for example. Thank you!"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 37, "user_id": 8566256, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3c79cd07c6ade981058759288c6abfcf?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/8566256/hawkeye"}, "edited": false, "score": 2, "creation_date": 1505314565, "post_id": 46200697, "comment_id": 79364274, "body": "@hawkeye Ah no <code>getLine</code> reads a line from stdin. For the command line arguments you would use <code>getArgs</code> from <code>System.Environment</code>. Of course I think you could pipe a line in rather than enter it directly."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": false, "score": 1, "last_activity_date": 1505314826, "last_edit_date": 1505314826, "creation_date": 1505314357, "answer_id": 46200697, "question_id": 46200596, "link": "https://stackoverflow.com/questions/46200596/my-program-seems-to-be-running-infinitely-and-im-not-sure-where-it-is-failing/46200697#46200697", "title": "My program seems to be running infinitely, and I&#39;m not sure where it is failing to continue", "body": "<p>Are you entering text and pressing enter to satisfy the <code>getLine</code> call? There will be no prompt. If you want a prompt, I think you would need a (for example) <code>putStr</code> and probably to disable output buffering.</p>\n\n<p>Also, your <code>writeFile</code> call will not be evaluated - you would need to put it in the body of the <code>do</code> block like:</p>\n\n<pre><code>import System.IO\n\nmain :: IO ()\nmain = do\n  hSetBuffering stdout NoBuffering\n  putStr \"Hawk ID: \"\n  hawkID &lt;- getLine\n  let text = ...\n  writeFile \"hawkID.hs\" text\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 8566256, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3c79cd07c6ade981058759288c6abfcf?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/8566256/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505314826, "creation_date": 1505314009, "question_id": 46200596, "link": "https://stackoverflow.com/questions/46200596/my-program-seems-to-be-running-infinitely-and-im-not-sure-where-it-is-failing", "title": "My program seems to be running infinitely, and I&#39;m not sure where it is failing to continue", "body": "<p>I've been working on writing to a file in Haskell using I/O, but it is just sitting there running with no end product. </p>\n\n<pre><code>main :: IO ()\nmain = do\n  hawkID &lt;- getLine\n  let text = \"module Operations where\\nimport \" ++ hawkID ++ \"\\n\\nsample :: (\" ++ hawkID ++ \"a)\\nsample = B\\n\\\n                                                                                        \\size :: (\" ++ hawkID ++ \" a) -&gt; Int\\nsize x = 0\\n\\n\\\n                                                                                        \\depth :: (\" ++ hawkID ++ \" a) -&gt; Int\\ndepth x = 0\\n\\n\\\n                                                                                        \\dropN :: (\" ++ hawkID ++ \" a) -&gt; (\" ++hawkID ++ \" a)\\ndropN x = x\\n\\n\\\n                                                                                        \\countB :: (\" ++ hawkID ++ \" a) -&gt; Int\\ncountB x = 0\\n\\\n                                                                                        \\ltoB :: (\" ++ hawkID ++ \" a) -&gt; (\" ++ hawkID ++ \" b)\\nltoB x = B\\n\\n\\\n                                                                                        \\toString :: (\" ++ hawkID ++ \" a) -&gt; String\\ntoString x = \\\"\\\"\\n\\n\\\n                                                                                        \\mapHawkid :: (a -&gt; b) -&gt; (\" ++ hawkID++ \" a) -&gt; (\" ++ hawkID ++ \" b)\\n\\n\\\n                                                                                        \\substB :: (\" ++ hawkID ++ \" a) -&gt; (\" ++ hawkID ++\" a) -&gt; (\" ++ hawkID ++ \" a)\\n\\\n                                                                                        \\substB x y = B\"\n  let file =  writeFile \"Desktop/hawkID.hs\"  text\n\n  return ()\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "haskell-stack", "nix", "nix-shell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1505318980, "post_id": 46194110, "comment_id": 79367373, "body": "I know nothing about <code>nix</code>, but AFAIK running <code>stack setup</code> won&#39;t redownload a version of GHC if that version was already downloaded somewhere on your computer. Stack tries as much as possible to share downloads between projects."}, {"owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "edited": false, "score": 0, "creation_date": 1505330501, "post_id": 46194110, "comment_id": 79373881, "body": "These days stack wants to use its own ghc unless <code>--system-ghc</code> is passed or <code>system-ghc: true</code> is specified in config.yaml / stack.yaml.  So, I recommend putting <code>system-ghc: true</code> in <code>config.yaml</code>."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "edited": false, "score": 0, "creation_date": 1505414212, "post_id": 46194110, "comment_id": 79415791, "body": "@mgsloan Thanks for your advice! Probably, this is the solution. Also considering adding <code>ghc</code> to <code>PATH</code>."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1519181677, "post_id": 46194110, "comment_id": 84800556, "body": "Is stack meant to be installed inside a nix-shell, or is it expected to exist in the user profile? I was under the the impression that I would bring in stack inside the shell via shell.nix then run stack while inside the shell."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1519199940, "post_id": 46194110, "comment_id": 84806729, "body": "@CMCDragonkai in my case <code>stack</code> already exist in my user profile."}], "answers": [{"tags": [], "owner": {"reputation": 166, "user_id": 3213408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c803946123968c42341999f105cb32?s=128&d=identicon&r=PG&f=1", "display_name": "brainrape", "link": "https://stackoverflow.com/users/3213408/brainrape"}, "is_accepted": true, "score": 2, "last_activity_date": 1520607827, "creation_date": 1520607827, "answer_id": 49196564, "question_id": 46194110, "link": "https://stackoverflow.com/questions/46194110/how-to-use-already-installed-ghc-with-stack-inside-nix-shell/49196564#49196564", "title": "How to use already installed ghc with stack inside nix-shell?", "body": "<p>I'm not sure how you set up your project, but probably the easiest (but limited) way is to use stack's <a href=\"http://stack.readthedocs.io/en/v0.1.10.1/nix_integration.html\" rel=\"nofollow noreferrer\">nix integration</a> which will use GHC and native dependencies from <code>nix</code>.</p>\n\n<p>Unfortunately, the stack nix integration is rather backwards. It doesn't use nix to build your package, just to create an environment with GHC and native dependencies. You have to use stack itself to build the project, and since stack will run cabal, it should still work with the flag. The stack nix integration will not generate a .nix file with the dependencies resolved by stack, so you can't build your project with <code>nix-build</code> and there's no point in entering <code>nix-shell</code>. You would have to use a tool like <code>stack2nix</code> or <code>stackage2nix</code> for that.</p>\n\n<p>So: build with <code>stack --nix build</code> and stack should use nix to set up GHC and native dependencies.</p>\n\n<p>When you're ready for serious business (like automated build and deploy), look into <code>stack2nix</code> or <code>stackage2nix</code>, use them to freeze the dependencies into a <code>nix</code> file, then build and deploy with <code>nix-build</code>, <code>nix-copy-closure</code> etc.</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 49196564, "answer_count": 1, "score": 2, "last_activity_date": 1520607827, "creation_date": 1505295746, "question_id": 46194110, "link": "https://stackoverflow.com/questions/46194110/how-to-use-already-installed-ghc-with-stack-inside-nix-shell", "title": "How to use already installed ghc with stack inside nix-shell?", "body": "<p>I have already installed <code>ghc</code> using <code>stack</code> build tool. It compiles my project. But when I enter <code>nix-shell</code> inside project directory and want to compile my project from <code>nix-shell</code> I see error like this:</p>\n\n<pre><code>No compiler found, expected minor version match with ghc-8.0.2\n</code></pre>\n\n<p>This can be fixed by running <code>stack setup</code> command. But I worry that this will install <code>ghc</code> once more time consuming more space on my machine and etc. Is there a way to use already installed <code>ghc</code> for <code>nix-shell</code> without running <code>stack setup</code> command?</p>\n"}, {"tags": ["haskell", "types", "polymorphism", "ghci", "monomorphism-restriction"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1505296114, "post_id": 46193983, "comment_id": 79350667, "body": "How do you see result of type defaulting rules? <code>:t 42 `div` 2</code> shows <code>Integral a =&gt; a</code>, and so do results of let-bindings etc."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1505296821, "post_id": 46193983, "comment_id": 79351198, "body": "@n.m. I was saying about actual result. Like <code>2^100 `div` 2</code> prints <code>633825300114114700748351602688</code> because default type for this case is <code>Integer</code>. Even if <code>ghci</code> says that type of this constant is polymorphic, in reality its specific and I want to see which monomorphic type is used."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1505299080, "post_id": 46193983, "comment_id": 79352865, "body": "@Shersh That&#39;s just GHCi though. The REPL picks a type (<code>Integer</code>, in this case) because it has to display something. In &quot;real&quot; code it&#39;ll be polymorphic until the context picks a type."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1505299508, "post_id": 46193983, "comment_id": 79353138, "body": "@BenjaminHodgson In real code I can write <code>main = print (2 ^ 100)</code> and it will pick <code>Integer</code> type though emitting warning that I&#39;m a bad person. This happens because type defaulting rules applied. I want to see which specific type <code>ghci</code> or <code>ghc</code> will pick. I don&#39;t care how it choses default type, I just want to see what type was chosen."}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1505300011, "post_id": 46195543, "comment_id": 79353514, "body": "It does work for <code>div</code> for me (8.0.2). Perhaps ask for <code>:t d</code> :)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1505300161, "post_id": 46195543, "comment_id": 79353630, "body": "Yeah, also works in 8.3 and 7.10, when actually writing <code>:t d</code> instead of <code>:t div</code>. My fingers typed away too fast there..."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1505303665, "post_id": 46195543, "comment_id": 79356042, "body": "That&#39;s really helpful! Not perfect (because I can&#39;t write <code>:t div</code>) but already good enough."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1505323752, "post_id": 46195543, "comment_id": 79370091, "body": "@Shersh I added a GHCi macro for the \u201cperfect\u201d solution to my answer."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1505336820, "post_id": 46195543, "comment_id": 79377060, "body": "If you want to default to <code>NoMonomorphismRestriction</code>, then you can add <code>:set -XNoMonomorphismRestriction</code> at the end of the definition of <code>:monotype</code>. Also I would use an uncommon identifier like <code>__defaulted__</code> to avoid the potential for name clashes, or <code>it</code> so that GHCi will automatically overwrite the binding anyway."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1505323704, "last_edit_date": 1505323704, "creation_date": 1505299745, "answer_id": 46195543, "question_id": 46193983, "link": "https://stackoverflow.com/questions/46193983/how-to-print-type-of-polymorphic-function-or-value-in-ghci-with-type-defaultin/46195543#46195543", "title": "How to print type of polymorphic function (or value) in ghci with type defaulting rules applied?", "body": "<p>You can do this by turning on the monomorphism restriction and then binding it to a new name:</p>\n\n<pre><code>Prelude&gt; :set -XMonomorphismRestriction \nPrelude&gt; let n = 42\nPrelude&gt; :t n\nn :: Integer\nPrelude&gt; let p = (^)\nPrelude&gt; :t p\np :: Integer -&gt; Integer -&gt; Integer\nPrelude&gt; let e = (**)\nPrelude&gt; :t e\ne :: Double -&gt; Double -&gt; Double\nPrelude&gt; let d = div\nPrelude&gt; :t d\nd :: Integer -&gt; Integer -&gt; Integer\n</code></pre>\n\n<p>If you don't fancy the need to always define a new variable, you can get around this by using</p>\n\n<pre><code>Prelude&gt; :def monotype (\\e -&gt; return $ \":set -XMonomorphismRestriction\\nlet defaulted = \"++e++\"\\n:t defaulted\")\n</code></pre>\n\n<p>(you may want to put that in your <code>.ghci</code> file to always have the command available) and then</p>\n\n<pre><code>Prelude&gt; :monotype (^)\ndefaulted :: Integer -&gt; Integer -&gt; Integer\n</code></pre>\n\n<p>Of course, the hidden global side-effect of enabling the monomorphism restriction is extremely ugly, but oh well...</p>\n"}, {"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1505303562, "post_id": 46195571, "comment_id": 79355957, "body": "That&#39;s an interesting solution!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1505299834, "creation_date": 1505299834, "answer_id": 46195571, "question_id": 46193983, "link": "https://stackoverflow.com/questions/46193983/how-to-print-type-of-polymorphic-function-or-value-in-ghci-with-type-defaultin/46195571#46195571", "title": "How to print type of polymorphic function (or value) in ghci with type defaulting rules applied?", "body": "<p>Not a perfect solution, but it could be a first step.</p>\n\n<pre><code>&gt; import Data.Typeable\n&gt; let withType x = (x, typeOf x)\n&gt; withType []\n([],[()])\n&gt; withType 56\n(56,Integer)\n</code></pre>\n\n<p>Note that, since the type <code>a</code> gets changed into <code>(a,TypeRep)</code>, GHCi will not use all its defaulting magic. Still, some of it can be shown.</p>\n\n<p>GHCi's <code>:set +t</code> option is also interesting, but prints the polymorphic type before the GHCi defaulting, it seems.</p>\n"}, {"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 2, "last_activity_date": 1534473747, "creation_date": 1534473747, "answer_id": 51887710, "question_id": 46193983, "link": "https://stackoverflow.com/questions/46193983/how-to-print-type-of-polymorphic-function-or-value-in-ghci-with-type-defaultin/51887710#51887710", "title": "How to print type of polymorphic function (or value) in ghci with type defaulting rules applied?", "body": "<p>Since GHC 8.4.1 it's possible to use <code>:type +d</code> (or <code>:t +d</code> for short) option to print the type of an expression, defaulting type variables if possible.</p>\n\n<pre><code>ghci&gt; :t 42\n42 :: Num p =&gt; p\nghci&gt; :t +d 42\n42 :: Integer\nghci&gt; :t div\ndiv :: Integral a =&gt; a -&gt; a -&gt; a\nghci&gt; :t +d div\ndiv :: Integer -&gt; Integer -&gt; Integer\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1534476317, "post_id": 51887952, "comment_id": 90727075, "body": "That&#39;s a very useful addition to the answer!"}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 1, "last_activity_date": 1534558976, "last_edit_date": 1534558976, "creation_date": 1534476040, "answer_id": 51887952, "question_id": 46193983, "link": "https://stackoverflow.com/questions/46193983/how-to-print-type-of-polymorphic-function-or-value-in-ghci-with-type-defaultin/51887952#51887952", "title": "How to print type of polymorphic function (or value) in ghci with type defaulting rules applied?", "body": "<p>It's not really possible for ghci to give you similar defaulting behaviour as GHC, which is exactly why the monomorphism restriction is (now) turned off by default in ghci.</p>\n\n<p>As shown in @Shersh's answer, you can now ask GHCi what it would default a given expression to.</p>\n\n<pre><code>Prelude&gt; :t 2^100 `div` 2\n2^100 `div` 2 :: Integral a =&gt; a\n\nPrelude&gt; :t +d 2^100 `div` 2\n2^100 `div` 2 :: Integer\n\nPrelude&gt; 2^100 `div` 2\n633825300114114700748351602688\n</code></pre>\n\n<p>But this isn't necessarily reflective of what GHC would do with the same expression, since GHC compiles the expression in the context of the full module. GHC can take into account all <em>uses</em> of the expression, where as GHCi only has access to the constituent parts of the expression. GHC only defaults things that <em>remain</em> ambiguous after considering all of that extra context, so it isn't guaranteed to use the type for the expression that you would see with <code>:t +d</code> in GHCi.</p>\n\n<p>For example:</p>\n\n<pre><code>n = 2^100 `div` 2\n\nxs = \"ABCD\"\n\nmain = print $ xs !! n\n</code></pre>\n\n<p>This prints <code>'A'</code>, which is obviously not the 633825300114114700748351602688th element of that (4-element) list. Because the expression <code>2^100 `div` 2</code> is <em>used</em> as an argument to <code>!!</code> (non-locally, via the <code>n</code> binding), and <code>(!!) :: [a] -&gt; Int -&gt; a</code> the type is chosen as <code>Int</code>, not the type that would be chosen by default without this context (<code>Integer</code>). Evaluating that expression as <code>Int</code> has a different result (0, due to overflow).</p>\n\n<p>This means that when you're scratching your head over a type error in GHC and are using <code>:t +d</code> in GHCi to try to get more information, you need to be aware that you still might not be seeing the same type that GHC is actually using. The polymorphic type is guaranteed to be compatible with the one GHC is using, but defaulting it in any other context might result in a different one that is not compatible.</p>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 51887710, "answer_count": 4, "score": 7, "last_activity_date": 1534558976, "creation_date": 1505295457, "question_id": 46193983, "link": "https://stackoverflow.com/questions/46193983/how-to-print-type-of-polymorphic-function-or-value-in-ghci-with-type-defaultin", "title": "How to print type of polymorphic function (or value) in ghci with type defaulting rules applied?", "body": "<p>When I enter <code>:t</code> command in GHCi I see polymorphic type:</p>\n\n<pre><code>ghci&gt; :t 42\n42 :: Num t =&gt; t\nghci&gt; :t div\ndiv :: Integral a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>But after I actually evaluate such functions I see result of type defaulting rules. Is there some command or ability to observe in ghci how type will be changed after type defaulting rules applied according to Haskell report and/or ghc implementation?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1505292672, "post_id": 46192963, "comment_id": 79348103, "body": "It is infinite because <code>s</code> occurs both on the left and right side of <code>~</code> and not in the semantical part. So after one substitution, it is <code>s ~ (a,s) ~ (a,(a,s))</code>, etc."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1505292858, "post_id": 46192963, "comment_id": 79348212, "body": "<code>s ~ (a,s)</code> is not true -- unification fails in the &quot;occurs check&quot; step. Indeed, there is no type <code>T</code> for which <code>(a,T)</code> is still the same type: the second intuitively contains one additional <code>a</code>. It is like solving <code>n=n+1</code> on numbers: it has no solution, unless you somehow allow &quot;infinity&quot; as a number."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1505293268, "post_id": 46192963, "comment_id": 79348506, "body": "@Willem Van Onsem  can you please show for a learner like me, how to substitute a type. I saw a lot of many cases, how substitution works, but not sure, if I am right or not."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1505292920, "creation_date": 1505292920, "answer_id": 46193083, "question_id": 46192963, "link": "https://stackoverflow.com/questions/46192963/how-to-use-the-type-and-why-compiler-complains-infinite-type/46193083#46193083", "title": "How to use the type and why compiler complains infinite type?", "body": "<blockquote>\n  <p>But I can not see, why it is infinite type.</p>\n</blockquote>\n\n<p>Because <code>s</code> occurs both at the left and right side of the type equality <code>~</code>, and this in a recursive fashion. After one substitution, we have:</p>\n\n<pre><code>s ~ (a,s)\n</code></pre>\n\n<p>But note that <code>s</code> in <code>(a,s)</code> should also be substituted, so:</p>\n\n<pre><code>s ~ (a,s) ~ (a,(a,s)) ~ (a,(a,(a,s))) ~ ...\n</code></pre>\n\n<p>So in order to construct this type it would result in a type with infinitely nested 2-tuples. Haskell can not handle such types.</p>\n\n<p><code>Moi (+1)</code> simply does not match the specifications of this \"<em>state monad</em>\". You probably want to use:</p>\n\n<pre><code>Moi (\\x -&gt; (x,x+1))\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>Moi (ap (,) (1 +))\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 46193083, "answer_count": 1, "score": 3, "last_activity_date": 1505292920, "creation_date": 1505292508, "question_id": 46192963, "link": "https://stackoverflow.com/questions/46192963/how-to-use-the-type-and-why-compiler-complains-infinite-type", "title": "How to use the type and why compiler complains infinite type?", "body": "<p>I have following type:</p>\n\n<pre><code>newtype Moi s a =\n  Moi { runMoi :: s -&gt; (a, s) }  \n</code></pre>\n\n<p>the data constructor expects a function as the argument and it should return a tuple.  </p>\n\n<p>I tried following: </p>\n\n<pre><code>*OwnState&gt; :t Moi (+1)\n</code></pre>\n\n<p>the compiler complains:</p>\n\n<pre><code>&lt;interactive&gt;:1:6: error:\n    * Occurs check: cannot construct the infinite type: s ~ (a, s)\n      Expected type: s -&gt; (a, s)\n        Actual type: (a, s) -&gt; (a, s)\n    * In the first argument of `Moi', namely `(+ 1)'\n      In the expression: Moi (+ 1)\n</code></pre>\n\n<p>First look at the type signature of <code>(+1)</code>:</p>\n\n<pre><code>*OwnState&gt; :t (+1)\n(+1) :: Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>The type <code>a</code> has to be constraint to <code>Num</code> typeclass.  </p>\n\n<p>So when I write <code>Moi (+1)</code>, what is going to happen, how the type is going to be substitute?   </p>\n\n<p>Let's analyze the error message as the next step:</p>\n\n<pre><code>Occurs check: cannot construct the infinite type: s ~ (a, s)\n</code></pre>\n\n<p>Tilde means <code>~</code> type equality and how the compiler comes to conclusion that <code>s</code> has the same type as <code>(a, s)</code>?  </p>\n\n<p>I suppose, the type substitution of example above works in this way:</p>\n\n<pre><code>n -&gt; n \"Type of (+1)\n|    |\ns -&gt; (a, s)\n</code></pre>\n\n<p>then <code>s</code> becomes to <code>(a, s)</code> and the proof <code>s ~ (a, s)</code> is true. </p>\n\n<pre><code>(a, s) -&gt; (a, s)\n</code></pre>\n\n<p>But I can not see, why it is infinite type. </p>\n"}, {"tags": ["haskell", "monad-transformers", "state-monad", "cloud-haskell"], "answers": [{"tags": [], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "is_accepted": true, "score": 2, "last_activity_date": 1505387976, "creation_date": 1505387976, "answer_id": 46217726, "question_id": 46191902, "link": "https://stackoverflow.com/questions/46191902/distributed-process-in-monad-transformer/46217726#46217726", "title": "Distributed Process in monad transformer", "body": "<p>As Michael Snoyman points <a href=\"https://www.fpcomplete.com/blog/2017/06/readert-design-pattern\" rel=\"nofollow noreferrer\">out</a> <a href=\"https://www.fpcomplete.com/blog/2017/06/understanding-resourcet\" rel=\"nofollow noreferrer\">in a</a> <a href=\"https://www.fpcomplete.com/blog/2017/06/tale-of-two-brackets\" rel=\"nofollow noreferrer\">series</a> of <a href=\"https://www.fpcomplete.com/blog/2017/07/announcing-new-unliftio-library\" rel=\"nofollow noreferrer\">blog</a> <a href=\"https://www.fpcomplete.com/blog/2017/07/the-rio-monad\" rel=\"nofollow noreferrer\">posts</a> (that's 5 links), wrapping <code>StateT</code> around <code>IO</code> is a bad idea. You just stumbled over one instance where that surfaces.</p>\n\n<pre><code>mystatefulcomp :: Cluster ()\nmystatefulcomp = do\n   old_state &lt;- get\n   receiveWait [ match doSomethingWithString ]\n   new_state &lt;- get\n</code></pre>\n\n<p>The problem is what ends up in <code>new_state</code> if <code>doSomethingWithString</code> throws an error. The <code>old_state</code>? Some intermediate state from <code>doSomethingWithString</code> before the exception? You see, the very fact that we are wondering makes this approach no less bad than just storing the state in an <code>IORef</code> or <code>MVar</code>.</p>\n\n<p>Apart from questionable semantics, this can't even be implemented without <code>distributed-process</code> being rewritten to use <a href=\"https://hackage.haskell.org/package/monad-control-1.0.2.2/docs/Control-Monad-Trans-Control.html#t:MonadBaseControl\" rel=\"nofollow noreferrer\"><code>MonadBaseControl</code></a> everywhere. This is exactly why <code>distributed-process-lifted</code> fails to deliver, because it just wraps around the primitives from <code>distributed-process</code>.</p>\n\n<p>So, what I would do here instead is to pass around a <code>data Config = Config { clusterState :: MVar ClusterState }</code> environment (Oh look, <a href=\"https://hackage.haskell.org/package/distributed-process-0.7.3/docs/src/Control-Distributed-Process-Internal-Types.html#Process\" rel=\"nofollow noreferrer\"><code>Process</code></a> does that, too!). Possibly with <code>ReaderT</code> which interacts with <code>IO</code> in a sane way, plus you can easily lift any number of nested occurences of <code>Process</code> to <code>ReaderT Config Process</code> yourself.</p>\n\n<p>Repeating the message of Michael's blog posts: <code>StateT</code> isn't bad in general (in a pure transformer stack, that is), just for cases where we wrap <code>IO</code> in some way. I encourage you to read those posts, they were very inspiring for me, so here they are again:</p>\n\n<ol>\n<li><a href=\"https://www.fpcomplete.com/blog/2017/06/readert-design-pattern\" rel=\"nofollow noreferrer\">https://www.fpcomplete.com/blog/2017/06/readert-design-pattern</a></li>\n<li><a href=\"https://www.fpcomplete.com/blog/2017/06/understanding-resourcet\" rel=\"nofollow noreferrer\">https://www.fpcomplete.com/blog/2017/06/understanding-resourcet</a></li>\n<li><a href=\"https://www.fpcomplete.com/blog/2017/06/tale-of-two-brackets\" rel=\"nofollow noreferrer\">https://www.fpcomplete.com/blog/2017/06/tale-of-two-brackets</a></li>\n<li><a href=\"https://www.fpcomplete.com/blog/2017/07/announcing-new-unliftio-library\" rel=\"nofollow noreferrer\">https://www.fpcomplete.com/blog/2017/07/announcing-new-unliftio-library</a></li>\n<li><a href=\"https://www.fpcomplete.com/blog/2017/07/the-rio-monad\" rel=\"nofollow noreferrer\">https://www.fpcomplete.com/blog/2017/07/the-rio-monad</a></li>\n</ol>\n"}], "owner": {"reputation": 255, "user_id": 1788453, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f438272f4e0a03a70f300301da669e62?s=128&d=identicon&r=PG", "display_name": "Patrik", "link": "https://stackoverflow.com/users/1788453/patrik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 46217726, "answer_count": 1, "score": 1, "last_activity_date": 1505387976, "creation_date": 1505289232, "last_edit_date": 1505311216, "question_id": 46191902, "link": "https://stackoverflow.com/questions/46191902/distributed-process-in-monad-transformer", "title": "Distributed Process in monad transformer", "body": "<p>Im toying with implementing a gossip based cluster membership backend for the so called <code>cloud-haskell</code> or is it <code>Distributed.Process</code>.. anyway Im trying to get away with handeling state without <code>ioref</code>  or <code>MVars</code> and instead using a state transformer and putting the <code>Process</code> monad on the bottom, like so:</p>\n\n<pre><code>type ClusterT = StateT ClusterState\ntype Cluster a = ClusterT Process a\n</code></pre>\n\n<p>This works fairly well using <code>Control.Distributed.Process.Lifted</code> (<a href=\"https://hackage.haskell.org/package/distributed-process-lifted\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/distributed-process-lifted</a>) allowing you to do something like this:</p>\n\n<pre><code>mystatefulcomp :: Cluster ()\nmystatefulcomp = do\n   msg &lt;- expect :: Cluster String\n   old_state &lt;- get\n   say $ \"My old state was \" ++ (show old_state)\n   put $ modifyState curr_state msg\n   mystatefulcomp\n\nmain = do\n   Right transport &lt;- createTransport '127.0.0.1' '3000' (\\n -&gt; ('127.0.0.1', n) defaultTCPParameters\n   node &lt;- newLocalNode transport initRemoteTable\n   runProcess node (evalStateT mystatefulcomp initialstate)\n   where initialstate = ClusterState.empty\n</code></pre>\n\n<p>this works resonably well and allows me to structure my program fairly well, i can keep my state functional and thread it along in the <code>Cluster</code> monad.</p>\n\n<p>This all break tho when i try to use <code>receiveWait</code> and <code>match</code> to receive messages.</p>\n\n<p>lets rewrite <code>statefulcomp</code> to do something else using <code>receiveWait</code></p>\n\n<pre><code>doSomethingWithString :: String -&gt; Cluster ()\ndoSomethingWithString str = do\n   s &lt; get\n   put $ modifyState s str    \n\nmystatefulcomp :: Cluster ()\nmystatefulcomp = do\n   old_state &lt;- get\n   receiveWait [ match doSomthingWithString ]\n   new_state &lt;- get\n   say $ \"old state \" ++ (show old_state) ++ \" new \" ++ (show new_state)\n</code></pre>\n\n<p>This wont work since the <code>match</code> function is of type <code>(a -&gt; Process b) -&gt; Match b</code> but we want it to be of type <code>(a -&gt; Cluster b) -&gt; Match b</code>. And here is where i get out on thin ice. As i understand <code>Control.Distributed.Process.Lifted</code> rexposes <code>Control.Distributed.Process</code> functions lifted into the tansformer stack allowing you to use functions like <code>expect</code> and <code>say</code> but does not rexposes <code>match</code>, <code>matchIf</code> and so on..</p>\n\n<p>Im really struggeling with this trying to find a work around or a way of re implementing <code>match</code> and its friends to the form of <code>MonadProcess m =&gt; (a -&gt; m b) -&gt; Match b</code>.</p>\n\n<p>Any insights is apriciated.</p>\n\n<p><strong>edit</strong></p>\n\n<p>So after som fiddeling about I came up with the following</p>\n\n<pre><code>doSomethingWithString :: String -&gt; Cluster ()\ndoSomethingWithString str = do\n   s &lt; get\n   put $ modifyState s str\n\ndoSomethingWithInt :: Int -&gt; Cluster ()\n...\n\nmystatefulcomp :: Cluster ()\nmystatefulcomp = do\n   old_state &lt;- get\n   id =&lt;&lt; receiveWait [ match $ return . doSomethingWithString\n                      , match $ return . doSomethingWithInt ]\n   new_state &lt;- get\n   say $ \"old state \" ++ (show old_state) ++ \" new \" ++ (show new_state)\n</code></pre>\n\n<p>This works fairly well but I am still curious about how good of a design this is</p>\n"}, {"tags": ["parsing", "haskell", "monads", "monad-transformers", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1505303831, "post_id": 46187912, "comment_id": 79356150, "body": "I&#39;m not sure what you mean by vertical parser composition. Do you mind expanding a bit?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1505317458, "post_id": 46187912, "comment_id": 79366345, "body": "@gallais I mean the operation you&#39;re asking for: a way to take a <code>Parser Foo [Bar]</code> and a <code>Parser Bar Baz</code> and turn it into a <code>Parser Foo Baz</code>."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1505319143, "post_id": 46187912, "comment_id": 79367461, "body": "Oh I see. With simple types like these the goal is much clearer than in OP&#39;s question I think. Thanks for the clarification!"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1544738436, "post_id": 46187912, "comment_id": 94393247, "body": "I wrote a parser library that supports vertical composition <code>https:&#47;&#47;github.com&#47;quickdudley&#47;phaser</code>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1505269798, "creation_date": 1505269798, "answer_id": 46187912, "question_id": 46186238, "link": "https://stackoverflow.com/questions/46186238/generate-parser-that-runs-a-received-parser-on-the-output-of-another-parser-and/46187912#46187912", "title": "Generate parser that runs a received parser on the output of another parser and monadically joins the results", "body": "<p>Sadly I know of no parser library or parser generator for Haskell that supports vertical parser composition like this. Something like what you wrote is about as good as it gets. Dang!</p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 4, "last_activity_date": 1505418164, "last_edit_date": 1505418164, "creation_date": 1505332599, "answer_id": 46205866, "question_id": 46186238, "link": "https://stackoverflow.com/questions/46186238/generate-parser-that-runs-a-received-parser-on-the-output-of-another-parser-and/46205866#46205866", "title": "Generate parser that runs a received parser on the output of another parser and monadically joins the results", "body": "<p>Elaborating on @Daniel Wagner's answer...  The way parsers are normally built with Parsec, you start with low-level parsers that parse specific characters (e.g., a plus sign or a digit), and you build parsers on top of them using combinators (like a <code>many1</code> combinator that turns a parser that reads a single digit into a parser that reads one or more digits, or a monadic parse that parsers \"one or more digits\" followed by a \"plus sign\" followed by \"one or more digits\").</p>\n\n<p>However, each parser, whether it's a low-level digit parser or a higher-level \"addition expression\" parser, is intended to be applied directly to the same input stream.</p>\n\n<p>What you don't <em>typically</em> do is write a parser that gobbles a chunk of the input stream to produce, say, a <code>String</code> and another parser that parses that <em><code>String</code></em> (instead of the original input stream) and try to combine them.  This is the kind of \"vertical composition\" that isn't directly supported by Parsec and looks unnatural and non-monadic.</p>\n\n<p>As pointed out in the comments, there are <em>some</em> situations where vertical composition is the cleanest overall approach (like when you have one language embedded within the components or expressions of another language), but it's not the usual approach taken by a Parsec parser.</p>\n\n<p>The bottom line in your application is that a <code>cell</code> parser that produces only a <code>String</code> is too specialized to be useful.  A more useful Parsec framework for CSV files would be:</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.String\n\n-- | `csv cell` parses a CSV file each of whose elements is parsed by `cell`\ncsv :: Parser a -&gt; Parser [[a]]\ncsv cell = many (row cell)\n\n-- | `row cell` parses a newline-terminated row of comma separated\n--   `cell`-expressions\nrow :: Parser a -&gt; Parser [a]\nrow cell = sepBy cell (char ',') &lt;* char '\\n'\n</code></pre>\n\n<p>Now, you can write a custom cell parser that parses positive integers:</p>\n\n<pre><code>customCell :: Parser Int\ncustomCell = read &lt;$&gt; many1 digit\n</code></pre>\n\n<p>and parse CSV files:</p>\n\n<pre><code>&gt; parse (csv customCell) \"\" \"1,2,3\\n4,5,6\\n\"\nRight [[1,2,3],[4,5,6]]\n&gt;\n</code></pre>\n\n<p>Here, instead of having a <code>cell</code> subparser that explicitly parses a comma-delimited cell into a string to be fed to a different parser, the \"cell\" is an implicit context in which a supplied cell parser is called to parse the underlying input stream at the appropriate point where one would expect a comma-delimited cell in the middle of a row in the middle of the input stream.</p>\n"}], "owner": {"reputation": 23573, "user_id": 330889, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/daacb6d0a16d95a3858ccae59b44860d?s=128&d=identicon&r=PG", "display_name": "Pedro Rolo", "link": "https://stackoverflow.com/users/330889/pedro-rolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1505418164, "creation_date": 1505255478, "last_edit_date": 1505256296, "question_id": 46186238, "link": "https://stackoverflow.com/questions/46186238/generate-parser-that-runs-a-received-parser-on-the-output-of-another-parser-and", "title": "Generate parser that runs a received parser on the output of another parser and monadically joins the results", "body": "<p>given the following type and function, meant to parse a field of a CSV field into a string:</p>\n\n<pre><code>type Parser resultType = ParsecT String () Identity resultType\ncell :: Parser String \n</code></pre>\n\n<p>I have implemented the following function:</p>\n\n<pre><code>customCell :: String -&gt; Parser res  -&gt; Parser res\ncustomCell typeName subparser = \n  cell\n    &gt;&gt;= either (const $ unexpected typeName) \n               return . parse (subparser &lt;* eof) \"\"\n</code></pre>\n\n<p>Though I cannot stop thinking that I am not using the Monad concept as much as desired and that eventually there is a better way to merge the result of the inner with the outer parser, specially on what regards its failure.</p>\n\n<p>Does anybody know how could I do so, or is this code what is meant to be done?</p>\n\n<p>PS - I now realised that my type simplification is probably not appropriate and that maybe what I want is to replace the underlying Identity Monad by the Either Monad.... Unfortunately, I do not feel enough acquainted with monad transformers yet.</p>\n\n<p>PS2 - What the hell is the underlying monad good for anyway? </p>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 12066, "user_id": 3924118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/abb01e1c2a8e3d9e1534dca14b19b3d8?s=128&d=identicon&r=PG&f=1", "display_name": "nbro", "link": "https://stackoverflow.com/users/3924118/nbro"}, "edited": false, "score": 0, "creation_date": 1505252164, "post_id": 46185621, "comment_id": 79334189, "body": "In Haskell, lists are immutable, so you can&#39;t change them (in case it was not clear). You can return a new list representing what you wanted to achieve."}, {"owner": {"reputation": 12066, "user_id": 3924118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/abb01e1c2a8e3d9e1534dca14b19b3d8?s=128&d=identicon&r=PG&f=1", "display_name": "nbro", "link": "https://stackoverflow.com/users/3924118/nbro"}, "edited": false, "score": 0, "creation_date": 1505252598, "post_id": 46185621, "comment_id": 79334362, "body": "Can you explain to me what <code>[a] = reverse [a]</code> is supposed to do? To program in Haskell, you need to think more mathematically, in terms of functions (and composition and application of functions), not much in terms of &quot;returning values different times and then putting them together&quot;."}, {"owner": {"reputation": 12066, "user_id": 3924118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/abb01e1c2a8e3d9e1534dca14b19b3d8?s=128&d=identicon&r=PG&f=1", "display_name": "nbro", "link": "https://stackoverflow.com/users/3924118/nbro"}, "edited": false, "score": 0, "creation_date": 1505252865, "post_id": 46185621, "comment_id": 79334466, "body": "Sorry, but I had to downvote this question because the problem you&#39;re describing is caused by the fact that you have not put enough effort in learning Haskell. Please, take it as an encouragement to put more effort next time!"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1505253191, "post_id": 46185778, "comment_id": 79334596, "body": "My advice is just to replace <code>init</code> and <code>tail</code> with saturating versions; see my answer."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1505253303, "post_id": 46185778, "comment_id": 79334647, "body": "@dfeuer Would that mean using <code>drop 1</code> as I suggest above as option 2), and some similar &quot;dropLast&quot; (to be coded)? There are many ways to solve this exercise. (And, BTW, I don&#39;t think this is a good beginner exercise -- asking to code a partial function rarely is, IMO)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1505253462, "post_id": 46185778, "comment_id": 79334698, "body": "That&#39;s certainly an option! <code>dropLast n xs = zipWith const xs (drop n xs)</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1505253559, "post_id": 46185778, "comment_id": 79334737, "body": "If the students are beginning programmers, or even just starting with functional programming, then yes, I definitely agree with you. More experienced students can more reasonably be expected to find reasonable ways to fill in the blanks."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1505253193, "last_edit_date": 1505253193, "creation_date": 1505252639, "answer_id": 46185778, "question_id": 46185621, "link": "https://stackoverflow.com/questions/46185621/function-which-returns-a-new-list-with-the-first-and-last-elements-removed/46185778#46185778", "title": "Function which returns a new list with the first and last elements removed", "body": "<p>You need to compose your steps functionally. Your proposed code could be rewritten as:</p>\n\n<pre><code>midList :: [a] -&gt; [a]\nmidList xs = reverse (tail (reverse (tail xs)))\n</code></pre>\n\n<p>Note that <code>tail</code> will crash your program if it is ever passed the empty list. You can, and should, avoid that by either 1) checking if the list has at least two elements, or 2) using <code>drop 1</code> instead of <code>tail</code>, which will simply return <code>[]</code> on the empty list.</p>\n\n<p>If you try 2), you can keep your function type. For approach 1), instead, you can report the error to the caller using a <code>Maybe [a]</code> return type. More concretely:</p>\n\n<pre><code>midList :: [a] -&gt; Maybe [a]\nmidList xs@(_:_:_) = Just (reverse (tail (reverse (tail xs))))\nmidList _          = Nothing\n</code></pre>\n\n<p>where the pattern <code>_:_:_</code> stands for a list which has at least two elements.</p>\n\n<p>Alternatively, use both <code>init</code> and <code>tail</code>: the former removes the last element, the latter removes the first element.</p>\n\n<pre><code>midList :: [a] -&gt; Maybe [a]\nmidList xs@(_:_:_) = Just (init (tail xs))\nmidList _          = Nothing\n</code></pre>\n\n<p>Be however quite careful here, since in general it is best to avoid partial functions like <code>init</code> and <code>tail</code>. As a general rule, one should never use them if a more basic approach does the job, e.g. using pattern matching.</p>\n\n<p>Here, I would find the code above to be suboptimal. I'd prefer the following, coding my own \"safe\" version of <code>init</code> to remove the last element, if any, or report the error otherwise.</p>\n\n<pre><code>midList :: [a] -&gt; Maybe [a]\nmidList (_:xs@(_:_)) = safeInit xs\nmidList _            = Nothing\n\nsafeInit :: [a] -&gt; Maybe [a]\nsafeInit [] = Nothing\nsafeInit (x:xs) = case safeInit xs of\n   Nothing -&gt; Just []\n   Just ys -&gt; Just (x:ys)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1505253059, "creation_date": 1505253059, "answer_id": 46185849, "question_id": 46185621, "link": "https://stackoverflow.com/questions/46185621/function-which-returns-a-new-list-with-the-first-and-last-elements-removed/46185849#46185849", "title": "Function which returns a new list with the first and last elements removed", "body": "<p>The first thing to do is to make sure you understand the problem. In particular, what do you want to happen if the list has no elements, or just one? The easiest thing is probably to just return the empty list in that case. So let's do that. We can break up the problem into two pieces:</p>\n\n<ol>\n<li>Remove the first element of a list</li>\n<li>Remove the last element of a list</li>\n</ol>\n\n<p>The Haskell prelude defines a couple functions we really don't want, so let's hide them:</p>\n\n<pre><code>import Prelude hiding (tail, init)\n</code></pre>\n\n<p>Now we can define better versions of those functions. <code>tail</code> will return all but the first element of a list and <code>init</code> will return all but the last element. Then we can write</p>\n\n<pre><code>chop :: [a] -&gt; [a]\nchop xs = init (tail xs)\n</code></pre>\n\n<p><code>tail</code> is the easiest to write. I'll provide the skeleton and you can fill in the missing bits.</p>\n\n<pre><code>tail :: [a] -&gt; [a]\ntail [] = ????\ntail (x : xs) = ????\n</code></pre>\n\n<p><code>init</code> is only a little bit trickier. Note that one of the cases will be recursive.</p>\n\n<pre><code>init :: [a] -&gt; [a]\ninit [] = ????\ninit [x] = ????\ninit (x : xs) = ????\n</code></pre>\n"}], "owner": {"reputation": 289, "user_id": 7800841, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8909e2ac4382c623d489fef1e3bc915f?s=128&d=identicon&r=PG&f=1", "display_name": "AdamK", "link": "https://stackoverflow.com/users/7800841/adamk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1292, "favorite_count": 0, "accepted_answer_id": 46185778, "answer_count": 2, "score": 1, "last_activity_date": 1505253193, "creation_date": 1505251891, "last_edit_date": 1505252090, "question_id": 46185621, "link": "https://stackoverflow.com/questions/46185621/function-which-returns-a-new-list-with-the-first-and-last-elements-removed", "title": "Function which returns a new list with the first and last elements removed", "body": "<p>I am very new to Haskell and am trying a simple exercise for practice.  I want to write a function that removes the first and last elements of a list. </p>\n\n<p>I do not need to check if the length of the list.  I found in a book I have a way to remove the first element and a way to reverse the list, but I think this may be more complex than it has to be. I also know that complexity aside, what I have is wrong after the second line, but I don't know why or how to fix it. </p>\n\n<p>Here is my code:</p>\n\n<pre><code>midList :: [a] -&gt; [a]\nmidList [a] = tail [a]\n[a] = reverse [a]\n[a] = tail [a]\n[a] = reverse [a]\n</code></pre>\n"}, {"tags": ["haskell", "optparse-applicative"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1505240370, "creation_date": 1505240370, "answer_id": 46183087, "question_id": 46182591, "link": "https://stackoverflow.com/questions/46182591/parsing-enum-options-with-optparse-applicative/46183087#46183087", "title": "Parsing &quot;enum&quot; options with optparse-applicative", "body": "<p>Use <code>str</code> instead of <code>auto</code>:</p>\n\n<pre><code>binFile :: ReadM BinaryFiles\nbinFile = str &gt;&gt;= \\s -&gt; case s of\n    \"binary\"        -&gt; return Binary\n    \"text\"          -&gt; return Text\n    \"without-match\" -&gt; return WithoutMatch\n    _ -&gt; readerError \"Accepted binary file types are 'binary', 'text', and 'without-match'.\"\n</code></pre>\n"}], "owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 0, "accepted_answer_id": 46183087, "answer_count": 1, "score": 3, "last_activity_date": 1505240370, "creation_date": 1505238329, "question_id": 46182591, "link": "https://stackoverflow.com/questions/46182591/parsing-enum-options-with-optparse-applicative", "title": "Parsing &quot;enum&quot; options with optparse-applicative", "body": "<p>How do I implement a parser for this example from <code>grep --help</code>:</p>\n\n<pre><code> --binary-files=TYPE   assume that binary files are TYPE;\n                       TYPE is 'binary', 'text', or 'without-match'\n</code></pre>\n\n<p>Assuming that I have </p>\n\n<pre><code>data BinaryFiles = Binary | Text | WithoutMatch\n</code></pre>\n\n<p>How do I write a parser? <code>option auto</code> seems a kludge since <code>Read</code> is supposed to be an \"inverse\" to <code>Show</code>, and I'd like to keep the derived <code>instance Show BinaryFiles</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1505238459, "post_id": 46182346, "comment_id": 79327987, "body": "You should include your attempts to translate to Haskell code and a brief description of why it doesn&#39;t work."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1505251791, "post_id": 46182346, "comment_id": 79334035, "body": "Also I don&#39;t see any &quot;anonymous instances of typeclasses&quot;, or anything like a typeclass at all in this question.  Maybe you are misunderstanding what a typeclass is."}], "answers": [{"comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1505281828, "post_id": 46183311, "comment_id": 79341646, "body": "I suppose I could assume the epithet <i>F# expert</i>, and this answer looks fine to me!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1505241292, "creation_date": 1505241292, "answer_id": 46183311, "question_id": 46182346, "link": "https://stackoverflow.com/questions/46182346/does-haskell-support-anonymous-instances-of-typeclass/46183311#46183311", "title": "Does Haskell support anonymous instances of typeclass?", "body": "<p>Apologies in advance: I'm not an F# expert, so I may be misreading the F# code. But if I'm reading it right it's fairly straightforward to translate to Haskell:</p>\n\n<pre><code>data Table t u = Table { get :: t -&gt; IO u, discard :: IO () }\n\nmemoize :: Hashable t =&gt; (t -&gt; u) -&gt; IO (Table t u)\nmemoize f = do\n    tbl &lt;- newHashTable\n    return Table\n        { get = \\t -&gt; do\n            result &lt;- lookupHashTable t tbl\n            case result of\n                Nothing -&gt; let u = f t in writeHashTable t u tbl &gt;&gt; return u\n                Just u -&gt; return u\n        , discard = clearHashTable tbl\n        }\n</code></pre>\n\n<p>I'm assuming some suitable hash table implementation here that offers <code>newHashTable</code>, <code>lookupHashTable</code>, <code>writeHashTable</code>, and <code>clearHashTable</code>. Implementing these (or suggesting a library that offers them) is sort of beside the point of the question, I think.</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 5, "last_activity_date": 1505279749, "creation_date": 1505279749, "answer_id": 46189345, "question_id": 46182346, "link": "https://stackoverflow.com/questions/46182346/does-haskell-support-anonymous-instances-of-typeclass/46189345#46189345", "title": "Does Haskell support anonymous instances of typeclass?", "body": "<p>I'm not an F# expert either, but I believe what you're describing is where you create a anonymous single-use subclass, by declaring in at the point where you create an object how it implements the methods of a superclass or interface? So it's really an anonymous <strong>class</strong>, not an anonymous instance (or rather, it's no more anonymous than any other object-oriented instance, which typically don't have names inherently, only variable names storing references to them).</p>\n\n<p>It doesn't really make sense to do that with Haskell type classes/instances. The reason is that a Haskell instance represents something very different from an OO instance.</p>\n\n<p>The instances of OO classes are objects (even the instances of interfaces are objects). All of a class' methods will always be invoked on an instance of that class. So it makes sense to create an anonymous subclass of an existing class or interface at the time you create a new object. You basically say how that <em>object</em> implements the required methods, as an alternative to declaring a whole named class of objects that implement the methods the same way, which you could instantiate in multiple places.</p>\n\n<p>The instances of Haskell classes are <em>types</em> (which is why the're called type classes). All of the methods of a class must involve the type somehow, but there is no guarantee that they take an <em>input</em> of the type. For example, consider the class<sup>1</sup>:</p>\n\n<pre><code>class Monoid' a\n  where mempty' :: a\n        mappend' :: a -&gt; a -&gt; a\n</code></pre>\n\n<p>It doesn't really make sense to say an <strong>object</strong> is an instance of <code>Monoid'</code>; if I were to create a new object and I wanted to anonymously instantiate <code>Monoid'</code>, how would I define <code>mempty'</code>? <code>mempty'</code> isn't an operation I could invoke <strong>on</strong> my new object, it's an operation that receives no inputs at all (not even an implicit \"this\") and <em>produces</em> a value<sup>2</sup>.</p>\n\n<p>And then there's things like:</p>\n\n<pre><code>class Functor' f\n  where fmap :: (a -&gt; b) -&gt; (f a -&gt; f b)\n</code></pre>\n\n<p>Nothing <em>ever</em> takes an input of a type <code>f</code> that is an instance of <code>Functor'</code>; it doesn't even make sense to talk about something that might, since the instances of the class <code>Functor'</code> are type constructors that need a type parameter to result in a type, not types that actually contain values. So again, it just makes no sense at the point that I'm creating a new <em>object</em> to say \"and here's how this object implements <code>Functor'</code>\").</p>\n\n<p>It could potentially make sense to declare a new anonymous <strong>type</strong> locally, and declare how it implements some type classes at the same time. But Haskell has no syntax for it, no.</p>\n\n<p>Fortunately, you also don't need to create anonymous classes/instances in order to have a one-off collection of functions that conforms to a known interface. Functions are first-class values too, so you can just have <em>type</em> whose fields are functions. Then anywhere you like you can create a new value of that type by providing a definition for all of the function fields. For example:</p>\n\n<pre><code>data MyInterface = MyInterface\n  { foo :: Int -&gt; Bool\n  , bar :: Int -&gt; String\n  }\n\nexample :: MyInterface -&gt; Int -&gt; (Bool, String)\nexample impl x\n  = (foo impl x, bar impl x)\n\nmain = do\n  let impl = MyInterface { foo = even, bar = show }\n  print $ example impl 7\n</code></pre>\n\n<p>The above program prints <code>(False,\"7\")</code>.</p>\n\n<hr>\n\n<p><sup>1</sup> I'm using <code>Monoid'</code> rather than <code>Monoid</code> (and similarly <code>Functor'</code>) because I'm using simplifications of the real classes. You can see the real definition with <code>:info Monoid</code> in ghci (or look up the documentation) if you're interested.</p>\n\n<p><sup>2</sup> Or alternatively, the class <code>Monoid'</code> mandates that there simply exists a value of each type that instantiates it, and <code>mempty'</code> just is a reference to it.</p>\n"}], "owner": {"reputation": 2659, "user_id": 581085, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5ef2ca8729e462595f1500b554ef95e0?s=128&d=identicon&r=PG", "display_name": "Dragno", "link": "https://stackoverflow.com/users/581085/dragno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 46189345, "answer_count": 2, "score": 1, "last_activity_date": 1505279749, "creation_date": 1505237332, "question_id": 46182346, "link": "https://stackoverflow.com/questions/46182346/does-haskell-support-anonymous-instances-of-typeclass", "title": "Does Haskell support anonymous instances of typeclass?", "body": "<p>I have the following code in F# (it's from a book)</p>\n\n<pre><code>open System.Collections.Generic\n\ntype Table&lt;'T, 'U&gt; =\n   abstract Item : 'T -&gt; 'U with get\n   abstract Discard : unit -&gt; unit\n\nlet memoizeAndPermitDiscard f =\n     let lookasideTable = new Dictionary&lt;_, _&gt;(HashIdentity.Structural)\n     {new Table&lt;'T, 'U&gt; with\n      member t.Item\n         with get(n) =\n             if lookasideTable.ContainsKey(n) then\n                 lookasideTable.[n]\n             else\n                 let res = f n\n                 lookasideTable.Add(n, res)\n                 res\n      member t.Discard() = \n           lookasideTable.Clear()}\nlet rec fibFast =\n     memoizeAndPermitDiscard (fun n -&gt;  \n     printfn \"computing fibFast %d\" n\n     if n &lt;= 2 then 1 else fibFast.[n - 1] + fibFast.[n - 2])\n</code></pre>\n\n<p>As we can see the abstract type Table take it's implementation in the function <code>memoizeAndPermitDiscard</code>. Can Haskell do the same?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1505235113, "post_id": 46181646, "comment_id": 79326323, "body": "Probably in <a href=\"http://hackage.haskell.org/package/split-0.1.1/docs/Data-List-Split.html#v:chunk\" rel=\"nofollow noreferrer\"><code>Data.List.Split</code></a>."}, {"owner": {"reputation": 3885, "user_id": 652528, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a580420b66f89e76e1fb9a368f785b3f?s=128&d=identicon&r=PG", "display_name": "geckos", "link": "https://stackoverflow.com/users/652528/geckos"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1505235517, "post_id": 46181646, "comment_id": 79326558, "body": "Is this part of the haskell-platform or I had to install it? I tried to import but failed too. I suppose I have to use <i>cabal</i> for installing this right?  I end up writhing my own version of chunk, based on this answer: <a href=\"https://stackoverflow.com/questions/18427157/how-to-partition-a-list-in-haskell\" title=\"how to partition a list in haskell\">stackoverflow.com/questions/18427157/&hellip;</a>"}, {"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 0, "creation_date": 1505235807, "post_id": 46181646, "comment_id": 79326690, "body": "Pick your poison. <a href=\"https://www.stackage.org/lts-9.4/hoogle?q=chunk\" rel=\"nofollow noreferrer\">stackage.org/lts-9.4/hoogle?q=chunk</a>"}, {"owner": {"reputation": 3885, "user_id": 652528, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a580420b66f89e76e1fb9a368f785b3f?s=128&d=identicon&r=PG", "display_name": "geckos", "link": "https://stackoverflow.com/users/652528/geckos"}, "edited": false, "score": 0, "creation_date": 1505240618, "post_id": 46181646, "comment_id": 79328972, "body": "<i>I searched for chunks at Hoogle and got Data.Text.Internal.Lazy, but this seems to be an internal module. And I couldn&#39;t import it anyway.</i>"}, {"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 2, "creation_date": 1505240847, "post_id": 46181646, "comment_id": 79329080, "body": "@geckos: You searched for &quot;chunks&quot;, but the missing value is named &quot;chunk&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 3885, "user_id": 652528, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a580420b66f89e76e1fb9a368f785b3f?s=128&d=identicon&r=PG", "display_name": "geckos", "link": "https://stackoverflow.com/users/652528/geckos"}, "edited": false, "score": 0, "creation_date": 1505412629, "post_id": 46183152, "comment_id": 79414932, "body": "Fixed at the wiki! Thanks for the suggestion, regards!!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1505240674, "creation_date": 1505240674, "answer_id": 46183152, "question_id": 46181646, "link": "https://stackoverflow.com/questions/46181646/where-to-find-chunks-in-haskell/46183152#46183152", "title": "Where to find chunks in haskell?", "body": "<p>Looks like the tutorial just forgot to define <code>chunk</code>. I encourage you to update the wiki to include a suitable definition.</p>\n"}], "owner": {"reputation": 3885, "user_id": 652528, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a580420b66f89e76e1fb9a368f785b3f?s=128&d=identicon&r=PG", "display_name": "geckos", "link": "https://stackoverflow.com/users/652528/geckos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "accepted_answer_id": 46183152, "answer_count": 1, "score": 0, "last_activity_date": 1505240674, "creation_date": 1505234362, "last_edit_date": 1505235674, "question_id": 46181646, "link": "https://stackoverflow.com/questions/46181646/where-to-find-chunks-in-haskell", "title": "Where to find chunks in haskell?", "body": "<p>I'm trying to follow this tutorial: <a href=\"https://wiki.haskell.org/Tutorials/Programming_Haskell/String_IO\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Tutorials/Programming_Haskell/String_IO</a>.</p>\n\n<p>In the last part <em>7 Extension: using SMP parallelism</em> I copy the code but it fails to compile with this error message</p>\n\n<pre><code>/home/dhilst/parallelspell.hs:13:20: error:\n    Variable not in scope: chunk :: Int -&gt; [String] -&gt; t\n</code></pre>\n\n<p>I searched for <em>chunks</em> at Hoogle and got <em>Data.Text.Internal.Lazy</em>, but this seems to be an internal module. And I couldn't import it anyway.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>import Data.Set hiding (map)\nimport Data.Maybe\nimport Data.Char\nimport Text.Printf\nimport System.IO\nimport System.Environment\nimport Control.Concurrent\nimport Control.Monad\n\nmain = do\n        (f,g,n) &lt;- readFiles\n        let dict = fromList (lines f)\n            work = chunk n (words g)\n        run n dict work\n\nrun n dict work = do\n        chan &lt;- newChan\n        errs &lt;- getChanContents chan\n        mapM_ (forkIO . thread chan dict) (zip [1..n] work)\n        wait n errs 0\n\n\nwait n xs i = when (i &lt; n) $ case xs of\n        Nothing : ys -&gt; wait n ys $! i+1\n        Just s  : ys -&gt; putStrLn s &gt;&gt; wait n ys i\n\nthread chan dict (me,xs) = do\n        mapM_ spellit xs\n        writeChan chan Nothing\n        where spellit w = when (spell dict w) $\n                writeChan chan . Just $ printf \"Thread %d: %-25s\" (me::Int) w\n\nspell d w = w `notMember` d\n\nreadFiles = do\n        [s,n] &lt;- getArgs\n        f &lt;- readFile \"/usr/share/dict/words\"\n        g &lt;- readFile s\n        return (f,g, read n)\n</code></pre>\n\n<p>And here is the compilation line:</p>\n\n<pre><code>ghc -O --make -threaded parallelspell.hs\n</code></pre>\n\n<p>-- \nUpdate: I write my own version of <em>chunk</em> based on this quest:<a href=\"https://stackoverflow.com/questions/18427157/how-to-partition-a-list-in-haskell\">How to partition a list in Haskell?</a></p>\n\n<pre><code>chunk :: Int -&gt; [a] -&gt; [[a]]\nchunk _ [] = []\nchunk n xs = (take n xs) : (chunk n (drop n xs))\n</code></pre>\n\n<p>Still, does this means that the tutorial that I'm following is very old and out of date!? Can anyone confirm if that function already existed some day or if I'm missing something?</p>\n\n<p>Regards,</p>\n"}, {"tags": ["haskell", "quickcheck", "hspec"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1505228873, "post_id": 46178822, "comment_id": 79322391, "body": "Possible to do yes, but your syntax is off. You want <code>within x yourAction</code>, not <code>within x &gt;&gt;= yourAction</code>. <code>within</code> could then be easily implemented with a fork and a time out."}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1505233169, "post_id": 46178822, "comment_id": 79325200, "body": "The idea is to chain checks, not to create and hoc <code>within</code> check. For example one could imagine <code>before</code> condition that states that next action should happen before another parallel action and if it is then pass result to another check. And there&#39;s no need to fork I believe. <code>Control.Concurrent.timeout</code> already does the thing I need."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1505241051, "post_id": 46178822, "comment_id": 79329193, "body": "That&#39;s because <code>timeout</code> does the forking for you; I didn&#39;t mean you had to use <code>forkIO</code> specifically."}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1505243645, "post_id": 46178822, "comment_id": 79330417, "body": "@Cubic Yeah okay. My question is still unanswered though. Can I create kind of compound monadic properties? The point of the DSL to be readable to a non haskell programmer. It&#39;s okay If I can&#39;t I just want to know for sure."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1505249479, "post_id": 46178822, "comment_id": 79333023, "body": "The exact thing you wrote works just fine if you change the type of <code>within</code> to <code>within :: Int -&gt; IO Bool -&gt; IO Bool</code> and <code>monadicIO $ within 100000 &gt;&gt;= repliesWith (==&quot;success&quot;)</code> to <code>monadicIO . within 100000 . repliesWith (==&quot;success&quot;) $ theActionYouWantToTest</code>. If you want something beyond that you&#39;ll have to elaborate."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1505252281, "post_id": 46178822, "comment_id": 79334236, "body": "@user1685095, not quite sure what you mean by &quot;compound monadic properties&quot;, but probably. <code>before</code> is certainly implementable.  I think you can do everything you need in a <code>ExceptT TestFailure IO</code> context, let&#39;s call it <code>Test</code>.   I think the design would be more like <code>repliesWith :: (a -&gt; Bool) -&gt; Test a -&gt; Test ()</code> though -- you raise an exception when it fails, rather than returning <code>False</code>."}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1505396345, "post_id": 46178822, "comment_id": 79404098, "body": "@luqui Yeah, I thought about types for a while and came to a conclustion that I would just need a monad transformer <code>EitherT</code> inside <code>IO</code> monad. I still not sure if the whole idea of writing spec in a human readable form is feasible, but the problem I have right now is that I don&#39;t know how to make human readable reports the way <code>hspec</code> does."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1505434134, "post_id": 46178822, "comment_id": 79423631, "body": "@user1685095 my own experience with DSLs like this is you can&#39;t expect people not to have to learn anything about Haskell, but they don&#39;t need to be gurus.  But the more &quot;syntax magic&quot; games you play in the name of &quot;readability&quot;, the harder it is (because all those games come with weird corner cases) -- just be as direct as you can."}, {"owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1505469621, "post_id": 46178822, "comment_id": 79437025, "body": "@luqui I&#39;m very skeptical about this idea myself. It&#39;s just would be very nice to have a documentation that can be used for testing. Right now people do double work basically. I&#39;m talking about system specification, not just function docs."}], "owner": {"reputation": 4989, "user_id": 1685095, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/5f06068bb9b4c00f12582ccc0ba64c4a?s=128&d=identicon&r=PG", "display_name": "user1685095", "link": "https://stackoverflow.com/users/1685095/user1685095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1505227160, "creation_date": 1505225800, "question_id": 46178822, "link": "https://stackoverflow.com/questions/46178822/quickcheck-specification-dsl", "title": "Quickcheck specification DSL", "body": "<p>I want to create a human readable DSL which non-haskell programmer could understand for creating specifications for black-box testing of external systems.</p>\n\n<p>And I wonder if something like this is possible to do in Haskell.</p>\n\n<pre><code>action = readProcess \"sleep 1; print success\"\n\nprop_action = monadicIO $\n\u00a0\u00a0\u00a0\u00a0within 100000 &gt;&gt;=\n\u00a0\u00a0\u00a0\u00a0repliesWith (== \"success\")\n\nwithin :: Int -&gt; IO a -&gt; IO\nwithin t = fromMaybe False $ timeout t\n\nrepliesWith :: (a -&gt; Bool) -&gt; IO a -&gt; IO Bool\nrepliesWith v = liftM v\n</code></pre>\n\n<p>Here I'm giving a pseudo code for checking that action would return value \"success\" within 0.1 seconds. It seems like I need some kind of monad that would short-circuit on false values to chain multiple checks that pass values from one to another.</p>\n\n<p>Feel like something like this should exist. Maybe you can suggest a library or how to implement my idea in Haskell.</p>\n"}, {"tags": ["haskell", "recursion", "tuples"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1505218949, "post_id": 46176242, "comment_id": 79314686, "body": "Well that&#39;s logical isn&#39;t it?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1505220249, "post_id": 46176242, "comment_id": 79315589, "body": "What result do you want to get if the input is <code>[[(1,1),(2,2)],[(3,3)]]</code>?"}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1505220371, "post_id": 46176242, "comment_id": 79315683, "body": "It should be <code>[[(2,2),(3,3)],[(4,4)]]</code>"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1505220468, "post_id": 46176242, "comment_id": 79315755, "body": "Do you want to flatten the input list or not? The function you&#39;ve just described has type <code>(a -&gt; b) -&gt; [[(a, a)]] -&gt; [[(b, b)]]</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1505220481, "post_id": 46176242, "comment_id": 79315766, "body": "<code>[[(2,2),(3,3)],[(4,4)]]</code> is of a wrong type. You wanted  <code>[(b, b)]</code> but it is of type <code>[[(b, b)]]</code>."}, {"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1505220668, "post_id": 46176242, "comment_id": 79315903, "body": "It works when I&#39;ve flatten the list <code>test = mapTuple myfunc $ concat myTup</code>. But is there anyway that I can do without flatten the list?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1505223981, "post_id": 46176242, "comment_id": 79318607, "body": "&quot;It should be <code>[[(2,2),(3,3)],[(4,4)]]</code>&quot;. &quot;It works when I&#39;ve flatten the list&quot;. Choose one."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1505229767, "post_id": 46176242, "comment_id": 79322973, "body": "You can&#39;t have the same function to work on lists-of-tuples and, at the same time, on lists-of-lists-of-tuple. What do you need?"}], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1505288152, "post_id": 46179797, "comment_id": 79345210, "body": "This is an accurate and precise answer!!! Yes this really help. I wrote down your explanation on a piece of paper in order to understand it. You nailed this part <i>&quot;From the comments you want a function that takes <code>[[(1,1),(2,2)],[(3,3)]] :: [[(a,a)]]</code> and returns <code>[[(2,2),(3,3)],[(4,4)]] :: [[(b,b)]]</code>  So we want to take this partial function and apply it to every <code>[(a,a)]</code> in <code>[[(a,a)]]</code> to get <code>[[(b,b)]]</code>.&quot;</i> Something new to me is the simplification to <code>(a -&gt; b) -&gt; [a] -&gt; [b]</code> which I think I need to look more into this. It looks like math. This should be a good reference. Thanks again!"}], "tags": [], "owner": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "is_accepted": true, "score": 2, "last_activity_date": 1505228589, "creation_date": 1505228589, "answer_id": 46179797, "question_id": 46176242, "link": "https://stackoverflow.com/questions/46176242/haskell-recursion-for-list-of-tuples/46179797#46179797", "title": "Haskell :: Recursion for List of Tuples", "body": "<p>Of course your mapTuple won't work when you change the type to <code>[[(a,a)]]</code> because <code>((a1, a2) : xs)</code> still has the type <code>[(a,a)]</code>.</p>\n\n<p>If you want to apply your mapTuple to a list of lists of tuples rather than a list of tuples then you don't need to change mapTuple at all.</p>\n\n<p>Let's look at the types for a second:\nmapTuple (before you changed it) had type <code>(a -&gt; b) -&gt; [(a,a)] -&gt; [(b,b)]</code></p>\n\n<p>Partially applying mapTuple to myfunc we get <code>[(a,a)] -&gt; [(b,b)]</code></p>\n\n<p>From the comments you want a function that takes <code>[[(1,1),(2,2)],[(3,3)]] :: [[(a,a)]]</code> and returns <code>[[(2,2),(3,3)],[(4,4)]] :: [[(b,b)]]</code></p>\n\n<p>So we want to take this partial function and apply it to every <code>[(a,a)]</code> in <code>[[(a,a)]]</code> to get <code>[[(b,b)]]</code>.</p>\n\n<p>So overall we want a function with type:\n<code>([(a,a)] -&gt; [(b,b)]) -&gt; [[(a,a)]] -&gt; [[(b,b)]]</code></p>\n\n<p>This can simplify to <code>(a -&gt; b) -&gt; [a] -&gt; [b]</code>. Well there is already a function that does that for us! Regular old map.</p>\n\n<p>So using your old mapTuple with type <code>(a -&gt; b) -&gt; [(a, a)] -&gt; [(b, b)]</code>\nwe get the correct result by the following:</p>\n\n<p><code>test = map (mapTuple myfunc) myTup</code></p>\n\n<p>Hopefully this makes sense, if not feel free to ask for clarification :)</p>\n"}, {"comments": [{"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1505288546, "post_id": 46186853, "comment_id": 79345469, "body": "Thanks for the comment Redu. Agree on a tuple is not an ideal representation of types like <code>(a,a)</code>. And if it is a list like you&#39;ve suggested, it can be used with the <code>mapNestedList</code>."}], "tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1505292779, "last_edit_date": 1505292779, "creation_date": 1505260402, "answer_id": 46186853, "question_id": 46176242, "link": "https://stackoverflow.com/questions/46176242/haskell-recursion-for-list-of-tuples/46186853#46186853", "title": "Haskell :: Recursion for List of Tuples", "body": "<p>This is not a one to one answer to your question. However i have to say that in Haskell a tuple is not an ideal representation of types like  <code>(a,a)</code>. A tuple is meant to group different types like <code>(a,b)</code>.</p>\n\n<p>Your job basically requires an <code>fmap</code> over tuple but <code>fmap</code> only effects the second item of the tuple. Then you may create a \"new type\" from tuple for a new functor instance in which <code>fmap</code> would effect both items. But then... you already have that. It's <code>[]</code>. So why don't you use <code>[]</code> in the place of a tuple which would introduce enormous simplicity if you dive into applicative types?</p>\n\n<pre><code>mapNestedList :: (a -&gt; b) -&gt; [[[a, a]]] -&gt; [[b, b]]\nmapNestedList f = ((map f &lt;$&gt;) =&lt;&lt;)\n\nPrelude&gt; mapNestedList (+1) [[[1,2],[5,6],[9,19]]]\n[[2,3],[6,7],[10,20]]\n</code></pre>\n\n<p>So what's going on here?</p>\n\n<ul>\n<li>The type of <code>map (+1)</code> is <code>Num a =&gt; [a] -&gt; [a]</code></li>\n<li>Remembering that <code>&lt;$&gt;</code> is in fact inline <code>fmap</code>, the type of <code>(map (+1) &lt;$&gt;)</code> turns out to be <code>(Num a, Functor f) =&gt; f [a] -&gt; f [a]</code></li>\n<li>Which means we have a functor that contains lists and we will apply a function to these lists. This functor can be a <code>Maybe</code> type or whatever. In this particular case our functor just happens to be another <code>[]</code>.</li>\n<li>Then comes <code>(=&lt;&lt;)</code> operator which is in fact the flipped version of monadic bind <code>(&gt;&gt;=)</code>. The type of <code>(=&lt;&lt;)</code> is <code>Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b</code>. As for this type signature and in this particular case, the <code>a</code> type variable stands for a type like <code>Num c =&gt; [[c]]</code> and <code>b</code> stands for <code>Num c =&gt; [c]</code>, yielding <code>m b</code> to resolve as <code>Num c =&gt; [[c]]</code> and <code>m a</code> to resolve as <code>Num c =&gt; [[[c]]]</code>.</li>\n<li>So from above given type variables for the <code>(a -&gt; m b)</code> we can use <code>((map (+1) &lt;$&gt;)</code> and the final type of <code>((map (+1) &lt;$&gt;) =&lt;&lt;)</code> turns out to be <code>(Num b, Monad m) =&gt; m (m [b]) -&gt; m [b]</code>.</li>\n</ul>\n\n<p>Once again...</p>\n\n<pre><code>Prelude&gt; mapNestedList (+1) [[[1,2],[5,6],[9,19]],[[10,20],[30,40]]]\n[[2,3],[6,7],[10,20],[11,21],[31,41]]\n</code></pre>\n"}], "owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 664, "favorite_count": 0, "accepted_answer_id": 46179797, "answer_count": 2, "score": 1, "last_activity_date": 1505292779, "creation_date": 1505218856, "last_edit_date": 1505218915, "question_id": 46176242, "link": "https://stackoverflow.com/questions/46176242/haskell-recursion-for-list-of-tuples", "title": "Haskell :: Recursion for List of Tuples", "body": "<p>I am mapping a tuple and managed to make it work for a single tuple (a, a). But when I've changed the tuple to <code>[[(a, a)]]</code>, then it says that \"couldn't match the expected type of <code>[(a, a)]</code> with <code>(a, a)</code>.</p>\n\n<pre><code>    mapTuple :: (a -&gt; b) -&gt; [[(a, a)]] -&gt; [(b, b)]\n    mapTuple f [] = []\n    mapTuple f ((a1, a2) : xs) = (f a1, f a2) : mapTuple f xs\n\n    myfunc :: Int -&gt; Int\n    myfunc xk = xk + 1\n\n\n    myTup = [[(1,2),(5,6),(9,10)]] :: [[(Int, Int)]]\n    test = mapTuple myfunc myTup\n</code></pre>\n\n<p>Couldn't break the error yet. I am missing something here. Thanks in advance for the help.</p>\n"}, {"tags": ["haskell", "f#", "catamorphism"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 6, "creation_date": 1505209661, "post_id": 46173077, "comment_id": 79308341, "body": "You can define it for a particular datatype (e.g. <code>List.fold</code>) but not generically as in your quoted example."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1505212649, "post_id": 46173077, "comment_id": 79310504, "body": "This needs higher kinds: roughly, the ability to define <code>T f = f Bool</code>, where <code>f : *-&gt;*</code>. You can do that in Haskell or Scala, but I don&#39;t know if F# allows that."}, {"owner": {"reputation": 13006, "user_id": 679898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7819f58e928d59c76fe12b30607346d6?s=128&d=identicon&r=PG", "display_name": "scrwtp", "link": "https://stackoverflow.com/users/679898/scrwtp"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1505216203, "post_id": 46173077, "comment_id": 79312817, "body": "@chi: It doesn&#39;t, outside of a defunctionalization-based encoding."}], "answers": [{"comments": [{"owner": {"reputation": 303, "user_id": 4159791, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/55fd85de8b1249fb495a8b554fa645e6?s=128&d=identicon&r=PG&f=1", "display_name": "Mario", "link": "https://stackoverflow.com/users/4159791/mario"}, "edited": false, "score": 0, "creation_date": 1505291417, "post_id": 46186244, "comment_id": 79347260, "body": "Thank you. The material looks very nice and I will go through it. Thanks."}], "tags": [], "owner": {"reputation": 13006, "user_id": 679898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7819f58e928d59c76fe12b30607346d6?s=128&d=identicon&r=PG", "display_name": "scrwtp", "link": "https://stackoverflow.com/users/679898/scrwtp"}, "is_accepted": true, "score": 13, "last_activity_date": 1505257622, "last_edit_date": 1505257622, "creation_date": 1505255546, "answer_id": 46186244, "question_id": 46173077, "link": "https://stackoverflow.com/questions/46173077/catamorphism-in-f/46186244#46186244", "title": "Catamorphism in F#", "body": "<p>If you're thinking of expressing truly generic folds over arbitrary container types, a'la <a href=\"http://blog.sumtypeofway.com/an-introduction-to-recursion-schemes/\" rel=\"noreferrer\">recursion schemes</a>, directly within the F# (or CLR for that matter) type system - you're out of luck. Too much of the required machinery is missing in the language - most crucially higher kinded types.  </p>\n\n<p>HKT's can however be encoded in F# using a technique called <a href=\"http://ocamllabs.io/higher/lightweight-higher-kinded-polymorphism.pdf\" rel=\"noreferrer\">defunctionalization</a>. There is an F# library based on the concepts from this paper - Higher. In fact, it already implements <a href=\"https://github.com/palladin/Higher/blob/master/src/Higher/Fix.fs\" rel=\"noreferrer\">fix, cata/ana/hylomorphisms</a> and <a href=\"https://github.com/palladin/Higher/blob/master/src/Higher/Algebra.fs\" rel=\"noreferrer\">algebras</a> as proofs of concept. I don't have a good gauge of how well that works though, both in terms of performance and ease of use. </p>\n\n<p>Other than that, you can implement folds specialized for your containers by hand, obviating the need for HKT's. There's a classic by now series of blog posts on implementing catamorphisms <a href=\"https://lorgonblog.wordpress.com/?s=catamorphisms\" rel=\"noreferrer\">here</a>. It's well worth reading - beside folds it also goes in-depth into programming in continuation-passing style.</p>\n"}], "owner": {"reputation": 303, "user_id": 4159791, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/55fd85de8b1249fb495a8b554fa645e6?s=128&d=identicon&r=PG&f=1", "display_name": "Mario", "link": "https://stackoverflow.com/users/4159791/mario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 559, "favorite_count": 5, "accepted_answer_id": 46186244, "answer_count": 1, "score": 14, "last_activity_date": 1505944747, "creation_date": 1505209417, "last_edit_date": 1505944747, "question_id": 46173077, "link": "https://stackoverflow.com/questions/46173077/catamorphism-in-f", "title": "Catamorphism in F#", "body": "<p>I'm reading the wikipedia article about catamorphisms and for the moment I was able to reproduce the Haskell examples in F# except for this part :</p>\n\n<pre><code>type Algebra f a = f a -&gt; a -- the generic f-algebras\n\nnewtype Fix f = Iso { invIso :: f (Fix f) } -- gives us the initial algebra for the functor f\n\ncata :: Functor f =&gt; Algebra f a -&gt; (Fix f -&gt; a) -- catamorphism from Fix f to a\ncata alg = alg . fmap (cata alg) . invIso -- note that invIso and alg map in opposite directions\n</code></pre>\n\n<p>Is this possible to do in F#?</p>\n"}, {"tags": ["haskell", "compiler-errors"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1505209892, "post_id": 46172732, "comment_id": 79308513, "body": "But <code>&lt;*&gt;</code> has type <code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b</code>... Since on the left side you write <code>(+4)</code>, Haskell reasons that <code>Num n =&gt; a ~ b ~ n</code>. But that means <code>(+3)</code> should have type <code>n</code>..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1505219157, "post_id": 46172732, "comment_id": 79314853, "body": "Even if it worked, it would mean something like <code>\\x -&gt; (+) x 4 ((+) x 3)</code> where the first <code>(+)</code> has too many arguments."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1505241503, "post_id": 46172732, "comment_id": 79329419, "body": "As it stands, it&#39;s a bit difficult to explain where your thinking is wrong because you haven&#39;t outlined your thinking. Here are some hints about how you can help us help you: Why do you expect this to return a function with one argument? Given the type <code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b</code>, what do you expect each type variable to get specialized to in <code>(+4) &lt;*&gt; (+3)</code> (what is <code>f</code>? <code>a</code>? <code>b</code>?)? What concrete type do you think would work for <code>4</code> in this expression? <code>(+4)</code>? <code>(+3)</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 5, "last_activity_date": 1505253984, "creation_date": 1505253984, "answer_id": 46186009, "question_id": 46172732, "link": "https://stackoverflow.com/questions/46172732/cannot-construct-the-infinite-type/46186009#46186009", "title": "cannot construct the infinite type", "body": "<p>The error \"Occurs check: cannot construct [an] infinite type\" results when Haskell determines that a type variable (explicitly given by the programmer or implicitly introduced by Haskell) must satisfy a condition that implies it would need to be recursively defined in terms of itself in a way that would lead to an infinitely \"deep\" type (i.e., the type variable \"occurs\" in its own definition).</p>\n\n<p>It normally results from either a typo or conceptual error on the part of the programmer related to confusing two different \"levels of structure\" in a program.</p>\n\n<p>As a simple example, a list of ints (type <code>[Int]</code>) is a valid Haskell type, and so is a list of lists of ints (<code>[[Int]]</code>) or a list of lists of lists of lists of lists of ints (<code>[[[[[Int]]]]]</code>) but only a finite number of list levels are allowed.  You can't have a list of lists of lists of lists of lists, etc. all the way down -- that would be an infinite type.  If Haskell thinks you want it to construct such a type, it'll give you an \"occurs check\" error.</p>\n\n<p>The following definition:</p>\n\n<pre><code>yuck (x:xs) = x == xs\n</code></pre>\n\n<p>gives this error for exactly this reason.  Haskell knows from the left-hand side that <code>yuck</code> takes a list of some unknown element type <code>a</code> where variable <code>x</code> is the head of type <code>a</code> and variable <code>xs</code> is the tail of type <code>[a]</code>.  From the RHS, the operator <code>(==)</code> forces <code>x</code> and <code>xs</code> to have the same type -- in other words, it implies the constraint <code>a ~ [a]</code> where the tilde indicates \"type equality\".  No finite type (no type with a finite number of list levels) has this properties, only the invalid infinite type <code>[[[[...forever...]]]]</code> could allow you to remove the outer list level and still have the same type left over, so you get the error.</p>\n\n<p>The issue here is that the programmer has confused two levels of structure:  the list <code>xs</code> and an element <code>x</code>.</p>\n\n<p>In your specific example, the reason for the error is similar, but harder to explain.  The operator:</p>\n\n<pre><code>(&lt;*&gt;) :: (Applicative f) =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>takes two applicative actions with different underlying types:  the left-hand side has type given by the applicative functor <code>f</code> applied to the underlying type <code>a -&gt; b</code>; the right-hand side has type given by the same applicative functor <code>f</code> applied to the underlying type <code>b</code>.</p>\n\n<p>You haven't told Haskell which applicative functor <code>f</code> you meant to use, so Haskell tries to infer it.  Because the LHS has type:</p>\n\n<pre><code>(+4) :: (Num n) =&gt; n -&gt; n\n</code></pre>\n\n<p>Haskell tries to match the type <code>n -&gt; n</code> with <code>f (a -&gt; b)</code>.  It may be clearer to write these types using the prefix form of the <code>(-&gt;)</code> type operator:  Haskell is trying to match <code>(-&gt;) n n</code> with <code>f ((-&gt;) a b)</code> where <code>f</code> is an applicative functor.</p>\n\n<p>Fortunately, there's an applicative functor instance for <code>(-&gt;) t</code> for any type <code>t</code>.  So, Haskell reasons that the applicative functor you want is <code>f = (-&gt;) n</code>, and it successfully matches <code>(-&gt;) n n = f n</code> to <code>f ((-&gt;) a b)</code>.  This implies that <code>n</code> is equal to <code>((-&gt;) a b)</code>.  Haskell then tries to match the types on the RHS, matching <code>(-&gt;) n n = f n</code> with <code>(-&gt;) n a = f a</code>.  This works, and it implies that <code>n</code> is equal to <code>a</code>.</p>\n\n<p>Now we have a problem.  <code>n</code> is simultaneously equal to <code>a -&gt; b</code> (from the LHS) and <code>a</code> (from the RHS).  This implies creation of an infinite function type, something that looks like:</p>\n\n<pre><code>(((... forever ...)-&gt;b)-&gt;b)-&gt;b)-&gt;b\n</code></pre>\n\n<p>which is the only way you could remove an outer <code>...-&gt;b</code> and be left with the same type.  This is an impossible infinite type, so you get the error.</p>\n\n<p>The <em>underlying</em> problem is that you've made a conceptual error.  Given that you are working on a <code>ReaderExample</code>, I think you intended to use the <code>(-&gt;) n</code> applicative functor instance, so you and Haskell are in agreement on this point.  In this context:</p>\n\n<pre><code>(+4) :: (Num n) -&gt; n -&gt; n\n</code></pre>\n\n<p>is a reader action that reads a number from the reader and adds four to it.  Similarly <code>(+3)</code> is a reader action that reads a number from the reader and adds three to it.</p>\n\n<p>However, <code>(&lt;*&gt;)</code> is an operator that takes a reader action on the LHS that reads from the reader to produce a <strong>function</strong> (not a number!) that is then applied to the result of using the RHS to read from the reader to produce a number.  For example, if you defined:</p>\n\n<pre><code>multiplyByReader :: (Num n) -&gt; n -&gt; n -&gt; n\nmultiplyByReader readerNum input = readerNum * input\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>multiplyByReader &lt;*&gt; (+4)\n</code></pre>\n\n<p>or the simpler version:</p>\n\n<pre><code>(*) &lt;*&gt; (+4)\n</code></pre>\n\n<p>would make sense.  The intended meaning would be:  Construct a reader action that (1) uses the LHS to read a number from the reader to create a  <em>function</em> that multiplies by the reader; and then (2) applies this function to the number that results from applying the RHS to the reader.</p>\n\n<p>This would be equivalent to <code>\\r -&gt; r * (r + 4)</code>, as you can see:</p>\n\n<pre><code>&gt; ((*) &lt;*&gt; (+4)) 5   -- same a 5 * (5 + 4)\n45\n&gt;\n</code></pre>\n\n<p>When you write <code>(+3) &lt;*&gt; (+4)</code>, you're mixing up two different structural levels:  the LHS reader yields a number but should instead yield a <em>function</em> that can be applied to a number.</p>\n\n<p>My best guess is that you want to create a reader action that applies <code>(+4)</code> to the reader to get a number and then applies <code>(+3)</code> to that result.  In this case, <code>(+3)</code> isn't a reader action; it's just a function you want to apply to the result of the reader action <code>(+4)</code>, which is equivalent to <code>fmap</code>ping over the reader action:</p>\n\n<pre><code>(+3) &lt;$&gt; (+4)\n</code></pre>\n\n<p>Of course, you could equivalently write it directly as:</p>\n\n<pre><code>(+3) . (+4)\n</code></pre>\n\n<p>Both are composite reader actions that add seven to the number read:</p>\n\n<pre><code>&gt; ((+3) &lt;$&gt; (+4)) 5\n12\n&gt; ((+3) . (+4)) 5\n12\n&gt;\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3075, "favorite_count": 0, "accepted_answer_id": 46186009, "answer_count": 1, "score": 0, "last_activity_date": 1505254260, "creation_date": 1505208439, "last_edit_date": 1505254260, "question_id": 46172732, "link": "https://stackoverflow.com/questions/46172732/cannot-construct-the-infinite-type", "title": "cannot construct the infinite type", "body": "<p>I want to use applicative function and tried as follow:</p>\n\n<pre><code>*ReaderExercise Control.Applicative&gt; (+4) &lt;*&gt; (+3)\n</code></pre>\n\n<p>then got following error message:</p>\n\n<pre><code>&lt;interactive&gt;:51:11: error:\n    * Occurs check: cannot construct the infinite type: a ~ a -&gt; b\n      Expected type: (a -&gt; b) -&gt; a\n        Actual type: a -&gt; a\n    * In the second argument of `(&lt;*&gt;)', namely `(+ 3)'\n      In the expression: (+ 4) &lt;*&gt; (+ 3)\n      In an equation for `it': it = (+ 4) &lt;*&gt; (+ 3)\n    * Relevant bindings include\n        it :: (a -&gt; b) -&gt; b (bound at &lt;interactive&gt;:51:1)\n</code></pre>\n\n<p>What do I expect is a return function with one argument.<br>\nWhat does it mean an infinite type?</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 0, "creation_date": 1505321637, "post_id": 46177388, "comment_id": 79368941, "body": "The problem is not with the handles returned by <code>createProcess</code> but with the ones <i>inside</i> the forked process. As suggested I will put a small example."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "edited": false, "score": 0, "creation_date": 1505322526, "post_id": 46177388, "comment_id": 79369439, "body": "I accept the answer as it lead me to the actual solution :)"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 3, "last_activity_date": 1505221901, "creation_date": 1505221901, "answer_id": 46177388, "question_id": 46172440, "link": "https://stackoverflow.com/questions/46172440/how-to-reliably-determine-if-a-handle-is-a-terminal-in-haskell/46177388#46177388", "title": "How to reliably determine if a Handle is a terminal in Haskell?", "body": "<p>Do you have a minimal example to illustrate the problem?  The following program prints \"False\" twice, suggesting that handles created with <code>CreatePipe</code> are <em>not</em> misidentified as terminal devices:</p>\n\n<pre><code>import System.Process\nimport System.IO\n\nmain = do (Just in_, Just out, err, h) &lt;-\n            createProcess $ (shell \"cat\") { std_in = CreatePipe,\n                                            std_out = CreatePipe }\n          print =&lt;&lt; hIsTerminalDevice in_\n          print =&lt;&lt; hIsTerminalDevice out\n</code></pre>\n"}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 46177388, "answer_count": 1, "score": 2, "last_activity_date": 1505322494, "creation_date": 1505207630, "last_edit_date": 1505322494, "question_id": 46172440, "link": "https://stackoverflow.com/questions/46172440/how-to-reliably-determine-if-a-handle-is-a-terminal-in-haskell", "title": "How to reliably determine if a Handle is a terminal in Haskell?", "body": "<p>I am using <code>System.IO.hIsTerminalDevice</code> to determine if a <code>Handle</code> is a terminal and apply colorization if this is the case. I noticed that when forking a process using <code>CreatePipe</code> as stream for new process stdin and stdout, this function returns <code>True</code> which seems to be the wrong answer: A pipe should not be considered as a terminal. I have tried to track down the issue looking at <code>System.IO</code> and <code>System.POSIX.IO</code> source code but it ends up in C <code>pipe</code> function and lead me nowhere.</p>\n\n<p>Is there a better way to tell if a handle is a terminal? Or am I doing something wrong?</p>\n\n<p><strong>Update</strong></p>\n\n<p>Here are 2 programs that are supposed to expose the behaviour I observed:</p>\n\n<pre><code>import           Control.Monad\nimport           System.IO\nimport           System.Process\n\nmain = do\n  (in_, Just out, Just err, h) &lt;-  createProcess $ (proc \"./test2\" [])\n                                   { std_in = CreatePipe\n                                   , std_err = CreatePipe\n                                   , std_out = CreatePipe }\n  dump out\n  where\n    dump h = forever $ do\n      ln &lt;- hGetLine h\n      putStrLn ln\n</code></pre>\n\n<p>Then `test2 :</p>\n\n<pre><code>import           System.IO\n\nmain = do\n  print =&lt;&lt; hIsTerminalDevice stderr\n  print =&lt;&lt; hIsTerminalDevice stdout\n  print =&lt;&lt; hIsTerminalDevice stdin\n</code></pre>\n\n<p>Then running the first program:</p>\n\n<pre><code>$ ./test\nFalse\nFalse\nFalse\n</code></pre>\n\n<p>I know what's happening: What I am forking is not the program itself but a <em>docker container</em>! And I explicitly add <code>-t</code> parameter which allocates a tty for the container...</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 0, "last_activity_date": 1505216682, "creation_date": 1505216682, "answer_id": 46175541, "question_id": 46172031, "link": "https://stackoverflow.com/questions/46172031/where-should-i-use-the-computes-or-computep-function-when-using-repa-array/46175541#46175541", "title": "Where should I use the &#39;computeS&#39; (or &#39;computeP&#39;) function when using Repa arrays?", "body": "<p>Do your functions use some elements of their input arrays more than once? In those cases it is usually better to run <code>computeS</code>/<code>computeP</code> first so they are computed only once.</p>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505216682, "creation_date": 1505206467, "question_id": 46172031, "link": "https://stackoverflow.com/questions/46172031/where-should-i-use-the-computes-or-computep-function-when-using-repa-array", "title": "Where should I use the &#39;computeS&#39; (or &#39;computeP&#39;) function when using Repa arrays?", "body": "<p>I have some data in a Repa array and this array is passed through a lot of functions that process the array in some way. Almost all the functions have the type <code>Array D DIM2 a -&gt; Array D DIM2 a</code> so I just composite them altogether and apply the composite function to my initial array.</p>\n\n<p>When I do this, the program runs really slow. However, when I insert the <code>computeS</code> function throughout my composite function, the code speeds up drastically. I assume this is not the intended way to work with repa arrays. What might the issue be?</p>\n"}, {"tags": ["haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1505205512, "post_id": 46171399, "comment_id": 79305314, "body": "I was confuse with the use of (1, 2, 3) with [1, 2, 3] which I think it represent a tuple and a list.  I did think why not do it this way [(x:xs)]? It is a list that is not empty [] but has a list that start with x and the rest is xs."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "edited": false, "score": 0, "creation_date": 1505205705, "post_id": 46171399, "comment_id": 79305465, "body": "You can write <code>[(x:xs)]</code>, but the parentheses don&#39;t make any difference there. Generally, parentheses only influence how the code is <i>parsed</i>, but <code>[...]</code> already parses everything within into one AST node anyway, so it doesn&#39;t matter whether you write <code>[x:xs]</code> or <code>[(x:xs)]</code> or even something like <code>(([((((x):((xs)))))]))</code>. Square brackets OTOH do make a difference, namely, they trigger the syntax desugaring. <code>[x:xs]</code> is sugar for <code>(x:xs):[]</code>, whereas <code>x:xs</code> is already desugared."}, {"owner": {"reputation": 990, "user_id": 2936186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EOPOx.jpg?s=128&g=1", "display_name": "H&#233;cate", "link": "https://stackoverflow.com/users/2936186/h%c3%a9cate"}, "edited": false, "score": 2, "creation_date": 1505205803, "post_id": 46171399, "comment_id": 79305540, "body": "The parenthesis are not the tuple constructor. They&#39;re here to isolate the several <code>,</code> (commas) which are the real tuple builders"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 990, "user_id": 2936186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EOPOx.jpg?s=128&g=1", "display_name": "H&#233;cate", "link": "https://stackoverflow.com/users/2936186/h%c3%a9cate"}, "edited": false, "score": 1, "creation_date": 1505251065, "post_id": 46171399, "comment_id": 79333749, "body": "@Uniaika that doesn&#39;t seem like a particularly useful concept considering that commas for tuples are never valid anywhere without parentheses (whereas an actual building operator would be). The tuple constructor syntactically doesn&#39;t really fit with anything else in Haskell land, which is arguably the reason it exists in the first place (because it&#39;s somewhat nicer than writing <code>Tuple3 1 2 3</code>)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1505205242, "last_edit_date": 1505205242, "creation_date": 1505204598, "answer_id": 46171399, "question_id": 46171368, "link": "https://stackoverflow.com/questions/46171368/haskell-the-use-of-brackets-in-recursion/46171399#46171399", "title": "Haskell :: The Use of Brackets in Recursion", "body": "<p><strong><code>[]</code></strong> matches the empty list.</p>\n\n<p><strong><code>[1]</code></strong> matches a list containing exactly one element, and that must be a number equal to one. Note that <code>[1]</code> is actually syntactic sugar for <code>(1:[])</code>, i.e. what this really matches is: a list beginning with the number <code>1</code>, followed by a list that is empty... which is just a complicated way of saying \u201ca list containing the single element <code>1</code>\u201d.</p>\n\n<p><strong><code>(x:xs)</code></strong> matches a list that begins with <code>x</code>, followed by <code>xs</code> (and that may contain any number of elements, possibly zero). I.e. this pattern matches any list with <strong>at least</strong> one element.</p>\n\n<p><strong><code>[x:xs]</code></strong> matches again a list which contains <strong>exactly</strong> one element, and that element should match the pattern <code>(x:xs)</code>. (Which doesn't make sense even type-wise, because your lists contain <code>Double</code>-numbers, not lists.)</p>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1505206156, "post_id": 46171749, "comment_id": 79305806, "body": "It does seem to make \u201cvisually sense\u201d to many people, but I&#39;ve never understood why. I find it much more intuitive that everything written within square brackets are single <i>elements</i>, not lists. In particular, I find the Matlab convention that <code>[a b]</code> can denote <code>a ++ b</code> completely crazy."}, {"owner": {"reputation": 990, "user_id": 2936186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EOPOx.jpg?s=128&g=1", "display_name": "H&#233;cate", "link": "https://stackoverflow.com/users/2936186/h%c3%a9cate"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1505206360, "post_id": 46171749, "comment_id": 79305945, "body": "eh, Erlang was my first programming language so I that&#39;s how I learned lists and lists comprehension. To me, the square brackets indicate a visual context for lists, in which you can do stuff like cons and list comprehensions."}], "tags": [], "owner": {"reputation": 990, "user_id": 2936186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EOPOx.jpg?s=128&g=1", "display_name": "H&#233;cate", "link": "https://stackoverflow.com/users/2936186/h%c3%a9cate"}, "is_accepted": false, "score": 3, "last_activity_date": 1505205694, "creation_date": 1505205694, "answer_id": 46171749, "question_id": 46171368, "link": "https://stackoverflow.com/questions/46171368/haskell-the-use-of-brackets-in-recursion/46171749#46171749", "title": "Haskell :: The Use of Brackets in Recursion", "body": "<p>I had the same problem because I'm coming from Erlang.  </p>\n\n<p>The thing to understand is that the [head|tail] pattern we have in Erlang is actually translated by the <code>cons</code> function in Haskell, which is the <code>:</code> operator. The parenthesis are just here to isolate the function parameters, like (3+4) would do.</p>\n\n<p>I know it's tempting to ask \"why though???\" and that it visually makes more sense, but <code>:</code> is how we build (and separate when pattern-matching) the head and the tail of a linked list.</p>\n"}], "owner": {"reputation": 179, "user_id": 8526423, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b3704e90f096e08359ec2b9e26a2fa1?s=128&d=identicon&r=PG&f=1", "display_name": "Sir DK", "link": "https://stackoverflow.com/users/8526423/sir-dk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 0, "accepted_answer_id": 46171399, "answer_count": 2, "score": 1, "last_activity_date": 1505205694, "creation_date": 1505204472, "question_id": 46171368, "link": "https://stackoverflow.com/questions/46171368/haskell-the-use-of-brackets-in-recursion", "title": "Haskell :: The Use of Brackets in Recursion", "body": "<p>I'm just wondering, for recursion example:</p>\n\n<pre><code>squaresRec :: [Double] -&gt; [Double]   \nsquaresRec [] = []                       \nsquaresRec (x:xs) = x*x : squaresRec xs\n</code></pre>\n\n<p>Why on the recursive case, there is no bracket? Shouldn't it suppose to be like this:</p>\n\n<pre><code>squaresRec :: [Double] -&gt; [Double]   \nsquaresRec [] = []                       \nsquaresRec [x:xs] = x*x : squaresRec xs\n</code></pre>\n\n<p>I know this will not work. But just wondering the explanation behind it. </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 1, "last_activity_date": 1505194060, "creation_date": 1505194060, "answer_id": 46168525, "question_id": 46168176, "link": "https://stackoverflow.com/questions/46168176/using-map-and-filter-function/46168525#46168525", "title": "Using map and filter function", "body": "<p>Some hints, but not a complete solution because this sounds like homework.  <code>mapmatrix</code> and <code>filterMatrix</code>: write functions that work on one row of your matrix at a time, then <code>map</code> those onto the list of rows.  <code>transpose'</code>: one way to do this would be with a list comprehension that applies the <code>!!</code> operator to lists of indices, and another would be a recursive function that removes one row at a time from the input and adds one column at a time to the output.</p>\n\n<p>Is <code>filterMatrix</code> supposed to return a list of lists that is not a valid matrix?</p>\n"}], "owner": {"reputation": 1, "user_id": 8577573, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4d705845f7bd83371ff45b520ed4e6c?s=128&d=identicon&r=PG&f=1", "display_name": "OG1", "link": "https://stackoverflow.com/users/8577573/og1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1505194060, "creation_date": 1505192105, "question_id": 46168176, "link": "https://stackoverflow.com/questions/46168176/using-map-and-filter-function", "title": "Using map and filter function", "body": "<p>I can't figure out how to implement the map and filter function for a matrix. Does anyone have any suggestions that would satisfy these tests?</p>\n\n<pre><code>-- | Matrix Tests\n--\n-- prop&gt; mapMatrix (\\a -&gt; a - 3) (mapMatrix (+ 3) x) == x\n--\n-- &gt;&gt;&gt; filterMatrix (&lt; 3) matrix1\n-- [[1,2],[2]]\n\n-- &gt;&gt;&gt; filterMatrix (&gt; 80) []\n-- []\n\n-- &gt;&gt;&gt; transpose' matrix2\n-- [[1,4],[5,8]]\n\n\nmapMatrix :: (a -&gt; b) -&gt; [[a]] -&gt; [[b]]\nmapMatrix f [list] = [map f list]\n\nfilterMatrix :: (a -&gt; Bool) -&gt; [[a]] -&gt; [[a]]\nfilterMatrix = undefined\n\ntranspose' :: [[a]] -&gt; [[a]]\ntranspose' = undefined\n\nmatrix1 = [[1 .. 10], [2 .. 20]]\n\nmatrix2 = [[1, 5], [4, 8]]\n</code></pre>\n"}, {"tags": ["haskell", "types", "hlist", "constraint-kinds"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1505180053, "post_id": 46166512, "comment_id": 79295349, "body": "I haven&#39;t seen one either. I&#39;ve worked on something like that a while ago, but I never had it in a form where I felt like it should be uploaded. <a href=\"https://github.com/roboguy13/existentialist/blob/master/src/Data/Existentialist.hs#L67\" rel=\"nofollow noreferrer\">Also, you can run into some weird corners of the type system exploring this</a>."}], "answers": [{"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1505181612, "post_id": 46166762, "comment_id": 79295694, "body": "A related question, is &quot;Exists&quot; anywhere? I&#39;ve uploaded &quot;polydata&quot; which is basically &quot;Exists&quot;, but I might as well someone else&#39;s package if it already exists to save duplication <a href=\"https://hackage.haskell.org/package/polydata-0.1.0.0/docs/Data-Poly.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/polydata-0.1.0.0/docs/&hellip;</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1505181766, "post_id": 46166762, "comment_id": 79295720, "body": "It&#39;s old but searching around there appears to be a package called <a href=\"http://hackage.haskell.org/package/exists-0.2/docs/Data-Exists.html\" rel=\"nofollow noreferrer\"><code>exists</code></a>..."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1505182074, "post_id": 46166762, "comment_id": 79295794, "body": "Oh hang on, Exists and Poly are different."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1505184764, "post_id": 46166762, "comment_id": 79296391, "body": "@Alec To construct <code>Exists c</code> you need to find a single example <code>a</code> such that <code>c a</code>. To construct <code>Poly c</code> you must show that an <code>a</code> exists for all <code>a</code> such that <code>c a</code>. I think the terminology is <code>Exists</code> is &quot;existentially quantified&quot; and <code>Poly</code> is &quot;universally quantified&quot;."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1505185025, "post_id": 46166762, "comment_id": 79296434, "body": "@Cirdec thanks! The haddock was tripping me up. Looking at the source code, I see what you mean."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1505185952, "post_id": 46166762, "comment_id": 79296678, "body": "I <a href=\"http://tunes.org/~nef/logs/haskell/17.01.25\" rel=\"nofollow noreferrer\">asked about whether your <code>Exists</code> type is in a library somewhere on IRC some time ago</a> (conversation starts around 21:34). At that time nobody knew of a place that offered it, but folks did suggest some <a href=\"http://lpaste.net/351658\" rel=\"nofollow noreferrer\">cute</a> <a href=\"https://github.com/glguy/operations\" rel=\"nofollow noreferrer\">ideas</a>."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1505215386, "post_id": 46166762, "comment_id": 79312267, "body": "Why not use a type family to build the constraint <code>All c as</code> (<code>All c &#39;[] = (); All c (a &#39;: as) = (c a, All c as)</code>) rather than converting from <code>Hlist as</code> to <code>[Exist c]</code> which makes you lose information about the <code>as</code>?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1505227173, "post_id": 46166762, "comment_id": 79321086, "body": "@gallais Just a matter of taste. The problem with doing that is how to use &#39;All&#39; afterwards."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1505229017, "post_id": 46166762, "comment_id": 79322498, "body": "@gallais Note that <code>ForallC as c</code> also holds exactly when <code>All c as</code> holds too - its just also lets you <i>do</i> something with that information."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1505231254, "post_id": 46166762, "comment_id": 79323988, "body": "I don&#39;t see why you wouldn&#39;t be able to do something with <code>All c as</code>. You&#39;d access constraints just like you access values in an HList: using an index."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1505231640, "post_id": 46166762, "comment_id": 79324252, "body": "@gallais I&#39;m not sure I see what you mean, but I wish I did because it sounds interesting. Do you have some example somewhere of how this works for <code>All</code> (or something similar)?"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1505236621, "post_id": 46166762, "comment_id": 79327090, "body": "What about something like this? <a href=\"https://gist.github.com/gallais/48b6dba11b1fd57d4a7386cfe502ff94\" rel=\"nofollow noreferrer\">gist.github.com/gallais/48b6dba11b1fd57d4a7386cfe502ff94</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1505236746, "post_id": 46166762, "comment_id": 79327144, "body": "@gallais Thanks! I see what you mean now. :)"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 1, "creation_date": 1505245718, "post_id": 46166762, "comment_id": 79331354, "body": "I would argue that a type family <code>All</code> makes it much <i>easier</i> to actually use the constraints in practice than using just a type class. There&#39;s then no reason to first compute some term-level form where dictionaries are attached to values."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1505429295, "post_id": 46166762, "comment_id": 79422451, "body": "Quick update: a <a href=\"https://www.reddit.com/r/haskell/comments/7056me/discovered_that_one_can_do_this_data_t_a_where_t/dn0iypo/\" rel=\"nofollow noreferrer\">reddit post</a> suggests the <a href=\"https://hackage.haskell.org/package/exists-0.2/docs/Data-Exists.html\" rel=\"nofollow noreferrer\">exists</a> package for your <code>Exists</code> type."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1505429396, "post_id": 46166762, "comment_id": 79422481, "body": "@DanielWagner That package was already linked to in the second comment. :)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1505446711, "post_id": 46166762, "comment_id": 79426188, "body": "@Alec Yeesh, I must be blind!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 9, "last_activity_date": 1505196539, "last_edit_date": 1505196539, "creation_date": 1505181446, "answer_id": 46166762, "question_id": 46166512, "link": "https://stackoverflow.com/questions/46166512/constrained-heterogeneous-list/46166762#46166762", "title": "Constrained heterogeneous list", "body": "<p>I'm not sure this data type is useful...</p>\n\n<ul>\n<li><p>If you really want <code>a</code> to be existentially qualified, I think you should use regular lists. The more interesting data type here would be <code>Exists</code>, although I'm certain there are variants of it all over <s>package</s> Hackage already:</p>\n\n<pre><code>data Exists c where\n  Exists :: c a =&gt; a -&gt; Exists c\n</code></pre>\n\n<p>Then, your <code>HList c</code> is isomorphic to <code>[Exists c]</code> and you can still use all of the usual list based functions.</p></li>\n<li><p>On the other hand, if you don't necessarily want <code>a</code> in the <code>(:-) :: c a =&gt; a -&gt; HList c</code> to be existentially qualified (having it as such sort of defies the point of the <code>HList</code>), you should instead define the following:</p>\n\n<pre><code>data HList (as :: [*]) where\n  (:-) :: a -&gt; HList as -&gt; HList (a ': as)\n  Nil :: HList '[]\n</code></pre>\n\n<p>Then, if you want to require that all entries of the <code>HList</code> satisfy <code>c</code>, you can make a type class to witness the injection from <code>HList as</code> into <code>[Exists c]</code> whose instance resolution only works if all the types in the <code>HList</code> satisfy the constraint:</p>\n\n<pre><code>class ForallC as c where\n  asList :: HList as -&gt; [Exists c]\n\ninstance ForallC '[] c where\n  asList Nil = []\n\ninstance (c a, ForallC as c) =&gt; ForallC (a ': as) c where\n  asList (x :- xs) = Exists x : asList xs\n</code></pre></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": false, "score": 5, "last_activity_date": 1505245501, "last_edit_date": 1505245501, "creation_date": 1505197423, "answer_id": 46169295, "question_id": 46166512, "link": "https://stackoverflow.com/questions/46166512/constrained-heterogeneous-list/46169295#46169295", "title": "Constrained heterogeneous list", "body": "<p>The <code>generics-sop</code> package offers this out of the box.</p>\n\n<p>A heterogeneous list can be defined in <code>generics-sop</code> by using</p>\n\n<pre><code>data NP :: (k -&gt; *) -&gt; [k] -&gt; * where\n  Nil  :: NP f '[]\n  (:*) :: f x -&gt; NP f xs -&gt; NP f (x ': xs)\n</code></pre>\n\n<p>and instantiating it to the identity type constructor <code>I</code> (from <code>generics-sop</code>) or <code>Identity</code> (from <code>Data.Functor.Identity</code>).</p>\n\n<p>The library then offers the constraint <code>All</code> such that e.g.</p>\n\n<pre><code>All Show xs =&gt; NP I xs\n</code></pre>\n\n<p>is the type of a heterogeneous list where all contained types are in the <code>Show</code> class. Conceptually, <code>All</code> is a type family that computes the constraint for every element in a type-level list:</p>\n\n<pre><code>type family All (f :: k -&gt; Constraint) (xs :: [k]) :: Constraint where\n  All c '[]       = ()\n  All c (x ': xs) = (c x, All c xs)\n</code></pre>\n\n<p>(Only that in the actual definition, <code>All</code> is additionally wrapped in a type class so that it can be partially applied.)</p>\n\n<p>The library furthermore offers all sorts of functions that traverse and transform <code>NP</code>s given a common constraint.</p>\n"}, {"comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1505245987, "post_id": 46179936, "comment_id": 79331494, "body": "As discussed in the other answers, I think you&#39;d be somewhat better off with turning <code>All</code> into a type family and not explicitly computing the <code>dicts</code>, but just using them directly. For this purpose, <code>generics-sop</code> offers &quot;constrained&quot; versions of functions such as your <code>zipHKList</code> that can use and distribute an <code>All</code> constraint over the elements."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 3, "last_activity_date": 1505228947, "creation_date": 1505228947, "answer_id": 46179936, "question_id": 46166512, "link": "https://stackoverflow.com/questions/46166512/constrained-heterogeneous-list/46179936#46179936", "title": "Constrained heterogeneous list", "body": "<p>What you really want is</p>\n\n<pre><code>data HKList :: (k -&gt; *) -&gt; [k] -&gt; * where\n  Nil  :: HKList f '[]\n  (:*) :: f x -&gt; HKList f xs -&gt; HKList f (x ': xs)\n</code></pre>\n\n<p>Which you can use either as an ordinary heterogeneous list</p>\n\n<pre><code>type HList = HKList Identity\n</code></pre>\n\n<p>Or with extra information of some constant type <code>e</code> attached to each value (or other interesting functors)</p>\n\n<pre><code>HKList ((,) e)\n</code></pre>\n\n<p>Or with extra information captured in a dictionary</p>\n\n<pre><code>data Has c a where\n    Has :: c a =&gt; a -&gt; Has c a\n\ntype ConstrainedList c = HKList (Has c)\n</code></pre>\n\n<p>Or keep lists of only captured constraints</p>\n\n<pre><code>data Dict1 :: (k -&gt; Constraint) -&gt; k -&gt; * where\n  Dict1 :: c k =&gt; Dict1 c k\n</code></pre>\n\n<p>Which you can use to define the idea of all of a list of types satisfying a constraint</p>\n\n<pre><code>class All c xs where\n  dicts :: HKList (Dict1 c) xs\n\ninstance All c '[] where\n  dicts = Nil\n\ninstance (All c xs, c x) =&gt; All c (x ': xs) where\n  dicts = Dict1 :* dicts\n</code></pre>\n\n<p>Or anything else you can do with a kind <code>k -&gt; *</code></p>\n\n<p>You can freely convert between working with <code>All c xs =&gt; HList xs</code> and <code>HKList (Has c) xs</code></p>\n\n<pre><code>zipHKList :: (forall k. f k -&gt; g k -&gt; h k) -&gt; HKList f xs -&gt; HKList g xs -&gt; HKList h xs\nzipHKList _ Nil Nil = Nil\nzipHKList f (x :* xs) (y :* ys) = f x y :* zipHKList f xs ys\n\nallToHas :: All c xs =&gt; HKList Identity xs -&gt; HKList (Has c) xs\nallToHas xs = zipHKList f dicts xs\n  where\n    f :: Dict1 c k -&gt; Identity k -&gt; Has c k\n    f Dict1 (Identity x) = Has x\n\nhasToAll :: HKList (Has c) xs -&gt; Dict (All c xs)\nhasToAll Nil = Dict\nhasToAll (Has x :* xs) =\n  case hasToAll xs of\n    Dict -&gt; Dict\n</code></pre>\n\n<p><a href=\"https://gist.github.com/Cedev/415eecdc17bbdba9f6c25964c8ddb4e7\" rel=\"nofollow noreferrer\">full code</a></p>\n\n<p>I've written this a few times before for various projects, but I didn't know it was in a library anywhere until <a href=\"https://stackoverflow.com/a/46169295/414413\">Kosmikus pointed out that it's in <code>generics-sop</code></a>.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 1, "answer_count": 3, "score": 5, "last_activity_date": 1505245501, "creation_date": 1505179622, "last_edit_date": 1505181522, "question_id": 46166512, "link": "https://stackoverflow.com/questions/46166512/constrained-heterogeneous-list", "title": "Constrained heterogeneous list", "body": "<p>I searched Hackage and couldn't find anything like the following but it seems to be fairly simple and useful. Is there a library that contains sort of data type?</p>\n\n<pre><code>data HList c where\n  (:-) :: c a =&gt; a -&gt; HList c\n  Nil :: HList c\n</code></pre>\n\n<p>All the HLists I found could have any type, and weren't constrained.</p>\n\n<p>If there isn't I'll upload my own.</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1505167987, "post_id": 46164070, "comment_id": 79292573, "body": "What&#39;s the code that&#39;s doing the filesaving so far? I think having a look at that might be helpful."}, {"owner": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1505171716, "post_id": 46164070, "comment_id": 79293569, "body": "@AJFarmar the file saving is spread across a few functions, is there a specific part that you would like to see / think would be useful? I can put all of them up if you want but I thought I would ask first."}], "answers": [{"comments": [{"owner": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "edited": false, "score": 0, "creation_date": 1505171592, "post_id": 46165089, "comment_id": 79293544, "body": "Thanks for the reply. I&#39;m a bit confused about how to use the handler function e.g. when I want to use it as the source of an image tag. Should I create a new Route for avatars? In your answer you showed the path still being in static, I already had a way of serving the images in static using StaticR but the problem was that they were being cached therefore when a user uploaded a new image it wasn&#39;t showing the new one even though the file in the file system was updated, wouldn&#39;t your answer have the same problem?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "edited": false, "score": 0, "creation_date": 1505174512, "post_id": 46165089, "comment_id": 79294198, "body": "@JamesBurton As indicated in my answer, I would recommend you to store the timestamp of the image (in the day part). That way, you are guaranteed to get unique urls for picture uploads."}, {"owner": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "edited": false, "score": 0, "creation_date": 1505174920, "post_id": 46165089, "comment_id": 79294279, "body": "Ok, is there a reason I should user the handler in your answer instead of generating StaticR routes like I did before?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "edited": false, "score": 0, "creation_date": 1505175646, "post_id": 46165089, "comment_id": 79294457, "body": "@JamesBurton You don&#39;t need to use my handlers at all and I would recommend you to not use one since it&#39;s already accessible via the <code>&#47;static</code> path! That was just a demo example."}, {"owner": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "edited": false, "score": 0, "creation_date": 1505176557, "post_id": 46165089, "comment_id": 79294685, "body": "Ok thanks. I&#39;ll add your suggestion of using the timestamp into my current implementation."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 3, "last_activity_date": 1505168285, "creation_date": 1505168285, "answer_id": 46165089, "question_id": 46164070, "link": "https://stackoverflow.com/questions/46164070/yesod-should-user-profile-pictures-be-stored-in-the-static-directory/46165089#46165089", "title": "Yesod - Should user profile pictures be stored in the static directory?", "body": "<blockquote>\n  <p>I know I could create a route along the lines of /avatars/#Day/#UserId but I'm not sure how I would get the \".png\" or \".jpg\" appended to th</p>\n</blockquote>\n\n<p>There is no need that your url should end up with a <code>png</code> or <code>jpeg</code> extension. All you need to make sure is that your content type header is set properly.</p>\n\n<blockquote>\n  <p>Or what I would write for the handler function.</p>\n</blockquote>\n\n<p>That's quite simple. If you are serving <code>png</code> images, then all you have to do is use the functions <a href=\"https://www.stackage.org/haddock/lts-9.0/yesod-core-1.4.35.1/Yesod-Core-Handler.html#v:sendFile\" rel=\"nofollow noreferrer\">sendFile</a> and <a href=\"https://www.stackage.org/haddock/lts-9.4/yesod-core-1.4.36/Yesod-Core-Content.html#v:typePng\" rel=\"nofollow noreferrer\">typePng</a> to serve them:</p>\n\n<pre><code>myAvatarHandler = sendFile typePng \"/home/yesod/static/avatars/day/userid.png\"\n</code></pre>\n\n<p>Also in your example, make sure to store timestamp of the upload and change your url according to that. Or else two profile images updated in the same day will be cached.</p>\n"}], "owner": {"reputation": 661, "user_id": 7720738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HccZv.png?s=128&g=1", "display_name": "James Burton", "link": "https://stackoverflow.com/users/7720738/james-burton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "accepted_answer_id": 46165089, "answer_count": 1, "score": 3, "last_activity_date": 1505168285, "creation_date": 1505162567, "question_id": 46164070, "link": "https://stackoverflow.com/questions/46164070/yesod-should-user-profile-pictures-be-stored-in-the-static-directory", "title": "Yesod - Should user profile pictures be stored in the static directory?", "body": "<p>Currently profile pictures that the users upload are saved to /static/avatars/{upload-date}. I then generate the StaticR route for the image via information stored in the database (they were added at runtime so the StaticR route doesn't already exist).</p>\n\n<p>The problem I've run into is that when a user updates their profile picture they still get the old one due to the caching of static files. Is there some way around this or should I be storing the images somewhere else? If so then how do I go about accessing the images from say /avatars/{upload-date}/{userid}.png?</p>\n\n<p>I know I could create a route along the lines of /avatars/#Day/#UserId but I'm not sure how I would get the \".png\" or \".jpg\" appended to that. Or what I would write for the handler function.</p>\n"}, {"tags": ["haskell", "request", "httpclient"], "comments": [{"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1505149564, "post_id": 46160838, "comment_id": 79283865, "body": "the error is pretty straightforward, you are passing a <code>String</code> or <code>[Char]</code> as parameter, but he wants a <code>Request</code>, probably you need to build that"}, {"owner": {"reputation": 31108, "user_id": 350351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b1a41bbf4677c8961237c4d147e764d6?s=128&d=identicon&r=PG", "display_name": "Daenyth", "link": "https://stackoverflow.com/users/350351/daenyth"}, "edited": false, "score": 6, "creation_date": 1505149620, "post_id": 46160838, "comment_id": 79283893, "body": "Are you using <code>OverloadedStrings</code>?"}, {"owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "edited": false, "score": 0, "creation_date": 1505149679, "post_id": 46160838, "comment_id": 79283922, "body": "Is it possible that <code>httpLBS</code> is not the same as <a href=\"https://hackage.haskell.org/package/http-client-0.5.7.0/docs/Network-HTTP-Client.html#v:httpLbs\" rel=\"nofollow noreferrer\"><code>httpLbs</code></a>?"}, {"owner": {"reputation": 660, "user_id": 3056525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ca5b6203fc7b814d6c2559be8354a0d?s=128&d=identicon&r=PG", "display_name": "TomDane", "link": "https://stackoverflow.com/users/3056525/tomdane"}, "reply_to_user": {"reputation": 31108, "user_id": 350351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b1a41bbf4677c8961237c4d147e764d6?s=128&d=identicon&r=PG", "display_name": "Daenyth", "link": "https://stackoverflow.com/users/350351/daenyth"}, "edited": false, "score": 0, "creation_date": 1505153730, "post_id": 46160838, "comment_id": 79286006, "body": "@Daenyth yes I do have OverloadedStrings active. Should have mentioned that, apologies. Here is the full file <a href=\"https://github.com/thomasdane/haskellApi/blob/master/src/Main.hs\" rel=\"nofollow noreferrer\">github.com/thomasdane/haskellApi/blob/master/src/Main.hs</a>"}, {"owner": {"reputation": 110, "user_id": 3982150, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b47baacc0b5111efb0f12ea9d315a1c?s=128&d=identicon&r=PG&f=1", "display_name": "FintanH", "link": "https://stackoverflow.com/users/3982150/fintanh"}, "edited": false, "score": 0, "creation_date": 1505154354, "post_id": 46160838, "comment_id": 79286317, "body": "Just to drop in the solution via your gist: <a href=\"https://gist.github.com/FintanH/84d4b50c52646f1c82a8ea79afc327fe\" rel=\"nofollow noreferrer\">gist.github.com/FintanH/84d4b50c52646f1c82a8ea79afc327fe</a>"}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "reply_to_user": {"reputation": 110, "user_id": 3982150, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b47baacc0b5111efb0f12ea9d315a1c?s=128&d=identicon&r=PG&f=1", "display_name": "FintanH", "link": "https://stackoverflow.com/users/3982150/fintanh"}, "edited": false, "score": 0, "creation_date": 1505165983, "post_id": 46160838, "comment_id": 79291922, "body": "@FintanH I think your solution is tricky, here I would prefer to use <code>parseRequest</code>. Or at least add type signatures and rename <code>url</code> to <code>request</code>"}], "owner": {"reputation": 660, "user_id": 3056525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ca5b6203fc7b814d6c2559be8354a0d?s=128&d=identicon&r=PG", "display_name": "TomDane", "link": "https://stackoverflow.com/users/3056525/tomdane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1505149268, "creation_date": 1505149268, "question_id": 46160838, "link": "https://stackoverflow.com/questions/46160838/cannot-pass-parameter-to-httplbs-in-network-http-simple", "title": "Cannot pass parameter to httpLBS in Network.HTTP.Simple", "body": "<p>I can't figure out why the following code works:</p>\n\n<pre><code>main = do\n    response &lt;- httpLBS \"http://httpbin.org/get\"\n    let statusCode = show $ getResponseStatusCode response\n    putStrLn statusCode\n</code></pre>\n\n<p>But this does not:</p>\n\n<pre><code>getStatusCode url = do\n response &lt;- httpLBS url\n let statusCode = show $ getResponseStatusCode response\n putStrLn statusCode\n</code></pre>\n\n<p>When called like <code>getStatusCode \"http://httpbin.org/get\"</code> I get the following error:</p>\n\n<pre><code>&lt;interactive&gt;:38:15: error:\n    * Couldn't match expected type `Request' with actual type `[Char]'\n    * In the first argument of `getStatusCode', namely\n        `\"http://httpbin.org/get\"'\n      In the expression: getStatusCode \"http://httpbin.org/get\"\n      In an equation for `it':\n          it = getStatusCode \"http://httpbin.org/get\"\n</code></pre>\n\n<p>The error message seems to imply that httpLBS needs a Request type. But I can't figure out why the first one works in that case.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1505147981, "post_id": 46160365, "comment_id": 79283040, "body": "Can you write a function of type <code>ShowFile -&gt; IO ()</code> which does what you want? Replace <code>print</code> with that function."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1505156954, "post_id": 46160365, "comment_id": 79287702, "body": "if you run into (run-time) problems with cmdargs - try &quot;optparse applicative&quot;, I had a few problems with it quite recently, and switched over to that. But it might be a bit more difficult to work with that as a beginner."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1505148039, "creation_date": 1505148039, "answer_id": 46160523, "question_id": 46160365, "link": "https://stackoverflow.com/questions/46160365/how-can-i-fix-my-simple-haskell-cli-program-to-show-the-contents-of-a-file/46160523#46160523", "title": "How can I fix my simple Haskell CLI program to show the contents of a file?", "body": "<p>Pattern match on the option.</p>\n\n<pre><code>main = do\n    options &lt;- cmdArgs showFile\n    contents &lt;- case options of\n        ShowFile { file = Nothing } -&gt; getContents\n        ShowFile { file = Just f  } -&gt; readFile f\n    putStr contents\n</code></pre>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 46160523, "answer_count": 1, "score": 0, "last_activity_date": 1505148039, "creation_date": 1505147497, "question_id": 46160365, "link": "https://stackoverflow.com/questions/46160365/how-can-i-fix-my-simple-haskell-cli-program-to-show-the-contents-of-a-file", "title": "How can I fix my simple Haskell CLI program to show the contents of a file?", "body": "<p>So I'm going through the examples in the <a href=\"http://community.haskell.org/~ndm/darcs/cmdargs/cmdargs.htm\" rel=\"nofollow noreferrer\">CmdArgs documentation</a>, and I'm trying to build off the Hello World program in order to make a simple CLI program that takes a filename as input, and just shows the contents of that file (like <code>cat</code>). But I'm a Haskell beginner, and have virtually no idea what I'm doing. Here's what I have so far:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\nmodule ShowFile where\nimport System.Console.CmdArgs\n\ndata ShowFile = ShowFile {file :: Maybe FilePath}\n              deriving (Show, Data, Typeable)\n\nshowFile = ShowFile\n  {file = def &amp;= typ \"FILE\" &amp;= argPos 0}\n\nmain = print =&lt;&lt; cmdArgs showFile\n</code></pre>\n\n<p>And so running <code>runhaskell mycat.hs test.txt</code> shows: </p>\n\n<pre><code>ShowFile {file = Just \"test.txt\"}\n</code></pre>\n\n<p>So something's working! Now how do I get it to display the contents of <code>test.txt</code> instead? I've been trying things like: </p>\n\n<pre><code>main = getContents showFile\n</code></pre>\n\n<p>but haven't stumbled on the right thing yet.</p>\n"}, {"tags": ["haskell", "monad-transformers", "state-monad"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1505146734, "post_id": 46159712, "comment_id": 79282327, "body": "You can&#39;t. All a transformer adds is <code>lift :: m a -&gt; t m a</code>. There&#39;s no generic way to implement what you&#39;re trying to do given just <code>Monad</code> and <code>MonadTrans</code> (the whole notion of &quot;running&quot; things isn&#39;t even part of the monad transformer concept). You can have specialized functions like in the answer, but no generic solution."}], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": false, "score": 5, "last_activity_date": 1505146679, "creation_date": 1505146679, "answer_id": 46160143, "question_id": 46159712, "link": "https://stackoverflow.com/questions/46159712/evalstate-in-a-monad-transformer-stack/46160143#46160143", "title": "evalState in a monad transformer stack", "body": "<p>I'm not aware of anything as general as your <code>split</code>, but using the <code>map...T</code> functions could prevent the explicit manipulation:</p>\n\n<pre><code>have :: ExceptT String (WriterT String (State s)) a\nf    :: State s a -&gt; a\n\nwant :: ExceptT String (WriterT String Identity) a\nwant = mapExceptT (mapWriterT (return . f)) have\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1505162368, "post_id": 46163978, "comment_id": 79290441, "body": "<code>hoist</code> was precisely what I was looking for."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1505239870, "last_edit_date": 1505239870, "creation_date": 1505162168, "answer_id": 46163978, "question_id": 46159712, "link": "https://stackoverflow.com/questions/46159712/evalstate-in-a-monad-transformer-stack/46163978#46163978", "title": "evalState in a monad transformer stack", "body": "<p>The approach that seems simplest in this particular case is to use the <code>MFunctor</code> instances of the <code>ExceptT e</code> and <code>WriterT w</code> transformers:</p>\n\n<pre><code>import Control.Monad.Morph\n\nfloop :: Monad m\n      =&gt; s\n      -&gt; ExceptT e (WriterT w (StateT s m)) a\n      -&gt; ExceptT e (WriterT w m) a\nfloop s = hoist (hoist $ flip evalStateT s)\n</code></pre>\n\n<p>Since <code>State s = StateT s Identity</code>, the slight generalization above is immediate.</p>\n"}], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 46163978, "answer_count": 2, "score": 1, "last_activity_date": 1505239870, "creation_date": 1505145205, "question_id": 46159712, "link": "https://stackoverflow.com/questions/46159712/evalstate-in-a-monad-transformer-stack", "title": "evalState in a monad transformer stack", "body": "<p>Given a <code>mtl</code> monad stack, e.g. <code>ExceptT String (WriterT String (State s a))</code>, how can I evaluate the inner state monad without needing to unwrap the outer monads?</p>\n\n<pre><code>have :: ExceptT String (WriterT String (State s)) a\nf    :: State s a -&gt; a\n\nwant :: ExceptT String (WriterT String Identity) a\n</code></pre>\n\n<p>I can do this by calling <code>runExceptT</code> followed by <code>runWriterT</code> and repacking the results afterward but it seems like the wrong way to accomplish this.</p>\n\n<hr>\n\n<p>As far as I tried, something like <code>fmap</code> or similar won't work because the monad transformer stack is treated as an entire monad on it's own. What I need is a functionality to \"split\" the monad transformer stack like this:</p>\n\n<pre><code>split :: (MonadTrans s, Monad t) =&gt; (s t) a -&gt; s (t a)\n</code></pre>\n\n<p>Either I haven't found this function or the solution works entirely differently.</p>\n"}, {"tags": ["haskell", "xmonad"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1505150998, "post_id": 46159643, "comment_id": 79284599, "body": "Does changing <code>mediaLayout = noBorders Full $ withIM ...</code> to <code>mediaLayout = noBorders Full ||| withIM ...</code> help?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1505157281, "post_id": 46159643, "comment_id": 79287861, "body": "Please include the relevant code into the question itself. If possible, create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 47, "user_id": 5694875, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/10208320945929364/picture?type=large", "display_name": "Jorge C&#252;rbera", "link": "https://stackoverflow.com/users/5694875/jorge-c%c3%bcrbera"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1505215470, "post_id": 46159643, "comment_id": 79312334, "body": "@arrowd Nope, it throws a different error."}, {"owner": {"reputation": 47, "user_id": 5694875, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/10208320945929364/picture?type=large", "display_name": "Jorge C&#252;rbera", "link": "https://stackoverflow.com/users/5694875/jorge-c%c3%bcrbera"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1505215531, "post_id": 46159643, "comment_id": 79312367, "body": "@Zeta Ok, I&#39;ll do"}], "answers": [{"tags": [], "owner": {"reputation": 2385, "user_id": 165544, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/81a96d91153ee37ffb2f77e6ff95238d?s=128&d=identicon&r=PG", "display_name": "danr", "link": "https://stackoverflow.com/users/165544/danr"}, "is_accepted": false, "score": 0, "last_activity_date": 1506242651, "creation_date": 1506242651, "answer_id": 46388246, "question_id": 46159643, "link": "https://stackoverflow.com/questions/46159643/haskell-ambiguous-type-variable-in-xmonad-configuration/46388246#46388246", "title": "Haskell Ambiguous type variable in xmonad configuration", "body": "<p>The problem is the <code>mediaLayout</code> definition, you're applying <code>noBorders Full</code> to something but it is a layout! Did you want it to be something like this below?</p>\n\n<pre><code>mediaLayout = noBorders Full |||\n       ( withIM 0.11 (Role \"gimp-toolbox\") $ reflectHoriz\n       $ withIM 0.15 (Role \"gimp-dock\") (trackFloating simpleTabbed)\n       )\n</code></pre>\n"}], "owner": {"reputation": 47, "user_id": 5694875, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/10208320945929364/picture?type=large", "display_name": "Jorge C&#252;rbera", "link": "https://stackoverflow.com/users/5694875/jorge-c%c3%bcrbera"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 439, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1506242651, "creation_date": 1505145002, "last_edit_date": 1505216023, "question_id": 46159643, "link": "https://stackoverflow.com/questions/46159643/haskell-ambiguous-type-variable-in-xmonad-configuration", "title": "Haskell Ambiguous type variable in xmonad configuration", "body": "<p>I have an old xmonad config done by me copying blocks from other configs. I haven't much knowledge in Haskell so I have done my best till the moment. The thing is older compiler didn't complain about the this line in question but now shows an Ambigous type variable error.</p>\n\n<p>I've checked other thread about similar problems but still cant figure how to solve my issue so if anyone could enlight me with any kind of answer I would be enormously thankfull.</p>\n\n<p>The first Ambiguous type variable is shown after this expression:</p>\n\n<pre><code>xmonad $ defaultConfig\n  { terminal            = myTerminal\n  , workspaces          = myWorkspaces\n  , keys                = myKeys\n  , modMask             = mymodMask\n  , layoutHook          = myLayoutHook\n  , manageHook          = manageSpawn &lt;+&gt; myManageHook\n  , logHook             = myLogHook dzenLeftBar\n  , normalBorderColor   = colorNormalBorder\n  , focusedBorderColor  = colorFocusedBorder\n  , borderWidth         = 0\n  , startupHook  = myStartupHook }\n</code></pre>\n\n<p>And the error is:</p>\n\n<pre><code>xmonad.hs:86:5: error:\n        * Ambiguous type variable `l10` arising from a use of `xmonad`\n          prevents the constraint `(LayoutClass\n                                      l10 GHC.Word.Word64)` from being solved.\n          Probable fix: use a type annotation to specify what `l10` should be.\n</code></pre>\n\n<p>The second error is thrown by the following expression:</p>\n\n<pre><code>onWorkspaces [\"7:media\"] mediaLayout $\n</code></pre>\n\n<p>And the error code is basically the same.</p>\n\n<p>The full config file is this: <a href=\"https://paste.pound-python.org/show/BXD7gxeTXq14c5hQHwyK/\" rel=\"nofollow noreferrer\">https://paste.pound-python.org/show/BXD7gxeTXq14c5hQHwyK/</a></p>\n\n<p>And the errors showed in the compiler are the following:</p>\n\n<pre><code>xmonad.hs:86:5: error:\n    * Ambiguous type variable `l10` arising from a use of `xmonad`\n      prevents the constraint `(LayoutClass\n                                  l10 GHC.Word.Word64)` from being solved.\n      Probable fix: use a type annotation to specify what `l10` should be.\n      These potential instances exist:\n        instance (LayoutClass l a, LayoutClass r a) =&gt;\n                 LayoutClass (Choose l r) a\n          -- Defined in `XMonad.Layout`\n        instance LayoutClass Full a -- Defined in `XMonad.Layout`\n        instance LayoutClass l a =&gt; LayoutClass (Mirror l) a\n          -- Defined in `XMonad.Layout`\n        ...plus four others\n\n        ...plus five instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    * In a stmt of a 'do' block:\n        xmonad\n        $ defaultConfig\n            {terminal = myTerminal, workspaces = myWorkspaces, keys = myKeys,\n             modMask = mymodMask, layoutHook = myLayoutHook,\n             manageHook = manageSpawn &lt;+&gt; myManageHook,\n             logHook = myLogHook dzenLeftBar,\n             normalBorderColor = colorNormalBorder,\n             focusedBorderColor = colorFocusedBorder, borderWidth = 0,\n             startupHook = myStartupHook}\n      In the expression:\n        do { dzenLeftBar &lt;- spawnPipe myXmonadBar;\n             dzenStatusBar &lt;- spawnPipe myStatusBar;\n             dzenTrayBar &lt;- spawnPipe myTrayBar;\n             dzenMpdBar &lt;- spawnPipe myMpdBar;\n             .... }\n      In an equation for `main`:\n          main\n            = do { dzenLeftBar &lt;- spawnPipe myXmonadBar;\n                   dzenStatusBar &lt;- spawnPipe myStatusBar;\n                   dzenTrayBar &lt;- spawnPipe myTrayBar;\n                   .... }\n\nxmonad.hs:180:17: error:\n    * Ambiguous type variable `l10` arising from a use of `onWorkspaces`\n      prevents the constraint `(LayoutClass\n                                  l10 Window)` from being solved.\n      Relevant bindings include\n        myLayoutHook :: XMonad.Layout.PerWorkspace.PerWorkspace\n                          (ModifiedLayout\n                             AvoidStruts\n                             (Choose\n                                (ModifiedLayout Spacing ResizableTall)\n                                (Choose\n                                   (Mirror (ModifiedLayout Spacing ResizableTall))\n                                   (Choose\n                                      (ModifiedLayout XMonad.Layout.NoBorders.WithBorder Full)\n                                      (ModifiedLayout\n                                         (XMonad.Layout.Decoration.Decoration\n                                            SimpleDecoration\n                                            XMonad.Layout.Decoration.DefaultShrinker)\n                                         (ModifiedLayout\n                                            XMonad.Actions.MouseResize.MouseResize\n                                            (ModifiedLayout\n                                               XMonad.Layout.WindowArranger.WindowArranger\n                                               SimpleFloat)))))))\n                          (XMonad.Layout.PerWorkspace.PerWorkspace\n                             (ModifiedLayout\n                                AvoidStruts\n                                (Choose\n                                   (ModifiedLayout\n                                      XMonad.Layout.NoBorders.WithBorder\n                                      (ModifiedLayout Spacing ResizableTall))\n                                   (Choose\n                                      (Mirror (ModifiedLayout Spacing ResizableTall))\n                                      (Choose\n                                         (ModifiedLayout XMonad.Layout.NoBorders.WithBorder Full)\n                                         (ModifiedLayout\n                                            (XMonad.Layout.Decoration.Decoration\n                                               SimpleDecoration\n                                               XMonad.Layout.Decoration.DefaultShrinker)\n                                            (ModifiedLayout\n                                               XMonad.Actions.MouseResize.MouseResize\n                                               (ModifiedLayout\n                                                  XMonad.Layout.WindowArranger.WindowArranger\n                                                  SimpleFloat)))))))\n                             (XMonad.Layout.PerWorkspace.PerWorkspace\n                                (ModifiedLayout\n                                   AvoidStruts\n                                   (Choose\n                                      (ModifiedLayout XMonad.Layout.NoBorders.WithBorder Full)\n                                      (Choose\n                                         (ModifiedLayout Spacing ResizableTall)\n                                         (Choose\n                                            (Mirror (ModifiedLayout Spacing ResizableTall))\n                                            (ModifiedLayout\n                                               (XMonad.Layout.Decoration.Decoration\n                                                  SimpleDecoration\n                                                  XMonad.Layout.Decoration.DefaultShrinker)\n                                               (ModifiedLayout\n                                                  XMonad.Actions.MouseResize.MouseResize\n                                                  (ModifiedLayout\n                                                     XMonad.Layout.WindowArranger.WindowArranger\n                                                     SimpleFloat)))))))\n                                (XMonad.Layout.PerWorkspace.PerWorkspace\n                                   (ModifiedLayout\n                                      AvoidStruts\n                                      (Choose\n                                         (ModifiedLayout\n                                            XMonad.Layout.NoBorders.WithBorder\n                                            (ModifiedLayout Spacing ResizableTall))\n                                         (Choose\n                                            (Mirror (ModifiedLayout Spacing ResizableTall))\n                                            (Choose\n                                               (ModifiedLayout\n                                                  XMonad.Layout.NoBorders.WithBorder Full)\n                                               (ModifiedLayout\n                                                  (XMonad.Layout.Decoration.Decoration\n                                                     SimpleDecoration\n                                                     XMonad.Layout.Decoration.DefaultShrinker)\n                                                  (ModifiedLayout\n                                                     XMonad.Actions.MouseResize.MouseResize\n                                                     (ModifiedLayout\n                                                        XMonad.Layout.WindowArranger.WindowArranger\n                                                        SimpleFloat)))))))\n                                   (XMonad.Layout.PerWorkspace.PerWorkspace\n                                      (ModifiedLayout\n                                         AvoidStruts\n                                         (ModifiedLayout\n                                            XMonad.Layout.NoBorders.WithBorder\n                                            (ModifiedLayout\n                                               (XMonad.Layout.Decoration.Decoration\n                                                  SimpleDecoration\n                                                  XMonad.Layout.Decoration.DefaultShrinker)\n                                               (ModifiedLayout\n                                                  XMonad.Actions.MouseResize.MouseResize\n                                                  (ModifiedLayout\n                                                     XMonad.Layout.WindowArranger.WindowArranger\n                                                     SimpleFloat)))))\n                                      (XMonad.Layout.PerWorkspace.PerWorkspace\n                                         l10\n                                         (XMonad.Layout.PerWorkspace.PerWorkspace\n                                            (ModifiedLayout\n                                               AvoidStruts\n                                               (ModifiedLayout\n                                                  AddRoster\n                                                  (ModifiedLayout\n                                                     (XMonad.Layout.Decoration.Decoration\n                                                        SimpleDecoration\n                                                        XMonad.Layout.Decoration.DefaultShrinker)\n                                                     (ModifiedLayout\n                                                        XMonad.Actions.MouseResize.MouseResize\n                                                        (ModifiedLayout\n                                                           XMonad.Layout.WindowArranger.WindowArranger\n                                                           SimpleFloat)))))\n                                            (ModifiedLayout\n                                               AvoidStruts\n                                               (Choose\n                                                  (ModifiedLayout\n                                                     XMonad.Layout.NoBorders.WithBorder Full)\n                                                  (Choose\n                                                     (ModifiedLayout Spacing ResizableTall)\n                                                     (Choose\n                                                        (Mirror\n                                                           (ModifiedLayout Spacing ResizableTall))\n                                                        (ModifiedLayout\n                                                           (XMonad.Layout.Decoration.Decoration\n                                                              SimpleDecoration\n                                                              XMonad.Layout.Decoration.DefaultShrinker)\n                                                           (ModifiedLayout\n                                                              XMonad.Actions.MouseResize.MouseResize\n                                                              (ModifiedLayout\n                                                                 XMonad.Layout.WindowArranger.WindowArranger\n                                                                 SimpleFloat)))))))))))))\n                          Window\n          (bound at xmonad.hs:174:1)\n      Probable fix: use a type annotation to specify what `l10` should be.\n      These potential instances exist:\n        instance (LayoutClass l a, LayoutClass r a) =&gt;\n                 LayoutClass (Choose l r) a\n          -- Defined in `XMonad.Layout`\n        instance LayoutClass Full a -- Defined in `XMonad.Layout`\n        instance LayoutClass l a =&gt; LayoutClass (Mirror l) a\n          -- Defined in `XMonad.Layout`\n        ...plus four others\n        ...plus five instances involving out-of-scope types\n        (use -fprint-potential-instances to see them all)\n    * In the expression: onWorkspaces [\"7:media\"] mediaLayout\n      In the second argument of `($)`, namely\n        `onWorkspaces [\"7:media\"] mediaLayout\n         $ onWorkspaces [\"8:com\"] chatLayout $ simpLayout`\n      In the second argument of `($)`, namely\n        `onWorkspaces [\"5:virt\"] vBoxLayout\n         $ onWorkspaces [\"7:media\"] mediaLayout\n           $ onWorkspaces [\"8:com\"] chatLayout $ simpLayout`\n\nxmonad.hs:202:15: error:\n    * Couldn't match expected type `ModifiedLayout\n                                      AddRoster\n                                      (ModifiedLayout\n                                         XMonad.Layout.Reflect.Reflect\n                                         (ModifiedLayout\n                                            AddRoster\n                                            (ModifiedLayout\n                                               TrackFloating\n                                               (ModifiedLayout\n                                                  (XMonad.Layout.Decoration.Decoration\n                                                     TabbedDecoration\n                                                     XMonad.Layout.Decoration.DefaultShrinker)\n                                                  XMonad.Layout.Simplest.Simplest))))\n                                      Window\n                                    -&gt; t`\n                  with actual type `ModifiedLayout\n                                      XMonad.Layout.NoBorders.WithBorder Full Window`\n    * The first argument of ($) takes one argument,\n      but its type `ModifiedLayout\n                      XMonad.Layout.NoBorders.WithBorder Full Window`\n      has none\n      In the expression:\n        noBorders Full\n        $ withIM 0.11 (Role \"gimp-toolbox\")\n          $ reflectHoriz\n            $ withIM 0.15 (Role \"gimp-dock\") (trackFloating simpleTabbed)\n      In an equation for `mediaLayout`:\n          mediaLayout\n            = noBorders Full\n              $ withIM 0.11 (Role \"gimp-toolbox\")\n                $ reflectHoriz\n                  $ withIM 0.15 (Role \"gimp-dock\") (trackFloating simpleTabbed)\n    * Relevant bindings include\n        mediaLayout :: t (bound at xmonad.hs:202:1)\n\nPlease check the file for errors.\n</code></pre>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 2, "creation_date": 1505147053, "post_id": 46159542, "comment_id": 79282501, "body": "I guess these are just in the opposite direction as <code>uncurry (liftA2 (,)) :: Applicative f :: (f a, f b) -&gt; f (a,b)</code>, so this might have something to do with <a href=\"https://cstheory.stackexchange.com/a/16264/20074\">comonoidal functors</a>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1505149259, "post_id": 46159542, "comment_id": 79283716, "body": "also relevant <a href=\"https://stackoverflow.com/questions/9190352/abusing-the-algebra-of-algebraic-data-types-why-does-this-work\" title=\"abusing the algebra of algebraic data types why does this work\">stackoverflow.com/questions/9190352/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1505149120, "post_id": 46159780, "comment_id": 79283638, "body": "See Chris Taylor&#39;s series starting here: <a href=\"http://chris-taylor.github.io/blog/2013/02/10/the-algebra-of-algebraic-data-types/\" rel=\"nofollow noreferrer\">chris-taylor.github.io/blog/2013/02/10/&hellip;</a>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 8, "last_activity_date": 1505145441, "creation_date": 1505145441, "answer_id": 46159780, "question_id": 46159542, "link": "https://stackoverflow.com/questions/46159542/whats-distributing-a-functor-over-a-tuple-called/46159780#46159780", "title": "What&#39;s distributing a functor over a tuple called?", "body": "<p>In your specific context <code>f ~ (x -&gt;)</code>, I think they can be called \"power laws\".</p>\n\n<p>Indeed, in theory, it is common to write <code>A -&gt; B</code> as the power <code>B^A</code>. The pair type <code>(A,B)</code> is also commonly written as a product <code>(A*B)</code>.</p>\n\n<p>Your first law is then written as</p>\n\n<pre><code>(A*B)^C = A^C * B^C\n</code></pre>\n\n<p>and is a classic type isomorphism. This can be easily generalized to tuples in the obvious way.</p>\n\n<p>In the general case, where <code>f</code> is an arbitrary functor, I can't think of nothing else than \"distribution\", right now.</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 2, "last_activity_date": 1505219971, "creation_date": 1505219971, "answer_id": 46176627, "question_id": 46159542, "link": "https://stackoverflow.com/questions/46159542/whats-distributing-a-functor-over-a-tuple-called/46176627#46176627", "title": "What&#39;s distributing a functor over a tuple called?", "body": "<p>There is <code>Data.Distributive</code> which is the dual of <code>Data.Traversable</code>. It provides the <code>distribute</code> function which can be specialized e.g. as <code>f (Stream a) -&gt; Stream (f a)</code> or <code>distribute :: f (Vec n a) -&gt; Vec n (f a)</code>. The latter example is a homogeneous variant of your family of functions.</p>\n\n<p>But we can generalize <code>Data.Distributive</code> a bit just like lenses generalize functors. Enter <code>Colens</code>:</p>\n\n<pre><code>type Colens s t a b = forall f. Functor f =&gt; (f a -&gt; b) -&gt; f s -&gt; t\n</code></pre>\n\n<p>Here is the mirror of <a href=\"https://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Each.html\" rel=\"nofollow noreferrer\"><code>Control.Lens.Each</code></a>:</p>\n\n<pre><code>class Coeach s t a b | s -&gt; a, t -&gt; b, s b -&gt; t, t a -&gt; s where\n  coeach :: Colens s t a b\n\ninstance (a~a', b~b') =&gt; Coeach (a,a') (b,b') a b where\n  coeach f p = (f $ fst &lt;$&gt; p, f $ snd &lt;$&gt; p)\n\ninstance (a~a2, a~a3, b~b2, b~b3) =&gt; Coeach (a,a2,a3) (b,b2,b3) a b where\n  coeach f p = ...\n\n...\n</code></pre>\n\n<p>And just like with <code>each</code> we can iterate over tuples</p>\n\n<pre><code>each_id1 :: Applicative f =&gt; (f a, f a) -&gt; f (a, a)\neach_id1 = each id\n\neach_id2 :: Applicative f =&gt; (f a, f a, f a) -&gt; f (a, a, a)\neach_id2 = each id\n</code></pre>\n\n<p>with <code>coeach</code> we can coiterate over tuples:</p>\n\n<pre><code>coeach_id1 :: Functor f =&gt; f (a, a) -&gt; (f a, f a)\ncoeach_id1 = coeach id\n\ncoeach_id2 :: Functor f =&gt; f (a, a, a) -&gt; (f a, f a, f a)\ncoeach_id2 = coeach id\n</code></pre>\n\n<p>This is still homogeneous, though. I don't know <code>lens</code> much, so can't say whether there is a heterogeneous <code>each</code> and the corresponding <code>coeach</code>.</p>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "answer_count": 2, "score": 7, "last_activity_date": 1505219971, "creation_date": 1505144680, "question_id": 46159542, "link": "https://stackoverflow.com/questions/46159542/whats-distributing-a-functor-over-a-tuple-called", "title": "What&#39;s distributing a functor over a tuple called?", "body": "<p>Is there a name for this family of operations?</p>\n\n<pre><code>Functor f =&gt; f (a, b) -&gt; (f a, f b)\nFunctor f =&gt; f (a, b, c) -&gt; (f a, f b, f c)\n...\nFunctor f =&gt; f (a, b, ..., z)  -&gt; (f a, f b, ..., f z)\n</code></pre>\n\n<p>They're easy to implement, just trying to figure out what to call it.</p>\n\n<pre><code>\\fab -&gt; (fst &lt;$&gt; fab, snd &lt;$&gt; fab)\n</code></pre>\n\n<p>For me, it came up in the context of <code>f ~ (x -&gt;)</code>.</p>\n"}, {"tags": ["haskell", "monads", "continuations"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1505162948, "post_id": 46159422, "comment_id": 79290710, "body": "Did you mean to make <code>y</code> a continuation as well? If it was, you could just pass the &quot;post-processing&quot; along into that. With explicit continuation passing, it could look like <code>let c1 :: Int -&gt; Cont r Int; c1 x = let y k2 = k2 (2*x) in cont $ \\k -&gt; y (k . (+1))</code>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1505163511, "post_id": 46159422, "comment_id": 79290947, "body": "If not, then what about just <code>let c1 :: Int -&gt; Cont r Int; c1 x = let y = 2*x in return (y + 1)</code>?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1505172430, "post_id": 46159422, "comment_id": 79293721, "body": "Compare <code>newtype ContT r m a = ContT { runContT :: (a -&gt; m r) -&gt; m r }</code> with <code>newtype Codensity m a = Codensity { runCodensity :: forall r. (a -&gt; m r) -&gt; m r }</code>. The latter quantifies <code>r</code> at a <i>higher rank</i> - that is to say, the <code>Codensity</code> computation is not allowed to assume anything about <code>r</code> and must treat it parametrically. <code>ContT</code> can do whatever the hell it wants with <code>r</code>, but <code>Codensity</code> can&#39;t."}, {"owner": {"reputation": 4761, "user_id": 2277395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/09841ca82e49f998ea0b8f159dea87c1?s=128&d=identicon&r=PG", "display_name": "Martin Drautzburg", "link": "https://stackoverflow.com/users/2277395/martin-drautzburg"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1505212223, "post_id": 46159422, "comment_id": 79310231, "body": "@David Young: (1) My question is not about possible ways to do post-processing, but whether it is unreasonable.    (2) Aren&#39;t you applying <code>(+1)</code> <i>before</i> you call the continuation? That would be pre-processing and not much different from just adding it to the formula as in <code>c1 x = let y = 2*x + 1</code>-"}], "answers": [{"comments": [{"owner": {"reputation": 4761, "user_id": 2277395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/09841ca82e49f998ea0b8f159dea87c1?s=128&d=identicon&r=PG", "display_name": "Martin Drautzburg", "link": "https://stackoverflow.com/users/2277395/martin-drautzburg"}, "edited": false, "score": 0, "creation_date": 1505343259, "post_id": 46186955, "comment_id": 79379318, "body": "So is it correct to say that <i>usually</i> the result of the continuation is the final result? At least this is in line with the idea, that the continuation is the <i>rest of the computation</i>. While the Cont type does not say &quot;thou shalt not not post-process&quot;, post-processing in this manner is not really popular. I believe CallCC allows doing comparable things, i.e. continue were you left off. Is this about right?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1505354652, "post_id": 46186955, "comment_id": 79381972, "body": "You can generalize <code>Cont</code> to <code>Cont f r a = (a -&gt; r) -&gt; f </code>. A <code>Cont f r a</code> represents a computation that produces <code>f</code>, but it has a hole so it can only get up to an <code>a</code>, needing help to make <code>r</code>, which it post processes to <code>f</code>. This lets you write e.g. <code>filtering :: [a] -&gt; Cont a Bool [a]</code>. In Haskell, this is useless, because this <code>Cont</code> isn&#39;t a <code>Monad</code>, so there&#39;s no nice way to use <code>filtering</code>. In, say, Scala + <code>scala-continuations</code>, a code-rewriting compiler phase is used so you can write <code>reset { filtering(xs) % 2 == 0 }</code>. Post processing works, but looks ugly in Haskell, so it&#39;s avoided."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1505261319, "creation_date": 1505261319, "answer_id": 46186955, "question_id": 46159422, "link": "https://stackoverflow.com/questions/46159422/can-a-cont-r-a-post-process-the-result-of-its-continuation/46186955#46186955", "title": "Can a &quot;Cont r a&quot; post-process the result of its continuation", "body": "<p>Technically, I think it's fine.  Specializing <code>Cont r a</code> to <code>Num r =&gt; Cont r a</code> doesn't seem fundamentally more problematic than specializing <code>Reader r a</code> to <code>Num r =&gt; Reader r a</code>.</p>\n\n<p>An implication of doing so is that the resulting CPS computation can only be run against a (final) continuation that produces a number, but that's obvious -- if you have a computation that post-processes the continuation result as a number, it can only be used with continuations that produce numbers!</p>\n\n<p>As additional evidence that this is sanctioned at least to some degree, note that there's a function:</p>\n\n<pre><code>mapCont :: (r -&gt; r) -&gt; Cont r a -&gt; Cont r a\n</code></pre>\n\n<p>If this function was to be used with no restriction on <code>r</code>, the only valid values for its first argument would be <code>id</code> or functions that don't terminate, as you have noted.</p>\n\n<p>A version of your <code>c1</code> using <code>mapCont</code> might look like:</p>\n\n<pre><code>c2 :: (Num r) =&gt; Int -&gt; Cont r Int\nc2 x = mapCont (+1) $ return (2*x)\n</code></pre>\n\n<p>and seems to work fine:</p>\n\n<pre><code>&gt; runCont (c2 10) id\n21\n&gt; runCont (c2 10) (const 5)\n6\n&gt; runCont (c2 10) show\n... No instance for (Num String) arising from a use of 'c2' ...\n</code></pre>\n\n<p>As for when this would be <em>useful</em>, I'm not sure.  I can think of a few somewhat lame applications.  You could define an computation that overrides the final result (provided no other kind of post-processing is used):</p>\n\n<pre><code>override x = cont (const x)\n</code></pre>\n\n<p>to be used like:</p>\n\n<pre><code>&gt; runCont (return 2 &gt;&gt;= \\x -&gt; cont (\\f -&gt; f (x*3))) id\n6\n&gt; runCont (return 2 &gt;&gt; override 1000 &gt;&gt;= \\x -&gt; cont (\\f -&gt; f (x*3))) id\n1000\n&gt;\n</code></pre>\n\n<p>or a computation transformer that emulates a writer to add log functionality:</p>\n\n<pre><code>annotate note comp = mapCont (\\(a, w) -&gt; (a, note:w)) comp\n</code></pre>\n\n<p>which you might use like this:</p>\n\n<pre><code>runCont (annotate \"two\" (return 2)\n        &gt;&gt;= \\x -&gt; annotate \"times three\" (cont (\\f -&gt; f (x*3))))\n   (\\a -&gt; (a, []))\n</code></pre>\n\n<p>yielding:</p>\n\n<pre><code>(6,[\"two\",\"times three\"])\n</code></pre>\n\n<p>These don't seem like very compelling applications, though.</p>\n"}, {"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 0, "last_activity_date": 1541996252, "creation_date": 1541996252, "answer_id": 53255906, "question_id": 46159422, "link": "https://stackoverflow.com/questions/46159422/can-a-cont-r-a-post-process-the-result-of-its-continuation/53255906#53255906", "title": "Can a &quot;Cont r a&quot; post-process the result of its continuation", "body": "<p>@KABuhr has shown that post-processing in the ordinary <code>Cont</code> works, but didn't find \"very compelling applications\". I'm going to show you how post-processing <em>is</em> useful, but it only works best when you generalize <code>Cont</code>. First, some header stuff (mostly used in the examples):</p>\n\n<pre><code>{-# LANGUAGE RebindableSyntax #-}\n\nimport Prelude(Num(..), Eq(..), Enum(..))\nimport Data.Bool\nimport Data.Function\nimport Data.Functor.Identity\nimport Data.List\nimport Data.Maybe\nimport Data.Tuple\n\nimport Control.Lens(_1, _2, traversed)\n</code></pre>\n\n<p>Now, a generalized <code>Cont</code>.</p>\n\n<pre><code>newtype Cont r f a = Cont { runCont :: (a -&gt; r) -&gt; f }\n</code></pre>\n\n<p>Your question was \"is post-processing allowed in <code>Cont</code>?\" The answer is yes. If would like it to not be so, you can use <code>newtype ContS a = { runContS :: forall r. (a -&gt; r) -&gt; r }</code> which totally disallows it. In fact, <code>ContS a</code> is isomorphic to <code>a</code>. The <code>Cont</code> I just defined takes the opposite position: even type-changing post-processors are allowed. We can define a standard <code>Functor</code>ial <code>(&lt;$&gt;)</code>.</p>\n\n<pre><code>infixl 1 &lt;$&gt;\n(&lt;$&gt;) :: (a -&gt; b) -&gt; Cont r f a -&gt; Cont r f b\nf &lt;$&gt; Cont x = Cont $ \\cont -&gt; x $ \\realX -&gt; cont (f realX)\n</code></pre>\n\n<p>Before continuing, let's get an understanding of the metaphor behind <code>Cont</code>. A <code>Cont r f a</code> is a computation that can produce <code>a</code>s. It will give you the <code>a</code>s, but will ask you to produce <code>r</code>s. Once you do that, it'll make <code>f</code>s. It's sort of like a <code>(r -&gt; f, a)</code>, but with heavy restrictions on use. If we try to define an <code>Applicative</code>-ish operator, we see something interesting.</p>\n\n<pre><code>infixl 1 &lt;*&gt; \n(&lt;*&gt;) :: Cont m f (a -&gt; b) -&gt; Cont r m a -&gt; Cont r f b\nCont f &lt;*&gt; Cont x = Cont $ \\cont -&gt; x $ \\realX -&gt; f $ \\realF -&gt; cont (realF realX)\n</code></pre>\n\n<p><code>(&lt;*&gt;)</code> is sort of doing two operations at once. It is applying the <code>a -&gt; b</code> to an <code>a</code> to get <code>b</code>, but it's also composing the <code>m -&gt; f</code> and <code>r -&gt; m</code> aspects into a <code>r -&gt; f</code> part. However, the type of <code>(&lt;*&gt;)</code> no longer fits into the normal <code>Applicative</code> format. This is why we use <code>Cont r a</code> instead of <code>Cont r f a</code>. The former is less powerful, but it fits into our existing framework. To get our <code>Cont</code> to work, we have to leave some of the established infrastructure behind.</p>\n\n<p>Before we get into the <code>RebindableSyntax</code>-level stuff, here's some usage.</p>\n\n<pre><code>complete :: Cont a f a -&gt; f\ncomplete (Cont x) = x id\n\namb :: [a] -&gt; Cont (Maybe b) (Maybe (a, b)) a\namb [] = Cont (const Nothing)\namb (x : xs) = Cont $ \\test -&gt; case test x of\n                                    Nothing -&gt; runCont (amb xs) test\n                                    Just y -&gt; Just (x, y)\npoly :: Num a =&gt; a -&gt; a -&gt; a -&gt; a\npoly x y z = sq x * y + sq y + z + sq z * x\n    where sq x = x * x\nsolution :: (Num a, Enum a, Eq a) =&gt; Maybe (a, (a, (a, ())))\nsolution = complete $ testRoot &lt;$&gt; amb [-5..5]\n                               &lt;*&gt; amb [-10 .. -5]\n                               &lt;*&gt; amb [5..10]\n    where testRoot x y z = case poly x y z of\n                                0 -&gt; Just ()\n                                _ -&gt; Nothing\n</code></pre>\n\n<p><code>complete</code> completes a computation when there isn't actually a gap holding it up. <code>amb</code> takes a <code>[a]</code>, and goes through each <code>a</code>, one by one. It passes each into the <code>test</code>, and searches until it finds one that succeeds. It post-processes the result of the <code>test</code> in two ways. It resets the result until it's a <code>Just</code> (or gives up), and a <code>Just</code> result gets up paired with the input that built it.</p>\n\n<p>In <code>solution</code>, the <code>complete</code> is delimiting the extent of the continuation passed to the <code>amb</code>s. Each <code>amb</code> is passed the code that lies between it and the <code>complete</code>. E.g., the continuation given to the <code>amb [-5..5]</code> is <code>\\x -&gt; testRoot x &lt;*&gt; amb [-10 .. -5] &lt;*&gt; amb [10..5]</code>. This style of continuations is called <code>shift</code>/<code>reset</code>. <code>Cont</code> is <code>shift</code>, <code>complete</code> is <code>reset</code>. The idea is that <code>amb [-5..5]</code> is a \"liar\"; it \"looks like\" a <code>Num a =&gt; a</code> because it's getting passed to <code>testRoot</code>, but it's actually a control structure that turns everything around it inside-out. Compared to the normal <code>Cont r a</code>, the control structures allowed in our <code>Cont</code> are more powerful.</p>\n\n<p>Now, here's what we need <code>RebindableSyntax</code> for:</p>\n\n<pre><code>(=&lt;&lt;) :: (a -&gt; Cont r m b) -&gt; Cont m f a -&gt; Cont r f b\nf =&lt;&lt; Cont x = Cont $ \\cont -&gt; x $ \\realX -&gt; runCont (f realX) cont\n(&gt;&gt;=) = flip (=&lt;&lt;)\nreturn :: a -&gt; Cont r r a\nreturn x = Cont ($ x)\n</code></pre>\n\n<p><code>(=&lt;&lt;)</code> is the <code>Monad</code>-style function application operator. Again, our version doesn't fit the usual type. With <code>(&gt;&gt;=)</code> and <code>return</code>, <code>do</code>-notation has now been redefined to work with <code>Cont</code>. You can go back and rewrite <code>solution</code> in <code>do</code>-notation to see that it works.</p>\n\n<p>Let's really get out there. The idea behind profunctor optics is that data structures give rise to \"transformer transformers\". E.g. a <code>Lens s t a b = forall f. Functor f =&gt; (a -&gt; f b) -&gt; s -&gt; f t</code> takes a transformer between the \"small\" structures <code>a</code> and <code>b</code> and makes one from between the \"bigger\" <code>s</code> and <code>t</code>. Look what lies just a <code>flip</code> away...</p>\n\n<pre><code>editing :: ((a -&gt; Identity b) -&gt; s -&gt; Identity t) -&gt; s -&gt; Cont b t a\nediting optic x = Cont (runIdentity . flip optic x . (Identity .))\n</code></pre>\n\n<p><code>editing</code>, as a control structure, takes a reference to a field inside a structure, a structure to use it on, and then mutates that structure with \"the rest of the program.\" Using it, you can write the following:</p>\n\n<pre><code>example :: (a -&gt; a) -&gt; [(Bool, (a, a))] -&gt; [(Bool, (a, a))]\nexample f xs = complete $ do x &lt;- editing traversed xs\n                             n2 &lt;- editing _2 x\n                             n &lt;- case fst x of\n                                       True -&gt; editing _1 n2\n                                       False -&gt; editing _2 n2\n                             return (f n)\n</code></pre>\n\n<p>I hope, with even these contrived examples, that you're convinced that post-processing is useful in <code>Cont</code>. There's nothing wrong with doing it. However, if you want to use it at its full potential, you have to break out of the existing <code>Applicative</code> and <code>Monad</code> form. This is painful, so we cripple <code>Cont</code> to make it fit, disabling type-changing post-processing as a trade-off.</p>\n"}], "owner": {"reputation": 4761, "user_id": 2277395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/09841ca82e49f998ea0b8f159dea87c1?s=128&d=identicon&r=PG", "display_name": "Martin Drautzburg", "link": "https://stackoverflow.com/users/2277395/martin-drautzburg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1541996252, "creation_date": 1505144292, "question_id": 46159422, "link": "https://stackoverflow.com/questions/46159422/can-a-cont-r-a-post-process-the-result-of-its-continuation", "title": "Can a &quot;Cont r a&quot; post-process the result of its continuation", "body": "<p>the <code>Cont r a</code> type stands for a function which takes a continuation <code>a-&gt;r</code> and produces a result of type <code>r</code>. So both the continuation and the entire <code>Cont r a</code> produce a result of the same <em>type</em> <code>r</code>. </p>\n\n<p>My question is: are the two results necessarily the same <em>value</em>, or can a <code>Cont r a</code> post-process the result from the continuation and produce a different value, albeit of the same type <code>r</code>?</p>\n\n<p>I tried using <code>(+1)</code> for post-processing (note the <code>+ 1 --&lt;--</code>):</p>\n\n<pre><code>c1 :: Int -&gt; Cont r Int\nc1 x = let y = 2*x\n       in cont $  \\k -&gt; (k y)  + 1 --&lt;--\n</code></pre>\n\n<p>Now that doesn't typecheck, because my post-processing function <code>(+1)</code> only accepts an argument whose type belongs to the <code>Num</code> typeclass. However, I pass the result of the continuation <code>(k y)</code> which is of some type <code>r</code> that is not guaranteed to belong to the <code>Num</code> typeclass.</p>\n\n<p>Whatever I do to <code>(k y)</code>, it must be a function of type <code>r-&gt;r</code>. The only function which can do this for all <code>r</code> is the <code>id</code> function and using <code>id</code> for post-processing is no post-processing at all.</p>\n\n<p>However, the whole thing does typecheck if I restrict <code>r</code> to the <code>Num</code> typeclass or even to the concrete type <code>Int</code>. It then produces the expected result:</p>\n\n<pre><code>*Main&gt; runCont (c1 1) id\n3\n</code></pre>\n\n<p>I am quite unsure, </p>\n\n<ul>\n<li>if such post-processing and restricting the type of <code>r</code> is a normal thing to do, and if so, in what circumstances this might be useful</li>\n<li>or if the type variable <code>r</code>has to be read as <em>for all <code>r</code></em> and restricting the type of <code>r</code> will lead to all sorts of trouble. </li>\n</ul>\n\n<p>Can someone shed some light on this?</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1505144300, "post_id": 46158409, "comment_id": 79280871, "body": "You shouldn&#39;t really rely on the <code>Show</code> instances for <code>Exp</code> or <code>Name</code> or any other TH syntax for anything except debugging. If you need a string representation of the AST for any purpose, your best bet is probably to use the <a href=\"https://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/Language-Haskell-TH-Ppr.html#v:pprint\" rel=\"nofollow noreferrer\">pretty printer</a>. But I don&#39;t see how this is really applicable to the use case - if you splice in code with TH, you shouldn&#39;t see the source (and hence any variable names) at all."}, {"owner": {"reputation": 83, "user_id": 7321533, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/473319b13d1589b40ea9b01fe311e988?s=128&d=identicon&r=PG&f=1", "display_name": "Theelepel", "link": "https://stackoverflow.com/users/7321533/theelepel"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1505146035, "post_id": 46158409, "comment_id": 79281911, "body": "I am not printing the TH abstract syntax datatypes; I am printing the spliced expressions as shown by ghci or -ddump-splices. The TH code describes a model in DSL, while the spliced code can be read as a mathematical formula. I use the TH code because it is easier to read and edit, but sometimes I need to check the resulting spliced code for sanity checking and communicating with coworkers. It would be useful if I could explicitly link the variable names in the spliced code to their description-in-words in the model."}], "owner": {"reputation": 83, "user_id": 7321533, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/473319b13d1589b40ea9b01fe311e988?s=128&d=identicon&r=PG&f=1", "display_name": "Theelepel", "link": "https://stackoverflow.com/users/7321533/theelepel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1505140913, "creation_date": 1505140913, "question_id": 46158409, "link": "https://stackoverflow.com/questions/46158409/is-there-a-way-to-lift-template-haskell-names", "title": "Is there a way to lift Template Haskell Names?", "body": "<p>Since <code>Name</code> has a <code>Show</code> instance and strings can be used to generate a corresponding <code>Name</code>, I thought about using the following method:</p>\n\n<pre><code> \\ name -&gt; [e| mkName $(lift (show name)) |]\n</code></pre>\n\n<p>This works fine in ghci. But in compiled code, the actual compiled variables look like <code>p_a4hEk</code>, whereas the strings produced by <code>Show</code> look like <code>p_6989586621680030942</code>.</p>\n\n<p>What is happening here? Is there a way to lift a <code>Name</code> into a Template Haskell <code>ExpQ</code>?</p>\n\n<hr>\n\n<p>Use case: I am writing a TH API that can build complex and efficient Haskell functions based on human-readable user descriptions. I am attaching to the returned function a documentation that explains the purpose and type of each parameter in human readable terms. It would be nice if the documentation could also contain the Name used for that parameter in the code, so that the user can review the spliced code as needed and recognize which parameter is which.</p>\n"}, {"tags": ["haskell", "vector", "fold"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1505127159, "post_id": 46153155, "comment_id": 79269361, "body": "Since you write &#39;all unique pairs&#39;, what&#39;s wrong with <code>(a, a)</code>, <code>(b, b)</code>, and <code>(c, c)</code>? Do you consider <code>(a, b)</code> equal to, or different from, <code>(b, a)</code>?"}, {"owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1505141120, "post_id": 46153155, "comment_id": 79278797, "body": "Alright, say unique pairs of different elements"}], "answers": [{"comments": [{"owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "edited": false, "score": 0, "creation_date": 1505141593, "post_id": 46154312, "comment_id": 79279126, "body": "Ooh, hadn&#39;t noticed the existence of <code>ifoldl</code>"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1505128843, "last_edit_date": 1505128843, "creation_date": 1505128268, "answer_id": 46154312, "question_id": 46153155, "link": "https://stackoverflow.com/questions/46153155/apply-function-to-all-pairs-efficiently/46154312#46154312", "title": "Apply function to all pairs efficiently", "body": "<p>There is no way to define a classical instance for <code>Unbox (U.Vector b)</code>, because that would require preallocating a memory area in which each element (i.e. each subvector!) has the same fixed amount of space. But in general, each of them may be arbitrarily big, so that's not feasible at all.</p>\n\n<p>It might <em>in principle</em> be possible to define that instance by storing only a flattened form of the nested vector plus an extra array of indices (where each subvector starts). <a href=\"https://gist.github.com/leftaroundabout/24427d8f59527c5b31823abd9778b63f\" rel=\"noreferrer\">I once briefly gave this a try</a>; it actually seems somewhat promising as far as immutable vectors are concerned, but a <a href=\"http://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector-Generic.html#t:Vector\" rel=\"noreferrer\"><code>G.Vector</code></a> instance also requires a mutable implementation, and that's hopeless for such an approach (because any mutation that changes the number of elements in one subvector would require shifting everything behind it).</p>\n\n<p>Usually, it's just not worth it, because if the individual element vectors aren't very small the overhead of boxing them won't matter, i.e. often it makes sense to use <code>B.Vector (U.Vector b)</code>.</p>\n\n<p>For your application however, I would not do that at all \u2013 there's no need to ever wrap the upper element-choices in a single triangular array. (And it would be really bad for performance to do that, because it make the algorithm take <em>O</em> (<em>n</em>\u00b2) memory rather than <em>O</em> (<em>n</em>) which is all that's needed.)</p>\n\n<p>I would just do the following:</p>\n\n<pre><code>pairApply combine neutral f v\n = U.ifoldl' (\\acc i p -&gt; U.foldl' (\\acc' q -&gt; combine acc' $ f p q)\n                                   acc\n                                   (U.drop (i+1) v) )\n             neutral v\n</code></pre>\n\n<p>This corresponds pretty much to the obvious nested-loops imperative implementation</p>\n\n<pre><code>pairApply(combine, b, f, v):\n    for(i in 0..length(v)-1):\n        for(j in i+1..length(v)-1):\n            b = combine(b, f(v[i], v[j]);\n    return b;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1505132011, "post_id": 46154715, "comment_id": 79272533, "body": "Well, I do see a potentially huge performance issue with this... namely, the <i>O</i> (<i>n</i> &#178;) <i>list</i> you build up before folding over the values. And indeed, without optimisations, <a href=\"https://gist.github.com/leftaroundabout/6e746cc6b2787a3c9f209e32740547b9\" rel=\"nofollow noreferrer\">your code runs three times slower than mine</a>. However, and that surprised me, with <code>ghc-8.2 -O2</code>, it actually takes only 60% as long as mine does! GHC sure does a great job at fusing control-flow lists to tight loops. I&#39;m still not sure I&#39;d prefer this solution, because this kind of optimisation isn&#39;t known to be very reliable."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1505134737, "post_id": 46154715, "comment_id": 79274370, "body": "Ah, and: your code is faster yet when you replace <code>!</code> with <a href=\"http://hackage.haskell.org/package/vector-0.12.0.1/docs/Data-Vector-Unboxed.html#v:unsafeIndex\" rel=\"nofollow noreferrer\"><code>unsafeIndex</code></a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1505135884, "post_id": 46154715, "comment_id": 79275160, "body": "Upon further testing, I think the performance differences are mostly due to an optimisation regression in GHC-8.2. With GHC-7.10, both versions (yours with <code>unsafeIndex</code>) run within 10% of the C reference implementation."}, {"owner": {"reputation": 68, "user_id": 3944962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1395e09caa50c2dea056b66934cb81d?s=128&d=identicon&r=PG&f=1", "display_name": "wkoiking", "link": "https://stackoverflow.com/users/3944962/wkoiking"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1505135942, "post_id": 46154715, "comment_id": 79275197, "body": "Reading <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl%27\" rel=\"nofollow noreferrer\">this article</a>, I thought my code will not build up O(n^2) list by using <code>foldl&#39;</code>. But I may be wrong. Thank you anyway for your comment and investigation."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1505136450, "post_id": 46154715, "comment_id": 79275580, "body": "Indeed your implementation doesn&#39;t build up an <i>O</i> (<i>n</i> &#178;) list... or indeed any list at all, but that&#39;s just because GHC optimises it away. You can&#39;t generally rely on this \u2013 the list is defined in your source code after all. At best, you could count on the garbage collector to reclaim the beginning of the list before the end is processed, but that&#39;s still not exactly great performance-wise."}], "tags": [], "owner": {"reputation": 68, "user_id": 3944962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1395e09caa50c2dea056b66934cb81d?s=128&d=identicon&r=PG&f=1", "display_name": "wkoiking", "link": "https://stackoverflow.com/users/3944962/wkoiking"}, "is_accepted": false, "score": 3, "last_activity_date": 1505129593, "creation_date": 1505129593, "answer_id": 46154715, "question_id": 46153155, "link": "https://stackoverflow.com/questions/46153155/apply-function-to-all-pairs-efficiently/46154715#46154715", "title": "Apply function to all pairs efficiently", "body": "<p>My answer is basically the same as leftaroundabout's nested-loops imperative implementation:</p>\n\n<pre><code>pairApply :: (Int -&gt; Int -&gt; Int) -&gt; Vector Int -&gt; Int\npairApply f v = foldl' (+) 0 [f (v ! i) (v ! j) | i &lt;- [0..(n-1)], j &lt;- [(i+1)..(n-1)]]\n where n = length v\n</code></pre>\n\n<p>As far as I know, I do not see any performance issue with this implementation.</p>\n\n<p>Non-polymorphic for simplicity.</p>\n"}], "owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 302, "favorite_count": 0, "accepted_answer_id": 46154312, "answer_count": 2, "score": 0, "last_activity_date": 1550843760, "creation_date": 1505124608, "last_edit_date": 1550843760, "question_id": 46153155, "link": "https://stackoverflow.com/questions/46153155/apply-function-to-all-pairs-efficiently", "title": "Apply function to all pairs efficiently", "body": "<p>I need a second order function <code>pairApply</code> that applies a binary function <code>f</code> to all unique pairs of a list-like structure and then combines them somehow. An example / sketch:</p>\n\n<pre><code>pairApply (+) f [a, b, c] = f a b + f a c + f b c\n</code></pre>\n\n<p>Some research leads me to believe that <code>Data.Vector.Unboxed</code> probably will have good performance (I will also need fast access to specific elements); also it necessary for <code>Statistics.Sample</code>, which would come in handy further down the line. </p>\n\n<p>With this in mind I have the following, which <em>almost</em> compiles:</p>\n\n<pre><code>import\u00a0qualified\u00a0Data.Vector.Unboxed\u00a0as\u00a0U\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n\npairElement\u00a0::\u00a0(U.Unbox\u00a0a,\u00a0U.Unbox\u00a0b)\u00a0\u00a0\u00a0\u00a0\n            =&gt;\u00a0(U.Vector\u00a0a)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n          \u00a0 -&gt;\u00a0(a\u00a0-&gt;\u00a0a\u00a0-&gt;\u00a0b)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n          \u00a0\u00a0-&gt;\u00a0Int\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n            -&gt;\u00a0a\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n           \u00a0-&gt;\u00a0(U.Vector\u00a0b)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\npairElement\u00a0v\u00a0f\u00a0idx\u00a0el\u00a0=\n  U.map\u00a0(f\u00a0el)\u00a0$\u00a0U.drop\u00a0(idx\u00a0+\u00a01)\u00a0v\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n\npairUp\u00a0::\u00a0(U.Unbox\u00a0a,\u00a0U.Unbox\u00a0b)\u00a0\u00a0\u00a0\n       =&gt;\u00a0(a\u00a0-&gt;\u00a0a\u00a0-&gt;\u00a0b)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n      \u00a0-&gt;\u00a0(U.Vector\u00a0a)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n       -&gt;\u00a0(U.Vector\u00a0(U.Vector\u00a0b))\npairUp\u00a0f\u00a0v\u00a0=\u00a0U.imap\u00a0(pairElement\u00a0v\u00a0f)\u00a0v\u00a0\n\npairApply\u00a0::\u00a0(U.Unbox\u00a0a,\u00a0U.Unbox\u00a0b)\n          =&gt;\u00a0(b\u00a0-&gt;\u00a0b\u00a0-&gt;\u00a0b)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n          -&gt;\u00a0b\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n         \u00a0-&gt;\u00a0(a\u00a0-&gt;\u00a0a\u00a0-&gt;\u00a0b)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n          -&gt;\u00a0(U.Vector\u00a0a)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\n         \u00a0-&gt;\u00a0b\npairApply\u00a0combine\u00a0neutral\u00a0f\u00a0v\u00a0=\n  folder\u00a0$\u00a0U.map\u00a0folder\u00a0(pairUp\u00a0f\u00a0v)\u00a0where\n  folder\u00a0=\u00a0U.foldl\u00a0combine\u00a0neutral\n</code></pre>\n\n<p>The reason this doesn't compile is that there is no Unboxed instance of a <code>U.Vector (U.Vector a))</code>. I have been able to create new unboxed instances in other cases using <code>Data.Vector.Unboxed.Deriving</code>, but I'm not sure it would be so easy in this case (transform it to a tuple pair where the first element is all the inner vectors concatenated and the second is the length of the vectors, to know how to unpack?)</p>\n\n<p>My question can be stated in two parts:</p>\n\n<ul>\n<li>Does the above implementation make sense at all or is there some quick library function magic etc that could do it much easier?</li>\n<li>If so, is there a better way to make an unboxed vector of vectors than the one sketched above?</li>\n</ul>\n\n<p>Note that I'm aware that <code>foldl</code> is probably not the best choice; once I've got the implementation sorted I plan to benchmark with a few different folds. </p>\n"}, {"tags": ["haskell", "monads", "st-monad", "starray"], "answers": [{"comments": [{"owner": {"reputation": 477, "user_id": 5829427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fjyjB.jpg?s=128&g=1", "display_name": "Zafer Cesur", "link": "https://stackoverflow.com/users/5829427/zafer-cesur"}, "edited": false, "score": 0, "creation_date": 1505099391, "post_id": 46147612, "comment_id": 79256943, "body": "That&#39;s very interesting! Thanks for your time."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 477, "user_id": 5829427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fjyjB.jpg?s=128&g=1", "display_name": "Zafer Cesur", "link": "https://stackoverflow.com/users/5829427/zafer-cesur"}, "edited": false, "score": 0, "creation_date": 1505100319, "post_id": 46147612, "comment_id": 79257105, "body": "@ZaferCesur, I love <code>ScopedTypeVariables</code>, but if you don&#39;t want to use it, another option is to make <code>go</code> take the array as an argument."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 4, "last_activity_date": 1505111594, "last_edit_date": 1505111594, "creation_date": 1505098894, "answer_id": 46147612, "question_id": 46147303, "link": "https://stackoverflow.com/questions/46147303/haskell-st-monad-no-instance-for-marray-starray-s-int-st-s1/46147612#46147612", "title": "Haskell ST Monad: No instance for (MArray (STArray s) Int (ST s1))", "body": "<p>In <code>No instance for (MArray (STArray s) Int (ST s1))</code>, the most important thing to notice is that it's talking about two different type variables, <code>s</code> and <code>s1</code>.  There is no instance of <code>MArray</code> unless those two type variables are the same.  This is an important part of how <code>ST</code> is valid with an externally-pure interface.</p>\n\n<p>The reason the compiler thinks that there are two different type variables involved is that you put a type signature on <code>go</code>.  The type variable <code>s</code> in that signature is not the same as the type variable <code>s</code> in the signature of <code>findDuplicates</code>.  This is an inherent part of Haskell's type signature rules - type variables in any particular signature are unrelated to type variables in any other signature.</p>\n\n<p>The simplest way to fix this is to remove the signature from <code>go</code>. Type inference will get the correct type for it.</p>\n\n<p>If you want to get fancier, you can use the <code>ScopedTypeVariables</code> extension to allow the signature on <code>go</code> to share the type variable with the enclosing definition:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\nmodule FindDuplicates where\n\nimport Control.Monad (foldM)\nimport Control.Monad.ST\nimport Data.Array.ST\n\nxs = [4,3,2,7,8,2,3,1] :: [Int]\n\nfindDuplicates :: forall s. [Int] -&gt; ST s [Int]\nfindDuplicates xs = do\n    arr &lt;- newListArray (1, length xs) xs :: ST s (STArray s Int Int)\n\n    let go :: [Int] -&gt; Int -&gt; ST s [Int]\n        go acc i = do x &lt;- abs &lt;$&gt; readArray arr i\n                      y &lt;- readArray arr x\n                      if y &lt; 0\n                          then return (x:acc)\n                          else do writeArray arr x (-y)\n                                  return acc \n\n    foldM go [] [1..length xs]\n</code></pre>\n\n<p>The <code>LANGUAGE</code> pragma at the top enables the extension.  To use the extension, you need to specify the type variables in a definition with <code>forall</code>.  (Forgetting to do that is the most common reason for <code>ScopedTypeVariables</code> to fail to work.)</p>\n\n<p>After doing that in the type of <code>findDuplicates</code>, it stores that <code>s</code> in scope across the entire definition.  When finding the type variable <code>s</code> in the type of <code>go</code>, it no longer treats it as a fresh type variable, and makes it match the type <code>s</code> in the enclosing context instead.</p>\n"}], "owner": {"reputation": 477, "user_id": 5829427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fjyjB.jpg?s=128&g=1", "display_name": "Zafer Cesur", "link": "https://stackoverflow.com/users/5829427/zafer-cesur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 46147612, "answer_count": 1, "score": 2, "last_activity_date": 1505111594, "creation_date": 1505095776, "question_id": 46147303, "link": "https://stackoverflow.com/questions/46147303/haskell-st-monad-no-instance-for-marray-starray-s-int-st-s1", "title": "Haskell ST Monad: No instance for (MArray (STArray s) Int (ST s1))", "body": "<p>I have been learning Haskell for the past month or two, and recently solved <a href=\"https://leetcode.com/problems/find-all-duplicates-in-an-array/description/\" rel=\"nofollow noreferrer\">this</a> coding problem. The additional challenge was to do the task without extra space and in linear time, which I did not think would be possible to do in a purely functional way, so naturally I found out about the ST monad and I thought this would be a good opportunity to learn more about it. Anyways, here is the code that I wrote:</p>\n\n<pre><code>module FindDuplicates where\n\nimport Control.Monad (foldM)\nimport Control.Monad.ST\nimport Data.Array.ST\n\nxs = [4,3,2,7,8,2,3,1] :: [Int]\n\nfindDuplicates :: [Int] -&gt; ST s [Int]\nfindDuplicates xs = do\n    arr &lt;- newListArray (1, length xs) xs :: ST s (STArray s Int Int)\n\n    let go :: [Int] -&gt; Int -&gt; ST s [Int]\n        go acc i = do x &lt;- abs &lt;$&gt; readArray arr i\n                      y &lt;- readArray arr x\n                      if y &lt; 0\n                          then return (x:acc)\n                          else do writeArray arr x (-y)\n                                  return acc \n\n    foldM go [] [1..length xs]\n</code></pre>\n\n<p>The idea is to use the pre-condition that 1 \u2264 a[i] \u2264 n and that each element appears at most 2 times. But the code gives me the following error.</p>\n\n<pre><code>FindDuplicates.hs:14:36:\n    No instance for (MArray (STArray s) Int (ST s1))\n      arising from a use of \u2018readArray\u2019\n    In the second argument of \u2018(&lt;$&gt;)\u2019, namely \u2018readArray arr i\u2019\n    In a stmt of a 'do' block: x &lt;- abs &lt;$&gt; readArray arr i\n    In the expression:\n      do { x &lt;- abs &lt;$&gt; readArray arr i;\n           y &lt;- readArray arr x;\n           if y &lt; 0 then\n               return (x : acc)\n           else\n               do { writeArray arr x (- y);\n                    .... } }\n</code></pre>\n\n<p>I hope someone can point me in the right direction!</p>\n"}, {"tags": ["haskell", "types", "abstract-syntax-tree", "pretty-print"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "edited": false, "score": 1, "creation_date": 1505101070, "post_id": 46147236, "comment_id": 79257249, "body": "If you are just doing this for your own edification I understand, otherwise I would point you to the <a href=\"https://hackage.haskell.org/package/haskell-src-exts-1.19.1/docs/Language-Haskell-Exts-Pretty.html\" rel=\"nofollow noreferrer\">haskell-src-exts</a> which has both a pretty printer and an exact printer for Haskell code."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1505096761, "creation_date": 1505096761, "answer_id": 46147414, "question_id": 46147236, "link": "https://stackoverflow.com/questions/46147236/haskell-pretty-print-infix-and-prefix/46147414#46147414", "title": "Haskell: Pretty print infix and prefix", "body": "<p>The usual way to do this is thread through a precedence variable to your printing function. Also, you almost always should prefer a pretty printing library instead of just using raw strings (both for performance reasons, and ease). GHC ships with <a href=\"https://hackage.haskell.org/package/pretty\" rel=\"nofollow noreferrer\"><code>pretty</code></a> and I also recommend the newer <a href=\"https://hackage.haskell.org/package/prettyprinter\" rel=\"nofollow noreferrer\"><code>prettyprinter</code></a>.</p>\n\n<p>Using the former (and assuming <code>type Name = String</code>):</p>\n\n<pre><code>import Text.PrettyPrint.HughesPJ\n\nprettyType :: Type -&gt; Doc\nprettyType = go 0\n  where\n    go :: Int -&gt; Type -&gt; Doc\n    go _ (TVar x) = text x\n    go _ (TLit n) = text n\n    go n (TLit \"Fun\" `TApp` l `TApp` r) = maybeParens (n &gt; 0) (go 1 l &lt;+&gt; text \"-&gt;\" &lt;+&gt; go 0 r)\n    go n (l `TApp` r) = maybeParens (n &gt; 1) (go 1 l &lt;+&gt; go 2 r)\n</code></pre>\n"}], "owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 46147414, "answer_count": 1, "score": 2, "last_activity_date": 1505157069, "creation_date": 1505095041, "question_id": 46147236, "link": "https://stackoverflow.com/questions/46147236/haskell-pretty-print-infix-and-prefix", "title": "Haskell: Pretty print infix and prefix", "body": "<p>I have a type to represent haskell types:</p>\n\n<pre><code>data Type \n    = TApp Type Type\n    | TVar Name\n    | TLit Name\ninfixl 8 `TApp`\n\n-- a -&gt; b\naToB = TLit \"Fun\" `TApp` TVar \"a\" `TApp` TVar \"b\"\n\n-- Maybe (IO Int)\nmaybeIOInt = TLit \"Maybe\" `TApp` (TLit \"IO\" `TApp` TLit \"Int\")\n</code></pre>\n\n<p>I want to print it as haskell does, namely, literals that are symbols are printed infix while other literal are printed prefix.\nalso parenthesis should be added when necessary:</p>\n\n<pre><code>show aToB = \"a -&gt; b\"\nshow maybeIOInt = \"Maybe (IO Int)\"\n\nshow ast = ???\n</code></pre>\n\n<p>How can I implement this?</p>\n"}, {"tags": ["haskell", "memory", "installation", "cabal", "criterion"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1505099385, "post_id": 46147137, "comment_id": 79256940, "body": "Try to set RTS flags on GHC to limit its memory usage (<code>--ghc-options=&quot;+RTS -M600M&quot;</code>) and avoid running multiple jobs in parallel (<code>-j1</code>)."}, {"owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1505104897, "post_id": 46147137, "comment_id": 79258126, "body": "Thanks! If you write it as an answer I&#39;ll accept"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1505105153, "post_id": 46147137, "comment_id": 79258168, "body": "Did it really work?!"}, {"owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1505105183, "post_id": 46147137, "comment_id": 79258172, "body": "Like a charm :)"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 8, "last_activity_date": 1505105172, "creation_date": 1505105172, "answer_id": 46148345, "question_id": 46147137, "link": "https://stackoverflow.com/questions/46147137/cabal-install-criterion-out-of-memory/46148345#46148345", "title": "Cabal install criterion out of memory", "body": "<p>Set RTS flags on GHC to limit its memory usage (<code>--ghc-options=\"+RTS -M600M\"</code>) and avoid running multiple jobs in parallel (<code>-j1</code>).</p>\n"}], "owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 445, "favorite_count": 0, "accepted_answer_id": 46148345, "answer_count": 1, "score": 3, "last_activity_date": 1505105172, "creation_date": 1505094071, "question_id": 46147137, "link": "https://stackoverflow.com/questions/46147137/cabal-install-criterion-out-of-memory", "title": "Cabal install criterion out of memory", "body": "<p>I'm running on a container with 768MB ram and 512 MB swap space. I can't increase either of this. <code>cabal install criterion</code> always gives</p>\n\n<pre><code>Failed during the building phase.\nThe exception was: ExitFailure (-9)\nThis may be due to an out-of-memory condition.\n</code></pre>\n\n<p>during <code>Compiling Criterion.Types</code>. Is there any way around this or do I have to make do without criterion? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1505091953, "post_id": 46146081, "comment_id": 79255730, "body": "In imperative code I can only stand <code>if cond then\\n  foo\\nelse\\n  bar</code> style aesthetic, the others drive me nuts. Thanks GHC dudes."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1505083087, "last_edit_date": 1505083087, "creation_date": 1505081995, "answer_id": 46146081, "question_id": 46146029, "link": "https://stackoverflow.com/questions/46146029/violation-of-haskell-indentation-rules-for-if-then-else/46146081#46146081", "title": "violation of Haskell indentation rules for if-then-else", "body": "<p>I'm reasonably sure this is an artifact of a <a href=\"https://prime.haskell.org/wiki/DoAndIfThenElse\" rel=\"noreferrer\">deliberate GHC variation on the indentation rule</a>. Nice catch!</p>\n\n<p>GHC reads this</p>\n\n<pre><code>foo = do\n  item\n  if a\n  then b\n  else c\n  item\n</code></pre>\n\n<p>as</p>\n\n<pre><code>foo = do {\n  item ;\n  if a ;\n  then b ;\n  else c ;\n  item }\n</code></pre>\n\n<p>which should trigger a parse error.</p>\n\n<p>However, this was so common that at a certain point the GHC devs decided to allow for an optional <code>;</code> before <code>then</code> and <code>else</code>. This change to the <code>if</code> grammar makes the code compile.</p>\n\n<p>This means that <code>if</code> became \"special\", in that it does not have to indented more, but only as much as the previous item. In the code posted in the question, <code>then</code> is indented as much as the previous item, so there's an implicit <code>;</code> before it, and that makes the code compile.</p>\n\n<p>I would still try to avoid this \"style\", though, since it's quirky. </p>\n\n<p>(Personally, I wouldn't have added this special case to GHC. But it's not a big deal, anyway.)</p>\n\n<p>I now noticed that the Wikibook mentions this variant as a \"proposal\" for a future version of Haskell. This is a bit outdated now, and has been implemented in GHC since then.</p>\n"}], "owner": {"reputation": 83, "user_id": 1131476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8d851cca806a23186b58e716e844ecc?s=128&d=identicon&r=PG", "display_name": "moyang_mm", "link": "https://stackoverflow.com/users/1131476/moyang-mm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "accepted_answer_id": 46146081, "answer_count": 1, "score": 8, "last_activity_date": 1505083087, "creation_date": 1505081550, "question_id": 46146029, "link": "https://stackoverflow.com/questions/46146029/violation-of-haskell-indentation-rules-for-if-then-else", "title": "violation of Haskell indentation rules for if-then-else", "body": "<p>According to the <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation\" rel=\"noreferrer\">Haskell indentation rules</a>, \"<em>Code which is part of some expression should be indented further in than the beginning of that expression</em>\". However, I found the following example, which seems to violate the rule above, compiles without any error or warning:</p>\n\n<pre><code>someFunction :: Bool -&gt; Int -&gt; Int -&gt; Int\nsomeFunction condition a b = if condition\nthen a - b\n      else a + b\n</code></pre>\n\n<p>Here I am defining a function <code>someFunction</code>, its body is an <code>if-then-else</code> block. According to the indentation rule, the <code>then</code> block is a part of the same expression in the first line, so it should be indented further than its previous line. Yet in my example, the second line <code>then</code> starts at the same column as the first line, and this example compiles.</p>\n\n<p>I am not sure what is going on here. I am working with GHC version 8.0.1.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 5, "creation_date": 1505074630, "post_id": 46144789, "comment_id": 79252146, "body": "Since <code>&quot;AM&quot; &lt; &quot;PM&quot;</code> the final implementation of <code>comesBefore</code> is the same as <code>comesBefore = (&lt;)</code>. I suspect <code>&quot;AM&quot;</code> and <code>&quot;PM&quot;</code> should be compared first, before the hours: <code>comesBefore (h1, m1, p1) (h2, m2, p2) = (p1, h1, m1) &lt; (p2, h2, m2)</code>. Both of these probably miss the point of the exercise (figure out for yourself what an ordering for a tuple is)."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 2, "last_activity_date": 1505072496, "last_edit_date": 1505072496, "creation_date": 1505072092, "answer_id": 46144789, "question_id": 46144751, "link": "https://stackoverflow.com/questions/46144751/haskell-error-parse-error-on-input/46144789#46144789", "title": "Haskell error - parse error on input &#39;|&#39;", "body": "<p>You need to indent those <code>|</code> lines more than <code>comesBefore</code>:</p>\n\n<pre><code>comesBefore (x1,y1,z1)(x2,y2,z2) | (x1&lt;x2) = True\n  | (x1&gt;x2) = False\n  | (x1==x2) &amp;&amp; (y1&lt;y2) = True\n  | (x1==x2) &amp;&amp; (y1&gt;y2) = False\n  | (x1==x2) &amp;&amp; (y1==y2) &amp;&amp; (z1==\"AM\") &amp;&amp; (z2==\"PM\") = True\n  | (x1==x2) &amp;&amp; (y1==y2) &amp;&amp; (z1==\"PM\") &amp;&amp; (z2==\"AM\") = False\n</code></pre>\n\n<p>There's a lot of redundant comparisons in there. You could eliminate those:</p>\n\n<pre><code>comesBefore (x1,y1,z1) (x2,y2,z2)\n  | x1 &lt; x2 = True\n  | x1 &gt; x2 = False\n  | y1 &lt; y2 = True\n  | y1 &gt; y2 = False\n  | z1 == \"AM\" &amp;&amp; z2 == \"PM\" = True\n  | z1 == \"PM\" &amp;&amp; z2 == \"AM\" = False\n</code></pre>\n\n<p>Finally, we could actually get rid of all guards because you're just checking some conditions and returning a Boolean value:</p>\n\n<pre><code>comesBefore (x1,y1,z1) (x2,y2,z2) =\n    x1 &lt; x2 || (x1 == x2 &amp;&amp; (y1 &lt; y2 || (y1 == y2 &amp;&amp; z1 == \"AM\" &amp;&amp; z2 == \"PM\")))\n</code></pre>\n\n<p>This is not quite the same as the previous version because this one always returns a value. Your original version is not defined if the strings aren't either <code>\"AM\"</code>/<code>\"PM\"</code> or <code>\"PM\"</code>/<code>\"AM\"</code>.</p>\n"}], "owner": {"reputation": 103, "user_id": 8588796, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210454551536049/picture?type=large", "display_name": "Blake Lewis", "link": "https://stackoverflow.com/users/8588796/blake-lewis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 46144789, "answer_count": 1, "score": 1, "last_activity_date": 1505072496, "creation_date": 1505071885, "question_id": 46144751, "link": "https://stackoverflow.com/questions/46144751/haskell-error-parse-error-on-input", "title": "Haskell error - parse error on input &#39;|&#39;", "body": "<p>I'm currently working on an assignment for a class that focuses on coding in Haskell, and I have run into a problem in one of my exercises. This is the specific exercise:</p>\n\n<p>The time of day can be represented by a tuple (hours,minutes,m) where m indicates either \"AM\" or \"PM\". Develop a Boolean Haskell function comesBefore that takes two time-of-day tuples and determines whether the first is an earlier time than the second.</p>\n\n<p>Here is my solution code: </p>\n\n<pre><code>comesBefore :: (Int,Int,String) -&gt; (Int,Int,String) -&gt; Bool\n\ncomesBefore (x1,y1,z1)(x2,y2,z2) | (x1&lt;x2) = True\n| (x1&gt;x2) = False\n| (x1==x2) &amp;&amp; (y1&lt;y2) = True\n| (x1==x2) &amp;&amp; (y1&gt;y2) = False\n| (x1==x2) &amp;&amp; (y1==y2) &amp;&amp; (z1==\"AM\") &amp;&amp; (z2==\"PM\") = True\n| (x1==x2) &amp;&amp; (y1==y2) &amp;&amp; (z1==\"PM\") &amp;&amp; (z2==\"AM\") = False\n\nmain= print(comesBefore (4,20,\"AM\")(4,15,\"AM\"))\n</code></pre>\n\n<p>The error I'm getting says \"error: parse error on input \u2018|\u2019\" for the first '|'. I'm seeing this is a common error for Haskell programs, and I've tried different spacing solutions, and nothing is working. Any help would be appreciated! Thanks! :)</p>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 571, "user_id": 4493361, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-1j2w11MYwK8/AAAAAAAAAAI/AAAAAAAAAEM/cllVRT5KBFs/photo.jpg?sz=128", "display_name": "ccQpein", "link": "https://stackoverflow.com/users/4493361/ccqpein"}, "edited": false, "score": 0, "creation_date": 1505073083, "post_id": 46144683, "comment_id": 79251620, "body": "I saw <code>Map.Map</code> source code given a <code>Tip</code> and <code>Bin</code> constructor for <code>Map k v</code> which <code>empty = Tip</code>. According to this wiki: <a href=\"https://en.wikibooks.org/wiki/Haskell/Pattern_matching\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/Pattern_matching</a> , pattern matching could match constructor in <code>data Foo</code>. So, the problem is Data.Map.Lazy does not export Tip and Bin, right?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 571, "user_id": 4493361, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-1j2w11MYwK8/AAAAAAAAAAI/AAAAAAAAAEM/cllVRT5KBFs/photo.jpg?sz=128", "display_name": "ccQpein", "link": "https://stackoverflow.com/users/4493361/ccqpein"}, "edited": false, "score": 1, "creation_date": 1505073239, "post_id": 46144683, "comment_id": 79251673, "body": "@ccQpein Right. <code>Map</code> is abstract (the implementation is private), so you can&#39;t directly access its constructors."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 3, "creation_date": 1505074453, "post_id": 46144683, "comment_id": 79252088, "body": "Can also use <code>ViewPatterns</code> here, <code>testF (Map.null -&gt; True) _ = [1024]</code>, although stylistically I prefer a guard for such a simple case."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1505101837, "post_id": 46144683, "comment_id": 79257449, "body": "It would also be possible to write a pattern synonym for the empty map, but as @JonPurdy says about the view pattern, it hardly seems worth the trouble. There aren&#39;t really any other patterns that would go along with it to form a particularly useful set. I mean, you <i>could</i> write patterns for inspecting the first and last elements of the map, but that&#39;s just not a common enough operation to worry about."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 7, "last_activity_date": 1505071457, "creation_date": 1505071457, "answer_id": 46144683, "question_id": 46144610, "link": "https://stackoverflow.com/questions/46144610/haskell-pattern-matching-match-map-empty-any-with-any-map-map-k-v/46144683#46144683", "title": "Haskell pattern matching match Map.empty any with any Map.Map k v", "body": "<p>You're not matching against <code>Map.empty</code>, you're matching against <code>empty</code>, which is just a local variable bound to whatever map is coming in. You can't match against <code>Map.empty</code> because it's not a constructor.</p>\n\n<p>What you can do instead is:</p>\n\n<pre><code>testF m _ | Map.null m = [1024]\n</code></pre>\n\n<p>I.e. use a guard to check whether <code>m</code> is empty.</p>\n"}], "owner": {"reputation": 571, "user_id": 4493361, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-1j2w11MYwK8/AAAAAAAAAAI/AAAAAAAAAEM/cllVRT5KBFs/photo.jpg?sz=128", "display_name": "ccQpein", "link": "https://stackoverflow.com/users/4493361/ccqpein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 978, "favorite_count": 0, "accepted_answer_id": 46144683, "answer_count": 1, "score": 0, "last_activity_date": 1505071457, "creation_date": 1505070889, "question_id": 46144610, "link": "https://stackoverflow.com/questions/46144610/haskell-pattern-matching-match-map-empty-any-with-any-map-map-k-v", "title": "Haskell pattern matching match Map.empty any with any Map.Map k v", "body": "<p>I am writing a function which has different operations depending on <code>Map.Map</code> in argument if Map is empty or not</p>\n\n<p>Here is my code:</p>\n\n<pre><code>import qualified Data.Map.Lazy as Map\n\ntestF :: (Ord a, Num a) =&gt; Map.Map a a -&gt; [a] -&gt; [a]\ntestF empty _  = [1024]\ntestF _ []     = []\ntestF m (x:xs) = [x] ++ (testF m xs)\n\nmain = do\n  let a = Map.fromList [(1,2), (3,4)]\n  print $ testF Map.empty [1,2,3] -- show [1024]\n  print $ testF a [1,2,3] -- show [1024] too\n  print $ a == Map.empty -- False\n</code></pre>\n\n<p>Of course GHC already give me notification that lastest line of function is redundant.</p>\n\n<pre><code>Pattern match is redundant\n   In an equation for \u2018testF\u2019: testF m (x : xs) =\n</code></pre>\n\n<ol>\n<li>Why every Map.Map can match Map.empty?</li>\n<li>What should I do to implement my requirement?</li>\n</ol>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "charts", "gtk"], "owner": {"reputation": 11, "user_id": 8588702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9554596828f4e204a7b8daea78cf9f4f?s=128&d=identicon&r=PG&f=1", "display_name": "Cypress", "link": "https://stackoverflow.com/users/8588702/cypress"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1505070020, "creation_date": 1505070020, "question_id": 46144450, "link": "https://stackoverflow.com/questions/46144450/how-do-i-do-gtk-mouse-interaction-correctly-with-haskell-chart-library", "title": "How do I do gtk mouse interaction correctly with Haskell Chart library?", "body": "<p>I'm using <a href=\"https://hackage.haskell.org/package/Chart-1.8.2\" rel=\"nofollow noreferrer\">this library</a></p>\n\n<p>As of now I have a point that follows the mouse, but it only kind of works because I assume the window will be 500x500, and the point is never directly behind the mouse because (0,0) on the graph is not (0,0) on the window.</p>\n\n<p>If I could just figure out what the graph origin is relative to the window's coordinates, then I could fix everything, but I can't seem to figure out how to do that. Graphics.Rendering.Chart.Renderable seems relevant, such as the \"Pick Function\" and RectSize, but again I'm not sure how to actually get anything relevant from it. Graphics.Rendering.Chart.Backend may also be relevant.</p>\n\n<p>Or this may actually be something to solve with gtk? I don't know.</p>\n\n<p>Please help, this has been killing me.</p>\n\n<p>EDIT: <a href=\"http://lpaste.net/358331\" rel=\"nofollow noreferrer\">Here's my current code if it helps</a></p>\n"}, {"tags": ["arrays", "sorting", "haskell", "functional-programming", "purescript"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1505069253, "post_id": 46144282, "comment_id": 79250422, "body": "What should happen if one of the <code>name</code>s isn\u2019t present in the sorted list of <code>String</code>s?"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 1, "creation_date": 1505070115, "post_id": 46144282, "comment_id": 79250663, "body": "I suggest that you sort <code>moduleinfo</code> directly."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1505070617, "post_id": 46144282, "comment_id": 79250831, "body": "Note that you should post complete code that will compile. In particular, <code>{name :: String, pack :: String }</code> causes compiler errors because you are missing <code>data</code> and a name for the data type."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1505088548, "post_id": 46144282, "comment_id": 79255080, "body": "Use the sorted array to make a hashmap or triemap from module name to index in the sorted array."}], "answers": [{"tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": false, "score": 1, "last_activity_date": 1505070501, "creation_date": 1505070501, "answer_id": 46144539, "question_id": 46144282, "link": "https://stackoverflow.com/questions/46144282/sort-an-array-based-on-an-array-of-another-different-type-in-haskell-or-purescri/46144539#46144539", "title": "sort an array based on an array of another/different type in haskell or purescript", "body": "<p>I suggest that you sort <code>moduleinfo</code> directly:</p>\n\n<pre><code>sortedModuleInfo = sortWith (\\(Module name1 pack1) (Module name2 pack2) -&gt; compare name1 name2) moduleinfo\n</code></pre>\n\n<p>Here I assume that you have declared a type named  <code>Module</code> with the <code>name</code> and <code>pack</code> elements which you showed in your question.</p>\n"}], "owner": {"reputation": 1, "user_id": 6647708, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0LbkG.png?s=128&g=1", "display_name": "Nikhil Nagaraju", "link": "https://stackoverflow.com/users/6647708/nikhil-nagaraju"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1521542267, "creation_date": 1505069037, "last_edit_date": 1521542267, "question_id": 46144282, "link": "https://stackoverflow.com/questions/46144282/sort-an-array-based-on-an-array-of-another-different-type-in-haskell-or-purescri", "title": "sort an array based on an array of another/different type in haskell or purescript", "body": "<p>I have two Arrays of different types, 1) say <code>moduleinfo</code> array which has each element of type </p>\n\n<p><code>{name :: String, pack :: String }</code> </p>\n\n<p>and 2) <code>String</code> Array. The simple <code>String</code> array contains element that is similar to the <code>name</code> field of <code>moduleinfo</code>, i.e <code>String</code>. The simple <code>String</code> array is already sorted but not the <code>moduleinfo</code> array.</p>\n\n<p>How do I write a function to sort the <code>moduleinfo</code> array based on the order of simple <code>String</code> array. Given that the <code>name</code> field in <code>moduleinfo</code> would match with simple <code>String</code> array elements. </p>\n\n<p>The function shall return a sorted array of <code>moduleinfo</code> type.</p>\n"}, {"tags": ["haskell", "monad-transformers", "haddock"], "owner": {"reputation": 2862, "user_id": 2613769, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/200dde59bd0be1e302c0d89ed34f5081?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/2613769/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "closed_date": 1505059883, "answer_count": 0, "score": 1, "last_activity_date": 1505059757, "creation_date": 1505059357, "last_edit_date": 1505059757, "question_id": 46142689, "link": "https://stackoverflow.com/questions/46142689/what-does-the-star-in-instance-documentation-mean", "closed_reason": "Duplicate", "title": "What does the star (*) in instance documentation mean?", "body": "<p>In the <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Class.html#t:MonadState\" rel=\"nofollow noreferrer\">MonadState doc page</a>, there's a star (*) inside the <code>ReaderT</code> type of the <code>MonadState</code> instance:</p>\n\n<pre><code>MonadState s m =&gt; MonadState s (ReaderT * r m)\n</code></pre>\n\n<p>But actually in the source, there's no star:</p>\n\n<pre><code>instance MonadState s m =&gt; MonadState s (ReaderT r m) where\n</code></pre>\n\n<p>So what does the star mean in the doc?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 0, "last_activity_date": 1505105069, "creation_date": 1505105069, "answer_id": 46148324, "question_id": 46142618, "link": "https://stackoverflow.com/questions/46142618/how-do-i-work-with-the-repa-bytestring-representation/46148324#46148324", "title": "How do I work with the REPA ByteString representation?", "body": "<p>I can't see how to produce an <code>Array B</code> with repa either. It has none of the relevant instances for that. Would you like to <a href=\"https://github.com/haskell-repa/repa/issues\" rel=\"nofollow noreferrer\">open an issue</a>?</p>\n\n<p>One obvious and mostly safe workaround is to extract a pair <code>(Int, Int -&gt; Word8)</code> from the delayed representation and use <code>unfoldrN</code> (the most fitting function I could find from the public API of bytestring).</p>\n\n<p>A <code>ByteString</code> is really a decorated <code>ForeignPtr</code>, so you can use the <code>F</code> representation (which has a <code>Target</code> instance), get a <code>ForeignPtr</code> out, and call <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.1/docs/src/Data-ByteString-Internal.html#fromForeignPtr\" rel=\"nofollow noreferrer\"><code>Data.ByteString.Internal.fromForeignPtr</code></a>.</p>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1505105069, "creation_date": 1505058805, "question_id": 46142618, "link": "https://stackoverflow.com/questions/46142618/how-do-i-work-with-the-repa-bytestring-representation", "title": "How do I work with the REPA ByteString representation?", "body": "<p>I want to use REPA arrays built from <code>ByteString</code> types. I can create an array with the <code>fromByteString</code> function that has the type <code>Array B sh Word8</code>. However, there is no equivalent <code>computeS</code> function for the <code>B</code> type arrays.</p>\n\n<p>The biggest issue is that I want a <code>ByteString</code> type at the end, but the function <code>toByteString</code> requires a <code>Array B sh Word8</code> type which I cannot create.</p>\n\n<p>It feels like the bytestring module in REPA is not fully implemented. As a comparison, the vector module provides <code>computeVectorS</code>, the foreignPointer module provides <code>computeIntoS</code>. Is there a reason that bytestrings are missing an equivalent function?</p>\n"}, {"tags": ["haskell", "types", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "is_accepted": true, "score": 9, "last_activity_date": 1505065272, "last_edit_date": 1505065272, "creation_date": 1505056464, "answer_id": 46142247, "question_id": 46142202, "link": "https://stackoverflow.com/questions/46142202/show-type-of-each-result-in-ghci/46142247#46142247", "title": "Show type of each result in GHCi", "body": "<p>Add <code>:set +t</code> to <code>.ghci</code>.</p>\n\n<p>From <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#ghci-options\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<pre><code>+t\n    Display the type of each variable bound after a statement is entered at the prompt.\n    If the statement is a single expression, then the only variable binding will be for\n    the variable \u2018it\u2019.\n</code></pre>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 400, "favorite_count": 0, "accepted_answer_id": 46142247, "answer_count": 1, "score": 4, "last_activity_date": 1505065272, "creation_date": 1505056215, "last_edit_date": 1505056409, "question_id": 46142202, "link": "https://stackoverflow.com/questions/46142202/show-type-of-each-result-in-ghci", "title": "Show type of each result in GHCi", "body": "<p>How can I show type of resulting expression in GHCi after each command?\nFor example, instead of</p>\n\n<pre><code>ghci&gt; \"hello\" ++ \" world\"\n\"hello world\"\n</code></pre>\n\n<p>I want to see</p>\n\n<pre><code>ghci&gt; \"hello\" ++ \" world\"\n\"hello world\" :: String\n</code></pre>\n\n<p>or at least</p>\n\n<pre><code>ghci&gt; \"hello\" ++ \" world\"\n\"hello world\" :: [Char]\n</code></pre>\n\n<p>REPLs for other languages provide such behavior by default. But I can't find <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/using.html#verbosity-options\" rel=\"nofollow noreferrer\">proper ghci option</a> for such behavior. It also will be ok for me to just print type of <code>it</code> after executing every command. But I didn't find a way how to call my commands after each ghci command. Well, sensible command: <code>let ... = ...</code> doesn't have result (though it would be nice to print type of defined variable).\nSo what are the ways to show type of result automatically after each command?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1505057081, "post_id": 46141280, "comment_id": 79246383, "body": "Maybe you could use <a href=\"https://hackage.haskell.org/package/vector\" rel=\"nofollow noreferrer\"><code>vector</code></a> instead?"}, {"owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1505057279, "post_id": 46141280, "comment_id": 79246456, "body": "That might be the best way to go. Can <code>vector</code> types have 2D indexing? <code>array</code> types have convenient indexing."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1505059083, "post_id": 46141280, "comment_id": 79247019, "body": "No, vectors can only be indexed by <code>Int</code> as far as I know."}], "answers": [{"comments": [{"owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "edited": false, "score": 0, "creation_date": 1505059341, "post_id": 46142661, "comment_id": 79247096, "body": "Is there a performance hit from converting back from a list? It seems like an indirect way."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "edited": false, "score": 0, "creation_date": 1505059769, "post_id": 46142661, "comment_id": 79247228, "body": "@user668074 As always with these questions, you have to ask &quot;performance hit compared to <i>what</i>?&quot;. The most obvious alternative seems to be making a mutable array, looping over indices, writing in the results, and then freezing; it seems to me the cost of taking steps in the loop is going to be basically identical to the cost of walking down this list. More realistically I expect the repeated bounds checking (shared by both approaches) is going to be the more noticeable cost. But if you care a lot... take some measurements!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1505059109, "creation_date": 1505059109, "answer_id": 46142661, "question_id": 46141280, "link": "https://stackoverflow.com/questions/46141280/is-there-a-zipwith-function-for-arrays/46142661#46142661", "title": "Is there a zipWith function for arrays?", "body": "<p>It's pretty easy to cook one up yourself:</p>\n\n<pre><code>zipWithA f xs ys = listArray (bounds xs) [f (xs ! i) (ys ! i) | i &lt;- range (bounds xs)]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1505091776, "post_id": 46144020, "comment_id": 79255689, "body": "Why avoid list comprehensions?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1505100444, "post_id": 46144020, "comment_id": 79257132, "body": "Because list comprehensions can introduce incomplete pattern matches that -Wall doesn&#39;t catch."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": true, "score": 2, "last_activity_date": 1505067423, "creation_date": 1505067423, "answer_id": 46144020, "question_id": 46141280, "link": "https://stackoverflow.com/questions/46141280/is-there-a-zipwith-function-for-arrays/46144020#46144020", "title": "Is there a zipWith function for arrays?", "body": "<p>Option 1: use <a href=\"https://hackage.haskell.org/package/repa-3.4.1.3/docs/Data-Array-Repa.html\" rel=\"nofollow noreferrer\">repa</a>. Might get some performance benefit from the parallelism as well, should you care about it.</p>\n\n<p>Option 2: just get indices using <code>bounds</code>. I would suggest avoiding list comprehensions in general; though the other answer uses them correctly in this case, it may be worthwhile to get in the habit of doing the right thing.</p>\n\n<pre><code>zipWithArr f xs ys = listArray (bounds xs) $ fmap (liftA2 f (xs !) (ys !)) (range (bounds xs))\n</code></pre>\n\n<p>The reason that this works is that Haskell's lists are lazy, and we can generally treat them as control structures (due to various optimizations), though we can <em>not</em> treat them as containers. Moreover, GHC evaluates an expression at most once per lambda, so in general you do not need to worry that this will be done inefficiently.</p>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "accepted_answer_id": 46144020, "answer_count": 2, "score": 3, "last_activity_date": 1505067423, "creation_date": 1505050516, "question_id": 46141280, "link": "https://stackoverflow.com/questions/46141280/is-there-a-zipwith-function-for-arrays", "title": "Is there a zipWith function for arrays?", "body": "<p>I have two arrays of equal size and I want to combine them element-wise. What is the best way to do this? The <code>array</code> package doesn't seem to provide a <code>zipWith</code> equivalent function.</p>\n\n<p>I'm reluctant to make my own function because the main way I can think of doing this is to convert back and forth with lists. I care about speed and I assume this way is not the most efficient way.</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1505075021, "post_id": 46141240, "comment_id": 79252263, "body": "One thing people do to avoid re-typing <code>Eq, Ord, ...</code> is <code>CPP</code>ing it."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1505080192, "post_id": 46141240, "comment_id": 79253602, "body": "You can have something like <code>\\x -&gt; let xn = varT x in [t|UserT $xn $xn|] :: Name -&gt; Q Type</code> - this is probably fine for your purposes. The type of your function then becomes <code>(Name -&gt; Q Type) -&gt; Q [Dec]</code>. I would probably do it slightly differently - have a function of type <code>Q [Dec] -&gt; Q [Dec]</code> which is called like <code>deriveContext [d| instance Foo (T x) |]</code> (and <code>deriveContext</code> would produce an error if it&#39;s given a <code>Dec</code> which isn&#39;t an instance declaration)."}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1505050212, "creation_date": 1505050212, "question_id": 46141240, "link": "https://stackoverflow.com/questions/46141240/using-template-haskell-to-derive-classes", "title": "Using Template Haskell to derive classes", "body": "<p>So, I found myself doing something like this:</p>\n\n<pre><code>newtype T x = T x deriving (Eq, Ord, ...) \n</code></pre>\n\n<p>And I thought this was annoying, so I'm thinking about making a package, using Template Haskell, that adds all the instances in base.</p>\n\n<p>Perhaps it could even be more flexible than just dealing with what's above.</p>\n\n<p>Firstly, it seems like Template Haskell can only spit out declarations, so I think I want to use standalone deriving. In general, I think I want to produce declarations something like this:</p>\n\n<pre><code>deriving instance (F x1, F x2, ... , F xn) =&gt; T x1 x2 x3\n</code></pre>\n\n<p>Where <code>F</code> is replaced by <code>Eq</code>, <code>Ord</code>, etc.</p>\n\n<p>But the right hand side could be a bit more complex, for example:</p>\n\n<pre><code>deriving instance (F x1, F x2, ... , F xn) =&gt; T x1 (Maybe x2) x3\n</code></pre>\n\n<p>Or maybe even</p>\n\n<pre><code>deriving instance (F x1, F x2, ... , F xn) =&gt; T x1 (T2 x2 x3)\n</code></pre>\n\n<p>You could even have repeats:</p>\n\n<pre><code>deriving instance F x =&gt; T x x\n</code></pre>\n\n<p>Lets simplify things for a moment here, and assume there is only one parameter on the left. So we're looking at instances like this:</p>\n\n<pre><code>deriving instance F x =&gt; T (some stuff involving x)\n</code></pre>\n\n<p>I figure what I need is a function like the following:</p>\n\n<pre><code>(Name -&gt; Type) -&gt; Q [Dec]\n</code></pre>\n\n<p>Then I keep each class in base in a list (i.e. <code>Eq</code>, <code>Ord</code> etc). Then for each class of that list, I create a dummy variable, apply the class to it on the left hand side of the <code>=&gt;</code>, and pass it to the <code>Name -&gt; Type</code> argument passed to get the right hand side of the <code>=&gt;</code>. I can the spit that out as a splice.</p>\n\n<p>I think I can do the Template Haskell for the above function, but the problem is, how does a user use that Template Haskell function?</p>\n\n<p>I think something like <code>\\x -&gt; [| UserT x x |]</code> won't work, will it? </p>\n\n<p>I want the user to be able to do something like:</p>\n\n<pre><code>data A t = A t (Maybe t)\n\nderiveClasses (\\x -&gt; A x) \n</code></pre>\n\n<p>How can I make this sort of thing nice for the end user? I hope this question makes some sort of sense, the thing I'm currently most focused on is a form that's easy for the user to use. When it comes to the actual writing of the Template Haskell I think I should be able to handle that.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 0, "last_activity_date": 1505101449, "creation_date": 1505101449, "answer_id": 46147888, "question_id": 46139146, "link": "https://stackoverflow.com/questions/46139146/how-to-speed-up-stack-build-with-profiling-enabled/46147888#46147888", "title": "How to speed up Stack &#39;build&#39; with profiling enabled?", "body": "<blockquote>\n  <p>Is there a way to not rebuild the external libraries or another way to speed up the builds?</p>\n</blockquote>\n\n<p>If you apply <code>--profile</code>, you need to build profiling versions of all the dependencies. Stack has the <code>--fast</code> flag you can use during development cycles, but it's probably not a good idea here, since the purpose of profiling is (I imagine) to get a good idea of which functions are called most often during real-world use. GHC with the optimizations off will produce very different code than GHC with the optimizations on.</p>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 192, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1505101449, "creation_date": 1505035400, "question_id": 46139146, "link": "https://stackoverflow.com/questions/46139146/how-to-speed-up-stack-build-with-profiling-enabled", "title": "How to speed up Stack &#39;build&#39; with profiling enabled?", "body": "<p>I'm building a program with <code>stack build --profile</code>. However, this takes a long time compared to building without profiling. It seems that it's because it has to rebuild the external libraries? Is there a way to not rebuild the external libraries or another way to speed up the builds?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1505024473, "post_id": 46137788, "comment_id": 79237695, "body": "Well <code>++</code> is performed lazily."}, {"owner": {"reputation": 253, "user_id": 8423622, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e0fd3c2609ac77126477434153dcb440?s=128&d=identicon&r=PG&f=1", "display_name": "johnson", "link": "https://stackoverflow.com/users/8423622/johnson"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1505025171, "post_id": 46137788, "comment_id": 79237844, "body": "so why does GHCI keep printing out lists"}, {"owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 1, "creation_date": 1505027160, "post_id": 46137788, "comment_id": 79238222, "body": "Try evaluating it for eg <code>xs = [1]</code>. <code>xs&#39; = [1] ++ (xs ++ xs&#39;) = [1] ++ ([1] + (xs ++ xs&#39;) = ...</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1505048617, "last_edit_date": 1505048617, "creation_date": 1505029444, "answer_id": 46138426, "question_id": 46137788, "link": "https://stackoverflow.com/questions/46137788/haskell-cycle-function/46138426#46138426", "title": "Haskell Cycle function", "body": "<p>A list, like basically everything else in Haskell, is lazily evaluated.</p>\n\n<p>Roughly, to make an OOP analogy, you can think of a list as a sort of \"iterator object\". When queried, it reports on whether there is a next element, and if so, what is such element and what is the tail of the list (this being another \"iterator object\").</p>\n\n<p>A list defined as</p>\n\n<pre><code>xs = 1 : xs\n</code></pre>\n\n<p>does not cause non termination. It corresponds to an \"iterator object\" <code>o</code> that, when queried, answers: \"the next element is <code>1</code>, and the rest of the list can be queried using <code>o</code>\". Basically, it returns itself.</p>\n\n<p>This is no different than a list having as a tail a \"pointer\" to the list itself: a circular list. This takes a constant amount of space.</p>\n\n<p>Appending with <code>++</code> works the same:</p>\n\n<pre><code>xs = [1] ++ xs\n</code></pre>\n\n<p>is identical to the previous list.</p>\n\n<p>In your code, the part</p>\n\n<pre><code>where xs' = xs ++ xs'\n</code></pre>\n\n<p>crafts a list that starts with <code>xs</code> and then continues with the list itself <code>xs'</code>. Operationally, it is an \"iterator object\" <code>o</code> that returns, one by one, the elements of <code>xs</code>, and when the last element of <code>xs</code> is returned, it is paired with \"you can query the rest of the list at <code>o</code>\". Again, a back-pointer, which builds a sort of circular list.</p>\n"}, {"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1505111626, "last_edit_date": 1505111626, "creation_date": 1505055072, "answer_id": 46141996, "question_id": 46137788, "link": "https://stackoverflow.com/questions/46137788/haskell-cycle-function/46141996#46141996", "title": "Haskell Cycle function", "body": "<p>Let's take out the last line separately:</p>\n\n<pre><code>cycle xs                = xs' where xs' = xs ++ xs'\n</code></pre>\n\n<p>Now, let's try to reduce it:</p>\n\n<pre><code>cycle xs                = xs ++ (xs ++ (xs ++ (xs ++ ...)))\n</code></pre>\n\n<p>You can see that it expands infinitely. But note that this is not how expressions get reduced in Haskell. Expressions will be reduced to <a href=\"https://stackoverflow.com/questions/6872898/haskell-what-is-weak-head-normal-form\">WHNF</a> when it's demanded. So, let's demand some values from <code>cycle</code> function:</p>\n\n<pre><code>ghci &gt; take 1 $ cycle [1..]\n[1]\n</code></pre>\n\n<p>This is how <code>take</code> function is implemented:</p>\n\n<pre><code>take n _      | n &lt;= 0 =  []\ntake _ []              =  []\ntake n (x:xs)          =  x : take (n-1) xs\n</code></pre>\n\n<p>Now, because of pattern matching - the value <code>n</code> will be evaluated first. Since it is already in normal form, no further reduction needs to be done and it will be checked if it is less than or equal to zero. Since the condition fails, it will move on to the second condition. Here, it's second argument will be checked to see if it's equal to <code>[]</code>. As usual, haskell will evaluate it to WHNF which will be <code>1:_</code>. Here <code>_</code> represents thunk. Now the whole expression will be reduced to <code>1:take 0 _</code>. Since this value has to be printed in ghci, the whole <code>1:take 0 _</code> will be reduced again. Following the similar steps like above again, we will get <code>1:[]</code> which reduces to <code>[1]</code>.\nHence <code>cycle [1,2,3]</code> will get reduced to WHNF in the form <code>(1:xs)</code> and will be ultimately reduced to <code>[1]</code>. But if the cycle function, itself is strict in it's implementation, then it will just go into an infinite loop:</p>\n\n<pre><code>cycle :: NFData a =&gt; [a] -&gt; [a]\ncycle [] = []\ncycle xs = let xs' = xs ++ xs'\n           in deepseq xs xs'\n</code></pre>\n\n<p>You can test that in ghci:    </p>\n\n<pre><code>ghci &gt; take 1 $ cycle [1..]\n^CInterrupted.\n</code></pre>\n"}], "owner": {"reputation": 253, "user_id": 8423622, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e0fd3c2609ac77126477434153dcb440?s=128&d=identicon&r=PG&f=1", "display_name": "johnson", "link": "https://stackoverflow.com/users/8423622/johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2891, "favorite_count": 0, "accepted_answer_id": 46141996, "answer_count": 2, "score": 2, "last_activity_date": 1505111626, "creation_date": 1505023879, "question_id": 46137788, "link": "https://stackoverflow.com/questions/46137788/haskell-cycle-function", "title": "Haskell Cycle function", "body": "<p>The code for cycle is as follows</p>\n\n<pre><code>cycle                   :: [a] -&gt; [a]\ncycle []                = errorEmptyList \"cycle\"\ncycle xs                = xs' where xs' = xs ++ xs'\n</code></pre>\n\n<p>I would appreciate an explanation on how the last line works. I feel that it would go off into an infinite recursion without returning or shall I say without printing anything on the screen. I guess my intuition is wrong.</p>\n"}, {"tags": ["haskell", "vector"], "answers": [{"comments": [{"owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "edited": false, "score": 0, "creation_date": 1505050154, "post_id": 46137417, "comment_id": 79244039, "body": "I&#39;m not familiar with how to use fusion but it sounds like using immutable vectors might be the best thing to use."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "edited": false, "score": 0, "creation_date": 1505103043, "post_id": 46137417, "comment_id": 79257706, "body": "@user668074, one reason you may not want to actually modify all the elements like this is that laziness could kill your efficiency. A <code>mapModify&#39;</code> that forces each result before installing it would probably be more useful. If the lazy pure version fuses with some other operation, it could also be okay."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 6, "last_activity_date": 1505019323, "creation_date": 1505019323, "answer_id": 46137417, "question_id": 46137356, "link": "https://stackoverflow.com/questions/46137356/is-there-an-inplace-map-function-for-mutable-vectors/46137417#46137417", "title": "Is there an inplace map function for mutable vectors?", "body": "<p>Yep, use <code>modify</code> if you want to modify elements in place. If you find yourself often modifying everything in place, you can define <code>mapModify</code> as follows.</p>\n\n<pre><code>import Data.Foldable (for_)\nimport qualified Data.Vector.Mutable as MV\n\nmapModify :: (a -&gt; a) -&gt; IOVector a -&gt; IO ()\nmapModify f v = for_ [0 .. MV.length v - 1)] (MV.modify v f)\n</code></pre>\n\n<p>That said, constantly modifying all elements in a vector sounds like you may be better off using immutable vectors and mapping over them using the regular <code>fmap</code>. If that code ends up fusing properly, the intermediate vectors will never even be materialized.</p>\n"}], "owner": {"reputation": 1029, "user_id": 668074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f82d3dd033cd691ad5340b9620bdcf38?s=128&d=identicon&r=PG", "display_name": "user668074", "link": "https://stackoverflow.com/users/668074/user668074"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 46137417, "answer_count": 1, "score": 1, "last_activity_date": 1505081918, "creation_date": 1505018368, "last_edit_date": 1505081918, "question_id": 46137356, "link": "https://stackoverflow.com/questions/46137356/is-there-an-inplace-map-function-for-mutable-vectors", "title": "Is there an inplace map function for mutable vectors?", "body": "<p>If I have a mutable vector (with type <code>IOVector a</code> for example), is there a map-like function that can modify the elements in place?</p>\n\n<p>The <code>vector</code> package provides the <code>modify</code> function but this is only one element at a time. Should I use this or is there a preferred method?</p>\n\n<p>And to clarify, the type of the vector will be the same before and after.</p>\n"}, {"tags": ["haskell", "purescript"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 7, "creation_date": 1504999938, "post_id": 46136009, "comment_id": 79234347, "body": "\u201cIs it merely a separator?\u201d Yes."}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 0, "creation_date": 1505000684, "post_id": 46136009, "comment_id": 79234454, "body": "And a low precedence one at that. Better than having to parenthesize all the stuff after it...."}], "answers": [{"comments": [{"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 3, "creation_date": 1505002013, "post_id": 46136067, "comment_id": 79234692, "body": "The other usual notations in mathematics are rather annoying for programming: <code>forall a (Num a =&gt; a -&gt; a -&gt; a)</code> and <code>forall a : Num a =&gt; a -&gt; a -&gt; a</code>. This leaves us with <code>.</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1505002226, "post_id": 46136067, "comment_id": 79234726, "body": "@rightfold <code>:</code> wouldn&#39;t have been that bad, I suppose"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 543, "user_id": 6754526, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/60bc5a2322d33e27c6c7cf874a93d234?s=128&d=identicon&r=PG&f=1", "display_name": "M. Walker", "link": "https://stackoverflow.com/users/6754526/m-walker"}, "edited": false, "score": 4, "creation_date": 1505030948, "post_id": 46136067, "comment_id": 79239065, "body": "@M.Walker Many mathematicians do as well. The problem is that, in type theory, programming languages theory (and category theory to some extent), we write a lot of &quot;forall x:T, y:A-&gt;B, ...&quot;. Writing &quot;forall x:T: p(x)&quot; looks strange. Historically a trend formed to write &quot;forall x:T. p(x)&quot;, perhaps borrowing the &quot;dot&quot; separator from lambda calculus. (I don&#39;t know who started that, though -- Peano/Russell used dots, but differently.) Haskell followed that trend (but without commas). In CS papers, I often see dots, but other notations are used as well."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 15, "last_activity_date": 1505002491, "last_edit_date": 1505002491, "creation_date": 1505000704, "answer_id": 46136067, "question_id": 46136009, "link": "https://stackoverflow.com/questions/46136009/forall-notation-what-does-the-period-dot-mean/46136067#46136067", "title": "forall notation: what does the period / dot mean?", "body": "<p>Yes, it's just a syntactic separator. It separates variable declarations from variable usages, just like the <code>-&gt;</code> in a lambda expression. It means \"Here endeth the binders\". I suppose the language designers went for <code>.</code> because it's 22 characters shorter.</p>\n"}], "owner": {"reputation": 543, "user_id": 6754526, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/60bc5a2322d33e27c6c7cf874a93d234?s=128&d=identicon&r=PG&f=1", "display_name": "M. Walker", "link": "https://stackoverflow.com/users/6754526/m-walker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "accepted_answer_id": 46136067, "answer_count": 1, "score": 8, "last_activity_date": 1505002491, "creation_date": 1504999851, "question_id": 46136009, "link": "https://stackoverflow.com/questions/46136009/forall-notation-what-does-the-period-dot-mean", "title": "forall notation: what does the period / dot mean?", "body": "<p>What does the period / dot mean?</p>\n\n<pre><code>forall a. Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>Is it merely a separator?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 175, "user_id": 1044712, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c01a279faed71c8bec6492a519373d95?s=128&d=identicon&r=PG", "display_name": "peteofce", "link": "https://stackoverflow.com/users/1044712/peteofce"}, "edited": false, "score": 0, "creation_date": 1505000426, "post_id": 46135950, "comment_id": 79234410, "body": "Argghh! found my problem: function atomReadT = return . atomically . readTVar.  Removed &quot;return&quot;.  Thanks for the reply!"}], "tags": [], "owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "is_accepted": false, "score": 1, "last_activity_date": 1504999031, "creation_date": 1504999031, "answer_id": 46135950, "question_id": 46135820, "link": "https://stackoverflow.com/questions/46135820/stuck-with-a-type-issue-using-servant/46135950#46135950", "title": "Stuck with a type issue using Servant", "body": "<p>Sounds like you need to bind <code>b</code> in the <code>do</code> block.</p>\n\n<pre><code>server :: Req -&gt; TVar Int -&gt;  Server API\nserver r s = tran\n    where\n        tran ::  Maybe String -&gt; BBuf -&gt; ExceptT ServantErr IO Rq\n        tran (Just m) b = do\n          h &lt;- liftIO $ atomReadT s\n          b1 &lt;- liftIO b\n          let eb = EBuf b1 h\n          let nb = Rq eb m []\n          liftIO $ atomically (putTMVar (fst r) nb)\n          liftIO $ atomRead (snd r)\n</code></pre>\n"}], "owner": {"reputation": 175, "user_id": 1044712, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c01a279faed71c8bec6492a519373d95?s=128&d=identicon&r=PG", "display_name": "peteofce", "link": "https://stackoverflow.com/users/1044712/peteofce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 28, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505197772, "creation_date": 1504997773, "last_edit_date": 1505197772, "question_id": 46135820, "link": "https://stackoverflow.com/questions/46135820/stuck-with-a-type-issue-using-servant", "title": "Stuck with a type issue using Servant", "body": "<p>Here's the problem</p>\n\n<pre><code>server :: Req -&gt; TVar Int -&gt;  Server API\nserver r s = tran\n    where\n        tran ::  Maybe String -&gt; BBuf -&gt; ExceptT ServantErr IO Rq\n        tran (Just m) b = do\n          h &lt;- liftIO $ atomReadT s\n          let eb = EBuf b h\n          let nb = Rq eb m []\n          liftIO $ atomically (putTMVar (fst r) nb)\n          liftIO $ atomRead (snd r)\n</code></pre>\n\n<p>I receive the following error.</p>\n\n<pre><code>/apps/workspace/hade/src/Server/Service.hs:36:23: error:\n    \u2022 Couldn't match expected type \u2018Int\u2019 with actual type \u2018IO Int\u2019\n    \u2022 In the second argument of \u2018EBuf\u2019, namely \u2018h\u2019\n      In the expression: EBuf b h\n      In an equation for \u2018eb\u2019: eb = EBuf b h\n</code></pre>\n\n<p>Any assistance would be appreciated\n- Carl</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1504997000, "post_id": 46135649, "comment_id": 79233800, "body": "also good rule of thumb is don&#39;t pass arguments that never change in your recursion. Instead use a <code>where</code> clause and reference the constant value bound higher up: <code>sumInts lo = go where go hi = if hi &lt;= lo then hi else hi + go (hi-1)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1505013023, "post_id": 46135769, "comment_id": 79236191, "body": "I think this formula is incorrect. <code>sumInts 5 6</code> should be <code>11</code>, but this function returns <code>0</code>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1505023515, "post_id": 46135769, "comment_id": 79237539, "body": "In this formula <code>b</code> is supposed to be the smaller number, not the larger one."}, {"owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1505035215, "post_id": 46135769, "comment_id": 79240058, "body": "@amalloy Yes, that&#39;s true. I edited it to reflect the original function."}], "tags": [], "owner": {"reputation": 6025, "user_id": 3053082, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cf7725958a43181e6b2b4c0f5f02b91b?s=128&d=identicon&r=PG&f=1", "display_name": "Kapol", "link": "https://stackoverflow.com/users/3053082/kapol"}, "is_accepted": false, "score": 0, "last_activity_date": 1505035172, "last_edit_date": 1505035172, "creation_date": 1504997160, "answer_id": 46135769, "question_id": 46135649, "link": "https://stackoverflow.com/questions/46135649/how-to-set-initial-conditions-for-recursive-function-with-two-parameters-haskel/46135769#46135769", "title": "How to Set Initial Conditions for Recursive Function with Two Parameters (Haskell)", "body": "<p>I know that the question is about recursion, but the easiest way to use only one function is to not use recursion at all, but a simple mathematical formula.</p>\n\n<pre><code>sumInts :: Int -&gt; Int -&gt; Int\nsumInts a b = ((a + b) / 2) * (b - a + 1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1504997289, "creation_date": 1504997289, "answer_id": 46135780, "question_id": 46135649, "link": "https://stackoverflow.com/questions/46135649/how-to-set-initial-conditions-for-recursive-function-with-two-parameters-haskel/46135780#46135780", "title": "How to Set Initial Conditions for Recursive Function with Two Parameters (Haskell)", "body": "<p>Pattern matching in Haskell is <em>linear</em>. It means that no variable can be written twice in the head of the function (the pattern matching part). So your clause:</p>\n\n<pre><code>sumInts a a = a\n</code></pre>\n\n<p>Is not allowed. In that case, you can <strong>use guards</strong>:</p>\n\n<pre><code>sumInts :: (Num a, Ord a) =&gt; a -&gt; a -&gt; a\nsumInts a b <b>| a &lt;= b</b> = a + sumInts (a+1) b\n            <b>| otherwise</b> = 0</code></pre>\n\n<p>The guards are conditions after the pipe character (<code>|</code>). In case the conditions are satisfied, the function evaluates to the part on the right side of the equal sign (<code>=</code>). The <code>otherwise</code> is just an alias for <code>True</code>.</p>\n"}], "owner": {"reputation": 165, "user_id": 6405419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CIOx7.gif?s=128&g=1", "display_name": "Zach466920", "link": "https://stackoverflow.com/users/6405419/zach466920"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "closed_date": 1505060212, "accepted_answer_id": 46135780, "answer_count": 2, "score": 4, "last_activity_date": 1505035172, "creation_date": 1504995883, "question_id": 46135649, "link": "https://stackoverflow.com/questions/46135649/how-to-set-initial-conditions-for-recursive-function-with-two-parameters-haskel", "closed_reason": "Duplicate", "title": "How to Set Initial Conditions for Recursive Function with Two Parameters (Haskell)", "body": "<p>I'm working through <em>Learn You a Haskell For Great Good</em> and was trying to work through some example problems for the chapter on recursion.</p>\n\n<p>I'm trying to write a function that takes a lower bound \"a\" and an upper bound \"b\" and returns the sum of all the numbers in between, inclusive. </p>\n\n<p>I originally tried (what I thought was) a straight forward approach</p>\n\n<pre><code>sumInts :: Int -&gt; Int -&gt; Int\nsumInts a a = a \nsumInts a b = (sumInts (a) (b-1)) + b\n</code></pre>\n\n<p>When I tried to compile, I got an error statement </p>\n\n<blockquote>\n  <p>\u2022 Conflicting definitions for \u2018a\u2019</p>\n</blockquote>\n\n<p>I ultimately just wanted the thing to work, so I split up what was supposed to be one function into two.</p>\n\n<pre><code>sumInts' :: Int -&gt; Int\nsumInts' 0 = 0\nsumInts' a = sumInts' (a-1) + a\n\n\nsumInts :: Int -&gt; Int -&gt; Int\nsumInts 0 b = sumInts' b \nsumInts a b = (sumInts (a-1) (b)) - (a-1)\n</code></pre>\n\n<p>I tried searching for what you'd think would be a pretty simple problem. Alas, it seems too niche to pull results.</p>\n\n<p>How do I combine the two function I currently have into one function? Additionally, why didn't my original function work? Any tips on how to avoid this in the future? Thanks!</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 3, "creation_date": 1505030379, "post_id": 46135098, "comment_id": 79238914, "body": "It should be sufficient to wipe out the .stack directory in your home directory."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "edited": false, "score": 1, "creation_date": 1505067930, "post_id": 46135098, "comment_id": 79249995, "body": "I would back up my ~/.stack/config.yaml and ~/.stack/global-project/stack.yaml as well :)"}, {"owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "edited": false, "score": 0, "creation_date": 1505245673, "post_id": 46135098, "comment_id": 79331333, "body": "This may also be an issue with your libncurses installation. Reinstalling it / installing a different version may be helpful."}], "owner": {"reputation": 1204, "user_id": 1599054, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/d4a721253898db1ee42eb770cf3d752a?s=128&d=identicon&r=PG", "display_name": "GlinesMome", "link": "https://stackoverflow.com/users/1599054/glinesmome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 270, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504991077, "creation_date": 1504991077, "question_id": 46135098, "link": "https://stackoverflow.com/questions/46135098/stack-rebuild-all-all-packages", "title": "stack rebuild all all packages", "body": "<h1>Question</h1>\n\n<p>Is there a way to force <code>stack</code> to rebuild all local precompiled packages?</p>\n\n<h1>Context</h1>\n\n<p>I had a working <code>stack</code> installation but I've updated my ArchLinux (including kernel update) and I get this now:</p>\n\n<pre><code>stack ghci\nMain.hs: &lt;command line&gt;: can't load .so/.DLL for: /usr/lib/gcc/x86_64-pc-linux-gnu/7.2.0/../../../../lib/libncurses.so (-lncursesw: cannot open shared object file: No such file or directory)\n</code></pre>\n\n<p>Since the given exists my guess is that the compiled version isn't linked correctly, that's why I try to rebuild everything.</p>\n"}, {"tags": ["haskell", "abstract-syntax-tree", "type-inference", "hindley-milner", "recursion-schemes"], "answers": [{"comments": [{"owner": {"reputation": 929, "user_id": 427785, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/651918248d103d4459c5ecafe6e40864?s=128&d=identicon&r=PG", "display_name": "dbeacham", "link": "https://stackoverflow.com/users/427785/dbeacham"}, "edited": false, "score": 0, "creation_date": 1522240047, "post_id": 46143294, "comment_id": 86075330, "body": "Are there any good references/blog posts that refer to this - especially the trick of returning a function from a catamorphism. I&#39;ve seen it mentioned in a couple of posts on this subject but nothing concrete."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 929, "user_id": 427785, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/651918248d103d4459c5ecafe6e40864?s=128&d=identicon&r=PG", "display_name": "dbeacham", "link": "https://stackoverflow.com/users/427785/dbeacham"}, "edited": false, "score": 1, "creation_date": 1522319311, "post_id": 46143294, "comment_id": 86114560, "body": "@dbeacham I believe it corresponds to the way of handling inherited attributes in this paper <a href=\"http://www.staff.science.uu.nl/~jeuri101/homepage/Publications/ags.pdf\" rel=\"nofollow noreferrer\">staff.science.uu.nl/~jeuri101/homepage/Publications/ags.pdf</a> and this othe one might also touch upon it <a href=\"http://www.cs.ox.ac.uk/people/jeremy.gibbons/publications/accatt.pdf\" rel=\"nofollow noreferrer\">cs.ox.ac.uk/people/jeremy.gibbons/publications/accatt.pdf</a> In the simplest case of lists, the trick corresponds to deriving <code>foldl</code> from <code>foldr</code>: <a href=\"https://wiki.haskell.org/Foldl_as_foldr\" rel=\"nofollow noreferrer\">wiki.haskell.org/Foldl_as_foldr</a>"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 4, "last_activity_date": 1505159566, "last_edit_date": 1505159566, "creation_date": 1505062933, "answer_id": 46143294, "question_id": 46134949, "link": "https://stackoverflow.com/questions/46134949/haskell-labeling-an-ast-with-type-information-using-algorithm-w/46143294#46143294", "title": "Haskell: Labeling an AST with type information using Algorithm W", "body": "<p>This answer does modify the function <code>w</code>, but it still aims to keep the \"workhorse\" functions disentangled from the recursion-schemes machinery.</p>\n\n<p>Let's keep the <code>Term</code> type as is, and assume we have a type <code>E</code> for the environment that is calculated downwards, and a type <code>R</code> for the final annotation that is calculated upwards from the leaves.</p>\n\n<p>Let's also assume that we have these two functions:</p>\n\n<pre><code>calcEnv :: E -&gt; Term x -&gt; E -- calculates the environment which will be passed downwards\n\ncalcResult :: E -&gt; Term R -&gt; IO R -- effectfully calculates the result flowing upwards\n</code></pre>\n\n<p>I'm using <code>IO</code> as the monad for simplicity. </p>\n\n<p>(Notice that I'm assuming that \"calculating the environment\" can't have effects. I this isn't the case then this solution won't do.)</p>\n\n<p>We work in two phases. First we construct a tree in which the nodes have been annotated with their environments. We use an <a href=\"https://en.wikipedia.org/wiki/Anamorphism\" rel=\"nofollow noreferrer\">anamorphism</a>, instead of the \"trick\" of returning a function from a catamorphism.</p>\n\n<pre><code>import qualified Control.Comonad.Trans.Cofree as COFREEF\n\nannotate :: E -&gt; Fix Term -&gt; Cofree Term E\nannotate = curry (ana coalg)\n    where\n    coalg :: (E, Fix Term) -&gt; COFREEF.CofreeF Term E (E, Fix Term)\n    coalg (environment, Fix term) =\n        let environment' = calcEnv environment term\n        in  environment COFREEF.:&lt; fmap ((,) environment') term\n</code></pre>\n\n<p>(Keep in mind that <code>type instance Base (Cofree f a) = CofreeF f a</code>. That's where the <code>COFREEF.:&lt;</code> <a href=\"http://hackage.haskell.org/package/free-4.12.4/docs/Control-Comonad-Trans-Cofree.html#t:CofreeF\" rel=\"nofollow noreferrer\">comes from</a>. It's basically a pair of a pure value and another value wrapped in the functor.)</p>\n\n<p>And in the next phase we effectfully consume the annotated tree from the leaves to produce the final result \u2014a tree with <code>R</code> annotations:</p>\n\n<pre><code>calculate :: Cofree Term E -&gt; IO (Cofree Term R)\ncalculate = cata alg\n    where\n    alg :: COFREEF.CofreeF Term E (IO (Cofree Term R)) -&gt; IO (Cofree Term R)\n    alg (environment COFREEF.:&lt; termio) = do\n        term :: Term (Cofree Term R) &lt;- sequenceA termio\n        result :: R &lt;- calcResult environment (fmap extract term)\n        return $ result :&lt; term\n</code></pre>\n\n<p>I did in two phases because I was having trouble combining the \"returning a function\" trick with returning an annotated tree.</p>\n\n<hr>\n\n<p>An anamorphism followed by a catamorphism is known as <a href=\"https://en.wikipedia.org/wiki/Hylomorphism_(computer_science)\" rel=\"nofollow noreferrer\">hylomorphism</a>. We could define the composed function using <a href=\"http://hackage.haskell.org/package/recursion-schemes-5.0.2/docs/Data-Functor-Foldable.html#v:hylo\" rel=\"nofollow noreferrer\"><code>hylo</code></a>, like this:</p>\n\n<pre><code>together :: E -&gt; Fix Term -&gt; IO (Cofree Term R)\ntogether = curry (hylo alg coalg)\n    where\n    coalg (environment, Fix term) = ...\n    alg (environment COFREEF.:&lt; termio) = ...\n</code></pre>\n\n<hr>\n\n<p>You can put together <code>calcEnv</code> and <code>calcResult</code> in the form of the original algebra like this:</p>\n\n<pre><code>w :: Term (E -&gt; IO R) -&gt; E -&gt; IO R\nw term environment = do\n    let downwards = calcEnv environment term\n    tr :: Term R &lt;- sequenceA $ fmap ($ downwards) term\n    calcResult environment tr\n</code></pre>\n"}], "owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 731, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1505159566, "creation_date": 1504989794, "question_id": 46134949, "link": "https://stackoverflow.com/questions/46134949/haskell-labeling-an-ast-with-type-information-using-algorithm-w", "title": "Haskell: Labeling an AST with type information using Algorithm W", "body": "<p>We have an AST definition:</p>\n\n<pre><code>data Term a \n  = Lam String a\n  | App a a\n  | Var String\n  deriving(Read,Show,Eq,Functor,Foldable,Traversable)\n</code></pre>\n\n<p>And an F-Algebra for the type inference:</p>\n\n<pre><code>type Wrapped m a = Enviroment -&gt; m a\ntype Result m = Wrapped (Type,Substitution)\nw ::\n  (MonadState Int, MonadError TypeError) \n  =&gt; Term (Result m)\n  -&gt; Result m\nw term env = ...\n</code></pre>\n\n<p>We can get the result of running the inference using <code>cata</code>:</p>\n\n<pre><code>infer :: \n  (MonadState Int, MonadError TypeError) \n  =&gt; Fix Term \n  -&gt; Result m\ninfer ast = cata hm ast\n</code></pre>\n\n<p>But now I want the result to be the original AST annotated with type information for each expression, So now <code>infer' :: Fix Term -&gt; Wrapped (Labeled Term Type)</code>.</p>\n\n<ol>\n<li>What data structure should I use to annotate the tree (<code>Cofree</code>,<code>Product</code>,<code>Fix</code> with a custom <code>Label</code>)?</li>\n<li>How can I implement this using recursion schemes, without modifying the original <code>w</code> function?</li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1504988680, "post_id": 46134769, "comment_id": 79231784, "body": "<code>tableaux32 = (fmap `fmap` fmap `fmap` fmap) intToInt32 tableaux</code>"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1504988821, "post_id": 46134769, "comment_id": 79231816, "body": "@melpomene I think using <code>fmap</code> where you could use its specializations, <code>map</code> and <code>.</code>, is unnecessarily confusing. I also don\u2019t think that using <code>.</code> is any clearer than just writing <code>map (map (map intToInt32)) tableaux</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1504989097, "post_id": 46134769, "comment_id": 79231873, "body": "@AlexisKing Yeah, but my way is funnier."}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1504989187, "post_id": 46134769, "comment_id": 79231900, "body": "@melpomene I can\u2019t argue with that. :)"}], "answers": [{"comments": [{"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 0, "creation_date": 1504988570, "post_id": 46134800, "comment_id": 79231739, "body": "This should be a comment, it&#39;s just a tip for the OP."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "reply_to_user": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 0, "creation_date": 1504988650, "post_id": 46134800, "comment_id": 79231770, "body": "Ah yes, indeed. Thanks. But then nesting the <code>map</code>&#39;s is a nice way ? Ok. @syntagma I understand the &quot;tip&quot;, it could be an answer then."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1504989509, "post_id": 46134800, "comment_id": 79231987, "body": "I finally prefer <code>map (map (map fromIntegral)) tableaux :: [[[Int32]]]</code>, no need to introduce a function like this."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 1, "creation_date": 1504990115, "post_id": 46134800, "comment_id": 79232141, "body": "I disagree, @syntagma. It&#39;s not a tip, it&#39;s the answer, but phrased in a way that means you have to read it and think for a second instead of copying and pasting."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 6, "last_activity_date": 1504988513, "creation_date": 1504988513, "answer_id": 46134800, "question_id": 46134769, "link": "https://stackoverflow.com/questions/46134769/changing-the-type-of-the-elements-in-a-nested-list/46134800#46134800", "title": "Changing the type of the elements in a nested list", "body": "<p>Consider that <code>(\\x -&gt; map f x)</code> is simply <code>map f</code>. How many times do you see this pattern in your function? I see it twice.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1505060357, "post_id": 46139074, "comment_id": 79247409, "body": "No need to reach for <code>lens</code> to achieve the feature you list in your last sentence. <code>fmap (fmap (fmap intToInt32))</code> does that just as well."}, {"owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1505148594, "post_id": 46139074, "comment_id": 79283341, "body": "Yeah right, maybe the example was not chosen well ;)  There are a lot of cases that you cannot solve with <code>fmap</code>."}], "tags": [], "owner": {"reputation": 2719, "user_id": 566890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/T0Csa.png?s=128&g=1", "display_name": "Markus1189", "link": "https://stackoverflow.com/users/566890/markus1189"}, "is_accepted": false, "score": 0, "last_activity_date": 1505148804, "last_edit_date": 1505148804, "creation_date": 1505034881, "answer_id": 46139074, "question_id": 46134769, "link": "https://stackoverflow.com/questions/46134769/changing-the-type-of-the-elements-in-a-nested-list/46139074#46139074", "title": "Changing the type of the elements in a nested list", "body": "<p>While in this example you can get away with a simple chain of <code>map</code>s, whenever you have deeply nested structures you should reach for lenses.  There are multiple packages for that in Haskell, one of the most powerful is Edward Kmett's <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens</a>.</p>\n\n<p>With lens you can use for example <code>traverse</code> to focus each element of a <code>Traversable</code> container:</p>\n\n<pre><code>convert :: (a -&gt; b) -&gt; [[[a]]] -&gt; [[[b]]]\nconvert = over (traverse . traverse . traverse)\n</code></pre>\n\n<p>The power of <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lens</a> is that you can also have a <code>[Vector [Maybe a]]</code> instead and the same function <code>convert</code> will still work after generalizing the type signature.</p>\n\n<p>As Daniel Wagner noted in the comments you can still do the above example by using only <code>fmap</code>.  The intention was to highlight that lens generalizes this pattern of modifying nested structures very nicely and should be preferred once those modifications get more complicated.</p>\n"}], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 46134800, "answer_count": 2, "score": 0, "last_activity_date": 1505148804, "creation_date": 1504988279, "question_id": 46134769, "link": "https://stackoverflow.com/questions/46134769/changing-the-type-of-the-elements-in-a-nested-list", "title": "Changing the type of the elements in a nested list", "body": "<p>I have the object <code>tableaux :: [[[Int]]]</code> and I want to change it to <code>[[[Int32]]]</code>. I do:</p>\n\n<pre><code>int32ToInt :: Int32 -&gt; Int\nint32ToInt = fromIntegral\n\ntableaux32 = map (\\y -&gt; map (\\x -&gt; map intToInt32 x) y) tableaux\n</code></pre>\n\n<p>Is there a better way?</p>\n"}, {"tags": ["haskell", "ghci", "haskell-stack"], "comments": [{"owner": {"reputation": 3075, "user_id": 1164871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d6a54a3752ab47170d790085935988f?s=128&d=identicon&r=PG", "display_name": "mgsloan", "link": "https://stackoverflow.com/users/1164871/mgsloan"}, "edited": false, "score": 1, "creation_date": 1505692943, "post_id": 46134228, "comment_id": 79502404, "body": "This is expected behavior because stack does not currently have any magic to parse this out of ghc-options.  I&#39;ve opened <a href=\"https://github.com/commercialhaskell/stack/issues/3439\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/3439</a> tracking the enhancement."}], "answers": [{"tags": [], "owner": {"reputation": 456, "user_id": 5122135, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FiFoN.jpg?s=128&g=1", "display_name": "Milad", "link": "https://stackoverflow.com/users/5122135/milad"}, "is_accepted": false, "score": 0, "last_activity_date": 1577132453, "creation_date": 1577132453, "answer_id": 59460930, "question_id": 46134228, "link": "https://stackoverflow.com/questions/46134228/haskell-stack-main-module-to-load-is-ambiguous/59460930#59460930", "title": "haskell-stack: main module to load is ambiguous", "body": "<p>I had the same problem, if I translate what I did on mine onto your project, you should be able to do either of these to choose the main module:</p>\n\n<pre><code>stack ghci --main-is ambig:exe:apple\n</code></pre>\n\n<p>or</p>\n\n<pre><code>stack ghci --main-is ambig:exe:banana\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 1513139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff05ceb89b7fea53b109ebd5637ee04?s=128&d=identicon&r=PG", "display_name": "instinctive", "link": "https://stackoverflow.com/users/1513139/instinctive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 342, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1577132453, "creation_date": 1504984341, "last_edit_date": 1504985117, "question_id": 46134228, "link": "https://stackoverflow.com/questions/46134228/haskell-stack-main-module-to-load-is-ambiguous", "title": "haskell-stack: main module to load is ambiguous", "body": "<p>I have multiple executables with non-conflicting names. Yet <code>stack ghci</code> complains that the main module is ambiguous:</p>\n\n<pre><code>$ find . -type f -exec grep -Hi \"apple\\|banana\" {} \\; | grep -v work\n./ambig.cabal:executable apple\n./ambig.cabal:  main-is:             Apple.hs\n./ambig.cabal:  ghc-options:         -main-is Apple.apple\n./ambig.cabal:executable banana\n./ambig.cabal:  main-is:             Banana.hs\n./ambig.cabal:  ghc-options:         -main-is Banana.banana\n./src/Apple.hs:module Apple (apple) where\n./src/Apple.hs:apple :: IO ()\n./src/Apple.hs:apple = putStrLn \"I am apple\"\n./src/Banana.hs:module Banana (banana) where\n./src/Banana.hs:banana :: IO ()\n./src/Banana.hs:banana = putStrLn \"I am banana\"\n$ stack ghci\nThe main module to load is ambiguous. Candidates are: [...]\n$ stack --version\nVersion 1.5.1, Git revision 600c1f01435a10d127938709556c1682ecfd694e\n</code></pre>\n\n<p>How can I make <code>stack ghci</code> load all these non-conflicting modules?</p>\n\n<p>The complete cabal file:</p>\n\n<pre><code>$ cat ambig.cabal\nname:                ambig\nversion:             0.1.0.0\nbuild-type:          Simple\ncabal-version:       &gt;=1.10\n\nexecutable apple\n  hs-source-dirs:      src\n  main-is:             Apple.hs\n  ghc-options:         -main-is Apple.apple\n  default-language:    Haskell2010\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n\nexecutable banana\n  hs-source-dirs:      src\n  main-is:             Banana.hs\n  ghc-options:         -main-is Banana.banana\n  default-language:    Haskell2010\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 6, "last_activity_date": 1615997539, "last_edit_date": 1615997539, "creation_date": 1504984404, "answer_id": 46134239, "question_id": 46134028, "link": "https://stackoverflow.com/questions/46134028/looping-over-lenses-and-using-each-with-view-and-set/46134239#46134239", "title": "Looping over lenses, and using each with view and set", "body": "<p><code>Lens'</code> is under the hood universally quantified</p>\n<pre><code>type Lens' s a = \u2200 f . Functor f =&gt; (a -&gt; f a) -&gt; s -&gt; f s\n</code></pre>\n<p>So the type of <code>[v,w,x]</code> would have to be</p>\n<pre><code>[\u2200 f . Functor f =&gt; (AType -&gt; f AType) -&gt; Thing -&gt; f Thing]\n</code></pre>\n<p>\u2013 with a quantor <em>inside the list</em>. Such types are called <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ImpredicativePolymorphism\" rel=\"nofollow noreferrer\">impredicative types</a>, and Haskell doesn't support them. (A GHC extension with that name has been around for a while, but it doesn't work.) [<strong>Edit</strong>: work on impredicatives <a href=\"https://dl.acm.org/doi/10.1145/3408971\" rel=\"nofollow noreferrer\">is ongoing</a> as of 2021.]</p>\n<p>There's a relatively easy way that always works to get around this: hide the quantor in a <code>newtype</code>. In the lens library, this is <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Reified.html#t:ReifiedLens\" rel=\"nofollow noreferrer\"><code>ReifiedLens</code></a>. With it you can write</p>\n<pre><code>transform a b =\n    let transformVorWorX :: ReifiedLens' Thing AType -&gt; AType\n        transformVorWorX (Lens lens) = \n            let vwx  = view lens a\n                vwx' = view lens b\n            in  f vwx vwx'\n    in  foldl (\\a' lens -&gt; set (runLens lens) (transformVorWorX lens) a') a\n            [Lens v, Lens w, Lens x]\n</code></pre>\n<p>This code has exactly the runtime behaviour of the one you envisioned, but it's clearly pretty ugly.</p>\n<p>The alternative solution you've discovered yourself does <em>effectively</em> the same thing too but is rather nicer. To see what's actually going on there, I'll put the <code>cloneLens</code> within <code>transformVorWorX</code>:</p>\n<pre><code>transform a b =\n    let transformVorWorX :: ALens' Thing AType -&gt; AType\n        transformVorWorX lens = \n            let vwx  = view (cloneLens lens) a\n                vwx' = view (cloneLens lens) b\n            in  f vwx vwx'\n    in  foldl (\\a' lens -&gt; set (cloneLens lens) (transformVorWorX lens) a') a [v,w,x]\n</code></pre>\n<p>The reason this works is that, like <code>ReifiedLens</code> \u2013 but unlike <code>Lens</code> \u2013 <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Lens.html#t:ALens\" rel=\"nofollow noreferrer\"><code>ALens'</code></a> has no quantor. It is just a concrete instantiation of the <code>Functor f</code>, thus it doesn't require impredicativity but you can directly use <code>v</code>, <code>w</code> and <code>x</code> in a <code>[ALens' Thing AType]</code> list. The functor instance is cleverly chosen to <em>not lose any of the generality</em>, hence <code>cloneLens</code> is able to give you back a full, universally-quantised lens.</p>\n<p>Rather than cloning it, you can also use the <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Lens.html#v:-94--35-\" rel=\"nofollow noreferrer\"><code>^#</code></a> operator, which directly views an <code>ALens</code>, and <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Lens.html#v:storing\" rel=\"nofollow noreferrer\"><code>storing</code></a> instead of <code>set</code>:</p>\n<pre><code>transform a b =\n    let transformVorWorX :: ALens' Thing AType -&gt; AType\n        transformVorWorX lens = \n            let vwx  = a^#lens\n                vwx' = b^#lens\n            in  f vwx vwx'\n    in  foldl (\\a' lens -&gt; storing lens (transformVorWorX lens) a') a [v,w,x]\n</code></pre>\n<p>If we condense that to a less verbose form, it looks quite good IMO:</p>\n<pre><code>transform a b = foldl updater a [v,w,x]\n where updater a' lens = a' &amp; lens #~ f (a^#lens) (b^#lens)\n</code></pre>\n<hr>\n<p>Let me also suggest an entirely different solution: you define <strong>a single optic that accesses <em>all</em> the values of interest</strong>, namely</p>\n<pre><code>vwx :: Traversal' Thing AType\nvwx f (Thing \u0432 \u0448 \u043a otherVals)\n    = (\\\u0432' \u0448' \u043a' -&gt; Thing \u0432' \u0448' \u043a' otherVals)\n      &lt;$&gt; f \u0432 &lt;*&gt; f \u0448 &lt;*&gt; f \u043a\n</code></pre>\n<p>Instead than defining this yourself, you can also let the Template Haskell helper do it for you:</p>\n<pre><code>makeLensesFor [(&quot;_v&quot;, &quot;vwx&quot;), (&quot;_w&quot;, &quot;vwx&quot;), (&quot;_x&quot;, &quot;vwx&quot;)] ''Thing\n</code></pre>\n<p>Now, a traversal can be used as a simple fold, and thus <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Fold.html#v:-94-..\" rel=\"nofollow noreferrer\">to get a <em>list</em></a> of all the values. You can then use a standard zip to perform the transformation of the elements:</p>\n<pre><code>transform a b = ...\n where tfmedVals = zipWith f (a^..vwx) (b^..vwx)\n</code></pre>\n<p>To put that list of modified values back in a container, the library has also a function: <a href=\"http://hackage.haskell.org/package/lens-4.15.4/docs/Control-Lens-Traversal.html#v:partsOf\" rel=\"nofollow noreferrer\"><code>partsOf</code></a>. And with that, your entire transformation boils down to</p>\n<pre><code>transform a b = a &amp; partsOf vwx .~ zipWith f (a^..vwx) (b^..vwx)\n</code></pre>\n"}], "owner": {"reputation": 555, "user_id": 994031, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/36b220092e7681ad2974c56dd17d5ced?s=128&d=identicon&r=PG", "display_name": "jfla", "link": "https://stackoverflow.com/users/994031/jfla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1615997539, "creation_date": 1504982879, "question_id": 46134028, "link": "https://stackoverflow.com/questions/46134028/looping-over-lenses-and-using-each-with-view-and-set", "title": "Looping over lenses, and using each with view and set", "body": "<p>This is a version of some code I have been working on, with the specifics removed. Hopefully it's clear what I'm trying to do, but if not I can clarify. I'm quite new to using lenses, and the complicated types involved often make them seem more trouble than they're worth.</p>\n\n<pre><code>-- some data type\ntype AType = ...\n\ndata Thing = Th { _v, _w, _x :: AType, _otherStuff :: ... }\n\nmakeLenses ''Thing\n\n-- some operation that can be performed on corresponding x or w or v values in two Things.\nf :: AType -&gt; AType -&gt; AType\nf = ...\n\n-- apply f to the corresponding v, and w, and x values in a and b; then store each result in the respective field of a, leaving other fields untouched.\ntransform :: Thing -&gt; Thing -&gt; Thing\ntransform a b =\n    let transformVorWorX :: Lens' Thing AType -&gt; AType\n        transformVorWorX lens = \n            let vwx  = view lens a\n                vwx' = view lens b\n            in  f vwx vwx'\n\n    in  foldl (\\a' lens -&gt; set lens (transformVorWorX lens) a') a [v,w,x]\n</code></pre>\n\n<p>When I compile, ghc spits out</p>\n\n<pre><code>Could not deduce (f ~ Identity)\nfrom the context (Functor f)\n  bound by a type expected by the context:\n             Functor f =&gt; (AType -&gt; f AType) -&gt; Thing -&gt; f Thing\n  at ...\n  \u2018f\u2019 is a rigid type variable bound by\n      a type expected by the context:\n        Functor f =&gt; (AType -&gt; f AType) -&gt; Thing -&gt; f Thing\n      at ...\nExpected type: (AType -&gt; f AType) -&gt; Thing -&gt; f Thing\n  Actual type: ASetter Thing Thing AType AType\nIn the first argument of \u2018transformVorWorX\u2019, namely \u2018lens\u2019\nIn the second argument of \u2018set\u2019, namely \u2018(transformVorWorX lens)\u2019\n</code></pre>\n\n<p>Why doesn't this code work? I found that replacing <code>lens</code> with <code>cloneLens lens</code> lets it compile, but I'm not sure why, and this feels very ugly - is there a more elegant way to do what I want, that is perhaps more general?</p>\n\n<p>Many thanks</p>\n"}, {"tags": ["haskell", "constructor"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1504979298, "post_id": 46133413, "comment_id": 79229265, "body": "You&#39;ve got it the wrong way round: <code>Point</code> is the type constructor and <code>Pt</code> is the data constructor."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1504979918, "post_id": 46133548, "comment_id": 79229434, "body": "Correct, however something like <code>Point</code> is indeed commonly called <i>type constructor</i>. You may have a point (pun not intended) in that this terminology doesn&#39;t make a lot of sense, but it is standard."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1505029739, "post_id": 46133548, "comment_id": 79238775, "body": "Note that &quot;higher order&quot; is used for functions taking functions, e.g. <code>(T-&gt;T)-&gt;...</code>. Similarly, &quot;higher kind&quot; refers to types which have a &quot;constructor&quot; argument e.g. <code>data T f a = K (f a)</code> where <code>T :: (*-&gt;*)-&gt;*</code>. I would say that <code>Point</code>, on its own, is not higher kinded."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1505049135, "post_id": 46133548, "comment_id": 79243759, "body": "Agreed. <code>Point</code> simply has a <i>different</i> kind (<code>* -&gt; *</code>) than  <code>Color</code> (<code>*</code>)."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 1, "last_activity_date": 1504979730, "creation_date": 1504979730, "answer_id": 46133548, "question_id": 46133413, "link": "https://stackoverflow.com/questions/46133413/the-meaning-of-constructor-in-data-constructor-and-type-constructor-in-haskell/46133548#46133548", "title": "The meaning of constructor in data constructor and Type constructor in Haskell", "body": "<p>I think you're getting a bit bogged down in terminology. I'd probably say \"<code>Point</code> is a higher-kinded type\" instead. That just means that it forms a new type given another type. Usually we just refer to <code>Pt</code> as a constructor.\nHere's an example:</p>\n\n<pre><code>data Point a = Pt a a\n\nsamplePoint :: Point Int\nsamplePoint = Pt 1 2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1504981292, "last_edit_date": 1504981292, "creation_date": 1504979734, "answer_id": 46133549, "question_id": 46133413, "link": "https://stackoverflow.com/questions/46133413/the-meaning-of-constructor-in-data-constructor-and-type-constructor-in-haskell/46133549#46133549", "title": "The meaning of constructor in data constructor and Type constructor in Haskell", "body": "<p>A constructor can indeed be used to, well, <em>construct a value</em> (or type, respectively), like a C++ class constructor can:</p>\n\n<pre><code>Prelude&gt; data Point a = Pt a a\nPrelude&gt; :type Pt\nPt :: a -&gt; a -&gt; Point a\nPrelude&gt; :kind Point\nPoint :: * -&gt; *\n</code></pre>\n\n<p>This corresponds, roughly, to</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>template &lt;typename A&gt;\nstruct Point {\n  A x, y;\n  Point(A x, A y): x(x), y(y) {}\n};\n</code></pre>\n\n<p>...or, to get the same name,</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>template &lt;typename A&gt;\nPoint Pt(A x, A y) { return Point(x,y); }\n</code></pre>\n\n<p>But that's not all, a value constructor can also be used to <em>deconstruct</em> a value:</p>\n\n<pre><code>centerDist :: Floating a =&gt; Point a -&gt; a\ncenterDist (Pt x y) = sqrt $ x^2 + y^2\n</code></pre>\n\n<p>There's nothing really analogous in C++ because that doesn't have pattern matching.</p>\n"}], "owner": {"reputation": 407, "user_id": 7388196, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/ffb6b2b72b09356a8bfda10784b3d7a3?s=128&d=identicon&r=PG&f=1", "display_name": "Agnivesh Singh", "link": "https://stackoverflow.com/users/7388196/agnivesh-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1504981292, "creation_date": 1504978855, "last_edit_date": 1504979246, "question_id": 46133413, "link": "https://stackoverflow.com/questions/46133413/the-meaning-of-constructor-in-data-constructor-and-type-constructor-in-haskell", "title": "The meaning of constructor in data constructor and Type constructor in Haskell", "body": "<p>I am going through Hudak's \"Gentle introduction to Haskell\". As stated in my earlier questions, I have a little experience with C and C++. So when I came across the term \"Constructors\" in the introduction to type constructors and data constructors I can't help but wonder if any similarities are there with C++ constructors or is it completely analogous with the later.</p>\n\n<p>So, the first example that Hudak provides is the following:</p>\n\n<pre><code>data Color  = Red|Green|Blue \n</code></pre>\n\n<p>So from the first example I got to know that the RHS is the data constructor. However, here I wasn't clear about type constructors. </p>\n\n<p>In the next example:</p>\n\n<pre><code>data Point a = Pt a a\n</code></pre>\n\n<p>It has been clearly stated that <code>Point</code> is the data constructor and <code>Pt</code> is the type constructor. So what exactly does a constructor do? Is it a function call as it is in case of C++?</p>\n\n<p>How exactly are the work of point and pt differentiated? what is \"pt\" doing?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1505003499, "post_id": 46133299, "comment_id": 79234937, "body": "<code>fmap</code> requires the result to have exactly as many elements as the original list; the monad lets you remove from (via <code>guard</code>) or add to (I assume; blanking on how) the resulting list."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1504979106, "last_edit_date": 1504979106, "creation_date": 1504978733, "answer_id": 46133388, "question_id": 46133299, "link": "https://stackoverflow.com/questions/46133299/use-of-list-monad-vs-fmap/46133388#46133388", "title": "Use of List Monad vs fmap", "body": "<pre><code>factors :: Int -&gt; [Int]\nfactors n = do\n    q &lt;- [1..n]\n    filter ((==n) . (*q)) [1..n]\n</code></pre>\n\n<p>...or, in desugared notation,</p>\n\n<pre><code>factors n = [1..n] &gt;&gt;= ($[1..n]) . filter . fmap (==n) . (*)\n</code></pre>\n\n<p>That's of course hardly efficient, but it works:</p>\n\n<pre><code>*Main&gt; factors 17\n[17,1]\n*Main&gt; factors 24\n[24,12,8,6,4,3,2,1]\n*Main&gt; factors 34\n[34,17,2,1]\n</code></pre>\n\n<p>For operations that's aren't so simple as <code>*</code>, so you couldn't avoid a brute-force approach like that, this might actually be a good solution.</p>\n"}, {"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 12, "last_activity_date": 1504979306, "creation_date": 1504979306, "answer_id": 46133486, "question_id": 46133299, "link": "https://stackoverflow.com/questions/46133299/use-of-list-monad-vs-fmap/46133486#46133486", "title": "Use of List Monad vs fmap", "body": "<p>Using bind with return is equivalent to using fmap. Indeed,</p>\n\n<pre><code>fmap f m = m &gt;&gt;= return . f\n</code></pre>\n\n<p>The uses of bind that can't be reproduced with fmap are exactly those which don't involve this use of return. To provide just one (hopefully) interesting example for lists, let's talk about <a href=\"https://en.wikipedia.org/wiki/L-system\" rel=\"noreferrer\">L-Systems</a>.</p>\n\n<p>L-systems were created by Aristid Lindenmeyer in 1968. As rewriting systems, they start with a simple object and repeatedly replace parts of it using a set of <em>rewriting rules</em> or <em>productions</em>. They can be used to generate fractals and other self-similar images. A context-free, deterministic L-System (or D0L) is defined by the triple of an alphabet, an axiom, and a collection of production rules.</p>\n\n<p>For our alphabet, we'll define a type:</p>\n\n<pre><code>data AB = A | B deriving Show\n</code></pre>\n\n<p>for our axiom, or starting state, we'll use the word <code>[A, B]</code>.</p>\n\n<pre><code>myAxiom = [A, B]\n</code></pre>\n\n<p>For our rules, we need a map from a single letter to a sequence of letters. This is a function of type <code>AB -&gt; [AB]</code>. Let's use this rule:</p>\n\n<pre><code>myRule :: AB -&gt; [AB]\nmyRule A = [A, B]\nmyRule B = [A]\n</code></pre>\n\n<p>To apply the rule, we must rewrite each letter using its production rule. We must do this for all letters in the word at the same time. Conveniently, this is exactly what <code>&gt;&gt;=</code> does for lists:</p>\n\n<pre><code>apply rule axiom = axiom &gt;&gt;= rule\n</code></pre>\n\n<p>Now, let's apply our rule to our axiom, generating the first step in the L-System:</p>\n\n<pre><code>&gt; apply myRule myAxiom\n&gt; [A, B, A]\n</code></pre>\n\n<p>This is Lindenmeyer's <a href=\"https://en.wikipedia.org/wiki/L-system#Example_1:_Algae\" rel=\"noreferrer\">original L-System</a>, used for modeling algae. We can iterate to see it progress:</p>\n\n<pre><code>&gt; mapM_ print . take 7 $ iterate (&gt;&gt;= myRule) myAxiom\n[A,B]\n[A,B,A]\n[A,B,A,A,B]\n[A,B,A,A,B,A,B,A]\n[A,B,A,A,B,A,B,A,A,B,A,A,B]\n[A,B,A,A,B,A,B,A,A,B,A,A,B,A,B,A,A,B,A,B,A]\n[A,B,A,A,B,A,B,A,A,B,A,A,B,A,B,A,A,B,A,B,A,A,B,A,A,B,A,B,A,A,B,A,A,B]\n</code></pre>\n\n<p>In general, bind for lists is <code>concatMap</code>, and you use it precisely when you want to combine mapping with concatenation. Another interpretation is that lists represent non-deterministic choice and that bind functions by choosing each possibility from the list once. For example, rolling dice:</p>\n\n<pre><code>do\n  d1 &lt;- [1..6]\n  d2 &lt;- [1..6]\n  return (d1, d2)\n</code></pre>\n\n<p>This gives all possible ways of rolling 2d6.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1504980661, "post_id": 46133659, "comment_id": 79229620, "body": "That doesn&#39;t seem to have much to do with &quot;zippers&quot; as the term is usually understood."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1505253001, "post_id": 46133659, "comment_id": 79334519, "body": "That <code>zipWith&#39;</code> is not what it claims to be.  Maybe you are looking for the <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Control-Applicative.html#t:ZipList\" rel=\"nofollow noreferrer\"><code>ZipList</code></a> applicative?"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 1, "last_activity_date": 1505267797, "last_edit_date": 1505267797, "creation_date": 1504980449, "answer_id": 46133659, "question_id": 46133299, "link": "https://stackoverflow.com/questions/46133299/use-of-list-monad-vs-fmap/46133659#46133659", "title": "Use of List Monad vs fmap", "body": "<p>For one thing, <code>concatMap</code> is just <code>(=&lt;&lt;)</code>. And <code>concat</code> is just <code>join</code>. I've used both of these frequently in real code.</p>\n\n<p>Another thing you can do is apply a list of functions to one value. </p>\n\n<pre><code>\u03bb:&gt; applyList = sequence\n\u03bb:&gt; applyList [(2*), (3+)] 4\n[8,7]\n</code></pre>\n\n<p>You can also generate a list of all subsets of a list</p>\n\n<pre><code>\u03bb:&gt; import Control.Monad\n\u03bb:&gt; allSubsets = filterM (const [True, False])\n\u03bb:&gt; allSubsets \"ego\"\n[\"ego\",\"eg\",\"eo\",\"e\",\"go\",\"g\",\"o\",\"\"]\n</code></pre>\n\n<p>Or even enumerate all strings that can be formed from an alphabet</p>\n\n<pre><code>\u03bb:&gt; import Data.List\n\u03bb:&gt; import Control.Monad\n\u03bb:&gt; allStrings = sequence &lt;=&lt; (inits . repeat)\n\u03bb:&gt; take 100 $ allStrings ['a'..'z']\n[\"\",\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\",\"p\",\"q\",\"r\",\"s\",\"t\",\"u\",\"v\",\"w\",\"x\",\"y\",\"z\",\"aa\",\"ab\",\"ac\",\"ad\",\"ae\",\"af\",\"ag\",\"ah\",\"ai\",\"aj\",\"ak\",\"al\",\"am\",\"an\",\"ao\",\"ap\",\"aq\",\"ar\",\"as\",\"at\",\"au\",\"av\",\"aw\",\"ax\",\"ay\",\"az\",\"ba\",\"bb\",\"bc\",\"bd\",\"be\",\"bf\",\"bg\",\"bh\",\"bi\",\"bj\",\"bk\",\"bl\",\"bm\",\"bn\",\"bo\",\"bp\",\"bq\",\"br\",\"bs\",\"bt\",\"bu\",\"bv\",\"bw\",\"bx\",\"by\",\"bz\",\"ca\",\"cb\",\"cc\",\"cd\",\"ce\",\"cf\",\"cg\",\"ch\",\"ci\",\"cj\",\"ck\",\"cl\",\"cm\",\"cn\",\"co\",\"cp\",\"cq\",\"cr\",\"cs\",\"ct\",\"cu\"]\n</code></pre>\n\n<p>Perhaps more practically, you can use the applicative instance to combine two lists together</p>\n\n<pre><code>\u03bb:&gt; zipWith' f xs ys = f &lt;$&gt; xs &lt;*&gt; ys\n\u03bb:&gt; zipWith' (+) [1..3] [5..8]\n[6,7,8,9,7,8,9,10,8,9,10,11]\n</code></pre>\n"}], "owner": {"reputation": 2970, "user_id": 1763955, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/3a7a94d762a9d702b88404f840e31d8f?s=128&d=identicon&r=PG&f=1", "display_name": "Carbon", "link": "https://stackoverflow.com/users/1763955/carbon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 46133486, "answer_count": 3, "score": 1, "last_activity_date": 1505267797, "creation_date": 1504978170, "question_id": 46133299, "link": "https://stackoverflow.com/questions/46133299/use-of-list-monad-vs-fmap", "title": "Use of List Monad vs fmap", "body": "<p>Are there any practical uses of the list monad that wouldn't just roll to a fmap? When would you use bind over fmap with the list monad?</p>\n\n<p>Like, for example, you can do <code>[1,2,3] &gt;&gt;= return . ( + 1)</code> but that's the same as <code>(+1) &lt;$&gt; [1,2,3]</code> - when would you use bind without a return on list?</p>\n"}, {"tags": ["haskell", "type-promotion", "singleton-type"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1504984719, "post_id": 46133182, "comment_id": 79230715, "body": "Where are the type level <code>Nat</code>s and <code>Representable</code> you are using from? Is <a href=\"https://hackage.haskell.org/package/representable-functors-3.2.0.2/docs/Data-Functor-Representable.html\" rel=\"nofollow noreferrer\">this the <code>Representable</code></a>?"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1504984778, "post_id": 46133182, "comment_id": 79230730, "body": "Nats are GHC.TypeLits, Representable is Data.Functor.Rep; this one from adjunctions: <a href=\"http://hackage.haskell.org/package/adjunctions-4.3/docs/Data-Functor-Rep.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/adjunctions-4.3/docs/&hellip;</a>"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1504987384, "post_id": 46133182, "comment_id": 79231420, "body": "I don&#39;t believe a <code>Representable</code> instance for <code>Grid</code> exists. Consider this value <code>Grid (Op (const True)) :: Grid 0 a</code> where <code>Op</code> is the non-representable contravariant functor <code>newtype Op r a = Op (a -&gt; r)</code>."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1504987567, "post_id": 46133182, "comment_id": 79231477, "body": "I glossed over some of those details; in reality my underlying functor is <code>data Space a = Space (Stream a) a (Stream a)</code> which is effectively an infinite number line indexed by integers. A Grid is some number of compositions of that, e.g. <code>type Board2D a = Grid (Compose Space Space a)</code>; I&#39;m pretty familiar with Representable in general so I&#39;m not worried about that, it&#39;s mostly the type arithmetic I&#39;m stuck on."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1505012395, "post_id": 46133182, "comment_id": 79236109, "body": "You mentioned you&#39;ve been working on this for a couple of months. Do you have a repo up by any chance? I reckon this might be one of those situations where you want to use Peano numbers instead of GHC&#39;s <code>Nat</code>: you would define your own type family <code>(&gt;=)</code> and then <code>promote</code> would likely follow the induction of that type family."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 0, "last_activity_date": 1505051152, "creation_date": 1505051152, "answer_id": 46141380, "question_id": 46133182, "link": "https://stackoverflow.com/questions/46133182/abstracting-over-dimensionality-of-types/46141380#46141380", "title": "Abstracting over Dimensionality of Types", "body": "<p>Measuring the size of your type expression with a <code>Nat</code>, and then trying to inject the index for a small grid into the index for a big one, is overkill here. All you really need to do is identify how deep into the nested <code>Compose</code> type you want to go before you modify the grid.</p>\n\n<pre><code>data Under g f where\n    Over :: Under f f\n    Under :: Functor h =&gt; Under g f -&gt; Under g (Compose h f)\n</code></pre>\n\n<p><code>Under g f</code> is shaped like a natural number - compare <code>Under (Under Over)</code> with <code>S (S Z)</code> - and it tells you how many layers of <code>Compose</code> you have to unpeel from <code>f</code> in order to find a <code>g</code>.</p>\n\n<pre><code>under :: Under g f -&gt; (g a -&gt; g a) -&gt; f a -&gt; f a\nunder Over f = f\nunder (Under u) f = Compose . fmap (under u f) . getCompose\n</code></pre>\n\n<p>You mentioned in a comment that you're working with grids of infinite zippers. It's easier to use <code>Under</code> with nested <code>Compose</code>s where the <code>Zipper</code> is always the left argument. My <code>Grid2</code> is isomorphic to your <code>Compose Zipper Zipper</code>.</p>\n\n<pre><code>type Zipped = Compose Zipper\ntype Grid1 = Zipped Identity\ntype Grid2 = Zipped Grid1\n\nzipped :: (Zipper (f a) -&gt; Zipper (g b)) -&gt; Zipped f a -&gt; Zipped g b\nzipped f = Compose . f . getCompose\n</code></pre>\n\n<p>Now, given <code>move :: Int -&gt; Zipper a -&gt; Zipper a</code>, you can go <code>Under</code> any number of <code>Compose</code> constructors to <code>move</code> a particular dimension of your grid.</p>\n\n<pre><code>moveUnder :: Under (Zipped g) f -&gt; Int -&gt; f a -&gt; f a\nmoveUnder u n = under u (zipped $ move n)\n</code></pre>\n\n<p>For example, to go <code>up</code> in a 2D grid, you move all the inner zippers left.</p>\n\n<pre><code>-- up :: Grid2 a -&gt; Grid2 a\nup :: Functor f =&gt; Compose f (Zipped g) a -&gt; Compose f (Zipped g) a\nup = moveUnder (Under Over) (-1)\n</code></pre>\n\n<p>Now if you want to move a variety of dimensions of your grid at once you can just call <code>moveUnder</code> multiple times. Here I'm putting a sequence of <code>Move</code>s in a list. Note that I'm existentially quantifying the <code>g</code> in <code>Move</code>'s constructor.</p>\n\n<pre><code>data Move f where\n    Move :: Under (Zipped g) f -&gt; Int -&gt; Move f\n\nmovesZipped :: [Move f] -&gt; f a -&gt; f a\nmovesZipped ms z = foldr (\\(Move u n) -&gt; moveUnder u n) z ms\n\nrightTwoUpOne = movesZipped [Move Over 2, Move (Under Over) (-1)]\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1505051903, "creation_date": 1504977445, "last_edit_date": 1505051903, "question_id": 46133182, "link": "https://stackoverflow.com/questions/46133182/abstracting-over-dimensionality-of-types", "title": "Abstracting over Dimensionality of Types", "body": "<p>I'm building a toy where you can draw circuits on a grid and we can simulate their behaviour. I thought it would be a fun experiment to abstract over the dimensionality of the board and try to make the code work (in a type-safe way) over any board dimensions (2D, 3D, 4D, etc).</p>\n\n<p>I can do most of the work with GADTs and Nats; Assuming I'm using a vector as a 2D base abstraction we can represent any dimensionality by composing it;</p>\n\n<pre><code>type family Count t where\n  Count (Compose _ g) = 1 + (Count g)\n  Count _ = 0\n\ndata Grid (n::Nat) a where\n  Grid :: f a -&gt; Grid (Count f) a\n</code></pre>\n\n<p>This works for the most part (unfortunately the type family requires UndecidableInstances)</p>\n\n<p>With this I can express that operations over grids stay consistent in dimensionality, i.e.</p>\n\n<pre><code>alter :: Grid n a -&gt; Grid n b\n</code></pre>\n\n<p>The tricky bit is that I want to also allow moving around in the grids. \nI've written a Representable instance for Grid which relies on the underlying Representable for <code>Compose</code>, basically you just pair up the representation for each functor being composed. In my case here are some example representations:</p>\n\n<pre><code>Rep (Grid 2) ~ (Sum Int, Sum Int)\nRep (Grid 3) ~ (Sum Int, (Sum Int, Sum Int))\nRep (Grid 3) ~ (Sum Int, (Sum Int, (Sum Int, Sum Int)))\n</code></pre>\n\n<p>And so on.</p>\n\n<p>Also assume that we can index into a Grid by keeping an index alongside it as a store comonad <code>type IGrid n a = (Rep (Grid n), Grid n a)</code></p>\n\n<p>I've written a few functions which move around in a certain dimensionality. Conceptually if a function moves the focus on the y-axis, we can still call that function on any dimensionality with at least 2 dimensions:</p>\n\n<p>e.g.</p>\n\n<pre><code>moveUp :: (n &gt;= 2) =&gt; IGrid n a -&gt; IGrid n a\n</code></pre>\n\n<p>This is doable and easy when n==2, but for higher dimensions it's probably easiest to implement by promoting a lower dimensionality index into some higher one (padding unknown dimensional coords with mempty) so that I can use <code>seek :: Rep (Grid n) -&gt; Grid n a -&gt; Grid n a</code> properly.</p>\n\n<pre><code>promote :: (m &lt;= n) =&gt; Rep (Grid m) -&gt; Rep (Grid n)\n</code></pre>\n\n<p>Then I can just promote a given index to any dim before using it:</p>\n\n<pre><code>moveBy :: Rep (Grid n) -&gt; IGrid n a -&gt; IGrid n a\nmoveBy m (rep, grid) = (rep &lt;&gt; m, grid)\n\nmoveAround :: IGrid n a -&gt; IGrid n a\nmoveAround grid = grid\n                &amp; moveBy (promote (Sum 3, Sum 2)) \n                &amp; moveBy (promote (Sum 1))\n</code></pre>\n\n<p>Most of my attempts have centered around using a typeclass and implementing it over certain Nats and using lots of type assertions. I've\nbeen able to promote an index by one or two finite levels, but can't figure out the general case.</p>\n\n<p>I've been trying to write this <code>promote</code> function for a month or two now, coming back to it from time to time and it seems possible but I just can't figure it out. Any help would be greatly appreciated. Using Nats and the singletons lib is fine if that's the way to do it :)</p>\n\n<p>Thanks for taking the time to read my dilemma!</p>\n"}, {"tags": ["haskell", "lambda-calculus"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1504975963, "post_id": 46132969, "comment_id": 79228231, "body": "check <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#a-yes-no-typeclass\" rel=\"nofollow noreferrer\">this</a> up"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1504975976, "post_id": 46132969, "comment_id": 79228236, "body": "No, because Haskell does not know that <code>cond</code> should be either <code>true</code> or <code>false</code>. For Haskell <code>cond</code> is a generic function."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1504976511, "post_id": 46132969, "comment_id": 79228409, "body": "You could write <code>ifThenElse :: (t -&gt; t -&gt; t) -&gt; t -&gt; t -&gt; t</code>."}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1504977952, "post_id": 46132969, "comment_id": 79228827, "body": "I know that Haskell doesn&#39;t know that <code>cond</code> must be either <code>true</code> or <code>false</code>. I&#39;m asking how to require that it be that.."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1504980114, "post_id": 46132969, "comment_id": 79229486, "body": "Switch on <code>RankNTypes</code> and demand <code>ifThenElse</code> take a condition of type <code>forall t. t -&gt; t -&gt; t</code>."}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1504980598, "post_id": 46132969, "comment_id": 79229601, "body": "Two things. (1) Can we do it without extra features? (2) More important, I would prefer to allow <code>t1</code> and <code>t2</code> to be different."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1505045255, "post_id": 46132969, "comment_id": 79242698, "body": "@RussAbbott, what will you do with the information that they can be different?  Say you have <code>let x = ifThenElse b 42 &quot;Foobar&quot;</code>, how do you plan to use <code>x</code>?"}, {"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1505070439, "post_id": 46132969, "comment_id": 79250770, "body": "I think I confused the issue by how I asked the question. I was thinking that <code>cond</code> should return either the <code>true</code> function or the <code>false</code> function. That result would be applied to the <code>thenPart</code> and <code>elsePart</code> and pick one. I suppose that the way GHC defined the <code>cond</code> type, the selection is made without requiring an intermediate <code>true</code> or <code>false</code> result first. I wanted to require the intermediate result. If that&#39;s not required there is no need to define the <code>true</code> and <code>false</code> functions at all, at least for defining <code>ifThenElse</code>. Does that make any sense? That was my original thought."}, {"owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "edited": false, "score": 0, "creation_date": 1505084633, "post_id": 46132969, "comment_id": 79254413, "body": "In the last line of code, you are just saying that <code>ifThenElse = id</code>. On the other hand, the expression <code>cond thenPart elsePart</code> can&#39;t have different types depending on <code>cond</code>. So you either stick with <code>Either t1 t2</code> or you make <code>t1</code> and <code>t2</code> be the same type."}], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 0, "last_activity_date": 1504980506, "creation_date": 1504980506, "answer_id": 46133671, "question_id": 46132969, "link": "https://stackoverflow.com/questions/46132969/implementing-lambda-calculus-true-and-false-in-haskell/46133671#46133671", "title": "Implementing Lambda Calculus true and false in Haskell", "body": "<p>You want these:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n-- These are the only two values of this type...\ntrue  :: l -&gt; r -&gt; Either l r\nfalse :: l -&gt; r -&gt; Either l r\ntrue  l _ = Left  l\nfalse _ r = Right r\n\n-- ...and they are the only possible arguments here.\nifThenElse :: (forall l r. l -&gt; r -&gt; Either l r) -&gt; l -&gt; r -&gt; Either l r\nifThenElse = id\n</code></pre>\n\n<p>There's no way around <code>Either</code> if you want differing left and right types.</p>\n"}], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 254, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1504980506, "creation_date": 1504975809, "question_id": 46132969, "link": "https://stackoverflow.com/questions/46132969/implementing-lambda-calculus-true-and-false-in-haskell", "title": "Implementing Lambda Calculus true and false in Haskell", "body": "<p>Perhaps this is a trivial question and I'm just not thinking about it correctly. If so, my apologies.</p>\n\n<p>I would like to implement the lambda calculus true and false functions in Haskell and then use those to implement if-then-else.  Here's what I did.</p>\n\n<pre><code>true :: t1 -&gt; t2 -&gt; t1\ntrue x y =  x\n\nfalse :: t1 -&gt; t2 -&gt; t2\nfalse x y = y\n\n-- ifThenElse :: (t2 -&gt; t1 -&gt; t) -&gt; t2 -&gt; t1 -&gt; t\nifThenElse cond thenPart elsePart =  cond thenPart elsePart\n</code></pre>\n\n<p>The commented-out <code>ifThenElse</code> type is what GHC generates. My concern is that <code>t</code> in that type should be constrained to be either <code>t1</code> or <code>t2</code>. Can I write a type for <code>ifThenElse</code> that accomplishes this? </p>\n"}, {"tags": ["haskell", "recursion", "recursive-datastructures", "recursion-schemes", "corecursion"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1504979427, "post_id": 46131958, "comment_id": 79229303, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/38462563/how-to-work-with-ast-with-cofree-annotation\" title=\"how to work with ast with cofree annotation\">stackoverflow.com/questions/38462563/&hellip;</a>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1504980838, "post_id": 46131958, "comment_id": 79229663, "body": "(tl;dr: use <code>Product</code>, not <code>Cofree</code>, for labelling.)"}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1504988198, "post_id": 46131958, "comment_id": 79231637, "body": "When you use <code>Product</code>,  it will iterate on both structures simoultaniasly, correct ?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1504993414, "post_id": 46131958, "comment_id": 79233036, "body": "Have a look at the linked answer. If the other half of the functor product contains no <code>a</code>s (ie <code>Const k</code>) there&#39;s nothing to iterate."}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1504993993, "post_id": 46131958, "comment_id": 79233192, "body": "The answer says that this method doesn&#39;t allow the algorithm to traverse the tree."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1504994064, "post_id": 46131958, "comment_id": 79233209, "body": "<code>hoistFix</code> doesn&#39;t, but you can still use <code>cata</code> or <code>ana</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1504973918, "post_id": 46132315, "comment_id": 79227594, "body": "Thanks! But there is another problem: actually my <code>Result</code> is wrapped in a monad. So <code>run&#39; :: Fix Term -&gt; Cofree Term (m Result)</code>. What can I do to get <code>m (Cofree Term Result)</code> ?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1504976832, "post_id": 46132315, "comment_id": 79228505, "body": "@user47376 Is your original algebra like <code>alg :: Term (m Result) -&gt; m Result</code> ?"}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1504977035, "post_id": 46132315, "comment_id": 79228542, "body": "Yes. The full type is <code>hm :: (MonadError TypeError m,MonadState Count m) =&gt; Term (Alias m) -&gt; Alias m</code>. Where <code>type Alias m = Enviroment -&gt; m (Substitution,Type)</code>. So it&#39;s actually wrapped in all sorts of things. I&#39;m only interested in <code>Type</code>. So the final result should be <code>Cofree Term Type</code>"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1504981728, "post_id": 46132315, "comment_id": 79229888, "body": "@user47376 In that case I&#39;m not sure how to reutilize <code>alg</code> in the definition of <code>alg&#39;</code>. But perhaps you could define <code>alg&#39;</code> (the algebra that returns annotated trees) directly and work with it from the start? It&#39;s easy to &quot;forget the tree&quot; and just keep the root result, after all."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1505054245, "post_id": 46132315, "comment_id": 79245357, "body": "@user47376 I&#39;ve just remember that there exists a recursion scheme called &quot;histomorphism&quot; which comes with the &quot;Cofree annotating all previous results&quot; baked-in. <a href=\"https://stackoverflow.com/questions/24884475/examples-of-histomorphisms-in-haskell\" title=\"examples of histomorphisms in haskell\">stackoverflow.com/questions/24884475/&hellip;</a> <a href=\"http://hackage.haskell.org/package/recursion-schemes-5.0.2/docs/Data-Functor-Foldable.html#v:histo\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/recursion-schemes-5.0.2/docs/&hellip;</a> I&#39;m still unsure about how to integrate it with returning functions / monadic effects."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1504972560, "last_edit_date": 1504972560, "creation_date": 1504971666, "answer_id": 46132315, "question_id": 46131958, "link": "https://stackoverflow.com/questions/46131958/haskell-recursion-schemes-label-the-tree-with-intermediate-results/46132315#46132315", "title": "Haskell Recursion Schemes: Label the tree with intermediate results", "body": "<p>Does this modified algebra work?</p>\n\n<pre><code>alg' :: Term (Cofree Term Result) -&gt; Cofree Term Result\nalg' t = alg (fmap extract t) :&lt; t  \n\nrun' :: Fix Term -&gt; Cofree Term Result\nrun' ast = cata alg' ast\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/comonad-5/docs/Control-Comonad.html#v:extract\" rel=\"nofollow noreferrer\"><code>extract</code></a> is from <code>Control.Comonad</code>. We are using it here with type <code>Cofree Term Result -&gt; Result</code>. It simply returns the annotation at the root.</p>\n\n<p><code>fmap extract :: Term (Cofree Term Result) -&gt; Term Result</code> lets us reuse our previous <code>alg</code> definition.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 0, "last_activity_date": 1504978151, "creation_date": 1504978151, "answer_id": 46133296, "question_id": 46131958, "link": "https://stackoverflow.com/questions/46131958/haskell-recursion-schemes-label-the-tree-with-intermediate-results/46133296#46133296", "title": "Haskell Recursion Schemes: Label the tree with intermediate results", "body": "<p>If you just need a simple catamorphism, you could use a function like <a href=\"https://hackage.haskell.org/package/recursion-schemes-ext-0.2.0.0/docs/Data-Functor-Foldable-Exotic.html#v:cataM\" rel=\"nofollow noreferrer\"><code>cataM</code></a>. This allows you to fold monadic values such that the actions are properly ordered. Plus, you don't need to write any boilerplate to wrap your F-algebra.</p>\n\n<p>Then</p>\n\n<pre><code>alg :: Term Result -&gt; Cofree Term Result\nalg = undefined\n\nrun' :: Fix Term -&gt; Cofree Term Result\nrun' = cataM alg\n</code></pre>\n"}], "owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 1, "accepted_answer_id": 46132315, "answer_count": 2, "score": 1, "last_activity_date": 1504978151, "creation_date": 1504969182, "question_id": 46131958, "link": "https://stackoverflow.com/questions/46131958/haskell-recursion-schemes-label-the-tree-with-intermediate-results", "title": "Haskell Recursion Schemes: Label the tree with intermediate results", "body": "<p>Using <code>cata</code> I can fold an AST to a result. With <code>Cofree</code> I can store additional annotations on the AST. How can I take an AST and return an annotated AST with the results at each step of the way?</p>\n\n<pre><code>alg :: Term Result -&gt; Result\nalg = undefined\n\nrun :: Fix Term -&gt; Result\nrun ast = cata alg ast\n\nrun' :: Fix Term -&gt; Cofree Term Result\nrun' = ???\n</code></pre>\n"}, {"tags": ["list", "class", "dictionary", "haskell", "anonymous-function"], "comments": [{"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "edited": false, "score": 1, "creation_date": 1504966510, "post_id": 46131310, "comment_id": 79225331, "body": "It&#39;s cool, that you&#39;re interested in Haskell, but it would be better to extract the &quot;bonus&quot; part into a separate question, because these two questions are not related to each other."}], "answers": [{"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 3, "last_activity_date": 1504966189, "creation_date": 1504966189, "answer_id": 46131547, "question_id": 46131310, "link": "https://stackoverflow.com/questions/46131310/haskell-having-trouble-understanding-a-small-bit-of-code/46131547#46131547", "title": "Haskell - Having trouble understanding a small bit of code", "body": "<blockquote>\n  <p>the inner map function only has an anonymous function but no list to operate on</p>\n</blockquote>\n\n<p>Given there's a function <code>f</code> of type <code>a -&gt; b -&gt; c</code>, which takes two arguments and returns a value of type <code>c</code>. If the <code>f</code> is called with one parameter it returns another function of type <code>b -&gt; c</code>, which is going to take one more parameter and return a value. This is called currying.</p>\n\n<p>This line:</p>\n\n<pre><code>map (map (\\x -&gt; ((head x), (length x))) . group . sort) (transpose strs)\n</code></pre>\n\n<p>can be transformed into:</p>\n\n<pre><code>map (\\str -&gt; (map (\\x -&gt; ((head x), (length x))) . group . sort) str)(transpose strs)\n</code></pre>\n\n<p>In this form, it might be cleared, that there's actually a list to operate on.</p>\n\n<p>This function</p>\n\n<pre><code>(map (\\x -&gt; ((head x), (length x))) . group . sort)\n</code></pre>\n\n<p>is just a composition of <code>sort</code>, <code>group</code> and <code>map (\\x -&gt; ((head x), (length x)))</code>.</p>\n\n<p>Let's see how it works on <code>[2,1,1,1,4]</code>:</p>\n\n<p><code>sort [2, 1, 1, 1, 4]</code> => <code>[1, 1, 1, 2, 4]</code></p>\n\n<p><code>group [1, 1, 1, 2, 4]</code> => <code>[[1,1,1],[2],[4]]</code></p>\n\n<p><code>map (\\x -&gt; ((head x), (length x)))</code> => <code>[(1,3),(2,1),(4,1)]</code></p>\n\n<p>It just returns a list of tuples. Every tuple contains an element as a first element and the number of occurrence as a second element.</p>\n"}, {"comments": [{"owner": {"reputation": 703, "user_id": 4490045, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/df608bfbe36fb52c6d54de21d7de5345?s=128&d=identicon&r=PG&f=1", "display_name": "Schytheron", "link": "https://stackoverflow.com/users/4490045/schytheron"}, "edited": false, "score": 0, "creation_date": 1504971568, "post_id": 46132214, "comment_id": 79226846, "body": "Thank you for such a detailed answer! Now I understand! :)"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 4, "last_activity_date": 1504971442, "last_edit_date": 1504971442, "creation_date": 1504971034, "answer_id": 46132214, "question_id": 46131310, "link": "https://stackoverflow.com/questions/46131310/haskell-having-trouble-understanding-a-small-bit-of-code/46132214#46132214", "title": "Haskell - Having trouble understanding a small bit of code", "body": "<p><code>map (\\x -&gt; (head x, length x)) . group . sort</code> is an idiomatic way of generating a histogram. When you see something like this that you don\u2019t understand, try breaking it down into smaller pieces and testing them on sample inputs:</p>\n\n<pre><code>(\\x -&gt; (head x, length x)) \"AAAA\"\n-- ('A', 4)\n\n(group . sort) \"CABABA\"\n-- [\"AAA\", \"BB\", \"C\"]\n\n(map (\\x -&gt; (head x, length x)) . group . sort) \"CABABA\"\nmap (\\x -&gt; (head x, length x)) (group (sort \"CABABA\"))\n-- [('A', 3), ('B', 2), ('C', 1)]\n</code></pre>\n\n<p>It\u2019s written in <em>point-free</em> style as a composition of 3 functions, <code>map (\u2026)</code>, <code>group</code>, and <code>sort</code>, but could also be written as a lambda:</p>\n\n<pre><code>\\row -&gt; map (\u2026) (group (sort row))\n</code></pre>\n\n<p>For each row in the transposed matrix, it produces a histogram of the data in that row. You could get a more visual representation of this by formatting it and printing it out:</p>\n\n<pre><code>let\n  showHistogramRow row = concat\n    [ show $ head row\n    , \":\\t\"\n    , replicate (length row) '#'\n    ]\n  input = [3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5]\n\nputStr\n  $ unlines\n  $ map showHistogramRow\n  $ group\n  $ sort input\n\n-- 1:   ##\n-- 2:   #\n-- 3:   ##\n-- 4:   #\n-- 5:   ###\n-- 6:   #\n-- 9:   #\n</code></pre>\n\n<p>As for this:</p>\n\n<pre><code>addRow object num  -- Adds row to distance matrix\n  | num &lt; length object = (name a, name b, distance a b) : addRow object (num + 1)\n  | otherwise = [] \n  where  \n        a = head object\n        b = object !! num\n</code></pre>\n\n<p><code>addRow</code> makes a list of the distances from the first element in <code>object</code> to each of the other elements. It uses indexing into the list in a sort of non-obvious way, when a simpler and more idiomatic <code>map</code> would suffice:</p>\n\n<pre><code>addRow object = map (\\ b -&gt; (name a, name b, distance a b)) object\n  where a = head object\n</code></pre>\n\n<p>Ordinarily it\u2019s good to avoid <em>partial</em> functions such as <code>head</code> because they can throw an exception on some inputs (e.g. <code>head []</code>). Here it\u2019s fine, however, because if the input list is empty, then <code>a</code> will never be used, and so <code>head</code> will never be called.</p>\n\n<p><code>distanceMatrix</code> could be expressed with a <code>map</code> as well, because it\u2019s just calling a function (<code>addRow</code>) on all the <code>tails</code> of the list and concatenating them together with <code>++</code>:</p>\n\n<pre><code>distanceMatrix object = concatMap addRow (tails object)\n</code></pre>\n\n<p>This could be written in point-free style too. <code>\\x -&gt; f (g x)</code> can be written as just <code>f . g</code>; here, <code>f</code> is <code>concatMap addRow</code> and <code>g</code> is <code>tails</code>:</p>\n\n<pre><code>distanceMatrix = concatMap addRow . tails\n</code></pre>\n\n<p><code>Evol</code> just describes the set of types for which you can generate a <code>distanceMatrix</code>, including <code>MolSeq</code> and <code>Profile</code>. Note that <code>addRow</code> and <code>distanceMatrix</code> don\u2018t need to be members of this class, because they\u2019re implemented entirely in terms of <code>name</code> and <code>distance</code>, so you could move them to the top level:</p>\n\n<pre><code>distanceMatrix :: (Evol object) =&gt; [object] -&gt; [(String, String, Double)]\ndistanceMatrix = concatMap addRow . tails\n\naddRow :: (Evol object) =&gt; [object] -&gt; Int -&gt; [(String, String, Double)]\naddRow object = map (\\ b -&gt; (name a, name b, distance a b)) object\n  where a = head object\n</code></pre>\n"}], "owner": {"reputation": 703, "user_id": 4490045, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/df608bfbe36fb52c6d54de21d7de5345?s=128&d=identicon&r=PG&f=1", "display_name": "Schytheron", "link": "https://stackoverflow.com/users/4490045/schytheron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 1, "accepted_answer_id": 46132214, "answer_count": 2, "score": 2, "last_activity_date": 1504971442, "creation_date": 1504964323, "question_id": 46131310, "link": "https://stackoverflow.com/questions/46131310/haskell-having-trouble-understanding-a-small-bit-of-code", "title": "Haskell - Having trouble understanding a small bit of code", "body": "<p>I am doing a school task where I am given a small bit of sample code which I can use later. I understand 90% of this code but there is one little line/function that I for the life of me can't figure out what it does (I am very new to Haskell btw).</p>\n\n<p>Sample code:</p>\n\n<pre><code>data Profile = Profile {matrix::[[(Char,Int)]], moleType::SeqType, nrOfSeqs::Int, nm::String} deriving (Show)\n\nnucleotides = \"ACGT\"\naminoacids = sort \"ARNDCEQGHILKMFPSTWYVX\"\n\nmakeProfileMatrix :: [MolSeq] -&gt; [[(Char, Int)]]\nmakeProfileMatrix [] = error \"Empty sequence list\"\nmakeProfileMatrix sl = res\n  where \n    t = seqType (head sl)\n    defaults = \n      if (t == DNA) then\n        zip nucleotides (replicate (length nucleotides) 0) -- Row 1\n      else \n        zip aminoacids (replicate (length aminoacids) 0)   -- Row 2\n    strs = map seqSequence sl                              -- Row 3\n    tmp1 = map (map (\\x -&gt; ((head x), (length x))) . group . sort)\n               (transpose strs)                            -- Row 4\n    equalFst a b = (fst a) == (fst b)\n    res = map sort (map (\\l -&gt; unionBy equalFst l defaults) tmp1)\n\n{-Row 1: 'replicate' creates a list of zeros that is equal to the length of the 'nucleotides' string. \nThis list is then 'zipped' (combines each element in each list into pairs/tuples) with the nucleotides-}\n\n{-Row 2: 'replicate' creates a list of zeros that is equal to the length of the 'aminoacids' string.\nThis list is then 'zipped' (combines each element in each list into pairs/tuples) with the aminoacids-}\n\n{-Row 3: The function 'seqSequence' is applied to each element in the 'sl' list and then returns a new altered list. \nIn other words 'strs' becomes a list that contains the all the sequences in 'sl' (sl contains MolSeq objects, not strings)-}\n\n{-Row 4: (transpose strs) creates a list that has each 'column' of sequences as a element (the first element is made up of each first element in each sequence etc.).\n--}\n</code></pre>\n\n<p>I have written an explanation for each marked Row in the code (which I think so far is correct) but I get stuck when I try to figure out what Row 4 does. I understand the 'transpose' bit but I can't at all figure out what the inner map function does. As far as I know a 'map' function needs a list as a second parameter to function but the inner map function only has an anonymous function but no list to operate on. To be perfectly clear I don't understand what the entire inner line <code>map (\\x -&gt; ((head x), (length x))) . group . sort</code> does. Please help!</p>\n\n<p>Bonus!:</p>\n\n<p>Here is another piece of sample code that I can't figure out (never worked with classes in Haskell):</p>\n\n<pre><code>class Evol object where\n name :: object -&gt; String\n distance :: object -&gt; object -&gt; Double\n distanceMatrix :: [object] -&gt; [(String, String, Double)]\n addRow :: [object] -&gt; Int -&gt; [(String, String, Double)]\n distanceMatrix [] = []\n distanceMatrix object =\n  addRow object 0 ++ distanceMatrix (tail object)\n addRow object num  -- Adds row to distance matrix\n  | num &lt; length object = (name a, name b, distance a b) : addRow object (num + 1)\n  | otherwise = [] \n  where  \n        a = head object\n        b = object !! num\n\n\n -- Determines the name and distance of an instance of \"Evol\" if the instance is a \"MolSeq\".\ninstance Evol MolSeq where\n name = seqName\n distance = seqDistance\n\n -- Determines the name and distance of an instance of \"Evol\" if the instance is a \"Profile\".\ninstance Evol Profile where\n name = profileName\n distance = profileDistance\n</code></pre>\n\n<p>Especially this part:</p>\n\n<pre><code>addRow object num  -- Adds row to distance matrix\n  | num &lt; length object = (name a, name b, distance a b) : addRow object (num + 1)\n  | otherwise = [] \n  where  \n        a = head object\n        b = object !! num\n</code></pre>\n\n<p>You don't have to explain this one if you don't want to I am just slightly confused as to what 'addRow' actually is trying to do (in detail).</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["algorithm", "haskell", "recursion", "unification", "recursion-schemes"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1504958638, "post_id": 46130052, "comment_id": 79223079, "body": "What is <code>Result</code>?"}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1504958824, "post_id": 46130052, "comment_id": 79223117, "body": "A Substitution, but that doesn&#39;t really matter."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1504972723, "post_id": 46130052, "comment_id": 79227217, "body": "think about your base cases - how should a <code>TypeVariable n</code> and a <code>TypeVariable m</code> unify? a <code>TypeVariable n</code> and a <code>TypeApplication x y</code>? a <code>TypeApplication x y</code> and a <code>TypeApplication u v</code>?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1504974488, "post_id": 46130052, "comment_id": 79227776, "body": "i) use the free monad rather than the raw fixpoint to distinguish variables from all other constructs (and to obtain a handy implementation of substitution); ii) learn about the halfZip operation (google it!); iii) note that any functor which is halfzippable and traversable induces a free monad with a Robinson unification algorithm"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1504981088, "post_id": 46130052, "comment_id": 79229719, "body": "Since @pigworker&#39;s Google search turns up a lot of clothing, you might look at <a href=\"https://stackoverflow.com/a/45254970/1477667\">stackoverflow.com/a/45254970/1477667</a>"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1504991369, "post_id": 46130052, "comment_id": 79232527, "body": "halfZip Haskell narrows it down..."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 2, "last_activity_date": 1504978806, "creation_date": 1504978806, "answer_id": 46133406, "question_id": 46130052, "link": "https://stackoverflow.com/questions/46130052/haskell-recursion-schemes-traverse-two-structures-simultaneously/46133406#46133406", "title": "Haskell Recursion Schemes: Traverse two structures simultaneously", "body": "<p>I'd just suggest currying and a hylomorphism.</p>\n\n<pre><code>data TypeF a\n    = TypeApplication a a\n    | TypeVariable Name\n    deriving (Read,Show,Eq,Functor,Foldable,Traversable)\ntype Type = Fix TypeF\n\nunify :: (Type, Type) -&gt; Result\nunify = hylo algebra coalgebra\n    where algebra :: TypeF Result -&gt; Result\n          algebra = ...\n          coalgebra :: (Type, Type) -&gt; TypeF (Type, Type)\n          coalgebra = ...\n</code></pre>\n\n<p>As an aside, I would probably with <code>TypeF</code> as follows, using the <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.0.2\" rel=\"nofollow noreferrer\">recursion-schemes</a> package.</p>\n\n<pre><code>import Data.Functor.Foldable.TH (makeBaseFunctor)\n\ndata Type = TypeApplication Type Type\n          | TypeVariable Name\n\nmakeBaseFunctor ''Type\n</code></pre>\n\n<p>This will automatically generate exactly what you want in this case, with no need to use to <code>Fix</code>.</p>\n"}], "owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1504978806, "creation_date": 1504955616, "question_id": 46130052, "link": "https://stackoverflow.com/questions/46130052/haskell-recursion-schemes-traverse-two-structures-simultaneously", "title": "Haskell Recursion Schemes: Traverse two structures simultaneously", "body": "<p>I'm trying to write Robinson's unification algorithm using recursion schemes.\nThe unification algorithm takes two types and spits a result.\nA type is a:</p>\n\n<pre><code>data TypeF a\n    = TypeApplication a a\n    | TypeVariable Name\n    deriving (Read,Show,Eq,Functor,Foldable,Traversable)\ntype Type = Fix TypeF\n\nunify :: Type -&gt; Type -&gt; Result\nunify = ...\n</code></pre>\n\n<p>How can this be done elegantly using recursion schemes?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "edited": false, "score": 0, "creation_date": 1504952894, "post_id": 46129304, "comment_id": 79221557, "body": "What is the problem you are trying to solve? I can give examples of using type families but I&#39;d rather answer a more specific question."}], "answers": [{"comments": [{"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 0, "creation_date": 1504966183, "post_id": 46129701, "comment_id": 79225238, "body": "Thanks for spotting my mistake in the type family declaration! (Fixed now)"}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 11, "last_activity_date": 1504952906, "creation_date": 1504952906, "answer_id": 46129701, "question_id": 46129304, "link": "https://stackoverflow.com/questions/46129304/why-cant-i-pattern-match-on-a-type-family/46129701#46129701", "title": "Why can&#39;t I pattern match on a type family?", "body": "<p>When you declare</p>\n\n<pre><code>leftthing :: a -&gt; Leftthing a\n</code></pre>\n\n<p>you are saying that the <em>caller</em> of <code>leftthing</code> gets to choose what <code>a</code> is.</p>\n\n<p>When you then write</p>\n\n<pre><code>leftthing (Twothings a b) = leftthing a\n</code></pre>\n\n<p>you are <em>presuming</em> that they have chosen a <code>Twothings</code> type, and as that is not necessarily the case, your program is rejected.</p>\n\n<p>You may have thought that you were <em>testing whether</em> they had chosen a <code>Twothings</code> type, but no! Type information is erased before run time, so there is no way to make such a test.</p>\n\n<p>You <em>can</em> try to restore the necessary run time information. First let me fix the inconsistency between your <code>Leftthing</code> and <code>leftthing</code>.</p>\n\n<pre><code>type family Leftthing a where\n  Leftthing (Twothings a b) = Leftthing{-you forgot the recursion!-} a\n  Leftthing a = a\n</code></pre>\n\n<p>Now we can define the GADT of witnesses to <code>Twothing</code>ness.</p>\n\n<pre><code>data IsItTwothings :: * -&gt; * where\n  YesItIs   :: IsItTwothings a -&gt; IsItTwothings (Twothings a b)\n  NoItIsn't :: Leftthing a ~ a =&gt; IsItTwothings a\n            -- ^^^^^^^^^^^^^^^ this constraint will hold for any type\n            -- which is *definitely not* a Twothings type\n</code></pre>\n\n<p>And then we can pass the witness as an argument:</p>\n\n<pre><code>leftthing :: IsItTwothings a -&gt; a -&gt; Leftthing a\nleftthing (YesItIs r) (Twothings a b) = leftthing r a\nleftthing NoItIsn't   b               = b\n</code></pre>\n\n<p>In effect, the witness is the unary encoding of the number of left-nested <code>Twothings</code>es at the root of your type. That's enough information to determine at run time the correct amount of unpacking to do.</p>\n\n<pre><code>&gt; leftthing (YesItIs (YesItIs NoItIsn't)) (Twothings (Twothings True 11) (Twothings \"strange\" [42]))\nTrue\n</code></pre>\n\n<p>To sum up, you can't find out a type by pattern matching on a value. Rather, you need to know the type to do pattern matching (because the type determines the memory layout, and there are no run time type tags). You can't pattern match on types directly (because they're just not there to be matched on). You can construct data types which act as run time evidence of type structure and match on those instead.</p>\n\n<p>Perhaps, one day, your program will work if you give it the type</p>\n\n<pre><code>leftthing :: pi a. a -&gt; Leftthing a\n</code></pre>\n\n<p>where <code>pi</code> is the dependent quantifier, indicating that the hidden type argument is not erased, but rather passed and matched on at run time. That day has not yet come, but I think it will.</p>\n"}], "owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 442, "favorite_count": 2, "accepted_answer_id": 46129701, "answer_count": 1, "score": 4, "last_activity_date": 1504966130, "creation_date": 1504950353, "last_edit_date": 1504966130, "question_id": 46129304, "link": "https://stackoverflow.com/questions/46129304/why-cant-i-pattern-match-on-a-type-family", "title": "Why can&#39;t I pattern match on a type family?", "body": "<p>Consider the following code:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\ndata Twothings a b = Twothings a b\n\ntype family Leftthing a where\n  Leftthing (Twothings a b) = Leftthing a\n  Leftthing a = a\n\nleftthing :: a -&gt; Leftthing a\nleftthing (Twothings a b) = leftthing a\nleftthing b = b\n</code></pre>\n\n<p>It doesn't compile, with the following error:</p>\n\n<pre><code>Couldn't match expected type \u2018a\u2019\n                  with actual type \u2018Twothings a0 t0\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          leftthing :: forall a. a -&gt; Leftthing a\n</code></pre>\n\n<p>It complains about the line <code>leftthing (Twothings a b) = leftthing a</code>. If I understand correctly, it can't unify the type variable <code>a</code> in the type signature with the type of the constructor <code>Twothings</code>. Ok, this seems to make sense. But then, <em>how can I ever define a function with type families in the type signature</em>?</p>\n"}, {"tags": ["haskell", "functional-programming", "pattern-matching"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1504968384, "post_id": 46129147, "comment_id": 79225943, "body": "In some sense, you can boil it down to &quot;variables are irrefutable, literals are refutable, and combinations are refutable if any part is refutable&quot;. For types with only one constructor (like a tuple), a seemingly refutable pattern like <code>(x, y)</code> (or, as it can be rewritten, <code>(,) x y</code>, a refutable literal followed by two irrefutable variables) can be considered irrefutable because after type checking, <i>only</i> values created by <code>(,)</code> are legal."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1504968504, "post_id": 46129147, "comment_id": 79225981, "body": "Ergo, a formal parameter is irrefutable because it is a variable."}], "answers": [{"comments": [{"owner": {"reputation": 407, "user_id": 7388196, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/ffb6b2b72b09356a8bfda10784b3d7a3?s=128&d=identicon&r=PG&f=1", "display_name": "Agnivesh Singh", "link": "https://stackoverflow.com/users/7388196/agnivesh-singh"}, "edited": false, "score": 0, "creation_date": 1504970574, "post_id": 46129174, "comment_id": 79226554, "body": "That would be a compilation error only in case of functional languges (or well typed or strictly typed languages) ..right ?"}, {"owner": {"reputation": 407, "user_id": 7388196, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/ffb6b2b72b09356a8bfda10784b3d7a3?s=128&d=identicon&r=PG&f=1", "display_name": "Agnivesh Singh", "link": "https://stackoverflow.com/users/7388196/agnivesh-singh"}, "edited": false, "score": 0, "creation_date": 1504970603, "post_id": 46129174, "comment_id": 79226566, "body": "I guess in &quot;c&quot; , the compiler does not check this."}], "tags": [], "owner": {"reputation": 10246, "user_id": 762363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cec6320f5a5a8253b3dbfbb8177e001?s=128&d=identicon&r=PG", "display_name": "Tarmil", "link": "https://stackoverflow.com/users/762363/tarmil"}, "is_accepted": false, "score": 7, "last_activity_date": 1504949276, "creation_date": 1504949276, "answer_id": 46129174, "question_id": 46129147, "link": "https://stackoverflow.com/questions/46129147/haskell-irrefutable-pattern-matching/46129174#46129174", "title": "Haskell irrefutable pattern matching", "body": "<p>No, passing a value of some other type is not a failure in the pattern matching. It's a type error, and the code won't even compile. Formal parameters are irrefutable patterns <em>for a well-typed program</em>, which is the only kind of program that the compiler allows you to run.</p>\n"}, {"comments": [{"owner": {"reputation": 407, "user_id": 7388196, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/ffb6b2b72b09356a8bfda10784b3d7a3?s=128&d=identicon&r=PG&f=1", "display_name": "Agnivesh Singh", "link": "https://stackoverflow.com/users/7388196/agnivesh-singh"}, "edited": false, "score": 0, "creation_date": 1504973550, "post_id": 46129293, "comment_id": 79227481, "body": "@Wilhem : So in a nutshell , type checking is done at compile time . As such  calls to &quot;foo&quot; will be validated when  a value from  the listed ones in the data constructor is passed ."}, {"owner": {"reputation": 407, "user_id": 7388196, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/ffb6b2b72b09356a8bfda10784b3d7a3?s=128&d=identicon&r=PG&f=1", "display_name": "Agnivesh Singh", "link": "https://stackoverflow.com/users/7388196/agnivesh-singh"}, "edited": false, "score": 0, "creation_date": 1504973651, "post_id": 46129293, "comment_id": 79227503, "body": "@Wilhem : And pattern matching is used to evaluate the outcomes of a function in this case . But I think I didn&#39;t understand the part about formal parameters being irrefutable . Could you please tell me a little more on that ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 407, "user_id": 7388196, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/ffb6b2b72b09356a8bfda10784b3d7a3?s=128&d=identicon&r=PG&f=1", "display_name": "Agnivesh Singh", "link": "https://stackoverflow.com/users/7388196/agnivesh-singh"}, "edited": false, "score": 0, "creation_date": 1504973873, "post_id": 46129293, "comment_id": 79227580, "body": "Well a variable like <code>c</code> is irrefutable since it matches <i>all possible</i> kinds of input (that satisfy the type constraint)."}, {"owner": {"reputation": 407, "user_id": 7388196, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/ffb6b2b72b09356a8bfda10784b3d7a3?s=128&d=identicon&r=PG&f=1", "display_name": "Agnivesh Singh", "link": "https://stackoverflow.com/users/7388196/agnivesh-singh"}, "edited": false, "score": 0, "creation_date": 1504974131, "post_id": 46129293, "comment_id": 79227683, "body": "@Wilhelm : Ok . Can I conclude that  &quot;c&quot; is the formal parameter here ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 407, "user_id": 7388196, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/ffb6b2b72b09356a8bfda10784b3d7a3?s=128&d=identicon&r=PG&f=1", "display_name": "Agnivesh Singh", "link": "https://stackoverflow.com/users/7388196/agnivesh-singh"}, "edited": false, "score": 0, "creation_date": 1504975860, "post_id": 46129293, "comment_id": 79228205, "body": "@AgniveshSingh: yes."}, {"owner": {"reputation": 407, "user_id": 7388196, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/ffb6b2b72b09356a8bfda10784b3d7a3?s=128&d=identicon&r=PG&f=1", "display_name": "Agnivesh Singh", "link": "https://stackoverflow.com/users/7388196/agnivesh-singh"}, "edited": false, "score": 0, "creation_date": 1504977527, "post_id": 46129293, "comment_id": 79228694, "body": "@Wilhem : Thanks a  lot"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 7, "last_activity_date": 1504950215, "creation_date": 1504950215, "answer_id": 46129293, "question_id": 46129147, "link": "https://stackoverflow.com/questions/46129147/haskell-irrefutable-pattern-matching/46129293#46129293", "title": "Haskell irrefutable pattern matching", "body": "<p>What you describe is <strong>not a pattern</strong>, it is a <strong>type</strong>. Haskell has types as well, and these are resolved at <em>compile</em> time. Each time can have several patterns. For example a list is defined as:</p>\n\n<pre><code>data Color = Red | Green | Blue | Other String\n</code></pre>\n\n<p>Now we can define a function <code>foo</code>:</p>\n\n<pre><code>foo :: Color -&gt; String\nfoo <b>Red</b> = \"Red\"\nfoo <b>Green</b> = \"Green\"\nfoo <b>Blue</b> = \"Blue\"\nfoo <b>(Other s)</b> = s</code></pre>\n\n<p>The elements in boldface are all <em>patterns</em>. But these are not irrefutable: the first one will check if we have given the function a <code>Red</code>, the second whether we have given it <code>Green</code>, the third if the value is <code>Blue</code>, and finally we have a pattern <code>(Other s)</code> that will match with all <code>Other</code> patterns (regardless what the value of <code>s</code> is), since <code>s</code> is a <em>variable</em>, and a variable is an irrefutable pattern: we do not perform any checks on the value of the string.</p>\n\n<p>Mind that these checks are done at <em>runtime</em>: if we would however call <code>foo \"Red\"</code>, we will get a type error at <em>compile time</em> since the Haskell compiler knows that <code>foo</code> has type <code>Color -&gt; String</code>.</p>\n\n<p>If we would have written:</p>\n\n<pre><code>foo :: Color -&gt; String\nfoo <b>c</b> = \"Some color\"\nfoo Red = \"Red\"</code></pre>\n\n<p><code>c</code> is an irrefutable pattern: it will match any <code>Color</code> object, so the second line <code>foo Red</code> will never match, so <code>c</code> is an <em>irrefutable pattern</em>.</p>\n"}, {"comments": [{"owner": {"reputation": 407, "user_id": 7388196, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/ffb6b2b72b09356a8bfda10784b3d7a3?s=128&d=identicon&r=PG&f=1", "display_name": "Agnivesh Singh", "link": "https://stackoverflow.com/users/7388196/agnivesh-singh"}, "edited": false, "score": 0, "creation_date": 1504974919, "post_id": 46129326, "comment_id": 79227896, "body": "Seeman : Tthanks a lot , but I think I need to understand a little bit more about type constructors and data constructors before being able to completely understand your answer."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1504950488, "creation_date": 1504950488, "answer_id": 46129326, "question_id": 46129147, "link": "https://stackoverflow.com/questions/46129147/haskell-irrefutable-pattern-matching/46129326#46129326", "title": "Haskell irrefutable pattern matching", "body": "<p>In Haskell, you can define types in various ways. One of these is to introduce a <em>sum type</em>, like this:</p>\n\n<pre><code>data FooBar = Foo Int | Bar Bool\n</code></pre>\n\n<p>You could attempt to write a function like this, using pattern matching:</p>\n\n<pre><code>myFunction (Foo x) = x\n</code></pre>\n\n<p>That would, however, be a partially matched function, and if you try to call it with <code>myFunction (Bar False)</code>, you'd get an exception.</p>\n\n<p>You can, on the other hand, also define single-case sum types, like this:</p>\n\n<pre><code>data MyInt = MyInt Int\n</code></pre>\n\n<p>Here, you can write a function like this:</p>\n\n<pre><code>myFunction' (MyInt x) = x\n</code></pre>\n\n<p>Here, you're still using pattern matching, but since there's only a single case, this is a complete match. If the calling code compiles, the match can't fail.</p>\n\n<p>The above <code>MyInt</code> is really only a wrapper around <code>Int</code>, so you could say that if you write a function that takes an <code>Int</code>, like this, it's the same sort of pattern matching:</p>\n\n<pre><code>myFunction'' :: Int -&gt; Int\nmyFunction'' x = x + 42\n</code></pre>\n\n<p>While <code>Int</code> doesn't have a value constructor that you can use to pattern-match on, <code>x</code> is a pattern that always matches an <code>Int</code> value. Therefore you can say that a function argument is a match that always succeeds.</p>\n"}], "owner": {"reputation": 407, "user_id": 7388196, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/ffb6b2b72b09356a8bfda10784b3d7a3?s=128&d=identicon&r=PG&f=1", "display_name": "Agnivesh Singh", "link": "https://stackoverflow.com/users/7388196/agnivesh-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 651, "favorite_count": 0, "answer_count": 3, "score": 10, "last_activity_date": 1504950488, "creation_date": 1504949088, "last_edit_date": 1504950010, "question_id": 46129147, "link": "https://stackoverflow.com/questions/46129147/haskell-irrefutable-pattern-matching", "title": "Haskell irrefutable pattern matching", "body": "<p>In order to get a head start into the path of Haskell, I chose the book by one of its creators Hudak. So, I am going through the gentle introduction to Haskell.</p>\n\n<p>I got stuck at trying to understand the following statement:</p>\n\n<blockquote>\n  <p>Technically speaking, formal parameters are also patterns but they never fail to match a value.</p>\n</blockquote>\n\n<p>From my little but relatively greater habituation with languages like C (or let's broadly say as non-functional languages), I could form that formal parameters are the arguments in the definition of a function. So, suppose there were a function like the following in C:</p>\n\n<pre><code>int func_add(int a, int d) \n</code></pre>\n\n<p>then passing a value of some other type like string will be a failure in pattern matching if I am correct. So calling <code>func_add</code> as <code>func_add(\"trs\", 5)</code> is a case of pattern mismatch.</p>\n\n<p>With a heavy possibility of an incorrect understanding or interpretation this similar situation can occur very well in Haskell as well when a piece of code calls a function by passing arguments of different types. </p>\n\n<p>So, why is it said that in Haskell formal parameters are irrefutable pattern matching? </p>\n"}, {"tags": ["class", "haskell", "types", "instance", "complex-numbers"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1504928553, "post_id": 46126787, "comment_id": 79216306, "body": "Just use FlexibleInstances."}], "answers": [{"comments": [{"owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "edited": false, "score": 0, "creation_date": 1504930216, "post_id": 46127004, "comment_id": 79216502, "body": "Nice! I like the last option. But why doesn&#39;t the compiler complain about this; it can&#39;t know that scale is defined fir a given a (e.g. Int)? Will it complan if you use it in a context later where this can happen? I should probably read up on compositional instances.."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "edited": false, "score": 1, "creation_date": 1504931335, "post_id": 46127004, "comment_id": 79216657, "body": "@jorgen Notice the <code>(Separate a) =&gt;</code> clause, which guarantees that <code>scale</code> is defined for <code>a</code>.  This instance says <code>Complex</code> <i>preserves</i> <code>Separate</code>ness."}, {"owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "edited": false, "score": 0, "creation_date": 1504931692, "post_id": 46127004, "comment_id": 79216697, "body": "Ah, makes sense"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1504991271, "post_id": 46127004, "comment_id": 79232505, "body": "@VanessaMcHale <a href=\"https://repl.it/KszN/0\" rel=\"nofollow noreferrer\">works for me</a>, what error are you getting/expecting?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1504991486, "post_id": 46127004, "comment_id": 79232555, "body": "@VanessaMcHale oh you wrote the other answer.  Application binds tighter than operator sections, too.  Just as <code>2 * realToFrac d</code> is parsed as <code>2 * (realToFrac d)</code>, <code>(* realToFrac d)</code> is parsed as <code>(* (realToFrac d))</code>.  I suspect you may come from the lisp world where that syntax would mean something quite different."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 4, "last_activity_date": 1504930020, "creation_date": 1504930020, "answer_id": 46127004, "question_id": 46126787, "link": "https://stackoverflow.com/questions/46126787/instance-of-complex-double/46127004#46127004", "title": "Instance of Complex Double", "body": "<p>As n.m. points out, defining <code>instance Separate (Complex Double)</code> is perfectly fine if you use the <code>FlexibleInstances</code> extension, which is a popular and harmless extension.</p>\n\n<p>But there are other options, too, for example:</p>\n\n<pre><code>instance (Floating a) =&gt; Separate (Complex a) where\n    d `scale` z = (* realToFrac d) &lt;$&gt; z\n</code></pre>\n\n<p>And the compositional instance <em>(<a href=\"https://www.youtube.com/watch?v=hou0lU8WMgo\" rel=\"nofollow noreferrer\">the best kind of instance</a>)</em>:</p>\n\n<pre><code>instance (Separate a) =&gt; Separate (Complex a) where\n    d `scale` z = (d `scale`) &lt;$&gt; z\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 2, "last_activity_date": 1504930426, "creation_date": 1504930426, "answer_id": 46127032, "question_id": 46126787, "link": "https://stackoverflow.com/questions/46126787/instance-of-complex-double/46127032#46127032", "title": "Instance of Complex Double", "body": "<p>This is a <em>type</em> issue rather than an issue with how you are handling instances. As you say, <code>(*)</code> is not defined between a <code>Double</code> and a <code>Float</code>. However, we can easily convert between a <code>Double</code> and a <code>Float</code>, so you're in luck! With <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:realToFrac\" rel=\"nofollow noreferrer\"><code>realToFrac</code></a>, we can convert between various fractional types.</p>\n\n<p>I would rewrite the instance as follows:</p>\n\n<pre><code>instance (Floating a) -&gt; Separate (Complex a) where\n  d `scale` z = (* (realToFrac d)) &lt;$&gt; z\n</code></pre>\n"}], "owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 46127004, "answer_count": 2, "score": 2, "last_activity_date": 1504930426, "creation_date": 1504926731, "question_id": 46126787, "link": "https://stackoverflow.com/questions/46126787/instance-of-complex-double", "title": "Instance of Complex Double", "body": "<p>I'm writing a class <code>Separate</code> which performs certain operations independently on \"parts\" of different structures; e.g. the real and complex parts of a complex number (later I'll also need it for lists). In this way I can write functions that don't care which of these structures they're acting on but will do it in this independent way.</p>\n\n<p>The functions should work normally on structures without parts, e.g. <code>Double</code>. </p>\n\n<p>This will be used among other things to compute standard deviations (I know there is a standard deviation defined for complex numbers that gives a real number but the \"independent\" one makes more sense in my case).</p>\n\n<p>But I'm having trouble with some instance declarations. In particular one of the operations should be \"multiply with a <code>Double</code>\", aka <code>scale</code>:</p>\n\n<pre><code>class Separate a where\n  scale :: Double -&gt; a -&gt; a\n\ninstance Separate Double where\n  scale = (*)\n\ninstance (Floating a) =&gt; Separate (Complex a) where\n  d `scale` z = (*d) &lt;$&gt; z\n</code></pre>\n\n<p>This of course doesn't compile because <code>*</code> isn't defined between a <code>Double</code> and a general <code>Floating a</code>. But I can't define directly <code>instance Separate (Complex Double) where...</code>.</p>\n\n<p>I could just write a function <code>Double -&gt; Complex Double -&gt; Complex Double</code> with no class but then the standard deviation must be defined separately for different structures.</p>\n\n<p>Any ideas? </p>\n"}, {"tags": ["haskell", "monads", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "edited": false, "score": 0, "creation_date": 1504935970, "post_id": 46126621, "comment_id": 79217528, "body": "Your solution doesn&#39;t compile. The expression <code>gets objects &gt;&gt;= traverse (execStateT nestedAction) &gt;&gt;= assign objects</code> results in <code>Couldn&#39;t match type ...</code> errors. As far as I understand you it seems that it is not possible to implement <code>&lt;~%</code>. I have an open mind on alternative solutions."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "edited": false, "score": 0, "creation_date": 1504959176, "post_id": 46126621, "comment_id": 79223213, "body": "Sorry, that should have been <code>use objects</code> instead of <code>gets objects</code>."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1504959190, "last_edit_date": 1504959190, "creation_date": 1504924236, "answer_id": 46126621, "question_id": 46126263, "link": "https://stackoverflow.com/questions/46126263/modify-a-traversable-lens-using-a-nested-state-transformer/46126621#46126621", "title": "Modify a traversable lens using a nested state transformer", "body": "<pre><code>use objects &gt;&gt;= traverse (execStateT nestedAction) &gt;&gt;= assign objects\n</code></pre>\n\n<hr>\n\n<p><code>object . traverse</code> is too coarse grained to elegantly express the update of the <code>count</code> field (implicit via <code>nestedAction</code>) during the traversal of the <code>objects</code> field. This is basically why the lens library has no operator <code>(&lt;~%) :: MonadState s m =&gt; ATraversal' s a -&gt; (a -&gt; m a) -&gt; m ()</code>: it does not behave well if its second argument modifies parts of the state that are also being targeted by the traversal in its first argument.</p>\n"}], "owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 46126621, "answer_count": 1, "score": 1, "last_activity_date": 1504959190, "creation_date": 1504919227, "last_edit_date": 1504919655, "question_id": 46126263, "link": "https://stackoverflow.com/questions/46126263/modify-a-traversable-lens-using-a-nested-state-transformer", "title": "Modify a traversable lens using a nested state transformer", "body": "<p>I have an <code>OuterState</code> object that contains multiple <code>_objects</code> that should be modified using <code>nestedAction</code> which also requires access to the <code>OuterState</code> object. Hence, <code>nestedAction</code> is a nested state transformer that is run for each <code>InnerStateObject</code> like in this example:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nmodule Main where\n\nimport Control.Lens ((+=), makeLenses)\nimport Control.Monad.IO.Class (liftIO)\nimport Control.Monad.State.Lazy\n       (StateT, evalStateT, execStateT, get)\nimport Control.Monad.Trans.Class (lift)\n\ndata OuterState = OuterState\n  { _objects :: [InnerStateObject]\n  , _count :: Int\n  } deriving (Show)\n\ndata InnerStateObject = InnerStateObject\n  { _value :: Int\n  } deriving (Show)\n\nmakeLenses ''OuterState\n\nmakeLenses ''InnerStateObject\n\nstartNestedAction :: StateT OuterState IO ()\nstartNestedAction = do\n  get &gt;&gt;= liftIO . putStrLn . (\"before: \" ++) . show\n  objects . traverse &lt;~% execStateT nestedAction\n  get &gt;&gt;= liftIO . putStrLn . (\"after: \" ++) . show\n\nnestedAction :: StateT InnerStateObject (StateT OuterState IO) ()\nnestedAction = do\n  value += 10\n  lift $ count += 100\n\nmain :: IO ()\nmain =\n  evalStateT\n    startNestedAction\n    OuterState {_count = 0, _objects = map InnerStateObject [0 .. 2]}\n</code></pre>\n\n<p>The definition of <code>&lt;~%</code> is missing in this example. The precedence is <code>infixr 2 &lt;~%</code>. It should pass each value of <code>objects . traverse</code> to <code>execStateT nestedAction</code> and assign the result to <code>objects . traverse</code>.</p>\n\n<p>How can I implement <code>&lt;~%</code>? What is the type of it?</p>\n\n<hr>\n\n<p><strong>dependencies:</strong> lts-9.3</p>\n\n<ul>\n<li><a href=\"https://www.stackage.org/lts-9.3/package/lens-4.15.4\" rel=\"nofollow noreferrer\">lens-4.15.4</a></li>\n<li><a href=\"https://www.stackage.org/lts-9.3/package/mtl-2.2.1\" rel=\"nofollow noreferrer\">mtl-2.2.1</a></li>\n<li><a href=\"https://www.stackage.org/lts-9.3/package/transformers-0.5\" rel=\"nofollow noreferrer\">transformers-0.5</a></li>\n</ul>\n"}, {"tags": ["haskell", "recursion", "type-inference", "hindley-milner", "recursion-schemes"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1504914904, "post_id": 46125839, "comment_id": 79214324, "body": "Yes just make the target of the cata a function <code>Env -&gt; a</code>"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1504914935, "post_id": 46125839, "comment_id": 79214329, "body": "Yes, but you&#39;ll probably need to use <code>cata</code> with a higher-order carrier type, computing an action that can modify the environment and possibly fail."}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1504915803, "post_id": 46125839, "comment_id": 79214498, "body": "Got it. Genius. Thanks"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1504921924, "post_id": 46125839, "comment_id": 79215481, "body": "@user47376 something about it feels a bit magical, doesn&#39;t it?"}], "answers": [{"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1504954240, "post_id": 46126834, "comment_id": 79221892, "body": "<i>Now</i> write algorithm W as a tail-recursive traversal using the <i>same</i> data structure as both the zipper and the environment of unification variables. You&#39;ll be glad you did."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1504927330, "creation_date": 1504927330, "answer_id": 46126834, "question_id": 46125839, "link": "https://stackoverflow.com/questions/46125839/algorithm-w-using-recursion-schemes/46126834#46126834", "title": "Algorithm W using recursion schemes", "body": "<blockquote>\n  <p>Yes just make the target of the <code>cata</code> a function <code>Env -&gt; a</code></p>\n</blockquote>\n\n<p>\u2013 luqui</p>\n\n<blockquote>\n  <p>Yes, but you'll probably need to use <code>cata</code> with a higher-order carrier type, computing an action that can modify the environment and possibly fail.</p>\n</blockquote>\n\n<p>\u2013 pigworker</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "is_accepted": false, "score": 3, "last_activity_date": 1504930294, "last_edit_date": 1504930294, "creation_date": 1504929845, "answer_id": 46126985, "question_id": 46125839, "link": "https://stackoverflow.com/questions/46125839/algorithm-w-using-recursion-schemes/46126985#46126985", "title": "Algorithm W using recursion schemes", "body": "<blockquote>\n  <p>Without the env part, this could be easily implemented with cata. Can this (with env) be done in general using recursion schemes? </p>\n</blockquote>\n\n<p>What you're looking for is a <a href=\"https://hackage.haskell.org/package/recursion-schemes-5.0.2/docs/Data-Functor-Foldable.html#v:chrono\" rel=\"nofollow noreferrer\">chronomorphism</a>. This allows you to do recursion using <em>both</em> results from the future and the past. It's not quite as user-friendly as it sounds, but it is the canonical way of doing things using recursion schemes.</p>\n"}], "owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 3, "answer_count": 2, "score": 6, "last_activity_date": 1504930294, "creation_date": 1504914199, "question_id": 46125839, "link": "https://stackoverflow.com/questions/46125839/algorithm-w-using-recursion-schemes", "title": "Algorithm W using recursion schemes", "body": "<p>I wanted to be able to formulate the hindley-milner type inference algorithm using fix-point data types and recursion schemes. \nDisregarding all detail apart from the actual recursion parts:</p>\n\n<pre><code>w env term = case term of \n    Lam n e -&gt; lam (w (modify1 env) e)\n    App a b -&gt; app (w (modify2 env) a) (w (modify3 env) b)\n    ...\n</code></pre>\n\n<p>The algorithm builds an environment data structure <code>env</code> as it recursively traverses the tree until it reaches the leafs. Then it uses this information as it builds up the result again.</p>\n\n<p>Without the <code>env</code> part, this could be easily implemented with <code>cata</code>.\nCan this (with <code>env</code>) be done in general using recursion schemes? </p>\n"}, {"tags": ["haskell", "monad-transformers", "haskell-pipes"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1504916738, "post_id": 46125030, "comment_id": 79214655, "body": "Add <code>lift</code> in front of <code>fork</code>. <code>fork stuff :: m ThreadId</code>, <code>lift :: m r -&gt; Producer a m r</code>. Although I don&#39;t think there are a lot of interesting types that you can actually fork."}, {"owner": {"reputation": 3226, "user_id": 1058732, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/271319f2b3d45b31f2bec9f3e4e92961?s=128&d=identicon&r=PG", "display_name": "shmish111", "link": "https://stackoverflow.com/users/1058732/shmish111"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1504956480, "post_id": 46125030, "comment_id": 79222492, "body": "Sweet it worked. Can you explain why it works? Maybe you should post an answer so I can mark it as correct and you get more points?"}, {"owner": {"reputation": 3226, "user_id": 1058732, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/271319f2b3d45b31f2bec9f3e4e92961?s=128&d=identicon&r=PG", "display_name": "shmish111", "link": "https://stackoverflow.com/users/1058732/shmish111"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1504956597, "post_id": 46125030, "comment_id": 79222523, "body": "Also, the reason I want to use <code>fork</code> is so that I can use any monad stack as long as it has IO. It doesn&#39;t matter that <code>IO</code> is about the only type you can <code>fork</code>"}], "answers": [{"comments": [{"owner": {"reputation": 3226, "user_id": 1058732, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/271319f2b3d45b31f2bec9f3e4e92961?s=128&d=identicon&r=PG", "display_name": "shmish111", "link": "https://stackoverflow.com/users/1058732/shmish111"}, "edited": false, "score": 0, "creation_date": 1504961276, "post_id": 46130694, "comment_id": 79223771, "body": "Ah yes, originally I tried to do this with lifted-async but I couldn&#39;t work it out. I couldn&#39;t find any information on how I &#39;run&#39; a <code>MonadBase</code>. Or how do I run <code>(MonadIO m, MonadBase m) =&gt; Producer a m r</code>?"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 3226, "user_id": 1058732, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/271319f2b3d45b31f2bec9f3e4e92961?s=128&d=identicon&r=PG", "display_name": "shmish111", "link": "https://stackoverflow.com/users/1058732/shmish111"}, "edited": false, "score": 0, "creation_date": 1504962569, "post_id": 46130694, "comment_id": 79224141, "body": "<code>MonadBaseControl IO m</code> is just like <code>HasFork m</code>. There is no &quot;run&quot; function to apply."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1504960358, "last_edit_date": 1504960358, "creation_date": 1504959977, "answer_id": 46130694, "question_id": 46125030, "link": "https://stackoverflow.com/questions/46125030/pipes-and-fork-with-control-concurrent-monadio/46130694#46130694", "title": "pipes and fork with Control.Concurrent.MonadIO", "body": "<p>Add <code>lift</code> in front of <code>fork</code>.</p>\n\n<pre><code>t1 &lt;- lift . fork . ...\n</code></pre>\n\n<p>In your function, <code>fork . ...</code> has type <code>m ThreadId</code>, but the <code>do</code> block is in the monad <code>Producer a m</code>.</p>\n\n<p>Also, <code>lifted-base</code> has a more up to date <code>fork</code>.</p>\n"}], "owner": {"reputation": 3226, "user_id": 1058732, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/271319f2b3d45b31f2bec9f3e4e92961?s=128&d=identicon&r=PG", "display_name": "shmish111", "link": "https://stackoverflow.com/users/1058732/shmish111"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 1, "accepted_answer_id": 46130694, "answer_count": 1, "score": 4, "last_activity_date": 1504960358, "creation_date": 1504907838, "question_id": 46125030, "link": "https://stackoverflow.com/questions/46125030/pipes-and-fork-with-control-concurrent-monadio", "title": "pipes and fork with Control.Concurrent.MonadIO", "body": "<p>In the following code I am trying to combine 2 <code>Producer</code>s into 1. All have the same type. They will be combined by each of the 2 input <code>Producer</code>s being run in a separate thread and being consumed by a <code>Consumer</code> that puts the values into an unagi chan (I'm using unagi chan for performance). A producer is returned which reads from the chan. I want to be able to take any <code>Producer</code> as long as it can run <code>IO</code> so I restrict the class of the monad to <code>MonadIO</code> and <code>HasFork</code>.</p>\n\n<pre><code>import Pipes (Producer, Consumer, (&gt;-&gt;), yield, await, runEffect)\nimport Control.Concurrent.Chan.Unagi (InChan, OutChan, newChan, readChan, writeChan)\nimport Control.Monad (forever, void)\nimport Control.Concurrent.MonadIO (MonadIO, HasFork, liftIO, fork)\n\ncombine :: (MonadIO m, HasFork m) =&gt; Producer a m r -&gt; Producer a m r -&gt; Producer a m r\ncombine p1 p2 = do\n  (inChan, outChan) &lt;- liftIO $ newChan\n  t1 &lt;- fork . void . runEffect $ p1 &gt;-&gt; (consumer inChan)\n  t2 &lt;- fork . void . runEffect $ p2 &gt;-&gt; (consumer inChan)\n  producer outChan\n\nproducer :: (MonadIO m) =&gt; OutChan a -&gt; Producer a m r\nproducer outChan = forever $ do\n  msg &lt;- liftIO $ readChan outChan\n  yield msg\n\nconsumer :: (MonadIO m) =&gt; InChan a -&gt; Consumer a m r\nconsumer inChan = forever $ do\n  msg &lt;- await\n  liftIO $ writeChan inChan msg\n</code></pre>\n\n<p>However I get the following error:</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018m\u2019\n                 with \u2018Pipes.Internal.Proxy Pipes.Internal.X () () a m\u2019\n  \u2018m\u2019 is a rigid type variable bound by\n    the type signature for:\n      combine :: forall (m :: * -&gt; *) a r.\n                 (MonadIO m, HasFork m) =&gt;\n                 Producer a m r -&gt; Producer a m r -&gt; Producer a m r\n    at src/Pipes/Unagi.hs:8:12\n  Expected type: Pipes.Internal.Proxy\n                   Pipes.Internal.X () () a m GHC.Conc.Sync.ThreadId\n    Actual type: m GHC.Conc.Sync.ThreadId\n</code></pre>\n\n<p>Is what I'm trying to do possible?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1504904623, "post_id": 46124490, "comment_id": 79211705, "body": "No. (and 10 more characters)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1504906329, "post_id": 46124490, "comment_id": 79212298, "body": "I don&#39;t think this is possible. Overlapping and incoherent instances are so confusing and fragile that they should be forbidden, IMO."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1504906701, "post_id": 46124490, "comment_id": 79212426, "body": "Think twice before using any extension with &quot;incoherent&quot; in the name. Then think thrice, then a fourth time, and then don&#39;t do it, because those extensions cause <i>way</i> too many problems."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1504914466, "post_id": 46124490, "comment_id": 79214245, "body": "@SilvioMayolo, while this view is not common, I tend to consider <code>IncoherentInstances</code> somewhat superior to overlapping ones. In particular, you aren&#39;t allowed to care which instance is selected, so you&#39;re forced to make them (effectively) coherent. Instance chains/closed type families are better, but none of these techniques make much sense in this context."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8174234"}, "edited": false, "score": 1, "creation_date": 1504979312, "post_id": 46124490, "comment_id": 79229269, "body": "&quot;Indeed, to have the code compile I have to specify these instances as incoherent which is right away false. As I see it, C a a is more specific since it only involves one variable type.&quot;  Not really. There&#39;s no good heuristic to determine which instance is better - perhaps the first one covers more types despite two constraints."}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1518130168, "post_id": 46125798, "comment_id": 84390877, "body": "This is a defeating example, but did you really have to call my idea silly?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 1, "creation_date": 1518133223, "post_id": 46125798, "comment_id": 84391886, "body": "@Kindaro, I&#39;m known for coming up with peculiar names, but I can erase that one."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 1, "last_activity_date": 1518133244, "last_edit_date": 1518133244, "creation_date": 1504913838, "answer_id": 46125798, "question_id": 46124490, "link": "https://stackoverflow.com/questions/46124490/is-there-a-way-to-set-one-of-these-two-incoherent-instances-as-preferred/46125798#46125798", "title": "Is there a way to set one of these two incoherent instances as preferred?", "body": "<p>As others have said, this is a terrible idea. However, I think it's probably possible without <code>IncoherentInstances</code>, as long as you don't want any other instances.</p>\n\n<pre><code>instance {-# OVERLAPPABLE #-}\n     (Foldable m, C a b, q ~ m a)\n   =&gt; C q b where\n  f = foldl f\n\ninstance {-# OVERLAPPING #-}\n         Monoid a =&gt; C a a where\n  f = mappend\n</code></pre>\n\n<p>For more predictable behavior, you could even recast this to use a type family instead of overlapping instances, but it would still be a terrible idea. This class just doesn't make any sense.</p>\n\n<pre><code>*Class Data.Monoid&gt; f (12 :: Sum Int) (ZipList [1,2,3 :: Sum Int])\nSum {getSum = 18}\n\n*Class Data.Monoid&gt; f [1,2,3:: Int] [12::Int]\n[1,2,3,12]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "is_accepted": false, "score": 1, "last_activity_date": 1547810786, "creation_date": 1547810786, "answer_id": 54253024, "question_id": 46124490, "link": "https://stackoverflow.com/questions/46124490/is-there-a-way-to-set-one-of-these-two-incoherent-instances-as-preferred/54253024#54253024", "title": "Is there a way to set one of these two incoherent instances as preferred?", "body": "<blockquote>\n  <p>I want the compiler to pick the second instance whenever possible.</p>\n</blockquote>\n\n<p>Easy. (But yes you need to take great care with overlapping instances; you definitely don't want <code>Incoherent</code>.)</p>\n\n<p>Let's put the preferred instance first.</p>\n\n<pre><code>instance (Monoid a) =&gt; C a a where\n    f = mappend\n\ninstance {-# OVERLAPPABLE #-} \n    C2 q b =&gt; C q b  where f = f2\n\nclass C2 a b where          -- identical to C\n    f2 :: b -&gt; a -&gt; b\n\ninstance (Foldable m, C a b) =&gt; C2 (m a) b where\n    f2 = foldl f\n</code></pre>\n\n<p>This is somewhat similar to @dfeuer's solution: put a catch-all <code>OVERLAPPABLE</code> instance. But the separate constraining instance for <code>C2</code> doesn't make any attempt to improve type <code>q</code> (there's no <code>~</code> constraint), so you've more freedom to add other instances: just make a chain of catch-alls <code>C3, C4, ...</code>.</p>\n\n<p>Contra @dfeuer's comment: I advise never to use <code>INCOHERENT</code> -- you can always avoid it, per this answer. I also advise never to use <code>OVERLAPPING</code>, but only <code>OVERLAPPABLE</code>. Then the instance author acknowledges the responsibility to cater in advance for overlaps.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 46125798, "answer_count": 2, "score": 0, "last_activity_date": 1547810786, "creation_date": 1504904456, "last_edit_date": 1504904652, "question_id": 46124490, "link": "https://stackoverflow.com/questions/46124490/is-there-a-way-to-set-one-of-these-two-incoherent-instances-as-preferred", "title": "Is there a way to set one of these two incoherent instances as preferred?", "body": "<p>I have this <strong>class</strong> at hand:</p>\n\n<pre><code>class C a b where\n    f :: b -&gt; a -&gt; b\n</code></pre>\n\n<p>Along with it, I have coexist two <strong>instances</strong>.</p>\n\n<p>The first instance works by applying elements from a foldable collection one by one:</p>\n\n<pre><code>instance (Foldable m, C a b) =&gt; C (m a) b where\n    f = foldl f\n</code></pre>\n\n<p>The second conjoins two elements of a semigroup:</p>\n\n<pre><code>instance (Monoid a) =&gt; C a a where\n    f = mappend\n</code></pre>\n\n<p>Of course, a type can be an instance of both <code>Monoid</code> and <code>Foldable</code> (example be <code>String</code>).</p>\n\n<p>Since I presume <code>mappend</code> to be optimized for the case (i.e. there to be defined a way of conjoining the foldable collections at hand more efficient than transferring elements one by one), I want the compiler to <strong>pick the second instance whenever possible</strong>. How can I denote or enforce such preferrence?</p>\n\n<p>Indeed, to have the code compile I have to specify these instances as <code>incoherent</code> which is right away false. As I see it, <code>C a a</code> is more specific since it only involves one variable type.</p>\n\n<hr>\n\n<p>You can review the code on GitHub: <a href=\"https://github.com/kindaro/overlap\" rel=\"nofollow noreferrer\">kindaro/overlap</a>.</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "answers": [{"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 4, "last_activity_date": 1504892503, "last_edit_date": 1504892503, "creation_date": 1504891795, "answer_id": 46121777, "question_id": 46121636, "link": "https://stackoverflow.com/questions/46121636/haskell-lens-getter-that-compares-values-of-two-lens-getters/46121777#46121777", "title": "Haskell lens getter that compares values of two lens getters", "body": "<p>You're close with this:</p>\n\n<pre><code>\u03bb&gt; left .&gt;=. right = (&gt;=) &lt;$&gt; use left &lt;*&gt; use right\n(.&gt;=.) ::\n  (Ord a, Control.Monad.State.Class.MonadState s f) =&gt;\n  Getting a s a -&gt; Getting a s a -&gt; f Bool\n</code></pre>\n\n<p>First, use <code>view</code> in instead of <code>use</code>; <code>use</code> is for getting from state (hence the <code>MonadState</code> constraint), which doesn't seem relevant here.</p>\n\n<pre><code>\u03bb&gt; left .&gt;=. right = (&gt;=) &lt;$&gt; view left &lt;*&gt; view right\n(.&gt;=.) ::\n  (Ord a, Control.Monad.Reader.Class.MonadReader s f) =&gt;\n  Getting a s a -&gt; Getting a s a -&gt; f Bool\n</code></pre>\n\n<p>That gives you a function (<code>MonadReader s f =&gt; f Bool</code> specializes to <code>s -&gt; Bool</code>), so now you need to turn this into a <code>Getting</code> with <code>to</code>.</p>\n\n<pre><code>\u03bb&gt; left .&gt;=. right = to $ (&gt;=) &lt;$&gt; view left &lt;*&gt; view right\n(.&gt;=.) ::\n  (Ord a, Contravariant f, Profunctor p) =&gt;\n  Getting a s a -&gt; Getting a s a -&gt; Optic' p f s Bool\n</code></pre>\n\n<p>(And <code>(Contravariant f, Profunctor p) =&gt; Optic' p f s Bool</code> specializes to <code>Getting Bool s Bool</code>, so this is what you want.)</p>\n"}], "owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 46121777, "answer_count": 1, "score": 3, "last_activity_date": 1504895380, "creation_date": 1504891138, "last_edit_date": 1504895380, "question_id": 46121636, "link": "https://stackoverflow.com/questions/46121636/haskell-lens-getter-that-compares-values-of-two-lens-getters", "title": "Haskell lens getter that compares values of two lens getters", "body": "<p>I try to write a comparison operator greater-than-equals for two <a href=\"https://hackage.haskell.org/package/lens-4.15.4\" rel=\"nofollow noreferrer\">lens</a> getters with type</p>\n\n<pre><code>(.&gt;=.) :: Ord a =&gt; Getting a s a -&gt; Getting a s a -&gt; Getting Bool s Bool\n</code></pre>\n\n<p>I have a working solution for a getter on the left side and a value on the right side (no <code>.</code> on the right side of the operator <code>.&gt;=</code>)</p>\n\n<pre><code>left .&gt;= right = left . to (&gt;= right)\n</code></pre>\n\n<p>I tried</p>\n\n<pre><code>left .&gt;=. right = (&gt;=) &lt;$&gt; use left &lt;*&gt; use right\n</code></pre>\n\n<p>but it has type</p>\n\n<pre><code>(.&gt;=.) :: (Ord a, MonadState s f) =&gt; Getting a s a -&gt; Getting a s a -&gt; f Bool\n</code></pre>\n\n<p>How can I get the desired return type <code>Getting Bool s Bool</code> instead of <code>f Bool</code>?</p>\n"}, {"tags": ["loops", "haskell", "matrix", "iterator", "sum"], "answers": [{"comments": [{"owner": {"reputation": 703, "user_id": 4490045, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/df608bfbe36fb52c6d54de21d7de5345?s=128&d=identicon&r=PG&f=1", "display_name": "Schytheron", "link": "https://stackoverflow.com/users/4490045/schytheron"}, "edited": false, "score": 0, "creation_date": 1504897466, "post_id": 46121121, "comment_id": 79208690, "body": "Thanks! Worked great."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 703, "user_id": 4490045, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/df608bfbe36fb52c6d54de21d7de5345?s=128&d=identicon&r=PG&f=1", "display_name": "Schytheron", "link": "https://stackoverflow.com/users/4490045/schytheron"}, "edited": false, "score": 1, "creation_date": 1504911080, "post_id": 46121121, "comment_id": 79213545, "body": "@Schytheron: If you need the difference as a matrix, and not just the sum, you can also use something like <code>zipWith (zipWith diffSnd)</code> instead of flattening the structure with <code>concat</code>. Also <code>diffSnd = (-) `on` snd</code> using <code>on</code> from <code>Data.Function</code>."}], "tags": [], "owner": {"reputation": 1419, "user_id": 203856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f1108eabf701ed53b05a875e3d8203?s=128&d=identicon&r=PG", "display_name": "larsen", "link": "https://stackoverflow.com/users/203856/larsen"}, "is_accepted": true, "score": 6, "last_activity_date": 1504889028, "creation_date": 1504889028, "answer_id": 46121121, "question_id": 46120750, "link": "https://stackoverflow.com/questions/46120750/haskell-sum-of-the-differences-between-each-element-in-each-matrix/46121121#46121121", "title": "Haskell - Sum of the differences between each element in each matrix", "body": "<p>Here a proposal:</p>\n\n<pre><code>solution m1 m2 = sum $ zipWith diffSnd flatM1 flatM2\n  where\n    diffSnd t1 t2 = snd t1 - snd t2\n    flatM1 = concat m1\n    flatM2 = concat m2\n</code></pre>\n\n<p>I wrote it so that it's easier to understand the building blocks. \nThe basic idea is to iterate simultaneously on our two lists of pairs using <code>zipWith</code>. Here its type:</p>\n\n<pre><code>zipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\n</code></pre>\n\n<p>It means it takes a function with type <code>a -&gt; b -&gt; c</code>, a list of <code>a</code>'s and a list of <code>b</code>'s, and it returns a list of <code>c</code>'s. In other words, <code>zipWith</code> takes case of the iteration, you just have to specify what you want to do with every item the iteration yields, that in your case will be a pair of pairs (one from the first matrix, another one from the second). </p>\n\n<p>The function passed to <code>zipWith</code> takes the <code>snd</code> element from each pair, and computes the difference. Looking back at <code>zipWith</code> signature you can deduce it will return a list of numbers. So the last thing we need to do is summing them, using the function <code>sum</code>. </p>\n\n<p>There's one last problem. We actually do not have two lists of pairs to be passed to <code>zipWith</code>!, but two matrices. We need to \"flatten\" them in a list, preserving the order of the elements. That's exactly what <code>concat</code> does, hence the calls to that function in the definitions of <code>flatM1</code> and <code>flatM2</code>.</p>\n\n<p>I suggest you look into the implementation of every function I mentioned to have a better grasp of how iteration is expressed by mean of recursion. HTH</p>\n"}], "owner": {"reputation": 703, "user_id": 4490045, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/df608bfbe36fb52c6d54de21d7de5345?s=128&d=identicon&r=PG&f=1", "display_name": "Schytheron", "link": "https://stackoverflow.com/users/4490045/schytheron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 596, "favorite_count": 1, "accepted_answer_id": 46121121, "answer_count": 1, "score": 2, "last_activity_date": 1504889028, "creation_date": 1504887476, "question_id": 46120750, "link": "https://stackoverflow.com/questions/46120750/haskell-sum-of-the-differences-between-each-element-in-each-matrix", "title": "Haskell - Sum of the differences between each element in each matrix", "body": "<p>I am very new to Haskell (and functional programming in general) and I am trying to write a function called \n\"profileDistance m1 m2\" that takes two matrices as parameters and needs to calculate the sum of the differences between each element in each matrix... I might have not explained that very well. Let me show it instead.</p>\n\n<p>The matrices are on the form of: <code>[[(Char,Int)]]</code>\nwhere each matrix might look something like this:</p>\n\n<pre><code>m1 = [[('A',1),('A',2)],\n      [('B',3),('B',4)],   \n      [('C',5),('C',6)]]\n\nm2 = [[('A',7),('A',8)],\n      [('B',9),('B',10)],   \n      [('C',11),('C',12)]]\n</code></pre>\n\n<p>(Note: I wrote the numbers in order in this example but they can be ANY numbers in any order. The chars in each row in each matrix will however match like shown in the example.)</p>\n\n<p>The result (in the case above) would look something like (psuedo code):</p>\n\n<pre><code>result = ((snd m1['A'][0])-(snd m2['A'][0]))+((snd m1['A'][1])-(snd m2['A'][1]))+((snd m1['B'][0])-(snd m2['B'][0]))+((snd m1['B'][1])-(snd m2['B'][1]))+((snd m1['C'][0])-(snd m2['C'][0]))+((snd m1['C'][1])-(snd m2['C'][1]))\n</code></pre>\n\n<p>This would be easy to do in any language that has for-loops and is non-functional but I have no idea how to do this in Haskell. I have a feeling that functions like <code>map</code>, <code>fold</code> or <code>sum</code> would help me here (admittedly I am not a 100% sure on how <code>fold</code> works). I hope there is an easy way to do this... please help.</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 103, "user_id": 8579872, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8a4ad5849904707098111a9d61109bb1?s=128&d=identicon&r=PG&f=1", "display_name": "Mel", "link": "https://stackoverflow.com/users/8579872/mel"}, "edited": false, "score": 0, "creation_date": 1504883910, "post_id": 46119569, "comment_id": 79201953, "body": "so maybe what I asked was wrong? i can&#39;t explain it well in english but when I run the program, what should I type to make it do its thing? Idk if I&#39;m making sense"}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 2, "creation_date": 1504883944, "post_id": 46119569, "comment_id": 79201976, "body": "Can you describe exactly how you got that error? Your code as it is compiles and produces the right output when run (either by compiling to an executable or by loading the file into <code>GHCi</code> then invoking <code>main</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 8579872, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8a4ad5849904707098111a9d61109bb1?s=128&d=identicon&r=PG&f=1", "display_name": "Mel", "link": "https://stackoverflow.com/users/8579872/mel"}, "edited": false, "score": 0, "creation_date": 1504883959, "post_id": 46119650, "comment_id": 79201985, "body": "oooh! thank you yes this is what I meant. Thank you so much!"}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 5, "last_activity_date": 1504883728, "creation_date": 1504883728, "answer_id": 46119650, "question_id": 46119569, "link": "https://stackoverflow.com/questions/46119569/how-the-input-should-go-inside-the-ghci-interpreter/46119650#46119650", "title": "How the input should go inside the ghci interpreter?", "body": "<p>The program, as it's written, doesn't take any input. Compiling with <code>ghc</code> will produce a working executable. Alternatively, running with <code>runhaskell</code> should work just as well.</p>\n\n<p>I suspect, based on your question, that you're running inside the <code>ghci</code> interpreter. In this case, you can load a file using <code>:l filename.hs</code> (or <code>:r</code> to reload) and then run your main function by simply invoking <code>main</code>.</p>\n"}], "owner": {"reputation": 103, "user_id": 8579872, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8a4ad5849904707098111a9d61109bb1?s=128&d=identicon&r=PG&f=1", "display_name": "Mel", "link": "https://stackoverflow.com/users/8579872/mel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1539754325, "creation_date": 1504883423, "last_edit_date": 1539754325, "question_id": 46119569, "link": "https://stackoverflow.com/questions/46119569/how-the-input-should-go-inside-the-ghci-interpreter", "title": "How the input should go inside the ghci interpreter?", "body": "<p>I'm trying a program from <a href=\"http://www.happylearnhaskelltutorial.com/1/more_shopping.html\" rel=\"nofollow noreferrer\">this tutorial</a>. The program goes like this:</p>\n\n<pre><code>type Name = String\ntype PriceInCents = Int\ntype ShoppingListItem = (Name, PriceInCents)\ntype ShoppingList = [ShoppingListItem]\n\nshoppingList :: ShoppingList\nshoppingList = [ (\"Bananas\", 300)\n               , (\"Chocolate\", 250)\n               , (\"Milk\", 300)\n               , (\"Apples\", 450)\n               ]\n\nsumShoppingList :: ShoppingList -&gt; PriceInCents\nsumShoppingList []     = 0\nsumShoppingList (x:xs) = getPriceFromItem x \n                         + sumShoppingList xs\n\n\ngetPriceFromItem :: ShoppingListItem -&gt; PriceInCents\ngetPriceFromItem (_, price) = price\n\nmain :: IO ()\nmain = putStrLn (\"Price of shopping list is \" \n                ++ show (sumShoppingList shoppingList)\n                ++ \" cents.\")\n</code></pre>\n\n<p>I tried running it and there were no errors but I don't know what to input. I tried but I guess I got it wrong since I got this error: </p>\n\n<blockquote>\n  <p>ERROR - Undefined data constructor </p>\n</blockquote>\n\n<p>Can anyone tell me what I should input?</p>\n"}, {"tags": ["haskell", "abstract-syntax-tree", "recursive-datastructures", "deriving"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1504878240, "post_id": 46117489, "comment_id": 79198155, "body": "<code>Show1</code> appears to be defined in <code>Data.Functor.Classes</code>. <code>Label</code> in <code>Labeled (Fix (Label a))</code> is partially applied, which I think is what <code>Show1</code> is intended to address."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 2, "last_activity_date": 1504922948, "last_edit_date": 1504922948, "creation_date": 1504884012, "answer_id": 46119740, "question_id": 46117489, "link": "https://stackoverflow.com/questions/46117489/haskell-labeled-ast-no-instance-for-show1-label-a-how-to-construct-an-inst/46119740#46119740", "title": "Haskell Labeled AST: No instance for (Show1 (Label a)), How to construct an instance?", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Classes.html#t:Show1\" rel=\"nofollow noreferrer\"><code>Show1</code></a> is the class of what you might call \"higher-order showables\": type constructors which are showable whenever their argument is showable. For the purposes of fast-and-loose reasoning, you can think of <code>Show1</code> as being declared roughly like this (see also <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor-Classes.html#v:showsPrec1\" rel=\"nofollow noreferrer\"><code>showsPrec1</code></a>):</p>\n\n<pre><code>class Show1 f where\n    show1 :: Show a =&gt; f a -&gt; String\n</code></pre>\n\n<p>Here's another inaccurate-but-useful way to think about <code>Show1</code>. I'm using <a href=\"https://hackage.haskell.org/package/constraints\" rel=\"nofollow noreferrer\">the <code>constraints</code> library</a>'s <a href=\"https://hackage.haskell.org/package/constraints-0.9.1/docs/Data-Constraint.html#t::-45-\" rel=\"nofollow noreferrer\">\"entailment\" operator</a> to declare that <code>f a</code> should be an instance of <code>Show</code> whenever <code>a</code> is. This model is a bit simpler but perhaps less practical.</p>\n\n<pre><code>class Show1 f where\n    show1 :: Show a :- Show (f a)\n</code></pre>\n\n<p>Anyway, <code>Fix :: (* -&gt; *) -&gt; *</code> is showable if its argument is a higher-order showable. From <a href=\"https://github.com/ekmett/recursion-schemes/blob/fec353466c96c6a7e34dd4fbe641cf4e289771b8/Data/Functor/Foldable.hs#L467-L471\" rel=\"nofollow noreferrer\">the source code</a>:</p>\n\n<pre><code>instance Show1 f =&gt; Show (Fix f) where\n  showsPrec d (Fix a) =\n    showParen (d &gt;= 11)\n      $ showString \"Fix \"\n      . showsPrec1 11 a\n</code></pre>\n\n<p>The authors of <code>recursion-schemes</code> could have used <code>StandaloneDeriving</code> to write their <code>Show</code> instance...</p>\n\n<pre><code>deriving instance Show (f (Fix f)) =&gt; Show (Fix f)\n</code></pre>\n\n<p>... but this context requires <code>UndecidableInstances</code>.</p>\n\n<p>The easiest way to write a <code>Show1</code> instance for a given functor is to use <a href=\"https://hackage.haskell.org/package/deriving-compat\" rel=\"nofollow noreferrer\">the <code>deriving-compat</code> library</a>'s <a href=\"https://hackage.haskell.org/package/deriving-compat-0.3.6/docs/Text-Show-Deriving.html#v:deriveShow1\" rel=\"nofollow noreferrer\">Template Haskell helper</a>.</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor, DeriveFoldable, DeriveTraversable #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Text.Show.Deriving\nimport Data.Functor.Foldable\n\n\ntype Name = String\ndata Term a \n    = Abstraction Name a\n    | Application a a\n    | Variable Name\n    deriving (Read, Show, Eq, Functor, Foldable, Traversable)\n\nderiveShow1 ''Term\n\ndata Label a b = Label a (Term b)\n    deriving (Read, Show, Eq, Functor, Foldable, Traversable)\n\nderiveShow1 ''Label\n\nnewtype Labeled a = Labeled (Fix (Label a)) deriving (Show)\n</code></pre>\n\n<p>This'll generate the following instances,</p>\n\n<pre><code>instance Show1 Term\ninstance Show a =&gt; Show1 (Label a)\n</code></pre>\n\n<p>giving you exactly what you want for <code>Labeled</code>'s derived instance:</p>\n\n<pre><code>instance Show a =&gt; Show (Labeled a)\n</code></pre>\n\n<p>(PS. Have you considered using a library like <a href=\"https://hackage.haskell.org/package/bound\" rel=\"nofollow noreferrer\"><code>bound</code></a> to manage names and binders in your term language?)</p>\n"}], "owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 2, "accepted_answer_id": 46119740, "answer_count": 1, "score": 4, "last_activity_date": 1554052181, "creation_date": 1504876833, "last_edit_date": 1554052181, "question_id": 46117489, "link": "https://stackoverflow.com/questions/46117489/haskell-labeled-ast-no-instance-for-show1-label-a-how-to-construct-an-inst", "title": "Haskell Labeled AST: No instance for (Show1 (Label a)), How to construct an instance?", "body": "<p>I want to have an annotated AST, so I defined those recursive data structures\nusing <code>Fix</code>:</p>\n\n<pre><code>data Term a \n  = Abstraction Name a\n  | Application a a\n  | Variable Name\n  deriving (Read,Show,Eq,Functor,Foldable,Traversable)\n\ndata Label a b \n  = Label a (Term b)\n  deriving (Read,Show,Eq,Functor,Foldable,Traversable)\n\nnewtype Labeled a \n  = Labeled (Fix (Label a))\n  deriving (Show)\n</code></pre>\n\n<p>I want to be able to <code>show</code> a <code>Labeled a</code>, but the compiler is not happy:</p>\n\n<blockquote>\n<pre><code>No instance for (Show1 (Label a))  \narising from the first field of `Labeled' (type `Fix (Label a)')\n</code></pre>\n</blockquote>\n\n<p>What is the class <code>Show1</code> and how do I define the appropriate instance to be able to show the <code>Labeled a</code> ?</p>\n"}, {"tags": ["haskell", "sandbox", "cabal"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1504883494, "post_id": 46117222, "comment_id": 79201682, "body": "Alternate suggestion: Give stack a try."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 992, "user_id": 1579244, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91326e6e4a8829c456ad73e58c3405ed?s=128&d=identicon&r=PG", "display_name": "Blank Chisui", "link": "https://stackoverflow.com/users/1579244/blank-chisui"}, "edited": false, "score": 0, "creation_date": 1504891894, "post_id": 46120362, "comment_id": 79206117, "body": "@BlankChisui Given that, it does indeed sound as though you&#39;ve installed a number of packages to your global package database. Shame, shame, shame! ;-)"}, {"owner": {"reputation": 992, "user_id": 1579244, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91326e6e4a8829c456ad73e58c3405ed?s=128&d=identicon&r=PG", "display_name": "Blank Chisui", "link": "https://stackoverflow.com/users/1579244/blank-chisui"}, "edited": false, "score": 0, "creation_date": 1504893178, "post_id": 46120362, "comment_id": 79206658, "body": "wtf, I just nuked both my <code>~&#47;.cabal</code> and <code>~&#47;.ghc</code> directory and I still get installed packages?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 992, "user_id": 1579244, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91326e6e4a8829c456ad73e58c3405ed?s=128&d=identicon&r=PG", "display_name": "Blank Chisui", "link": "https://stackoverflow.com/users/1579244/blank-chisui"}, "edited": false, "score": 0, "creation_date": 1504896048, "post_id": 46120362, "comment_id": 79208078, "body": "@BlankChisui Yes, your global package database lives in <code>&#47;usr&#47;local&#47;lib</code> or similar by default. Check <code>ghc-pkg list</code> to see what&#39;s in it. You might also like <a href=\"http://www.vex.net/~trebla/haskell/sicp.xhtml\" rel=\"nofollow noreferrer\">SICP</a>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1504886115, "creation_date": 1504886115, "answer_id": 46120362, "question_id": 46117222, "link": "https://stackoverflow.com/questions/46117222/cabal-sandbox-hell-can-not-resolve-depdencies/46120362#46120362", "title": "cabal sandbox hell: can not resolve depdencies", "body": "<p>First I will give an explanation of <em>what the error message says</em>. Then I will attempt to make some guesses about <em>why you have the error</em>. Then I will propose some next steps.</p>\n\n<p>The error says:</p>\n\n<ol>\n<li>Maybe version 4.15.4 of lens will work.</li>\n<li>Maybe the installed version 0.2.8.0 of unordered-containers will satisfy lens' dependency on unordered-containers.</li>\n<li>Maybe the installed version 1.2.2.2 of text will satisfy lens' dependency on text.</li>\n<li>Crap. You asked for version 0.8.5.1 of binary, but the installed version of text was built against version 0.8.3.0. I have to rebuild text.</li>\n<li>Maybe the installed version 1.2.6.1 version of hashable will satisfy lens' dependency on hashable.</li>\n<li>Crap. We're rebuilding text, a dependency of hashable. I have to rebuild hashable.</li>\n<li>Double crap. We already committed to using the installed version of unordered-containers, which depends on the installed version of hashable, which prevents us from rebuilding hashable.</li>\n<li>(...and I tried a bunch of other stuff that didn't work, too, but I'm not telling you what, nya nya nya)</li>\n</ol>\n\n<p>Normally sandboxes ignore local package databases, so this suggests to me that where it is talking about \"installed versions\" above it is either picking these up from your global package database or from your existing sandbox. You claim that you have just created this sandbox and run this <code>cabal install</code> command immediately. If this is true (is it? or is this a second run of the tool? why do you have <code>--force-reinstalls</code>?), it cannot be picking the installed versions from your sandbox, and therefore must be picking them up from your global package database. Installing things to the global package database is generally considered a Bad Idea, because it's much more difficult to correctly clear out a cluttered/broken global package database. Take it under future advisement.</p>\n\n<p>Now, to make progress, I would try one of these two things:</p>\n\n<ol>\n<li>The only part of the above error explanation that you have control over is the \"You asked for version 0.8.5.1 of binary\" part. Consider relaxing your version constraints on binary to accept the already-installed version 0.8.3.0.</li>\n<li><p>You can often get significantly better error messages out of cabal by cutting down on its search space; because it only prints a part of the search space in its error, you sometimes need to guide it to the problematic part of the space so that it will show you the real problem in its error. If you're pretty sure the installed versions of unordered-containers et al are a good match for your library, consider</p>\n\n<pre><code>cabal install --only-dependencies --constraint 'unordered-containers installed' --constraint 'binary installed'\n</code></pre>\n\n<p>and so on for any other packages it mentions trying to rebuild that you don't want it to rebuild. Alternately you can put exact version constraints in the <code>--constraint</code> if you don't want one of the installed versions. Don't include <code>--force-reinstalls</code>, basically ever.</p></li>\n</ol>\n"}], "owner": {"reputation": 992, "user_id": 1579244, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91326e6e4a8829c456ad73e58c3405ed?s=128&d=identicon&r=PG", "display_name": "Blank Chisui", "link": "https://stackoverflow.com/users/1579244/blank-chisui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1504889752, "creation_date": 1504875870, "last_edit_date": 1504889752, "question_id": 46117222, "link": "https://stackoverflow.com/questions/46117222/cabal-sandbox-hell-can-not-resolve-depdencies", "title": "cabal sandbox hell: can not resolve depdencies", "body": "<p>I'm trying to build my package using a sandbox. Without it, it compiles and works like a charm. Once I introduce a sandbox though cabal says it can't resolve dependencies. To my eyes these conflicts do not look like conflicts though.</p>\n\n<p>The project structure is as follows:</p>\n\n<pre><code>application (depends on library-base, library-impl1 and library-impl2)\n\nlibrary\n \u251c library-base\n \u251c library-impl1 (depends on library-base)\n \u2514 library-impl2 (depends on library-base)\n</code></pre>\n\n<p>These are the commands I ran in that order</p>\n\n<pre><code>rm -rf ~/.cabal\nrm -rf ~/.ghc\ncabal update\nrm -f  cabal.sandbox.config\nrm -rf .cabal-sandbox\ncabal sandbox init\ncabal sandbox add-source $LIB_HOME/library-base\ncabal sandbox add-source $LIB_HOME/library-impl1\ncabal sandbox add-source $LIB_HOME/library-impl2\ncabal install --only-dependencies --force-reinstalls &amp;&amp; cabal build\n</code></pre>\n\n<p><code>cabal install --only-dependencies --force-reinstalls</code> produces the following output:</p>\n\n<pre><code>Resolving dependencies...\ncabal: Could not resolve dependencies:\nnext goal: lens (dependency of library-base-0.1.0.0)\nrejecting: lens-4.15.4/installed-I5C... (conflict: bifunctors==5.4.2, lens =&gt;\nbifunctors==5.4.2/installed-Hs7...)\ntrying: lens-4.15.4\ntrying: unordered-containers-0.2.8.0/installed-1tq... (dependency of\nlens-4.15.4)\nnext goal: text (dependency of lens-4.15.4)\nrejecting: text-1.2.2.2/installed-3EN... (conflict: binary==0.8.5.1, text =&gt;\nbinary==0.8.3.0/installed-0.8...)\ntrying: text-1.2.2.2\nnext goal: hashable (dependency of lens-4.15.4)\nrejecting: hashable-1.2.6.1/installed-2nP... (conflict: text==1.2.2.2,\nhashable =&gt; text==1.2.2.2/installed-3EN...)\nrejecting: hashable-1.2.6.1, hashable-1.2.6.0, hashable-1.2.5.0,\nhashable-1.2.4.0, hashable-1.2.3.3, hashable-1.2.3.2, hashable-1.2.3.1,\nhashable-1.2.3.0, hashable-1.2.2.0, hashable-1.2.1.0, hashable-1.2.0.10,\nhashable-1.2.0.9, hashable-1.2.0.8, hashable-1.2.0.7, hashable-1.2.0.6,\nhashable-1.2.0.5, hashable-1.2.0.4, hashable-1.2.0.3, hashable-1.2.0.2,\nhashable-1.2.0.1, hashable-1.2.0.0, hashable-1.1.2.5, hashable-1.1.2.4,\nhashable-1.1.2.3, hashable-1.1.2.2, hashable-1.1.2.1, hashable-1.1.2.0,\nhashable-1.1.1.0, hashable-1.1.0.0, hashable-1.0.1.1, hashable-1.0.1.0,\nhashable-1.0.0 (conflict: unordered-containers =&gt;\nhashable==1.2.6.1/installed-2nP...)\nDependency tree exhaustively searched.\n</code></pre>\n\n<p>Does anyone have an idea what is going on here?</p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1504882023, "post_id": 46119030, "comment_id": 79200784, "body": "Thank you, this is exactly what I was looking for plus some nice extra information."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1504887242, "post_id": 46119030, "comment_id": 79203867, "body": "But be careful: shells typically distinguish between &quot;interactive&quot; use and &quot;non-interactive use&quot;, and skip the startup files that define functions and aliases when used non-interactively. So even after this setup the stated goal may not be met."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1504894368, "post_id": 46119030, "comment_id": 79207210, "body": "<code>fish</code>, though, takes the opposite approach. All configuration files are processed on start-up, and special commands inside the configuration files detect whether the shell is interactive or a login shell."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 5, "last_activity_date": 1504881676, "creation_date": 1504881676, "answer_id": 46119030, "question_id": 46116329, "link": "https://stackoverflow.com/questions/46116329/change-shell-used-to-run-shell-commands-in-ghci/46119030#46119030", "title": "Change shell used to run &quot;shell commands&quot; in GHCi", "body": "<p>The <a href=\"https://github.com/ghc/ghc/blob/22733532171330136d87533d523f565f2a4f102f/ghc/GHCi/UI.hs#L1205\" rel=\"noreferrer\"><code>:!</code> command in current versions of ghci</a> is a call to <a href=\"http://hackage.haskell.org/package/process-1.6.1.0/docs/System-Process.html#v:system\" rel=\"noreferrer\"><code>System.Process.system</code></a></p>\n\n<pre><code>-- | Entry point for execution a ':&lt;command&gt;' input from user\nspecialCommand :: String -&gt; InputT GHCi Bool\nspecialCommand ('!':str) = lift $ shellEscape (dropWhile isSpace str)\n-- [...]\n\nshellEscape :: String -&gt; GHCi Bool\nshellEscape str = liftIO (system str &gt;&gt; return False)\n</code></pre>\n\n<p>I suspect <code>system</code> is hardcoded to <code>/bin/sh</code>, but there's no reason you can't <a href=\"https://downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/ghci-commands.html#id3041426\" rel=\"noreferrer\">define your own ghci command</a> to do <code>fish</code> calls. I don't have <code>fish</code> installed, so I'll use <code>bash</code> as an example:</p>\n\n<pre><code>\u03bb import System.Process (rawSystem)\n\u03bb :def bash \\cmd -&gt; rawSystem \"/bin/bash\" [\"-c\", cmd] &gt;&gt; return \"\"\n\u03bb :bash echo $0\n/bin/bash\n</code></pre>\n"}], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 645, "favorite_count": 1, "accepted_answer_id": 46119030, "answer_count": 1, "score": 5, "last_activity_date": 1504881676, "creation_date": 1504872939, "last_edit_date": 1504874900, "question_id": 46116329, "link": "https://stackoverflow.com/questions/46116329/change-shell-used-to-run-shell-commands-in-ghci", "title": "Change shell used to run &quot;shell commands&quot; in GHCi", "body": "<p>In GHCi, a shell command can be executed using <code>:!&lt;command&gt;</code>. By default, it seems that the <code>sh</code> shell is used:</p>\n\n<pre><code>Prelude&gt; :!echo $0\n/bin/sh\n</code></pre>\n\n<p>I have a number of aliases and custom functions defined for the shell I use generally on my system (<code>fish</code>), and I'd like to use these from GHCi but not have to translate them into <code>sh</code>-compatible versions.</p>\n\n<p>Is there a way of changing the shell GHCi uses to execute <code>:!</code> commands? I haven't been able to find any <code>:set</code> options for this, nor any command-line arguments to GHCi to do this.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 1, "creation_date": 1504873149, "post_id": 46116321, "comment_id": 79194812, "body": "Winhugs is obsolete. Please consider using a more modern compiler, GHC, and for a more well-rounded experience, you could use <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">Stack</a>"}, {"owner": {"reputation": 103, "user_id": 8579872, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8a4ad5849904707098111a9d61109bb1?s=128&d=identicon&r=PG&f=1", "display_name": "Mel", "link": "https://stackoverflow.com/users/8579872/mel"}, "reply_to_user": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 0, "creation_date": 1504874068, "post_id": 46116321, "comment_id": 79195432, "body": "i would but it&#39;s the compiler that we&#39;re being taught to use in school :("}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1504875986, "post_id": 46116321, "comment_id": 79196638, "body": "@Mel that may be, but here you&#39;re clearly straying into territory that&#39;s not covered by school curriculum, and may quite possibly not be doable with Hugs at all. In fact it&#39;s debatable whether it makes any <i>sense</i> to do it, still... you <i>should</i> use GHC, and nobody at school can seriously mind you doing that. They just probably think Hugs is easier."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1504879260, "post_id": 46116321, "comment_id": 79198892, "body": "This is more like a domain-specific language (DSL) than a function."}], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 8579872, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8a4ad5849904707098111a9d61109bb1?s=128&d=identicon&r=PG&f=1", "display_name": "Mel", "link": "https://stackoverflow.com/users/8579872/mel"}, "edited": false, "score": 0, "creation_date": 1504877667, "post_id": 46117221, "comment_id": 79197737, "body": "Hi! thank you for your response!  &quot;What&#39;s wrong with cookies 1 + chocolate 2&quot; My professor&#39;s very specific about stuff and he wants us to do cookies 1 chocolate 2 instead :(  i tried what you typed out but hugs unfortunately does not support that extension. Thank you for trying to help!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 103, "user_id": 8579872, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8a4ad5849904707098111a9d61109bb1?s=128&d=identicon&r=PG&f=1", "display_name": "Mel", "link": "https://stackoverflow.com/users/8579872/mel"}, "edited": false, "score": 2, "creation_date": 1504878521, "post_id": 46117221, "comment_id": 79198370, "body": "Ugh. That&#39;s an absurd requirement! But well, now you have one crippled solution that allows the exact syntax <code>cookies 1 chocolate 1</code> (but nothing else) and also works in Hugs, and one ridiculous typeclass-hackery solution that allows anything of the form <code>crumble a crumble b ... crumble \u03c9</code>. Let them choose..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 103, "user_id": 8579872, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8a4ad5849904707098111a9d61109bb1?s=128&d=identicon&r=PG&f=1", "display_name": "Mel", "link": "https://stackoverflow.com/users/8579872/mel"}, "edited": false, "score": 2, "creation_date": 1504878551, "post_id": 46117221, "comment_id": 79198393, "body": "@Mel That looks as a very unusual requirement. Double check the assignment, since it seems unreasonable to require that <code>cookies 1 chacolate 2</code> works. Maybe the professor forgot the <code>+</code>? If possible I&#39;d write to the professor and ask to confirm that. From a teaching point of view, it seems a very pointless exercise, since its solution requires to abuse the typeclass machinery, which is not something that should be taught."}, {"owner": {"reputation": 103, "user_id": 8579872, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8a4ad5849904707098111a9d61109bb1?s=128&d=identicon&r=PG&f=1", "display_name": "Mel", "link": "https://stackoverflow.com/users/8579872/mel"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1504879971, "post_id": 46117221, "comment_id": 79199403, "body": "@chi yeah i checked again and that&#39;s what he&#39;s requiring. i dont think it&#39;s a mistake since he gave 5 examples. All of which had no operator"}, {"owner": {"reputation": 103, "user_id": 8579872, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8a4ad5849904707098111a9d61109bb1?s=128&d=identicon&r=PG&f=1", "display_name": "Mel", "link": "https://stackoverflow.com/users/8579872/mel"}, "edited": false, "score": 0, "creation_date": 1504880089, "post_id": 46117221, "comment_id": 79199476, "body": "@leftaroundabout: exactly what i thought :( oh well thank you so much for your help!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 103, "user_id": 8579872, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8a4ad5849904707098111a9d61109bb1?s=128&d=identicon&r=PG&f=1", "display_name": "Mel", "link": "https://stackoverflow.com/users/8579872/mel"}, "edited": false, "score": 8, "creation_date": 1504886772, "post_id": 46117221, "comment_id": 79203620, "body": "@Mel Are you sure your professor is asking for the <i>Haskell term</i> <code>cookies 1 chocolate 2</code> to work, and not asking you to write a program which accepts <code>cookies 1 chocolate 2</code> as input? The latter is significantly easier (and significantly closer to the kind of assignment I could imagine giving to beginners)."}, {"owner": {"reputation": 103, "user_id": 8579872, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8a4ad5849904707098111a9d61109bb1?s=128&d=identicon&r=PG&f=1", "display_name": "Mel", "link": "https://stackoverflow.com/users/8579872/mel"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1504889374, "post_id": 46117221, "comment_id": 79204946, "body": "@DanielWagner that is actually what I was trying to ask here so I guess I might&#39;ve worded things out wrong. He&#39;s asking us to input something like <code>cookies 1 chocolate 2</code> which should give a result of 20. I got to &#39;partially&#39; do it as stated above but I dont exactly know how else to go around it"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 6, "last_activity_date": 1504876334, "last_edit_date": 1504876334, "creation_date": 1504875868, "answer_id": 46117221, "question_id": 46116321, "link": "https://stackoverflow.com/questions/46116321/how-can-i-add-without-having-to-use-an-arithmetic-operator-in-haskell/46117221#46117221", "title": "How can I add without having to use an arithmetic operator in Haskell?", "body": "<p>I don't understand why you want all of this. What you're trying to implement is called <a href=\"https://en.wikipedia.org/wiki/Variadic_function\" rel=\"noreferrer\">variadic function</a>. Haskell doesn't really support these, and I really don't believe it makes sense to use them for your application. What's wrong with <code>cookies 1 + chocolate 2</code>?</p>\n\n<p>That said, the Haskell2010 / GHC-Haskell type system is sufficiently flexible to allow hacking together variadic functions:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, FlexibleInstances #-}\n\nclass Crumbles c where\n  crumble :: Int -&gt; c\ninstance Crumbles Int where\n  crumble = id\ninstance (f ~ (Int -&gt; Int), i ~ Int, Crumbles c) =&gt; Crumbles (f -&gt; i -&gt; c) where\n  crumble acc f i = crumble $ f i + acc\n</code></pre>\n\n<p>Now you can do</p>\n\n<pre><code>cookies :: Crumbles c =&gt; Int -&gt; c\ncookies n = crumble $ n*10\n\nchocolate :: Crumbles c =&gt; Int -&gt; c\nchocolate n = crumble $ n*5\n\ngoodies :: [Int]\ngoodies = [ cookies 1  -- 10\n          , cookies 1 chocolate 1   -- 15\n          , cookies 1 chocolate 1 cookies 100000  -- 1000015\n          ]\n\nmain :: IO ()\nmain = print goodies\n</code></pre>\n\n<p>...giving <code>[10,15,1000015]</code>.</p>\n\n<p>I don't know if Hugs supports the <code>TypeFamilies</code> extension that's needed for the equational constraints <code>f ~ (Int -&gt; Int)</code> and <code>i ~ Int</code>.</p>\n\n<hr>\n\n<p>What I suspect the <strong>task</strong> is going for is something entirely different, namely, how to <em>implement</em> <code>cookies :: Int -&gt; Int</code> without using either addition nor multiplication, i.e. without writing <code>*10</code> nor <code>10 + cookies (n-1)</code>. The answer they probably want should use only the <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Prelude.html#v:succ\" rel=\"noreferrer\"><code>succ</code></a> and <code>pred</code> functions (which are equivalent to <code>+1</code> and <code>-1</code>, respectively).</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1504892370, "creation_date": 1504892370, "answer_id": 46121910, "question_id": 46116321, "link": "https://stackoverflow.com/questions/46116321/how-can-i-add-without-having-to-use-an-arithmetic-operator-in-haskell/46121910#46121910", "title": "How can I add without having to use an arithmetic operator in Haskell?", "body": "<p>Don't try to write functions named <code>cookies</code> and <code>chocolate</code> which, when typed into the hugs interpreter, behave that way.</p>\n\n<p>Instead, try to write an <code>IO</code> action which accepts input, parses it, and does the appropriate computation. You may like the <code>interact</code> function, which takes a function on <code>String</code>s and runs it on things the user types:</p>\n\n<pre><code>interact :: (String -&gt; String) -&gt; IO ()\n</code></pre>\n\n<p>For example, with runhaskell (which is very similar to hugs), the following code:</p>\n\n<pre><code>main = interact $ \\s -&gt;\n    \"What is your name?\\n\" ++\n    filter (/='\\n') s ++ \", nice to meet you!\\n\"\n</code></pre>\n\n<p>produces the following interaction:</p>\n\n<pre><code>% runhaskell test.hs\nWhat is your name?\nDaniel\nDaniel, nice to meet you!\n</code></pre>\n\n<p>Note that I pressed the EOF button after typing <code>Daniel</code> and pressing enter; on Linux this is ctrl-d but I believe on Windows it is ctrl-z. Note also that nowhere in the code is there a definition for <code>Daniel</code> -- this <code>Daniel</code> that I typed in is <em>not</em> a Haskell term, but rather is input read by running the Haskell term <code>main</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 1, "last_activity_date": 1504972830, "creation_date": 1504972830, "answer_id": 46132485, "question_id": 46116321, "link": "https://stackoverflow.com/questions/46116321/how-can-i-add-without-having-to-use-an-arithmetic-operator-in-haskell/46132485#46132485", "title": "How can I add without having to use an arithmetic operator in Haskell?", "body": "<p>Like Daniel Wagner, I suspect this question is misguided. I find it hard to believe that the assignment is asking for functions <code>cookies</code> and <code>chocolate</code> that can be combined in this way. Rather, it\u2019s probably asking for a function <code>calculate :: String -&gt; Int</code> which accepts the <em>string</em> <code>\"cookies 1 chocolate 2\"</code>, parses it, and returns the result.</p>\n\n<p>For that, a solution is pretty simple\u2014so I won\u2019t give it away. Break the problem down into small steps like these:</p>\n\n<ul>\n<li><p><code>\"cookies 1 chocolate 2\"</code></p></li>\n<li><p><code>[\"cookies\", \"1\", \"chocolate\", \"2\"]</code></p></li>\n<li><p><code>[(\"cookies\", 1), (\"chocolate\", 2)]</code></p></li>\n<li><p><code>[10, 10]</code></p></li>\n<li><p><code>20</code></p></li>\n</ul>\n\n<p>Write a function for each step, and a <code>main</code> that asks for input and calls these functions to calculate the final result. Bonus points if you consider how to use <code>Maybe</code> or <code>Either</code> to handle errors in the input, such as an unknown item, a non-numeric quantity, a missing quantity, &amp;c.</p>\n"}], "owner": {"reputation": 103, "user_id": 8579872, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8a4ad5849904707098111a9d61109bb1?s=128&d=identicon&r=PG&f=1", "display_name": "Mel", "link": "https://stackoverflow.com/users/8579872/mel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1504972830, "creation_date": 1504872912, "last_edit_date": 1592644375, "question_id": 46116321, "link": "https://stackoverflow.com/questions/46116321/how-can-i-add-without-having-to-use-an-arithmetic-operator-in-haskell", "title": "How can I add without having to use an arithmetic operator in Haskell?", "body": "<p>I'm new to Haskell and I'm trying to figure out how to add without having to use the '+' sign. I'm using Winhugs as a compiler.</p>\n<p>Let's say,\ncookies = 10, chocolate = 5, cake = 20</p>\n<p>if I enter,</p>\n<blockquote>\n<p>cookies 1 chocolate 1</p>\n</blockquote>\n<p>output should be,</p>\n<blockquote>\n<p>15</p>\n</blockquote>\n<p>here's what I have</p>\n<pre><code>cookies :: Int -&gt; Int\ncookies 1 = 10\ncookies n = 10 + cookies (n-1)\n\nchocolate :: Int -&gt; Int\nchocolate 1 = 5\nchocolate n = 5 + chocolate (n-1)\n</code></pre>\n<p>i have to enter,</p>\n<blockquote>\n<p>cookies 1 + chocolate 1</p>\n</blockquote>\n<p>in order to get 15. Is there another way around this?</p>\n<p>I also tried using recursive types but I still find it very confusing. I tried this one too but I can only add two items and I'd always have to input cookies:</p>\n<pre><code>cookies ::  Int -&gt; (Int -&gt; Int) -&gt; Int -&gt; Int \ncookies x item y = (x * 20) + item y\n\ncake :: Int -&gt; Int\ncake 1 = 20\ncake n = 20 + cake (n-1)\n\nchocolate :: Int -&gt; Int\nchocolate 1 = 5\nchocolate n = 5 + chocolate (n-1)\n</code></pre>\n<p>also, I cannot enter just cookies as it should always have another item with it.</p>\n<blockquote>\n<p>cookies 1</p>\n<p>ERROR - Cannot find &quot;show&quot; function for:</p>\n<p>*** Expression : cookies 1</p>\n<p>*** Of type    : (Int -&gt; Int) -&gt; Int -&gt; Int</p>\n</blockquote>\n<p>I'm sorry for the very noob question. Thank you to everyone who can help!</p>\n<p>** UPDATE **\nI know I could use a different compiler but it's what's being taught in school and it's the compiler we need to use for our project as well :(</p>\n"}, {"tags": ["haskell", "monads", "lenses"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1504867092, "post_id": 46112354, "comment_id": 79191066, "body": "You can get rid of the edit, sorry, I missed that you&#39;ve used <code>Control.Monad.Trans.State (StateT,put,get)</code>, not <code>Control.Monad.State (StateT,put,get)</code>."}, {"owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1504872131, "post_id": 46112354, "comment_id": 79194122, "body": "@Zeta I have removed the example of the edit."}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1504863931, "post_id": 46113439, "comment_id": 79189096, "body": "@Daniel thanks for the edit, unfortunately you killed some part of the answer ^^&quot;."}, {"owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1504864031, "post_id": 46113439, "comment_id": 79189161, "body": "sorry, maybe we just posted at the same time. My apologies :/"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "edited": false, "score": 0, "creation_date": 1504864099, "post_id": 46113439, "comment_id": 79189206, "body": "No worries, <a href=\"https://stackoverflow.com/posts/46113439/revisions\">that&#39;s what revisions are for</a>. I completely missed the bad formatting"}, {"owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "edited": false, "score": 0, "creation_date": 1504864751, "post_id": 46113439, "comment_id": 79189615, "body": "@Zeta Thanks, I updated my example. I like to assign the new value of course <i>blush</i>. I tried to use your suggested solution in my example, but it results in compile time errors (see edit 2)."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "edited": false, "score": 1, "creation_date": 1504865514, "post_id": 46113439, "comment_id": 79190095, "body": "@maiermic I threw away the <code>Lens</code> part, since I have to check it more thoroughly. But the other error stems from a missing <code>lift</code> in <code>action</code>. If you like the <code>&gt;&gt;=</code> style you can use <code>use l &gt;&gt;= f &gt;&gt;= assign l</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "edited": false, "score": 1, "creation_date": 1504866059, "post_id": 46113439, "comment_id": 79190395, "body": "@maiermic you&#39;ve used <code>Control.Monad.Trans.State.Lazy</code>, where I used <code>Control.Monad.State.Lazy</code>. The former has <code>put</code> and <code>get</code> variants that only work on <code>StateT</code>, whereas the latter uses <code>MonadState</code>."}, {"owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "edited": false, "score": 0, "creation_date": 1504870437, "post_id": 46113439, "comment_id": 79192995, "body": "@Zeta Thanks, is it possible to do <code>lift</code> in <code>modifyingM</code> so that I don&#39;t have to use <code>lift</code> in <code>action</code>?"}, {"owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "edited": false, "score": 0, "creation_date": 1504871710, "post_id": 46113439, "comment_id": 79193828, "body": "Just figured it out. The type is <code>modifyingM :: Monad m =&gt; Lens&#39; s a -&gt; (a -&gt; m a) -&gt; StateT s m ()</code> and a possible implementation is <code>modifyingM l f = use l &gt;&gt;= lift . f &gt;&gt;= assign l</code>. I misunderstood <code>MonadState</code> and got further confused by using the wrong modules before."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "edited": false, "score": 0, "creation_date": 1504873498, "post_id": 46113439, "comment_id": 79195057, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/153953/discussion-between-zeta-and-maiermic\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 7, "last_activity_date": 1504866865, "last_edit_date": 1504866865, "creation_date": 1504863810, "answer_id": 46113439, "question_id": 46112354, "link": "https://stackoverflow.com/questions/46112354/modify-state-using-a-monadic-function-with-lenses/46113439#46113439", "title": "Modify state using a monadic function with lenses", "body": "<p>You're using <code>use</code> on a <code>ASetter</code>, but <code>use</code> takes a <code>Getter</code>:</p>\n\n<pre><code>use  :: MonadState s m =&gt; Getting a s a        -&gt; m a \n(.=) :: MonadState s m =&gt; ASetter s s a b -&gt; b -&gt; m ()\n</code></pre>\n\n<p>Unfortunately, <code>ASetter</code> and <code>Getting</code> are not the same:</p>\n\n<pre><code>type Getting r s a   = (a -&gt; Const r a ) -&gt; s -&gt; Const r s \ntype ASetter s t a b = (a -&gt; Identity b) -&gt; s -&gt; Identity t \n</code></pre>\n\n<p>We need to switch between <code>Const</code> and <code>Identity</code> arbitrarily. We need a <code>Lens</code>:</p>\n\n<pre><code>type Lens s t a b = forall f. Functor f =&gt; (a -&gt; f b) -&gt; s -&gt; f t\n</code></pre>\n\n<p>Note that there is no <code>f</code> on the left-hand side. Next, we note that your <code>lift</code> is not necessary. After all, <code>f</code> already works in our target monad <code>m</code>; you had to use <code>lift</code> previously because <code>modifyObjects</code> was in <code>IO</code> and <code>action</code> was in <code>StateT Game IO</code>, but here we just have a single <code>m</code>:</p>\n\n<pre><code>modifyingM :: MonadState s m =&gt; Lens s s a a -&gt; (a -&gt; m b) -&gt; m ()\nmodifyingM l f = do\n  old &lt;- use l\n  new &lt;- f old\n  l .= old\n</code></pre>\n\n<p>That works! But it's likely wrong, since you probably want to set the <em>new</em> value in <code>l .= old</code>. If that's the case, we have to make sure that <code>old</code> and <code>new</code> have the same type:</p>\n\n<pre><code>--                                      only a here, no b\n--                                       v v     v      v\nmodifyingM :: MonadState s m =&gt; Lens s s a a -&gt; (a -&gt; m a) -&gt; m ()\nmodifyingM l f = do\n  old &lt;- use l\n  new &lt;- f old\n  l .= new\n</code></pre>\n\n<p>Keep in mind that you need to <code>lift</code> <code>modifyObjects</code> though:</p>\n\n<pre><code>action :: StateT Game IO ()\naction = modifyingM objects (lift . modifyObjects)\n</code></pre>\n\n<hr>\n\n<p>We could stop here, but just for some fun, let us have a look again at Lens:</p>\n\n<pre><code>type Lens s t a b = forall f. Functor f =&gt; (a -&gt; f b) -&gt; s -&gt; f t\n</code></pre>\n\n<p>For any <code>a -&gt; f b</code> you give me, I'll give you a new <code>s -&gt; f t</code>. So if we just plug something in your objects, we have</p>\n\n<pre><code>&gt; :t \\f -&gt; objects f\n\\f -&gt; objects f\n  :: Functor f =&gt; (GameObject -&gt; f GameObject) -&gt; Game -&gt; f Game\n</code></pre>\n\n<p>Therefore, we just need some <code>MonadState s m =&gt; (s -&gt; m s) -&gt; m ()</code> function, but that's easy to achieve:</p>\n\n<pre><code>import Control.Monad.State.Lazy (get, put) -- not the Trans variant!\n\nmodifyM :: MonadState s m =&gt; (s -&gt; m s) -&gt; m ()\nmodifyM f = get &gt;&gt;= f &gt;&gt;= put\n</code></pre>\n\n<p>Note that you need to use <code>Control.Monad.State</code> from <code>mtl</code> instead of <code>Control.Monad.Trans.State</code>. The latter only defines <code>put :: Monad m =&gt; s -&gt; StateT s m ()</code> and <code>get :: Monad m =&gt; StateT s m s</code>, but you want to use the <code>MonadState</code> variant from <code>mtl</code>.</p>\n\n<p>If we put all things together, we see that <code>modifyingM</code> can be written as:</p>\n\n<pre><code>modifyingM :: MonadState s m =&gt; Lens s s a a -&gt; (a -&gt; m a) -&gt; m ()\nmodifyingM l f = modifyM (l f)\n</code></pre>\n\n<p>Alternatively, we use the can use the lens functions, although that does not give us the insight that we can use <code>l f</code>:</p>\n\n<pre><code>modifyingM :: MonadState s m =&gt; Lens s s a a -&gt; (a -&gt; m a) -&gt; m ()\nmodifyingM l f = use l &gt;&gt;= f &gt;&gt;= assign l\n</code></pre>\n"}], "owner": {"reputation": 3780, "user_id": 1065654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/74bd400c23607114d9ff560ce1b7391c?s=128&d=identicon&r=PG", "display_name": "maiermic", "link": "https://stackoverflow.com/users/1065654/maiermic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 675, "favorite_count": 0, "accepted_answer_id": 46113439, "answer_count": 1, "score": 2, "last_activity_date": 1504871940, "creation_date": 1504860412, "last_edit_date": 1504871940, "question_id": 46112354, "link": "https://stackoverflow.com/questions/46112354/modify-state-using-a-monadic-function-with-lenses", "title": "Modify state using a monadic function with lenses", "body": "<p>My question is quite similar to <a href=\"https://stackoverflow.com/questions/22209982/how-to-modify-using-a-monadic-function-with-lenses\">How to modify using a monadic function with lenses?</a> The author asked if something like this exists</p>\n\n<pre><code>overM :: (Monad m) =&gt; Lens s t a b -&gt; (a -&gt; m b) -&gt; s -&gt; m t\n</code></pre>\n\n<p>The answer was <a href=\"https://www.stackage.org/haddock/lts-9.3/lens-4.15.4/Control-Lens-Traversal.html#v:mapMOf\" rel=\"nofollow noreferrer\">mapMOf</a></p>\n\n<pre><code>mapMOf :: Profunctor p =&gt;\n     Over p (WrappedMonad m) s t a b -&gt; p a (m b) -&gt; s -&gt; m t\n</code></pre>\n\n<p>I'm trying to implement a function that modifies state in <code>MonadState</code> using a monadic function:</p>\n\n<pre><code>modifyingM :: MonadState s m =&gt; ASetter s s a b -&gt; (a -&gt; m b) -&gt; m ()\n</code></pre>\n\n<p>Example without <code>modifingM</code>:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nmodule Main where\n\nimport Control.Lens (makeLenses, use, (.=))\nimport Control.Monad.Trans.Class (lift)\nimport Control.Monad.Trans.State.Lazy (StateT(StateT), execStateT)\n\ndata GameObject = GameObject\n  { _num :: Int\n  } deriving (Show)\n\ndata Game = Game\n  { _objects :: [GameObject]\n  } deriving (Show)\n\nmakeLenses ''Game\n\nmakeLenses ''GameObject\n\ndefaultGame = Game {_objects = map GameObject [0 .. 3]}\n\naction :: StateT Game IO ()\naction = do\n  old &lt;- use objects\n  new &lt;- lift $ modifyObjects old\n  objects .= new\n\nmodifyObjects :: [GameObject] -&gt; IO [GameObject]\nmodifyObjects objs = return objs -- do modifications\n\nmain :: IO ()\nmain = do\n  execStateT action defaultGame\n  return ()\n</code></pre>\n\n<p>This example works. Now I'd like to extract the code from <code>action</code> to a generic solution <code>modifingM</code>:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nmodule Main where\n\nimport Control.Lens (makeLenses, use, (.=), ASetter)\nimport Control.Monad.State.Class (MonadState)\nimport Control.Monad.Trans.Class (lift)\nimport Control.Monad.Trans.State.Lazy (StateT(StateT), execStateT)\n\ndata GameObject = GameObject\n  { _num :: Int\n  } deriving (Show)\n\ndata Game = Game\n  { _objects :: [GameObject]\n  } deriving (Show)\n\nmakeLenses ''Game\n\nmakeLenses ''GameObject\n\ndefaultGame = Game {_objects = map GameObject [0 .. 3]}\n\nmodifyingM :: MonadState s m =&gt; ASetter s s a b -&gt; (a -&gt; m b) -&gt; m ()\nmodifyingM l f = do\n  old &lt;- use l\n  new &lt;- lift $ f old\n  l .= new\n\naction :: StateT Game IO ()\naction = modifyingM objects modifyObjects\n\nmodifyObjects :: [GameObject] -&gt; IO [GameObject]\nmodifyObjects objs = return objs -- do modifications\n\nmain :: IO ()\nmain = do\n  execStateT action defaultGame\n  return ()\n</code></pre>\n\n<p>This results in compile time errors:</p>\n\n<pre><code>Main.hs:26:14: error:\n    \u2022 Couldn't match type \u2018Data.Functor.Identity.Identity s\u2019\n                     with \u2018Data.Functor.Const.Const a s\u2019\n      Expected type: Control.Lens.Getter.Getting a s a\n        Actual type: ASetter s s a b\n    \u2022 In the first argument of \u2018use\u2019, namely \u2018l\u2019\n      In a stmt of a 'do' block: old &lt;- use l\n      In the expression:\n        do { old &lt;- use l;\n             new &lt;- lift $ f old;\n             l .= new }\n    \u2022 Relevant bindings include\n        f :: a -&gt; m b (bound at app/Main.hs:25:14)\n        l :: ASetter s s a b (bound at app/Main.hs:25:12)\n        modifyingM :: ASetter s s a b -&gt; (a -&gt; m b) -&gt; m ()\n          (bound at app/Main.hs:25:1)\n\nMain.hs:31:10: error:\n    \u2022 Couldn't match type \u2018IO\u2019 with \u2018StateT Game IO\u2019\n      Expected type: StateT Game IO ()\n        Actual type: IO ()\n    \u2022 In the expression: modifyingM objects modifyObjects\n      In an equation for \u2018action\u2019:\n          action = modifyingM objects modifyObjects\n</code></pre>\n\n<p>What's the problem?</p>\n\n<hr>\n\n<p><strong>Edit 1:</strong> Assign <code>new</code> instead of <code>old</code> value.</p>\n\n<p><strong>Edit 2:</strong> Added example with solution of @Zeta that does not compile.</p>\n\n<p><strong>Edit 3:</strong> Remove example of second edit. It didn't compile due to wrong imports (see <a href=\"https://stackoverflow.com/questions/46112354/modify-state-using-a-monadic-function-with-lenses/46113439#comment79190395_46113439\">comment</a>).</p>\n"}, {"tags": ["haskell", "servant", "stackage"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1504858324, "post_id": 46110753, "comment_id": 79185724, "body": "Did you read the <a href=\"https://www.stackage.org/lts-8.6/package/servant-0.9.1.1\" rel=\"nofollow noreferrer\">changelogs of your packages</a>?"}], "owner": {"reputation": 375, "user_id": 5287908, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/w0QJd.png?s=128&g=1", "display_name": "QSpider", "link": "https://stackoverflow.com/users/5287908/qspider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1504858797, "creation_date": 1504855051, "last_edit_date": 1504858797, "question_id": 46110753, "link": "https://stackoverflow.com/questions/46110753/migration-in-haskell-from-stack-lts-8-6-to-lts-9-3", "title": "Migration in Haskell from stack lts-8.6 to lts-9.3", "body": "<p>I used the stack lts-8.6 in my Haskell project. Below is my code that is compiled correctly with lts-8.6:</p>\n\n<pre><code>type AppM = ReaderT App (ExceptT ServantErr IO) \n\ntype ServletAPI = ResourcesAPI\n             :&lt;|&gt; MapTitleAPI\n\nserver :: ServerT ServletAPI AppM\nserver = serverResourcesAPI\n    :&lt;|&gt; serverMapTitleAPI\n\ntype API = ServletAPI \n      :&lt;|&gt; Raw\n\nrunWebServerNibes :: App \n                  -&gt; IO ()\nrunWebServerNibes app = do \n    run (app_portServer . app_serverHTTP . appSettings $ app) $ appNubes app\n\nappNubes :: App -&gt; Application\nappNubes app = serve api (readerServer app)\n\nreaderServer :: App -&gt; Server API\nreaderServer app = enter (readerToExcept app) server\n                    :&lt;|&gt; serveDirectory (app_pathFolderStatic . app_serverHTTP . appSettings $ app)\n\nreaderToExcept :: App -&gt; AppM :~&gt; ExceptT ServantErr IO\nreaderToExcept app = Nat $ \\x -&gt; runReaderT x app\n\napi :: Proxy API\napi = Proxy\n</code></pre>\n\n<p>For lts-9.3, I replaced <code>Nat</code> by <code>NT</code>.\nBut when I use lts-9.3, I get an error:</p>\n\n<pre><code> \u2022 Couldn't match type \u2018ImportWSN.Handler\u2019\n                     with \u2018ExceptT ServantErr IO\u2019\n        arising from a functional dependency between:\n          constraint \u2018Servant.Utils.Enter.Enter\n                        (ReaderT App IO Data.Text.Internal.Text)\n                        (ReaderT App IO)\n                        (ExceptT ServantErr IO)\n                        (ImportWSN.Handler Data.Text.Internal.Text)\u2019\n            arising from a use of \u2018enter\u2019\n          instance \u2018Servant.Utils.Enter.Enter (m a) m n (n a)\u2019\n            at &lt;no location info&gt;\n    \u2022 In the first argument of \u2018(:&lt;|&gt;)\u2019, namely\n        \u2018enter (readerToExcept app) server\u2019\n      In the expression:\n        enter (readerToExcept app) server\n        :&lt;|&gt;\n          serveDirectory\n            (app_pathFolderStatic . app_serverHTTP . appSettings $ app)\n      In an equation for \u2018readerServer\u2019:\n          readerServer app\n            = enter (readerToExcept app) server\n              :&lt;|&gt;\n                serveDirectory\n                  (app_pathFolderStatic . app_serverHTTP . appSettings $ app)\n</code></pre>\n\n<p>and</p>\n\n<pre><code> \u2022 Couldn't match type \u2018IO\u2019 with \u2018ExceptT ServantErr IO\u2019\n      Expected type: ReaderT App (ExceptT ServantErr IO) x\n        Actual type: AppM x\n    \u2022 In the first argument of \u2018runReaderT\u2019, namely \u2018x\u2019\n      In the expression: runReaderT x app\n      In the second argument of \u2018($)\u2019, namely \u2018\\ x -&gt; runReaderT x app\u2019\n</code></pre>\n\n<p>I can not understand what changes to make to my code, so that it becomes a worker!</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "edited": false, "score": 0, "creation_date": 1504931815, "post_id": 46111283, "comment_id": 79216719, "body": "So three styles to write control process: (*&gt;) sequence actions, do notations, and lambdaCase. And &quot;Nothing&quot; can stop the process. Good to learn! Thank you for advice."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1504856836, "creation_date": 1504856836, "answer_id": 46111283, "question_id": 46110171, "link": "https://stackoverflow.com/questions/46110171/haskell-function-composition-on-maybe/46111283#46111283", "title": "Haskell function composition on Maybe", "body": "<p>The code is written in a confusing manner. <code>fmap (const xyz)</code> basically abuses <code>Maybe a</code> as a bool switch: if it's <code>Just _\u1d21\u029c\u1d00\u1d1b\u1d07\u1d20\u1d07\u0280</code>, the result will be <code>Just xyz</code>, while a <code>Nothing</code> is simply passed on. Such a nothing can come straight from <code>listToMaybe</code> in case of an empty list, that's how this composition can yield <code>Nothing</code>.</p>\n\n<p>The preferred style of writing all this would be</p>\n\n<pre><code>unfoldr (\\b -&gt; listToMaybe b *&gt; Just (second (drop 1) (break (==' ') b)))\n</code></pre>\n\n<p>or indeed with good old old <code>do</code> notation</p>\n\n<pre><code>unfoldr $ \\b -&gt; do\n    listToMaybe b\n    return . second (drop 1) $ break (==' ') b\n</code></pre>\n\n<p>But really, an explicit pattern match would be much clearer:</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\nunfoldr $ \\case\n   [] -&gt; Nothing\n   b -&gt; Just . second (drop 1) $ break (==' ') b\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "edited": false, "score": 0, "creation_date": 1504931075, "post_id": 46111298, "comment_id": 79216619, "body": "Oh! So &quot;listToMaybe b&quot; is just an argument for fmap in order to decide cases. And according to purity, it doesn&#39;t matter to do listToMaybe inside or outside fmap. Great to know! Thank you for your response."}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 3, "last_activity_date": 1504856880, "creation_date": 1504856880, "answer_id": 46111298, "question_id": 46110171, "link": "https://stackoverflow.com/questions/46110171/haskell-function-composition-on-maybe/46111298#46111298", "title": "Haskell function composition on Maybe", "body": "<p>The type of <code>(const . (second $ drop 1) . break (==' '))</code> is <code>[Char] -&gt; b -&gt; ([Char], [Char])</code></p>\n\n<p>This sophisticated function just takes a string (for example <code>\"one two three\"</code>) and any argument and returns <code>(\"one\", \"two three\")</code>.</p>\n\n<p>Therefore, <code>(const . (second $ drop 1) . break (==' ')) $ \"one two three\"</code> takes any argument and returns <code>(\"one\", \"two three\")</code>.</p>\n\n<p><code>fmap (const . (second $ drop 1) . break (==' ') $ b) . listToMaybe $ b\n</code></p>\n\n<p>is the same as</p>\n\n<p><code>fmap (const . (second $ drop 1) . break (==' ') $ b) $ listToMaybe b</code></p>\n\n<p>e.g. the function is <code>fmapped</code> to a <code>Maybe</code> value, but the definition of <code>fmap</code> for <code>Maybe</code> instance is:</p>\n\n<pre><code>instance  Functor Maybe  where\n    fmap _ Nothing       = Nothing\n    fmap f (Just a)      = Just (f a)\n</code></pre>\n\n<p>which means that <code>fmap</code> returns <code>Nothing</code> if <code>a</code> in <code>fmap f a</code> is <code>Nothing</code>.</p>\n\n<p><code>listToMaybe</code> returns <code>Just</code> first element of a list, or <code>Nothing</code> if the list is empty. That's why</p>\n\n<p><code>fmap (const . (second $ drop 1) . break (==' ') $ b) $ listToMaybe b\n</code></p>\n\n<p>will return <code>Nothing</code>, when <code>b</code> is an empty list.</p>\n"}], "owner": {"reputation": 521, "user_id": 7126380, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10207438513426512/picture?type=large", "display_name": "Johnny Liao", "link": "https://stackoverflow.com/users/7126380/johnny-liao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 587, "favorite_count": 0, "accepted_answer_id": 46111298, "answer_count": 2, "score": 1, "last_activity_date": 1504856880, "creation_date": 1504852964, "last_edit_date": 1504854301, "question_id": 46110171, "link": "https://stackoverflow.com/questions/46110171/haskell-function-composition-on-maybe", "title": "Haskell function composition on Maybe", "body": "<p>I was studying Haskell idioms from <a href=\"https://wiki.haskell.org/Blow_your_mind\" rel=\"nofollow noreferrer\">Blow Your Mind</a></p>\n\n<pre><code>-- split at whitespace\n-- \"hello world\" -&gt; [\"hello\",\"world\"]\n\nunfoldr (\\b -&gt; fmap (const . (second $ drop 1) . break (==' ') $ b) . listToMaybe $ b)\n</code></pre>\n\n<p>From what I know, unfoldr is supposed to be:</p>\n\n<pre><code>unfoldr :: (b -&gt; Maybe (a,b)) -&gt; b -&gt; [a]\nunfoldr f b = \ncase f b of\n  Just (a, new_b) -&gt; a : unfoldr f new_b\n  Nothing         -&gt; []\n</code></pre>\n\n<p>So f b must output Nothing at the end, right?</p>\n\n<p>So I tried to understand the f part, <code>fmap (const . (second $ drop 1) . break (==' ') $ b) . listToMaybe $ b)</code>.</p>\n\n<p>I get the idea of second, drop, break, listToMaybe. But I can't figure out why composing functions like this can output Nothing.</p>\n\n<p><code>Const</code> always ignore the second parameter. So why <code>fmap (const . (second $ drop1) . break (==' ') $ b) . listToMaybe $ b</code> can output Nothing in the end?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1504836056, "post_id": 46107517, "comment_id": 79177943, "body": "paste the code as text, and make sure you indent the code."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 2, "creation_date": 1504850476, "post_id": 46107517, "comment_id": 79181668, "body": "As a rule of thumb to help you decide what to look at when debugging problems in future: if you get a type error (&quot;cannot match expected type ... with actual type ...&quot;), it usually means that there is no issue with your <i>syntax</i>. In this example the problem had noting to do with guards or cases, you just used an operation that wasn&#39;t supported by your type. If you had a problem with the guard or case syntax Haskell wouldn&#39;t be able to figure out enough of what you were trying to do to even begin checking types."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 5, "creation_date": 1504837999, "post_id": 46107572, "comment_id": 79178354, "body": "Also, using floats for money is often dangerous. I&#39;d say just use an integer number of pennies."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 3, "last_activity_date": 1504836299, "creation_date": 1504836299, "answer_id": 46107572, "question_id": 46107517, "link": "https://stackoverflow.com/questions/46107517/how-to-use-an-integer-when-computing-a-float/46107572#46107572", "title": "How to use an Integer when computing a Float", "body": "<p><code>x</code> is an <code>Integer</code>, and you are multiplying it with decimal values to produce a <code>Float</code>. The operands and result of arithmetic operators like <code>(*)</code> must be of the same type, and you must convert between types explicitly.</p>\n\n<pre><code>totalPrice product y = case product of\n  Ramen\n    | x &lt;= 10 -&gt; 2 * x\n    ...\n  where\n    x = fromInteger y\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 8577573, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4d705845f7bd83371ff45b520ed4e6c?s=128&d=identicon&r=PG&f=1", "display_name": "OG1", "link": "https://stackoverflow.com/users/8577573/og1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1504870461, "creation_date": 1504835932, "last_edit_date": 1504870461, "question_id": 46107517, "link": "https://stackoverflow.com/questions/46107517/how-to-use-an-integer-when-computing-a-float", "title": "How to use an Integer when computing a Float", "body": "<pre><code>totalPrice :: Product -&gt; Integer -&gt; Float    \ntotalPrice product x = case product of  \n\n    Ramen    \n    | x &lt;= 10 -&gt; 2 * x    \n    | x &lt;= 30 -&gt; 1.8 * x   \n    | x &lt;= 100 -&gt; 1.5 * x   \n    | x &lt;= 200 -&gt; 1.4 * x   \n    | x &gt; 200 -&gt; 1.35 * x   \n    | otherwise -&gt; 0   \n\nChips\n    | x &lt;= 2 -&gt; 3 * x\n    | x &lt;= 5 -&gt; 2.95 * x\n    | x &lt;= 10 -&gt; 2.7 * x\n    | x &lt;= 20 -&gt; 2.5 * x\n    | x &gt; 20 -&gt; 2.35 * x\n    | otherwise -&gt; 0\n</code></pre>\n\n<p>When I compile this code it get error \"Couldn't match expected type \u2018Double\u2019 with actual type \u2018Integer\u2019\"</p>\n\n<p>Any suggestions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 4, "creation_date": 1504834125, "post_id": 46106980, "comment_id": 79177484, "body": "You are calling <code>filter</code> with a function that takes two arguments, but <code>filter</code> expects a function that wants only one argument. Where are you planning for the second argument to come from?"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1504841861, "last_edit_date": 1504841861, "creation_date": 1504841320, "answer_id": 46108168, "question_id": 46106980, "link": "https://stackoverflow.com/questions/46106980/haskell-error-using-tuples-and-list/46108168#46108168", "title": "Haskell- Error using Tuples and List", "body": "<p><code>puntosCircunferencia</code> takes three arguments: a radius <code>a</code>, a center <code>y</code>, and a list of points <code>z</code>. <code>auxPuntos</code> should test if a <em>single</em> given point is with a distance <code>a</code> of point <code>y</code>, and as such should only take a single argument.</p>\n\n<p>Below, I replace <code>y</code> with a pattern to match the components, as we need those in the definition of <code>auxPuntos</code>.</p>\n\n<pre><code>puntosEnCircunferencia a (x0, y0) zs = filter auxPuntos zs\n   where auxPuntos (x1, y1) = ((x1-x0)^2 + (y1-y0)^2) &lt; (a^2)\n</code></pre>\n\n<p>Another (possibly) clearer way to write this is to define a distance function as well.</p>\n\n<pre><code>puntosEnCircunferencia a y zs = filter auxPuntos zs\n    where auxPuntos p = squareDistance p y &lt; a^2\n          squareDistance (x0, y0) (x1, y1) = (x1 - x0)^2 + (y1 - y0)^2\n</code></pre>\n\n<p>(In either case, you can drop <code>zs</code> as an explicit argument:</p>\n\n<pre><code>puntosEnCircunferencia a y = filter auxPuntos\n  where ...\n</code></pre>\n\n<p>)</p>\n"}, {"tags": [], "owner": {"reputation": 87, "user_id": 8425653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KHyTe.png?s=128&g=1", "display_name": "Gober", "link": "https://stackoverflow.com/users/8425653/gober"}, "is_accepted": false, "score": 0, "last_activity_date": 1504843461, "creation_date": 1504843461, "answer_id": 46108448, "question_id": 46106980, "link": "https://stackoverflow.com/questions/46106980/haskell-error-using-tuples-and-list/46108448#46108448", "title": "Haskell- Error using Tuples and List", "body": "<p>The problem of your code is in the <strong>where</strong> pattern matching, the ghci tell us:</p>\n\n<pre><code>Expected type: (Float, Float) -&gt; Bool\n        Actual type: (Float, Float) -&gt; (Float, Float) -&gt; Bool\n</code></pre>\n\n<p>Now lets get back into your code, you have: </p>\n\n<pre><code>where auxPuntos (w,s) (k,r) = ((k - w)^2 + (r - s)^2) &lt; (a ^ 2)\n</code></pre>\n\n<p>Above you're calling auxPuntos with 2 parameters (two arrays), but you only have one list of arrays <strong>z</strong> not two.</p>\n\n<pre><code>filter auxPuntos z \n</code></pre>\n\n<p>But remember the type of filter is: </p>\n\n<pre><code>filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>So we only apply a filter to [a], to solve this we need to add the k and r values into the <strong>where</strong>:</p>\n\n<pre><code>puntosEnCircunferencia a b z= filter p z\n    where\n      k = b !! 0\n      r = b !! 1\n      p (w,s)= ((k - w)^2 + (r - s)^2) &lt; a^2\n\nghci&gt; largestDivisible 1 [2,1] [(1,2),(3,4)]\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 8577388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48f732fa5f21e08c5015512299962d5e?s=128&d=identicon&r=PG&f=1", "display_name": "Ricardo Perez", "link": "https://stackoverflow.com/users/8577388/ricardo-perez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 46108168, "answer_count": 2, "score": 0, "last_activity_date": 1504843461, "creation_date": 1504831194, "question_id": 46106980, "link": "https://stackoverflow.com/questions/46106980/haskell-error-using-tuples-and-list", "title": "Haskell- Error using Tuples and List", "body": "<p>I'm testing this code:</p>\n\n<pre><code>    puntosEnCircunferencia  ::  Float -&gt; (Float , Float) -&gt; [(Float , Float)] -&gt; [(Float , Float)] \npuntosEnCircunferencia a y z = filter auxPuntos z \n   where auxPuntos (w,s) (k,r) = ((k - w)^2 + (r - s)^2) &lt; (a ^ 2)\n</code></pre>\n\n<p>but it throw me this error:</p>\n\n<pre><code> \u2022 Couldn't match type \u2018(Float, Float) -&gt; Bool\u2019 with \u2018Bool\u2019\n      Expected type: (Float, Float) -&gt; Bool\n        Actual type: (Float, Float) -&gt; (Float, Float) -&gt; Bool\n    \u2022 Probable cause: \u2018auxPuntos\u2019 is applied to too few arguments\n      In the first argument of \u2018filter\u2019, namely \u2018auxPuntos\u2019\n      In the expression: filter auxPuntos z\n      In an equation for \u2018puntosEnCircunferencia\u2019:\n          puntosEnCircunferencia a y z\n            = filter auxPuntos z\n            where\n                auxPuntos (w, s) (k, r) = ((k - w) ^ 2 + (r - s) ^ 2) &lt; (a ^ 2)\n</code></pre>\n\n<p>What im doing wrong. Im starting with Haskell so I don't have much experience to fix this. \nThanks.</p>\n"}, {"tags": ["haskell", "idris"], "comments": [{"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 1, "creation_date": 1504844031, "post_id": 46106633, "comment_id": 79179756, "body": "The crash details would be helpful. As a wild guess, your CPU might just be missing some instructions GHC assumed as existing."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1504853857, "post_id": 46106633, "comment_id": 79183263, "body": "Wait a bit for Windows to complete that search, and then take a look at crash info. There would be at least module name that caused crash."}, {"owner": {"reputation": 43, "user_id": 5850293, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hY46o.jpg?s=128&g=1", "display_name": "Vifonius", "link": "https://stackoverflow.com/users/5850293/vifonius"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1504855255, "post_id": 46106633, "comment_id": 79183997, "body": "@arrowd, according to crash info, there is an incorrect pathway: C:\\idris\\idris.exe, problem name is APPCRASH, module name is ntdll.dll, exception code is c0000005. Unfortunately, this doesn&#39;t tell me much."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1504870649, "post_id": 46106633, "comment_id": 79193135, "body": "You should probably move that discussion to <a href=\"https://github.com/idris-lang/idris-dev/issues\" rel=\"nofollow noreferrer\">Idris&#39; bugtracker</a>."}, {"owner": {"reputation": 43, "user_id": 5850293, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hY46o.jpg?s=128&g=1", "display_name": "Vifonius", "link": "https://stackoverflow.com/users/5850293/vifonius"}, "edited": false, "score": 0, "creation_date": 1505592281, "post_id": 46106633, "comment_id": 79479453, "body": "I&#39;ve got an older version and everything runs o&#39;k."}], "owner": {"reputation": 43, "user_id": 5850293, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hY46o.jpg?s=128&g=1", "display_name": "Vifonius", "link": "https://stackoverflow.com/users/5850293/vifonius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1504843689, "creation_date": 1504828164, "last_edit_date": 1504843689, "question_id": 46106633, "link": "https://stackoverflow.com/questions/46106633/idris-interactive-environment-doesnt-work-properly", "title": "Idris interactive environment doesn&#39;t work properly", "body": "<p>I've downloaded Idris using Windows binary available at <a href=\"https://github.com/idris-lang/Idris-dev\" rel=\"nofollow noreferrer\">https://github.com/idris-lang/Idris-dev</a> (<a href=\"https://neon.se/idris/idris-1.1.1-win32.exe\" rel=\"nofollow noreferrer\">https://neon.se/idris/idris-1.1.1-win32.exe</a>)\nIt is claimed that \"It includes everything needed to run Idris and build Idris programs, including a toolchain for the C backend. \"\nI had no problem with compiling .idr source files but when I try to evaluate simple expressions using REPL, the program dies with an error. The message box says that running idris.exe is terminated and Windows tries to recover error.<a href=\"https://i.stack.imgur.com/wwG32.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wwG32.jpg\" alt=\"message box\"></a>\nI'm running 32-bit Windows 7.</p>\n\n<p>Could anyone please help me?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 2, "creation_date": 1504826427, "post_id": 46106404, "comment_id": 79175871, "body": "<code>Double</code> is a <code>type</code>, but you&#39;re using it as if it were a <code>typeclass</code>. See <a href=\"http://learnyouahaskell.com/types-and-typeclasses\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 37, "user_id": 8201008, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-vzM-Z67ARvU/AAAAAAAAAAI/AAAAAAAAAMs/3C1nUT8D3jI/photo.jpg?sz=128", "display_name": "Abhik Nag", "link": "https://stackoverflow.com/users/8201008/abhik-nag"}, "reply_to_user": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1504827198, "post_id": 46106404, "comment_id": 79176043, "body": "Ok that helped."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1504827644, "post_id": 46106404, "comment_id": 79176158, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/12018959/string-is-applied-to-too-many-type-arguments\">`String&#39; is applied to too many type arguments</a>, <a href=\"https://stackoverflow.com/questions/16329408/types-num-a-ord-a-versus-int-a\">Types: (Num a, Ord a) versus (Int a)?</a>."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1504866493, "post_id": 46106566, "comment_id": 79190685, "body": "I find all the talk about kinds in this answer superfluous and probably pretty confusing for the OP, considering the basic level of the question."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1504908055, "post_id": 46106566, "comment_id": 79212818, "body": "@luqui: I found it helpful to learn about kinds pretty early on in my Haskell journey, but I appreciate that it may not be equally helpful to everybody. I\u2019ve split that information into a separate section and added more explanation in the hope that it\u2019s clearer, at least."}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 5, "last_activity_date": 1504907847, "last_edit_date": 1504907847, "creation_date": 1504827548, "answer_id": 46106566, "question_id": 46106404, "link": "https://stackoverflow.com/questions/46106404/type-signature-error-haskell/46106566#46106566", "title": "Type Signature error Haskell", "body": "<p>The signature you want is <code>Double -&gt; Double</code>.</p>\n\n<p><code>Double d =&gt; d -&gt; d</code> says \u201cI take a value of any type <code>d</code>, and return a value of that same type, provided that <code>d</code> has an instance of a typeclass called <code>Double</code>\u201d. The compiler is looking for a <em>typeclass</em> called <code>Double</code> but there is no such typeclass; instead it finds a <em>type</em> called <code>Double</code>, giving an error.</p>\n\n<p>With some extensions (such as <code>TypeFamilies</code> or <code>GADTs</code>) you <em>can</em> write this type like so:</p>\n\n<pre><code>(d ~ Double) =&gt; d -&gt; d\n</code></pre>\n\n<p>This says \u201cI take a value of any type <code>d</code>, and return a value of that same type, provided that <code>d</code> is equal to <code>Double</code>\u201d. That\u2019s just a roundabout way of saying <code>Double -&gt; Double</code>; if you write a function of this type, the compiler will actually expand it out to <code>Double -&gt; Double</code>:</p>\n\n<pre><code>&gt; :set -XTypeFamilies\n&gt; let f :: (d ~ Double) =&gt; d -&gt; d; f x = x\n&gt; :t f\nf :: Double -&gt; Double\n</code></pre>\n\n<p>More technically, the error you\u2019ve encountered is a <em>kind</em> error\u2014kinds are the \u201ctypes of types\u201d and are used to check things like giving the correct number of type parameters to a type. Because you give a type parameter to <code>Double</code>, GHC infers that it should be a typeclass like <code>Eq</code> or <code>Ord</code> that takes 1 type as an argument (kind <code>* -&gt; Constraint</code>), but <code>Double</code> is a plain type that takes no arguments (kind <code>*</code>). You can see the kinds of common types &amp; typeclasses in GHCi with the <code>:kind</code> or <code>:k</code> command to get a better understanding of them:</p>\n\n<pre><code>&gt; :k Double\nDouble :: *\n\n&gt; :k Maybe\nMaybe :: * -&gt; *\n\n&gt; :k Maybe Double\nMaybe Double :: *\n\n&gt; :k Eq\nEq :: * -&gt; Constraint\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 8201008, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-vzM-Z67ARvU/AAAAAAAAAAI/AAAAAAAAAMs/3C1nUT8D3jI/photo.jpg?sz=128", "display_name": "Abhik Nag", "link": "https://stackoverflow.com/users/8201008/abhik-nag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 46106566, "answer_count": 1, "score": 1, "last_activity_date": 1504907847, "creation_date": 1504826129, "question_id": 46106404, "link": "https://stackoverflow.com/questions/46106404/type-signature-error-haskell", "title": "Type Signature error Haskell", "body": "<p>This is probably a dumb question but I would like to understand type signatures better and why I am getting the following error when I run my code. Code is below.</p>\n\n<pre><code>area :: Double d =&gt; d -&gt; d\narea x = x^2 * 3.14\n</code></pre>\n\n<p>The error I am getting is below. </p>\n\n<pre><code>Double is applied to too many type arguments\nIn the type signature for `area': area :: Double d =&gt; d -&gt; d\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack", "hspec"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1504825806, "post_id": 46106286, "comment_id": 79175714, "body": "Have you tried simply <code>$ echo --match=post_returns_200&gt;.hspec</code>? (using <code>&gt;</code> to overwrite the file instead of appending to it, since otherwise it will still contain the <code>--match=&quot;post_returns_200&quot;</code> line.)"}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "reply_to_user": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 0, "creation_date": 1504826097, "post_id": 46106286, "comment_id": 79175779, "body": "@M.Aroosi Yes, tried that and get same error. So same error with <code>.hspec</code> file containing just the single line <code>--match=post_returns_200</code>."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1504834772, "creation_date": 1504834772, "answer_id": 46107388, "question_id": 46106286, "link": "https://stackoverflow.com/questions/46106286/hspec-test-arguments-work-on-command-line-but-not-from-hspec-file/46107388#46107388", "title": "hspec test arguments work on command line but not from .hspec file", "body": "<p>For some reason I ignore, hspec recognizes a different set of options in the command line and in config files.</p>\n\n<p>As of now, explicit command line arguments (via <code>--test-arguments</code> when using stack) is the only way to pass <code>--match</code> to hspec.</p>\n\n<hr>\n\n<p>From the source code of 2.4.4 (which has changed a lot on the current active branch, but it still doesn't allow what you want either):</p>\n\n<ul>\n<li><p><a href=\"https://github.com/hspec/hspec/blob/2.4.4/hspec-core/src/Test/Hspec/Core/Options.hs#L242\" rel=\"nofollow noreferrer\">Command line options</a> are parsed with <a href=\"https://github.com/hspec/hspec/blob/2.4.4/hspec-core/src/Test/Hspec/Core/Options.hs#L233\" rel=\"nofollow noreferrer\"><code>recognizedOptions</code></a>, containing both <a href=\"https://github.com/hspec/hspec/blob/2.4.4/hspec-core/src/Test/Hspec/Core/Options.hs#L148\" rel=\"nofollow noreferrer\"><code>commandLineOptions</code></a> (which includes <code>--match</code>) and <a href=\"https://github.com/hspec/hspec/blob/2.4.4/hspec-core/src/Test/Hspec/Core/Options.hs#L158\" rel=\"nofollow noreferrer\"><code>configFileOptions</code></a>.</p></li>\n<li><p><a href=\"https://github.com/hspec/hspec/blob/2.4.4/hspec-core/src/Test/Hspec/Core/Options.hs#L250\" rel=\"nofollow noreferrer\">Config file options</a>, via <a href=\"https://github.com/hspec/hspec/blob/2.4.4/hspec-core/src/Test/Hspec/Core/Options.hs#L258\" rel=\"nofollow noreferrer\"><code>parseOtherOptions</code></a>, use only <code>configFileOptions</code>, which don't include <code>--match</code>.</p></li>\n</ul>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 46107388, "answer_count": 1, "score": 2, "last_activity_date": 1504834772, "creation_date": 1504825082, "last_edit_date": 1504825396, "question_id": 46106286, "link": "https://stackoverflow.com/questions/46106286/hspec-test-arguments-work-on-command-line-but-not-from-hspec-file", "title": "hspec test arguments work on command line but not from .hspec file", "body": "<p>I am following the <a href=\"http://hspec.github.io/options.html\" rel=\"nofollow noreferrer\">hspec documentation</a> on passing options to Hspec. Specifying my option works as expected when passed from the command line, but not when passed from the <code>.hspec</code> file or any of the other listed methods.</p>\n\n<p>One of the tests in my test suite matches the filter \"post_returns_200\". I can run this test alone without running the rest of the suite via the command</p>\n\n<pre><code>stack test --test-arguments=--match=\"post_returns_200\"\n</code></pre>\n\n<p>The linked hspec documentation shows that I should be able to specify this filter not only from the command line, but also: from an <code>.hspec</code> file, from within <code>ghci</code>, or from an environment variable. When I follow the documentation to specify my filter by one of those other methods, however, I get an \"unrecognized option\" error. For instance, when I specify the option in the <code>.hspec</code> file via</p>\n\n<pre><code>$ echo --match=\"post_returns_200\"&gt;&gt;.hspec\n</code></pre>\n\n<p>then running <code>stack test</code> returns the following</p>\n\n<pre><code>$ stack test\nazara-api-0.1.0.0: test (suite: azara-test)\n\nazara-test: unrecognized option `--match=\"post_returns_200\"' in config file /home/matthew/backup/azara_work/platform/api/.hspec\n\nTest suite failure for package azara-api-0.1.0.0\n    azara-test:  exited with: ExitFailure 1\nLogs printed to console\n</code></pre>\n\n<p>When I attempt to specify the option via an environment variable or from within ghci, I get a similar error. I have tried many variations on how to specify the command, e.g. with or without quotes, with and without \"<code>--test-arguments=</code>\", but I am totally stumped at this point. Any suggestions on why the option works properly when specified via command line but is unrecognized by the other methods?</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 221, "user_id": 2849491, "user_type": "registered", "accept_rate": 38, "profile_image": "https://graph.facebook.com/948496018502300/picture?type=large", "display_name": "Nudin", "link": "https://stackoverflow.com/users/2849491/nudin"}, "edited": false, "score": 0, "creation_date": 1504884370, "post_id": 46118288, "comment_id": 79202231, "body": "Yes, that Is what I mean. I need this because I want to run the application on two different locations, once with an own domain where every routes are in &quot;/&quot;, while the other time the app has to run inside a sub-folder of a domain."}, {"owner": {"reputation": 221, "user_id": 2849491, "user_type": "registered", "accept_rate": 38, "profile_image": "https://graph.facebook.com/948496018502300/picture?type=large", "display_name": "Nudin", "link": "https://stackoverflow.com/users/2849491/nudin"}, "edited": false, "score": 0, "creation_date": 1505333789, "post_id": 46118288, "comment_id": 79375603, "body": "I tried overriding the cleanPath method but I don&#39;t manage to do it correctly. Can you give me a hint?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 221, "user_id": 2849491, "user_type": "registered", "accept_rate": 38, "profile_image": "https://graph.facebook.com/948496018502300/picture?type=large", "display_name": "Nudin", "link": "https://stackoverflow.com/users/2849491/nudin"}, "edited": false, "score": 0, "creation_date": 1505370438, "post_id": 46118288, "comment_id": 79386800, "body": "Are you able to reproduce this in a single file example? It&#39;s not quite clear to me what error is occurring."}, {"owner": {"reputation": 221, "user_id": 2849491, "user_type": "registered", "accept_rate": 38, "profile_image": "https://graph.facebook.com/948496018502300/picture?type=large", "display_name": "Nudin", "link": "https://stackoverflow.com/users/2849491/nudin"}, "edited": false, "score": 0, "creation_date": 1505563294, "post_id": 46118288, "comment_id": 79470768, "body": "I stripped my code down to a minimal example: <a href=\"https://pastebin.com/vSKVLZDP\" rel=\"nofollow noreferrer\">pastebin.com/vSKVLZDP</a>"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 221, "user_id": 2849491, "user_type": "registered", "accept_rate": 38, "profile_image": "https://graph.facebook.com/948496018502300/picture?type=large", "display_name": "Nudin", "link": "https://stackoverflow.com/users/2849491/nudin"}, "edited": false, "score": 0, "creation_date": 1505666894, "post_id": 46118288, "comment_id": 79495508, "body": "Your parsing logic isn&#39;t accounting for how the <code>&#47;foo&#47;</code> path is being parsed, which is <code>[&quot;foo&quot;, &quot;&quot;]</code>. You&#39;ll need special handling for the trailing empty string."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 2, "last_activity_date": 1504879241, "creation_date": 1504879241, "answer_id": 46118288, "question_id": 46105550, "link": "https://stackoverflow.com/questions/46105550/yesod-parseroutes-depending-on-approot/46118288#46118288", "title": "Yesod: parseRoutes depending on approot", "body": "<p>It's not completely clear what problem you're running into. I <em>think</em> what you're saying is, if you simply set APPROOT, then:</p>\n\n<ul>\n<li>The URLs generated by Yesod will include the <code>/path</code> prefix</li>\n<li>But incoming requests with the <code>/path</code> prefix will not be parsed correctly</li>\n</ul>\n\n<p>The usual use case for this kind of prefix is that you have a reverse proxy in front of your app, such as Apache or Nginx, which is delegating only part of the domain to your app. In this case: APPROOT works fine.</p>\n\n<p>I'm not sure what other use case you're trying to address, but in general you can just drop a part of the request path by overriding the <a href=\"https://www.stackage.org/haddock/lts-9.3/yesod-core-1.4.36/Yesod-Core.html#v:cleanPath\" rel=\"nofollow noreferrer\"><code>cleanPath</code></a> method. Or you could use a WAI middleware to modify the request itself if you wanted.</p>\n"}], "owner": {"reputation": 221, "user_id": 2849491, "user_type": "registered", "accept_rate": 38, "profile_image": "https://graph.facebook.com/948496018502300/picture?type=large", "display_name": "Nudin", "link": "https://stackoverflow.com/users/2849491/nudin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1505341182, "creation_date": 1504820750, "last_edit_date": 1505341182, "question_id": 46105550, "link": "https://stackoverflow.com/questions/46105550/yesod-parseroutes-depending-on-approot", "title": "Yesod: parseRoutes depending on approot", "body": "<p>My Yesod-Application should get it's approot via an Envoirement-Variable. <a href=\"https://www.yesodweb.com/book/environment-variables\" rel=\"nofollow noreferrer\">This</a> seems describe exactly this situation. But: When doing so, only links generated by Yesod will consider the approot, but the Route-definitions in the Quasiquoter parseRoutes will stay absolute:</p>\n\n<pre><code>mkYesod \"App\" [parseRoutes|\n / HomeR GET\n|]\n</code></pre>\n\n<p>So setting APPROOT to \"domain.com/path\" will not work, since there's no route for \"/path\" but only for \"/\".</p>\n\n<p>Is there a way to make the routes relative to the approot?</p>\n\n<hr>\n\n<p>Update:</p>\n\n<p>I tried to modify cleanPath accordingly too, but Routes to the Home-Route are still wrong\u2026</p>\n\n<pre><code>instance Yesod Browser where\n  approot = ApprootMaster myApproot\n  cleanPath site s = do\n        if corrected == s\n            then Right $ dropprefix (Data.List.map dropDash s)\n            else Left $ dropprefix corrected\n      where\n        corrected = Data.List.filter (not . Data.Text.null) s\n        dropDash t\n            | Data.Text.all (== '-') t = Data.Text.drop 1 t\n            | otherwise = t\n        r = Data.Text.drop 1 $ myApproot site\n        l = Data.Text.length r\n        dropprefix l\n            | Data.List.take 1 l == [r] = Data.List.drop 1 l\n            | otherwise = l\n</code></pre>\n\n<p>If I set approot to \"/foo\" it works, except for \"@{HomeR}\" leading to \"/foo/\" which redirects to \"/foo/foo\"\u2026</p>\n"}, {"tags": ["haskell", "pattern-matching", "elm"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1504820887, "post_id": 46105492, "comment_id": 79174164, "body": "In Haskell you would need to first create an instance of <code>Eq</code> for <code>Thing</code>, and then use the <code>elem</code> function."}, {"owner": {"reputation": 2915, "user_id": 1295154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9687b362fd1d4754033efc0b19001e81?s=128&d=identicon&r=PG", "display_name": "Dominique Devriese", "link": "https://stackoverflow.com/users/1295154/dominique-devriese"}, "edited": false, "score": 0, "creation_date": 1504854963, "post_id": 46105492, "comment_id": 79183821, "body": "Your caseStatement reminds me of GHC&#39;s <a href=\"http://neilmitchell.blogspot.be/2009/11/reviewing-view-patterns.html\" rel=\"nofollow noreferrer\">View Patterns</a>."}], "answers": [{"comments": [{"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 0, "creation_date": 1504882636, "post_id": 46105716, "comment_id": 79201178, "body": "I ended up going with <code>List.member thing things</code>.  However, is there any way to drop something like that into a case statement?  For example: <code>Foo|Bar|Baz -&gt;</code>, or some kind of regex.  If case expressions are definitely only designed for simple, direct matches, put that at the top of the response and I&#39;ll mark as correct."}], "tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": true, "score": 4, "last_activity_date": 1504822379, "last_edit_date": 1504822379, "creation_date": 1504821644, "answer_id": 46105716, "question_id": 46105492, "link": "https://stackoverflow.com/questions/46105492/pattern-matching-on-a-list-in-elm/46105716#46105716", "title": "Pattern Matching on a List in Elm", "body": "<p>Elm is based on Haskell, actually has lot of less features, you can pattern match your type easily element by element or check if it is in the list:</p>\n\n<pre><code>data Thing = Foo | Bar | Baz deriving (Eq, Show)\n\nthings :: [Thing]\nthings = [ Foo, Bar, Baz ]\n\ncaseStatement :: Thing -&gt; Bool\ncaseStatement thing = thing `elem` things\n</code></pre>\n\n<p>Pattern matching:</p>\n\n<pre><code>caseStatement :: Thing -&gt; Bool\ncaseStatement Foo = True\ncaseStatement Bar = True\ncaseStatement Baz = True\ncaseStatement _   = False\n</code></pre>\n\n<p>Here you have a <a href=\"https://repl.it/Kopy/1\" rel=\"noreferrer\">live example</a></p>\n\n<p>In Elm you can use <code>List.member</code></p>\n\n<pre><code>import List\ntype Thing = Foo | Bar | Baz\n\nthings : List Thing\nthings = [ Foo, Bar, Baz ]\n\ncaseStatement : Thing -&gt; Bool\ncaseStatement thing = List.member thing things\n</code></pre>\n\n<p>Pattern matching it:</p>\n\n<pre><code>caseStatement : Thing -&gt; Bool\ncaseStatement thing = case thing of\n    Foo -&gt; True\n    Bar -&gt; True\n    Baz -&gt; True\n    _   -&gt; False\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 175, "user_id": 8085046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fd08d37d0de690f3468bed89f45316d?s=128&d=identicon&r=PG&f=1", "display_name": "nidstang", "link": "https://stackoverflow.com/users/8085046/nidstang"}, "edited": false, "score": 2, "creation_date": 1504859705, "post_id": 46107564, "comment_id": 79186517, "body": "In Mark&#39;s example Thing is a type not a List. Your solution is wrong. This code will not compile.  You will get this:  -- TYPE MISMATCH ------------------------------------------------------------&zwnj;&#8203;---  Tag :: is causing problems in this pattern match.  Foo :: Foo :: Bar :: [] -&gt; ^^^^^^^^^^^^^^^^^^^^^^^ The pattern matches things of type:      List a  But the values it will actually be trying to match are:      Thing"}, {"owner": {"reputation": 21877, "user_id": 131227, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/60e3c03e227b84e2898c29fd711cae5b?s=128&d=identicon&r=PG", "display_name": "z5h", "link": "https://stackoverflow.com/users/131227/z5h"}, "reply_to_user": {"reputation": 175, "user_id": 8085046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fd08d37d0de690f3468bed89f45316d?s=128&d=identicon&r=PG&f=1", "display_name": "nidstang", "link": "https://stackoverflow.com/users/8085046/nidstang"}, "edited": false, "score": 0, "creation_date": 1504873974, "post_id": 46107564, "comment_id": 79195386, "body": "If you make sure thing is a list then it&#39;s fine. Of course if thing isn&#39;t a list you can&#39;t treat it as one. If it&#39;s a list, you pattern match on a list as the op requested."}], "tags": [], "owner": {"reputation": 21877, "user_id": 131227, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/60e3c03e227b84e2898c29fd711cae5b?s=128&d=identicon&r=PG", "display_name": "z5h", "link": "https://stackoverflow.com/users/131227/z5h"}, "is_accepted": false, "score": 1, "last_activity_date": 1504836238, "creation_date": 1504836238, "answer_id": 46107564, "question_id": 46105492, "link": "https://stackoverflow.com/questions/46105492/pattern-matching-on-a-list-in-elm/46107564#46107564", "title": "Pattern Matching on a List in Elm", "body": "<p>Yes!</p>\n\n<pre><code>case thing of\n   Foo :: Foo :: Bar :: [] -&gt;\n      \"two foos and a bar\"\n   Bar :: stuff -&gt;\n      \"a bar and then \" ++ (toString stuff)\n    _ -&gt;\n      \"something else\"\n</code></pre>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 534, "favorite_count": 0, "accepted_answer_id": 46105716, "answer_count": 2, "score": 1, "last_activity_date": 1504836238, "creation_date": 1504820417, "question_id": 46105492, "link": "https://stackoverflow.com/questions/46105492/pattern-matching-on-a-list-in-elm", "title": "Pattern Matching on a List in Elm", "body": "<p>Can you pattern match on a list of items in Elm 0.18?  For example:</p>\n\n<pre><code>type Thing = Foo | Bar | Baz\n\nthings : List Thing\nthings : [ Foo, Bar, Baz ]\n\ncaseStatement : Thing -&gt; Bool\ncaseStatement thing =\n  case thing of\n    expressionSayingThatItIsInThingsList -&gt;\n      True\n    _ -&gt;\n      False\n</code></pre>\n\n<p>Also, can this be done in Haskell?</p>\n"}, {"tags": ["haskell", "deep-learning"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1504849543, "post_id": 46104942, "comment_id": 79181300, "body": "At a guess: that <code>&#39;[ &#39;D1 265, &#39;D1 200, &#39;D1 265]</code> should be <code>&#39;[ &#39;D1 265, &#39;D1 200, &#39;D1 200, &#39;D1 265, &#39;D1 265]</code>. But it&#39;s a pretty wild guess."}, {"owner": {"reputation": 514, "user_id": 208519, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5d56a83e37c27191bdcb93d55e36b4d?s=128&d=identicon&r=PG", "display_name": "Captain Fim", "link": "https://stackoverflow.com/users/208519/captain-fim"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1504862956, "post_id": 46104942, "comment_id": 79188520, "body": "Yes, this compiles! Very good wild guess, thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1504883193, "creation_date": 1504883193, "answer_id": 46119491, "question_id": 46104942, "link": "https://stackoverflow.com/questions/46104942/model-an-autoencoder-with-haskell-grenade/46119491#46119491", "title": "Model an Autoencoder with Haskell Grenade", "body": "<p>It looks like activation functions count as \"layers\" (that don't change the dimension) in this library. So duplicate the dimensions that correspond to the relu layers:</p>\n\n<pre><code>type Auto = \n  Network\n    '[ FullyConnected 265 200, Relu, FullyConnected 200 265, Relu]\n    '[ 'D1 265, 'D1 200, 'D1 200, 'D1 265, 'D1 265]\n</code></pre>\n"}], "owner": {"reputation": 514, "user_id": 208519, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5d56a83e37c27191bdcb93d55e36b4d?s=128&d=identicon&r=PG", "display_name": "Captain Fim", "link": "https://stackoverflow.com/users/208519/captain-fim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 46119491, "answer_count": 1, "score": 4, "last_activity_date": 1504883193, "creation_date": 1504817709, "question_id": 46104942, "link": "https://stackoverflow.com/questions/46104942/model-an-autoencoder-with-haskell-grenade", "title": "Model an Autoencoder with Haskell Grenade", "body": "<p>I would like to create a network for an Autoencoder with the Grenade Deep Learning Library written in Haskell. \nIt should learn to represent 265 Bits of input with a layer of 200 bits.\nThus, I declare the type:</p>\n\n<pre><code>type Auto = \n  Network\n    '[ FullyConnected 265 200, Relu, FullyConnected 200 265, Relu]\n    '[ 'D1 265, 'D1 200, 'D1 265]\n</code></pre>\n\n<p>However, when I try to generate a random network for this type by</p>\n\n<pre><code>randomAuto :: MonadRandom m =&gt; m Auto\nrandomAuto = randomNetwork\n</code></pre>\n\n<p>I get a type error like this:</p>\n\n<pre><code>Could not deduce (Layer Relu ('D1 200) ('D1 265)) arising from a use of \u2018randomNetwork\u2019\n</code></pre>\n\n<p>This surely is because the only <code>Relu</code> instance of dimension 1 is declared as</p>\n\n<pre><code>KnownNat i =&gt; Layer Relu (D1 i) (D1 i)\n</code></pre>\n\n<p>requiring that input and output are of the same size.</p>\n\n<p>But how do you create an auto encoder with this library?</p>\n"}, {"tags": ["haskell", "gadt", "type-families"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1504816931, "post_id": 46104536, "comment_id": 79172447, "body": "Yes, type families must be used <i>saturated</i> - that is, you have to apply the type family to all of its declared arguments. Type families are expanded at compile time, so the compiler has to know all of the type family&#39;s arguments in order to know what it&#39;s meant to expand into. The same applies to type synonyms."}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1504817390, "post_id": 46104536, "comment_id": 79172692, "body": "I&#39;d be tempted to argue that newtypes are expanded (well, reduced) at compile-time as well, yet with them it works. So perhaps &quot;compile-time&quot; is a bit broad. What makes them different? In a word: why?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1504819105, "post_id": 46104536, "comment_id": 79173487, "body": "Sure, I was using the term &quot;compile time&quot; a bit loosely. <code>newtype</code>s are erased during code generation - the runtime representation of a newtype is the same as the wrapped type and it&#39;s free to coerce in either direction - but they are not expanded during type checking like <code>type</code>s are. <code>newtype</code>s are apart from any other type; type synonyms/families are not."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1504866780, "post_id": 46104536, "comment_id": 79190878, "body": "You could use a <code>data family</code> though, if you wanted.  They&#39;re like type families but injective."}, {"owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "edited": false, "score": 0, "creation_date": 1504873318, "post_id": 46104536, "comment_id": 79194922, "body": "Thanks for the suggestion! As target types I&#39;ve currently got a newtype (not pictured here), a data (that Dup) and a raw Int (the one I&#39;m currently using my TFId functor for), so I&#39;d have to convince myself Int is data, and compatible with whatever <code>f</code> does. Will give it a try."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1504859173, "creation_date": 1504859173, "answer_id": 46111967, "question_id": 46104536, "link": "https://stackoverflow.com/questions/46104536/difference-between-type-family-and-partial-newtype-and-partial-data/46111967#46111967", "title": "Difference between type family and partial newtype? (and partial data?)", "body": "<p>Injectivity.</p>\n\n<pre><code>type family F :: * -&gt; *\ntype instance F Int  = Bool\ntype instance F Char = Bool\n</code></pre>\n\n<p>here <code>F Int ~ F Char</code>. However,</p>\n\n<pre><code>data G (a :: *) = ...\n</code></pre>\n\n<p>will never cause <code>G Int ~ G Char</code>. These are guaranteed to be distinct types.</p>\n\n<p>In universal quantifications like</p>\n\n<pre><code>foo :: forall f a. f a -&gt; a\n</code></pre>\n\n<p><code>f</code> is allowed to be <code>G</code> (injective) but not allowed to be <code>F</code> (not injective).</p>\n\n<p>This is to make inference work. <code>foo (... :: G Int)</code> can be inferred to have type <code>Int</code>. <code>foo (... :: F Int)</code> is equivalent to <code>foo (... :: Bool)</code> which may have type <code>Int</code>, or type <code>Char</code> -- it's an ambiguous type.</p>\n\n<p>Also consider <code>foo True</code>. We can't expect GHC to choose <code>f ~ F, a ~ Int (or Char)</code> for us. This would involve looking at <em>all</em> type families and see if <code>Bool</code> can be produced by any on them -- essentially, we would need to invert all the type families. Even if this were feasible, it would generate a huge amount of possible solutions, so it would be ambiguous.</p>\n"}], "owner": {"reputation": 34465, "user_id": 12274, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/98e72a0366a5d8e0a4a5df9ecd1933db?s=128&d=identicon&r=PG&f=1", "display_name": "JB.", "link": "https://stackoverflow.com/users/12274/jb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 46111967, "answer_count": 1, "score": 3, "last_activity_date": 1504859173, "creation_date": 1504815806, "question_id": 46104536, "link": "https://stackoverflow.com/questions/46104536/difference-between-type-family-and-partial-newtype-and-partial-data", "title": "Difference between type family and partial newtype? (and partial data?)", "body": "\n\n<p>I've had to interface two libraries where metadata is represented as a type parameter in one and as a record field in the other.  I wrote an adaptor using a GADT.  Here's a distilled version:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs #-}\n\nnewtype TFId  a = MkId   a\ndata    TFDup a = MkDup !a !a\n\ndata GADT tf where\n  ConstructorId  :: GADT TFId\n  ConstructorDup :: GADT TFDup\n\nmain = do\n  f ConstructorId\n  f ConstructorDup\n\nf :: GADT tf -&gt; IO ()\nf = _\n</code></pre>\n\n<p>This works.  (May not be perfect; comments welcome, but that's not the question.)</p>\n\n<p>It took me some time to get to this working state.  My initial intuition was to use a type family for <code>TFId</code>, figuring: \u201c<code>GADT</code> has kind <code>(* -&gt; *) -&gt; *</code>; in <code>ConstructorDup</code> <code>TFDup</code> has kind <code>* -&gt; *</code>; so for <code>ConstructorId</code> I can use the following <code>* -&gt; *</code> type family:\u201d</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TypeFamilies #-}\ntype family TFId a where TFId a = a\n</code></pre>\n\n<p>The type constructor does have the same kind <code>* -&gt; *</code>, but GHC apparently won't have it in the same place:</p>\n\n<blockquote>\n  <p>error: \u2026</p>\n  \n  <ul>\n  <li>The type family \u2018TFId\u2019 should have 1 argument, but has been given none</li>\n  <li>In the definition of data constructor \u2018ConstructorId\u2019\n   In the data type declaration for \u2018GADT\u2019</li>\n  </ul>\n</blockquote>\n\n<p>Well, if it says so\u2026</p>\n\n<p>I'm no sure I understand why it would make such a difference.  No using type family stems without applying them?  What's going on?  Any other (better) way to do?</p>\n\n\n"}, {"tags": ["haskell", "haskell-stack", "hspec"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1504805896, "post_id": 46102095, "comment_id": 79167081, "body": "Is <a href=\"http://hspec.github.io/options.html\" rel=\"nofollow noreferrer\">this</a> what you are looking for? Stack just passes <code>test-arguments</code> to the testing library, so it makes sense <code>stack test --help</code> wouldn&#39;t be able to tell you the options <code>hspec</code> has."}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1504805986, "post_id": 46102095, "comment_id": 79167125, "body": "@Alec I hadn&#39;t seen that, thanks."}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 194, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504805619, "creation_date": 1504805302, "last_edit_date": 1504805619, "question_id": 46102095, "link": "https://stackoverflow.com/questions/46102095/explanation-of-stack-test-test-arguments-m-filter", "title": "Explanation of `stack test --test-arguments &quot;-m &quot;&lt;filter&gt;&quot;&quot;`", "body": "<p>On other <a href=\"https://github.com/commercialhaskell/stack/issues/2210\" rel=\"nofollow noreferrer\">forum pages</a>, I've seen that I can run specific <a href=\"https://hackage.haskell.org/package/hspec\" rel=\"nofollow noreferrer\"><code>hspec</code></a> tests with the command</p>\n\n<pre><code>stack test --test-arguments \"-m \"&lt;filter&gt;\"\"\n</code></pre>\n\n<p>where <code>&lt;filter&gt;</code> is set to match <a href=\"https://hackage.haskell.org/package/hspec-2.4.4/docs/Test-Hspec.html#v:it\" rel=\"nofollow noreferrer\"><code>it</code>'s</a> textual descriptor for the intended tests. I frequently use this command to run single tests of interest without having to run the entire test suite.</p>\n\n<p><strong>But I do not understand how exactly this command specifies that.</strong> For instance, what kind of argument is <code>\"-m \"&lt;filter&gt;\"\"</code>, and what does that \"-m\" mean? What other arguments can be specified as the <code>\"-m \"&lt;filter&gt;\"\"</code> is here?</p>\n\n<p>About <code>--test-arguments</code>, <code>stack test --help | less</code> says only</p>\n\n<pre><code>--ta,--test-arguments TEST_ARGS\n                       Arguments passed in to the test suite program\n</code></pre>\n\n<p>which is the only relevant documentation I have found on how to specify stack to run a subset of tests.</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1504796898, "post_id": 46099700, "comment_id": 79161783, "body": "Because we transform the <code>Maybe</code> monad, and not what the <code>Maybe</code> contains?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1504797443, "post_id": 46099700, "comment_id": 79162219, "body": "I think this has been answered somewhere before, but I can&#39;t find it."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1504808289, "post_id": 46100445, "comment_id": 79168309, "body": "I think it&#39;s easier to see the problem by focusing on <code>join2</code> directly, rather than trying to reason too deeply about how it must decompose. We can pattern match on the argument, and then we need <code>m (Maybe (m a)) -&gt; Maybe (m a)</code>. The only non-trivial choice is <code>Just</code>, which leads to <code>m (Maybe (m a)) -&gt; m a</code>, which smells like trouble."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 7, "last_activity_date": 1504962853, "last_edit_date": 1504962853, "creation_date": 1504798959, "answer_id": 46100445, "question_id": 46099700, "link": "https://stackoverflow.com/questions/46099700/in-a-monad-transformer-why-is-the-known-monad-the-inner-one/46100445#46100445", "title": "In a monad transformer, why is the known monad the inner one?", "body": "<p>After expanding newtypes, we have <code>join :: Monad m =&gt; m (Maybe (m (Maybe a))) -&gt; m (Maybe a)</code> in the first case and <code>join :: Monad m =&gt; Maybe (m (Maybe (m a))) -&gt; Maybe (m a)</code> in the second.</p>\n\n<p>To implement the first <code>join</code> you need a way to distribute <code>Maybe</code> over <code>m</code>: <code>dist1 :: Monad m =&gt; Maybe (m a) -&gt; m (Maybe a)</code> :</p>\n\n<pre><code>join1 :: m (Maybe (m (Maybe a))) -&gt; m (Maybe a)\njoin1 = fmap join . join . fmap dist1\n</code></pre>\n\n<p>To implement the second <code>join</code> you need the opposite distributive law <code>dist2 :: Monad m =&gt; m (Maybe a) -&gt; Maybe (m a)</code></p>\n\n<pre><code>join2 :: Maybe (m (Maybe (m a))) -&gt; Maybe (m a)\njoin2 = fmap join . join . fmap dist2\n</code></pre>\n\n<p><code>dist1</code> is easy to implement (I'll leave proving the monad transformer laws to you):</p>\n\n<pre><code>dist1 :: Monad m =&gt; Maybe (m a) -&gt; m (Maybe a) \ndist1 = sequenceA\n</code></pre>\n\n<p><code>dist2</code> is not so easy. It can't be done for an arbitrary <code>Monad</code>. As a counterexample, let's pick <code>m</code> to be the \"reader\" monad <code>(-&gt;) r</code>:</p>\n\n<pre><code>dist2 :: (r -&gt; Maybe a) -&gt; Maybe (r -&gt; a)\n</code></pre>\n\n<p>Since you don't have access to an <code>r</code>, the only implementation of <code>dist2</code> that'll typecheck is <code>const Nothing</code>, which clearly won't satisfy the monad laws.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1504975144, "post_id": 46104287, "comment_id": 79227981, "body": "I suspect the names we give some transformers may suggest a false pattern. We name <code>StateT</code> after <code>State</code> and <code>ReaderT</code> after <code>Reader</code>, etc, which seems to suggest a one-to-one relationship of some kind. But monads and monad transformers are really quite different, as evidenced by the various things that profess to be the &quot;right&quot; list monad transformer. &quot;<code>ListT</code> done right&quot;, pipes/conduit/streaming/machines/coroutines, and <code>LogicT</code> (and the reflection-without-remorse version of <code>LogicT</code>) all seem to have legitimate claims to the title."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 3, "last_activity_date": 1504814802, "creation_date": 1504814802, "answer_id": 46104287, "question_id": 46099700, "link": "https://stackoverflow.com/questions/46099700/in-a-monad-transformer-why-is-the-known-monad-the-inner-one/46104287#46104287", "title": "In a monad transformer, why is the known monad the inner one?", "body": "<p>Looking at <code>StateT</code> might be instructive:</p>\n\n<pre><code>newtype StateT s m a = StateT { runStateT :: s -&gt; m (a,s) }\n</code></pre>\n\n<p>Here the state is neither \"inner\" nor \"outer\", but its type is interleaved with the monad it is transforming, some bits inside, some outside.  And indeed</p>\n\n<pre><code>newtype ReaderT r m a = ReaderT { runReaderT :: r -&gt; m a }\n</code></pre>\n\n<p>is all \"outer\".  So it depends on what transformer it is.  There's probably some category theory that at least partially explains this interleaving, I'm curious to know about it (intelligentsia?).</p>\n\n<p>Contrast with applicative functors, for which</p>\n\n<pre><code>newtype Compose f g a = Compose { getCompose :: f (g a) }\n</code></pre>\n\n<p>is an applicative as well, so there is always a clear \"inner/outer\" relationship.  You could make an applicative-only <code>StateT</code>, and finding its structure by <code>Compose (State s)</code>:</p>\n\n<pre><code>ApplicativeStateT s f a = s -&gt; (s, f a)\n</code></pre>\n\n<p>In fact, there's another one if you compose on the right:</p>\n\n<pre><code>ApplicativeStateT' s f a = f (s -&gt; (s,a))\n</code></pre>\n\n<p>But monads have no such regularity.</p>\n"}], "owner": {"reputation": 2862, "user_id": 2613769, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/200dde59bd0be1e302c0d89ed34f5081?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/2613769/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 1, "answer_count": 2, "score": 11, "last_activity_date": 1504962853, "creation_date": 1504796711, "last_edit_date": 1504799380, "question_id": 46099700, "link": "https://stackoverflow.com/questions/46099700/in-a-monad-transformer-why-is-the-known-monad-the-inner-one", "title": "In a monad transformer, why is the known monad the inner one?", "body": "<p>For example, <code>MaybeT</code> is defined as:</p>\n\n<pre><code>newtype MaybeT m a =\n  MaybeT { runMaybeT :: m (Maybe a)}\n</code></pre>\n\n<p>But not:</p>\n\n<pre><code>newtype MaybeT m a =\n  MaybeT { runMaybeT :: Maybe (m a) }\n</code></pre>\n\n<p>Why is this?</p>\n"}, {"tags": ["haskell", "typeclass", "subclassing"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1504790028, "post_id": 46096938, "comment_id": 79156457, "body": "I think you haven&#39;t quite grokked what a class <i>is</i>. A Haskell type-class is very different from a class in typical OO languages. Defining an <i>instance</i> of a class (which can be done for concrete types, as the newtype in your third attempt) is fundamentally different from defining a subclass of it."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1504790351, "post_id": 46096938, "comment_id": 79156683, "body": "To give an answer to this probably <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY</a> question, it would be useful to know a bit more about what you want all this for. In particular, the type family <code>TheType</code> doesn&#39;t seem to make any sense; why do you think you need an associated type family there?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1504794568, "post_id": 46096938, "comment_id": 79160020, "body": "This is definitely not something Haskell is built to support. That said, I made a <a href=\"https://gist.github.com/harpocrates/38ec83098cd45d7e8bccbb2d7001acb5#file-subtype-hs\" rel=\"nofollow noreferrer\">proof of concept gist</a> about this a while ago. If that is what you are looking for, the question is probably a duplicate of <a href=\"https://stackoverflow.com/q/41504364/3072788\">stackoverflow.com/q/41504364/3072788</a>."}], "answers": [{"tags": [], "owner": {"reputation": 18156, "user_id": 127335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765a0d6880973a0e95e2700e11786c3a?s=128&d=identicon&r=PG", "display_name": "Conal", "link": "https://stackoverflow.com/users/127335/conal"}, "is_accepted": true, "score": 0, "last_activity_date": 1504800314, "creation_date": 1504800314, "answer_id": 46100846, "question_id": 46096938, "link": "https://stackoverflow.com/questions/46096938/how-to-apply-incremental-specificity-using-subclassing-in-haskell/46100846#46100846", "title": "How to apply incremental specificity, using subclassing in Haskell?", "body": "<p>Your first guess seems sensible enough to me, but no, Haskell doesn't let one define associated types or methods in a (sub)class definition. </p>\n"}], "owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 46100846, "answer_count": 1, "score": 1, "last_activity_date": 1504800314, "creation_date": 1504788906, "question_id": 46096938, "link": "https://stackoverflow.com/questions/46096938/how-to-apply-incremental-specificity-using-subclassing-in-haskell", "title": "How to apply incremental specificity, using subclassing in Haskell?", "body": "<p>I'm trying to use subclassing, in Haskell, to apply incremental specificity to my classes and having no luck.</p>\n\n<p>My first attempt:</p>\n\n<pre><code>module Subclassing where\n\nclass SuperClass a where\n  type TheType a :: *\n  theFunc :: TheType a -&gt; TheType a\n\nclass SuperClass b =&gt; SubClass b where\n  type TheType b = Int\n\ndata MyType\n\ninstance SubClass MyType where\n  theFunc x = x + x\n</code></pre>\n\n<p>yielded this:</p>\n\n<pre><code>Subclassing.hs:10:8: error:\n    \u2018TheType\u2019 is not a (visible) associated type of class \u2018SubClass\u2019\n\nSubclassing.hs:15:3: error:\n    \u2018theFunc\u2019 is not a (visible) method of class \u2018SubClass\u2019\n</code></pre>\n\n<p>I wondered if there was some syntactical method for exposing the superclass' types/methods to the subclass. So, I searched around a bit on the net, but didn't find anything.</p>\n\n<p>In my second attempt, I tried to force the issue, by defining a universal instance of the superclass, constrained on the subclass:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies           #-}\n{-# LANGUAGE AllowAmbiguousTypes    #-}\n{-# LANGUAGE FlexibleInstances      #-}\n{-# LANGUAGE UndecidableInstances   #-}\n\nmodule Subclassing where\n\nclass SuperClass a where\n  type TheType a :: *\n  theFunc :: TheType a -&gt; TheType a\n\nclass SubClass b\ninstance SubClass c =&gt; SuperClass c where\n  type TheType c = Int\n\ndata MyType\n\ninstance SubClass MyType\ninstance SuperClass MyType where\n  theFunc x = x + x\n\ntestFunc :: SuperClass d =&gt; [TheType d] -&gt; TheType d\ntestFunc = sum . (map theFunc)\n</code></pre>\n\n<p>It yielded this:</p>\n\n<pre><code>Subclassing2.hs:25:23: error:\n    \u2022 Overlapping instances for SuperClass a0\n        arising from a use of \u2018theFunc\u2019\n      Matching givens (or their superclasses):\n        SuperClass d\n          bound by the type signature for:\n                     testFunc :: SuperClass d =&gt; [TheType d] -&gt; TheType d\n          at Subclassing2.hs:24:1-52\n      Matching instances:\n        instance SubClass c =&gt; SuperClass c\n          -- Defined at Subclassing2.hs:15:10\n        instance SuperClass MyType -- Defined at Subclassing2.hs:21:10\n      (The choice depends on the instantiation of \u2018a0\u2019)\n    \u2022 In the first argument of \u2018map\u2019, namely \u2018theFunc\u2019\n      In the second argument of \u2018(.)\u2019, namely \u2018(map theFunc)\u2019\n      In the expression: sum . (map theFunc)\n</code></pre>\n\n<p>In my third attempt, I tried making the subclass a type rather than a class.\n(I realized that this would have limited applicability, due to the single field limitation of the <em>newtype</em> value constructor, but was out of ideas.):</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies           #-}\n{-# LANGUAGE AllowAmbiguousTypes    #-}\n\nmodule Subclassing where\n\nclass SuperClass a where\n  type TheType a :: *\n  theFunc :: TheType a -&gt; TheType a\n\nnewtype SubClass = SubClass { unSubClass :: Int -&gt; Int }\ninstance SuperClass SubClass where\n  type TheType SubClass = Int\n  theFunc = unSubClass\n\ntestFunc :: SuperClass d =&gt; [TheType d] -&gt; TheType d\ntestFunc = sum . (map theFunc)\n</code></pre>\n\n<p>And it yielded this:</p>\n\n<pre><code>Subclassing3.hs:17:13: error:\n    \u2022 Couldn't match type \u2018Int -&gt; Int\u2019 with \u2018Int\u2019\n      Expected type: TheType SubClass -&gt; TheType SubClass\n        Actual type: SubClass -&gt; Int -&gt; Int\n    \u2022 In the expression: unSubClass\n      In an equation for \u2018theFunc\u2019: theFunc = unSubClass\n      In the instance declaration for \u2018SuperClass SubClass\u2019\n\nSubclassing3.hs:20:23: error:\n    \u2022 Couldn't match type \u2018TheType a0\u2019 with \u2018TheType d\u2019\n      Expected type: TheType a0 -&gt; TheType d\n        Actual type: TheType a0 -&gt; TheType a0\n      NB: \u2018TheType\u2019 is a type function, and may not be injective\n      The type variable \u2018a0\u2019 is ambiguous\n    \u2022 In the first argument of \u2018map\u2019, namely \u2018theFunc\u2019\n      In the second argument of \u2018(.)\u2019, namely \u2018(map theFunc)\u2019\n      In the expression: sum . (map theFunc)\n    \u2022 Relevant bindings include\n        testFunc :: [TheType d] -&gt; TheType d\n          (bound at Subclassing3.hs:20:1)\n</code></pre>\n"}, {"tags": ["class", "haskell", "show", "instances"], "comments": [{"owner": {"reputation": 23, "user_id": 5479108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0fcf65e445fe5e4e7b62e313d7fbea3d?s=128&d=identicon&r=PG&f=1", "display_name": "EntroKay", "link": "https://stackoverflow.com/users/5479108/entrokay"}, "edited": false, "score": 0, "creation_date": 1504771011, "post_id": 46090803, "comment_id": 79143428, "body": "NumId = Int in the testing"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1504771663, "creation_date": 1504771663, "answer_id": 46091152, "question_id": 46090803, "link": "https://stackoverflow.com/questions/46090803/cannot-show-result-from-an-instance-function-in-haskell/46091152#46091152", "title": "cannot show result from an instance function in haskell", "body": "<p>You have not given <code>k1</code> a fixed type. Because <code>keyBuild</code> can construct a key of <em>any</em> type with the right instance, it has the polymorphic type <code>k1 :: KEY k =&gt; k</code>. That's nice because you can then compare <code>k1</code> to keys of different concrete types... in your case, you've tried it with <code>k2 :: PrimaryKey</code>, but you could just as well do <code>k1 == k3</code> with <code>k3 :: SomeOtherKeyType</code>, provided <code>SomeOtherKeyType</code> is also an instance of the <code>KEY</code> class \u2013 in that case, <code>k1</code> would simply also \u201ctake over\u201d the type <code>SomeOtherKeyType</code>.</p>\n\n<p>The flip side is that <code>k1</code> has no <em>particular</em> type. It may in fact be <em>any</em> applicable type, but how is the compiler supposed to know which you want? When using <code>==</code> it must be the same type on both sides, so there it's sufficient to have a concrete type on one side, but all by itself <code>k1</code> is ambiguous.</p>\n\n<p>It so happens that in your module there is only one instance that matches, namely <code>KEY PrimaryKey</code> but in general there would be many (or zero!) such instances. It would be strange if the compiler just picked one arbitrarily, wouldn't it?</p>\n\n<p>So if you want to show <code>k1</code>, you need to manually pick one type. Easy enough to do, just add a local signature:</p>\n\n<pre><code>*Main&gt; let k1 = keyBuild 1 2 3\n*Main&gt; :t k1\nk1 :: KEY k =&gt; k\n*Main&gt; k1 :: PrimaryKey\nPK (1,2,3)\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 5479108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0fcf65e445fe5e4e7b62e313d7fbea3d?s=128&d=identicon&r=PG&f=1", "display_name": "EntroKay", "link": "https://stackoverflow.com/users/5479108/entrokay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 46091152, "answer_count": 1, "score": 2, "last_activity_date": 1504775394, "creation_date": 1504770480, "last_edit_date": 1504775394, "question_id": 46090803, "link": "https://stackoverflow.com/questions/46090803/cannot-show-result-from-an-instance-function-in-haskell", "title": "cannot show result from an instance function in haskell", "body": "<pre><code>class (Eq k, Ord k, Show k) =&gt; KEY k where\n  keyBuild    :: NumId -&gt; NumId -&gt; NumId  -&gt; k\n  keyDummy    :: k\n  keyFromList :: [NumId] -&gt; k\n  -- keyGenerate :: (DATAPOOL p) =&gt; p -&gt; Int -&gt; [k]  -- p = Pool k e s\n\n\nnewtype PrimaryKey = PK (NumId, NumId, NumId) deriving (Eq, Ord, Show) \n\ninstance KEY PrimaryKey where\n  keyBuild k0 k1 k2 = PK (k0,k1,k2)\n  keyDummy          = PK (0,0,0)\n  keyFromList is    = keyFromList (take 3 (is ++ (replicate 3 0)))\n  keyGenerate p cnt = let\n                        ks = keys p\n                        pks = map (\\l -&gt;  keyFromList (randomize l))                   (replicate cnt 3)\n                      in pks\n</code></pre>\n\n<p>in ghci I do</p>\n\n<pre><code>let k1 = keyBuild 1 2 3\nlet k2 = PK (1,2,3)\nk1 == k2 \nTrue\nk2\nPK (1,2,3)\n</code></pre>\n\n<p>and get True and the value of k2 as expected, but</p>\n\n<pre><code>k1\n231:1: error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018it\u2019\n      prevents the constraint \u2018(KEY a0)\u2019 from being solved.\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instance exist:\n        instance [safe] KEY PrimaryKey -- Defined at Work\n</code></pre>\n\n<p>Expected PK(1,2,3)\nPrimaryKey has deriving (Eq, Ord, Show) so what have I done wrong or missed? </p>\n"}, {"tags": ["haskell", "ghc", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 1193, "user_id": 1024626, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1f3105b2e91741b91b5af4431e26a0d6?s=128&d=identicon&r=PG", "display_name": "pretobomba", "link": "https://stackoverflow.com/users/1024626/pretobomba"}, "edited": false, "score": 0, "creation_date": 1504820552, "post_id": 46088235, "comment_id": 79174044, "body": "This is honestly extremely concerning. In a real world application where the numerator and denominator are coming from user input this case would show up only in a fraction of requests, making it extremely hard to debug. It seems like the general advice should be to avoid Data.Scientific at all costs and only use it when converting numbers to JSON."}], "tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": true, "score": 5, "last_activity_date": 1504760869, "creation_date": 1504760869, "answer_id": 46088235, "question_id": 46087887, "link": "https://stackoverflow.com/questions/46087887/haskell-hanging-on-number-conversion/46088235#46088235", "title": "Haskell hanging on number conversion", "body": "<p>The conversion of <code>10 % 9</code> (a Rational) to Scientific is what does not terminate.</p>\n\n<pre><code>10 / 9 :: Scientific\n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/scientific-0.3.5.2/docs/Data-Scientific.html\" rel=\"noreferrer\">From the documentation of Data.Scientific</a>:</p>\n\n<blockquote>\n  <p>WARNING: Although Scientific is an instance of Fractional, the methods\n  are only partially defined! Specifically recip and / will diverge\n  (i.e. loop and consume all space) when their outputs have an infinite\n  decimal expansion. fromRational will diverge when the input Rational\n  has an infinite decimal expansion. Consider using fromRationalRepetend\n  for these rationals which will detect the repetition and indicate\n  where it starts.</p>\n</blockquote>\n\n<p>Therefore, try this instead:</p>\n\n<pre><code>let Right (x, _) = fromRationalRepetend Nothing (10 / 9) in x\n</code></pre>\n\n<p>You will have to decide what measures are appropriate. I decided here to ignore the possibility of <code>Left</code>.</p>\n"}], "owner": {"reputation": 1193, "user_id": 1024626, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1f3105b2e91741b91b5af4431e26a0d6?s=128&d=identicon&r=PG", "display_name": "pretobomba", "link": "https://stackoverflow.com/users/1024626/pretobomba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 46088235, "answer_count": 1, "score": 1, "last_activity_date": 1504760985, "creation_date": 1504758914, "last_edit_date": 1504759300, "question_id": 46087887, "link": "https://stackoverflow.com/questions/46087887/haskell-hanging-on-number-conversion", "title": "Haskell hanging on number conversion", "body": "<p>I have the following piece of code that seems to consistently hang when running with after compiling with GHC (although no build failures with <code>-Werror</code>).</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Aeson\nimport Data.Scientific\nimport qualified Data.HashMap.Strict as S\n\nmyObj = Object $\n  S.fromList [(\"bla\", Number $ pc * 100.0)]\n  where pc = 10 / 9   \n</code></pre>\n\n<p>And when trying to access <code>myObj</code> the program will hang. After some digging it seems like haskell has a tough time with the number conversion (although no warnings or errors with the above snippet). If I change the <code>9</code> above to a <code>10</code>, it doesn't hang. But I'm curious, why does the above hang?</p>\n"}, {"tags": ["class", "haskell", "default", "subclassing", "repeat"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1504763410, "post_id": 46087632, "comment_id": 79139038, "body": "&quot;Even if the above compiles, it&#39;s ugly.&quot; I have bad news: it&#39;s ugly, <i>and</i> it doesn&#39;t compile."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1504772560, "post_id": 46087632, "comment_id": 79144393, "body": "Perhaps you should explain what is the problem you are trying to solve. As a very rough intuition, consider Haskell typeclasses as something that can be used to achieve OOP function overloading. Do you need that for your problem? As a general thumb rule, if you have only one instance, this is like having one overload, so you don&#39;t really need typeclasses to begin with."}], "answers": [{"comments": [{"owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "edited": false, "score": 0, "creation_date": 1504760491, "post_id": 46088048, "comment_id": 79137963, "body": "Thanks! But the crux of the problem (maybe not expressed properly in the OP) is that there will be several functions, <code>SimpleObservable</code>s, (of which <code>aveConst</code> in the OP is one example) that are <code>Observable</code>s in similar but different ways and I want to avoid code repetition between these. In a way the &quot;outer&quot; functionality (average in the example) will be common but the &quot;inner&quot; will not (multiplication of constant in example). Also, importantly, there will be other kinds of <code>Observable</code>s that have a different &quot;outer&quot; structure, i.e. not be <code>SimpleObservable</code>s."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "reply_to_user": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "edited": false, "score": 0, "creation_date": 1504761029, "post_id": 46088048, "comment_id": 79138153, "body": "Maybe spend more time with Haskell before trying to implement sophisticated abstractions, jorgen. I am having a difficult time understanding what you want to achieve. Many functions have the type <code>[a] -&gt; b</code> for various choices of <code>a</code> and <code>b</code>. <code>genericLength</code> is just one such function if we choose <code>b</code> to be some <code>Fractional</code> type."}, {"owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "edited": false, "score": 0, "creation_date": 1504761293, "post_id": 46088048, "comment_id": 79138250, "body": "In my opinion this is not very sophisticated, erisco. As stated the OP is a simplified sketch of the actual problem, which is why it&#39;s a bit contrived and seems to have a much simpler solution as you point out."}, {"owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "reply_to_user": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "edited": false, "score": 2, "creation_date": 1504761497, "post_id": 46088048, "comment_id": 79138326, "body": "You usually do not need to define new type classes. While common in OOP, it is uncommon in FP. What I mean is that you may more clearly see how to actualise your ideas if you spend more time with the basics of Haskell. I am not sure what an <code>Observable</code> is supposed to be, unless it is like that in C#, in which case there are already libraries which can help you depending on what specifically you need."}, {"owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "edited": false, "score": 0, "creation_date": 1504762563, "post_id": 46088048, "comment_id": 79138721, "body": "Hm, I guess I thought of the <code>Observable</code> class as an organising principle; every time I&#39;d want to write an observable the compiler will enforce that it has a function of the right type. Of course it will also complain if I try to use any function with the wrong signature in an &quot;observable-context,&quot; with a different warning. You may be right, maybe a new class is not the answer and doesn&#39;t give any more type safety."}], "tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 3, "last_activity_date": 1504759861, "creation_date": 1504759861, "answer_id": 46088048, "question_id": 46087632, "link": "https://stackoverflow.com/questions/46087632/set-of-functions-that-are-instances-in-a-common-way/46088048#46088048", "title": "Set of functions that are instances in a common way", "body": "<p>I do not fully understand the question yet but I'll edit this answer as I learn more.</p>\n\n<p>Something which acts on a list and produces a result can simply be a function. The interface (that is, the type) of this function can be <code>[a] -&gt; b</code>. This says the function accepts a list of elements of some type and returns a result of a possibly different type.</p>\n\n<p>Now, lets invent a small problem as an example. I want to take a list of lists, some function on lists which produces a number, apply this function to every list, and return the average of the numbers.</p>\n\n<pre><code>average :: (Fractional b) =&gt; ([a] -&gt; b) -&gt; [[a]] -&gt; b\naverage f xs = sum (fmap f xs) / genericLength xs\n</code></pre>\n\n<p>For example, <code>average genericLength</code> will tell me the average length of the sub-lists. I do not need to define any type classes or new types. Simply, I use the function type <code>[a] -&gt; b</code> for those functions which map a list to some result.</p>\n"}, {"comments": [{"owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "edited": false, "score": 0, "creation_date": 1504764293, "post_id": 46088793, "comment_id": 79139417, "body": "Good points! But the last paragraph is only true because this is a simplified sketch of the actual problem."}, {"owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "edited": false, "score": 0, "creation_date": 1504764481, "post_id": 46088793, "comment_id": 79139502, "body": "I guess my only problem with this is: if I mistakenly use as an observable a function with the right signature but which was never intended as an observable the compiler won&#39;t know. Or is this not a good way to think?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "edited": false, "score": 0, "creation_date": 1504766659, "post_id": 46088793, "comment_id": 79140642, "body": "@jorgen It&#39;s a fine way to think. In such cases you can use a <code>newtype</code> wrapper to distinguish between <code>Observable</code> and <code>[Int] -&gt; Int</code>; but exercise taste -- too many <code>newtype</code>s can be just as bad as too few."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1504763696, "creation_date": 1504763696, "answer_id": 46088793, "question_id": 46087632, "link": "https://stackoverflow.com/questions/46087632/set-of-functions-that-are-instances-in-a-common-way/46088793#46088793", "title": "Set of functions that are instances in a common way", "body": "<p>I propose going even simpler:</p>\n\n<pre><code>type Observable = [Int] -&gt; Int\n</code></pre>\n\n<p>Then, an averaging observable is:</p>\n\n<pre><code>average :: Observable\naverage ns = sum ns `div` length ns\n</code></pre>\n\n<p>If your <code>Observable</code> needs some data inside -- say, a constant to multiply by -- no problem; that's what closures are for. For example:</p>\n\n<pre><code>sumTimesConst :: Int -&gt; Observable\nsumTimesConst c = sum . map (c*)\n</code></pre>\n\n<p>You can abstract over the construction of <code>Observable</code>s without trouble; e.g. if you want a <code>SimpleObservable</code> which only looks at elements, and then sums, you can:</p>\n\n<pre><code>type SimpleObservable = Int -&gt; Int\n\ntimesConst :: Int -&gt; SimpleObservable\ntimesConst = (*)\n\nliftSimple :: SimpleObservable -&gt; Observable\nliftSimple f = sum . map f\n</code></pre>\n\n<p>Then <code>liftSimple . timesConst</code> is another perfectly fine way to spell <code>sumTimesConst</code>.</p>\n\n<p>...but honestly, I'd feel dirty doing <em>any</em> of the above things. <code>sum . map (c*)</code> is a perfectly readable expression without introducing a questionable new name for its type.</p>\n"}], "owner": {"reputation": 2781, "user_id": 1540547, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4f07f7dc869bd71c0ba13719468daeab?s=128&d=identicon&r=PG", "display_name": "jorgen", "link": "https://stackoverflow.com/users/1540547/jorgen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 1, "accepted_answer_id": 46088793, "answer_count": 2, "score": 2, "last_activity_date": 1504763696, "creation_date": 1504757323, "question_id": 46087632, "link": "https://stackoverflow.com/questions/46087632/set-of-functions-that-are-instances-in-a-common-way", "title": "Set of functions that are instances in a common way", "body": "<p>I'm pretty new to haskell and I think I'm falling into some OO traps. Here's a sketch of a structure (simplified) that I'm having trouble implementing:</p>\n\n<ul>\n<li><p>A concept of an Observable that acts on a list of samples (Int) to produce a result (Int)</p>\n\n<ul>\n<li>A concept SimpleObservable that achieves the result using a certain pattern (while there will be Observables that do it other ways), e.g. something like an average</li>\n</ul></li>\n<li><p>A function instance, e.g. one that's just an average times a constant </p></li>\n</ul>\n\n<p>My first thought was to use a subclass; something like (the below is kinda contrived but hopefully gets the idea across) </p>\n\n<pre><code>class Observable a where\n  estimate :: a -&gt; [Int] -&gt; Int\n\nclass (Observable a) =&gt; SimpleObservable a where\n  compute :: a -&gt; Int -&gt; Int\n  simpleEstimate :: a -&gt; [Int] -&gt; Int\n  simpleEstimate obs list = sum $ map compute list\n\ndata AveConst = AveConst Int\n\ninstance Observable AveConst where\n  estimate = simpleEstimate\n\ninstance SimpleObservable AveConst  where\n  compute (AveConst c) x = c * x\n</code></pre>\n\n<p>However, even if something like the above compiles it's ugly. Googling tells me <code>DefaultSignatures</code> might help in that I don't have to do <code>estimate = simpleEstimate</code> for each instance but from discussions around it it seems doing it this way would be an antipattern.</p>\n\n<p>Another option would be to have no subclass, but something like (with the same <code>Observable</code> class):</p>\n\n<pre><code>data AveConst = AveConst Int\n\ninstance Observable AveConst where\n  estimate (AveConst c) list = sum $ map (*c) list\n</code></pre>\n\n<p>But this way I'm not sure how to reuse the pattern; each <code>Observable</code> has to contain the complete <code>estimate</code> definition and there will be code repetition.</p>\n\n<p>A third way is a type with a function field:</p>\n\n<pre><code>data SimpleObservable = SimpleObservable {\n  compute :: [Int] -&gt; Int\n} \n\ninstance Observable SimpleObservable where\n  estimate obs list =\n    sum $ map (compute obs) list\n\naveConst :: Int -&gt; SimpleObservable\naveConst c = SimpleObservable {\n  compute = (*c)\n}\n</code></pre>\n\n<p>But I'm not sure this is idiomatic either. Any advice? </p>\n"}, {"tags": ["haskell", "tree"], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1504773198, "post_id": 46089815, "comment_id": 79144779, "body": "At a glance, I suspect it doesn&#39;t correctly handle trees containing duplicate values"}, {"owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1504773608, "post_id": 46089815, "comment_id": 79145044, "body": "@luqui yes, that&#39;s true, this is just a piece code showing the algorithm. Talking about duplicates, so how to restore a tree with <code>0 0 0 0... 0</code> and <code>0 0 0 0... 0</code>? That&#39;s another question, with type signature <code>[a]-&gt;[a]-&gt;[Tree a]</code>. Duplicates makes us enumerate. But they share the same thoughts IMHO."}], "tags": [], "owner": {"reputation": 3633, "user_id": 675154, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/23da6806cab4830b5d1b15ef2a410541?s=128&d=identicon&r=PG", "display_name": "delta", "link": "https://stackoverflow.com/users/675154/delta"}, "is_accepted": true, "score": 4, "last_activity_date": 1504767477, "creation_date": 1504767477, "answer_id": 46089815, "question_id": 46087406, "link": "https://stackoverflow.com/questions/46087406/generating-a-tree-based-on-two-lists/46089815#46089815", "title": "Generating a tree based on two lists", "body": "<p><strong>in</strong> and <strong>pre</strong> describes the <strong>position</strong> of the <strong>root</strong> in the sequence. So:</p>\n\n<ol>\n<li>the <strong>first</strong> element of <code>inorder</code> sequence is the <strong>root</strong>. Then left subtree inorder sequences followed by right subtree's. but we don't know where the right subtree sequence begins.</li>\n<li>if we can locate the <strong>root</strong> in <code>preorder</code> sequence, then the left side is the preorder sequences of the left subtree, right hand is the preorder sequence of the right subtree.</li>\n</ol>\n\n<p>Assume we have a binary tree like this:</p>\n\n<pre><code>  1\n / \\\n2   3\n   /  \\\n  4    5\n\npreorder: 1 2 3 4 5\ninorder : 2 1 4 3 5\n</code></pre>\n\n<p>Let's build it back! OK, look at preorder sequence <code>1 2 3 4 5</code>. We know 1 is the root.</p>\n\n<pre><code>[1] 2 3 4 5\n2 [1] 4 3 5\n</code></pre>\n\n<p><code>2</code> is left subtree's inorder sequence. <code>4 3 5</code> is right subtree's. And also we have known:</p>\n\n<ol>\n<li>left subtree has only <em>1</em> node, right has <em>3</em> nodes!</li>\n<li>left subtree preorder sequences aside right's preorder sequence is <code>2 3 4 5</code></li>\n</ol>\n\n<p>as a result, left's preorder is <code>2</code>, right's is <code>3 4 5</code>.</p>\n\n<p>And the recursive begins. until we have nothing! that is the empty sequence. Then we have met the <code>Leaf</code>.</p>\n\n<hr>\n\n<p>Summarized it up, we have the following Haskell code. (This does not handle the incorrect input situation)</p>\n\n<pre><code>data Tree a = Branch a (Tree a) (Tree a)\n            | Leaf\n            deriving Show\n--                 pre    in\ngenTree :: Eq a =&gt; [a] -&gt; [a] -&gt; Tree a\ngenTree [] [] = Leaf\ngenTree (root:pre_seq) in_seq = Branch root left right\n  where\n    (left_in, _:right_in) = break   (== root)        in_seq\n    (left_pre, right_pre) = splitAt (length left_in) pre_seq\n    left  = genTree left_pre  left_in\n    right = genTree right_pre right_in\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 8542117, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/abe9b7ac3afe582ee17e633bf060b9f9?s=128&d=identicon&r=PG&f=1", "display_name": "john", "link": "https://stackoverflow.com/users/8542117/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "closed_date": 1504791084, "accepted_answer_id": 46089815, "answer_count": 1, "score": 0, "last_activity_date": 1504767477, "creation_date": 1504755413, "last_edit_date": 1504755591, "question_id": 46087406, "link": "https://stackoverflow.com/questions/46087406/generating-a-tree-based-on-two-lists", "closed_reason": "Duplicate", "title": "Generating a tree based on two lists", "body": "<p>i'd like to know how to generate a tree based in two lists. The first one representing a pre-order and the second one an in-order one of the wanted tree to be generated, for example:</p>\n\n<pre><code>data Tree a = Branch a (Tree a) (Tree a) | Leaf deriving Show\ngenTree :: [a] -&gt; [a] -&gt; Tree a\ngenTree [7,9,2] [9,7,2] = \nBranch 7 (Branch 9 Leaf Leaf ) (Branch 2 Leaf Leaf )\n</code></pre>\n\n<p>Any suggestion is accepted, Thanks!!</p>\n"}, {"tags": ["haskell", "monads", "functor"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1504770783, "post_id": 46087160, "comment_id": 79143287, "body": "I noticed that <code>\\f x -&gt; contrabind (return x) f :: (m b -&gt; a) -&gt; a -&gt; m b</code>. Somehow I don&#39;t like how we can flip the direction of these functions: every contramonad must support that, which seems hard to achieve.  Also, <code>contrabind (return ()) (const ()) : m b</code> for any <code>b</code> looks quite weird."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1504772926, "post_id": 46087160, "comment_id": 79144623, "body": "<a href=\"https://stackoverflow.com/questions/30641500/are-there-contravariant-monads\" title=\"are there contravariant monads\">stackoverflow.com/questions/30641500/&hellip;</a>"}, {"owner": {"reputation": 119, "user_id": 8571971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5841623ef0b3e547ed95c2db1d407285?s=128&d=identicon&r=PG", "display_name": "E8xE8", "link": "https://stackoverflow.com/users/8571971/e8xe8"}, "edited": false, "score": 0, "creation_date": 1504829195, "post_id": 46087160, "comment_id": 79176491, "body": "The function is flipped because m is a contravariant functor.  Thus, a function from <code>m b -&gt; a</code> becomes a function from <code>m a -&gt; m (m b))</code>.  Every contramonad can achieve this as long as it is contravariant instead of covariant.  You can write <code>contrabind x f = join.contramap (f x)</code>.  The <code>contramap f</code> function almost always works by precomposing with f as opposed to the normal postcomposition with f.  That&#39;s how most contravariant functors work.  A <code>ContraMonad</code> should be exactly like a <code>Monad</code> except for the fact that it&#39;s contravariant.  Thus, <code>return</code> and <code>join</code> shouldn&#39;t change."}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 8571971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5841623ef0b3e547ed95c2db1d407285?s=128&d=identicon&r=PG", "display_name": "E8xE8", "link": "https://stackoverflow.com/users/8571971/e8xe8"}, "edited": false, "score": 0, "creation_date": 1504829691, "post_id": 46093869, "comment_id": 79176575, "body": "So, if I may ask, what would <code>join</code> be for <code>Predicate</code>?  Is it possible to write the code implementing <code>join :: Predicate (Predicate a) -&gt; Predicate a</code> in Haskell?  If so, what is that code?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 119, "user_id": 8571971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5841623ef0b3e547ed95c2db1d407285?s=128&d=identicon&r=PG", "display_name": "E8xE8", "link": "https://stackoverflow.com/users/8571971/e8xe8"}, "edited": false, "score": 0, "creation_date": 1504838606, "post_id": 46093869, "comment_id": 79178486, "body": "<code>Predicate (Predicate a)</code> is <code>(a -&gt; Bool) -&gt; Bool</code>. There&#39;s no way to convert that to <code>a -&gt; Bool</code>. An  <code>a -&gt; Bool</code> is exactly what you need to get anything non-trivial out of <code>(a -&gt; Bool) -&gt; Bool</code>!"}, {"owner": {"reputation": 119, "user_id": 8571971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5841623ef0b3e547ed95c2db1d407285?s=128&d=identicon&r=PG", "display_name": "E8xE8", "link": "https://stackoverflow.com/users/8571971/e8xe8"}, "edited": false, "score": 0, "creation_date": 1504841966, "post_id": 46093869, "comment_id": 79179290, "body": "So there&#39;s no way to take the <code>predAnd</code> of all possible predicates in <code>Predicate( Predicate a)</code>?  I know it might not be possible to implement in Haskell, but at least in theory, it can be calculated in many cases.  It can always be calculated if a is a finite set."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 119, "user_id": 8571971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5841623ef0b3e547ed95c2db1d407285?s=128&d=identicon&r=PG", "display_name": "E8xE8", "link": "https://stackoverflow.com/users/8571971/e8xe8"}, "edited": false, "score": 0, "creation_date": 1504860402, "post_id": 46093869, "comment_id": 79186935, "body": "Try it for a small data type, like <code>a ~ Word8</code>"}, {"owner": {"reputation": 119, "user_id": 8571971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5841623ef0b3e547ed95c2db1d407285?s=128&d=identicon&r=PG", "display_name": "E8xE8", "link": "https://stackoverflow.com/users/8571971/e8xe8"}, "edited": false, "score": 0, "creation_date": 1504999620, "post_id": 46093869, "comment_id": 79234283, "body": "I have some ideas, but there&#39;s not enough room to type them all here.  First, we would need to require the <code>a</code> in <code>Pred a</code> to be in the <code>Eq</code> typeclass.  Then, we can find a way to define <code>Pred a</code> as being in <code>Eq</code> by saying two predicates are equal if and only if they are true for exactly the same terms of <code>a</code>.  Finally, we could construct a new data type, <code>data Remove a = Rmv {getRmv :: [a]}</code> which represents the data type <code>a</code> with the elements of the list being removed.  This would allow us to recursively call <code>join</code>, removing each predicate from <code>Pred a</code> one at a time."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 119, "user_id": 8571971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5841623ef0b3e547ed95c2db1d407285?s=128&d=identicon&r=PG", "display_name": "E8xE8", "link": "https://stackoverflow.com/users/8571971/e8xe8"}, "edited": false, "score": 0, "creation_date": 1505006405, "post_id": 46093869, "comment_id": 79235251, "body": "That&#39;s not the problem. Check out the universe package, it defines equality for types with finite universes. The problem is that once you start considering all possible predicates <code>a -&gt; Bool</code> the number of predicates is <code>2^a</code>. So computing all the predicates to see if they&#39;re admitted by <code>Predicate (Predicate a)</code> would take on the order of 2^256 steps when <code>a</code> is an 8 bit word."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 119, "user_id": 8571971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5841623ef0b3e547ed95c2db1d407285?s=128&d=identicon&r=PG", "display_name": "E8xE8", "link": "https://stackoverflow.com/users/8571971/e8xe8"}, "edited": false, "score": 0, "creation_date": 1505006563, "post_id": 46093869, "comment_id": 79235271, "body": "If you replace the predicates with sets then sets are an ordinary monad where join is set union. You need something like <a href=\"https://github.com/leftaroundabout/constrained-categories\" rel=\"nofollow noreferrer\"><code>constrained-categories</code></a>, because you need an <code>Ord a</code> or at least <code>Eq a</code> constraint to join <code>Set (Set a)</code> into <code>Set a</code>."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 3, "last_activity_date": 1504779984, "last_edit_date": 1504779984, "creation_date": 1504779558, "answer_id": 46093869, "question_id": 46087160, "link": "https://stackoverflow.com/questions/46087160/implementing-predicate-types-as-contravariant-monads/46093869#46093869", "title": "Implementing predicate types as contravariant monads?", "body": "<p>There is something related, the contravariant version of <code>Applicative</code> is <a href=\"https://hackage.haskell.org/package/contravariant-1.4/docs/Data-Functor-Contravariant-Divisible.html\" rel=\"nofollow noreferrer\"><code>Divisible</code></a>, which I've simplified here</p>\n\n<pre><code>class Contravariant f =&gt; Divisible f where\n  divide  :: f b -&gt; f c -&gt; f (b, c)\n  conquer :: f a\n</code></pre>\n\n<p>The <code>divide</code> in <code>Data.Functor.Contravariant.Divisible</code> is written in terms of <code>a -&gt; (b, c)</code> which highlights the idea of dividing the work for <code>a</code> into the work for <code>b</code> and <code>c</code>.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\n-- The divide from Data.Functor.Contravariant.Divisible\ndivide' :: Divisible f =&gt; (a -&gt; (b, c)) -&gt; f b -&gt; f c -&gt; f a\ndivide' f b c = contramap f $ divide b c\n\n-- And a proof they types are equivalent\nproof :: (forall a b c. (a -&gt; (b, c)) -&gt; f b -&gt; f c -&gt; f a) -&gt; f b -&gt; f c -&gt; f (b, c)\nproof divide' = divide' id\n</code></pre>\n\n<p>Any <code>Op</code> is <code>Divisible</code> if its result is a <code>Monoid</code>. This is a generalization of <code>Predicate</code>, which is <a href=\"https://hackage.haskell.org/package/contravariant-1.4/docs/Data-Functor-Contravariant.html#t:Op\" rel=\"nofollow noreferrer\"><code>Op</code></a> <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Monoid.html#t:All\" rel=\"nofollow noreferrer\"><code>All</code></a></p>\n\n<pre><code>import Data.Monoid\n\nnewtype Op r a = Op {runOp :: a -&gt; r}\n\ninstance Contravariant (Op r) where\n  contramap f (Op g) = Op (g . f)\n\ninstance Monoid r =&gt; Divisible (Op r) where\n  divide (Op f) (Op g) = Op (\\(b, c) -&gt; f b &lt;&gt; g c)\n  conquer = Op (const mempty)\n</code></pre>\n\n<hr>\n\n<p>As a bonus, <code>Op r</code> is a <code>Monoid</code> as long as the result <code>r</code> is a moniod, which provides a straightforward way to define <code>predAnd</code></p>\n\n<pre><code>instance Monoid a =&gt; Monoid (Op a b) where\n  mempty = Op (const mempty)\n  mappend (Op p) (Op q) = Op $ \\a -&gt; mappend (p a) (q a)\n\ntype Predicate a = Op All a\n\npredAnd :: Predicate a -&gt; Predicate a -&gt; Predicate a\npredAnd = mappend \n</code></pre>\n\n<p>But that's <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/src/GHC.Base.html#line-270\" rel=\"nofollow noreferrer\">hardly surprising</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 119, "user_id": 8571971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5841623ef0b3e547ed95c2db1d407285?s=128&d=identicon&r=PG", "display_name": "E8xE8", "link": "https://stackoverflow.com/users/8571971/e8xe8"}, "edited": false, "score": 0, "creation_date": 1505029787, "post_id": 46138454, "comment_id": 79238786, "body": "As an addendum, another very natural operator, which gives the union of all true predicates would be <code>isSufficient :: Predicate( Predicate a) -&gt; Predicate a</code> where <code>isSufficient p = Pred(\\x -&gt; (getPred p) (\\y -&gt; y == x))</code>.  This would let you know if <code>x</code> is sufficient for a predicate to be judged as true.  Unlike necessity, this is straightforward to implement and requires no additional rules."}], "tags": [], "owner": {"reputation": 119, "user_id": 8571971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5841623ef0b3e547ed95c2db1d407285?s=128&d=identicon&r=PG", "display_name": "E8xE8", "link": "https://stackoverflow.com/users/8571971/e8xe8"}, "is_accepted": false, "score": 0, "last_activity_date": 1505029667, "creation_date": 1505029667, "answer_id": 46138454, "question_id": 46087160, "link": "https://stackoverflow.com/questions/46087160/implementing-predicate-types-as-contravariant-monads/46138454#46138454", "title": "Implementing predicate types as contravariant monads?", "body": "<p>I think I may have thought of a partial answer to my own question.  First, we must force <code>a</code> to be in the <code>Eq</code> typeclass.</p>\n\n<pre><code>join p = Pred(\\x -&gt; not ((getPred p) (\\y -&gt; y /= x)))\n</code></pre>\n\n<p>This is a predicate which takes an element of type <code>a</code> and constructs a predicate out of it, namely the predicate where x is false and everything else is true.  Then, it evaluates this predicate according to the original <code>Pred( Pred a)</code> judgment.</p>\n\n<p>If this predicate is true, than it is the case that x is not in the intersection of all predicates, and thus the final predicate sends x to False.  On the other hand, if this predicate is false, it is not necessarily the case that <code>x</code> is in the intersection, unless we make an additional rule:</p>\n\n<p>If the <code>Pred( Pred a)</code> judgment rules a nearly maximal predicate false, the element ruled false in the nearly maximal predicate must appear in all predicates judged to be true.</p>\n\n<p>Thus, the judgment \"The predicate f is true for all even numbers.\" is allowed under this rule, but the judgment \"The predicate f is true only for even numbers.\" is not allowed.  If a judgment of the first kind is used, <code>join</code> will give the intersection of all true predicates.  In the second case, <code>join</code> will simply give a predicate which can sometimes tell you if <code>x</code> is unnecessary.  If it returns <code>False</code>, <code>x</code> is definitely unnecessary.  If it returns <code>True</code>, the test is inconclusive.</p>\n\n<p>I'm now convinced that a full implementation of \"ANDing\" is impossible unless the type <code>a</code> is finite and even then is impractical unless <code>a</code> is very small.</p>\n"}], "owner": {"reputation": 119, "user_id": 8571971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5841623ef0b3e547ed95c2db1d407285?s=128&d=identicon&r=PG", "display_name": "E8xE8", "link": "https://stackoverflow.com/users/8571971/e8xe8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1505029667, "creation_date": 1504753296, "question_id": 46087160, "link": "https://stackoverflow.com/questions/46087160/implementing-predicate-types-as-contravariant-monads", "title": "Implementing predicate types as contravariant monads?", "body": "<p>I'm pretty sure I can show that, in principle, the <code>Predicate</code> type constructor is a <code>ContraMonad</code>, a generalization of <code>Monad</code> where the functor is contravariant, but I'm not sure how it would be implemented.</p>\n\n<p>First, let's define some terms: </p>\n\n<pre><code>class Contravariant f where\n    contramap :: (b -&gt; a) -&gt; f a -&gt; f b\n\nclass ContraMonad m where\n    return :: a -&gt; m a\n    join :: m(m a) -&gt; m a\n    contrabind :: m a -&gt; (m b -&gt; a) -&gt; m b\n\ndata Predicate a = Pred {getPred :: a -&gt; Bool}\n\ninstance Contravariant Predicate where\n    contramap f x = Pred ((getPred x).f)\n</code></pre>\n\n<p>This shows that a predicate, which is a function that takes values of a and generates propositions from them, is a contravariant functor from Hask to Hask^{op}.  An example of a predicate would be:</p>\n\n<pre><code>isEven :: Integer -&gt; Bool\nisEven n = if (mod n 2 == 0)\n           then True\n           else False\n</code></pre>\n\n<p>The function <code>isEven</code> is a predicate in the mathematical sense, while <code>Pred isEven</code> is a <code>Predicate</code> in the sense implemented here.</p>\n\n<p>Implementing <code>Predicate</code> as a <code>ContraMonad</code> is trickier.</p>\n\n<p>There is only one natural choice for <code>return</code>.</p>\n\n<pre><code>return :: a -&gt; Predicate a\nreturn x = Pred(const True)\n</code></pre>\n\n<p>You may consider the possibility of 'return' giving a Predicate for which x is true and no other elements of type a are true.  The problem is that this can only be implemented if a is a member of the <code>Eq</code> typeclass.</p>\n\n<p>It is easier to think about join than <code>contrabind</code>.  Clearly, we want</p>\n\n<pre><code>contrabind x f = join.contramap f x\n</code></pre>\n\n<p>so that contrabind resembles bind as much as possible while taking account of f as a contravariant functor.  The function <code>f</code> takes <code>Pred b</code> to <code>a</code>, so <code>contramap f</code> takes <code>Pred a</code> to <code>Pred(Pred b)</code>.</p>\n\n<p>So, what should <code>join</code> do?  It must take a Predicate of a Predicate of type a to a Predicate of type a.  A Predicate of a Predicate of type a makes a judgement about predicates of type a.  As an example, consider a = Integer.  An example of <code>Pred( Pred Integer)</code> is:</p>\n\n<pre><code>Pred(\"The predicate f is true for all even numbers.\")\n</code></pre>\n\n<p>Where I have used a quote in place of an actual implementation.  If it is the case that f is true for all evens, then this statement is true.  For example, <code>Pred isEven</code> would evaluate to <code>True</code>.</p>\n\n<p>Considering the fact that predicates on a set A are correspond to subsets of A, a <code>Pred(Pred A)</code> is a wrapper for a function that takes all subsets of A and judges them as \"True\" or \"False.\"  We want <code>join</code> to give us a predicate, which is the same as giving a subset of A.  This subset should be as lossless as possible.  In fact, it should care about the truth value of every single <code>Pred X</code>, w.r.t. the <code>Pred(Pred X)</code> judgment.  The natural solution seems, to me, to be the intersection of all subsets judged as \"True,\" which is the same thing as \"ANDing\" together all true predicates where</p>\n\n<pre><code>predAnd :: (a -&gt; Bool) -&gt; (a -&gt; Bool) -&gt; (a -&gt; Bool)\npredAnd p q = \\x -&gt; ((getPred p) $ x) &amp;&amp; ((getPred q) $ x)\n</code></pre>\n\n<p>As an example, let's go back to \"The predicate f is true for all even numbers.\"  Every predicate evaluated as <code>True</code> under this judgment must be true for all evens, so every possible subset contains the evens.  The intersection of all these sets will simply be the set of evens, so <code>join</code> would return the predicate <code>Pred isEven</code>.</p>\n\n<p>My question is this, how would 'join' actually be implemented?  Can it be implemented?  I can see potential problems with undecidable sets arising for infinite types like 'Integer', but could it even be implemented for finite types like 'Char', where even the power set has finite cardinality?</p>\n"}]