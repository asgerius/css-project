[{"tags": ["haskell", "audio", "wav", "data-conversion"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 3, "creation_date": 1484167233, "post_id": 41599845, "comment_id": 70403332, "body": "How do you want to decode those 24 bits into a <code>Float</code>? You had mentioned <code>Data.Binary.IEEE754</code> in your previous question. In the source there is an example of decoding a 16 bit float, I would expect you need something similar for your 24 bits and then you can use <code>Data.Binary</code> to decode your stream."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 1, "creation_date": 1484169820, "post_id": 41599845, "comment_id": 70404683, "body": "Good luck with using that lib, it reads samples into a nested linked list. Last time I needed something like this I developed <code>wave</code>: <a href=\"https://hackage.haskell.org/package/wave\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/wave</a>. Without knowing your untimate goal it&#39;s hard to advise what is the best way to do what you want to do."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1484212172, "post_id": 41599845, "comment_id": 70419680, "body": "@Mark I&#39;m not planning to use that lib. I&#39;ve written my own library that streams the content of the .wav file using <code>Conduit</code>s. The only part I use from the library is the <code>ByteString</code> to <code>Double</code> conversion. But I&#39;m looking for something more efficient."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1484214336, "post_id": 41599845, "comment_id": 70421066, "body": "@ryachza I don&#39;t know how I want to decode those 24 bits into a <code>Float</code>. That&#39;s my problem. I do not understand the example for 16 bits enough to make my own version for 24 bits."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1484214483, "post_id": 41599845, "comment_id": 70421166, "body": "@Mark Why is my ultimate goal important to solving this subproblem? I just need a way to convert my <code>ByteString</code>, I get from reading 3 bytes from the data chunk of the .wav file, to a <code>Float</code> (between -1 and 1). E.g. <code>hGet</code> gives me this <code>ByteString</code>: <code>&quot;\\131\\237\\242&quot;</code>. It should be converted to a float containing <code>-0.10212671756744385</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484215453, "post_id": 41599845, "comment_id": 70421843, "body": "Are you sure those samples in the file correspond to <i>floating point</i>, but within 24 bits? That would be a heck of a weird format. Normally, <code>.wav</code> files use fixed precision up to 24-bit, and floating point for 32-bit or 64-bit."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484216017, "post_id": 41599845, "comment_id": 70422225, "body": "@leftaroundabout Yes, I&#39;m sure."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484216928, "post_id": 41599845, "comment_id": 70422836, "body": "Well, such a format is not included in the IEEE754 standard, nor do I think it&#39;s actually legal in a wav file. You&#39;ll need to manually sort out mantissa and exponent through bit twiddling."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484217755, "post_id": 41599845, "comment_id": 70423459, "body": "@leftaroundabout Is that really necessary? I&#39;ve added my current solution to my question. In that solution i&#39;m just converting the <code>ByteString</code> to an <code>Int32</code> and then I&#39;m converting the <code>Int32</code> to a <code>Double</code>. This works, but I want to get rid of the intermediate conversion to <code>Int32</code> and I would like a <code>Float</code> result instead of a <code>Double</code>. This conversion is based on the source code of <code>Data.WAVE</code> where samples are represented by <code>Int32</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484219703, "post_id": 41599845, "comment_id": 70424748, "body": "Well, fine, if that works it means that the samples are stored in 24-bit <i>integral</i> format. Which makes sense too \u2013 48kHz int24 is one of the most common audio formats."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484220121, "post_id": 41599845, "comment_id": 70425033, "body": "@leftaroundabout Does that mean that there isn&#39;t a more efficient conversion than I&#39;m currently using?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484220388, "post_id": 41599845, "comment_id": 70425209, "body": "Well, you should most definitely avoid the intermediate list of <code>Word8</code>s. Use a serialisation library to get at the <code>Int24</code> values, then use <code>fromIntegral intV &#47; 2^23</code> on these. I wouldn&#39;t scale the different signs differently \u2013 the only notable difference that would make is to introduce a little bit of distortion."}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1484224888, "post_id": 41599845, "comment_id": 70428194, "body": "<code>wave</code> does not impose how you read and write contents of WAVE file, you can do it with conduits just as well, you can even do it in C. Why not use something existing and well-tested on build on top of that?"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484227599, "post_id": 41599845, "comment_id": 70429937, "body": "@leftaroundabout I&#39;ve avoided having to <code>unpack</code> the <code>ByteString</code> by directly folding over the <code>ByteString</code> with <code>ByteString.foldr</code>. I&#39;ve also used the same scale for each sign. This didn&#39;t result in a performance increase though. Can you point me to an example of using a serialisation library to get at the <code>Int24</code>&#39;s values?"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1484227849, "post_id": 41599845, "comment_id": 70430105, "body": "@Mark All I need is a list/array representation of the samples in my .wav file. From there, I&#39;ve written all the functions to manipulate and extract the required information. The data in the .wav files is not really &quot;audio&quot;, it is a artificially created signal that represents the &quot;state&quot; of an engine in time. Values range from -1 to 1 and I just need to analyze a list of them. What would you recommend that is existing and well-tested?"}], "answers": [{"tags": [], "owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "is_accepted": false, "score": 0, "last_activity_date": 1484233353, "last_edit_date": 1484233353, "creation_date": 1484232642, "answer_id": 41616108, "question_id": 41599845, "link": "https://stackoverflow.com/questions/41599845/convert-wav-audio-format-bytestring-to-floats/41616108#41616108", "title": "Convert wav audio format ByteString to Floats", "body": "<p>I'm using this to convert to <code>Double</code>, it seems it could help with floats too - it assumes the binary representation of the underlying number is the same as the in-memory representation.:\n<a href=\"https://hackage.haskell.org/package/reinterpret-cast\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/reinterpret-cast</a></p>\n\n<pre><code>wordToFloat :: Word32 -&gt; Float\n</code></pre>\n\n<p>It seems however that the 24-bit in WAV would have different memory characteristics than your underlying platform - if you find the correct mantissa/exponent lengths, it should be quite easy to convert it to proper 32-bit float and use this function to do the conversion.</p>\n"}, {"comments": [{"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 1, "creation_date": 1484384662, "post_id": 41636323, "comment_id": 70495815, "body": "This could definitely help! Though, it doesn&#39;t give me the correct result. I&#39;ve been looking at the source code of the WAVE parser that works for my .wav files (Data.WAVE) and it says in the module description: <code>This module currently supports reading and writing single-section little-endian PCM audio files containing up to 32-bit samples encoded according to the well-known WAVE sample encoding.&#39;. So I think the problem is that your conversion uses big-endian. I think you&#39;re right about the values being 24 bit integers that have to be normalized. I will take a look at the </code>Get` monad. Thank you"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1484400702, "post_id": 41636323, "comment_id": 70499757, "body": "@ThomasVanhelden Yeah it&#39;s definitely a matter of inverting whatever the original encoding is. If it was little-endian, I think you would just need to reverse the indices (2,1,0 instead of 0,1,2)."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 1, "creation_date": 1484408617, "post_id": 41636323, "comment_id": 70502204, "body": "Reversing the indices (0,1,2 to 2,1,0) did the trick. The performance is better than my current implementation. Thank you!"}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 0, "creation_date": 1484408895, "post_id": 41636323, "comment_id": 70502288, "body": "By the way, removing the redundant lambda expression seems to do even better."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "edited": false, "score": 1, "creation_date": 1484409490, "post_id": 41636323, "comment_id": 70502485, "body": "@ThomasVanhelden Are you referring to the <code>\\s -&gt;</code> versus <code>int32_24be s =</code>? The difference is related to inlining as I believe GHC will only inline fully applied functions. So the performance may vary based on optimizations and exact use."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": true, "score": 3, "last_activity_date": 1484316122, "creation_date": 1484316122, "answer_id": 41636323, "question_id": 41599845, "link": "https://stackoverflow.com/questions/41599845/convert-wav-audio-format-bytestring-to-floats/41636323#41636323", "title": "Convert wav audio format ByteString to Floats", "body": "<p>Does something like this help:</p>\n\n<pre><code>import Data.Int (Int32)\nimport Data.Bits ((.|.),(.&amp;.),unsafeShiftL)\nimport Data.Word (Word32)\nimport Data.Binary\nimport qualified Data.ByteString as BS\nimport qualified Data.ByteString.Unsafe as BSU\n\nint32_24be :: BS.ByteString -&gt; Int32\nint32_24be = \\s -&gt;\n  let x =   unsafeShiftL (fromIntegral (BSU.unsafeIndex s 0)) 16\n        .|. unsafeShiftL (fromIntegral (BSU.unsafeIndex s 1))  8\n        .|.               fromIntegral (BSU.unsafeIndex s 2)\n        :: Int32\n      y = fromIntegral x :: Word32\n  in fromIntegral (if x .&amp;. 0x00800000 &gt; 0 then y .|. 0xFF000000 else y .&amp;. 0x00FFFFFF)\n\ngetFloat :: BS.ByteString -&gt; Float\ngetFloat = (/ 2^^23) . fromIntegral . int32_24be\n</code></pre>\n\n<p>My thought is that the 24 bit values are integers, and you want to normalize them to a float between -1 and 1 (positive 1 excluded, though). If this is the case, I'm thinking you would be able to use <code>getFloat</code> with <code>Data.Binary.Get</code> to parse your stream 24 bits at a time.</p>\n"}], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 504, "favorite_count": 1, "accepted_answer_id": 41636323, "answer_count": 2, "score": 0, "last_activity_date": 1484316122, "creation_date": 1484165310, "last_edit_date": 1484217605, "question_id": 41599845, "link": "https://stackoverflow.com/questions/41599845/convert-wav-audio-format-bytestring-to-floats", "title": "Convert wav audio format ByteString to Floats", "body": "<p>I'm working on sensor data that is stored in .wav files. The samples represent floating point numbers between -1 and 1. </p>\n\n<p>I'm reading samples from the .wav file as <code>ByteString</code>s and I need a way to convert this <code>ByteString</code> to a <code>Float</code>. So I'm looking for a function with the following signature:</p>\n\n<p><code>toFloat :: ByteString -&gt; Float</code></p>\n\n<p>For example. I'm working with a .wav file that contains 1 channel, has a framerate of 48kHz and samples consist of 24 bits. This means that each sample consists of 3 bytes and I can read it from the .wav file like this:\n<code>hGet h 3</code>.\n Here, <code>h</code> is the handle of the .wav file. </p>\n\n<p>How can I convert this ByteString I get from <code>hGet</code> to a <code>Float</code> (between -1 and 1)?</p>\n\n<p>As you can see in my <a href=\"https://stackoverflow.com/questions/41143884/bytestring-representation-of-a-double-conversion\">previous question</a>, I'm currently converting the <code>ByteString</code> to a <code>Double</code> by first converting it to an <code>Int32</code> (based on <a href=\"http://hackage.haskell.org/package/WAVE-0.1.1/docs/Data-WAVE.html\" rel=\"nofollow noreferrer\">Data.WAVE</a>). Since my samples are never bigger than 32 bits, I would like to use <code>Float</code>s instead of <code>Double</code>s. I'm also looking for a more efficient way of doing this conversion. </p>\n\n<p><strong>EDIT</strong>\nI'm currently converting the <code>ByteString</code> first to an <code>Int32</code> and then to a <code>Double</code>. This is done by <code>bsToDouble</code>:</p>\n\n<pre><code>convertNBytesLen :: [Word8] -&gt; Int32\nconvertNBytesLen = foldr accum 0\n  where accum bs a = 256 * a + fromIntegral bs\n\n\nbsToDouble :: S.ByteString -&gt; Int -&gt; Double\nbsToDouble bs n = if intV &gt;= 0\n                   then fromIntegral intV / 2147483647\n                   else - (fromIntegral intV / (-2147483648))\n  where intV = convertNBytesLen (S.unpack bs) `shift` (32 - 8 * n) \n</code></pre>\n\n<p>The <code>ByteString</code> as input to <code>bsToDouble</code> comes straight from <code>hGet h 3</code> and the integer is the amount of bytes in a sample (which is 3). </p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484170118, "post_id": 41597013, "comment_id": 70404851, "body": "<code>my-stack.yaml</code> doesn&#39;t parse: Above <code>- &#39;.&#39;</code>, a line with <code>packages:</code> is missing."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484171174, "post_id": 41597013, "comment_id": 70405334, "body": "Looks like a bug triggered by the <code>explicit-setup-deps</code> setting. Can you <a href=\"https://github.com/commercialhaskell/stack/issues/new\" rel=\"nofollow noreferrer\">open a bug report</a>?"}, {"owner": {"reputation": 1066, "user_id": 1709190, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/312687fd46a3b2a21bb469c2244c0668?s=128&d=identicon&r=PG", "display_name": "asr", "link": "https://stackoverflow.com/users/1709190/asr"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484190108, "post_id": 41597013, "comment_id": 70411177, "body": "@sjakobi, I fixed <code>my-stack.yaml</code> and filed Issue <a href=\"https://github.com/commercialhaskell/stack/issues/2918\" rel=\"nofollow noreferrer\">#2918</a>."}], "owner": {"reputation": 1066, "user_id": 1709190, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/312687fd46a3b2a21bb469c2244c0668?s=128&d=identicon&r=PG", "display_name": "asr", "link": "https://stackoverflow.com/users/1709190/asr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1484189198, "creation_date": 1484155492, "last_edit_date": 1484189198, "question_id": 41597013, "link": "https://stackoverflow.com/questions/41597013/why-stack-doesnt-pick-the-cabal-library-from-the-lts-haskell-snapshot", "title": "Why stack doesn&#39;t pick the Cabal library from the LTS Haskell snapshot", "body": "<p>Using <code>stack</code> with my system GHC 8.0.1 installation, I got the following error:</p>\n\n<pre><code>$ cabal get shuffle\n$ cd shuffle\n$ stack build --system-ghc --stack-yaml my-stack.yaml shuffle\nshuffle-0.1.3.3: configure (lib + exe)\n[1 of 2] Compiling Main             ( /tmp/shuffle-0.1.3.3/Setup.hs, /tmp/shuffle-0.1.3.3/.stack-work/dist/x86_64-linux/Cabal-1.24.0.0/setup/Main.o )\n\n/tmp/shuffle-0.1.3.3/Setup.hs:21:10: error:\n    \u2022 Couldn't match expected type \u2018UserHooks\u2019\n                  with actual type \u2018Cabal-  1.24.2.0:Distribution.Simple.UserHooks.UserHooks\u2019\n      NB: \u2018Cabal-1.24.2.0:Distribution.Simple.UserHooks.UserHooks\u2019\n            is defined in \u2018Distribution.Simple.UserHooks\u2019\n                in package \u2018Cabal-1.24.2.0\u2019\n          \u2018UserHooks\u2019\n            is defined in \u2018Distribution.Simple.UserHooks\u2019\n                in package \u2018Cabal-1.24.0.0\u2019\n    \u2022 In the second argument of \u2018($)\u2019, namely \u2018uuagcLibUserHook uuagc\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018addHook $ uuagcLibUserHook uuagc\u2019\n      In the expression:\n        defaultMainWithHooks $ addHook $ uuagcLibUserHook uuagc\n\n--  While building package shuffle-0.1.3.3 using:\n      /usr/local/bin/ghc --make -odir /tmp/shuffle-0.1.3.3/.stack-work/dist/x86_64-linux/Cabal-1.24.0.0/setup -hidir /tmp/shuffle-0.1.3.3/.stack-work/dist/x86_64-linux/Cabal-1.24.0.0/setup -i -i. -clear-package-db -global-package-db -package-db=/home/asr/.stack/snapshots/x86_64-linux/lts-7.15/8.0.1/pkgdb -package-db=/tmp/shuffle-0.1.3.3/.stack-work/install/x86_64-linux/lts-7.15/8.0.1/pkgdb -hide-all-packages -package=Cabal-1.24.0.0 -package-id=array-0.5.1.1 -package-id=base-4.9.0.0 -package-id=binary-0.8.3.0 -package-id=bytestring-0.10.8.1 -package-id=containers-0.5.7.1 -package-id=deepseq-1.4.2.0 -package-id=directory-1.2.6.2 -package-id=filepath-1.4.1.0 -package-id=ghc-boot-8.0.1 -package-id=ghc-boot-th-8.0.1 -package-id=ghc-prim-0.5.0.0 -package-id=ghci-8.0.1 -package-id=haskeline-0.7.2.3 -package-id=hoopl-3.10.2.1 -package-id=hpc-0.6.0.3 -package-id=integer-gmp-1.0.0.1 -package-id=network-2.6.3.1-G4Up1CPKbp7DeFsnywOnGG -package-id=network-uri-2.6.1.0-DDHh2FNiPirBRgkuU9DEt2 -package-id=pretty-1.1.3.3 -package-id=process-1.4.2.0 -package-id=rts -package-id=template-haskell-2.11.0.0 -package-id=terminfo-0.4.0.2 -package-id=time-1.6.0.1 -package-id=transformers-0.5.2.0 -package-id=uhc-util-0.1.6.7-L1BUn9NMMzYIrWlUtPHNBC -package-id=unix-2.7.2.0 -package-id=uuagc-0.9.52.1-IIwyYC9tdGhA1gPRBZkcWJ -package-id=uuagc-cabal-1.0.6.0-G8DOi0EgyIL1on8rRTcIWG -package-id=uulib-0.9.22-Kc77nQM8lM76maeFa6Awar -package-id=xhtml-3000.2.1 /tmp/shuffle-0.1.3.3/Setup.hs /home/asr/.stack/setup-exe-src/setup-shim-mPHDZzAJ.hs -main-is StackSetupShim.mainOverride -o /tmp/shuffle-0.1.3.3/.stack-work/dist/x86_64-linux/Cabal-1.24.0.0/setup/setup -threaded\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>Note that the above error message mentions two versions of the Cabal library:</p>\n\n<ul>\n<li>Cabal-1.24.0.0 (included in GHC 8.0.1)</li>\n<li>Cabal-1.24.2.0 (included in the LTS 7.15 Haskell snapshot)</li>\n</ul>\n\n<p>The <code>my-stack.yaml</code> file contains:</p>\n\n<pre><code>$ cat my-stack.yaml \nresolver: lts-7.15\n\n# See http://stackoverflow.com/questions/39564607/error-installing-the-shuffle-library-with-stack.\nexplicit-setup-deps:\n  shuffle: true\n\n# Local packages, usually specified by relative directory name\npackages:\n- '.'\nextra-deps:\n- logict-state-0.1.0.2\n- pqueue-1.3.2\n- uhc-util-0.1.6.7\n- uuagc-0.9.52.1\n- uuagc-cabal-1.0.6.0\n- uulib-0.9.22\n</code></pre>\n\n<p>I can build the package by adding <code>Cabal-1.24.0.0</code> (the version from GHC) to the <code>extra-deps</code> above but I don't understand why it is necessary.</p>\n\n<p>Stack version:</p>\n\n<pre><code>$ stack --version\nVersion 1.3.2, Git revision 3f675146590da4f3edf768b89355f798229da2a5 (4395 commits) x86_64 hpac\n</code></pre>\n"}, {"tags": ["java", "multithreading", "haskell", "corruption"], "comments": [{"owner": {"reputation": 33331, "user_id": 1898563, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d99204bcce923f40f5c72b7f80121644?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1898563/michael"}, "edited": false, "score": 4, "creation_date": 1484154479, "post_id": 41596537, "comment_id": 70396158, "body": "<a href=\"http://book.realworldhaskell.org/read/software-transactional-memory.html\" rel=\"nofollow noreferrer\">Basically, STM</a>. <code>atomically</code> is somewhat similar to a synchronised block."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1484168293, "post_id": 41596537, "comment_id": 70403863, "body": "<a href=\"http://community.haskell.org/~simonmar/pcph/\" rel=\"nofollow noreferrer\">There&#39;s a whole book on it</a>."}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 6431608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6418093c9be0cfe382b0b732b7f274?s=128&d=identicon&r=PG&f=1", "display_name": "WhatsThat", "link": "https://stackoverflow.com/users/6431608/whatsthat"}, "edited": false, "score": 0, "creation_date": 1484156648, "post_id": 41596718, "comment_id": 70397575, "body": "That&#39;s great, thanks for the response. Can probably tell that I haven&#39;t even touched a functional programming language before. So it doesn&#39;t affect data shared between the threads at all when running?"}, {"owner": {"reputation": 3429, "user_id": 5899161, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e7974a2c4fbb2bc7a521323ecfaa207a?s=128&d=identicon&r=PG&f=1", "display_name": "lukeg", "link": "https://stackoverflow.com/users/5899161/lukeg"}, "reply_to_user": {"reputation": 57, "user_id": 6431608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6418093c9be0cfe382b0b732b7f274?s=128&d=identicon&r=PG&f=1", "display_name": "WhatsThat", "link": "https://stackoverflow.com/users/6431608/whatsthat"}, "edited": false, "score": 0, "creation_date": 1484157637, "post_id": 41596718, "comment_id": 70398131, "body": "As far as I know, basic premise of functional programming is that the data is immutable, so threads can read it freely, because it won&#39;t change. I do not know of any exception to this rule, though I am not very experienced in FP myself."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 6, "creation_date": 1484167815, "post_id": 41596718, "comment_id": 70403656, "body": "While there is a point to this argument, it&#39;s still a bit rash to say <i>no synchronisation is needed</i> in pure functional languages. True is, <i>many</i> tasks that would require synchronisation in imperative languages to exploit multithreading can be done in Haskell by just tossing in a few <code>par</code> combinators. But a lot of these applications could also parallelised with simply a <code>#pragma omp parallel</code> or the like in imperative languages. Many multithreading applications use <i>concurrency</i> rather than parallelism, and that&#39;s not completely trivial even in Haskell (though it <i>can</i> be done quite nicely)."}], "tags": [], "owner": {"reputation": 3429, "user_id": 5899161, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e7974a2c4fbb2bc7a521323ecfaa207a?s=128&d=identicon&r=PG&f=1", "display_name": "lukeg", "link": "https://stackoverflow.com/users/5899161/lukeg"}, "is_accepted": false, "score": 0, "last_activity_date": 1484154513, "creation_date": 1484154513, "answer_id": 41596718, "question_id": 41596537, "link": "https://stackoverflow.com/questions/41596537/java-uses-synchronisation-what-does-haskell-use/41596718#41596718", "title": "Java uses synchronisation... What does Haskell use?", "body": "<p>This answer will pertain to functional languages in general - no synchronisation are needed. As functions in functional programming have no side effects: functions accept a value and return a value, there's no mutable state. Such functions are inherently thread safe.</p>\n"}, {"tags": [], "owner": {"reputation": 196, "user_id": 2051477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb3f0199a25ddd0e7d1a03822ebb9f6?s=128&d=identicon&r=PG", "display_name": "madidier", "link": "https://stackoverflow.com/users/2051477/madidier"}, "is_accepted": true, "score": 6, "last_activity_date": 1484227727, "last_edit_date": 1484227727, "creation_date": 1484166044, "answer_id": 41600013, "question_id": 41596537, "link": "https://stackoverflow.com/questions/41596537/java-uses-synchronisation-what-does-haskell-use/41600013#41600013", "title": "Java uses synchronisation... What does Haskell use?", "body": "<p>Your question is a bit ambiguous since one may use multithreading for either concurrency or parallelism, which are distinct problems with distinct solutions.</p>\n\n<p>In both cases, you'll need to make sure your programs are compiled with SMP support and ran using multiple RTS threads: see the GHC manual's <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/using-concurrent.html#using-concurrent\" rel=\"nofollow noreferrer\">section about concurrency</a>.</p>\n\n<h2>Concurrency</h2>\n\n<p>As others have pointed out, synchronization will be a non problem in the vast majority of your code, since you'll mostly be dealing with pure functions. This is true in any language if you <s>keep mutable state and libraries that rely on it under armed guard</s> religiously avoid mutable state unless it is properly wrapped behind a <em>pure API</em>. Concurrency is an area where Haskell shines because its semantics <em>require</em> purity. Types are used to <em>describe</em> impure operations instead, making it dead easy to spot code where some sort of synchronization might be needed.</p>\n\n<p>Typically, your application's state will be backed by a transactional database which will handle synchronization and persistence for you. <em>You will not need any additional synchronization at all if your concurrent application does not have additional state.</em></p>\n\n<p>In other cases, haskell has a handy <a href=\"http://hackage.haskell.org/package/stm\" rel=\"nofollow noreferrer\">Software Transactional Memory</a> implementation. It allows you to write and compose code written in an imperative-looking style, without explicit locking, while having atomicity and guarantees against deadlocks. It is <em>the</em> foolproof(tm) way to write concurrent code.</p>\n\n<p>Lastly, there are some low-level primitives available in <code>base</code>: plain old mutable references with <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-IORef.html\" rel=\"nofollow noreferrer\"><code>IORef</code></a>, <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Concurrent-QSem.html\" rel=\"nofollow noreferrer\">semaphores</a>, and <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Concurrent-MVar.html\" rel=\"nofollow noreferrer\"><code>MVars</code></a> which can be used as if they were variables protected by a mutex.</p>\n\n<blockquote class=\"spoiler\">\n  <p> There also are channels in <code>base</code>, but beware: they are unbounded !</p>\n</blockquote>\n\n<h2>Parallelism</h2>\n\n<p>This is also an area where Haskell shines because of its non-strict semantics. <em>Non-strictness</em> allows you to write code that expresses your logic in a straightforward manner while not getting committed to a specific evaluation order.</p>\n\n<p>As a consequence, you can describe a <a href=\"https://hackage.haskell.org/package/parallel-3.2.1.0/docs/Control-Parallel-Strategies.html\" rel=\"nofollow noreferrer\">parallel evaluation strategy</a> separately from the business logic. Writing parallel code is then just a matter of placing the right annotation in the right spot.</p>\n\n<p>Here is an example that was/is used in production at <a href=\"https://medium.com/@folsen/haskell-in-production-bdellium-1df48de40e19\" rel=\"nofollow noreferrer\">Bdellium</a>:</p>\n\n<pre><code>map outputParticipant parts `using` parListChunk 10 rdeepseq\n^^^^^ business logic ^^^^^^         ^^^^ eval. strategy ^^^^\n</code></pre>\n\n<p>The code can be understood as follows: Parallel workers will fully evaluate the results of mapping the <code>outputParticipant</code> function to individual items in the <code>parts</code> list, distributing the work in chunks of 10 elements.</p>\n"}], "owner": {"reputation": 57, "user_id": 6431608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6418093c9be0cfe382b0b732b7f274?s=128&d=identicon&r=PG&f=1", "display_name": "WhatsThat", "link": "https://stackoverflow.com/users/6431608/whatsthat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 419, "favorite_count": 0, "accepted_answer_id": 41600013, "answer_count": 2, "score": 1, "last_activity_date": 1484227727, "creation_date": 1484153953, "question_id": 41596537, "link": "https://stackoverflow.com/questions/41596537/java-uses-synchronisation-what-does-haskell-use", "title": "Java uses synchronisation... What does Haskell use?", "body": "<p>So I am pretty new to Haskell and would like to know, if synchronisation is used to prevent corruption when multithreading Java, how is this done in Haskell? I've only found useless or overly complicated responses on google. </p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 6, "creation_date": 1484169455, "post_id": 41596094, "comment_id": 70404485, "body": "The <code>any</code> function was written exactly to wrap up this <code>or</code>/<code>map</code> combination! You just need to go whole hog instead of only putting half the <code>map</code> into the condition, as you did: <code>any (\\d -&gt; x `mod` d == 0)</code>."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 3, "last_activity_date": 1484152686, "creation_date": 1484152686, "answer_id": 41596094, "question_id": 41595863, "link": "https://stackoverflow.com/questions/41595863/creating-filter-conditions-based-on-list-elements/41596094#41596094", "title": "Creating filter conditions based on list elements", "body": "<p>What you're looking for is the <code>or</code> function:</p>\n\n<pre><code>my_filter divisors = filter (\\x -&gt; or $ map ((0 ==) . (x `mod`)) divisors)\n</code></pre>\n\n<p>If you wanted to filter where all the values were divisors then you just have to change <code>or</code> to <code>and</code>.</p>\n\n<p>Another way to do it would be</p>\n\n<pre><code>my_filter divisors = filter (\\x -&gt; any (== 0) $ map (x `mod`) divisors)\n</code></pre>\n\n<p>These are equivalent functions, just a little different style.</p>\n"}], "owner": {"reputation": 367, "user_id": 5929023, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/374f88c63b3ab0372758b9fa9ba865cc?s=128&d=identicon&r=PG&f=1", "display_name": "galliwuzz", "link": "https://stackoverflow.com/users/5929023/galliwuzz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "accepted_answer_id": 41596094, "answer_count": 1, "score": 1, "last_activity_date": 1484152686, "creation_date": 1484151902, "question_id": 41595863, "link": "https://stackoverflow.com/questions/41595863/creating-filter-conditions-based-on-list-elements", "title": "Creating filter conditions based on list elements", "body": "<p>I'm interested in creating a filter, whose conditions depend on an input list. Specifically, I want to define the filter such that it checks whether a number is divisible by any number in my input list. So for a single element that would be:</p>\n\n<pre><code>my_filter a = filter (\\x -&gt; x `mod` a == 0)\n</code></pre>\n\n<p>basically I want to extend this such that if I have an input list, it would do the following:</p>\n\n<pre><code>my_filter [a,b] = filter (\\x -&gt; x `mod` a == 0 || x `mod` b == 0)\n</code></pre>\n\n<p>How can I define this filter recursively, such that each element of the list creates a new condition?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35543, "user_id": 149530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b6c8b04130af49735de5be666d67c00?s=128&d=identicon&r=PG", "display_name": "Michael Foukarakis", "link": "https://stackoverflow.com/users/149530/michael-foukarakis"}, "edited": false, "score": 0, "creation_date": 1484151119, "post_id": 41595322, "comment_id": 70394000, "body": "You&#39;re on the right track. What happens when one of the lists is empty, but the other is not?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1484151134, "post_id": 41595322, "comment_id": 70394013, "body": "And what do you do with <code>l1</code> and <code>l2</code>?"}, {"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1484152090, "post_id": 41595322, "comment_id": 70394654, "body": "Thanks I solved it with a bit of trying :)"}], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1484152406, "post_id": 41595604, "comment_id": 70394851, "body": "Thanks alex got the same after some trying. Works like a charm :)"}, {"owner": {"reputation": 2755, "user_id": 5326679, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh5.googleusercontent.com/-UAJcCqeI85w/AAAAAAAAAAI/AAAAAAAAAEw/hAEYnJlKTt8/photo.jpg?sz=128", "display_name": "xandermonkey", "link": "https://stackoverflow.com/users/5326679/xandermonkey"}, "reply_to_user": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "edited": false, "score": 0, "creation_date": 1484152673, "post_id": 41595604, "comment_id": 70395007, "body": "Please vote for my answer if it is the solution to your question!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1484169673, "post_id": 41595604, "comment_id": 70404607, "body": "You might also like to match only on the first argument: <code>mix (x:xs) ys = x:mix ys xs; mix [] ys = ys</code>. It&#39;s a cute trick I&#39;ve <a href=\"http://stackoverflow.com/a/41192723/791604\">used a few times</a> myself."}], "tags": [], "owner": {"reputation": 2755, "user_id": 5326679, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh5.googleusercontent.com/-UAJcCqeI85w/AAAAAAAAAAI/AAAAAAAAAEw/hAEYnJlKTt8/photo.jpg?sz=128", "display_name": "xandermonkey", "link": "https://stackoverflow.com/users/5326679/xandermonkey"}, "is_accepted": false, "score": 2, "last_activity_date": 1484159704, "last_edit_date": 1484159704, "creation_date": 1484151126, "answer_id": 41595604, "question_id": 41595322, "link": "https://stackoverflow.com/questions/41595322/haskell-mix-two-lists/41595604#41595604", "title": "Haskell mix two lists", "body": "<p>I do not have an interpreter available to use as I am on a different computer to usual, but here is some code:</p>\n\n<pre><code>mix :: [a] -&gt; [a] -&gt; [a]\nmix (x:xs) (y:ys) = x : y : mix xs ys\nmix x [] = x\nmix [] y = y\n</code></pre>\n\n<p>Edit: I just tested this online, I believe it works.</p>\n"}, {"tags": [], "owner": {"reputation": 136, "user_id": 1553834, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/Rk6Gb.jpg?s=128&g=1", "display_name": "urbanslug", "link": "https://stackoverflow.com/users/1553834/urbanslug"}, "is_accepted": false, "score": 1, "last_activity_date": 1484153231, "last_edit_date": 1484153231, "creation_date": 1484152730, "answer_id": 41596112, "question_id": 41595322, "link": "https://stackoverflow.com/questions/41595322/haskell-mix-two-lists/41596112#41596112", "title": "Haskell mix two lists", "body": "<p>So there are two functions <code>transpose</code> and <code>concat</code>.</p>\n\n<pre><code>-- transpose :: [[a]] -&gt; [[a]] \n-- concat :: Foldable t =&gt; t [a] -&gt; [a]\n</code></pre>\n\n<p>Since List already has an instance of Foldable this ends up being one line of code like so:</p>\n\n<pre><code>concat . transpose $ a : b : []\n</code></pre>\n\n<p>or </p>\n\n<pre><code>concat . transpose  $ [a,b]\n</code></pre>\n\n<p>The first step is to create a list of lists with transpose like so </p>\n\n<pre><code>\u03bb&gt; transpose  $ [a, b]\n[[4,3],[8,5],[20,17],[56],[89],[30]]\n</code></pre>\n\n<p>which we then collapse into one.</p>\n\n<p>The secret here is to use function composition. The <code>.</code> is a function that takes two functions and calls one after the other creating a larger function so:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>means: take the result of the first function, <code>transpose</code>, and feed it to the next one, <code>concat</code>. </p>\n\n<p>We can chain as many functions as we wish as long as the types allow it. \nIn our case the composition creates a function <code>[a] -&gt; [a] -&gt; [a]</code></p>\n"}], "owner": {"reputation": 65, "user_id": 7186508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/efbb0f6aa8d6a557d7d430b01ab4780b?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/7186508/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 959, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1484159704, "creation_date": 1484150277, "last_edit_date": 1484150981, "question_id": 41595322, "link": "https://stackoverflow.com/questions/41595322/haskell-mix-two-lists", "title": "Haskell mix two lists", "body": "<p>Im about to write my first haskell program, so I need your help. I want to interlink two lists. For example;</p>\n\n<pre><code>a = [4,8,20]\nb = [3,5,17,56,89,30]\n\ninterlink a b = [4,3,8,5,20,17,56,89,30]\n</code></pre>\n\n<p>The resulting list must cointain the elements of List a and b alternately. If one List is longer then the elements of the longer list should be added to the result list after the shorter list mashed up with the elements of the longer list. I think you saw that in my example above.</p>\n\n<p>Now how do i do this in Haskell??</p>\n\n<p>My start </p>\n\n<pre><code>mix :: [a]-&gt;[a]-&gt;[a]\nmix (x:l1) (y:l2) = (x:y:[])\nmix [] [] = []\n</code></pre>\n\n<p>Please, can you help me??</p>\n"}, {"tags": ["haskell", "ghc", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 1998, "user_id": 79475, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a7d29c825581e5a220b2ae0c27e4cdce?s=128&d=identicon&r=PG", "display_name": "The_Ghost", "link": "https://stackoverflow.com/users/79475/the-ghost"}, "edited": false, "score": 0, "creation_date": 1484150752, "post_id": 41595332, "comment_id": 70393747, "body": "Eurika! Yes, I have no relationship between gen and light, so the second variant is my actual fix.  Thank you very much for the detailed answer!"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1484150310, "creation_date": 1484150310, "answer_id": 41595332, "question_id": 41592832, "link": "https://stackoverflow.com/questions/41592832/could-not-deduce-error-on-multi-parameter-type-class/41595332#41595332", "title": "&quot;Could not deduce&quot; error on multi-parameter type class", "body": "<p>The problem is that <code>eval</code> does not use <code>gen</code>, and so specialising its type is not enough to decide which <code>gen</code> to use when picking the <code>Shadow</code> instance to use. One possible solution is using a <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#functional-dependencies\" rel=\"nofollow noreferrer\">functional dependency</a> to enforce that there will be only one <code>gen</code> for each choice of <code>light</code>:</p>\n\n<pre><code>{-# LANGUAGE FunctionalDependencies #-}\n\nclass RandomGen gen =&gt; Shadow gen light | light -&gt; gen where\n    shadowRay :: gen -&gt; light -&gt; Float\n    eval      :: light -&gt; Float\n</code></pre>\n\n<p>It is possible, however, that you don't want or need to couple <code>light</code> and <code>gen</code> in this manner. In that case, you might want to consider the opposite alternative of removing <code>gen</code> from the type class -- if <code>gen</code> and <code>light</code> aren't related, you don't need a multi-parameter type class to relate them:</p>\n\n<pre><code>class Shadow light where\n    shadowRay :: RandomGen gen =&gt; gen -&gt; light -&gt; Float\n    eval      :: light -&gt; Float\n</code></pre>\n"}], "owner": {"reputation": 1998, "user_id": 79475, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a7d29c825581e5a220b2ae0c27e4cdce?s=128&d=identicon&r=PG", "display_name": "The_Ghost", "link": "https://stackoverflow.com/users/79475/the-ghost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 41595332, "answer_count": 1, "score": 1, "last_activity_date": 1484150339, "creation_date": 1484143034, "last_edit_date": 1484150339, "question_id": 41592832, "link": "https://stackoverflow.com/questions/41592832/could-not-deduce-error-on-multi-parameter-type-class", "title": "&quot;Could not deduce&quot; error on multi-parameter type class", "body": "<p>I have this code:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\nimport System.Random (RandomGen(..))\n\nclass RandomGen gen =&gt; Shadow gen light where\n    shadowRay :: gen -&gt; light -&gt; Float\n    eval      :: light -&gt; Float\n</code></pre>\n\n<p>and I get that error:</p>\n\n<blockquote>\n<pre><code>[1 of 1] Compiling Main             ( problem.hs, problem.o )\n\nproblem.hs:6:5: error:\n    * Could not deduce (Shadow gen0 light)\n      from the context: Shadow gen light\n        bound by the type signature for:\n                   eval :: Shadow gen light =&gt; light -&gt; float -&gt; float\n        at problem.hs:6:5-40\n      The type variable `gen0' is ambiguous\n    * In the ambiguity check for `eval'\n      To defer the ambiguity check to use sites, enable AllowAmbiguousTypes\n      When checking the class method:\n        eval :: forall gen light.\n                Shadow gen light =&gt;\n                forall float. light -&gt; float -&gt; float\n      In the class declaration for `Shadow'\n</code></pre>\n</blockquote>\n\n<p>This is problem from GHC 7.10+. Before it was working. There is a fix if I add \"gen\" parameter to \"eval\", like:</p>\n\n<p><code>eval      :: gen -&gt; light -&gt; Float</code></p>\n\n<p>But I don't want to add a new value parameter which will not be used. Is there some kind of other way for type resolution?</p>\n"}, {"tags": ["haskell", "filesystems"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484142777, "post_id": 41592717, "comment_id": 70388484, "body": "So you mean cycles in file systems?"}], "answers": [{"comments": [{"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1492527859, "post_id": 41600812, "comment_id": 74006733, "body": "This is currently beyond what I am used to do in Haskell - I have not yet touched FFI yet. May come."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1492534947, "post_id": 41600812, "comment_id": 74011629, "body": "@user855443 The <code>unix</code> package author already did all the necessary FFI work -- you don&#39;t need to touch the FFI yourself to use this."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "edited": false, "score": 0, "creation_date": 1494408895, "post_id": 41600812, "comment_id": 74811299, "body": "thank you - on first reading, I did not realize it was already on hackage"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1484169287, "creation_date": 1484169287, "answer_id": 41600812, "question_id": 41592717, "link": "https://stackoverflow.com/questions/41592717/how-to-detect-circles-of-symbolic-links-in-haskell/41600812#41600812", "title": "how to detect circles of symbolic links in haskell", "body": "<p>You can use the <code>unix</code> package's <a href=\"http://hackage.haskell.org/package/unix-2.7.2.1/docs/System-Posix-Files.html#v:readSymbolicLink\" rel=\"nofollow noreferrer\"><code>readSymbolicLink</code></a> to implement this check.</p>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1484169287, "creation_date": 1484142654, "last_edit_date": 1492085628, "question_id": 41592717, "link": "https://stackoverflow.com/questions/41592717/how-to-detect-circles-of-symbolic-links-in-haskell", "title": "how to detect circles of symbolic links in haskell", "body": "<p>i understand that i can find circles in symbolic links with the </p>\n\n<pre><code>find . -follow -printf \"\"\n</code></pre>\n\n<p>command (and other similar methods on the command line as previously <a href=\"https://serverfault.com/questions/265598/how-do-i-find-circular-symbolic-links/265614#265614\">previously suggested</a>. but i cannot find a command in haskell to achieve the same. </p>\n\n<p>there are several operations in System.Directory (eg createDirectory, renameDirectory) to return the ELOOP error from the OS (for <a href=\"https://www.gnu.org/software/libc/manual/html_node/Symbolic-Links.html\" rel=\"nofollow noreferrer\">linux</a>), but none to simply check a filepath for a circle of symbolic links. but none to simply to check a filepath.   </p>\n"}, {"tags": ["haskell", "monad-transformers", "servant"], "answers": [{"tags": [], "owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "is_accepted": false, "score": 1, "last_activity_date": 1484089054, "creation_date": 1484089054, "answer_id": 41579927, "question_id": 41579873, "link": "https://stackoverflow.com/questions/41579873/using-readert-based-client-wrapper-with-servant-client/41579927#41579927", "title": "Using ReaderT based Client wrapper with Servant client", "body": "<p>Following example with IO at the bottom of the page <a href=\"http://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader.html\" rel=\"nofollow noreferrer\">Control Monad Reader</a> I had to implement function to lift <code>ReaderT</code></p>\n\n<pre><code>liftReaderT :: m a -&gt; ReaderT r m a\nliftReaderT m = ReaderT (const m)\n</code></pre>\n\n<p>So then I can have verbose implementation like this:</p>\n\n<pre><code>getT :: TClient Text\ngetT = do\n    t &lt;- ask\n    liftReaderT $ get t\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1484122993, "post_id": 41581016, "comment_id": 70375637, "body": "Thank you for answer! Doing just <code>lift get</code> I got <code>Couldn&#39;t match expected type &#39;ClientM Text&#39; with actual type &#39;Token -&gt; ClientM Text&#39;</code> so I had to do <code>ask &gt;&gt;= \\t -&gt; lift $ get t</code>..."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1484132456, "post_id": 41581016, "comment_id": 70381671, "body": "@klappvisor My mistake, that should read <code>lift . get</code>. I&#39;ll fix the answer"}, {"owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "edited": false, "score": 0, "creation_date": 1484152267, "post_id": 41581016, "comment_id": 70394770, "body": "for <code>get :: Token -&gt; ClientM Text</code> I have to read <code>Token</code> in <code>getT</code> and pass it to <code>get</code>. at the moment for <code>lift . get</code> I have got <code>Couldn&#39;t match type &#39;Token -&gt; t0 ClientM Text&#39; with &#39;ReaderT Token ClientM Text&#39;</code>"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 1, "last_activity_date": 1484132469, "last_edit_date": 1484132469, "creation_date": 1484095762, "answer_id": 41581016, "question_id": 41579873, "link": "https://stackoverflow.com/questions/41579873/using-readert-based-client-wrapper-with-servant-client/41581016#41581016", "title": "Using ReaderT based Client wrapper with Servant client", "body": "<p><code>ReaderT r</code> is an instance of <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Class.html#t:MonadTrans\" rel=\"nofollow noreferrer\"><code>MonadTrans</code></a>, so you can just use <code>lift :: (MonadTrans t, Monad m) =&gt; m a -&gt; t m a</code>. Specialised to the types in question, that's <code>lift :: ClientM a -&gt; ReaderT Token ClientM a</code>.</p>\n\n<pre><code>getT :: Int -&gt; TClient Text\ngetT = lift . get\n\npostT :: Int -&gt; TClient Text\npostT = lift . post\n</code></pre>\n"}], "owner": {"reputation": 1049, "user_id": 793874, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/512e19604a6878fd5aa38c4f180d5af9?s=128&d=identicon&r=PG", "display_name": "klappvisor", "link": "https://stackoverflow.com/users/793874/klappvisor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1484132469, "creation_date": 1484088723, "question_id": 41579873, "link": "https://stackoverflow.com/questions/41579873/using-readert-based-client-wrapper-with-servant-client", "title": "Using ReaderT based Client wrapper with Servant client", "body": "<p>I'm trying to extend servant's <code>ClientM</code> monad with additional <code>Token</code> parameter that I will use to call REST resource. </p>\n\n<pre><code>type TClient a = ReaderT Token ClientM a\n</code></pre>\n\n<p>Then I have the following defined for servant pattern matching  </p>\n\n<pre><code>get :: Token -&gt; ClientM Text\npost :: Token -&gt; Int -&gt; ClientM Text\nget :&lt;|&gt; post = client (Proxy :: Proxy MyAPI)\n</code></pre>\n\n<p>Now my extended client comes to play. This is how I use it:</p>\n\n<pre><code>getT :: TClient Text\ngetT = undefined -- implementation to extract token and call 'get'\n\npostT :: Int -&gt; TClient Text\nportT = undefined -- implementation to extract token and call 'post'\n\nqueries :: TClient Text\nqueries = do\n    text1 &lt;- postT 5\n    text2 &lt;- getT\n    return (text1 ++ text2)\n\n--| runReaderT and then runClientM\nrunTClient :: Token -&gt; TClient a -&gt; ClientEnv -&gt; IO (Either ServantError a)\nrunTClient token tcm env = runClientM (runReaderT tcm token) env\n</code></pre>\n\n<p>Question is how to implement <code>getT</code> and <code>postT</code> functions the better way. </p>\n\n<p><em>I will post my current solution, but hopefully more experienced haskellers here can suggest better one</em></p>\n"}, {"tags": ["haskell", "classy-prelude"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1484084731, "post_id": 41577106, "comment_id": 70362877, "body": "Generalized anamorphisms (like <code>iterate</code> or <code>unfold</code>) are less common than generalized catamorphisms (like <code>map</code> or <code>fold</code>). It think it&#39;s more likely <code>iterate</code> was omitted because it isn&#39;t used commonly enough to warrant inclusion in a redesigned prelude."}], "answers": [{"comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1484103004, "post_id": 41581633, "comment_id": 70368469, "body": "I was going to suggest <code>\\f -&gt; unfoldr (Just . join (,) . f)</code>"}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 2, "last_activity_date": 1484100726, "creation_date": 1484100726, "answer_id": 41581633, "question_id": 41577106, "link": "https://stackoverflow.com/questions/41577106/is-there-any-replacement-for-preludes-iterate-function-in-classy-prelude/41581633#41581633", "title": "Is there any replacement for Prelude&#39;s iterate function in classy prelude?", "body": "<p>You can always reimplement it with <a href=\"https://hackage.haskell.org/package/classy-prelude-1.0.2/docs/ClassyPrelude.html#v:repeat\" rel=\"nofollow noreferrer\"><code>ClassyPrelude.repeat</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:scanl\" rel=\"nofollow noreferrer\"><code>Data.List.scanl</code></a>:</p>\n\n<pre><code>iterate = \\f a -&gt; scanl (\\a f -&gt; f a) a (repeat f)\n</code></pre>\n"}], "owner": {"reputation": 942, "user_id": 1073784, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a826c65f4ff3e4fbffb972c3b16acde7?s=128&d=identicon&r=PG", "display_name": "Sami Liedes", "link": "https://stackoverflow.com/users/1073784/sami-liedes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1484100726, "creation_date": 1484077567, "question_id": 41577106, "link": "https://stackoverflow.com/questions/41577106/is-there-any-replacement-for-preludes-iterate-function-in-classy-prelude", "title": "Is there any replacement for Prelude&#39;s iterate function in classy prelude?", "body": "<p>In the standard prelude:</p>\n\n<pre><code>Prelude&gt; :t iterate\niterate :: (a -&gt; a) -&gt; a -&gt; [a]\n</code></pre>\n\n<p>However, in classy prelude there is no iterate, so I presume there might be some more generic function to do the same, perhaps a monadic one. I just cannot figure out what it is. Is there one?</p>\n"}, {"tags": ["list", "haskell", "recursion"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1484075736, "post_id": 41576474, "comment_id": 70358015, "body": "<code>removeone (a:as) = as : map (a:) (removeone as)</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1484075800, "post_id": 41576474, "comment_id": 70358045, "body": "@user2407038 Please don&#39;t post answers as comments."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1484075922, "post_id": 41576474, "comment_id": 70358125, "body": "@user2407038 I was about to post it as an answer, but now I am feeling bad with that.."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1484077335, "last_edit_date": 1484077335, "creation_date": 1484076653, "answer_id": 41576860, "question_id": 41576474, "link": "https://stackoverflow.com/questions/41576474/haskell-all-possible-ways-to-remove-1-element-from-the-list/41576860#41576860", "title": "Haskell all possible ways to remove 1 element from the list", "body": "<p>Let's look at a slightly longer example and figure out how to break it up:</p>\n\n<pre><code>&gt; removeone [1,2,3,4]\n[[2,3,4],[1,3,4],[1,2,4],[1,2,3]]\n</code></pre>\n\n<p>As you already guessed, you simply put <code>as</code> (the result of removing the first element from the input) on the front of <em>some</em> list, but what list is that?</p>\n\n<pre><code>removeone (a:as) = as : ...\n</code></pre>\n\n<p>Looking more closely, you can see that <code>a == 1</code> is at the front of each of them. Let's factor that out to see how we might construct it:</p>\n\n<pre><code>[[1,3,4],[1,2,4],[1,2,3]] == [1:[3,4],1:[2,4],1:[2,3]]\n                          == map (1:) [[3,4],[2,4],[2,3]]\n</code></pre>\n\n<p>The second argument should look familiar: it's what you should expect the result of <code>removeone [2,3,4]</code> to look like. And just like that, you have your recursive case:</p>\n\n<pre><code>removeone (a:as) = as : map (a:) (removeone as)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1484092193, "post_id": 41578515, "comment_id": 70365921, "body": "It is worth noting that this solution benefits from the tuned implementations of <code>inits</code> and <code>tails</code> in <code>Data.List</code>. There is discussion of them in <a href=\"http://stackoverflow.com/q/29393412/2751851\"><i>What are the space complexities of inits and tails?</i></a> and <a href=\"http://stackoverflow.com/q/27672585/2751851\"><i>Efficient version of &#39;inits&#39;</i></a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5672248"}, "edited": false, "score": 0, "creation_date": 1484660426, "post_id": 41578515, "comment_id": 70593045, "body": "This is great answer! This helped me and i understood this very much!"}], "tags": [], "owner": {"reputation": 228, "user_id": 7347627, "user_type": "registered", "profile_image": "https://graph.facebook.com/1828143650801314/picture?type=large", "display_name": "samsergey", "link": "https://stackoverflow.com/users/7347627/samsergey"}, "is_accepted": true, "score": 3, "last_activity_date": 1484084426, "last_edit_date": 1484084426, "creation_date": 1484082802, "answer_id": 41578515, "question_id": 41576474, "link": "https://stackoverflow.com/questions/41576474/haskell-all-possible-ways-to-remove-1-element-from-the-list/41578515#41578515", "title": "Haskell all possible ways to remove 1 element from the list", "body": "<p>The idiomatic recursive solution is given by @\u0441hepner. However, everyday Haskell is not about recursion, it's more about recursive patterns and precise formulation of a problem. If I have got it I would end up with following solution</p>\n\n<pre><code>import Data.List (inits, tails)\n\nremoveone :: [a] -&gt; [[a]]\nremoveone lst = zipWith (++) (inits lst) (tail (tails lst))\n</code></pre>\n\n<p>It is more then 2\u00d7 faster then explicit recursion and seems more like formulation of a problem. Using \"dangerous\" function <code>tail</code> is safe here because <code>tails [] = [[]]</code>. Trivial cases are held by <code>zipWith</code>, <code>inits</code> and <code>tails</code>.</p>\n\n<p>If the resulting complementary lists are supposed to be nontrivially processed (say, they represent a view of each game personage in a group) consider Zippers and utilize their comonadic properties (it is really not as scaring as it sounds:)).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5672248"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 0, "accepted_answer_id": 41578515, "answer_count": 2, "score": 0, "last_activity_date": 1484087405, "creation_date": 1484075175, "last_edit_date": 1484087405, "question_id": 41576474, "link": "https://stackoverflow.com/questions/41576474/haskell-all-possible-ways-to-remove-1-element-from-the-list", "title": "Haskell all possible ways to remove 1 element from the list", "body": "<p>This is what I've written so far, but I've gotten a bit lost:</p>\n\n<pre><code>removeone :: [a] -&gt; [[a]]\nremoveone [] = []\nremoveone (a:as) = [as] -- I'm lost here\n</code></pre>\n\n<p>This is the kind of output I'm looking for:</p>\n\n<pre><code>removeone [1,2,3] = [[2,3],[1,3],[1,2]]\nremoveone [1,2]   = [[1],[2]]\n</code></pre>\n\n<p>What would be the best way to solve this problem? In Java I would just loop this and each time produce a new list that I would append to a pre-existing list. I am pretty lost in translating this into Haskell.</p>\n"}, {"tags": ["algorithm", "haskell", "recursion", "monads"], "comments": [{"owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "edited": false, "score": 0, "creation_date": 1484075452, "post_id": 41576240, "comment_id": 70357853, "body": "Close voter, care to elaborate why you think that I did not elaborate my problem clearly?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1484075566, "post_id": 41576240, "comment_id": 70357908, "body": "1. This example is very far from minimal. 2. <code>testCounter</code> explodes the stack because it is not tail recursive (no amount of strictness annotations will help you here, and the one on <code>!eitherFirst32</code> does nothing - you pattern match on <code>eitherFirst32</code> immediately after the let binding, so it will be evaluated to WHNF anyways.) I have no idea what it actually does, so I couldn&#39;t tell you how to make it tail recursive. 3. All these conversions and encoding/decoding will almost certainly kill performance.. e.g. <code>firstBitsZero</code> is very inefficient - <code>num</code> comparisons to zero instead of one!"}, {"owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1484075873, "post_id": 41576240, "comment_id": 70358095, "body": "@user2407038 Thanks for the information, can you elaborate what you mean by <code>num comparisons to zero instead of one</code>?  I have to test the first <code>num</code> bits, can this be done in less than <code>num</code> number of operations (perhaps binary OR on num bits against mask) == 0?)"}, {"owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1484076509, "post_id": 41576240, "comment_id": 70358459, "body": "@user2407038 The constant encoding and hashing after each increment of the counter is required by the algorithm.  It is supposed to perform badly.  It is a Proof of Work algorithm, that&#39;s kinda the point!  It is not supposed to blow the stack however and I imagine it is supposed to run at LEAST as fast as the Java implementation I whipped up."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1484076648, "post_id": 41576240, "comment_id": 70358532, "body": "Nice task. It&#39;s hard to see what&#39;s going wrong, though. Can you try to test your functions and see if you can reduce the issue to some part? BTW <code>formatTemplate</code> looks suspicious, the first argument could explode exponentially fast."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1484077042, "post_id": 41576240, "comment_id": 70358744, "body": "<code>firstBitsZero</code> could be a <code>foldr</code>: <code>foldl&#39;</code> always scans all the list so there&#39;s no early exit (short-circuit) when a bit is found to be wrong. Minor: why <code>get16RandomBytes</code> in the IO monad? Suggestion: you can use <code>Debug.Trace.trace</code> to do some printf-like debugging. E.g. when some key function is called you could try to trace its arguments so they get printed."}, {"owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1484082415, "post_id": 41576240, "comment_id": 70361578, "body": "@chi Good suggestion on foldr! I just want 16 random bytes for the random part of the Hashcash header. That can be precomputed and in fact when I run this in ghci it shows the complete string of the header minus the counter part on the sys out. It is stuck incrementing through possible numbers thst satisfy where the first 4 bits are zero."}], "answers": [{"comments": [{"owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "edited": false, "score": 0, "creation_date": 1484138951, "post_id": 41582329, "comment_id": 70386037, "body": "Awesome!  I can&#39;t believe I missed those two bugs.  Seems obvious now.  Also I wasn&#39;t aware that that the header prefix isn&#39;t included.  Will definitely fix that. I will also make the foldr performance improvement in firstBitsZero that another user suggests.  And thank you for wrapping your code in a spoiler tag.  Much appreciated!"}, {"owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "edited": false, "score": 0, "creation_date": 1484139101, "post_id": 41582329, "comment_id": 70386131, "body": "Any thoughts on possibly using a takeWhile against [1..] for testing an incremented counter here?  I am wondering if this is safer or more efficient than using recursion."}, {"owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "edited": false, "score": 0, "creation_date": 1484150790, "post_id": 41582329, "comment_id": 70393770, "body": "I tried the takeWhile approach as opposed to recursion and it worked fantastic after fixing the bugs and fixed the firstBitsZero function.  I see what you mean about the performance though.  To be fair though this appears to run slightly faster than my Java implementation after doing the -02 optimization flag.  Will probably look into how I can improve the performance of this.  Thanks again for your help."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "edited": false, "score": 0, "creation_date": 1489976603, "post_id": 41582329, "comment_id": 72890670, "body": "@maple_shaft Note that <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.List.html#takeWhile\" rel=\"nofollow noreferrer\"><code>takeWhile</code> uses recursion internally</a>. All forms of looping in Haskell ultimately involve recursion."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 5, "last_activity_date": 1484106302, "creation_date": 1484106302, "answer_id": 41582329, "question_id": 41576240, "link": "https://stackoverflow.com/questions/41576240/haskell-while-loop-where-recursion-simply-wont-do/41582329#41582329", "title": "Haskell while loop where recursion simply won&#39;t do?", "body": "<p>The problem isn't the efficiency of your code.  You really are entering an infinite loop because you have two bugs:</p>\n\n<ol>\n<li><code>firstBitsZero</code> is checking for \"one\" bits, not \"zero\" bits.</li>\n<li>You are applying <code>firstBitsZero</code> to the Base64 encoded version of the hash, instead of the actual bits of the hash.</li>\n</ol>\n\n<p>It's no surprise that you're having trouble generating hashes whose Base64 (i.e., ASCII!) representation \"starts with\" (but see below) more than a small number of one bits and/or zero bits.</p>\n\n<p>If you fix these two problems, you'll find that your program, when compiled with <code>-O2</code> optimizations on, generates a HashCash for 20 bits in under a minute.  Still too slow, but obviously much improved. </p>\n\n<p>You still have a number of bugs that make your program incompatible with an actual hashcash:</p>\n\n<pre><code>SPOILERS\n\n\n\nSPOILERS\n\n\n\nSPOILERS\n</code></pre>\n\n<ul>\n<li>You are checking if the <em>least</em> significant bits of the first 32 bit word are zero, instead of the most significant bits (and you are assuming the bit index for <code>testBit</code> starts with 1, but it actually starts with zero).</li>\n<li>You are hashing the entire header including the <code>X-HashCash:</code> prefix, which isn't part of the string that should be hashed.</li>\n</ul>\n\n<p>After fixing these, it looks like your program works fine.  For example, here's a hashcash generated by your program at difficulty 20, which we can verify starts with 20 zero bits using your <code>mahDecoder</code>.</p>\n\n<pre><code>&gt; runGet mahDecoder (hashSHA1 \"1:20:150320112233:a@a::2go+qPr1OxIigymGiuEDxw==:NTE3MDM0\")\n(Right 753,\"[\\191\\GS\\237iw\\NAKIp\\193\\140)BZI_\")\n&gt;\n</code></pre>\n\n<p>Again, note that the string to check excludes the <code>X-HashCash</code> header.</p>\n\n<p>Nice choice of project, by the way.</p>\n"}], "owner": {"reputation": 10318, "user_id": 650425, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/917eb01650ad8da7e4d2187eedcfeb82?s=128&d=identicon&r=PG", "display_name": "maple_shaft", "link": "https://stackoverflow.com/users/650425/maple-shaft"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 41582329, "answer_count": 1, "score": 1, "last_activity_date": 1484106302, "creation_date": 1484074351, "question_id": 41576240, "link": "https://stackoverflow.com/questions/41576240/haskell-while-loop-where-recursion-simply-wont-do", "title": "Haskell while loop where recursion simply won&#39;t do?", "body": "<p>I am somewhat of a beginner to Haskell and declarative languages in general, but as a thought experiment, I decided that an interesting coding exercise would be to implement something like the <a href=\"https://en.wikipedia.org/wiki/Hashcash\" rel=\"nofollow noreferrer\">Hashcash algorithm</a>.  If you aren't familiar with it, basically it is the grandfather of the Bitcoin Proof of Work scheme.  It specifies the creation of an email header that when hashed into a SHA-1 digest, should have the first <code>n</code> bits as zero where <code>n</code> is the difficulty of the Proof of Work.  This is designed to be trivial to validate for the recipient while a modest expense of CPU cycles for senders with the intent of discouraging mass spamming operations.  This was an interesting exercise to me because it allowed me to learn how to work with ByteStrings and bits in Haskell, while trying to tackle a very specific but potentially massive imperative series of steps in a functional and declarative way.  Essentially the sender must increment a counter and rebuild the potential header, test it, and if that particular test is valid then we have a valid header.  It is designed to be exponentially harder as the difficulty increases.</p>\n\n<p>My problem at this point is that difficulty of 1 and 2 bits as zero seems to work fine, but once I get to 3 or more difficulty I appear to be caught in an endless loop until the stack blows up.  Rather than use a while loop, I attempted to do this in a recursive way, so I specified the strictness of counter such prior thunks must be computed before moving to the next step, and I no longer receive an overflow, but I still appear to be caught in an endless loop (or perhaps the performance is so bad that I never get to the end?)</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\n\nmodule HashCash where\n\nimport Data.Int\nimport Data.List\nimport Data.List.Split (splitOn)\nimport Data.Char\nimport Data.Function\nimport System.Random\nimport Data.Bits\nimport Data.Either\nimport Data.Binary.Strict.Get\nimport System.IO as SIO\nimport Data.Word (Word32)\nimport Data.ByteString as B\nimport Data.ByteString.Char8 as BC\nimport Data.ByteString.UTF8 as BU\nimport Data.ByteString.Base64 as B64\nimport Data.ByteString.Conversion as BCON\nimport Data.ByteArray as BA\nimport Crypto.Random\nimport Crypto.Hash\n\n\nstartingCounter :: Int32\nstartingCounter = 1\ndifficulty :: Int\ndifficulty = 4\ntemplate = \"X-Hashcash: 1:{:{:{::{:{\"\ndateTemplate = \"YYMMDDhhmmss\"\naddress = \"a@a\"\n\n-- example date because I dont want to mess with date formatting just now\nexampleDate = \"150320112233\"\n\nconvertToString :: ByteString -&gt; String\nconvertToString b = BU.toString b\n\nconvertFromString :: String -&gt; ByteString\nconvertFromString s = BU.fromString s\n\nconvertIntToString :: Int -&gt; String\nconvertIntToString a = convertToString . BCON.toByteString' $ a\n\nencodeInt32 :: Int32 -&gt; ByteString\nencodeInt32 a = B64.encode . BCON.toByteString' $ a\n\nmahDecoder :: Get Word32\nmahDecoder = do\n  first32Bits &lt;- getWord32be\n  return first32Bits\n\nfirstBitsZero :: (Bits a) =&gt; a -&gt; Int -&gt; Bool\nfirstBitsZero val num = Data.List.foldl' (\\acc x -&gt; (testBit val x) &amp;&amp; acc) True [1..num]\n\nformatTemplate :: String -&gt; [String] -&gt; String\nformatTemplate base [] = base\nformatTemplate base (x:xs) = \n   let splix = (Data.List.Split.splitOn \"{\" base) :: [String]\n       splixHead = Data.List.head splix ++ x\n       splixTail = Data.List.tail splix\n       concatSplitTail = Data.List.init $ Data.List.concatMap (++ \"{\") splixTail\n   in formatTemplate (splixHead ++ concatSplitTail) xs\n\nget16RandomBytes :: (DRG g) =&gt; g -&gt; IO (ByteString, g)\nget16RandomBytes gen = do\n  let a = randomBytesGenerate 16 gen\n  return $ a\n\ngetBaseString :: ByteString -&gt; Int32 -&gt; String\ngetBaseString bs counter = \n  let encodedVal = B64.encode bs\n      encodedCounter = encodeInt32 counter\n      baseParams = [(convertIntToString difficulty), exampleDate, address, (convertToString encodedVal), (convertToString encodedCounter)]\n  in formatTemplate template baseParams\n\nhashSHA1Encoded :: ByteString -&gt; ByteString\nhashSHA1Encoded bs =\n  let hashDigest = hash bs :: Digest SHA1\n      byteString = B.pack . BA.unpack $ hashDigest\n  in B64.encode byteString\n\n-- Pass a counter and if the first 20 bits are zero then return the same counter value else increment it\n-- signifying it is time to test the next number (NOTE: recursive style, may overflow stack)\ntestCounter :: ByteString -&gt; Int32 -&gt; Int32\ntestCounter rb !counter = \n  let baseString = getBaseString rb counter\n      hashedString = hashSHA1Encoded $ convertFromString baseString\n      !eitherFirst32 = runGet mahDecoder hashedString\n      incCounter = counter + 1\n  in case eitherFirst32 of\n    (Left first32, _) -&gt; testCounter rb incCounter\n    (Right first32, _) -&gt; if (firstBitsZero first32 difficulty)\n                           then counter\n                           else testCounter rb incCounter\n\ngenerateHeader :: IO String\ngenerateHeader = do\n  g &lt;- getSystemDRG\n  (ran, _) &lt;- get16RandomBytes g\n  let counter = testCounter ran startingCounter\n  return $ getBaseString ran counter\n\nmain :: IO ()\nmain = do \n  header &lt;- generateHeader\n  SIO.putStrLn header\n  return ()\n</code></pre>\n\n<p>So clearly this doesn't work and I am not terribly sure why just yet, but I was trying to think about better ways I can solve this.  Is it possible for instance to create a <code>sequence</code> of monadic actions for <code>testCounter</code> then possibly do a <code>takeWhile</code> on the condition of each action result to see if I need to take anymore?</p>\n\n<p>If not, then does Proof of Work algorithms fall into that class of applications that just don't make sense for declarative functional programming?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1484074310, "post_id": 41575528, "comment_id": 70357186, "body": "The <code>preConf</code> hook is probably what you need to modify - this has an output type of <code>IO HookedBuildInfo</code>, and <code>HookedBuildInfo</code> contains a <code>cSources :: [FilePath]</code> field and a <code>includeDirs :: [FilePath]</code> field - presumably you can write the Haskell function to find your files, and then it is just a matter of calling the default hook and then appending (or prepending? might make a difference to the linker...) to the respective lists."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1484100522, "post_id": 41575528, "comment_id": 70367881, "body": "It seems possible that <a href=\"https://github.com/sol/hpack#readme\" rel=\"nofollow noreferrer\">hpack</a> supports file globbing for <code>C-Sources</code>."}, {"owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484138532, "post_id": 41575528, "comment_id": 70385763, "body": "@sjakobi: I just tried hpack and it does not not (I filed a GitHub issue about it though)."}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 157, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1484103626, "creation_date": 1484071751, "last_edit_date": 1495542278, "question_id": 41575528, "link": "https://stackoverflow.com/questions/41575528/how-to-automatically-include-haskell-c-sources-through-setup-hs-build-script", "title": "How to automatically include Haskell C-sources through `Setup.hs` build script?", "body": "<p>In a Haskell project's cabal file we have the following sections:</p>\n\n<pre><code>C-Sources:    src/A.c\n            , src/B.c\n            , ...\n\nIncludes:     include/A.h\n            , include/B.h\n            , ...\n</code></pre>\n\n<p>Unfortunately, wildcarding in these sections is not allowed (as confirmed <a href=\"https://stackoverflow.com/questions/41292462/programmatically-listing-c-sources-in-haskell-cabal-files\">here</a>):</p>\n\n<pre><code>-- this doesn't work:\nC-Sources: src/*.c\nIncludes:  include/*.h\n</code></pre>\n\n<p><strong>Question:</strong> How can one alter <code>Setup.hs</code> to automatically include <code>src/*.c</code> and <code>include/*.h</code> as above?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484100778, "post_id": 41574445, "comment_id": 70367944, "body": "If you often run into linking issues with <code>stack build</code>, please <a href=\"https://github.com/commercialhaskell/stack/issues/new\" rel=\"nofollow noreferrer\">create a bug report</a>!"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1484102009, "post_id": 41574445, "comment_id": 70368213, "body": "In a single package project <code>stack clean --full</code> is basically an alias for <code>rm .stack-work</code>."}, {"owner": {"reputation": 187, "user_id": 2801663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dad8e2d30c14d11bdc0f7ef167cce51?s=128&d=identicon&r=PG", "display_name": "SnowOnion", "link": "https://stackoverflow.com/users/2801663/snowonion"}, "edited": false, "score": 1, "creation_date": 1522160653, "post_id": 41574445, "comment_id": 86035889, "body": "<a href=\"https://github.com/commercialhaskell/stack/issues/1609\" rel=\"nofollow noreferrer\">This issue</a> recorded how the <code>--full</code> option of <code>stack clean</code> was created."}], "answers": [{"tags": [], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "is_accepted": false, "score": 1, "last_activity_date": 1498557907, "creation_date": 1498557907, "answer_id": 44777503, "question_id": 41574445, "link": "https://stackoverflow.com/questions/41574445/what-is-the-difference-between-stack-clean-and-removing-the-stack-work-dire/44777503#44777503", "title": "What is the difference between `stack clean` and removing the `.stack-work` directory?", "body": "<p>As you can see by reading the source here:</p>\n\n<p><a href=\"https://github.com/commercialhaskell/stack/blob/master/src/Stack/Clean.hs\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/blob/master/src/Stack/Clean.hs</a></p>\n\n<p>There are two levels, full and shallow. I think shallow seems to be the default. It seems to be able to clean specific packages, or if you don't provide no options at all, it'll clean everything but extra-deps in local packages.</p>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2376, "favorite_count": 1, "answer_count": 1, "score": 14, "last_activity_date": 1498557907, "creation_date": 1484068267, "last_edit_date": 1484102876, "question_id": 41574445, "link": "https://stackoverflow.com/questions/41574445/what-is-the-difference-between-stack-clean-and-removing-the-stack-work-dire", "title": "What is the difference between `stack clean` and removing the `.stack-work` directory?", "body": "<h3>1 Context</h3>\n\n<p>I am involved in a Haskell project that involves lots of C-bits and FFI. So I find myself frequently running and re-running commands like</p>\n\n<pre><code>$ stack build\n$ stack build --force-dirty\n$ stack clean\n$ rm ./.stack-work\n</code></pre>\n\n<p>over and over in order for the C-bits to be linked properly to the Haskell bits. Put differently, sometimes things just work when running <code>stack build</code>, and sometimes they don't (in which case I'm forced to cycle through the above commands over and over until my project builds properly).</p>\n\n<p>This means I don't have a proper understanding of how <code>stack</code> (through <code>ghc</code>) assembles the C-bits before assembling the Haskell bits.  So here is one question to help me start clearing up my confusion:</p>\n\n<h3>2 Question</h3>\n\n<p>Are there any noteworthy difference between running <code>stack clean</code> and deleting the contents of the <code>.stack-work</code> directory? Are there cases where deleting the <code>.stack-work</code> directory is needed as a good precaution to ensure that you are actually running a clean build?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1484069435, "post_id": 41574250, "comment_id": 70354398, "body": "Your final solution is quite idiomatic. If you want, you can also remove the parentheses in <code>... ++ (intersperse a xs)</code> since application (function call) has the highest precedence. It is common to write e.g. <code>f 3 + g 2 - h 5</code> without parentheses."}], "answers": [{"comments": [{"owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 0, "creation_date": 1484068740, "post_id": 41574432, "comment_id": 70353986, "body": "Thanks for the explanation, but replacing the brackets with parentheses in <code>[x:xs]</code> still returns the same error, only this time at <code>4:29</code> instead of <code>4:24</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "edited": false, "score": 0, "creation_date": 1484068840, "post_id": 41574432, "comment_id": 70354052, "body": "@Jono The above answer indeed fixes only one error. The next error arises since in the RHS, <code>a</code> is not a list, and you are using it with <code>++</code>. Try using <code>... ++ [a] ++ ...</code> instead."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1484068231, "creation_date": 1484068231, "answer_id": 41574432, "question_id": 41574250, "link": "https://stackoverflow.com/questions/41574250/how-do-i-properly-do-haskell-pattern-matching-on-a-list/41574432#41574432", "title": "How do I properly do Haskell pattern matching on a list?", "body": "<p>The pattern <code>[x:xs]</code> matches only with a list of length one, whose single element is nonempty (matches with <code>x:xs</code>). E.g. it matches with <code>[[1,2,3]]</code> with <code>x=1</code> and <code>xs=[2,3]</code>. It does not match with <code>[[1],[2,3]]</code>, <code>[]</code>, or <code>[[]]</code>.</p>\n\n<p>You want <code>(x:xs)</code> instead. This can match <code>[[1,2],[3],[4,5]]</code> with <code>x=[1,2]</code> and <code>xs=[[3],[4,5]]</code>.</p>\n"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 41574432, "answer_count": 1, "score": 3, "last_activity_date": 1484069264, "creation_date": 1484067681, "last_edit_date": 1484069264, "question_id": 41574250, "link": "https://stackoverflow.com/questions/41574250/how-do-i-properly-do-haskell-pattern-matching-on-a-list", "title": "How do I properly do Haskell pattern matching on a list?", "body": "<p>I'm trying to work through the Haskell exercises at the bottom of <a href=\"http://book.realworldhaskell.org/read/defining-types-streamlining-functions.html\" rel=\"nofollow noreferrer\">this page</a>. The one I'm working on is #7. Here's the problem: </p>\n\n<p>Define a function that joins a list of lists together using a separator value. </p>\n\n<p>Here's the type signature: </p>\n\n<pre><code>-- file: ch03/Intersperse.hs\nintersperse :: a -&gt; [[a]] -&gt; [a]\n</code></pre>\n\n<p>And here's the way it's supposed to behave: </p>\n\n<pre><code>ghci&gt; :load Intersperse\n[1 of 1] Compiling Main             ( Intersperse.hs, interpreted )\nOk, modules loaded: Main.\nghci&gt; intersperse ',' []\n\"\"\nghci&gt; intersperse ',' [\"foo\"]\n\"foo\"\nghci&gt; intersperse ',' [\"foo\",\"bar\",\"baz\",\"quux\"]\n\"foo,bar,baz,quux\"\n</code></pre>\n\n<p>So this is what I came up with: </p>\n\n<pre><code>intersperse :: a -&gt; [[a]] -&gt; [a]\nintersperse a [] = \"\"\nintersperse a [x] = x\nintersperse a [x:xs] = x ++ a ++ (intersperse a xs)\n</code></pre>\n\n<p>But I'm getting this error: </p>\n\n<pre><code>intersperse.hs:4:24: error:\n    \u2022 Couldn't match expected type \u2018[a]\u2019 with actual type \u2018a\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          intersperse :: forall a. a -&gt; [[a]] -&gt; [a]\n        at intersperse.hs:1:16\n    \u2022 In the first argument of \u2018(++)\u2019, namely \u2018x\u2019\n      In the expression: x ++ a ++ (intersperse a xs)\n      In an equation for \u2018intersperse\u2019:\n          intersperse a [x : xs] = x ++ a ++ (intersperse a xs)\n    \u2022 Relevant bindings include\n        xs :: [a] (bound at intersperse.hs:4:18)\n        x :: a (bound at intersperse.hs:4:16)\n        a :: a (bound at intersperse.hs:4:13)\n        intersperse :: a -&gt; [[a]] -&gt; [a] (bound at intersperse.hs:2:1)\n</code></pre>\n\n<p>I'm really new at Haskell, so I don't really understand this error. What am I doing wrong? </p>\n\n<p>Edit: </p>\n\n<p>Got it to work with this: </p>\n\n<pre><code>intersperse :: a -&gt; [[a]] -&gt; [a]\nintersperse a [] = []\nintersperse a [x] = x\nintersperse a (x:xs) = x ++ [a] ++ (intersperse a xs)\n</code></pre>\n\n<p>Turns out there were a few things wrong. </p>\n"}, {"tags": ["haskell", "binary-tree"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1484085624, "post_id": 41574499, "comment_id": 70363342, "body": "<code>data Dir = L | R; type Path = [Dir]</code>?"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 3, "last_activity_date": 1484068447, "creation_date": 1484068447, "answer_id": 41574499, "question_id": 41573170, "link": "https://stackoverflow.com/questions/41573170/finding-out-number-of-even-paths-from-root-in-a-tree/41574499#41574499", "title": "Finding out number of even paths from root in a tree", "body": "<p>I think the easiest way would be to make a data type that can describe a path through a tree:</p>\n\n<pre><code>data Path = L Path | R Path | End deriving (Eq, Show)\n</code></pre>\n\n<p>This type is basically a list but with two prepend constructors to tell you either go Left or go Right.  This conveniently lets you look up items by path, or you can write a function that gives you a list of all paths in the tree.</p>\n\n<pre><code>-- Note that this can fail: lookupNode (Leaf 1) (L End) == Nothing\nlookupNode :: Tree -&gt; Path -&gt; Maybe Tree\n\nallPaths :: Tree -&gt; [Path]\n</code></pre>\n\n<p>If you can write the <code>allPaths</code> function, then you can write the function you want on top of it.  To start, just begin by listing the base cases:</p>\n\n<pre><code>allPaths (Leaf _) = [End]\nallPaths (Node _ left right) = _\n</code></pre>\n\n<p>To fill in the hole <code>_</code>, think about what it means to list all the paths starting at a <code>Node</code> and recursing down <code>left</code>.  You would need to have a <code>L</code> at the beginning of all of those paths, so you can put the following in there</p>\n\n<pre><code>allPaths (Node _ left right) = (map L $ allPaths left)\n</code></pre>\n\n<p>Similarly, you would need to handle the <code>right</code> tree:</p>\n\n<pre><code>allPaths (Node _ left right) =\n    (map L $ allPaths left) ++\n    (map R $ allPaths right)\n</code></pre>\n\n<p>So now:</p>\n\n<pre><code>&gt; let tree =\n    Node 1\n        (Node 2           -- L _\n            (Leaf 3)      -- L (L End)\n            (Node 4       -- L (R _)\n                (Leaf 5)  -- L (R (L End))\n                (Leaf 6)  -- L (R (R End))\n            )\n        )\n        (Leaf 7)          -- R End\n&gt; allPaths tree\n[L (L End),L (R (L End)), L (R (R End)),R End]\n</code></pre>\n\n<p>Now, to find the <code>Leaf</code>s with an even number of nodes above them, first write a function that calculates a path length:</p>\n\n<pre><code>pathLength :: Path -&gt; Int\npathLength End = 0\npathLength (L rest) = 1 + pathlength rest\npathLength (R rest) = 1 + pathLength rest\n\nevenNodeCountPaths :: Tree -&gt; [Path]\nevenNodeCountPaths tree = filter (even . pathLength) $ allPaths tree\n</code></pre>\n\n<hr>\n\n<p>Note: It is possible to do this with</p>\n\n<pre><code>data Dir = L | R | End\ntype Path = [Dir]\n</code></pre>\n\n<p>But that can lead to invalid paths like [End, End, L, R, End], which just doesn't make any sense.  I chose to go for the list-like <code>data Path</code> for this reason.  You have to write your own <code>pathLength</code> function, but this formulation makes it impossible to have invalid paths.</p>\n"}, {"comments": [{"owner": {"reputation": 55, "user_id": 4780017, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cec207e58d37f226adf78d5b798184ec?s=128&d=identicon&r=PG&f=1", "display_name": "banzai", "link": "https://stackoverflow.com/users/4780017/banzai"}, "edited": false, "score": 0, "creation_date": 1484136543, "post_id": 41579192, "comment_id": 70384409, "body": "thank you. I never would have managed that on my own, I even had trouble understanding why your solution even works at first."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1484085564, "creation_date": 1484085564, "answer_id": 41579192, "question_id": 41573170, "link": "https://stackoverflow.com/questions/41573170/finding-out-number-of-even-paths-from-root-in-a-tree/41579192#41579192", "title": "Finding out number of even paths from root in a tree", "body": "<p>Probably it's easier to compute both the number of even <em>and</em> the number of odd paths.</p>\n\n<pre><code>evenAndOdd (Leaf _) = (0, 1)\nevenAndOdd (Node _ l r) = let\n    (el, ol) = evenAndOdd l\n    (er, or) = evenAndOdd r\n    in (ol+or, el+er)\n</code></pre>\n\n<p>If you really must, you can then define a function in terms of this to count just the even paths.</p>\n\n<pre><code>evenOnly = fst . evenAndOdd\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 4780017, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cec207e58d37f226adf78d5b798184ec?s=128&d=identicon&r=PG&f=1", "display_name": "banzai", "link": "https://stackoverflow.com/users/4780017/banzai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 386, "favorite_count": 0, "accepted_answer_id": 41579192, "answer_count": 2, "score": 1, "last_activity_date": 1484085564, "creation_date": 1484064326, "last_edit_date": 1484069571, "question_id": 41573170, "link": "https://stackoverflow.com/questions/41573170/finding-out-number-of-even-paths-from-root-in-a-tree", "title": "Finding out number of even paths from root in a tree", "body": "<p>I'm trying to get a function that counts all paths from the root to a leaf that has an even number of nodes ( counting the root and the leaf)\nMy tree looks like this:</p>\n\n<pre><code>data Tree = Leaf Int | Node Int Tree Tree\n</code></pre>\n\n<p>all i got so far is a function that counts ALL nodes in a tree, which is easy enough:</p>\n\n<pre><code>countNodes (Leaf _) = 1\ncountNodes (Node _ x y) = 1+ countNodes x + countNodes y\n</code></pre>\n\n<p>Now i saw a bunch of questions that deal with trees but i felt like no answer helped me much, so I'm just gonna ask myself. How do i make a part of a function stop when a leaf is reached? I know this has to do with my problem to think with recursions.</p>\n\n<p>What I tried to do was to to make list of all paths from the root, but i always end up with a function that gets all elements in the tree and puts them together somehow. \nI'm missing something simple, please help. (or link me an answer that does exactly what i want)</p>\n"}, {"tags": ["html", "haskell", "yesod"], "comments": [{"owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "edited": false, "score": 0, "creation_date": 1486919504, "post_id": 41572459, "comment_id": 71543003, "body": "One approach is to define the name of the anchor in a place that you can access from you handlers. So essentially the anchor is just a variable, and that way it&#39;s kept consistent. It doesn&#39;t deal with an anchor not being present on a page though."}], "owner": {"reputation": 81, "user_id": 7400091, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bddeb889efd6c87614a671b2a1849b15?s=128&d=identicon&r=PG&f=1", "display_name": "Harpo", "link": "https://stackoverflow.com/users/7400091/harpo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1484062303, "creation_date": 1484062303, "question_id": 41572459, "link": "https://stackoverflow.com/questions/41572459/page-anchors-in-yesod", "title": "Page Anchors In Yesod", "body": "<p>Normally you can specify an anchor on a page such as \"index.html\" with code such as:</p>\n\n<pre><code>&lt;a href=\"#anchor\"&gt;Link Text&lt;/a&gt;\n</code></pre>\n\n<p>You can then jump to that anchor when the page is displayed by including it in the path:</p>\n\n<pre><code>http://example.com/index.html#anchor\n</code></pre>\n\n<p>I am developing a landing page with the Yesod Haskell framework, and would like to integrate this functionality into my landing page.</p>\n\n<p>Currently I have a navigation bar with several links at the top of the page. The navbar is specified with hamlet as:</p>\n\n<pre><code>&lt;div #navbar .collapse.navbar-collapse&gt;\n    &lt;ul .nav.navbar-nav&gt;\n        &lt;li :Just HomeR == mcurrentRoute:.active&gt;\n            &lt;a href=@{HomeR}&gt;_{MsgHome}\n</code></pre>\n\n<p>Note that the href is specified with \"HomeR\". \"HomeR\" is defined in the Yesode \"config/routes\" file that lists all of the paths for the site.\nIt looks like:</p>\n\n<pre><code>/ HomeR GET\n/settings SettingsR GET\n</code></pre>\n\n<p>Here is my problem. I can add an anchor to a section of the hamlet specification, then modify the href on the title bar to jump to that section such as:</p>\n\n<pre><code>&lt;li :Just HomeR == mcurrentRoute:.active&gt;\n    &lt;a href=@{HomeR}#section0&gt;_{MsgHome}\n</code></pre>\n\n<p>However this is annoying for several reasons. First the anchor is not checked for validity at compile time like the other paths. </p>\n\n<p>Second normally the current page is highlighted on the navigation bar with the code: </p>\n\n<pre><code>&lt;li :Just HomeR == mcurrentRoute:.active&gt;\n</code></pre>\n\n<p>With this approach I can highlight for individual pages, but not individual anchors within a page.</p>\n\n<p>Is there a way to insert safe anchors into the Yesod config/routes file. Or is it only possible to have a route with actual pages. This would allow jumping to sections of the page in the navbar, then highlighting the section that was clicked on. If this is not possible is there a better way to deal with page anchors in yesod?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1484057502, "post_id": 41570668, "comment_id": 70346051, "body": "Something is inconsistent between the environments in which you are running these commands - you say that <code>leksah.sh</code> demands <code>haskell-gi-base &gt;=0.18 &amp;&amp; &lt;0.21</code> but <code>cabal</code> very clearly tells you it is installing <code>haskell-gi-base-0.9</code>. <code>cabal install leksah</code> should find the correct dependencies - trying to install them one by one is the wrong thing to do. The <code>cabal</code> file referred to in the error is the <code>cabal</code> file of <code>haskell-gi-base-0.9</code> - this version is probably just too old to be built with your configuration (cabal 1.20.0.3 is fairly new)."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 2, "creation_date": 1484062607, "post_id": 41570668, "comment_id": 70349730, "body": "maybe you have more luck with <a href=\"https://www.haskellstack.org/\" rel=\"nofollow noreferrer\">stack</a>..."}, {"owner": {"reputation": 1642, "user_id": 3928184, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-opJFz3zFjGI/AAAAAAAAAAI/AAAAAAAAAr0/2zAUOWaRv90/photo.jpg?sz=128", "display_name": "bjd2385", "link": "https://stackoverflow.com/users/3928184/bjd2385"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1484068263, "post_id": 41570668, "comment_id": 70353661, "body": "@user2407038 I&#39;ve posted an update regarding your suggestion."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1484068880, "post_id": 41570668, "comment_id": 70354072, "body": "Your update suggests you are in dependency hell. Purge your package db and start anew, or use <code>stack</code> or at the very least a cabal sandbox. Also, if you get <code>cabal install</code> to make a working build plan (with <code>--max-backjumps</code> or any other flag) but that build plan takes &#39;too long&#39; (10 minutes is too long?) there is no reason to expect that <i>any</i> build plan would be substantially faster - if the use of such resources for compilation in unacceptable to you, I&#39;m afraid you simply will not be able to build leksah from source."}, {"owner": {"reputation": 1642, "user_id": 3928184, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-opJFz3zFjGI/AAAAAAAAAAI/AAAAAAAAAr0/2zAUOWaRv90/photo.jpg?sz=128", "display_name": "bjd2385", "link": "https://stackoverflow.com/users/3928184/bjd2385"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1484071091, "post_id": 41570668, "comment_id": 70355401, "body": "@user2407038 It&#39;s not that 10 minutes is too long, it&#39;s that after <i>only</i> 10 minutes it&#39;s consuming almost half my memory, and that&#39;s only climbing, which <i>is</i> unacceptable. I&#39;m now trying Stack and it seems to be working well."}], "answers": [{"tags": [], "owner": {"reputation": 1020, "user_id": 500060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c122862374667042520953c02df7d7ed?s=128&d=identicon&r=PG", "display_name": "glguy", "link": "https://stackoverflow.com/users/500060/glguy"}, "is_accepted": false, "score": 0, "last_activity_date": 1484980727, "creation_date": 1484980727, "answer_id": 41776468, "question_id": 41570668, "link": "https://stackoverflow.com/questions/41570668/cabal-haskell-gi-base-refuses-to-install/41776468#41776468", "title": "cabal: haskell-gi-base refuses to install", "body": "<p>The <code>Data.Proxy</code> module moved to the <code>base</code> package in <code>base-4.7.0.0</code> which was part of the <code>ghc-7.6</code> series. The <code>haskell-gi-base</code> you are trying to install is also quite old. I expect that it was selected because the newest version that could satisfy the version constraints, but that those version constraints are wrong. Your version of GHC must be older than this.</p>\n\n<p>The solution is to update your GHC and cabal-install. Current version of GHC 8.0.2 and the current version of cabal-install is 1.24.0.2. You need at least version 1.24 of cabal-install when you upgrade to GHC 8. Fortunately the Minimal Haskell Platform comes with an up-to-date GHC, cabal-install, and even stack!</p>\n"}], "owner": {"reputation": 1642, "user_id": 3928184, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-opJFz3zFjGI/AAAAAAAAAAI/AAAAAAAAAr0/2zAUOWaRv90/photo.jpg?sz=128", "display_name": "bjd2385", "link": "https://stackoverflow.com/users/3928184/bjd2385"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 324, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1484980727, "creation_date": 1484056905, "last_edit_date": 1484068220, "question_id": 41570668, "link": "https://stackoverflow.com/questions/41570668/cabal-haskell-gi-base-refuses-to-install", "title": "cabal: haskell-gi-base refuses to install", "body": "<p>When I try</p>\n\n<pre><code>$ cabal install gi-cairo\n</code></pre>\n\n<p>(One of the long list of dependencies to install leksah) I get the following error:</p>\n\n<pre><code>Resolving dependencies...\nConfiguring haskell-gi-base-0.9...\nBuilding haskell-gi-base-0.9...\nFailed to install haskell-gi-base-0.9\nBuild log ( /home/brandon/.cabal/logs/haskell-gi-base-0.9.log ):\nConfiguring haskell-gi-base-0.9...\nBuilding haskell-gi-base-0.9...\nPreprocessing library haskell-gi-base-0.9...\n\nsrc/Data/GI/Base/Attributes.hs:105:8:\n    Could not find module `Data.Proxy'\n    It is a member of the hidden package `tagged-0.8.5'.\n    Perhaps you need to add `tagged' to the build-depends in your .cabal file.\n    Use -v to see a list of the files searched for.\ncabal: Error: some packages failed to install:\ngi-cairo-0.1.14.8 depends on haskell-gi-base-0.9 which failed to install.\nhaskell-gi-base-0.9 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p>I see the part about <code>tagged</code>, but where is this <code>.cabal</code> file ? On my machine it's a directory at <code>~/.cabal/</code>, not a file. And what do I add to this supposed file ?</p>\n\n<p>By the way, the output of <code>cabal --version</code>:</p>\n\n<pre><code>cabal-install version 1.20.0.3\nusing version 1.20.0.2 of the Cabal library \n</code></pre>\n\n<p>My goal is to install the dependencies output by <code>leksah.sh</code> when I run it:</p>\n\n<pre><code>gi-cairo &gt;=1.0.6 &amp;&amp; &lt;1.1,\ngi-gdk &gt;=3.0.6 &amp;&amp; &lt;3.1,\ngi-gdkpixbuf &gt;=2.0.6 &amp;&amp; &lt;2.1,\ngi-gio &gt;=2.0.6 &amp;&amp; &lt;2.1,\ngi-glib &gt;=2.0.6 &amp;&amp; &lt;2.1,\ngi-gobject &gt;=2.0.6 &amp;&amp; &lt;2.1,\ngi-gtk &gt;=3.0.6 &amp;&amp; &lt;3.1,\ngi-gtk-hs &gt;=0.3.1.0 &amp;&amp; &lt;0.4,\ngi-gtksource &gt;=3.0.6 &amp;&amp; &lt;3.1,\ngi-pango &gt;=1.0.6 &amp;&amp; &lt;1.1,\ngi-webkit2 &gt;=4.0.6 &amp;&amp; &lt;4.1,\nhaskell-gi-base &gt;=0.18 &amp;&amp; &lt;0.21,\nhaskell-src-exts &gt;=1.13.5 &amp;&amp; &lt;1.19,\nleksah-server &gt;=0.16.1.0 &amp;&amp; &lt;0.17,\nltk &gt;=0.16.0.0 &amp;&amp; &lt;0.17,\nregex-tdfa &gt;=1.1 &amp;&amp; &lt;1.3,\nregex-tdfa-text -any,\nvcsgui &gt;=0.2.0 &amp;&amp; &lt;0.3\n</code></pre>\n\n<p>I've been trying to solve this since last night, but I don't see anything like this documented anywhere when I Google.</p>\n\n<hr>\n\n<p>UPDATE: When I try running <code>cabal install leksah</code>, I get the following errors:</p>\n\n<pre><code>Resolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: leksah-0.15.2.0 (user goal)\ntrying: vcswrapper-0.1.1/installed-1eQ... (dependency of leksah-0.15.2.0)\nnext goal: transformers (dependency of leksah-0.15.2.0)\nrejecting: transformers-0.5.2.0/installed-3Es... (conflict: leksah =&gt;\ntransformers&gt;=0.2.2.0 &amp;&amp; &lt;0.5)\nrejecting: transformers-0.3.0.0/installed-ff2... (conflict:\ntransformers-compat-0.5.1.4:three =&gt; transformers&gt;=0.4.1 &amp;&amp; &lt;0.6)\nrejecting: transformers-0.5.2.0, 0.5.1.0, 0.5.0.1, 0.5.0.0 (conflict: leksah\n=&gt; transformers&gt;=0.2.2.0 &amp;&amp; &lt;0.5)\ntrying: transformers-0.4.3.0\nnext goal: mtl (dependency of leksah-0.15.2.0)\nrejecting: mtl-2.2.1/installed-4vs... (conflict: transformers==0.4.3.0, mtl =&gt;\ntransformers==0.5.2.0/installed-3Es...)\nrejecting: mtl-2.1.2/installed-94c..., 2.2.1, 2.2.0.1, 2.2, 2.1.3.1, 2.1.2,\n2.1.1, 2.1, 2.0.1.1, 2.0.1.0, 2.0.0.0, 1.1.1.1, 1.1.1.0, 1.1.0.2, 1.1.0.1,\n1.1.0.0, 1.0 (conflict: vcswrapper =&gt; mtl==2.2.1/installed-4vs...)\nBackjump limit reached (change with --max-backjumps).\n</code></pre>\n\n<p>So I tried <code>cabal install leksah --max-backjumps -1</code> per the manpage of cabal and after about 10 minutes it's now consuming >40% of the memory of my machine, so I simply can't continue on that route.</p>\n"}, {"tags": ["list", "sorting", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1484076631, "post_id": 41568203, "comment_id": 70358520, "body": "<code>(compare `on` f)</code> = <code>Data.Ord.comparing f</code>; <code>sortBy (comparing f)</code> = <code>Data.List.sortOn f</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1484077200, "post_id": 41568203, "comment_id": 70358830, "body": "@JonPurdy: I&#39;ve updated the answer with your suggestions, many thanks."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 8, "last_activity_date": 1484077180, "last_edit_date": 1484077180, "creation_date": 1484049076, "answer_id": 41568203, "question_id": 41568096, "link": "https://stackoverflow.com/questions/41568096/how-to-sort-custom-type-by-string/41568203#41568203", "title": "How to sort custom Type by String", "body": "<p>First you better define an <code>animalName</code> function:</p>\n\n<pre><code>animalName :: Animal -&gt; String\nanimalName (Cat n) = n\nanimalName (Dog n) = n\nanimalName (Fox n) = n\n</code></pre>\n\n<p>Simply use <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:sortBy\" rel=\"nofollow noreferrer\"><code>sortBy</code></a> where the comparator is simply <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:compare\" rel=\"nofollow noreferrer\"><code>compare</code></a> but <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-Function.html#v:on\" rel=\"nofollow noreferrer\"><code>on</code></a> the <code>animalName</code>:</p>\n\n<pre><code>import Data.Function(on)\nimport Data.List(sortBy)\n\nsortAnimalsByName :: [Animal] -&gt; [Animal]\nsortAnimalsByName = sortBy (compare `on` animalName)\n</code></pre>\n\n<p>Or you can - like @JonPurdy suggests, use <code>comparing</code> which is basically the same as <code>on compare</code>:</p>\n\n<pre><code>import Data.Ord(comparing)\n\nsortAnimalsByName :: [Animal] -&gt; [Animal]\nsortAnimalsByName = sortBy (comparing animalName)\n</code></pre>\n\n<p>or even shorter:</p>\n\n<pre><code>import Data.List(sortOn)\n\nsortAnimalsByName :: [Animal] -&gt; [Animal]\nsortAnimalsByName = sortOn animalName\n</code></pre>\n\n<p>You can furthermore omit the definition of <code>animalName</code> if you use <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#record-syntax\" rel=\"nofollow noreferrer\"><em>record-syntax</em></a>:</p>\n\n<pre><code>--omitting the `animalName` function\ndata Animal = Cat { animalName :: String} |\n              Dog { animalName :: String} |\n              Fox { animalName :: String} deriving (Show)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1484053757, "post_id": 41568956, "comment_id": 70343355, "body": "This will not sort the objects based on the <i>name</i> of the animal. The default <code>Ord</code> will always sort a <code>Cat</code> lower than <code>Dog</code> and <code>Dog</code> lower than <code>Fox</code> (or in your case <code>Dog</code> &lt; <code>Cat</code> &lt; <code>Fox</code>), regardless of their name. In case of a tie, the name will indeed be used. But <code>Cat &quot;zz&quot;</code> will be less than <code>Fox &quot;aa&quot;</code>. It first sorts on constructor (<code>Cat</code>, <code>Dog</code>, <code>Fox</code>) and then - iirc - on its parameters."}, {"owner": {"reputation": 136, "user_id": 1553834, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/Rk6Gb.jpg?s=128&g=1", "display_name": "urbanslug", "link": "https://stackoverflow.com/users/1553834/urbanslug"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1484055796, "post_id": 41568956, "comment_id": 70344828, "body": "@WillemVanOnsem Thank you. I just edited the answer."}], "tags": [], "owner": {"reputation": 136, "user_id": 1553834, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/Rk6Gb.jpg?s=128&g=1", "display_name": "urbanslug", "link": "https://stackoverflow.com/users/1553834/urbanslug"}, "is_accepted": false, "score": 3, "last_activity_date": 1484055753, "last_edit_date": 1484055753, "creation_date": 1484051515, "answer_id": 41568956, "question_id": 41568096, "link": "https://stackoverflow.com/questions/41568096/how-to-sort-custom-type-by-string/41568956#41568956", "title": "How to sort custom Type by String", "body": "<p><em>Edited</em> Thank you @WillemVanOnsem for your comment.</p>\n\n<p>First of all this should be a proper sum type so that you can avoid repeating String all over. Meaning, you should make it </p>\n\n<p><code>type Animal a = Dog a | Cat a | Fox a\n</code></p>\n\n<p>This way you would have a more general Animal type (which is a good thing). One of the advantages of a more general type would be it would allow you to create more precise typeclass instances of Animal.</p>\n\n<p>However in your case the easiest way would be to derive <code>Show</code>, <code>Eq</code>, and then write an Ord instance like so:</p>\n\n<pre><code>data Animal = Cat String | Dog String | Fox String deriving (Show, Eq)\n\ninstance Ord Animal where\n  (Cat x) `compare` (Cat y) = x `compare` y\n  (Cat x) `compare` (Dog y) = x `compare` y\n  (Cat x) `compare` (Fox y) = x `compare` y\n  (Dog x) `compare` (Cat y) = x `compare` y\n  (Dog x) `compare` (Dog y) = x `compare` y\n  (Dog x) `compare` (Fox y) = x `compare` y\n  (Fox x) `compare` (Cat y) = x `compare` y\n  (Fox x) `compare` (Dog y) = x `compare` y\n  (Fox x) `compare` (Fox y) = x `compare` y\n</code></pre>\n\n<p>or </p>\n\n<pre><code>data Animal a = Cat a | Dog a | Fox a deriving (Show, Eq)\n\ninstance Ord a =&gt; Ord (Animal a) where\n  (Cat x) `compare` (Cat y) = x `compare` y\n  (Cat x) `compare` (Dog y) = x `compare` y\n  (Cat x) `compare` (Fox y) = x `compare` y\n  (Dog x) `compare` (Cat y) = x `compare` y\n  (Dog x) `compare` (Dog y) = x `compare` y\n  (Dog x) `compare` (Fox y) = x `compare` y\n  (Fox x) `compare` (Cat y) = x `compare` y\n  (Fox x) `compare` (Dog y) = x `compare` y\n  (Fox x) `compare` (Fox y) = x `compare` y\n</code></pre>\n\n<p>You can use <code>sort</code> because now <code>Animal</code> has an <code>Ord</code> instance</p>\n\n<pre><code>-- sort :: Ord a =&gt; [a] -&gt; [a]\n\nsort testAnimals\n</code></pre>\n\n<p>Point is: use typeclasses. That is just the easiest way for your simple type.</p>\n"}, {"tags": [], "owner": {"reputation": 228, "user_id": 7347627, "user_type": "registered", "profile_image": "https://graph.facebook.com/1828143650801314/picture?type=large", "display_name": "samsergey", "link": "https://stackoverflow.com/users/7347627/samsergey"}, "is_accepted": false, "score": 0, "last_activity_date": 1484088676, "last_edit_date": 1484088676, "creation_date": 1484088213, "answer_id": 41579756, "question_id": 41568096, "link": "https://stackoverflow.com/questions/41568096/how-to-sort-custom-type-by-string/41579756#41579756", "title": "How to sort custom Type by String", "body": "<p>Joining answers, given by @Willem Van Onsem (record-syntax) and @urbanslug (implementing <code>Ord</code> class instance) we obtain the simplest one:</p>\n\n<pre><code>data Animal a = Cat {name :: a}\n              | Dog {name :: a}\n              | Fox {name :: a} deriving (Show, Eq)\n\ninstance Ord a =&gt; Ord (Animal a) where\n  a1 `compare` a2 = name a1 `compare` name a2\n</code></pre>\n\n<p>So that it is possible to say simply</p>\n\n<pre><code>\u03bb&gt; sort [(Dog \"c\"),(Fox \"a\"),(Cat \"b\")]\n[Fox {name = \"a\"},Cat {name = \"b\"},Dog {name = \"c\"}]\n</code></pre>\n\n<p>Using <code>Data.Ord.comparing</code> function one coud write even more precisely:</p>\n\n<pre><code>instance Ord a =&gt; Ord (Animal a) where compare = comparing name\n</code></pre>\n"}], "owner": {"reputation": 327, "user_id": 3374117, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BQsT9.jpg?s=128&g=1", "display_name": "Kert Kukk", "link": "https://stackoverflow.com/users/3374117/kert-kukk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 41568203, "answer_count": 3, "score": 2, "last_activity_date": 1484088676, "creation_date": 1484048806, "last_edit_date": 1484069699, "question_id": 41568096, "link": "https://stackoverflow.com/questions/41568096/how-to-sort-custom-type-by-string", "title": "How to sort custom Type by String", "body": "<p>How can I sort animals by their name? Names are represented by <code>String</code> values.</p>\n\n<pre><code>data Animal = Cat String | Dog String | Fox String deriving (Show)\n\ntestAnimals = [(Dog \"c\"),(Fox \"a\"),(Cat \"b\")]\n\nsortAnimalsByName :: [Animal] -&gt; [Animal]\nsortAnimalsByName animals = undefined\n</code></pre>\n\n<p>The query:</p>\n\n<pre><code>sortAnimalsByName testAnimals\n</code></pre>\n\n<p>should return:</p>\n\n<pre><code>[(Fox \"a\"),(Cat \"b\"),(Dog \"c\")]\n</code></pre>\n\n<p>I think the function <code>sort :: Ord a =&gt; [a] -&gt; [a]</code> from <code>Data.List</code> should be used, but how?</p>\n"}, {"tags": ["json", "haskell", "io", "lazy-evaluation", "aeson"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1484036507, "post_id": 41561189, "comment_id": 70332518, "body": "The simple answer is yes, use conduit or the like. The more complicated answer is, your <code>loadAllResults</code> is <i>incredibly</i> lazy - simply executing <code>loadAllResults x</code> does not actually read any files (or indeed, open them). When you try to evaluate the resulting list, you simultaneously open all the files and try to read them. <code>withFile</code> doesn&#39;t help you because the laziness comes from <code>hGetContents</code> - try switching to non-lazy Text IO."}], "answers": [{"comments": [{"owner": {"reputation": 479, "user_id": 1050182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bfgX0.jpg?s=128&g=1", "display_name": "Yuan Wang", "link": "https://stackoverflow.com/users/1050182/yuan-wang"}, "edited": false, "score": 1, "creation_date": 1484060498, "post_id": 41566055, "comment_id": 70348261, "body": "Thank you so much for the detailed answer!"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 5, "last_activity_date": 1484042781, "last_edit_date": 1484042781, "creation_date": 1484042428, "answer_id": 41566055, "question_id": 41561189, "link": "https://stackoverflow.com/questions/41561189/how-to-use-data-text-lazy-io-to-parse-json-files-with-aeson/41566055#41566055", "title": "How to use Data.Text.Lazy.IO to parse JSON files with Aeson", "body": "<p>Generally speaking I <em>would</em> recommend using a streaming library for parsing arbitrarily sized data like a JSON file. However, in the specific case of parsing JSON with aeson, the concerns of overrunning memory are not as significant IMO, since the aeson library itself will ultimately represent the entire file in memory as a <code>Value</code> type. So given that, you may choose to simply use strict bytestring I/O. I've given an example of using both conduit and strict I/O for parsing a JSON value. (I think the conduit version exists in some libraries already, I'm not sure.)</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack --resolver lts-7.14 --install-ghc runghc\n   --package aeson --package conduit-extra\n-}\nimport           Control.Monad.Catch     (MonadThrow, throwM)\nimport           Control.Monad.IO.Class  (MonadIO, liftIO)\nimport           Data.Aeson              (FromJSON, Result (..), eitherDecodeStrict',\n                                          fromJSON, json, Value)\nimport           Data.ByteString         (ByteString)\nimport qualified Data.ByteString         as B\nimport           Data.Conduit            (ConduitM, runConduitRes, (.|))\nimport           Data.Conduit.Attoparsec (sinkParser)\nimport           Data.Conduit.Binary     (sourceFile)\n\nsinkFromJSON :: (MonadThrow m, FromJSON a) =&gt; ConduitM ByteString o m a\nsinkFromJSON = do\n    value &lt;- sinkParser json\n    case fromJSON value of\n        Error e -&gt; throwM $ userError e\n        Success x -&gt; return x\n\nreadJSONFile :: (MonadIO m, FromJSON a) =&gt; FilePath -&gt; m a\nreadJSONFile fp = liftIO $ runConduitRes $ sourceFile fp .| sinkFromJSON\n\n-- Or using strict I/O\nreadJSONFileStrict :: (MonadIO m, FromJSON a) =&gt; FilePath -&gt; m a\nreadJSONFileStrict fp = liftIO $ do\n    bs &lt;- B.readFile fp\n    case eitherDecodeStrict' bs of\n        Left e -&gt; throwM $ userError e\n        Right x -&gt; return x\n\nmain :: IO ()\nmain = do\n    x &lt;- readJSONFile \"test.json\"\n    y &lt;- readJSONFileStrict \"test.json\"\n    print (x :: Value)\n    print (y :: Value)\n</code></pre>\n\n<p><strong>EDIT</strong> Forgot to mention: I'd strongly recommend <em>against</em> using textual I/O for reading your JSON files. JSON files should be encoded with UTF-8, while the textual I/O functions will use whatever your system settings specify for character encoding. Relying on <code>Data.ByteString.readFile</code> and similar is more reliable. I went into more detail <a href=\"http://www.snoyman.com/blog/2016/12/beware-of-readfile\" rel=\"noreferrer\">in a recent blog post</a>.</p>\n"}], "owner": {"reputation": 479, "user_id": 1050182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/bfgX0.jpg?s=128&g=1", "display_name": "Yuan Wang", "link": "https://stackoverflow.com/users/1050182/yuan-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 41566055, "answer_count": 1, "score": 4, "last_activity_date": 1484042781, "creation_date": 1484022794, "last_edit_date": 1484023151, "question_id": 41561189, "link": "https://stackoverflow.com/questions/41561189/how-to-use-data-text-lazy-io-to-parse-json-files-with-aeson", "title": "How to use Data.Text.Lazy.IO to parse JSON files with Aeson", "body": "<p>I want to parse all json files in a given directory into a data type <em>Result</em>.</p>\n\n<p>So i have a decode function </p>\n\n<pre><code>decodeResult :: Data.ByteString.Lazy.ByteString -&gt; Maybe Result\n</code></pre>\n\n<p>I began with <em>Data.Text.Lazy.IO</em> to load file into Lazy ByteString,</p>\n\n<pre><code>import qualified Data.Text.Lazy.IO as T\nimport qualified Data.Text.Lazy.Encoding as T\n\ngetFileContent :: FilePath -&gt; IO B.ByteString\ngetFileContent path = T.encodeUtf8 `fmap` T.readFile path\n</code></pre>\n\n<p>It compiled, but I ran into Too many files opened problem, so I thought maybe I should use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/System-IO.html#v:withFile\" rel=\"nofollow noreferrer\"><em>withFile</em></a>.</p>\n\n<pre><code>import System.IO\nimport qualified Data.ByteString.Lazy as B\nimport qualified Data.Text.Lazy.IO as T\nimport qualified Data.Text.Lazy.Encoding as T\n\ngetFileContent :: FilePath -&gt; IO (Maybe Result)\ngetFileContent path = withFile path ReadMode $ \\hnd -&gt; do\n   content &lt;- T.hGetContents hnd\n   return $ (decodeAnalytic . T.encodeUtf8) content\n\nloadAllResults :: FilePath -&gt; IO [Result]\nloadAllResults path = do\n   paths &lt;- listDirectory path\n   results &lt;- sequence $ fmap getFileContent (fmap (path ++ ) $ filter (endswith \".json\") paths)\n   return $ catMaybes results\n</code></pre>\n\n<p>In this version, the lazy io seems never got evaluated, it always return empty list. But If i print content inside <em>getFileContent</em> function, then everything seems work correctly.</p>\n\n<pre><code>getFileContent :: FilePath -&gt; IO (Maybe Result)\ngetFileContent path = withFile path ReadMode $ \\hnd -&gt; do\n   content &lt;- T.hGetContents hnd\n   print content\n   return $ (decodeAnalytic . T.encodeUtf8) content\n</code></pre>\n\n<p>So I am not sure what am I missing, should I use conduit for this type of things?</p>\n"}, {"tags": ["haskell", "type-level-computation"], "comments": [{"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1484052956, "post_id": 41561169, "comment_id": 70342745, "body": "You may be interested in <a href=\"https://stackoverflow.com/questions/41492754/could-not-deduce-knownnat-in-two-existentials-with-respect-to-the-singletons-lib/41496362\">this question</a> and the corresponding answer."}], "answers": [{"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 10, "last_activity_date": 1484027393, "last_edit_date": 1484027393, "creation_date": 1484026775, "answer_id": 41561843, "question_id": 41561169, "link": "https://stackoverflow.com/questions/41561169/avoiding-class-constraint-on-type-level-naturals/41561843#41561843", "title": "Avoiding class constraint on type level naturals", "body": "<p>This GHC type checker plugin does exactly that (derives \"complex\" <code>KnownNat</code> constraints from other ones already available): <a href=\"https://hackage.haskell.org/package/ghc-typelits-knownnat\" rel=\"noreferrer\">https://hackage.haskell.org/package/ghc-typelits-knownnat</a></p>\n\n<p>If \"type checker plugin\" sounds a little intimidating (it did to me at first), it's actually very simple to use. Simply add it as a dependency in your package file (or cabal install it) like any other package, then either add:</p>\n\n<pre><code>{-# OPTIONS_GHC -fplugin GHC.TypeLits.Normalise #-}\n</code></pre>\n\n<p>to the start of your source files (much like a <code>LANGUAGE</code> pragma), or add it as an option globally in your package file.</p>\n\n<p>There's also another plugin by the same author that's very useful as well for working with typelit Nats: <a href=\"https://hackage.haskell.org/package/ghc-typelits-natnormalise\" rel=\"noreferrer\">https://hackage.haskell.org/package/ghc-typelits-natnormalise</a>. This one is able to infer equality of Nat type expressions that GHC on its own gives up on: things like <code>n + (m + 1) ~ (n + 1) + m</code> that come up all the time when GHC is trying to prove \"expected\" and \"actual\" types match.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 1, "accepted_answer_id": 41561843, "answer_count": 1, "score": 5, "last_activity_date": 1484027393, "creation_date": 1484022697, "question_id": 41561169, "link": "https://stackoverflow.com/questions/41561169/avoiding-class-constraint-on-type-level-naturals", "title": "Avoiding class constraint on type level naturals", "body": "<p>I am using the <code>Nat</code> type in from the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-TypeLits.html\" rel=\"noreferrer\"><code>GHC.TypeLits</code></a> module, which admittedly says the programmer interface should be defined in a separate library. In any case, the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-TypeLits.html\" rel=\"noreferrer\"><code>GHC.TypeLits</code></a> has a class <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-TypeLits.html#t:KnownNat\" rel=\"noreferrer\"><code>KnownNat</code></a> with a class function <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-TypeLits.html#v:natVal\" rel=\"noreferrer\"><code>natVal</code></a> which converts a compile time <code>Nat</code> into a runtime <code>Integer</code>. There's also a type function <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-TypeLits.html#t:-43-\" rel=\"noreferrer\"><code>(+)</code></a> which adds compile time <code>Nat</code>s.</p>\n\n<p>The problem is that given <code>(KnownNat n1, KnownNat n2)</code>, GHC can't derive that <code>KnownNat (n1 + n2)</code>.</p>\n\n<p>This results in an explosion of constraints needed to be added whenever I add type level naturals.</p>\n\n<p>One alternative would be to define Natural numbers myself like so:</p>\n\n<pre><code>data Nat = Zero | Succ Nat\n</code></pre>\n\n<p>Or perhaps use a library like <a href=\"https://hackage.haskell.org/package/type-natural-0.7.1.2/docs/Data-Type-Natural.html\" rel=\"noreferrer\">type-natural</a>. But it seems silly to not use the Nats which are built into GHC, which also allow you to nicely use literal numbers in types (i.e. <code>0</code>, <code>1</code>) instead of having to define:</p>\n\n<pre><code>N0 = Zero\nN1 = Succ N0\netc...\n</code></pre>\n\n<p>Is there anyway around this issue with GHC <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-TypeLits.html#t:KnownNat\" rel=\"noreferrer\"><code>KnownNat</code></a> constraints being required all over the place? Or should I just ignore the <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-TypeLits.html\" rel=\"noreferrer\"><code>GHC.TypeLits</code></a> module for my problem?</p>\n"}, {"tags": ["haskell", "functional-programming", "category-theory", "monoids"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1484018419, "post_id": 41560500, "comment_id": 70326031, "body": "As a footnote to the answers in the duplicate, one example of a nifty use of <code>Endo</code> is in <a href=\"http://stackoverflow.com/q/23319683/2751851\">getting a default implementation for <code>foldr</code> out of <code>foldMap</code></a>."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484019231, "post_id": 41560584, "comment_id": 70326222, "body": "Or use <code>TypeFamilies</code> and write <code>instance a ~ b =&gt; Monoid (a -&gt; b)</code>."}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 2, "last_activity_date": 1484018258, "creation_date": 1484018258, "answer_id": 41560584, "question_id": 41560500, "link": "https://stackoverflow.com/questions/41560500/set-of-transformations-fa-a-form-a-monoid-over-function-composition-how-do/41560584#41560584", "title": "Set of transformations f::a-&gt;a form a monoid over function composition - how do I make this an instance of Monoid?", "body": "<p>Actually the error message describes it quite well: <code>a -&gt; a</code> is a too specific type:</p>\n\n<blockquote>\n  <p>All instance types must be of the form <code>(T a1 ... an)</code>\n  where <code>a1 ... an</code> are <em>distinct type variables</em>,\n  and each type variable appears at most once in the instance head.</p>\n</blockquote>\n\n<p>The <code>T</code> here is the function type <code>-&gt;</code>, you could've written without the special infix notation</p>\n\n<pre><code>instance Monoid ((-&gt;) a a) where \u2026\n</code></pre>\n\n<p>and clearly <code>a</code> doesn't appear only once.</p>\n\n<p>On how to can fix this, again the error message recommends</p>\n\n<blockquote>\n  <p>Use <a href=\"https://prime.haskell.org/wiki/FlexibleInstances\" rel=\"nofollow noreferrer\"><code>FlexibleInstances</code></a> if you want to disable this [restriction].</p>\n</blockquote>\n"}], "owner": {"reputation": 143, "user_id": 4039275, "user_type": "registered", "profile_image": "https://graph.facebook.com/1027791609/picture?type=large", "display_name": "Matthew Hampsey", "link": "https://stackoverflow.com/users/4039275/matthew-hampsey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "closed_date": 1484018196, "accepted_answer_id": 41560584, "answer_count": 1, "score": 1, "last_activity_date": 1484018258, "creation_date": 1484017694, "question_id": 41560500, "link": "https://stackoverflow.com/questions/41560500/set-of-transformations-fa-a-form-a-monoid-over-function-composition-how-do", "closed_reason": "Duplicate", "title": "Set of transformations f::a-&gt;a form a monoid over function composition - how do I make this an instance of Monoid?", "body": "<p>It looks as though transformations should form a Monoid, with the identity function as the empty element and standard function composition as the binary operation. I don't think it's particularly useful, but it should be possible. Something along the lines of:</p>\n\n<pre><code>instance Monoid (a -&gt; a) where\n        mempty = id\n        mappend f g = (.)\n</code></pre>\n\n<p>The above doesn't compile, possibly because it is masked by the pre-existing definition</p>\n\n<pre><code>instance Monoid b =&gt; Monoid (a -&gt; b) where\n    mempty _ = mempty\n    mappend f g x = f x `mappend` g x\n</code></pre>\n\n<p>Error is:</p>\n\n<pre><code>Illegal instance declaration for \u2018Monoid (a -&gt; a)\u2019\n      (All instance types must be of the form (T a1 ... an)\n       where a1 ... an are *distinct type variables*,\n       and each type variable appears at most once in the instance head.\n       Use FlexibleInstances if you want to disable this.)\n    In the instance declaration for \u2018Monoid (a -&gt; a)\u2019\n</code></pre>\n\n<p>I'm still a Haskell scrub so I'm not sure how I can fix this - any help?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1484005462, "post_id": 41558870, "comment_id": 70322941, "body": "I suggest you read up on data declaration syntax.  Those are constructors."}, {"owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1484005667, "post_id": 41558870, "comment_id": 70322993, "body": "@ThomasM.DuBuisson any resources you could suggest? Neither of these explain very well"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1484006000, "post_id": 41558870, "comment_id": 70323079, "body": "I&#39;ve always felt that wikibooks is an under-rated resource (<a href=\"https://en.wikibooks.org/wiki/Haskell/Type_declarations\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/Type_declarations</a>) but LYAH does have a chapter for this (<a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses#algebraic-data-types\" rel=\"nofollow noreferrer\">learnyouahaskell.com/&hellip;</a>)."}, {"owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1484006233, "post_id": 41558870, "comment_id": 70323144, "body": "@ThomasM.DuBuisson yes this is the chapter of LYAH I was talking about. Maybe I didn&#39;t articulate my problem very well. The book doesn&#39;t seem to explain exactly what :-: means. I can&#39;t see the function defined or mentioned anywhere else in the chapter."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1484007268, "post_id": 41558870, "comment_id": 70323411, "body": "That <i>is</i> the definition.  It constructs a value of type <code>List a</code>.  <code>Empty</code> is a valid expression and represents an empty list.  <code>Cons 1 Empty</code> is a valid expression and its value is of type <code>List Int</code>."}, {"owner": {"reputation": 150, "user_id": 1354641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc485fc582b90d90622443527c0b4602?s=128&d=identicon&r=PG", "display_name": "Marcel Besixdouze", "link": "https://stackoverflow.com/users/1354641/marcel-besixdouze"}, "edited": false, "score": 0, "creation_date": 1610305503, "post_id": 41558870, "comment_id": 116085029, "body": "The output of <code>:t Cons</code>, once you get your scope problem sorted out, will be <code>Cons ::  a -&gt; List a -&gt; List a</code>, and the output of <code>:i Cons</code> will be the line you&#39;re asking about in your question."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1484059321, "post_id": 41559196, "comment_id": 70347444, "body": "You can use <code>Cons</code> in infix position as well, as long as it is enclosed in backquotes. Any constructor name beginning with <code>:</code> (such as <code>:</code> or <code>:-:</code>) is special-cased as an infix constructor and is used as such without enclosing it in backquotes."}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1484068533, "post_id": 41559196, "comment_id": 70353862, "body": "@chepner Sure, but then the backticks themselves are annoying."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1486727934, "post_id": 41559196, "comment_id": 71482848, "body": "I can&#39;t find <code>:-:</code> in hoogle, and ghci doesn&#39;t seem to recognise it. How does it differ from <code>:</code>?"}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1486738088, "post_id": 41559196, "comment_id": 71489221, "body": "@ZoeyHewll <code>:-:</code> isn&#39;t in the standard library. You have to define it first."}], "tags": [], "owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "is_accepted": false, "score": 7, "last_activity_date": 1484059397, "last_edit_date": 1484059397, "creation_date": 1484007354, "answer_id": 41559196, "question_id": 41558870, "link": "https://stackoverflow.com/questions/41558870/what-does-cons-and-mean-in-haskell/41559196#41559196", "title": "What does Cons and :-: mean in Haskell?", "body": "<p><code>:-:</code> is just an infix name for a data constructor. You could see that <code>data</code> declaration as equivalent to</p>\n\n<pre><code>data List a = Empty | (:-:) a (List a)\n</code></pre>\n\n<p>Semantically, there is no difference between using <code>(:-:)</code> or <code>Cons</code>, but it's much nicer to read</p>\n\n<pre><code>1 :-: 2 :-: 3 :-: 4 :-: Empty\n</code></pre>\n\n<p>than either</p>\n\n<pre><code>Cons 1 (Cons 2 (Cons 3 (Cons 4 Empty)))\n</code></pre>\n\n<p>or</p>\n\n<pre><code>1 `Cons` (2 `Cons` (3 `Cons` (4 `Cons` Empty)))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "edited": false, "score": 0, "creation_date": 1484007592, "post_id": 41559202, "comment_id": 70323501, "body": "Ah thank you I was starting to suspect that was it while playing around with it. I think too much coffee and too little sleep is a bad idea."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 10, "last_activity_date": 1484007378, "creation_date": 1484007378, "answer_id": 41559202, "question_id": 41558870, "link": "https://stackoverflow.com/questions/41558870/what-does-cons-and-mean-in-haskell/41559202#41559202", "title": "What does Cons and :-: mean in Haskell?", "body": "<blockquote>\n<pre><code>data List a = Cons a (List a) deriving (Show, Read, Eq, Ord)\n</code></pre>\n  \n  <p>I understand what most of this means apart from Cons. When I try <code>:t Cons</code> and <code>:i Cons</code> in <code>ghci</code> I get a  not in scope error.</p>\n</blockquote>\n\n<p>You need to load the Haskell source file with the <code>data</code> declaration before you can have <code>Cons</code> in scope. Or, alternatively, you can enter that <code>data</code> line directly in GHCi. </p>\n\n<p>For serious code, it's easier if you put it in a file and load it. This is because the learning process typically involves modifying the file a bit, reloading it, trying some test in GHCi, modifying the file again, etc. Doing this in GHCi is cumbersome.</p>\n\n<p>Anyway, <code>Cons</code> is just the constructor name -- it is an arbitrary name. You can use <code>data List a = Foobar a (List a) ....</code> and name it <code>Foobar</code>, if you wish. <code>Cons</code> is a historic name, though, originating from Lisp.</p>\n\n<p><code>:-:</code> is another arbitrary name for the constructor, except that it can be used <em>infix</em>. I.e. instead of <code>Cons 1 someList</code> one can write <code>1 :-: someList</code>.</p>\n"}], "owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13675, "favorite_count": 1, "accepted_answer_id": 41559202, "answer_count": 2, "score": 5, "last_activity_date": 1484059397, "creation_date": 1484005397, "last_edit_date": 1484039123, "question_id": 41558870, "link": "https://stackoverflow.com/questions/41558870/what-does-cons-and-mean-in-haskell", "title": "What does Cons and :-: mean in Haskell?", "body": "<p>In <a href=\"http://learnyouahaskell.com/\" rel=\"noreferrer\">LYAHFGG</a>, one chapter says that list is defined as:</p>\n\n<pre><code>data List a = Cons a (List a) deriving (Show, Read, Eq, Ord)\n</code></pre>\n\n<p>I understand what most of this means apart from Cons. When I try <code>:t Cons</code> and <code>:i Cons</code> in <code>ghci</code> I get a  not in scope error. Later on in the chapter it also talks about :-: and how it's the same as Cons</p>\n\n<pre><code>infixr 5 :-:  \ndata List a = Empty | a :-: (List a) deriving (Show, Read, Eq, Ord)  \n</code></pre>\n\n<p>But again I really don't understand what this <code>:-:</code> means either. </p>\n\n<p>In another resource, in a section about data types, they define the following data type:</p>\n\n<pre><code>data Expr = X\n      | Const Int\n      | Expr :+: Expr\n      | Expr :-: Expr\n      | Expr :*: Expr\n      | Expr :/: Expr\n      | IfZero Expr Expr Expr\n      deriving (Eq, Ord)\n</code></pre>\n\n<p>Where <code>IfZero p q r</code> is the same as <code>if p == 0 then q else r</code>. Is this the same thing? I'm mostly confused as to what the two <code>:</code>s mean, and if it's mandatory syntax or just style choice.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1484004490, "post_id": 41558667, "comment_id": 70322643, "body": "In a word: no. But you can use the <code>C{}</code> pattern if you don\u2019t want to write out all the fields."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 5, "creation_date": 1484005241, "post_id": 41558667, "comment_id": 70322882, "body": "Why would you want to avoid pattern matching? It&#39;s a fundamental part of Haskell."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1484006912, "post_id": 41558667, "comment_id": 70323314, "body": "Why do you want to check the constructor alone? In the vast majority of cases, after you discover that <code>x</code> is a <code>C something</code> you&#39;ll want to know what is <code>something</code>. Pattern matches solves this simply. The <code>isA,...</code> functions may be symptoms of <i>boolean blindness</i>, where all the relevant information is compressed into a boolean, losing most of it in the process."}], "answers": [{"comments": [{"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "edited": false, "score": 0, "creation_date": 1484007003, "post_id": 41558843, "comment_id": 70323341, "body": "The last \u201ce\u201d from <code>True</code> got split off. Also, you could&#39;ve used <code>fmap (const ()) x == C ()</code>. Since the internal value is irrelevant, the unit type is in a sense the \u201cmore appropriate\u201d choice."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1484007495, "post_id": 41558843, "comment_id": 70323474, "body": "I don&#39;t think someone recommended <code>isC x = x == C{}</code> - but pattern matching on the constructor <code>C</code> , i.e. <code>isC C{} = True; isC _ = False</code> which saves you writing wildcards for every field of the constructor."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1484088865, "last_edit_date": 1484088865, "creation_date": 1484005250, "answer_id": 41558843, "question_id": 41558667, "link": "https://stackoverflow.com/questions/41558667/match-data-without-pattern-matching/41558843#41558843", "title": "Match data without pattern matching", "body": "<p>To my knowledge even your first example would not compile without an error</p>\n\n<pre><code>&gt; ghci\n...\nPrelude&gt; data MyData = A | B | C Char\nPrelude&gt; isA x = x == A\n\n&lt;interactive&gt;:2:9: error:\n    \u2022 No instance for (Eq MyData) arising from a use of \u2018==\u2019\n    \u2022 In the expression: x == A\n      In an equation for \u2018isA\u2019: isA x = x == A\n</code></pre>\n\n<p>which can be fixed easily by</p>\n\n<pre><code>Prelude&gt; data MyData = A | B | C Char deriving (Eq)\n</code></pre>\n\n<p>@Alexis King's <strike>advice</strike> comment defining</p>\n\n<pre><code>isC x = x == C{}\n</code></pre>\n\n<p>will compile but raise a run time error</p>\n\n<pre><code>isC (C 'a')\n*** Exception: &lt;interactive&gt;:6:14-17: Missing field in record construction\n</code></pre>\n\n<hr>\n\n<p>If I view this correctly this is a special case of <code>(a -&gt; b)</code> having no <code>Eq</code> instance - because in general you cannot (reasonably) define <code>==</code> say for something like <code>[Double] -&gt; Int</code> - the only reasonable definition same input data yield same output data - is not feasible.</p>\n\n<h2>Note:</h2>\n\n<p>If you accept pattern matching - you do not need the additional <code>deriving (Eq)</code> for the <code>isA</code>, <code>isB</code> and <code>isC</code> pattern matching does not need this.</p>\n\n<hr>\n\n<p>I have found another weird way - but we also need to change the type and use a Language Pragma:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\nPrelude> :set -XDeriveFunctor\nPrelude> data MyData a = A | B | C a deriving (Eq, Functor)\nPrelude> <strike>isC x = fmap (const True) x == C True</strike>\nPrelude> isC x = fmap (const ()) x == C ()\n</code></pre>\n\n<h2>Remark</h2>\n\n<p>I think your question is a bit like - can I ride the bicycle without legs - the answer is well kind of you need a special bike for that. Or in your case - it works if you have <code>deriving Eq</code> and type constructors without any parameters.</p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 6, "last_activity_date": 1484008292, "last_edit_date": 1484008292, "creation_date": 1484005281, "answer_id": 41558846, "question_id": 41558667, "link": "https://stackoverflow.com/questions/41558667/match-data-without-pattern-matching/41558846#41558846", "title": "Match data without pattern matching", "body": "<p>As a point of terminology, you're checking if a variable matches a certain data <em>constructor</em>, not <em>type</em>.  All your values are of type <code>MyData</code>; you're checking which constructor they match.</p>\n\n<p>That being said, there is no good reason to avoid pattern matching.  In fact, the correct idiomatic way in Haskell to implement <code>isA</code> is:</p>\n\n<pre><code>isA A = True\nisA _ = False\n</code></pre>\n\n<p>or, if you prefer:</p>\n\n<pre><code>isA x = case x of { A -&gt; True; _ -&gt; False }\n</code></pre>\n\n<p>Likewise, correct ways to implement <code>isC</code> are:</p>\n\n<pre><code>isC (C _) = True\nisC _ = False\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>isC x = case x of { C _ -&gt; True; _ -&gt; False }\n</code></pre>\n\n<p>If you are trying to avoid pattern matching because you are concerned that it is somehow less efficient than testing equality, disabuse yourself of this notion.  It is the most efficient way to determine the constructor of a value.</p>\n\n<p>If you are trying to avoid pattern matching because you dislike the syntax or have some kind of personal distaste for the technique, then you have my sympathies:  learning Haskell will be a miserable experience for you.</p>\n"}], "owner": {"reputation": 5377, "user_id": 4593869, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/06da0e57ee68db68028e3be4d0da144e?s=128&d=identicon&r=PG&f=1", "display_name": "Code", "link": "https://stackoverflow.com/users/4593869/code"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 41558846, "answer_count": 2, "score": 0, "last_activity_date": 1484088865, "creation_date": 1484004256, "last_edit_date": 1484005931, "question_id": 41558667, "link": "https://stackoverflow.com/questions/41558667/match-data-without-pattern-matching", "title": "Match data without pattern matching", "body": "<p>How can I check if a variable is of a certain data type without pattern matching?</p>\n\n<pre><code>data MyData = A | B | C char\n            deriving (Eq)\n\n-- This works.\nisA :: MyData -&gt; Bool\nisA x = x == A\n\n-- This generates a compile error.\nisC :: MyData -&gt; Bool\nisC x = x == C\n</code></pre>\n\n<p>Edit: Forgot to add <code>deriving Eq</code>.</p>\n"}, {"tags": ["haskell", "polymorphism"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1484001093, "post_id": 41557954, "comment_id": 70321500, "body": "Real world example: <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad-ST.html#v:runST\" rel=\"nofollow noreferrer\"><code>runST :: (forall s. ST s a) -&gt; a</code></a> keeps two separate <code>ST</code> computations from having the same <code>s</code>. This prevents you from leaking <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-STRef.html#t:STRef\" rel=\"nofollow noreferrer\"><code>STRef</code></a>s outside the <code>ST</code> monad."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484001159, "post_id": 41557954, "comment_id": 70321531, "body": "I&#39;m not sure I understand why rank-2 functions seem similar to GADTs to you. Can you clarify what you mean by that?"}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484001606, "post_id": 41557954, "comment_id": 70321677, "body": "@DanielWagner At least existential types can be expressed with GADTs (e.g <code>data Ext where Ext :: a -&gt; Ext</code>). Probably also other constructs that could be expressed with Rank 2 Types?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1484004795, "post_id": 41557954, "comment_id": 70322724, "body": "One can encode the equality between two types (as in the &#39;canonical&#39; GADT - <code>data (:~:) a b where Refl :: a :~: a</code>) using rank 2 types - <code>newtype (:~:) a b = Refl (forall p . p a -&gt; p b)</code> - and a similar such encoding is used in <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Equality.html\" rel=\"nofollow noreferrer\"><code>lens</code></a>."}], "answers": [{"comments": [{"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1484051637, "post_id": 41559258, "comment_id": 70341885, "body": "This is a great answer, the additional introduction to lenses is much appreciated!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1484008029, "last_edit_date": 1484008029, "creation_date": 1484007726, "answer_id": 41559258, "question_id": 41557954, "link": "https://stackoverflow.com/questions/41557954/practical-applications-of-rank-2-polymorphism/41559258#41559258", "title": "Practical applications of Rank 2 polymorphism?", "body": "<p>If you pass a polymorphic function as and argument to a Rank2-polymorphic function, you're essentially passing not just one function but a whole <em>family</em> of functions \u2013 for all possible types that fulfill the constraints.</p>\n\n<p>Typically, those forall quantifiers come with a class constraint. For example, I might wish to do number arithmetic with two different types simultaneously (for comparing precision or whatever).</p>\n\n<pre><code>data FloatCompare = FloatCompare {\n     singlePrecision :: Float\n   , doublePrecision :: Double\n   }\n</code></pre>\n\n<p>Now I might want to modify those numbers through some maths operation. Something like</p>\n\n<pre><code>modifyFloat :: (Num -&gt; Num) -&gt; FloatCompare -&gt; FloatCompare\n</code></pre>\n\n<p>But <code>Num</code> is not a type, only a type class. I could of course pass a function that would modify any <em>particular</em> number type, but I couldn't use that to modify <em>both</em> a <code>Float</code> and a <code>Double</code> value, at least not without some ugly (and possibly lossy) converting back and forth.</p>\n\n<p>Solution: Rank-2 polymorphism!</p>\n\n<pre><code>modifyFloat :: (\u2200 n . Num n =&gt; n -&gt; n) -&gt; FloatCompare -&gt; FloatCompare\nmofidyFloat f (FloatCompare single double)\n    = FloatCompare (f single) (f double)\n</code></pre>\n\n<p>The best single example of how this is useful in practice are probably <a href=\"http://lens.github.io/tutorial.html\" rel=\"noreferrer\">lenses</a>. A lens is a \u201csmart accessor function\u201d to a field in some larger data structure. It allows you to access fields, update them, gather results... while at the same time composing in a very simple way. How it works: Rank2-polymorphism; every lens is polymorphic, with the different instantiations corresponding to the \u201cgetter\u201d / \u201csetter\u201d aspects, respectively.</p>\n"}, {"tags": [], "owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "is_accepted": false, "score": 3, "last_activity_date": 1484089707, "creation_date": 1484089707, "answer_id": 41580059, "question_id": 41557954, "link": "https://stackoverflow.com/questions/41557954/practical-applications-of-rank-2-polymorphism/41580059#41580059", "title": "Practical applications of Rank 2 polymorphism?", "body": "<p>The go-to example of an application of rank-2 types is <code>runST</code> as Benjamin Hodgson mentioned in the comments.  This is a rather good example and there are a variety of examples using the same trick. For example, <a href=\"http://okmij.org/ftp/Haskell/eliminating-array-bound-check.lhs\" rel=\"nofollow noreferrer\">branding</a> to maintain abstract data type invariants across multiple types, avoiding confusion of differentials in <a href=\"http://hackage.haskell.org/package/ad-4.3.2.1/docs/Numeric-AD.html\" rel=\"nofollow noreferrer\">ad</a>, a <a href=\"http://okmij.org/ftp/Haskell/regions.html#light-weight\" rel=\"nofollow noreferrer\">region-based version of ST</a>.</p>\n\n<p>But I'd actually like to talk about how Haskell programmers are implicitly using rank-2 types all the time.  Every type class whose methods have universally quantified types desugars to a dictionary with a field with a rank-2 type.  In practice, this is virtually always a higher-kinded type class<sup>*</sup> like <code>Functor</code> or <code>Monad</code>. I'll use a simplified version of <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Applicative.html#g:2\" rel=\"nofollow noreferrer\"><code>Alternative</code></a> as an example.  The class declaration is:</p>\n\n<pre><code>class Alternative f where\n    empty :: f a\n    (&lt;|&gt;) :: f a -&gt; f a -&gt; f a\n</code></pre>\n\n<p>The dictionary representing this class would be:</p>\n\n<pre><code>data AlternativeDict f = AlternativeDict {\n    empty :: forall a. f a,\n    (&lt;|&gt;) :: forall a. f a -&gt; f a -&gt; f a }\n</code></pre>\n\n<p>Sometimes such an encoding is nice as it allows one to use different \"instances\" for the same type, perhaps only locally.  For example, <code>Maybe</code> has two obvious instances of <code>Alternative</code> depending on whether <code>Just a &lt;|&gt; Just b</code> is <code>Just a</code> or <code>Just b</code>. Languages without type classes, such as Scala, do indeed <a href=\"https://oss.sonatype.org/service/local/repositories/snapshots/archive/org/scalaz/scalaz_2.12/7.3.0-SNAPSHOT/scalaz_2.12-7.3.0-SNAPSHOT-javadoc.jar/!/scalaz/PlusEmpty.html\" rel=\"nofollow noreferrer\">use this encoding</a>. </p>\n\n<p>To connect to leftaroundabout's reference to <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">lenses</a>, you can view the hierarchy there as a hierarchy of type classes and the lens combinators as simply tools for explicitly building the relevant type class dictionaries.  Of course, the reason it isn't <em>actually</em> a hierarchy of type classes is that we usually will have multiple \"instances\" for the same type.  E.g. <code>_head</code> and <code>_head . _tail</code> are <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Cons.html#v:_head\" rel=\"nofollow noreferrer\">both</a> \"instances\" of <code>Traversal' s a</code>. </p>\n\n<p><sup>*</sup> A higher-kinded type class doesn't necessarily lead to  this, and it can happen for a type class of kind <code>*</code>. For example:</p>\n\n<pre><code>-- Higher-kinded but doesn't require universal quantification.\nclass Sum c where\n    sum :: c Int -&gt; Int\n\n-- Not higher-kinded but does require universal quantification.\nclass Length l where\n    length :: [a] -&gt; l\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1855, "user_id": 6587634, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209643793277415/picture?type=large", "display_name": "Wong Jia Hau", "link": "https://stackoverflow.com/users/6587634/wong-jia-hau"}, "is_accepted": false, "score": 0, "last_activity_date": 1617865634, "creation_date": 1617865634, "answer_id": 66998915, "question_id": 41557954, "link": "https://stackoverflow.com/questions/41557954/practical-applications-of-rank-2-polymorphism/66998915#66998915", "title": "Practical applications of Rank 2 polymorphism?", "body": "<p>If you are using modules in Haskell, you are already using Rank-2 types. Theoretically speaking, modules are records with rank-2 type properties.</p>\n<p>For example, the <code>Foo</code> module below in Haskell ...</p>\n<pre><code>module Foo(id) where\nid :: forall a. a -&gt; a\nid x = x\n</code></pre>\n<pre><code>import qualified Foo\nmain = do\n  putStrLn (Foo.id &quot;hello&quot;)\n  return ()\n</code></pre>\n<p>... can actually be thought as a record as follows:</p>\n<pre><code>type FooType = FooType {\n  id :: forall a. a -&gt; a\n}\nFoo :: FooType\nFoo = Foo {\n  id = \\x -&gt; x\n}\n</code></pre>\n<p>P/S (unrelated this question): from a language design perspective, if you are going to support module system, then you might as well support higher-rank types (i.e. allow arbitrary quantification of type variables on any level) to reduce duplication of efforts (i.e. type checking a module should be almost the same as type checking a record with higher rank types).</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 1, "accepted_answer_id": 41559258, "answer_count": 3, "score": 4, "last_activity_date": 1617865634, "creation_date": 1484000515, "last_edit_date": 1484058945, "question_id": 41557954, "link": "https://stackoverflow.com/questions/41557954/practical-applications-of-rank-2-polymorphism", "title": "Practical applications of Rank 2 polymorphism?", "body": "<p>I'm covering polymorphism and I'm trying to see the practical uses of such a feature. </p>\n\n<p>My basic understanding of Rank 2 is: </p>\n\n<pre><code>type MyType = \u2200 a. a -&gt; a\n\nsubFunction :: a -&gt; a\nsubFunction el = el\n\nmainFunction :: MyType -&gt; Int\nmainFunction func = func 3\n</code></pre>\n\n<p>I understand that this is allowing the user to use a polymorphic function (subFunction) inside mainFunction and strictly specify it's output (Int). This seems very similar to GADT's:</p>\n\n<pre><code>data Example a where\n ExampleInt :: Int -&gt; Example Int\n ExampleBool :: Bool -&gt; Example Bool\n</code></pre>\n\n<p>1) Given the above, is my understanding of Rank 2 polymorphism correct?</p>\n\n<p>2) What are the general situations where Rank 2 polymorphism can be used, as opposed to GADT's, for example?</p>\n"}, {"tags": ["list", "haskell", "queue", "instance"], "comments": [{"owner": {"reputation": 2116, "user_id": 63513, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/172563332d62ea121cbb10ac55e0e6b3?s=128&d=identicon&r=PG", "display_name": "Mr. Putty", "link": "https://stackoverflow.com/users/63513/mr-putty"}, "edited": false, "score": 0, "creation_date": 1483981358, "post_id": 41552588, "comment_id": 70311350, "body": "Shouldn&#39;t your instance declaration be Queue (QueueA a) instead?"}], "answers": [{"comments": [{"owner": {"reputation": 320, "user_id": 3742929, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100001447103526/picture?type=large", "display_name": "user3742929", "link": "https://stackoverflow.com/users/3742929/user3742929"}, "edited": false, "score": 0, "creation_date": 1483984798, "post_id": 41553092, "comment_id": 70313336, "body": "Thanks for your answer, how woud i use the TypeFamilies extension?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 320, "user_id": 3742929, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100001447103526/picture?type=large", "display_name": "user3742929", "link": "https://stackoverflow.com/users/3742929/user3742929"}, "edited": false, "score": 0, "creation_date": 1483985651, "post_id": 41553092, "comment_id": 70313807, "body": "@user3742929 You would put <code>{-# LANGUAGE TypeFamilies #-}</code> at the top of your file, same as any extension."}, {"owner": {"reputation": 320, "user_id": 3742929, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100001447103526/picture?type=large", "display_name": "user3742929", "link": "https://stackoverflow.com/users/3742929/user3742929"}, "edited": false, "score": 0, "creation_date": 1483986225, "post_id": 41553092, "comment_id": 70314099, "body": "The class method <code>empty&#39;     mentions none of the type or kind variables of the class </code>Queue a&#39;     When checking the class method: empty :: forall q. q     In the class declaration for `Queue&#39;"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 320, "user_id": 3742929, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100001447103526/picture?type=large", "display_name": "user3742929", "link": "https://stackoverflow.com/users/3742929/user3742929"}, "edited": false, "score": 0, "creation_date": 1483986903, "post_id": 41553092, "comment_id": 70314446, "body": "@user3742929 Odd, the code I posted compiled for me under GHC 8.0.1.  That error message makes me think that you didn&#39;t copy my code correctly, though, since it says the type signature of <code>empty</code> is <code>:: q</code> but your typeclass is <code>class Queue a</code>.  Make sure your type variables are all the same."}, {"owner": {"reputation": 320, "user_id": 3742929, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100001447103526/picture?type=large", "display_name": "user3742929", "link": "https://stackoverflow.com/users/3742929/user3742929"}, "edited": false, "score": 0, "creation_date": 1483990720, "post_id": 41553092, "comment_id": 70316454, "body": "Hmmm, checked again. Doesn&#39;t compile."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 320, "user_id": 3742929, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100001447103526/picture?type=large", "display_name": "user3742929", "link": "https://stackoverflow.com/users/3742929/user3742929"}, "edited": false, "score": 0, "creation_date": 1483992420, "post_id": 41553092, "comment_id": 70317287, "body": "@user3742929 Sorry, that was my bad.  I re-read my post and noticed that I put the implementation for <code>null</code> as <code>empty</code>.  Check my edit and try again, because now I&#39;m not being silly."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1483993336, "post_id": 41553092, "comment_id": 70317786, "body": "The standard (non-type-family) solutions would be <code>class Queue q item | q -&gt; item where empty :: q; (|&gt;) :: q -&gt; item -&gt; q</code> or the less flexible (but extension-free) <code>class Queue q where empty :: q item; (|&gt;) :: q item -&gt; item -&gt; q item</code>. By comparison, your version has the flexibility and extension requirements of the fundep version but not its good type inference properties."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1484004753, "post_id": 41553092, "comment_id": 70322717, "body": "@bheklilr @DanielWagner Why use any extensions? What&#39;s wrong with <code>class Queue q where push :: a -&gt; q a -&gt; q a {- etc -}</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1484005730, "post_id": 41553092, "comment_id": 70323015, "body": "@BenjaminHodgson That is the less flexible but extension-free alternative I proposed in my comment. I say &quot;less flexible&quot; for the usual reasons: you cannot have a <code>Queue</code> instance that only works for <code>Ord</code>erable items, for example, and you cannot have a <code>Queue</code> instance that puts its item type somewhere other than its last argument (e.g. if you need to shuffle it earlier to be able to instantiate another class, or if your type is monomorphic, or similar)."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1484006286, "post_id": 41553092, "comment_id": 70323161, "body": "@DanielWagner Ah, apologies, I misread your comment. I&#39;ve written up an answer elaborating on that idea"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 2, "last_activity_date": 1483992382, "last_edit_date": 1483992382, "creation_date": 1483981274, "answer_id": 41553092, "question_id": 41552588, "link": "https://stackoverflow.com/questions/41552588/queue-with-balanced-lists-in-haskell/41553092#41553092", "title": "Queue with balanced lists in haskell", "body": "<p>I think you'd want something like</p>\n\n<pre><code>class Queue q where\n    type Item q\n    empty :: q\n    (|&gt;) :: q -&gt; Item q -&gt; q\n    null :: q -&gt; Bool\n    head :: q -&gt; Item q\n    tail :: q -&gt; q\n    toList :: q -&gt; [Item q]\n</code></pre>\n\n<p>With the instance</p>\n\n<pre><code>instance Queue (QueueA a) where\n    type Item (QueueA a) = a\n\n    empty = QA [] []\n\n    (QA a b) |&gt; e = norm $ QA a (e : b)\n\n    ...\n</code></pre>\n\n<p>Note that this requires the <code>TypeFamilies</code> extension.</p>\n\n<p>The reason for your error is because you're conflating the queue itself with the values inside the queue.  For example, you have</p>\n\n<pre><code>instance Queue (QueueA b) where  -- changed (QueueA a) to (QueueA b) for clarity\n    head :: QueueA b -&gt; QueueA b\n    head ... = ...\n</code></pre>\n\n<p>Since <code>a ~ QueueA b</code> in your instance.  However, you're returning <code>b</code> with <code>Prelude.head</code>, hence the error.  You could also go with</p>\n\n<pre><code>class Queue q item where\n    empty :: q item\n    (|&gt;) :: q item -&gt; item -&gt; q item\n    null :: q item -&gt; Bool\n    head :: q item -&gt; item\n    tail :: q item -&gt; q item\n    toList :: q item -&gt; [item]\n</code></pre>\n\n<p>With <code>MultiParamTypeClasses</code> and co (GHC will tell you which extensions to enable), but I've found that this approach is usually less flexible in practice when working with generic containers.</p>\n"}, {"comments": [{"owner": {"reputation": 320, "user_id": 3742929, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100001447103526/picture?type=large", "display_name": "user3742929", "link": "https://stackoverflow.com/users/3742929/user3742929"}, "edited": false, "score": 0, "creation_date": 1484039427, "post_id": 41558868, "comment_id": 70334140, "body": "Shouldn&#39;t it be instance &quot;Queue QueueA where&quot;?"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 3, "last_activity_date": 1484043842, "last_edit_date": 1484043842, "creation_date": 1484005386, "answer_id": 41558868, "question_id": 41552588, "link": "https://stackoverflow.com/questions/41552588/queue-with-balanced-lists-in-haskell/41558868#41558868", "title": "Queue with balanced lists in haskell", "body": "<p>I think @bheklilr's answer is more complicated than necessary. I reckon a good-enough definition of a queue class can be given in pure Haskell 98:</p>\n\n<pre><code>class Queue q where\n    empty :: q a\n    push :: a -&gt; q a -&gt; q a\n    pop :: q a -&gt; Maybe (a, q a)\n</code></pre>\n\n<p>No need for type families or functional dependencies, unless you need to do advanced <a href=\"https://hackage.haskell.org/package/mono-traversable\" rel=\"nofollow noreferrer\"><code>mono-traversable</code></a>-like tricks.</p>\n\n<p>The rest of the functions in your class can be squeezed through this toothpaste tube:</p>\n\n<pre><code>-- it may make sense to make this into a class method with a default implementation,\n-- so that instances can give an optimised implementation where possible\nnull :: (Eq (q a), Queue q) =&gt; q a -&gt; Bool\nnull q = q == empty\n\n-- head and tail are unsafe! I don't recommend writing an interface like this\nhead :: Queue q =&gt; q a -&gt; a\nhead = fst . fromJust . pop\n\ntail :: Queue q =&gt; q a -&gt; q a\ntail = snd . fromJust . pop\n\n(|&gt;) :: Queue q =&gt; q a -&gt; a -&gt; q a\n(|&gt;) = flip push\n\ntoList :: Queue q =&gt; q a -&gt; [a]\ntoList = unfoldr pop\n</code></pre>\n\n<p>Your first-in-first-out queue can be made into an instance of <code>Queue</code> straightforwardly:</p>\n\n<pre><code>instance Queue QueueA where\n    empty = QA [] []\n\n    push x (QA front back) = QA front (x:back)\n\n    pop (QA [] []) = Nothing\n    pop (QA [] back) =\n        let (x:xs) = reverse back\n        in Just (x, QA xs [])\n    pop (QA (x:front) back) = Just (x, QA front back)\n</code></pre>\n\n<p>... as can a last-in-first-out queue:</p>\n\n<pre><code>newtype LIFO a = LIFO [a]\n\ninstance Queue LIFO where\n    empty = LIFO []\n    push x (LIFO xs) = LIFO (x:xs)\n    pop (LIFO []) = Nothing\n    pop (LIFO (x:xs)) = Just (x, LIFO xs)\n</code></pre>\n\n<hr>\n\n<p>If you want to include priority queues in your abstraction, it gets somewhat more complicated, because a priority queue needs to know how to choose the highest-priority element and the given interface provides no way of comparing elements. One way to patch up <code>Queue</code> would be to use the <code>ConstraintKinds</code> extension (with <code>MultiParamTypeClasses</code> and <code>FunctionalDependencies</code>) to enable <code>q</code> to specify the constraint it places on its elements:</p>\n\n<pre><code>class Queue c q | q -&gt; c where\n    empty :: c a =&gt; q a\n    push :: c a =&gt; a -&gt; q a -&gt; q a\n    pop :: c a =&gt; q a -&gt; Maybe (a, q a)\n</code></pre>\n\n<p>Then we can implement a priority queue using, eg, the <em>skew heap</em> from <a href=\"https://themonadreader.files.wordpress.com/2010/05/issue16.pdf\" rel=\"nofollow noreferrer\"><em>Playing With Priority Queues</em></a>...</p>\n\n<pre><code>instance Queue Ord SkewHeap where  -- SkewHeap requires that its elements be an instance of Ord\n    empty = Empty\n    push x q = q `merge` SkewNode x Empty Empty\n    pop Empty = Nothing\n    pop (SkewNode x l r) = Just (x, l `merge` r)\n</code></pre>\n\n<p>... and the previous two queues can be adapted to work with the new <code>Queue</code>...</p>\n\n<pre><code>class Trivial a\ninstance Trivial a\n\ninstance Queue Trivial QueueA where\n    {- as before -}\ninstance Queue Trivial LIFO where\n    {- as before \u2013}\n</code></pre>\n"}], "owner": {"reputation": 320, "user_id": 3742929, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100001447103526/picture?type=large", "display_name": "user3742929", "link": "https://stackoverflow.com/users/3742929/user3742929"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1484043842, "creation_date": 1483979579, "last_edit_date": 1483980376, "question_id": 41552588, "link": "https://stackoverflow.com/questions/41552588/queue-with-balanced-lists-in-haskell", "title": "Queue with balanced lists in haskell", "body": "<p>I'm trying to write a definition for balanced lists in haskell. QueueA should be the queue with balanced lists:</p>\n\n<pre><code>module QueueA where \n\nimport Queue\n\ndata QueueA a = QA [a] [a]\n\ninstance Queue (Queue a) where\n    empty = QA [] []\n\n    (|&gt;) (QA a b) el = norm $ QA a (el : b)\n\n    head (QA a _) = Prelude.head a\n\n    tail (QA a b) = norm $ QA (Prelude.tail a) b\n\n    toList queue = Queue.head queue : Queue.tail queue\n\n\nnorm :: [a] -&gt; [a]\nnorm queue@(QA a b) = if (length a) &gt;= (length b) then queue else QA (a ++ reverse b) []\n</code></pre>\n\n<p>based on the interface Queue</p>\n\n<pre><code>module Queue where\n\nclass Queue a where\n     empty :: a\n     (|&gt;) :: a -&gt; a -&gt; a\n     null :: a -&gt; Bool\n     head :: a -&gt; a\n     tail :: a -&gt; a\n     toList :: a -&gt; [a]\n</code></pre>\n\n<p>I have no idea how to define the interface correctly, I based this around an example i found. Most errors look like this:</p>\n\n<pre><code> Couldn't match expected type `a' with actual type `QueueA a1'\n  `a' is a rigid type variable bound by\n      the instance declaration\n      at C:\\Users\\kroll\\Dropbox\\WS 16.17\\Moderne Funktionale Programmierung\\\u00dcbung\\Blatt 8\\Code\\Queue\n</code></pre>\n\n<p>I know that defining empty :: a is probably wrong, but empty :: Queue a doesn't work either.</p>\n"}, {"tags": ["haskell", "functional-programming", "coding-style"], "answers": [{"tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 4, "last_activity_date": 1499992556, "last_edit_date": 1499992556, "creation_date": 1483981585, "answer_id": 41553202, "question_id": 41552250, "link": "https://stackoverflow.com/questions/41552250/mixing-fmap-and-bind/41553202#41553202", "title": "Mixing fmap and bind (&gt;&gt;=)", "body": "<p>I don't think it's \"bad\" (unless it forfeits optimisations in <code>fmap</code> of that particular monad), however I don't like its verbosity.</p>\n\n<p>I'd rather define my own operator for this, <a href=\"http://haskell.1045720.n5.nabble.com/Add-flipped-fmap-td3178048.html\" rel=\"nofollow noreferrer\"><code>&lt;$$&gt;</code> has been suggested</a> or <code>&lt;&amp;&gt;</code> would match the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Function.html#v:-36-\" rel=\"nofollow noreferrer\"><code>$</code></a>/<a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Function.html#v:-38-\" rel=\"nofollow noreferrer\"><code>&amp;</code></a>-duality well (see also <em><a href=\"https://stackoverflow.com/q/1678104/1048572\">Anyone ever flip (&lt;$&gt;)</a></em>):</p>\n\n<pre><code>infixl 1 &lt;&amp;&gt;\n(&lt;&amp;&gt;) = flip (&lt;$&gt;)\n\nfindDlls dir = listDirectoryAbs dir\n &gt;&gt;= filterM predicate3\n &lt;&amp;&gt; filter predicate2\n &gt;&gt;= filterM predicate1\n &lt;&amp;&gt; f\n</code></pre>\n\n<p>Btw, if your monad is an <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Arrow.html#t:Arrow\" rel=\"nofollow noreferrer\"><code>Arrow</code></a> (e.g. functions), then <code>&lt;&lt;&lt;</code>/<code>&gt;&gt;&gt;</code> combines nicely with <code>=&lt;&lt;</code>/<code>&gt;&gt;=</code>.</p>\n"}], "owner": {"reputation": 58948, "user_id": 857807, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/297e4dba223f5103614030100eab78ca?s=128&d=identicon&r=PG", "display_name": "dcastro", "link": "https://stackoverflow.com/users/857807/dcastro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 41553202, "answer_count": 1, "score": 3, "last_activity_date": 1499992556, "creation_date": 1483978552, "last_edit_date": 1483979560, "question_id": 41552250, "link": "https://stackoverflow.com/questions/41552250/mixing-fmap-and-bind", "title": "Mixing fmap and bind (&gt;&gt;=)", "body": "<p>In Haskell, when I have to mix calls to <code>fmap</code>/<code>&lt;$&gt;</code> and <code>&gt;&gt;=</code>/<code>=&lt;&lt;</code>, I invariably end up with lots of parenthesis.</p>\n\n<p>For example, here I'm calling <code>listDirectoryAbs dir :: IO [String]</code> and then chaining a series of <code>filter</code> and <code>filterM</code>, ending with a <code>fmap</code>.</p>\n\n<pre><code>findDlls :: String -&gt; IO [String]\nfindDlls dir = f &lt;$&gt; (filterM predicate1 =&lt;&lt; (filter predicate2 &lt;$&gt; (filterM predicate3 =&lt;&lt; listDirectoryAbs dir)))\n</code></pre>\n\n<p>Because all these nested expressions look messy (at least to me), I end up rewriting <code>f &lt;$&gt; x</code> to <code>return . f =&lt;&lt; x</code>. If I then flip the binds, I get something more readable:</p>\n\n<pre><code>findDlls dir = listDirectoryAbs dir\n &gt;&gt;= filterM predicate3\n &gt;&gt;= return . filter predicate2\n &gt;&gt;= filterM predicate1\n &gt;&gt;= return . f\n</code></pre>\n\n<p>Is rewriting <code>f &lt;$&gt; x</code> -> <code>return . f =&lt;&lt; x</code> -> <code>x &gt;&gt;= return . f</code> \"bad\" in any way? Is there a preferable way of avoiding nested expressions in situations such as these?</p>\n\n<p>I <em>could</em> use <code>do</code> notation instead, but I'd like to avoid having to be explicit about data flow and giving every return value a name.</p>\n"}, {"tags": ["haskell", "recursion", "optimization"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1483990992, "post_id": 41551942, "comment_id": 70316597, "body": "GHC Core is usually more readable instead of C--. From a quick look I&#39;d say it is left as a recursive function. Remember to annotate the type, by the way: that greatly helps the optimizer."}], "answers": [{"comments": [{"owner": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "edited": false, "score": 0, "creation_date": 1484023109, "post_id": 41559051, "comment_id": 70327102, "body": "That&#39;s what I need. Thanks!"}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 3, "last_activity_date": 1484006474, "creation_date": 1484006474, "answer_id": 41559051, "question_id": 41551942, "link": "https://stackoverflow.com/questions/41551942/can-haskell-optimise-not-tail-recursive-function/41559051#41559051", "title": "Can haskell optimise not tail recursive function?", "body": "<p>The answer is no, GHC will not optimize this to a tail recursive function. As a commenter suggests, to see this, you should look at the GHC core^:</p>\n\n<pre><code>Rec {\nmy_sum :: Integer -&gt; Integer\nmy_sum =\n  \\ (ds :: Integer) -&gt;\n    case eqInteger# ds my_sum'2 of wild { __DEFAULT -&gt;\n    case tagToEnum# wild of _ {\n      False -&gt; plusInteger ds (my_sum (minusInteger ds lvl));\n      True -&gt; my_sum'1\n    }\n    }\nend Rec }\n</code></pre>\n\n<p>This function is clearly not tail-recursive - the outermost call is to <code>plusInteger</code>. The GHC core is the code after all optimizations are performed - this code is what is actually translated to machine code. So you know if your function is not tail-recursive in core, it really isn't tail recursive. It is also essentially just Haskell, aside from some funny names, so reading it should not be a problem. </p>\n\n<p>If you want a tail recursive function, just use <code>foldl'</code>: </p>\n\n<pre><code>import Data.List (foldl')\n\nmy_sum' :: Integer -&gt; Integer \nmy_sum' i0 = foldl' (+) 54321 [0..i0]\n</code></pre>\n\n<p>Which gives the following core: </p>\n\n<pre><code>my_sum' :: Integer -&gt; Integer\nmy_sum' =\n  \\ (i0 :: Integer) -&gt;\n    letrec {\n      go :: Integer -&gt; Integer -&gt; Integer\n      go =\n        \\ (x :: Integer) (eta :: Integer) -&gt;\n          case gtInteger# x i0 of wild { __DEFAULT -&gt;\n          case tagToEnum# wild of _ {\n            False -&gt; go (plusInteger x $fEnumInteger1) (plusInteger eta x);\n            True -&gt; eta\n          }\n          }; } in\n    go my_sum'2 my_sum'1\n</code></pre>\n\n<p>Here <code>my_sum'2</code>, <code>my_sum'1</code> and <code>lvl</code> are the constants in the program: </p>\n\n<pre><code>my_sum'2 :: Integer\nmy_sum'2 = 0\nmy_sum'1 :: Integer\nmy_sum'1 = 54321\nlvl :: Integer\nlvl = 1\n</code></pre>\n\n<hr>\n\n<p>^ Generated with the options <code>-ddump-simpl -dsuppress-idinfo -dsuppress-coercions -dsuppress-type-applications -dsuppress-uniques -dsuppress-module-prefixes --make</code></p>\n"}], "owner": {"reputation": 3946, "user_id": 4444768, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vVqiI.jpg?s=128&g=1", "display_name": "LmTinyToon", "link": "https://stackoverflow.com/users/4444768/lmtinytoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 41559051, "answer_count": 1, "score": 0, "last_activity_date": 1484006474, "creation_date": 1483977652, "question_id": 41551942, "link": "https://stackoverflow.com/questions/41551942/can-haskell-optimise-not-tail-recursive-function", "title": "Can haskell optimise not tail recursive function?", "body": "<p>I have following program:</p>\n\n<pre><code>my_sum 0 = 54321\nmy_sum i = i + (my_sum (i - 1))\n\nmain = do\n    print $ my_sum 12345\n</code></pre>\n\n<p>I want to find out whether generated <code>my_sum</code> function is recursive. In other words, will haskell transform this one to not recursive kind.</p>\n\n<p>I am tried to see native c-- code (asm almost the same). But it is too difficult for me. It is code of <code>my_sum</code>:</p>\n\n<pre><code>my_sum_s24N_entry() //  [R1]\n     { info_tbl: [(c25x,\n                   label: block_c25x_info\n                   rep:StackRep [False, False]),\n                  (c267,\n                   label: my_sum_s24N_info\n                   rep:HeapRep 1 nonptrs { Fun {arity: 1 fun_type: ArgSpec 5} })]\n       stack_info: arg_space: 8 updfr_space: Just 4\n     }\n {offset\n   c267:\n       _s24N::P32 = R1;\n       _s24O::P32 = P32[Sp];\n       if ((Sp + 8) - 32 &lt; SpLim) goto c268; else goto c269;\n   c269:\n       Hp = Hp + 8;\n       if (Hp &gt; HpLim) goto c26b; else goto c26a;\n   c26b:\n       HpAlloc = 8;\n       goto c268;\n   c268:\n       R1 = _s24N::P32;\n       call (stg_gc_fun)(R1) args: 8, res: 0, upd: 4;\n   c26a:\n       I32[Hp - 4] = sat_s24V_info;\n       _c25n::P32 = Hp - 4;\n       I32[Sp - 8] = c25x;\n       P32[Sp - 24] = GHC.Integer.Type.$fEqInteger_closure;\n       I32[Sp - 20] = stg_ap_pp_info;\n       P32[Sp - 16] = _s24O::P32;\n       P32[Sp - 12] = _c25n::P32;\n       P32[Sp - 4] = _s24N::P32;\n       Sp = Sp - 24;\n       call GHC.Classes.==_info() returns to c25x, args: 20, res: 4, upd: 4;\n   c25x:\n       _s24N::P32 = P32[Sp + 4];\n       _s24O::P32 = P32[Sp + 8];\n       _s24W::P32 = R1;\n       _c266::P32 = _s24W::P32 &amp; 3;\n       if (_c266::P32 != 1) goto c265; else goto c264;\n   c265:\n       Hp = Hp + 8;\n       if (Hp &gt; HpLim) goto c26j; else goto c26i;\n   c26j:\n       HpAlloc = 8;\n       R1 = _s24W::P32;\n       call stg_gc_unpt_r1(R1) returns to c25x, args: 4, res: 4, upd: 4;\n   c26i:\n       I32[Hp - 4] = GHC.Integer.Type.S#_con_info;\n       I32[Hp] = 54321;\n       _c26k::P32 = Hp - 3;\n       P32[Sp] = GHC.Num.$fNumInteger_closure;\n       I32[Sp + 4] = stg_ap_p_info;\n       P32[Sp + 8] = _c26k::P32;\n       call GHC.Num.fromInteger_info() args: 16, res: 0, upd: 4;\n   c264:\n       Hp = Hp + 16;\n       if (Hp &gt; HpLim) goto c26e; else goto c26d;\n   c26e:\n       HpAlloc = 16;\n       R1 = _s24W::P32;\n       call stg_gc_unpt_r1(R1) returns to c25x, args: 4, res: 4, upd: 4;\n   c26d:\n       I32[Hp - 12] = sat_s250_info;\n       P32[Hp - 4] = _s24N::P32;\n       P32[Hp] = _s24O::P32;\n       _c25B::P32 = Hp - 12;\n       P32[Sp - 4] = GHC.Num.$fNumInteger_closure;\n       I32[Sp] = stg_ap_pp_info;\n       P32[Sp + 4] = _s24O::P32;\n       P32[Sp + 8] = _c25B::P32;\n       Sp = Sp - 4;\n       call GHC.Num.+_info() args: 20, res: 0, upd: 4;\n }\n } \n</code></pre>\n"}, {"tags": ["haskell", "tree"], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 0, "last_activity_date": 1483970135, "creation_date": 1483970135, "answer_id": 41549619, "question_id": 41549515, "link": "https://stackoverflow.com/questions/41549515/map-or-fold-tree/41549619#41549619", "title": "Map or fold tree", "body": "<p>Both map and fold for the <code>Tree</code> type would consume a <code>Tree</code>.  You don't have a <code>Tree</code> to consume.  Neither one will work.  You're looking for an <code>unfold</code>.   See <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:unfoldr\" rel=\"nofollow noreferrer\">Data.List.unfoldr</a> for an example of what one looks like.</p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 1, "last_activity_date": 1483987583, "creation_date": 1483987583, "answer_id": 41554816, "question_id": 41549515, "link": "https://stackoverflow.com/questions/41549515/map-or-fold-tree/41554816#41554816", "title": "Map or fold tree", "body": "<p>You can't really fold here, because you don't have a recursive structure to consume; rather you want to produce one from a base value. In principle this is an unfold, as Carl says in another answer, but I don't think Carl suggests to actually use Data.List.unfoldr: unfoldr is for generating specifically lists. You <em>could</em> use it to generate, say, an infinite list of gradually-deeper game trees, implementing a sort of iterative deepening, but it is simpler to just write this recursive function by hand, perhaps using Data.List.unfoldr as a template to see how unfolding works in general.</p>\n\n<p>Here is one implementation that seems reasonable to me, together with dummy definitions of the other data types you mention but do not define, so that the file is compilable on its own.</p>\n\n<pre><code>data Move g\ndata Player\ndata GameState g\nclass Game g\n\ndata Tree m v = Tree v [(m, Tree m v)]\ntype GTree g = Tree (Move g) (Player, GameState g)\n\nmoves :: g -&gt; Player -&gt; GameState g -&gt; [Move g]\nmoves = undefined\nmove :: g -&gt; Player -&gt; GameState g -&gt; Move g -&gt; GameState g\nmove = undefined\n\ntree :: Game g =&gt; g -&gt; (Player, GameState g) -&gt; GTree g\ntree game (player, root) = expand root\n  where expand node = Tree (player, node) $ explore node\n        explore state = do\n          edge &lt;- moves game player state\n          let node = move game player state edge\n          return (edge, expand node)\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 7346297, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10209290974621035/picture?type=large", "display_name": "Daniel", "link": "https://stackoverflow.com/users/7346297/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 41554816, "answer_count": 2, "score": 0, "last_activity_date": 1483987583, "creation_date": 1483969727, "last_edit_date": 1483969822, "question_id": 41549515, "link": "https://stackoverflow.com/questions/41549515/map-or-fold-tree", "title": "Map or fold tree", "body": "<p>If a tree has the data constructor and type of:</p>\n\n<pre><code>data Tree m v = Tree v [(m, Tree m v)]\ntype GTree g = Tree (Move g) (Player, GameState g)\n</code></pre>\n\n<p>where</p>\n\n<pre><code>moves :: g -&gt; Player -&gt; GameState g -&gt; [Move g]\nmove :: g -&gt; Player -&gt; GameState g -&gt; Move g -&gt; GameState g\n\ntree :: Game g =&gt; g -&gt; (Player, GameState g) -&gt; GTree g\n</code></pre>\n\n<p>Where <code>tree</code> needs to generate an infinite game tree.</p>\n\n<p>Is <code>map</code> to <code>fold</code> preferred here? And how would one achieve doing so?</p>\n"}, {"tags": ["haskell", "optimization", "ghc"], "comments": [{"owner": {"reputation": 1, "user_id": 5655455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765842cff0e9a0ae0ca0806c589d04d6?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey Radkov", "link": "https://stackoverflow.com/users/5655455/alexey-radkov"}, "edited": false, "score": 1, "creation_date": 1483965915, "post_id": 41546614, "comment_id": 70301424, "body": "The key is <i>memoization</i>. See <a href=\"http://stackoverflow.com/questions/11466284/how-is-this-fibonacci-function-memoized\">here</a>."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1483964555, "post_id": 41546927, "comment_id": 70300666, "body": "A little additional explanation for <i>why</i> the <code>where</code> block is re-evaluated: it&#39;s because <code>i</code> is in the <code>where</code> block&#39;s closure. If you were to write it as <code>let mfib = \\i -&gt; map fib [0..] !! i where ...</code> it&#39;d be just as fast as the eta-contracted version. That said, I&#39;m surprised GHC didn&#39;t spot an opportunity to apply the full-laziness transformation and float <code>fib</code> outside the binder."}, {"owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1483968756, "post_id": 41546927, "comment_id": 70303258, "body": "@BenjaminHodgson I did indeed try putting the <code>i</code> in a lambda, but it makes no difference -- memoization still not &quot;working&quot;."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 7, "last_activity_date": 1483961002, "creation_date": 1483961002, "answer_id": 41546927, "question_id": 41546614, "link": "https://stackoverflow.com/questions/41546614/ghc-optimization/41546927#41546927", "title": "GHC optimization", "body": "<p>No, this has nothing to do with inlining. The difference is that <code>mfib = (map fib [0..] !!)</code> has no arguments. It's still a function of course, but evaluating that function does upfront not require to pass any argument. In particular, evaluating this <code>mfib</code> will generate the <code>fib</code> list in a way that it can be reused for all indices.</p>\n\n<p>OTOH, <code>mfib i = map fib [0..] !! i</code> means the entire <code>where</code> block will only get considered when you actually pass an argument <code>i</code>.</p>\n\n<p>The two are only different if you evaluate a function many multiple times again and again. Unfortunately for the second version, the functions own recursion already calls it again and again! So <code>mfib (x-1) + mfib (x-2)</code> then needs to do the entire work of <code>mfib (x-1)</code>, <em>and then again</em> the entire work of <code>mfib (x-2)</code>. So <code>mfib n</code> takes more than twice the computational cost of <code>mfib (n-1)</code>, therefore <code>mfib</code> \u2208 <em>O</em> (2<sup><em>n</em></sup>).</p>\n\n<p>That's incredibly wasteful, because most of the terms in <code>mfib (x-2)</code> are also already in <code>mfib (x-1)</code> and could simply be re-used. Well, that's exactly what your first version does, because it computes the <code>fib</code> list once and for all indices, so evaluating <code>mfib (x-1)</code> will already do most of the work that can then simply be re-read by <code>mfib (x-2)</code>, reducing the complexity to polynomial.</p>\n"}, {"comments": [{"owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "edited": false, "score": 0, "creation_date": 1483972213, "post_id": 41549387, "comment_id": 70305473, "body": "I did some tests on the repl to try to confirm this and seems correct. I also looked at the link provided by @alexey-radkov about memoization and the suggestion there was that it had to do with the first function being monomorphic and therefore shared between calls, whereas the second is polymorphic, but I couldn&#39;t confirm this e.g. by redefining <code>map</code> to be monomorphic."}, {"owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "edited": false, "score": 0, "creation_date": 1483972287, "post_id": 41549387, "comment_id": 70305514, "body": "TL;DR Because <code>map fib [0..]</code> is in a lambda it isn&#39;t shared, but garbage collected between (recursive) calls. Correct?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "edited": false, "score": 0, "creation_date": 1483979848, "post_id": 41549387, "comment_id": 70310409, "body": "@Mikkel Right, and the reason is because (though it doesn&#39;t in this case) it could depend on <code>i</code>, and then couldn&#39;t be shared. (And this is usually a good way to see what will be shared without doing the desugaring first.)"}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 12, "last_activity_date": 1483969260, "last_edit_date": 1495540391, "creation_date": 1483969260, "answer_id": 41549387, "question_id": 41546614, "link": "https://stackoverflow.com/questions/41546614/ghc-optimization/41549387#41549387", "title": "GHC optimization", "body": "<p>It's easier to understand these differences when looking at the desugared code, so here are partially desugared versions of the two functions.</p>\n\n<pre><code>let mfib = let fib 0 = 0\n               fib 1 = 1\n               fib x = mfib (x-1) + mfib (x-2)\n           in (!!) (map fib [0..])\n</code></pre>\n\n<p>versus</p>\n\n<pre><code>let mfib = \\i -&gt;\n               let fib 0 = 0\n                   fib 1 = 1\n                   fib x = mfib (x-1) + mfib (x-2)\n               in map fib [0..] !! i\n</code></pre>\n\n<p>Note that in the second program, the expression <code>map fib [0..]</code> appears inside <code>\\i -&gt; ...</code>, so it will (normally, without optimizations) evaluated for each value of <code>i</code>. See <a href=\"https://stackoverflow.com/questions/3951012/when-is-memoization-automatic-in-ghc-haskell\">When is memoization automatic in GHC Haskell?</a></p>\n"}], "owner": {"reputation": 662, "user_id": 668354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Yn84u.jpg?s=128&g=1", "display_name": "Mikkel", "link": "https://stackoverflow.com/users/668354/mikkel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "accepted_answer_id": 41549387, "answer_count": 2, "score": 10, "last_activity_date": 1483969260, "creation_date": 1483960004, "last_edit_date": 1483968242, "question_id": 41546614, "link": "https://stackoverflow.com/questions/41546614/ghc-optimization", "title": "GHC optimization", "body": "<p>The two Haskell functions below seems to differ only by whether the index variable is implicit or explicit but the difference in performance is by two orders of magnitude.</p>\n\n<p>This function takes about 0.03 seconds to calculate mfib 30:</p>\n\n<pre><code>let mfib = (map fib [0..] !!)\n  where\n    fib 0 = 0\n    fib 1 = 1\n    fib x = mfib (x-1) + mfib (x-2)\n</code></pre>\n\n<p>This function takes about 3 seconds for mfib 30:</p>\n\n<pre><code>let mfib i = map fib [0..] !! i\n  where\n    fib 0 = 0\n    fib 1 = 1\n    fib x = mfib (x-1) + mfib (x-2)\n</code></pre>\n\n<p>I'm guessing it has to do with GHC inline rules and have been trying to add inline/noinline pragmas to get matching performance.</p>\n\n<p>EDIT: I understand how doing a lookup into the lazy list can be used to memoize the fib function and why the traditional definition of fib is very slow. I was expecting the memoization to work in the second function as well as the first and don't understand why it is not.</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7394009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12dbcf49ad9d1326b1b2bec7a2611b90?s=128&d=identicon&r=PG&f=1", "display_name": "Maria Negrea", "link": "https://stackoverflow.com/users/7394009/maria-negrea"}, "edited": false, "score": 0, "creation_date": 1483965867, "post_id": 41547346, "comment_id": 70301397, "body": "Thank you for your prompt answer. Now the function compiles, but I still have an issue. As you said, the function can be used only in Yesod handlers. Do you know what can be done to make it work also in hamlet? I&#39;ve posted another question with the detailed issue and code:<a href=\"http://stackoverflow.com/questions/41548361/yesod-function-call-in-hamlet-not-working\" title=\"yesod function call in hamlet not working\">stackoverflow.com/questions/41548361/&hellip;</a>"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 2, "last_activity_date": 1483962311, "creation_date": 1483962311, "answer_id": 41547346, "question_id": 41546413, "link": "https://stackoverflow.com/questions/41546413/yesod-error-couldnt-match-expected-type-when-extracting-data-from-database/41547346#41547346", "title": "Yesod - Error &quot;couldn&#39;t match expected type&quot; when extracting data from database", "body": "<p>That's because the type signature of <code>runDB</code> is <code>YesodDB site a -&gt; HandlerT site IO a</code>. Unless you want to run database related actions in yesod handers, you won't be needing <code>runDB</code>. The code for extracting city name would be like this:</p>\n\n<pre><code>extractCityName :: EventId -&gt; ReaderT SqlBackend IO (Maybe Text)\nextractCityName eventId = do\n  event &lt;- selectFirst [EventId ==. eventId] [LimitTo 1]\n  case event of\n    Nothing -&gt; return Nothing\n    Just event' -&gt; do\n               city &lt;- getJust (eventCityId $ entityVal event')\n               return $ Just $ cityName city\n</code></pre>\n\n<p>Now you can use the above function in the Yesod handlers when you actually need it. You can do the pattern matching in the result and send a <code>404</code> page if the result is <code>Nothing</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 7394009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12dbcf49ad9d1326b1b2bec7a2611b90?s=128&d=identicon&r=PG&f=1", "display_name": "Maria Negrea", "link": "https://stackoverflow.com/users/7394009/maria-negrea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1483964257, "creation_date": 1483959362, "question_id": 41546413, "link": "https://stackoverflow.com/questions/41546413/yesod-error-couldnt-match-expected-type-when-extracting-data-from-database", "title": "Yesod - Error &quot;couldn&#39;t match expected type&quot; when extracting data from database", "body": "<p>Having the following database models, I am trying to get the city name (a certain field from city - a related entity) of an event :</p>\n\n<pre><code>City json\n    name Text\n    countryId CountryId\n    UniqueCity name\n    deriving Eq\n    deriving Show\nEvent\n    title Text\n    description Text\n    date UTCTime\n    cityId CityId\n\nextractCityName :: EventId -&gt; Text\nextractCityName eventId = do\nevent &lt;- runDB $ get404 eventId\n    city &lt;- runDB $ get404 (eventCityId event)\n    x &lt;- cityName city\n    return cityName\n</code></pre>\n\n<p>And I am having this error even if the function is not called yet(at compile time):</p>\n\n<pre><code>Couldn't match expected type `HandlerT site0 IO t0' with actual type `Text'\n    In a stmt of a 'do' block: x &lt;- cityName city\n    In the expression:\n      do { event &lt;- runDB $ get404 eventId;\n          city &lt;- runDB $ get404 (eventCityId event);\n          x &lt;- cityName city;\n          return cityName }\n</code></pre>\n\n<p>Can you please help me figure out what is wrong with my code?</p>\n"}, {"tags": ["haskell", "ghc", "gadt"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1483954869, "post_id": 41543710, "comment_id": 70294493, "body": "Part of the problem here is that Haskell erases types at runtime: even if &#39;g :: forall a. D a -&gt; Bool` at runtime <code>g</code> is not passed the &quot;value&quot; of <code>a</code>. To circumvent that you need either a typeclass constraint (which passes a dictionary at runtime) or a singleton as shown below by dfeuer. Maybe in the future we will get <code>g :: pi a . ...</code> for non-erased types, but for now..."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 4, "creation_date": 1483956619, "post_id": 41543710, "comment_id": 70295548, "body": "You can also think of this as <code>forall</code> always being parametric: the behavior of <code>g</code> cannot depend on the type <code>a</code>. <code>pi</code> would be the non-parametric counterpart to <code>forall</code>."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1484022775, "post_id": 41543710, "comment_id": 70327022, "body": "Thanks for the comments. I&#39;ve worked around this issue by providing separate constructors wherever I want to differentiate the types at runtime."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 7, "last_activity_date": 1483951776, "creation_date": 1483951776, "answer_id": 41544127, "question_id": 41543710, "link": "https://stackoverflow.com/questions/41543710/avoiding-redundant-constraints-when-working-with-phantom-types/41544127#41544127", "title": "Avoiding redundant constraints when working with phantom types", "body": "<p>No, this is not possible, because I could hand you a perfectly good value of type <code>D Any</code>, where <code>Any</code> is defined</p>\n\n<pre><code>type family Any :: k where {}\n</code></pre>\n\n<p>What you can do is write a more generally useful class:</p>\n\n<pre><code>data SBool a where\n  SFalse :: SBool 'False\n  STrue :: SBool 'True\n\nsBoolToBool :: SBool a -&gt; Bool\nsBoolToBool SFalse = False\nsBoolToBool STrue = True\n\nclass KnownBool a where\n  knownBool :: SBool a\ninstance KnownBool 'False where\n  knownBool = SFalse\ninstance KnownBool 'True where\n  knownBool = STrue\n</code></pre>\n\n<p>Of course, all this machinery is really overkill if you're not using the types for anything else.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 41544127, "answer_count": 1, "score": 3, "last_activity_date": 1483951776, "creation_date": 1483950053, "question_id": 41543710, "link": "https://stackoverflow.com/questions/41543710/avoiding-redundant-constraints-when-working-with-phantom-types", "title": "Avoiding redundant constraints when working with phantom types", "body": "<p>This is a simplified, perhaps silly example of what I'm trying to code up (which is more complex and involves compile time encoding of list length).</p>\n\n<p>Given the following:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE GADTs #-}\n\ndata D (a :: Bool) where\n  D :: Bool -&gt; D a\n</code></pre>\n\n<p>I want the following function <code>g</code>:</p>\n\n<pre><code>g :: D a -&gt; Bool\ng (D x) = x == a\n</code></pre>\n\n<p>Of course this won't compile as <code>a</code> is a type, not a value.</p>\n\n<p>Here's a possible solution:</p>\n\n<pre><code>class C (a :: Bool) where\n  f :: D a -&gt; Bool\n\ninstance C True where\n  f (D x) = x == True\n\ninstance C False where\n  f (D x) = x == False\n\ng :: (C a) =&gt; D a -&gt; Bool\ng = f\n</code></pre>\n\n<p>But then I have to add a constraint to <code>g</code>, which seems redundant as <code>a :: Bool</code> and I've got instances for all cases of <code>Bool</code>. </p>\n\n<p>Is there anyway I could write <code>g</code> such that it has the signature:</p>\n\n<pre><code>g :: D a -&gt; Bool \n</code></pre>\n\n<p>i.e. doesn't require an additional constraint?</p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"comments": [{"owner": {"reputation": 918, "user_id": 656298, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ce9d3d08cd1b2486c0ed1a4fbf82dd85?s=128&d=identicon&r=PG", "display_name": "Zach", "link": "https://stackoverflow.com/users/656298/zach"}, "edited": false, "score": 0, "creation_date": 1483927074, "post_id": 41539686, "comment_id": 70285126, "body": "In this scenario, is <code>m ()</code> the concrete type? What tells the compiler that that m has a kind of <code>(* -&gt; *)</code> instead of <code>(* -&gt; * -&gt; *)</code>?"}, {"owner": {"reputation": 918, "user_id": 656298, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ce9d3d08cd1b2486c0ed1a4fbf82dd85?s=128&d=identicon&r=PG", "display_name": "Zach", "link": "https://stackoverflow.com/users/656298/zach"}, "edited": false, "score": 0, "creation_date": 1483927154, "post_id": 41539686, "comment_id": 70285139, "body": "Also, could you clarify what you mean by &quot;principal type&quot;?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 918, "user_id": 656298, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ce9d3d08cd1b2486c0ed1a4fbf82dd85?s=128&d=identicon&r=PG", "display_name": "Zach", "link": "https://stackoverflow.com/users/656298/zach"}, "edited": false, "score": 0, "creation_date": 1483927694, "post_id": 41539686, "comment_id": 70285245, "body": "In no particular order: 1) &quot;Principal type&quot; is just another way of saying &quot;most general type&quot;. 2) The invalid part of the type signature is <code>MonadWriter [String] m</code>; <code>[String]</code> is a concrete type, not a type variable, and Haskell 98 requires constraints&#39; arguments to always be type variables. 3) The type-checker knows <code>m :: * -&gt; *</code> because a) it&#39;s applied to one argument in the type expression <code>m ()</code> and b) it&#39;s used as the second argument to <code>MonadWriter :: * -&gt; (* -&gt; *) -&gt; Constraint</code>"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 6, "last_activity_date": 1483958317, "last_edit_date": 1483958317, "creation_date": 1483924562, "answer_id": 41539686, "question_id": 41539611, "link": "https://stackoverflow.com/questions/41539611/haskell-tell-abc-evaluation-throwing-non-type-variable-argument-error/41539686#41539686", "title": "Haskell: &#39;tell [&quot;abc&quot;]&#39; evaluation throwing &quot;non-type variable argument&quot; error", "body": "<p><code>tell</code>'s return type is more general than <code>Writer</code>: it uses <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Writer-Class.html#t:MonadWriter\" rel=\"nofollow noreferrer\">the <code>MonadWriter</code> type class</a> to abstract over all monads with a writerly spirit.</p>\n\n<pre><code>tell :: MonadWriter w m =&gt; w -&gt; m ()\n</code></pre>\n\n<p>So when you write <code>tell [\"abc\"]</code> with no type annotation, the type-checker unifies <code>w</code> with <code>[String]</code> but it doesn't have any information with which to refine <code>m</code>. So you get</p>\n\n<pre><code>tell [\"abc\"] :: MonadWriter [String] m =&gt; m ()\n</code></pre>\n\n<p>Haskell 98 doesn't support constraints like <code>MonadWriter</code> applied to concrete type arguments like <code>[String]</code>, so the above is not valid Haskell 98. Turning on <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#the-context-of-a-type-signature\" rel=\"nofollow noreferrer\">the <code>FlexibleContexts</code> language extension</a> enables support for this sort of type.</p>\n\n<p>Since <code>Writer w</code> is an instance of <code>MonadWriter w</code> (when <code>w</code> is an instance of <code>Monoid</code>), <code>tell</code>'s principal type can be specialised to <code>Writer</code>. That's why it worked when you gave it the <code>Writer</code> type annotation.</p>\n\n<pre><code>tell :: w -&gt; Writer w ()\n</code></pre>\n"}], "owner": {"reputation": 918, "user_id": 656298, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ce9d3d08cd1b2486c0ed1a4fbf82dd85?s=128&d=identicon&r=PG", "display_name": "Zach", "link": "https://stackoverflow.com/users/656298/zach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 41539686, "answer_count": 1, "score": 3, "last_activity_date": 1483958317, "creation_date": 1483923558, "question_id": 41539611, "link": "https://stackoverflow.com/questions/41539611/haskell-tell-abc-evaluation-throwing-non-type-variable-argument-error", "title": "Haskell: &#39;tell [&quot;abc&quot;]&#39; evaluation throwing &quot;non-type variable argument&quot; error", "body": "<p>When I attempt to evaluate <code>tell [\"abc\"]</code> in GHCI, it spits out this error: </p>\n\n<pre><code>Non type-variable argument\n        in the constraint: MonadWriter [[Char]] m\n      (Use FlexibleContexts to permit this)\n</code></pre>\n\n<p>If I do <code>tell [\"abc\"] :: Writer [String] ()</code>, it evalutes without a problem, but why is that necessary?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1483950486, "post_id": 41539460, "comment_id": 70292123, "body": "As a general note, try to avoid using &#39;let&#39; and &#39;in&#39; statements within functions. It&#39;s a very &#39;OOP-like&#39;, instead try to think about structuring functions using recursion, for example, or with where clauses. I&#39;d also suggest that you take your function type statements to the highest abstraction, so using &#39;(Integral a) =&gt;&#39; here would be useful&#39;"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 1, "creation_date": 1483954610, "post_id": 41539460, "comment_id": 70294299, "body": "@BabraCunningham <code>let</code> vs <code>where</code> is mostly a matter of style and personal preference. Neither is OOP-like, in my view. Further, <code>let</code> is usable in subexpressions, while <code>where</code> is not. For what it is worth, I tend to use <code>where</code> when the function body fits a line, and <code>let</code> otherwise."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 5, "last_activity_date": 1483955074, "last_edit_date": 1483955074, "creation_date": 1483924640, "answer_id": 41539697, "question_id": 41539460, "link": "https://stackoverflow.com/questions/41539460/using-haskell-map-when-functions-needs-an-intermediate-result/41539697#41539697", "title": "Using Haskell map when functions needs an intermediate result", "body": "<p><code>map</code> is the wrong function to use, because as you note it only works for situations where each element can be handled independently, not when elements depend on each other.</p>\n\n<p>However, <code>makeChange</code> is a function that is implementable with a fold. Specifically, your implementation incorporates all the feature of a left fold, but done by hand; you can instead implement your function in terms of <code>foldl'</code>.</p>\n"}], "owner": {"reputation": 31, "user_id": 7392298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ca37cd416d17a15691e8e5dd4b9ec1c?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Houser", "link": "https://stackoverflow.com/users/7392298/mike-houser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1483955074, "creation_date": 1483921904, "question_id": 41539460, "link": "https://stackoverflow.com/questions/41539460/using-haskell-map-when-functions-needs-an-intermediate-result", "title": "Using Haskell map when functions needs an intermediate result", "body": "<p>I'm working thorough a Haskell text and have come across a question about making change. I'm given an ordered list of (denomonation, numCoins) tuples along with an amount and need to return a list of how many of each coin was used to make change. I have the following code that solves the problem:</p>\n\n<pre><code>useCoins :: (Int,Int) -&gt; Int -&gt; Int\nuseCoins (denomination, numCoins) target = min numCoins (target `div` denomination)\n\nmakeChange :: [(Int, Int)] -&gt; Int -&gt; [Int]\nmakeChange [] target = []\nmakeChange ((denomination, numCoins):xs) target = \n  let\n     coinsUsed = useCoins (denomination, numCoins) target\n  in coinsUsed : makeChange xs (target - (coinsUsed * denomination))\n</code></pre>\n\n<p>The problem is that this is in a chapter on higher-order functions and I'm having a hard time coming up with a way to use map as the target value is changing as it drops through the list. I'd love any help.</p>\n\n<p>Thanks.</p>\n\n<p>-mh</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1483918231, "post_id": 41538975, "comment_id": 70283383, "body": "It&#39;s not clear to me what sort of change you&#39;re referring to. Is a &quot;core model&quot; not a type? You might try splitting things up into smaller modules (as in e.g. the common <code>Foo&#47;Types.hs</code> idiom) It sounds like you also want to disable optimizations during development. In modern GHC you can also just run the typechecker which is often what you want"}, {"owner": {"reputation": 604, "user_id": 717881, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aac21dfd75e7d66cc8476bdbca6d2153?s=128&d=identicon&r=PG", "display_name": "ghorn", "link": "https://stackoverflow.com/users/717881/ghorn"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1483918337, "post_id": 41538975, "comment_id": 70283418, "body": "I mean like adding a print statement without changing the <code>IO ()</code> type, or changing some model parameter without changing the <code>Double</code> type."}, {"owner": {"reputation": 604, "user_id": 717881, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aac21dfd75e7d66cc8476bdbca6d2153?s=128&d=identicon&r=PG", "display_name": "ghorn", "link": "https://stackoverflow.com/users/717881/ghorn"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1483918429, "post_id": 41538975, "comment_id": 70283435, "body": "There is an open issue for <code>stack typecheck</code> here <a href=\"https://github.com/commercialhaskell/stack/issues/977\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/977</a> as well. Does disabling optimizations avoid recompilation or just speed up compilation?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1483919141, "post_id": 41538975, "comment_id": 70283580, "body": "have you try <code>stack build --fast</code> ?"}, {"owner": {"reputation": 604, "user_id": 717881, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aac21dfd75e7d66cc8476bdbca6d2153?s=128&d=identicon&r=PG", "display_name": "ghorn", "link": "https://stackoverflow.com/users/717881/ghorn"}, "edited": false, "score": 0, "creation_date": 1483925257, "post_id": 41538975, "comment_id": 70284792, "body": "Yes I am usually using <code>stack build --fast</code>"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 4, "creation_date": 1483926898, "post_id": 41538975, "comment_id": 70285102, "body": "Do you have a minimal example that illustrates the problem?  I am not able to duplicate it in the simple example of one module depending on a <code>Double</code> parameter defined and modified in separate module.  Providing I always build with <code>--fast</code>, only the modified module gets rebuilt."}, {"owner": {"reputation": 604, "user_id": 717881, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aac21dfd75e7d66cc8476bdbca6d2153?s=128&d=identicon&r=PG", "display_name": "ghorn", "link": "https://stackoverflow.com/users/717881/ghorn"}, "edited": false, "score": 1, "creation_date": 1484004000, "post_id": 41538975, "comment_id": 70322493, "body": "You are right, I cannot reproduce it with --fast. I must have been measuring incorrectly before."}], "owner": {"reputation": 604, "user_id": 717881, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/aac21dfd75e7d66cc8476bdbca6d2153?s=128&d=identicon&r=PG", "display_name": "ghorn", "link": "https://stackoverflow.com/users/717881/ghorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 185, "favorite_count": 0, "answer_count": 0, "score": 7, "last_activity_date": 1483925963, "creation_date": 1483917472, "last_edit_date": 1483925963, "question_id": 41538975, "link": "https://stackoverflow.com/questions/41538975/avoiding-recompilation-when-types-dont-change", "title": "avoiding recompilation when types don&#39;t change", "body": "<p>I have a large Haskell project with many packages built with stack. I have long recompilation times when I make trivial changes in a core model or some configuration data <strong>without changing any types</strong>.</p>\n\n<p>If this were C, I would have to only recompile the changed object file and then re-link the whole project. In Haskell I have to recompile every module which depends on the changed module.</p>\n\n<p>I understand that this enables all kinds of compiler optimizations, but I am looking for a way to sidestep this in order to have quick recompilation during development. Is there any way to accomplish this in Haskell?</p>\n"}, {"tags": ["haskell", "tree", "functional-programming", "fold"], "comments": [{"owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1483918006, "post_id": 41538931, "comment_id": 70283341, "body": "@leftaroundabout I think the concept in general is just going over my head slightly"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1483919274, "post_id": 41538931, "comment_id": 70283603, "body": "<code>foldTree f Tip = Tip</code> already has the wrong type - it takes too few parameters, and it produces a <code>Tree x</code> for some <code>x</code>, not a <code>b</code>. The correct patterns would be <code>foldTree f z Tip = ..; foldTree f z (Node l x r) = ...</code> (your problem has nothing to do with Monoid)"}, {"owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1483919416, "post_id": 41538931, "comment_id": 70283620, "body": "@user2407038 okay yeah that was just stupid thanks I&#39;ve fixed that. Still the same issue tho."}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "edited": false, "score": 0, "creation_date": 1483922155, "post_id": 41539364, "comment_id": 70284187, "body": "Wow thank you this is incredibly detailed! I did not know that ghci could do that so that&#39;s really useful to know. The way you&#39;ve explained it makes perfect sense so thank you :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1483940997, "post_id": 41539364, "comment_id": 70288361, "body": "Actually, the convention with folds (except for list folds, for what are often seen as historical reasons) is to put the arguments in the order of the constructors. This is how it works for <code>bool</code>, <code>maybe</code>, and <code>either</code>, anyway."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1483961983, "last_edit_date": 1483961983, "creation_date": 1483920949, "answer_id": 41539364, "question_id": 41538931, "link": "https://stackoverflow.com/questions/41538931/how-to-fold-a-tree-without-making-it-an-instance-of-foldable/41539364#41539364", "title": "How to fold a tree without making it an instance of Foldable?", "body": "<p>First note that <code>foldTree</code> has <em>three</em> arguments:</p>\n\n<pre><code>foldTree :: b                   -- ^ Starting value\n         -&gt; (b -&gt; a -&gt; b -&gt; b)  -- ^ Folding function\n         -&gt; Tree a              -- ^ Tree to fold over\n         -&gt; b\n</code></pre>\n\n<p>Actually, convention with folds is to put the function argument first, so I'll in the following discuss <code>foldTree :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b</code>.</p>\n\n<p>Now your attempt</p>\n\n<pre><code>foldTree f Tip = Tip\n</code></pre>\n\n<p>is lacking an argument, and the result type also doesn't make sense: <code>Tip</code> is a tree(-leaf), but you want the result to be simply <code>b</code>.</p>\n\n<p>A good way to write functions where you have difficulty seeing what's supposed to happen is to let the compiler help you. Again, <code>foldTree</code> has <em>three</em> arguments, so in general its definition should have the form</p>\n\n<pre><code>foldTree q r t = _\n</code></pre>\n\n<p>where <code>t</code> is the tree, so the first clause will be</p>\n\n<pre><code>foldTree q r Tip = _\n</code></pre>\n\n<p>Well, <a href=\"https://wiki.haskell.org/GHC/Typed_holes\" rel=\"nofollow noreferrer\">you can actually present GHC (>= 7.8) with this \u201cdefinition\u201d</a>. This is what it replies:</p>\n\n<pre><code>Found hole \u2018_\u2019 with type: b\nWhere: \u2018b\u2019 is a rigid type variable bound by\n           the type signature for\n             foldTree :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n           at /tmp/wtmpf-file26763.hs:6:13\nRelevant bindings include\n  r :: b (bound at /tmp/wtmpf-file26763.hs:8:12)\n  q :: b -&gt; a -&gt; b -&gt; b (bound at /tmp/wtmpf-file26763.hs:8:10)\n  foldTree :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n    (bound at /tmp/wtmpf-file26763.hs:8:1)\nIn the expression: _\nIn an equation for \u2018foldTree\u2019: foldTree q r Tip = _\n</code></pre>\n\n<p>So, it wants a result of type <code>b</code>. It so happens that you have a value of type <code>b</code> at hand, namely <code>r</code>. So one definition for this clause is</p>\n\n<pre><code>foldTree q r Tip = r\n</code></pre>\n\n<p>In fact that's the correct defintion and the <em>only possible</em>, since the only other thing you have at that point is the function <code>q</code>, but that would require an <code>a</code> value to evaluate, of which you have none.</p>\n\n<p>So, let's move on:</p>\n\n<pre><code>foldTree _ r Tip = r\nfoldTree q r (Node lsub x rsub) = _\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>Found hole \u2018_\u2019 with type: b\nWhere: \u2018b\u2019 is a rigid type variable bound by\n           the type signature for\n             foldTree :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n           at /tmp/wtmpf-file26763.hs:6:13\nRelevant bindings include\n  rsub :: Tree a (bound at /tmp/wtmpf-file26763.hs:9:27)\n  x :: a (bound at /tmp/wtmpf-file26763.hs:9:25)\n  lsub :: Tree a (bound at /tmp/wtmpf-file26763.hs:9:20)\n  r :: b (bound at /tmp/wtmpf-file26763.hs:9:12)\n  q :: b -&gt; a -&gt; b -&gt; b (bound at /tmp/wtmpf-file26763.hs:9:10)\n  foldTree :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n    (bound at /tmp/wtmpf-file26763.hs:8:1)\nIn the expression: _\nIn an equation for \u2018foldTree\u2019: foldTree q r (Node lsub x rsub) = _\n</code></pre>\n\n<p>Ok, so again you need a <code>b</code>. You could of course yet again simply return <code>r</code>, but that would mean the function simply ignores the entire tree. In particular, now you <em>have</em> a value <code>x :: a</code> which you could pass to <code>q</code> \u2013 sounds like a good idea. The result of <code>q</code> actually has type <code>b</code>, so let's try to use that as the result of the entire clause.</p>\n\n<p><code>q</code> has three arguments, I'm lazy so I'll again leave typed holes first...</p>\n\n<pre><code>foldTree q r (Node lsub x rsub) = q _q\u2080 _q\u2081 _q\u2082\n</code></pre>\n\n<p>giving</p>\n\n<pre><code>Found hole \u2018_q\u2080\u2019 with type: b\n...\nFound hole \u2018_q\u2081\u2019 with type: a\n...\nFound hole \u2018_q\u2082\u2019 with type: b\n...\nRelevant bindings include\n  rsub :: Tree a (bound at /tmp/wtmpf-file26763.hs:9:27)\n  x :: a (bound at /tmp/wtmpf-file26763.hs:9:25)\n  lsub :: Tree a (bound at /tmp/wtmpf-file26763.hs:9:20)\n  r :: b (bound at /tmp/wtmpf-file26763.hs:9:12)\n  q :: b -&gt; a -&gt; b -&gt; b (bound at /tmp/wtmpf-file26763.hs:9:10)\n  foldTree :: (b -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n    (bound at /tmp/wtmpf-file26763.hs:8:1)\n</code></pre>\n\n<p>Ok, one of these is clear-cut: we have a value <code>x :: a</code>, so that's the natural fit for <code>_q\u2081</code>.</p>\n\n<pre><code>foldTree q r (Node lsub x rsub) = q _q\u2080 x _q\u2082\n</code></pre>\n\n<p>For <code>_q\u2080</code> and <code>_q\u2082</code> we need once more values of type <code>b</code>. We could in principle pass <code>r</code> to both of these, but that would mean we still don't use the subtrees <code>lsub</code> and <code>rsub</code>. How could we use those? Well, there's one function in the hint that eats trees: <code>foldTree</code>. Indeed it also yields <code>b</code> as the result. So looks like we need recursive calls here. Again use holes for the missing arguments:</p>\n\n<pre><code>foldTree q r (Node lsub x rsub)\n        = q (foldTree _\u2080 _\u2081 lsub) x (foldTree _\u2082 _\u2083 rsub)\n</code></pre>\n\n<p>...</p>\n\n<pre><code>Found hole \u2018_\u2080\u2019 with type: b -&gt; a -&gt; b -&gt; b\n...\nRelevant bindings include\n      q :: b -&gt; a -&gt; b -&gt; b (bound at /tmp/wtmpf-file26763.hs:9:10)\n</code></pre>\n\n<p>aha, so that leads us to</p>\n\n<pre><code>foldTree q r (Node lsub x rsub)\n        = q (foldTree q _\u2081 lsub) x (foldTree _\u2082 _\u2083 rsub)\n</code></pre>\n\n<p>...</p>\n\n<pre><code>Found hole \u2018_\u2081\u2019 with type: b\n</code></pre>\n\n<p>Ok, now we've used everything else, so we might as well just plug in the initial value.</p>\n\n<pre><code>foldTree q r (Node lsub x rsub)\n        = q (foldTree q r lsub) x (foldTree _\u2082 _\u2083 rsub)\n</code></pre>\n\n<p>and so on, just fill the gaps with what GHC offers you with the right type.</p>\n"}], "owner": {"reputation": 161, "user_id": 6731064, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3e89af583f596652d94294cd481ae31?s=128&d=identicon&r=PG&f=1", "display_name": "user6731064", "link": "https://stackoverflow.com/users/6731064/user6731064"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "accepted_answer_id": 41539364, "answer_count": 1, "score": 2, "last_activity_date": 1483961983, "creation_date": 1483917190, "last_edit_date": 1483919456, "question_id": 41538931, "link": "https://stackoverflow.com/questions/41538931/how-to-fold-a-tree-without-making-it-an-instance-of-foldable", "title": "How to fold a tree without making it an instance of Foldable?", "body": "<p>I've defined my tree as follows:</p>\n\n<pre><code>data Tree a\n  = Tip\n  | Node (Tree a) a (Tree a)\n  deriving Show\n</code></pre>\n\n<p>and made it an instance of a Functor:</p>\n\n<pre><code>instance Functor Tree where\n  fmap f Tip                       = Tip\n  fmap f (Node leftsub x rightsub) = Node (fmap f leftsub) (f x) (fmap f rightsub)\n</code></pre>\n\n<p>now I want to define the following function to fold the tree:</p>\n\n<pre><code>foldTree :: b -&gt; (b -&gt; a -&gt; b -&gt; b) -&gt; Tree a -&gt; b\n</code></pre>\n\n<p>I've tried something like this but I don't think it works since Tree isn't a monoid:</p>\n\n<pre><code>foldTree f z Tip = Tip\nfoldTree f z (Node leftsub x rightsub) = foldr f leftsub ++ f x ++ foldr f rightsub\n</code></pre>\n\n<p>I'm having some trouble thinking how to do it. Any help would be appreciated.</p>\n"}, {"tags": ["haskell", "request", "servant"], "comments": [{"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1483916823, "post_id": 41538438, "comment_id": 70283042, "body": "The actual type family is <code>ServerT</code>, <code>Server</code> is just a convenient synonym to <code>ServerT</code> that uses the <code>Handler</code> monad."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1550838743, "post_id": 41538438, "comment_id": 96429058, "body": "Hey, did you ever find an answer for this? My use-case is for audit &amp; logging."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1550839666, "post_id": 41538438, "comment_id": 96429600, "body": "Btw, there is a <code>Summary</code> and <code>Description</code> with <code>HasServer</code> instances - <a href=\"https://www.stackage.org/haddock/lts-12.1/servant-0.14.1/Servant-API.html#t:Summary\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-12.1/servant-0.14.1/&hellip;</a> -- is there any way to extract this text from <b>within</b> a handler?"}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1484043622, "last_edit_date": 1484043622, "creation_date": 1484042542, "answer_id": 41566105, "question_id": 41538438, "link": "https://stackoverflow.com/questions/41538438/haskell-servant-get-current-route-url-from-handler/41566105#41566105", "title": "Haskell Servant Get Current Route / URL From Handler", "body": "<p>I don't know how to do this automatically, but it can be done \"manually\" by using the <a href=\"http://hackage.haskell.org/package/servant-0.9.1.1/docs/Servant-Utils-Links.html#v:safeLink\" rel=\"nofollow noreferrer\"><code>safeLink</code></a> function.</p>\n\n<p>The idea is that, if you have an API</p>\n\n<pre><code>type ServerAPI = \n        \"route01\" :&gt; Get '[HTML] Text\n   :&lt;|&gt; \"route02\" :&gt; \"subroute\" :&gt; Get '[HTML] Text\n   :&lt;|&gt; Route3\n\ntype Route3 = \"route03\" :&gt; Get '[HTML] Text\n</code></pre>\n\n<p>You can pass to <code>safeLink</code> a proxy with the whole API and a proxy with the particular route, and show the resulting <a href=\"http://hackage.haskell.org/package/servant-0.9.1.1/docs/Servant-Utils-Links.html#t:URI\" rel=\"nofollow noreferrer\"><code>URI</code></a>:</p>\n\n<pre><code>show (safeLink (Proxy::Proxy ServerAPI) (Proxy::Proxy Route3))\n</code></pre>\n\n<p>If the route has parameters, you will also have to pass the parameters taken by the handler. For example:</p>\n\n<pre><code>type ServerAPI =\n       ...\n   :&lt;|&gt; Route4\n\ntype Route4 = \"route04\" :&gt; Capture \"cap\" Int :&gt; Get '[JSON] Text\n</code></pre>\n\n<p>in ghci:</p>\n\n<pre><code>ghci&gt; :set -XKindSignatures -XDataKinds -XTypeOperators -XTypeFamilies\nghci&gt; :type safeLink (Proxy::Proxy ServerAPI) (Proxy::Proxy Route4)\nInt -&gt; URI\n</code></pre>\n\n<hr>\n\n<p>You will  have to do this for each route.</p>\n"}, {"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1551074856, "post_id": 54847072, "comment_id": 96491435, "body": "How will the middleware help in determining which servant route was/will-be used to serve the request? At best the middleware will give you information at solely at an HTTP level, like the request path, or the query params. What I&#39;m interested in in determining, whether the current request was matched to <code>&#47;users&#47;:id&#47;comments</code> or <code>&#47;users&#47;:id&#47;posts</code>"}], "tags": [], "owner": {"reputation": 1, "user_id": 11105473, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NWMP9.png?s=128&g=1", "display_name": "expressive-gjf", "link": "https://stackoverflow.com/users/11105473/expressive-gjf"}, "is_accepted": false, "score": 0, "last_activity_date": 1551019542, "last_edit_date": 1551019542, "creation_date": 1550962497, "answer_id": 54847072, "question_id": 41538438, "link": "https://stackoverflow.com/questions/41538438/haskell-servant-get-current-route-url-from-handler/54847072#54847072", "title": "Haskell Servant Get Current Route / URL From Handler", "body": "<p>When you add a 'route' parameter to your handler, you could then set the parameter value via function application when you combine the handlers for your server.</p>\n\n<p>Based on your example:</p>\n\n<pre><code>type ServerAPI = \n         \"route01\" :&gt; Get '[JSON] Text\n    :&lt;|&gt; \"route02\" :&gt; \"subroute\" :&gt; Get '[JSON] Text\n    :&lt;|&gt; \"route03\" :&gt; Get '[JSON] Text\n\nroute1and2Handler :: String -&gt; Handler Text\nroute1and2Handler route = do\n    -- addVisitCountForRouteToDatabaseOrSomethingOfThatSort...\n    return (pack route)\n\nroute3Handler :: Handler Text\nroute3Handler = return \"Hello, I'm route 03\"\n\nserver :: Server ServerAPI\nserver = route1and2Handler \"route01\" :&lt;|&gt; route1and2Handler \"route02\" :&lt;|&gt; route3Handler\n</code></pre>\n\n<p>Alternatively, if what you are really interested in is some generic request processing for all routes, this is perhaps better achieved by applying 'middleware' between the server and the application. The middleware (usually of type <code>Application -&gt; Application</code>) has access to the request. See <a href=\"http://hackage.haskell.org/package/wai-extra\" rel=\"nofollow noreferrer\">wai-extra</a> for examples of wai middleware.</p>\n\n<p>An example of performing logging for all requests:</p>\n\n<pre><code>import Network.Wai.Middleware.RequestLogger (logStdoutDev)\n\n...\n\napp :: Application\napp = serve serverAPI server\n\nmain :: IO ()\nmain = run 8081 $ logStdoutDev app\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 8, "last_activity_date": 1551200837, "creation_date": 1551200837, "answer_id": 54890701, "question_id": 41538438, "link": "https://stackoverflow.com/questions/41538438/haskell-servant-get-current-route-url-from-handler/54890701#54890701", "title": "Haskell Servant Get Current Route / URL From Handler", "body": "<p>There are two questions in one:</p>\n\n<ol>\n<li>how to get current Request or URL?</li>\n<li>how to get current \"route\"?</li>\n</ol>\n\n<p>Note, that URL (e.g. <code>/route12/42</code>) is different than route\n(e.g. `\"route12\" :> Capture \"id\" Int :> Get '[JSON] Int).\nLet's see how we can solve both of these questions, right after a\nshort language pragma and import section.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE ConstraintKinds         #-}\n{-# LANGUAGE DataKinds               #-}\n{-# LANGUAGE DeriveGeneric           #-}\n{-# LANGUAGE FlexibleContexts        #-}\n{-# LANGUAGE FlexibleInstances       #-}\n{-# LANGUAGE MultiParamTypeClasses   #-}\n{-# LANGUAGE OverloadedStrings       #-}\n{-# LANGUAGE RankNTypes              #-}\n{-# LANGUAGE ScopedTypeVariables     #-}\n{-# LANGUAGE TypeFamilies            #-}\n{-# LANGUAGE TypeOperators           #-}\n{-# LANGUAGE UndecidableInstances    #-}\n{-# LANGUAGE UndecidableSuperClasses #-}\n{-# OPTIONS_GHC -Wno-orphans         #-}\nmodule Main where\n\nimport Data.Maybe             (fromMaybe)\nimport Control.Monad.IO.Class (liftIO)\nimport System.Environment     (getArgs)\nimport GHC.Generics           (to, from, M1 (..), K1 (..), (:*:) (..))\n\n-- for \"unsafe\" vault key creation\nimport System.IO.Unsafe (unsafePerformIO)\n\nimport qualified Data.ByteString.Char8    as BS8\nimport qualified Data.Vault.Lazy          as V\nimport qualified Network.Wai              as Wai\nimport qualified Network.Wai.Handler.Warp as Warp\n\nimport Servant\nimport Servant.API.Generic \nimport Servant.Server.Generic\nimport Servant.Server.Internal.RoutingApplication (passToServer)\n</code></pre>\n\n<h2>How to get current <code>Request</code> object or URL</h2>\n\n<p>Passing current <code>WAI</code> <code>Request</code> to the handler is actually quite easy.\nThis is \"lazy\" approach, we ask for \"everything\" in the request,\nand we have to be careful in the handler (e.g. we cannot touch <code>requestBody</code>).\nAlso this \"combinator\" ties implementation to the <code>wai</code> server implementation,\nwhich is an implementation detail\n(nothing else in <code>servant-server</code> exposes <code>wai</code> internals, except of <code>Raw</code>).</p>\n\n<p>The idea is to make <code>Server (Wai.Request :&gt; api) = Wai.Request -&gt; Server api</code>.\nIf we imagine for a second that we have such functionality in place,\nwe can write, using <code>Servant.API.Generic</code> (see \"Using generics\" cookbook recipe):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Routes1 route = Routes1\n    { route11 :: route :- Wai.Request :&gt; \"route1\" :&gt; Get '[JSON] Int\n    , route12 :: route :- Wai.Request :&gt; \"route2\" :&gt; Capture \"id\" Int :&gt; Get '[JSON] Int\n    }\n  deriving (Generic)\n\nroutes1 :: Routes1 AsServer\nroutes1 = Routes1\n    { route11 = \\req -&gt; liftIO $ do\n        let p = Wai.rawPathInfo req\n        BS8.putStrLn p\n        return (BS8.length p)\n    , route12 = \\req i -&gt; liftIO $ do\n        let p = Wai.rawPathInfo req\n        BS8.putStrLn p\n        return (succ i)\n    }\n\napp1 :: Application\napp1 = genericServe routes1\n</code></pre>\n\n<p>We define a <code>Routes1</code> data type, implement <code>Routes1 AsServer</code> value and turn it\ninto the <code>wai</code>'s <code>Application</code>. However, to compile this example, we need an\nadditional instance.  We use an <em>internal</em> <code>passToServer</code> combinator in the\nimplementation of <code>route</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance HasServer api ctx =&gt; HasServer (Wai.Request :&gt; api) ctx where\n    type ServerT (Wai.Request :&gt; api) m = Wai.Request -&gt; ServerT api m\n\n    hoistServerWithContext _ pc nt s =\n        hoistServerWithContext (Proxy :: Proxy api) pc nt . s\n\n    route _ ctx d = route (Proxy :: Proxy api) ctx $\n        passToServer d id\n</code></pre>\n\n<p>This solution is good quick fix, but there are arguably better ways.</p>\n\n<h3>Specific combinator</h3>\n\n<p>We may notice that both our handlers use <code>Wai.rawPathInto req</code> call.\nThat should alert us. Specific combinator is more elegant.\nAn ability to create new combinators outside the core framework,\nis one of design principles of <code>servant</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data RawPathInfo\n\ninstance HasServer api ctx =&gt; HasServer (RawPathInfo :&gt; api) ctx where\n    type ServerT (RawPathInfo :&gt; api) m = BS8.ByteString -&gt; ServerT api m\n\n    hoistServerWithContext _ pc nt s =\n        hoistServerWithContext (Proxy :: Proxy api) pc nt . s\n\n    route _ ctx d = route (Proxy :: Proxy api) ctx $\n        passToServer d Wai.rawPathInfo\n</code></pre>\n\n<p>Using new <code>RawPathInfo</code> combinator, we can re-implement our application:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Routes2 route = Routes2\n    { route21 :: route :- RawPathInfo :&gt; \"route1\" :&gt; Get '[JSON] Int\n    , route22 :: route :- RawPathInfo :&gt; \"route2\" :&gt; Capture \"id\" Int :&gt; Get '[JSON] Int\n    }\n  deriving (Generic)\n\nroutes2 :: Routes2 AsServer\nroutes2 = Routes2\n    { route21 = \\p -&gt; liftIO $ do\n        BS8.putStrLn p\n        return (BS8.length p)\n    , route22 = \\p i -&gt; liftIO $ do\n        BS8.putStrLn p\n        return (succ i)\n    }\n\napp2 :: Application\napp2 = genericServe routes2\n</code></pre>\n\n<p>This version is slightly more declarative, and handlers are more restrictive.\nWe moved the <code>rawPathInfo</code> selector from handlers to combinator implementation,\nremoved repetition.</p>\n\n<h3>Using <code>Vault</code></h3>\n\n<p>The <code>vault</code> value in <code>wai</code> <code>Request</code> is not well known or used.\nBut in this scenario it can be useful.\nVault is explained in <a href=\"https://www.yesodweb.com/blog/2015/10/using-wais-vault\" rel=\"noreferrer\">Using WAI's vault for fun and profit</a> blog post.\nIt fills a \"dynamic\" gap of strongly typed <code>Request</code>: we can attach arbitrary data to the request,\nas is common in web frameworks in a dynamically typed languages.\nAs <code>servant-server</code> is based on <code>wai</code>, using vault is the third answer\nto the first part of the question.</p>\n\n<p>We (unsafely) create a key to the vault:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>rpiKey :: V.Key BS8.ByteString\nrpiKey = unsafePerformIO V.newKey\n</code></pre>\n\n<p>Then we create a <em>middleware</em> which will put <code>rawPathInfo</code> into the <code>vault</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>middleware :: Wai.Middleware\nmiddleware app req respond = do\n    let vault' = V.insert rpiKey (Wai.rawPathInfo req) (Wai.vault req)\n        req' = req { Wai.vault = vault' }\n    app req' respond\n</code></pre>\n\n<p>Using this we make third variant of our application.\nNote that we values might not be in the vault,\nthat's small functional regression.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Routes3 route = Routes3\n    { route31 :: route :- Vault :&gt; \"route1\" :&gt; Get '[JSON] Int\n    , route32 :: route :- Vault :&gt; \"route2\" :&gt; Capture \"id\" Int :&gt; Get '[JSON] Int\n    }\n  deriving (Generic)\n\nroutes3 :: Routes3 AsServer\nroutes3 = Routes3\n    { route31 = \\v -&gt; liftIO $ do\n        let p = fromMaybe \"?\" $ V.lookup rpiKey v\n        BS8.putStrLn p\n        return (BS8.length p)\n    , route32 = \\v i -&gt; liftIO $ do\n        let p = fromMaybe \"?\" $ V.lookup rpiKey v\n        BS8.putStrLn p\n        return (succ i)\n    }\n\napp3 :: Application\napp3 = middleware $ genericServe routes3\n</code></pre>\n\n<p>Note: that <code>vault</code> can be used to pass information from middlewares to handlers\nand from handlers to middlewares. For example, the authentication can be done\ncompletely in the middleware, with a user information stored in the vault for\nhandlers to use.</p>\n\n<h2>How to get current <em>route</em>?</h2>\n\n<p>The second part of a question, is how to get current route.\nSomething, we can get <code>route2/:id</code> out?\nNote that handlers are <em>anonymous</em>, in the same sense functions are.\nE.g. to write <em>recursive</em> anonymous functions, we can use <code>fix</code> combinator.\nWe can use something close to that to pass \"route into itself\",\nusing <code>Servant.API.Generics</code> we can reduce the boilerplate too.</p>\n\n<p>We start with ordinary looking <code>Routes4</code> data structure.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Routes4 route = Routes4\n    { route41 :: route :- \"route1\" :&gt; Get '[JSON] Int\n    , route42 :: route :- \"route2\" :&gt; Capture \"id\" Int :&gt; Get '[JSON] Int\n    }\n  deriving (Generic)\n</code></pre>\n\n<p>But instead of making a <code>Routes4 AsServer</code> value, we'll use a different <em>mode</em>.\n<code>AsRecServer route</code> is a handler which takes <code>route :- api</code> as a first\nargument.  In this example we use <code>HasLink'</code>, but reader is free to use other\nautomatic interpretations, e.g. <code>servant-client</code> to make a proxy!</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data AsRecServer route\ninstance GenericMode (AsRecServer route) where\n    type AsRecServer route :- api = (route :- api) -&gt; (AsServer :- api)\n\nroutes4 :: Routes4 (AsRecServer (AsLink Link))\nroutes4 = Routes4\n    { route41 = \\l -&gt; liftIO $ do\n        print l\n        return 42\n    , route42 = \\l i -&gt; liftIO $ do\n        print (l i)\n        return i\n    }\n\napp4 :: Application\napp4 = genericRecServe routes4\n</code></pre>\n\n<p>The usage is very simple, unfortunately the implementation is not.</p>\n\n<h3>Hairy bits</h3>\n\n<p>The implementation of <code>genericRecServe</code> is intimidating.\nThe missing bit is a function <code>genericHoist</code>.\nIn short, given a function which can convert <code>modeA :- api</code> into <code>modeB :- api</code> for all <code>api</code>,\n<code>genericHoist</code> converts <code>routes modeA</code> into <code>routes modeB</code>.\nMaybe this function should exist in <code>Servant.API.Generic</code>?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>genericHoist\n    :: ( GenericMode modeA, GenericMode modeB\n       , Generic (routes modeA), Generic (routes modeB)\n       , GServantHoist c api modeA modeB (Rep (routes modeA)) (Rep (routes modeB))\n       )\n    =&gt; Proxy modeA -&gt; Proxy modeB -&gt; Proxy c -&gt; Proxy api\n    -&gt; (forall api'. c api' =&gt; Proxy api' -&gt; (modeA :- api') -&gt; (modeB :- api'))\n    -&gt; routes modeA -&gt; routes modeB\ngenericHoist pa pb pc api nt = to . gservantHoist pa pb pc api nt . from\n</code></pre>\n\n<p><code>genericRecServe</code> is <code>genericHoist</code> precomposed with a variant of <code>genericServe</code>.\nThe implementation of one-liner, given a wall of constraints.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>genericRecServe\n    :: forall routes.\n       ( HasServer (ToServantApi routes) '[]\n       , GenericServant routes AsApi\n       , GenericServant routes AsServer\n       , GenericServant routes (AsRecServer (AsLink Link))\n       , Server (ToServantApi routes) ~ ToServant routes AsServer\n       , GServantHoist \n          HasLink'\n          (ToServantApi routes)\n          (AsRecServer (AsLink Link))\n          AsServer\n          (Rep (routes (AsRecServer (AsLink Link))))\n          (Rep (routes AsServer))\n       )\n    =&gt; routes (AsRecServer (AsLink Link)) -&gt; Application\ngenericRecServe\n    = serve (Proxy :: Proxy (ToServantApi routes)) \n    . toServant\n    . genericHoist\n        (Proxy :: Proxy (AsRecServer (AsLink Link)))\n        (Proxy :: Proxy AsServer)\n        (Proxy :: Proxy HasLink')\n        (genericApi (Proxy :: Proxy routes))\n        (\\p f -&gt; f $ safeLink p p)\n</code></pre>\n\n<p>There we us single-instance-class trick to make partially applicable <code>HasLink</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class (IsElem api api, HasLink api) =&gt; HasLink' api\ninstance (IsElem api api, HasLink api) =&gt; HasLink' api\n</code></pre>\n\n<p>The work horse of <code>genericHoist</code> is <code>gservantHoist</code> which works\non <code>Rep</code> of route structures.\nIt's important to notice that <code>c</code> and <code>api</code> arguments are class arguments.\nThis let us constraint them in instances.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class GServantHoist c api modeA modeB f g where\n    gservantHoist\n        :: Proxy modeA -&gt; Proxy modeB -&gt; Proxy c -&gt; Proxy api\n        -&gt; (forall api'. c api' =&gt; Proxy api' -&gt; (modeA :- api') -&gt; (modeB :- api'))\n        -&gt; f x -&gt; g x\n</code></pre>\n\n<p>Instance for <code>M1</code> (metadata) and <code>:*:</code> (product) are straight-forward\npass-through, something you would expect:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance\n    GServantHoist c api modeA modeB f g\n    =&gt;\n    GServantHoist c api modeA modeB (M1 i j f) (M1 i' j' g)\n  where\n    gservantHoist pa pb pc api nt\n        = M1\n        . gservantHoist pa pb pc api nt\n        . unM1\n\ninstance\n    ( GServantHoist c apiA modeA modeB f f'\n    , GServantHoist c apiB modeA modeB g g'\n    ) =&gt;\n    GServantHoist c (apiA :&lt;|&gt; apiB) modeA modeB (f :*: g) (f' :*: g')\n  where\n    gservantHoist pa pb pc _ nt (f :*: g) =\n        gservantHoist pa pb pc (Proxy :: Proxy apiA) nt f \n        :*:\n        gservantHoist pa pb pc (Proxy :: Proxy apiB) nt g\n</code></pre>\n\n<p>The implementation for the leaf <code>K1</code> shows why we need <code>c</code> and <code>api</code>\nas class arguments: here we require <code>c api</code>, and \"coherence\" conditions,\nso <code>api</code>, <code>modeA</code>, <code>modeB</code>, <code>x</code> and <code>y</code> match.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance\n    ( c api, (modeA :- api) ~ x, (modeB :- api) ~ y )\n    =&gt; GServantHoist c api modeA modeB (K1 i x) (K1 i y)\n  where\n    gservantHoist _pa _pb _pc api nt\n        = K1\n        . nt api\n        . unK1\n</code></pre>\n\n<h3>Conclusion</h3>\n\n<p>Using similar <code>Generic</code> approach, we can do various transformations on handlers.\nFor example we can wrap ordinary routes in <code>servant</code> \"middleware\", which would\nput route information into <code>vault</code>, and that information may be used by <code>wai</code>\n<code>Middleware</code> to collect statistics. This way we can make an improved version of\n<code>servant-ekg</code>, as currently <code>servant-ekg</code> may get confused by overlapping routes.</p>\n\n<h2>Main for testing</h2>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main :: IO ()\nmain = do\n    args &lt;- getArgs\n    case args of\n        (\"run1\":_) -&gt; run app1\n        (\"run2\":_) -&gt; run app2\n        (\"run3\":_) -&gt; run app3\n        (\"run4\":_) -&gt; run app4\n        _ -&gt; putStrLn \"To run, pass 'run1' argument: cabal new-run cookbook-generic run\"\n  where\n    run app = do\n        putStrLn \"Starting cookbook-current-route at http://localhost:8000\"\n        Warp.run 8000 app\n</code></pre>\n"}], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1031, "favorite_count": 0, "accepted_answer_id": 54890701, "answer_count": 3, "score": 4, "last_activity_date": 1551200837, "creation_date": 1483913327, "last_edit_date": 1483973153, "question_id": 41538438, "link": "https://stackoverflow.com/questions/41538438/haskell-servant-get-current-route-url-from-handler", "title": "Haskell Servant Get Current Route / URL From Handler", "body": "<p>I'd like to get current route that corresponds to my handler. Here is mockup of my server just for reference:</p>\n\n<pre><code>type ServerAPI = \n         \"route01\" :&gt; Get '[HTML] Text\n    :&lt;|&gt; \"route02\" :&gt; \"subroute\" :&gt; Get '[HTML] Text\n    :&lt;|&gt; \"route03\" :&gt; Get '[HTML] Text\n</code></pre>\n\n<p>And here are some handlers :</p>\n\n<pre><code>route1and2Handler :: Handler Text\nroute1and2Handler = do\n    route &lt;- getCurrentRoute\n    addVisitCountForRouteToDatabaseOrSomethingOfThatSort...\n    return template\n\nroute3Handler :: Handler Text\nroute3Handler = return \"Hello, I'm route 03\"\n</code></pre>\n\n<p>And my server :</p>\n\n<pre><code>server :: Server ServerAPI\nserver = route1and2Handler :&lt;|&gt; route1and2Handler :&lt;|&gt; route3Handler\n</code></pre>\n\n<p>So, essentially my <code>route1and2Handler</code> should have some way of getting current route. I've tried getting a request object into my handler and extracting url from that by implementing <code>HasServer</code> instance like so :</p>\n\n<pre><code>data FullRequest\n\ninstance HasServer a =&gt; HasServer (FullRequest :&gt; a) where\n    type Server (FullRequest :&gt; a) = Request -&gt; Server a\n    route Proxy subserver request respond =\n        route (Proxy :: Proxy a) (subserver request) request respond\n</code></pre>\n\n<hr>\n\n<p><strong>[EDIT]</strong> I have just noticed that I was looking at api for old version of servant and this isn't valid any more. New <code>route</code> has type signature of <code>route :: Proxy api -&gt; Context context -&gt; Delayed env (Server api) -&gt; Router env</code> and I don't really see way to get <code>Request</code> from here.</p>\n\n<hr>\n\n<p>And than making <code>route1and2Handler</code> type signature to be <code>Request -&gt; Handler Text</code>, but I'm getting this error when trying to create <code>HasServer</code> instance :</p>\n\n<pre><code>`Server' is not a (visible) associated type of class `HasServer'\n</code></pre>\n\n<p><strong>And just to point out in the end, my end goal is to get current route from within the <code>Handler</code>, adding visit count for route in the database is just for example purposes. I'm not interested in better way to count visits or something of that sort.</strong></p>\n"}, {"tags": ["haskell", "frp", "reflex"], "answers": [{"comments": [{"owner": {"reputation": 3188, "user_id": 590347, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca28027d24f8a5aacd4d9d9098a09b5?s=128&d=identicon&r=PG", "display_name": "Bartosz", "link": "https://stackoverflow.com/users/590347/bartosz"}, "edited": false, "score": 0, "creation_date": 1483917155, "post_id": 41538837, "comment_id": 70283106, "body": "Oh, you&#39;ve found it out earlier than I posted my answer. Posted anyway, with short explanation of what&#39;s going on."}, {"owner": {"reputation": 3188, "user_id": 590347, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca28027d24f8a5aacd4d9d9098a09b5?s=128&d=identicon&r=PG", "display_name": "Bartosz", "link": "https://stackoverflow.com/users/590347/bartosz"}, "edited": false, "score": 0, "creation_date": 1483917216, "post_id": 41538837, "comment_id": 70283124, "body": "Aside note: &#39;button&#39; is kind of weird from the API point of view. It seems like it&#39;s just made to be an util to quickly add some buttons, but quickly becomes useless once you want more from it."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 3, "last_activity_date": 1483916506, "creation_date": 1483916506, "answer_id": 41538837, "question_id": 41538347, "link": "https://stackoverflow.com/questions/41538347/reflexfrp-how-to-set-button-text-from-textinput-on-button-click/41538837#41538837", "title": "ReflexFRP: How to set button text from textInput on button click", "body": "<p>It seems that vanilla buttons in <code>reflex-dom</code> do not support dynamic labeling; so for the</p>\n\n<pre><code>solutionWidget :: MonadWidget t m =&gt; m ()\nsolutionWidget = do\n  rec send  &lt;- dynButton dyn\n      input &lt;- textInput $ def &amp; setValue .~ fmap (const \"\") send\n      dyn &lt;- holdDyn \"click button to set text below\"\n                     (tag (current $ view textInput_value input) send)\n  return ()\n</code></pre>\n\n<p>we need to define the following: </p>\n\n<pre><code>dynButton :: MonadWidget t m =&gt; Dynamic t Text -&gt; m (Event t ())\ndynButton s = do\n  (e, _) &lt;- elAttr' \"button\" (Map.singleton \"type\" \"button\") $ dynText s\n  return $ domEvent Click e\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3188, "user_id": 590347, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca28027d24f8a5aacd4d9d9098a09b5?s=128&d=identicon&r=PG", "display_name": "Bartosz", "link": "https://stackoverflow.com/users/590347/bartosz"}, "is_accepted": true, "score": 3, "last_activity_date": 1483917119, "creation_date": 1483917119, "answer_id": 41538920, "question_id": 41538347, "link": "https://stackoverflow.com/questions/41538347/reflexfrp-how-to-set-button-text-from-textinput-on-button-click/41538920#41538920", "title": "ReflexFRP: How to set button text from textInput on button click", "body": "<p>What happens here is that <code>button</code> takes String (or Text, depending on version), and this string depends on the value of text input, which, in turn, depends on the event produced by a button. Now, normally similar loops in event network are just fine, but here you need to sample the input value to obtain the text <em>before</em> the button is even rendered (because it needs that text to render to DOM).</p>\n\n<p>Following code (written in hsnippet, so older reflex-dom, and simplified (no lens), shows how one can defined a 'button' helper that does not need to have the input text realized before being written to DOM:</p>\n\n<pre><code>app :: MonadWidget t m =&gt; App t m ()\napp = do\n  rec send  &lt;- button' $ _textInput_value input\n      input &lt;- textInput $ def { _textInputConfig_setValue = fmap (const \"\") send }\n  return ()\n\nbutton' :: MonadWidget t m =&gt; Dynamic t String -&gt; m (Event t ())\nbutton' s = do\n  (e, _) &lt;- elAttr' \"button\" (M.singleton \"type\" \"button\") $ dynText s\n  return $ domEvent Click e\n</code></pre>\n"}], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 41538920, "answer_count": 2, "score": 3, "last_activity_date": 1483917119, "creation_date": 1483912665, "question_id": 41538347, "link": "https://stackoverflow.com/questions/41538347/reflexfrp-how-to-set-button-text-from-textinput-on-button-click", "title": "ReflexFRP: How to set button text from textInput on button click", "body": "<p>I have a simple widget that should set the \"text\" of a button from a given text input field.</p>\n\n<p>While I managed to do a simple clear functionality</p>\n\n<pre><code>buttonWidget :: MonadWidget t m =&gt; m ()\nbuttonWidget = do\n  send  &lt;- button \"clear\"\n  input &lt;- textInput $ def &amp; setValue .~ fmap (const \"\") send\n  return ()\n</code></pre>\n\n<p>I did not manage to set the button label - the code below compiles</p>\n\n<pre><code>buttonWidget :: MonadWidget t m =&gt; m ()\nbuttonWidget = do\n  rec send  &lt;- button val\n      input &lt;- textInput $ def &amp; setValue .~ fmap (const \"\") send\n      val   &lt;- sample $ current $ view textInput_value input\n  return ()\n</code></pre>\n\n<p>but looking at the output <code>index.html</code> - I get only a white page with a console error message: </p>\n\n<blockquote>\n  <p><code>rts.js:7313 thread blocked indefinitely in an MVar operation</code></p>\n</blockquote>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 7260011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58d710b193c2c9907cffc15995143dc2?s=128&d=identicon&r=PG&f=1", "display_name": "neo2500", "link": "https://stackoverflow.com/users/7260011/neo2500"}, "edited": false, "score": 0, "creation_date": 1483904532, "post_id": 41536757, "comment_id": 70279220, "body": "RHW indicates &quot;Consider the value (1+2):(3+4):[]. If we apply seq to this, it will evaluate the (1+2) thunk&#168;. So I thought that 1 should be evaluated."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1483905379, "post_id": 41536757, "comment_id": 70279509, "body": "<code>1+2</code> is not the same as <code>(,) 1 2</code> or <code>(,) undefined undefined</code> in your question.  One is a computation the other is a data construction."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 45, "user_id": 7260011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58d710b193c2c9907cffc15995143dc2?s=128&d=identicon&r=PG&f=1", "display_name": "neo2500", "link": "https://stackoverflow.com/users/7260011/neo2500"}, "edited": false, "score": 4, "creation_date": 1483905401, "post_id": 41536757, "comment_id": 70279516, "body": "@neo2500 That seems to be a mistake in the book. <code>undefined:(3+4):[] `seq` &quot;OK&quot;</code> evaluates to &quot;OK&quot; - the left operand of <code>:</code> is definitely not evaluated."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1483905485, "post_id": 41536757, "comment_id": 70279548, "body": "@ThomasM.DuBuisson But <code>(1+2) : ...</code> is the same as <code>(1+2, ...)</code> (in terms of where the expression is relative to the constructor). The line in the book seems to be just wrong (or both neo and me are misreading it)."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 45, "user_id": 7260011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58d710b193c2c9907cffc15995143dc2?s=128&d=identicon&r=PG&f=1", "display_name": "neo2500", "link": "https://stackoverflow.com/users/7260011/neo2500"}, "edited": false, "score": 2, "creation_date": 1483905497, "post_id": 41536757, "comment_id": 70279555, "body": "@neo2500 The book isn&#39;t really clear about what &quot;apply <code>seq</code> to this&quot; means. <code>seq (1+2) &quot;OK&quot;</code> does evalute <code>1+2</code> to <code>3</code>, but you can check in GHCi that <code>(1+2):(3+4):[] </code>seq` &quot;OK&quot;` does not evalute any element of the list: <code>&gt; let x = (1+2):(3+4):[]; &gt; seq x &quot;OK&quot;; &gt; :sprint x  --&gt; x = _</code>"}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 4, "last_activity_date": 1483903636, "last_edit_date": 1483903636, "creation_date": 1483903082, "answer_id": 41536757, "question_id": 41536705, "link": "https://stackoverflow.com/questions/41536705/seq-stops-as-soon-as-it-reaches-a-constructor/41536757#41536757", "title": "seq stops as soon as it reaches a constructor", "body": "<blockquote>\n  <p>But why the case2 function return \"OK\" too ?</p>\n</blockquote>\n\n<p>Because both <code>undefined</code>s are inside the <code>(,)</code> constructor and thus not evaluated.</p>\n\n<blockquote>\n  <p>I thought that case2 will return \"Preluded.undefined\" because in the first case 1 is evaluated</p>\n</blockquote>\n\n<p><code>1</code> isn't evaluated in the first case - the evaluation stops with <code>(:)</code> (the first constructor), as the book says. <code>undefined : undefined `seq` \"OK\"</code> still evaluates to \"OK\".</p>\n"}, {"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 4, "last_activity_date": 1483920857, "last_edit_date": 1483920857, "creation_date": 1483915051, "answer_id": 41538654, "question_id": 41536705, "link": "https://stackoverflow.com/questions/41536705/seq-stops-as-soon-as-it-reaches-a-constructor/41538654#41538654", "title": "seq stops as soon as it reaches a constructor", "body": "<p>RWH says,</p>\n\n<blockquote>\n  <p>Consider the value <code>(1+2):(3+4):[]</code>. If we apply <code>seq</code> to this, it will evaluate the <code>(1+2)</code> thunk.</p>\n</blockquote>\n\n<p>This is incorrect, as a comment from Phil Thomas in the online version points out:</p>\n\n<blockquote>\n  <p>In ghci, if you enter the following:</p>\n\n<pre><code>let x = (1+2):(3+4):[]\nseq x True\n:print x\n</code></pre>\n  \n  <p>You will see:</p>\n\n<pre><code>x = [(_t1::Integer),(_t2::Integer)]\n</code></pre>\n  \n  <p>The <code>(1+2)</code> has not been evaluated. The cons is an infix operator that appears to come after the <code>(1+2)</code>, but it really is the first thing encountered by the seq.</p>\n</blockquote>\n\n<p>We can think of <code>seq</code> as being defined as:</p>\n\n<pre><code>\u22a5 `seq` b = \u22a5\na `seq` b = b\n</code></pre>\n\n<p>In order to determine whether a value is bottom, it must be evaluated only up to its <em>outermost</em> constructor. The outermost constructor of <code>1 : repeat undefined</code> is not <code>1</code>, it is <code>(:)</code>. For example, you can visualize <code>1 : []</code> as:</p>\n\n<pre><code> (:)\n / \\\n1   []\n</code></pre>\n\n<p>The outermost constructor in this representation is the <strong>topmost</strong> constructor.</p>\n\n<p>This means that <code>1 : repeat undefined</code> will be evaluated to <code>_ : _</code>, not <code>1 : _</code> (where <code>_</code> represents an unevaluated thunk).</p>\n\n<p>Similarly, the outermost constructor of <code>(undefined, undefined)</code> is <code>(,)</code> and it will be evaluated to <code>(_, _)</code>, not <code>(undefined, _)</code> or <code>undefined</code>.</p>\n"}], "owner": {"reputation": 45, "user_id": 7260011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58d710b193c2c9907cffc15995143dc2?s=128&d=identicon&r=PG&f=1", "display_name": "neo2500", "link": "https://stackoverflow.com/users/7260011/neo2500"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 41538654, "answer_count": 2, "score": 2, "last_activity_date": 1483961665, "creation_date": 1483902779, "last_edit_date": 1483961665, "question_id": 41536705, "link": "https://stackoverflow.com/questions/41536705/seq-stops-as-soon-as-it-reaches-a-constructor", "title": "seq stops as soon as it reaches a constructor", "body": "<p><a href=\"http://book.realworldhaskell.org/read/functional-programming.html#x_dD1\" rel=\"nofollow noreferrer\">RWH</a> explains that seq stops as soon as it reaches a constructor.</p>\n\n<pre><code>case1 = 1:repeat undefined `seq` \"OK\"\ncase2 = (undefined,undefined) `seq` \"OK\"\n</code></pre>\n\n<p>We have </p>\n\n<pre><code>1:repeat undefined = (:) 1 (repeat undefined)\n(undefined,undefined) = (,) undefined undefined\n</code></pre>\n\n<p>I understood why case1 function return \"OK\".\nBut why the case2 function return \"OK\" too ?\nI thought that case2 will return \"Preluded.undefined\" because in the first case 1 is evaluated so I thought that undefined should be evaluated in the second case too.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1483893365, "post_id": 41534962, "comment_id": 70275080, "body": "1. Learn how to cabalize your package 2. <code>cabal install</code>."}, {"owner": {"reputation": 191, "user_id": 4690599, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/w0DCU.jpg?s=128&g=1", "display_name": "some idiot", "link": "https://stackoverflow.com/users/4690599/some-idiot"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1483959291, "post_id": 41534962, "comment_id": 70297363, "body": "Ok, I\u2019ll copy-paste then. It\u2019s a mess but it works at least."}], "answers": [{"comments": [{"owner": {"reputation": 191, "user_id": 4690599, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/w0DCU.jpg?s=128&g=1", "display_name": "some idiot", "link": "https://stackoverflow.com/users/4690599/some-idiot"}, "edited": false, "score": 0, "creation_date": 1483903924, "post_id": 41535361, "comment_id": 70279020, "body": "after asking for source directory, cabal init complains (Warning) about missing dependencies--librarys that I do not import, like Text.Parsec, Crypto.MAC.SipHash, Graphics.UI.Threepenny."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 191, "user_id": 4690599, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/w0DCU.jpg?s=128&g=1", "display_name": "some idiot", "link": "https://stackoverflow.com/users/4690599/some-idiot"}, "edited": false, "score": 0, "creation_date": 1483904058, "post_id": 41535361, "comment_id": 70279071, "body": "Aha. Sound like a topic for a separate question."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1483896547, "last_edit_date": 1483896547, "creation_date": 1483895287, "answer_id": 41535361, "question_id": 41534962, "link": "https://stackoverflow.com/questions/41534962/install-local-library/41535361#41535361", "title": "Install local library", "body": "<ol>\n<li><p>Make sure you have the proper Haskell platform installed, including <code>cabal</code>. Alternatively you can use <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\"><code>stack</code></a>, which is more modern and in many ways better, but IMO <code>cabal</code> is still more practical for a simple project like yours.<br>The following assumes you use <code>cabal</code> on a typical Linux machine.</p></li>\n<li><p>If not already done, give your file a meaningful <em>hierarchical module name</em>, according to what it does. <code>module Video.Demuxing.FFMPEG</code> or <code>Data.List.Shuffle.Deterministic</code>, for example. Let's assume you call it <code>Foo.Bar.Baz</code>. I.e. the file should begin with</p>\n\n<pre><code>module Foo.Bar.Baz where\n... -- start code\n</code></pre></li>\n<li><p>Put the file in a corresponding folder structure, i.e.</p>\n\n<ol>\n<li><p>if not already done, make a new project directory, for example</p>\n\n<pre><code>mkdir /home/U\ua731\u1d07\u0280\u0274\u1d00\u1d0d\u1d07/haskell/foobar\ncd /home/U\ua731\u1d07\u0280\u0274\u1d00\u1d0d\u1d07/haskell/foobar\n</code></pre></li>\n<li><p>In that project directory make a subdirectory <code>Foo</code>, therein a directory <code>Bar</code>, and put your file in it as <code>Baz.hs</code>.</p>\n\n<pre><code>mkdir -p Foo/Bar\ncp W\u029c\u1d07\u0280\u1d07E\u1d20\u1d07\u0280/Y\u1d0f\u1d1c\u0280/F\u026a\u029f\u1d07/W\u1d00\ua731/B\u1d07\ua730\u1d0f\u0280\u1d07.hs Foo/Bar/Baz.hs\n</code></pre></li>\n</ol></li>\n<li><p>Make the file part of a new cabal library.</p>\n\n<pre><code>cabal init\n</code></pre>\n\n<p>This will ask you a couple of questions, hopefully it'll be clear what to choose. For the most part, the defaults will be fine, in that case always just press <kbd>enter</kbd>.</p></li>\n<li><p>Put everything under <em>version control</em>, if you haven't already. (If you don't know what this is, I suggest you read some Github tutorials. You can skip this step, but the sooner you accustom yourself to some VCS, the better.)</p></li>\n<li><p>Install your project locally.</p>\n\n<pre><code>cabal install\n</code></pre></li>\n<li><p>If everything has worked without errors, you can then, in a Haskell file stored in somewhere else on the computer, simply</p>\n\n<pre><code>import Foo.Bar.Baz\n</code></pre>\n\n<p>and have everything availably you've defined in that project module. No need to tell GHC where <code>Foo.Bar.Baz</code> is stored when compiling, it has already registered that at this point. You can also launch up ghci anywhere and <code>:m +Foo.Bar.Baz</code>.</p></li>\n</ol>\n"}], "owner": {"reputation": 191, "user_id": 4690599, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/w0DCU.jpg?s=128&g=1", "display_name": "some idiot", "link": "https://stackoverflow.com/users/4690599/some-idiot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 374, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1483896547, "creation_date": 1483893187, "question_id": 41534962, "link": "https://stackoverflow.com/questions/41534962/install-local-library", "title": "Install local library", "body": "<p>How can I \"install\" a local (ie it is on my hard-drive, not on the internet) .hs file to use it across multiple programs? Specifically, if I edit the library, those edits should be available to all programs, so no copy-pasting the library into every program\u2019s directory. </p>\n\n<p>To compile my programs, I still want to type ghc main.hs, not a page of file-paths. </p>\n\n<p>This may be obvious from the above, but I don\u2019t have any knowledge of cabal. </p>\n"}, {"tags": ["haskell", "functional-programming", "list-comprehension", "higher-order-functions"], "answers": [{"comments": [{"owner": {"reputation": 8046, "user_id": 1774391, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/96ec1a791090d470daa3338f3dfdf996?s=128&d=identicon&r=PG", "display_name": "MainstreamDeveloper00", "link": "https://stackoverflow.com/users/1774391/mainstreamdeveloper00"}, "edited": false, "score": 0, "creation_date": 1483888142, "post_id": 41534089, "comment_id": 70273349, "body": "Thanks for the quick answer, but lexicographical order is alphabetical order preceded by a length comparison, so 906609 is still larger than 99999. Why comparison result changes only when I change the bound?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 8046, "user_id": 1774391, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/96ec1a791090d470daa3338f3dfdf996?s=128&d=identicon&r=PG", "display_name": "MainstreamDeveloper00", "link": "https://stackoverflow.com/users/1774391/mainstreamdeveloper00"}, "edited": false, "score": 5, "creation_date": 1483888255, "post_id": 41534089, "comment_id": 70273384, "body": "Length is checked <i>after</i> alphabetical order. <code>&quot;aaaaaaaaaa&quot; &lt; &quot;b&quot;</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 8046, "user_id": 1774391, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/96ec1a791090d470daa3338f3dfdf996?s=128&d=identicon&r=PG", "display_name": "MainstreamDeveloper00", "link": "https://stackoverflow.com/users/1774391/mainstreamdeveloper00"}, "edited": false, "score": 0, "creation_date": 1483888983, "post_id": 41534089, "comment_id": 70273609, "body": "By changing the lower bound on <code>x</code>, you are eliminating the numbers that consist of all 9s."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 9, "last_activity_date": 1483888215, "last_edit_date": 1483888215, "creation_date": 1483887787, "answer_id": 41534089, "question_id": 41534058, "link": "https://stackoverflow.com/questions/41534058/strange-behaviour-of-list-comprehensions/41534089#41534089", "title": "Strange behaviour of list comprehensions", "body": "<p>The result of <code>filter</code> is a list of <code>String</code> values, so <code>maximum</code> is comparing them lexicographically. You need to convert the values back to <code>Int</code>s  first. The type signature ensures that <code>read</code> returns values of the correct type.</p>\n\n<pre><code>palindrome :: Int\npalindrome = maximum . map read . filter ...\n</code></pre>\n\n<p>Another approach is to only convert a value to a <code>String</code> in the filter itself:</p>\n\n<pre><code>palindrome :: Int\npalindrome = maximum $ filter (\\a -&gt; let sa = show a in reverse sa == sa) [ x*y | x &lt;- [100..999], y &lt;- [x..999]]\n</code></pre>\n"}], "owner": {"reputation": 8046, "user_id": 1774391, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/96ec1a791090d470daa3338f3dfdf996?s=128&d=identicon&r=PG", "display_name": "MainstreamDeveloper00", "link": "https://stackoverflow.com/users/1774391/mainstreamdeveloper00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 41534089, "answer_count": 1, "score": 4, "last_activity_date": 1483893181, "creation_date": 1483887606, "last_edit_date": 1483893181, "question_id": 41534058, "link": "https://stackoverflow.com/questions/41534058/strange-behaviour-of-list-comprehensions", "title": "Strange behaviour of list comprehensions", "body": "<p>I'm learning basics of Haskell and trying to solve project Euler's simple tasks: find largest palindrome of 3 digit numbers (100.999). I wrote this code:</p>\n\n<pre><code>palindrome = maximum $ filter (\\a -&gt; reverse a == a) $\n                                    map show [ x*y :: Int | x &lt;- [100 .. 999],\n                                                            y &lt;- [x, x+1 .. 999]]\n</code></pre>\n\n<p>It gives a wrong answer = 99999, when I change it to <code>x &lt;- [307 .. 999]</code>answer still is wrong: 94249 (all palindromes, but not the largest) and finally when I change it to <code>x &lt;- [308 .. 999],</code> it gives me right answer: 906609. </p>\n\n<p>I really don't understand this behaviour: it seems there is some kind of overflow and truncation happens inside the generated list. Can someone explain me this wrong behaviour? I <strong>don't want</strong> you to answer the task: i know my solution is not very efficient. I just want you to explain this code behaviour (list truncation or memory issues). Thanks.</p>\n"}, {"tags": ["haskell", "yesod"], "owner": {"reputation": 143, "user_id": 2997695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d7588716b59ec54b6c445870065c475?s=128&d=identicon&r=PG&f=1", "display_name": "user2997695", "link": "https://stackoverflow.com/users/2997695/user2997695"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1483909138, "creation_date": 1483887219, "last_edit_date": 1483909138, "question_id": 41534008, "link": "https://stackoverflow.com/questions/41534008/yesod-trying-to-print-table-data-and-getting-foreign-key-information-from-anoth", "title": "Yesod: Trying to print table data and getting foreign key information from another table", "body": "<p>I am working with Yesod and I am trying to print a table containing a list of events and the city they belong to.</p>\n\n<p>I have the following models:</p>\n\n<pre><code>City\n    name Text\n    countryId CountryId\n    UniqueCity name\n    deriving Eq\n    deriving Show\n\nEvent\n    title Text\n    description Text\n    date UTCTime\n    cityId CityId\n    deriving Eq\n    deriving Show`\n</code></pre>\n\n<p>and the following code in the handler:</p>\n\n<pre><code>`module Handler.Event where\n\nimport Import\nimport Yesod.Form.Bootstrap3\nimport Database.Persist.Sql\n\ngetEventR :: Handler Html\ngetEventR = do\n    events &lt;- runDB $ selectList [] [Asc EventTitle]\n    defaultLayout $ do \n        setTitle \"Events\"   \n        [whamlet|\n            &lt;h1&gt;Events\n                &lt;table&gt;\n                    &lt;thead&gt;\n                        &lt;tr&gt;\n                          &lt;th&gt;Event title&lt;/th&gt;\n                          &lt;th&gt;Event date&lt;/th&gt;\n                          &lt;th&gt;Event city&lt;/th&gt;\n                    &lt;tbody&gt;\n                    $forall Entity eventId event &lt;- events\n                        &lt;tr&gt;\n                            &lt;td&gt;#{eventTitle event}\n                            &lt;td&gt;#{show (eventDate event)}   \n                            &lt;td&gt;#{addCity eventId}   \n        |]\n\naddCity event = do\n    city &lt;- getCity $ eventCityId event\n    return city\n\ngetCity cid = do\n    city &lt;- runDB $ get404 cid\n    return city`\n</code></pre>\n\n<p>But when I try running this, I get the following error:\n    Couldn't match expected type 'Event' with actual type 'Key Event'\n    In the first argument of 'addCity', namely 'eventId_ajRi'\n    In the first argument of 'toHtml', namely 'addCity eventId_ajRi'</p>\n\n<p>I think I understand the error, but I really have no idea how to fix it and how to display the city name. Can someone please tell me how this should be done?</p>\n\n<p>I have also tried doing it like this, but still no luck:</p>\n\n<pre><code>module Handler.Event where\n\nimport Import\nimport Yesod.Form.Bootstrap3\nimport Database.Persist.Sql\n\ngetEventR :: Handler Html\ngetEventR = do\n    events &lt;- runDB $ selectList [] [Asc EventTitle]\n    defaultLayout $ do \n        setTitle \"Events\"   \n        [whamlet|\n            &lt;h1&gt;Events\n                &lt;table&gt;\n                    &lt;thead&gt;\n                        &lt;tr&gt;\n                          &lt;th&gt;Event name&lt;/th&gt;\n                          &lt;th&gt;Event date&lt;/th&gt;\n                          &lt;th&gt;Event city&lt;/th&gt;\n                    &lt;ul&gt;\n                    &lt;tbody&gt;\n                    $forall ev &lt;- map entityVal events\n                        &lt;tr&gt;\n                            &lt;td&gt;#{eventTitle ev}\n                            &lt;td&gt;#{show (eventDate ev)}   \n                            &lt;td&gt;#{addCity ev}   \n        |]\n\naddCity ev = do\n    eve &lt;- entityVal ev\n    city &lt;- getCity $ eventCityId eve\n    return city\n\ngetCity cid = do\n    city &lt;- runDB $ get404 cid\n    return $ cityName city\n</code></pre>\n\n<p>With this modifications, I am now getting:</p>\n\n<pre><code>Couldn't match expected type 'Entity (HandlerT site0 IO Event)' with actual type 'Event'\nIn the first argument of 'addCity', namely 'ev_ajRc'\nIn the first argument of 'toHtml', namely 'addCity ev_ajRc'\n</code></pre>\n"}, {"tags": ["haskell", "game-development"], "answers": [{"tags": [], "owner": {"reputation": 381, "user_id": 1517689, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f18ad9baf832c26ed0d6ae6163615929?s=128&d=identicon&r=PG", "display_name": "Miloslav \u010c&#237;\u017e", "link": "https://stackoverflow.com/users/1517689/miloslav-%c4%8c%c3%ad%c5%be"}, "is_accepted": true, "score": 9, "last_activity_date": 1484589005, "last_edit_date": 1484589005, "creation_date": 1483883740, "answer_id": 41533452, "question_id": 41533451, "link": "https://stackoverflow.com/questions/41533451/how-can-i-write-a-simple-real-time-game-loop-in-pure-haskell/41533452#41533452", "title": "How can I write a simple real-time game loop in pure Haskell?", "body": "<p><em>this answer is being updated as I find new solutions</em></p>\n\n<p>After hours of studying I came up with the following code:</p>\n\n<pre><code>    {- Simple game loop example. -}\n\nimport System.IO\nimport System.Timeout\n\ninputTimeout = 50000           -- in microseconds\ninitialGameState = 100    \ntype GameState = Int           -- change to your own gamestate type here\n\nnextGameState :: GameState -&gt; Char -&gt; GameState\nnextGameState previousGameState inputChar =\n\n  -- REPLACE THIS FUNCTION WITH YOUR GAME\n\n  case inputChar of\n    's' -&gt; previousGameState + 1\n    'a' -&gt; previousGameState - 1\n    _   -&gt; previousGameState\n\nloop :: GameState -&gt; IO ()            -- game loop\nloop gameState =\n  do\n    putStrLn (show gameState)\n    hFlush stdout\n\n    c &lt;- timeout inputTimeout getChar -- wait for input, with timeout\n\n    case c of\n      -- no input given\n      Nothing -&gt; do loop gameState\n\n      -- quit on 'q'\n      Just 'q' -&gt; do putStrLn \"quitting\"                     \n\n      -- input was given\n      Just input -&gt; do loop (nextGameState gameState input)\n\nmain = \n  do\n    hSetBuffering stdin NoBuffering   -- to read char without [enter]\n    hSetBuffering stdout (BlockBuffering (Just 80000))  -- to reduce flickering, you can change the constant\n    hSetEcho stdout False             -- turn off writing to console with keyboard\n    loop initialGameState\n</code></pre>\n\n<p>A few notes:</p>\n\n<ul>\n<li>This (not really) a game simply writes out the world state, which is just a number here, and increments/decrements it with 's' or 'a'. 'q' quits the program.</li>\n<li>Obviously this is a very simple solution and won't be usable for more serious games. The downfalls are:\n\n<ul>\n<li>The code doesn't scan for the keyboard state but reads the standard input, which limits the input handling. You won't be able to read simultaneous keypresses and there will be repeat delay. You could fix this by maybe writing a script in another language that would handle the keyboard input in more sophisticated way and pass it via pipe to your program. On Unix-like systems you could also read the keyboard state from a file in /dev/...</li>\n<li>You can expect each frame to take about <code>inputTimeout</code> microseconds, but not exactly. Very fast input could theoretically lower this, computation delays will increase this.</li>\n</ul></li>\n<li>I'm a Haskell beginner, so feel free to improve on this and post here. I'm updating this answer.</li>\n</ul>\n\n<h2>updated code</h2>\n\n<p>In previous code, if the game <code>nextGameState</code> function took a significant time to compute, the input characters would pile up in stdin and the reaction of the program would be delayed. The following code solves this by always reading all characters from input and taking only the last one.</p>\n\n<pre><code>    {- Simple game loop example, v 2.0. -}\n\nimport System.IO\nimport Control.Concurrent\n\nframeDelay = 10000             -- in microseconds\ninitialGameState = 100    \ntype GameState = Int           -- change to your own gamestate type here\n\nnextGameState :: GameState -&gt; Char -&gt; GameState\nnextGameState previousGameState inputChar =\n\n  -- REPLACE THIS FUNCTION WITH YOUR GAME\n\n  case inputChar of\n    's' -&gt; previousGameState + 1\n    'a' -&gt; previousGameState - 1\n    _   -&gt; previousGameState\n\ngetLastChar :: IO Char\ngetLastChar =\n  do  \n    isInput &lt;- hWaitForInput stdin 1      -- wait for char for 1 ms\n\n    if isInput\n      then\n        do\n          c1 &lt;- getChar\n          c2 &lt;- getLastChar\n\n          if c2 == ' '\n            then return c1\n            else return c2\n\n      else\n        do\n          return ' '\n\ngameLoop :: GameState -&gt; IO ()            -- game loop\ngameLoop gameState =\n  do\n    threadDelay frameDelay\n    putStrLn (show gameState)\n    hFlush stdout\n\n    c &lt;- getLastChar\n\n    case c of\n      'x' -&gt; do putStrLn \"quitting\"\n      _   -&gt; do gameLoop (nextGameState gameState c)\n\nmain = \n  do\n    hSetBuffering stdin NoBuffering   -- to read char without [enter]\n    hSetBuffering stdout (BlockBuffering (Just 80000))  -- to reduce flickering, you can change the constant\n    hSetEcho stdout False             -- turn off writing to console with keyboard\n    gameLoop initialGameState\n</code></pre>\n"}], "owner": {"reputation": 381, "user_id": 1517689, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f18ad9baf832c26ed0d6ae6163615929?s=128&d=identicon&r=PG", "display_name": "Miloslav \u010c&#237;\u017e", "link": "https://stackoverflow.com/users/1517689/miloslav-%c4%8c%c3%ad%c5%be"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 723, "favorite_count": 3, "accepted_answer_id": 41533452, "answer_count": 1, "score": 7, "last_activity_date": 1484589005, "creation_date": 1483883740, "question_id": 41533451, "link": "https://stackoverflow.com/questions/41533451/how-can-i-write-a-simple-real-time-game-loop-in-pure-haskell", "title": "How can I write a simple real-time game loop in pure Haskell?", "body": "<p>I've just started with Haskell and want to make a simple real-time game without installing additional libraries. I need to write a loop that scans for keyboard input but the game also has to run if there is no input. How do I do this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1483877887, "post_id": 41532592, "comment_id": 70270198, "body": "<code>do { let x = someComputation; return () }</code>? Assuming the actual code makes more sense (as shown, it will have no effect)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7361363"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1483879072, "post_id": 41532592, "comment_id": 70270510, "body": "Ok, thanks you very much!"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1483894833, "post_id": 41532592, "comment_id": 70275570, "body": "That should be <code>do let { x = someComputation }; return ()</code>. Otherwise <code>let</code> will try to parse <code>return</code> as the beginning of a local binding."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1483910914, "creation_date": 1483910914, "answer_id": 41538100, "question_id": 41532592, "link": "https://stackoverflow.com/questions/41532592/do-section-in-lambda-notation-for-mapm-function/41538100#41538100", "title": "do section in lambda notation - for mapM_ function", "body": "<p>A <code>do</code> block can be included, properly indented, even in a lambda-expression.  So, the following code will work fine:</p>\n\n<pre><code>foo :: IO ()\nfoo = mapM_ (\\x -&gt; do let y = x * 10\n                      print y\n                      return ()) [1..10]\n</code></pre>\n\n<p>Alternatively, you can use the <code>{ ... ; ... }</code> alternative syntax in place of indentation for <code>do</code> and <code>let</code> blocks as noted by @Ryan and @melpomene, so this will work fine, too:</p>\n\n<pre><code>foo = mapM_ (\\x -&gt; do { let { y = x * 10 }; print y; return () }) [1..10]\n</code></pre>\n\n<p>You can avoid the extra <code>{...}</code> around the <code>let</code> by using the following combination of <code>{...}</code> syntax and indentation:</p>\n\n<pre><code>foo = mapM_ (\\x -&gt; do { let y = x * 10\n                      ; print y; return () }) [1..10]\n</code></pre>\n\n<p>Here, the fact that the semicolon is in an earlier column than the <code>y</code> in the <code>let</code> line ends the <code>let</code> statement, then the semicolon separates it from the second statement in the do-block.  For details, see <a href=\"https://www.haskell.org/onlinereport/lexemes.html#lexemes-layout\" rel=\"nofollow noreferrer\">Section 2.7 Layout of the Haskell 98 Report</a> which describes how indentation-based layout is turned into brace notation.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7361363"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 429, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1483910914, "creation_date": 1483877798, "last_edit_date": 1483879905, "question_id": 41532592, "link": "https://stackoverflow.com/questions/41532592/do-section-in-lambda-notation-for-mapm-function", "title": "do section in lambda notation - for mapM_ function", "body": "<p>How to use <code>do</code> notation in lambda expression in <code>mapM_</code> ?   </p>\n\n<pre><code>mapM_ (\\x -&gt; do let x = someComputation, return ())\n</code></pre>\n\n<p>In real, I am searching for something like this comma.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1483875019, "post_id": 41532132, "comment_id": 70269472, "body": "As the error says, monads don&#39;t have a &quot;zero object&quot; or <code>mzero</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1483875104, "post_id": 41532132, "comment_id": 70269491, "body": "<code>instance Monad m</code> would make all possible types <code>m</code> an instance of <code>Monad</code>. You&#39;d need <code>instance Monad []</code>, but that already exists in the standard library. You have to define either your own class or your own type to be able to provide an instance like this."}, {"owner": {"reputation": 169, "user_id": 4386129, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000394595220/picture?type=large", "display_name": "BarbedWire", "link": "https://stackoverflow.com/users/4386129/barbedwire"}, "edited": false, "score": 0, "creation_date": 1483877027, "post_id": 41532132, "comment_id": 70269964, "body": "It&#39;s not clear for me why did you add that &#39;mzero&#39; while defining an instance for monad type class.."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3292534"}, "edited": false, "score": 0, "creation_date": 1483883397, "post_id": 41532132, "comment_id": 70271771, "body": "How would I define custom Monad. My code is from <a href=\"https://en.wikipedia.org/wiki/Monad_(functional_programming)#Collections\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/&hellip;</a>, I want to simply run those in haskell and try to populate them. See edit."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1483883594, "post_id": 41532132, "comment_id": 70271841, "body": "@kaboom Your second error is what my second comment is all about."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1483883664, "post_id": 41532132, "comment_id": 70271858, "body": "The code on wikipedia is just random samples from the standard library (<code>Control.Monad</code> and friends). You can&#39;t repeat it in your code; it&#39;s already defined."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3292534"}, "edited": false, "score": 0, "creation_date": 1483884012, "post_id": 41532132, "comment_id": 70271969, "body": "ok, where can I read on how to define simplest monad of my own, with custom name to it. In all the tutorials there is class Monad m defined, and then it&#39;s never used. I&#39;m very confused on how to just declare one."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1483884201, "post_id": 41532132, "comment_id": 70272036, "body": "Well, first you need to define a parametrized type. A simple example is something equivalent to the standard <code>Maybe</code> type: <code>data Option a = None | Some a</code>. Then you can do <code>instance Monad Option where { return x = ...; m &gt;&gt;= f = ... }</code> (implementation left as an exercise for the reader)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1483892305, "post_id": 41532132, "comment_id": 70274750, "body": "&quot;In all the tutorials there is class Monad m defined, and then it&#39;s never used&quot; -- You are mixing up the definition of a class (e.g. <code>Monad</code>) with the definition of instances of that class (e.g. <code>[]</code>, <code>Maybe</code>, etc.)."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1484942382, "last_edit_date": 1484942382, "creation_date": 1483913239, "answer_id": 41538423, "question_id": 41532132, "link": "https://stackoverflow.com/questions/41532132/properly-defining-a-monad-class/41538423#41538423", "title": "Properly defining a monad class", "body": "<p>There are a few potential pitfalls here, most of which are covered in the comments:</p>\n\n<ul>\n<li>There is no <code>mzero</code> defined for <code>Monad</code> instances, and you'll get an error if you try to specify one.  <code>mzero</code> would be defined in the <code>MonadPlus</code> instance, if any.</li>\n<li>Trying to redefine the monad instance for built-in lists won't work.  You need to define your own <code>List</code> type if you want to play with this.</li>\n<li>In \"modern\" Haskell (since GHC 7.10), the implementation of the <a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"nofollow noreferrer\">Applicative => Monad Proposal</a> has obsoleted a lot of old Monad tutorials and made user-defined Monads a little more difficult to write because you also need to define <code>Functor</code> and <code>Applicative</code> instances (<a href=\"https://ghc.haskell.org/trac/ghc/wiki/Migration/7.10#base-4.8.0.0\" rel=\"nofollow noreferrer\">detailed migration instructions</a>).</li>\n</ul>\n\n<p>So, here is a translation of your list example to use a user-defined <code>List</code> type with GHC 7.10-compatible boilerplate.  Note that the definition for <code>return</code> gets moved into the <code>Applicative</code> instance's <code>pure</code> instead. </p>\n\n<pre><code>module MyListMonad where\n\nimport Control.Monad\n\ndata List a = Empty | Cons a (List a) deriving (Show, Eq)\n\ninstance Functor List where\n  fmap = liftM                      -- boilerplate\ninstance Applicative List where\n  pure x = Cons x Empty             -- put definition of `return` here\n  (&lt;*&gt;) = ap \ninstance Monad List where\n  return = pure                     -- boilerplate\n  (&gt;&gt;) = (*&gt;)                       -- boilerplate\n  xs &gt;&gt;= f = myConcat (myMap f xs)  -- bind definition here\n\nmyConcat :: List (List a) -&gt; List a\nmyConcat (Cons lst rest) = myAppend lst (myConcat rest)\nmyConcat Empty = Empty\n\nmyAppend :: List a -&gt; List a -&gt; List a\nmyAppend (Cons x rest) ys = Cons x (myAppend rest ys)\nmyAppend Empty ys = ys\n\nmyMap :: (a -&gt; b) -&gt; List a -&gt; List b\nmyMap f (Cons x rest) = Cons (f x) (myMap f rest)\nmyMap _ Empty = Empty\n\ntest = do x &lt;- Cons 1 $ Cons 2 $ Cons 3 Empty\n          y &lt;- Cons 4 $ Cons 5 $ Empty\n          return (x * y)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3292534"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 1, "accepted_answer_id": 41538423, "answer_count": 1, "score": 0, "last_activity_date": 1484942382, "creation_date": 1483874369, "last_edit_date": 1483883563, "question_id": 41532132, "link": "https://stackoverflow.com/questions/41532132/properly-defining-a-monad-class", "title": "Properly defining a monad class", "body": "<p>How do I make following declaration of a list monad compilable?</p>\n\n<pre><code>module Main where\n\ninstance Monad m where\n  -- \"return\" constructs a one-item list.\n  return x = [x]\n  -- \"bind\" concatenates the lists obtained by applying f to each item in list xs.\n  xs &gt;&gt;= f = concat (map f xs)\n  -- The zero object is an empty list.\n  mzero = []\n</code></pre>\n\n<p>Currently I get the following error:</p>\n\n<pre><code>monad_ex1.hs:9:3: \u2018mzero\u2019 is not a (visible) method of class \u2018Monad\u2019\n</code></pre>\n\n<p>My code is from <a href=\"https://en.wikipedia.org/wiki/Monad_(functional_programming)#Collections\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Monad_(functional_programming)#Collections</a> , goal is to run create compilable code from that, import it in ghci and play around with it.</p>\n\n<p>Removing mzero from the code leads to another cryptic message:</p>\n\n<pre><code>Illegal instance declaration for \u2018Monad m\u2019\n      (All instance types must be of the form (T a1 ... an)\n       where a1 ... an are *distinct type variables*,\n       and each type variable appears at most once in the instance head.\n       Use FlexibleInstances if you want to disable this.)\n    In the instance declaration for \u2018Monad m\u2019\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "yesod", "haskell-stack"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1483877920, "post_id": 41531416, "comment_id": 70270210, "body": "Can you try one of this workaround: <a href=\"https://docs.haskellstack.org/en/stable/faq/#why-is-dyld_library_path-ignored\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/faq/&hellip;</a> ?"}, {"owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "edited": false, "score": 1, "creation_date": 1486920157, "post_id": 41531416, "comment_id": 71543261, "body": "Are you on macOS Sierra? In that case you need to use GHC 8.2, which fixes the panic issue. You should more or less be able to set your stack LTS to the just arrived 8.0, and upgrade with no to minor changes."}], "answers": [{"tags": [], "owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "is_accepted": true, "score": 0, "last_activity_date": 1494227417, "last_edit_date": 1494227417, "creation_date": 1488331466, "answer_id": 42521624, "question_id": 41531416, "link": "https://stackoverflow.com/questions/41531416/how-to-build-stack-yesod/42521624#42521624", "title": "How to build Stack Yesod?", "body": "<p><a href=\"https://github.com/commercialhaskell/stack/issues/2577#issuecomment-256135836\" rel=\"nofollow noreferrer\">GHC 8.0.2 fixes the panic issue</a>. By changing LTS to 8.0, the upgrade resolves all issues.</p>\n"}], "owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 42521624, "answer_count": 1, "score": 0, "last_activity_date": 1494227417, "creation_date": 1483869132, "last_edit_date": 1483880879, "question_id": 41531416, "link": "https://stackoverflow.com/questions/41531416/how-to-build-stack-yesod", "title": "How to build Stack Yesod?", "body": "<p>I've been trying to use stack to start a yesod-simple project, but nothing I do will build this project. I've looked into other similar stackoverflow questions but couldn't get this to work. Can some one help me figure out what I need to do to get started?</p>\n\n<h2>Error</h2>\n\n<pre><code>&gt; stack build\n\nPopulated index cache.\nyesod-persistent-1.4.0.6: configure\nyesod-persistent-1.4.0.6: build\nyesod-persistent-1.4.0.6: copy/register\nyesod-form-1.4.9: configure\nyesod-form-1.4.9: build\nyesod-form-1.4.9: copy/register\nyesod-auth-1.4.15: configure\nyesod-auth-1.4.15: build\nProgress: 3/6\n--  While building package yesod-auth-1.4.15 using:\n  /Users/scottyluciano/.stack/setup-exe-cache/x86_64-osx/setup-Simple-Cabal-1.22.5.0-ghc-7.10.3 --builddir=.stack-work/dist/x86_64-osx/Cabal-1.22.5.0 build --ghc-options \" -ddump-hi -ddump-to-file\"\nProcess exited with code: ExitFailure 1\nLogs have been written to: /Users/scottyluciano/Documents/tutorials/practice/.stack-work/logs/yesod-auth-1.4.15.log\n\nConfiguring yesod-auth-1.4.15...\nBuilding yesod-auth-1.4.15...\nPreprocessing library yesod-auth-1.4.15...\n[ 1 of 12] Compiling Yesod.PasswordStore ( Yesod/PasswordStore.hs, .stack-work/dist/x86_64-osx/Cabal-1.22.5.0/build/Yesod/PasswordStore.o )\n\n/private/var/folders/kl/yp2gqzf116131b5gvs9pzttw0000gn/T/stack64861/yesod-auth-1.4.15/Yesod/PasswordStore.hs:166:31: Warning:\n    Defaulting the following constraint(s) to type \u2018Integer\u2019\n      (Integral b0)\n        arising from a use of \u2018^\u2019 at Yesod/PasswordStore.hs:166:31\n      (Num b0)\n        arising from the literal \u201832\u2019 at Yesod/PasswordStore.hs:166:32-33\n    In the first argument of \u2018(-)\u2019, namely \u20182 ^ 32\u2019\n    In the first argument of \u2018(*)\u2019, namely \u2018(2 ^ 32 - 1)\u2019\n    In the second argument of \u2018(&gt;)\u2019, namely \u2018(2 ^ 32 - 1) * hLen\u2019\n\n/private/var/folders/kl/yp2gqzf116131b5gvs9pzttw0000gn/T/stack64861/yesod-auth-1.4.15/Yesod/PasswordStore.hs:419:1: Warning:\n    Defined but not used: \u2018toStrict\u2019\n\n/private/var/folders/kl/yp2gqzf116131b5gvs9pzttw0000gn/T/stack64861/yesod-auth-1.4.15/Yesod/PasswordStore.hs:422:1: Warning:\n    Defined but not used: \u2018fromStrict\u2019\n[ 2 of 12] Compiling Yesod.Auth.Message ( Yesod/Auth/Message.hs, .stack-work/dist/x86_64-osx/Cabal-1.22.5.0/build/Yesod/Auth/Message.o )\n\n/private/var/folders/kl/yp2gqzf116131b5gvs9pzttw0000gn/T/stack64861/yesod-auth-1.4.15/Yesod/Auth/Message.hs:24:1: Warning:\n    The import of \u2018mappend\u2019 from module \u2018Data.Monoid\u2019 is redundant\n\n/private/var/folders/kl/yp2gqzf116131b5gvs9pzttw0000gn/T/stack64861/yesod-auth-1.4.15/Yesod/Auth/Message.hs:460:1: Warning:\n    Pattern match(es) are overlapped\n    In an equation for \u2018finnishMessage\u2019: finnishMessage Password = ...\n\n/private/var/folders/kl/yp2gqzf116131b5gvs9pzttw0000gn/T/stack64861/yesod-auth-1.4.15/Yesod/Auth/Message.hs:460:1: Warning:\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018finnishMessage\u2019:\n        Patterns not matched: CurrentPassword\n[ 3 of 12] Compiling Yesod.Auth.Routes ( Yesod/Auth/Routes.hs, .stack-work/dist/x86_64-osx/Cabal-1.22.5.0/build/Yesod/Auth/Routes.o )\n[ 4 of 12] Compiling Yesod.Auth       ( Yesod/Auth.hs, .stack-work/dist/x86_64-osx/Cabal-1.22.5.0/build/Yesod/Auth.o )\nghc: panic! (the 'impossible' happened)\n  (GHC version 7.10.3 for x86_64-apple-darwin):\n    Loading temp shared object failed: dlopen(/var/folders/kl/yp2gqzf116131b5gvs9pzttw0000gn/T/ghc65133_0/libghc_21.dylib, 5): no suitable image found.  Did find:\n    /var/folders/kl/yp2gqzf116131b5gvs9pzttw0000gn/T/ghc65133_0/libghc_21.dylib: malformed mach-o: load commands size (36784) &gt; 32768\n\nPlease report this as a GHC bug:  http://www.haskell.org/ghc/reportabug\n</code></pre>\n"}, {"tags": ["c", "haskell", "functional-programming", "lazy-evaluation"], "comments": [{"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1483878522, "post_id": 41531163, "comment_id": 70270365, "body": "Well, there is no unique answer to this question since it depends on the implementation.  In ghc the primitive operations have primitive types, i.e., the same types as in C.  You have separate operation for wrapping and unwrapping the primitive types in thunks."}, {"owner": {"reputation": 95, "user_id": 4342337, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X6GXo.png?s=128&g=1", "display_name": "raviqqe", "link": "https://stackoverflow.com/users/4342337/raviqqe"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1483881237, "post_id": 41531163, "comment_id": 70271129, "body": "@augustss How about if and case expressions? Their primitives must be passed thunks directly, I guess. Or, are they curried?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1483889830, "post_id": 41531163, "comment_id": 70273902, "body": "An if expression is translated into a case expression.  And there is no primitive for case, it&#39;s translated into (abstract) machine code that depends on the type.  Simplified, first the scrutinee is evaluated to WHNF, then you extract its constructor number and use that as an offset in a jump table. The code you jump to will unpack the fields of the constructor and proceed with evaluation."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 4342337, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X6GXo.png?s=128&g=1", "display_name": "raviqqe", "link": "https://stackoverflow.com/users/4342337/raviqqe"}, "edited": false, "score": 0, "creation_date": 1483949438, "post_id": 41539571, "comment_id": 70291606, "body": "Are both creation and evaluation of thunks allowed in primitive functions?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 95, "user_id": 4342337, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X6GXo.png?s=128&g=1", "display_name": "raviqqe", "link": "https://stackoverflow.com/users/4342337/raviqqe"}, "edited": false, "score": 0, "creation_date": 1484004347, "post_id": 41539571, "comment_id": 70322585, "body": "Primitives <i>can</i> evaluate thunks, but few do.  For example, <code>newArray#</code> can take a thunk (as the initial value for the array elements), but it doesn&#39;t evaluate it -- it just populates the array with pointers to the thunk.  I guess <code>raise#</code> is an example of a primitive that accepts (and evaluates) a thunk.  Since evaluating a thunk can create new thunks, this means <code>raise#</code> is capable of <i>implicitly</i> creating thunks, too.  I don&#39;t know of a primitive that explicitly creates a thunk, but I don&#39;t see why one can&#39;t, since primitives can create heap objects, and a thunk is just another heap object."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 95, "user_id": 4342337, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X6GXo.png?s=128&g=1", "display_name": "raviqqe", "link": "https://stackoverflow.com/users/4342337/raviqqe"}, "edited": false, "score": 0, "creation_date": 1484026445, "post_id": 41539571, "comment_id": 70328120, "body": "@raviqqe, one primop that can create a thunk is <code>tryTakeMVar# :: MVar# s a -&gt; State# s -&gt; (#State# s, Int#, a#)</code>. If the <code>MVar</code> is empty, it returns with an undefined value (a thunk that will produce an error if forced). The same goes for <code>tryReadMVar#</code>. It&#39;s not documented, but it looks like the same holds for <code>deRefWeak#</code> if someone tries to dereference a weak pointer whose key has been collected."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1483923840, "last_edit_date": 1483923840, "creation_date": 1483923138, "answer_id": 41539571, "question_id": 41531163, "link": "https://stackoverflow.com/questions/41531163/type-of-primitive-functions-in-lazy-evaluation/41539571#41539571", "title": "Type of primitive functions in lazy evaluation", "body": "<p>In GHC, a Haskell primitive function (sometimes called a PrimOp) is\ncalled with a mixture of pointers (to \"heap objects\") and unboxed\ntypes (including C-style ints, doubles, etc).  The Haskell type system\nensures that PrimOps always get the number, order, and types of the\npointers and unboxed values that they are expecting.  It's important\nto note, though, that where a primitive is expecting a pointer to a specific type of heap object, say a <code>String</code>,\nit is expecting a pointer to a heap object that may <em>either</em> be a list\nconstructor (since a Haskell <code>String</code> is a list of characters) <strong>or</strong> a thunk\nthat can be evaluated to a list constructor.</p>\n\n<p>So, the \"strict\" type of a Haskell PrimOp doesn't differentiate\nbetween thunks and non-thunks.  If there was a primitive function to\nget a list's length, for example (there isn't), it would likely have type, using your notation, of:</p>\n\n<pre><code>primitiveLength : (list_object) -&gt; unboxed_int\n</code></pre>\n\n<p>where the <code>list_object</code> would be a pointer to <strong>either</strong> a list\nconstructor <strong>or</strong> a thunk that can yield a list constructor.</p>\n\n<p>This is really the only sensible approach.  A PrimOp can't control whether its argument is still a thunk or has been partially (or fully!) evaluated by some previous computation, so it has to be ready to accept either.</p>\n\n<p>Similarly, if a Haskell PrimOp <em>returns</em> a heap object, that object could technically either be a thunk or non-thunk, and the choice would have no effect on the primitive's \"strict\" type signature.</p>\n\n<p>In practice, it's not very useful for a PrimOp to return a thunk.  In a lazy language, the fact that the primitive is being called implies that its return value is needed.  If it returns a thunk, that thunk will need to be evaluated right away, so why return a thunk?</p>\n\n<p>(Edited to add:)  By the way, there's nothing really specific to PrimOps above: user-defined Haskell functions are also called with a mixture of pointers and unboxed types, too (and they never return thunks).</p>\n"}], "owner": {"reputation": 95, "user_id": 4342337, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X6GXo.png?s=128&g=1", "display_name": "raviqqe", "link": "https://stackoverflow.com/users/4342337/raviqqe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 41539571, "answer_count": 1, "score": 0, "last_activity_date": 1483923840, "creation_date": 1483867026, "question_id": 41531163, "link": "https://stackoverflow.com/questions/41531163/type-of-primitive-functions-in-lazy-evaluation", "title": "Type of primitive functions in lazy evaluation", "body": "<p>I want to know what the exact type of primitive functions in lazy functional programming languages like Haskell is.</p>\n\n<p>Let's say thunks are evaluated to objects of weak head normal form. Then, what should be the type of primitive functions in strict languages like C?</p>\n\n<p>My guesses are:</p>\n\n<pre><code>primitive1 : (thunk, thunk, ...) -&gt; thunk\nprimitive2 : (thunk, thunk, ...) -&gt; object\n</code></pre>\n\n<p>I think primitive functions should be passed thunks as arguments because they may not need some of them. But, I don't know if they should return a thunk or evaluated object while the later one must be wrapped with some function like the below to make it lazy.</p>\n\n<pre><code>lazy : ((thunk, thunk, ...) -&gt; object) -&gt; ((thunk, thunk, ...) -&gt; thunk)\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "owner": {"reputation": 11, "user_id": 4736782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1034365462f9424c887ea49c1cd7639?s=128&d=identicon&r=PG&f=1", "display_name": "Nathan Merkley", "link": "https://stackoverflow.com/users/4736782/nathan-merkley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1483851968, "creation_date": 1483851968, "last_edit_date": 1495539964, "question_id": 41529670, "link": "https://stackoverflow.com/questions/41529670/creating-a-foreign-library-in-haskell", "title": "Creating a Foreign Library in Haskell", "body": "<p>I've spent about a day now all over the documentation and Google, and can't seem to figure out a reasonable way to do dynamic foreign libraries in Haskell.</p>\n\n<p>It's fairly easy to write a static library that gets compiled into a C or C++ program. However, creating a dynamic library using, from what I gather, the normal way (ghc -dynamic -shared -fPIC) causes runtime errors when calling hs_init (undefined symbols in libHSghc-prim). If I manually link libHSrts with the -l flag, everything works as intended. But doing it this way would require me to distribute all of the base Base Haskell libraries with my program. I also found <a href=\"https://stackoverflow.com/questions/27815467/haskell-dynamic-library\">this</a>, which implies I could recompile GHC and then statically link everything to resolve my linker issues, but I would like to avoid needing a custom build of GHC if possible.</p>\n\n<p>What am I doing wrong? Executables can be easily built without needing to distribute the entire runtime, so it's odd to me that I'm having so much trouble doing the same but as a library</p>\n"}, {"tags": ["haskell", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1483850287, "post_id": 41528805, "comment_id": 70264696, "body": "Probably also worth noting that adding the <code>-Wall</code> flag would have pointed out the shadowing, giving a strong clue what was wrong."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1483859451, "post_id": 41528805, "comment_id": 70266105, "body": "Indeed, the whole <code>let</code> is redundant, along with the surrounding <code>do</code>. All it needs is <code>else readData (addPoint l entered)</code>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1483899048, "last_edit_date": 1495540427, "creation_date": 1483842061, "answer_id": 41528805, "question_id": 41528595, "link": "https://stackoverflow.com/questions/41528595/haskell-exception-loop-on-recursive-data-entry/41528805#41528805", "title": "Haskell: Exception &lt;&lt;loop&gt;&gt; on recursive data entry", "body": "<p><code>&lt;&lt;loop&gt;&gt;</code> basically means GHC has detected an infinite loop caused by a value which depends immediately on itself (cf. <a href=\"https://stackoverflow.com/q/21505192/2751851\">this question</a>, or <a href=\"https://stackoverflow.com/q/41517506/2751851\">this one</a> for further technical details if you are curious). In this case, that is triggered by:</p>\n\n<pre><code>else do let l = addPoint l entered\n</code></pre>\n\n<p>This definition, which shadows the <code>l</code> you passed as an argument, defines <code>l</code> in terms of itself. You meant to write something like...</p>\n\n<pre><code>else do let l' = addPoint l entered\n</code></pre>\n\n<p>... which defines a new value, <code>l'</code>, in terms of the original <code>l</code>.</p>\n\n<p>As Carl points out, turning on <code>-Wall</code> (e.g. by passing it to GHC at the command line, or with <code>:set -Wall</code> in GHCi) would make GHC warn you about the shadowing:</p>\n\n<pre><code>&lt;interactive&gt;:171:33: warning: [-Wname-shadowing]\n    This binding for \u2018l\u2019 shadows the existing binding\n      bound at &lt;interactive&gt;:167:10\n</code></pre>\n\n<p>Also, as hightlighted by dfeuer, the whole do-block in the <code>else</code> branch can be replaced by:</p>\n\n<pre><code>readData (addPoint l entered)\n</code></pre>\n\n<hr>\n\n<p>As an unrelated suggestion, in this case it is a good idea to replace your uses of <code>length</code> and <code>(!!)</code> with pattern matching. For instance, <code>checkInputData</code> can be written as:</p>\n\n<pre><code>checkInputData :: [String] -&gt; [String]\ncheckInputData xs = case xs of\n    [_,_] -&gt; xs ++ [\"0\"]\n    [_,_,_] -&gt; xs\n    _ -&gt; [\"0\",\"0\",\"0\"]\n</code></pre>\n\n<p><code>addPoint</code>, in its turn, might become:</p>\n\n<pre><code>addPoint :: (Num a, Read a) =&gt; [Point a] -&gt; String -&gt; [Point a]\naddPoint l s = l ++ [Point x y z]\n    where [x,y,z] = (map read $ checkInputData . splitOn \",\" $ s) :: (Read a) =&gt; [a]\n</code></pre>\n\n<p>That becomes even neater if you change <code>checkInputData</code> so that it returns a <code>(String, String, String)</code> triple, which would better express the invariant that you are reading exactly three values.</p>\n"}], "owner": {"reputation": 31, "user_id": 6302448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17c85c4b4028b974d2a142330033a371?s=128&d=identicon&r=PG&f=1", "display_name": "Rigel", "link": "https://stackoverflow.com/users/6302448/rigel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 41528805, "answer_count": 1, "score": 0, "last_activity_date": 1483899048, "creation_date": 1483839790, "last_edit_date": 1483840091, "question_id": 41528595, "link": "https://stackoverflow.com/questions/41528595/haskell-exception-loop-on-recursive-data-entry", "title": "Haskell: Exception &lt;&lt;loop&gt;&gt; on recursive data entry", "body": "<p>So I'm trying to make a little program that can take in data captured during an experiment, and for the most part I think I've figured out how to recursively take in data until the user signals there is no more, however upon termination of data taking haskell throws <code>Exception: &lt;&lt;loop&gt;&gt;</code> and I can't really figure out why. Here's the code:</p>\n\n<pre><code>readData :: (Num a, Read a) =&gt; [Point a] -&gt; IO [Point a]\nreadData l = do putStr \"Enter Point (x,y,&lt;e&gt;) or (d)one: \"\n                entered &lt;- getLine\n                if (entered == \"d\" || entered == \"done\")\n                    then return l\n                    else do let l = addPoint l entered\n                            nl &lt;- readData l\n                            return nl\n\naddPoint :: (Num a, Read a) =&gt; [Point a] -&gt; String -&gt; [Point a]\naddPoint l s = l ++ [Point (dataList !! 0) (dataList !! 1) (dataList !! 2)]\n    where dataList = (map read $ checkInputData . splitOn \",\" $ s) :: (Read a) =&gt; [a]\n\ncheckInputData :: [String] -&gt; [String]\ncheckInputData xs\n    | length xs &lt; 2 = [\"0\",\"0\",\"0\"]\n    | length xs &lt; 3 = (xs ++ [\"0\"])\n    | length xs == 3 = xs\n    | length xs &gt; 3 = [\"0\",\"0\",\"0\"]\n</code></pre>\n\n<p>As far as I can tell, the exception is indication that there is an infinite loop somewhere, but I can't figure out why this is occurring. As far as I can tell when \"done\" is entered the current level should simply return l, the list it's given, which should then cascade up the previous iterations of the function.</p>\n\n<p>Thanks for any help. (And yes, checkInputData will have proper error handling once I figure out how to do that.)</p>\n"}, {"tags": ["haskell", "ghc", "ffi"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1483838509, "post_id": 41528208, "comment_id": 70262832, "body": "If you look at the generated Cmm there&#39;s none of the <code>suspendThread</code>/<code>resumeThread</code> stuff you&#39;d see around a safe call. I don&#39;t know why it shows <code>__pkg_ccall_GC</code> in Core, maybe just a display bug."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1483839772, "post_id": 41528208, "comment_id": 70263056, "body": "@ReidBarton Thanks once again :) Do you think I should file a little bug?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 3, "creation_date": 1483840243, "post_id": 41528208, "comment_id": 70263139, "body": "Aren&#39;t those <code>movq</code> to get the arguments into the right registers before the tail call?  They don&#39;t look redundant to me."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1483840853, "post_id": 41528208, "comment_id": 70263247, "body": "Probably worth filing a bug yes--it looks like <code>prim</code> imports are marked <code>PlaySafe</code> by the parser, which is presumably mostly ignored, and definitely ignored during code generation. But wherever it&#39;s not ignored there could be a bug."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1483840915, "post_id": 41528208, "comment_id": 70263258, "body": "@augustss yeah they are, but wouldn&#39;t we want the register allocation algorithm to do away with a lot of that? e.g. I could &quot;optimize&quot; this by simply changing which registers I&#39;m using for what in <code>sipRound_s_x2</code>; those moves are shuffling around <code>rsi</code>, <code>r14</code> and <code>rdi</code>. But I&#39;m speaking out of ignorance, as I have very little experience with this stuff. It&#39;s just that at a high level the algorithm I&#39;m working with can be implemented quite naturally without these moves"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1483841076, "post_id": 41528208, "comment_id": 70263278, "body": "But then I suppose <code>sipRound_s_x2</code> is a black box to GHC, so perhaps that&#39;s the issue? Or perhaps the register allocation tries its best to &quot;work backward&quot; from that call, but can&#39;t always get things to line up?"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1483878149, "post_id": 41528208, "comment_id": 70270278, "body": "You&#39;d have to do global register allocation to avoid argument shuffling.  I don&#39;t think ghc does that. Have you tried the llvm code generator?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1483899982, "post_id": 41528208, "comment_id": 70277592, "body": "Yeah, I&#39;m struggling to compare them though"}], "answers": [{"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 3, "last_activity_date": 1483900194, "creation_date": 1483900194, "answer_id": 41536266, "question_id": 41528208, "link": "https://stackoverflow.com/questions/41528208/why-is-there-no-foreign-import-prim-unsafe/41536266#41536266", "title": "Why is there no &#39;foreign import prim unsafe&#39;?", "body": "<p>As Reid Barton points out the <code>__pkg_ccall_GC</code> doesn't indicate anything. The code generated doesn't do the bookkeeping you would see in a <code>safe</code> FFI call.</p>\n"}], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 41536266, "answer_count": 1, "score": 10, "last_activity_date": 1483900194, "creation_date": 1483835753, "last_edit_date": 1495541840, "question_id": 41528208, "link": "https://stackoverflow.com/questions/41528208/why-is-there-no-foreign-import-prim-unsafe", "title": "Why is there no &#39;foreign import prim unsafe&#39;?", "body": "<p>This is a followup to my earlier question <a href=\"https://stackoverflow.com/questions/41213378/using-foreign-import-prim-with-a-c-function-using-stg-calling-convention\">here</a>. I've been able to get something working per <a href=\"https://stackoverflow.com/a/41214165/176841\">Reid Barton's answer</a>, but I notice in the core I see <code>__pkg_ccall_GC</code>:</p>\n\n<pre><code>              case {__pkg_ccall_GC hashabler-2.0.0 sipRound_s_x2 Word#\n                                          -&gt; Word#\n                                          -&gt; Word#\n                                          -&gt; Word#\n                                          -&gt; (# Word#, Word#, Word#, Word# #)}\n                     ww1 ww2 ww3 (xor# ww4 b1)\n</code></pre>\n\n<p>Which is I think what you'd expect for a \"safe\" ffi call. Yet adding \"unsafe\" to the foreign import string is not allowed (though the error messages doesn't say why):</p>\n\n<pre><code>src/Data/Hashabler/SipHash.hs:60:1: error:\n    \u2022 The safe/unsafe annotation should not be used with `foreign import prim'.\n    \u2022 When checking declaration:\n        foreign import prim unsafe \"static sipRound_s_x4\" sipRound_s_x4#\n          :: Word#\n             -&gt; Word# -&gt; Word# -&gt; Word# -&gt; (# Word#, Word#, Word#, Word# #)\n</code></pre>\n\n<p>My foreign procedure is just a little but of bit-twiddling, so I don't think I want whatever the <code>_GC</code> is giving me. Some relevant bits of GHC source I've looked at, FWIW and background:</p>\n\n<p>compiler/prelude/ForeignCall.hs: only \"Risky\" omits the \"_GC\"</p>\n\n<pre><code>data Safety\n  = PlaySafe            -- Might invoke Haskell GC, or do a call back, or\n                        -- switch threads, etc.  So make sure things are\n                        -- tidy before the call. Additionally, in the threaded\n                        -- RTS we arrange for the external call to be executed\n                        -- by a separate OS thread, i.e., _concurrently_ to the\n                        -- execution of other Haskell threads.\n\n  | PlayInterruptible   -- Like PlaySafe, but additionally\n                        -- the worker thread running this foreign call may\n                        -- be unceremoniously killed, so it must be scheduled\n                        -- on an unbound thread.\n\n  | PlayRisky           -- None of the above can happen; the call will return\n                        -- without interacting with the runtime system at all\n  deriving ( Eq, Show, Data )\n        -- Show used just for Show Lex.Token, I think\n</code></pre>\n\n<p>I also see some <code>foreign import prim unsafe</code> and <code>... safe</code> in the GHC tree, though I suppose it's dead code. e.g. <code>testsuite/tests/printer/Ppr046.hs</code>.</p>\n\n<p>So my questions are:</p>\n\n<ol>\n<li>What is the difference between code generated from a <code>__pkg_ccall_GC</code> vs a <code>__pkg_ccall</code> in this case (where I'm doing <code>foreign import prim</code> not <code>ccall</code>)? Is it the same as described <a href=\"https://wiki.haskell.org/Foreign_Function_Interface#Unsafe_calls\" rel=\"nofollow noreferrer\">here</a>?</li>\n<li>Why doesn't a <code>foreign import prim unsafe</code> seem to be supported?</li>\n<li>Assuming I understand (1): Is there anyway I can work around this, getting both efficient return of multiple values and avoiding whatever bookkeeping is happening in (1)?</li>\n</ol>\n\n<hr>\n\n<p><strong>EDIT</strong>: Looking at the assembly from <code>-ddump-asm</code> makes it clear nothing much is happening (shouldn't have been scared to look at the assembly), support Reid Barton's comment below:</p>\n\n<pre><code>movq %rdi,%rax\nmovq %r8,%rdi \nxorq %r9,%rdi\nmovq %rsi,%rcx\nmovq %rax,%rsi\nmovq %r14,%rax\nmovq %rcx,%r14\nmovq %rbx,%rcx\nmovq %rax,%rbx\nmovq %r9,-8(%rbp)\nmovq %rcx,(%rbp)\naddq $-16,%rbp\njmp sipRound_s_x2\n</code></pre>\n\n<p>The <code>xorq</code> towards the top corresponds to a haskell <code>xor</code>. All those <code>movq</code> do seem to be a bummer though...</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 3, "creation_date": 1483832837, "post_id": 41527761, "comment_id": 70261665, "body": "That\u2019s pretty much what <code>catchError</code> is for."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7361363"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1483877690, "post_id": 41527761, "comment_id": 70270152, "body": "Thanks you very much!"}], "owner": {"user_type": "does_not_exist", "display_name": "user7361363"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1483996563, "creation_date": 1483831925, "last_edit_date": 1483996563, "question_id": 41527761, "link": "https://stackoverflow.com/questions/41527761/checking-if-throwerror-happened", "title": "Checking if throwError happened", "body": "<p><code>(StateT Env (ErrorT String IO)) ()</code> is my stack of monads. I use <code>throwError</code> function to abort computation and propagate information about error. I am aware of the fact that it is sense of <code>ErrorT</code> monad - abort and propagate error.</p>\n\n<p>However, the question is: is it possible to check if error was thrown?</p>\n\n<p>I mean:</p>\n\n<pre><code>res &lt;- computeSomething -- it may throw error\ncase (error was thrown) of\n      True -&gt; do something\n      False -&gt; do something else\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1483831170, "post_id": 41527552, "comment_id": 70261323, "body": "What&#39;s with the quantification of <code>u</code>?  That&#39;s not typically useful."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1483835045, "post_id": 41527552, "comment_id": 70262155, "body": "The only bottom-free values of type <code>forall u. Either u x</code> are of the form <code>Right something</code>. In the other direction, <code>ZeroF</code> should be defined to evaluate to <code>NatF $ Left undefined</code>. (Why are you using that?)"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1483863729, "post_id": 41527552, "comment_id": 70266930, "body": "I wanted to express the algebra F X =  1 + X but obviously that&#39;s Either () x.."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 4, "last_activity_date": 1483914945, "last_edit_date": 1483914945, "creation_date": 1483836717, "answer_id": 41528309, "question_id": 41527552, "link": "https://stackoverflow.com/questions/41527552/pattern-synonym-directionality/41528309#41528309", "title": "Pattern synonym directionality", "body": "<p>You're having trouble because you've set up your assumptions wrong. <code>forall u. Either u x</code> is not isomorphic to your <code>PeanoF x</code>. The latter is isomorphic to <code>Either () x</code> (or just <code>Maybe x</code>); the former is isomorphic to <code>x</code>.</p>\n\n<pre><code>newtype NatF x = NatF (Maybe x)\npattern ZeroF = NatF Nothing\npattern SuccF n = NatF (Just n)\n</code></pre>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 41528309, "answer_count": 1, "score": 0, "last_activity_date": 1483914945, "creation_date": 1483830236, "question_id": 41527552, "link": "https://stackoverflow.com/questions/41527552/pattern-synonym-directionality", "title": "Pattern synonym directionality", "body": "<p>The two types are isomorphic, but there is a slight restriction to only <strong>unidirectional</strong> type synonym for <code>ZeroF</code> for which I am not sure there is a way out of.</p>\n\n<pre><code>data NatF x  = NatF { unNatF :: (forall u. Either u x) }\npattern ZeroF  &lt;- NatF (Left _)\npattern SuccF n = NatF (Right n)\n\ndata PeanoF x =  ZeroFP | SuccFP x  -- isomorphe\n</code></pre>\n\n<p>Am I doing something wrong (beside the contrived example.. ) ?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1483831858, "post_id": 41527504, "comment_id": 70261459, "body": "Try <code>--allow-newer</code>."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1483832139, "post_id": 41527504, "comment_id": 70261517, "body": "Oh, apparently that&#39;s not a CLI option. <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#allow-newer\" rel=\"nofollow noreferrer\">You can set it in the stack.yaml though.</a>"}], "answers": [{"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1484435599, "post_id": 41528029, "comment_id": 70510774, "body": "Thanks for the tips. if I set the resolver to ghc-8.1.20170103, a solver attempt finds no plans as it complains about all the libraries which specify this upper bound on base. so frustrating."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1484435767, "post_id": 41528029, "comment_id": 70510827, "body": "oh ok, the solver ignores the &#39;allow-newer&#39; flag set in stack.yaml. just attempting to build and add as required packages what comes out leads to some compilation."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1483834524, "last_edit_date": 1483834524, "creation_date": 1483834188, "answer_id": 41528029, "question_id": 41527504, "link": "https://stackoverflow.com/questions/41527504/how-do-i-override-upper-bounds-in-a-haskell-project/41528029#41528029", "title": "how do I override upper-bounds in a haskell project?", "body": "<p>Your main problem is that the <code>nightly-2016-12-31</code> snapshot <a href=\"https://www.stackage.org/nightly-2016-12-31\" rel=\"nofollow noreferrer\">uses GHC 8.0.1 and <em>base</em> 4.9.0.0</a>, and so it is incompatible with your installation of GHC 8.1. It should be enough to <a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#other-resolver-values\" rel=\"nofollow noreferrer\">set the resolver to <code>ghc-8.1.20170103</code></a>, so that no snapshots are used. (There is also a <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#system-ghc\" rel=\"nofollow noreferrer\"><code>system-ghc</code></a> option; however, given that Stack is already using the correct compiler I guess it won't be necessary to turn that on.) If you need packages not bundled with GHC, you will have to add them to the <code>extra-deps</code> in <code>stack.yaml</code> (if you already have a .cabal file specifying your dependencies, <code>stack solver --update-config</code> can be used to fill that in automatically).</p>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 41528029, "answer_count": 1, "score": 3, "last_activity_date": 1483834524, "creation_date": 1483829854, "last_edit_date": 1483830110, "question_id": 41527504, "link": "https://stackoverflow.com/questions/41527504/how-do-i-override-upper-bounds-in-a-haskell-project", "title": "how do I override upper-bounds in a haskell project?", "body": "<p>I would like to use kind equality, which seems only present in GHC head for now.</p>\n\n<p>I made a system-install of GHC, and in my project I added a <code>snapshot.yaml</code></p>\n\n<pre><code>resolver: nightly-2016-12-31\ncompiler: ghc-8.1.20170103\n</code></pre>\n\n<p>and updated <code>stack.yaml</code> accordingly</p>\n\n<pre><code>resolver:\n  name: snapshot\n  location: snapshot.yaml\n</code></pre>\n\n<p>I can see using <code>stack path</code> that it picks the correct compiler.</p>\n\n<p>When I build my project I now have </p>\n\n<pre><code>In the dependencies for array-0.5.1.1:\n    base-4.10.0.0 must match &gt;=4.5 &amp;&amp; &lt;4.10 (latest applicable is 4.9.0.0)\nneeded due to bookkeeper-0.2.4 -&gt; array-0.5.1.1\n</code></pre>\n\n<p>How can I override from my project the upper-bound declared by array-0.5.1.1, which is probably not <em>actually</em> required ?</p>\n"}, {"tags": ["haskell", "visual-studio-code"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1483830052, "post_id": 41527489, "comment_id": 70261029, "body": "Based on the looks of syntax and on the non-Haskell examples <a href=\"https://code.visualstudio.com/Docs/editor/tasks\" rel=\"nofollow noreferrer\">in this page</a>, I guess you need to use <code>&quot;args&quot;: [&quot;-o app&quot;, &quot;app.hs&quot;]</code> -- it seems the <code>-o</code> output option and the input file name are being parsed as a single thing."}, {"owner": {"reputation": 327, "user_id": 6229637, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/2Lxry.jpg?s=128&g=1", "display_name": "Xam Eseerts", "link": "https://stackoverflow.com/users/6229637/xam-eseerts"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1483834652, "post_id": 41527489, "comment_id": 70262065, "body": "You had the right idea! It worked with <code>&quot;args&quot;: [&quot;-o&quot;, &quot;app&quot;, &quot;app.hs&quot;]</code>. Thanks!"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1483835931, "post_id": 41527489, "comment_id": 70262332, "body": "Nice. Given that it worked, it should become an answer. (I suggest you post it as a self-answer.)"}], "answers": [{"comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520934683, "post_id": 41533787, "comment_id": 85509271, "body": "Do you know how to have the comments (<code>--</code>). Nothing happens when I type <code>Ctrl + :</code>."}, {"owner": {"reputation": 327, "user_id": 6229637, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/2Lxry.jpg?s=128&g=1", "display_name": "Xam Eseerts", "link": "https://stackoverflow.com/users/6229637/xam-eseerts"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520935839, "post_id": 41533787, "comment_id": 85510025, "body": "Could you explain what you mean in a bit more detail? Do you want to put comments in the tasks.json file?"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1520936313, "post_id": 41533787, "comment_id": 85510347, "body": "No, not in the json file. In the haskell file. I want to select some lines and when I press Ctrl+: I want these lines to be commented."}], "tags": [], "owner": {"reputation": 327, "user_id": 6229637, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/2Lxry.jpg?s=128&g=1", "display_name": "Xam Eseerts", "link": "https://stackoverflow.com/users/6229637/xam-eseerts"}, "is_accepted": true, "score": 3, "last_activity_date": 1483885882, "creation_date": 1483885882, "answer_id": 41533787, "question_id": 41527489, "link": "https://stackoverflow.com/questions/41527489/how-to-setup-a-task-for-compiling-haskell-in-vs-code/41533787#41533787", "title": "How to setup a task for compiling haskell in vs code?", "body": "<p>Thanks to @duplode and with a little playing around I now came up with the following task-setup (see picture below):</p>\n\n<p><a href=\"https://i.stack.imgur.com/rlIBs.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/rlIBs.png\" alt=\"enter image description here\"></a></p>\n\n<p>For answering my question only the first out of the three tasks I defined is of relevance. As you can see the trick was to change <code>\"args: [\"-o app app.hs\"]\"</code> to <code>\"args: [\"-o\", \"app\", \"app.hs\"]\"</code>. Please note however that <code>-o app</code> is not relevant and can be omitted in this case. The <code>-o</code>-flag is for renaming the ghc output files. If you omit this flag ghc will name all of the output files according to the input filename. So in my case the input file app.hs leads to the output files app.exe, app.o and app.hi. Only if you want to name your output files different from your input file does it make sense to use the <code>-o</code>-flag.</p>\n\n<p>As for the other two tasks I defined: If someone will ever read this and be interested in it, just comment or send me a message.</p>\n"}], "owner": {"reputation": 327, "user_id": 6229637, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/2Lxry.jpg?s=128&g=1", "display_name": "Xam Eseerts", "link": "https://stackoverflow.com/users/6229637/xam-eseerts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2082, "favorite_count": 0, "accepted_answer_id": 41533787, "answer_count": 1, "score": 3, "last_activity_date": 1483885882, "creation_date": 1483829738, "question_id": 41527489, "link": "https://stackoverflow.com/questions/41527489/how-to-setup-a-task-for-compiling-haskell-in-vs-code", "title": "How to setup a task for compiling haskell in vs code?", "body": "<p>sorry for this really uninformed question but I'm trying out vs code right now and want to configure a task that's compiling the file I am working on. My folder structure and the configured task look like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/aTwkP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/aTwkP.png\" alt=\"enter image description here\"></a></p>\n\n<p>The problem is, that this doesn't compile my app.hs source file but instead gives me the following ghc error: <code>ghc: unrecognised flag: -o app app.hs</code>. I have tested the command <code>ghc -o app app.hs</code> directly from the command prompt and it works just fine. So I think the error has something to do with the way vs code sends what I have written in tasks.json to the command prompt. I can't figure out what to do though. Does anybody have an idea?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 706, "user_id": 225833, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b28406d1fc6c91934c8c22c85f621f1?s=128&d=identicon&r=PG", "display_name": "Dominik", "link": "https://stackoverflow.com/users/225833/dominik"}, "edited": false, "score": 0, "creation_date": 1483827698, "post_id": 41527163, "comment_id": 70260427, "body": "That really was the problem. Thank you!"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 2, "last_activity_date": 1483827181, "creation_date": 1483827181, "answer_id": 41527163, "question_id": 41527072, "link": "https://stackoverflow.com/questions/41527072/haskell-couldnt-match-type-io-with-when-using-parsefileexif/41527163#41527163", "title": "Haskell: Couldn&#39;t match type \u2018IO\u2019 with \u2018[]\u2019 when using parseFileExif", "body": "<p>Your type signature says</p>\n\n<pre><code>getDateStringFromFile :: FilePath -&gt; String\n</code></pre>\n\n<p><code>String</code> is <code>[Char]</code>, which is a list.</p>\n\n<pre><code>getDateStringFromFile filePath = do\n</code></pre>\n\n<p>Therefore here the compiler expects all statements of this <code>do</code> block to have a list type.</p>\n\n<p>Did you mean <code>IO String</code>?</p>\n\n<p>In that case <code>exifToString exifData</code> has the wrong type (no <code>IO</code>), so you'd have to use <code>return</code>:</p>\n\n<pre><code>    return (exifToString exifData)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 706, "user_id": 225833, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b28406d1fc6c91934c8c22c85f621f1?s=128&d=identicon&r=PG", "display_name": "Dominik", "link": "https://stackoverflow.com/users/225833/dominik"}, "edited": false, "score": 0, "creation_date": 1483827719, "post_id": 41527226, "comment_id": 70260442, "body": "This compiles. Thank you for your help!"}], "tags": [], "owner": {"reputation": 3287, "user_id": 341061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f01669013eac8b56559066aab4a0817?s=128&d=identicon&r=PG", "display_name": "Giovanni Cappellotto", "link": "https://stackoverflow.com/users/341061/giovanni-cappellotto"}, "is_accepted": true, "score": 1, "last_activity_date": 1483827602, "creation_date": 1483827602, "answer_id": 41527226, "question_id": 41527072, "link": "https://stackoverflow.com/questions/41527072/haskell-couldnt-match-type-io-with-when-using-parsefileexif/41527226#41527226", "title": "Haskell: Couldn&#39;t match type \u2018IO\u2019 with \u2018[]\u2019 when using parseFileExif", "body": "<p>The issue is that <code>getDateStringFromFile</code> implementation is wrong, it should be something like:</p>\n\n<pre><code>getDateStringFromFile :: FilePath -&gt; IO String\ngetDateStringFromFile filePath = do\n  exifData &lt;- parseFileExif filePath\n  return $ exifToString exifData\n</code></pre>\n\n<p>At that point you could use the new <code>getDateStringFromFile</code> like this:</p>\n\n<pre><code>photoProcess :: [FilePath] -&gt; IO ()\nphotoProcess arguments = do\n  dateStrings &lt;- getDateStringFromFileList arguments\n  putStrLn (\"photoProcess: \" ++ (unwords dateStrings))\n\ngetDateStringFromFileList :: [FilePath] -&gt; IO [String]\ngetDateStringFromFileList = mapM getDateStringFromFile\n</code></pre>\n"}], "owner": {"reputation": 706, "user_id": 225833, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b28406d1fc6c91934c8c22c85f621f1?s=128&d=identicon&r=PG", "display_name": "Dominik", "link": "https://stackoverflow.com/users/225833/dominik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 675, "favorite_count": 0, "accepted_answer_id": 41527226, "answer_count": 2, "score": 0, "last_activity_date": 1483827602, "creation_date": 1483826579, "question_id": 41527072, "link": "https://stackoverflow.com/questions/41527072/haskell-couldnt-match-type-io-with-when-using-parsefileexif", "title": "Haskell: Couldn&#39;t match type \u2018IO\u2019 with \u2018[]\u2019 when using parseFileExif", "body": "<p>Playing around with Haskell I'm trying to build a script that takes paths to image files and outputs the EXIF creation date of these files. The <code>photoProcess</code> function of the following module is called from the executable:</p>\n\n<pre><code>module Lib\n    ( photoProcess\n    ) where\n\nimport Graphics.HsExif\nimport Data.Time.Format\nimport Data.Time.LocalTime\nimport Data.Map\n\nphotoProcess :: [FilePath] -&gt; IO ()\nphotoProcess arguments = putStrLn (\"photoProcess: \" ++ (unwords (getDateStringFromFileList arguments)))\n\ngetDateStringFromFileList :: [FilePath] -&gt; [String]\ngetDateStringFromFileList = fmap getDateStringFromFile\n\ngetDateStringFromFile :: FilePath -&gt; String\ngetDateStringFromFile filePath = do\n  exifData &lt;- parseFileExif filePath\n  exifToString exifData\n\nexifToString :: Either String (Map ExifTag ExifValue) -&gt; String\nexifToString (Left message) = message\nexifToString (Right exifMap) = timeToString exifMap\n\ntimeToString :: Map ExifTag ExifValue -&gt; String\ntimeToString exifMap = case getDateTimeOriginal exifMap of\n  Just localTime -&gt; formatTime defaultTimeLocale \"%m/%d/%Y %I:%M %p\" localTime\n  Nothing -&gt; \"Nothing\"\n</code></pre>\n\n<p>I know the script has several errors but I do not know how to find or fix them. <code>stack build</code> says:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018IO\u2019 with \u2018[]\u2019\n  Expected type: [Either String (Map ExifTag ExifValue)]\n    Actual type: IO (Either String (Map ExifTag ExifValue))\n\u2022 In a stmt of a 'do' block: exifData &lt;- parseFileExif filePath\n  In the expression:\n    do { exifData &lt;- parseFileExif filePath;\n         exifToString exifData }\n  In an equation for \u2018getDateStringFromFile\u2019:\n      getDateStringFromFile filePath\n        = do { exifData &lt;- parseFileExif filePath;\n               exifToString exifData }\n</code></pre>\n\n<p>The main problem seems to be</p>\n\n<pre><code>exifData &lt;- parseFileExif filePath\n</code></pre>\n\n<p>Where is the list from the error message coming from? Why expect a list?</p>\n\n<p>Testing the types in GHCI I get:</p>\n\n<pre><code>Prelude Graphics.HsExif&gt; :t parseFileExif path\nparseFileExif path\n  :: IO\n       (Either\n          String (containers-0.5.7.1:Data.Map.Base.Map ExifTag ExifValue))\nPrelude Graphics.HsExif&gt; test &lt;- parseFileExif path\nPrelude Graphics.HsExif&gt; :t test\ntest\n  :: Either\n       String (containers-0.5.7.1:Data.Map.Base.Map ExifTag ExifValue)\n</code></pre>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["haskell", "opengl", "nixos"], "comments": [{"owner": {"reputation": 5215, "user_id": 133235, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/64798a399a79ed8d34fa83ba0e61c1ac?s=128&d=identicon&r=PG", "display_name": "iElectric", "link": "https://stackoverflow.com/users/133235/ielectric"}, "edited": false, "score": 0, "creation_date": 1483882112, "post_id": 41527061, "comment_id": 70271378, "body": "Can you post a repository so I can reproduce?"}, {"owner": {"reputation": 228, "user_id": 7347627, "user_type": "registered", "profile_image": "https://graph.facebook.com/1828143650801314/picture?type=large", "display_name": "samsergey", "link": "https://stackoverflow.com/users/7347627/samsergey"}, "reply_to_user": {"reputation": 5215, "user_id": 133235, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/64798a399a79ed8d34fa83ba0e61c1ac?s=128&d=identicon&r=PG", "display_name": "iElectric", "link": "https://stackoverflow.com/users/133235/ielectric"}, "edited": false, "score": 0, "creation_date": 1483910383, "post_id": 41527061, "comment_id": 70281212, "body": "@iElectric, It could be any Gloss MWE (just display a circle, for example), or something more interesting, like RosettaCode <a href=\"http://rosettacode.org/wiki/Snake\" rel=\"nofollow noreferrer\">snake game</a>."}, {"owner": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "edited": false, "score": 1, "creation_date": 1486725439, "post_id": 41527061, "comment_id": 71481287, "body": "After having read this page carefully, I&#39;m still facing the described problem when using stack/nixos/gloss . I&#39;d highly appreciate if someone could upload a minimal working example to a github repo. This would be really nice."}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "reply_to_user": {"reputation": 5352, "user_id": 4896150, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/74d0c938f3f71d6ee14db4f6b9d222c2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Harald", "link": "https://stackoverflow.com/users/4896150/anton-harald"}, "edited": false, "score": 0, "creation_date": 1538037940, "post_id": 41527061, "comment_id": 92005118, "body": "@AntonHarald, for a repository that doesn&#39;t have those linker errors, have a look at <a href=\"https://github.com/turion/rhine/tree/develop/rhine-gloss\" rel=\"nofollow noreferrer\">github.com/turion/rhine/tree/develop/rhine-gloss</a>. But it has another puzzling error, this time related to GLUT."}], "answers": [{"comments": [{"owner": {"reputation": 1494, "user_id": 1188670, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/HEXZx.png?s=128&g=1", "display_name": "Vektorweg", "link": "https://stackoverflow.com/users/1188670/vektorweg"}, "edited": false, "score": 0, "creation_date": 1484150529, "post_id": 41588628, "comment_id": 70393584, "body": "uh, he&#39;s using cabal, not stack."}, {"owner": {"reputation": 1793, "user_id": 1593359, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/2ifAI.jpg?s=128&g=1", "display_name": "Soham Chowdhury", "link": "https://stackoverflow.com/users/1593359/soham-chowdhury"}, "reply_to_user": {"reputation": 1494, "user_id": 1188670, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/HEXZx.png?s=128&g=1", "display_name": "Vektorweg", "link": "https://stackoverflow.com/users/1188670/vektorweg"}, "edited": false, "score": 0, "creation_date": 1484154323, "post_id": 41588628, "comment_id": 70396041, "body": "@Vektorweg thanks for pointing that out! I&#39;ve modified the instructions; hopefully they&#39;ll work in their case (although I don&#39;t use <code>cabal</code> and can&#39;t be sure)."}, {"owner": {"reputation": 228, "user_id": 7347627, "user_type": "registered", "profile_image": "https://graph.facebook.com/1828143650801314/picture?type=large", "display_name": "samsergey", "link": "https://stackoverflow.com/users/7347627/samsergey"}, "edited": false, "score": 1, "creation_date": 1484170248, "post_id": 41588628, "comment_id": 70404909, "body": "Thanks for your effort to help, @Soham Chowdhury! Alas, I&#39;ve tried all combinations of <code>mesa</code>, <code>mesa+freeglut</code>, <code>mesa_glu+freeglut</code> etc. neither works. I believe, the problem is not with <code>stack</code> or <code>cabal</code>, probably, something is not set properly in my OS environments or configuarions. Does anyone know whether there is something like <code>glxgears</code> to see if OpenGL works at all? I couldn&#39;t find it in NixOs packages list."}, {"owner": {"reputation": 228, "user_id": 7347627, "user_type": "registered", "profile_image": "https://graph.facebook.com/1828143650801314/picture?type=large", "display_name": "samsergey", "link": "https://stackoverflow.com/users/7347627/samsergey"}, "edited": false, "score": 0, "creation_date": 1484209467, "post_id": 41588628, "comment_id": 70418073, "body": "Yeah, the <code>stack</code> really did solve the problem! Farewell, <code>cabal</code>, I will miss you :)"}, {"owner": {"reputation": 1793, "user_id": 1593359, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/2ifAI.jpg?s=128&g=1", "display_name": "Soham Chowdhury", "link": "https://stackoverflow.com/users/1593359/soham-chowdhury"}, "edited": false, "score": 0, "creation_date": 1484209614, "post_id": 41588628, "comment_id": 70418160, "body": "Yeah! <i>small jump of joy</i> I haven&#39;t used Haskell long enough to have known <code>cabal</code> nontrivially, so ... welcome to the dark side? ;)"}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 2, "creation_date": 1512243997, "post_id": 41588628, "comment_id": 82181908, "body": "Any idea why <code>nix-shell -p mesa mesa_glu freeglut</code> doesn&#39;t work?"}, {"owner": {"reputation": 4452, "user_id": 562583, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7d7c259d7212f8278d89e6bc45a9b39c?s=128&d=identicon&r=PG", "display_name": "Turion", "link": "https://stackoverflow.com/users/562583/turion"}, "edited": false, "score": 0, "creation_date": 1538037984, "post_id": 41588628, "comment_id": 92005147, "body": "I think now you have to change those packages to <code>[libGL libGLU freeglut]</code>."}], "tags": [], "owner": {"reputation": 1793, "user_id": 1593359, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/2ifAI.jpg?s=128&g=1", "display_name": "Soham Chowdhury", "link": "https://stackoverflow.com/users/1593359/soham-chowdhury"}, "is_accepted": true, "score": 5, "last_activity_date": 1484154283, "last_edit_date": 1484154283, "creation_date": 1484131239, "answer_id": 41588628, "question_id": 41527061, "link": "https://stackoverflow.com/questions/41527061/nixos-haskell-opengl-problems-with-building-and-running-opengl-programs/41588628#41588628", "title": "NixOS, Haskell, opengl : problems with building and running openGL programs", "body": "<p>I <em>just</em> fixed this, after three days of, well, being another not-happy Arch-user-until-last-week: try adding <code>freeglut</code> to the <code>nix-shell</code> environment, i.e. use <code>nix-shell -p mesa freeglut</code>.</p>\n\n<p>For <code>stack</code> users stumbling upon this answer, add this to <code>~/.stack/stack.yaml</code>:</p>\n\n<pre><code>nix:\n  enable: true\n  packages: [mesa freeglut]\n</code></pre>\n\n<p>The <code>nix-shell</code> solution doesn't work in this case -- the problem, as I'm guessing, is that Stack always works inside a pure environment even if run from inside a <code>nix-shell</code>. I did try <code>pure: false</code> in the <code>nix</code> section of <code>stack.yaml</code>, but that didn't work. This does, for now.</p>\n\n<ul>\n<li><code>mesa</code> is required to provide the C headers for <code>OpenGLRaw</code> and other libraries (and this is why linking fails in your case, I believe).</li>\n<li><code>freeglut</code> provides the GLUT bindings (you'll get the \"unknown GLUT entry\" error otherwise) required at runtime.</li>\n</ul>\n\n<p>You may need to change the <code>mesa</code> there to something else, like <code>mesa_glu</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 43, "user_id": 4973303, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XYaBD6jNc4Q/AAAAAAAAAAI/AAAAAAAAAsg/gB9qk5i4Hk4/photo.jpg?sz=128", "display_name": "NCrashed", "link": "https://stackoverflow.com/users/4973303/ncrashed"}, "is_accepted": false, "score": 0, "last_activity_date": 1541029713, "creation_date": 1541029713, "answer_id": 53093412, "question_id": 41527061, "link": "https://stackoverflow.com/questions/41527061/nixos-haskell-opengl-problems-with-building-and-running-opengl-programs/53093412#53093412", "title": "NixOS, Haskell, opengl : problems with building and running openGL programs", "body": "<p>The following helped me:</p>\n\n<pre><code>with import &lt;nixpkgs&gt; {};\npkgs.stdenv.mkDerivation rec {\n  name = \"dev-env\";\n  buildInputs = with pkgs; [\n    mesa\n    freeglut\n  ];\n  LD_LIBRARY_PATH = with pkgs; \"${freeglut}/lib\";\n}\n</code></pre>\n\n<p>Copy this to <code>shell.nix</code>, enter the environment with <code>nix-shell</code> and run compiled executable inside the env.</p>\n"}], "owner": {"reputation": 228, "user_id": 7347627, "user_type": "registered", "profile_image": "https://graph.facebook.com/1828143650801314/picture?type=large", "display_name": "samsergey", "link": "https://stackoverflow.com/users/7347627/samsergey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1312, "favorite_count": 2, "accepted_answer_id": 41588628, "answer_count": 2, "score": 8, "last_activity_date": 1541029713, "creation_date": 1483826527, "last_edit_date": 1516716637, "question_id": 41527061, "link": "https://stackoverflow.com/questions/41527061/nixos-haskell-opengl-problems-with-building-and-running-opengl-programs", "title": "NixOS, Haskell, opengl : problems with building and running openGL programs", "body": "<p>I'm experiencing a problem with GL on NixOS: the problem seems to be old, but there is still no straightforward solution yet in 2017!</p>\n\n<p>I'm trying to build a Haskell program using the <code>Gloss</code> library. I have installed <code>gloss</code> and everything it needs using the <code>nix-shell -p mesa</code> and it seems to be properly build and istalled (using <code>cabal install</code>). However if I build the program in the same <code>nix-shell</code> it doesn't work:</p>\n\n<pre><code>$ nix-shell -p mesa_glu\n\n[nix-shell:]$ ghc --make -O2 SnakePar.hs\nLinking SnakePar ...\n\n[nix-shell:]$ ./SnakePar \nSnakePar: user error (unknown GLUT entry glutInit)\n</code></pre>\n\n<p>While working outside of a <code>nix-shell</code> the linking stage failes:</p>\n\n<pre><code>$ ghc --make -O2 SnakePar.hs\n[1 of 1] Compiling Main             ( SnakePar.hs, SnakePar.o )\nLinking SnakePar ...\n/nix/store/&lt;hash&gt;-binutils-2.27/bin/ld: cannot find -lGLU\n/nix/store/&lt;hash&gt;-binutils-2.27/bin/ld: cannot find -lGL\ncollect2: error: ld returned 1 exit status\n`cc' failed in phase `Linker'. (Exit code: 1)\n</code></pre>\n\n<p>This happens even though I have manually installed the <code>glu</code> library via <code>nix-env -iA</code>.</p>\n\n<pre><code>$ nix-env -q\ncabal-install-1.24.0.0\nghc-8.0.1\nglu-9.0.0\n</code></pre>\n\n<p>I have tried using <code>freeglut</code> or <code>mesa</code> in the same manner, but none of these (or even all together) didn't work.</p>\n\n<p>What am I missing?</p>\n\n<p>This question is relevant but it doesn't help: <a href=\"https://stackoverflow.com/questions/40310973/nixos-haskell-opengl-prerequisites\">nixos + haskell + opengl (prerequisites)</a></p>\n\n<p><strong>Solution:</strong> After switching to stack everything works. </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 1, "last_activity_date": 1483827444, "creation_date": 1483827444, "answer_id": 41527205, "question_id": 41526868, "link": "https://stackoverflow.com/questions/41526868/redirecting-standard-error-stream-haskell-create-process/41527205#41527205", "title": "Redirecting standard error stream, haskell create process", "body": "<p>Not the exact solution you are looking for but one popular solution in the community is to use the <code>silently</code> package to achieve it.</p>\n\n<p>You can use the function <a href=\"https://www.stackage.org/haddock/lts-7.14/silently-1.2.5/src/System.IO.Silently.html#hSilence\" rel=\"nofollow noreferrer\">hSilence</a> to do want you want. In fact, internally it opens <code>/dev/null</code> and does all the work. Sample code demo:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n     --resolver lts-6.15\n     --install-ghc\n     runghc\n     --package process\n     --package silently\n -}\n\nimport System.Process\nimport System.IO\nimport System.IO.Silently\n\nwriteToStderr :: IO ()\nwriteToStderr = do\n  hPutStrLn stderr \"hello\"\n  hPutStrLn stderr \"world\"\n\nmain :: IO ()\nmain = hSilence [stderr] writeToStderr\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1483874541, "last_edit_date": 1495539965, "creation_date": 1483874541, "answer_id": 41532146, "question_id": 41526868, "link": "https://stackoverflow.com/questions/41526868/redirecting-standard-error-stream-haskell-create-process/41532146#41532146", "title": "Redirecting standard error stream, haskell create process", "body": "<p>Open <code>/dev/null</code> with <code>withFile</code> and set it as <code>std_err</code> in the <code>CreateProcess</code> record:</p>\n\n<pre><code>import System.Process\nimport System.IO \n\nmain :: IO ()\nmain = withFile \"/dev/null\" WriteMode (\\handle -&gt; do\n    (_,_,_,phandle) &lt;- createProcess (shell \"echo foo\"){ std_err = UseHandle handle}\n    waitForProcess phandle\n    return ())\n</code></pre>\n\n<p>In Windows, you can use the <a href=\"https://stackoverflow.com/questions/313111/dev-null-in-windows\"><code>NUL</code></a> file.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7361363"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 336, "favorite_count": 0, "accepted_answer_id": 41532146, "answer_count": 2, "score": 2, "last_activity_date": 1483874541, "creation_date": 1483825221, "question_id": 41526868, "link": "https://stackoverflow.com/questions/41526868/redirecting-standard-error-stream-haskell-create-process", "title": "Redirecting standard error stream, haskell create process", "body": "<p>How to using <code>createProcess</code> in haskell redirect stderr into <code>/dev/null</code> ?</p>\n"}, {"tags": ["haskell", "bytestring"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1483825020, "post_id": 41526743, "comment_id": 70259630, "body": "In the end, do you want some function <code>g :: IO (PktHdr, B.ByteString) -&gt; IO (PktHdr, [Word8])</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 2, "last_activity_date": 1483825247, "creation_date": 1483825247, "answer_id": 41526876, "question_id": 41526743, "link": "https://stackoverflow.com/questions/41526743/ptr-word8-to-word8/41526876#41526876", "title": "Ptr Word8 to [Word8]", "body": "<p>I'm not familiar with those libraries, but can't you just do this?</p>\n\n<pre><code>import Foreign.Marshal.Array\n\ntoByteList :: PktHdr -&gt; Ptr Word8 -&gt; IO [Word8]\ntoByteList hdr ptr = peekArray (fromIntegral (hdrCaptureLength hdr)) ptr\n</code></pre>\n"}], "owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 41526876, "answer_count": 1, "score": 0, "last_activity_date": 1483825247, "creation_date": 1483824389, "question_id": 41526743, "link": "https://stackoverflow.com/questions/41526743/ptr-word8-to-word8", "title": "Ptr Word8 to [Word8]", "body": "<p>I'm using the library <code>Network.Pcap</code>, and it has the function <code>toBS</code></p>\n\n<pre><code>toBS :: (PktHdr, Ptr Word8) -&gt; IO (PktHdr, B.ByteString)\ntoBS (hdr, ptr) = do\n    let len = hdrCaptureLength hdr\n    s &lt;- B.create (fromIntegral len) $ \\p -&gt; B.memcpy p ptr (fromIntegral len)\n    return (hdr, s)\n</code></pre>\n\n<p>Right now I am unpacking the ByteString which gives me the <code>[Word8]</code> I want. I'\nm looking for a way to avoid having to unpack the <code>ByteString</code>, and get the <code>[Word8]</code> directly.</p>\n\n<p>(1) Does this function exist?\n(2) If not, could I get some advice on how to proceed?</p>\n"}, {"tags": ["haskell", "functor", "recursive-datastructures", "recursion-schemes", "fixpoint-combinators"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1483816691, "post_id": 41524960, "comment_id": 70256792, "body": "Yes, this <i>is</i> two questions in one. Please don&#39;t do that."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1483824224, "post_id": 41524960, "comment_id": 70259401, "body": "Not sure what I was thinking haha, since you answered the first I&#39;ll pull the second into a new one. Thanks BTW!"}], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1483828899, "post_id": 41525613, "comment_id": 70260734, "body": "Do we need the newtype? What does it provide in this case? Is it necessary for the Functor instance?  I&#39;m having a bit of trouble using this now, for instance the following (trivial) example works with the regular Fix, but not with the new Bifunctor Fix, take a look at <code>allTree</code> here: <a href=\"https://gist.github.com/ChrisPenner/aa6083478d2d1100f62a974860aae529\" rel=\"nofollow noreferrer\">gist.github.com/ChrisPenner/aa6083478d2d1100f62a974860aae529</a>  Sorry for all the trouble, I&#39;m pretty new to all this Fix stuff, and now having two different versions of it isn&#39;t making it any easier haha."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1483847936, "post_id": 41525613, "comment_id": 70264371, "body": "@ChrisPenner, does that help?"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1483916351, "post_id": 41525613, "comment_id": 70282927, "body": "This is considerably more complicated than I&#39;d thought it would be; I think I may go back to my simple Functor solution unless you have any simpler ideas. I&#39;d like to learn recursion-schemes, but if something as simple as having a Functor datatype is this complicated then I don&#39;t know that I&#39;m up to the task. I really do appreciate the explanations though! For some reason stack is refusing to install the &#39;profunctors&#39; lib, so I&#39;m even having trouble even trying this out. Despite that, even if I could figure it out, I think it would be difficult for other programmers to understand the result :("}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1483917630, "post_id": 41525613, "comment_id": 70283234, "body": "@ChrisPenner, you can certainly use the <code>recursion-schemes</code> approach and write the <code>Functor</code> instance by hand. I suspect the prettiest way may involve writing a bifunctorish clone of <code>recursion-schemes</code>, but that surely seems like overkill."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1483991498, "post_id": 41525613, "comment_id": 70316849, "body": "Hrmm, interesting; I just rediscovered the <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Plated.html\" rel=\"nofollow noreferrer\">Plated</a> section of the lens library; it has para, and you can use <code>transformOf</code> as <code>cata</code>, It&#39;s perhaps a little different but has similar power without needing to mangle your underlying data-structure which is nice. So far it&#39;s worked for my needs."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1484002811, "post_id": 41525613, "comment_id": 70322084, "body": "Ran into a few problems with that plated too because functions like <code>transform</code> have the signature <code>(a -&gt; a) -&gt; a -&gt; a</code> which doesn&#39;t allow changing the type as part of a folding operations like <code>cata</code> does... <i>sigh</i>. Thanks for trying though!"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1484027629, "post_id": 41525613, "comment_id": 70328514, "body": "Ended up going a different direction again; see my answer; It&#39;s simpler for me to understand than <code>Data.Bifunctor.Fix</code>; let me know what you think of it."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1483847928, "last_edit_date": 1483847928, "creation_date": 1483817526, "answer_id": 41525613, "question_id": 41524960, "link": "https://stackoverflow.com/questions/41524960/recursion-schemes-using-fix-on-a-data-type-thats-already-a-functor/41525613#41525613", "title": "Recursion schemes using `Fix` on a data-type that&#39;s already a Functor?", "body": "<p>Yes, you want to use the version of <code>Fix</code> from <code>Data.Bifunctor.Fix</code>:</p>\n\n<pre><code>newtype Fix p a = In { out :: p (Fix p a) a }\n\ninstance Bifunctor p =&gt; Functor (Fix p) where\n  fmap f (In x) = In (bimap (fmap f) f x)\n</code></pre>\n\n<p>You'll have to change your <code>WindowF</code> type to match:</p>\n\n<pre><code>data WindowF r a =\n  Split Dir SplitInfo r r\n    | Single ViewInfo a\n    deriving (Show, Functor)\n\ninstance Bifunctor WindowF where\n  bimap f _g (Split dir si x y) = Split dir si (f x) (f y)\n  bimap _f g (Single vi a) = Single vi (g a)\n\nnewtype Window a = Window (Fix WindowF a) deriving Functor\n</code></pre>\n\n<p>It's possible to use <code>recursion-schemes</code> with this, along with an auxiliary type:</p>\n\n<pre><code>import Data.Functor.Foldable hiding (Fix (..))\nimport Data.Profunctor.Unsafe\nimport Data.Coerce\n\nnewtype Flip p a b = Flip {unFlip :: p b a}\n\ninstance Bifunctor p =&gt; Bifunctor (Flip p) where\n  bimap f g (Flip x) = Flip (bimap g f x)\n\ninstance Bifunctor p =&gt; Functor (Flip p a) where\n  fmap = coerce (first :: (x -&gt; y) -&gt; p x a -&gt; p y a)\n    :: forall x y . (x -&gt; y) -&gt; Flip p a x -&gt; Flip p a y\n\ntype instance Base (Fix p a) = Flip p a\ninstance Bifunctor p =&gt; Recursive (Fix p a) where\n  project = Flip #. out\n  cata f = f . Flip . first (cata f) . out\n</code></pre>\n\n<p>Unfortunately, defining <code>Recursive</code> for the newtype-wrapped version is a little trickier:</p>\n\n<pre><code>newtype Window a = Window {getWindow :: Fix WindowF a} deriving (Functor)\ntype instance Base (Window a) = Flip WindowF a\n\ninstance Recursive (Window a) where\n  project = coerce #. project .# getWindow\n  cata = (. getWindow) #. cata\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "is_accepted": true, "score": 4, "last_activity_date": 1484027555, "creation_date": 1484027555, "answer_id": 41561999, "question_id": 41524960, "link": "https://stackoverflow.com/questions/41524960/recursion-schemes-using-fix-on-a-data-type-thats-already-a-functor/41561999#41561999", "title": "Recursion schemes using `Fix` on a data-type that&#39;s already a Functor?", "body": "<p>After a lot of wrestling I've come to the conclusion that a better choice is to define two data-types; a standard datatype that has the properties you want (in this case Bifunctor) and a Recursive Functor data-type for which you can define <code>Base</code>, <code>Recursive</code> and <code>Corecursive</code> instances for.</p>\n\n<p>Here's what it looks like:</p>\n\n<pre><code>{-# language DeriveFunctor, DeriveTraversable, TypeFamilies  #-}\n\nimport Data.Typeable\nimport Data.Bifunctor\nimport Data.Functor.Foldable\n\ndata BiTree b l =\n  Branch b (BiTree b l) (BiTree b l)\n    | Leaf l\n    deriving (Show, Typeable, Functor, Traversable, Foldable)\n\ninstance Bifunctor BiTree where\n  bimap _ g (Leaf x) = Leaf (g x)\n  bimap f g (Branch b l r) = Branch (f b) (bimap f g l) (bimap f g r)\n\ndata BiTreeF b l r =\n  BranchF b r r\n    | LeafF l\n    deriving (Show, Functor, Typeable)\n\ntype instance Base (BiTree a b) = BiTreeF a b\ninstance Recursive (BiTree a b) where\n  project (Leaf x) = LeafF x\n  project (Branch s l r) = BranchF s l r\n\ninstance Corecursive (BiTree a b) where\n  embed (BranchF sp x xs) = Branch sp x xs\n  embed (LeafF x) = Leaf x\n</code></pre>\n\n<p>You can now use your base type (BiTree) throughout your code like normal; and when you decide to use a recursion scheme you simply need to remember that when unpacking you use the 'F' versions of the constructors:</p>\n\n<pre><code>anyActiveWindows :: Window -&gt; Bool\nanyActiveWindows = cata alg\n  where alg (LeafF vw) = vw^.active\n        alg (BranchF _ l r) = l || r\n</code></pre>\n\n<p>Note that if you end up rebuilding a set of windows you'll still use the NON-F versions on the right-hand side of the <code>=</code>.</p>\n\n<p>I've defined the following for my scenario and it works great; I've got both <code>Functor</code> and <code>Bifunctor</code> for <code>Window</code> as I wanted without even using a newtype:</p>\n\n<pre><code>type Window = BiTree Split View\n\ndata SplitRule =\n  Percentage Double\n  | FromStart Int\n  | FromEnd Int\n  deriving (Show)\n\ndata Dir = Hor\n        | Vert\n        deriving (Show)\n\ndata Split = Split\n  { _dir :: Dir\n  , _splitRule :: SplitRule\n  } deriving (Show)\n\nmakeLenses ''Split\n\ndata View = View\n  { _active :: Bool\n  , _bufIndex :: Int\n  } deriving (Show)\n\nmakeLenses ''View\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 1, "accepted_answer_id": 41561999, "answer_count": 2, "score": 5, "last_activity_date": 1563169260, "creation_date": 1483813633, "last_edit_date": 1563169260, "question_id": 41524960, "link": "https://stackoverflow.com/questions/41524960/recursion-schemes-using-fix-on-a-data-type-thats-already-a-functor", "title": "Recursion schemes using `Fix` on a data-type that&#39;s already a Functor?", "body": "<p>Still working on my text editor <a href=\"https://github.com/chrispenner/rasa\" rel=\"nofollow noreferrer\">Rasa</a>.</p>\n\n<p>At the moment I'm building out the system for tracking viewports/splits (similar to vim splits). It seemed natural to me to represent this structure as a tree:</p>\n\n<pre><code>data Dir = Hor\n         | Vert\n         deriving (Show)\n\ndata Window a =\n  Split Dir SplitInfo (Window a) (Window a)\n    | Single ViewInfo a\n    deriving (Show, Functor, Traversable, Foldable)\n</code></pre>\n\n<p>This works great, I store my <code>View</code>s in the tree, and then I can traverse/fmap over them to alter them, it also dovetails with the lens package pretty well!</p>\n\n<p>I've been learning about <a href=\"https://medium.com/@jaredtobin/practical-recursion-schemes-c10648ec1c29#.nlgrc4ibh\" rel=\"nofollow noreferrer\">Recursion Schemes</a> lately and it seems like this is a suitable use-case for them since the tree is a recursive data-structure.</p>\n\n<p>I managed to figure it out well enough to build out the Fixpoint version:</p>\n\n<pre><code>data WindowF a r =\n  Split Dir SplitInfo r r\n    | Single ViewInfo a\n    deriving (Show, Functor)\n\ntype Window a = Fix (WindowF a)\n</code></pre>\n\n<p>However, now the Functor instance is used up by the <code>r</code>; </p>\n\n<p>I've tried a few variations of</p>\n\n<pre><code>deriving instance Functor Window\n</code></pre>\n\n<p>But it chokes because window is a type synonym.</p>\n\n<p>And:</p>\n\n<pre><code>newtype Window a = Window (Fix (WindowF a)) deriving Functor\n</code></pre>\n\n<p>And that fails too;</p>\n\n<pre><code>\u2022 Couldn't match kind \u2018* -&gt; *\u2019 with \u2018*\u2019\n    arising from the first field of \u2018Window\u2019 (type \u2018Fix (WindowF a)\u2019)\n\u2022 When deriving the instance for (Functor Window)\n</code></pre>\n\n<ol>\n<li>Is it still possible to define fmap/traverse over <code>a</code>? Or do I need to do these operations using <a href=\"http://hackage.haskell.org/package/recursion-schemes\" rel=\"nofollow noreferrer\">recursion-schemes</a> primitives? Do I implement Bifunctor? What would the instance implementation look like?</li>\n</ol>\n\n<p>Rest of the types are <a href=\"https://github.com/ChrisPenner/rasa/blob/render-pref-recursion-schemes/rasa-ext-views/src/Rasa/Ext/Views.hs#L29\" rel=\"nofollow noreferrer\">here</a>, the project doesn't compile because I don't have the proper Functor instance for Window...</p>\n\n<p>Thanks!!</p>\n"}, {"tags": ["list", "haskell", "predicate"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1483823038, "post_id": 41524068, "comment_id": 70259033, "body": "You left out the best part (IMO) of the point-free solution! <code>afterFilter p = map snd . filter (p . fst) . (zip &lt;*&gt; tail)</code>"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 4, "last_activity_date": 1483826233, "last_edit_date": 1483826233, "creation_date": 1483808560, "answer_id": 41524068, "question_id": 41523856, "link": "https://stackoverflow.com/questions/41523856/predicate-and-a-list-search-haskell/41524068#41524068", "title": "predicate and a list search haskell", "body": "<p>The trick is to pull <em>two</em> elements out of the input list by pattern-matching two cons cells. If the first element passes the predicate, we stick the second on the output. But don't forget to stick the second element back on the input list when you make the recursive call.</p>\n\n<pre><code>afterFilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nafterFilter f [] = []   -- input list is empty\nafterFilter f [x] = []  -- input list has only one element - no \"next element\" to return\nafterFilter f (x:y:xs) =\n    let ys = afterFilter f (y:xs)\n    in (if f x then y:ys else rest)\n</code></pre>\n\n<p>However, a higher-level - and much more Haskellish - way to approach the problem would be to break it down into a pipeline of operations.</p>\n\n<ol>\n<li>Pair up each item in the list with the element that follows it using <code>zip</code>, so we have a list of <code>(element, next)</code> pairs.</li>\n<li>Use <code>filter</code> to drop the pairs for which <code>element</code> does not pass the predicate.</li>\n<li>Use <code>map</code> to extract the <code>next</code> part of each surviving pair.</li>\n</ol>\n\n<p>So the code looks like this:</p>\n\n<pre><code>pairWithSuccessors :: [a] -&gt; [(a, a)]\npairWithSuccessors xs = zip xs (tail xs)\n\nafterFilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nafterFilter p xs =\n    let withSuccessors = pairWithSuccessors xs (tail xs)\n        filtered = filter (\\(element, next) -&gt; p element) withSuccessors\n        filteredSuccessors = map (\\(element, next) -&gt; next) filtered\n    in filteredSuccessors\n</code></pre>\n\n<p>Or, written in <em>point-free style</em>:</p>\n\n<pre><code>afterFilter p = map snd . filter (p . fst) . pairWithSuccessors\n</code></pre>\n\n<p>Functions built with the <em>composition operator</em> <code>.</code> are read right-to-left: first <code>pairWithSuccessors</code>, then <code>filter (p . fst)</code>, then <code>map snd</code> over the result.</p>\n\n<p>GHC is good at working with lists: when compiled with optimisations, both approaches should produce roughly the same machine code - that is, there's no performance cost to the high-level solution</p>\n"}, {"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 1, "last_activity_date": 1483809359, "creation_date": 1483809359, "answer_id": 41524215, "question_id": 41523856, "link": "https://stackoverflow.com/questions/41523856/predicate-and-a-list-search-haskell/41524215#41524215", "title": "predicate and a list search haskell", "body": "<p>Following what you did, there are some strange things with your code :</p>\n\n<p>The <code>map head [ys]</code> is very odd, and causes your function to stop : At the first element matching the predicate, your function returns a list containing its immediate successor and stops there. You still need to process the rest of the list.</p>\n\n<p>Also, following your definition of the problem, each item which is a successor of an item passing the predicate should be on the resulting array. I may be wrong, but what I understood is that <code>afterFilter (&lt;0) [-1, -1, 1]</code> should return <code>[-1, 1]</code>.</p>\n\n<p>However, you're discarding one element you didn't check for by calling <code>tail ys</code> : You checked for <code>y</code>, but not for <code>head ys</code>.</p>\n\n<p>Finally, by adding the edge cases, here is what you get : </p>\n\n<pre><code>afterFilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n\nafterFilter _ [] = []\nafterFilter _ [_] = []\nafterFilter x (y:ys@(z:zs)) =\n    if x y\n        then z : afterFilter x ys\n    else\n        afterFilter x ys\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "is_accepted": false, "score": 0, "last_activity_date": 1483837600, "last_edit_date": 1483837600, "creation_date": 1483811140, "answer_id": 41524504, "question_id": 41523856, "link": "https://stackoverflow.com/questions/41523856/predicate-and-a-list-search-haskell/41524504#41524504", "title": "predicate and a list search haskell", "body": "<p>Try:</p>\n\n<pre><code>afterFilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nafterFilter p [] = []\nafterFilter p [_] = []\nafterFilter p (x1:x2:xs) \n  | p x1 = x2:rest\n  | otherwise = rest\n  where rest = afterFilter p (x2:xs)\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>afterFilter' :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nafterFilter' p xs = map snd $ filter (\\(x, _) -&gt; p x) $ zip xs (tail xs)\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>afterFilter'' :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nafterFilter'' p xs = [y | (x, y) &lt;- zip xs (tail xs), p x]\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 6938720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5Y9qMGXuMuU/AAAAAAAAAAI/AAAAAAAAAF8/PYrpf7srtBk/photo.jpg?sz=128", "display_name": "Rebecca McGowan", "link": "https://stackoverflow.com/users/6938720/rebecca-mcgowan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1719, "favorite_count": 1, "accepted_answer_id": 41524068, "answer_count": 3, "score": 3, "last_activity_date": 1483837600, "creation_date": 1483807535, "last_edit_date": 1483808133, "question_id": 41523856, "link": "https://stackoverflow.com/questions/41523856/predicate-and-a-list-search-haskell", "title": "predicate and a list search haskell", "body": "<p>I am learning Haskell at the moment and have come to a bit of a standstill. I'm trying to write a function that takes a predicate <code>p</code> and a list <code>xs</code> and returns the list of those elements of <code>xs</code> which immediately follow an element which passes the predicate <code>p</code>. Here is what I have :</p>\n\n<pre><code>afterFilter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n\nafterFilter x (y:ys) =\n\n    if x y\n\n        then (map head [ys])\n\n    else\n\n        afterFilter x (tail ys) \n</code></pre>\n\n<p>test input : <code>afterFilter (&lt;0) [-4,7,-4,-8,3,-3,-6,0,-9,-1]</code></p>\n\n<p>output : <code>[7]</code></p>\n"}, {"tags": ["list", "haskell", "random", "shuffle"], "answers": [{"tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": true, "score": 1, "last_activity_date": 1483808458, "last_edit_date": 1483808458, "creation_date": 1483807034, "answer_id": 41523770, "question_id": 41523394, "link": "https://stackoverflow.com/questions/41523394/data-random-extras-usage/41523770#41523770", "title": "Data.Random.Extras Usage", "body": "<p>That is because the type of <code>shuffle</code> is <code>[a] -&gt; RVar [a]</code>. So you don't get back an <code>[a]</code> which you could use directly but some mysterious <code>RVar</code>. <code>RVar</code> is a bit like <code>IO</code> in that an <code>RVar a</code> is not a value of type <code>a</code> but more of a mean of getting a value of type <code>a</code>. In order to actually get a value of type <code>a</code> you have to use <code>runRVar :: RandomSource m s =&gt; RVar a -&gt; s -&gt; m a</code>. Looking at the documentation of <a href=\"https://hackage.haskell.org/package/random-fu-0.2.3.0/docs/Data-Random.html#t:RandomSource\" rel=\"nofollow noreferrer\"><code>RandomSource</code></a>, there are multiple instances for it. One example would be <code>MonadRandom m =&gt; RandomSource m StdRandom</code>. So we can use <code>runRVar</code> like this (because <code>IO</code> is an instance of <code>MonadRandom</code>):</p>\n\n<pre><code>&gt; import Data.Random (runRVar, StdRandom(..))\n&gt; import Data.Random.Extras (shuffle)\n&gt; runRVar (shuffle [1..10]) StdRandom :: IO [Int]\n[3,10,8,5,6,7,4,2,9,1]\n</code></pre>\n\n<p>Or another instance of <code>MonadRandom</code>, that doesn't involve <code>IO</code> would be <code>State StdGen a</code>:</p>\n\n<pre><code>&gt; -- Above imports and\n&gt; import Control.Monad.State (State,evalState)\n&gt; import System.Random (StdGen,mkStdGen)\n&gt; shuffledState = runRVar (shuffle [1..10]) StdRandom :: State StdGen [Int]\n&gt; evalState shuffledState $ mkStdGen 0 -- 0 is the seed\n[6,8,7,5,10,9,2,3,1,4]\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 7388053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/971a64c6854f8446d1784dd8ecd0d463?s=128&d=identicon&r=PG&f=1", "display_name": "jdet", "link": "https://stackoverflow.com/users/7388053/jdet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 41523770, "answer_count": 1, "score": 1, "last_activity_date": 1483808458, "creation_date": 1483805025, "question_id": 41523394, "link": "https://stackoverflow.com/questions/41523394/data-random-extras-usage", "title": "Data.Random.Extras Usage", "body": "<p>I'm trying to use a <strong><em>shuffle</em></strong> function from <strong>Data.Random.Extras</strong> package on the list of cards I have created. My code:</p>\n\n<pre><code>module Cards where\n\nimport Data.Random.Extras\n\ndata Suit = Clubs\n             | Diamonds\n             | Hearts\n             | Spades\n               deriving (Eq,Enum,Ord,Show,Bounded)\n\ndata Value =  Two\n            | Three\n            | Four\n            | Five\n            | Six\n            | Seven\n            | Eight\n            | Nine\n            | Ten\n            | Jack\n            | Queen\n            | King\n            | Ace\n                deriving (Eq,Enum,Ord,Show,Bounded)\n\ndata Card = Card Value Suit\n                deriving (Eq,Ord,Show)\n\ntype Deck = [Card]\n\n-- Generate deck of cards\ngenerateDeck :: Deck\ngenerateDeck = [Card val suit | suit &lt;- [Clubs .. Spades], val &lt;- [Two .. Ace]]\n\n-- Print deck of cards\nprintDeck :: Deck -&gt; IO ()\nprintDeck deck = putStr (formatDeck deck)\n  where\n    formatDeck [] = []\n    formatDeck (x:xs) = (show x) ++ \"\\n\" ++ formatDeck xs\n</code></pre>\n\n<p>The problem is that when I'm trying to execute <strong><em>shuffle $ generateDeck</em></strong> on GHCi prompt I'm getting:</p>\n\n<pre><code>No instance for (Show (Data.RVar.RVar [Card]))\n  arising from use of 'print'\nPossible fix:\n  Add an instance declaration for (Show (Data.RVar.RVar [Card]))\nIn a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>I spent hours searching and trying to solve/understand this without any success. I would really appreciate your help.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "records", "algebraic-data-types"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483810306, "post_id": 41522984, "comment_id": 70254469, "body": "One could use scrap-your-boilerplate. For this simple case, I&#39;m not sure that&#39;s much better."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1483821157, "post_id": 41522984, "comment_id": 70258366, "body": "You could factor it somewhat without generics: <code>uniqueAttributes objects = and [go color, go width, go height] where go :: (Ord a) =&gt; (Object -&gt; a) -&gt; Bool; go f = allDifferent (map f objects)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": false, "score": 4, "last_activity_date": 1483811737, "last_edit_date": 1483811737, "creation_date": 1483811167, "answer_id": 41524511, "question_id": 41522984, "link": "https://stackoverflow.com/questions/41522984/haskell-is-there-a-way-of-mapping-over-an-algebraic-data-type/41524511#41524511", "title": "Haskell: is there a way of &#39;mapping&#39; over an algebraic data type?", "body": "<p>Here is a solution using <a href=\"https://hackage.haskell.org/package/generics-sop\" rel=\"nofollow noreferrer\">generics-sop</a>:</p>\n\n<pre><code>pointwiseAllDifferent\n  :: (Generic a, Code a ~ '[ xs ], All Ord xs) =&gt; [a] -&gt; Bool\npointwiseAllDifferent =\n    and\n  . hcollapse\n  . hcmap (Proxy :: Proxy Ord) (K . allDifferent)\n  . hunzip\n  . map (unZ . unSOP . from)\n\nhunzip :: SListI xs =&gt; [NP I xs] -&gt; NP [] xs\nhunzip = foldr (hzipWith ((:) . unI)) (hpure [])\n</code></pre>\n\n<p>This assumes that the type <code>Object</code> you want to compare is a record type and requires that you make this type an instance of the class <code>Generic</code>, which can be done using Template Haskell:</p>\n\n<pre><code>deriveGeneric ''Object\n</code></pre>\n\n<p>Let's try to see what's going on here by looking at a concrete example:</p>\n\n<pre><code>objects = [Object Red Thin Short, Object Green Fat Short]\n</code></pre>\n\n<p>The line <code>map (unZ . unSOP . from)</code> converts each <code>Object</code> into a heterogeneous list (called an n-ary product in the library):</p>\n\n<pre><code>GHCi&gt; map (unZ . unSOP . from) objects\n[I Red :* (I Thin :* (I Short :* Nil)),I Green :* (I Fat :* (I Short :* Nil))]\n</code></pre>\n\n<p>The <code>hunzip</code> then turns this list of products into a product where each element is a list:</p>\n\n<pre><code>GHCi&gt; hunzip it\n[Red,Green] :* ([Thin,Fat] :* ([Short,Short] :* Nil))\n</code></pre>\n\n<p>Now, we apply <code>allDifferent</code> to each list in the product:</p>\n\n<pre><code>GHCi&gt; hcmap (Proxy :: Proxy Ord) (K . allDifferent) it\nK True :* (K True :* (K False :* Nil))\n</code></pre>\n\n<p>The product is now in fact homogeneous, as every position contains a <code>Bool</code>, so <code>hcollapse</code> turns it into a normal homogeneous list again:</p>\n\n<pre><code>GHCi&gt; hcollapse it\n[True,True,False]\n</code></pre>\n\n<p>The last step just applies <code>and</code> to it:</p>\n\n<pre><code>GHCi&gt; and it\nFalse\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 141, "user_id": 7387991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61056dff4613bebfb7a5660469e335f4?s=128&d=identicon&r=PG", "display_name": "yun", "link": "https://stackoverflow.com/users/7387991/yun"}, "edited": false, "score": 0, "creation_date": 1483879497, "post_id": 41527998, "comment_id": 70270630, "body": "Although converting constructors to strings and comparing them as such feels somewhat indirect, this solution has the virtue of being quite simple. It seems newer approaches to generics are all the rage, but <code>Data.Data</code> does the job!"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 141, "user_id": 7387991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61056dff4613bebfb7a5660469e335f4?s=128&d=identicon&r=PG", "display_name": "yun", "link": "https://stackoverflow.com/users/7387991/yun"}, "edited": false, "score": 0, "creation_date": 1483907728, "post_id": 41527998, "comment_id": 70280344, "body": "I added a note about using <code>constrIndex</code> to get <code>Int</code>-valued indexes instead.  This is what I did originally, but using <code>show</code> gave a prettier (though admittedly less direct and less efficient) signature value."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1483907626, "last_edit_date": 1483907626, "creation_date": 1483833941, "answer_id": 41527998, "question_id": 41522984, "link": "https://stackoverflow.com/questions/41522984/haskell-is-there-a-way-of-mapping-over-an-algebraic-data-type/41527998#41527998", "title": "Haskell: is there a way of &#39;mapping&#39; over an algebraic data type?", "body": "<p>For this very specific situation (checking a set of attributes that are simple sum types with 0-arity constructors), you can use the following construction using <code>Data.Data</code> generics:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n\nmodule Signature where\n\nimport Data.List (sort, transpose)\nimport Data.Data\n\ndata Color  = Red   | Green  | Blue deriving (Eq, Show, Enum, Ord, Data)\ndata Width  = Thin  | Normal | Fat  deriving (Eq, Show, Enum, Ord, Data)\ndata Height = Short | Medium | Tall deriving (Eq, Show, Enum, Ord, Data)\n\ndata Object = Object { color  :: Color\n                     , width  :: Width \n                     , height :: Height } deriving (Show, Data)\n\n-- |Signature of attribute constructors used in object\nsignature :: Object -&gt; [String]\nsignature = gmapQ (show . toConstr)\n\nuniqueAttributes :: [Object] -&gt; Bool\nuniqueAttributes = all allDifferent . transpose . map signature\n\nallDifferent :: (Ord a) =&gt; [a] -&gt; Bool\nallDifferent = comparePairwise . sort\n  where comparePairwise xs = and $ zipWith (/=) xs (drop 1 xs)\n</code></pre>\n\n<p>The key here is the function <code>signature</code> which takes an object and generically across its immediate children calculates the constructor name of each child.  So:</p>\n\n<pre><code>*Signature&gt; signature (Object Red Fat Medium)\n[\"Red\",\"Fat\",\"Medium\"]\n*Signature&gt; \n</code></pre>\n\n<p>If there are any fields other than these simple sum types, (like say an attribute of type <code>data Weight = Weight Int</code> or if you added a <code>name :: String</code> field to <code>Object</code>), then this will suddenly fail.</p>\n\n<p>(Edited to add:)  Note that you can use <code>constrIndex . toConstr</code> in place of <code>show . toConstr</code> to use an <code>Int</code>-valued constructor index (basically, the index starting with 1 of the constructor within the <code>data</code> definition), if this feels less indirect.  If the <code>Constr</code> returned by <code>toConstr</code> had an <code>Ord</code> instance, there would be no indirection at all, but unfortunately...</p>\n"}], "owner": {"reputation": 141, "user_id": 7387991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61056dff4613bebfb7a5660469e335f4?s=128&d=identicon&r=PG", "display_name": "yun", "link": "https://stackoverflow.com/users/7387991/yun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 988, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1483907626, "creation_date": 1483802437, "question_id": 41522984, "link": "https://stackoverflow.com/questions/41522984/haskell-is-there-a-way-of-mapping-over-an-algebraic-data-type", "title": "Haskell: is there a way of &#39;mapping&#39; over an algebraic data type?", "body": "<p>Suppose that I have some simple algebraic data (essentially enums) and another type which has these enums as fields.</p>\n\n<pre><code>data Color  = Red   | Green  | Blue deriving (Eq, Show, Enum, Ord)\ndata Width  = Thin  | Normal | Fat  deriving (Eq, Show, Enum, Ord)\ndata Height = Short | Medium | Tall deriving (Eq, Show, Enum, Ord)\n\ndata Object = Object { color  :: Colour\n                     , width  :: Width \n                     , height :: Height } deriving (Show)\n</code></pre>\n\n<p>Given a list of objects, I want to test that the attributes are all distinct. For this I have following functions (using <code>sort</code> from <code>Data.List</code>)</p>\n\n<pre><code>allDifferent = comparePairwise . sort\n  where comparePairwise xs = and $ zipWith (/=) xs (drop 1 xs)\n\nuniqueAttributes :: [Object] -&gt; Bool\nuniqueAttributes objects = all [ allDifferent $ map color  objects \n                               , allDifferent $ map width  objects\n                               , allDifferent $ map height objects ]\n</code></pre>\n\n<p>This works, but is rather dissatisfying because I had to type each field (color, width, height) manually. In my actual code, there are more fields! Is there a way of 'mapping' the function </p>\n\n<pre><code>\\field -&gt; allDifferent $ map field objects\n</code></pre>\n\n<p>over the fields of an algebraic datatype like <code>Object</code>? I want to treat <code>Object</code> as a list of its fields (something that would be easy in e.g. javascript), but these fields have different types...</p>\n"}, {"tags": ["haskell", "lenses", "higher-rank-types", "impredicativetypes"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1483802114, "post_id": 41522857, "comment_id": 70251670, "body": "Use <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Lens.html#t:ALens\" rel=\"nofollow noreferrer\"><code>ALens</code></a> maybe?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1483803113, "post_id": 41522857, "comment_id": 70251954, "body": "There&#39;s also <code>ReifiedLens</code> which is just the usual newtype wrapper.around a <code>Lens</code>. When you&#39;re returning a lens it might be more efficient to use <code>ReifiedLens</code> than <code>ALens</code>, and it seems about equally convenient for the consumer."}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 7, "last_activity_date": 1483806033, "creation_date": 1483806033, "answer_id": 41523570, "question_id": 41522857, "link": "https://stackoverflow.com/questions/41522857/how-to-non-impredicatively-return-maybe-a-lens/41523570#41523570", "title": "How to non-impredicatively return `Maybe` a lens?", "body": "<p>This is what the <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Reified.html\" rel=\"noreferrer\"><code>Control.Lens.Reified</code></a> module is for. It contains <code>newtype</code> wrappers for the <code>lens</code> hierarchy.</p>\n\n<pre><code>foo :: A -&gt; Maybe (ReifiedLens' B C)\n</code></pre>\n"}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 1, "accepted_answer_id": 41523570, "answer_count": 1, "score": 6, "last_activity_date": 1483806033, "creation_date": 1483801656, "question_id": 41522857, "link": "https://stackoverflow.com/questions/41522857/how-to-non-impredicatively-return-maybe-a-lens", "title": "How to non-impredicatively return `Maybe` a lens?", "body": "<p>A type like <code>Maybe (Lens' a b)</code> doesn't work because <a href=\"http://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Type.html#t:Lens-39-\" rel=\"nofollow noreferrer\"><code>Lens'</code></a> is under the hood a Rank-2 type, that can't be wrapped in a type constructor without the <code>-XImpredicativeTypes</code> extension (which is not really supported in GHC).</p>\n\n<p>What is thus the best type to give a function that would morally have type</p>\n\n<pre><code>foo :: A -&gt; Maybe (Lens' B C)\n</code></pre>\n\n<p>A possibility would be to defer the <code>Maybe</code> into a passed continuation</p>\n\n<pre><code>foo' :: \u2200 y . A -&gt; (Lens' B C -&gt; y) -&gt; Maybe y\n</code></pre>\n\n<p>but I don't particularly like that.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 7, "creation_date": 1483799896, "post_id": 41522491, "comment_id": 70251003, "body": "You can use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad-ST.html\" rel=\"nofollow noreferrer\"><code>ST</code></a> for locally impure operations."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1483808084, "post_id": 41522491, "comment_id": 70253691, "body": "This is <i>precisely</i> what the IO monad tries to prevent. All the impure effects are relegated inside the IO. Why on earth do you want to break that?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1483811698, "post_id": 41522491, "comment_id": 70254973, "body": "It definitely doesn&#39;t mean you can unwrap something because it&#39;s a <code>Monad</code>. Consider <code>data Proxy a = Proxy</code> (Note that there is no value &quot;contained in&quot; <code>Proxy</code> at all) which is a <code>Monad</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1483812673, "post_id": 41522491, "comment_id": 70255331, "body": "You cannot unwrap <code>IO</code> <i>by design</i>, because its very purpose is to mark operations that are necessarily implemented by the compiler, not in Haskell code."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1483813664, "post_id": 41522491, "comment_id": 70255726, "body": "As has already been mentioned, <code>ST</code> is exactly what you&#39;re looking for. Running <code>IO</code> locally is against everything Haskell stands for."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 3, "creation_date": 1483841664, "post_id": 41522491, "comment_id": 70263374, "body": "It is far too hasty to say <code>ST</code> is what he&#39;s looking for.  While it is a good solution for many problems, he has yet to state a need and his one example was <code>trace</code> - certainly not an <code>ST</code> sort of task.  @yanpas Can you please be more specific as to your actual goal?"}, {"owner": {"reputation": 1921, "user_id": 4355809, "user_type": "registered", "accept_rate": 84, "profile_image": "https://graph.facebook.com/100000696083609/picture?type=large", "display_name": "yanpas", "link": "https://stackoverflow.com/users/4355809/yanpas"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1483862296, "post_id": 41522491, "comment_id": 70266657, "body": "@ThomasM.DuBuisson no goal, just wondering and getting minuses"}, {"owner": {"reputation": 1494, "user_id": 1188670, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/HEXZx.png?s=128&g=1", "display_name": "Vektorweg", "link": "https://stackoverflow.com/users/1188670/vektorweg"}, "edited": false, "score": 0, "creation_date": 1484149504, "post_id": 41522491, "comment_id": 70392916, "body": "People are just offended by your assumptions about monads and then probably started collectively not to tell you about unsafe IO (which, I believe, most people know). Btw. the constructor of every monad is <code>return :: Monad m =&gt; a -&gt; m a</code>."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1484153752, "post_id": 41594721, "comment_id": 70395676, "body": "\u201cUse it with caution\u201d \u2013 that&#39;s too weak. The correct advice is <i><b>don&#39;t</b> use it</i> in general Haskell code, only for wrappers around foreign-function calls (i.e. C functions which can be wrapped to something properly pure, which the C language can&#39;t by itself guarantee). <i>Sometimes</i> it can also make sense to use <code>unsafePerformIO</code> in Haskell itself, as a last-resort optimisation, but this should almost never be necessary (<code>ST</code> can do most of the operations you might need for this). Any function you can write in Haskell at all can also be written completely without IO, at worst it&#39;ll be slower."}, {"owner": {"reputation": 1494, "user_id": 1188670, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/HEXZx.png?s=128&g=1", "display_name": "Vektorweg", "link": "https://stackoverflow.com/users/1188670/vektorweg"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1484154438, "post_id": 41594721, "comment_id": 70396120, "body": "@leftaroundabout perhaps you might want to submit a patch for the documentation then, because the docs don&#39;t say it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1600709857, "post_id": 41594721, "comment_id": 113167169, "body": "@leftaroundabout, there are some rather interesting use-cases for <code>unsafePerformIO</code> that I&#39;d be sad to lose. Off the top of my head: 1. Running (conceptually pure) parallel computations. 2. Data structures designed around a generalization of laziness, where nodes in the structure are replaced by semantically equivalent but &quot;improved&quot; versions. See &quot;Simple confluently persistent catenable lists&quot; by Kaplan, Okasaki, and Tarjan (particularly Section 2) for a discussion of this technique."}], "tags": [], "owner": {"reputation": 1494, "user_id": 1188670, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/HEXZx.png?s=128&g=1", "display_name": "Vektorweg", "link": "https://stackoverflow.com/users/1188670/vektorweg"}, "is_accepted": true, "score": 2, "last_activity_date": 1484148466, "creation_date": 1484148466, "answer_id": 41594721, "question_id": 41522491, "link": "https://stackoverflow.com/questions/41522491/is-there-a-way-to-place-some-impure-code-inside-pure-functions/41594721#41594721", "title": "Is there a way to place some impure code inside pure functions?", "body": "<p><code>unsafePerformIO :: IO a -&gt; a</code> in <code>System.IO.Unsafe</code> (base).</p>\n\n<p>Use it with caution and read the description in the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/System-IO-Unsafe.html\" rel=\"nofollow noreferrer\">documentation</a> carefully. </p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1484155705, "creation_date": 1484155705, "answer_id": 41597096, "question_id": 41522491, "link": "https://stackoverflow.com/questions/41522491/is-there-a-way-to-place-some-impure-code-inside-pure-functions/41597096#41597096", "title": "Is there a way to place some impure code inside pure functions?", "body": "<p>The correct answer is</p>\n\n<h3>No, you can't!</h3>\n\n<p><sup>Well, <em>yes</em>, GHC has a thing called <code>unsafePerformIO</code>, but this is <em>not</em> part of the Haskell standard, merely a hack to allow certain \u201cmorally pure\u201d functions from other languages to be called using the foreign function interface, and reflect the type of those functions with the type they would have if you'd written them straight in pure Haskell.</sup></p>\n\n<p>Note that \u201cunwrapping the <code>IO</code> monad\u201d would <em>not</em> simply give you the result of that computation. If <code>IO</code> were a public-constructors type, it would actually look (conceptually) something like the following:</p>\n\n<pre><code>data IO' a =\n    WriteToFile FilePath String\n  | PutStr String\n  | WithStdLine (String -&gt; IO' a)\n  | ...\n  | SequenceIO (IO' ()) (IO' a)\n</code></pre>\n\n<p>Pattern matching on such an <code>IO' a</code> value would normally not give you access to anything of type <code>a</code>, it would merely give you some <em>description of actions to be performed</em>, and perhaps some function that could possibly yield an <code>a</code> value <em>from</em> intermediate results obtained from the environment.</p>\n\n<p>The only way to actually get useful work done would then still be like it is now: by binding it to something like the <code>main</code> action, which then executed by some \u201creal world entity\u201d (the runtime).</p>\n\n<p>If you want to implement an algorithm that describes a proper mathematical (i.e. pure) function but seems to lend itself to an imperative programming style with mutation etc., then you should not implement this in the <code>IO</code> monad at all. You might well be able to just implement it in ordinary pure Haskell98 by just choosing suitable data structures, or perhaps it makes sense to use <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad-ST.html\" rel=\"nofollow noreferrer\">the <code>ST</code> monad</a> to achieve e.g. array updates with the same performance they'd have in imperative languages.</p>\n"}, {"tags": [], "owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "is_accepted": false, "score": 1, "last_activity_date": 1605539774, "last_edit_date": 1605539774, "creation_date": 1600671848, "answer_id": 63987583, "question_id": 41522491, "link": "https://stackoverflow.com/questions/41522491/is-there-a-way-to-place-some-impure-code-inside-pure-functions/63987583#63987583", "title": "Is there a way to place some impure code inside pure functions?", "body": "<blockquote>\n<p>Is there a way to place some impure code inside pure functions?</p>\n</blockquote>\n<ul>\n<li><p>What if there <strong>was</strong> a way to do this?</p>\n</li>\n<li><p>What if <strong>everyone else</strong> could use it?</p>\n</li>\n</ul>\n<p>Would you be willing to sit down and scrutinise the sources of <em><strong>each and every library and program</strong></em> you use to check they are safe?</p>\n<p>If you are, then Haskell probably isn't for you - I suggest you have a look at languages like <a href=\"https://www.smlnj.org/sml.html\" rel=\"nofollow noreferrer\">Standard ML</a> or <a href=\"https://ocaml.org\" rel=\"nofollow noreferrer\">OCaml</a>...</p>\n<hr />\n<p>You're still here?</p>\n<p>Alright then, there's an alternative approach which you can use: <em>abstract out the pure functions from the impure code</em>. It's possible to do this because\nfunctions are <em>first-class values</em> in Haskell - in particular, <em>functions can be used as arguments</em> e.g:</p>\n<pre><code>fmap  :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nliftM2 :: Monad m =&gt; (a -&gt; b -&gt; c) -&gt; m a -&gt; m b -&gt; m c\n</code></pre>\n<p>As your powers of abstraction improve, you'll delegate more and more work to pure code (in the form of functions), with just a small cohort of definitions being tainted by effects (including <code>main :: IO ()</code>). It requires some extra effort to start with, but the long-term rewards are substantial...</p>\n"}], "owner": {"reputation": 1921, "user_id": 4355809, "user_type": "registered", "accept_rate": 84, "profile_image": "https://graph.facebook.com/100000696083609/picture?type=large", "display_name": "yanpas", "link": "https://stackoverflow.com/users/4355809/yanpas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 0, "accepted_answer_id": 41594721, "answer_count": 3, "score": -1, "last_activity_date": 1605539774, "creation_date": 1483799367, "question_id": 41522491, "link": "https://stackoverflow.com/questions/41522491/is-there-a-way-to-place-some-impure-code-inside-pure-functions", "title": "Is there a way to place some impure code inside pure functions?", "body": "<p><code>IO</code>, just like <code>Maybe</code>, is just an instance of <code>Monad</code>. On the other hand we have all data constructors for <code>Maybe</code> (<code>Just</code> and <code>Nothing</code>), but no constructors for <code>IO</code>. <code>Reader</code> and <code>Writer</code> do not export constructors too, they have functions, which return instance of this type (<code>reader</code> and <code>writer</code>) and more importantly <code>runReader</code> and <code>runWriter</code>, which unwrap computation result from Monad.</p>\n\n<p>Is there a way to unwrap IO Monad? I would like to have pure function which do some impure IO computations under the hood. Currently I am able to do this with most of the Monads</p>\n\n<p>I know one example of such tricky function: <code>Debug.Trace.trace</code></p>\n"}, {"tags": ["haskell", "circleci", "hakyll"], "comments": [{"owner": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1483816622, "post_id": 41522485, "comment_id": 70256773, "body": "Possibly relevant <a href=\"https://stackoverflow.com/questions/34654262/build-fails-because-of-multiple-definition-linker-errors-in-native-dependencie/34811594#34811594\" title=\"build fails because of multiple definition linker errors in native dependencie\">stackoverflow.com/questions/34654262/&hellip;</a>"}, {"owner": {"reputation": 21, "user_id": 6683808, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cs6jhvbuAAM/AAAAAAAAAAI/AAAAAAAAAZY/PtvAbe4O18Q/photo.jpg?sz=128", "display_name": "Carlos G&#243;mez", "link": "https://stackoverflow.com/users/6683808/carlos-g%c3%b3mez"}, "reply_to_user": {"reputation": 4630, "user_id": 160386, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b6044f355342bb055fbb03804d9673e3?s=128&d=identicon&r=PG", "display_name": "Jan Tojnar", "link": "https://stackoverflow.com/users/160386/jan-tojnar"}, "edited": false, "score": 0, "creation_date": 1483826399, "post_id": 41522485, "comment_id": 70260093, "body": "@JanTojnar Your comment was very helpful, thx. I fixed by adding another version of GCC in CircleCI."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 6683808, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cs6jhvbuAAM/AAAAAAAAAAI/AAAAAAAAAZY/PtvAbe4O18Q/photo.jpg?sz=128", "display_name": "Carlos G&#243;mez", "link": "https://stackoverflow.com/users/6683808/carlos-g%c3%b3mez"}, "is_accepted": false, "score": 1, "last_activity_date": 1483826775, "creation_date": 1483826775, "answer_id": 41527103, "question_id": 41522485, "link": "https://stackoverflow.com/questions/41522485/can-not-build-hakyll-with-circleci/41527103#41527103", "title": "Can not build Hakyll with CircleCI", "body": "<p>Thx to @JanTojnar I've been able to fix this by adding a different GCC in my CircleCI:</p>\n\n<pre><code>machine:\n   pre:\n     - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.6 20\n     - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.6 20\n     - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.9 10\n     - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.9 10\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 6683808, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cs6jhvbuAAM/AAAAAAAAAAI/AAAAAAAAAZY/PtvAbe4O18Q/photo.jpg?sz=128", "display_name": "Carlos G&#243;mez", "link": "https://stackoverflow.com/users/6683808/carlos-g%c3%b3mez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1483826775, "creation_date": 1483799363, "question_id": 41522485, "link": "https://stackoverflow.com/questions/41522485/can-not-build-hakyll-with-circleci", "title": "Can not build Hakyll with CircleCI", "body": "<p>I need help building Hakyll with CircleCI, I could not find much helper info about this error. The error seems to be on building dependency HsLua library, here is the stack logs I am getting:</p>\n\n<pre><code>...\n`ScriptingziLua_dbgI'\n/tmp/ghc14828_0/ghc_11.o:ghc_8.c:(.text+0x100): first defined here\n/tmp/ghc14828_0/ghc_11.o: In function `ScriptingziLua_dbgR':\nghc_8.c:(.text+0x190): multiple definition of `ScriptingziLua_dbgR'\n/tmp/ghc14828_0/ghc_11.o:ghc_8.c:(.text+0x190): first defined here\n/tmp/ghc14828_0/ghc_11.o: In function `ScriptingziLua_dbh0':\nghc_8.c:(.text+0x260): multiple definition of `ScriptingziLua_dbh0'\n/tmp/ghc14828_0/ghc_11.o:ghc_8.c:(.text+0x260): first defined here\ncollect2: error: ld returned 1 exit status\nstack build --only-dependencies returned exit code 1\n</code></pre>\n\n<p>I tried using stack haskell with lts-5.18, locally is working fine, and with CircleCI is failing on building the HsLua library. I also tried using a predefined GHC machine in CircleCI (version: 7.10.2) and Cabal, but same error.\nI will appreciate some help on this, thx.</p>\n"}, {"tags": ["haskell", "containers", "traversable"], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1484156940, "post_id": 41523456, "comment_id": 70397759, "body": "@WillNess Nah, you just need to check whether there&#39;s anything left in the input list after you&#39;ve finished traversing. I&#39;ll update my code"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1484157514, "post_id": 41523456, "comment_id": 70398066, "body": "@WillNess I think the questioneer wants to return <code>Nothing</code> if there aren&#39;t enough items in the list to fill up the <code>Traversable</code>. The idea is to keep the input <code>Traversable</code>&#39;s shape while pairing up each of the values"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1484159006, "post_id": 41523456, "comment_id": 70398829, "body": "ah, this makes sense. this means your previous version was indeed correct. :)  I&#39;ve restored your previous version, and added a clarifying example. sorry for this."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1484759236, "post_id": 41523456, "comment_id": 70645354, "body": "Perhaps &quot;use the state monad&quot; should be changed to &quot;use the state applicative&quot;, to emphasise the applicative instance of state is enough."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1484780072, "post_id": 41523456, "comment_id": 70656214, "body": "@duplode It&#39;s a tricky one. On the one hand, your suggestion uses more precise terminology, but on the other hand the term <i>state monad</i> is a more widely-recognised name for the concept (despite the fact that it&#39;s also an applicative functor), plus the phrase &quot;the state applicative&quot; doesn&#39;t trip off  the tongue as easily as &quot;the state monad&quot;. It&#39;s my answer so I&#39;ll use whatever word I want! \ud83d\ude1c"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1484781882, "post_id": 41523456, "comment_id": 70656798, "body": "That&#39;s fine; there is indeed a decent case for either option. I just made the suggestion because I&#39;m quite fond of <code>mapAccumL</code> as an example of the applicative instance of <code>State</code>."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 5, "last_activity_date": 1484158677, "last_edit_date": 1484158677, "creation_date": 1483805341, "answer_id": 41523456, "question_id": 41522422, "link": "https://stackoverflow.com/questions/41522422/whats-the-most-standard-generic-way-to-zip-a-traversable-with-a-list/41523456#41523456", "title": "What&#39;s the most standard/generic way to zip a traversable with a list?", "body": "<p>What about <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Traversable.html#v:mapAccumL\" rel=\"nofollow noreferrer\"><code>mapAccumL</code></a>/<a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Traversable.html#v:mapAccumL\" rel=\"nofollow noreferrer\"><code>mapAccumR</code></a>?</p>\n\n<pre><code>tzipWith :: Traversable t =&gt; (a -&gt; b -&gt; c) -&gt; [a] -&gt; t b -&gt; Maybe (t c)\ntzipWith f xs = sequenceA . snd . mapAccumL pair xs\n    where pair [] y = ([], Nothing)\n          pair (x:xs) y = (xs, Just (f x y))\n\ntzip :: Traversable t =&gt; [a] -&gt; t b -&gt; Maybe (t (a, b))\ntzip = tzipWith (,)\n\nghci&gt; tzip [1..] [4,5,6]\nJust [(1,4),(2,5),(3,6)]\n\nghci&gt; tzip [1,2] [4,5,6]\nNothing\n</code></pre>\n\n<p>On the question of efficiency - <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Traversable.html#mapAccumL\" rel=\"nofollow noreferrer\">under the hood</a> the <code>mapAccum</code> functions use the state monad, so all I've really done is capture the imperative part of your code in a higher-order function. I wouldn't expect this code to perform better than yours. But I don't think you can do much better than the <code>State</code> monad (or <code>ST</code>), given only <code>Traversable t</code>.</p>\n"}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1484158677, "creation_date": 1483798959, "question_id": 41522422, "link": "https://stackoverflow.com/questions/41522422/whats-the-most-standard-generic-way-to-zip-a-traversable-with-a-list", "title": "What&#39;s the most standard/generic way to zip a traversable with a list?", "body": "<p><code>Traversable</code> is in a sense the class of containers whose structure has a \u201cpath\u201d (that can correspond to a list), the elements on which can be modified without dissolving the structure. Hence</p>\n\n<pre><code>zipTrav :: Traversable t =&gt; t a -&gt; [b] -&gt; Maybe (t (a,b))\nzipTrav = evalStateT . traverse zp\n where zp a = do\n           bs &lt;- get\n           case bs of\n              [] -&gt; lift Nothing\n              (b:bs') -&gt; put bs' &gt;&gt; return (a,b)\n</code></pre>\n\n<p>However, that list-state traversal seems a bit hackish and likely not the most efficient way to do it. I'd suppose there would be a standard function that accomplished the above or a more general task, but I can't figure out what it would be.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1483804164, "post_id": 41522634, "comment_id": 70252303, "body": "Am I right that GHC is able to derive a Monoid instance for <code>Policy</code> because <code>Max a</code> is a Monoid and <code>x -&gt; Monoid y</code> is a Monoid. I can also derive my own ` instance: <code>(Policy a) `mappend` (Policy b) = Policy $ \\r -&gt; max (a r) (b r) </code>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1483804521, "post_id": 41522634, "comment_id": 70252418, "body": "Yes, though GHC will generate exactly the same code, so why bother writing it?"}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1483805437, "post_id": 41522634, "comment_id": 70252750, "body": "This is a very elegant solution. Thanks!"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 7, "last_activity_date": 1505221682, "last_edit_date": 1505221682, "creation_date": 1483800229, "answer_id": 41522634, "question_id": 41522159, "link": "https://stackoverflow.com/questions/41522159/typed-hierarchical-access-control-system/41522634#41522634", "title": "Typed Hierarchical Access Control System", "body": "<p>Anyone with access to <code>Policy</code>'s constructors can take a <code>Policy</code> apart and put it back together, possibly in a nonsensical fashion. Don't expose the <code>Policy</code> constructor outside of this module. Instead, provide a <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"nofollow noreferrer\"><em>smart constructor</em></a> to create policies that are guaranteed to be well-formed and expose a <code>Monoid</code> interface to compose them without breaking invariants. Keeping the <code>Policy</code> type abstract ensures that all the code which could result in nonsensical policies is kept inside this module.</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nmodule Policy (\n    Role(..),\n    Level(..),\n    Policy,  -- keep Policy abstract by not exposing the constructor\n    can\n    ) where\n\nimport Data.Semigroup (Semigroup, Max(..))\n\ndata Role = Public | Contributor | Owner\n    deriving (Eq, Ord, Bounded, Enum, Show, Read)\ndata Level = None | View | Edit\n    deriving (Eq, Ord, Bounded, Enum, Show, Read)\n</code></pre>\n\n<p>Below I'm using <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#generalised-derived-instances-for-newtypes\" rel=\"nofollow noreferrer\"><code>GeneralizedNewtypeDeriving</code></a> to borrow a pair of <code>Monoid</code> instances from <code>base</code>: <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-268\" rel=\"nofollow noreferrer\">the monoid for functions</a>, which lifts another monoid through the function arrow point-wise, and <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Semigroup.html#t:Max\" rel=\"nofollow noreferrer\">the <code>Max</code> newtype</a>, which turns an <code>Ord</code> instance into a <code>Monoid</code> instance by always choosing the larger of <code>mappend</code>'s arguments.</p>\n\n<p>So <code>Policy</code>'s <code>Monoid</code> instance will automatically manage the ordering of <code>Level</code> when composing policies: when composing two policies with conflicting levels at a given role we'll always choose the more permissive one. This makes <code>&lt;&gt;</code> an <em>additive</em> operation: you define policies by adding permissions to the \"default\" policy, <code>mempty</code>, which is the one which grants no permissions to anyone.</p>\n\n<pre><code>newtype Policy = Policy (Role -&gt; Max Level) deriving (Semigroup, Monoid)\n</code></pre>\n\n<p><code>grant</code> is a <em>smart constructor</em> which produces policies which respect the ordering properties of <code>Role</code> and <code>Level</code>. Note that I'm comparing roles with <code>&gt;=</code> to ensure that granting a permission to a role also grants that permission to more privileged roles.</p>\n\n<pre><code>grant :: Role -&gt; Level -&gt; Policy\ngrant r l = Policy (Max . pol)\n    where pol r'\n            | r' &gt;= r   = l\n            | otherwise = None\n</code></pre>\n\n<p><code>can</code> is an <em>observation</em> which tells you whether a policy grants a given access level to a given role. Once more I'm using <code>&gt;=</code> to ensure that more-permissive levels imply less-permissive ones.</p>\n\n<pre><code>can :: Role -&gt; Level -&gt; Policy -&gt; Bool\n(r `can` l) (Policy f) = getMax (f r) &gt;= l\n</code></pre>\n\n<p>I was pleasantly surprised by how little code this module took! Leaning on the <code>deriving</code> mechanism, especially <code>GeneralizedNewtypeDeriving</code>, is a really nice way of putting the types in charge of \"boring\" code so you can focus on the important stuff.</p>\n\n<hr>\n\n<p>Usage of these policies looks like this:</p>\n\n<pre><code>module Client where\n\nimport Data.Monoid ((&lt;&gt;))\nimport Policy\n</code></pre>\n\n<p>You can use the <code>Monoid</code> class to build complex policies out of simple ones.</p>\n\n<pre><code>ownerEdit, contributorView, myPolicy :: Policy\n\nownerEdit = grant Owner Edit\ncontributorView = grant Contributor View\nmyPolicy = ownerEdit &lt;&gt; contributorView\n</code></pre>\n\n<p>And you can use the <code>can</code> function to test policies.</p>\n\n<pre><code>canPublicView :: Policy -&gt; Bool\ncanPublicView = Public `can` View\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>ghci&gt; canPublicView myPolicy\nFalse\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1483829713, "post_id": 41523984, "comment_id": 70260942, "body": "excellent comparison. still juggling with the static / dynamic design space"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1483868702, "last_edit_date": 1483868702, "creation_date": 1483808222, "answer_id": 41523984, "question_id": 41522159, "link": "https://stackoverflow.com/questions/41522159/typed-hierarchical-access-control-system/41523984#41523984", "title": "Typed Hierarchical Access Control System", "body": "<p>Benjamin Hodgson's solution is simpler and more elegant, but here's a type-level programming solution, using the machinery of the <code>singletons</code> package.</p>\n\n<p>The idea is that policies are represented as type-level lists of <code>(Role, Operation)</code> tuples, where both the <code>Role</code>s and the <code>Operation</code>s must be nondecreasing across the list. That way, we can't have an absurd <code>[(Public,Edit),(Owner,View)]</code> permission.</p>\n\n<p>Some required extensions and imports:</p>\n\n<pre><code>{-# language PolyKinds #-}\n{-# language DataKinds #-}\n{-# language TypeFamilies #-}\n{-# language GADTs #-}\n{-# language TypeOperators #-}\n{-# language UndecidableInstances #-}\n{-# language FlexibleInstances #-}\n{-# language ScopedTypeVariables #-}\n{-# language TemplateHaskell #-}\n\nimport Data.Singletons\nimport Data.Singletons.TH\nimport Data.Promotion.Prelude (Unzip)\n</code></pre>\n\n<p>We declare the datatypes and singletonize them using Template Haskell:</p>\n\n<pre><code>data Role = Public | Contributor | Owner deriving (Show,Eq,Ord)\ndata Operation = None | View | Edit deriving (Show,Eq,Ord)\n$(genSingletons       [''Role,''Operation])\n$(promoteEqInstances  [''Role,''Operation])\n$(promoteOrdInstances [''Role,''Operation])\n</code></pre>\n\n<p>A class for lists with nondecreasing elements:</p>\n\n<pre><code>class Monotone (xs :: [k])\ninstance Monotone '[]\ninstance Monotone (x ': '[])\ninstance ((x :&lt;= y) ~ True, Monotone (y ': xs)) =&gt; Monotone (x ': y ': xs)\n</code></pre>\n\n<p>Given a policy specified as a type-level list, return the policy function:</p>\n\n<pre><code>policy :: forall (xs :: [(Role, Operation)]) rs os. \n             (Unzip xs ~ '(rs,os), Monotone rs, Monotone os) \n       =&gt; Sing xs\n       -&gt; Role \n       -&gt; Operation\npolicy singleton role = \n    let decreasing = reverse (fromSing singleton)\n        allowed = dropWhile (\\(role',_) -&gt; role' &gt; role) decreasing\n    in case allowed of\n        [] -&gt; None\n        (_,perm) : _ -&gt; perm\n</code></pre>\n\n<p>Testing it in ghci:</p>\n\n<pre><code>ghci&gt; :set -XDataKinds -XPolyKinds -XTypeApplications\nghci&gt; policy (sing::Sing '[ '(Public,View),'(Owner,Edit) ]) Owner\nEdit\nghci&gt; policy (sing::Sing '[ '(Public,Edit),'(Owner,View) ]) Owner\n*unhelpful type error*\n</code></pre>\n"}], "owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 2, "accepted_answer_id": 41522634, "answer_count": 2, "score": 7, "last_activity_date": 1505221682, "creation_date": 1483797054, "question_id": 41522159, "link": "https://stackoverflow.com/questions/41522159/typed-hierarchical-access-control-system", "title": "Typed Hierarchical Access Control System", "body": "<p>How can I define a simple hierarchical access control system in Haskell?</p>\n\n<p>My roles are <code>Public &gt; Contributor &gt; Owner</code>, these roles are in a hierarchy. Everything that can be done by <code>Public</code> can also be done by <code>Contributor</code> and <code>Owner</code>; and so on.</p>\n\n<p>Similarly Operations are also in a hierarchy: <code>None &gt; View &gt; Edit</code>. If a Role is permitted to Edit, it should also be able to View.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Role = Public | Contributor | Owner\ndata Operation = None | View | Edit\n\nnewtype Policy = Policy (Role -&gt; Operation)\n</code></pre>\n\n<p>In this system I can express public editable policy as:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>publicEditable :: Policy\npublicEditable = Policy $ const Edit\n</code></pre>\n\n<p>But type system does not prevent me from defining stupid policies like this (that permits <code>Public</code> to <code>Edit</code> but denies any access to the <code>Owner</code>):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>stupidPolicy :: Policy\nstupidPolicy = Policy check where\n  check Public      = Edit\n  check Contributor = View\n  check Owner       = None\n</code></pre>\n\n<p>How can I express the hierarchical nature of Role and Operation in the type system?</p>\n"}, {"tags": ["haskell", "haddock"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1483793342, "post_id": 41521511, "comment_id": 70248992, "body": "I don&#39;t think there is any proper support for tables. You may have to make do with an image file."}, {"owner": {"reputation": 1593, "user_id": 1829442, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f1b88b650cc161e532273962f4017f75?s=128&d=identicon&r=PG", "display_name": "idontgetoutmuch", "link": "https://stackoverflow.com/users/1829442/idontgetoutmuch"}, "edited": false, "score": 0, "creation_date": 1483795392, "post_id": 41521511, "comment_id": 70249586, "body": "There is now mathjax support in haddock so it may be possible to create a table using e.g. \\begin{matrix} and \\mathrm{...} - a bit rubbish but possibly better than an image file. Alternatively, you could add table support to haddock - the code is not difficult to modify but you&#39;d have to worry about output formats other than html."}], "answers": [{"tags": [], "owner": {"reputation": 3287, "user_id": 341061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f01669013eac8b56559066aab4a0817?s=128&d=identicon&r=PG", "display_name": "Giovanni Cappellotto", "link": "https://stackoverflow.com/users/341061/giovanni-cappellotto"}, "is_accepted": false, "score": 1, "last_activity_date": 1483819594, "creation_date": 1483819594, "answer_id": 41525942, "question_id": 41521511, "link": "https://stackoverflow.com/questions/41521511/how-to-generate-a-table-in-haddock-documentation/41525942#41525942", "title": "How to generate a table in Haddock documentation", "body": "<p><a href=\"https://github.com/haskell/haddock/blob/haddock-2.17.3-release/haddock-library/src/Documentation/Haddock/Types.hs#L56-L80\" rel=\"nofollow noreferrer\">Haddock \"markup\"</a> doesn't currently support tables, see also <a href=\"https://www.haskell.org/haddock/doc/html/ch03s08.html\" rel=\"nofollow noreferrer\">Haddock User Guide - Chapter 3. Documentation and Markup</a>. There is an <a href=\"https://github.com/haskell/haddock/issues/530\" rel=\"nofollow noreferrer\">open issue</a> to add support for simple tables.</p>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1525795746, "creation_date": 1525795746, "answer_id": 50238002, "question_id": 41521511, "link": "https://stackoverflow.com/questions/41521511/how-to-generate-a-table-in-haddock-documentation/50238002#50238002", "title": "How to generate a table in Haddock documentation", "body": "<p>Haddock bundled with GHC 8.4 or newer (Haddock version >= 2.18.2) supports tables. As per <a href=\"https://github.com/haskell/haddock/pull/718\" rel=\"noreferrer\">the pull request where this was added</a>, the syntax is based on <a href=\"http://docutils.sourceforge.net/docs/ref/rst/restructuredtext.html#grid-tables\" rel=\"noreferrer\">RST Grid tables</a>.</p>\n\n<h1>Sample use:</h1>\n\n<pre><code>module Sample where\n\n-- | A table:\n--\n-- +------------------------+------------+----------+----------+\n-- | Header row, column 1   | Header 2   | Header 3 | Header 4 |\n-- | (header rows optional) |            |          |          |\n-- +========================+============+==========+==========+\n-- | body row 1, column 1   | column 2   | column 3 | column 4 |\n-- +------------------------+------------+----------+----------+\n-- | body row 2             | Cells may span columns.          |\n-- +------------------------+------------+---------------------+\n-- | body row 3             | Cells may  | \\[                  |\n-- +------------------------+ span rows. | f(n) = \\sum_{i=1}   |\n-- | body row 4             |            | \\]                  |\n-- +------------------------+------------+---------------------+\nsample :: ()\nsample = ()\n</code></pre>\n\n<p>Turns into </p>\n\n<p><a href=\"https://i.stack.imgur.com/rQ89U.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/rQ89U.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 1, "accepted_answer_id": 50238002, "answer_count": 2, "score": 3, "last_activity_date": 1525795746, "creation_date": 1483792626, "question_id": 41521511, "link": "https://stackoverflow.com/questions/41521511/how-to-generate-a-table-in-haddock-documentation", "title": "How to generate a table in Haddock documentation", "body": "<p>I am writing some documentation with Haddock, and I need to put a multi-column table with some values in it. How can I do it with Haddock? I cannot find info about it. Embedding some html as alternative looks no possible too.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1483760443, "post_id": 41517506, "comment_id": 70241373, "body": "Searching for <i>ghc loop</i> gives a few relevant results, including <a href=\"http://stackoverflow.com/q/21505192/2751851\"><i>Haskell program outputs `&lt;&lt;loop&gt;&gt;`</i></a> and <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2013-June/108826.html\" rel=\"nofollow noreferrer\">this Haskell Cafe message</a>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1483776430, "post_id": 41517506, "comment_id": 70244475, "body": "Despite the halting problem, it is clearly possible to detect non-termination in a limited amount of cases (i.e. an algorithm which proves a program is non-terminating or fails with no answer after a finite amount of time is possible). In short, <code>&lt;&lt;loop&gt;&gt;</code> means that GHC found an expression of the form <code>let x = x in x</code> after simplification, and rewrote it to <code>throw ..</code> where <code>..</code> is a special exception which produces the message you see when evaluated - I can&#39;t recall what this exception is called, but you may not catch it."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 6, "creation_date": 1483777893, "post_id": 41517506, "comment_id": 70244779, "body": "@user2407038 I don&#39;t believe that&#39;s true.  I&#39;m pretty sure that <code>&lt;&lt;loop&gt;&gt;</code> detection is entirely at runtime, and detects any case of a value depending on itself, not just being trivially defined as itself."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1483780085, "post_id": 41517506, "comment_id": 70245283, "body": "AFAIK GHC raises a <code>&lt;&lt;loop&gt;&gt;</code> whenever, when evaluating a thunk, it finds that it has to evalute the very same thunk to obtain a value. This is more general than what @user2407038 describes. Itis possible to catch many cases of non-termination, the halting problem simply says that we cannot catch <i>all</i> of them."}], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1483796815, "post_id": 41520758, "comment_id": 70249988, "body": "A small correction: when a thread enters a black hole, it puts itself on a list of threads to be woken up and blocks (returns to the scheduler). After all another thread might be in the middle of evaluating the same thunk we wanted to evaluate. GHC sends the <code>&lt;&lt;loop&gt;&gt;</code> exception when it detects a deadlock."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1483787278, "creation_date": 1483787278, "answer_id": 41520758, "question_id": 41517506, "link": "https://stackoverflow.com/questions/41517506/how-does-the-loop-error-work-in-detail/41520758#41520758", "title": "How does the &lt;&lt;loop&gt;&gt; error &quot;work&quot; in detail?", "body": "<p>This is a simple \"improvement\" of the STG runtime which was implemented in GHC. I'll share what I have understood, but GHC experts can likely provide more useful and accurate information.</p>\n\n<p>GHC compiles to an intermediate language called Core, after having done several optimizations. You can see it using <code>ghc -ddump-simpl ...</code></p>\n\n<p>Very roughly, in Core, an unevaluated binding (like <code>let x = 1+y+x in f x</code>) creates a thunk. Some memory is allocated somewhere to represent the closure, and <code>x</code> is made to point at it.</p>\n\n<p>When (and if) <code>x</code> is forced by <code>f</code>, then the thunk is evaluated. Here's the improvement: before the evaluation starts, the thunk of <code>x</code> is overwritten with a special value called <code>BLACKHOLE</code>. After <code>x</code> is evaluated (to WHNF) then the black hole is again overwritten with the actual value (so we don't recompute it if e.g. <code>f x = x+x</code>).</p>\n\n<p>If the black hole is ever forced, <code>&lt;&lt;loop&gt;&gt;</code> is triggered. This is actually an IO exception (those can be raised in pure code, too, so this is fine).</p>\n\n<p>Examples:</p>\n\n<pre><code>let x = 1+x in 2*x          -- &lt;&lt;loop&gt;&gt;\nlet g x = g (x+1) in  g 0   -- diverges\nlet h x = h (10-x) in h 0   -- diverges, even if h 0 -&gt; h 10 -&gt; h 0 -&gt; ...\nlet g0 = g10 ; g10 = g0 in g0   -- &lt;&lt;loop&gt;&gt;\n</code></pre>\n\n<p>Note that each call of <code>h 0</code> is considered a distinct thunk, hence no black hole is forced there.</p>\n\n<p>The tricky part is that it's not completely trivial to understand which thunks are actually created in Core since GHC can perform several optimizations before emitting Core. Hence, we should regard <code>&lt;&lt;loop&gt;&gt;</code> as a bonus, not as a given / hard guarantee by GHC. New optimizations in the future might replace some <code>&lt;&lt;loop&gt;&gt;</code>s with actual non-termination.</p>\n\n<p>If you want to google something, \"GHC, blackhole, STG\" should be good keywords.</p>\n"}], "owner": {"reputation": 2044, "user_id": 1258491, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/yyvEu.png?s=128&g=1", "display_name": "metaleap", "link": "https://stackoverflow.com/users/1258491/metaleap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "accepted_answer_id": 41520758, "answer_count": 1, "score": 9, "last_activity_date": 1483787278, "creation_date": 1483759791, "question_id": 41517506, "link": "https://stackoverflow.com/questions/41517506/how-does-the-loop-error-work-in-detail", "title": "How does the &lt;&lt;loop&gt;&gt; error &quot;work&quot; in detail?", "body": "<p>I'm working on this tool where the user can define-and-include in [config files | content text-files | etc] their own \"templates\" (like mustache etc) and these can reference others so they can induce a loop. Just when I was about to create a \"max-loops\" setting I realized with runghc the program after a while just quits with farewell message of just <code>&lt;&lt;loop&gt;&gt;</code>. That's actually good enough for me but raises a few ponderations:</p>\n\n<ul>\n<li><p>how does GHC or the runtime actually detect it's stuck in a loop, and how would it distinguish between a wanted long-running operation and an accidental infinite loop? The halting problem is still a thing last I checked..</p></li>\n<li><p>any (time or iteration) limits that can be custom-set to the compiler or the runtime?</p></li>\n<li><p>is this <code>runghc</code>-only or does it exist in all final compile outputs?</p></li>\n<li><p>will any <code>-o</code> (optimization) flags set much later when building releases disable this apparent built-in loop detection?</p></li>\n</ul>\n\n<p>All stuff I can figure out the hard way of course, but who knows maybe someone already looked into this in more detail.. (hard to google/ddg for <code>\"haskell\" \"&lt;&lt;loop&gt;&gt;\"</code> because they strip the angle brackets and then show results for \"how to loop in Haskell\" etc..)</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1483743493, "post_id": 41515695, "comment_id": 70237457, "body": "I don&#39;t understand this question at all."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1483743975, "post_id": 41515695, "comment_id": 70237618, "body": "&quot;Intuitively, I&#39;m afraid of subtle coupling between the nested lambdas.&quot; -- Could you say a bit more on what you are worried with?"}, {"owner": {"reputation": 932, "user_id": 730606, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/6c007d88f3e1d6ddac17f453d2962c13?s=128&d=identicon&r=PG", "display_name": "Polymer", "link": "https://stackoverflow.com/users/730606/polymer"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1483751607, "post_id": 41515695, "comment_id": 70239935, "body": "@duplode Does my edit clarify my worry?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1483756248, "post_id": 41515695, "comment_id": 70240760, "body": "It does; I added an answer which focuses on it."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1483745829, "post_id": 41515978, "comment_id": 70238310, "body": "Honestly, I&#39;m not sure quite what relation between <code>f &lt;$&gt; x &lt;*&gt; y</code> and <code>flip f &lt;$&gt; y &lt;*&gt; x</code> the applicative laws imply; I&#39;m pretty sure they say <i>something</i> about that symmetry but I&#39;ve always had trouble properly understanding those laws."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1483747436, "post_id": 41515978, "comment_id": 70238854, "body": "Regarding your comment: <code>State</code> is a counterexample of the sameness of values between <code>f &lt;$&gt; x &lt;*&gt; y</code> and <code>flip f &lt;$&gt; y &lt;*&gt; x</code> -- for instance, <code>runState ((&#47;) &lt;$&gt; state ((2*) &amp;&amp;&amp; (3*)) &lt;*&gt; state ((+4) &amp;&amp;&amp; (subtract 3))) 1</code> is <code>(1&#47;7, 0)</code>, but <code>runState (flip (&#47;) &lt;$&gt; state ((+4) &amp;&amp;&amp; (subtract 3)) &lt;*&gt; state ((2*) &amp;&amp;&amp; (3*))) 1</code> is <code>(-4&#47;5, -6)</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1483753630, "post_id": 41515978, "comment_id": 70240362, "body": "More generally, the <code>Applicative</code> interface does not itself enable dependence between effects, but its existence does not prevent such dependence either. I think <code>StateT</code> may get at this even better than <code>State</code>, as it allows practically arbitrary dependence."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1483747543, "last_edit_date": 1483747543, "creation_date": 1483745009, "answer_id": 41515978, "question_id": 41515695, "link": "https://stackoverflow.com/questions/41515695/what-can-be-proved-about-parameters-in-lambda-expressions-passed-into-monads/41515978#41515978", "title": "What can be proved about parameters in lambda expressions, passed into monads?", "body": "<p>No, there aren't any restrictions. Once you've bound a lambda you can do <a href=\"https://en.wikipedia.org/wiki/Turing_completeness\" rel=\"nofollow noreferrer\">anything</a>. This is one of the reasons of <code>Applicative</code> being preferrable to <code>Monad</code> <em>because it's weaker</em> (and hence gives you stronger free-theorem restrictions).</p>\n\n<pre><code> ( [1,2] &gt;&gt;= \\n -&gt; \"ab\" &gt;&gt;= \\ch -&gt; return (n,ch) )\n   \u2261  (,) &lt;$&gt; [1,2] &lt;*&gt; \"ab\"\n   \u2261  liftA2 (,) [1,2] \"ab\"\n   \u2248  liftA2 (flip (,)) \"ab\" [1,2]\n</code></pre>\n\n<p>The last is actually not a proper equation; the applicative laws only <del>guarantee that the <em>values</em> will be the same for these expressions</del><sup>See comments</sup>, but the <em>structure</em> can and will be different.</p>\n\n<pre><code>Prelude Control.Applicative&gt; liftA2 (,) [1,2] \"ab\"\n[(1,'a'),(1,'b'),(2,'a'),(2,'b')]\nPrelude Control.Applicative&gt; liftA2 (flip (,)) \"ab\" [1,2]\n[(1,'a'),(2,'a'),(1,'b'),(2,'b')]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1483820257, "last_edit_date": 1483820257, "creation_date": 1483755840, "answer_id": 41517173, "question_id": 41515695, "link": "https://stackoverflow.com/questions/41515695/what-can-be-proved-about-parameters-in-lambda-expressions-passed-into-monads/41517173#41517173", "title": "What can be proved about parameters in lambda expressions, passed into monads?", "body": "<p>Addressing your edit, in which you consider how to write...</p>\n\n<blockquote>\n<pre><code>\\a -&gt; g a &gt;&gt;= \\b -&gt; f a b\n</code></pre>\n</blockquote>\n\n<p>... using <code>(&gt;=&gt;)</code>, nothing is actually lost in that case. It is helpful to take a step back and consider exactly how <code>(&gt;=&gt;)</code> can be converted into <code>(&gt;&gt;=)</code> and vice-versa:</p>\n\n<pre><code>f &gt;=&gt; g = \\x -&gt; f x &gt;&gt;= g\nm &gt;&gt;= f = (const m &gt;=&gt; f) () -- const x = \\_ -&gt; x\n</code></pre>\n\n<p>In the second equation, which is the one related to your concerns, we turn the first argument to <code>(&gt;&gt;=)</code> into a function which can be passed to <code>(&gt;=&gt;)</code> by using <code>const</code>. As <code>const m &gt;=&gt; f</code> is a functions which ignores its argument, we just pass <code>()</code> as a dummy argument in order to recover <code>(&gt;&gt;=)</code>.</p>\n\n<p>That being so, your example can be rewritten by using the second equation:</p>\n\n<pre><code>\\a -&gt; g a &gt;&gt;= \\b -&gt; f a b\n\\a -&gt; (const (g a) &gt;=&gt; \\b -&gt; f a b) ()\n\\a -&gt; (const (g a) &gt;=&gt; f a) ()\n</code></pre>\n\n<p>Which, except for the added trick of supplying a dummy <code>()</code>, is what you had obtained in your question. </p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 2, "last_activity_date": 1483784473, "creation_date": 1483784473, "answer_id": 41520333, "question_id": 41515695, "link": "https://stackoverflow.com/questions/41515695/what-can-be-proved-about-parameters-in-lambda-expressions-passed-into-monads/41520333#41520333", "title": "What can be proved about parameters in lambda expressions, passed into monads?", "body": "<p>An additional idea to your question: Monads are most general in the sense that effects can depend on inputs. A monadic computation <code>m</code> that takes input <code>a</code> and produces output <code>b</code> can be written as <code>a -&gt; m b</code>. As this is a function, we (can) define such computations using lambdas, which can naturally span fo the right. But this generality complicates analyzing computations as your <code>\\a -&gt; g a &gt;&gt;= \\b -&gt; f a b</code>.</p>\n\n<p>For <a href=\"https://www.haskell.org/arrows/\" rel=\"nofollow noreferrer\">arrows</a> (which occupy the space between applicative functors and monads) the situation is somewhat different. For a general arrow, the input must be explicit - an arrow computation <code>arr</code> has the general type of <code>arr a b</code>. And so an input that spans \"forward\" in an arrow computation must be explicitly threaded there using Arrow primitives.</p>\n\n<p>To expand your example</p>\n\n<pre><code>{-# LANGUAGE Arrows #-}\n\nimport Control.Arrow\n\nbind2 :: (Monad m) =&gt; (a -&gt; m b) -&gt; (a -&gt; b -&gt; m c) -&gt; a -&gt; m c\nbind2 g f = \\a -&gt; g a &gt;&gt;= \\b -&gt; f a b\n</code></pre>\n\n<p>to arrows: Function <code>f</code> must now take a pair as its input (because arrows are defined as accepting one input value). Using the arrow <code>do</code> notation we can express it as</p>\n\n<pre><code>bind2A :: (Arrow arr) =&gt; arr a b -&gt; arr (a, b) c -&gt; arr a c\nbind2A g f = proc a -&gt; do\n                b &lt;- g -&lt; a\n                c &lt;- f -&lt; (a, b)\n                returnA -&lt; c\n</code></pre>\n\n<p>Or even simpler using the <code>Arrow</code> primitives:</p>\n\n<pre><code>bind2A' :: (Arrow arr) =&gt; arr a b -&gt; arr (a, b) c -&gt; arr a c\nbind2A' g f = (returnA &amp;&amp;&amp; g) &gt;&gt;&gt; f\n</code></pre>\n\n<p>Graphically:</p>\n\n<pre><code>---------------&gt;[   ]\n   \\            [ f ]----&gt;\n    \\--&gt;[ g ]--&gt;[   ]\n</code></pre>\n\n<p>Being less general, arrows allow to infer more information about a circuit before it's actually executed. A nice reading is <a href=\"https://en.wikibooks.org/wiki/Haskell/Understanding_arrows\" rel=\"nofollow noreferrer\">Understanding arrows</a>, which describes the original motivation behind them - to construct parsers that can can avoid space leaks by having static and dynamic parts.</p>\n"}], "owner": {"reputation": 932, "user_id": 730606, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/6c007d88f3e1d6ddac17f453d2962c13?s=128&d=identicon&r=PG", "display_name": "Polymer", "link": "https://stackoverflow.com/users/730606/polymer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 41515978, "answer_count": 3, "score": 0, "last_activity_date": 1483820257, "creation_date": 1483743322, "last_edit_date": 1483752581, "question_id": 41515695, "link": "https://stackoverflow.com/questions/41515695/what-can-be-proved-about-parameters-in-lambda-expressions-passed-into-monads", "title": "What can be proved about parameters in lambda expressions, passed into monads?", "body": "<p>Relative to the fish operator, Monads satisfy associativity.</p>\n\n<pre><code>(h &gt;=&gt; g) &gt;=&gt; f = h &gt;=&gt; ( g &gt;=&gt; f)\n</code></pre>\n\n<p>This translated to bind (with lambda expressions) looks like,</p>\n\n<pre><code>\\a -&gt; h a &gt;&gt;=(\\b -&gt; g b &gt;&gt;= \\c -&gt; f c) = \n\\a -&gt;(h a &gt;&gt;= \\b -&gt; g b)&gt;&gt;= \\c -&gt; f c\n</code></pre>\n\n<p>which means the following equation is unambiguous</p>\n\n<pre><code>( a -&gt; h a &gt;&gt;= \\b -&gt; g b &gt;&gt;= \\c -&gt; f c ) =  h &gt;=&gt; g &gt;=&gt; f\n</code></pre>\n\n<p>This is a nice way to understand Monadic composition.</p>\n\n<p>However not all Monadic code keeps the bound variables to the lambdas separated. For example,</p>\n\n<pre><code>[1,2] &gt;&gt;= \\n -&gt; ['a','b'] &gt;&gt;= \\ch -&gt; return (n,ch) = \n[(1,'a'),(1,'b'),(2,'a'),(2,'b')]\n</code></pre>\n\n<p>The \"n\" in the return was obtained from the top lambda. </p>\n\n<p>More generally,</p>\n\n<pre><code>a -&gt; g a &gt;&gt;= \\b -&gt; f a b\n</code></pre>\n\n<p>f depends on both a and b in the above. Defining the above in terms of f, g, and (>=>) gives</p>\n\n<pre><code>\\a -&gt; (\\x -&gt; g a) &gt;=&gt; f a \n</code></pre>\n\n<p>Which I don't understand very well. It doesn't match the above equation I showed very well. I see fish as the fundamental notion here, and I'm trying to understand how it interacts with typical Monads I write. I would like to understand the above better.</p>\n\n<p>One way of approaching this is by trying to obtain meaning from List expression syntax</p>\n\n<pre><code>[ (n,ch) | n &lt;- [1, 2], ch &lt;- ['a', 'b'] ]\n</code></pre>\n\n<p>I think this implies a kind of symmetry.</p>\n\n<p>Are there any nice symmetries connecting lambda expressions and Monads? Or am I reading too much into this? Is my fear of highly nested lambda expressions wrong or reasonable?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 13, "last_activity_date": 1575694800, "last_edit_date": 1575694800, "creation_date": 1483740772, "answer_id": 41515203, "question_id": 41514951, "link": "https://stackoverflow.com/questions/41514951/how-can-i-untangle-multiple-maybes-nested-at-different-levels/41515203#41515203", "title": "How can I untangle multiple Maybes nested at different levels?", "body": "<p>This is pretty simple written with <code>do</code> notation:</p>\n\n<pre><code>fubar :: String -&gt; Maybe (Prefix, URL)\nfubar url = do\n  u &lt;- parseURI url\n  scheme &lt;- uriScheme u\n  authority &lt;- uriAuthority u\n  return (scheme ++ \"//\" ++ uriRegName authority, url)\n</code></pre>\n\n<p>Monads in general (and Maybe in particular) are all about combining <code>m (m a)</code> into <code>m a</code>. Each <code>&lt;-</code> binding is an alternate syntax for a call to <code>&gt;&gt;=</code>, the operator responsible for aborting if it sees a Nothing, and otherwise unwrapping the Just for you.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1483740781, "creation_date": 1483740781, "answer_id": 41515204, "question_id": 41514951, "link": "https://stackoverflow.com/questions/41514951/how-can-i-untangle-multiple-maybes-nested-at-different-levels/41515204#41515204", "title": "How can I untangle multiple Maybes nested at different levels?", "body": "<p>First note that you're just stacking multiple <code>fmap</code>s there, with <code>\u03b1 &lt;$&gt; (fmap \u03b2 (\u03b3 &lt;$&gt; uriAuthority u))</code>. This can (functor laws!) be rewritten <code>\u03b1 . \u03b2 . \u03b3 &lt;$&gt; uriAuthority u</code>, i.e.</p>\n\n<pre><code>{-# LANGUAGE TupleSections #-}\n\n   ...\n    Just u -&gt; (,url) . ((uriScheme u++\"//\") ++ ) . uriRegName &lt;$&gt; uriAuthority u\n</code></pre>\n\n<p>It might be better for legibility to actually keep the layers separate, but then you should also give them names as amalloy suggests.</p>\n\n<p>Further, more strongly:</p>\n\n<blockquote>\n  <p>Extract multiple nested <code>M</code> into one, final <code>M</code></p>\n</blockquote>\n\n<p>Well, sounds like monads, doesn't it?</p>\n\n<pre><code>fubar url = do\n   u &lt;- parseURI url\n   (,url) . ((uriScheme u++\"//\") ++ ) . uriRegName &lt;$&gt; uriAuthority u\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 2430, "user_id": 1525842, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95abedfeb09f68271233421d1aafb3be?s=128&d=identicon&r=PG", "display_name": "zeronone", "link": "https://stackoverflow.com/users/1525842/zeronone"}, "edited": false, "score": 0, "creation_date": 1483843738, "post_id": 41515289, "comment_id": 70263699, "body": "@zeronone, ah yes, that&#39;s nice, didn&#39;t notice that way"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 3, "last_activity_date": 1483741237, "creation_date": 1483741237, "answer_id": 41515289, "question_id": 41514951, "link": "https://stackoverflow.com/questions/41514951/how-can-i-untangle-multiple-maybes-nested-at-different-levels/41515289#41515289", "title": "How can I untangle multiple Maybes nested at different levels?", "body": "<p>I'm not entirely clear on precisely what you're asking, but I'll do my best to answer the questions you have presented.</p>\n\n<p>To extract multiple nested <code>Maybe</code>s into a single final <code>Maybe</code> is taken care of by <code>Maybe</code>'s monad-nature (also applicative-nature).  How specifically to do it depends on how they are nested.  </p>\n\n<p>Simplest example:</p>\n\n<pre><code>Control.Monad.join :: (Monad m) =&gt; m (m a) -&gt; m a\n-- thus \nControl.Monad.join :: Maybe (Maybe a) -&gt; Maybe a\n</code></pre>\n\n<p>A tuple:</p>\n\n<pre><code>squishTuple :: (Maybe a, Maybe b) -&gt; Maybe (a,b)\nsquishTuple (ma, mb) = do  -- do in Maybe monad\n    a &lt;- ma\n    b &lt;- mb\n    return (a,b)\n\n-- or\nsquishTuple (ma, mb) = liftA2 (,) ma mb\n</code></pre>\n\n<p>A list:</p>\n\n<pre><code>sequenceA :: (Applicative f, Traversable t) =&gt; t (f a) -&gt; f (t a)\n-- thus\nsequenceA :: [Maybe a] -&gt; Maybe [a]\n-- (where t = [], f = Maybe)\n</code></pre>\n\n<p>Other structures can be flattened by composing these and following the types.  For example:</p>\n\n<pre><code>flattenComplexThing :: (Maybe a, [Maybe (Maybe b)]) -&gt; Maybe (a, [b])\nflattenComplexThing (ma, mbs) = do\n    a &lt;- ma\n    bs &lt;- (join . fmap sequenceA . sequenceA) mbs\n    return (a, bs)\n</code></pre>\n\n<p>That <code>join . fmap sequenceA . sequenceA</code> line is a bit complex, and it takes some getting used to to know how to construct things like this.  My brain works in a very type-directed way (read the composition right-to-left):</p>\n\n<pre><code>[Maybe (Maybe b)]\n      |\n   sequenceA :: [Maybe _] -&gt; Maybe [_]\n      \u2193\nMaybe [Maybe b]\n      |\n    -- sequenceA :: [Maybe b] -&gt; Maybe [b]\n    -- fmap f  makes the function f work \"inside\" the Maybe, so\n   fmap sequenceA :: Maybe [Maybe b] -&gt; Maybe (Maybe [b])\n      \u2193\nMaybe (Maybe [b])\n      |\n   join :: Maybe (Maybe _) -&gt; Maybe _\n      \u2193\nMaybe [b]\n</code></pre>\n\n<hr>\n\n<p>As for the second question, how to do an <code>a -&gt; b -&gt; IO ()</code> when you have <code>Maybe a</code> and <code>Maybe b</code>, presuming you don't want to do the action at all in the case that either one is <code>Nothing</code>, you just do some gymnastics:</p>\n\n<pre><code>conditional :: (a -&gt; IO ()) -&gt; Maybe a -&gt; IO ()\nconditional = maybe (return ())\n\nconditional2 :: (a -&gt; b -&gt; IO ()) -&gt; Maybe a -&gt; Maybe b -&gt; IO ()\nconditional2 f ma mb = conditional (uncurry f) (liftA2 (,) ma mb)\n</code></pre>\n\n<p>Again I found <code>conditional2</code> in a mainly type-directed way in my mind.</p>\n\n<p>It takes some time to develop your type gymnastics, but then it starts to get really fun.  To make code like this readable, it's important to use helper functions, e.g. <code>conditional</code> above, and name them well (which is arguable about <code>conditional</code> :-).  You'll gradually get familiar with the standard library's helpers.  There's no magic bullet here, you just have to get used to it -- it's a language.  Work with it, strive for clarity, if something is too ugly try your best to make it prettier.  And ask more specific questions :-)</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 426, "favorite_count": 0, "accepted_answer_id": 41515203, "answer_count": 3, "score": 1, "last_activity_date": 1575694800, "creation_date": 1483739595, "question_id": 41514951, "link": "https://stackoverflow.com/questions/41514951/how-can-i-untangle-multiple-maybes-nested-at-different-levels", "title": "How can I untangle multiple Maybes nested at different levels?", "body": "<p>Working with <code>Maybe</code> seems really difficult in Haskell. I was able to implement the function I need after many frustrating compile errors, but it's still completely disorganized and I don't know how else can I improve it.</p>\n\n<p>I need to:</p>\n\n<ul>\n<li>extract multiple nested <code>... Maybe</code>s into one, final <code>Maybe ...</code></li>\n<li>Do <code>a -&gt; b -&gt; IO ()</code> with <code>Just a</code> and <code>Just b</code> or nothing (*)</li>\n</ul>\n\n<p>Here is example with <code>IO</code> part removed. I need <code>a -&gt; b -&gt; IO ()</code>, not <code>(a,b) -&gt; IO ()</code> later but I couldn't figure out how to pass both arguments otherwise (I can <code>mapM_</code> with one argument only).</p>\n\n<pre><code>import Network.URI\n\ntype URL = String\ntype Prefix = String\n\nfubar :: String -&gt; Maybe (Prefix, URL)\nfubar url = case parseURI url of\n    Just u -&gt; (flip (,) $ url)\n               &lt;$&gt; (fmap ((uriScheme u ++) \"//\" ++ ) ((uriRegName &lt;$&gt; uriAuthority u)))\n    _ -&gt; Nothing\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>&gt; fubar \"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Foldable.html#mapM\"\nJust (\"https://hackage.haskell.org\"\n     ,\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Foldable.html#mapM\"\n     )\n</code></pre>\n\n<p>(*) printing what failed to parse wrong would be nice</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "edited": false, "score": 0, "creation_date": 1483742790, "post_id": 41514811, "comment_id": 70237161, "body": "Thank you for your detailed answer. I went to the directory where I had put <code>pong.hs</code> and ran <code>cabal install Gloss --reinstall</code> --- even though cabal said it was unsafe. (When I first tried <code>install</code> I was told it was already installed.) Then I restarted winghci and loaded pong successfully. (Obviously it&#39;s not your problem, but I hate having to work at this sysadmin level.) I tried some of the other things you suggested and got confusing answers, but the approach outlined loaded. I haven&#39;t tried to run it yet, though.  Thanks again for your time."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1483738798, "creation_date": 1483738798, "answer_id": 41514811, "question_id": 41514559, "link": "https://stackoverflow.com/questions/41514559/cant-load-graphics-gloss-in-haskell/41514811#41514811", "title": "Can&#39;t load Graphics.Gloss in Haskell", "body": "<p>First, some background: <code>Graphics.Gloss</code> is the name of a module -- a collection of named code snippets. <code>gloss</code> is the name of a package -- a collection of modules. <code>cabal install</code> accepts a package name and installs that package into a package database -- a collection of packages.</p>\n\n<p>Now we have the vocabulary we need to discuss what you observed, and how you can make progress.</p>\n\n<blockquote>\n  <p><code>cabal install Graphics.Gloss</code> couldn't find <code>Graphics.Gloss</code></p>\n</blockquote>\n\n<p>Right, <code>Graphics.Gloss</code> is a module, not a package. The <code>gloss</code> package provides that module. I don't know of a reliable tool for mapping module names to the packages that provide them, but Hoogle and Hayoo will both tell you the package name associated with any of their search results. (I don't class them as \"reliable\" because they index only a subset of Hackage.)</p>\n\n<blockquote>\n  <p><code>cabal install Gloss</code> succeeded</p>\n</blockquote>\n\n<p>Although the package is named <code>gloss</code> and not <code>Gloss</code>, <code>cabal install</code> attempts to Do The Right Thing, installing a surrogate package if it differs only in case.</p>\n\n<blockquote>\n  <p>when I tried to load the code into WinGHCi, I got [an error]</p>\n</blockquote>\n\n<p>I would bet that Sublime Text and WinGHCi are using different package databases; for example, perhaps you are using a cabal sandbox and Sublime Text has picked that up. You could try running these two commands and comparing their output:</p>\n\n<pre><code>cabal sandbox hc-pkg list gloss\nghc-pkg list gloss\n</code></pre>\n\n<p>Note that the former will behave differently when run from different directories and in different environments, so take care to run it using the same steps you used to run <code>cabal install Gloss</code>!</p>\n\n<p>If you have installed gloss into a sandbox, the first command should show you the location of the package database associated with that sandbox and the version of the gloss library installed there. The second should show no results. If that is the case, you can try running WinGHCi using an environment appropriate for the sandbox; for example, something like</p>\n\n<pre><code>cabal exec winghci\n</code></pre>\n\n<p>should do the trick (if <code>winghci</code> is the command that starts WinGHCi -- no Windows box here, so I don't know for sure). Again, being in the right directory with the right environment variables set is important for this command to work, so make sure you run it following the same steps you did for running <code>cabal install Gloss</code> and the previous package database query.</p>\n"}], "owner": {"reputation": 2366, "user_id": 1112406, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/abd557d2593a8fa81511a817b83c8f4b?s=128&d=identicon&r=PG", "display_name": "RussAbbott", "link": "https://stackoverflow.com/users/1112406/russabbott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1806, "favorite_count": 0, "accepted_answer_id": 41514811, "answer_count": 1, "score": 0, "last_activity_date": 1483738798, "creation_date": 1483737755, "question_id": 41514559, "link": "https://stackoverflow.com/questions/41514559/cant-load-graphics-gloss-in-haskell", "title": "Can&#39;t load Graphics.Gloss in Haskell", "body": "<p>I wanted to play around with <a href=\"https://github.com/ekmett/lens/blob/master/examples/Pong.hs\" rel=\"nofollow noreferrer\">Pong.hs</a>. I downloaded the <code>.hs</code> file, but when I opened it in Sublime Text (with the Haskell plugin) I was told that <code>Graphics.Gloss</code> and <code>Graphics.Gloss.Interface.Pure.Game</code> were missing.</p>\n\n<pre><code>&gt; cabal install Graphics.Gloss\n</code></pre>\n\n<p>couldn't find <code>Graphics.Gloss</code>. Hoogle found it for me. One of the comments in the file mentioned compiling <code>Gloss</code>. So I tried</p>\n\n<pre><code>&gt; cabal install Gloss\n</code></pre>\n\n<p>which succeeded -- although I don't understand why.  The Sublime Text plugin was also happy. But when I tried to load the code into WinGHCi, I got</p>\n\n<pre><code>Pong.hs:22:1: error:\n    Failed to load interface for \u2018Graphics.Gloss\u2019\n    Use -v to see a list of the files searched for.\n\nPong.hs:23:1: error:\n    Failed to load interface for \u2018Graphics.Gloss.Interface.Pure.Game\u2019\n    Use -v to see a list of the files searched for.\n</code></pre>\n\n<p>I'd appreciate suggestions about what to try next.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483731236, "post_id": 41512822, "comment_id": 70231970, "body": "What behaviour do you want? Obviously if you change the type of something all code using it will break. The error just tells you, that it wanted a <code>(Int,Int)</code> = <code>Pos</code> but got a <code>[Pos]</code>."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483731377, "post_id": 41512822, "comment_id": 70232043, "body": "You can fix the first error by removing the <code>head</code> from <code>blanks</code>. Then you get <code>blanks = allBlanks</code>, so you could do away with one of those. You will however of course run into the next error after that."}, {"owner": {"reputation": 3215, "user_id": 4153021, "user_type": "registered", "accept_rate": 77, "profile_image": "https://graph.facebook.com/100000232211540/picture?type=large", "display_name": "Timo Cengiz", "link": "https://stackoverflow.com/users/4153021/timo-cengiz"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483732265, "post_id": 41512822, "comment_id": 70232510, "body": "I get that, i just need to change it to [Pos] but i am not very sure how to make it work @jpath"}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483734242, "post_id": 41512822, "comment_id": 70233477, "body": "Why do you even want to change the type? The code seems works as it is. And if you really want it, you can just move the <code>head</code> from <code>blanks</code> to everywhere where <code>blanks</code> is used."}], "answers": [{"comments": [{"owner": {"reputation": 3215, "user_id": 4153021, "user_type": "registered", "accept_rate": 77, "profile_image": "https://graph.facebook.com/100000232211540/picture?type=large", "display_name": "Timo Cengiz", "link": "https://stackoverflow.com/users/4153021/timo-cengiz"}, "edited": false, "score": 0, "creation_date": 1483759387, "post_id": 41514222, "comment_id": 70241220, "body": "I HAVE to change the function type, so is there anyway to fix it by changing it to [Pos]? Your current solutions only involve in either not changing the function type or removing blanks. I need to change it and keep blanks still"}], "tags": [], "owner": {"reputation": 3287, "user_id": 341061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f01669013eac8b56559066aab4a0817?s=128&d=identicon&r=PG", "display_name": "Giovanni Cappellotto", "link": "https://stackoverflow.com/users/341061/giovanni-cappellotto"}, "is_accepted": false, "score": 1, "last_activity_date": 1483736247, "creation_date": 1483736247, "answer_id": 41514222, "question_id": 41512822, "link": "https://stackoverflow.com/questions/41512822/error-when-changing-function-name-to-list-haskell/41514222#41514222", "title": "Error when changing function name to list, haskell", "body": "<p>The first error tells you that your new <code>blanks</code> definition is wrong. The reason is that <code>head</code>, that is applied to a <code>[Pos]</code>, returns <code>Pos</code>, that is different from the type you'd like to return.</p>\n\n<p>You're using <code>blanks</code> in two cases:</p>\n\n<ol>\n<li>In a pattern binding: <code>(x, y) = blanks</code> (second error)</li>\n<li>In the second argument of <code>update</code>, namely <code>(blanks x)</code> (third error)</li>\n</ol>\n\n<p>Those two usages of the <code>blanks</code> function require it to return a single <code>Pos</code>.</p>\n\n<p>I would suggest to either:</p>\n\n<ol>\n<li>do not change the function type, but rename <code>blanks</code> to <code>firstBlank</code> or something more meaningful</li>\n<li>remove <code>blanks</code> altogether and replace its occurrences with <code>head . allBlanks</code></li>\n</ol>\n"}], "owner": {"reputation": 3215, "user_id": 4153021, "user_type": "registered", "accept_rate": 77, "profile_image": "https://graph.facebook.com/100000232211540/picture?type=large", "display_name": "Timo Cengiz", "link": "https://stackoverflow.com/users/4153021/timo-cengiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1483736247, "creation_date": 1483730509, "question_id": 41512822, "link": "https://stackoverflow.com/questions/41512822/error-when-changing-function-name-to-list-haskell", "title": "Error when changing function name to list, haskell", "body": "<p>I am almost done with my code but i have to do some slight modifications. This is my code:</p>\n\n<pre><code>module Sudoku where\n\nimport Data.Char\nimport Data.List\nimport Data.Maybe\n\nimport Test.QuickCheck\n\ndata Sudoku = Sudoku { rows :: [[Maybe Int]] }\n  deriving (Show, Eq) \n\nexample :: Sudoku\nexample =   Sudoku [[Just 3, Just 6, Nothing,Nothing,Just 7, Just 1, Just 2, Nothing,Nothing]\n    , [Nothing,Just 5, Nothing,Nothing,Nothing,Nothing,Just 1, Just 8, Nothing]\n    , [Nothing,Nothing,Just 9, Just 2, Nothing,Just 4, Just 7, Nothing,Nothing]\n    , [Nothing,Nothing,Nothing,Nothing,Just 1, Just 3, Nothing,Just 2, Just 8]\n    , [Just 4, Nothing,Nothing,Just 5, Nothing,Just 2, Nothing,Nothing,Just 9]\n    , [Just 2, Just 7, Nothing,Just 4, Just 6, Nothing,Nothing,Nothing,Nothing]\n    , [Nothing,Nothing,Just 5, Just 3, Nothing,Just 8, Just 9, Nothing,Nothing]\n    , [Nothing,Just 8, Just 3, Nothing,Nothing,Nothing,Nothing,Just 6, Nothing]\n    , [Nothing,Nothing,Just 7, Just 6, Just 9, Nothing,Nothing,Just 4, Just 3]\n    ]\n\n-- A\n\n-- Crates a blank sudoku \"map\"\nallBlankSudoku :: Sudoku\nallBlankSudoku = Sudoku (replicate 9 (replicate 9 Nothing)) \n\n-- Checks if the criterias meet the standard sudoku\nisSudoku :: Sudoku -&gt; Bool\nisSudoku x = (length (rows x) == 9) &amp;&amp; ( and [length y == 9 | y &lt;- rows x]) &amp;&amp; ( and [x &gt; 0 &amp;&amp; x &lt; 10 | Just x &lt;- concat (rows x)])\n\n-- Checks if the sudoku puzzle is solved. Which is when there is no more cells to fill in\nisSolved :: Sudoku -&gt; Bool\nisSolved x = Nothing `notElem` concat (rows x)\n\n-- Prints a sudoko\nprintSudoku :: Sudoku -&gt; IO()\nprintSudoku x = putStr (unlines ([ map convertInt y | y &lt;- rows x]))\n\n-- converting from int to char \nconvertInt :: Maybe Int -&gt; Char \nconvertInt Nothing = '.'\nconvertInt (Just x) = chr (x+48)\n\n-- simply reads sudoku from file\nreadSudoku :: FilePath -&gt; IO Sudoku \nreadSudoku x = \n        do y &lt;- readFile x\n           return (Sudoku [map convertChar c | c &lt;- lines y])\n\n-- Convertion from char to int.       \nconvertChar :: Char -&gt; Maybe Int\nconvertChar '.' = Nothing\nconvertChar x  = Just (digitToInt x)\n\n-- this function crates a cell\ncell :: Gen (Maybe Int) \ncell  = frequency\n        [(1, do n &lt;- choose (1,9)\n                return (Just n)),\n            (9, return Nothing)]\n\n -- C2. Make Sudokus an instance of the class Arbitrary.\ninstance Arbitrary Sudoku where\n  arbitrary =\n    do rows &lt;- sequence [ sequence [ cell | j &lt;- [1..9] ] | i &lt;- [1..9] ]\n       return (Sudoku rows)\n\n-- check sudoku\nprop_Sudoku :: Sudoku -&gt; Bool\nprop_Sudoku x = isSudoku x\n\ntype Block = [ Maybe Int]\n\n-- CHeck if block containts same digit twice\nisOkayBlock :: Block -&gt; Bool\nisOkayBlock x = x' == nub x'\n            where x' = filter isJust x\n\n-- create list of all blocks\nblocks :: Sudoku -&gt; [Block]\nblocks x = rows x ++ transpose (rows x) ++ blocks1 x\n\n-- 3x3 made by blocks\nblocks1 :: Sudoku -&gt; [Block] \nblocks1 x = [concat [take 3 (drop a b) | b &lt;- take 3 (drop d (rows x))] | a &lt;- [0,3,6] , d &lt;- [0,3,6]]\n\n-- checks the whole sudoku\nisOkay :: Sudoku -&gt; Bool\nisOkay x = and (map isOkayBlock (blocks x))\nprop_isOkay x = and [ length a == 9 | a &lt;- blocks x ] &amp;&amp; length (blocks x) == 27\n\n\ntype Pos = (Int,Int)\n\nblanks :: Sudoku -&gt; Pos\nblanks = head . allBlanks\n\n-- Changed the way blanks works,\n(!!!) :: [[a]] -&gt; Pos -&gt; a\n(!!!) l (y,x) = (l !! y) !! x\n\n-- Get the blanks in sudoku.\nallBlanks :: Sudoku -&gt; [Pos]\nallBlanks s = [ (y,x) | y &lt;- [0..8], x &lt;- [0..8], ((rows s) !!! (y,x)) == Nothing]\n\nprop_isBlank :: Sudoku -&gt; Bool\nprop_isBlank sud = (selElement (selectRow (rows sud) x) y) == Nothing\n   where (x, y) = blanks sud\n\nselectRow :: [[a]] -&gt; Int -&gt; [a]\nselectRow (x:_) 0  = x\nselectRow (x:xs) n = selectRow xs (n-1)\n\nselElement :: [a] -&gt; Int -&gt; a\nselElement (x:_) 0  = x\nselElement (x:xs) n = selElement xs (n-1)\n\n\n--Replace/update \n(!!=) :: [a] -&gt; (Int ,a) -&gt; [a] \n(x:xs) !!= (0,a) = (a:xs)\n(x:xs) !!= (y,a) = (x:(xs!!=(y-1,a)))\n\nprop_replacedElement :: [Int] -&gt; (Int,Int) -&gt; Property\nprop_replacedElement list (index, obj) = list /= [] ==&gt; (list !!= (index', obj)) !! index' == obj\n  where\n    index' = index `mod` length list\n\n-- Update cell with new value\nupdate :: Sudoku -&gt; Pos -&gt; Maybe Int -&gt; Sudoku\nupdate x (p,i) y = Sudoku ((rows x) !!= (p,z))\n                   where z = (rows x) !! p !!= (i,y) \n\n-- Check update function\nprop_update (x,y) sud n = prop_XY (x',y') (update sud (x',y') n) == n \n                          where x' = x `mod` 9 \n                                y' = y `mod` 9\n\n-- helepr to find specific value \nprop_XY (x,y) sud = ((!!) (rows (sud)) x) !! y\n\n\n-- Gives allowed numbers on an empty cell\ncandidates :: Sudoku -&gt; Pos -&gt; [Int]\ncandidates sud (x,y) = filter (/=0) [if isOkay (update sud (x,y) (Just z)) == True then z else 0 | z &lt;- [1..9]]\n\n\nsolve :: Sudoku -&gt; Maybe Sudoku\nsolve  x \n       | not(isOkay x) = Nothing\n       | isSolved x = Just x\n       | otherwise = solve' [solve $ update x (blanks x) (Just c) | c &lt;- [1..9]]\n\n-- take from our list solutions\nsolve' :: [Maybe a] -&gt; Maybe a \nsolve' [] = Nothing\nsolve' (Nothing:xs) = solve' xs\nsolve' (Just x:xs) = Just x \n\n-- read and solves the sudoku. \nreadAndSolve :: FilePath -&gt; IO () \nreadAndSolve x = do \n  y &lt;- readSudoku x\n  case solve y of\n      Nothing  -&gt; putStrLn\"(no solution)\"\n      Just y -&gt; printSudoku y\n\n-- check if x 2 solution to x1\nisSolutionOf :: Sudoku -&gt; Sudoku -&gt; Bool\nisSolutionOf x1 x2 = isOkay x1 &amp;&amp; isSolved x1 &amp;&amp; isSolutionOf2 (zip (concat(rows x1)) (concat(rows x2)))\n\n-- helper func\nisSolutionOf2 :: (Eq a) =&gt; [(Maybe a, Maybe a)] -&gt; Bool \nisSolutionOf2 [] = True\nisSolutionOf2 ((x,y):xs) = x == y || y == Nothing &amp;&amp; isSolutionOf2 xs\n\n-- Solved or not \nprop_SolveSound :: Sudoku -&gt; Property\nprop_SolveSound x = isOkay x ==&gt; (fromJust (solve x)) `isSolutionOf` x \n</code></pre>\n\n<p>Now i have to change the function:</p>\n\n<pre><code>blanks :: Sudoku -&gt; Pos\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>blanks :: Sudoku -&gt; [Pos]\n</code></pre>\n\n<p>But when doing so i get some errors that i have no idea on how to fix. I have tried to change so that use the function \"head\" in my definition of solve instead. Code examples is appreciated. </p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Forgot to ut in the errors:</p>\n\n<pre><code>Sudoku.hs:99:10: error:\n    \u2022 Couldn't match type \u2018(Int, Int)\u2019 with \u2018[Pos]\u2019\n      Expected type: Sudoku -&gt; [Pos]\n        Actual type: Sudoku -&gt; Pos\n    \u2022 In the expression: head . allBlanks\n      In an equation for \u2018blanks\u2019: blanks = head . allBlanks\n\nSudoku.hs:111:19: error:\n    \u2022 Couldn't match expected type \u2018(t, t1)\u2019 with actual type \u2018[Pos]\u2019\n    \u2022 In the expression: blanks sud\n      In a pattern binding: (x, y) = blanks sud\n      In an equation for \u2018prop_isBlank\u2019:\n          prop_isBlank sud\n            = (selElement (selectRow (rows sud) x) y) == Nothing\n            where\n                (x, y) = blanks sud\n    \u2022 Relevant bindings include\n        x :: t (bound at Sudoku.hs:111:11)\n        y :: t1 (bound at Sudoku.hs:111:14)\n\nSudoku.hs:155:48: error:\n    \u2022 Couldn't match type \u2018[Pos]\u2019 with \u2018(Int, Int)\u2019\n      Expected type: Pos\n        Actual type: [Pos]\n    \u2022 In the second argument of \u2018update\u2019, namely \u2018(blanks x)\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018update x (blanks x) (Just c)\u2019\n      In the expression: solve $ update x (blanks x) (Just c)\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "lazy-evaluation"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1483726102, "post_id": 41509890, "comment_id": 70229294, "body": "Initially <code>first</code> and <code>last</code> are simply <i>thunks</i>, i.e. <b>unevaluated</b> expressions, the trick is that the <code>go</code> function does not evalute the arguments until their values are ready."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1483739713, "post_id": 41509890, "comment_id": 70236013, "body": "As an experiment, I tried to adapt the knot-tying code to Java in an overly literal way, using an explicit <code>Thunk</code> class instead of the &quot;implicit thunks&quot; of Haskell: <a href=\"https://gist.github.com/danidiaz/58cbbff4f4d4b6071b3daa2d54409292\" rel=\"nofollow noreferrer\">gist.github.com/danidiaz/58cbbff4f4d4b6071b3daa2d54409292</a>"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1483728703, "last_edit_date": 1483728703, "creation_date": 1483726331, "answer_id": 41511748, "question_id": 41509890, "link": "https://stackoverflow.com/questions/41509890/how-does-tying-the-knot-on-this-cyclic-linked-list-in-haskell-work/41511748#41511748", "title": "How does &quot;tying the knot&quot; on this cyclic linked list in Haskell work?", "body": "<p>Since Haskell is lazy, values are evaluated until strictly necessary. We can walk through a simple example using equational reasoning to see where that gets us.</p>\n\n<p>Start with the simplest example: a one-element list.</p>\n\n<pre><code>mkDList [1] == let (first, last) = go last [1] first in first\n</code></pre>\n\n<p>It seems that you can't call <code>go</code>, because you don't know what <code>last</code> and <code>first</code> are equal to yet. However, you can think of them as unevaluated black boxes: it doesn't matter <em>what</em> they are, just that you can proceed with equational reasoning with them.</p>\n\n<pre><code>-- Just plug last and first into the definition of go\n-- last2 is just a renaming of the argument for clarity\ngo last [1] first == let this = DLNode last 1 rest\n                         (rest, last2) = go this [] first\n                     in (this, last2)\n</code></pre>\n\n<p>Let's try to evaluate the next call to <code>go</code> in the same way.</p>\n\n<pre><code>go this [] first == (first, this)\n</code></pre>\n\n<p>Conveniently, we didn't need to imagine any new black boxes; <code>go</code> simply evaluates to its original arguments in a slightly repackaged manner.</p>\n\n<p>OK, now we can go back the way we came, and replace the recursive call to <code>go</code> with its evaluation.</p>\n\n<pre><code>go last [1] first == let this = DLNode last 1 rest\n                         (rest, last2) = (first, this)\n                     in (this, last2)\n</code></pre>\n\n<p>And we'll plug <em>this</em> back into our original equation with <code>mkDList</code>:</p>\n\n<pre><code>mkDList [1] == let (first, last) = let this = DLNode last 1 rest\n                                       (rest, last2) = (first, this)\n                                   in (this, last2)\n               in first\n</code></pre>\n\n<p>This doesn't look too helpful, but remember, we haven't actually <em>called</em> <code>mkDList</code> yet; we just used equational reasoning to simplify its definition a little bit. In particular, there are no recursive calls to <code>go</code>, just one <code>let</code> expression nested in another. </p>\n\n<hr>\n\n<p>Since Haskell is lazy, we don't have to evaluate any of this until it is absolutely necessary, such as when we try to pattern-match against the return value of <code>mkDlist [1]</code>:</p>\n\n<pre><code>let (DLNode p x n) = mkDList [1] in x\n</code></pre>\n\n<p>To evaluate this expression, we just need to ask the following questions:</p>\n\n<ol>\n<li>\"What is the value of <code>x</code>?\" Answer: we need to pattern-match against <code>mkDList [1]</code> first.</li>\n<li>\"What is the value of <code>mkDList</code>?\" Answer: <code>first</code>.</li>\n<li>\"What is the value of <code>first</code>?\" Answer: <code>this</code>.</li>\n<li>\"What is the value of <code>this</code>?\" Answer: <code>DLNode last 1 rest</code></li>\n</ol>\n\n<p>At this point, you have enough information to see that <code>x == 1</code>, and <code>last</code> and <code>rest</code> don't need to be evaluated further. You could, though, pattern match again to see what, for example, <code>p</code> is, and discover that</p>\n\n<pre><code>p == last == last2 == this == DLNode last 1 rest\n</code></pre>\n\n<p>and</p>\n\n<pre><code>n == rest == first == this == DLNode last 1 rest\n</code></pre>\n\n<hr>\n\n<p>The magic is a call like <code>(first, last) = go last xs first</code> doesn't actually <em>need</em> values for its arguments; it just needs placeholders to keep track of what values <code>first</code> and <code>last</code> will eventually get when they are evaluated. These placeholders are called \"thunks\", and they represent pieces of unevaluated code. They let us refer to boxes that we haven't filled with anything yet, and we can pass the empty boxes to <code>go</code> safe in the knowledge that somebody will fill them before anyone else tries to look in them. (In fact, <code>go</code> itself never does; it simply keeps passing them along until somebody <em>outside</em> of <code>mkDList</code> tries to look at them.)</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1483735557, "last_edit_date": 1483735557, "creation_date": 1483726334, "answer_id": 41511749, "question_id": 41509890, "link": "https://stackoverflow.com/questions/41509890/how-does-tying-the-knot-on-this-cyclic-linked-list-in-haskell-work/41511749#41511749", "title": "How does &quot;tying the knot&quot; on this cyclic linked list in Haskell work?", "body": "<p>We can try some simple input first, to see what's going on there:</p>\n\n<pre><code>mkDList [1] = first\n    where \n    (first,last) := go last [1] first\n                  = let { prev=last; next=first;         -- prev = last\n                          x=1; xs=[] }                   -- next = first\n                    in go prev (x:xs) next\n                       = let this := (DLNode prev 1 rest)  -- a node is constructed, with \n                                      -- the two pointers still pointing into the unknown\n                             (rest,last2) := go this [] next\n                                           = (next,this) -- rest := next\n                                                         -- last2 := this\n                         in  (this,last2)                -- first := this\n                                                         -- last := last2\n</code></pre>\n\n<p><code>let</code> in Haskell is recursive: same name can appear on both left and right sides of the equation sign, and will refer to the same entity. </p>\n\n<p>First, <code>go</code> is called with <code>last</code>, <code>[1]</code> and <code>first</code>. Both <code>last</code> and <code>first</code> do not yet refer to any value; they exist only as identity, kind of \"named pointers\" to still empty boxes, boxes which are yet to be \"filled\" with values.</p>\n\n<p>Going into the guts of <code>go</code>, both names are \"fleshed out\", and then the final <em>value</em> <code>(this, last2)</code> is returned; then the pattern <code>(first, last)</code> is matched with that value. This is how the <code>last</code> finally gets its value, even though it was used as a named identity inside the <code>go</code> invocations. This is what is referred to as the tying of the knot: imagine an arrow going \"out\" of <code>last</code> into the <code>go</code> invocations, coming back to it from the deep; and same with <code>first</code>; thus creating chains of equivalences:</p>\n\n<pre><code>    first := this = (DLNode prev 1 rest)\n    last := last2 := this\n    prev = last\n    rest := next = first\n</code></pre>\n\n<p>The above follows a somewhat imperative view of Haskell's semantics as a single-assignment language. The <code>:=</code> operator is used, as a pseudocode, to provide a visual clue to the fact that a value is calculated by the expression on the right, and is \"passed\" into the variables in the pattern on the left of the equality sign (when that pattern is matched with the calculated value).</p>\n\n<hr>\n\n<p>In fact, the name \"next\" is no good, as we're just passing along the very <em>first</em> node all the way down, to be used as the last node's <em>next node</em>:</p>\n\n<pre><code> mkDList xs@(_:_) = first where (first,last) = go last xs first\n\n go ::   DList a -&gt;  [a]  -&gt;        DList a -&gt; (DList a, DList a)\n go          prev  (x:xs)            first = \n    (this,                     last)        -- (this   , last   )\n     where \n     this                                 := DLNode \n             prev   x    rest\n     (                   rest, last)      := go \n             this     xs             first \n\n go          prev     []             first = \n                                    (first,  -- first --&gt; rest of the last node\n             prev)\n</code></pre>\n\n<p>This can be \"described\" by equivalent Prolog definition:</p>\n\n<pre class=\"lang-erlang prettyprint-override\"><code>mkDList(    [X|XS], First) :-                 % mkDList( in, out)\n  go( Last, [X|XS], First,   First, Last).    % go( in, in, in, out, out)\n\ngo(   Prev, [X|XS], First,   This,  Last) :-   This = dlnode(Prev, X, Rest),\n  go(  This,   XS,  First,   Rest,  Last).    % fill the Rest, return Last\ngo(   Prev, [],     First,   First, Prev).\n</code></pre>\n\n<p>Indeed,</p>\n\n<pre class=\"lang-erlang prettyprint-override\"><code>?- mkDList([1,2,3],X).\nX = dlnode(_S1, 1, _S2), % where\n    _S2 = dlnode(X, 2, _S1),\n    _S1 = dlnode(_S2, 3, X).\n</code></pre>\n"}], "owner": {"reputation": 159, "user_id": 1840624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90e3d702eea956c57fce38944ccff1e5?s=128&d=identicon&r=PG", "display_name": "user1840624", "link": "https://stackoverflow.com/users/1840624/user1840624"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1483735557, "creation_date": 1483720005, "last_edit_date": 1483722450, "question_id": 41509890, "link": "https://stackoverflow.com/questions/41509890/how-does-tying-the-knot-on-this-cyclic-linked-list-in-haskell-work", "title": "How does &quot;tying the knot&quot; on this cyclic linked list in Haskell work?", "body": "<p>I am learning Haskell and was reading through <a href=\"http://wiki.haskell.org/Tying_the_Knot#Other_Examples\" rel=\"nofollow noreferrer\">Tying the Knot</a> on how to build a cyclic linked list. In the code </p>\n\n<pre><code>data DList a = DLNode (DList a) a (DList a)\nmkDList :: [a] -&gt; DList a\nmkDList [] = error \"must have at least one element\"\nmkDList xs = let (first,last) = go last xs first\n         in  first\n         where go :: DList a -&gt; [a] -&gt; DList a -&gt; (DList a, DList a)\n               go prev []     next = (next,prev)\n               go prev (x:xs) next = let this        = DLNode prev x rest\n                                         (rest,last) = go this xs next\n                                     in  (this,last)\n</code></pre>\n\n<p>I am trying to understand the call where they link the last element to the first through a \"little trick\" (!) called tying the knot:</p>\n\n<pre><code>mkDList xs = let (first,last) = go last xs first\n</code></pre>\n\n<p>But I am having difficulty seeing how this works. What is \"go\" initially called with? And per the comment in the article, how is the first result from \"go\" \"passed back in\"? </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["r", "haskell", "dll", "wolfram-mathematica"], "comments": [{"owner": {"reputation": 6498, "user_id": 1004168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c05e808436031bc45a7620adc236e3d?s=128&d=identicon&r=PG", "display_name": "agentp", "link": "https://stackoverflow.com/users/1004168/agentp"}, "edited": false, "score": 0, "creation_date": 1483739317, "post_id": 41509628, "comment_id": 70235844, "body": "suggest you ask on mathematica.stackexchange.com"}, {"owner": {"reputation": 61, "user_id": 7384722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7263bde2ceba70a8622539bae840248f?s=128&d=identicon&r=PG&f=1", "display_name": "rand", "link": "https://stackoverflow.com/users/7384722/rand"}, "reply_to_user": {"reputation": 6498, "user_id": 1004168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c05e808436031bc45a7620adc236e3d?s=128&d=identicon&r=PG", "display_name": "agentp", "link": "https://stackoverflow.com/users/1004168/agentp"}, "edited": false, "score": 0, "creation_date": 1483802613, "post_id": 41509628, "comment_id": 70251792, "body": "Fine, thanks for your suggestion."}, {"owner": {"reputation": 6498, "user_id": 1004168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c05e808436031bc45a7620adc236e3d?s=128&d=identicon&r=PG", "display_name": "agentp", "link": "https://stackoverflow.com/users/1004168/agentp"}, "edited": false, "score": 0, "creation_date": 1483887904, "post_id": 41509628, "comment_id": 70273261, "body": "a link in case anyone needs to find it.. <a href=\"http://mathematica.stackexchange.com/q/134913/2079\">mathematica.stackexchange.com/q/134913/2079</a>"}], "owner": {"reputation": 61, "user_id": 7384722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7263bde2ceba70a8622539bae840248f?s=128&d=identicon&r=PG&f=1", "display_name": "rand", "link": "https://stackoverflow.com/users/7384722/rand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1483719125, "creation_date": 1483719125, "question_id": 41509628, "link": "https://stackoverflow.com/questions/41509628/call-haskell-dll-from-mathematica", "title": "Call Haskell DLL from Mathematica", "body": "<p>Looking for a way to call a Haskell DLL from Mathematica, I've stumbled on this, for GNU R:</p>\n\n<p><a href=\"http://neilmitchell.blogspot.com.br/2011/10/calling-haskell-from-r.html\" rel=\"nofollow noreferrer\">http://neilmitchell.blogspot.com.br/2011/10/calling-haskell-from-r.html</a></p>\n\n<p>It is (to me) a beautiful example and I managed to make it work on Mathematica without modification through this spell:</p>\n\n<pre><code>Needs[\"NETLink`\"]\nhsStart = DefineDLLFunction[\"HsStart\", \"c:\\\\temp\\\\SumRoots.dll\", \"void\", {}];\nhsEnd = DefineDLLFunction[\"HsEnd\", \"c:\\\\temp\\\\SumRoots.dll\", \"void\", {}];\nsroot = DefineDLLFunction[\"sumRootsR\", \"c:\\\\temp\\\\SumRoots.dll\", \"double\", {\"int*\", \"double[]\", \"double*\"}];\nhsStart[];\nresulta = 0;\nlista = {9, 3.5, 5.58, 64.1, 12.54};\nsroot[Length[lista], lista, resulta];\nresulta\n18.7805\nhsEnd[];\n</code></pre>\n\n<p>Then I tried to modify the example to return a vector of doubles, instead of a single value:<br>\nCode in Haskell:</p>\n\n<pre><code>-- SumRoots.hs\n\n{-# LANGUAGE ForeignFunctionInterface #-}\nmodule SumRoots where\n\nimport Foreign\n\nforeign export ccall acumSumR :: Ptr Int -&gt; Ptr Double -&gt; Ptr Double -&gt; IO ()\n\nacumSum :: [Double] -&gt; [Double]\nacumSum xs = scanl (\\x y -&gt; x+y) 0 xs\n\nacumSumR :: Ptr Int -&gt; Ptr Double -&gt; Ptr Double -&gt; IO ()\nacumSumR n xs result = do\n                       n &lt;- peek n\n                       xs &lt;- peekArray n xs\n                       pokeArray result $ acumSum xs\n</code></pre>\n\n<p>Code in C: (exactly the same of the mentioned blog post)</p>\n\n<p>Compiling:</p>\n\n<pre><code>ghc -c SumRoots.hs\nghc -c StartEnd.c\nghc -shared -o SumRoots.dll SumRoots.o StartEnd.o\n</code></pre>\n\n<p>Code in Mathematica:</p>\n\n<pre><code>Needs[\"NETLink`\"]\nhsStart = DefineDLLFunction[\"HsStart\", \"c:\\\\temp\\\\SumRoots.dll\", \"void\", {}];\nhsEnd = DefineDLLFunction[\"HsEnd\", \"c:\\\\temp\\\\SumRoots.dll\", \"void\", {}];\nacums = DefineDLLFunction[\"acumSumR\", \"c:\\\\temp\\\\SumRoots.dll\", \"double[]\", {\"int*\", \"double[]\", \"double[]\"}];\nhsStart[];\nlista = {9, 3.5, 5.58, 64.1, 12.54};\nNETBlock@Module[{n, resultb}, n = Length[lista]+1; \n  resultb = NETNew[\"System.Double[]\", n]; acums[n, lista, resultb]; \n  NETObjectToExpression[resultb]]\n\n{0., 0., 0., 0., 0., 0.}\n</code></pre>\n\n<p>The result should be {0.0, 9.0, 12.5, 18.08, 82.18, 94.72}. I'm not sure if this problem belongs to Mathematica or Haskell realm, but posting here is based on the fact that the GNU R call worked:</p>\n\n<pre><code>dyn.load(\"C:/temp/SumRoots.dll\") \n.C(\"HsStart\")\nacumSum &lt;- function(input)\n{\nreturn(.C(\"acumSumR\", n=as.integer(length(input)), xs=as.double(input), result=as.double(rep(0,length(input)+1)))$result)\n}\ninput &lt;- c(9,3.5,5.58,64.1,12.54)\nacumSum(input)\n</code></pre>\n\n<p>So, can somebody give a hint on how to call this modified Haskell DLL function from Mathematica?<br>\nEnvironment:<br>\nSO: Windows 10 64-bit<br>\nMathematica 8.0 64-bit<br>\nHaskell Platform 8.0.1 64-bit<br>\nGNU R 3.3.2 64-bit  </p>\n\n<p>Cheers,</p>\n\n<p>Rand</p>\n"}, {"tags": ["json", "haskell", "ghci", "aeson"], "answers": [{"tags": [], "owner": {"reputation": 3287, "user_id": 341061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f01669013eac8b56559066aab4a0817?s=128&d=identicon&r=PG", "display_name": "Giovanni Cappellotto", "link": "https://stackoverflow.com/users/341061/giovanni-cappellotto"}, "is_accepted": true, "score": 1, "last_activity_date": 1483740722, "creation_date": 1483740722, "answer_id": 41515189, "question_id": 41509412, "link": "https://stackoverflow.com/questions/41509412/exception-jsonerror-content-type-of-response-is-application-random-v4json/41515189#41515189", "title": "Exception: JSONError &quot;content type of response is \\&quot;application/random.v4+json\\&quot;&quot; #Haskell", "body": "<p><code>Network.Wreq.asJSON</code> will <a href=\"https://github.com/bos/wreq/blob/0.4.1.0/Network/Wreq.hs#L432-L433\" rel=\"nofollow noreferrer\">throw a <code>JSONError</code></a> if response's content type is different from <code>\"application/json\"</code>.</p>\n\n<p>I guess the easiest way to go would be to explicitly use Aeson to decode the response body as json:</p>\n\n<pre><code>getInfo = do\n    let opts = defaults &amp;&amp; header \"Accept\" .~ [\"application/random.v4+json\"] \"Content-Type\" .~ [\"application/json\"]\n    resp &lt;- getWith opts \"url\"\n    let respBody = decodeResponseBody $ resp ^. responseBody\n    return respBody\n  where\n    decodeResponseBody :: ByteString -&gt; Map String Value\n    decodeResponseBody body =\n      case eitherDecode' body of\n        Left err -&gt; fail err\n        Right val -&gt; return val\n</code></pre>\n"}], "owner": {"reputation": 457, "user_id": 7169108, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QRp7Z.jpg?s=128&g=1", "display_name": "Sumanth Kumar Mora", "link": "https://stackoverflow.com/users/7169108/sumanth-kumar-mora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 41515189, "answer_count": 1, "score": 0, "last_activity_date": 1484259312, "creation_date": 1483718473, "last_edit_date": 1484259312, "question_id": 41509412, "link": "https://stackoverflow.com/questions/41509412/exception-jsonerror-content-type-of-response-is-application-random-v4json", "title": "Exception: JSONError &quot;content type of response is \\&quot;application/random.v4+json\\&quot;&quot; #Haskell", "body": "<p>I am using Network.Wreq, Control.Lens, Data.Aeson</p>\n\n<pre><code>getInfo = do\n    let opts = defaults &amp;&amp; header \"Accept\" .~ [\"application/random.v4+json\"] \"Content-Type\" .~ [\"application/json\"]\n    resp &lt;- asJSON =&lt;&lt; getWith opts \"url\" :: IO (Response (Map String Value))\n    let respBody = resp ^. responseBody\n    return respBody\n</code></pre>\n\n<p>response has <code>Content-Type \u2192 application/random.v4+json</code></p>\n\n<p>when I call the function it throws an exception saying</p>\n\n<pre><code>Exception: JSONError \"content type of response is \\\"application/random.v4+json\\\"\"\n</code></pre>\n\n<p>But when I make a call to an API whose response has simple <code>Content-Type \u2192 application/json</code> instead of having some fancy <code>Content-Type \u2192 application/random.v4+json</code></p>\n\n<p>my function works all expected. When the response <code>contenty-type</code> changes to anything otherthan <code>application/json</code> it throws me the above error.</p>\n\n<p>Why is it throwing an exception ? How can make it to work for all the versions of my API ?</p>\n\n<p>**Note: Both versions of API returns same kind of data.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483714904, "post_id": 41508145, "comment_id": 70222440, "body": "I don&#39;t see how it would be possible to implement <code>relation</code>. StanfordType is basically just <code>Show</code> but with <code>Text</code> and thus <code>relation</code> is pretty much <code>(Dep a, Show b) =&gt; a -&gt; b</code>. How do you want to whip up any <code>Show t =&gt; t</code> value? This seems practically impossible. Just like implementing a (total) function <code>a -&gt; b</code>."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483715176, "post_id": 41508145, "comment_id": 70222625, "body": "The compiler can&#39;t work out that they are the same, because they aren&#39;t. The type variable in the definition of <code>Dep</code> is not the same as the <code>b</code> in the definition of <code>DepTag</code>."}, {"owner": {"reputation": 1238, "user_id": 2929228, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cb14a0ca1c489bdb92f63429a6a5cff2?s=128&d=identicon&r=PG&f=1", "display_name": "Sam P", "link": "https://stackoverflow.com/users/2929228/sam-p"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483715490, "post_id": 41508145, "comment_id": 70222798, "body": "@jpath I&#39;m definitely missing something because I don&#39;t understand how they are not the same? <code>DepTag</code> has two parameters, the second I thought was constrained to be a member of <code>StanfordType</code>. The function <code>relation</code> also returns a value that is constrained to be a member of <code>StanfordType</code>. What am I missing?"}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483715765, "post_id": 41508145, "comment_id": 70222949, "body": "The <code>b</code> can be <i>any</i> Member of Stanford type. So if I make a type <code>Foo</code> and make it a member of <code>StandfordType</code>. Then <code>relation</code> has to be able to whip up <code>Foo</code>s, because <code>relation :: Dep a =&gt; a -&gt; Foo</code> is a valid instantiation of <code>relation</code>. Can you give me a valid value of <code>Foo</code>?"}, {"owner": {"reputation": 1238, "user_id": 2929228, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cb14a0ca1c489bdb92f63429a6a5cff2?s=128&d=identicon&r=PG&f=1", "display_name": "Sam P", "link": "https://stackoverflow.com/users/2929228/sam-p"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483716093, "post_id": 41508145, "comment_id": 70223143, "body": "Thanks for the help, I&#39;m still not quite following though. If I decide to implement 1000 members of <code>StanfordType</code>, I don&#39;t understand how they affect <code>relation</code>. So long as <code>relation</code> has the ability to return at least one of those 1000 members of <code>StanfordType</code>, isn&#39;t that alright?"}], "answers": [{"comments": [{"owner": {"reputation": 1238, "user_id": 2929228, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cb14a0ca1c489bdb92f63429a6a5cff2?s=128&d=identicon&r=PG&f=1", "display_name": "Sam P", "link": "https://stackoverflow.com/users/2929228/sam-p"}, "edited": false, "score": 0, "creation_date": 1483717622, "post_id": 41508883, "comment_id": 70224088, "body": "I see, perfect - this really helped. Turns out I need to fundamentally rethink this :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1483719114, "post_id": 41508883, "comment_id": 70225060, "body": "I never recommend the classic existential quantification syntax to beginners. GADT syntax, which the OP clearly knows already, is both clearer and more powerful."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1483719395, "post_id": 41508883, "comment_id": 70225237, "body": "@dfeuer How about you make an edit? I&#39;m not familiar with GADTs."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1483719726, "post_id": 41508883, "comment_id": 70225445, "body": "GADTs basically just let you give an explicit type signature to each constructor, as long as each of them ultimately produces a value of a type whose type constructor is the one being defined. This is ultimately very powerful, since the result can serve as type evidence."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1483719786, "post_id": 41508883, "comment_id": 70225481, "body": "@dfeuer I see. Thank you."}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": true, "score": 4, "last_activity_date": 1483726484, "last_edit_date": 1483726484, "creation_date": 1483716754, "answer_id": 41508883, "question_id": 41508145, "link": "https://stackoverflow.com/questions/41508145/unable-to-deduce-two-constrained-types-are-the-same/41508883#41508883", "title": "Unable to deduce two constrained types are the same", "body": "<blockquote>\n  <p>I can't work out why the compiler can't see that both r in relation (Dep) and b in the type signature of relation are the same.</p>\n</blockquote>\n\n<p>The problem is that they are not the same. The problem here is, that <code>relation :: (Dep a, StanfordType b) =&gt; a -&gt; b</code> has to be able to return every valid <code>b</code>. So while your understanding of the type signature is that you can return any <code>b</code> that you (the writer of <code>relation</code>) want it actually means, that you have to return any <code>b</code> that I (the caller of <code>relation</code>) want. We can make this difference explicit like this (the second variant is not actual Haskell syntax and the first is not standard Haskell):</p>\n\n<pre><code>relation :: forall b. (Dep a, StanfordType b) =&gt; a -&gt; b -- Actual meaning\nrelation :: exists b. (Dep a, StanfordType b) =&gt; a -&gt; b -- Your interpretation\n</code></pre>\n\n<p>So if make a type <code>Foo</code>, that is an instance of <code>StanfordType</code>:</p>\n\n<pre><code>newtype Foo = Foo | Bar\ninstance StanfordType Foo where\n   text = pack \"FooBar\"\n</code></pre>\n\n<p>you can now verify with GHCi, that resolution actually has to be able to return values of type <code>Foo</code>:</p>\n\n<pre><code> &gt; :t resolution :: Dep a =&gt; a -&gt; Foo\n resolution :: Dep a =&gt; a -&gt; Foo :: Dep a =&gt; a -&gt; Foo\n</code></pre>\n\n<p>Of course it is impossible to create values of any unknown type with a <code>StanfordType</code> instance. Especially because literally every type can have a <code>StanfordType</code> instance.</p>\n\n<p>We can actually express the second type using an existential:</p>\n\n<pre><code>data ExtStanfordType where\n   EST :: StanfordType a =&gt; a -&gt; ExtStanfordType\n\nclass StanfordType a =&gt; Dep a where\n    relation :: a -&gt; ExtStanfordType\n\ninstance Dep (DepTag a b) where\n    relation = (DepTag _ r) = EST r\n</code></pre>\n\n<p>Now resolution can return any <code>StanfordType</code> wrapped up in an <code>ExtStanfordType</code>. You can then use <code>text</code> like this:</p>\n\n<pre><code> textExt :: ExtStanfordType -&gt; Text\n textExt (EST b) = text b\n</code></pre>\n\n<p>See also: <a href=\"https://wiki.haskell.org/Existential_type\" rel=\"nofollow noreferrer\">Existential type - Haskell Wiki</a></p>\n"}], "owner": {"reputation": 1238, "user_id": 2929228, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cb14a0ca1c489bdb92f63429a6a5cff2?s=128&d=identicon&r=PG&f=1", "display_name": "Sam P", "link": "https://stackoverflow.com/users/2929228/sam-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 41508883, "answer_count": 1, "score": 0, "last_activity_date": 1483726484, "creation_date": 1483714150, "question_id": 41508145, "link": "https://stackoverflow.com/questions/41508145/unable-to-deduce-two-constrained-types-are-the-same", "title": "Unable to deduce two constrained types are the same", "body": "<p>I have a couple of classes that form part of a wider hierarchy and I'm trying to implement them on <code>DepTag</code>:</p>\n\n<pre><code>class StanfordType a where\n  text :: a -&gt; Text\n\nclass StanfordType a =&gt; Dep a where\n  relation :: (StanfordType b) =&gt; a -&gt; b\n\ndata DepTag a b where\n  DepTag :: (StanfordType a) =&gt; Text -&gt; a -&gt; DepTag Text a\n\ninstance StanfordType (DepTag a b) where \n  text (DepTag s _) = s\n\ninstance Dep (DepTag a b) where \n  relation (DepTag _ r) = r\n</code></pre>\n\n<p>When I try to compile this, I'm thrown the following error:</p>\n\n<pre><code>\u2022 Could not deduce: b ~ b1\n  from the context: (a ~ Text, N.StanfordType b)\n    bound by a pattern with constructor:\n               DepTag :: forall b. N.StanfordType b =&gt; Text -&gt; b -&gt; DepTag Text b,\n             in an equation for \u2018relation\u2019\n    at src/NLP/Data.hs:17:45-54\n  \u2018b\u2019 is a rigid type variable bound by\n    the instance declaration at src/NLP/Data.hs:17:10\n  \u2018b1\u2019 is a rigid type variable bound by\n    the type signature for:\n      relation :: forall b1. N.StanfordType b1 =&gt; DepTag a b -&gt; b1\n    at src/NLP/Data.hs:17:35\n\u2022 In the expression: r\n  In an equation for \u2018relation\u2019: relation (DepTag _ r) = r\n  In the instance declaration for \u2018N.Dep (DepTag a b)\u2019\n\u2022 Relevant bindings include\n    r :: b (bound at src/NLP/Data.hs:17:54)\n    relation :: DepTag a b -&gt; b1 (bound at src/NLP/Data.hs:17:35)\n</code></pre>\n\n<p>I can't work out why the compiler can't see that both <code>r</code> in <code>relation</code> (Dep) and <code>b</code> in the type signature of <code>relation</code> are the same. What am I missing here? </p>\n"}, {"tags": ["haskell", "functional-programming", "blockchain", "ethereum", "smartcontracts"], "comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 3, "creation_date": 1483705753, "post_id": 41505646, "comment_id": 70216745, "body": "Such a measure can not be independet of evaluation strategy. Outermost evaluation will reduce terms to normal form, that innermost won&#39;t. For example <code>const () (fix id)</code>. With outermost evaluation this term will be reduced to normal form in one step. With innermost evaluation this will execute the infinite loop <code>fix id</code>, so the cost would be infinite. <code>fix</code> is from <code>Data.Function</code>."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483706230, "post_id": 41505646, "comment_id": 70217047, "body": "Well actually it would be independent of evaluation strategy if you define it as the minimum number of steps to reduce a term to normal form over all possible evaluation strategies. But that would be equal to the number of steps needed when using lazy evaluation and I don&#39;t think this would be a useful measure for any other evaluation strategy."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483706345, "post_id": 41505646, "comment_id": 70217124, "body": "By step I mean applying a lambda abstraction to <b>one</b> argument or applying a primitive operation its arguments."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483706594, "post_id": 41505646, "comment_id": 70217281, "body": "@jpath Are you sure about the lazy strategy being an optimal evaluation strategy? I thought optimality was more complex."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1483706632, "post_id": 41505646, "comment_id": 70217303, "body": "Then it is not viable to replace such machine with a functional core?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1483706656, "post_id": 41505646, "comment_id": 70217325, "body": "I think this requires defining a cost model for term reduction. I&#39;m pretty sure this has been done, albeit a single &quot;winner&quot; cost model for FP has not emerged."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483706757, "post_id": 41505646, "comment_id": 70217390, "body": "@chi I&#39;m sure my professor said that..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483706813, "post_id": 41505646, "comment_id": 70217434, "body": "Cost model example: you could e.g. perform leftmost-outermost beta steps, and pay a price (e.g. Ethereum &quot;gas&quot;) for every substitution <code>M{N&#47;x}</code> which is <code>size(M)*size(N)</code> (or <code>size(M{N&#47;x})</code>, or ...). Better (in some sense) formulas surely exist."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483706967, "post_id": 41505646, "comment_id": 70217543, "body": "@jpath Mhhh not sure. If we evaluate <code>map (\\x -&gt; id id id x) [1..5]</code> in a lazy way, then <code>id id id</code> gets evaluated 5 times, I think."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483706978, "post_id": 41505646, "comment_id": 70217551, "body": "@chi that is a progress, but it seems to overcharge for linear terms and undercharge for terms with tons of copies of <code>x</code> (which could possibly be a room for attack: send for the blockchain terms whose beta-reductions take exponential time on their size)."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1483707069, "post_id": 41505646, "comment_id": 70217605, "body": "@MaiaVictor I think evaluation strategy is part of a language definition, because you can not write a program for one evaluation strategy and expect it to work with any other strategy. So if you define the evaluation strategy the problem goes away."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483707136, "post_id": 41505646, "comment_id": 70217647, "body": "@MaiaVictor Agreed, it&#39;s not ideal. Perhaps for Ethereum-related purposes a bit of overcharging is OK, the important aspect is to not undercharge (for attacks, as you say). By the way, isn&#39;t the cost above proportional to the number of copies anyway?"}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483707153, "post_id": 41505646, "comment_id": 70217658, "body": "@chi Lazy evaluation is not just outermost evaluation, but outermost evaluation with memorisation. So <code>id id id</code> should only be evaluated once."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483707154, "post_id": 41505646, "comment_id": 70217659, "body": "@jpath you can&#39;t force nodes to run a specific strategy... in practice some nodes will find different evaluation strategies for some terms to gain an advantage."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483707279, "post_id": 41505646, "comment_id": 70217729, "body": "@chi ah, I think it is. Interesting idea, then. So this never undercharges, but overcharges often, right? That might be an issue for user experience, but might be good enough to work."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1483707457, "post_id": 41505646, "comment_id": 70217854, "body": "@MaiaVictor I think so. Probably <code>size(M{N&#47;x})</code> is better, even if it overcharges since it does not take sharing into account."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483707501, "post_id": 41505646, "comment_id": 70217886, "body": "@MaiaVictor If your cost model is based on outermost evaluation, they will have to use outermost otherwise they won&#39;t be able to reduce terms with finite cost. What they can do is use optimisations like strictness analysis and sharing/memorisation to be more efficient in some cases. If you base your model around innermost evaluation they can use outermost or innermost evaluation but programmers can not make use of the benefits of outermost evaluation."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1483736418, "post_id": 41505646, "comment_id": 70234560, "body": "&quot;in practice some nodes will find different evaluation strategies for some terms to gain an advantage.&quot; Why doesn&#39;t this apply equally to an imperative stack-register machine language?"}], "answers": [{"tags": [], "owner": {"reputation": 547, "user_id": 761122, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7369f387f0a6481166e70cee97cff208?s=128&d=identicon&r=PG", "display_name": "Kang", "link": "https://stackoverflow.com/users/761122/kang"}, "is_accepted": false, "score": 1, "last_activity_date": 1487417905, "creation_date": 1487417905, "answer_id": 42314636, "question_id": 41505646, "link": "https://stackoverflow.com/questions/41505646/how-to-accurately-measure-the-effort-required-to-reduce-a-%ce%bb-term/42314636#42314636", "title": "How to accurately measure the effort required to reduce a \u03bb-term?", "body": "<p>\"just fix a cost for each primitive operation and sum\" is not easy to do. A blockchain network dynamically determines the true value of its token for whatever value the minimum of its token provides. For eg, a gas is worth whatever the world wants to pay for it to use it as a unit of calculation on the world computer. To accurately measure the effort spent by the network to ensure the unit value of its token , we need a DMMS algorithm(as described in the sidechains paper) &amp; which is nothing but a proof-of-work blockchain.</p>\n\n<p>Each primitive operation needs its own blockchain for its value to be determined accurately. When multiple token are implemented over a single blockchain, for eg colored/custom coins, it cannot accurately measure the value of a unit.</p>\n\n<p>In case of functional language, one could perhaps imagine a lisp blockchain with paul graham's 7 primitives implemented as an opcode (stack based interpretor is irrelevant), which would be turing complete but will suffer from the problem of determining the true value of each opcode; the cheapest one will always be abused as evident on ethereum (suicide function's cheapness was spammed). </p>\n\n<p>Thus, to achieve a functional turing complete blockchain you need a braid network of 7 blockchains, each independently determining the true value of effort required for that primitive calculation.</p>\n\n<p>People who have alternatives to proof-of-work will disagree with the above. Cryptocurrency is a new field and the maths is not mature enough for anyone to make concrete claims.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 3, "answer_count": 1, "score": 5, "last_activity_date": 1487417905, "creation_date": 1483705354, "question_id": 41505646, "link": "https://stackoverflow.com/questions/41505646/how-to-accurately-measure-the-effort-required-to-reduce-a-%ce%bb-term", "title": "How to accurately measure the effort required to reduce a \u03bb-term?", "body": "<p>Blockchains such as Ethereum use a stack-register based language on their smart-contract processing virtual machines. That model is very convenient because it provides a simple mechanism to measure the amount of work required to run programs: just fix a cost for each primitive operation and sum.</p>\n\n<p>Suppose that, instead of virtual machines, a blockchain featuring smart-contracts used a functional programming language such as Haskell's core. Is there any simple, accurate way to measure the amount of work required to execute a functional program - keeping in mind that nodes are able to use any evaluation strategy, so such measurement must be universal.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1483701556, "post_id": 41504364, "comment_id": 70214303, "body": "The simplest approach would be having <code>Arg</code> datatype that has an <code>Agent</code> field. Would that be insufficient?"}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1483701698, "post_id": 41504364, "comment_id": 70214389, "body": "@danidiaz That would contradict this requirement: &quot;When I have a function that operates on an arg, the type that I use to represent arg should also include agent&quot;."}, {"owner": {"reputation": 1513, "user_id": 6624417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a73a12db09cb90a99be14fa2bb7b6096?s=128&d=identicon&r=PG&f=1", "display_name": "E4z9", "link": "https://stackoverflow.com/users/6624417/e4z9"}, "edited": false, "score": 0, "creation_date": 1483706890, "post_id": 41504364, "comment_id": 70217484, "body": "this might be an interesting related read: <a href=\"https://wiki.haskell.org/OOP_vs_type_classes\" rel=\"nofollow noreferrer\">wiki.haskell.org/OOP_vs_type_classes</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483712562, "post_id": 41504364, "comment_id": 70220987, "body": "The best approach I have seen in &quot;practice&quot; to solving this problem is the subtyping as defined in subhask. Essentially, you define a typeclass to represent subtype relationships (and a few difficult-to-implement choice instances to get the transitivity property) which has only an &#39;embed&#39; function."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483713068, "post_id": 41504364, "comment_id": 70221276, "body": "<a href=\"https://hackage.haskell.org/package/subhask-0.1.1.0/docs/SubHask-SubType.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/subhask-0.1.1.0/docs/&hellip;</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483719987, "post_id": 41504364, "comment_id": 70225615, "body": "Do you have any actual fields in these classes/types?"}, {"owner": {"reputation": 1238, "user_id": 2929228, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cb14a0ca1c489bdb92f63429a6a5cff2?s=128&d=identicon&r=PG&f=1", "display_name": "Sam P", "link": "https://stackoverflow.com/users/2929228/sam-p"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483720638, "post_id": 41504364, "comment_id": 70226035, "body": "@Alec all types will have a text field, members of <code>dep</code> have an additional relation field. What&#39;s important is that the type itself is conveying some useful information about the context of the relation. The context gets more specific the further down the hierarchy you travel."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1483736749, "post_id": 41504364, "comment_id": 70234714, "body": "@SamP, this is interesting. &quot;The type itself is conveying some useful information ...&quot;.  In constructive logic, information comes with witness. E.g. if for every A there is a B such that..., there will be a witness function <code>A -&gt; B</code>.  Find the witnesses of your &quot;useful information&quot;, and you might get insight into how to model it."}], "answers": [{"comments": [{"owner": {"reputation": 1238, "user_id": 2929228, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cb14a0ca1c489bdb92f63429a6a5cff2?s=128&d=identicon&r=PG&f=1", "display_name": "Sam P", "link": "https://stackoverflow.com/users/2929228/sam-p"}, "edited": false, "score": 1, "creation_date": 1483707359, "post_id": 41504598, "comment_id": 70217781, "body": "Why has this been downvoted? I get that this isn&#39;t the ideal use of a type class, but is there an alternative? Would this + GADT not do it?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1483712779, "post_id": 41504598, "comment_id": 70221109, "body": "Not a downvoter but probably because you are using type classes merely as a means of overloading (and not as an abstraction). I wouldn&#39;t recommend this approach, but I don&#39;t think pointing it out is a bad idea"}], "tags": [], "owner": {"reputation": 4516, "user_id": 1937198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b97a3ec92aed1c16e35c1bf532465d6b?s=128&d=identicon&r=PG", "display_name": "user1937198", "link": "https://stackoverflow.com/users/1937198/user1937198"}, "is_accepted": false, "score": 0, "last_activity_date": 1483701984, "last_edit_date": 1483701984, "creation_date": 1483701664, "answer_id": 41504598, "question_id": 41504364, "link": "https://stackoverflow.com/questions/41504364/how-to-model-hierarchical-data-types-in-haskell/41504598#41504598", "title": "How to model hierarchical data types in Haskell?", "body": "<p>Use typeclasses.</p>\n\n<p>First define each of the concrete types as a seperate data declaration.</p>\n\n<p>Then for each type with subtypes declare a typeclass with a constraint on its parent. An example of this sort of relationship is Functor =>  Applicative => Monad structure in prelude. </p>\n\n<p>So to define the example structure:</p>\n\n<pre><code>class Root where\n    ...\n\nclass Root =&gt; Dep where\n    ...\n\nclass Dep =&gt; Aux where\n    ...\n\nclass Aux =&gt; Auxpass where\n    ...\n\nclass Aux =&gt; Cop where\n    ...\n\nclass Dep =&gt; Arg where\n    ...\n\nclass Arg =&gt; Agent where\n    ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1483723722, "creation_date": 1483723722, "answer_id": 41511007, "question_id": 41504364, "link": "https://stackoverflow.com/questions/41504364/how-to-model-hierarchical-data-types-in-haskell/41511007#41511007", "title": "How to model hierarchical data types in Haskell?", "body": "<p>Subtyping in general does not play too well with Haskell. However, in the case that you are just trying to model (non-multiple) inheritance (so you have a tree of subtypes instead of a lattice), you can actually build sub typing up using type classes. <a href=\"https://gist.github.com/harpocrates/38ec83098cd45d7e8bccbb2d7001acb5#file-subtype-hs\" rel=\"nofollow noreferrer\">Here is a short gist that does exactly this.</a> Working from there, you define your data types</p>\n\n<pre><code>data Root = Root ...\ndata Dep = Dependent ...\ndata Aux = Auxiliary ...\ndata AuxPass = PassiveAuxiliary ... \ndata Cop = Copula ...\ndata Arg = Argument ...\ndata Agent = Agent ...\n</code></pre>\n\n<p>And the corresponding instances </p>\n\n<pre><code>instance Subtype Aux where\n  type SuperType Aux = Dep\n  embedImmediate = ...\n\ninstance Subtype AuxPass where\n  type SuperType AuxPass = Aux\n  embedImmediate = ...\n\ninstance Subtype Cop where\n  type SuperType Cop = Aux\n  embedImmediate = ...\n\ninstance Subtype Arg where\n  type SuperType Arg = Dep\n  embedImmediate = ...\n\ninstance Subtype Agent where\n  type SuperType Agent = Arg\n  embedImmediate = ...\n</code></pre>\n\n<p>How you fill in the <code>...</code> is up to you. A couple things you could do for this:</p>\n\n<ul>\n<li>if your subtype adds lots of fields on top of the supertype, consistently, just add to it a field that has the supertype and make <code>embedImmediate</code> return that field</li>\n<li>if your subtype adds only a couple of fields, you might want to manually unpack them. Your <code>data</code> definitions will look neater, but your <code>embedImmediate</code> definition will be a bit longer</li>\n<li>if your subtypes doesn't add any fields to the supertype, you can just make a <code>newtype</code> around the super type and <code>embedImmediate = coerce</code> (from <code>Data.Coerce</code>)</li>\n</ul>\n\n<p>Then, you can't <em>quite</em> just use the subtypes in functions that expect supertypes, but almost: you just have to add a call to <code>embed</code> (different from <code>embedImmediate</code>!) to convert from the subtype to whichever supertype is needed (based on type inference). You may want to check out <a href=\"https://gist.github.com/harpocrates/38ec83098cd45d7e8bccbb2d7001acb5#file-subtype-examples-hs\" rel=\"nofollow noreferrer\">some example uses</a>.</p>\n\n<p>Note that you can now use <code>&lt;:</code> as a constraint: the type of something that is a subtype of <code>Aux</code>, for example, is <code>(a &lt;: Aux) =&gt; a</code>. Whenever you want this thing treated as an <code>Aux</code> (or a super type of <code>Aux</code>), call <code>embed</code> on it.</p>\n\n<p>The one big downside of this approach is that the input and output types must be annotated (else it isn't clear <em>which</em> supertype you want to <code>embed</code> into and you'll get \"ambiguous type\" errors). If you already write lots of signatures, you should be fine though.</p>\n"}], "owner": {"reputation": 1238, "user_id": 2929228, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/cb14a0ca1c489bdb92f63429a6a5cff2?s=128&d=identicon&r=PG&f=1", "display_name": "Sam P", "link": "https://stackoverflow.com/users/2929228/sam-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 578, "favorite_count": 2, "answer_count": 2, "score": 4, "last_activity_date": 1483723722, "creation_date": 1483700833, "last_edit_date": 1483701355, "question_id": 41504364, "link": "https://stackoverflow.com/questions/41504364/how-to-model-hierarchical-data-types-in-haskell", "title": "How to model hierarchical data types in Haskell?", "body": "<p>I have a bunch of types where their hierarchy stores some useful information. I'm trying to avoid having to bake in knowledge of the hierarchy of the types into the functions that operate on them. </p>\n\n<p>The following is a little excerpt of Stanford's Typed Dependencies for natural language processing:</p>\n\n<pre><code>root - root\ndep - dependent\n  aux - auxiliary\n    auxpass - passive auxiliary \n    cop - copula\n  arg - argument \n    agent - agent\n</code></pre>\n\n<p>I would like to create some data types that mirror this structure so that I can define some functions that can only operate on certain types. When I have a function that operates on an <code>arg</code>, the type that I use to represent <code>arg</code> should also include <code>agent</code> but the type for <code>agent</code> should not include <code>arg</code>. The type for <code>dep</code> should include anything below it.</p>\n\n<p>Is this possible in haskell? I've been trying to declare various <code>data</code> types to model this, but I can't get it to work since a data type cannot use the constructor of another data type.</p>\n\n<p>I suspect that maybe this approach doesn't work very well with Haskell, so if that's the case how do you usually deal with these cases where flattening the hierarchy is definitely undesirable?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1483699563, "post_id": 41503371, "comment_id": 70213187, "body": "habe a look at <a href=\"http://learnyouahaskell.com/types-and-typeclasses\" rel=\"nofollow noreferrer\">learnyouahaskell.com/types-and-typeclasses</a> for a good intro to type classes... (but the kind of function overloading you&#39;re looking for is probably simply not possible and neither desirable in haskell)"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 3, "creation_date": 1483700033, "post_id": 41503371, "comment_id": 70213455, "body": "your question isn&#39;t very specific. what exactly are you trying to achieve? concrete example? the simple answer is that one function can only have on function signature in haskell, not four like in your example."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1483705393, "post_id": 41503371, "comment_id": 70216528, "body": "I can maybe see the first three being combined to something like <code>foo :: FooArgs -&gt; Double</code>, where <code>FooArgs</code> is a sum of <code>(Int, String)</code>, <code>(String, String)</code>, and <code>String</code>, but the last should probably be a separate function."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1483712752, "post_id": 41503371, "comment_id": 70221093, "body": "Unless the first <code>String</code> argument itself determines what to return, you can&#39;t differentiate between (2) and (3) due to currying. Should <code>foo &quot;bar&quot;</code> return a <code>Double</code> or a function of type <code>String -&gt; Double</code>?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1483844981, "post_id": 41503371, "comment_id": 70263900, "body": "I don&#39;t know why you are editing your question into gibberish, but please stop."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1483908444, "post_id": 41503371, "comment_id": 70280616, "body": "I have already asked to delete this question. It doesn&#39;t express exactly what I meant. The answer is wrong, but cos of it I cannot remove the question. Can you please delete this question for me? People just voting down without a reason. Thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 5, "last_activity_date": 1483703584, "last_edit_date": 1483703584, "creation_date": 1483700633, "answer_id": 41504301, "question_id": 41503371, "link": "https://stackoverflow.com/questions/41503371/idiomatic-function-overloading/41504301#41504301", "title": "Idiomatic function overloading", "body": "<p>Technically, you can do like this:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}                                          \n\nclass Foo a where\n    foo :: a\n\ninstance Foo (Int -&gt; String -&gt; Double) where\n    foo = ...\n\ninstance Foo (String -&gt; String -&gt; Double) where\n    foo = ...\n\ninstance Foo (String -&gt; Double) where\n    foo = ...\n\ninstance Foo (Char -&gt; Integer -&gt; Integer -&gt; String) where\n    foo = ...\n</code></pre>\n\n<p>But, I think it's usually bad way, because I believe that these functions have random properties, you just union them to group by your mind and in the future somebody will hard to understand the <code>foo</code> function.</p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1483844954, "creation_date": 1483697507, "last_edit_date": 1483844954, "question_id": 41503371, "link": "https://stackoverflow.com/questions/41503371/idiomatic-function-overloading", "title": "Idiomatic function overloading", "body": "<p>I googled a lot but still confused about the most idiomatic way to overloading function in Haskell. Given:</p>\n\n<pre><code>foo :: Int -&gt; String -&gt; Double\nfoo :: String -&gt; String -&gt; Double\nfoo :: String -&gt; Double\nfoo :: Char -&gt; Integer-&gt; Integer -&gt; Integer -&gt; String\n</code></pre>\n\n<p>(not sure if I covered all the possible cases) how would you make it idiomatic (type classes?)</p>\n"}, {"tags": ["haskell", "ghc", "overlapping-instances"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 7383150, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/425c1193ea905bb0f3ad55601efa61f1?s=128&d=identicon&r=PG&f=1", "display_name": "Didier Pieroux", "link": "https://stackoverflow.com/users/7383150/didier-pieroux"}, "edited": false, "score": 0, "creation_date": 1483737968, "post_id": 41503808, "comment_id": 70235319, "body": "Thanks a lot Shree. So basically, it looks like it is simply &quot;the way GHC works&quot; on this (non-standard) extension. I close the question."}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 2, "last_activity_date": 1483698970, "creation_date": 1483698970, "answer_id": 41503808, "question_id": 41503036, "link": "https://stackoverflow.com/questions/41503036/haskell-ghc-overlapping-instances-reported-while-context-only-allows-a-single-o/41503808#41503808", "title": "Haskell/GHC: overlapping instances reported while context only allows a single one", "body": "<p>My understanding (could be very wrong):</p>\n\n<p>First, from the <a href=\"https://downloads.haskell.org/~ghc/7.0.1/docs/html/users_guide/type-class-extensions.html#instance-overlap\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>When matching, GHC takes no account of the context of the instance\n  declaration (context1 etc). GHC's default behaviour is that exactly\n  one instance must match the constraint it is trying to resolve. It is fine for there to be a potential of overlap (by including both declarations (A) and (B), say); an error is only reported if a particular constraint matches more than one.</p>\n  \n  <p>The -XOverlappingInstances flag instructs GHC to allow more than one\n  instance to match, provided there is a most specific one.</p>\n</blockquote>\n\n<p>In your case, the type passed to <code>foo</code> is <code>[(Char,Bool)]</code>. This satisfies the generic <code>[a]</code> and the more specialised <code>[(Char,a)]</code>. In the absence of <code>OverlappingInstances</code> flag, the most specific match scenario does not apply, and an error is reported.</p>\n\n<p>Now if you were to tweak your code slightly like so:</p>\n\n<pre><code>instance C Bool\ninstance (C a) =&gt; C [a]\ninstance (C a) =&gt; C (Char, a)\n</code></pre>\n\n<p>Then there would be no overlap, because a tuple is not a list.</p>\n"}], "owner": {"reputation": 13, "user_id": 7383150, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/425c1193ea905bb0f3ad55601efa61f1?s=128&d=identicon&r=PG&f=1", "display_name": "Didier Pieroux", "link": "https://stackoverflow.com/users/7383150/didier-pieroux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 41503808, "answer_count": 1, "score": 1, "last_activity_date": 1483698970, "creation_date": 1483696359, "last_edit_date": 1483696759, "question_id": 41503036, "link": "https://stackoverflow.com/questions/41503036/haskell-ghc-overlapping-instances-reported-while-context-only-allows-a-single-o", "title": "Haskell/GHC: overlapping instances reported while context only allows a single one", "body": "<p>Dear Haskell/GHC experts,</p>\n\n<p>I don't really understand why GHC reports overlapping instances while only one is actually valid according the provided contexts. For instance, let's consider the following piece of code:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\nclass C a where\n    foo :: a -&gt; String\n    foo x = \"OK\"\n\ninstance C Bool\ninstance (C a) =&gt; C [a]\ninstance (C a) =&gt; C [(Char, a)]\n\nmain = print $ foo [('a', True)]\n</code></pre>\n\n<p>Compiling it gives:</p>\n\n<pre><code>Test.hs:13:16: error:\n    * Overlapping instances for C [(Char, Bool)]\n        arising from a use of `foo'\n      Matching instances:\n        instance C a =&gt; C [a] -- Defined at Test.hs:9:10\n        instance C a =&gt; C [(Char, a)] -- Defined at Test.hs:11:10\n    * In the second argument of `($)', namely `foo [('a', True)]'\n      In the expression: print $ foo [('a', True)]\n      In an equation for `main': main = print $ foo [('a', True)]\n</code></pre>\n\n<p>The point is that <code>('a', True)</code> has type <code>(Char, Bool)</code> which is not an instance of <code>C</code>. Therefore, <code>instance C a => C [a]</code> is not applicable to the value <code>[('a', True)]</code>.</p>\n\n<p>Therefore, why does GHC consider it?</p>\n\n<p>The question is really about understanding the behaviour of GHC, not about how to avoid the issue (e.g. using <code>OverlappingInstances</code>). Is it because contexts are not used when \"resolving\" a function call? And if so, why?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["performance", "haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1483691537, "post_id": 41501748, "comment_id": 70208715, "body": "Question aside, this is a use case begging for <code>conduit</code> or <code>pipes</code>."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1483694961, "post_id": 41501748, "comment_id": 70210371, "body": "The <code>getInput</code> identifier isn&#39;t in scope, is it defined elsewhere in your program or imported from somewhere?"}, {"owner": {"reputation": 101, "user_id": 5027049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dd6bcb4294fed4ef681cc9a92af4260?s=128&d=identicon&r=PG&f=1", "display_name": "Ralli", "link": "https://stackoverflow.com/users/5027049/ralli"}, "edited": false, "score": 0, "creation_date": 1483697123, "post_id": 41501748, "comment_id": 70211747, "body": "getInput is defined elsewhere, based on the command line arguments it returns stdin or an open file handle for input and stdout or a file handle for output"}], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 5027049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dd6bcb4294fed4ef681cc9a92af4260?s=128&d=identicon&r=PG&f=1", "display_name": "Ralli", "link": "https://stackoverflow.com/users/5027049/ralli"}, "edited": false, "score": 0, "creation_date": 1483694352, "post_id": 41502017, "comment_id": 70210034, "body": "i understand this, but the programs reads and processes the complete file in both cases. I don&#39;t think that reading a one MB file in one block should take 35 times longer than reading line by line."}, {"owner": {"reputation": 450, "user_id": 3711397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9adb9f05f4da9535fe896434488c828?s=128&d=identicon&r=PG&f=1", "display_name": "prof1990", "link": "https://stackoverflow.com/users/3711397/prof1990"}, "reply_to_user": {"reputation": 101, "user_id": 5027049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dd6bcb4294fed4ef681cc9a92af4260?s=128&d=identicon&r=PG&f=1", "display_name": "Ralli", "link": "https://stackoverflow.com/users/5027049/ralli"}, "edited": false, "score": 0, "creation_date": 1483694876, "post_id": 41502017, "comment_id": 70210328, "body": "The memory footprint is also a lot smaller. but i agree it only explains part of the speed increase. you could force memory usage  and kill some of the Lazyness by changing &quot; let newLog = processLog actLog&quot; to  &quot;newLog &lt;- processLog actLog&quot;  see if that kills the speed in the same order as using the non lazy Data.Text"}, {"owner": {"reputation": 101, "user_id": 5027049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dd6bcb4294fed4ef681cc9a92af4260?s=128&d=identicon&r=PG&f=1", "display_name": "Ralli", "link": "https://stackoverflow.com/users/5027049/ralli"}, "edited": false, "score": 0, "creation_date": 1483697347, "post_id": 41502017, "comment_id": 70211870, "body": "&quot;newLog &lt;- processLog actLog&quot; does not compile"}, {"owner": {"reputation": 450, "user_id": 3711397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9adb9f05f4da9535fe896434488c828?s=128&d=identicon&r=PG&f=1", "display_name": "prof1990", "link": "https://stackoverflow.com/users/3711397/prof1990"}, "reply_to_user": {"reputation": 101, "user_id": 5027049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dd6bcb4294fed4ef681cc9a92af4260?s=128&d=identicon&r=PG&f=1", "display_name": "Ralli", "link": "https://stackoverflow.com/users/5027049/ralli"}, "edited": false, "score": 0, "creation_date": 1483698336, "post_id": 41502017, "comment_id": 70212456, "body": "my bad forgot to wrap that in a monad &quot;newLog &lt;- return $ processLog actLog&quot; should compile. But not shure if it actualy forces the strictness."}, {"owner": {"reputation": 101, "user_id": 5027049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dd6bcb4294fed4ef681cc9a92af4260?s=128&d=identicon&r=PG&f=1", "display_name": "Ralli", "link": "https://stackoverflow.com/users/5027049/ralli"}, "edited": false, "score": 0, "creation_date": 1483700221, "post_id": 41502017, "comment_id": 70213572, "body": "yes, this does compile but the runtime is still the same"}], "tags": [], "owner": {"reputation": 450, "user_id": 3711397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9adb9f05f4da9535fe896434488c828?s=128&d=identicon&r=PG&f=1", "display_name": "prof1990", "link": "https://stackoverflow.com/users/3711397/prof1990"}, "is_accepted": false, "score": 0, "last_activity_date": 1483692723, "creation_date": 1483692723, "answer_id": 41502017, "question_id": 41501748, "link": "https://stackoverflow.com/questions/41501748/haskell-data-text-vs-data-text-lazy-performance/41502017#41502017", "title": "Haskell: Data.Text vs. Data.Text.Lazy Performance", "body": "<p>The difference between the lazy and normal Data.Text is whether the entire file is read into memory at </p>\n\n<pre><code>actLog &lt;- T.hGetContents inp \n</code></pre>\n\n<p>When processed lazy Haskell reads only the line directly required to produce the output. So instead of reading the entire file and then processing and writing as needed, it can now read, write and process as needed eliminating the wait for the entire file to be read in memory.</p>\n"}, {"comments": [{"owner": {"reputation": 101, "user_id": 5027049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dd6bcb4294fed4ef681cc9a92af4260?s=128&d=identicon&r=PG&f=1", "display_name": "Ralli", "link": "https://stackoverflow.com/users/5027049/ralli"}, "edited": false, "score": 0, "creation_date": 1483874650, "post_id": 41505249, "comment_id": 70269388, "body": "After rewriting the program as suggested both versions have the same runtime"}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 1, "last_activity_date": 1483704032, "creation_date": 1483704032, "answer_id": 41505249, "question_id": 41501748, "link": "https://stackoverflow.com/questions/41501748/haskell-data-text-vs-data-text-lazy-performance/41505249#41505249", "title": "Haskell: Data.Text vs. Data.Text.Lazy Performance", "body": "<p>This looks like a data structures issue rather than a laziness issue. A strict <code>Text</code> is essentially a single big chunk of memory, while a lazy <code>Text</code> is essentially a linked list of strict <code>Text</code>s (\"chunks\"). The way that a lazy <code>Text</code> is split up into chunks isn't supposed to be part of the meaning of the value (which is just the text obtained by concatenating all the chunks). But it can have a big effect on the cost of operations.</p>\n\n<p>You have a bunch of operations of the form <code>short &lt;&gt; accu</code> where <code>accu</code> is growing with the size of your output. If these are strict <code>Text</code>s, this concatenation has to copy the entire contents of both <code>short</code> and <code>accu</code> into a new strict <code>Text</code> value. The total runtime is necessarily quadratic. If they are lazy <code>Text</code>s, then <code>&lt;&gt;</code> has another option: it can prepend the list of chunks that is <code>short</code> to the list of chunks that is <code>accu</code>. This doesn't need to touch <code>accu</code> at all, but even if it did, the spine of the linked list of chunks that makes up <code>accu</code> could be much less data to process than the entire textual contents of <code>accu</code>, depending on the chunk size. That's why your lazy <code>Text</code> version is so much faster.</p>\n\n<p>It looks like you could write your program in the form</p>\n\n<pre><code>processLog = T.unlines . processLines . T.lines\nprocessLines :: [T.Text] -&gt; [T.Text]\nprocessLines = ...\n</code></pre>\n\n<p>which leaves the problem of how to concatenate up to the library function <code>T.unlines</code>, in which case you can expect it to be efficient whether you use strict <code>Text</code> or lazy <code>Text</code>.</p>\n"}], "owner": {"reputation": 101, "user_id": 5027049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dd6bcb4294fed4ef681cc9a92af4260?s=128&d=identicon&r=PG&f=1", "display_name": "Ralli", "link": "https://stackoverflow.com/users/5027049/ralli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1483704032, "creation_date": 1483691335, "question_id": 41501748, "link": "https://stackoverflow.com/questions/41501748/haskell-data-text-vs-data-text-lazy-performance", "title": "Haskell: Data.Text vs. Data.Text.Lazy Performance", "body": "<p>for training i wrote a short Haskell program as a replacement for a Perl script.\nThe program reads a log file which contains multi-line messages and simply joins them to produce one line per message.\nMy test input file has 14000 lines and a size of 1 MB.\nThe version using Data.Text has a runtime of 3.5 secs, the one using Data.Text.Lazy only 0.1 secs (the original perl script needs 0.2 secs).\nI found in other posts that using Data.Text.Lazy would only make sense for really great amounts of data and didn't expect such a difference.\nCan anybody explain the reason why or what's wrong with my program ?</p>\n\n<p>The relevant part of the source (the only difference between both versions is the import Data.Text*):</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\nimport Data.Char (isDigit)\nimport Data.Monoid ((&lt;&gt;))\nimport qualified Data.Text.Lazy    as T\nimport qualified Data.Text.Lazy.IO as T\nimport System.Environment (getArgs, getProgName)\nimport System.IO (openFile, stdin, stdout, Handle,\n                  IOMode(ReadMode,WriteMode))\n\nmain :: IO ()\nmain = do\n  (inp,out) &lt;- getInput\n  actLog &lt;- T.hGetContents inp\n  let newLog = processLog actLog\n  T.hPutStr out newLog\n\nprocessLog :: T.Text -&gt; T.Text\nprocessLog = foldr joinLines \"\" . T.lines\n\njoinLines :: T.Text -&gt; T.Text -&gt; T.Text\njoinLines elem accu\n  | T.length elem == 0    = accu                     -- Blank Line\n  | T.head elem   == ' '  = textElem &lt;&gt; accu         -- Continuation\n  | isDigit (T.head elem) = \"\\n\" &lt;&gt; textElem &lt;&gt; accu -- Start\n  | otherwise             = accu                     -- Garbage\n    where textElem = T.strip elem\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 7, "last_activity_date": 1483687395, "last_edit_date": 1483687395, "creation_date": 1483686954, "answer_id": 41500803, "question_id": 41500747, "link": "https://stackoverflow.com/questions/41500747/haskell-modyfying-only-one-field-of-structure/41500803#41500803", "title": "Haskell, modyfying only one field of structure", "body": "<p>You can use a record update and specify only the fields you want to update. Also, you can extract a particular field during pattern matching.</p>\n\n<pre><code>s@S{ a = a' } &lt;- get \nput $ s{ a = a' + 1 } \n</code></pre>\n\n<hr>\n\n<p>Alternately, if you find yourself doing a lot of this sort of thing, you might want to use <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\"><code>lens</code></a>. With <code>lens</code>, you would have to make lenses for <code>S</code> (which requires turning on <code>-XTemplateHaskell</code>)</p>\n\n<pre><code>data S = { _a, _b :: Integer, _c :: String, _d :: Map String Integer }\nmakeLenses ''S\n</code></pre>\n\n<p>But then, in your state monad you can just write</p>\n\n<pre><code>a += 1\n</code></pre>\n\n<p>Yep, this is legitimate Haskell. <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Setter.html#v:-43--61-\" rel=\"nofollow noreferrer\"><code>+=</code></a> is actually a thing.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7361363"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 41500803, "answer_count": 1, "score": 3, "last_activity_date": 1483721144, "creation_date": 1483686705, "last_edit_date": 1483721144, "question_id": 41500747, "link": "https://stackoverflow.com/questions/41500747/haskell-modyfying-only-one-field-of-structure", "title": "Haskell, modyfying only one field of structure", "body": "<p>I have a some structure:  </p>\n\n<pre><code>data S = { \n  a :: Integer,\n  b :: Integer,\n  c :: String,\n  d :: Map String Integer\n}   \n</code></pre>\n\n<p>I closed it in my <code>State monad</code>, And I am using it in following way:   </p>\n\n<pre><code>s &lt;- get\nlet S {a = a', b =b', c=c', d=d'} s   \nput $ S {a = a' + 1, b = b', c= c', d = d'}   \n</code></pre>\n\n<p>As you can see, when I would like to modify/read only one field (here <code>a</code>), I must get and put all fields - it is embarassing - otherwise I get warnings and sometimes runtime errors.   </p>\n\n<p>Can you try to propose me some solution to make it better and cleaner ?  </p>\n\n<p>Thanks in advance,<br>\nRegards</p>\n"}, {"tags": ["haskell", "recursion", "gadt", "data-kinds"], "answers": [{"comments": [{"owner": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "edited": false, "score": 0, "creation_date": 1483682530, "post_id": 41498943, "comment_id": 70205366, "body": "Wow, thank you for the incredibly thorough answer. That makes perfect sense and is so much more elegant, especially the <code>DataPart</code> portion. One question I have about DataPart is how to add data for the other types. Changing it to <code>A_Data :: ((x ==? &#39;A) ~ &#39;True)</code> with similar for the others doesn&#39;t work."}, {"owner": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "edited": false, "score": 0, "creation_date": 1483683523, "post_id": 41498943, "comment_id": 70205734, "body": "Ah, I figured it out. <code>A_Data :: ((x ==? &#39;A) ~ &#39;True) =&gt; Integer -&gt; DataPart x</code> works, but <code>... =&gt; Integer -&gt; DataPart &#39;A</code> does not. I&#39;m not entirely sure why though."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "edited": false, "score": 1, "creation_date": 1483775981, "post_id": 41498943, "comment_id": 70244379, "body": "The type variable <code>x</code> in the constructor <code>A_Data :: ((x ==? &#39;A) ~ &#39;True) =&gt; ... -&gt; DataPart &#39;A</code> is not related at all to the type variable in the index of the type - it only works because type variables are bound implicitly, but in these two cases the type variables play entirely different roles - in the first case, the constructor contains a constraint on a type parameter, in the latter, an existentially quantified type variable (with a constraint) as well as a proof that the parameter is precisesly <code>&#39;A</code> - but the existentially quantified variable and the parameter are entirely unrelated."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 7, "last_activity_date": 1483677282, "last_edit_date": 1483677282, "creation_date": 1483676860, "answer_id": 41498943, "question_id": 41498540, "link": "https://stackoverflow.com/questions/41498540/how-to-process-a-recursive-gadt-with-kind-somedatakind/41498943#41498943", "title": "How to process a recursive GADT with kind :: &#39;[SomeDataKind]", "body": "<p>The error you get is a red herring - GHC cannot infer the types of functions on GADTs. You must give it a type signature to see the real mistake: </p>\n\n<pre><code>propogate :: SomeData x -&gt; SomeData x \n....\n</code></pre>\n\n<p>This gives the error:</p>\n\n<pre><code>* Couldn't match type `x' with `p0 : parts0'\n  `x' is a rigid type variable bound by\n    the type signature for:\n      propogate :: forall (x :: [DataKind]). SomeData x -&gt; SomeData x\n  Expected type: SomeData (p0 : parts0)\n    Actual type: SomeData x\n</code></pre>\n\n<p>If it is not clear, this error message says that we claim that the type arguement to <code>SomeData</code> is just a variable (that is, we know nothing about it, except its kind) but the use of some functions inside <code>propogate</code> require it to be of the form <code>p0 : parts0</code> for some types <code>p0 : parts0</code>.</p>\n\n<p>However, you state at the beginning: </p>\n\n<blockquote>\n  <p>'parts' should always contain at least 1 element which is enforced by\n  the GADT.</p>\n</blockquote>\n\n<p>but the compiler doesn't know this! You must tell it, and typically this is done by pattern matching on a GADT constructor which brings a type equality into scope. Your only issue here is you would have to match on three constructors, all of which would have identical code. The solution is to remove the duplicate from your datatype:</p>\n\n<pre><code>data SomeData (parts :: [DataKind]) where\n  Mk :: SDataKind s -&gt; Maybe Char -&gt; Maybe (SomeData subparts) -&gt; SomeData (s ': subparts)\n\ndata SDataKind (x :: DataKind) where \n  SA :: SDataKind A \n  SB :: SDataKind B \n  SC :: SDataKind C \n</code></pre>\n\n<p>Packages like <code>singletons</code> will generate the <code>SDataKind</code> type and related functions on the type for you automatically.</p>\n\n<p>All of your 'record' functions are greatly simplified:</p>\n\n<pre><code>getVal :: SomeData parts -&gt; Maybe Char\ngetVal (Mk _ v _) = v \n\nupdateVal :: Maybe Char -&gt; SomeData parts -&gt; SomeData parts\nupdateVal val (Mk t _val sub) = Mk t val sub\n\ngetSubData :: SomeData (p ': rest) -&gt; Maybe (SomeData rest)\ngetSubData (Mk _ _ sub) = sub\n</code></pre>\n\n<p>And now, in order to get your function to typecheck (since it is indeed correct semantically), all you must do is pattern match on the constructor: </p>\n\n<pre><code>propogate :: SomeData x -&gt; SomeData x \npropogate sd@Mk{} =\n    .... -- unchanged\n</code></pre>\n\n<p>Note that the code is identical, other than the addition of a type signature and <code>@Mk{}</code> after the variable pattern <code>sd</code>. </p>\n\n<p>Finally, trying to use typeclasses here does not give you anything - you already have an indexed type which contains all the (type) information which you need - you obtain this information by pattern matching on the constructors of that type.</p>\n\n<hr>\n\n<p>Also note you do not lose any generality in <code>SomeData</code> - if you want particular indices to have extra information, you simply add another field indexed on the <code>part</code>. You can even embed complex logic inside of the extra field, as the <code>SDataKind</code> field allows you to pattern match on the index at will:</p>\n\n<pre><code>data SomeData (parts :: [DataKind]) where\n  Mk :: SDataKind s \n     -&gt; DataPart s \n     -&gt; Maybe Char \n     -&gt; Maybe (SomeData subparts) \n     -&gt; SomeData (s ': subparts) \n\ntype family (==?) (a :: k) (b :: k) :: Bool where \n  a ==? a = 'True \n  a ==? b = 'False \n\n-- Example - an additional field for only one index, without duplicating \n-- the constructors for each index\ndata DataPart x where \n  Nil :: ((x ==? 'A) ~ 'False) =&gt; DataPart x \n  A_Data :: Integer -&gt; DataPart A\n</code></pre>\n\n<hr>\n\n<p>Finally, if you wish to trudge along the original course, you can do so, but the source of the code duplication should become very apparent:</p>\n\n<pre><code>partsUncons :: SomeData ps0 -&gt; (forall p ps . (ps0 ~ (p : ps)) =&gt; r) -&gt; r \npartsUncons MkA{} x = x \npartsUncons MkB{} x = x \npartsUncons MkC{} x = x \n\npropogate :: SomeData x -&gt; SomeData x \npropogate sd = partsUncons sd $ \n    .... -- unchanged \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "edited": false, "score": 0, "creation_date": 1483725613, "post_id": 41498949, "comment_id": 70229015, "body": "Thanks for this answer! This would work and be much simpler if I didn&#39;t have differing data across my GADT cases."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 2, "last_activity_date": 1483676898, "creation_date": 1483676898, "answer_id": 41498949, "question_id": 41498540, "link": "https://stackoverflow.com/questions/41498540/how-to-process-a-recursive-gadt-with-kind-somedatakind/41498949#41498949", "title": "How to process a recursive GADT with kind :: &#39;[SomeDataKind]", "body": "<p>This might seem a bit boilerplate-ish, but if you just write out the three cases of <code>propagate</code>, then it can be made simple (if a bit verbose):</p>\n\n<pre><code>import Control.Monad (mplus)\nimport Control.Arrow (second)\n\npropagate' :: (Maybe Char -&gt; Maybe (SomeData ps) -&gt; SomeData ps')\n           -&gt; Maybe Char -&gt; Maybe (SomeData ps) -&gt; (Maybe Char, SomeData ps')\npropagate' mk c ds = (c'', mk c'' ds')\n  where\n    (c', ds') = maybe (Nothing, Nothing) (second Just . propagate) ds\n    c'' = c `mplus` c'\n\npropagate :: SomeData ps -&gt; (Maybe Char, SomeData ps)\npropagate (MkA c ds) = propagate' MkA c ds\npropagate (MkB c ds) = propagate' MkB c ds\npropagate (MkC c ds) = propagate' MkC c ds\n</code></pre>\n"}], "owner": {"reputation": 1225, "user_id": 1553313, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c254d80f35c4c00cf529252f98f23fea?s=128&d=identicon&r=PG", "display_name": "m-renaud", "link": "https://stackoverflow.com/users/1553313/m-renaud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 41498943, "answer_count": 2, "score": 1, "last_activity_date": 1483677282, "creation_date": 1483673959, "question_id": 41498540, "link": "https://stackoverflow.com/questions/41498540/how-to-process-a-recursive-gadt-with-kind-somedatakind", "title": "How to process a recursive GADT with kind :: &#39;[SomeDataKind]", "body": "<p>I think this is the furthest into the Haskell type system extensions that I've even been and I've run into an error that I haven't been able to figure out. Apologies in advance for the length, it's the shortest example I could create that still illustrates the issue I'm having. I have a recursive GADT whose kind is a promoted list, something like the following:</p>\n\n<p><strong>GADT Definition</strong></p>\n\n<pre><code>{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE TypeOperators #-}\n\ndata DataKind = A | B | C\n\n-- 'parts' should always contain at least 1 element which is enforced by the GADT.\n-- Lets call the first piece of data 'val' and the second 'subdata'.\n-- All data constructors have these 2 fields, although some may have\n-- additional fields which I've omitted for simplicity.\ndata SomeData (parts :: [DataKind]) where\n    MkA :: Maybe Char -&gt; Maybe (SomeData subparts) -&gt; SomeData ('A ': subparts)\n    MkB :: Maybe Char -&gt; Maybe (SomeData subparts) -&gt; SomeData ('B ': subparts)\n    MkC :: Maybe Char -&gt; Maybe (SomeData subparts) -&gt; SomeData ('C ': subparts)\nderiving instance Show (SomeData parts)\n</code></pre>\n\n<p><strong>Problem</strong></p>\n\n<p>What I'm trying to do is traverse the data and perform some operations, for instance propagate the first <code>Just</code> <code>Char</code> found up to the top.</p>\n\n<p><strong>Annoying missing features - needed for the next section</strong></p>\n\n<p>Now, because there is apparently no record syntax support for GADTs (<a href=\"https://ghc.haskell.org/trac/ghc/ticket/2595\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/2595</a>) you need to write them manually, so here they are:</p>\n\n<pre><code>getVal :: SomeData parts -&gt; Maybe Char\ngetVal (MkA val _) = val\ngetVal (MkB val _) = val\ngetVal (MkC val _) = val\n\n-- The lack of record syntax for GADTs is annoying.\nupdateVal :: Maybe Char -&gt; SomeData parts -&gt; SomeData parts\nupdateVal val (MkA _val sub) = MkA val sub\nupdateVal val (MkB _val sub) = MkB val sub\nupdateVal val (MkC _val sub) = MkC val sub\n\n-- really annoying...\ngetSubData :: SomeData (p ': rest) -&gt; Maybe (SomeData rest)\ngetSubData (MkA _ sub) = sub\ngetSubData (MkB _ sub) = sub\ngetSubData (MkC _ sub) = sub\n</code></pre>\n\n<p><strong>Test Data</strong></p>\n\n<p>So, the thing I want to do. Walk down the structure from the top until I find a value that is <code>Just</code>. So given the following initial values:</p>\n\n<pre><code>a :: SomeData '[ 'A ]\na = MkA (Just 'A') Nothing\n\nb :: SomeData '[ 'B ]\nb = MkB (Just 'B') Nothing\n\nc :: SomeData '[ 'C ]\nc = MkC (Just 'C') Nothing\n\nbc :: SomeData '[ 'B, 'C ]\nbc = MkB Nothing (Just c)\n\nabc :: SomeData '[ 'A, 'B, 'C ]\nabc = MkA Nothing (Just bc)\n</code></pre>\n\n<p><strong>Expected Result</strong></p>\n\n<p>I would like have something like this:</p>\n\n<pre><code>&gt; abc\nMkA Nothing (Just (MkB Nothing (Just (MkC (Just 'C') Nothing))))\n&gt; propogate abc\nMkA (Just 'C') (Just (MkB (Just 'C') (Just (MkC (Just 'C') Nothing))))\n</code></pre>\n\n<p><strong>Previous Attempts</strong></p>\n\n<p>I took a few stabs at it, first with a regular function:</p>\n\n<pre><code>propogate sd =\n    case getVal sd of\n        Just _val -&gt;\n            sd\n        Nothing -&gt;\n            let\n                newSubData = fmap propogate (getSubData sd)\n                newVal = join . fmap getVal $ newSubData\n            in\n                updateVal newVal sd\n</code></pre>\n\n<p>This gives the error:</p>\n\n<pre><code>Broken.hs:(70,1)-(81,35): error: \u2026\n    \u2022 Occurs check: cannot construct the infinite type: rest ~ p : rest\n      Expected type: SomeData rest -&gt; SomeData (p : rest)\n        Actual type: SomeData (p : rest) -&gt; SomeData (p : rest)\n    \u2022 Relevant bindings include\n        propogate :: SomeData rest -&gt; SomeData (p : rest)\n          (bound at Broken.hs:70:1)\nCompilation failed.\n</code></pre>\n\n<p>I also tried a typeclass and attempting to match on the structure:</p>\n\n<pre><code>class Propogate sd where\n    propogateTypeClass :: sd -&gt; sd\n\n-- Base case: We only have 1 element in the promoted type list.\ninstance Propogate (SomeData parts) where\n    propogateTypeClass sd = sd    \n\n-- Recursie case: More than 1 element in the promoted type list.\ninstance Propogate (SomeData (p ': parts)) where\n    propogateTypeClass sd =\n        case getVal sd of\n            Just _val -&gt;\n                sd\n            Nothing -&gt;\n                let\n                    -- newSubData :: Maybe subparts\n                    -- Recurse on the subdata if it exists.\n                    newSubData = fmap propogateTypeClass (getSubData sd)\n                    newVal = join . fmap getVal $ newSubData\n                in\n                    updateVal newVal sd\n</code></pre>\n\n<p>This results in the error:</p>\n\n<pre><code>Broken.hs:125:5-26: error: \u2026\n    \u2022 Overlapping instances for Propogate (SomeData '['A, 'B, 'C])\n        arising from a use of \u2018propogateTypeClass\u2019\n      Matching instances:\n        instance Propogate (SomeData parts)\n          -- Defined at Broken.hs:91:10\n        instance Propogate (SomeData (p : parts))\n          -- Defined at Broken.hs:95:10\n    \u2022 In the expression: propogateTypeClass abc\n      In an equation for \u2018x\u2019: x = propogateTypeClass abc\nCompilation failed.\n</code></pre>\n\n<p>I've also tried combinations of matching on <code>SomeData '[]</code> and <code>SomeData '[p]</code> to no avail.</p>\n\n<p>I'm hoping I'm missing something simple but I haven't found documentation anywhere on how to process a structure like this and I'm at the limits of my understand if the Haskell type system, for now anyways :). Once again, sorry for the long post and any help would be greatly appreciated :)</p>\n"}, {"tags": ["haskell", "unicode"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1483664931, "post_id": 41497316, "comment_id": 70200860, "body": "if you want to fetch unicode - it would be best to use <a href=\"https://hackage.haskell.org/package/http-conduit-2.2.3/docs/Network-HTTP-Conduit.html#v:simpleHttp\" rel=\"nofollow noreferrer\">Network.HTTP.Conduit.simpleHttp</a> and <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text-Encoding.html#v:decodeUtf8\" rel=\"nofollow noreferrer\">decodeUtf8</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1483665172, "post_id": 41497316, "comment_id": 70200920, "body": "I think almost the same question was asked before. Regardless of that, please always add full informations on dependencies/import to questions that are concerned with some library functions."}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 2, "last_activity_date": 1483665045, "creation_date": 1483665045, "answer_id": 41497406, "question_id": 41497316, "link": "https://stackoverflow.com/questions/41497316/how-to-fetch-a-website-as-unicode/41497406#41497406", "title": "How to fetch a website as unicode?", "body": "<p>You need to decode the text, for example with <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text-Encoding.html#v:decodeUtf8\" rel=\"nofollow noreferrer\"><code>Data.Text.Encoding.decodeUtf8</code></a> from <code>text</code> or <a href=\"https://hackage.haskell.org/package/utf8-string-1.0.1.1/docs/Codec-Binary-UTF8-String.html#v:decodeString\" rel=\"nofollow noreferrer\"><code>Codec.Binary.UTF8.String.decodeString</code></a> from <code>utf8-string</code>.</p>\n"}], "owner": {"reputation": 2966, "user_id": 3014199, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/72332b0ac6ee78bc829c378c6c747e0e?s=128&d=identicon&r=PG", "display_name": "peer", "link": "https://stackoverflow.com/users/3014199/peer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 41497406, "answer_count": 1, "score": -2, "last_activity_date": 1483665045, "creation_date": 1483664378, "question_id": 41497316, "link": "https://stackoverflow.com/questions/41497316/how-to-fetch-a-website-as-unicode", "title": "How to fetch a website as unicode?", "body": "<p>I want to fetch a website looking like this\u00b9: naked unicode between tags</p>\n\n<pre><code>&lt;html&gt;\n\ud55c\uad6d\uc5b4\n&lt;/html&gt;\n</code></pre>\n\n<p>I'm currently using </p>\n\n<pre><code>openURL :: String -&gt; IO String\nopenURL x = getResponseBody =&lt;&lt; simpleHTTP (getRequest x)\n</code></pre>\n\n<p>But when inspecting the string <code>\ud55c\uad6d\uc5b4</code> is displayed as <code>\\237\\149\\156\\234\\181\\173\\236\\150\\180</code>, 9 characters.\nAnd what I want would be 3 escaped characters like <code>\\u???\\u???\\u???</code></p>\n\n<p>I tried <code>Text.pack</code> on <code>page</code> where <code>page &lt;- openURL \"url\"</code> but it's already to late then.</p>\n\n<p>\u00b9 If I let firefox show me the source, and page info says UTF-8</p>\n"}, {"tags": ["haskell", "patch", "dynamic-linking", "maintenance"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 2, "creation_date": 1483661613, "post_id": 41496934, "comment_id": 70199956, "body": "Recompiling or just relinking?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1483662751, "post_id": 41496934, "comment_id": 70200292, "body": "&quot;In JVM world I can replace a single &quot;jar&quot; and restart the application.&quot; Not if you need to change the ABI of the bad library"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1483661531, "creation_date": 1483661531, "question_id": 41496934, "link": "https://stackoverflow.com/questions/41496934/how-to-patch-a-vulnerable-or-buggy-dependency-in-haskell", "title": "How to patch a vulnerable or buggy dependency in Haskell?", "body": "<p>While this may not be trendy, I would like to be able to patch dendencies of my Haskell application after deployment without recompiling the whole application.</p>\n\n<p>In JVM world I can replace a single \"jar\" and restart the application.</p>\n\n<p>From this point of view, am I better off with wrappers like <code>libcurl</code> that link dynamically rather than library written in Haskell?</p>\n"}, {"tags": ["haskell", "dependent-type", "existential-type"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1483657342, "post_id": 41492754, "comment_id": 70198683, "body": "Have to admit I&#39;ve not done much with this, but it seems to me you&#39;re missing <code>(KnownNat a, KnownNat b)</code> in <code>minfoo</code>."}], "answers": [{"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 10, "last_activity_date": 1483657874, "creation_date": 1483657874, "answer_id": 41496362, "question_id": 41492754, "link": "https://stackoverflow.com/questions/41492754/could-not-deduce-knownnat-in-two-existentials-with-respect-to-the-singletons-lib/41496362#41496362", "title": "Could not deduce KnownNat in two existentials with respect to the singletons library", "body": "<p>You need to do some theorem proving to check that given <code>KnownNat a</code> and <code>KnownNat b</code> you can get <code>KnownNat (Min a b)</code>. A possible solution:</p>\n\n<pre><code>import Data.Constraint\n</code></pre>\n\n<p>(...)</p>\n\n<pre><code>theorem :: forall a b. (KnownNat a, KnownNat b) =&gt;\n           Sing a -&gt; Sing b -&gt; Dict (KnownNat (Min a b))\ntheorem sa sb = case sCompare sa sb of\n  SLT -&gt; Dict\n  SEQ -&gt; Dict\n  SGT -&gt; Dict\n\nfooSing :: forall a. KnownNat a =&gt; Foo a -&gt; Sing a\nfooSing _ = sing\n\nminthing' :: Thing -&gt; Thing -&gt; Integer\nminthing' (Thing foo1) (Thing foo2) =\n  case theorem (fooSing foo1) (fooSing foo2) of\n    Dict -&gt; minfoo foo1 foo2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "is_accepted": false, "score": 3, "last_activity_date": 1484230177, "creation_date": 1484230177, "answer_id": 41615278, "question_id": 41492754, "link": "https://stackoverflow.com/questions/41492754/could-not-deduce-knownnat-in-two-existentials-with-respect-to-the-singletons-lib/41615278#41615278", "title": "Could not deduce KnownNat in two existentials with respect to the singletons library", "body": "<p>I feel like user3237465's comment needs to be immortalized because it removes the contraint library dependency and it's pretty neat.</p>\n\n<pre><code>minthing' :: Thing -&gt; Thing -&gt; Integer\nminthing' (Thing foo1) (Thing foo2) =\n  theorem (fooSing foo1) (fooSing foo2) $ minfoo foo1 foo2\n  where\n    fooSing :: KnownNat a =&gt; Foo a -&gt; Sing a\n    fooSing = const sing\n\ntheorem :: forall a b c. (KnownNat a, KnownNat b) =&gt;\n           Sing a -&gt; Sing b -&gt; (KnownNat (Min a b) =&gt; c) -&gt; c\ntheorem sa sb c = case sCompare sa sb of\n  SLT -&gt; c\n  SEQ -&gt; c\n  SGT -&gt; c\n</code></pre>\n"}], "owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 1, "accepted_answer_id": 41496362, "answer_count": 2, "score": 10, "last_activity_date": 1484230177, "creation_date": 1483643115, "question_id": 41492754, "link": "https://stackoverflow.com/questions/41492754/could-not-deduce-knownnat-in-two-existentials-with-respect-to-the-singletons-lib", "title": "Could not deduce KnownNat in two existentials with respect to the singletons library", "body": "<p>I was experimenting with the singletons library and I found a case that I don't understand.</p>\n\n<pre><code>{-# LANGUAGE GADTs, StandaloneDeriving, RankNTypes, ScopedTypeVariables,\nFlexibleInstances, KindSignatures, DataKinds, StandaloneDeriving  #-}\n\nimport Data.Singletons.Prelude\nimport Data.Singletons.TypeLits\n\ndata Foo (a :: Nat) where\n Foo :: Foo a\n  deriving Show\n\ndata Thing where\n  Thing :: KnownNat a =&gt; Foo a -&gt; Thing\n\nderiving instance Show Thing\n\nafoo1 :: Foo 1\nafoo1 = Foo \n\nafoo2 :: Foo 2\nafoo2 = Foo \n\nathing :: Thing\nathing = Thing afoo1\n\nfoolen :: forall n. KnownNat n =&gt; Foo n -&gt; Integer\nfoolen foo =\n  case sing of (SNat :: Sing n) -&gt; natVal (Proxy :: Proxy n)\n\n\nminfoo :: forall a b c. (Min a b ~ c, KnownNat c) =&gt; Foo a -&gt; Foo b -&gt; Integer\nminfoo _ _ = \n  let c = case sing of (SNat :: Sing c) -&gt; natVal (Proxy :: Proxy c)\n  in natVal (Proxy :: Proxy c)\n\nthinglen :: Thing -&gt; Integer\nthinglen (Thing foo) = foolen foo \n</code></pre>\n\n<p>I could use this to get the minimum of two Things</p>\n\n<pre><code>minthing :: Thing -&gt; Thing -&gt; Integer\nminthing (Thing foo1) (Thing foo2) = min (foolen foo1) (foolen foo2)\n</code></pre>\n\n<p>But why can't I just do this?</p>\n\n<pre><code>minthing' :: Thing -&gt; Thing -&gt; Integer\nminthing' (Thing foo1) (Thing foo2) = minfoo foo1 foo2\n\n\u2022 Could not deduce (KnownNat\n                      (Data.Singletons.Prelude.Ord.Case_1627967386\n                         a\n                         a1\n                         (Data.Singletons.Prelude.Ord.Case_1627967254\n                            a a1 (GHC.TypeLits.CmpNat a a1))))\n</code></pre>\n"}, {"tags": ["haskell", "typeclass", "monoids"], "comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 3, "creation_date": 1483638268, "post_id": 41491370, "comment_id": 70188531, "body": "You can just use <code>mempty</code> and <code>mappend</code> and the type system will figure out which <code>mempty</code> you meant."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1483638368, "post_id": 41491370, "comment_id": 70188586, "body": "For example <code>mempty = Mem (\\s -&gt; (mempty, s))</code>."}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 2, "last_activity_date": 1483638975, "last_edit_date": 1483638975, "creation_date": 1483638664, "answer_id": 41491557, "question_id": 41491370, "link": "https://stackoverflow.com/questions/41491370/access-member-of-class-instance-from-outside-its-definition/41491557#41491557", "title": "Access member of class instance from outside its definition", "body": "<p><code>mempty</code> is simply the <code>mempty</code> of <code>a</code> and the <code>s</code> that was passed in.</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>mempty = Mem (\\s -&gt; (mempty, s))\n</code></pre>\n\n<p><code>mappend</code> can be defined as running <code>f</code>, then <code>g</code> based on the results of <code>f</code>, then mappending the results:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f `mappend` g = Mem (\\s -&gt; \n                    let (fa, fs) = runMem f s\n                        (ga, gs) = runMem g fs\n                    in (fa `mappend` ga, gs))\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 7377103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fa441524800c69eb66f26d1f16d2ede?s=128&d=identicon&r=PG&f=1", "display_name": "G&#233;rard", "link": "https://stackoverflow.com/users/7377103/g%c3%a9rard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 41491557, "answer_count": 1, "score": 0, "last_activity_date": 1483640748, "creation_date": 1483638014, "last_edit_date": 1483640748, "question_id": 41491370, "link": "https://stackoverflow.com/questions/41491370/access-member-of-class-instance-from-outside-its-definition", "title": "Access member of class instance from outside its definition", "body": "<p>I have this type:</p>\n\n<pre><code>newtype Mem s a = Mem { runMem :: s -&gt; (a,s) }\n</code></pre>\n\n<p>and I have to create an instance of monoid for this type, but to do so I have to use the mempty and the mappend of the monoid a, regardless of what it may be. How would one go about doing that?</p>\n\n<pre><code>instance Monoid a =&gt; Monoid (Mem s a) where\n    mempty =  --runMem with the mempty of a\n    f@(Mem aa) `mappend` g@(Mem aaa) = --runMem with mappend of a\n    f@(Mem s) `mappend` mempty = f\n    mempty `mappend` g@(Mem ss) = g\n</code></pre>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1483634045, "post_id": 41489933, "comment_id": 70185699, "body": "You can <code>fmap</code> the predicate into the <code>m2</code> but how do you intend to inspect the resulting <code>m2 Bool</code>? The best you can do is <code>(Functor f, Applicative g) =&gt; (a -&gt; Bool) -&gt; f [g a] -&gt; f (g [a])</code>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1483634955, "post_id": 41489933, "comment_id": 70186288, "body": "As @BenjaminHodgson points out, you can reach for <code>Traversable</code> when you need something of the shape: <code>t (f a) -&gt; f (t a)</code>"}, {"owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "edited": false, "score": 1, "creation_date": 1483634990, "post_id": 41489933, "comment_id": 70186311, "body": "I assumed there was some sort of a function for filtering a list of monads of a given type, and that I&#39;d lift that function onto the IO monad. Like, for example: ` filterM (liftM . (\\x-&gt;True))` Can filter a list of monads -  I understand that, internally, concatenating instances of <code>[Either a b]</code> is different from concatenating instances of <code>IO [Either a b]</code>, and so this won&#39;t work, but that&#39;s not impossible, it&#39;s just a headache.  I assumed I wasn&#39;t the first person to have this problem, and that someone else had solved it."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1483635170, "post_id": 41489933, "comment_id": 70186446, "body": "Note that your outer <code>m</code> is not really an interesting part of the question, as you can just <code>fmap myFilter</code>, so what you want is really <code>myFilter :: (Monad m2) =&gt; [m2 a] -&gt; (a -&gt; Bool) -&gt; [m2 a]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "edited": false, "score": 0, "creation_date": 1483637665, "post_id": 41490332, "comment_id": 70188156, "body": "This works, thank you!  I am not sure I quite understand though -  If you &quot;can&#39;t get the Bool out of it&#39;s wrapper&quot;, how would filtering anything of type [m a] work at all? -EDIT- More clearly -  If ` fmap (map (fmap (*3))) (Just ([Right 5, Right 12]))` returns <code>Just [Right 15, Right 36]</code> Why can&#39;t there be a filter that does the same thing?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "edited": false, "score": 1, "creation_date": 1483637835, "post_id": 41490332, "comment_id": 70188264, "body": "In general you don&#39;t work with monads by getting things out of them; instead you lift yourself into the monad. You can&#39;t get the <code>a</code> out of the <code>[m a]</code>, but you can push the <code>[]</code> inside the <code>m</code> using <code>sequenceA :: Applicative m =&gt; [m a] -&gt; m [a]</code>. If <code>m</code> is <code>Proxy</code> then you have <code>sequenceA :: [Proxy a] -&gt; Proxy a; sequenceA _ = Proxy</code>."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 5, "last_activity_date": 1506552956, "last_edit_date": 1506552956, "creation_date": 1483634789, "answer_id": 41490332, "question_id": 41489933, "link": "https://stackoverflow.com/questions/41489933/filtering-a-list-of-monads/41490332#41490332", "title": "Filtering a list of monads", "body": "<blockquote>\n  <p>Ideally, I would like to compose filtering function with the following\n  type sig:</p>\n\n<pre><code>(Monad m, Monad m2) =&gt; m [m2 a] -&gt; (a -&gt; Bool) -&gt; m [m2 a]\n</code></pre>\n</blockquote>\n\n<p>It can't be done in general, because the <code>Monad</code> interface provides no way to get an <code>a</code> out of an <code>m a</code>. You can get as far as <code>m [m2 Bool]</code> using <code>fmap (fmap (fmap f))</code> but you need to get the <code>Bool</code> out of the <code>m2 Bool</code> in order to decide whether or not to drop the element.</p>\n\n<p>Look at it this way. What if the monad in question was <code>Proxy</code>?</p>\n\n<pre><code>data Proxy a = Proxy  -- one constructor, no fields\n\ninstance Monad Proxy where\n    return _ = Proxy\n    Proxy &gt;&gt;= _ = Proxy\n</code></pre>\n\n<p>You can't look at the <code>Bool</code> inside a <code>Proxy Bool</code> because there's never anything inside it! Given <code>a -&gt; Bool</code> and <code>[Proxy a]</code>, how can I be expected to know which elements of the list to drop?</p>\n\n<hr>\n\n<p>You <em>can</em> write a function with the following type signature:</p>\n\n<pre><code>myfilter :: (Functor f, Applicative g) =&gt; (a -&gt; Bool) -&gt; f [g a] -&gt; f (g [a])\n</code></pre>\n\n<p>Note that the return type is <code>f (g [a])</code>, not <code>f [g a]</code>.</p>\n\n<p>This function uses <code>fmap</code> to go into the outer functor, smashes together the applicative <code>g</code>s in the list, then <code>fmap</code>s once more to filter the results.</p>\n\n<pre><code>myfilter p = fmap (fmap (filter p) . sequenceA)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "edited": false, "score": 0, "creation_date": 1483729625, "post_id": 41491544, "comment_id": 70231108, "body": "Thank you, this was a very helpful addendum."}], "tags": [], "owner": {"reputation": 10248, "user_id": 268396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4220afde4dd928ef33648797c7415ada?s=128&d=identicon&r=PG", "display_name": "user268396", "link": "https://stackoverflow.com/users/268396/user268396"}, "is_accepted": false, "score": 1, "last_activity_date": 1483638617, "creation_date": 1483638617, "answer_id": 41491544, "question_id": 41489933, "link": "https://stackoverflow.com/questions/41489933/filtering-a-list-of-monads/41491544#41491544", "title": "Filtering a list of monads", "body": "<p>To add to the accepted answer while you may not be able to get the <code>a</code> out of the <code>Monad m</code>, you can get your functions into the <code>Monad m</code> using e.g. <code>liftM</code>. Depending on the inner structure(s) you can still compose usable actions and then finally sequence them in some fashion so the computations 'happen' in the desired fashion.</p>\n\n<p>To give an example using the problem of <code>IO[Either a b]</code> given as <code>IO[Either Bool Integer]</code>:</p>\n\n<pre><code>import Control.Monad\n\ntestCase :: IO [Either Bool Integer]\ntestCase = return [(Right 1), (Left True), (Right 2), (Left False), (Right 3), (Right 4)]\n\nliftFilter :: Monad m =&gt; (a -&gt; Bool) -&gt; m [a] -&gt; m [a]\nliftFilter pred = liftM (filter pred)\n\ntestFilter :: (Either Bool Integer) -&gt; Bool\ntestFilter (Left True) = True\ntestFilter (Right x)   = even x\ntestFilter _           = False\n\nshowIt :: (Either Bool Integer) -&gt; String\nshowIt (Left True)  = \"Left True\"\nshowIt (Left False) = \"Left False\"\nshowIt (Right x)    = \"Right x=\" ++ (show x)\n\ntest = do\n    filtered &lt;- liftFilter testFilter testCase\n    return (fmap showIt filtered)\n\nrunTest = do\n    actions &lt;- liftM (fmap putStrLn) test\n    sequence_ actions\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 13641999, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-w-kK8AUGBPc/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucnbMue4yuSsCHPwWmPjT9QDsU_gaw/photo.jpg?sz=128", "display_name": "Esko Hanell", "link": "https://stackoverflow.com/users/13641999/esko-hanell"}, "is_accepted": false, "score": 0, "last_activity_date": 1590780596, "last_edit_date": 1590780596, "creation_date": 1590773872, "answer_id": 62091680, "question_id": 41489933, "link": "https://stackoverflow.com/questions/41489933/filtering-a-list-of-monads/62091680#62091680", "title": "Filtering a list of monads", "body": "<p>I am handling the lists using their monad instance instead of using filter method. It may be better to use the filter in real world situations. I'm also not trying to make my functions as small as possible</p>\n\n<p>I assumed you want some arbitrary method to handle the Eithers.\nIf you want to only filter the \"right a\" or get the left then you probably should use traversable. You also could use bimap to \"fmap\" left and right of Either simultaneously.</p>\n\n<p>First a solution that works only with <code>either</code>:</p>\n\n<pre><code>filtermonads :: IO [(Either a b)] -&gt; (a -&gt; Bool) -&gt; IO [(Either a b)]\nfiltermonads ioListEitherA cond = do\n  listEitherA &lt;- ioListEitherA\n  return $ do\n        eitherA &lt;- listEitherA\n        case eitherA of\n          Left a -&gt; if cond a then pure (Left a) else []\n          Right b -&gt; return (Right b)\n</code></pre>\n\n<p>Should be the same as the following:</p>\n\n<pre><code>filtermonads' :: IO [(Either a b)] -&gt; (a -&gt; Bool) -&gt; IO [(Either a b)]\nfiltermonads' ioListEitherA cond = let\n  f x = case x of\n    Left a -&gt; if cond a then pure (Left a) else []\n    Right a -&gt; pure (Right a)\n  in\n    fmap (join . fmap f) ioListEitherA\n</code></pre>\n\n<p>We have to manually open the Either as we require access to the information encapsulated inside it in order to know how to handle the list.</p>\n\n<p>You could generalize this by instead separately providing a function (<code>m2 a -&gt; Bool</code>) that tells how to extract the information from the monad.</p>\n\n<pre><code>eitherCond :: Either a b -&gt; Bool\neitherCond eitherA = case eitherA of\n          Left a -&gt; False\n          Right b -&gt; True\n\nfiltermonads'' :: (Monad m) =&gt; m [a] -&gt; (a -&gt; Bool) -&gt; m [a]\nfiltermonads'' m1listm2a cond = do\n  listm2a &lt;- m1listm2a\n  return $ do\n    m2a &lt;- listm2a\n    if cond m2a then pure m2a else []\n</code></pre>\n\n<p>You could also generalize the list to <code>MonadPlus</code> or <code>MonadFail</code> as you can think of filtering meaning you need a monad with a zero element. The monad library itself also has fail that is sometimes zero, but you should not use it as it is not a feature all plain monads have and as such the implementations are sometimes very arbitrary.</p>\n\n<p>Plain filter might be better as only few structures implement the <code>MonadPlus</code> class. I should have used <code>mfilter</code> for this. <code>MonadPlus</code> also doesn't have that many structures that implement it. For example Map is not even a monad.</p>\n\n<pre><code>filtermonads''' :: (Monad m1, MonadPlus mp) =&gt; m1 (mp a) -&gt; (a -&gt; Bool) -&gt; m1 (mp a)\nfiltermonads''' m1listm2a cond = do\n  listm2a &lt;- m1listm2a\n  return $ do\n    m2a &lt;- listm2a\n    if cond m2a then pure m2a else mzero\n</code></pre>\n\n\n\n<pre><code>testData :: IO [Either Char Char]\ntestData = pure [Right 'a', Left 'a', Left 'c']\n\ntest1 = filtermonads testData (\\x -&gt; x=='a')\ntest2 = filtermonads' testData (\\x -&gt; x=='a')\ntest3 = filtermonads'' testData eitherCond\ntest4 = filtermonads''' testData eitherCond\n\njustData ::IO (Maybe Char)\njustData = pure (Just 'b')\nreadData :: Maybe (IO Char)\nreadData = Just (getChar) -- Notice that io mzero is error!\ntest5 = filtermonads''' justData (\\x -&gt; x=='a')\ntest6 = filtermonads''' readData (\\x -&gt; x=='a') \nmain = case (test6) of\n  Just a -&gt; a &gt;&gt;= putStrLn . pure\n  Nothing -&gt; pure () \n</code></pre>\n"}], "owner": {"reputation": 368, "user_id": 2492166, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/54b4fd0a3406e65b532e27dfd9b3ad0d?s=128&d=identicon&r=PG", "display_name": "Iron Gremlin", "link": "https://stackoverflow.com/users/2492166/iron-gremlin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 936, "favorite_count": 0, "accepted_answer_id": 41490332, "answer_count": 3, "score": 0, "last_activity_date": 1590780596, "creation_date": 1483633631, "last_edit_date": 1483634119, "question_id": 41489933, "link": "https://stackoverflow.com/questions/41489933/filtering-a-list-of-monads", "title": "Filtering a list of monads", "body": "<p>I am attempting to filter a list of type: <code>IO [Either a b]</code></p>\n\n<p>Ideally, I would like to compose filtering function with the following type sig:</p>\n\n<pre><code>(Monad m, Monad m2) =&gt; m [m2 a] -&gt; (a -&gt; Bool) -&gt; m [m2 a]\n</code></pre>\n\n<p>I have tried a lot of combinations of <code>filter</code>, <code>filterM</code>, <code>fmap</code>, and <code>=&lt;&lt;</code> in a vain attempt to lift my predicate into the proper context, but I keep missing the mark - I can achieve <code>m [m a]-&gt; (a -&gt; m Bool)-&gt; m [m a]</code>, but since Either and IO are not the same monad, this doesn't seem to do me any good.</p>\n\n<p>This seems like a usecase for 'do notation' , but I've been unable to suss out a way to examine the type signatures of things assigned with the <code>&lt;-</code> operator, and so am left shooting at a moving target.</p>\n\n<p>I am not sure how to compose the function in a way that will make it clear that it's traversing a list containing a instances of a different monad (Either) then the monad that contains the list itself (IO).</p>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1483638960, "post_id": 41489690, "comment_id": 70188941, "body": "Is your <code>infixl 5 @@</code> actually being applied to the local <code>(@@)</code>? Because that ought to be a bug I would think"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1483639330, "post_id": 41489690, "comment_id": 70189168, "body": "looks like it isn&#39;t"}], "answers": [{"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1483633314, "post_id": 41489771, "comment_id": 70185161, "body": "I was just about to post this. According to the Haskell 2010 Report, it&#39;s 100% legal to put fixity declarations in a where-block. Surprising, but true."}, {"owner": {"reputation": 580, "user_id": 2466383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550ba434909acd5357b9defb56e7254a?s=128&d=identicon&r=PG", "display_name": "Mike Spivey", "link": "https://stackoverflow.com/users/2466383/mike-spivey"}, "edited": false, "score": 0, "creation_date": 1483634262, "post_id": 41489771, "comment_id": 70185837, "body": "Ooh, I didn&#39;t think of that!"}, {"owner": {"reputation": 580, "user_id": 2466383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550ba434909acd5357b9defb56e7254a?s=128&d=identicon&r=PG", "display_name": "Mike Spivey", "link": "https://stackoverflow.com/users/2466383/mike-spivey"}, "edited": false, "score": 0, "creation_date": 1484693522, "post_id": 41489771, "comment_id": 70612343, "body": "... and I suppose I didn&#39;t think of it because as a compiler writer, I wouldn&#39;t fancy implementing that, or trying to do it and generate reasonable error messages when it went wrong.  Of course it can be done, but it&#39;s a job for someone with more youthful enthusiasm than I possess."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 16, "last_activity_date": 1483633139, "creation_date": 1483633139, "answer_id": 41489771, "question_id": 41489690, "link": "https://stackoverflow.com/questions/41489690/local-infix-operator-definition-in-haskell/41489771#41489771", "title": "Local infix operator definition in Haskell", "body": "<p>Just putting the fixity declaration in the <code>where</code> clause seems to work fine:</p>\n\n<pre><code>f x = x @@ 5 where\n    infixl 5 @@\n    x @@ y = (x+1) * (y+1)\n</code></pre>\n"}], "owner": {"reputation": 580, "user_id": 2466383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550ba434909acd5357b9defb56e7254a?s=128&d=identicon&r=PG", "display_name": "Mike Spivey", "link": "https://stackoverflow.com/users/2466383/mike-spivey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 671, "favorite_count": 0, "accepted_answer_id": 41489771, "answer_count": 1, "score": 11, "last_activity_date": 1483633139, "creation_date": 1483632876, "question_id": 41489690, "link": "https://stackoverflow.com/questions/41489690/local-infix-operator-definition-in-haskell", "title": "Local infix operator definition in Haskell", "body": "<p>In this Haskell program, <code>@@</code> is an infix operator that I want to define only locally within the body of function <code>f</code>.  (Naturally enough, my actual program is more complicated than this, and there is a good reason to use infix notation.)</p>\n\n<pre><code>infixl 5 @@\n\n(@@) = undefined\n\nf x = x @@ 5 where x @@ y = (x+1) * (y+1)\n\nmain = print (f 7)\n</code></pre>\n\n<p>However, unless I also make the global definition, written here as <code>(@@) = undefined</code>, GHC complains that 'The fixity signature for <code>@@</code> lacks an accompanying binding.'  Is there any way of getting round this without a global definition of the operator symbol?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1483631940, "post_id": 41487629, "comment_id": 70184160, "body": "Isn&#39;t <i>the default</i> for the process to inherit all three standard handles? Why are you trying to explicitly manage the transfer yourself? Do you ultimately want to change the data in transit or something?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1483635012, "post_id": 41487629, "comment_id": 70186328, "body": "Can you include the contents of your <code>echo.hs</code> program too? Is its functionality intended to be identical to <code>cat</code>, and for simplicity can this be reproed that way?"}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1483688851, "last_edit_date": 1483688851, "creation_date": 1483635405, "answer_id": 41490531, "question_id": 41487629, "link": "https://stackoverflow.com/questions/41487629/piping-from-stdin-to-process/41490531#41490531", "title": "Piping from stdin to process", "body": "<p>Your <code>fdToHandler stdInput</code> call creates a new <code>Handle</code> pointing at file descriptor 0 (stdin) of the original process. After a bit of time, the garbage collector notices that it's no longer being used, and garbage collects the <code>Handle</code>, which in turn causes the underlying file descriptor to be closed. Then your <code>getLine</code> (which uses <code>System.IO.stdin</code>) call fails. That's because that <code>Handle</code> is still open, but the underlying file descriptor it's pointing at has been closed.</p>\n\n<p>FWIW, I'd recommend using binary I/O on the handles to avoid issues with character encodings.</p>\n"}], "owner": {"reputation": 464, "user_id": 5803067, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24c214b5a2bb45dabb3122be0dfef109?s=128&d=identicon&r=PG", "display_name": "Aneesh Durg", "link": "https://stackoverflow.com/users/5803067/aneesh-durg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 451, "favorite_count": 1, "accepted_answer_id": 41490531, "answer_count": 1, "score": 1, "last_activity_date": 1483688851, "creation_date": 1483626860, "question_id": 41487629, "link": "https://stackoverflow.com/questions/41487629/piping-from-stdin-to-process", "title": "Piping from stdin to process", "body": "<p>I'm trying to pipe the stdin of my program to an external process using the following </p>\n\n<pre><code>import System.IO\nimport System.Posix.IO\nimport System.Posix.Process\nimport qualified System.Process as P\nimport Control.Concurrent (forkIO, killThread)\nimport Control.Monad\n\nmain :: IO ()\nmain = do\n    h &lt;- fdToHandle stdInput\n    (Just hIn, _, _, p) &lt;-\n        P.createProcess (P.shell \"runhaskell echo.hs\"){ P.std_in = P.CreatePipe }\n\n    hSetBuffering hIn NoBuffering\n    tid &lt;- forkIO $ getInput hIn\n    e &lt;- P.waitForProcess p\n    killThread tid\n    print e\n\ngetInput hin = do  \n    forever $ do \n        l &lt;- getLine\n        hPutStrLn hin l\n</code></pre>\n\n<p>where echo.hs just echoes stdin to stdout, but if I wait a couple seconds between giving new input, I get the following error:</p>\n\n<pre><code>pipes.hs: &lt;stdin&gt;: hGetLine: invalid argument (Bad file descriptor)\n</code></pre>\n\n<p>when I tried compiling with <code>ghc pipes.hs</code>, the compiled program would not redirect stdin to the stdin of echo.hs at all</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1483623607, "post_id": 41485705, "comment_id": 70178093, "body": "So, none of these guarantees to create a new OS thread? For example <code>forkOS</code> even if called 1 million times could simply create new green threads associated with the same OS thread?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1483624263, "post_id": 41485705, "comment_id": 70178590, "body": "@Bakuriu I&#39;ve updated the answer with a quote from the original paper, which clearer and more precise than what I&#39;d originally written. As far as I&#39;m aware there&#39;s no way to directly use an actual OS thread in GHC, but I can&#39;t think of any particularly compelling reason to do so anyway."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1483625654, "post_id": 41485705, "comment_id": 70179607, "body": "Well, it does say &quot;For each OS thread there is at most a single bound Haskell thread&quot; which implies that two <code>forkOS</code> calls will have to spawn green threads on different OS threads... I didn&#39;t really have a usecase for this but I was simply curious. It makes sense that this is the behaviour, otherwise the GHC runtime would have to share the thread-local storage with different FFI calls..."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1483626804, "post_id": 41485705, "comment_id": 70180444, "body": "@Bakuriu I read the spec as saying that not every call to <code>forkOS</code> will necessarily create a new OS thread. The runtime could reuse one of its existing worker threads which doesn&#39;t already have a bound thread attached to it. Whether or not it actually does that, I don&#39;t know - you&#39;d have to ask a GHC dev"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 8, "last_activity_date": 1483630786, "last_edit_date": 1483630786, "creation_date": 1483620965, "answer_id": 41485705, "question_id": 41485126, "link": "https://stackoverflow.com/questions/41485126/difference-between-forkio-forkos-and-forkprocess/41485705#41485705", "title": "Difference between forkIO/forkOS and forkProcess?", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Concurrent.html#v:forkIO\" rel=\"nofollow noreferrer\"><code>forkIO</code></a> creates a lightweight unbound <em>green thread</em>. Green threads have very little overhead; the GHC runtime is capable of efficiently multiplexing millions of green threads over a small pool of OS worker threads. A green thread may live on more than one OS thread over its lifetime.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Concurrent.html#v:forkOS\" rel=\"nofollow noreferrer\"><code>forkOS</code></a> creates a <em>bound thread</em>: a green thread for which FFI calls are guaranteed to take place on a single fixed OS thread. Bound threads are typically used when interacting with C libraries which use thread-local data and expect all API calls to come from the same thread. From <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/Papers/conc-ffi/index.htm\" rel=\"nofollow noreferrer\">the paper</a> specifying GHC's bound threads:</p>\n\n<blockquote>\n  <p>The idea is that each bound Haskell thread has a dedicated associated\n  OS thread. It is guaranteed that any FFI calls made by a bound Haskell\n  thread are made by its associated OS thread, although pure-Haskell\n  execution can, of course, be carried out by any OS thread. A group of\n  foreign calls can thus be guaranteed to be carried out by the same OS\n  thread if they are all performed in a single bound Haskell thread.</p>\n  \n  <p>[...]</p>\n  \n  <p>[F]or each OS thread, there is at most a single bound Haskell thread.</p>\n</blockquote>\n\n<p>Note that the above quotation does not exclude the possibility that an OS thread associated with a bound thread can act as a worker for unbound Haskell threads. Nor does it guarantee that the bound thread's non-FFI code will execute on any particular thread.</p>\n\n<p><a href=\"https://hackage.haskell.org/package/unix-2.7.2.1/docs/System-Posix-Process.html#v:forkProcess\" rel=\"nofollow noreferrer\"><code>forkProcess</code></a> creates a new process, just like <code>fork</code> on UNIX.</p>\n"}, {"tags": [], "owner": {"reputation": 4763, "user_id": 1065586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYTQe.jpg?s=128&g=1", "display_name": "tomferon", "link": "https://stackoverflow.com/users/1065586/tomferon"}, "is_accepted": false, "score": 4, "last_activity_date": 1483620974, "creation_date": 1483620974, "answer_id": 41485707, "question_id": 41485126, "link": "https://stackoverflow.com/questions/41485126/difference-between-forkio-forkos-and-forkprocess/41485707#41485707", "title": "Difference between forkIO/forkOS and forkProcess?", "body": "<p><code>forkIO</code> creates a lightweight thread managed by Haskell's runtime system. It is unbound, i.e. it can be ran by any OS thread.</p>\n\n<p><code>forkOS</code> creates a bound thread, meaning it is bound to an actual OS thread. This can be necessary when using C functions for example.</p>\n\n<p><code>forkProcess</code> forks the current process like <code>fork()</code> in C.</p>\n"}], "owner": {"reputation": 464, "user_id": 5803067, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24c214b5a2bb45dabb3122be0dfef109?s=128&d=identicon&r=PG", "display_name": "Aneesh Durg", "link": "https://stackoverflow.com/users/5803067/aneesh-durg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 895, "favorite_count": 0, "accepted_answer_id": 41485705, "answer_count": 2, "score": 5, "last_activity_date": 1483630786, "creation_date": 1483619293, "last_edit_date": 1483619874, "question_id": 41485126, "link": "https://stackoverflow.com/questions/41485126/difference-between-forkio-forkos-and-forkprocess", "title": "Difference between forkIO/forkOS and forkProcess?", "body": "<p>I'm not sure what the difference between <code>forkIO</code>/<code>forkOS</code> and <code>forkProcess</code> are in Haskell. To my understanding, <code>forkIO</code>/<code>forkOS</code> are more like threads (analogous to <code>pthread_create</code> in C) whereas <code>forkProcess</code> starts a separate process (analogous to <code>fork</code>).</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1483601625, "post_id": 41478141, "comment_id": 70164299, "body": "Clarifying a detail: what is supposed to happen if one of your inner lists is something like <code>[[1,2],[3,4]]</code>?"}, {"owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1483601687, "post_id": 41478141, "comment_id": 70164335, "body": "nothing the 2d array remains unchanged. <code>[[1,2],[3,4]]</code>"}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1483604842, "post_id": 41478141, "comment_id": 70165766, "body": "The type should be one list less deep, so <code>f :: [[[Integer]]] -&gt; [[[Integer]]]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 627, "user_id": 4179599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7df8139d9f4ec48fee9d6bfd968976?s=128&d=identicon&r=PG&f=1", "display_name": "Renzeee", "link": "https://stackoverflow.com/users/4179599/renzeee"}, "edited": false, "score": 2, "creation_date": 1483613192, "post_id": 41480533, "comment_id": 70170834, "body": "You can work around <code>groupBy</code> with <code>sort</code> (or the generic <code>sortBy</code>), like <code>map (map (foldl1&#39; dedup) . groupBy dup . sort)</code>. In this case, <code>sort</code> works fine, as it sorts <code>[[a]]</code> on elements from head to tail."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 627, "user_id": 4179599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7df8139d9f4ec48fee9d6bfd968976?s=128&d=identicon&r=PG&f=1", "display_name": "Renzeee", "link": "https://stackoverflow.com/users/4179599/renzeee"}, "edited": false, "score": 1, "creation_date": 1483636747, "post_id": 41480533, "comment_id": 70187550, "body": "@Renzeee Indeed. I considered mentioning that, but given the phrasing used in the question I suspect the order in the &quot;middle layer&quot; inner lists matters for the OP. In any case, I guess it doesn&#39;t hurt to add that as a footnote."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 4, "last_activity_date": 1483649223, "last_edit_date": 1495542834, "creation_date": 1483605784, "answer_id": 41480533, "question_id": 41478141, "link": "https://stackoverflow.com/questions/41478141/how-to-transform-array-with-duplicates-into-array-with-sum-of-duplicates/41480533#41480533", "title": "How to transform array with duplicates into array with sum of duplicates?", "body": "<p>(Preliminary note: if your innermost lists always have two elements, you should consider <a href=\"https://stackoverflow.com/q/31497468/2751851\">using pairs instead</a>, as in <code>[[(4,2)],[(1,2),(1,1)]]</code>. That would make it unnecessary to deal with impossible cases or to worry about getting lists with wrong lengths that your function can't handle. That said, in what follows I will use the types you originally proposed.)</p>\n\n<p>Though you didn't use it in <code>sumOfSample</code>, you were on the right track with <code>ifDuplicateGroup</code>:</p>\n\n<pre><code>-- I have specialised the functions to Integer; they could be more general.\n-- Also note that dup is partial; it only works with lists of two elements.\n-- That is the sort of issue you might avoid by using pairs.\ndup :: [Integer] -&gt; [Integer] -&gt; Bool\ndup [x,_] [y,_] = x == y\n\n-- Making it a function by not supplying 'sample'.\nifDuplicateGroup :: [[[Integer]]] -&gt; [[[[Integer]]]]\nifDuplicateGroup = map (groupBy dup)\n</code></pre>\n\n<p><code>ifDuplicateGroup</code> will give you a quadryply nested list -- a list of grouped two-element lists. The next step is changing that back into a triply nested list by squashing the groups and thus removing the duplicates. That can be done through a fold, applied through two layers of mapping (so that the lists being folded are the groups of innermost lists):</p>\n\n<pre><code>-- Combining function for the fold. Note that, just like dup, it is partial.\ndedup :: [Integer] -&gt; [Integer] -&gt; [Integer]\ndedup [x, acc] [_, y] = [x, acc + y]\n\n-- foldl1' doesn't work with empty lists. That is not a problem here, given\n-- that group does not produce empty (inner) lists.\nsumOfSample :: [[[[Integer]]]] -&gt; [[[Integer]]]\nsumOfSample = map (map (foldl1' dedup)) . ifDuplicateGroup\n-- Or, equivalently:\n-- sumOfSample = map (map (foldl1' dedup) . groupBy dup)\n</code></pre>\n\n<p>One caveat is that <code>groupBy</code> only groups adjacent elements, and so you have e.g.:</p>\n\n<pre><code>GHCi&gt; sumOfSample [[[4,2],[4,4]],[[1,2],[2,1],[1,1]]]\n[[[4,6]],[[1,2],[2,1],[1,1]]]\n</code></pre>\n\n<p>If that is not acceptable, working around that is possible, though it may be quite annoying and/or require a somewhat different approach. (Unless you don't care about the order in the \"middle layer\" inner lists, in case you can simply use <code>ifDuplicateGroup = map (groupBy dup . sort) sample</code>, as Renezee points out in the comments.)</p>\n"}, {"tags": [], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "is_accepted": true, "score": 3, "last_activity_date": 1483624149, "last_edit_date": 1483624149, "creation_date": 1483622594, "answer_id": 41486250, "question_id": 41478141, "link": "https://stackoverflow.com/questions/41478141/how-to-transform-array-with-duplicates-into-array-with-sum-of-duplicates/41486250#41486250", "title": "How to transform array with duplicates into array with sum of duplicates?", "body": "<p>Deep list make code hard to understand. Does using type alias help?</p>\n\n<p>This is my ad hoc solution.</p>\n\n<pre><code>import Data.List\n\ntype Pair = [Int]\n\ntype PairList = [Pair]\n\nsample :: [PairList]\nsample = [[[3,5],[2,3],[1,1]],\n          [[3,5],[2,3],[4,2],[1,2]],\n          [[3,5],[2,3],[4,2],[1,2]],\n          [[4,2],[1,2],[1,1]]]\n\ndupList :: PairList -&gt; PairList\ndupList xs = ss\n  where gs = groupBy dup xs\n        ss = map sumGroup gs\n\nsumGroup :: PairList -&gt; Pair\nsumGroup xs = [h,t]\n  where h = head $ head xs\n        t = sum $ concatMap tail xs\n\ndup :: Pair -&gt; Pair -&gt; Bool\ndup xs ys = head xs == head ys\n\nmain :: IO ()\nmain = do\n  putStrLn \"input\"\n  mapM_ print sample\n\n  putStrLn \"output\"\n  let output = map dupList sample\n  mapM_ print output\n</code></pre>\n\n<p>yeild</p>\n\n<pre><code>&gt;runhaskell listlist.hs  \n\ninput                    \n[[3,5],[2,3],[1,1]]      \n[[3,5],[2,3],[4,2],[1,2]]\n[[3,5],[2,3],[4,2],[1,2]]\n[[4,2],[1,2],[1,1]]      \noutput                   \n[[3,5],[2,3],[1,1]]      \n[[3,5],[2,3],[4,2],[1,2]]\n[[3,5],[2,3],[4,2],[1,2]]\n[[4,2],[1,3]]    \n</code></pre>\n\n<p>If <code>Pair</code> only have 2 members, eg. <code>[a,b]</code>, you should use tuple <code>(a,b)</code> and use <code>fst</code>,<code>snd</code> instead of <code>head</code>,<code>tail</code></p>\n"}], "owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 1, "accepted_answer_id": 41486250, "answer_count": 2, "score": 2, "last_activity_date": 1483649223, "creation_date": 1483595690, "last_edit_date": 1483625948, "question_id": 41478141, "link": "https://stackoverflow.com/questions/41478141/how-to-transform-array-with-duplicates-into-array-with-sum-of-duplicates", "title": "How to transform array with duplicates into array with sum of duplicates?", "body": "<p>So I've been struggling with this for a few hours now. I have this array <code>[[[4,2]],[[1,2],[1,1]]]</code> and I'd like to transform this array into <code>[[[4,2]],[[1,3]]]</code>. </p>\n\n<p>So a function with type <code>f :: [[[Integer]]] -&gt; [[[Integer]]]</code></p>\n\n<h1>Problem</h1>\n\n<p>I have a 2d array with inner arrays of length 2: <code>[[x,y] .. ]</code> \nAn inner array is a duplicate if its head element is repeated: <code>[[1,2],[1,1]]</code>\nIf there are duplicates I want to take the sum of all the tails and create a new array with the head as the duplicate value and the sum of duplicates as the tail value: <code>[[1,2],[1,1]]</code> becomes <code>[[[1,3]]</code></p>\n\n<h1>What I have</h1>\n\n<pre><code>dup [x,_] [y,_] = x == y\n\nsample = [[[3,5],[2,3],[1,1]],\n          [[3,5],[2,3],[4,2],[1,2]],\n          [[3,5],[2,3],[4,2],[1,2]],\n          [[4,2],[1,2],[1,1]]]\n\nifDuplicateGroup = map (groupBy dup) sample\n\ngetSumOfDups n = map sum [concat $ map tail y | y &lt;- n, (length y) &gt; 1]\n\nsumOfSample = map getSumOfDups sample\n</code></pre>\n\n<p><strong>Returns</strong>: </p>\n\n<pre><code>sumOfSample = [[],[],[],[3]]\n</code></pre>\n\n<p><strong>Desired Result:</strong></p>\n\n<pre><code>sumOfSample = \n[[[3,5],[2,3],[1,1]],\n [[3,5],[2,3],[4,2],[1,2]],\n [[3,5],[2,3],[4,2],[1,2]],\n [[4,2],[1,3]]]`\n</code></pre>\n\n<p>this is the best I could work through. Please help! I cant figure out how to get the desired result.</p>\n"}, {"tags": ["haskell", "conduit", "haskell-pipes", "http-conduit", "lazy-io"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1483574750, "post_id": 41475255, "comment_id": 70156575, "body": "Print is just <code>putStrLn</code> and <code>show</code>.  So what you should probably be asking is &quot;why doesn&#39;t &#39;Show&#39; fully evaluate the value?&quot;.  I suspect the answer will be obvious once you look at the Show instance for whatever the body type is.  Also notice the only portion of the response that would be forced is the body, not the status or other fields."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1483574924, "post_id": 41475255, "comment_id": 70156634, "body": "Re-reading your question, it appears you want one value, <code>response</code>, to be evaluated when calling print on another value, <code>body</code>.  Is that the case?  If so, why would you expect that behavior in the first place?"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1483575606, "post_id": 41475255, "comment_id": 70156844, "body": "What happened to the <code>show (statusCode) ...</code> line in the first snippet?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1483577541, "post_id": 41475255, "comment_id": 70157345, "body": "This doesn&#39;t have to do with laziness, it&#39;s the difference between the <code>Response L.ByteString</code> you get in the &quot;simple&quot; case, and the <code>Response BodyReader</code> you get in the tls case. A <code>BodyReader</code> cant be printed directly since it&#39;s an IO action. But it&#39;s an action that can be repeated, yielding a new chunk each time. It follows the familiar protocol that when it is  &#39;done&#39; when it gets an empty bytestring.  In your tls case, you are just printing the first chunk, but you need a loop to print the results as they come, til you hit an empty chunk."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1483578919, "post_id": 41475255, "comment_id": 70157745, "body": "sevo, look at the difference between <code>bip</code> and <code>bop</code> here <a href=\"http://lpaste.net/8526468113670078464\" rel=\"nofollow noreferrer\">lpaste.net/8526468113670078464</a> You wrote <code>bip</code> which only fetches once, so to speak, and prints one nice-sized chunk - in this case the first couple chapters of the king james bible. But you want <code>bop</code> which prints chunks until it hits an empty chunk, and thus prints the whole translation."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1483581543, "post_id": 41475255, "comment_id": 70158359, "body": "@Michael Comments are an impoverished space, which probably explains why you put your code in an lpaste instead of including it inline. Why not turn it into an answer, where you have enough space to include all the details without linking elsewhere? =)"}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1483659718, "post_id": 41475255, "comment_id": 70199448, "body": "@Michael Please make this an answer. I was hasty and not aware that &quot;body&quot; means &quot;body chunk of arbitrary size&quot; in this API. I&#39;m still confused about the types and names in this API but you helped me to realize my mistake."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1483714737, "post_id": 41475255, "comment_id": 70222330, "body": "@DanielWagner Okay I wrote a long version fwiw."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1483720789, "post_id": 41475255, "comment_id": 70226124, "body": "The first example has a syntax error (trailing <code>++</code>). Please fix."}], "answers": [{"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 5, "last_activity_date": 1483749976, "last_edit_date": 1483749976, "creation_date": 1483670999, "answer_id": 41498160, "question_id": 41475255, "link": "https://stackoverflow.com/questions/41475255/why-doesnt-print-force-entire-lazy-io-value/41498160#41498160", "title": "Why doesn&#39;t print force entire lazy IO value?", "body": "<p>This doesn't have to do with laziness, but with the difference between the <code>Response L.ByteString</code> you get with the Simple module, and the <code>Response BodyReader</code> you get with the TLS module. </p>\n\n<p>You noticed that a <code>BodyReader</code> is an <code>IO ByteString</code>. But in particular it is an action that can be repeated, each time with the <em>next</em> chunk of bytes. It follows the protocol that it never sends a null bytestring except when it's at the end of file. (<code>BodyReader</code> might have been called <code>ChunkGetter</code>). <code>bip</code> below is like what you wrote: after extracting the <code>BodyReader</code>/<code>IO ByteString</code> from the <code>Response</code>, it performs it to get the first chunk, and prints it. But doesn't repeat the action to get more - so in this case we just see the first couple chapters of Genesis. What you need is a loop to exhaust the chunks, as in <code>bop</code> below, which causes the whole King James Bible to spill into the console. </p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-} \nimport Network.HTTP.Client\nimport Network.HTTP.Client.TLS\nimport qualified Data.ByteString.Char8 as B\n\nmain = bip\n-- main = bop\n\nbip = do \n  manager &lt;- newManager tlsManagerSettings\n  request &lt;- parseRequest \"https://raw.githubusercontent.com/michaelt/kjv/master/kjv.txt\"\n  withResponse request manager $ \\response -&gt; do\n      putStrLn \"The status code was: \"  \n      print (responseStatus response)\n      chunk  &lt;- responseBody response\n      B.putStrLn chunk\n\nbop = do \n  manager &lt;- newManager tlsManagerSettings\n  request &lt;- parseRequest \"https://raw.githubusercontent.com/michaelt/kjv/master/kjv.txt\"\n  withResponse request manager $ \\response -&gt; do\n      putStrLn \"The status code was: \" \n      print (responseStatus response)\n      let loop = do \n            chunk &lt;- responseBody response\n            if B.null chunk \n              then return () \n              else B.putStr chunk  &gt;&gt; loop \n      loop\n</code></pre>\n\n<p>The loop keeps going back to get more chunks until it gets an empty string, which represents eof, so in the terminal it prints through to the end of the Apocalypse.</p>\n\n<p>This is behavior is straightforward but slightly technical. You can only work with a <code>BodyReader</code> by hand-written recursion. But the purpose of the <code>http-client</code> library is to make things like <code>http-conduit</code> possible. There the result of <a href=\"https://hackage.haskell.org/package/http-conduit-2.2.3/docs/Network-HTTP-Simple.html#v:withResponse\" rel=\"nofollow noreferrer\"><code>withResponse</code></a> has the type <code>Response (ConduitM i ByteString m ())</code>. <code>ConduitM i ByteString m ()</code> is how conduit types of a byte stream; this byte stream would contain the whole file.  </p>\n\n<p>In the original form of the <code>http-client</code>/<code>http-conduit</code> material, the <code>Response</code> contained a conduit like this; the <code>BodyReader</code> part was later factored out into <code>http-client</code> so it could be used by different streaming libraries like <code>pipes</code>.</p>\n\n<p>So to take a simple example, in the corresponding http material for the <a href=\"https://hackage.haskell.org/package/streaming\" rel=\"nofollow noreferrer\"><code>streaming</code></a> and <a href=\"https://hackage.haskell.org/package/streaming-bytestring\" rel=\"nofollow noreferrer\"><code>streaming-bytestring</code></a> libraries, <a href=\"https://hackage.haskell.org/package/streaming-utils-0.1.4.3/docs/Data-ByteString-Streaming-HTTP.html#v:withHTTP\" rel=\"nofollow noreferrer\"><code>withHTTP</code></a> gives you a response of type <code>Response (ByteString IO ())</code>.  <code>ByteString IO ()</code> is the type of a stream of bytes arising in IO, as its name suggests; <code>ByteString Identity ()</code> would be the equivalent of a lazy bytestring (effectively a pure list of chunks.)  The <code>ByteString IO ()</code> will in this case represent the whole bytestream down to the Apocalypse. So with the imports </p>\n\n<pre><code> import qualified Data.ByteString.Streaming.HTTP as Bytes -- streaming-utils\n import qualified Data.ByteString.Streaming.Char8 as Bytes -- streaming-bytestring\n</code></pre>\n\n<p>the program is identical to a lazy bytestring program:</p>\n\n<pre><code>bap = do \n    manager &lt;- newManager tlsManagerSettings\n    request &lt;- parseRequest \"https://raw.githubusercontent.com/michaelt/kjv/master/kjv.txt\"\n    Bytes.withHTTP request manager $ \\response -&gt; do \n        putStrLn \"The status code was: \"\n        print (responseStatus response)\n        Bytes.putStrLn $ responseBody response\n</code></pre>\n\n<p>Indeed it is slightly simpler, since you don't have \"extract the bytes from IO`:</p>\n\n<pre><code>        lazy_bytes &lt;- responseStatus response\n        Lazy.putStrLn lazy_bytes\n</code></pre>\n\n<p>but just write</p>\n\n<pre><code>        Bytes.putStrLn $ responseBody response\n</code></pre>\n\n<p>you just \"print\" them directly.  If you want to view just a bit from the middle of the KJV, you can instead do what you would with a lazy bytestring, and end with:</p>\n\n<pre><code>        Bytes.putStrLn $ Bytes.take 1000 $ Bytes.drop 50000 $ responseBody response\n</code></pre>\n\n<p>Then you will see something about Abraham.</p>\n\n<p>The <code>withHTTP</code> for <code>streaming-bytestring</code> just hides the recursive looping that we needed to use the <code>BodyReader</code> material from <code>http-client</code> directly. It's the same e.g. with the <code>withHTTP</code> you find in <a href=\"https://hackage.haskell.org/package/pipes-http\" rel=\"nofollow noreferrer\"><code>pipes-http</code></a>, which represents a stream of bytestring chunks as <code>Producer ByteString IO ()</code>, and the same with <code>http-conduit</code>. In all of these cases, once you have your hands on the byte stream you handle it in the ways typical of the streaming IO framework without handwritten recursion. All of them use the <code>BodyReader</code> from <code>http-client</code> to do this, and this was the main purpose of the library.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 41498160, "answer_count": 1, "score": 2, "last_activity_date": 1483749976, "creation_date": 1483574555, "last_edit_date": 1483714843, "question_id": 41475255, "link": "https://stackoverflow.com/questions/41475255/why-doesnt-print-force-entire-lazy-io-value", "title": "Why doesn&#39;t print force entire lazy IO value?", "body": "<p>I'm using <a href=\"https://haskell-lang.org/library/http-client\" rel=\"nofollow noreferrer\">http-client</a> tutorial to get response body using TLS connection. Since I can observe that <code>print</code> is called by <code>withResponse</code>, why doesn't <code>print</code> force entire response to the output in the following fragment?</p>\n\n<pre><code>withResponse request manager $ \\response -&gt; do\n    putStrLn $ \"The status code was: \" ++\n    body &lt;- (responseBody response)\n    print body\n</code></pre>\n\n<p>I need to write this instead:</p>\n\n<pre><code>response &lt;- httpLbs request manager\n\nputStrLn $ \"The status code was: \" ++\n           show (statusCode $ responseStatus response)\nprint $ responseBody response\n</code></pre>\n\n<p>Body I want to print is a lazy ByteString. I'm still not sure whether I should expect <code>print</code> to print the entire value.</p>\n\n<pre><code>instance Show ByteString where\n    showsPrec p ps r = showsPrec p (unpackChars ps) r\n</code></pre>\n"}]