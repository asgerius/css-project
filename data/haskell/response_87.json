[{"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1473287494, "post_id": 39379600, "comment_id": 66087778, "body": "Well yes, it&#39;s definitely relevant that you&#39;re using Windows 7. And so is the Haskell ecosystem \u2013 how did you install GHC? With stack, or some other way? ...I know I shouldn&#39;t, but I can&#39;t help recommending to just switch to some Linux distro to definitely get rid of such trouble. (But I&#39;ve heard that GHC with stack should nowadays be easy even on Windows, so...)"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1473292501, "post_id": 39379600, "comment_id": 66089073, "body": "Is your drive full?"}, {"owner": {"reputation": 513, "user_id": 5041183, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1c5068e27ced5f817fd65a7f3d333cfe?s=128&d=identicon&r=PG", "display_name": "Fortunato", "link": "https://stackoverflow.com/users/5041183/fortunato"}, "edited": false, "score": 0, "creation_date": 1473340005, "post_id": 39379600, "comment_id": 66109611, "body": "Unfortunately, I am stuck with Windows for the time being   I installed GHC using the Haskell Platform installer.     The drive is not full ~8GB of space left."}, {"owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "edited": false, "score": 0, "creation_date": 1473457956, "post_id": 39379600, "comment_id": 66165497, "body": "@Fortunato this is peculiar.. can you pastebin the output of <code>ghc hello.hs -v3</code> ?"}, {"owner": {"reputation": 2667, "user_id": 325725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3db095f94749aaedfea12b927b13cf74?s=128&d=identicon&r=PG", "display_name": "Phyx", "link": "https://stackoverflow.com/users/325725/phyx"}, "edited": false, "score": 0, "creation_date": 1473458890, "post_id": 39379600, "comment_id": 66165757, "body": "The lines: *** Deleting temp files: Deleting: *** Deleting temp dirs: Deleting:  Make me think that something&#39;s wrong with your temp folder. As no temporaries have been created (which would explain the missing hello.o file). GHCi could be linking entirely in memory."}], "answers": [{"tags": [], "owner": {"reputation": 103, "user_id": 4671061, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aTNOT.png?s=128&g=1", "display_name": "Adam Beddoe", "link": "https://stackoverflow.com/users/4671061/adam-beddoe"}, "is_accepted": false, "score": 1, "last_activity_date": 1503110022, "creation_date": 1503110022, "answer_id": 45767094, "question_id": 39379600, "link": "https://stackoverflow.com/questions/39379600/running-and-compiling-hello-world-in-haskell/45767094#45767094", "title": "Running and compiling &#39;Hello, World!&#39; in Haskell", "body": "<p>GHC requires that the file be named the same as the module in order to compile it. \nHowever, any module can be loaded into GHCi regardless of file name. This is why repl worked but compiling did not.</p>\n\n<p>In your case, therefore, you should rename the file Main.hs</p>\n"}], "owner": {"reputation": 513, "user_id": 5041183, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1c5068e27ced5f817fd65a7f3d333cfe?s=128&d=identicon&r=PG", "display_name": "Fortunato", "link": "https://stackoverflow.com/users/5041183/fortunato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2343, "favorite_count": 0, "answer_count": 1, "score": 8, "last_activity_date": 1503110022, "creation_date": 1473285343, "last_edit_date": 1473345283, "question_id": 39379600, "link": "https://stackoverflow.com/questions/39379600/running-and-compiling-hello-world-in-haskell", "title": "Running and compiling &#39;Hello, World!&#39; in Haskell", "body": "<p>I am new to Haskell and am having an issue running the following code:</p>\n\n<pre><code>module Main (\nmain\n) where \nmain = putStrLn \"Hello, world!\"\n</code></pre>\n\n<p>SublimeHaskell tries to compile and run the above using </p>\n\n<pre><code>runhaskell hello.hs\n</code></pre>\n\n<p>which returns the error</p>\n\n<pre><code>hello.o: getModificationTime: invalid argument (The system cannot find the file specified.)\n</code></pre>\n\n<p>I have also tried to run it using</p>\n\n<pre><code>ghc --make hello.hs\n</code></pre>\n\n<p>with the same error. When I try to manually compile the code before running using the command line</p>\n\n<pre><code>ghc -c hello.hs\n</code></pre>\n\n<p>I get a different error: </p>\n\n<pre><code>CreateDirectory \".\": invalid argument (Cannot create a file when that file already exists.)\n</code></pre>\n\n<p>On the other hand, I can run the program via the REPL without issue:</p>\n\n<pre><code>ghci\nGHCi, version 8.0.1: http://www.haskel.org/ghc/  :? for help\nPrelude&gt; putStrLn \"Hello, world!\"\nHello, world!\n</code></pre>\n\n<p>If it's relevant, I am using Windows 7, and I installed GHC using the Haskell Platform installer.</p>\n\n<p>***edit  running the above commands with the <code>-v</code> flag gives the following results:</p>\n\n<pre><code>ghc -v hello.hs\n\nGlasgow Haskell Compiler, Version 8.0.1, stage 2 booted by GHC version     7.10.2\nUsing binary package database: C:\\Program Files\\Haskell      Platform\\8.0.1\\lib\\package.conf.d\\package.cache\nloading package database C:\\Program Files\\Haskell    Platform\\8.0.1\\lib\\package.conf.d\nwired-in package ghc-prim mapped to ghc-prim-0.5.0.0\nwired-in package integer-gmp mapped to integer-gmp-1.0.0.1\nwired-in package base mapped to base-4.9.0.0\nwired-in package rts mapped to rts\nwired-in package template-haskell mapped to template-haskell-2.11.0.0\nwired-in package ghc mapped to ghc-8.0.1\nwired-in package dph-seq not found.\nwired-in package dph-par not found.\nHsc static flags:\nloading package database C:\\Program Files\\Haskell     Platform\\8.0.1\\lib\\package.conf.d\nwired-in package ghc-prim mapped to ghc-prim-0.5.0.0\nwired-in package integer-gmp mapped to integer-gmp-1.0.0.1\nwired-in package base mapped to base-4.9.0.0\nwired-in package rts mapped to rts-1.0\nwired-in package template-haskell mapped to template-haskell-2.11.0.0\nwired-in package ghc mapped to ghc-8.0.1\nwired-in package dph-seq not found.\nwired-in package dph-par not found.\n*** Chasing dependencies:\nChasing modules from: *hello.hs\n*** Deleting temp files:\nDeleting:\n*** Deleting temp dirs:\nDeleting:\nhello.o: getModificationTime: invalid argument (The system cannot find the file specified.)\n\nghc -c -v hello.hs\n\nGlasgow Haskell Compiler, Version 8.0.1, stage 2 booted by GHC version 7.10.2\nUsing binary package database: C:\\Program Files\\Haskell     Platform\\8.0.1\\lib\\package.conf.d\\package.cache\nloading package database C:\\Program Files\\Haskell    Platform\\8.0.1\\lib\\package.conf.d\nwired-in package ghc-prim mapped to ghc-prim-0.5.0.0\nwired-in package integer-gmp mapped to integer-gmp-1.0.0.1\nwired-in package base mapped to base-4.9.0.0\nwired-in package rts mapped to rts\nwired-in package template-haskell mapped to template-haskell-2.11.0.0\nwired-in package ghc mapped to ghc-8.0.1\nwired-in package dph-seq not found.\nwired-in package dph-par not found.\nHsc static flags:\n*** Checking old interface for Main:\n*** Parser [Main]:\n!!! Parser [Main]: finished in 0.00 milliseconds, allocated 0.067 megabytes\n*** Renamer/typechecker [Main]:\n!!! Renamer/typechecker [Main]: finished in 46.80 milliseconds, allocated  15.720 megabytes\n*** Desugar [Main]:\nResult size of Desugar (after optimization)\n= {terms: 13, types: 6, coercions: 0}\n!!! Desugar [Main]: finished in 0.00 milliseconds, allocated 0.204 megabytes\n*** Simplifier [Main]:\nResult size of Simplifier iteration=1\n= {terms: 17, types: 8, coercions: 0}\nResult size of Simplifier = {terms: 17, types: 8, coercions: 0}\n!!! Simplifier [Main]: finished in 0.00 milliseconds, allocated 0.171  megabytes\n*** CoreTidy [Main]:\nResult size of Tidy Core = {terms: 17, types: 8, coercions: 0}\n!!! CoreTidy [Main]: finished in 0.00 milliseconds, allocated 2.558  megabytes\n*** Deleting temp files:\nDeleting:\n*** Deleting temp dirs:\nDeleting:\nCreateDirectory \".\": invalid argument (Cannot create a file when that file already exists.)\n</code></pre>\n\n<p>After looking around, it seems that the two packages that are listed as not found (<code>dph-seq</code> and <code>dph-par</code>) have been deprecated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1473289206, "post_id": 39379531, "comment_id": 66088270, "body": "I don&#39;t know the answer, but I do know that the ability to use ambiguous functions like this is very new, thanks to GHC8&#39;s new type application syntax. So I wouldn&#39;t be surprised if the answer is &quot;it&#39;s not supported yet&quot;"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473317329, "post_id": 39379531, "comment_id": 66095584, "body": "In this context, you&#39;re specializing to an <i>argument</i> more than a <i>signature</i>. I don&#39;t know that the type specialization process makes much sense here. One option might be to use a proxy behind the scenes to get specialization while presenting this weird new interface to the world (I&#39;m not entirely sold on it yet)."}, {"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473317622, "post_id": 39379531, "comment_id": 66095725, "body": "@dfeuer: I think it&#39;s just that the existing /syntax/ isn&#39;t well-suited for specifying it. The only real difference between the proxy and the ambiguous type is whether the type parameter is explicit or implicit."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473318004, "post_id": 39379531, "comment_id": 66095944, "body": "I don&#39;t see the difference between adding specialization for explicit type arguments and adding specializations for value arguments. Maybe general argument specialization is the way to go?"}, {"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "edited": false, "score": 0, "creation_date": 1473320159, "post_id": 39379531, "comment_id": 66097186, "body": "Sounds plausible, but might be significantly more work than just exposing the existing type specialization functionality for ambiguous types. If there&#39;s a good syntax that can express both, perhaps that could be used but the value specialisation left unimplemented initially."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473320160, "post_id": 39379531, "comment_id": 66097187, "body": "I&#39;d try to code this using the <code>RULES</code> pragma, but I don&#39;t expect it to work, currently."}, {"owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473320240, "post_id": 39379531, "comment_id": 66097242, "body": "@chi: with <code>RULES</code> couldn&#39;t I wind up inadvertently rewriting to the wrong specialization? If I can&#39;t specify an appropriate constraint on <code>t</code> on the left-hand side of the rule, it might apply too often."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473320874, "post_id": 39379531, "comment_id": 66097597, "body": "@GaneshSittampalam True. I was wondering about something like <code>RULES showRead @Int = showReadInt</code>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1473351772, "post_id": 39379531, "comment_id": 66117879, "body": "Maybe just slap an INLINE on it?"}], "answers": [{"tags": [], "owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "is_accepted": true, "score": 1, "last_activity_date": 1475789652, "creation_date": 1475789652, "answer_id": 39905967, "question_id": 39379531, "link": "https://stackoverflow.com/questions/39379531/how-do-i-specialise-with-an-explicit-type-application/39905967#39905967", "title": "How do I specialise with an explicit type application?", "body": "<p>This isn't supported in GHC 8.0, but is now the subject of a <a href=\"https://github.com/ghc-proposals/ghc-proposals/pull/15/files\" rel=\"nofollow\">proposal</a> to support it in future GHCs.</p>\n"}], "owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "accepted_answer_id": 39905967, "answer_count": 1, "score": 18, "last_activity_date": 1475789652, "creation_date": 1473284988, "last_edit_date": 1473311058, "question_id": 39379531, "link": "https://stackoverflow.com/questions/39379531/how-do-i-specialise-with-an-explicit-type-application", "title": "How do I specialise with an explicit type application?", "body": "<p>With GHC 8.0, I can write an ambiguous function that's overloaded over some type not mentioned in the main part of its type signature, and then call it using an explicit type application:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables, RankNTypes,\n             AllowAmbiguousTypes, TypeApplications, TypeFamilies #-}\n\nshowRead :: forall t . (Read t, Show t) =&gt; String -&gt; String\nshowRead x = show (read x :: t)\n\nshowReadInt = showRead @Int\n</code></pre>\n\n<p>I'd like to use a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#specialize-pragma\"><code>SPECIALIZE</code></a> pragma to force a specialisation of <code>showRead</code> for <code>Int</code> (my real code has the actual call site in a different module). However, the normal <code>SPECIALIZE</code> syntax is based on writing the main part of the type signature, e.g.:</p>\n\n<pre><code>{-# SPECIALIZE showRead :: String -&gt; String #-}\n</code></pre>\n\n<p>and in this case that doesn't allow me to specify what <code>t</code> should be, and predictably gives an error about it being ambiguous.</p>\n\n<p>I tried using an equality constraint:</p>\n\n<pre><code>{-# SPECIALISE showRead :: forall t . (Read t, Show t, t ~ Int) =&gt; String -&gt; String #-}\n</code></pre>\n\n<p>but that just gave the error:</p>\n\n<blockquote>\n<pre><code>\u2022 Could not deduce (Read t0) a SPECIALISE pragma for \u2018showRead\u2019\n  from the context: (Read t, Show t, t ~ Int)\n    bound by the type signature for:\n               showRead :: (Read t, Show t, t ~ Int) =&gt; String -&gt; String\n    at foo.hs:4:1-76\n  The type variable \u2018t0\u2019 is ambiguous\n</code></pre>\n</blockquote>\n\n<p>Is there any way I can do this? Of course I could just use a <code>Proxy</code>, but it seems a shame not to use the shiny new way instead.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 27942, "user_id": 96982, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "GS - Apologise to Monica", "link": "https://stackoverflow.com/users/96982/gs-apologise-to-monica"}, "is_accepted": true, "score": 3, "last_activity_date": 1473335651, "last_edit_date": 1473335651, "creation_date": 1473285035, "answer_id": 39379545, "question_id": 39379517, "link": "https://stackoverflow.com/questions/39379517/wondering-about-interact-usage/39379545#39379545", "title": "Wondering about interact usage", "body": "<p>With what you've written, you're trying to calculate the length of the whole input sequence, so your program has to wait for the entire sequence to be available. </p>\n\n<p>You could try a lazy pattern-match like this:</p>\n\n<pre><code>interaction (x1:x2:x3:x4:x5:x6:x7:x8:x9:x10:x11:_) = \"long word\"\n</code></pre>\n\n<p>This allows you to ignore the rest of the input once you know you've reached 10 characters.</p>\n\n<p>A cleaner/more general alternative (suggested by @amalloy) that scales for bigger lengths and allows a variable length guard would be something like:</p>\n\n<pre><code>interaction xs | not . null . drop 10 $ xs = \"long word\"\n</code></pre>\n\n<p>If what you really want to do is process your input a line at a time, and produce this message for an individual line longer than 10 characters, you can use <code>lines</code> and <code>unlines</code> to make your interaction function line-oriented rather than character-oriented, e.g.:</p>\n\n<pre><code>main :: IO ()\nmain = interact (unlines . interaction . lines)\n\ninteraction :: [String] -&gt; [String]\ninteraction (x:_) | length x &gt; 10 = \"long word\" -- this is just looking at the first line\n...\n</code></pre>\n\n<p>or maybe if you want to do that for every line, not just the first:</p>\n\n<pre><code>main :: IO ()\nmain = interact (unlines . map interaction . lines)\n\ninteraction :: String -&gt; String\ninteraction x | length x &gt; 10 = \"long word\"\n...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 34692, "user_id": 356440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d16fc2844c1d9f8f815f318734554266?s=128&d=identicon&r=PG", "display_name": "Stephane Rolland", "link": "https://stackoverflow.com/users/356440/stephane-rolland"}, "edited": false, "score": 0, "creation_date": 1473285237, "post_id": 39379567, "comment_id": 66087026, "body": "ok, so it is because of my using the <code>length</code>function. it makes sense. thanks."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 3, "last_activity_date": 1473285141, "creation_date": 1473285141, "answer_id": 39379567, "question_id": 39379517, "link": "https://stackoverflow.com/questions/39379517/wondering-about-interact-usage/39379567#39379567", "title": "Wondering about interact usage", "body": "<p><code>interact</code> takes the entirety of standard input at once, as one big string. You call <code>length</code> on all of stdin, and so your function cannot return until stdin is exhausted entirely. You could, for example, hit ctrl-D (assuming Unix) to send EOF, and then your function will finally find out what stdin's length is.</p>\n"}], "owner": {"reputation": 34692, "user_id": 356440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d16fc2844c1d9f8f815f318734554266?s=128&d=identicon&r=PG", "display_name": "Stephane Rolland", "link": "https://stackoverflow.com/users/356440/stephane-rolland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 39379545, "answer_count": 2, "score": 1, "last_activity_date": 1473335651, "creation_date": 1473284918, "last_edit_date": 1473286196, "question_id": 39379517, "link": "https://stackoverflow.com/questions/39379517/wondering-about-interact-usage", "title": "Wondering about interact usage", "body": "<p>I'm playing with the <code>interact</code> function from Prelude, wanting to do a simple REPL evaluating my inputs line by line, and I cannot understand what's going on.</p>\n\n<p>If I make it simple like this:</p>\n\n<pre><code>main :: IO ()\nmain = interact interaction\n\ninteraction :: String -&gt; String\ninteraction (x:xs) = xs\ninteraction x = x\n</code></pre>\n\n<p>Then it behaves ok, and removes the first character from my input, or returns the input if it is only one character long.</p>\n\n<p>What puzzles me is if add this line:</p>\n\n<pre><code>interaction :: String -&gt; String\ninteraction x | length x &gt; 10 = \"long word\"  -- this line causes problem\ninteraction (x:xs) = xs\ninteraction x = x\n</code></pre>\n\n<p>Then, interact <em>seems</em> not to work correctly any longer. \nIt just awaits for my input, swallows it awaiting another input and so on, but <strong>never</strong> outputs anything.</p>\n\n<p>It seems so simple however, but I cannot see what is going wrong.\nAny idea ?</p>\n\n<p>(On my path I have GHC 7.6.3, I don't know if it has some importance.)</p>\n"}, {"tags": ["haskell", "generics", "deriving"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1473283172, "post_id": 39379006, "comment_id": 66086277, "body": "I haven&#39;t yet seen <code>DeriveAnyClass</code> do anything useful. I have seen it produce compile-time crashes, however. Methinks &#39;tis buggy."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1560523484, "post_id": 39379006, "comment_id": 99776774, "body": "These days, the code proposed in this question <i>does</i> compile! The compiler&#39;s behavior has changed -- and for the better."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1560532639, "post_id": 39379006, "comment_id": 99781246, "body": "Indeed, the extension got a lot of work over the last couple years, I believe mostly by Ryan Scott."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1473291843, "post_id": 39380305, "comment_id": 66088902, "body": "Thanks, this explains things completely! Now that you&#39;ve highlighted the problem that&#39;s being solved (&quot;What context should be given to the instance?&quot;), I can see why the GHC folks made the decision they did -- and I&#39;m nevertheless starting to consider this a misfeature. The conditions under which it will &quot;Just Work&quot; seem incredibly specific, and the work it saves in those conditions seems quite small indeed."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1473292111, "post_id": 39380305, "comment_id": 66088977, "body": "I agree. Most (all?) of the classes for which <code>DeriveAnyClass</code> is useful will be relying on a top-level superclass like <code>Generic</code> or <code>Data</code>, rather than a recursive context based on the structure of the type. The rules make sense for <code>Eq</code> because the generated code is itself structurally recursive."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1560532945, "post_id": 39380305, "comment_id": 99781386, "body": "This answer is now outdated. As Daniel Wagner points out in a comment on the question, the code now compiles! This answer should at least be updated to indicate that, and to link to an older version of the manual that still says that <code>Eq</code> and <code>Functor</code> business. Recent versions are much more sensible about inferring constraints."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1560535625, "post_id": 39380305, "comment_id": 99782416, "body": "@dfeuer Thanks for notifying me, I&#39;ve added a note to the top of the answer"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 15, "last_activity_date": 1560535605, "last_edit_date": 1560535605, "creation_date": 1473289802, "answer_id": 39380305, "question_id": 39379006, "link": "https://stackoverflow.com/questions/39379006/what-is-the-difference-between-deriveanyclass-and-an-empty-instance/39380305#39380305", "title": "What is the difference between `DeriveAnyClass` and an empty instance?", "body": "<p><strong>NB</strong>: As pointed out by David in the comments, GHC has been updated since I wrote this. The code as written in the question compiles and works correctly. So just imagine everything below is written in the past tense.</p>\n\n<hr>\n\n<p><a href=\"http://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#deriving-any-other-class\" rel=\"nofollow noreferrer\">The GHC docs</a> say:</p>\n\n<blockquote>\n  <p>The instance context will be generated according to the same rules\n  used when deriving <code>Eq</code> (if the kind of the type is <code>*</code>), or the rules for\n  Functor (if the kind of the type is <code>(* -&gt; *)</code>). For example</p>\n\n<pre><code>instance C a =&gt; C (a,b) where ...\n\ndata T a b = MkT a (a,b) deriving( C )\n</code></pre>\n  \n  <p>The <code>deriving</code> clause will\n  generate</p>\n\n<pre><code>instance C a =&gt; C (T a b) where {}\n</code></pre>\n  \n  <p>The constraints <code>C a</code> and <code>C (a,b)</code> are generated from the data constructor arguments, but the\n  latter simplifies to <code>C a</code>.</p>\n</blockquote>\n\n<p>So, according to the <code>Eq</code> rules, your <code>deriving</code> clause generates...</p>\n\n<pre><code>instance ToNamedRecord Int =&gt; ToNamedRecord Foo where\n</code></pre>\n\n<p>... which is not the same as...</p>\n\n<pre><code>instance ToNamedRecord Foo where\n</code></pre>\n\n<p>... in that the former is only valid if there's an <code>instance ToNamedRecord Int</code> in scope (which is appears there isn't in your case).</p>\n\n<p>But I find the spec to be somewhat ambiguous. Should the example really generate that code, or should it generate <code>instance (C a, C (a, b)) =&gt; instance C (T a b)</code> and let the solver discharge the second constraint? It appears, in your example, that it's generating such constraints even for fields with fully-concrete types.</p>\n\n<p>I hesitate to call this a bug, because it's how <code>Eq</code> works, but given that <code>DeriveAnyClass</code> is intended to make it quicker to write <em>empty</em> instances it does seem unintuitive.</p>\n"}], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2512, "favorite_count": 2, "accepted_answer_id": 39380305, "answer_count": 1, "score": 24, "last_activity_date": 1560535605, "creation_date": 1473282375, "last_edit_date": 1473283737, "question_id": 39379006, "link": "https://stackoverflow.com/questions/39379006/what-is-the-difference-between-deriveanyclass-and-an-empty-instance", "title": "What is the difference between `DeriveAnyClass` and an empty instance?", "body": "<p>Using the <a href=\"http://hackage.haskell.org/package/cassava\">cassava</a> package, the following compiles:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nimport Data.Csv\nimport GHC.Generics\n\ndata Foo = Foo { foo :: Int } deriving (Generic)\ninstance ToNamedRecord Foo\n</code></pre>\n\n<p>However, the following does not:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE DeriveAnyClass #-}\n\nimport Data.Csv\nimport GHC.Generics\n\ndata Foo = Foo { foo :: Int } deriving (Generic, ToNamedRecord)\n</code></pre>\n\n<p>The compiler reports:</p>\n\n<pre><code>test.hs:7:50:\n    No instance for (ToNamedRecord Int)\n      arising from the first field of \u2018Foo\u2019 (type \u2018Int\u2019)\n    Possible fix:\n      use a standalone 'deriving instance' declaration,\n        so you can specify the instance context yourself\n    When deriving the instance for (ToNamedRecord Foo)\n</code></pre>\n\n<p>This leaves me with two questions: Why isn't the second version identical to the first? And why is the compiler hoping to find an instance for <code>ToNamedRecord Int</code>?</p>\n"}, {"tags": ["haskell", "scotty"], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 5, "last_activity_date": 1473282331, "creation_date": 1473282331, "answer_id": 39378995, "question_id": 39378493, "link": "https://stackoverflow.com/questions/39378493/ambiguous-type-variable-a0-arising-from-a-use-of-param-prevents-the-constrai/39378995#39378995", "title": "Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018param\u2019 prevents the constraint \u2018(Parsable a0)\u2019 from being solved", "body": "<p><code>param</code> has type <code>Parseable a =&gt; Text -&gt; ActionM a</code>, which means <code>f</code> would have type <code>a</code>. However, you never do anything with <code>f</code>, so there is no way to infer what type <code>a</code> should be. Assuming you don't want to just comment the line out until you <em>do</em> use <code>f</code>, you need to provide an explicit type:</p>\n\n<pre><code>routes :: ScottyM ()\nroutes = do\n  post \"/create\" $ do\n    f &lt;- param (\"fa\" :: L.Text) :: ActionM L.Text\n    file \"create.html\"\n</code></pre>\n\n<p>You could probably pick any type that has a <code>Parseable</code> instance, but <code>L.Text</code> seems like the type it <em>should</em> be. Once you actually use <code>f</code>, you can probably remove the explicit annotation.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1708, "favorite_count": 0, "accepted_answer_id": 39378995, "answer_count": 1, "score": 3, "last_activity_date": 1473282331, "creation_date": 1473280213, "question_id": 39378493, "link": "https://stackoverflow.com/questions/39378493/ambiguous-type-variable-a0-arising-from-a-use-of-param-prevents-the-constrai", "title": "Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018param\u2019 prevents the constraint \u2018(Parsable a0)\u2019 from being solved", "body": "<p>I'm having trouble understanding this error message, not too sure what I should investigate next.</p>\n\n<p>I've got the  following imports:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Web.Scotty\n\nimport Control.Applicative\nimport Control.Monad.IO.Class\nimport Database.SQLite.Simple\nimport Database.SQLite.Simple.FromRow\nimport qualified Data.Text.Lazy as L\n</code></pre>\n\n<p>The code causing the error:</p>\n\n<pre><code>routes :: ScottyM ()\nroutes = do\n  post \"/create\" $ do\n    f &lt;- param (\"fa\" :: L.Text)\n    file \"create.html\"\n</code></pre>\n\n<p>And the error:</p>\n\n<pre><code>    \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018param\u2019\n  prevents the constraint \u2018(Parsable a0)\u2019 from being solved.\n  Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n  These potential instances exist:\n    instance Parsable Integer\n      -- Defined in \u2018scotty-0.11.0:Web.Scotty.Action\u2019\n    instance Parsable L.Text\n      -- Defined in \u2018scotty-0.11.0:Web.Scotty.Action\u2019\n    instance Parsable ()\n      -- Defined in \u2018scotty-0.11.0:Web.Scotty.Action\u2019\n    ...plus 7 others\n    ...plus 12 instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n\u2022 In a stmt of a 'do' block: f &lt;- param (\"f\" :: L.Text)\n  In the second argument of \u2018($)\u2019, namely\n    \u2018do { f &lt;- param (\"f\" :: L.Text);\n          file \"create.html\" }\u2019\n  In a stmt of a 'do' block:\n    post \"/create\"\n    $ do { f &lt;- param (\"f\" :: L.Text);\n           file \"create.html\" }\n</code></pre>\n"}, {"tags": ["multithreading", "haskell", "asynchronous", "server"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1473278417, "post_id": 39377458, "comment_id": 66084129, "body": "What kind of memory consumption are you observing?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1473279749, "post_id": 39377458, "comment_id": 66084746, "body": "If this is a performance question please post how you&#39;re compiling and running"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 1, "creation_date": 1473280102, "post_id": 39377458, "comment_id": 66084918, "body": "No, so far I&#39;m not experiencing any problems as I&#39;m testing with with a limited amount of clients. My concern are the nested calls to <code>withAsync</code>."}, {"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 0, "creation_date": 1473697700, "post_id": 39377458, "comment_id": 66230889, "body": "Maybe a watchdog timer architecture?  Have the main loop sleep and write the current time to an MVar.  Have server threads check the current time against the MVar.  Instead of <code>forever</code> write and use <code>untilWatchdog :: MVar CTime -&gt; IO a -&gt; IO ()</code>."}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1473275431, "creation_date": 1473275431, "question_id": 39377458, "link": "https://stackoverflow.com/questions/39377458/simple-server-that-cancels-all-the-forked-threads-upon-termination", "title": "Simple server that cancels all the forked threads upon termination", "body": "<p>I'm writing a simple (chat) server inspired on <a href=\"http://chimera.labs.oreilly.com/books/123000000092\" rel=\"nofollow\">Simon Marlow's book</a>. I'm writing some unit tests where, at each case, I start the server, wait for it, and kill it. </p>\n\n<p>What I would like is to define the main server thread in such a way that if it dies, all the threads spawned by it are terminated.</p>\n\n<p>Currently the server looks as follows:</p>\n\n<pre><code>serve :: IO ()\nserve = withSocketsDo $ do\n  bracket acquireSocket releaseSocket doServe\n  where\n    acquireSocket = do\n      putStrLn \"Starting chat server\"\n      listenOn Config.port\n\n    releaseSocket socket = do\n      sClose socket\n      putStrLn \"Stopping chat server\"\n\n    doServe socket = forever $ do\n        (h, host, port) &lt;- accept socket\n        a &lt;- async $ talk h `finally` hClose h\n        -- How do we cancel all the asynchronous processes if an exception is\n        -- raised?\n        return ()\n</code></pre>\n\n<p>If I run the tests using a simple <code>talk</code> function defined as:</p>\n\n<pre><code>talk :: Handle -&gt; IO ()\ntalk h = do\n  putStrLn $ (show h) ++ \" bla bla bla ...\"\n  defaultDelay\n  talk h     \n</code></pre>\n\n<p>I can see, as expected, that the <code>talk</code> threads keep on \"talking\" after their parents have died.</p>\n\n<p>In Marlow's book, it is shown how a hierarchy of threads can be created using <code>withAsync</code>, so that if the parent dies all of its children are terminated. Using this function, the <code>doServe</code> function could be rewritten as follows:</p>\n\n<pre><code>doServe socket = do\n  (h, host, port) &lt;- accept socket\n  withAsync (talk h `finally` hClose h) (\\_ -&gt; doServe socket)\n</code></pre>\n\n<p>Note that I've replaced <code>forever</code> by a recursive call to <code>doServe</code>. </p>\n\n<p>This solution has the expected behavior, and I like its simplicity, however, I'm worried about its the memory consumption.</p>\n\n<p>I've sketched other solutions, but I cannot come up with something reasonably simple and more efficient. If I have to maintain a large data structures anyway, I'd rather stick to the <code>withAsync</code> solution.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 3, "creation_date": 1473268233, "post_id": 39375641, "comment_id": 66079385, "body": "If other languages can&#39;t consume it, it&#39;s a problem with their JSON parser. <a href=\"http://www.json.org/\" rel=\"nofollow noreferrer\">Scientific notation is part of the JSON standard.</a>"}, {"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1473269188, "post_id": 39375641, "comment_id": 66079867, "body": "Noted.  I&#39;d still like to know if there is a way to do it without writing my own encode function."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1473269945, "creation_date": 1473269945, "answer_id": 39376174, "question_id": 39375641, "link": "https://stackoverflow.com/questions/39375641/in-aeson-how-do-you-encode-from-a-value-without-resulting-in-scientific-notatio/39376174#39376174", "title": "In aeson, how do you encode from a Value without resulting in scientific notation?", "body": "<p>I have looked for this functionality before myself; I believe at that time I was trying to interface with a Ruby program, and the standard Ruby JSON parser didn't support scientific notation. Unfortunately I believe aeson does not have a way to do it, so you will need to either patch aeson or write your own encoder.</p>\n\n<p>There are further details <a href=\"https://github.com/bos/aeson/issues/227\" rel=\"nofollow\">on the aeson issue tracker</a>. That issue additionally suggests using <code>toEncoding</code> on a type other than <code>Value</code> to achieve this, but it's not clear whether this is practical in your case or not.</p>\n"}, {"comments": [{"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "edited": false, "score": 0, "creation_date": 1473272378, "post_id": 39376357, "comment_id": 66081372, "body": "I should be able to extract some minimal code from the library at least.  If no one gives a better method I&#39;ll mark it answered."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1473270720, "creation_date": 1473270720, "answer_id": 39376357, "question_id": 39375641, "link": "https://stackoverflow.com/questions/39375641/in-aeson-how-do-you-encode-from-a-value-without-resulting-in-scientific-notatio/39376357#39376357", "title": "In aeson, how do you encode from a Value without resulting in scientific notation?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/aeson-pretty-0.8.1/docs/Data-Aeson-Encode-Pretty.html\" rel=\"nofollow\">pretty printer for Aeson</a> (only since version 0.8, quite recent) has a configuration option that does exactly what you're asking:</p>\n\n<pre><code>Prelude&gt; :m +Data.Aeson Data.Aeson.Encode.Pretty \nPrelude Data.Aeson Data.Aeson.Encode.Pretty&gt; encodePretty' (defConfig{confNumFormat=Decimal}) (Array [String \"asdf\",Number 1.0,Number 1.0,Number 1.0000000001e9,Number 1.0e-2])\n\"[\\n    \\\"asdf\\\",\\n    1.0,\\n    1.0,\\n    1000000000.1,\\n    0.01\\n]\"\n</code></pre>\n\n<p>Unfortunately, this pretty-printer now outputs the actual integral numbers as <code>1.0</code> instead of <code>1</code>, which I consider a much more severe problem than printing decimals in scientific notation (which really should be ok everywhere). This also happens with the default setting:</p>\n\n<pre><code>Prelude Data.Aeson Data.Aeson.Encode.Pretty&gt; encodePretty (Array [String \"asdf\",Number 1.0,Number 1.0,Number 1.0000000001e9,Number 1.0e-2])\n\"[\\n    \\\"asdf\\\",\\n    1.0,\\n    1.0,\\n    1.0000000001e9,\\n    1.0e-2\\n]\"\n</code></pre>\n\n<p>Version 0.7.2 still printed integers without fractional part, like the normal aeson <code>encode</code> does:</p>\n\n<pre><code>aeson-pretty-0.7.2:Data.Aeson.Encode.Pretty&gt; encodePretty (Array [String \"asdf\",Number 1.0,Number 1.0,Number 1.0000000001e9,Number 1.0e-2])\n\"[\\n    \\\"asdf\\\",\\n    1,\\n    1,\\n    1.0000000001e9,\\n    1.0e-2\\n]\"\n</code></pre>\n\n<p>I think I'll file this as a bug report.</p>\n\n<p>Note that there's also a <a href=\"http://hackage.haskell.org/package/aeson-pretty-0.8.1/docs/Data-Aeson-Encode-Pretty.html#t:NumberFormat\" rel=\"nofollow\"><code>Custom</code></a> <code>NumberFormat</code> option, which gives you complete control about how numbers should appear.</p>\n"}], "owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "accepted_answer_id": 39376357, "answer_count": 2, "score": 5, "last_activity_date": 1473270720, "creation_date": 1473267772, "question_id": 39375641, "link": "https://stackoverflow.com/questions/39375641/in-aeson-how-do-you-encode-from-a-value-without-resulting-in-scientific-notatio", "title": "In aeson, how do you encode from a Value without resulting in scientific notation?", "body": "<p>I have parsed a large amount of json, manipulated some values and I'd like to write it back out.  Aeson decodes numbers into scientific, but when it encodes it, by default, scientific shows numbers in scientific notation in many cases, and aeson does not offer any means that I can see to change that.</p>\n\n<pre><code>&gt; decode \"[\\\"asdf\\\", 1, 1.0, 1000000000.1, 0.01]\" :: Maybe Value\nJust (Array [String \"asdf\",Number 1.0,Number 1.0,Number 1.0000000001e9,Number 1.0e-2])\n\nencode (Array [String \"asdf\",Number 1.0,Number 1.0,Number 1.0000000001e9,Number 1.0e-2])\n\"[\\\"asdf\\\",1,1,1.0000000001e9,1.0e-2]\"\n\n&gt; encode (Array [String \"asdf\", Number 1, Number 1.0, Number 1000000000.1, Number 0.01])\n\"[\\\"asdf\\\",1,1,1.0000000001e9,1.0e-2]\"\n</code></pre>\n\n<p>How can I write out my Value with numbers in a more widely acceptable format that other languages can consume?  Let's pretend I'm not concerned with precision loss or integer overflows.  The scientific package has the means to format numbers in this manner, aeson just happened not to use it.</p>\n\n<pre><code>&gt;formatScientific Fixed Nothing (0.01)\n\"0.01\"\n\n&gt;formatScientific Fixed Nothing (1000000000.1)\n\"1000000000.1\"\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473260083, "post_id": 39369916, "comment_id": 66074463, "body": "For instance <code>foldr (\\w r -&gt; w .&amp;. 1 : r) []</code> will lazily produce a list of the least significant bits. The line noise version is <code>foldr ((:) . (1 .&amp;.)) []</code>."}, {"owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "edited": false, "score": 0, "creation_date": 1473316721, "post_id": 39369916, "comment_id": 66095257, "body": "the signature of <code>unpack</code> is <code>ByteString -&gt; [GHC.Word.Word8]</code> is there any difference between <code>Data.Word8</code> and <code>GHC.Word.Word8</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1473319808, "post_id": 39369916, "comment_id": 66096991, "body": "Yes, they are the same, in GHC. The <code>Data.Word8</code> is the public version you should use. Internally, that is a re-export of the GHC internal implementation of <code>Word8</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1473251113, "creation_date": 1473251113, "answer_id": 39369916, "question_id": 39369889, "link": "https://stackoverflow.com/questions/39369889/haskell-convert-a-bytestring-to-word8/39369916#39369916", "title": "Haskell : convert a bytestring to [word8]", "body": "<pre><code>unpack :: ByteString -&gt; [Word8] \n</code></pre>\n\n<p><a href=\"http://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString.html#v:unpack\">http://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString.html#v:unpack</a></p>\n\n<p>Also consider whether you can skip the intermediate list, and directly use <a href=\"http://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString.html#v:foldl-39-\"><code>foldl'</code></a> or some related fold.</p>\n"}], "owner": {"reputation": 623, "user_id": 5910215, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/62487068172a6c63ecc4f2e13d4b2a8f?s=128&d=identicon&r=PG&f=1", "display_name": "khaled omar", "link": "https://stackoverflow.com/users/5910215/khaled-omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 0, "accepted_answer_id": 39369916, "answer_count": 1, "score": 0, "last_activity_date": 1473251113, "creation_date": 1473251003, "question_id": 39369889, "link": "https://stackoverflow.com/questions/39369889/haskell-convert-a-bytestring-to-word8", "title": "Haskell : convert a bytestring to [word8]", "body": "<p>my intent is to convert a <code>bytestring</code> to a <code>List of Word8</code> in haskell in order to get access to the LSB for each <code>byte</code>.</p>\n\n<p>any idea how to achieve that ?</p>\n"}, {"tags": ["haskell", "time-complexity"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 5, "creation_date": 1473247824, "post_id": 39368619, "comment_id": 66065332, "body": "Use <a href=\"https://hackage.haskell.org/package/dlist\" rel=\"nofollow noreferrer\">difference lists</a>."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 4, "creation_date": 1473254744, "post_id": 39368619, "comment_id": 66070334, "body": "Or better: <a href=\"http://comments.gmane.org/gmane.comp.lang.haskell.libraries/18980\" rel=\"nofollow noreferrer\">don&#39;t use</a> <code>Writer</code> at all."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1473267081, "post_id": 39368619, "comment_id": 66078799, "body": "Getty wrote up a nice little piece about the issue with Writer not too long ago: <a href=\"http://blog.infinitenegativeutility.com/2016/7/writer-monads-and-space-leaks\" rel=\"nofollow noreferrer\">blog.infinitenegativeutility.com/2016/7/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 3, "last_activity_date": 1474028135, "creation_date": 1474028135, "answer_id": 39531300, "question_id": 39368619, "link": "https://stackoverflow.com/questions/39368619/what-is-complexity-of-control-monad-writer-for-w-a/39531300#39531300", "title": "What is complexity of Control.Monad.Writer for w ~ [a]?", "body": "<p>To sum this up:</p>\n\n<ol>\n<li><p>Yes, <code>tell</code>ing an <code>[a]</code> has quadratic complexity in <code>Writer</code>. This can be avoided by using <code>DList</code> (which uses that <code>Codensity</code>-like trick I was talking about) or another datatype whose <code>mappend</code> isn't <code>O(n^2)</code>.</p></li>\n<li><p>On top of that, <code>Writer</code> generates thunks for each <code>&gt;&gt;=</code> used to build up a computation. This is a problem because unlike the first case it can't be worked around. The solution is to use <code>State</code> monad instead.</p></li>\n</ol>\n"}], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 39531300, "answer_count": 1, "score": 3, "last_activity_date": 1474028135, "creation_date": 1473247520, "last_edit_date": 1473247853, "question_id": 39368619, "link": "https://stackoverflow.com/questions/39368619/what-is-complexity-of-control-monad-writer-for-w-a", "title": "What is complexity of Control.Monad.Writer for w ~ [a]?", "body": "<p>Assuming <code>tell = flip mappend</code> it should be quadratic, but that would make this <code>Writer</code> instance pretty useless. If it's really so, what can be done to improve performance?</p>\n\n<p>I'm thinking of trick that was used in <code>Control.Monad.Free.Church</code> as well as <code>Control.Monad.Codensity</code>: it should be possible to reassociate <code>mappend</code> calls, just like <code>Codensity</code> reassociates <code>&gt;&gt;=</code>, but i haven't figured how exactly.</p>\n"}, {"tags": ["haskell", "monads", "reader-monad"], "comments": [{"owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "edited": false, "score": 0, "creation_date": 1473240760, "post_id": 39366069, "comment_id": 66060830, "body": "As I understand, this is an abstraction over anything which could behave like <code>Reader</code> monad. For example, it could be a stack of monad transformers. Please correct me if I&#39;m wrong."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 16, "last_activity_date": 1473240998, "creation_date": 1473240998, "answer_id": 39366332, "question_id": 39366069, "link": "https://stackoverflow.com/questions/39366069/reader-and-monadreader/39366332#39366332", "title": "Reader and MonadReader", "body": "<p>There is no <code>MonadReader</code> monad. That is a <em>class</em> of monads, namely of those monads that can be <em>used as</em> a <code>Reader</code> (generally, because they're defined as a monad transformer stack with a <a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Reader.html#t:ReaderT\"><code>ReaderT</code></a> in somewhere). So,</p>\n\n<ul>\n<li><p><a href=\"http://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Reader.html#t:Reader\"><code>Reader</code></a> is the specific monad that <em>only</em> acts as a reader, because it has <code>ReaderT</code> only applied to the trivial identity monad:</p>\n\n<pre><code>type Reader r = ReaderT r Identity\n</code></pre>\n\n<p>It is thus obviously an instance of <code>MonadReader</code>, but doesn't do anything else.</p></li>\n<li><code>MonadReader</code> is is the class of <em>all</em> monads that can read from some environment. Again, this includes <code>Reader</code> itself, but also <code>MaybeT (ReaderT Int (ListT IO))</code>.</li>\n</ul>\n"}], "owner": {"reputation": 831, "user_id": 2198297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d1c9129d47811254fac68d8561c9a50c?s=128&d=identicon&r=PG", "display_name": "andro", "link": "https://stackoverflow.com/users/2198297/andro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 478, "favorite_count": 2, "accepted_answer_id": 39366332, "answer_count": 1, "score": 6, "last_activity_date": 1473245357, "creation_date": 1473240327, "last_edit_date": 1473245357, "question_id": 39366069, "link": "https://stackoverflow.com/questions/39366069/reader-and-monadreader", "title": "Reader and MonadReader", "body": "<p>Why is there a Reader monad and a MonadReader monad in Control.Monad.Reader? The package documentation talks about the Reader monad and then launches into the MonadReader documentation directly with no explanation. What is the difference between these monads? Reading these reference pages leaves me more than confused. Interestingly, the Reader monad page for the Haskell wikibook has yet to be written!</p>\n"}, {"tags": ["haskell", "haskell-stack", "hspec"], "answers": [{"tags": [], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "is_accepted": true, "score": 20, "last_activity_date": 1473239886, "creation_date": 1473239886, "answer_id": 39365910, "question_id": 39365402, "link": "https://stackoverflow.com/questions/39365402/select-which-test-to-run-with-hspec-and-stack/39365910#39365910", "title": "Select which test to run with Hspec and stack", "body": "<p>I found the answer <a href=\"https://github.com/commercialhaskell/stack/issues/2210\" rel=\"noreferrer\">here</a>. I was trying with <code>--</code>, however I needed to use <code>--test-arguments</code>:</p>\n\n<pre><code>stack test --test-arguments \"-m \"Module0\"\"\n</code></pre>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1210, "favorite_count": 5, "accepted_answer_id": 39365910, "answer_count": 1, "score": 15, "last_activity_date": 1473239886, "creation_date": 1473238465, "question_id": 39365402, "link": "https://stackoverflow.com/questions/39365402/select-which-test-to-run-with-hspec-and-stack", "title": "Select which test to run with Hspec and stack", "body": "<p>I've written a series of test, using the <a href=\"http://hspec.github.io/hspec-discover.html\" rel=\"noreferrer\">automatic spec discovery</a> feature of Hspec. I'm also using <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"noreferrer\">stack</a> as my build tool.</p>\n\n<p>My test directory has the the <code>Spec.hs</code> file, along with the test files for the different modules of my application (e.g. <code>Module0Spec.hs</code>, <code>Module1Spec.hs</code>).</p>\n\n<p>Now, when I start writing a new test module, or when I want to re-run a failed test after code changes, I'd like to be able to run only a given test module.</p>\n\n<p>Is there any way in which either stack or Hspec allow to do this?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1473241004, "post_id": 39365101, "comment_id": 66060987, "body": "Intero requires stack. It says as much on the front page. If you want some place to toy around with, why not create sort of a playground stack project?"}, {"owner": {"reputation": 3205, "user_id": 134596, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4e8005d587118578e4027e5312fd4171?s=128&d=identicon&r=PG", "display_name": "oggy", "link": "https://stackoverflow.com/users/134596/oggy"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1473246824, "post_id": 39365101, "comment_id": 66064677, "body": "@Cubic: I know it requires stack. I can indeed create a stack project, but I&#39;m just wondering if there&#39;s a faster workaround for one-offs that I already have lying around."}], "owner": {"reputation": 3205, "user_id": 134596, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4e8005d587118578e4027e5312fd4171?s=128&d=identicon&r=PG", "display_name": "oggy", "link": "https://stackoverflow.com/users/134596/oggy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1473237594, "creation_date": 1473237594, "question_id": 39365101, "link": "https://stackoverflow.com/questions/39365101/stack-ghci-intero-import-between-two-standalone-files", "title": "stack ghci (intero): import between two standalone files", "body": "<p>I have just two files <code>A.hs</code> and <code>B.hs</code> in a directory <code>dir</code> (so no cabal or stack.yaml files). <code>A</code> imports <code>B</code> (with just <code>import B</code>). Running <code>stack ghci</code> and loading <code>A</code> then fails, complaining about the import. Is there a way to get this working? Running the system-wide <code>ghci</code>, everything works fine of course.</p>\n\n<p>The reason I'm asking is that I've switched to intero for Emacs, which uses stack, and I'd like to be able to use intero for random small bits of code that I have lying around.</p>\n\n<p>Versions: ghc 8.0.1, stack 1.1.2.</p>\n"}, {"tags": ["list", "function", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1473257477, "post_id": 39365187, "comment_id": 66072333, "body": "As I pointed out in an answer to a similar question, you can replace the first two cases with <code>applyToTwo f _ = []</code> if it is listed after the <code>applyToTwo f (x:x1:rest)</code> case."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1473238210, "last_edit_date": 1473238210, "creation_date": 1473237853, "answer_id": 39365187, "question_id": 39364983, "link": "https://stackoverflow.com/questions/39364983/apply-a-function-to-next-two-elements-in-list/39365187#39365187", "title": "Apply a function to next two elements in list", "body": "<p>This should do:</p>\n\n<pre><code>applyToTwo :: (a -&gt; a -&gt; b) -&gt; [a] -&gt; [b]\napplyToTwo f [] = []\napplyToTwo f [x] = []\napplyToTwo f (x:x1:rest) = f x x1 : applyToTwo f (x1:rest)\n</code></pre>\n\n<p>Generalizing to arbitrary arities should be possible, but it requires some advanced type-level hackery.</p>\n"}, {"tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": false, "score": 8, "last_activity_date": 1473270104, "last_edit_date": 1473270104, "creation_date": 1473237919, "answer_id": 39365212, "question_id": 39364983, "link": "https://stackoverflow.com/questions/39364983/apply-a-function-to-next-two-elements-in-list/39365212#39365212", "title": "Apply a function to next two elements in list", "body": "<p>It appears you are simply zipping a list with its tail, so you could use <code>zipWith</code>:</p>\n\n<pre><code>applyToTwo f xs = zipWith f xs (tail xs)\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 6376286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29f9527237423285f50e51fc3e21fe99?s=128&d=identicon&r=PG&f=1", "display_name": "GlossMash", "link": "https://stackoverflow.com/users/6376286/glossmash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 39365187, "answer_count": 2, "score": 1, "last_activity_date": 1473270104, "creation_date": 1473237242, "last_edit_date": 1473238513, "question_id": 39364983, "link": "https://stackoverflow.com/questions/39364983/apply-a-function-to-next-two-elements-in-list", "title": "Apply a function to next two elements in list", "body": "<p>I am writing a function to apply a function for next two elements in list. </p>\n\n<p>For example: <code>applyToTwo (+) [1,2,3,4]</code> return <code>[3,5,7]</code>.</p>\n\n<p><code>applyToTwo (-) [7,1,1,1,1]</code> return <code>[6,0,0,0]</code>.</p>\n\n<p>I want to generalize the type so it could apply to any type I want. My attempt is:</p>\n\n<pre><code>applyToTwo :: (a -&gt; a -&gt; b) -&gt; [a] -&gt; [a]\napplyToTwo f [] = []\napplyToTwo f [x] = []\napplyToTwo f (x:x1:rest) = f x x1 ++ applyToTwo f (x1:rest)\n</code></pre>\n\n<p>By the way, are there any way to generalize the number of element to apply so it could apply to 3, 4, 5?</p>\n"}, {"tags": ["sockets", "haskell", "io", "network-programming", "handle"], "comments": [{"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 1, "creation_date": 1473235345, "post_id": 39364198, "comment_id": 66057499, "body": "Yes, if any of the two sides doesn&#39;t want to read from the socket again, it can write its final data and the close the socket. The other side will still be able to read all that final data."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1473235416, "post_id": 39364198, "comment_id": 66057531, "body": "And I guess the best practice is to close the handle at both ends, isn&#39;t it?"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 231, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1473234773, "creation_date": 1473234773, "last_edit_date": 1495535351, "question_id": 39364198, "link": "https://stackoverflow.com/questions/39364198/closing-socket-and-handle-in-a-client-server-application", "title": "Closing socket and handle in a client-server application", "body": "<p>This question refers to the <code>Network</code> library in Haskell.</p>\n\n<p>I have a simple client-server application. The server acquires a socket, accepts connections there, and forks a server thread to handle the requests:</p>\n\n<pre><code>sock &lt;- listenOn port\n(handle, _, _) &lt;- accept socket\nforkFinally (serve handle) (_ -&gt; hClose handle)\n-- Upon termination of the main thread I perform a 'sClose sock' as well\n</code></pre>\n\n<p>The client connects to the server, and reads and writes to the handle (as the server does):</p>\n\n<pre><code>handle &lt;- connectTo host port\n-- Read and write on 'handle'\n</code></pre>\n\n<p>Now my question is whether the client should close the handle as well when it finishes interacting with the server.</p>\n\n<p>Secondly, the server thread terminates when an <code>\"end\"</code> string is received, but it sends a message <code>\"bye\"</code> before closing the handle. Looking at <a href=\"https://stackoverflow.com/questions/17667901/how-to-handle-socket-read-in-c-when-the-remote-server-closes-socket-possibly-bef\">similar questions</a>, it seems closing the handle at the server still allows the client to read all the data sent to it. My tests confirm this, but maybe I got just lucky. Will closing the handle at the server allow the client to read the data in all cases? </p>\n"}, {"tags": ["haskell", "dll", "shared-libraries", "haskell-stack"], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1473233228, "creation_date": 1473229789, "last_edit_date": 1473233228, "question_id": 39362618, "link": "https://stackoverflow.com/questions/39362618/compile-part-of-all-dependencies-as-shared-libraries", "title": "Compile part of all dependencies as shared libraries", "body": "<p>Say I got (regular source) libraries <code>A</code> and <code>B</code> and executable <code>E</code> which depends on both.</p>\n\n<p>Now, I want <code>E</code> to include the object files of <code>A</code> directly, whereas <code>B</code> should be added as a shared library (concrete use: <code>B</code> contains shared types of a plugin architecture). How would I do that with existing tools, preferably <code>stack</code>?</p>\n\n<p>Is that possible or is it rather an all-or-nothing choice (use only shared libraries or link everything into the same binary)?</p>\n\n<hr>\n\n<p>Optimally, I'd like to specify for each dependency if it should be linked statically or dynamically. Also, that should probably go into the <code>.cabal</code> file, but we have to work with what we got...</p>\n\n<p>(Well, technically that's both statically linked, but in the second case the object code is split up in different files, you get the idea).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1473221477, "post_id": 39360972, "comment_id": 66051420, "body": "What do you mean by &quot;match certain constraints&quot;? Would it help to rewrite this in &quot;pointful&quot; style? <code>readData str = map read (words str)</code>"}, {"owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473221914, "post_id": 39360972, "comment_id": 66051530, "body": "@chepner I need the input to be 2 - 10000. Your earlier comment works. Thanks. Can you help me on this?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1473235622, "post_id": 39360972, "comment_id": 66057642, "body": "You should prove much more information. There&#39;s no way we can answer this without wild guessing about what you actually need."}], "answers": [{"tags": [], "owner": {"reputation": 9272, "user_id": 241544, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d27ca4e9a9a41ec8732046e6a272f091?s=128&d=identicon&r=PG", "display_name": "Matthew Walton", "link": "https://stackoverflow.com/users/241544/matthew-walton"}, "is_accepted": false, "score": 2, "last_activity_date": 1473239963, "creation_date": 1473239963, "answer_id": 39365937, "question_id": 39360972, "link": "https://stackoverflow.com/questions/39360972/access-parameters-of-a-function-with-no-parameter/39365937#39365937", "title": "Access parameters of a function with no parameter", "body": "<p>I'm going to assume, as seems likely, this function takes a string, splits it into words, and then parses them into integers and you need those integers to be restricted to between 2 and 10,000.</p>\n\n<p>So you can just wrap a check around the list you're already producing. However, to do that you're going to need to change to explicit parameters so that you can talk about them.</p>\n\n<pre><code>readData input = map read (words input)\n</code></pre>\n\n<p>Now we can filter it</p>\n\n<pre><code>readData input = filter (\\n -&gt; n &gt;= 2 &amp;&amp; n &lt;= 10000) $ map read (words input)\n</code></pre>\n\n<p>So any out of range numbers just get dropped from the list.</p>\n\n<p>It's best to remember that while point-free style (not using explicit parameters) can be really nice, it's often not possible to express more complex logic with it. I tend to start out by writing my functions with parameters and then taking them out if I realise I can, and if the resulting code looks easier to understand.</p>\n"}], "owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "closed_date": 1473245078, "answer_count": 1, "score": 0, "last_activity_date": 1473239963, "creation_date": 1473220511, "question_id": 39360972, "link": "https://stackoverflow.com/questions/39360972/access-parameters-of-a-function-with-no-parameter", "closed_reason": "Needs details or clarity", "title": "Access parameters of a function with no parameter", "body": "<p>I am new to Haskell. I have a function as:</p>\n\n<pre><code>readData = (map read) . words\n</code></pre>\n\n<p>I need to match certain constraints and accordingly return data. Is there any way I can do this. Thanks.</p>\n"}, {"tags": ["haskell", "ghci", "monomorphism-restriction"], "answers": [{"comments": [{"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1473222859, "post_id": 39361236, "comment_id": 66051776, "body": "That solved my problem. Knowing all of these GHC language extensions is an art in an of itself :-)"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1473222926, "post_id": 39361236, "comment_id": 66051798, "body": "@kurzweil4: now imagine using another (proprietary) Haskell compiler, with its own quirks, for your day job..."}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 1, "creation_date": 1473223172, "post_id": 39361236, "comment_id": 66051859, "body": "I wish GHC would just say &quot;OK, we are Haskell&quot; and get it over with. Then they can just add as many features as they want and not be limited by some old standard. Then, they can publish the spec of &quot;GHC Haskell&quot; as THE Haskell, and if someone else wants to make a compiler, just follow their spec. As far as I know, they are the only (significant) game in town. Perhaps that could get rid of the need for all these language pragmas?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473224736, "post_id": 39361236, "comment_id": 66052304, "body": "@Cactus, I didn&#39;t know there <i>was</i> a proprietary Haskell compiler. What&#39;s that like?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473225107, "post_id": 39361236, "comment_id": 66052419, "body": "@dfeuer: <a href=\"http://anil.recoil.org/papers/2011-cufp-scribe-preprint.pdf\" rel=\"nofollow noreferrer\">anil.recoil.org/papers/2011-cufp-scribe-preprint.pdf</a> spoiler alert: it&#39;s Mu"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473225282, "post_id": 39361236, "comment_id": 66052477, "body": "@dfeuer: also: <a href=\"https://www.reddit.com/r/haskell/comments/35042c/mirror_for_don_stewarts_google_talk/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/35042c/&hellip;</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1473266872, "post_id": 39361236, "comment_id": 66078688, "body": "I realize deciding which ones should be included would be contentious, but it would be nice if you could simply say <code>{-# LANGUAGE GhcAll -#}</code> and get all the extensions at once. There must be <i>some</i> fairly large subset of extensions that would cover most uses with a minimal compile- or run-time impact."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473266979, "post_id": 39361236, "comment_id": 66078744, "body": "@chepner, well, there&#39;s <code>-fglasgow-exts</code>, but that&#39;s deprecated because it means entirely different things in different versions and doesn&#39;t make it the least bit clear what the module actually needs."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 4, "last_activity_date": 1473222715, "creation_date": 1473222715, "answer_id": 39361236, "question_id": 39360929, "link": "https://stackoverflow.com/questions/39360929/list-of-existentially-quantified-constructors/39361236#39361236", "title": "List of Existentially Quantified Constructors", "body": "<p>This is because GHCi doesn't turn on the monomorphism restriction, and GHC (by default) does. To witness, the following file typechecks:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE NoMonomorphismRestriction #-}\n\nclass ToString a where\n\ndata M = forall a. (ToString a) =&gt; B a\n\nbs = [B, B]\n</code></pre>\n\n<p>The inferred type of <code>bs</code> is fairly useless, of course:</p>\n\n<pre><code>*Main&gt; :t bs\nbs :: ToString a =&gt; [a -&gt; M]\n</code></pre>\n\n<p>If you don't want to turn off the monomorphism restriction, you can just add a type signature to the definition of <code>bs</code>:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\nclass ToString a where\n\ndata M = forall a. (ToString a) =&gt; B a\n\nbs :: (ToString a) =&gt; [a -&gt; M]\nbs = [B, B]\n</code></pre>\n"}], "owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 39361236, "answer_count": 1, "score": 1, "last_activity_date": 1473222865, "creation_date": 1473220197, "last_edit_date": 1473222865, "question_id": 39360929, "link": "https://stackoverflow.com/questions/39360929/list-of-existentially-quantified-constructors", "title": "List of Existentially Quantified Constructors", "body": "<p>I have the following data type:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE ExtendedDefaultRules #-}\n\nclass ToString a where\n\ndata M = forall a. (ToString a) =&gt; B a\n</code></pre>\n\n<p>In GHCI I can do the following with no problems:</p>\n\n<p><code>let bs = [B, B]</code></p>\n\n<p>But if I try to do this in a compiled file, I get the following error:</p>\n\n<blockquote>\n<pre class=\"lang-hs prettyprint-override\"><code>No instance for (ToString a0) arising from a use of \u2018B\u2019\nThe type variable \u2018a0\u2019 is ambiguous\nRelevant bindings include\n  bs :: [a0 -&gt; M] (bound at src/My/Module:7:1)\n</code></pre>\n</blockquote>\n\n<p>Which extension(s) am I missing that would allow me to create the list of <code>B</code> as shown? Or what am I missing that GHCI is adding?</p>\n"}, {"tags": ["debugging", "haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1473225917, "post_id": 39360667, "comment_id": 66052669, "body": "GHC 8 has stack traces.  1. Use those traces.  2. Make a newtype wrapper that checks for NAN and +/- infinity then throws exceptions."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1473235123, "post_id": 39360667, "comment_id": 66057349, "body": "If performance is not relevant, definfing a <code>newtype</code> with a custom definition for <code>Num, RealFrac</code> looks simpler than dealing with signals. I&#39;m still curious if using signals is actually possible, though."}], "owner": {"reputation": 319, "user_id": 6531137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8fa00f21d96d6c6030c3c74d7fb26944?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/6531137/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 192, "favorite_count": 2, "answer_count": 0, "score": 4, "last_activity_date": 1473217908, "creation_date": 1473217908, "question_id": 39360667, "link": "https://stackoverflow.com/questions/39360667/how-to-find-floating-point-exceptions-in-haskell", "title": "How to find floating point exceptions in Haskell?", "body": "<p>Suppose a large and complicated Haskell program produces a NaN sometime during the execution. How do I find where in my code this happened without spending a lot of time adding lots of NaN checks to my code? I'm only interested in debugging, so I don't care about portability or performance.</p>\n\n<p>This was discussed five years ago on Haskell-cafe. A possible solution was proposed, but wasn't discussed further.\n<a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2011-May/091858.html\" rel=\"nofollow\">https://mail.haskell.org/pipermail/haskell-cafe/2011-May/091858.html</a></p>\n\n<p>Below is my attempt to get a stack trace to the point where a NaN is generated (in a small example program) by using <code>feenableexcept</code> as suggested in the Haskell-cafe discussion:</p>\n\n<pre><code>-- https://www.gnu.org/software/libc/manual/html_node/Control-Functions.html\nforeign import ccall \"feenableexcept\" enableFloatException :: Int -&gt; IO Int\n\nallFloatExceptions :: Int\nallFloatExceptions = 1 {-INVALID-} + 4 {-DIVBYZERO-} + 8 {-OVERFLOW-} + 16 {-UNDERFLOW-}\n\nmain :: IO ()\nmain = do\n  _ &lt;- enableFloatException allFloatExceptions\n\n  print $ (0/0 :: Double)\n</code></pre>\n\n<p>Unfortunately, running this code doesn't produce a stack trace :(</p>\n\n<pre><code>$ ghc -rtsopts -prof -fprof-auto testNaN.hs &amp;&amp; ./testNaN +RTS -xc\n[1 of 1] Compiling Main             ( testNaN.hs, testNaN.o )\nLinking testNaN ...\nFloating point exception (core dumped)\n</code></pre>\n\n<p>I assume (but really have no idea) that I don't get a stack trace because the GHC runtime wasn't in control when the exception aborted the program. So next I tried using <code>installHandler</code> from <code>System.Posix.Signals</code> to try to make the program crash within GHC's runtime:</p>\n\n<pre><code>import qualified System.Posix.Signals as Signals\n\n-- https://www.gnu.org/software/libc/manual/html_node/Control-Functions.html\nforeign import ccall \"feenableexcept\" enableFloatException :: Int -&gt; IO Int\n\nallFloatExceptions :: Int\nallFloatExceptions = 1 {-INVALID-} + 4 {-DIVBYZERO-} + 8 {-OVERFLOW-} + 16 {-UNDERFLOW-}\n\ncatchFloatException :: IO ()\ncatchFloatException = error \"print stack trace?\"\n\nmain :: IO ()\nmain = do\n  _ &lt;- enableFloatException allFloatExceptions\n  _ &lt;- Signals.installHandler Signals.floatingPointException (Signals.Catch catchFloatException) Nothing\n\n  print $ (0/0 :: Double)\n</code></pre>\n\n<p>Unfortunately, this results in a more mysterious error, and still doesn't give me a stack trace :(</p>\n\n<pre><code>$ ghc -rtsopts -prof -fprof-auto testNaN.hs &amp;&amp; ./testNaN +RTS -xc\n[1 of 1] Compiling Main             ( testNaN.hs, testNaN.o )\nLinking testNaN ...\ntestNaN: too many pending signals\n</code></pre>\n\n<p>I also tried using multiple threads. Most of the time the following happens.</p>\n\n<pre><code>$ ghc -rtsopts -prof -fprof-auto -threaded testNaN.hs &amp;&amp; ./testNaN +RTS -xc -N2\n[1 of 1] Compiling Main             ( testNaN.hs, testNaN.o )\nLinking testNaN ...\ntestNaN: lost signal due to full pipe: 8\n\ntestNaN: lost signal due to full pipe: 8\n\ntestNaN: lost signal due to full pipe: 8\n\n... repeat many many times, very very fast\n</code></pre>\n\n<p>Although, once this happened.\n<a href=\"http://pastebin.com/u3u2cnHE\" rel=\"nofollow\">http://pastebin.com/u3u2cnHE</a></p>\n\n<p>Am I taking the right approach? Is there a way to modify my example so that I can get a stack trace?</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 1, "creation_date": 1473223848, "post_id": 39359969, "comment_id": 66052067, "body": "<code>(+) a b</code> is equivalent to <code>a + b</code> at the expression level.  <code>(-&gt;) a b</code> is equivalent to <code>a -&gt; b</code> at the type level.  Wrapping an infix expression in parentheses is how you write it in prefix."}], "answers": [{"tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 12, "last_activity_date": 1473218590, "last_edit_date": 1473218590, "creation_date": 1473211823, "answer_id": 39360015, "question_id": 39359969, "link": "https://stackoverflow.com/questions/39359969/what-does-data-a-b-mean/39360015#39360015", "title": "What does data (-&gt;) a b mean?", "body": "<p><code>(-&gt;)</code> is the function type and people generally pronounce it as \"to\" (ie <code>a -&gt; b</code> would be pronounced \"a to b\").</p>\n\n<p><code>(-&gt;)</code> is a primitive construct built into GHC: the compiler handles it specially. However, some tools like <code>:i</code> that work with normal types see a fake definition of <code>(-&gt;)</code> as if it was an empty data type:</p>\n\n<pre><code>data (-&gt;) a b\n</code></pre>\n\n<p>This allows <code>:i</code> to give you information about a built-in operation as if it was a normal definition.</p>\n\n<p>The <code>(-&gt;) a b</code> syntax is the prefix version of an infix name, just like you can define normal operators in prefix form:</p>\n\n<pre><code>a ~+ b = a * b + b\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>(~+) a b = a * b + b\n</code></pre>\n\n<p>If you actually tried defining <code>(-&gt;)</code> this way yourself, you would get an error:</p>\n\n<pre><code>&lt;interactive&gt;:20:1-13: error:\n    Illegal binding of built-in syntax: (-&gt;)\n</code></pre>\n\n<p>However, you <em>can</em> define empty data types like this yourself if you give them a valid name:</p>\n\n<pre><code>data Foo a b\n</code></pre>\n\n<p>This makes <code>Foo</code> a type with two (phantom) arguments that has no values except \u22a5, just like <code>Void</code> from <code>Data.Void</code>.</p>\n\n<p>If you want to play around with the infix syntax, you can define a type operator with the <code>TypeOperators</code> extension enabled, with the same meaning as <code>Foo</code>:</p>\n\n<pre><code>data a +~ b\n</code></pre>\n\n<p>or</p>\n\n<pre><code>data (+~) a b\n</code></pre>\n\n<p>This might be useful if, for example, we want to emulate OCaml and write pair typess as <code>a * b</code> rather than <code>(a, b)</code>:</p>\n\n<pre><code>type a * b = (a, b)\n</code></pre>\n"}], "owner": {"reputation": 831, "user_id": 2198297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d1c9129d47811254fac68d8561c9a50c?s=128&d=identicon&r=PG", "display_name": "andro", "link": "https://stackoverflow.com/users/2198297/andro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 39360015, "answer_count": 1, "score": 3, "last_activity_date": 1473218590, "creation_date": 1473211453, "question_id": 39359969, "link": "https://stackoverflow.com/questions/39359969/what-does-data-a-b-mean", "title": "What does data (-&gt;) a b mean?", "body": "<p>For (->) we have:</p>\n\n<pre><code>Prelude&gt; :i (-&gt;)\ndata (-&gt;) t1 t2         -- Defined in \u2018GHC.Prim\u2019\n</code></pre>\n\n<p>What does this syntax mean? I thought the data declaration keyword required a type constructor on the LHS and one or more value constructors on the RHS?</p>\n\n<p>And how is (->) generally spoken or pronounced?</p>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1473196151, "post_id": 39357777, "comment_id": 66045627, "body": "If you can easily generate all permutations yourself, why not do so in a unit test without invoking QuickCheck at all? QuickCheck doesn&#39;t do anything for you if you are generating your own cases."}, {"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1473196411, "post_id": 39357777, "comment_id": 66045753, "body": "All of my tests are using QuickCheck. I think it is nicer having all of the data come from QuickCheck rather than doing something clunky for a special case. If QuickCheck can feed that list one by one to that check, then I think that is much cleaner."}], "answers": [{"comments": [{"owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "edited": false, "score": 0, "creation_date": 1473217876, "post_id": 39359678, "comment_id": 66050700, "body": "Not at all along the lines of what I was thinking. Something totally different, but does exactly what I was looking for. And it a much simpler way."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1473208571, "creation_date": 1473208571, "answer_id": 39359678, "question_id": 39357777, "link": "https://stackoverflow.com/questions/39357777/quickcheck-to-generate-from-static-permutations-list/39359678#39359678", "title": "QuickCheck to Generate from Static Permutations List", "body": "<p>Presumably you have something like:</p>\n\n<pre><code>prop_for_b :: B -&gt; Bool\nprop_for_b = undefined\n\ntest_for_b :: IO ()\ntest_for_b = quickCheck prop_for_b\n</code></pre>\n\n<p>You can use <code>quickCheck</code> and its variants on plain <code>Bool</code>s and it will smartly only run one \"test\"; thus:</p>\n\n<pre><code>prop_for_all_bs :: Bool\nprop_for_all_bs = all prop_for_b [{- ... -}]\n\ntest_for_all_bs :: IO ()\ntest_for_all_bs = quickCheck prop_for_all_bs\n</code></pre>\n"}], "owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 39359678, "answer_count": 1, "score": 1, "last_activity_date": 1473208571, "creation_date": 1473195687, "question_id": 39357777, "link": "https://stackoverflow.com/questions/39357777/quickcheck-to-generate-from-static-permutations-list", "title": "QuickCheck to Generate from Static Permutations List", "body": "<p>Say that I have the data types:</p>\n\n<p></p>\n\n<pre><code>data A = A1 | A2 | A3\ndata B = B1 A | B2 A\n</code></pre>\n\n<p>I can easily generate a list of all possibilities of B. I want to test all possible permutations, but I still want to use QuickCheck to spit out all the elements of the list where it is applied. In this case, I want to test that a rule is true for all possibilities, so I don't want to generate random data.</p>\n\n<p>Assuming that I already have all possibilities in a list, how can I make QuickCheck output each element of the list exactly once? Giving the same exact set of values each time.</p>\n"}, {"tags": ["haskell", "currying", "type-level-computation", "data-kinds", "higher-rank-types"], "comments": [{"owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "edited": false, "score": 0, "creation_date": 1473186631, "post_id": 39355548, "comment_id": 66041141, "body": "Not sure if type level computation is an appropriate label when &#39;computing&#39; at the type level is not the goal."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 2, "creation_date": 1473187257, "post_id": 39355548, "comment_id": 66041471, "body": "As far as I&#39;m aware, and much to my annoyance, GHC is not yet of the opinion that <code>ab ~ &#39;(Fst ab, Snd ab)</code>, where <code>Fst</code> and <code>Snd</code> are the type-level projections."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1473187301, "post_id": 39355548, "comment_id": 66041499, "body": "Dunno for sure, but at a guess: <a href=\"https://hackage.haskell.org/package/ghc-prim-0.5.0.0/docs/GHC-Prim.html#t:Any\" rel=\"nofollow noreferrer\"><code>Any</code></a> strikes again. (<code>Any :: (*, *)</code> but it is not the case that <code>Any ~ (a, b)</code> for any <code>a</code> and <code>b</code>.)"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 2, "creation_date": 1473187584, "post_id": 39355548, "comment_id": 66041683, "body": "Pardon my ignorance, but what is the purpose of these <code>forward</code> and <code>backward</code> functions? When would you want to use them? They just look like complicated <code>id</code> functions to me."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1473192519, "post_id": 39355548, "comment_id": 66043995, "body": "@AlexisKing: well, logically speaking, any true statement is a tautology... ...seriously though, I could see this as quite useful if you need to \u201cstuff\u201d multiple types into a single functor."}, {"owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1473233733, "post_id": 39355548, "comment_id": 66056563, "body": "@AlexisKing, this kind of problem comes up, for example, when you need to have more than one thing in the cells of an <code>HList</code>. Ideally, we should not have to write a custom <code>HList</code> just to store an extra type, just like we can use value level to store more than one thing at each cell."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 6, "last_activity_date": 1473194013, "last_edit_date": 1473194013, "creation_date": 1473187584, "answer_id": 39355891, "question_id": 39355548, "link": "https://stackoverflow.com/questions/39355548/is-it-possible-to-uncurry-a-forall-quantifier/39355891#39355891", "title": "Is it possible to &#39;uncurry&#39; a forall quantifier?", "body": "<p>The trouble, as pigworker and Daniel Wagner indicate, is that <code>ab</code> may be a \"stuck type\". You can sometimes work around this with type families (as I learned in <a href=\"http://personal.cis.strath.ac.uk/~conor/Kleisli.pdf\" rel=\"nofollow\">one of pigworker's papers</a>):</p>\n\n<pre><code>type family Fst (x :: (k1, k2)) :: k1 where\n  Fst '(t1, t2) = t1\n\ntype family Snd (x :: (k1, k2)) :: k2 where\n  Snd '(t1, t2) = t2\n\nbackward :: forall (f :: (*, *) -&gt; *) (ab :: (*, *)) proxy .\n            proxy ab -&gt;\n            (forall (a :: *) (b :: *). f '(a, b)) -&gt;\n            f '(Fst ab, Snd ab)\nbackward _ x = x\n</code></pre>\n\n<p>Another option, sometimes, is to use wrappers.</p>\n\n<pre><code>newtype Curry f x y = Curry (f '(x,y))\n\ndata Uncurry f xy where\n  Uncurry :: f x y -&gt; f '(x, y)\n</code></pre>\n"}], "owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 1, "accepted_answer_id": 39355891, "answer_count": 1, "score": 4, "last_activity_date": 1473194013, "creation_date": 1473186312, "question_id": 39355548, "link": "https://stackoverflow.com/questions/39355548/is-it-possible-to-uncurry-a-forall-quantifier", "title": "Is it possible to &#39;uncurry&#39; a forall quantifier?", "body": "<p>Suppose we have a type constructor f that takes two types, by means of a DataKinds-promoted pair.</p>\n\n<pre><code>forall (f :: (ka, kb) -&gt; *)\n</code></pre>\n\n<p>I can then implement a function <code>forward</code>, which is like <code>curry</code> for the <code>forall</code> quantifier:</p>\n\n<pre><code>forward :: forall (f :: (ka, kb) -&gt; *).\n           (forall (ab :: (ka, kb)).     f ab) -&gt;\n           (forall (a :: ka) (b :: kb).  f '(a, b))\nforward x = x\n</code></pre>\n\n<p>However, the reverse function is problematic:</p>\n\n<pre><code>backward :: forall (f :: (*, *) -&gt; *).\n            (forall (a :: *) (b :: *). f '(a, b)) -&gt;\n            (forall (ab :: (*, *)). f ab)\nbackward x = x\n</code></pre>\n\n<p>GHC 8.0.1 gives the error message:</p>\n\n<pre>\n    \u2022 Couldn't match type \u2018ab\u2019 with \u2018'(a0, b0)\u2019\n      \u2018ab\u2019 is a rigid type variable bound by\n        the type signature for:\n          backward :: forall (ab :: (*, *)). (forall a b. f '(a, b)) -> f ab\n        at :6:116\n      Expected type: f ab\n        Actual type: f '(a0, b0)\n    \u2022 In the expression: x\n      In an equation for \u2018backward\u2019: backward x = x\n</pre>\n\n<p>Conceptually, it seems like a valid program. Is there another way to implement this function? Or is this a known limitation of GHC?</p>\n"}, {"tags": ["haskell", "memory", "haskell-pipes"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1473182172, "post_id": 39354139, "comment_id": 66038875, "body": "Check out the haskell tag info section and please post how you&#39;re compiling and running your binary"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1473182312, "post_id": 39354139, "comment_id": 66038944, "body": "Because <code>seq (Just undefined) = ()</code> but <code>seq (undefined :: Int) () = undefined</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473186227, "post_id": 39354139, "comment_id": 66040935, "body": "Consider <code>forceMaybe Nothing = Nothing; forceMaybe x@(Just !_) = x</code>."}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1473188743, "post_id": 39354139, "comment_id": 66042269, "body": "Thank you for the comments everyone! If I understand what is being said the issue is due to accumulating the result in a Maybe, and the folding function creating a dependency on, or a reference to, MyRecord values. Until the result of the whole fold is demanded the intermediate values won&#39;t be evaluated beyond a constructor of Maybe causing  MyRecord&#39;s to pile up. deepseq forces anything &quot;hiding&quot; in a Maybe and allows MyRecord&#39;s to be garbage collected. Would that be a fair assessment of what&#39;s happening?"}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1473210331, "post_id": 39354139, "comment_id": 66049355, "body": "By the way, you can use <code>P.sum (pipeline &gt;-&gt; P.map (fromMaybe 0 . fst))</code>."}], "answers": [{"comments": [{"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1473192006, "post_id": 39356085, "comment_id": 66043753, "body": "Thank you @ErikR Am I correct in thinking that a build up of those thunks in the fold accumulator would also <a href=\"http://stackoverflow.com/questions/39354139/understanding-memory-usage-of-this-haskell-program#comment66042269_39354139\">cause  MyRecord&#39;s not to be released</a>?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 1, "creation_date": 1473197064, "post_id": 39356085, "comment_id": 66046016, "body": "Yes, because the summation contains references to your MyRecord values through calls to <code>myRecordField10</code>."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1473188479, "creation_date": 1473188479, "answer_id": 39356085, "question_id": 39354139, "link": "https://stackoverflow.com/questions/39354139/understanding-memory-usage-of-this-haskell-program/39356085#39356085", "title": "Understanding memory usage of this Haskell program", "body": "<p>As mentioned in the <a href=\"https://hackage.haskell.org/package/pipes-4.2.0/docs/Pipes-Prelude.html#v:fold\" rel=\"nofollow\">docs for <code>Pipes.foldl</code></a>, the fold is strict. However,\nthe strictness is <a href=\"https://hackage.haskell.org/package/pipes-4.2.0/docs/src/Pipes-Prelude.html#fold\" rel=\"nofollow\">implemented with <code>$!</code></a> which only forces evaluation\nto WHNF - weak head normal form. WHNF is enough to fully evaluate a simple\ntype like an Int, but it isn't strong enough to completely evaluate a more\ncomplex type like a <code>Maybe Int</code>.</p>\n\n<p>Some examples:</p>\n\n<pre><code>main1 = do\n  let a = 3 + undefined\n      b = seq a 10\n  print b                -- error: Exception: Prelude.undefined\n\nmain2 = do\n  let a = Just (3 + undefined)\n      b = seq a 10\n  print b                -- no exception\n</code></pre>\n\n<p>In the first case the variable <code>acc</code> is a <code>Just</code> of a large thunk - the summation of all of the elements. On each iteration the variable <code>acc</code>\ngoes from <code>Just a</code> to <code>Just (a+b)</code> to <code>Just (a+b+c)</code> etc. The addition\nis not being performed during the fold - it's only being done at the\nvery end. The large memory usage comes from storing this growing summation\nin memory.</p>\n\n<p>In the second case the summation is reduced each iteration by <code>$!</code> to a simple Int.</p>\n\n<p>Besides using <code>deepseq</code> you can also use <code>force</code>:</p>\n\n<pre><code>force x = x `deepseq` x\n</code></pre>\n\n<p>and as <a href=\"http://hackage.haskell.org/package/deepseq-1.4.2.0/docs/Control-DeepSeq.html#v:force\" rel=\"nofollow\">mentioned in the deepseq docs</a>, combined with ViewPatterns you\ncan create an pattern which will fully evaluate a function argument:</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\n\n...\nP.fold\n  (\\(force -&gt; !acc) (v,_) -&gt; (+) &lt;$&gt; acc &lt;*&gt; pure (fromMaybe 0 v))\n  (Just 0)\n  ...\n</code></pre>\n"}], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 39356085, "answer_count": 1, "score": 1, "last_activity_date": 1473188479, "creation_date": 1473180683, "last_edit_date": 1473186394, "question_id": 39354139, "link": "https://stackoverflow.com/questions/39354139/understanding-memory-usage-of-this-haskell-program", "title": "Understanding memory usage of this Haskell program", "body": "<p>I should preface this with saying I'm very much a beginner with Haskell and the pipes library, and I would like to understand what is causing the high memory usage of this program in the <code>test</code> function.</p>\n\n<p>Specifically in the fold that produces <code>r1</code> value in <code>test</code> I'm seeing a build up of MyRecord values until the final result is produced, unless <code>deepseq</code> is used. On my sample data set of ~ 500000 lines / ~ 230 MB the memory usage grows beyond 1.5 GB.</p>\n\n<p>The fold that produces <code>r2</code> value runs in constant memory.</p>\n\n<p>What I would like to understand is:</p>\n\n<p>1) What could be causing the build of MyMemory values in the first fold, and why using <code>deepseq</code> would fix it? I was very much throwing things at it at random until arriving at using <code>deepseq</code> to achieve constant memory usage but would like to understand why it works. Can constant memory usage be achieved without using <code>deepseq</code> while still producing the same result type of Maybe Int?</p>\n\n<p>2). What is different for the second fold causing it not to exhibit the same issue?</p>\n\n<p>I know that if I were to work with just integers instead of a tuples I could use the builtin <code>sum</code> function from Pipes.Prelude but I will eventually want to process the second element that contains any parsing errors.</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nmodule Test where\n\nimport           Control.Arrow\nimport           Control.DeepSeq\nimport           Control.Monad\nimport           Data.Aeson\nimport           Data.Function\nimport           Data.Maybe\nimport           Data.Monoid\nimport           Data.Text (Text)\n\nimport           Pipes\nimport qualified Pipes.Aeson as PA (DecodingError(..))\nimport qualified Pipes.Aeson.Unchecked as PA\nimport qualified Pipes.ByteString as PB\nimport qualified Pipes.Group as PG\nimport qualified Pipes.Parse as PP\nimport qualified Pipes.Prelude as P\n\nimport           System.IO\nimport           Control.Lens\nimport qualified Control.Foldl as Fold\n\ndata MyRecord = MyRecord\n  { myRecordField1 :: !Text\n  , myRecordField2 :: !Int\n  , myRecordField3 :: !Text\n  , myRecordField4 :: !Text\n  , myRecordField5 :: !Text\n  , myRecordField6 :: !Text\n  , myRecordField7 :: !Text\n  , myRecordField8 :: !Text\n  , myRecordField9 :: !Text\n  , myRecordField10 :: !Int\n  , myRecordField11 :: !Text\n  , myRecordField12 :: !Text\n  , myRecordField13 :: !Text\n  } deriving (Eq, Show)\n\ninstance FromJSON MyRecord where\n  parseJSON (Object o) =\n    MyRecord &lt;$&gt; o .: \"field1\" &lt;*&gt; o .: \"field2\" &lt;*&gt; o .: \"field3\" &lt;*&gt;\n    o .: \"field4\" &lt;*&gt;\n    o .: \"field5\" &lt;*&gt;\n    o .: \"filed6\" &lt;*&gt;\n    o .: \"field7\" &lt;*&gt;\n    o .: \"field8\" &lt;*&gt;\n    o .: \"field9\" &lt;*&gt;\n    (read &lt;$&gt; o .: \"field10\") &lt;*&gt;\n    o .: \"field11\" &lt;*&gt;\n    o .: \"field12\" &lt;*&gt;\n    o .: \"field13\"\n  parseJSON x = fail $ \"MyRecord: expected Object, got: \" &lt;&gt; show x\n\ninstance ToJSON MyRecord where\n    toJSON _ = undefined\n\ntest :: IO ()\ntest = do\n  withFile \"some-file\" ReadMode $ \\hIn\n  {-\n\n      the pipeline is composed as follows:\n\n      1 a producer reading a file with Pipes.ByteString, splitting chunks into lines,\n        and parsing the lines as JSON to produce tuples of (Maybe MyRecord, Maybe\n        ByteString), the second element being an error if parsing failed\n\n      2 a pipe filtering that tuple on a field of Maybe MyRecord, passing matching\n        (Maybe MyRecord, Maybe ByteString) downstream\n\n      3 and a pipe that picks an Int field out of Maybe MyRecord, passing (Maybe Int,\n        Maybe ByteString downstream)\n\n      pipeline == 1 &gt;-&gt; 2 &gt;-&gt; 3\n\n      memory profiling indicates the memory build up is due to accumulation of\n      MyRecord \"objects\", and data types comprising their fields (mainly\n      Text/ARR_WORDS)\n\n  -}\n   -&gt; do\n    let pipeline = f1 hIn &gt;-&gt; f2 &gt;-&gt; f3\n    -- need to use deepseq to avoid leaking memory\n    r1 &lt;-\n      P.fold\n        (\\acc (v, _) -&gt; (+) &lt;$&gt; acc `deepseq` acc &lt;*&gt; pure (fromMaybe 0 v))\n        (Just 0)\n        id\n        (pipeline :: Producer (Maybe Int, Maybe PB.ByteString) IO ())\n    print r1\n    hSeek hIn AbsoluteSeek 0\n    -- this works just fine as is and streams in constant memory\n    r2 &lt;-\n      P.fold\n        (\\acc v -&gt;\n           case fst v of\n             Just x -&gt; acc + x\n             Nothing -&gt; acc)\n        0\n        id\n        (pipeline :: Producer (Maybe Int, Maybe PB.ByteString) IO ())\n    print r2\n    return ()\n  return ()\n\nf1\n  :: (FromJSON a, MonadIO m)\n  =&gt; Handle -&gt; Producer (Maybe a, Maybe PB.ByteString) m ()\nf1 hIn = PB.fromHandle hIn &amp; asLines &amp; resumingParser PA.decode\n\nf2\n  :: Pipe (Maybe MyRecord, Maybe PB.ByteString) (Maybe MyRecord, Maybe PB.ByteString) IO r\nf2 = filterRecords ((\"some value\" ==) . myRecordField5)\n\nf3 :: Pipe (Maybe MyRecord, d) (Maybe Int, d) IO r\nf3 = P.map (first (fmap myRecordField10))\n\nfilterRecords\n  :: Monad m\n  =&gt; (MyRecord -&gt; Bool)\n  -&gt; Pipe (Maybe MyRecord, Maybe PB.ByteString) (Maybe MyRecord, Maybe PB.ByteString) m r\nfilterRecords predicate =\n  for cat $ \\(l, e) -&gt;\n    when (isNothing l || (predicate &lt;$&gt; l) == Just True) $ yield (l, e)\n\nasLines\n  :: Monad m\n  =&gt; Producer PB.ByteString m x -&gt; Producer PB.ByteString m x\nasLines p = Fold.purely PG.folds Fold.mconcat (view PB.lines p)\n\nparseRecords\n  :: (Monad m, FromJSON a, ToJSON a)\n  =&gt; Producer PB.ByteString m r\n  -&gt; Producer a m (Either (PA.DecodingError, Producer PB.ByteString m r) r)\nparseRecords = view PA.decoded\n\nresumingParser\n  :: Monad m\n  =&gt; PP.StateT (Producer a m r) m (Maybe (Either e b))\n  -&gt; Producer a m r\n  -&gt; Producer (Maybe b, Maybe a) m ()\nresumingParser parser p = do\n  (x, p') &lt;- lift $ PP.runStateT parser p\n  case x of\n    Nothing -&gt; return ()\n    Just (Left _) -&gt; do\n      (x', p'') &lt;- lift $ PP.runStateT PP.draw p'\n      yield (Nothing, x')\n      resumingParser parser p''\n    Just (Right b) -&gt; do\n      yield (Just b, Nothing)\n      resumingParser parser p'\n</code></pre>\n"}, {"tags": ["haskell", "ghcjs"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473182062, "post_id": 39354041, "comment_id": 66038809, "body": "Could you <code>grep -r</code> the GHCJS source searching for the JS time primitive?"}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473183242, "post_id": 39354041, "comment_id": 66039455, "body": "@dfeuer I&#39;ve added the results. I think that it might not be <code>getTime</code> that gets used by GHCJS. Although that seems that the obvious choice for POSIX time."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473183521, "post_id": 39354041, "comment_id": 66039617, "body": "Ah, it&#39;s actually <code>Date.now</code>. I&#39;ll add the source I found."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473185871, "post_id": 39354041, "comment_id": 66040754, "body": "It looks more like a primitive than something &quot;linked in&quot;, so you might check the code generator. That <code>h$</code> could even be a special pattern it looks for. I could be wrong though!"}, {"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "edited": false, "score": 1, "creation_date": 1473220011, "post_id": 39354041, "comment_id": 66051127, "body": "I discovered <code>h$gettimeofday</code> in shims <code>src&#47;environment.js</code> <a href=\"https://github.com/ghcjs/shims/blob/master/src/environment.js#L243\" rel=\"nofollow noreferrer\">github.com/ghcjs/shims/blob/master/src/environment.js#L243</a>"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 146, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1473183582, "creation_date": 1473180310, "last_edit_date": 1473183582, "question_id": 39354041, "link": "https://stackoverflow.com/questions/39354041/how-does-getcurrenttime-work-under-ghcjs", "title": "How does getCurrentTime work under GHCJS?", "body": "<p>Under GHCJS, how does <code>getCurrentTime</code> work? In the <code>time</code> library itself, this is <a href=\"https://github.com/haskell/time/blob/1b74336b646b6bd3e36eee3efa00f41b915f02c7/lib/Data/Time/Clock/CTimespec.hsc\" rel=\"nofollow\">implemented using the FFI</a>, calling out to functions provided by the operating system. However, there aren't any lines in <code>time</code> that start with:</p>\n\n<pre><code>foreign import javascript ...\n</code></pre>\n\n<p>I've checked the <code>shims</code> repository that GHCJS using to patch libraries. It <a href=\"https://github.com/ghcjs/shims/blob/570494fe9ff9278ec1e5df01c450bd19e7d0adcc/pkg/time.js\" rel=\"nofollow\">patches the timezone getting function</a> but has no mention of <code>getCurrentTime</code>. The only thing I found that was remotely close was in <code>ghcjs-boot</code>, where <code>old-time</code> is patched with an:</p>\n\n<pre><code>#ifdef ghcjs_HOST_OS\ntype CTimeVal = ()\ntype CTimeZone = ()\n...\nforeign import ccall unsafe \"HsTime.h __hscore_gettimeofday\"\n    gettimeofday :: Ptr CTimeVal -&gt; Ptr CTimeZone -&gt; IO CInt\n...\n</code></pre>\n\n<p>But there are two problems with this. One is that it's not the right library (<code>old-time</code> instead of <code>time</code>). The other is that it's still using the C FFI. I don't understand how the using the C FFI can work when you are compiling with GHCJS.</p>\n\n<p>So, where does <code>getCurrentTime</code> get shimmed in for GHCJS?</p>\n\n<p>In response to the comment about grepping ghcjs source, if I search for <code>getTime</code> (which I believe would be the javascript function used) in GHCJS's source, I get basically nothing. However, by grepping an <code>all.js</code> file produced by GHCJS for a project that uses <code>getCurrentTime</code>, I get this:</p>\n\n<pre><code>ag '\\bgetTime\\b' all.js\n20948:  h$log(((\"elapsed time: \" + (h$RTS_597.getTime() - h$RTS_595.getTime())) + \"ms\"));\n22863:                var atime = goog.math.Long.fromNumber(fs.atime.getTime());\n22864:                var mtime = goog.math.Long.fromNumber(fs.mtime.getTime());\n22865:                var ctime = goog.math.Long.fromNumber(fs.ctime.getTime());\n</code></pre>\n\n<p>The latter three are from some kind of filesystem shim.</p>\n\n<p>I found this in the generated javascript:</p>\n\n<pre><code>function h$gettimeofday(tv_v,tv_o,tz_v,tz_o) {\n  var now = Date.now();\n  tv_v.dv.setInt32(tv_o, (now / 1000)|0, true);\n  tv_v.dv.setInt32(tv_o + 4, ((now % 1000) * 1000)|0, true);\n  if(tv_v.len &gt;= tv_o + 12) {\n    tv_v.dv.setInt32(tv_o + 8, ((now % 1000) * 1000)|0, true);\n  }\n  return 0;\n}\n</code></pre>\n\n<p>But the question of how this got linked in remains.</p>\n"}, {"tags": ["c", "haskell", "segmentation-fault", "z3"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1473177650, "post_id": 39353100, "comment_id": 66036438, "body": "I would open a bug report in the haskell package, and let them deal with upstream if there&#39;s an issue"}, {"owner": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1473192209, "post_id": 39353100, "comment_id": 66043850, "body": "I&#39;ve done that: <a href=\"https://bitbucket.org/iago/z3-haskell/issues/12/possible-error-in-package\" rel=\"nofollow noreferrer\">bitbucket.org/iago/z3-haskell/issues/12/&hellip;</a> If iago replies there, and not here, I&#39;ll post an update."}], "answers": [{"comments": [{"owner": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "edited": false, "score": 0, "creation_date": 1473193135, "post_id": 39357007, "comment_id": 66044277, "body": "Sorry about that error- I had to reindent everything after copying and pasting to SO, and messed up that section (it&#39;s now fixed.) We do have different versions of ghc (I&#39;m on 8.0.1) and z3 (I&#39;m on 4.4.2.)  Same version of the z3 haskell package though. Did you run it with 0 to 70 (or some other larger number), and just cut down your output? I don&#39;t get the segment fault error when I use just [0..9]."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "edited": false, "score": 0, "creation_date": 1473194479, "post_id": 39357007, "comment_id": 66044878, "body": "I ran with 0..70, just your code with the indentation fixed."}, {"owner": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "edited": false, "score": 0, "creation_date": 1473194938, "post_id": 39357007, "comment_id": 66045089, "body": "Alright, well thanks for looking at it anyway.  I&#39;m inclined to doubt it has to do with ghc, but I&#39;ll see if I can give it a shot with 7.10.3, just in case."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "edited": false, "score": 0, "creation_date": 1473196062, "post_id": 39357007, "comment_id": 66045587, "body": "@Bill I have tried with GHC 8.0.1 and Z3 4.3.2 (commit <code>79326e24dfb9dff723d1ce64b3f50bcf394bd48c</code>).  I can not reproduce your issue."}, {"owner": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "edited": false, "score": 0, "creation_date": 1473207851, "post_id": 39357007, "comment_id": 66048902, "body": "Thanks for the information.  I&#39;ll try reinstalling and see what happens..."}, {"owner": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "edited": false, "score": 0, "creation_date": 1473208936, "post_id": 39357007, "comment_id": 66049119, "body": "Still not working after reinstalling, unfortunately."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "edited": false, "score": 0, "creation_date": 1473218714, "post_id": 39357007, "comment_id": 66050860, "body": "@Bill. Not much more I can do from here. If you&#39;re willing to put together a simple vagrant file that can reproduce the issue then I&#39;d likely check it out, but without an ability to reproduce seems unlikely even the z3 maintainers will get anywhere."}, {"owner": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "edited": false, "score": 0, "creation_date": 1473219496, "post_id": 39357007, "comment_id": 66051023, "body": "Yeah, I understand, didn&#39;t expect you to be able to help at this point.  I&#39;m not sure how to use Vagrant, but I&#39;ll look into it."}, {"owner": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "edited": false, "score": 0, "creation_date": 1473220735, "post_id": 39357007, "comment_id": 66051266, "body": "So it appears something was wrong with the way z3 was setup.  I just rebuilt it, and everything works perfectly now.  So I guess if you&#39;re getting a similar error, try that.  Thanks for looking at this, Thomas."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1473196017, "last_edit_date": 1473196017, "creation_date": 1473192334, "answer_id": 39357007, "question_id": 39353100, "link": "https://stackoverflow.com/questions/39353100/segmentation-fault-with-haskell-z3-api/39357007#39357007", "title": "Segmentation fault with Haskell Z3 api", "body": "<p>I see there is one spacing issue in the code you pasted (the alignment of <code>do</code>).  Please ensure that this is otherwise the code causing your issue.</p>\n\n<p>I am unable to reproduce your issue:</p>\n\n<pre><code>% ghc so.hs -fforce-recomp &amp;&amp; ./so 2&gt;&amp;1 | tail ; ghc --version ; z3 -version\n[1 of 1] Compiling Main             ( so.hs, so.o )\nLinking so ...\nSat\nSat\nSat\nSat\nSat\nSat\nSat\nSat\nSat\n[]\nThe Glorious Glasgow Haskell Compilation System, version 7.10.3\nZ3 version 4.4.1\n</code></pre>\n\n<p>Oh, and:</p>\n\n<pre><code>% ghc-pkg list z3\n   z3-4.1.0\n</code></pre>\n\n<p>EDIT: Matching GHC and Z3 versions and I still can not reproduce the issue:</p>\n\n<pre><code>% LD_LIBRARY_PATH=$HOME/lib ghc so.hs -fforce-recomp &amp;&amp; LD_LIBRARY_PATH=$HOME/lib ./so 2&gt;&amp;1 | tail ; ghc --version ; z3 -version\n[1 of 1] Compiling Main             ( so.hs, so.o )\nLinking so ...\nSat\nSat\nSat\nSat\nSat\nSat\nSat\nSat\nSat\n[]\nThe Glorious Glasgow Haskell Compilation System, version 8.0.1\nZ3 version 4.3.2\n</code></pre>\n"}], "owner": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1473196017, "creation_date": 1473176989, "last_edit_date": 1473193204, "question_id": 39353100, "link": "https://stackoverflow.com/questions/39353100/segmentation-fault-with-haskell-z3-api", "title": "Segmentation fault with Haskell Z3 api", "body": "<p>I'm using Haskell with this Z3 package, which closely mirrors (and makes use of, via Haskell's foreign function interface) the C api: <a href=\"https://hackage.haskell.org/package/z3\" rel=\"nofollow\">https://hackage.haskell.org/package/z3</a></p>\n\n<p>I'm getting a segmentation fault, and have managed to reduce it to the following: </p>\n\n<pre><code>mainx = do\n    print =&lt;&lt; intCheck [0..70]\n\nintCheck :: [Int] -&gt; IO [Int]\nintCheck [] = return []\nintCheck (x:xs) = \n    do\n        checking &lt;- evalZ3 $ checkImpact x\n        print checking\n        return =&lt;&lt; intCheck xs\n\ncheckImpact :: Int -&gt; Z3 Result\ncheckImpact r  = do\n    reset\n\n    xSymb &lt;- mkStringSymbol \"x\"\n    x &lt;- mkConst xSymb  =&lt;&lt; mkIntSort\n    trace (\"asserting = \" ++ show r) assert =&lt;&lt; mkEq x x\n\n    solverCheck\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>asserting = 0\nSat\nasserting = 1\nSat\nasserting = 2\nSat\n...[omitted]\nasserting = 45\nSat\nasserting = 46\nSegmentation fault: 11\n</code></pre>\n\n<p>Usually, the last asserting is somewhere around 46, but it does vary between executions.  My best guess is that memory is not being freed properly (I can't figure out why it would halt at slightly different points otherwise), but I'm unsure if it's a problem with my recursion (in intCheck), or with the z3 api.</p>\n\n<p>Thanks in advance for any help!</p>\n"}, {"tags": ["haskell", "dll", "cabal", "awesomium"], "answers": [{"tags": [], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "is_accepted": true, "score": 2, "last_activity_date": 1473365891, "creation_date": 1473365891, "answer_id": 39399504, "question_id": 39352795, "link": "https://stackoverflow.com/questions/39352795/runtime-dll-issues-with-haskell-and-awesomium/39399504#39399504", "title": "Runtime DLL issues with Haskell and Awesomium", "body": "<p>I eventually managed to solve it on my own. Turns out I was trying to link to a more recent version of the Awesomium SDK.</p>\n\n<p>Having downgraded to Awesomium 1.6.5 and replaced the DLLs in my build folder with the older ones, I am now able to initialise the <code>WebCore</code> and create <code>WebViews</code>.</p>\n\n<p>Unfortunately, I still haven't been able to render any HTML (stuck on loading), but that's for another question...</p>\n"}], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 1, "accepted_answer_id": 39399504, "answer_count": 1, "score": 6, "last_activity_date": 1473365891, "creation_date": 1473175923, "question_id": 39352795, "link": "https://stackoverflow.com/questions/39352795/runtime-dll-issues-with-haskell-and-awesomium", "title": "Runtime DLL issues with Haskell and Awesomium", "body": "<p>I am trying to run a Haskell program that depends on the <a href=\"http://www.awesomium.com/\" rel=\"noreferrer\">Awesomium</a> library. I've compiled it but ran into the following issue at runtime:</p>\n\n<p><a href=\"https://i.stack.imgur.com/irSNh.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/irSNh.png\" alt=\"Cannot find procedure start address...\"></a></p>\n\n<p>Roughly translated, it says that the procedure start address for awe_history_entry_get_visit_count cannot be found in the DLL file [path to my executable].</p>\n\n<p>It seems like it is trying to load that symbol from my program rather than <code>awesomium.dll</code>.</p>\n\n<ul>\n<li>I'm on Windows 10</li>\n<li>I'm using <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"noreferrer\">stack</a> as my build tool</li>\n<li>The program is 32-bit (i386), because that is the only architecture Awesomium supports</li>\n<li>I've referenced the DLLs I need in the <code>extra-libraries</code> field in the <code>.cabal</code> file</li>\n</ul>\n\n<p>Any help or hints will be much appreciated.</p>\n"}, {"tags": ["haskell", "machine-learning", "functional-programming", "nearest-neighbor"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1473177124, "post_id": 39352792, "comment_id": 66036111, "body": "It sounds like you&#39;re starting at the problem from the wrong end. Can you post some type signatures of some actual <code>classify</code> and <code>train</code> functions for the various classifiers you plan on creating? Then it will probably be obvious if, why and how to abstract things"}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1473182441, "post_id": 39353858, "comment_id": 66039001, "body": "A classifier that can work with every type of samples and labels is probably too generic to be useful."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1473182812, "post_id": 39353858, "comment_id": 66039196, "body": "Yeah, I suspect a type family (or multiparameter type class with functional dependencies) to constrain the sample and label types that can be used with a given classifier would be better, but I don&#39;t know the domain well enough to provide a suggestion. This at least works with <code>KNN</code> as defined."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1473181698, "last_edit_date": 1473181698, "creation_date": 1473179626, "answer_id": 39353858, "question_id": 39352792, "link": "https://stackoverflow.com/questions/39352792/haskell-polymorphism-and-typeclass-instance/39353858#39353858", "title": "Haskell polymorphism and typeclass instance", "body": "<p>Assuming your type class has no knowledge of what a classifier provides, you could do something like</p>\n\n<pre><code>class Classifier c where\n  train :: [x] -&gt; [y] -&gt; c -&gt; [(x,y)]\n  classify :: [(x,y)] -&gt; c -&gt; x &gt; y\n</code></pre>\n\n<p>Here, <code>train</code> is getting a list of samples of type <code>x</code>, a list of labels of type <code>y</code>, and a classifier of some type <code>c</code>, and needs to return a list of sample/label pairs.</p>\n\n<p><code>classify</code> takes a list of sample/label pairs (such as that produced by <code>train</code>), the classifier, and a sample, and produces a new label.</p>\n\n<p>(At the very least, though, I'd probably replace <code>[(x,y)]</code> with something like <code>Map x y</code>.)</p>\n\n<p>The key is that the classifier itself needs to be used by both <code>train</code> and <code>classify</code>, although you don't need to know what that would look like at this time.</p>\n\n<p>Your instance for <code>KNN</code> could then look like</p>\n\n<pre><code>instance Classifier KNN where\n\n  train samples labels (KNN n f) = ...\n  classify td (KNN n f) sample = ...\n</code></pre>\n\n<p>Here, <code>n</code> and <code>f</code> can be used both to create the training data, and to help pick the closest member of the training data for a sample point.</p>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 4, "last_activity_date": 1473184631, "creation_date": 1473184631, "answer_id": 39355130, "question_id": 39352792, "link": "https://stackoverflow.com/questions/39352792/haskell-polymorphism-and-typeclass-instance/39355130#39355130", "title": "Haskell polymorphism and typeclass instance", "body": "<p>I would say you need multi-parameter type classes (with optional functional dependencies, or type families; I omit those). </p>\n\n<pre><code> class Classifier c s l  k where\n      train :: c -&gt; [(s, l)] -&gt; k\n      classify :: c -&gt; k -&gt; s -&gt; l\n      combine :: c -&gt; k -&gt; k -&gt; k\n</code></pre>\n\n<p>There is a four-sided relationship between classifier, sample, label and knowledge types.</p>\n\n<p>The train method derives some knowledge (k) from a set of sample (s) \u2014 label (l) pairs. The classify method uses that knowledge to infer a label for a sample. (The combine method joins two pieces of knowledge together; don't know if it always applies).</p>\n"}], "owner": {"reputation": 771, "user_id": 2580829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86a03824702b97d544f00fac4f2cb307?s=128&d=identicon&r=PG&f=1", "display_name": "David Barda", "link": "https://stackoverflow.com/users/2580829/david-barda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 39355130, "answer_count": 2, "score": 2, "last_activity_date": 1473184631, "creation_date": 1473175915, "question_id": 39352792, "link": "https://stackoverflow.com/questions/39352792/haskell-polymorphism-and-typeclass-instance", "title": "Haskell polymorphism and typeclass instance", "body": "<p>I am trying to write a machine learning library in Haskell, to work on my Haskell skills. \nI thought about a general design involving a class which is like so:</p>\n\n<pre><code>  class Classifier classifier where\n    train :: X -&gt; y -&gt; trainingData\n    classify :: trainingData -&gt; x -&gt; y\n</code></pre>\n\n<p>For example, given a set of examples X, and their true labels y, train returns\ntrainingData which is used in the classify function. </p>\n\n<p>So, if I want to implement KNN, I would do it like so:</p>\n\n<pre><code>data KNN = KNN Int (Int -&gt; Int -&gt; Float) \n</code></pre>\n\n<p>Where the first int is the number of neighbors and the function its the metric that calculate the distance between the vectors</p>\n\n<pre><code>  instance Classifier KNN where\n---This is where I am stuck---\n</code></pre>\n\n<p>How can I implement the Classifier type class function so they would be generic\nto all of the classifier that I will create?\nI am feeling like I am treating Haskell too much like an imperative \nOOP like language and I'd like to do this the Haskell way.</p>\n"}, {"tags": ["haskell", "pdf", "character-encoding"], "answers": [{"tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 1, "last_activity_date": 1473163285, "last_edit_date": 1473163285, "creation_date": 1473162650, "answer_id": 39348371, "question_id": 39347808, "link": "https://stackoverflow.com/questions/39347808/howto-encode-special-characters-with-haskell-pdf-easyrender-package/39348371#39348371", "title": "Howto encode special characters with haskell PDF EasyRender package?", "body": "<p>Each PDF font has its own encoding, and usually PDF files has them embedded together with encoding information. <code>easyrender</code> doesn't embed fonts, it uses standard PDF fonts, that are deprecated.</p>\n\n<p>AFAIU, <code>Helverica</code> uses the <code>StandardEncoding</code> (see PDF reference for details), and it doesn't contain <code>\u00e4</code> character. So I don't think you can non-ASCII characters with <code>easyrender</code>.</p>\n\n<p>To confirm, try to draw a string with byte (octal) <code>341</code> (and also <code>256</code> and <code>306</code> in case it uses <code>MacRomanEncoding</code> or <code>WinAnsiEncoding</code>), it should represent character <code>\u00c6</code>.</p>\n\n<p>ADDED: Character <code>\u00e4</code> in UTF8 is <a href=\"http://www.fileformat.info/info/unicode/char/00e4/index.htm\" rel=\"nofollow\">represented</a> as two bytes, <code>303</code> and <code>244</code>. In the <code>StandardEncoding</code> they represent <code>\u02c6</code> and <code>\u2044</code> -- exactly what you see in the first output. Not sure where <code>\u00b4</code> comes from in the second one.</p>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1473165607, "creation_date": 1473165607, "answer_id": 39349245, "question_id": 39347808, "link": "https://stackoverflow.com/questions/39347808/howto-encode-special-characters-with-haskell-pdf-easyrender-package/39349245#39349245", "title": "Howto encode special characters with haskell PDF EasyRender package?", "body": "<p>There are two issues:</p>\n\n<ol>\n<li>Re-encoding a standard font like Helvetica to be able to \"show\" characters in the range 128-255.</li>\n<li>Representing characters 128-255 in a Postscript string.</li>\n</ol>\n\n<p>The first is covered in Section 5.9.1 of the <a href=\"https://www.adobe.com/products/postscript/pdfs/PLRM.pdf\" rel=\"nofollow\">Postscript Language Reference</a>, page 349. Another reference is <a href=\"http://apps.jcns.fz-juelich.de/doku/sc/ps-latin\" rel=\"nofollow\">http://apps.jcns.fz-juelich.de/doku/sc/ps-latin</a></p>\n\n<p>The second is a deficiency with the easyrender library. One way to represent the character \u00c4 (capital A with an umlaut) is via the octal\nescape <code>\\304</code>. That is, in the Postscript file you need to have:</p>\n\n<pre><code>(\\304) show\n</code></pre>\n\n<p>However, looking at the library's source code, the function <code>ps_escape</code> is incapable of producing octal escape codes for characters in the range 128-255.</p>\n\n<p>Another way to solve this problem is to emit the generated Postscript in the Latin1 encoding:</p>\n\n<pre><code>import System.IO\n...\n\nmain = do\n  let doc = newpage_defer $ do\n    ...\n  let output = render_string Format_PDF doc\n  hSetEncoding stdout latin1\n  putStr output\n</code></pre>\n\n<p>Putting these two ideas together:</p>\n\n<pre><code>import Graphics.EasyRender\nimport System.IO\n\nreencode_fonts = \" /Helvetica findfont dup length dict begin { 1 index /FID ne {def} {pop pop} ifelse } forall /Encoding ISOLatin1Encoding def currentdict end /Helvetica exch definefont pop\"\n\nmy_custom = custom { ps_defs = reencode_fonts }\n\ndocument = newpage_defer $ do\n  textbox align_left (Font Helvetica 12) (Color_Gray 0) 10 100 100 100 0 myStr\n  endpage 500 500\n\nmyStr :: String\nmyStr =  \"test text \u00e4\"\n\nout = render_custom_string Format_PS my_custom document\n\nmain = do\n  hSetEncoding stdout latin1\n  putStr out\n</code></pre>\n"}], "owner": {"reputation": 391, "user_id": 480146, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bfe2f5f477cb68954d1aed04194485f1?s=128&d=identicon&r=PG", "display_name": "agreif", "link": "https://stackoverflow.com/users/480146/agreif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 39348371, "answer_count": 2, "score": 2, "last_activity_date": 1473165607, "creation_date": 1473160799, "question_id": 39347808, "link": "https://stackoverflow.com/questions/39347808/howto-encode-special-characters-with-haskell-pdf-easyrender-package", "title": "Howto encode special characters with haskell PDF EasyRender package?", "body": "<p>I am using the Graphics.EasyRender haskell package to render PDF files.\nEverything is fine with normal ascii characters, but I get encoding problems when using for example German Umlauts like \u00f6\u00e4\u00fc\u00df or french chars like \u00e9\u00e8 etc.</p>\n\n<pre><code>let document = newpage_defer $ do\n  textbox align_left (Font Helvetica 12) (Color_Gray 0) 10 100 100 100 0 myStr\n\nmyStr :: String\nmyStr =  \"test text \u00e4\"\n</code></pre>\n\n<p>the output is</p>\n\n<pre><code>test text \u02c6\u2044\n</code></pre>\n\n<p>I also tried to encode UTF8, but then it gets worse:</p>\n\n<pre><code>test text \u02c6\u00b4\u2044\n</code></pre>\n\n<p>As a test I also tries to generate postcript output from the EasyRender package, but there I have the same problems.</p>\n\n<p>PDF is my main concern, any Idea how use these Umlauts in the target PDF?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack", "ghc-mod"], "answers": [{"tags": [], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "is_accepted": false, "score": 0, "last_activity_date": 1473198015, "creation_date": 1473198015, "answer_id": 39358252, "question_id": 39344230, "link": "https://stackoverflow.com/questions/39344230/multiple-installations-of-ghc-mod/39358252#39358252", "title": "Multiple installations of ghc-mod", "body": "<p>Cabal installs to ~\\cabal\\bin and stack installs to both ~\\48375d44\\bin and ~\\local\\bin. </p>\n"}], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473198015, "creation_date": 1473150716, "question_id": 39344230, "link": "https://stackoverflow.com/questions/39344230/multiple-installations-of-ghc-mod", "title": "Multiple installations of ghc-mod", "body": "<p>I have noticed I have 3 sets of ghc-mod.exe, ghc-modi.exe etc on my computer. The first one I suspect was created with stack. It is in </p>\n\n<blockquote>\n  <p>c:\\users\\myname\\appdata\\roaming\\local\\bin</p>\n</blockquote>\n\n<p>The 2nd one I think was created with cabal and is in </p>\n\n<blockquote>\n  <p>c:\\users\\myname\\appdata\\roaming\\cabal\\bin</p>\n</blockquote>\n\n<p>and the 3rd one again I suspect was created with stack. It is in </p>\n\n<blockquote>\n  <p>C:\\stack_root\\snapshots\\48375d44\\bin</p>\n</blockquote>\n\n<p>. At the moment my PATH is pointing to all 3 however I have renamed ghc-modi.exe and ghc-mod.exe in 2 folders and left version 5.6.0.0 in ~\\roaming\\cabal\\bin unchanged. The whole thing is somewhat confusing and I suspect unnecessary. Do I need all 3 versions? How can I clean it up?</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1473157930, "post_id": 39344161, "comment_id": 66023089, "body": "The last one is, I think, equivalent to <code>type API2 = TypeError ...</code>. I argue that this <i>should</i> compile, otherwise either 1) no code with a <code>TypeError</code> could type check, or 2) we can no longer substitute aliases and get equivalent programs (<code>type E = TypeError ... ; type X = If .. .. E</code> should be equivalent to <code>type X = if .. .. (TypeError ..)</code>, when <code>E</code> is not used later on). Note that I&#39;m only guessing here -- I&#39;m not an expert on how these type errors actually work."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1473162615, "post_id": 39344161, "comment_id": 66026253, "body": "I would say that restricting the set of status codes is not a great idea. The HTTP designers intended the status codes to be extensible and there are plenty of non-standard status codes out there (eg WebDAV). By restricting said codes you&#39;re making it impossible for users of your library to integrate with systems which use status codes you didn&#39;t anticipate. In the real world people need to be able to do that sort of thing."}, {"owner": {"reputation": 1361, "user_id": 2556165, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/fGy2y.jpg?s=128&g=1", "display_name": "wowofbob", "link": "https://stackoverflow.com/users/2556165/wowofbob"}, "edited": false, "score": 1, "creation_date": 1473162615, "post_id": 39344161, "comment_id": 66026254, "body": "You can encode all required codes like <code>type HttpStatusCodeOK = (200 :: Nat)</code> and then supply them into <code>Get</code>. This approach doesn&#39;t catch attempts to supply wrong codes but it documents the valid ones."}, {"owner": {"reputation": 5397, "user_id": 1149074, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/2Bm6Y.jpg?s=128&g=1", "display_name": "shock_one", "link": "https://stackoverflow.com/users/1149074/shock-one"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1473162830, "post_id": 39344161, "comment_id": 66026406, "body": "@BenjaminHodgson if the constraint was imposed by, say, type classes, it&#39;d be open for extension. You&#39;d just have to create an <code>IsStatusCode</code> instance for your custom code."}, {"owner": {"reputation": 807, "user_id": 1278218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc600c707e4f698ad2e6d0a1b9d9f119?s=128&d=identicon&r=PG", "display_name": "erdeszt", "link": "https://stackoverflow.com/users/1278218/erdeszt"}, "edited": false, "score": 0, "creation_date": 1473170684, "post_id": 39344161, "comment_id": 66031758, "body": "If you want to go crazy on the type level magic then this paper: <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow noreferrer\">personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf</a> defines type level less than/greater than operations."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1473394536, "post_id": 39344161, "comment_id": 66132929, "body": "I don&#39;t think your <code>DatatypeContexts</code> solution works the way you think it does: the constraints are simply tacked on when trying to use any of its constructors, so <code>undefined :: Get 999</code> compiles just fine. That said, I am very confused as to why the last example even needs a value of the type... I would&#39;ve expected <code>api  = undefined</code> to return a type error too. My gut feeling is that this is an error..."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1473394880, "post_id": 39344161, "comment_id": 66133020, "body": "Regarding my previous comment, <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11990#comment:7\" rel=\"nofollow noreferrer\">this</a> example seems to suggest this is a bug..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473486428, "post_id": 39344161, "comment_id": 66170369, "body": "I&#39;m thinking in GHC 8 you can probably do this with <code>TypeInType</code>, since you can promote GADTs."}, {"owner": {"reputation": 5397, "user_id": 1149074, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/2Bm6Y.jpg?s=128&g=1", "display_name": "shock_one", "link": "https://stackoverflow.com/users/1149074/shock-one"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473500254, "post_id": 39344161, "comment_id": 66173428, "body": "@dfeuer, I tried that too and got an error about an illegal constraint in a promoted constructor."}, {"owner": {"reputation": 5397, "user_id": 1149074, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/2Bm6Y.jpg?s=128&g=1", "display_name": "shock_one", "link": "https://stackoverflow.com/users/1149074/shock-one"}, "edited": false, "score": 0, "creation_date": 1473500391, "post_id": 39344161, "comment_id": 66173464, "body": "There are also constraints in kinds, which look promising, but I could make it work either. <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#constraints-in-kinds\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/users_guide/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1473925484, "creation_date": 1473925484, "answer_id": 39505576, "question_id": 39344161, "link": "https://stackoverflow.com/questions/39344161/how-to-add-a-constraint-to-a-type-constructor/39505576#39505576", "title": "How To Add a Constraint to a Type Constructor", "body": "<p>I'll start with a solution, then discuss the other possibilities (which appear to not have panned out):</p>\n\n<pre><code>{-# LANGUAGE TypeOperators, TypeInType, GADTs #-}\n\nimport GHC.TypeLits (Nat, type (&lt;=))\nimport Data.Proxy (Proxy(..))\nimport Data.Kind (type (*))\n\ndata Get (statusCode :: Nat) :: (statusCode &lt;= 600) =&gt; *\n\ntype API1 = Get 900 -- compiles\ntype API2 = Get 200 -- compiles\n\napi1 :: Proxy (Get 900) -- doesn't compile\napi1 = Proxy\n\napi2 :: Proxy (Get 200) -- compiles\napi2 = Proxy\n</code></pre>\n\n<p>No type families needed, no need to ever drop down to the value level. The type synonyms, however, will compile just fine. <em>Using</em> a type synonym of an invalid <code>Get</code> will lead to a compile time crash at the usage site. I reckon this is as good a solution as you can hope for. Please let me know if anything is unclear.</p>\n\n<hr>\n\n<p>Next, just some thoughts on the other approaches:</p>\n\n<h3><code>DatatypeContexts</code></h3>\n\n<p>This one will never work: besides being deprecated, all this does is add the constraint to constructors. You specifically indicated you <em>don't</em> want to have to construct anything of the type, so this is pointless. The new GADT syntax fixes this ambiguity - the constraints are now clearly bound to the data or type constructors.</p>\n\n<h3>Type Families and <code>TypeError</code></h3>\n\n<p>I believe this should work, and without having to construct a value of the type. (So the following should be fine:)</p>\n\n<pre><code>data Get' (statusCode :: Nat)\n\ntype family Get x where\n  Get x = If (x &lt;=? 600) (Get' x) (TypeError (Text \"Invalid Code\"))\n\napi2 :: Proxy (Get 200) -- should compile.\napi2 = Proxy\n\napi1 :: Proxy (Get 999) -- shouldn't compile, but currently does\napi1 = Proxy\n</code></pre>\n\n<p>I am motivated to believe this should work based on the <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11990#comment:7\" rel=\"nofollow\">example</a> in this trac ticker. Something here is clearly not behaving as it should: even if I replace the call to the type function <code>If</code> with the <code>TypeError</code> itself, still nothing gets triggered - it appears that <code>TypeErrors</code> that aren't top-level still cause some problems.</p>\n\n<p>On the other hand, I am really unsure what the behaviour of <code>TypeError</code> in <code>type</code> synonyms <em>should</em> be, although I'm inclined to say that <code>type API1 = Get 999</code> should not compile, since <code>type API1 = TypeError (Text \"error\")</code> doesn't. </p>\n"}], "owner": {"reputation": 5397, "user_id": 1149074, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/2Bm6Y.jpg?s=128&g=1", "display_name": "shock_one", "link": "https://stackoverflow.com/users/1149074/shock-one"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 3, "answer_count": 1, "score": 17, "last_activity_date": 1473925484, "creation_date": 1473150539, "last_edit_date": 1473154501, "question_id": 39344161, "link": "https://stackoverflow.com/questions/39344161/how-to-add-a-constraint-to-a-type-constructor", "title": "How To Add a Constraint to a Type Constructor", "body": "<p>Consider the following data type:</p>\n\n<pre><code>data Get (statusCode :: Nat)\n</code></pre>\n\n<p>Actually, it's a simplified <a href=\"https://github.com/haskell-servant/servant/blob/bf824a388/servant/src/Servant/API/Verbs.hs#L26\">type constructor from servant</a> which is then used in a type-level API like this:</p>\n\n<pre><code>type API = \"users\" :&gt; Verb 'GET 200 '[JSON] [User]\n</code></pre>\n\n<p>For our purposes we can cut down the API to</p>\n\n<pre><code>type API = Get 200\n</code></pre>\n\n<p>Now, having a restriction of the status code being of kind <code>Nat</code> is too loose, allowing to define a non-existing HTTP status code:</p>\n\n<pre><code>type API = Get 999\n</code></pre>\n\n<p>Hence, the question: <strong>Is there a way to restrict the set of naturals that can be applied to the <code>Get</code> type constructor?</strong></p>\n\n<h1>What was Tried</h1>\n\n<p><em>I'll omit all the pragmas and imports in the code samples for clarity.</em></p>\n\n<h3>A different kind for <code>statusCode</code></h3>\n\n<p>One obvious way to fix it would be to define a separate ADT for status codes and use it in place of <code>Nat</code> utilizing data type promotion.</p>\n\n<pre><code>data StatusCode = HTTP200 | HTTP201 | HTTP202\ndata Get (statusCode :: StatusCode)\n</code></pre>\n\n<p>However, this is a breaking change, which'd require to bump a major version and rewrite all the users' definitions. I doubt the benefit of restricted codes is worth it.</p>\n\n<h3>DatatypeContexts</h3>\n\n<p>This extension allows to have a straightforward constraint on our type variable</p>\n\n<pre><code>data IsStatusCode statusCode =&gt; Get (statusCode :: Nat)\n</code></pre>\n\n<p>but it requires users to add the constraint to all their declaration. Again, a breaking change. Besides, <code>DatatypeContexts</code> is deprecated.                                                                                                                         </p>\n\n<h3>Type Families</h3>\n\n<p>We could conditionally create <code>Get'</code> from the example below using type families, but for some reason declaring a type alias happily compiles. In order to get an error we need to construct a value of this type, which is also a breaking change.</p>\n\n<pre><code>data Get' (statusCode :: Nat) = Get\n\ntype family Get x where\n  Get x = If (x &lt;=? 600) (Get' x) (TypeError (Text \"Invalid Code\"))\n\ntype API1 = Get 200\ntype API2 = Get 999 -- compiles.\n\napi :: Get 999 -- doesn't compile.\napi = Get\n</code></pre>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1473149707, "post_id": 39343471, "comment_id": 66017981, "body": "I\u2019m not sure if this would fix your problem, but you might try dropping the explicit <code>ToJSON</code> / <code>FromJSON</code> instances and the <code>Generic</code> derivation and instead just derive <code>ToJSON</code> and <code>FromJSON</code> using <code>GeneralizedNewtypeDeriving</code>. That would <i>ensure</i> the instance isn\u2019t trying to do anything more complicated than the instance for <code>String</code>."}, {"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1473154847, "post_id": 39343471, "comment_id": 66021196, "body": "Good idea, I&#39;ll give that a go when I get the chance! I did quite thoroughly test encode/decode however (as well as the eitherDecodeLenient variant) as well as write a custom decoder, and I didn&#39;t get anywhere :("}, {"owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1473178711, "post_id": 39343471, "comment_id": 66037025, "body": "I&#39;d still worry @AlexisKing might be right. <code>GeneralizedNewtypeDeriving</code> and <code>DeriveAnyClass</code> would lead to different results, and depending on how your <code>.ghci</code> config file and <code>cabal</code> file are setup, the GHCi session may be using something different."}, {"owner": {"reputation": 1750, "user_id": 442535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f65da9343686b1be444b35f88f4803d0?s=128&d=identicon&r=PG", "display_name": "fizruk", "link": "https://stackoverflow.com/users/442535/fizruk"}, "edited": false, "score": 0, "creation_date": 1473178869, "post_id": 39343471, "comment_id": 66037108, "body": "What are the <code>servant</code> and <code>aeson</code> versions you&#39;re using? Do you have any other route that could possible conflict with the one you think gets processed?"}, {"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "reply_to_user": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "edited": false, "score": 0, "creation_date": 1473187573, "post_id": 39343471, "comment_id": 66041670, "body": "Good point, I added versions and a link to the full source into the question! I don&#39;t believe any other routes can possibly conflict (it&#39;s the only one with &quot;order&quot; in at all). @user2141650 I wrote a custom decoder along the lines of <code>parseJSON (String s) = return $ Id $ Text.unpack s</code> to avoid that sort of thing and it didn&#39;t help matters :("}, {"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "reply_to_user": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "edited": false, "score": 0, "creation_date": 1473189260, "post_id": 39343471, "comment_id": 66042481, "body": "@user2141650 fyi I double checked after writing custom parsers again with no luck (added to the original post)"}, {"owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "reply_to_user": {"reputation": 1750, "user_id": 442535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f65da9343686b1be444b35f88f4803d0?s=128&d=identicon&r=PG", "display_name": "fizruk", "link": "https://stackoverflow.com/users/442535/fizruk"}, "edited": false, "score": 0, "creation_date": 1473190802, "post_id": 39343471, "comment_id": 66043195, "body": "@fizruk so I think you&#39;re onto something (but I&#39;m not sure how it&#39;s possible!) - I have been experimenting with throwing different request bodies at the troublesome route, and I managed to get back a very specific error message from another route (specifically, the one declared right next to it, AddEntry)! This is very strange - if you look at my Routes.hs you&#39;ll see that it all looks sane (though I am still expecting to find some sort of silly mistake).. I wonder whether there is an off-by-one error in servant somewhere."}], "owner": {"reputation": 4782, "user_id": 1339698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7d43d1dd397dceade900eb917cec4167?s=128&d=identicon&r=PG", "display_name": "jsdw", "link": "https://stackoverflow.com/users/1339698/jsdw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 523, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1473319990, "creation_date": 1473148399, "last_edit_date": 1473319990, "question_id": 39343471, "link": "https://stackoverflow.com/questions/39343471/haskell-servant-400-bad-request-when-using-array-of-custom-data-type-in-reqbody", "title": "Haskell Servant: 400 Bad Request when using array of custom data type in ReqBody", "body": "<p>So, I have a simple Id type:</p>\n\n<pre><code>newtype Id = Id String\n    deriving (Show, Eq, Ord, Generic)\n\ninstance ToJSON Id\ninstance FromJSON Id\ninstance FromHttpApiData Id where parseUrlPiece = Right . Id . Text.unpack\n</code></pre>\n\n<p>And a servant route defined as so:</p>\n\n<pre><code>type SetEntryOrder = \"entries\" :&gt; \"order\" :&gt; ReqBody '[JSON] [Id] :&gt; Post '[JSON] [Id]\n</code></pre>\n\n<p>I make a request to it with headers and request body as below:</p>\n\n<pre><code>POST /entries/order HTTP/1.1\nHost: localhost:9090\nConnection: keep-alive\nContent-Length: 199\nPragma: no-cache\nCache-Control: no-cache\nOrigin: http://localhost:9090\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36\nContent-Type: application/json\nAccept: */*\nReferer: http://localhost:9090/\nAccept-Encoding: gzip, deflate\nAccept-Language: en\n\n[\"0pAWSlIHH38sApt0n101X2brrCkyYp\",\"1aaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",\"2aaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",\"7T84N81O7T84N81O7T84N81Obeu4JU\",\"vMfOGs2LvMfOGs2LvMfOGs2LzjlQIP\",\"j1Ew8Ju7HzAIv2yH9ohcdl9Wm2o7qx\"]\n</code></pre>\n\n<p>But I get back a 400 with the following body (the route is not entered at all):</p>\n\n<pre><code>Error in $: expected record (:*:), encountered Array\n</code></pre>\n\n<p>I cloned the github servant repo and grepped for various parts of this but found nothing.</p>\n\n<p>It's perhaps worth noting that I have a bunch of other routes that work fine.</p>\n\n<p>I thought perhaps my <code>Id</code> type was not being decoded properly (Aeson expected records or something) but I can use the same thing servant does under the hood without issue in GHCI:</p>\n\n<pre><code>&gt; import Servant.API.ContentTypes (eitherDecodeLenient)\n&gt; eitherDecodeLenient \"[\\\"hello\\\",\\\"hi\\\"]\" :: Either String [Id]\nRight [Id \"hello\",Id \"hi\"]\n</code></pre>\n\n<p>And defining custom JSON handlers for my Id type like so doesn't help either:</p>\n\n<pre><code>instance ToJSON Id where\n    toJSON (Id s) = String $ Text.pack s\ninstance FromJSON Id where\n    parseJSON (String s) = return $ Id $ Text.unpack s\n    parseJSON _ = empty\n</code></pre>\n\n<p>Sooo, does anyone have an idea why Servant is getting stuck trying to decode my array of Ids and throwing me a 400 rather than getting into my route? :)</p>\n\n<p><strong>versions</strong></p>\n\n<p>stack LTS 6.15, which means:</p>\n\n<p>GHC 7.10.3, servant 0.7.1, servant-server 0.7.1, aeson 0.11.2.1</p>\n\n<p>(I tested servant-0.8.1 also but no change)</p>\n\n<p><strong>Original Code</strong></p>\n\n<p><a href=\"https://github.com/jsdw/talklicker/tree/master/server\" rel=\"nofollow\">https://github.com/jsdw/talklicker/tree/master/server</a> (see Routes.hs for the route definition and Types.hs for the definition of Id)</p>\n\n<h1>Update!</h1>\n\n<p>So, the issue appears to be that servant is matching the wrong route, as by passing in the right data to my <code>/entries/orders</code> route (in fact, it seems I can replace \"orders\" with any string, and trailing slash makes no difference!), I can actually get to my <code>/entries</code> route. Adding another route piece (eg <code>:&gt; \"dadada\"</code>) to SetEntryOrder and using that allows me to target the correct route.</p>\n\n<p>The routes in question that overlap are:</p>\n\n<pre><code>type SetEntryOrder = HasSession :&gt; \"order\" :&gt; ReqBody '[JSON] [Id] :&gt; Post '[JSON] [Id]\n</code></pre>\n\n<p>and</p>\n\n<pre><code>type AddEntry = HasSession :&gt; ReqBody '[JSON] AddEntryInput :&gt; Post '[JSON] Entry\n</code></pre>\n\n<p>noting that both of these are prefixed with \"entries\" at the top of my Routes.hs file. I have yet to work out why this is the case, but it's a start!</p>\n\n<h1>Update 2!</h1>\n\n<p>Problem solved! It in fact was because I had overlapping routes, so my fault! I made things hard for myself because the overlapping route accepted almost any input (but I forgot this!). Swapping the routes around fixed it.</p>\n"}, {"tags": ["haskell", "typeclass", "newtype", "overlapping-instances"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473147705, "post_id": 39343074, "comment_id": 66016851, "body": "Is <code>deriving Show</code> different to what you want to achieve?"}, {"owner": {"reputation": 214, "user_id": 5122945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5e4f5ee524d6551bbb1af83acf49de0?s=128&d=identicon&r=PG&f=1", "display_name": "Leif Willerts", "link": "https://stackoverflow.com/users/5122945/leif-willerts"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1473148108, "post_id": 39343074, "comment_id": 66017073, "body": "Yes. I don&#39;t just want <code>FlapMap (fromList [...])</code>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1473159243, "post_id": 39343074, "comment_id": 66023935, "body": "I would not override the <code>Show</code> instance for it is really helpful for creating output, showing it in ghci and copy it to a test case - especially in combination with a prettyprinting library. I would rather create a UserFriendlyShow typeclass - but then you need the OverlappingInstances anyway."}], "answers": [{"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": false, "score": 5, "last_activity_date": 1473149930, "last_edit_date": 1473149930, "creation_date": 1473149361, "answer_id": 39343788, "question_id": 39343074, "link": "https://stackoverflow.com/questions/39343074/how-to-declare-instances-of-a-typeclass-like-show-for-all-types-in-my-own-type/39343788#39343788", "title": "How to declare instances of a typeclass (like Show) for all types in my own typeclass?", "body": "<p>You can\u2019t do this without <code>OverlappingInstances</code>, which as you mention, is unpredictable. It won\u2019t help you here, anyway, so you pretty much can\u2019t do this at all without a wrapper type.</p>\n\n<p>That\u2019s rather unsatisfying, of course, so why is this the case? As you\u2019ve already determined, GHC does not look at the instance context when picking an instance, only the instance head. Why? Well, consider the following code:</p>\n\n<pre><code>class Foo a where\n  fooToString :: a -&gt; String\n\nclass Bar a where\n  barToString :: a -&gt; String\n\ndata Something = Something\n\ninstance Foo Something where\n  fooToString _ = \"foo something\"\n\ninstance Bar Something where\n  barToString _ = \"bar something\"\n\ninstance Foo a =&gt; Show a where\n  show = fooToString\n\ninstance Bar a =&gt; Show a where\n  show = barToString\n</code></pre>\n\n<p>If you consider the <code>Foo</code> or <code>Bar</code> typeclasses in isolation, the above definitions make sense. Anything that implements the <code>Foo</code> typeclass should get a <code>Show</code> instance \u201cfor free\u201d. Unfortunately, the same is true of the <code>Bar</code> instance, so now you have <em>two</em> valid instances for <code>show Something</code>.</p>\n\n<p>Since typeclasses are always open (and indeed, <code>Show</code> must be open if you are able to define your own instances for it), it\u2019s impossible to know that someone will not come along and add their own similar instance, then create an instance on your datatype, creating ambiguity. This is effectively the classic <a href=\"https://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem\">diamond problem</a> from OO multiple inheritance in typeclass form.</p>\n\n<p>The best you can get is to create a wrapper type that provides the relevant instances:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\ndata ShowableWrapper = forall w. Wrapper w =&gt; ShowableWrapper w\n\ninstance Show ShowableWrapper where\n  show (ShowableWrapper w) = show . toList $ open w\n</code></pre>\n\n<p>At that point, though, you really aren\u2019t getting much of an advantage over just writing your own <code>showWrapper :: Wrapper w =&gt; w -&gt; String</code> function.</p>\n"}], "owner": {"reputation": 214, "user_id": 5122945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5e4f5ee524d6551bbb1af83acf49de0?s=128&d=identicon&r=PG&f=1", "display_name": "Leif Willerts", "link": "https://stackoverflow.com/users/5122945/leif-willerts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473209743, "creation_date": 1473147091, "question_id": 39343074, "link": "https://stackoverflow.com/questions/39343074/how-to-declare-instances-of-a-typeclass-like-show-for-all-types-in-my-own-type", "title": "How to declare instances of a typeclass (like Show) for all types in my own typeclass?", "body": "<p>I have a typeclass:</p>\n\n<pre><code>class Wrapper w where\n    open :: w -&gt; Map String Int\n    close :: Map String Int -&gt; w\n</code></pre>\n\n<p>It doesn't look very useful, but I use it to strongly (not just a <code>type</code> synonym) distinguish between semantically different varieties of <code>Map String Int</code>s:</p>\n\n<pre><code>newtype FlapMap = Flap (Map String Int)\nnewtype SnapMap = Snap (Map String Int)\n...\n</code></pre>\n\n<p>and still have functions that operate on any type of the class.</p>\n\n<ol>\n<li>Is there a better way to do this distinction (maybe without the <code>Wrapper</code> instances boilerplate)?</li>\n</ol>\n\n<p>I want to do this:</p>\n\n<pre><code>instance (Wrapper wrapper) =&gt; Show wrapper where\n    show w = show $ toList $ open w\n</code></pre>\n\n<p>instead of writing many boilerplate <code>Show</code> instances as well.</p>\n\n<p>Via <code>FlexibleInstances</code> and <code>UndecidableInstances</code>, GHC leads me to a point where it thinks my instance declaration applies to everything, as it allegedly clashes with the other <code>Show</code> instances in my code and in <code>GHC.Show</code>. HaskellWiki and StackOverflow answerers and HaskellWiki convince me <code>OverlappingInstances</code> is not quite safe and possibly confusing. GHC doesn't even suggest it.</p>\n\n<ol start=\"2\">\n<li><p>Why does GHC first complain about not knowing which instance of fx <code>Show Int</code> to pick (so why it doesn't look at the constraint I give at compile time?) and then, being told that instances may overlap, suddenly know what to do?</p></li>\n<li><p>Can I avoid allowing <code>OverlappingInstances</code> with my <code>newtype</code>s?</p></li>\n</ol>\n"}, {"tags": ["haskell", "typeclass", "fold"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1473146503, "post_id": 39341632, "comment_id": 66016164, "body": "Neither <code>foldl1</code> nor <code>foldl1&#39;</code> belongs in <code>Foldable</code>. They belong in <code>Foldable1</code>, the class of nonempty foldable containers. Someone made a mistake and put <code>foldl1</code> in <code>Foldable</code>. I don&#39;t think anyone has the heart to compound that error."}, {"owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473147223, "post_id": 39341632, "comment_id": 66016571, "body": "@dfeuer: was the introduction of <code>Foldable</code> not preceded by a <i>really</i> long period of discussion and polls? Was this overlooked or is it some compromise?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "edited": false, "score": 0, "creation_date": 1473151366, "post_id": 39341632, "comment_id": 66018904, "body": "@ljedrz I think you&#39;re mixing up the discussion about using <code>Foldable</code> in the Prelude with the original design (if any) of <code>Foldable</code>."}, {"owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1473151542, "post_id": 39341632, "comment_id": 66018995, "body": "@Cactus: I thought this was a parallel discussion, but you&#39;re right - I can&#39;t seem to be able to find anything on <code>Foldable</code> that was not related to <code>Prelude</code>."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "edited": false, "score": 0, "creation_date": 1473151566, "post_id": 39341632, "comment_id": 66019009, "body": "@ljedrz <code>Foldable</code> has existed in its current form for ages."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1473152770, "post_id": 39341632, "comment_id": 66019787, "body": "I reckon there was so much discussion about the FTP that any argument about the <code>fold*1*</code> variants likely got drowned in noise."}], "answers": [{"comments": [{"owner": {"reputation": 319, "user_id": 6531137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8fa00f21d96d6c6030c3c74d7fb26944?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/6531137/kevin"}, "edited": false, "score": 0, "creation_date": 1473184864, "post_id": 39344685, "comment_id": 66040284, "body": "Data.List already exports the generalized form of foldl1 and foldl&#39;, both of which are part of the Foldable instance. So it seems like a generalized foldl1&#39; should be exported from both Data.List and Data.Foldable for consistency sake."}], "tags": [], "owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "is_accepted": false, "score": 0, "last_activity_date": 1473152027, "creation_date": 1473152027, "answer_id": 39344685, "question_id": 39341632, "link": "https://stackoverflow.com/questions/39341632/why-is-foldl1-not-generalized-to-foldable/39344685#39344685", "title": "Why is foldl1&#39; not generalized to Foldable?", "body": "<p>Maybe the generalized form just <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Prelude710/FTP#SomefunctionsinData.ListcouldbegeneralizedtoFoldablebuthavenotbeen.ForexampleisPrefixOfandisInfixOfcanbegeneralised.Moregenerallyanythingwithalistinanargumentpositioncanbegeneralized.\" rel=\"nofollow\">would have no good place to live</a>? There may also have been some performance reasons behind this, but I couldn't find any information about it.</p>\n"}], "owner": {"reputation": 319, "user_id": 6531137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8fa00f21d96d6c6030c3c74d7fb26944?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/6531137/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 205, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1473156400, "creation_date": 1473141837, "last_edit_date": 1473151319, "question_id": 39341632, "link": "https://stackoverflow.com/questions/39341632/why-is-foldl1-not-generalized-to-foldable", "title": "Why is foldl1&#39; not generalized to Foldable?", "body": "<p>The title says it all. <code>foldl1</code> and <code>foldl'</code> are both generalized to <code>Foldable</code>, while <code>foldl1'</code> is not. Is this just a recent oversight? Or is it a design choice?</p>\n\n<p>The type of <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:foldl1-39-\" rel=\"nofollow\"><code>foldl1'</code></a> is</p>\n\n<pre><code>foldl1' :: (a -&gt; a -&gt; a) -&gt; [a] -&gt; a\n</code></pre>\n\n<p>I expected it to have the same type as <code>foldl1</code>:</p>\n\n<pre><code>foldl1 :: Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a\n</code></pre>\n\n<p>I also see that <code>foldl1'</code> is exported by <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:foldl1-39-\" rel=\"nofollow\"><code>Data.List</code></a> but not <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#v:foldl-39-\" rel=\"nofollow\"><code>Data.Foldable</code></a>. Perhaps this is related?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "is_accepted": false, "score": 2, "last_activity_date": 1473148479, "last_edit_date": 1473148479, "creation_date": 1473145703, "answer_id": 39342644, "question_id": 39341624, "link": "https://stackoverflow.com/questions/39341624/count-the-number-of-same-value-pair-of-element-in-two-list-haskell/39342644#39342644", "title": "Count the number of same value pair of element in two list (Haskell)", "body": "<p>Just sort and compute recursively.</p>\n\n<pre><code>getMatch :: Ord a =&gt; [a] -&gt; [a] -&gt; Int\ngetMatch l r = getMatch' (sort l) (sort r)\n\ngetMatch' [] _ = 0\ngetMatch' _ [] = 0\ngetMatch' l@(a: as) r@(b: bs) | a &lt; b = getMatch' as r\n                              | a == b = getMatch' as bs + 1\n                              | otherwise = getMatch' l bs\n</code></pre>\n\n<hr>\n\n<p>Test:</p>\n\n<pre><code>\u03bb&gt; getMatch \"ABA\" \"CAC\"\n1\n\u03bb&gt; getMatch \"AAA\" \"ACA\"\n2\n\u03bb&gt; getMatch \"ABC\" \"CAA\"\n2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": true, "score": 2, "last_activity_date": 1473217152, "last_edit_date": 1473217152, "creation_date": 1473146848, "answer_id": 39343004, "question_id": 39341624, "link": "https://stackoverflow.com/questions/39341624/count-the-number-of-same-value-pair-of-element-in-two-list-haskell/39343004#39343004", "title": "Count the number of same value pair of element in two list (Haskell)", "body": "<p>Here's a solution:</p>\n\n<pre><code>import Data.List\n\ncountEm count []       l2 = count\ncountEm count (x : xs) l2 = if elem x l2\n                             then countEm (count + 1) xs (delete x l2)\n                             else countEm count xs l2\n</code></pre>\n\n<p>The <code>delete</code> function comes from <code>Data.List</code> and deletes just one element from the list.</p>\n\n<p>Testing your examples:</p>\n\n<pre><code>&gt; countEm 0 \"ABA\" \"CAC\"\n1\n&gt; countEm 0 \"AAA\" \"ACA\"\n2\n&gt; countEm 0 \"ABC\" \"CAA\"\n2\n</code></pre>\n\n<p>It still could be more efficient by combining <code>elem</code> and <code>delete</code> into a function with those two responsibilities.</p>\n"}], "owner": {"reputation": 89, "user_id": 6376286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29f9527237423285f50e51fc3e21fe99?s=128&d=identicon&r=PG&f=1", "display_name": "GlossMash", "link": "https://stackoverflow.com/users/6376286/glossmash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 833, "favorite_count": 0, "accepted_answer_id": 39343004, "answer_count": 2, "score": 0, "last_activity_date": 1473217152, "creation_date": 1473141812, "question_id": 39341624, "link": "https://stackoverflow.com/questions/39341624/count-the-number-of-same-value-pair-of-element-in-two-list-haskell", "title": "Count the number of same value pair of element in two list (Haskell)", "body": "<p>I want to count the number of pair of mutual elements in two lists without using any functions outside Prelude and Data.List. Each match only count once.</p>\n\n<p>For example: </p>\n\n<p>[A,B,A] and [C,A,C] return 1 (only 1 A).</p>\n\n<p>[A,A,A] and [A,C,A] return 2 (2 A). </p>\n\n<p>[A,B,C] and [C,A,A] return 2 (A and C).</p>\n\n<p>Here is my attempt, I want to do it as short as possible but failed.</p>\n\n<pre><code>length filter (`elem` list1) list2\n</code></pre>\n\n<p>My code count will return 2 for [A,B,A] and [C,A,C] because it count all the matches in two lists.</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 5, "creation_date": 1473120302, "post_id": 39338947, "comment_id": 66009113, "body": "Specifically, <code>5</code> means <code>fromInteger (5 :: Integer)</code>, so <code>toString 5</code> is ambiguous for the same reason that <code>show (read 5)</code> is\u2014the intermediate type isn\u2019t specified, so the compiler doesn\u2019t know which instance to use without more information, such as a type signature."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "edited": false, "score": 0, "creation_date": 1473131248, "post_id": 39338947, "comment_id": 66011122, "body": "@behzad.nouri I went into the difference in my answer, by talking about why <code>ExtendedDefaultRules</code> actually makes a difference here."}], "tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 7, "last_activity_date": 1473120202, "last_edit_date": 1495540862, "creation_date": 1473120202, "answer_id": 39338947, "question_id": 39338899, "link": "https://stackoverflow.com/questions/39338899/why-am-i-forced-to-specify-a-type-here/39338947#39338947", "title": "Why am I forced to specify a type here?", "body": "<p>You are required to specify a type because <code>5</code> is polymorphic in Haskell:</p>\n\n<pre><code>\u03bb&gt; :type 5\n5 :: Num a =&gt; a\n</code></pre>\n\n<p>so the compiler doesn't know which <code>Num</code> instance to choose. However, because of <a href=\"https://stackoverflow.com/questions/26467291/ambiguous-type-variable-but-not-in-ghci\">extended defaulting</a>, this <em>does</em> work in ghci:</p>\n\n<pre><code>\u03bb&gt; toString 5\n\"5\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 6, "last_activity_date": 1473131063, "creation_date": 1473131063, "answer_id": 39340034, "question_id": 39338899, "link": "https://stackoverflow.com/questions/39338899/why-am-i-forced-to-specify-a-type-here/39340034#39340034", "title": "Why am I forced to specify a type here?", "body": "<p>When you write <code>toString \"Text\"</code> or <code>toString 't'</code>, Haskell is able to tell exactly which concrete type <code>\"Text\"</code> and <code>'t'</code> are: <code>[Char]</code> (aka <code>String</code>) and <code>Char</code> respectively. So it can select an instance and run your code.</p>\n\n<p><code>toString 5</code> is subtly different. Numeric literals like <code>5</code> are overloaded in Haskell, so that <code>5</code> could be an <code>Int</code>, a <code>Double</code>, or something completely different with a <code>Num</code> instance that doesn't have a <code>ToString</code> instance. So it's not specified which instance of <code>ToString</code> we should be using (and note that you'll get different observable behaviour with your existing instances based on whether you choose <code>Int</code> or <code>Double</code>). Haskell's general response to such a situation is to to report an ambiguous type error, requiring you to do something to pin down the types more.</p>\n\n<p>The authors of the Haskell spec considered that this would be a very common and annoying problem with numeric types in particular, so they built in a mechanism for <strong>defaulting</strong> ambiguous types, under certain conditions that are fairly conservatively designed to help with numeric literals used with standard Haskell features only.<sup>1</sup></p>\n\n<p>A type will only be defaulted if both:</p>\n\n<ol>\n<li>All the constraints on it only involve built-in type classes</li>\n<li>At least one of the classes is numeric (<code>Num</code>, <code>Floating</code>, etc)</li>\n</ol>\n\n<p>So <code>show 5</code> works because the constraints on the type of <code>5</code> are <code>(Num a, Show a)</code>; <code>Num</code> is a numeric class, and all of the constraints are built-in classes.</p>\n\n<p><code>toString 5</code> seems like it should be basically the same, but you get the constraints <code>(Num a, ToString a)</code>, and since <code>ToString</code> isn't a built-in class defaulting doesn't apply, leaving you with an ambiguous type error.</p>\n\n<p>The extended defaulting rules used in GHCi (or if you use the <code>ExtendedDefaultRules</code> extension) relax the \"only built-in classes\" rule (among other extensions), which makes <code>(Num a, ToString a)</code> eligible for defaulting after all.</p>\n\n<p>The GHC user manual talks about how the usual type defaulting rules are extended in GHCi (or with the <code>ExtendedDefaultRule</code>s extension), comparing them to the standard rules:</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#type-defaulting-in-ghci\">https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci.html#type-defaulting-in-ghci</a></p>\n\n<hr>\n\n<p><sup>1</sup> In practice I find it to be an extremely rare problem in actual development (I usually compile with a flag that warns about type defaulting), but that's because I adopt the (common) practice of giving type signatures to almost all top-level functions. When GHC is invoked to compile entire modules written with that practice, there's almost always enough information available to specify all the types and defaulting is never needed.</p>\n\n<p>For example, <code>toString x</code> would be perfectly fine if it occurred in a function where <code>x</code> was an argument with type <code>Int</code>. It would even be fine if <code>x</code> was a local variable with no explicit type, but it was also passed to a function that required an <code>Int</code> argument. Or was put in a list along with something else that was known to be an <code>Int</code>. Etc etc.</p>\n\n<p>But in GHCi you supply expressions to be analysed one-at-a-time, and usually don't bother with optional things like type signatures. Under these conditions numeric literals (and other expressions) are ambiguously typed <strong>much</strong> more frequently, which is the motivation for GHCi's extended default rules.</p>\n"}], "owner": {"reputation": 1995, "user_id": 713861, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ed73350b722bb9ea9d5a8720a1af4f3?s=128&d=identicon&r=PG", "display_name": "GreenSaguaro", "link": "https://stackoverflow.com/users/713861/greensaguaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 290, "favorite_count": 0, "accepted_answer_id": 39338947, "answer_count": 2, "score": 4, "last_activity_date": 1473131063, "creation_date": 1473119776, "last_edit_date": 1473128669, "question_id": 39338899, "link": "https://stackoverflow.com/questions/39338899/why-am-i-forced-to-specify-a-type-here", "title": "Why am I forced to specify a type here?", "body": "<p>I have the following code:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>class ToString a where\n    toString :: a -&gt; String\n\ninstance ToString String where\n    toString a = a\n\ninstance ToString Char where\n    toString a = [a]\n\ninstance ToString Int where\n    toString a = show a\n\ninstance ToString Integer where\n    toString a = show a\n\ninstance ToString Float where\n    toString a = show a\n\ninstance ToString Double where\n    toString a = show a\n</code></pre>\n\n<p>I can do <code>toString \"Text\"</code> and <code>toString 't'</code> and both compile fine. But if I do <code>toString 5</code> I get and error. I am forced to do <code>toString (5::Int)</code>.</p>\n\n<p><code>show</code> does not need a type specified to work. And when I look at the implementations of <code>Show</code>, I don't see anything magical:</p>\n\n<p><code>instance Show Int where ...</code></p>\n\n<p><code>instance Show Integer where ...</code></p>\n\n<p>What am I doing wrong that requires me to specify the type and how can I fix it?</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I added <code>{-# LANGUAGE ExtendedDefaultRules #-}</code> as suggested below, and it worked perfectly. Solved my problem.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 5, "creation_date": 1473107596, "post_id": 39337332, "comment_id": 66005771, "body": "Just give it a type annotation: <code>let list = [1, 2, 3] :: [Int]</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1473107678, "post_id": 39337332, "comment_id": 66005800, "body": "It <i>should</i> have type <code>Num t =&gt; [t]</code>, not <code>[Integer]</code>."}, {"owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1473107757, "post_id": 39337332, "comment_id": 66005822, "body": "Managed to find the same solution using <code>list :: [Int]</code>. Thanks all the same, @AlexisKing!"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473109874, "post_id": 39337332, "comment_id": 66006589, "body": "@chepner Only with <code>NoMonomorphismRestriction</code>, which I believe is not turned on by default in older versions of ghci. Actually, I&#39;m not sure it&#39;s turned on by default with current haskell platform, haven&#39;t used it in a while."}], "answers": [{"tags": [], "owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "is_accepted": false, "score": 1, "last_activity_date": 1473111949, "last_edit_date": 1473111949, "creation_date": 1473107682, "answer_id": 39337366, "question_id": 39337332, "link": "https://stackoverflow.com/questions/39337332/how-to-define-a-list-of-type-int/39337366#39337366", "title": "How to define a list of type [Int]?", "body": "<p>Turns out it can be done with:</p>\n\n<pre><code>list :: [Int]\nlist = [1, 2, 3]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10220, "user_id": 2720372, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/olQxk.jpg?s=128&g=1", "display_name": "w.b", "link": "https://stackoverflow.com/users/2720372/w-b"}, "is_accepted": false, "score": 3, "last_activity_date": 1473108672, "creation_date": 1473108672, "answer_id": 39337572, "question_id": 39337332, "link": "https://stackoverflow.com/questions/39337332/how-to-define-a-list-of-type-int/39337572#39337572", "title": "How to define a list of type [Int]?", "body": "<p>Another way:</p>\n\n<pre><code>let lst = [1 :: Int, 2, 3]\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 806848, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/fa2d23ca403ed0f695e2f2bd382094d1?s=128&d=identicon&r=PG", "display_name": "hvth", "link": "https://stackoverflow.com/users/806848/hvth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 721, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1473126727, "creation_date": 1473107505, "last_edit_date": 1473126727, "question_id": 39337332, "link": "https://stackoverflow.com/questions/39337332/how-to-define-a-list-of-type-int", "title": "How to define a list of type [Int]?", "body": "<p>If we define a list constant like</p>\n\n<pre><code>Prelude&gt; let list = [1, 2, 3]\n</code></pre>\n\n<p>it will have the following type:</p>\n\n<pre><code>Prelude&gt; :t list\nlist :: [Integer]\n</code></pre>\n\n<p>How can one define such a constant, literal list of type <code>[Int]</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 841, "user_id": 2272506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d910c6f729897b6af6fa867a794001?s=128&d=identicon&r=PG", "display_name": "Jesin", "link": "https://stackoverflow.com/users/2272506/jesin"}, "edited": false, "score": 4, "creation_date": 1473103914, "post_id": 39336516, "comment_id": 66004559, "body": "This type is not a Functor and cannot become a Functor. A Functor needs to be a type constructor that takes 1 parameter."}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "reply_to_user": {"reputation": 841, "user_id": 2272506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d910c6f729897b6af6fa867a794001?s=128&d=identicon&r=PG", "display_name": "Jesin", "link": "https://stackoverflow.com/users/2272506/jesin"}, "edited": false, "score": 0, "creation_date": 1473104406, "post_id": 39336516, "comment_id": 66004714, "body": "Oh yeah, I got that it can&#39;t since it doesn&#39;t have a parameter, but still the 3 question form above are not clear to me."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 2, "creation_date": 1473106825, "post_id": 39336516, "comment_id": 66005530, "body": "GHC version 7.10.3 throws an error on <code>fmap id (Clock12Hours 10)</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1473107292, "post_id": 39336516, "comment_id": 66005665, "body": "The three questions are meaningless: you do not and cannot have a functor, so I don&#39;t believe the results you claim for #1 and #2. Question 3, ignoring the functor issue, would only require a <code>Num</code> instance for <code>Clock12Hours</code>, since <code>(+4) :: Num a =&gt; a -&gt; a</code>."}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473109166, "post_id": 39336516, "comment_id": 66006336, "body": "@chepner why would I make up the results? :) They are what I got when I try them on <code>ghci version 7.10.3</code>. I will remove the word &quot;Functors&quot; from the post, but my requirements/ questions still remain on how to achieve the functionality + how come <code>fmap id</code> worked"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1473117771, "post_id": 39336516, "comment_id": 66008652, "body": "@amitaibu Check again <code>fmap id (Clock12Hours 10)</code>. It looks impossible to us that it is producing any result. Maybe, post the full code and the GHCi session. Possibly, something is defined differently from what was posted above."}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1473151240, "post_id": 39336516, "comment_id": 66018849, "body": "Indeed, sorry - the code I tried was <code>fmap (id) Clock12Hours 12</code> (and it works). I&#39;ll update the post"}, {"owner": {"reputation": 841, "user_id": 2272506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d910c6f729897b6af6fa867a794001?s=128&d=identicon&r=PG", "display_name": "Jesin", "link": "https://stackoverflow.com/users/2272506/jesin"}, "edited": false, "score": 1, "creation_date": 1473189919, "post_id": 39336516, "comment_id": 66042801, "body": "@amitaibu: Function application is left-associative in Haskell, so that code means <code>(fmap id Clock12Hours) 12</code>. This &quot;works&quot; because the <code>Clock12Hours</code> data constructor acts like a function, so your code uses <code>instance Functor ((-&gt;) r)</code> (see <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-637\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.9.0.0/docs/src/&hellip;</a> ). I think you meant to write <code>fmap id (Clock12Hours 12)</code>, which does not work because <code>(Clock12Hours 12)</code> is not any kind of <code>Functor</code>."}, {"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 1, "creation_date": 1473198344, "post_id": 39336516, "comment_id": 66046500, "body": "Thanks @jeson, now I understand where my confusion came from."}], "answers": [{"comments": [{"owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 0, "creation_date": 1473109465, "post_id": 39337323, "comment_id": 66006439, "body": "So, on your installation the <code>fmap id</code> doen&#39;t work at-all? (which makes more sense to me, because I don&#39;t understand how it works on mine). I seem to also have v7.10.3.  Could I change my <code>data</code> to something else to accomplish my needs, but still have the argument only Int (i.e. <code>data Clock12Hours a = Clock12Hours a</code> won&#39;t limit it to <code>Int</code> only)?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "edited": false, "score": 2, "creation_date": 1473109707, "post_id": 39337323, "comment_id": 66006537, "body": "@amitaibu You could do that, although that would defeat the purpose of your datatype, no? You cannot make your type polymorphic and restrict it afterward, that is nonsensical. Also, that would be the <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Functor-Identity.html\" rel=\"nofollow noreferrer\"><code>Identity</code> functor</a>, which already exists in Haskell. <b>TL;DR</b> Don&#39;t do that."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 0, "last_activity_date": 1473107480, "creation_date": 1473107480, "answer_id": 39337323, "question_id": 39336516, "link": "https://stackoverflow.com/questions/39336516/prevent-wrong-values-inside-custom-type-upon-fmap/39337323#39337323", "title": "Prevent wrong values inside custom type upon fmap", "body": "<p>I have no answer for <code>1.</code> because I can't reproduce the error on GHC 7.10.3.</p>\n\n<p>For <code>2.</code>: Only types which take 1 type parameter to construct can be functors because <code>fmap</code> is <em>polymorphic</em> in its arguments, while <code>Clock12Hours</code> is not.</p>\n\n<p>To answer <code>3.</code>: Well a map operation unpacks it's argument, applys a function and re-packs the whole thing. Using this definition, we come up with:</p>\n\n<pre><code>myMap :: (Int -&gt; Int) -&gt; Clock12Hours -&gt; Clock12Hours\nmyMap f (Clock12Hours time) = Clock12Hours (f time)\n</code></pre>\n\n<p>But now we have the problem that we might not get a 12 hour time, so we have two options: add 0 (<code>mappend mempty</code>), or write a <code>normalize</code> function:</p>\n\n<pre><code>normalize (Clock12Hours x) = Clock12Hours (x `mod` 12)\nnormalize clock = myMap (`mod` 12) clock\nnormalize = myMap (`mod` 12)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 841, "user_id": 2272506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d910c6f729897b6af6fa867a794001?s=128&d=identicon&r=PG", "display_name": "Jesin", "link": "https://stackoverflow.com/users/2272506/jesin"}, "is_accepted": true, "score": 3, "last_activity_date": 1513609493, "last_edit_date": 1513609493, "creation_date": 1473111943, "answer_id": 39338041, "question_id": 39336516, "link": "https://stackoverflow.com/questions/39336516/prevent-wrong-values-inside-custom-type-upon-fmap/39338041#39338041", "title": "Prevent wrong values inside custom type upon fmap", "body": "<p>I think you meant to do something like this:</p>\n\n<pre><code>{-# LANGUAGE Safe #-}\nmodule Numeric.IntMod12 (\n    IntMod12(), lift1Enum, lift2Enum\n) where\n\nnewtype IntMod12 = IntMod12 Int deriving (Eq, Ord, Show)\n\ninstance Enum IntMod12 where\n    {-# INLINABLE toEnum #-}\n    toEnum i = IntMod12 (mod i 12)\n    {-# INLINABLE fromEnum #-}\n    fromEnum (IntMod12 i) = i\n\nlift1Enum :: (Enum a, Enum b) =&gt; (Int -&gt; Int) -&gt; a -&gt; b\n{-# INLINABLE lift1Enum #-}\nlift1Enum f = \\ x -&gt; toEnum (f (fromEnum x))\n\nlift2Enum :: (Enum a, Enum b, Enum c) =&gt; (Int -&gt; Int -&gt; Int) -&gt; a -&gt; b -&gt; c\n{-# INLINABLE lift2Enum #-}\nlift2Enum f = \\ x y -&gt; toEnum (f (fromEnum x) (fromEnum y))\n\ninstance Real IntMod12 where\n    {-# INLINABLE toRational #-}\n    toRational (IntMod12 i) = toRational i\n\ninstance Num IntMod12 where\n    {-# INLINABLE fromInteger #-}\n    fromInteger i = IntMod12 (fromInteger (mod i 12))\n    (+) = lift2Enum (+)\n    (-) = lift2Enum (-)\n    (*) = lift2Enum (*)\n    negate = lift1Enum negate\n    abs = id\n    signum 0 = 0\n    signum _ = 1\n\ninstance Integral IntMod12 where\n    {-# INLINABLE toInteger #-}\n    toInteger (IntMod12 i) = toInteger i\n    div = lift2Enum div\n    mod = lift2Enum mod\n    quot = lift2Enum quot\n    rem = lift2Enum rem\n    divMod x y = (toEnum d, toEnum m) where\n        (d, m) = divMod (fromEnum x) (fromEnum y)\n    quotRem x y = (toEnum q, toEnum r) where\n        (q, r) = quotRem (fromEnum x) (fromEnum y)\n\ninstance Monoid IntMod12 where\n    mempty = 0\n    mappend = (+)\n</code></pre>\n\n<p>Because this is not a <code>Functor</code> (and cannot be turned into a <code>Functor</code>), you would have to use something like <code>lift1Enum</code> instead of <code>fmap</code>.</p>\n"}], "owner": {"reputation": 813, "user_id": 750039, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dd083a563230226543fcab3e1395b1fd?s=128&d=identicon&r=PG", "display_name": "amitaibu", "link": "https://stackoverflow.com/users/750039/amitaibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "closed_date": 1473147492, "accepted_answer_id": 39338041, "answer_count": 2, "score": 0, "last_activity_date": 1513609493, "creation_date": 1473103203, "last_edit_date": 1473151266, "question_id": 39336516, "link": "https://stackoverflow.com/questions/39336516/prevent-wrong-values-inside-custom-type-upon-fmap", "closed_reason": "Not suitable for this site", "title": "Prevent wrong values inside custom type upon fmap", "body": "<p>I'd like to have a monoid of a 12 hours clock.</p>\n\n<pre><code>data Clock12Hours = Clock12Hours Int\n    deriving (Show)\n\ninstance Monoid Clock12Hours where\n    mappend (Clock12Hours x) (Clock12Hours y) = Clock12Hours $ (x + y) `mod` 12\n    mempty = Clock12Hours 12\n</code></pre>\n\n<p>when I <code>mappend (Clock12Hours 4) (Clock12Hours 10)</code> I get correct value - <code>Clock12Hours 2</code>.</p>\n\n<p>My questions are:</p>\n\n<ol>\n<li>When I <code>fmap (id) Clock12Hours 10</code>, I get <code>Clock12Hours 10</code>. But how did it know how to fmap, if I haven't provided a functor definition (which as clarified in the comments, can't even be done)?</li>\n<li>When I try to <code>fmap (+1) (Clock12Hours 10)</code> I get an error <code>No instance for (Num Clock12Hours) arising from a use of \u2018+\u2019</code> - why is that?</li>\n<li>My goal here is that if I would try to fmap some Int operation, it will give a result similar to the monoid (e.g. <code>fmap (+4) (Clock12Hours 10)</code> would return <code>Clock12Hours 2</code>. How?</li>\n</ol>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 6, "last_activity_date": 1473100811, "creation_date": 1473100811, "answer_id": 39336087, "question_id": 39335993, "link": "https://stackoverflow.com/questions/39335993/why-does-my-code-in-haskell-work-on-command-line-but-not-in-a-file/39336087#39336087", "title": "Why does my code in Haskell work on command line but not in a file", "body": "<p>The REPL, GHCi, accepts Haskell expressions.  Unlike Python, a Haskell module must be composed of declarations.</p>\n\n<p>For example, an expression could be <code>1+1</code> but even from a human perspective that makes no sense as a top-level of a source file - there is no variable declared and no operation performed.  At the top level you can declare a value, such as:</p>\n\n<pre><code>val = [let square x = x * x in (square 5, square 3, square 2)]\n</code></pre>\n\n<p>Or in the REPL you can do the same but with <code>let</code>:</p>\n\n<pre><code>let val = [let square x = x * x in (square 5, square 3, square 2)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": false, "score": 3, "last_activity_date": 1473100940, "creation_date": 1473100940, "answer_id": 39336109, "question_id": 39335993, "link": "https://stackoverflow.com/questions/39335993/why-does-my-code-in-haskell-work-on-command-line-but-not-in-a-file/39336109#39336109", "title": "Why does my code in Haskell work on command line but not in a file", "body": "<p>A haskell module (i.e source a file), typically contains declarations of the form <code>some_var = expression</code>. This line will evaluate the expression (lazilly), and assign it (\"bind\" it) to the variable <code>some_var</code>. If you just put an expression by itself (a \"naked expression\"), the compiler doesn't know what to do with it. So you need to bind it to some variable or do something else with it. So for example, the following will complile:</p>\n\n<pre><code>sumSqaures = [let square x = x * x in (square 5, square 3, square 2)]\n</code></pre>\n\n<p>Now, this is not a very useful module, and in fact, if you try to compile it as an executable (and not a library), it will fail. This is because executables are supposed to define a variable called <code>main</code>. So if you want a complete program that will compile, you can try this</p>\n\n<pre><code>main = print sumSqaures\n\nsumSqaures = [let square x = x * x in (square 5, square 3, square 2)]\n</code></pre>\n\n<p>or even just the line</p>\n\n<pre><code>main = print [let square x = x * x in (square 5, square 3, square 2)]\n</code></pre>\n"}], "owner": {"reputation": 5249, "user_id": 949827, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/S479X.jpg?s=128&g=1", "display_name": "TastyCode", "link": "https://stackoverflow.com/users/949827/tastycode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 39336087, "answer_count": 2, "score": 0, "last_activity_date": 1473104440, "creation_date": 1473100299, "last_edit_date": 1473104440, "question_id": 39335993, "link": "https://stackoverflow.com/questions/39335993/why-does-my-code-in-haskell-work-on-command-line-but-not-in-a-file", "title": "Why does my code in Haskell work on command line but not in a file", "body": "<p>I have the following code that works well on command line:</p>\n\n<pre><code>ghci&gt; [let square x = x * x in (square 5, square 3, square 2)]\n[(25,9,4)]\n</code></pre>\n\n<p>but when I have it in a file and compile it, it doesn't work and I get an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[1 of 1] Compiling Main             ( baby.hs, interpreted )\n\nbaby.hs:62:1:\n    Parse error: naked expression at top level\n    Perhaps you intended to use TemplateHaskell\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1481823494, "post_id": 39333946, "comment_id": 69540657, "body": "Can ghci itself import these modules?"}], "answers": [{"tags": [], "owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "is_accepted": false, "score": 0, "last_activity_date": 1481819385, "creation_date": 1481819385, "answer_id": 41168969, "question_id": 39333946, "link": "https://stackoverflow.com/questions/39333946/is-it-possible-to-load-compiled-code-to-hint/41168969#41168969", "title": "Is it possible to load compiled code to hint?", "body": "<p>You could make yourself a <strong>stack</strong> project and put your code on which you depend on Hackage.</p>\n\n<p>Then in your project add that package into your <code>build-depends</code> section of the <code>*.cabal</code> file.\nThen just import the stuff you need using <code>setImportsQ</code> from <code>hint</code>.</p>\n\n<p>An example would be depending on <code>Chart</code> and <code>Chart-diagrams</code>:</p>\n\n<pre><code>build-depends:       base\n                     ...\n                     , Chart\n                     , Chart-diagrams\n</code></pre>\n\n<p>And then in your evaluation function:</p>\n\n<pre><code>setImportsQ[ (\"Prelude\",Nothing)\n           , (\"Graphics.Rendering.Chart.Easy\", Nothing)\n           , (\"Graphics.Rendering.Chart.Backend.Diagrams\", Nothing)\n           ]\n</code></pre>\n"}], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 167, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1481819385, "creation_date": 1473090244, "question_id": 39333946, "link": "https://stackoverflow.com/questions/39333946/is-it-possible-to-load-compiled-code-to-hint", "title": "Is it possible to load compiled code to hint?", "body": "<p>I have a library and I want my executable to be pretty much what I get when I <code>cabal repl</code> it, i.e. I want the user to be able to use Haskell expressions, and import the modules and use the data types that are defined in my library.</p>\n\n<p>Is it possible? I get the idea that <code>hint</code> can only work with source files (which are not available to the user), but I'm not certain. When I tried to load modules from my library or from cabal packages that are globally installed, I got a vague error message saying that the module is a package module. In fact, almost whatever I write will do that too:</p>\n\n<pre><code>ghci&gt; runInterpreter $ loadModules [\"Not.A.Package.Module\"]\nLeft (WontCompile [GhcError {errMsg = \"&lt;no location info&gt;: error:\\n    module \\8216Not.A.Package.Module\\8217 is a package module\"}])\n</code></pre>\n\n<p>Is there any way to do this? (P.S. I'm using GHC 8.0.1 and <code>plugins</code> isn't supporting it, and I also got the idea it's a very dead project. If there's another way but <code>hint</code> &amp; <code>plugins</code> I'm open to it).</p>\n"}, {"tags": ["haskell", "monads", "free-monad"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473090888, "post_id": 39333675, "comment_id": 65999495, "body": "Can you add an example of how you&#39;d like to use these functions?"}, {"owner": {"reputation": 107, "user_id": 6743841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294832dd90389a3d25f99f2d92139214?s=128&d=identicon&r=PG&f=1", "display_name": "venu gangireddy", "link": "https://stackoverflow.com/users/6743841/venu-gangireddy"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473091294, "post_id": 39333675, "comment_id": 65999685, "body": "@Bergi example is added, please note that this program not yet compiled, so please expect some bugs"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1473091522, "post_id": 39333675, "comment_id": 65999789, "body": "I don&#39;t see in that example why or how the type of an annoying output would be any different from an ordinary output? What do you mean by &quot;<i>will take some thing and return String message</i>&quot;?"}, {"owner": {"reputation": 107, "user_id": 6743841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294832dd90389a3d25f99f2d92139214?s=128&d=identicon&r=PG&f=1", "display_name": "venu gangireddy", "link": "https://stackoverflow.com/users/6743841/venu-gangireddy"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473091578, "post_id": 39333675, "comment_id": 65999819, "body": "I edited it again, please refresh question"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473092080, "post_id": 39333675, "comment_id": 66000055, "body": "My hunch would be that the type is <code>String</code> and the function is <code>id</code>, but I&#39;m not sure"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473092295, "post_id": 39333675, "comment_id": 66000160, "body": "Btw your <code>runToy</code> seems to miss the <code>Pure</code> case"}, {"owner": {"reputation": 107, "user_id": 6743841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294832dd90389a3d25f99f2d92139214?s=128&d=identicon&r=PG&f=1", "display_name": "venu gangireddy", "link": "https://stackoverflow.com/users/6743841/venu-gangireddy"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473092328, "post_id": 39333675, "comment_id": 66000177, "body": "Yes, something wrong with <code>runToy</code> Errors :      1. Couldn&#39;t match expected type \u2018Free (Toy a) r -&gt; String\u2019                                                                                                                                                  with actual type \u2018[Char]\u2019     2. Couldn&#39;t match expected type \u2018[Char]\u2019                                                                                                                                                                    with actual type \u2018Free (Toy a0) r0 -&gt; String\u2019"}, {"owner": {"reputation": 107, "user_id": 6743841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294832dd90389a3d25f99f2d92139214?s=128&d=identicon&r=PG&f=1", "display_name": "venu gangireddy", "link": "https://stackoverflow.com/users/6743841/venu-gangireddy"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1473092837, "post_id": 39333675, "comment_id": 66000391, "body": "@Bergi Pure case added, still unable resolve above errors. any suggestions?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1473098913, "post_id": 39333675, "comment_id": 66002780, "body": "There are examples of how to write things like <code>annoyingOutput</code> in the answer to <a href=\"http://stackoverflow.com/q/23766419/414413\">this related question</a>. <code>annoyingOutput</code> will look like <code>add</code>."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1473111732, "post_id": 39333675, "comment_id": 66007212, "body": "The <code>$</code> in <code>runToy $ f &quot;blah blah blah \\n&quot;</code> should be replaced <code>runToy (f &quot;blah blah blah \\n&quot;)</code>"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1473111890, "post_id": 39333675, "comment_id": 66007258, "body": "The type is <code>annoyingOutput :: a -&gt; Free (Toy a) String; annoyingOutput x = liftF $ AnnoyingOutput x id</code>. This means that properly the run function should have access to a source of Strings where you just keep feeding it <code>&quot;blah blah blah \\n&quot;</code>"}, {"owner": {"reputation": 107, "user_id": 6743841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294832dd90389a3d25f99f2d92139214?s=128&d=identicon&r=PG&f=1", "display_name": "venu gangireddy", "link": "https://stackoverflow.com/users/6743841/venu-gangireddy"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1473167840, "post_id": 39333675, "comment_id": 66029679, "body": "@Michael thanks for the tip, actually it helped a lot. Can you please explain the difference between <code>runToy $ f &quot;blah blah blah \\n&quot;</code> should be replaced <code>runToy (f &quot;blah blah blah \\n&quot;)</code>? in general <code>$</code> and <code>()</code> can be replaceable, why it is different in this case?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1473178118, "post_id": 39333675, "comment_id": 66036698, "body": "venu, it&#39;s just the ultra-low precedence of <code>$</code> is interfering with what you want which is something shaped like <code>... ++ ... ++ ...</code> The <code>$</code> has <code>infixr 0</code> so ghc is reading it as the dominant connective in the expression, so as something shaped like <code>... $ ...</code> which then it can&#39;t understand. You want the $ to be to be restricted to the last thing appended - you could also write <code>(runToy $ f &quot;blah blah blah \\n&quot;)</code> to control the <code>$</code>, but once you use parantheses you might as well put them around <code>(f &quot;blah ..)</code>. You can query precedence in the ghci with <code>:i ++</code> or <code>:info $</code> or the like."}], "owner": {"reputation": 107, "user_id": 6743841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/294832dd90389a3d25f99f2d92139214?s=128&d=identicon&r=PG&f=1", "display_name": "venu gangireddy", "link": "https://stackoverflow.com/users/6743841/venu-gangireddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1473168090, "creation_date": 1473089140, "last_edit_date": 1473168090, "question_id": 39333675, "link": "https://stackoverflow.com/questions/39333675/free-monad-extending-toy-example", "title": "Free monad extending toy example", "body": "<p>I am trying to extend toy example explained in this <a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\" rel=\"nofollow\">blog post</a>.</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nmodule FreeToy where\n\nimport Control.Monad.State\nimport Control.Monad.Free\nimport Data.Map (Map)\nimport qualified Data.Map as M\n\n\n-- defining commands\ndata Toy a next = \n          Output a next\n        | AnnoyingOutput a (String -&gt; next)\n        | Done\n        deriving (Functor)\n\n-- lifing commands to free monad level\noutput :: a -&gt; Free (Toy a) ()\noutput x = liftF $ Output x ()\n\nannoyingOutput :: a -&gt; Free (Toy a) {-some type-}\nannoyingOutput x = liftF $ AnnoyingOutput x {-some function-}\n\ndone :: Free (Toy a) r\ndone = liftF $ Done\n\n-- defining one of the interpreter\nrunToy :: (Show a, Show r) =&gt; Free (Toy a) r -&gt; String\nrunToy (Free (Output a x)) =\n    \"output \" ++ show a ++ \"\\n\" ++ runToy x\nrunToy (Free (AnnoyingOutput a f)) = \n    \"annoying output \" ++ show a ++ runToy (f \"blah blah blah \\n\")\nrunToy (Free Done) =\n    \"done\\n\"\nrunToy (Pure r) =\n    \"return \" ++ show r ++ \"\\n\"\n</code></pre>\n\n<p>The new thing I tried to add is <code>AnnoyingOutput a (String -&gt; next)</code> this will take some thing and return String message. I am struct while lifting it to Free monad level using <code>liftF</code> function. Please help me to fill the blanks, and proper explanation is appreciable. </p>\n\n<p>Edit: Adding example</p>\n\n<pre><code>module Main where\n\nimport FreeToy\nimport Control.Monad.Free\n\nprogram ::  Free (Toy String) ()\n\nprogram = do\n      output \"something\"\n      x &lt;- annoyingOutput \"something else\"\n      output x\n      done\n\nmain :: IO ()\nmain = putStrLn $ runToy program\n</code></pre>\n"}, {"tags": ["haskell", "rabbitmq", "amqp"], "comments": [{"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1473194134, "post_id": 39333441, "comment_id": 66044720, "body": "Your snippet does not reproduce the error for me. It loads and runs. This is on ghci 7.10.2, from stack resolver lts-3.10, which gives me amqp 0.13.0 and network 2.6.2.1."}], "owner": {"reputation": 37, "user_id": 5668331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81e3719e1a05b62f6f303ec98e6d5e14?s=128&d=identicon&r=PG&f=1", "display_name": "JackFreedom", "link": "https://stackoverflow.com/users/5668331/jackfreedom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1473088208, "creation_date": 1473088208, "question_id": 39333441, "link": "https://stackoverflow.com/questions/39333441/cant-get-the-right-portnumber-type-in-the-connectionoptions-data-type-coserver", "title": "Can&#39;t get the right PortNumber type in the connectionOptions data type (coServers)", "body": "<p>So I am using the Network.AMQP library in Haskell and I am trying to connect to a broker via the openConnection'' function which requires a ConnectionOpts structure which itself takes a list of tuples of Strings and PortNumbers in the coServers field. I wanted to make this in a seperate function which takes a String (the host name) and a PortNumber. So far so good. But when i try to insert those parameters in the coServers field then I get the error like this: </p>\n\n<p>Couldn't match expected type <code>network-2.6.2.1:Network.Socket.Types.PortNumber' with actual type</code>PortNumber'\nIn the expression: port\nIn the expression: (host, port)\nIn the `coServers' field of a record</p>\n\n<p>here is a snippet that reproduces the error (not my actual program but this one runs into the exact same problem and is much shorter.)</p>\n\n<pre><code>import Network\nimport Network.AMQP\n\n\nmain :: IO()\nmain = do\n  publisher1 \"127.0.0.1\" 5555\n\n\npublisher1 :: String -&gt; PortNumber -&gt; IO ()\npublisher1 host port = do\n  conn &lt;- openConnection'' defaultConnectionOpts {coServers = [(host, port)] , coHeartbeatDelay = Just 30}\n  chn &lt;- openChannel conn\n  return ()\n</code></pre>\n\n<p>so after I tried some other PortNumber types I know and I can actually import  (i.e. Network.Socket, Network.Socket.Internal ...) and after I looked at the library source code , I tried to find out  where this \"special\" PortNumber is comming from (I know, eventually it is coming from Network.Socket.Type as the error message suggests but the Network.AMQP isn't importing this one either). So I cloned the repository and tried to compile it and well, it worked, as suspected. I commented out the imported Network library (the one that's named Network) and then I became the error message that the Type PortNumber is not in scope. Also as to be expected. </p>\n\n<p>So it should work with the Network library ,but why is my program not getting the \"right\" type (or to be precise why do I get this type inferred from ghc?)</p>\n\n<p>My problem is not that i can't get it working. I can circumvent this problem  when I change the type of the function to String -> Integer -> IO() and add the line </p>\n\n<p>let goodPort = fromInteger port </p>\n\n<p>and change the port parameter in coservers to goodPort it works.</p>\n\n<p>But I really , REALLY want to know why this is happening and how I can solve this problem more elegantly. </p>\n"}, {"tags": ["haskell", "gadt"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473089718, "post_id": 39328175, "comment_id": 65998882, "body": "Your datatype contains arbitrary function types - which you cannot serialize - so you cannot hope to get the interface you want here. <code>saveState</code> is useless w/o the ability to serialize the graph itself. The first step is to identify what you actually wish to model - the only functions you use in an &#39;edge&#39; function are the constant function and <code>if</code>, and if this is representative if your general use case, then modelling this will probably be quite easy. If you really want to model a &#39;graph&#39; (nodes &amp; edges) with the additional type safety constraints then this is tougher."}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473090241, "post_id": 39328175, "comment_id": 65999169, "body": "I am looking for a general solution. I can imagine more complex <code>Edge</code>s that select the next subgraph depending on the current state <code>s</code> and latest answer <code>a</code>. A real life <code>Edge</code> might even use database connections etc. and return the subgraph in an <code>IO (Edge s&#39; sf)</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1473092103, "post_id": 39328175, "comment_id": 66000064, "body": "One does not &#39;select&#39; which node to &#39;go to&#39; in a graph - each node is simply connected to a (possibly empty) set of nodes. The <i>value semantics</i> of a node somehow &#39;producing&#39; a value on which to transition, and the transition itself, are not part of the graph structure - rather you simply have a graph whose nodes and edges are labelled by things which you interpret (in your domain) to be &#39;states&#39; and &#39;transitions&#39;. i.e. your <i>edge</i> is <code>e1 = Edge n1 [n2,n3]</code> but your <i>edge label</i> is the function <code>\\b -&gt; if b ...</code> - the <i>shape</i> of this graph can be serialized easily even if the labels cannot."}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1473154395, "post_id": 39328175, "comment_id": 66020879, "body": "In <code>e1 = Edge n1 [n2,n3]</code> <code>n2</code> and <code>n3</code> may not be of the same type, they have same input but different outputs. (but <code>n1 &gt;&gt;&gt;= n2 &gt;&gt;&gt;= nf</code> and <code>n1 &gt;&gt;&gt;= n3 &gt;&gt;&gt;= n4 &gt;&gt;&gt;= nf</code> are of the same type with same input and output)."}], "answers": [{"comments": [{"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1473154050, "post_id": 39331124, "comment_id": 66020627, "body": "Indexed state monad is a brilliant solution. How can I cast my current state to <code>Stage</code>?"}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1473156216, "post_id": 39331124, "comment_id": 66022023, "body": "Is this in the right direction? <code>interaction&#39; machine stage as = (\\ (r, _) -&gt; Suspended stage r) &lt;$&gt; runIState machine as</code>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1473158104, "post_id": 39331124, "comment_id": 66023208, "body": "I was thinking that you&#39;d insert calls to <code>suspend</code> in your monadic computation directly."}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1473159519, "post_id": 39331124, "comment_id": 66024110, "body": "OK, I see <code>(suspend AskWeight &gt;&gt;&gt; askWeight) &gt;&gt;&gt; ...</code>"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1473159602, "post_id": 39331124, "comment_id": 66024185, "body": "@homam Exactly."}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 1, "creation_date": 1473165474, "post_id": 39331124, "comment_id": 66028106, "body": "We can easily reduce duplication by recursively calling <code>resume</code>: <code>resume (Suspended AskWeight e) = iput e &gt;&gt;&gt; askWeight &gt;&gt;&gt; iget &gt;&gt;&gt;= (resume . Suspended AskHeight)</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 2, "creation_date": 1473185475, "post_id": 39331124, "comment_id": 66040557, "body": "@homam, to represent your computation more explicitly (if that&#39;s something you want to do), take a look at &quot;Reflection Without Remorse&quot; and its associated type-aligned sequences. That describes the &quot;initial encoding&quot; Benjamin Hodgson mentioned."}, {"owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "edited": false, "score": 0, "creation_date": 1473347270, "post_id": 39331124, "comment_id": 66114990, "body": "After each question, I want to terminate the flow before user input. Is it the right approach to change the state to <code>Maybe</code>, for example: <code>askColour :: StateMachine as (Maybe Colour, as) ()</code> and <code>askColour = ilift (...) &gt;&gt;&gt; imodify (Nothing, )</code>? I will also introduce an answer function: <code>answer :: String -&gt; Suspended -&gt; StateMachine as FinalResult ()</code>"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 7, "last_activity_date": 1473166889, "last_edit_date": 1495542797, "creation_date": 1473080229, "answer_id": 39331124, "question_id": 39328175, "link": "https://stackoverflow.com/questions/39328175/type-safe-flow-state-machine/39331124#39331124", "title": "Type-safe Flow (State Machine)", "body": "<p>For the purposes of having a simple example to explain, I'm going to show you a solution which doesn't have natural support for suspending, persisting and resuming computations. At the end I'll give you the gist of how to add that in - hopefully you'll be able to figure out the nitty gritty of it yourself.</p>\n\n<hr>\n\n<p>Here's the so-called <em>indexed state monad</em>:</p>\n\n<pre><code>newtype IStateT m i o a = IStateT { runIState :: i -&gt; m (o, a) }\n</code></pre>\n\n<p><code>IStateT</code> is like a regular state monad transformer, except that the type of the implicit state is allowed to change throughout the course of a computation. Sequencing actions in the indexed state monad requires that the output state of one action matches the input state of the next. This sort of domino-like sequencing is what <a href=\"http://bentnib.org/paramnotions-jfp.pdf\" rel=\"nofollow noreferrer\">Atkey's <em>parameterised monad</em></a> (or <a href=\"https://stackoverflow.com/questions/28690448/what-is-indexed-monad\"><em>indexed monad</em></a>) is for.</p>\n\n<pre><code>class IMonad m where\n    ireturn :: a -&gt; m i i a\n    (&gt;&gt;&gt;=) :: m i j a -&gt; (a -&gt; m j k b) -&gt; m i k b\n\n(&gt;&gt;&gt;) :: IMonad m =&gt; m i j a -&gt; m j k b -&gt; m i k b\nmx &gt;&gt;&gt; my = mx &gt;&gt;&gt;= \\_ -&gt; my\n</code></pre>\n\n<p><code>IMonad</code> is the class of monad-like things which describe a path through an indexed graph. The type of <code>(&gt;&gt;&gt;=)</code> says \"If you have a computation which goes from <code>i</code> to <code>j</code> and a computation from <code>j</code> to <code>k</code>, I can join them up to give you a computation from <code>i</code> to <code>k</code>\".</p>\n\n<p>We'll also need to lift computations from classical monads into indexed monads:</p>\n\n<pre><code>class IMonadTrans t where\n    ilift :: Monad m =&gt; m a -&gt; t m i i a\n</code></pre>\n\n<p>Note that the code for <code>IStateT</code> is just the same as the code for the regular state monad - it's just the types that have got smarter.</p>\n\n<pre><code>iget :: Monad m =&gt; IStateT m s s s\niget = IStateT $ \\s -&gt; return (s, s)\n\niput :: Monad m =&gt; o -&gt; IStateT m i o ()\niput x = IStateT $ \\_ -&gt; return (x, ())\n\nimodify :: Monad m =&gt; (i -&gt; o) -&gt; IStateT m i o ()\nimodify f = IStateT $ \\s -&gt; return (f s, ())\n\ninstance Monad m =&gt; IMonad (IStateT m) where\n    ireturn x = IStateT (\\s -&gt; return (s, x))\n    IStateT f &gt;&gt;&gt;= g = IStateT $ \\s -&gt; do\n                                    (s', x) &lt;- f s\n                                    let IStateT h = g x\n                                    h s'\ninstance IMonadTrans IStateT where\n    ilift m = IStateT $ \\s -&gt; m &gt;&gt;= \\x -&gt; return (s, x)\n</code></pre>\n\n<p>The idea is that monadic actions like <code>askSize</code> and <code>askWeight</code> (below) will <em>add some data to the implicit environment</em>, growing its type. So I'm going to build the implicit environment out of nested tuples, treating them as type-level lists of types. Nested tuples are more flexible (though less efficient) than flat tuples, because they allow you to abstract over the tail of the list. This allows you to build tuples of arbitrary size.</p>\n\n<pre><code>type StateMachine = IStateT IO\n\nnewtype Size = Size Int\nnewtype Height = Height Int\nnewtype Weight = Weight Int\nnewtype Colour = Colour String\n\n-- askSize takes an environment of type as and adds a Size element\naskSize :: StateMachine as (Size, as) ()\naskSize = askNumber \"What is your size?\" Size\n\n-- askHeight takes an environment of type as and adds a Height element\naskHeight :: StateMachine as (Height, as) ()\naskHeight = askNumber \"What is your height?\" Height\n\n-- etc\naskWeight :: StateMachine as (Weight, as) ()\naskWeight = askNumber \"What is your weight?\" Weight\n\naskColour :: StateMachine as (Colour, as) ()\naskColour =\n    -- poor man's do-notation. You could use RebindableSyntax\n    ilift (putStrLn \"What is your favourite colour?\") &gt;&gt;&gt;\n    ilift readLn                                      &gt;&gt;&gt;= \\answer -&gt;\n    imodify (Colour answer,)\n\ncalculateSize :: Height -&gt; Weight -&gt; Size\ncalculateSize (Height h) (Weight w) = Size (h - w)  -- or whatever the calculation is\n\naskNumber :: String -&gt; (Int -&gt; a) -&gt; StateMachine as (a, as) ()\naskNumber question mk =\n    ilift (putStrLn question) &gt;&gt;&gt;\n    ilift readLn              &gt;&gt;&gt;= \\answer -&gt;\n    case reads answer of\n        [(x, _)] -&gt; imodify (mk x,)\n        _ -&gt; ilift (putStrLn \"Please type a number\") &gt;&gt;&gt; askNumber question mk\n\naskYN :: String -&gt; StateMachine as as Bool\naskYN question =\n    ilift (putStrLn question) &gt;&gt;&gt;\n    ilift readLn              &gt;&gt;&gt;= \\answer -&gt;\n    case answer of\n        \"y\" -&gt; ireturn True\n        \"n\" -&gt; ireturn False\n        _ -&gt; ilift (putStrLn \"Please type y or n\") &gt;&gt;&gt; askYN question\n</code></pre>\n\n<p>My implementation differs from your specification slightly. You say it should be <em>impossible</em> to ask for the user's size and then ask for their weight. I say it should be possible - the result just won't necessarily have the type you wanted (because you've added two things to the environment, not one). This comes in useful here, where <code>askOrCalculateSize</code> is just a black box which adds a <code>Size</code> (and nothing else) to an environment. Sometimes it does it by asking for the size directly; sometimes it calculates it by first asking for the height and the weight. It doesn't matter as far as the type-checker is concerned.</p>\n\n<pre><code>interaction :: StateMachine xs (Colour, (Size, xs)) ()\ninteraction =\n    askYN \"Do you know your size?\" &gt;&gt;&gt;= \\answer -&gt;\n    askOrCalculateSize answer &gt;&gt;&gt;\n    askColour\n\n    where askOrCalculateSize True = askSize\n          askOrCalculateSize False =\n            askWeight &gt;&gt;&gt;\n            askHeight &gt;&gt;&gt;\n            imodify (\\(h, (w, xs)) -&gt; ((calculateSize h w), xs))\n</code></pre>\n\n<hr>\n\n<p>There's a question remaining: how can one <em>resume</em> a computation from a persisted state? You don't statically know the type of the input environment (though it's safe to assume the output is always <code>(Colour, Size)</code>) because it varies throughout the computation, and you don't know until you load the persisted state where it was up to.</p>\n\n<p>The trick is to use a bit of GADT evidence which you can pattern-match on to <em>learn</em> what the type was. <code>Stage</code> represents where you could've got up to in the process, and it's indexed by the type that the environment should have by that stage. <code>Suspended</code> pairs up a <code>Stage</code> with the actual data that was in the environment at the point that the computation was suspended.</p>\n\n<pre><code>data Stage as where\n    AskSize :: Stage as\n    AskWeight :: Stage as\n    AskHeight :: Stage (Weight, as)\n    AskColour :: Stage (Size, as)\n\ndata Suspended where\n    Suspended :: Stage as -&gt; as -&gt; Suspended\n\nresume :: Suspended -&gt; StateMachine as (Colour, (Size, as)) ()\nresume (Suspended AskSize e) =\n    iput e                                               &gt;&gt;&gt;\n    askSize                                              &gt;&gt;&gt;\n    askColour\nresume (Suspended AskWeight e) =\n    iput e                                               &gt;&gt;&gt;\n    askWeight                                            &gt;&gt;&gt;\n    askHeight                                            &gt;&gt;&gt;\n    imodify (\\(h, (w, xs)) -&gt; ((calculateSize h w), xs)) &gt;&gt;&gt;\n    askColour\nresume (Suspended AskHeight e) =\n    iput e                                               &gt;&gt;&gt;\n    askHeight                                            &gt;&gt;&gt;\n    imodify (\\(h, (w, xs)) -&gt; ((calculateSize h w), xs)) &gt;&gt;&gt;\n    askColour\nresume (Suspended AskColour e) =\n    iput e                                               &gt;&gt;&gt;\n    askColour\n</code></pre>\n\n<p>Now you can add suspension points to the computation:</p>\n\n<pre><code>-- given persist :: Suspended -&gt; IO ()\nsuspend :: Stage as -&gt; StateMachine as as ()\nsuspend stage =\n    iget                                  &gt;&gt;&gt;= \\env\n    ilift (persist (Suspended stage env))\n</code></pre>\n\n<p><code>resume</code> works, but it's pretty ugly and has a lot of code duplication. This is because once you've put a state monad together you can't take it apart again to look inside it. You can't jump in at a given point in the computation. This is the big advantage of your original design, wherein you represented the state machine as a data structure which can be queried in order to figure out how to resume the computation. This is called an <em>initial</em> encoding, whereas my example (representing the state machine as a function) is a <em>final</em> encoding. Final encodings are simple but initial encodings are flexible. Hopefully you can see how to adapt an initial approach to the indexed monad design.</p>\n"}], "owner": {"reputation": 1747, "user_id": 343761, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cf716ff342bad8a3aa8178ab9b39366d?s=128&d=identicon&r=PG", "display_name": "homam", "link": "https://stackoverflow.com/users/343761/homam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 544, "favorite_count": 5, "accepted_answer_id": 39331124, "answer_count": 1, "score": 13, "last_activity_date": 1473166889, "creation_date": 1473069780, "last_edit_date": 1473073052, "question_id": 39328175, "link": "https://stackoverflow.com/questions/39328175/type-safe-flow-state-machine", "title": "Type-safe Flow (State Machine)", "body": "<p>I am trying to create a type-safe Question-Answer flow in Haskell. I am modeling QnA as a directed graph, similar to a FSM.</p>\n\n<p>Each node in the graph represent a question:</p>\n\n<pre><code>data Node s a s' = Node {\n  question :: Question a,\n  process :: s -&gt; a -&gt; s'\n}\n</code></pre>\n\n<p><code>s</code> is the input state, <code>a</code> is the answer to the question and <code>s'</code> is the output state. Nodes depend on the input state <code>s</code>, meaning that for processing the answer we have to be a in a particular state before. </p>\n\n<p><code>Question a</code> represent a simple question / answer producing an answer of type <code>a</code>.</p>\n\n<p>By type-safe I mean, for example given a node <code>Node2 :: si -&gt; a -&gt; s2</code>, if <code>si</code> depends on <code>s1</code> then all the paths ending with <code>Node2</code> must be passing through a node that produces <code>s1</code> first. (If <code>s1 == si</code> then all predecessors of <code>Node2</code>  must be producing <code>s1</code>).</p>\n\n<p><strong>An Example</strong></p>\n\n<p>QnA: In an online shopping website, we need to ask user's body size and favorite color.</p>\n\n<ol>\n<li><code>e1</code>: ask user if they know their size. If yes then go to <code>e2</code> otherwise go to <code>e3</code></li>\n<li><code>e2</code>: ask user's size and go to <code>ef</code> to ask the color.</li>\n<li><code>e3</code>: (user doesn't know their size), ask user's weight and go to <code>e4</code>.</li>\n<li><code>e4</code>: (after <code>e3</code>) ask user's height and calculate their size and go to <code>ef.</code></li>\n<li><code>ef</code>: ask user's favorite color and finish the flow with the <code>Final</code> result.</li>\n</ol>\n\n<p>In my model, <code>Edge</code>s connect <code>Node</code>s to each other:</p>\n\n<pre><code>data Edge s sf where\n  Edge  :: EdgeId -&gt; Node s a s' -&gt; (s' -&gt; a -&gt; Edge s' sf) -&gt; Edge s sf\n  Final :: EdgeId -&gt; Node s a s' -&gt; (s' -&gt; a -&gt; sf) -&gt; Edge s sf\n</code></pre>\n\n<p><code>sf</code> is the final result of the QnA, that here is: <code>(Bool, Size, Color)</code>.</p>\n\n<p>The QnA state at each moment can be represented by a tuple: <code>(s, EdgeId)</code>. This state is serializable and we should be able to continue a QnA by just knowing this state.</p>\n\n<pre><code>saveState :: (Show s) =&gt; (s, Edge s sf) -&gt; String\nsaveState (s, Edge eid n _) = show (s, eid)\n\ngetEdge :: EdgeId -&gt; Edge s sf\ngetEdge = undefined --TODO\n\nrespond :: s -&gt; Edge s sf -&gt; Input -&gt; Either sf (s', Edge s' sf)\nrespond s (Edge ...) input = Right (s', Edge ...)\nrespond s (Final ...) input = Left s' -- Final state\n\n-- state = serialized (s, EdgeId)\n-- input = user's answer to the current question\nmain' :: String -&gt; Input -&gt; Either sf (s', Edge s' sf)\nmain' state input =\n  let (s, eid) = read state :: ((), EdgeId) --TODO\n      edge = getEdge eid\n  in respond s input edge\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/9bSVu.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/9bSVu.png\" alt=\"Flow for determining user&#39;s dress size\"></a></p>\n\n<p>Full code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs, RankNTypes, TupleSections #-}\n\ntype Input = String\ntype Prompt = String\ntype Color = String\ntype Size = Int\ntype Weight = Int\ntype Height = Int\n\ndata Question a = Question {\n  prompt :: Prompt,\n  answer :: Input -&gt; a\n}\n\n-- some questions \ndoYouKnowYourSizeQ :: Question Bool\ndoYouKnowYourSizeQ = Question \"Do you know your size?\" read\n\nwhatIsYourSizeQ :: Question Size\nwhatIsYourSizeQ = Question \"What is your size?\" read\n\nwhatIsYourWeightQ :: Question Weight\nwhatIsYourWeightQ = Question \"What is your weight?\" read\n\nwhatIsYourHeightQ :: Question Height\nwhatIsYourHeightQ = Question \"What is your height?\" read\n\nwhatIsYourFavColorQ :: Question Color\nwhatIsYourFavColorQ = Question \"What is your fav color?\" id\n\n-- Node and Edge\n\ndata Node s a s' = Node {\n  question :: Question a,\n  process :: s -&gt; a -&gt; s'\n}\n\ndata Edge s sf where\n  Edge  :: EdgeId -&gt; Node s a s' -&gt; (s' -&gt; a -&gt; Edge s' sf) -&gt; Edge s sf\n  Final :: EdgeId -&gt; Node s a s' -&gt; (s' -&gt; a -&gt; sf) -&gt; Edge s sf\n\ndata EdgeId = E1 | E2 | E3 | E4 | Ef deriving (Read, Show)\n\n-- nodes\n\nn1 :: Node () Bool Bool\nn1 = Node doYouKnowYourSizeQ (const id)\n\nn2 :: Node Bool Size (Bool, Size)\nn2 = Node whatIsYourSizeQ (,)\n\nn3 :: Node Bool Weight (Bool, Weight)\nn3 = Node whatIsYourWeightQ (,)\n\nn4 :: Node (Bool, Weight) Height (Bool, Size)\nn4 = Node whatIsYourHeightQ (\\ (b, w) h -&gt; (b, w * h))\n\nn5 :: Node (Bool, Size) Color (Bool, Size, Color)\nn5 = Node whatIsYourFavColorQ (\\ (b, i) c -&gt; (b, i, c))\n\n\n-- type-safe edges\n\ne1 = Edge E1 n1 (const $ \\ b -&gt; if b then e2 else e3)\ne2 = Edge E2 n2 (const $ const ef)\ne3 = Edge E3 n3 (const $ const e4)\ne4 = Edge E4 n4 (const $ const ef)\nef = Final Ef n5 const\n\n\nask :: Edge s sf -&gt; Prompt\nask (Edge _ n _) = prompt $ question n\nask (Final _ n _) = prompt $ question n\n\nrespond :: s -&gt; Edge s sf -&gt; Input -&gt; Either sf (s', Edge s' sf)\nrespond s (Edge _ n f) i =\n  let a  = (answer $ question n) i\n      s' = process n s a\n      n' = f s' a\n  in Right undefined --TODO n'\n\nrespond s (Final _ n f) i =\n  let a  = (answer $ question n) i\n      s' = process n s a\n  in Left undefined --TODO s'\n\n\n-- User Interaction:\n\nsaveState :: (Show s) =&gt; (s, Edge s sf) -&gt; String\nsaveState (s, Edge eid n _) = show (s, eid)\n\ngetEdge :: EdgeId -&gt; Edge s sf\ngetEdge = undefined --TODO\n\n-- state = serialized (s, EdgeId) (where getEdge :: EdgeId -&gt; Edge s sf)\n-- input = user's answer to the current question\nmain' :: String -&gt; Input -&gt; Either sf (s', Edge s' sf)\nmain' state input =\n  let (s, eid) = undefined -- read state --TODO\n      edge = getEdge eid\n  in respond s edge input\n</code></pre>\n\n<p>It's important for me to keep the edges type-safe. Meaning for instance incorrectly linking <code>e2</code> to <code>e3</code> must be a type error: <code>e2 = Edge E2 n2 (const $ const ef)</code> is fine by <code>e2 = Edge E2 n2 (const $ const e3)</code> must be an error.</p>\n\n<p>I have indicated my questions with <code>--TOOD</code>:</p>\n\n<ul>\n<li><p>Given my criteria for keeping edges type-safe, <code>Edge s sf</code> must have an input type variable (<code>s</code>) then how can I create <code>getEdge :: EdgeId -&gt; Edge s sf</code> function?</p></li>\n<li><p>How can I create the <code>respond</code> function that given the current state <code>s</code> and current edge <code>Edge s sf</code>, will return either the final state (if current edge is <code>Final</code>) or the next state and the next edge <code>(s', Edge s' sf)</code>?</p></li>\n</ul>\n\n<p>My design of <code>Node s a s'</code> and <code>Edge s sf</code> might be simply wrong. I don't have to stick with it.</p>\n"}, {"tags": ["haskell", "stream", "lazy-evaluation"], "answers": [{"comments": [{"owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "edited": false, "score": 1, "creation_date": 1473074575, "post_id": 39328486, "comment_id": 65990407, "body": "Your first definition looks very familiar that I must have seen it before. I guess it was in SICP"}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 7, "last_activity_date": 1477486013, "last_edit_date": 1477486013, "creation_date": 1473070841, "answer_id": 39328486, "question_id": 39327656, "link": "https://stackoverflow.com/questions/39327656/fail-to-define-an-infinite-stream/39328486#39328486", "title": "Fail to define an infinite stream", "body": "<p>Your interleaving function is too strict. The following works:</p>\n\n<pre><code>interleaveStreams (Cons x xs) ys = Cons x (interleaveStreams ys xs)\n</code></pre>\n\n<p>This also works:</p>\n\n<pre><code>interleaveStreams (Cons x xs) ~(Cons y ys) = \n    Cons x (Cons y (interleaveStreams xs ys))\n</code></pre>\n\n<p>The original definition goes into infinite loop because <code>interleaveStreams</code> demands that both arguments must be of <code>Cons</code> forms. <code>infInterStream n</code> evaluates to the the interleaving of two streams, and the first one can be immediately evaluated to <code>Cons</code>, but the second one must also be reduced  first to <code>Cons</code>, so we recursively call <code>infInterStream (n + 1)</code>, which keeps calling itself ad infinitum. </p>\n\n<p>If <code>interleaveStreams</code> can return a <code>Cons a _</code> without first having to force the second argument, <code>infInterStream</code> can also incrementally build the result.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1484339544, "post_id": 39397505, "comment_id": 70485840, "body": "Using a separate stream type makes it locally obvious that pattern matches are complete, so I think it&#39;s better that way."}, {"owner": {"reputation": 580, "user_id": 2466383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550ba434909acd5357b9defb56e7254a?s=128&d=identicon&r=PG", "display_name": "Mike Spivey", "link": "https://stackoverflow.com/users/2466383/mike-spivey"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1484425217, "post_id": 39397505, "comment_id": 70507776, "body": "Yes, you can do that if you like: but then you need to redefine all the standard functions (like <code>repeat</code> and <code>map</code> above) for streams.  Compromise is the essence of engineering."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1484519621, "post_id": 39397505, "comment_id": 70532254, "body": "That&#39;s why we have Hackage! The code has already been written."}, {"owner": {"reputation": 580, "user_id": 2466383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550ba434909acd5357b9defb56e7254a?s=128&d=identicon&r=PG", "display_name": "Mike Spivey", "link": "https://stackoverflow.com/users/2466383/mike-spivey"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1484557958, "post_id": 39397505, "comment_id": 70543186, "body": "Why do I get the impression you are trying to pick a fight?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1484599430, "post_id": 39397505, "comment_id": 70566455, "body": "Not trying to pick a fight. It just looked to me like the OP set things up very nicely, and you seemed to brush that aside as extra work."}], "tags": [], "owner": {"reputation": 580, "user_id": 2466383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550ba434909acd5357b9defb56e7254a?s=128&d=identicon&r=PG", "display_name": "Mike Spivey", "link": "https://stackoverflow.com/users/2466383/mike-spivey"}, "is_accepted": false, "score": 1, "last_activity_date": 1484335958, "last_edit_date": 1484335958, "creation_date": 1473357928, "answer_id": 39397505, "question_id": 39327656, "link": "https://stackoverflow.com/questions/39327656/fail-to-define-an-infinite-stream/39397505#39397505", "title": "Fail to define an infinite stream", "body": "<p>There's no need for a new type for streams, and we can just use Haskell's lazy lists instead.  As others have noted, the definition of interleave must be sufficiently lazy that it can produce the first element of the output before testing whether the second argument is non-empty.  This definition will do:</p>\n\n<pre><code>interleave (x:xs) ys = x : interleave ys xs\n</code></pre>\n\n<p>If you want <code>interleave</code> to work also for finite lists, you can add the equation</p>\n\n<pre><code>interleave [] ys = ys\n</code></pre>\n\n<p>Note also that, using functions from the standard prelude,</p>\n\n<pre><code>ruler = interleave (repeat 0) (map (+1) ruler)\n</code></pre>\n\n<p>Here <code>repeat 0</code> is the list <code>[0, 0, 0, ...]</code>.      </p>\n"}], "owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 39328486, "answer_count": 2, "score": 3, "last_activity_date": 1484335958, "creation_date": 1473067995, "last_edit_date": 1473070380, "question_id": 39327656, "link": "https://stackoverflow.com/questions/39327656/fail-to-define-an-infinite-stream", "title": "Fail to define an infinite stream", "body": "<p>I'm working on <a href=\"http://www.seas.upenn.edu/%7Ecis194/spring13/hw/06-laziness.pdf\" rel=\"nofollow\">UPENN Haskell Homework 6 Exercise 5</a>, trying to define a <code>ruler function</code></p>\n\n<p><code>0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,...</code></p>\n\n<p>where the nth element in the stream (assuming the first element corresponds to <code>n</code> = 1) is the largest <code>power of 2</code> which evenly divides <code>n</code>.</p>\n\n<p>I just came up with an idea to build it without any divisibility testing:</p>\n\n<pre><code>data Stream x = Cons x (Stream x) deriving (Eq)\n\nstreamRepeat x = Cons x (streamRepeat x)\n\ninterleaveStreams (Cons x xs) (Cons y ys) =\n    Cons x (Cons y (interleaveStreams xs ys))\n\nruler =\n    interleaveStreams (streamRepeat 0)\n        (interleaveStreams (streamRepeat 1)\n            (interleaveStreams (streamRepeat 2)\n                (interleaveStreams (streamRepeat 3) (...))\n</code></pre>\n\n<p>where first 20 element of</p>\n\n<pre><code>ruler =\n    interleaveStreams (streamRepeat 0)\n        (interleaveStreams (streamRepeat 1)\n            (interleaveStreams (streamRepeat 2)\n                (interleaveStreams (streamRepeat 3) (streamRepeat 4))))\n</code></pre>\n\n<p>is</p>\n\n<p><code>[0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2]</code></p>\n\n<p>Obviously I couldn't define it manually to infinite so I defined a <code>infInterStream</code> to help such infinite recursion definition:</p>\n\n<pre><code>infInterStream n = interleaveStreams (streamRepeat n) (infInterStream (n+1))\n\nruler = infInterStream 0\n</code></pre>\n\n<p>But now I get stuck when typing in <code>ruler</code> in <code>ghci</code>, it probably falls into infinite loop.</p>\n\n<p>It shouldn't be if lazy evaluation works. I want to know why lazy evaluation fails here.</p>\n\n<hr>\n\n<p>Helper function to observe <code>Stream</code>:</p>\n\n<pre><code>streamToList (Cons x xs) = x : streamToList xs\n\ninstance Show a =&gt; Show (Stream a) where\n    show = show . take 20 . streamToList\n</code></pre>\n"}, {"tags": ["haskell", "atom-editor", "ghc-mod"], "comments": [{"owner": {"reputation": 12661, "user_id": 5343387, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/15a14cec3014822297a08ed6dfae2563?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Schuchard", "link": "https://stackoverflow.com/users/5343387/matt-schuchard"}, "edited": false, "score": 1, "creation_date": 1473085255, "post_id": 39326733, "comment_id": 65996584, "body": "Can you please reformat your question with stackoverflow markdown instead of github markdown?"}, {"owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "reply_to_user": {"reputation": 12661, "user_id": 5343387, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/15a14cec3014822297a08ed6dfae2563?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Schuchard", "link": "https://stackoverflow.com/users/5343387/matt-schuchard"}, "edited": false, "score": 0, "creation_date": 1473113571, "post_id": 39326733, "comment_id": 66007729, "body": "I have only used stackoverflow markdown."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 6797359, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-myTlgMkVYGg/AAAAAAAAAAI/AAAAAAAAACk/u0XWNHjxtqc/photo.jpg?sz=128", "display_name": "Werner Drange Karlsen", "link": "https://stackoverflow.com/users/6797359/werner-drange-karlsen"}, "is_accepted": false, "score": 0, "last_activity_date": 1473102685, "last_edit_date": 1473102685, "creation_date": 1473098929, "answer_id": 39335764, "question_id": 39326733, "link": "https://stackoverflow.com/questions/39326733/atom-wont-work-with-cabal-file/39335764#39335764", "title": "atom won&#39;t work with .cabal file", "body": "<p>a quick guess, without  a computer to confirm this. did run into a similar situation and delete the build folder  . this happend when I run yesod devel inside the project, and afterward did open the project folder in atom editor, usin ghc-mod on Windows 10. I'll update this answer when I'm back at a computer and learn how to format responses here on stackoverflow. don't delete the build folder if you want to use it later, I assume there is some configuration in the atom addon or in a configuration file for ghc-mod or maybe wrap the ghc-mod configuration to use spesific version  of library. </p>\n"}, {"tags": [], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "is_accepted": false, "score": 0, "last_activity_date": 1473150174, "creation_date": 1473150174, "answer_id": 39344056, "question_id": 39326733, "link": "https://stackoverflow.com/questions/39326733/atom-wont-work-with-cabal-file/39344056#39344056", "title": "atom won&#39;t work with .cabal file", "body": "<p>I upgraded to ghc-mod-5.6.0.0. I also have ghc-mod installed in 3 places. As my PATH points to all 3 I have temporarily renamed those old exe files and only using the latest 5.6.0.0.</p>\n"}], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 215, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1473150174, "creation_date": 1473064763, "last_edit_date": 1473113513, "question_id": 39326733, "link": "https://stackoverflow.com/questions/39326733/atom-wont-work-with-cabal-file", "title": "atom won&#39;t work with .cabal file", "body": "<p>I have been learning haskell using the atom editor on Windows 7. This has worked fine until I created a .cabal file. Now I continuously get red error messages.In fact it is so bad to be unusable as the error messages keep popping up faster than you can delete them. The haskell program is a trivial hello world.</p>\n\n<pre><code>module Main where\n\nmain :: IO ()\nmain = putStrLn \"Hello from Haskell!\"\n</code></pre>\n\n<p>The .cabal file is as follows:</p>\n\n<pre><code>-- Initial hello-haskell.cabal generated by cabal init.  For further\n-- documentation, see http://haskell.org/cabal/users-guide/\n\nname:                hello-haskell\nversion:             0.1.0.0\nsynopsis:            Hello Haskell\ndescription:         Hello Haskell\nlicense:             BSD3\nlicense-file:        LICENSE\nauthor:              Tyrone Faulkner\nmaintainer:          p75213@gmail.com\n-- copyright:\ncategory:            None\nbuild-type:          Simple\nextra-source-files:  ChangeLog.md\ncabal-version:       &gt;=1.10\n\nexecutable hello-haskell\n  main-is:             Main.hs\n  ghc-options:         -Wall -fwarn-tabs\n  -- other-modules:\n  -- other-extensions:\n  build-depends:       base &gt;=4.8 &amp;&amp; &lt;4.9\n  hs-source-dirs:      src\n  default-language:    Haskell2010\n</code></pre>\n\n<p>The error message is as follows:</p>\n\n<p>*[Enter steps to reproduce below:]\n1. ...\n2. ...\n<strong>Atom Version</strong>: 1.8.0\n<strong>System</strong>: Microsoft Windows 7 Professional \n<strong>Thrown From</strong>: <a href=\"https://github.com/atom-haskell/haskell-ghc-mod\" rel=\"nofollow\">haskell-ghc-mod</a> package, v1.17.2</p>\n\n<h3>Stack Trace</h3>\n\n<p>Haskell-ghc-mod: ghc-mod interactive command type failed with error ghc-modi crashed\n<code>At caps: {\"version\":[5,5,0,0],\"fileMap\":true,\"quoteArgs\":true,\"optparse\":true,\"typeConstraints\":false,\"browseParents\":false,\"interactiveCaseSplit\":false} URI: C:\\Users\\Tyrone\\MyProjects\\hello-haskell\\src\\Main.hs Args: --,1,1 message:  log:\n-2.884s: {}\n-2.884s: \"Trying to run ghc-modi in C:\\\\Users\\\\Tyrone\\\\MyProjects\\\\hello-haskell\"\n-2.884s: \"Checking for ghc-modi in C:\\\\Users\\\\Tyrone\\\\MyProjects\\\\hello-haskell\"\n-2.884s: \"Spawning new ghc-modi instance for C:\\\\Users\\\\Tyrone\\\\MyProjects\\\\hello-haskell with\",{\"cwd\":\"C:\\\\Users\\\\Tyrone\\\\MyProjects\\\\hello-haskell\",\"env\":{\"ALLUSERSPROFILE\":\"C:\\\\ProgramData\",\"APPDATA\":\"C:\\\\Users\\\\Tyrone\\\\AppData\\\\Roaming\",\"ATOM_HOME\":\"C:\\\\Users\\\\Tyrone\\\\.atom\",\"CommonProgramFiles\":\"C:\\\\Program Files\\\\Common Files\",\"COMPUTERNAME\":\"TYRONE-PC\",\"ComSpec\":\"C:\\\\Windows\\\\system32\\\\cmd.exe\",\"FP_NO_HOST_CHECK\":\"NO\",\"GHC\":\"c:\\\\users\\\\tyrone\\\\appdata\\\\local\\\\programs\\\\stack\\\\i386-windows\\\\ghc-7.10.3\\\\bin\",\"GOOGLE_API_KEY\":\"AIzaSyAQfxPJiounkhOjODEO5ZieffeBv6yft2Q\",\"HOMEDRIVE\":\"C:\",\"HOMEPATH\":\"\\\\Users\\\\Tyrone\",\"LOCALAPPDATA\":\"C:\\\\Users\\\\Tyrone\\\\AppData\\\\Local\",\"LOGONSERVER\":\"\\\\\\\\TYRONE-PC\",\"NUMBER_OF_PROCESSORS\":\"2\",\"OS\":\"Windows_NT\",\"Path\":\"C:\\\\ProgramData\\\\Oracle\\\\Java\\\\javapath;C:\\\\Windows\\\\system32;C:\\\\Windows;C:\\\\Windows\\\\System32\\\\Wbem;C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\;C:\\\\Program Files\\\\Skype\\\\Phone\\\\;C:\\\\Program Files\\\\Support Tools\\\\;C:\\\\Program Files\\\\Git\\\\cmd;C:\\\\Users\\\\Tyrone\\\\AppData\\\\Roaming\\\\local\\\\bin;c:\\\\users\\\\tyrone\\\\appdata\\\\local\\\\atom\\\\bin;c:\\\\stack_root;c:\\\\users\\\\tyrone\\\\appdata\\\\local\\\\programs\\\\stack\\\\i386-windows\\\\ghc-7.10.3\\\\bin\",\"PATHEXT\":\".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC\",\"PROCESSOR_ARCHITECTURE\":\"x86\",\"PROCESSOR_IDENTIFIER\":\"x86 Family 6 Model 15 Stepping 6, GenuineIntel\",\"PROCESSOR_LEVEL\":\"6\",\"PROCESSOR_REVISION\":\"0f06\",\"ProgramData\":\"C:\\\\ProgramData\",\"ProgramFiles\":\"C:\\\\Program Files\",\"PSModulePath\":\"C:\\\\Windows\\\\system32\\\\WindowsPowerShell\\\\v1.0\\\\Modules\\\\\",\"PUBLIC\":\"C:\\\\Users\\\\Public\",\"ROOT_ATOM_DIRECTORY\":\"c:\\\\users\\\\tyrone\\\\appdata\\\\local\\\\atom\\\\bin\",\"SESSIONNAME\":\"Console\",\"skype\":\"C:\\\\Program Files\\\\Skype\\\\Phone\\\\\",\"STACK_ROOT\":\"c:\\\\stack_root\",\"SystemDrive\":\"C:\",\"SystemRoot\":\"C:\\\\Windows\",\"TEMP\":\"C:\\\\Users\\\\Tyrone\\\\AppData\\\\Local\\\\Temp\",\"TMP\":\"C:\\\\Users\\\\Tyrone\\\\AppData\\\\Local\\\\Temp\",\"USERDOMAIN\":\"Tyrone-PC\",\"USERNAME\":\"Tyrone\",\"USERPROFILE\":\"C:\\\\Users\\\\Tyrone\",\"windir\":\"C:\\\\Windows\",\"windows_tracing_flags\":\"3\",\"windows_tracing_logfile\":\"C:\\\\BVTBin\\\\Tests\\\\installpackage\\\\csilogfile.log\",\"NODE_PATH\":\"C:\\\\Users\\\\Tyrone\\\\AppData\\\\Local\\\\atom\\\\app-1.8.0\\\\resources\\\\app.asar\\\\exports\",\"NODE_ENV\":\"production\",\"PATH\":\"C:\\\\stack_root\\\\global-project\\\\.stack-work\\\\install\\\\6840de01\\\\bin;C:\\\\stack_root\\\\snapshots\\\\48375d44\\\\bin;C:\\\\ProgramData\\\\Oracle\\\\Java\\\\javapath;C:\\\\Windows\\\\system32;C:\\\\Windows;C:\\\\Windows\\\\System32\\\\Wbem;C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\;C:\\\\Program Files\\\\Skype\\\\Phone\\\\;C:\\\\Program Files\\\\Support Tools\\\\;C:\\\\Program Files\\\\Git\\\\cmd;C:\\\\Users\\\\Tyrone\\\\AppData\\\\Roaming\\\\local\\\\bin;c:\\\\users\\\\tyrone\\\\appdata\\\\local\\\\atom\\\\bin;c:\\\\stack_root;c:\\\\users\\\\tyrone\\\\appdata\\\\local\\\\programs\\\\stack\\\\i386-windows\\\\ghc-7.10.3\\\\bin\"},\"encoding\":\"utf-8\",\"maxBuffer\":null}\n-2.884s: \"Spawning new ghc-modi instance for C:\\\\Users\\\\Tyrone\\\\MyProjects\\\\hello-haskell with options = \",{\"cwd\":\"C:\\\\Users\\\\Tyrone\\\\MyProjects\\\\hello-haskell\",\"env\":{\"ALLUSERSPROFILE\":\"C:\\\\ProgramData\",\"APPDATA\":\"C:\\\\Users\\\\Tyrone\\\\AppData\\\\Roaming\",\"ATOM_HOME\":\"C:\\\\Users\\\\Tyrone\\\\.atom\",\"CommonProgramFiles\":\"C:\\\\Program Files\\\\Common Files\",\"COMPUTERNAME\":\"TYRONE-PC\",\"ComSpec\":\"C:\\\\Windows\\\\system32\\\\cmd.exe\",\"FP_NO_HOST_CHECK\":\"NO\",\"GHC\":\"c:\\\\users\\\\tyrone\\\\appdata\\\\local\\\\programs\\\\stack\\\\i386-windows\\\\ghc-7.10.3\\\\bin\",\"GOOGLE_API_KEY\":\"AIzaSyAQfxPJiounkhOjODEO5ZieffeBv6yft2Q\",\"HOMEDRIVE\":\"C:\",\"HOMEPATH\":\"\\\\Users\\\\Tyrone\",\"LOCALAPPDATA\":\"C:\\\\Users\\\\Tyrone\\\\AppData\\\\Local\",\"LOGONSERVER\":\"\\\\\\\\TYRONE-PC\",\"NUMBER_OF_PROCESSORS\":\"2\",\"OS\":\"Windows_NT\",\"Path\":\"C:\\\\ProgramData\\\\Oracle\\\\Java\\\\javapath;C:\\\\Windows\\\\system32;C:\\\\Windows;C:\\\\Windows\\\\System32\\\\Wbem;C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\;C:\\\\Program Files\\\\Skype\\\\Phone\\\\;C:\\\\Program Files\\\\Support Tools\\\\;C:\\\\Program Files\\\\Git\\\\cmd;C:\\\\Users\\\\Tyrone\\\\AppData\\\\Roaming\\\\local\\\\bin;c:\\\\users\\\\tyrone\\\\appdata\\\\local\\\\atom\\\\bin;c:\\\\stack_root;c:\\\\users\\\\tyrone\\\\appdata\\\\local\\\\programs\\\\stack\\\\i386-windows\\\\ghc-7.10.3\\\\bin\",\"PATHEXT\":\".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC\",\"PROCESSOR_ARCHITECTURE\":\"x86\",\"PROCESSOR_IDENTIFIER\":\"x86 Family 6 Model 15 Stepping 6, GenuineIntel\",\"PROCESSOR_LEVEL\":\"6\",\"PROCESSOR_REVISION\":\"0f06\",\"ProgramData\":\"C:\\\\ProgramData\",\"ProgramFiles\":\"C:\\\\Program Files\",\"PSModulePath\":\"C:\\\\Windows\\\\system32\\\\WindowsPowerShell\\\\v1.0\\\\Modules\\\\\",\"PUBLIC\":\"C:\\\\Users\\\\Public\",\"ROOT_ATOM_DIRECTORY\":\"c:\\\\users\\\\tyrone\\\\appdata\\\\local\\\\atom\\\\bin\",\"SESSIONNAME\":\"Console\",\"skype\":\"C:\\\\Program Files\\\\Skype\\\\Phone\\\\\",\"STACK_ROOT\":\"c:\\\\stack_root\",\"SystemDrive\":\"C:\",\"SystemRoot\":\"C:\\\\Windows\",\"TEMP\":\"C:\\\\Users\\\\Tyrone\\\\AppData\\\\Local\\\\Temp\",\"TMP\":\"C:\\\\Users\\\\Tyrone\\\\AppData\\\\Local\\\\Temp\",\"USERDOMAIN\":\"Tyrone-PC\",\"USERNAME\":\"Tyrone\",\"USERPROFILE\":\"C:\\\\Users\\\\Tyrone\",\"windir\":\"C:\\\\Windows\",\"windows_tracing_flags\":\"3\",\"windows_tracing_logfile\":\"C:\\\\BVTBin\\\\Tests\\\\installpackage\\\\csilogfile.log\",\"NODE_PATH\":\"C:\\\\Users\\\\Tyrone\\\\AppData\\\\Local\\\\atom\\\\app-1.8.0\\\\resources\\\\app.asar\\\\exports\",\"NODE_ENV\":\"production\",\"PATH\":\"C:\\\\stack_root\\\\global-project\\\\.stack-work\\\\install\\\\6840de01\\\\bin;C:\\\\stack_root\\\\snapshots\\\\48375d44\\\\bin;C:\\\\ProgramData\\\\Oracle\\\\Java\\\\javapath;C:\\\\Windows\\\\system32;C:\\\\Windows;C:\\\\Windows\\\\System32\\\\Wbem;C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\;C:\\\\Program Files\\\\Skype\\\\Phone\\\\;C:\\\\Program Files\\\\Support Tools\\\\;C:\\\\Program Files\\\\Git\\\\cmd;C:\\\\Users\\\\Tyrone\\\\AppData\\\\Roaming\\\\local\\\\bin;c:\\\\users\\\\tyrone\\\\appdata\\\\local\\\\atom\\\\bin;c:\\\\stack_root;c:\\\\users\\\\tyrone\\\\appdata\\\\local\\\\programs\\\\stack\\\\i386-windows\\\\ghc-7.10.3\\\\bin\"},\"encoding\":\"utf-8\",\"maxBuffer\":null}\n-2.884s: \"Started interactive action block in C:\\\\Users\\\\Tyrone\\\\MyProjects\\\\hello-haskell\"\n-2.884s: \"Running ghc-modi command type\",\"C:\\\\Users\\\\Tyrone\\\\MyProjects\\\\hello-haskell\\\\src\\\\Main.hs\",\"--\",1,1\n-2.419s: \"ghc-modi said: \"\n-2.419s: \"ghc-modi said: on the commandline: Warning:\"\n-2.419s: \"ghc-modi said:     -package-conf=C:\\\\Users\\\\Tyrone\\\\AppData\\\\Roaming\\\\ghc-mod\\\\cabal-helper\\\\Cabal-1.24.0.0-db-7.10.3 is deprecated: Use -package-db instead\"\n-1.936s: \"ghc-modi said: [1 of 5] Compiling CabalHelper.Types ( CabalHelper\\\\Types.hs, C:\\\\Users\\\\Tyrone\\\\AppData\\\\Roaming\\\\ghc-mod\\\\cabal-helper\\\\CabalHelper\\\\Types.o )\"\n-0.807s: \"ghc-modi said: [2 of 5] Compiling CabalHelper.Common ( CabalHelper\\\\Common.hs, C:\\\\Users\\\\Tyrone\\\\AppData\\\\Roaming\\\\ghc-mod\\\\cabal-helper\\\\CabalHelper\\\\Common.o )\"\n-0.445s: \"ghc-modi said: [3 of 5] Compiling CabalHelper.Sandbox ( CabalHelper\\\\Sandbox.hs, C:\\\\Users\\\\Tyrone\\\\AppData\\\\Roaming\\\\ghc-mod\\\\cabal-helper\\\\CabalHelper\\\\Sandbox.o )\"\n-0.228s: \"ghc-modi said: [4 of 5] Compiling CabalHelper.Licenses ( CabalHelper\\\\Licenses.hs, C:\\\\Users\\\\Tyrone\\\\AppData\\\\Roaming\\\\ghc-mod\\\\cabal-helper\\\\CabalHelper\\\\Licenses.o )\"\n-0.071s: \"ghc-modi said: \"\n-0.071s: \"ghc-modi said: CabalHelper\\\\Licenses.hs:38:28:\"\n-0.071s: \"ghc-modi said:     Not in scope: `lookupComponentId'\"\n-0.07s: \"ghc-modi said:     Perhaps you meant one of these:\"\n-0.07s: \"ghc-modi said:       `lookupComponent' (imported from Distribution.Simple.LocalBuildInfo),\"\n-0.07s: \"ghc-modi said:       `localComponentId' (imported from Distribution.Simple.LocalBuildInfo)\"\n-0.07s: \"ghc-modi said: \"\n-0.07s: \"ghc-modi said: CabalHelper\\\\Licenses.hs:53:18:\"\n-0.07s: \"ghc-modi said:     Ambiguous occurrence `lookupInstalledPackageId'\"\n-0.07s: \"ghc-modi said:     It could refer to either `CabalHelper.Licenses.lookupInstalledPackageId',\"\n-0.07s: \"ghc-modi said:                              defined at CabalHelper\\\\Licenses.hs:38:1\"\n-0.07s: \"ghc-modi said:                           or `Distribution.Simple.PackageIndex.lookupInstalledPackageId',\"\n-0.07s: \"ghc-modi said:                              imported from `Distribution.Simple.PackageIndex' at CabalHelper\\\\Licenses.hs:24:1-39\"\n-0.07s: \"ghc-modi said: \"\n-0.07s: \"ghc-modi said: CabalHelper\\\\Licenses.hs:74:10:\"\n-0.07s: \"ghc-modi said:     Ambiguous occurrence `lookupInstalledPackageId'\"\n-0.07s: \"ghc-modi said:     It could refer to either `CabalHelper.Licenses.lookupInstalledPackageId',\"\n-0.07s: \"ghc-modi said:                              defined at CabalHelper\\\\Licenses.hs:38:1\"\n-0.07s: \"ghc-modi said:                           or `Distribution.Simple.PackageIndex.lookupInstalledPackageId',\"\n-0.07s: \"ghc-modi said:                              imported from `Distribution.Simple.PackageIndex' at CabalHelper\\\\Licenses.hs:24:1-39\"\n-0.012s: \"ghc-modi said: ghc-mod: readCreateProcess: C:\\\\stack_root\\\\snapshots\\\\48375d44\\\\libexec\\\\cabal-helper-wrapper.exe \\\"--with-ghc=ghc\\\" \\\"--with-ghc-pkg=ghc-pkg\\\" \\\"--with-cabal=cabal\\\" \\\"C:\\\\\\\\Users\\\\\\\\Tyrone\\\\\\\\MyProjects\\\\\\\\hello-haskell\\\" \\\"C:\\\\\\\\Users\\\\\\\\Tyrone\\\\\\\\MyProjects\\\\\\\\hello-haskell\\\\\\\\dist\\\" \\\"package-db-stack\\\" \\\"entrypoints\\\" \\\"source-dirs\\\" \\\"ghc-options\\\" \\\"ghc-src-options\\\" \\\"ghc-pkg-options\\\" \\\"ghc-merged-pkg-options\\\" \\\"ghc-lang-options\\\" \\\"licenses\\\" \\\"flags\\\" \\\"config-flags\\\" \\\"non-default-config-flags\\\" \\\"compiler-version\\\" (exit 1): failed\"\n-0.001s: \"ghc-modi for C:\\\\Users\\\\Tyrone\\\\MyProjects\\\\hello-haskell ended with 1\"\n-0.001s: \"ghc-modi for C:\\\\Users\\\\Tyrone\\\\MyProjects\\\\hello-haskell ended with 1\"\n-0.001s: \"Running ghc-modi command unmap-file\",\"C:\\\\Users\\\\Tyrone\\\\MyProjects\\\\hello-haskell\\\\src\\\\Main.hs\" 0s: {\"name\":\"ghc-modi crashed\"}\nghc-modi crashed\n    at module.exports.Util.mkError (file:///C:/Users/Tyrone/.atom/packages/haskell-ghc-mod/lib/util.coffee:225:15)\n    at ChildProcess.exitCallback (file:///C:/Users/Tyrone/.atom/packages/haskell-ghc-mod/lib/ghc-mod/interactive-process.coffee:77:20)\n    at emitTwo (events.js:92:20)\n    at ChildProcess.emit (events.js:172:7)\n    at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)</code></p>\n\n<h3>Commands</h3>\n\n<p><code>\n     -2:22.4.0 core:copy (atom-text-editor.editor.is-focused)</code></p>\n\n<h3>Config</h3>\n\n<p><code>json {   \"core\": {\n    \"automaticallyUpdate\": false,\n    \"themes\": [\n      \"atom-light-ui\",\n      \"atom-light-syntax\"\n    ]   } }</code></p>\n\n<h3>Installed Packages</h3>\n\n<p>```coffee</p>\n\n<h1>User autocomplete-haskell, v0.6.6 haskell-ghc-mod, v1.17.2 ide-haskell, v1.8.1 ide-haskell-cabal, v1.6.4 ide-haskell-repl, v0.1.0 language-haskell, v1.9.7</h1>\n\n<h1>Dev No dev packages ```*</h1>\n"}, {"tags": ["haskell", "typeclass", "deriving"], "answers": [{"tags": [], "owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "is_accepted": true, "score": 8, "last_activity_date": 1473057323, "creation_date": 1473057323, "answer_id": 39324999, "question_id": 39324988, "link": "https://stackoverflow.com/questions/39324988/fail-to-read-a-self-defined-data-type/39324999#39324999", "title": "Fail to read a self defined data type", "body": "<p>You have to derive <code>Read</code> in definition of <code>MyNum</code>:</p>\n\n<pre><code>data MyNum = One\n           | Two\n           | Three\n           deriving (Show, Eq, Read)\n\nx = read(\"One\")::MyNum\n</code></pre>\n\n<blockquote>\n  <p>*Main> x</p>\n  \n  <p>One</p>\n</blockquote>\n"}], "owner": {"reputation": 13, "user_id": 6795134, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6845de49634a444485c22525e4ad40e8?s=128&d=identicon&r=PG&f=1", "display_name": "Dong", "link": "https://stackoverflow.com/users/6795134/dong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 39324999, "answer_count": 1, "score": 1, "last_activity_date": 1473065832, "creation_date": 1473057258, "last_edit_date": 1592644375, "question_id": 39324988, "link": "https://stackoverflow.com/questions/39324988/fail-to-read-a-self-defined-data-type", "title": "Fail to read a self defined data type", "body": "<pre><code>data MyNum = One\n           | Two\n           | Three\n           deriving (Show, Eq)\n</code></pre>\n<p>I just define <code>MyNum</code> with constructor <code>One</code>, <code>Two</code> and <code>Three</code>.</p>\n<blockquote>\n<p>*Main&gt; :t One</p>\n<p>One :: MyNum</p>\n</blockquote>\n<p>But ghci produces errors when I add <code>x = read(&quot;One&quot;)::MyNum</code> to my program:</p>\n<blockquote>\n<p>No instance for (Read MyNum) arising from a use of \u2018read\u2019</p>\n<p>In the expression: read (&quot;One&quot;) :: MyNum</p>\n<p>In an equation for \u2018x\u2019: x = read (&quot;One&quot;) :: MyNum</p>\n</blockquote>\n<p>Why couldn't I <code>read</code> it?</p>\n"}, {"tags": ["haskell", "recursion", "type-inference"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1473050649, "post_id": 39323984, "comment_id": 65979878, "body": "You need a print statement. <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"nofollow noreferrer\">learnyouahaskell.com/input-and-output</a> It should print the current number, and then call with <code>n - 1</code> if <code>n &gt; 0</code>"}], "answers": [{"comments": [{"owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "edited": false, "score": 0, "creation_date": 1473053108, "post_id": 39324339, "comment_id": 65980429, "body": "For the first example, you&#39;ll need <code>n &gt;= 0</code>"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1473062967, "post_id": 39324339, "comment_id": 65984134, "body": "FYI: your alternative using an enumeration is printing numbers in <i>ascending</i> order not descending. You should reverse that list first."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1473093546, "post_id": 39324339, "comment_id": 66000743, "body": "@gallais Thanks, fixed."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473127412, "post_id": 39324339, "comment_id": 66010426, "body": "Another alternative is to use <code>*&gt;</code> directly instead of introducing <code>do</code> syntax."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 8, "last_activity_date": 1473093533, "last_edit_date": 1473093533, "creation_date": 1473052913, "answer_id": 39324339, "question_id": 39323984, "link": "https://stackoverflow.com/questions/39323984/haskell-decrement-function/39324339#39324339", "title": "Haskell decrement function", "body": "<p>You have shown:</p>\n\n<pre><code>printDescending n = if n &gt; 0\n                    then printDescending n - 1 return n\n                    else return n - 1\n</code></pre>\n\n<p>Lets first look at how this is parsed:</p>\n\n<pre><code>printDescending n = if n &gt; 0\n                    then (printDescending n) - (1 return n)\n                    else (return n) - 1\n</code></pre>\n\n<p>Probably not what you intended, huh?  Notice the infix operators, such as <code>-</code> bind less tightly than function application.  Also see how 'return' is not special - it's also just function application.  Finally, you didn't actually include a call to any sort of <code>print</code> command so no matter what language you are using I wouldn't expect this to function.</p>\n\n<p>Fixing these issues, let's first provide a type signature (which is somewhat like a function prototype in C):</p>\n\n<pre><code>printDescending :: Int -&gt; IO ()\n</code></pre>\n\n<p>So <code>printDecending</code> accepts one argument, an <code>Int</code>, and does some IO.  the <code>()</code> is called \"unit\" and for the first lesson of a programmer who knows C you should be able to mentally think of that as <code>void</code> and be OK.</p>\n\n<p>Now how about the body? Well your <code>if</code> statement was fine:</p>\n\n<pre><code>printDescending n =\n    if n &gt; 0\n      then  ...\n      else...\n</code></pre>\n\n<p>The <code>else</code> statement was a little weird.  Even fixing the parsing, why would you want <code>0-1</code>?  Let's just return unit:</p>\n\n<pre><code>printDescending n =\n    if n &gt; 0\n      then ...\n      else return ()\n</code></pre>\n\n<p>Now for the <code>then</code> branch you want two things really.  1. print the value 2. recursively call printDecending on the next smallest value.  There is one bit of notation, <code>do</code>, that we'll use to sequence two IO operations but beyond that these two tasks translate to commands directly:</p>\n\n<pre><code>printDescending n =\n    if n &gt; 0\n      then do print n\n              printDescending (n - 1)\n      else return ()\n</code></pre>\n\n<p>Now lets do one more step.  Since this isn't C/Java/etc and is a functional language then people will expect a declarative style.  To that end, let's declare printDescending using guards instead of an if statement:</p>\n\n<pre><code>printDescending n\n    | n &gt; 0 = do print n\n                 printDescending (n-1)\n    | otherwise = return ()\n</code></pre>\n\n<p><strong>Alternatives</strong></p>\n\n<p>Now I'm going to present some alternatives, just for exemplification.</p>\n\n<p>If you don't care about negative values then we could just terminate on zero with something like:</p>\n\n<pre><code>printDescending 0 = return ()\nprintDescending n =\n     do print n\n        printDescending (n-1)\n</code></pre>\n\n<p>Or we can use list comprehension to build a list of the values then perform <code>print</code> on each element of the list.  We can do this with <code>forM_</code> (see also the more idiomatic <code>mapM_</code>) which executes an operation on each element of the list and throws away the results, returning unit.</p>\n\n<pre><code>printDescending n = forM_ [n,n-1..1] print\n</code></pre>\n\n<p>Finally, if you want to have more rapid exchanges then consider joining the #haskell channel on irc.freenode.net.  There's a great group there and it's where many of the Haskell programmers I know got their start.</p>\n"}, {"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1473053814, "post_id": 39324436, "comment_id": 65980629, "body": "Indeed, the main difference between Steven and my answer is the printing of zero (or not)."}], "tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": false, "score": 3, "last_activity_date": 1473053648, "creation_date": 1473053648, "answer_id": 39324436, "question_id": 39323984, "link": "https://stackoverflow.com/questions/39323984/haskell-decrement-function/39324436#39324436", "title": "Haskell decrement function", "body": "<p>In addition to Thomas' detailed answer, I get the feeling that the following is what you were going for:</p>\n\n<pre><code>printDescending :: Integer -&gt; IO ()\nprintDescending n = do\n  print n\n  if n &gt; 0\n     then printDescending (n - 1)\n     else return ()\n</code></pre>\n\n<p>Admittedly, the <code>return ()</code> may seem strange at first.</p>\n\n<p>A more functional approach might be something like this:</p>\n\n<pre><code>printDescending :: Integer -&gt; IO ()\nprintDescending n = mapM_ print [n, (n-1) .. 0]\n</code></pre>\n\n<p>A quick tip: I'd recommend adding the function signature (if you know what it is) as it will help guide the compiler's error messages.</p>\n"}], "owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1687, "favorite_count": 0, "accepted_answer_id": 39324339, "answer_count": 2, "score": 1, "last_activity_date": 1473093533, "creation_date": 1473050028, "last_edit_date": 1473064373, "question_id": 39323984, "link": "https://stackoverflow.com/questions/39323984/haskell-decrement-function", "title": "Haskell decrement function", "body": "<p>I am trying to learn Haskell, this is my very first approach at functional programming. I'm having some trouble creating a function that takes a number as input and prints that number one by one recursively, until 0.</p>\n\n<pre><code>printDescending n = if n &gt; 0\n                        then printDescending n - 1 return n\n                        else return n - 1\n</code></pre>\n\n<p>I want to be able to do <code>printDescending 20</code> and have it output 20, 19, 18...2, 1, 0. But I'm getting this error:</p>\n\n<pre><code>&gt;     \u2022 Non type-variable argument\n&gt;         in the constraint: Num ((a -&gt; m a) -&gt; a1 -&gt; m1 a1)\n&gt;       (Use FlexibleContexts to permit this)\n&gt;     \u2022 When checking the inferred type\n&gt;         printDescending :: forall (m :: * -&gt; *) a (m1 :: * -&gt; *) a1.\n&gt;                            (Ord a1, Num ((a -&gt; m a) -&gt; a1 -&gt; m1 a1), Num (m1 a1), Num a1,\n&gt;                             Monad m1, Monad m) =&gt;\n&gt;                            a1 -&gt; m1 a1 Failed, modules loaded: none.\n</code></pre>\n\n<p>I think it may be my syntax. Anyone have some insight?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473022087, "post_id": 39321171, "comment_id": 65974606, "body": "You&#39;re breaking it up into lines, sorting the lines relative to each other, and putting them back together. How can you modify the <code>sort</code> invocation to sort <code>each</code> line?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1473028491, "post_id": 39321171, "comment_id": 65976095, "body": "<code>sort</code> here is being called at the type <code>[String] -&gt; [String]</code>, but you want <code>[Char] -&gt; [Char]</code> - i.e. the current <code>sort</code> is sorting the list of lines by lexicographical ordering on strings. Try <code>let sort&#39; :: String -&gt; String&#39;; sort&#39; = sort in interact (concat . sort&#39; . lines)</code> - this gives you a type error, but should be a starting point for figuring this out."}], "answers": [{"tags": [], "owner": {"reputation": 5428, "user_id": 482382, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9fe6eecd0900f0e779711f091fec8b3b?s=128&d=identicon&r=PG", "display_name": "Steven Shaw", "link": "https://stackoverflow.com/users/482382/steven-shaw"}, "is_accepted": true, "score": 2, "last_activity_date": 1473063083, "last_edit_date": 1473063083, "creation_date": 1473057869, "answer_id": 39325122, "question_id": 39321171, "link": "https://stackoverflow.com/questions/39321171/interact-concat-sort-lines-cba/39325122#39325122", "title": "interact (concat . sort lines) cba", "body": "<p>Looks like you want something more like:</p>\n\n<pre><code>import Data.List\n\nmain = interact (unlines . map sort . lines)\n</code></pre>\n\n<p>This sorts each line entered.</p>\n"}], "owner": {"reputation": 343, "user_id": 6268947, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/b27a22f070dbbc34e426bcd91fe078d2?s=128&d=identicon&r=PG&f=1", "display_name": "J.doe", "link": "https://stackoverflow.com/users/6268947/j-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 39325122, "answer_count": 1, "score": 0, "last_activity_date": 1473063083, "creation_date": 1473020660, "last_edit_date": 1473022109, "question_id": 39321171, "link": "https://stackoverflow.com/questions/39321171/interact-concat-sort-lines-cba", "title": "interact (concat . sort lines) cba", "body": "<p>Why is the code below not working- it is not giving the desired output.I want it to sort a string(e.g cba -> abc ) .After  I signal end of file with \n^D  i just get: cba . </p>\n\n<pre><code>import Data.List\nimport Data.Char\nimport System.IO (isEOF)\n\n\nmain =\n   interact (concat . sort .lines)\n</code></pre>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1473018384, "post_id": 39320832, "comment_id": 65973641, "body": "Can I ask where you can get information on the compiler behaviour? I&#39;ve been coding in Haskell for about 6 months and would like to take a step up and learn what&#39;s happening under the hood."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 1, "creation_date": 1473018559, "post_id": 39320832, "comment_id": 65973683, "body": "Er, what do you mean by \u201cinformation on the compiler behaviour\u201d? You can certainly look at <a href=\"http://git.haskell.org/ghc.git\" rel=\"nofollow noreferrer\">the source code</a> to learn what GHC does. I actually never read much of it \u2013 I find it much more useful to just write lots of code and see what happens."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1473031094, "post_id": 39320832, "comment_id": 65976527, "body": "It&#39;s best not to think of learning about behaviors like this as learning the compiler since this behavior is well specified by the language itself.  The type of quantification is provided by type signatures is not an uncommon tripping point and its a good thing to dig into explicitly rather than pass over with a &quot;hurm, someday I&#39;ll understand&quot; sort of response."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1473018248, "creation_date": 1473018248, "answer_id": 39320832, "question_id": 39320695, "link": "https://stackoverflow.com/questions/39320695/haskell-function-signature/39320832#39320832", "title": "Haskell: function signature", "body": "<p>In the first, you're using <code>liftIO</code> on <code>bar</code>. That actually requires <code>bar :: IO String</code>. Now, <code>IO</code> happens to be (trivially) an instance on <code>MonadIO</code>, so this works \u2013 the compiler simply throws away the polymorphism of <code>bar</code>.</p>\n\n<p>In the second case, the compiler doesn't get to decide what particular monad to use as the type of <code>foo</code>: it's fixed by the environment, i.e. the <em>caller</em> can decide what <code>MonadIO</code> instance it should be. To again get the freedom to choose <code>IO</code> as the monad, you'd need the following signature:</p>\n\n<pre><code>{-# LANGUAGE Rank2Types, UnicodeSyntax #-}\n\nrun2IO' :: MonadIO m\n       =&gt; (\u2200 m' . MonadIO m' =&gt; m' String)\n       -&gt; m String\nrun2IO' foo  = liftIO foo\n</code></pre>\n\n<p>... however I don't think you really want that: you might then as well write</p>\n\n<pre><code>run2IO' :: MonadIO m =&gt; IO String -&gt; m String\nrun2IO' foo  = liftIO foo\n</code></pre>\n\n<p>or simply <code>run2IO = liftIO</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473034866, "post_id": 39320838, "comment_id": 65977160, "body": "It may or may not be worth mentioning the <code>PrimBase</code> class in <code>primitive</code>."}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": false, "score": 9, "last_activity_date": 1473027292, "last_edit_date": 1473027292, "creation_date": 1473018261, "answer_id": 39320838, "question_id": 39320695, "link": "https://stackoverflow.com/questions/39320695/haskell-function-signature/39320838#39320838", "title": "Haskell: function signature", "body": "<p>Remember the type of <code>liftIO</code>:</p>\n\n<pre><code>liftIO :: MonadIO m =&gt; IO a -&gt; m a\n</code></pre>\n\n<p>Importantly, the first argument must be a concrete <code>IO</code> value. That means when you have an expression <code>liftIO x</code>, then <code>x</code> must be of type <code>IO a</code>.</p>\n\n<p>When a Haskell function is universally quantified (using an implicit or explicit <code>forall</code>), then that means the <em>function caller</em> chooses what the type variable is replaced by. As an example, consider the <code>id</code> function: it has type <code>a -&gt; a</code>, but when you evaluate the expression <code>id True</code>, then <code>id</code> takes the type <code>Bool -&gt; Bool</code> because <code>a</code> is instantiated as the <code>Bool</code> type.</p>\n\n<p>Now, consider your first example again:</p>\n\n<pre><code>run2IO :: MonadIO m =&gt; m Integer -&gt; m Integer\nrun2IO foo = liftIO bar\n</code></pre>\n\n<p>The <code>foo</code> argument is completely irrelevant here, so all that actually matters is the <code>liftIO bar</code> expression. Since <code>liftIO</code> <em>requires</em> its first argument to be of type <code>IO a</code>, then <code>bar</code> <em>must</em> be of type <code>IO a</code>. However, <code>bar</code> is polymorphic: it actually has type <code>MonadIO m =&gt; m Integer</code>.</p>\n\n<p>Fortunately, <code>IO</code> has a <code>MonadIO</code> instance, so the <code>bar</code> value is <em>instantiated</em> using <code>IO</code> to become <code>IO Integer</code>, which is okay, because <code>bar</code> is universally quantified, so its instantiation is chosen by its use.</p>\n\n<p>Now, consider the other situation, in which <code>liftIO foo</code> is used, instead. This <em>seems</em> like it\u2019s the same, but it actually isn\u2019t at all: this time, the <code>MonadIO m =&gt; m Integer</code> value is an argument to the function, not a separate value. The quantification is over the entire function, not the individual value. To understand this more intuitively, it might be helpful to consider <code>id</code> again, but this time, consider its definition:</p>\n\n<pre><code>id :: a -&gt; a\nid x = x\n</code></pre>\n\n<p>In this case, <code>x</code> cannot be instantiated to be <code>Bool</code> within its definition, since that would mean <code>id</code> could only work on <code>Bool</code> values, which is obviously wrong. Effectively, within the implementation of <code>id</code>, <code>x</code> must be used completely generically\u2014it cannot be instantiated to a specific type because that would violate the parametricity guarantees.</p>\n\n<p>Therefore, in your <code>run2IO</code> function, <code>foo</code> must be used completely generically as an arbitrary <code>MonadIO</code> value, not a specific <code>MonadIO</code> instance. The <code>liftIO</code> call attempts to use the specific <code>IO</code> instance, which is disallowed, since the caller might not provide an <code>IO</code> value.</p>\n\n<hr>\n\n<p>It is possible, of course, that you might want the argument to the function to be quantified in the same way as <code>bar</code> is; that is, you might want its instantiation to be chosen by the implementation, not the caller. In that case, you can use the <code>RankNTypes</code> language extension to specify a different type using an explicit <code>forall</code>:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nrun3IO :: MonadIO m =&gt; (forall m1. MonadIO m1 =&gt; m1 Integer) -&gt; m Integer\nrun3IO foo = liftIO foo\n</code></pre>\n\n<p>This will typecheck, but it\u2019s not a very useful function.</p>\n"}], "owner": {"reputation": 303, "user_id": 2444986, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/191fe5f186d853b1ba0470035ae19129?s=128&d=identicon&r=PG", "display_name": "Blezz", "link": "https://stackoverflow.com/users/2444986/blezz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 633, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1473027292, "creation_date": 1473017283, "last_edit_date": 1473020633, "question_id": 39320695, "link": "https://stackoverflow.com/questions/39320695/haskell-function-signature", "title": "Haskell: function signature", "body": "<p>This program compiles without problems:</p>\n\n<pre><code>bar :: MonadIO m\n    =&gt; m String\nbar = undefined\n\nrun2IO :: MonadIO m\n       =&gt; m String\n       -&gt; m String\nrun2IO foo  = liftIO bar\n</code></pre>\n\n<p>When I change <code>bar</code> to <code>foo</code> (argument name),</p>\n\n<pre><code>run2IO :: MonadIO m\n       =&gt; m String\n       -&gt; m String\nrun2IO foo  = liftIO foo\n</code></pre>\n\n<p>I get:</p>\n\n<blockquote>\n  <p>Couldn't match type \u2018m\u2019 with \u2018IO\u2019\n        \u2018m\u2019 is a rigid type variable bound by\n            the type signature for run2IO :: MonadIO m => m String -> m String\n  ...</p>\n  \n  <p>Expected type: IO String\n  Actual type: m String ...</p>\n</blockquote>\n\n<p>Why are the 2 cases are not equivalent?</p>\n"}, {"tags": ["haskell", "vim"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1473012990, "post_id": 39320035, "comment_id": 65972127, "body": "Excellent idea, I need to look up the corresponding action for Emacs."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1473013263, "post_id": 39320035, "comment_id": 65972219, "body": "@leftaroundabout added the corresponding emacs plugin"}, {"owner": {"reputation": 29614, "user_id": 15934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66027fd61cc5e638b5d3057859e1be51?s=128&d=identicon&r=PG", "display_name": "Luc Hermitte", "link": "https://stackoverflow.com/users/15934/luc-hermitte"}, "edited": false, "score": 0, "creation_date": 1473031324, "post_id": 39320035, "comment_id": 65976570, "body": "IMO, this is a duplicate of <a href=\"http://stackoverflow.com/questions/39315386/how-to-create-a-customized-stdheader-not-h-file\" title=\"how to create a customized stdheader not h file\">stackoverflow.com/questions/39315386/&hellip;</a> -- or the other way around. I let others (i.e, you) chose to vote or not (I have too many points, and my votes are kind of not democratic)"}], "answers": [{"comments": [{"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1473015059, "post_id": 39320062, "comment_id": 65972788, "body": "Thanks, but I&#39;d like it to be automatic, without having to write <code>module</code>."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1473034484, "post_id": 39320062, "comment_id": 65977106, "body": "As @cubic said i don&#39;t think not typing <code>module</code> is the killer feature, but the snippets give you way more than just this, for example i have the boilerplate for generating my test suite in one snippet,  as well as language pragmas and import statements. If you are not already using it, try it for 10 days, i think it is at least worth trying"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1473012964, "creation_date": 1473012964, "answer_id": 39320062, "question_id": 39320035, "link": "https://stackoverflow.com/questions/39320035/configure-vim-to-add-module-declaration-for-haskell-files/39320062#39320062", "title": "Configure vim to add module declaration for haskell files", "body": "<p>You can use a snippet engine like <a href=\"https://github.com/SirVer/ultisnips\" rel=\"nofollow\">Ultisnips</a> together with <a href=\"https://github.com/honza/vim-snippets/\" rel=\"nofollow\">vim-snippets</a> you can trigger the keyword <code>module</code> to get the desired result.</p>\n\n<p>See <a href=\"https://github.com/honza/vim-snippets/blob/master/snippets/haskell.snippets#L43\" rel=\"nofollow\">https://github.com/honza/vim-snippets/blob/master/snippets/haskell.snippets#L43</a> for the line responsible for this.</p>\n\n<h2>Edit:</h2>\n\n<p>For emacs one choice would be <a href=\"http://joaotavora.github.io/yasnippet/\" rel=\"nofollow\">yasnippets</a>: and the module keyword is supported in\n<a href=\"https://github.com/AndreaCrotti/yasnippet-snippets/blob/9ce0b05f4b4d693831e67dd65d660716a8192e8d/haskell-mode/module\" rel=\"nofollow\">yasnippet-snippets</a></p>\n"}, {"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 3, "last_activity_date": 1473015696, "creation_date": 1473015696, "answer_id": 39320472, "question_id": 39320035, "link": "https://stackoverflow.com/questions/39320035/configure-vim-to-add-module-declaration-for-haskell-files/39320472#39320472", "title": "Configure vim to add module declaration for haskell files", "body": "<p>You could do something like</p>\n\n<pre><code>au BufNewFile *.hs call WriteHaskellModuleHeader(expand('%:t:r'))\n\nfunction! WriteHaskellModuleHeader(fname)\n    execute \"normal imodule \" . a:fname . \" where\\n\"\nendfunction\n</code></pre>\n\n<p>in your .vimrc for starters; But of course that breaks the moment you use hierarchical modules (in which case a general vimscript only solution wouldn't work anymore, you'd probably have to invoke cabal or something to find your source roots, and the whole thing would probably get fairly messy very quickly).</p>\n\n<hr>\n\n<p>Opinion: It doesn't seem to me like something particularly worthwhile, it's not a lot of text to write and you don't write it often.</p>\n"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 1, "accepted_answer_id": 39320472, "answer_count": 2, "score": 2, "last_activity_date": 1473015696, "creation_date": 1473012795, "question_id": 39320035, "link": "https://stackoverflow.com/questions/39320035/configure-vim-to-add-module-declaration-for-haskell-files", "title": "Configure vim to add module declaration for haskell files", "body": "<p>When I edit a new Haskell file e.g. \"xyz.hs\", I'd like vim to automatically add</p>\n\n<pre><code>module Xyz where\n</code></pre>\n\n<p>at the first line. How can it be configured?</p>\n"}, {"tags": ["string", "haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1473010856, "post_id": 39319706, "comment_id": 65971500, "body": "Why avoid <code>OverloadedStrings</code>? That is exactly one of the two purposes of that extension (the other is construction of <code>String</code>-like things with nice syntax)."}, {"owner": {"reputation": 3629, "user_id": 379639, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/4fa63505dd4dd4691b87d30508b1bfd3?s=128&d=identicon&r=PG", "display_name": "Xavier Shay", "link": "https://stackoverflow.com/users/379639/xavier-shay"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1473011041, "post_id": 39319706, "comment_id": 65971546, "body": "I&#39;ll probably end up using it, I&#39;m just trying to understand how everything works!"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1473011089, "post_id": 39319706, "comment_id": 65971558, "body": "You can use guards: <code>myFunc s | s == pack &quot;&quot; = &quot;nothing&quot; | otherwise = &quot;something!&quot;</code>."}, {"owner": {"reputation": 3629, "user_id": 379639, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/4fa63505dd4dd4691b87d30508b1bfd3?s=128&d=identicon&r=PG", "display_name": "Xavier Shay", "link": "https://stackoverflow.com/users/379639/xavier-shay"}, "edited": false, "score": 0, "creation_date": 1473011228, "post_id": 39319706, "comment_id": 65971609, "body": "My first version used guards. The actual case is more complicated though and is much clearer with patterns, so I&#39;m trying to use them instead."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1473105616, "post_id": 39319706, "comment_id": 66005126, "body": "@melpomene One possible issue with that is that you might end up without a warning for incomplete patterns (as in the <code>f n | even n = ... | odd n  = ...</code> case)."}], "answers": [{"comments": [{"owner": {"reputation": 3629, "user_id": 379639, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/4fa63505dd4dd4691b87d30508b1bfd3?s=128&d=identicon&r=PG", "display_name": "Xavier Shay", "link": "https://stackoverflow.com/users/379639/xavier-shay"}, "edited": false, "score": 0, "creation_date": 1473023303, "post_id": 39319844, "comment_id": 65974951, "body": "hadn&#39;t thought of <code>case</code>, that&#39;s a decent way to do it. Thanks!"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 7, "last_activity_date": 1473011519, "creation_date": 1473011519, "answer_id": 39319844, "question_id": 39319706, "link": "https://stackoverflow.com/questions/39319706/how-to-pattern-match-against-text-without-using-overloadedstrings/39319844#39319844", "title": "How to pattern match against Text without using OverloadedStrings?", "body": "<p>The easiest way to solve this is to use either guards as @melpomene suggests or case expressions.</p>\n\n<pre><code>testfunc :: Text -&gt; String\ntestfunc s | s == pack \"\" = \"nothing\"\n           | otherwise    = \"someting\"\n\ntestfunc' :: Text -&gt; String\ntestfunc' s = case unpack s of\n                \"\" -&gt; \"nothing\"\n                _  -&gt; \"something\"\n</code></pre>\n\n<p>The inner workings of <code>LANGUAGE OverloadedStrings</code> uses the <code>IsString</code> typeclass, if I remember correctly, and I guess it also relies on <code>INLINING</code> to make this efficient.</p>\n"}, {"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1473020186, "post_id": 39319920, "comment_id": 65974101, "body": "I did think of <code>ViewPatterns</code> but dismissed them because I assumed the OP wanted to have an answer w\\o <code>LANGUAGE</code>-extensions. But nice explanation of <code>ViewPatterns</code> and <code>PatternSynonyms</code> nevertheless (+1)"}, {"owner": {"reputation": 3629, "user_id": 379639, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/4fa63505dd4dd4691b87d30508b1bfd3?s=128&d=identicon&r=PG", "display_name": "Xavier Shay", "link": "https://stackoverflow.com/users/379639/xavier-shay"}, "edited": false, "score": 0, "creation_date": 1473023284, "post_id": 39319920, "comment_id": 65974947, "body": "agree, though I learned about <code>PatternSynonyms</code> so accepting. Thanks!"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1578677978, "post_id": 39319920, "comment_id": 105529822, "body": "Would it be more efficient to write <code>myFunc ((==) Txt.empty -&gt; True) = &quot;nothing&quot;</code>? since I assume checking if two <code>Text</code>s are the same is faster than converting this to a <code>String</code> (especially for non-empty string)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1578680523, "post_id": 39319920, "comment_id": 105530828, "body": "@WillemVanOnsem hm might well be faster. Is <code>Txt.unpack</code> lazy?"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 12, "last_activity_date": 1506553730, "last_edit_date": 1506553730, "creation_date": 1473012082, "answer_id": 39319920, "question_id": 39319706, "link": "https://stackoverflow.com/questions/39319706/how-to-pattern-match-against-text-without-using-overloadedstrings/39319920#39319920", "title": "How to pattern match against Text without using OverloadedStrings?", "body": "<p>The most <em>direct</em> translation is with <a href=\"https://ocharles.org.uk/blog/posts/2014-12-02-view-patterns.html\" rel=\"nofollow noreferrer\">ViewPatterns</a></p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\nimport qualified Data.Text as Txt\nmyFunc (Txt.unpack-&gt;\"\") = \"nothing\"\nmyFunc _other = \"something!\"\n</code></pre>\n\n<p>The <em>best</em> translation, albeit probably too specific for your actual use case, is of course</p>\n\n<pre><code>myFunc txt | Txt.null txt  = \"nothing\"\n           | otherwise     = \"something!\"\n</code></pre>\n\n<p>You could also go nuts and make up a pattern synonym:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms, ViewPatterns #-}\npattern T :: String -&gt; Txt.Text\npattern T str &lt;- (Txt.unpack -&gt; str)\n where T = Txt.pack\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>myFunc (T\"\") = \"nothing\"\nmyFunc _other = \"something\"\n</code></pre>\n\n<p>Arguably, <code>OverloadedStrings</code> is a more sane extension than <code>ViewPatterns</code>, and certainly saner than <code>PatternSynonyms</code>.</p>\n"}], "owner": {"reputation": 3629, "user_id": 379639, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/4fa63505dd4dd4691b87d30508b1bfd3?s=128&d=identicon&r=PG", "display_name": "Xavier Shay", "link": "https://stackoverflow.com/users/379639/xavier-shay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 860, "favorite_count": 1, "accepted_answer_id": 39319920, "answer_count": 2, "score": 5, "last_activity_date": 1506553730, "creation_date": 1473010688, "last_edit_date": 1495540989, "question_id": 39319706, "link": "https://stackoverflow.com/questions/39319706/how-to-pattern-match-against-text-without-using-overloadedstrings", "title": "How to pattern match against Text without using OverloadedStrings?", "body": "<p>This works:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmyFunc :: Text -&gt; String\nmyFunc \"\"    = \"nothing\"\nmyFunc other = \"something!\"\n</code></pre>\n\n<p>Without the <code>OverloadedStrings</code> extension however, <code>\"\"</code> is of type <code>String</code> so it doesn't compile. Using a function  like <code>myFunc (pack \"\")</code> is not allowed in patterns.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/4056449/haskell-bytestrings-how-to-pattern-match\">Haskell Bytestrings: How to pattern match?</a> contains some suggestions that should work, however in this case I'm wondering if there is something special about the fact that it works with <code>OverloadedStrings</code> that would allow a better way?</p>\n"}, {"tags": ["python", "user-interface", "haskell", "gtk"], "answers": [{"comments": [{"owner": {"reputation": 997, "user_id": 2085282, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a7f3c60909c612ccd978a2e381c4ac45?s=128&d=identicon&r=PG", "display_name": "user2085282", "link": "https://stackoverflow.com/users/2085282/user2085282"}, "edited": false, "score": 0, "creation_date": 1473016003, "post_id": 39320180, "comment_id": 65973024, "body": "I&#39;m starting to think this might be a system-dependent issue, I tried adding a scrolled window like you have, which, miraculously, does have the text showing. Except if I resize the window too big, it goes away again. <a href=\"http://imgur.com/a/64vDD\" rel=\"nofollow noreferrer\">imgur.com/a/64vDD</a>"}, {"owner": {"reputation": 1134, "user_id": 2387806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebead5d6b9a6e8a2e443d77cd68d946b?s=128&d=identicon&r=PG", "display_name": "EvensF", "link": "https://stackoverflow.com/users/2387806/evensf"}, "reply_to_user": {"reputation": 997, "user_id": 2085282, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a7f3c60909c612ccd978a2e381c4ac45?s=128&d=identicon&r=PG", "display_name": "user2085282", "link": "https://stackoverflow.com/users/2085282/user2085282"}, "edited": false, "score": 0, "creation_date": 1473016626, "post_id": 39320180, "comment_id": 65973197, "body": "Hmmm\u2026 You may be right because I&#39;m not seeing this behaviour on my system: <a href=\"http://imgur.com/a/xOuK1\" rel=\"nofollow noreferrer\">imgur.com/a/xOuK1</a>"}, {"owner": {"reputation": 997, "user_id": 2085282, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a7f3c60909c612ccd978a2e381c4ac45?s=128&d=identicon&r=PG", "display_name": "user2085282", "link": "https://stackoverflow.com/users/2085282/user2085282"}, "edited": false, "score": 0, "creation_date": 1473016733, "post_id": 39320180, "comment_id": 65973233, "body": "The plot thickens: If i set pass-through, and type some characters, they don&#39;t appear until I resize again. Something is definitely causing the TextView not to redraw."}, {"owner": {"reputation": 1134, "user_id": 2387806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebead5d6b9a6e8a2e443d77cd68d946b?s=128&d=identicon&r=PG", "display_name": "EvensF", "link": "https://stackoverflow.com/users/2387806/evensf"}, "reply_to_user": {"reputation": 997, "user_id": 2085282, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a7f3c60909c612ccd978a2e381c4ac45?s=128&d=identicon&r=PG", "display_name": "user2085282", "link": "https://stackoverflow.com/users/2085282/user2085282"}, "edited": false, "score": 0, "creation_date": 1473018173, "post_id": 39320180, "comment_id": 65973596, "body": "Well, I don&#39;t know what else I can do to help you except maybe to look into this <a href=\"https://stackoverflow.com/questions/577302/gtk-textview-widget-doesnt-update-during-function\">question</a>. I&#39;m not sure it is related to your problem but you never know."}], "tags": [], "owner": {"reputation": 1134, "user_id": 2387806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebead5d6b9a6e8a2e443d77cd68d946b?s=128&d=identicon&r=PG", "display_name": "EvensF", "link": "https://stackoverflow.com/users/2387806/evensf"}, "is_accepted": false, "score": 1, "last_activity_date": 1473013661, "creation_date": 1473013661, "answer_id": 39320180, "question_id": 39319292, "link": "https://stackoverflow.com/questions/39319292/gtkoverlay-hides-gtktextview/39320180#39320180", "title": "GtkOverlay hides GtkTextView", "body": "<p>I don't know on what system your a running this example but it is working fine for me. The only caveat is that the top button appears over the bottom button and the <code>TextView</code> widget so I have to manually resize the <code>Window</code> to see the text. You can see a screen cast of my situation in this video: <a href=\"https://youtu.be/xoAH4OuEM0E\" rel=\"nofollow\">https://youtu.be/xoAH4OuEM0E</a></p>\n\n<p>Now depending on what you really want there may be few different answers. What I would suggest is putting the <code>TextView</code> inside a <a href=\"https://lazka.github.io/pgi-docs/Gtk-3.0/classes/ScrolledWindow.html\" rel=\"nofollow\"><code>ScrolledWindow</code></a>. This way the TextView will be at least visible before you would need the resize the window. It would also have the consequence to provide scrollbars if the text overflow the visible area.</p>\n\n<p>It could look like this:</p>\n\n<pre><code>import gi\ngi.require_version('Gtk', '3.0')\nfrom gi.repository import Gtk\n\nUSE_OVERLAY = True\n\nwin = Gtk.Window()\ntext_view = Gtk.TextView()\noverlay = Gtk.Overlay()\ntop_button = Gtk.Button()\nbottom_button = Gtk.Button()\ntop_container = Gtk.VBox()\nbottom_container = Gtk.VBox()\n\noverlay_str = \"( USE_OVERLAY = \" + str(USE_OVERLAY) + \")\"\nwin.set_title(overlay_str)\n\ntop_button.set_label(\"I'm a button on top!\")\nbottom_button.set_label(\"I'm a button on bottom!\")\ntext_view.get_buffer().set_text(\"This should be visible\")\n\n# This is where the text_view is inserted in a ScrolledWindow\nscrolled_window = Gtk.ScrolledWindow()     \nscrolled_window.add(text_view)\n\nwin.add(overlay)\noverlay.add(bottom_container)\nbottom_container.pack_start(bottom_button, False, False, 0)\n# The scrolled_window is inserted in the bottom_container\nbottom_container.pack_end(scrolled_window, True, True, 0) \nif USE_OVERLAY:\n    overlay.add_overlay(top_container)\n    top_container.pack_end(top_button, False, False, 0)\n\nwin.connect(\"delete-event\", Gtk.main_quit)\noverlay.show_all()\n\nwin.show_all()\nGtk.main()\n</code></pre>\n\n<p>You can also see the result on the aforementioned screencast. The only drawback is that the top button won't be able to overlay as much the bottom layer as in your script. But maybe it won't bother you.</p>\n"}], "owner": {"reputation": 997, "user_id": 2085282, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a7f3c60909c612ccd978a2e381c4ac45?s=128&d=identicon&r=PG", "display_name": "user2085282", "link": "https://stackoverflow.com/users/2085282/user2085282"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1473013661, "creation_date": 1473007881, "last_edit_date": 1473010977, "question_id": 39319292, "link": "https://stackoverflow.com/questions/39319292/gtkoverlay-hides-gtktextview", "title": "GtkOverlay hides GtkTextView", "body": "<p>I'm trying to develop an application using <code>Gtk</code>, and I have run into a problem using <code>GtkOverlay</code>. If I have a <code>GtkOverlay</code> with a <code>GtkTextView</code> that was added using the standard container <code>add</code> method, the text is hidden. However, all other widgets, say for example, buttons, appear just fine. Even more odd is the fact that this behavior is only present if at least one widget was adding using <code>add_overlay</code>.</p>\n\n<p><a href=\"https://i.stack.imgur.com/SG7up.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/SG7up.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/CjYgD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CjYgD.png\" alt=\"enter image description here\"></a></p>\n\n<pre><code>#!/usr/bin/env python\nimport gi\ngi.require_version('Gtk', '3.0')\nfrom gi.repository import Gtk\n\nUSE_OVERLAY = False\n\nwin = Gtk.Window()\ntext_view = Gtk.TextView()\noverlay = Gtk.Overlay()\ntop_button = Gtk.Button()\nbottom_button = Gtk.Button()\ntop_container = Gtk.VBox()\nbottom_container = Gtk.VBox()\n\noverlay_str = \"( USE_OVERLAY = \" + str(USE_OVERLAY) + \")\"\nwin.set_title(overlay_str)\n\ntop_button.set_label(\"I'm a button on top!\")\nbottom_button.set_label(\"I'm a button on bottom!\")\ntext_view.get_buffer().set_text(\"This should be visible\")\n\nwin.add(overlay)\noverlay.add(bottom_container)\nbottom_container.pack_start(bottom_button, False, False, 0)\nbottom_container.pack_end(text_view, True, True, 0)\nif USE_OVERLAY:\n    overlay.add_overlay(top_container)\n    top_container.pack_end(top_button, False, False, 0)\n\nwin.connect(\"delete-event\", Gtk.main_quit)\noverlay.show_all()\n\nwin.show_all()\nGtk.main()\n</code></pre>\n\n<p>I have reason to believe that this is not a python problem, as the actual application is written using <code>haskell-gi</code>, however I figured more people would be familiar with python.</p>\n"}, {"tags": ["linux", "ubuntu", "haskell", "linux-mint", "haskell-platform"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1473000982, "post_id": 39318167, "comment_id": 65968469, "body": "I&#39;m voting to close this question as off-topic because <a href=\"https://m.youtube.com/watch?v=nZoSZhxLGy8\" rel=\"nofollow noreferrer\">m.youtube.com/watch?v=nZoSZhxLGy8</a>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473004393, "post_id": 39318167, "comment_id": 65969517, "body": "@dfeuer I&#39;m voting to close this quesiton as off-topic because <a href=\"https://www.youtube.com/watch?v=pQJFWhn1R_w\" rel=\"nofollow noreferrer\">youtube.com/watch?v=pQJFWhn1R_w</a>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1473004664, "post_id": 39318167, "comment_id": 65969598, "body": "the currently maintained version of haskell on ubuntu is fairly old - better use <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow noreferrer\">launchpad.net/~hvr/+archive/ubuntu/ghc</a>"}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1473004678, "post_id": 39318327, "comment_id": 65969602, "body": "As with the other answer, this will lead to an outdated installation. Also, learn Markdown to format your answers properly."}], "tags": [], "owner": {"reputation": 87, "user_id": 5568434, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KUYtlKf_nP4/AAAAAAAAAAI/AAAAAAAAADk/lxZiYMfmv5o/photo.jpg?sz=128", "display_name": "eheller", "link": "https://stackoverflow.com/users/5568434/eheller"}, "is_accepted": false, "score": -1, "last_activity_date": 1473001631, "creation_date": 1473001631, "answer_id": 39318327, "question_id": 39318167, "link": "https://stackoverflow.com/questions/39318167/how-to-compile-and-run-haskell-program-in-ubuntu-linux-system/39318327#39318327", "title": "How to compile and run haskell program in ubuntu linux system?", "body": "<p>Install haskell-platform using \"sudo apt-get install haskell-platform\" in your commandline and then open another console and start ghci.</p>\n\n<p><a href=\"https://wiki.ubuntuusers.de/Haskell/\" rel=\"nofollow\">https://wiki.ubuntuusers.de/Haskell/</a></p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1473004500, "post_id": 39318538, "comment_id": 65969548, "body": "Depending on the Ubuntu version, that will install an ancient version of GHC and Cabal, and the <code>cabal install</code> <b><i>will</i></b> lead to Cabal hell. Also, you don&#39;t need <code>cabal install</code> for imports, at all, as long as the modules are in GHCs package database."}, {"owner": {"reputation": 1, "user_id": 6783246, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3m3a8.png?s=128&g=1", "display_name": "h31nr1ch", "link": "https://stackoverflow.com/users/6783246/h31nr1ch"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1473007272, "post_id": 39318538, "comment_id": 65970415, "body": "true, you don&#39;t need to install cabal for modules what are already in the ghc .  I said to install cabal because exist linux distributions you need."}, {"owner": {"reputation": 37, "user_id": 5710489, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/475978145906444/picture?type=large", "display_name": "Prashant Tripathi", "link": "https://stackoverflow.com/users/5710489/prashant-tripathi"}, "edited": false, "score": 0, "creation_date": 1473095928, "post_id": 39318538, "comment_id": 66001707, "body": "thank you guys for giving time on this outdated topic."}], "tags": [], "owner": {"reputation": 1, "user_id": 6783246, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3m3a8.png?s=128&g=1", "display_name": "h31nr1ch", "link": "https://stackoverflow.com/users/6783246/h31nr1ch"}, "is_accepted": false, "score": -3, "last_activity_date": 1473002933, "creation_date": 1473002933, "answer_id": 39318538, "question_id": 39318167, "link": "https://stackoverflow.com/questions/39318167/how-to-compile-and-run-haskell-program-in-ubuntu-linux-system/39318538#39318538", "title": "How to compile and run haskell program in ubuntu linux system?", "body": "<pre><code>sudo apt-get install ghc\n</code></pre>\n\n<p>and if you need to use imports like</p>\n\n<pre><code>import System.Environment\nimport Data.List\n</code></pre>\n\n<p>you need to install cabal,</p>\n\n<pre><code>sudo apt-get install cabal\n</code></pre>\n\n<p>after install cabal, you need to update him</p>\n\n<pre><code> cabal update\n</code></pre>\n\n<p>and you can install the packages with </p>\n\n<pre><code>cabal install name_package\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 5, "last_activity_date": 1473005077, "creation_date": 1473005077, "answer_id": 39318875, "question_id": 39318167, "link": "https://stackoverflow.com/questions/39318167/how-to-compile-and-run-haskell-program-in-ubuntu-linux-system/39318875#39318875", "title": "How to compile and run haskell program in ubuntu linux system?", "body": "<p>Follow the instructions on <a href=\"https://www.haskell.org/downloads\" rel=\"noreferrer\">the download page</a>. Any other approach will get out of date at some point. Depending on your syllabus, you could be fine with your distribution's packages; you're looking for the packages <code>ghc</code> and <code>cabal</code>. However, they are usually tremendously out-of-date.</p>\n\n<p>If you don't know how to install packages on Ubuntu with the command line yet, or don't have any experience with the command line, I recommend you <a href=\"http://linuxcommand.org/tlcl.php\" rel=\"noreferrer\">The Linux Command Line</a>, since there is a free (CC-BY-NC-ND) version.</p>\n"}], "owner": {"reputation": 37, "user_id": 5710489, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/475978145906444/picture?type=large", "display_name": "Prashant Tripathi", "link": "https://stackoverflow.com/users/5710489/prashant-tripathi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3198, "favorite_count": 0, "closed_date": 1575344099, "answer_count": 3, "score": -4, "last_activity_date": 1473005077, "creation_date": 1473000640, "question_id": 39318167, "link": "https://stackoverflow.com/questions/39318167/how-to-compile-and-run-haskell-program-in-ubuntu-linux-system", "closed_reason": "Not suitable for this site", "title": "How to compile and run haskell program in ubuntu linux system?", "body": "<p>I am new in ubuntu platform, i don't have idea how i can compile and run haskell code in ubuntu system, haskell is in my syllabus so i have to configure my system for haskell. Please show me the way.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 653, "user_id": 2236092, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8e95a9d73105658172c8932d5a920751?s=128&d=identicon&r=PG", "display_name": "schernichkin", "link": "https://stackoverflow.com/users/2236092/schernichkin"}, "edited": false, "score": 3, "creation_date": 1472997362, "post_id": 39317573, "comment_id": 65967269, "body": "I think problem is in <code>rankCard</code>. Check it return value. Possibly it returns empty list and then <code>head tnt1</code> fails with exception."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 3, "creation_date": 1472999029, "post_id": 39317573, "comment_id": 65967835, "body": "also, it&#39;s worth trying to write code without using <code>head</code>, using pattern matching instead, if possible..."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1472999203, "post_id": 39317573, "comment_id": 65967895, "body": "there is also be a problem if <code>rankCard</code> returne a singleton list - for <code>rank (head (tail tnt1))</code> in the first <code>else if</code> branch would then be an error."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1472999983, "post_id": 39317573, "comment_id": 65968129, "body": "could you please explain your second if statement? it seems you are doing a <code>if condition then &quot;something&quot; else &quot;the same thing&quot;</code> I see a small optimization step (or a possible logic error). also there is no need for <code>(x:xs)</code> and <code>(y:ys)</code> you are never using <code>x</code>,<code>y</code>,<code>xs</code> or <code>ys</code>, and another advice, your indentation/aligment seems to be misleading - the last else branch is inside the other else branch - not on the same level."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1473006066, "post_id": 39317573, "comment_id": 65970013, "body": "Try writing this without <code>head</code> and without <code>tail</code>. Run GHC or GHCi with the <code>-Wall</code> option and fix any warnings you get. (Take two aspirin and call me in the morning.)"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1473123580, "post_id": 39317573, "comment_id": 66009748, "body": "As an aside, you can simplify your code to something like this: <code>import Data.Ord (comparing); compareSmall [] _ = 0; compareSmall _ [] = 0; compareSmall as bs = length $ filter (&lt; minimumBy (comparing rank) bs) as</code>. I don\u2019t know what <code>rankCard</code> is supposed to mean, though."}], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 6793286, "user_type": "registered", "profile_image": "https://graph.facebook.com/1015010038597490/picture?type=large", "display_name": "Junwen Xie", "link": "https://stackoverflow.com/users/6793286/junwen-xie"}, "edited": false, "score": 0, "creation_date": 1473049984, "post_id": 39323648, "comment_id": 65979759, "body": "I understand!! it really helps me to learn how the Haskell works, Thank you very much!"}, {"owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "reply_to_user": {"reputation": 17, "user_id": 6793286, "user_type": "registered", "profile_image": "https://graph.facebook.com/1015010038597490/picture?type=large", "display_name": "Junwen Xie", "link": "https://stackoverflow.com/users/6793286/junwen-xie"}, "edited": false, "score": 0, "creation_date": 1473099660, "post_id": 39323648, "comment_id": 66003081, "body": "If you feel like it answered the question, could you mark it as the answer, just to &quot;close&quot; it? :)"}], "tags": [], "owner": {"reputation": 1872, "user_id": 701940, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6ea807bc634041db1c8ad327b770ee2?s=128&d=identicon&r=PG", "display_name": "Tehnix", "link": "https://stackoverflow.com/users/701940/tehnix"}, "is_accepted": false, "score": 1, "last_activity_date": 1473047213, "creation_date": 1473047213, "answer_id": 39323648, "question_id": 39317573, "link": "https://stackoverflow.com/questions/39317573/haskell-exception-prelude-head-empty-list/39323648#39323648", "title": "Haskell *** Exception: Prelude.head: empty list", "body": "<h3>Why</h3>\n\n<p>Your problem lies in <code>rankCard</code> returning an empty list and thus <code>tnt1</code> or <code>tnt2</code> is <code>[]</code> at some point. You then get the error when you do <code>head tnt1</code>, because <code>head</code> is a partial function, and will throw an exception on an empty list instead of a <code>Maybe</code>.</p>\n\n<p>This is happening in the call <code>else if  rank (head (tail tnt1)) == rank (head tnt2) then</code>, specifically <code>(head (tail tnt1))</code> giving an error when <code>tnt1</code> is a list containing 1 element.</p>\n\n<h3>Fixing it</h3>\n\n<p>It seems your second if-statement is not needed since you never modify your <code>tnt2</code> list, so it will be caught the final else by letting the recursion run one more time and not throw any errors. Your code could just be </p>\n\n<pre><code>compareSmall :: [Card] -&gt; [Card] -&gt; Int\ncompareSmall [] _ = 0\ncompareSmall _ [] = 0\ncompareSmall a b  =\n  if rank (head tnt1) &lt; rank (head tnt2)   then\n    1 + compareSmall (tail tnt1) b\n  else\n    0 + compareSmall (tail tnt1) b\n  where\n    tnt1 = rankCard a\n    tnt2 = rankCard b\n</code></pre>\n\n<hr>\n\n<p>Side-note: Haskell has syntax for keeping the whole list when you pattern match it, so you could do </p>\n\n<pre><code>compareSmall a@(x:xs) b@(y:ys) =\n  ...\n  where\n    tnt1 = rank a\n    tnt2 = rank b\n</code></pre>\n\n<p>if you ever need that.</p>\n"}], "owner": {"reputation": 17, "user_id": 6793286, "user_type": "registered", "profile_image": "https://graph.facebook.com/1015010038597490/picture?type=large", "display_name": "Junwen Xie", "link": "https://stackoverflow.com/users/6793286/junwen-xie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 991, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1473047213, "creation_date": 1472996788, "last_edit_date": 1473010854, "question_id": 39317573, "link": "https://stackoverflow.com/questions/39317573/haskell-exception-prelude-head-empty-list", "title": "Haskell *** Exception: Prelude.head: empty list", "body": "<p>this function is to find out how many elements in list A is smaller than the smallest element in list B</p>\n\n<p>every time the recursion happens the length list of A is reduce until emepty.</p>\n\n<p>however... it only return the Exception: Prelude.head: empty list \nnot even a 0..</p>\n\n<p>why it is happened?</p>\n\n<pre><code>compareSmall::[Card] -&gt; [Card] -&gt; Int\ncompareSmall [] _ = 0\ncompareSmall _ [] = 0\ncompareSmall (x:xs) (y:ys) =         \n        if   rank  (head tnt1) &lt; rank (head tnt2)   then         \n            1 + compareSmall (tail tnt1) (tnt2)      \n        else if  rank (head (tail tnt1)) == rank (head tnt2) then       \n            0 + compareSmall (tail tnt1) (tnt2)       \n        else \n            0 + compareSmall (tail tnt1) (tnt2)\n                    where tnt1 = rankCard (x:xs)\n                          tnt2 = rankCard (y:ys)\n</code></pre>\n"}, {"tags": ["linux", "haskell", "ubuntu-14.04", "cabal", "hackage"], "comments": [{"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1472989395, "post_id": 39316460, "comment_id": 65965105, "body": "Can you try to install it in a new sandbox with some verbosity: <code>mkdir &#47;tmp&#47;network; cd &#47;tmp&#47;network; cabal sandbox init; cabal install -j1 network</code>."}, {"owner": {"reputation": 812, "user_id": 3975579, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XBMKC.jpg?s=128&g=1", "display_name": "rbonallo", "link": "https://stackoverflow.com/users/3975579/rbonallo"}, "reply_to_user": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1472993461, "post_id": 39316460, "comment_id": 65966190, "body": "This also yielded similar results, when I run cabal install -j1 network -v I get makelike errors such as &quot;No hmake found, No hugs found&quot;. Are these critical errors?"}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1472994556, "post_id": 39316460, "comment_id": 65966465, "body": "Can you post the output that command somewhere, eg a pastebin? Also, can you install other packages?"}, {"owner": {"reputation": 812, "user_id": 3975579, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XBMKC.jpg?s=128&g=1", "display_name": "rbonallo", "link": "https://stackoverflow.com/users/3975579/rbonallo"}, "reply_to_user": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1472994966, "post_id": 39316460, "comment_id": 65966588, "body": "<a href=\"https://gist.github.com/anonymous/4bb309ef42c17323f2da7c132029e709\" rel=\"nofollow noreferrer\">gist.github.com/anonymous/4bb309ef42c17323f2da7c132029e709</a>. I can yes."}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1472995388, "post_id": 39316460, "comment_id": 65966730, "body": "Does it work if you try to install an older version of <code>network</code>, e.g. <code>cabal install network-2.4.0.1</code> (in a clean sandbox again)?"}, {"owner": {"reputation": 812, "user_id": 3975579, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XBMKC.jpg?s=128&g=1", "display_name": "rbonallo", "link": "https://stackoverflow.com/users/3975579/rbonallo"}, "reply_to_user": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1472996735, "post_id": 39316460, "comment_id": 65967097, "body": "No joy on other versions. Is it possible there is a collision between versions? I may have a default version of network installed."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1472999092, "post_id": 39316460, "comment_id": 65967858, "body": "you might also consider using <a href=\"http://haskellstack.org\" rel=\"nofollow noreferrer\">stack</a> instead of cabal..."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1472999486, "post_id": 39316460, "comment_id": 65967983, "body": "could you please list your <code>ghc --version</code>, <code>cabal --version</code>a, the output of <code>ghc-pkg list</code>"}, {"owner": {"reputation": 812, "user_id": 3975579, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XBMKC.jpg?s=128&g=1", "display_name": "rbonallo", "link": "https://stackoverflow.com/users/3975579/rbonallo"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1473003349, "post_id": 39316460, "comment_id": 65969215, "body": "@epsilonhalbe &quot;The Glorious Glasgow Haskell Compilation System, version 7.6.3&quot; &quot;cabal-install version 1.16.0.2 using version 1.16.0 of the Cabal library&quot; <a href=\"https://gist.github.com/anonymous/c1df7f21e6458e13269509d5a7f54c98\" rel=\"nofollow noreferrer\">gist.github.com/anonymous/c1df7f21e6458e13269509d5a7f54c98</a>"}, {"owner": {"reputation": 812, "user_id": 3975579, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XBMKC.jpg?s=128&g=1", "display_name": "rbonallo", "link": "https://stackoverflow.com/users/3975579/rbonallo"}, "edited": false, "score": 0, "creation_date": 1473003505, "post_id": 39316460, "comment_id": 65969274, "body": "So it would seem according to the ghc-pkg list I have network 2.4.1.2, would this conflict with version happstack-server is dependent on?"}], "answers": [{"comments": [{"owner": {"reputation": 812, "user_id": 3975579, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XBMKC.jpg?s=128&g=1", "display_name": "rbonallo", "link": "https://stackoverflow.com/users/3975579/rbonallo"}, "edited": false, "score": 0, "creation_date": 1473005884, "post_id": 39318749, "comment_id": 65969972, "body": "So I am here, stacked up. I have been reading the docs. Is it possible for me to install happstack-server and import the module in an isolated .hs script anywhere or do I need to go through the stack project workflow (<a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/README</a>) just to import an external module?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1473006468, "post_id": 39318749, "comment_id": 65970133, "body": "You can use the script interpreter approach. I wrote up a blog post on that recently <a href=\"https://www.fpcomplete.com/blog/2016/08/bitrot-free-scripts\" rel=\"nofollow noreferrer\">fpcomplete.com/blog/2016/08/bitrot-free-scripts</a>"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 1, "last_activity_date": 1473004240, "creation_date": 1473004240, "answer_id": 39318749, "question_id": 39316460, "link": "https://stackoverflow.com/questions/39316460/cabal-failing-to-install-network-2-6-3-1-on-linux/39318749#39318749", "title": "Cabal failing to install network-2.6.3.1 on Linux", "body": "<p>I would recommend using <a href=\"https://www.haskellstack.org/\" rel=\"nofollow\"><code>stack</code></a> it is fairly simply to install, also I would recommend using a newer version of GHC - this <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow\"><code>hvr-ppa</code></a> can help you (GHC 7.10.2 or 8.0.1 are recommended!) </p>\n\n<p>Remove your old <code>./ghc</code> directory and reinstall your old tooling with stack</p>\n\n<pre><code>stack install ghcid\nstack install ghc-mod\nstack install happstack-server\n</code></pre>\n\n<p><strong>Note:</strong> Do not forget to add <code>~/.local/bin</code> to your <code>$PATH</code> otherwise <code>ghc-mod</code> etc. will not be found.</p>\n\n<p>If you do not want to use <code>stack</code> - you need to find the cabal-package that installed the network package in it's old version - install that one in a sandbox and then install happstack-server in another sandbox.</p>\n\n<p>If I recall correctly - Cabal 1.16 does not support sandboxes.</p>\n"}], "owner": {"reputation": 812, "user_id": 3975579, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XBMKC.jpg?s=128&g=1", "display_name": "rbonallo", "link": "https://stackoverflow.com/users/3975579/rbonallo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 1, "accepted_answer_id": 39318749, "answer_count": 1, "score": 0, "last_activity_date": 1473004240, "creation_date": 1472988766, "last_edit_date": 1473003704, "question_id": 39316460, "link": "https://stackoverflow.com/questions/39316460/cabal-failing-to-install-network-2-6-3-1-on-linux", "title": "Cabal failing to install network-2.6.3.1 on Linux", "body": "<p>In short I am fairly new to the Haskell world and am having an issue installing a package with a dependency on network-2.6.3.1. </p>\n\n<pre><code>cabal install happstack-server\nResolving dependencies...\nConfiguring network-2.6.3.1...\nFailed to install network-2.6.3.1\ncabal: Error: some packages failed to install:\nhappstack-server-7.4.6.2 depends on network-2.6.3.1 which failed to install.\nhslogger-1.2.10 depends on network-2.6.3.1 which failed to install.\nnetwork-2.6.3.1 failed during the configure step. The exception was:\nExitFailure 127\nsendfile-0.7.9 depends on network-2.6.3.1 which failed to install.\n</code></pre>\n\n<p>Installing network on its own yields similar results. Are there any usual suspects or recommended steps for erroring installations? I have successfully installed other packages, ghcid, ghc-mod etc.</p>\n\n<h2>Update</h2>\n\n<pre><code>&gt; ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 7.6.3\n&gt; cabal --version\ncabal-install version 1.16.0.2 using version 1.16.0 of the Cabal library\"\n&gt; ghc-pkg list \n/var/lib/ghc/package.conf.d\n   Cabal-1.16.0\n   GLURaw-1.3.0.0\n   GLUT-2.4.0.0\n   HTTP-4000.2.8\n   HUnit-1.2.5.2\n   MonadCatchIO-mtl-0.3.0.5\n   OpenGL-2.8.0.0\n   OpenGLRaw-1.3.0.0\n   QuickCheck-2.6\n   array-0.4.0.1\n   async-2.0.1.4\n   attoparsec-0.10.4.0\n   base-4.6.0.1\n   bin-package-db-0.0.0.0\n   binary-0.5.1.1\n   bytestring-0.10.0.2\n   case-insensitive-1.1.0.2\n   cgi-3001.1.8.3\n   containers-0.5.0.0\n   deepseq-1.3.0.1\n   directory-1.2.0.1\n   extensible-exceptions-0.1.1.4\n   fgl-5.4.2.4\n   filepath-1.3.0.1\n   ghc-7.6.3\n   ghc-prim-0.3.0.0\n   hashable-1.2.1.0\n   haskell-src-1.0.1.5\n   haskell2010-1.1.1.0\n   haskell98-2.0.0.2\n   hoopl-3.9.0.0\n   hpc-0.6.0.0\n   html-1.0.1.2\n   integer-gmp-0.5.0.0\n   mtl-2.1.2\n   network-2.4.1.2\n   old-locale-1.0.0.5\n   old-time-1.1.0.1\n   parallel-3.2.0.3\n   parsec-3.1.3\n   pretty-1.1.1.0\n   primitive-0.5.0.1\n   process-1.1.0.2\n   random-1.0.1.1\n   regex-base-0.93.2\n   regex-compat-0.95.1\n   regex-posix-0.95.2\n   rts-1.0\n   split-0.2.2\n   stm-2.4.2\n   syb-0.4.0\n   template-haskell-2.8.0.0\n   text-0.11.3.1\n   time-1.4.0.1\n   transformers-0.3.0.0\n   unix-2.6.0.1\n   unordered-containers-0.2.3.0\n   vector-0.10.0.1\n   xhtml-3000.2.1\n   zlib-0.5.4.1\n/home/myHome/.ghc/x86_64-linux-7.6.3/package.conf.d\n   base64-bytestring-1.0.0.1\n   blaze-builder-0.4.0.2\n   blaze-html-0.8.1.2\n   blaze-markup-0.7.1.0\n   bytestring-0.10.8.1\n   bytestring-builder-0.10.8.1.0\n   cereal-0.5.3.0\n   exceptions-0.8.3\n   fail-4.9.0.0\n   monad-control-1.0.1.0\n   mtl-2.2.1\n   network-uri-2.6.1.0\n   parsec-3.1.11\n   system-filepath-0.4.13.4\n   threads-0.5.1.4\n   time-compat-0.1.0.3\n   transformers-0.5.2.0\n   transformers-base-0.4.4\n   transformers-compat-0.5.1.4\n   utf8-string-1.0.1.1\n</code></pre>\n"}, {"tags": ["function", "haskell", "simulation", "gloss"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1472998223, "post_id": 39315762, "comment_id": 65967579, "body": "What about just adding another state variable to record whether or not the simulation should be frozen?  If the <code>isFrozen</code> value is <code>True</code> you just return the current model; otherwise you evolve it - i.e. apply the step function."}], "answers": [{"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 0, "last_activity_date": 1473064260, "creation_date": 1473064260, "answer_id": 39326591, "question_id": 39315762, "link": "https://stackoverflow.com/questions/39315762/freeze-simulation-in-gloss-haskell/39326591#39326591", "title": "freeze simulation in gloss Haskell", "body": "<p>As @ErikR suggested, what you're describing amounts to not updating the model anymore once you've reached the state you are looking for. You can define a combinator acting on stepping functions doing precisely this:</p>\n\n<pre><code>untilModel\n  :: (ViewPort -&gt; Float -&gt; model -&gt; model)\n  -&gt; (model -&gt; Bool)\n  -&gt; (ViewPort -&gt; Float -&gt; model -&gt; model)\nuntilModel step isFrozen v f m =\n  if isFrozen m then m\n  else step v f m\n</code></pre>\n\n<p>When you have a <code>step</code> function and you want to stop the simulation when <code>isFrozen</code> becomes true of the model, you can simply pass <code>simulate</code> the altered step function <code>step `untilModel` isFrozen</code>.</p>\n"}], "owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 188, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1473064260, "creation_date": 1472983488, "question_id": 39315762, "link": "https://stackoverflow.com/questions/39315762/freeze-simulation-in-gloss-haskell", "title": "freeze simulation in gloss Haskell", "body": "<p>I'm using the gloss library to picture a simulation. Is there a function, which stops the <code>simulation</code> function when a condition is true. Just the last drawn picture should remain in the window. </p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1472969304, "post_id": 39313923, "comment_id": 65960507, "body": "Can you compute<code>sky [True, False]</code>? According to the type you have assigned it, you should be able to. What is the result?"}, {"owner": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1472969447, "post_id": 39313923, "comment_id": 65960529, "body": "@n.m I apologize, I am a newbie and am not sure I understand what you mean. I can&#39;t get the program to run at all."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1472969466, "post_id": 39313923, "comment_id": 65960533, "body": "Offtopic notes: <code>[&#39;a&#39;,&#39;e&#39;,&#39;i&#39;,&#39;o&#39;,&#39;u&#39;,&#39;y&#39;]</code> is exactly the same as <code>&quot;aeiouy&quot;</code>; <code>x : (&#39;o&#39; : [x]) ++ sky(rest)</code> is better written <code>x: &#39;o&#39; : x : sky rest</code>; you don&#39;t need parentheses to call a function; the <code>sky [a] = [a]</code> case is erroneous and should be deleted."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1472969663, "post_id": 39313923, "comment_id": 65960563, "body": "You expect <code>sky &quot;cat&quot;</code> to return <code>&quot;cocatot&quot;</code>, presumably because you have calculate it with pencil and paper or in your head or whatever. Using the same mode of calculations, what do you expect <code>sky [True, False]</code> to return?"}, {"owner": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1472969870, "post_id": 39313923, "comment_id": 65960595, "body": "@ n.m. I am not sure. I think it will return just &#39;o&#39;. I don&#39;t really know."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1472970247, "post_id": 39313923, "comment_id": 65960662, "body": "A function of type <code>[a]-&gt;[a]</code> should return the same kind of list it gets as its argument. <code>[True, False]</code> is a list of <code>Bool</code> and <code>&#39;o&#39;</code> is a character and not a list at all."}, {"owner": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1472984314, "post_id": 39313923, "comment_id": 65963910, "body": "Thank you I get it now :)"}], "answers": [{"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": true, "score": 3, "last_activity_date": 1472971695, "creation_date": 1472971695, "answer_id": 39314297, "question_id": 39313923, "link": "https://stackoverflow.com/questions/39313923/pirate-language-in-haskell/39314297#39314297", "title": "Pirate language in Haskell", "body": "<p>To answer to you type checking error. You declare <code>sky</code> as working with any list of <code>a</code> but <code>isConsonant</code> work only with <code>Char</code>, therefore <code>sky</code> can only work with list if <code>Char</code> too.</p>\n\n<p>Solution :  fix <code>sky</code> type signature to <code>String -&gt; String</code>  or even just remove it.</p>\n"}], "owner": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 39314297, "answer_count": 1, "score": 1, "last_activity_date": 1472971695, "creation_date": 1472968219, "last_edit_date": 1472970094, "question_id": 39313923, "link": "https://stackoverflow.com/questions/39313923/pirate-language-in-haskell", "title": "Pirate language in Haskell", "body": "<p>I am trying to create a function that changes </p>\n\n<blockquote>\n  <p>\"cat\" to \"cocatot\"</p>\n</blockquote>\n\n<p>by putting an 'o' if a consonant is detected and repeating the same consonant after that.</p>\n\n<p>This is what I have came up with so far. </p>\n\n<p>UPDATED (cleaner version)</p>\n\n<pre><code>isConsonant letter = notElem letter \"aeiouy\"\nsky :: [a] -&gt; [a]\n--sky [a] = [a]\nsky [] = []\nsky (x:rest) = if isConsonant x then x : 'o' : [x] ++ sky rest else x : sky rest\n</code></pre>\n\n<p>and get these errors</p>\n\n<pre><code> * Couldn't match expected type `Char' with actual type `a'\n      `a' is a rigid type variable bound by\n        the type signature for:\n          sky :: forall a. [a] -&gt; [a]\n\n * In the first argument of `isConsonant', namely `(x)'\n      In the expression: isConsonant (x)\n      In the expression:\n        if isConsonant (x) then\n            x : ('o' : [x]) ++ sky (rest)\n        else\n            x : sky (rest)\n</code></pre>\n\n<p>Any help is really appreciated. I am a beginner in Haskell and I am getting nowhere. </p>\n"}, {"tags": ["haskell", "pointfree"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 6, "creation_date": 1472961614, "post_id": 39313267, "comment_id": 65959513, "body": "How about making it simpler by breaking it into easy-to-understand pieces, instead?"}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1472962038, "post_id": 39313267, "comment_id": 65959565, "body": "Sure, I&#39;m open to suggestions."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1472962900, "post_id": 39313267, "comment_id": 65959660, "body": "Well, how about a function to line up a string with the spaces in another string, plus <code>cycle</code>."}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1472979003, "post_id": 39313267, "comment_id": 65962527, "body": "@ReidBarton thanks, implemented."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1473043282, "post_id": 39313267, "comment_id": 65978493, "body": "What if <code>length str != len</code>? There&#39;s no reason to pass the length as an explicit argument; just infer it from the given string."}], "answers": [{"comments": [{"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 0, "creation_date": 1472962097, "post_id": 39313397, "comment_id": 65959577, "body": "I wonder if <code>flip flip</code> can be eliminated since they cancel out?"}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "reply_to_user": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "edited": false, "score": 3, "creation_date": 1472962487, "post_id": 39313397, "comment_id": 65959616, "body": "@dimid No, they do not cancel out. Remember, function application is left associative, so e.g. <code>flip flip snd</code> is the same as <code>(flip flip) snd</code> and <i>not</i> <code>flip (flip snd)</code>."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 5, "last_activity_date": 1472961301, "creation_date": 1472961301, "answer_id": 39313397, "question_id": 39313267, "link": "https://stackoverflow.com/questions/39313267/make-this-function-tacit/39313397#39313397", "title": "Make this function tacit", "body": "<p>I seriously doubt it that this particular function can be made more simple by writing it in a point-free style. For example, here's what I got from <a href=\"http://pointfree.io/\">pointfree.io</a>:</p>\n\n<pre><code>cycleWS = ((fst .) .) . flip flip (([]), 0) . (foldr .) . flip flip snd . ((flip . (ap .)) .) . flip flip fst . ((flip . ((.) .) . flip (ap . (ap .) . (. ((,) . (++ \" \"))) . (.) . if' . (' ' ==))) .) . flip flip (1 +) . ((flip . (liftM2 (,) .) . flip ((.) . (++))) .) . flip flip ([]) . ((flip . ((:) .)) .) . (. flip mod) . (.) . (!!)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1472979190, "post_id": 39315128, "comment_id": 65962576, "body": "You can use <code>isSpace</code> for more space characters."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1472979371, "post_id": 39315128, "comment_id": 65962624, "body": "By the way, this is far superior to the code you started out with. I&#39;m allergic to <code>!!</code>."}, {"owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472979472, "post_id": 39315128, "comment_id": 65962650, "body": "Out of curiosity, why? Is <code>!!</code> considered a code smell?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 6, "creation_date": 1472979829, "post_id": 39315128, "comment_id": 65962724, "body": "It&#39;s a partial function and it&#39;s also slow as molasses. The combination is terrible."}], "tags": [], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "is_accepted": false, "score": 7, "last_activity_date": 1472983006, "last_edit_date": 1472983006, "creation_date": 1472978913, "answer_id": 39315128, "question_id": 39313267, "link": "https://stackoverflow.com/questions/39313267/make-this-function-tacit/39315128#39315128", "title": "Make this function tacit", "body": "<p>Following @Reid Barton's suggestion:</p>\n\n<pre><code>-- Cycle with respect to whitespace (currently only spaces).\n-- Given a source string and its length, and a longer target string\n-- (which may contain spaces) match the source to target such that:\n-- 1. both will have the same length\n-- 2. spaces in the target string will remain spaces\n-- 3. chars from the source string will be cycled\n--\n-- Example:\n-- src: \"ALLY\", len: 4\n-- target: \"MEET AT DAWN\"\n-- Result: \"ALLY AL LYAL\"                  \ncycleWS :: String -&gt; String -&gt; String\ncycleWS = align . cycle\n\n-- Align with respect to spaces.\n-- Given two strings, source and target, align the source to target such that:\n-- 1. both will have the same length\n-- 2. spaces in the target string will remain spaces\n-- Assume the source string is long enough \nalign :: String -&gt; String -&gt; String\nalign [] _  = []\nalign _ [] = []\nalign (x:xs) (y:ys) = if isSpace y then y : align (x:xs) ys else x : align xs ys\n</code></pre>\n"}], "owner": {"reputation": 6119, "user_id": 165753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/w6iBN.jpg?s=128&g=1", "display_name": "dimid", "link": "https://stackoverflow.com/users/165753/dimid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 39313397, "answer_count": 2, "score": 1, "last_activity_date": 1472983006, "creation_date": 1472959567, "last_edit_date": 1472961388, "question_id": 39313267, "link": "https://stackoverflow.com/questions/39313267/make-this-function-tacit", "title": "Make this function tacit", "body": "<p>I'd like to make this function point-free, in order to simplify it. I'm passing the length explicitly instead of computing it, since I also need it for other functions, and I'd like to compute it just once. I've manged to get rid of the target string parameter, but struggling with the other two.</p>\n\n<pre><code>-- Cycle with respect to whitespace (currently only spaces).\n-- Given a source string and its length, and a longer target string\n-- (which may contain spaces) match the source to target such that:\n-- 1. both will have the same length\n-- 2. spaces in the target string will remain spaces\n-- 3. chars from the source string will be cycled\n--\n-- Example:\n-- src: \"ALLY\", len: 4\n-- target: \"MEET AT DAWN\"\n-- Result: \"ALLY AL LYAL\"                  \ncycleWS :: String -&gt; Int -&gt; String -&gt; String\ncycleWS str len = fst . (foldr (\\x (s, n) -&gt; if x == ' ' then (s ++ \" \", n) else (s ++ [str !! (n `mod` len)], n + 1)) (\"\", 0))\n</code></pre>\n"}, {"tags": ["haskell", "clojure", "functional-programming", "currying", "transducer"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1472957328, "post_id": 39313019, "comment_id": 65959014, "body": "I don&#39;t think <code>reduce</code> is a standard Haskell function. Although I suppose you probably mean one of <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#v:foldr1\" rel=\"nofollow noreferrer\"><code>foldr1</code></a> or <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html#v:foldl1\" rel=\"nofollow noreferrer\"><code>foldl1</code></a>."}, {"owner": {"reputation": 2245, "user_id": 1512161, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a6ac07e8e5efbba8bec17c104c8e4bb8?s=128&d=identicon&r=PG", "display_name": "Fuad Saud", "link": "https://stackoverflow.com/users/1512161/fuad-saud"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1472957425, "post_id": 39313019, "comment_id": 65959030, "body": "You&#39;re correct, I mixed them up."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1472958626, "post_id": 39313019, "comment_id": 65959163, "body": "Depending on whether or not you compile with optimizations, the first is subject to stream fusion, so it will almost certainly end up running as one tight loop (no extra intermediate allocations). I believe that transducers give you similar (if not as powerful / no overhead) benefits, so the third example should run sort of like the first. On the other hand, the second almost certainly is much less efficient - you&#39;ll end up building intermediate lists which are anyways garbage collected immediately."}, {"owner": {"reputation": 2245, "user_id": 1512161, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a6ac07e8e5efbba8bec17c104c8e4bb8?s=128&d=identicon&r=PG", "display_name": "Fuad Saud", "link": "https://stackoverflow.com/users/1512161/fuad-saud"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1472959246, "post_id": 39313019, "comment_id": 65959241, "body": "Ok, so, I knew this was how Haskell behaved by default but I didn&#39;t know it was called &quot;stream fusion&quot;. That&#39;s nice to know. Actually I thought that&#39;s how Clojure behaved as well, but it seems I was wrong? Anyway, is it valid to say: 1st and 3rd are <code>O(n)</code> while 2nd is <code>O(3n)</code>?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1472960259, "post_id": 39313019, "comment_id": 65959368, "body": "Well I wouldn&#39;t be so sure about that... the benefits and drawbacks are in space-complexity here. So the time benefits are observable through the time garbage collection takes, which isn&#39;t really something so predictable."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1472979749, "post_id": 39313019, "comment_id": 65962707, "body": "You&#39;re misusing big-O notation. Garbage collection is definitely one concern; another is cache utilization. If you build a giant list, most of it will fall out of cache before you&#39;re ready to start the next transformation. @Alec, this is a form of &quot;short cut deforestation&quot; called foldr/build fusion. Stream fusion usually refers to a different technique with similar goals."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1472984176, "post_id": 39313019, "comment_id": 65963864, "body": "@FuadSaud Any O(n) function is O(kn) for evey <code>k</code> positive natural number so there is <i>zero</i> distinction between O(n) and O(3n) or O(1000n). If you want to say &quot;The code X performs <i>exactly</i> <code>n</code> computational steps/memory allocations/whatever thing you want to measure&quot; you should say &quot;The code X has complexity <code>n</code> (or <code>n+k</code> if you want), while code Y has complexity <code>3n+k</code>&quot;, where both functions belong to the set O(n) which is the <i>same set of functions</i> as O(3n) and O(kn) for every positive <code>k</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473002630, "post_id": 39313019, "comment_id": 65968985, "body": "@dfeuer Thanks for the correction! Where <i>is</i> stream fusion actually used? <a href=\"http://code.haskell.org/~dons/papers/icfp088-coutts.pdf\" rel=\"nofollow noreferrer\">This</a> paper had me thinking it was applied to lists for GHC. There&#39;s also <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/07/haskell-beats-C.pdf\" rel=\"nofollow noreferrer\">this</a> paper that talks about <code>vector</code>, but now I&#39;m not sure about anything anymore! I&#39;ll have to actually read the source!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1473007703, "post_id": 39313019, "comment_id": 65970550, "body": "@Alec, the <code>vector</code> package is the big one I know about, which is sadly greatly complicated by various factors, but I think there&#39;s also one called <code>stream-fusion</code> or something."}, {"owner": {"reputation": 2245, "user_id": 1512161, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a6ac07e8e5efbba8bec17c104c8e4bb8?s=128&d=identicon&r=PG", "display_name": "Fuad Saud", "link": "https://stackoverflow.com/users/1512161/fuad-saud"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1473014611, "post_id": 39313019, "comment_id": 65972641, "body": "@Bakuriu thanks for the correction, that&#39;s what I wanted to convey"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1473018896, "post_id": 39313019, "comment_id": 65973768, "body": "@dfeuer IIRC <code>stream-fusion</code> is literally the implementation of the first stream fusion paper I referenced above. And that package hasn&#39;t been updated since 2013. :S  Also, slightly off topic, but I just realized you are the person to ask for this: is there any literature/documentation on the fusion techniques in <code>containers</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1473020476, "post_id": 39313019, "comment_id": 65974158, "body": "@Alec, I don&#39;t think there&#39;s any documentation, and I don&#39;t know about literature. <code>containers</code> doesn&#39;t have any sort of general fusion framework; it just implements a few simple fusion laws like <code>map&#47;map</code>, <code>traverse&#47;map</code>, <code>map&#47;reverse</code>, etc. If you want more, let me know on GitHub."}], "answers": [{"tags": [], "owner": {"reputation": 473, "user_id": 1011662, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bf9390bb67fc3879da44c0c8c7943d9?s=128&d=identicon&r=PG", "display_name": "matrix10657", "link": "https://stackoverflow.com/users/1011662/matrix10657"}, "is_accepted": true, "score": 4, "last_activity_date": 1472993627, "creation_date": 1472993627, "answer_id": 39317115, "question_id": 39313019, "link": "https://stackoverflow.com/questions/39313019/whats-the-difference-between-these-functions-implemented-with-currying-and-tran/39317115#39317115", "title": "What&#39;s the difference between these functions implemented with currying and transducers?", "body": "<p>The intermediate steps between the second and third example are the same <em>for this specific example</em>. This is due to the fact that <strong>map</strong> and <strong>filter</strong> are implemented as lazy transformations of a sequence into a sequence, as you\u2019re no-doubt already aware.</p>\n\n<p>The transducer versions of map and filter are defined using the same <em>essential functionality</em> as the not-transducer versions, except that the way they \u201cconj\" (or not, in the case of filter) onto the result stream is defined elsewhere. Indeed, if u look at the source for map, there are <a href=\"https://github.com/clojure/clojure/blob/clojure-1.8.0/src/clj/clojure/core.clj#L2646\" rel=\"nofollow\">explicit data-structure construction functions</a> in use, whereas the <a href=\"https://github.com/clojure/clojure/blob/clojure-1.8.0/src/clj/clojure/core.clj#L2627\" rel=\"nofollow\">transducer variant</a> uses no such functions -- they are passed in via <code>rf</code>. Explicitly using <code>cons</code> in the non-transducer versions means they're always going to be dealing with sequences</p>\n\n<p>IMO, the main benefit of using transducers is that you have the ability to define the <em>process</em> that you're doing away from the thing which will use your process. Therefore perhaps a more interesting rewrite of your third example may be:</p>\n\n<pre><code>(def process (comp (filter even)\n                   (map #(* 7 %))))\n\n(defn f [coll] (transduce process + collection))\n</code></pre>\n\n<p>Its an exercise to the application author to decide when this sort of abstraction is necessary, but it can definitely open an opportunity for reuse.</p>\n\n<hr>\n\n<p>It may occur to you that you can simply rewrite</p>\n\n<pre><code>(defn process [coll]\n  ((comp\n    (partial map #(* 7 %)\n    (partial filter even?)) coll))\n\n(reduce + (process coll))\n</code></pre>\n\n<p>And get the same effect; this is true. <strong>When your input is always a sequence</strong> (or always the same kind of stream / you know what kind of stream it will be) there's arguably not a good reason to create a transducer. But the power of reuse can be demonstrated here (assume process is a transducer)</p>\n\n<pre><code>(chan 1 process)  ;; an async channel which runs process on all inputs\n\n(into [] process coll)  ;; writing to a vector\n\n(transduce + process coll)  ;; your goal\n</code></pre>\n\n<p>The motivation behind transducers was essentially to stop having to write new collection functions for different collection types. Rich Hickey mentions his frustration writing functions like map&lt; map> mapcat&lt; mapcat>, and so on in the core async library -- <em>what</em> map and mapcat <em>are</em>, is already defined, but because they <em>assume</em> that they operate on sequences (that explicit <code>cons</code> I linked above), they cant be applied to asnychronous channels. But channels can supply their own <code>rf</code> in the transducer version to let them reuse these functions.</p>\n"}], "owner": {"reputation": 2245, "user_id": 1512161, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a6ac07e8e5efbba8bec17c104c8e4bb8?s=128&d=identicon&r=PG", "display_name": "Fuad Saud", "link": "https://stackoverflow.com/users/1512161/fuad-saud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 1, "accepted_answer_id": 39317115, "answer_count": 1, "score": 3, "last_activity_date": 1472993627, "creation_date": 1472955764, "last_edit_date": 1472957458, "question_id": 39313019, "link": "https://stackoverflow.com/questions/39313019/whats-the-difference-between-these-functions-implemented-with-currying-and-tran", "title": "What&#39;s the difference between these functions implemented with currying and transducers?", "body": "<p>Taking the three functions below, implemented in Haskell and Clojure respectively:</p>\n\n<pre><code>f :: [Int] -&gt; Int\nf = foldl1 (+) . map (*7) . filter even\n</code></pre>\n\n<hr>\n\n<pre><code>(defn f [coll]\n  ((comp\n    (partial reduce +)\n    (partial map #(* 7 %)\n    (partial filter even?)) coll))\n</code></pre>\n\n<hr>\n\n<pre><code>(defn f [coll]\n  (transduce\n    (comp\n      (filter even?)\n      (map #(* 7 %)))\n     + coll))\n</code></pre>\n\n<p>when they are applied to a list like <code>[1, 2, 3, 4, 5]</code> they all return <code>42</code>. I know the machinery behind the first 2 is similar since <code>map</code> is lazy in Clojure, but the third one uses transducers. Could someone show the intermediate steps for the execution of these functions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1472949442, "post_id": 39312440, "comment_id": 65957964, "body": "I think that is just a bad example of parsers and of MonadPlus."}], "answers": [{"comments": [{"owner": {"reputation": 1002, "user_id": 2016455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/17d5b8c3cce04fa2071d7919d8671b4d?s=128&d=identicon&r=PG", "display_name": "Albert Netymk", "link": "https://stackoverflow.com/users/2016455/albert-netymk"}, "edited": false, "score": 0, "creation_date": 1473002027, "post_id": 39312536, "comment_id": 65968785, "body": "Thanks for the explanation. IOW, the claim in the wikibook, &quot;The do-block assures that any failed pattern match will result in returning Nothing.&quot; is incorrect, right?"}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "reply_to_user": {"reputation": 1002, "user_id": 2016455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/17d5b8c3cce04fa2071d7919d8671b4d?s=128&d=identicon&r=PG", "display_name": "Albert Netymk", "link": "https://stackoverflow.com/users/2016455/albert-netymk"}, "edited": false, "score": 0, "creation_date": 1473002089, "post_id": 39312536, "comment_id": 65968803, "body": "@AlbertNetymk Yes, you could say that"}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 2, "last_activity_date": 1472949507, "last_edit_date": 1472949507, "creation_date": 1472949152, "answer_id": 39312536, "question_id": 39312440, "link": "https://stackoverflow.com/questions/39312440/haskell-wikibook-monadplus-potential-error/39312536#39312536", "title": "haskell wikibook monadplus potential error", "body": "<p>The code in wikibooks does not account for the case when the input string is empty. When the line <code>let (c:_) = s</code> is executed and <code>s</code> is empty, it will cause a failure in the pattern matching and an exception will be thrown. Your suggestion <code>(c:_) &lt;- return s</code> is actually quite similar to the one used, except for one difference; when the pattern matching in a monadic bind (i.e. <code>&lt;-</code>) fails, then the <code>fail</code> method of the monad will be called. Now, in the <code>Maybe</code> monad, <code>fail</code> is <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/GHC.Base.html#line-665\" rel=\"nofollow\">defined</a> to always return <code>Nothing</code>,so it will cause the whole <code>do</code> block to return <code>Nothing</code>. One thing I don't like about using your suggestion is that I personally don't consider using <code>fail</code> to be the most elegant solution and I would prefer to use a <code>case</code> expression in the case:</p>\n\n<pre><code>digit :: Int -&gt; String -&gt; Maybe Int\ndigit i s | i &gt; 9 || i &lt; 0 = Nothing\n          | otherwise      =\n    case s of\n        c:_ | [c] == show i -&gt; Just i\n        _ -&gt; Nothing\n</code></pre>\n\n<p>In fact, as you can see, we don't need to use a <code>do</code> block at all.</p>\n\n<p>Finally, here's a more compact version of the above code:</p>\n\n<pre><code>digit :: Int -&gt; String -&gt; Maybe Int\ndigit i s | 0 &lt;= i, i &lt;= 9, c:_ &lt;- s, [c] == show i = Just i\n          | otherwise = Nothing\n</code></pre>\n"}], "owner": {"reputation": 1002, "user_id": 2016455, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/17d5b8c3cce04fa2071d7919d8671b4d?s=128&d=identicon&r=PG", "display_name": "Albert Netymk", "link": "https://stackoverflow.com/users/2016455/albert-netymk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 39312536, "answer_count": 1, "score": 0, "last_activity_date": 1472949507, "creation_date": 1472948052, "question_id": 39312440, "link": "https://stackoverflow.com/questions/39312440/haskell-wikibook-monadplus-potential-error", "title": "haskell wikibook monadplus potential error", "body": "<p>Was reading monadplus chapter of haskell wiki book: <a href=\"https://en.wikibooks.org/wiki/Haskell/MonadPlus\" rel=\"nofollow\">https://en.wikibooks.org/wiki/Haskell/MonadPlus</a></p>\n\n<pre><code>digit :: Int -&gt; String -&gt; Maybe Int\ndigit i s | i &gt; 9 || i &lt; 0 = Nothing\n          | otherwise      = do\n  let (c:_) = s\n  if [c] == show i then Just i else Nothing\n</code></pre>\n\n<p>\"The do-block assures that any failed pattern match will result in returning Nothing.\"</p>\n\n<p>However, when I tried <code>digit 1 \"\"</code>, it produces irrefutable runtime error, instead of \"Nothing\".</p>\n\n<p>I can get around it using <code>(c:_) &lt;- return s</code>. It would be great if someone more experienced in haskell could confirm/clarify on this.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1472944159, "post_id": 39311908, "comment_id": 65957032, "body": "You can use the <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Type.html#t:Traversal-39-\" rel=\"nofollow noreferrer\"><code>Traversal&#39;</code></a> returned by <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-At.html#v:ix\" rel=\"nofollow noreferrer\"><code>ix</code></a>, but just give it a type of <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Type.html#t:Fold\" rel=\"nofollow noreferrer\"><code>Fold</code></a>. Folds are read-only traversals, in some sense. Of course this doesn&#39;t help you if the type is abstract and you can&#39;t write to it, because you won&#39;t be able to instantiate <code>Ixed</code>."}], "answers": [{"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 2, "last_activity_date": 1472988575, "creation_date": 1472988575, "answer_id": 39316434, "question_id": 39311908, "link": "https://stackoverflow.com/questions/39311908/what-in-lens-should-i-use-to-build-a-read-only-getter-by-index/39316434#39316434", "title": "What in lens should I use to build a read-only getter by index?", "body": "<p>If you want to define <em>read-only</em> lens you should use <code>Getter</code> type. Let's first consider simple example. You can access element by index using <code>^?</code> and <code>ix</code> functions.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb: [1..] ^? ix 10\nJust 11\n\u03bb: import qualified Data.Map as M\n\u03bb: M.empty ^? ix 'a'\nNothing\n\u03bb: M.singleton 'a' 3 ^? ix 'a'\nJust 3\n</code></pre>\n\n<p>So it was an example of how you can use standard lenses to access indexed data structures. These knowledges should be enough to define your own readonly indexed getter but I'll give extended example.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes      #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport Control.Lens\n\ndata MyData = MkData\n    { _innerList  :: [Int]\n    , _dummyField :: Double\n    }\n\nmakeLenses ''MyData\n\nindexedGetter :: Int -&gt; Getter MyData (Maybe Int)\nindexedGetter i = innerList . to (^? ix i)\n</code></pre>\n\n<p>Now in ghci you can use this getter.</p>\n\n<pre><code>\u03bb: let exampleData = MkData [2, 1, 3] 0.3 \n\u03bb: exampleData ^. indexedGetter 0\nJust 2\n\u03bb: exampleData &amp; indexedGetter 0 .~ Just 100\n\n&lt;interactive&gt;:7:15:\n    No instance for (Contravariant Identity)\n      arising from a use of \u2018indexedGetter\u2019\n    In the first argument of \u2018(.~)\u2019, namely \u2018indexedGetter 0\u2019\n    In the second argument of \u2018(&amp;)\u2019, namely\n      \u2018indexedGetter 0 .~ Just 100\u2019\n    In the expression: exampleData &amp; indexedGetter 0 .~ Just 100\n</code></pre>\n"}], "owner": {"reputation": 2704, "user_id": 2629787, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HApc9.jpg?s=128&g=1", "display_name": "Koz Ross", "link": "https://stackoverflow.com/users/2629787/koz-ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "accepted_answer_id": 39316434, "answer_count": 1, "score": 4, "last_activity_date": 1472988575, "creation_date": 1472942124, "question_id": 39311908, "link": "https://stackoverflow.com/questions/39311908/what-in-lens-should-i-use-to-build-a-read-only-getter-by-index", "title": "What in lens should I use to build a read-only getter by index?", "body": "<p>I have a type whose internal details are hidden. I want to provide some kind of lens that can read elements from said type at particular indexes, but <em>not</em> modify them.  An <code>Ixed</code> instance for my type doesn't seem to do what I want, as it explicitly allows modifications (though not insertions or deletions). I'm not sure what I use if I want to allow read-only indexing.</p>\n"}, {"tags": ["unit-testing", "haskell", "cabal"], "comments": [{"owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "edited": false, "score": 0, "creation_date": 1472927521, "post_id": 39310043, "comment_id": 65952978, "body": "Your code (plus a stub Foo.hs) works for me.  I&#39;ve seen that error happen when the test program crashes."}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1472931964, "post_id": 39310043, "comment_id": 65954207, "body": "I cannot reproduce that too."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1472935229, "post_id": 39310043, "comment_id": 65955115, "body": "This works fine for me, using the same ghc and cabal. Did you try <code>cabal clean</code> before building?"}, {"owner": {"reputation": 107, "user_id": 3453051, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c3c9e02f47e939f6216365f8655ff7cb?s=128&d=identicon&r=PG&f=1", "display_name": "mgmillani", "link": "https://stackoverflow.com/users/3453051/mgmillani"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1472937867, "post_id": 39310043, "comment_id": 65955750, "body": "@Michael Yes, I tried to run <code>cabal clean</code>, but it made no difference. Is there any configuration that could interfere with this? Or any package?"}], "answers": [{"tags": [], "owner": {"reputation": 107, "user_id": 3453051, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c3c9e02f47e939f6216365f8655ff7cb?s=128&d=identicon&r=PG&f=1", "display_name": "mgmillani", "link": "https://stackoverflow.com/users/3453051/mgmillani"}, "is_accepted": true, "score": 0, "last_activity_date": 1472998023, "last_edit_date": 1472998023, "creation_date": 1472997613, "answer_id": 39317695, "question_id": 39310043, "link": "https://stackoverflow.com/questions/39310043/getting-prelude-read-no-parse-error-when-using-detailed-0-9-tests-with-cabal/39317695#39317695", "title": "Getting &quot;Prelude.read: no parse&quot; error when using detailed-0.9 tests with cabal", "body": "<p>The problem seems to be with dynamic linkage. Cabal could not find the .so of the test. In my case, adding a link to <code>dist/build/bar-1.0-1l0Xa8pRO0dDWU0quwEdrS-test-bar.test/libHSbar-1.0-1l0Xa8pRO0dDWU0quwEdrS-test-bar.test-ghc8.0.1.so</code> solved the problem, but the filename probably changes.</p>\n\n<p>The alternative is to use <code>cabal configure --enable-tests --disable-shared</code> when configuring the package (I use <code>--enable-shared</code> implicitly in my cabal config). Or I can hack a script which sets <code>LD_LIBRARY_PATH</code> to the proper value before calling <code>cabal test</code>.</p>\n\n<p>EDIT: there is already a <a href=\"https://github.com/haskell/cabal/pull/3527\" rel=\"nofollow\">pull request on github</a>.</p>\n"}], "owner": {"reputation": 107, "user_id": 3453051, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c3c9e02f47e939f6216365f8655ff7cb?s=128&d=identicon&r=PG&f=1", "display_name": "mgmillani", "link": "https://stackoverflow.com/users/3453051/mgmillani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 39317695, "answer_count": 1, "score": 2, "last_activity_date": 1472998023, "creation_date": 1472926721, "last_edit_date": 1472928464, "question_id": 39310043, "link": "https://stackoverflow.com/questions/39310043/getting-prelude-read-no-parse-error-when-using-detailed-0-9-tests-with-cabal", "title": "Getting &quot;Prelude.read: no parse&quot; error when using detailed-0.9 tests with cabal", "body": "<p>I tried to follow <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#test-suites\" rel=\"nofollow\">this guide</a> in order to write some tests for a Haskell package using the <code>detailed-0.9</code> test type. The cabal file is</p>\n\n<pre><code>Name:           bar\nVersion:        1.0\nLicense:        BSD3\nCabal-Version:  &gt;= 1.10\nBuild-Type:     Simple\n\nLibrary\n    exposed-modules:     Foo\n    build-depends:       base &gt;=4.9 &amp;&amp; &lt;4.10\n    default-language:    Haskell2010\n\nTest-Suite test-bar\n    type:       detailed-0.9\n    test-module: Bar\n    build-depends: base, Cabal &gt;= 1.9.2\n    default-language:    Haskell2010\n</code></pre>\n\n<p>and Bar.hs is</p>\n\n<pre><code>module Bar ( tests ) where\n\nimport Distribution.TestSuite\n\ntests :: IO [Test]\ntests = return [ Test succeeds, Test fails ]\n  where\n    succeeds = TestInstance\n        { run = return $ Finished Pass\n        , name = \"succeeds\"\n        , tags = []\n        , options = []\n        , setOption = \\_ _ -&gt; Right succeeds\n        }\n    fails = TestInstance\n        { run = return $ Finished $ Fail \"Always fails!\"\n        , name = \"fails\"\n        , tags = []\n        , options = []\n        , setOption = \\_ _ -&gt; Right fails\n        }\n</code></pre>\n\n<p>However, when I run the tests with</p>\n\n<pre><code>cabal configure --enable-tests\ncabal build\ncabal test\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>Preprocessing test suite 'test-bar' for bar-1.0...\n[1 of 1] Compiling Main             ( dist/build/test-barStub/test-barStub-tmp/test-barStub.hs, dist/build/test-barStub/test-barStub-tmp/Main.dyn_o )\nLinking dist/build/test-barStub/test-barStub ...\nRunning 1 test suites...\nTest suite test-bar: RUNNING...\nPrelude.read: no parse\n</code></pre>\n\n<p>This also happens with the code from <a href=\"https://github.com/michaxm/test-detailed-example\" rel=\"nofollow\">this repository</a>.</p>\n\n<p>Using <code>strace cabal test</code> I managed to see that the last file that cabal tries to open is <code>dist/test/cabal-test-1804289383846930886.log</code>, which does not exist. Creating the file does not help.</p>\n\n<p>Is the <code>detailed-0.9</code> test type still experimental? Should I use <code>exitcode-stdio-1.0</code> instead?</p>\n\n<p>GHC version: 8.0.1<br>\ncabal version: 1.24.0.0</p>\n\n<p>EDIT:\nThe error persists even if I set <code>tests = return []</code> in <code>Bar.hs</code>.</p>\n"}, {"tags": ["c", "haskell", "ffi"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1472926751, "post_id": 39309749, "comment_id": 65952746, "body": "Will the C routine modify the two arrays?"}, {"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472926832, "post_id": 39309749, "comment_id": 65952770, "body": "@chi No. At least not for the applications I have in mind."}], "answers": [{"comments": [{"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 0, "creation_date": 1472926390, "post_id": 39309871, "comment_id": 65952625, "body": "Interesting! Is the data inside &quot;d&quot; copied into a separate corresponding C-struct, on which c_myfunc operates? Or does c_myfunc operate directly on the &quot;d&quot; record, as if it were a C-type. This would be very important to know for performance when dealing with large data."}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "reply_to_user": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 0, "creation_date": 1472926694, "post_id": 39309871, "comment_id": 65952728, "body": "It is copied to a separate structure. In general, haskell&#39;s representation of most complex data types is significantly different than C, so passing data to and from C involves a lot of copying. You can avoid that in the few cases where you have no need to do any processing of the data in one of the two languages. In that case, you just store the data in the format of language that does the processing."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 1, "creation_date": 1472926911, "post_id": 39309871, "comment_id": 65952793, "body": "@smilingbuddha A copy is needed. The Haskell memory layout for <code>[Int]</code> is not a contiguous array like in C. Note that if the function modifies those arrays the changes will not be reflected in the pure <code>MyData</code> argument, of course. If needed, one can make <code>myfunc</code> return a new updated <code>MyData</code>."}, {"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472927017, "post_id": 39309871, "comment_id": 65952831, "body": "@chi Thanks! What if instead of [Int] I had something like the REPA arrays where I believe they are essentially arrays are stored in contiguous memory?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472927372, "post_id": 39309871, "comment_id": 65952933, "body": "I was wondering a similar question... I guess there should be a mutable vector data type in some Haskell package which lets you do this without a copy. I have no pointer to contribute, though. You could search hackage for &quot;(mutable) unboxed vector&quot; and see if there&#39;s something useful."}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 1, "creation_date": 1472927526, "post_id": 39309871, "comment_id": 65952980, "body": "Have a look at <code>Data.Vector.Storable</code> and <code>Data.Vector.Storable.Mutable</code>."}, {"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "edited": false, "score": 0, "creation_date": 1472927720, "post_id": 39309871, "comment_id": 65953046, "body": "@ redneb Thanks I will check it out. Btw, is there any comprehensive tutorial to understand the ins and outs of the C FFI? Most tutorials on the web seem really scratchy and low on examples and even the ones which are present seem a bit ad hoc."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1472951174, "post_id": 39309871, "comment_id": 65958204, "body": "There&#39;s also <code>Data.Array.Storable</code>."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 5, "last_activity_date": 1473025675, "last_edit_date": 1473025675, "creation_date": 1472925695, "answer_id": 39309871, "question_id": 39309749, "link": "https://stackoverflow.com/questions/39309749/passing-struct-like-data-between-c-and-haskell-via-the-ffi/39309871#39309871", "title": "Passing struct-like data between C and Haskell via the FFI", "body": "<p>You could do something like that:</p>\n\n<pre><code>import Foreign\nimport Foreign.C\n\nmyfunc :: MyData -&gt; IO CInt\nmyfunc d =\n    withArray (map fromIntegral $ arrInt d) $ \\arr1 -&gt;\n        withArray (map CDouble $ arrDouble d) $ \\arr2 -&gt;\n            c_myfunc arr1 arr2 (fromIntegral $ arraySize d)\n\nforeign import ccall safe \"myfunc\"\n    c_myfunc :: Ptr CInt -&gt; Ptr CDouble -&gt; CInt -&gt; IO CInt\n</code></pre>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 1, "accepted_answer_id": 39309871, "answer_count": 1, "score": 5, "last_activity_date": 1473025675, "creation_date": 1472924942, "last_edit_date": 1472929853, "question_id": 39309749, "link": "https://stackoverflow.com/questions/39309749/passing-struct-like-data-between-c-and-haskell-via-the-ffi", "title": "Passing struct-like data between C and Haskell via the FFI", "body": "<p>Consider a Haskell data-type which looks like this </p>\n\n<pre><code>data MyData = MyData { arrInt :: [Int] , arrDouble :: [Double], arraySize :: N }\n</code></pre>\n\n<p>Here N represents the sizes of both the arrays the MyData record. </p>\n\n<p>Is it possible to pass this (or some kind of Haskell \"pointer\" of a MyData object) to a C function which looks like this. </p>\n\n<pre><code>int myfunc (int* a, double* b, int N)\n</code></pre>\n\n<p>I am able to use the FFI to call C functions accepting and returning simple datat-types like Double, Int, Char etc. But for more complicated types I don't know what to do. </p>\n"}, {"tags": ["list", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 1, "creation_date": 1472925463, "post_id": 39309802, "comment_id": 65952325, "body": "Thank you! that works well. Any chance of a breakdown/explanation?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 1, "creation_date": 1473061429, "post_id": 39309802, "comment_id": 65983366, "body": "There is a sensible answer for the empty list, but <code>[[[]]]</code> isn&#39;t it. The components of a partition should not be empty, but a partition could have no components in exactly the case that there were no elements in the first place."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1472925975, "last_edit_date": 1472925975, "creation_date": 1472925243, "answer_id": 39309802, "question_id": 39309695, "link": "https://stackoverflow.com/questions/39309695/haskell-different-ways-to-join-a-list/39309802#39309802", "title": "Haskell: Different ways to join a list", "body": "<p>You can do it like this:</p>\n\n<pre><code>sublists :: [a] -&gt; [[[a]]]\nsublists [x] = [[[x]]]\nsublists (x:xs) = sublists xs &gt;&gt;= \\(y:ys) -&gt; [[x]:y:ys, (x:y):ys]\n</code></pre>\n\n<p>The main insight here is that there is no logical way of extending this to empty list inputs - the only viable candidate would have been <code>sublists [] = [[[]]]</code> but this introduces empty lists (which you don't want in this case). </p>\n\n<p>However, this motivates a useful invariant: the inner-inner (innermost) lists can never be empty (and we make sure this remains the case by not introducing empty lists in <code>[[x]:y:ys, (x:y):ys]</code> - the only time we add new lists with <code>[x]</code>, they already have an element in them). This ensures the pattern matching in the lambda never fails.</p>\n\n<hr>\n\n<p>As an aside, if it is any clearer, this can be trivially rewritten using do notation:</p>\n\n<pre><code>sublists :: [a] -&gt; [[[a]]]\nsublists' [x] = [[[x]]]\nsublists' (x:xs) = do\n    (y:ys) &lt;- sublists' xs\n    [[x]:y:ys, (x:y):ys]\n</code></pre>\n\n<p>Or <code>concatMap</code> instead of <code>(&gt;&gt;=)</code>:</p>\n\n<pre><code>sublists'' :: [a] -&gt; [[[a]]]\nsublists'' [x] = [[[x]]]\nsublists'' (x:xs) = concatMap (\\(y:ys) -&gt; [[x]:y:ys, (x:y):ys]) (sublists'' xs)\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 39309802, "answer_count": 1, "score": 0, "last_activity_date": 1472925975, "creation_date": 1472924643, "question_id": 39309695, "link": "https://stackoverflow.com/questions/39309695/haskell-different-ways-to-join-a-list", "title": "Haskell: Different ways to join a list", "body": "<p>If I have a list <code>[a,b,c,d,e]</code> how do I find every way of joining the elements into sub-lists while maintaining order.</p>\n\n<p>The output should look something like this </p>\n\n<pre><code>[ [[a], [b], [c], [d]]\n, [[a,b], [c], [d]]\n, [[a], [b,c], [d]]\n, [[a], [b], [c,d]]\n, [[a,b,c], [d]]\n, [[a,b], [c,d]]\n, [[a,b,c,d]]\n]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 7, "creation_date": 1472924402, "post_id": 39309616, "comment_id": 65951975, "body": "Not enough close parens."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1472937363, "post_id": 39309616, "comment_id": 65955619, "body": "Note that <b>1.</b> you don&#39;t need half of these parentheses anyway <b>2.</b> I don&#39;t think your code can possibly terminate, because you have a recursion of the form <code>sky list = f $ sky list</code> \u2013 the recursive call works on exactly the same data again, so this can never come to an end. (In fact it doesn&#39;t <i>need</i> to come to an end because Haskell is lazy, but I don&#39;t think this would work, either. And <b>3</b> <i>always use type signatures</i>, even (or, <i>especially</i>) if you only want to demonstrate a simple example. This makes it so much easier to understand what your code is supposed to be doing (or <i>not</i>)."}], "owner": {"reputation": 273, "user_id": 4748776, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0b92126fb77d1017fdcfe19fe2ef4054?s=128&d=identicon&r=PG&f=1", "display_name": "DoubleOseven", "link": "https://stackoverflow.com/users/4748776/doubleoseven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1303, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472924191, "creation_date": 1472924191, "question_id": 39309616, "link": "https://stackoverflow.com/questions/39309616/haskell-parse-error-on-input", "title": "Haskell: parse error on input `|&#39;", "body": "<p>I am getting this error:</p>\n\n<blockquote>\n  <p>sky.hs:3:5: error: parse error on input `|'</p>\n</blockquote>\n\n<p>This is the code:</p>\n\n<pre><code>sky list  \n    | (length list) /= 1 = reverse (last(even (sky list)) : reverse(odd list)\n    | otherwise = list\n</code></pre>\n\n<p>Does anyone have any idea why this is happening? I have made sure that there are no tabs, just 4 spaces before the <code>|</code> symbol. This might seem like a novice question but I am a beginner in Haskell.</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1472922010, "post_id": 39309234, "comment_id": 65951274, "body": "Yes, there is a much more straightforward way to do this, which does not involve helper functions. BTW both helper functions you defined, already exist in <code>Data.Maybe</code>, but to be clear, you can do it without them."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1472922387, "post_id": 39309234, "comment_id": 65951399, "body": "Small remark: since you&#39;ve already solved your &quot;problem&quot;, your question is probably eligible for <a href=\"https://codereview.stackexchange.com\">Code Review</a>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1472957688, "post_id": 39309468, "comment_id": 65959061, "body": "Sadly, I seem to have a mental block WRT pattern guards. I basically never think of them when writing code. I suspect this is because they weren&#39;t in Haskell 98 (the standard when I started with Haskell) and they&#39;re not as exciting/indispensable as some other extensions. Indeed, they seem to offer <i>reliable</i> performance in only a fairly narrow domain--they&#39;re great for types with at most two constructors at most one of which takes an argument, but they&#39;re otherwise less great.."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472973932, "post_id": 39309468, "comment_id": 65961393, "body": "@dfeuer to be honest, I usually don&#39;t use them either. I just read a comment some hours before which reminded me of them. I like the <code>case \u2026 of \u2026</code> variant more, to be honest. <code>Maybe</code> and <code>Either</code> are probably the only things I would them for, though."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 6, "last_activity_date": 1472923073, "creation_date": 1472923073, "answer_id": 39309468, "question_id": 39309234, "link": "https://stackoverflow.com/questions/39309234/how-to-write-my-version-of-unfoldr-in-a-better-more-idiomatic-manner-in-haskel/39309468#39309468", "title": "How to write my version of unfoldr in a better / more idiomatic manner in Haskell?", "body": "<p>Two words: pattern matching. You're using <code>$ head $ maybeToList (f x)</code> twice to get both the next state as well as the list element. However, we can pattern match on <code>f x</code> to get whether we're having <code>Just</code> another element (and a state to continue our little unfolding) or whether we're done:</p>\n\n<pre><code>myUnfoldr :: (s -&gt; Maybe (a, s)) -&gt; s -&gt; [a]\nmyUnfoldr f x = case f x of\n    Just (next, state) -&gt; next : myUnfoldr f state\n    Nothing            -&gt; []\n</code></pre>\n\n<p>The problem with your variant is that you don't use <code>isJust (f x)</code> to your advantage. Instead of checking whether something is <code>Just</code> and then getting the values out of it, just check whether the pattern matches.</p>\n\n<p>Note that this is also possible with pattern guards:</p>\n\n<pre><code>myUnfoldr :: (s -&gt; Maybe (a, s)) -&gt; s -&gt; [a]\nmyUnfoldr f x\n  | Just (next, state) &lt;- f x = next : myUnfoldr f state\n  | otherwise                 = []\n</code></pre>\n\n<p>I haven't read the book yet, but I guess that both techniques have been told by chapter 12.</p>\n"}], "owner": {"reputation": 7105, "user_id": 236007, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BiYes.jpg?s=128&g=1", "display_name": "Emre Sevin&#231;", "link": "https://stackoverflow.com/users/236007/emre-sevin%c3%a7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 39309468, "answer_count": 1, "score": 3, "last_activity_date": 1472938166, "creation_date": 1472921385, "last_edit_date": 1472929383, "question_id": 39309234, "link": "https://stackoverflow.com/questions/39309234/how-to-write-my-version-of-unfoldr-in-a-better-more-idiomatic-manner-in-haskel", "title": "How to write my version of unfoldr in a better / more idiomatic manner in Haskell?", "body": "<p>I'm trying to write my version of <code>unfoldr</code> in order to solve a chapter exercise from <a href=\"http://haskellbook.com/\" rel=\"nofollow\">Haskell Book</a> (Chapter 12, Signaling Adversity). The book says:</p>\n\n<blockquote>\n  <p>Write the function <code>myUnfoldr</code> using direct recursion. Compare with\n  the built-in <code>unfoldr</code> to check your implementation. Again, don\u2019t look\n  at implementations of unfoldr so that you figure it out yourself.</p>\n</blockquote>\n\n<p>And gives the following:</p>\n\n<pre><code>myUnfoldr :: (b -&gt; Maybe (a, b)) -&gt; b -&gt; [a] \nmyUnfoldr = undefined\n</code></pre>\n\n<p>My initial attempt for <code>myUnfoldr</code> has been to write it using a single helper function:</p>\n\n<pre><code>maybeToList :: Maybe a -&gt; [a]\nmaybeToList (Just x) = [x]\nmaybeToList Nothing = []\n\nmyUnfoldr :: (b -&gt; Maybe (a, b)) -&gt; b -&gt; [a]\nmyUnfoldr f x = (fst $ head $ maybeToList (f x)) :\n  myUnfoldr f (snd $ head $ maybeToList (f x))\n</code></pre>\n\n<p>This type checks, and for a few example runs it seems like I've achieved what <code>unfoldr</code> does, because:</p>\n\n<pre><code>\u03bb&gt; take 10 $ unfoldr (\\x -&gt; Just (x, x + 1)) 0\n[0,1,2,3,4,5,6,7,8,9]\n</code></pre>\n\n<p>and the same result with <code>myUnfoldr</code>:</p>\n\n<pre><code>\u03bb&gt; take 10 $ myUnfoldr (\\x -&gt; Just (x, x + 1)) 0\n[0,1,2,3,4,5,6,7,8,9]\n</code></pre>\n\n<p>But of course, <code>myUnfoldr</code> is problematic because if I try the following:</p>\n\n<pre><code>\u03bb&gt; take 10 $ myUnfoldr (\\x -&gt; Nothing) 0\n[*** Exception: Prelude.head: empty list\n</code></pre>\n\n<p>whereas <code>unfoldr</code> works as expected, returning <code>[]</code>.</p>\n\n<p>I can see why my <code>unFoldr</code> is problematic, but I couldn't find out how to handle the situation where <code>f</code> can return <code>Nothing</code>.</p>\n\n<p>So my second take at the problem is to use another helper function, and this time use guards:</p>\n\n<pre><code>isJust :: Maybe a -&gt; Bool\nisJust (Just _) = True\nisJust _      = False\n\nmyUnfoldr :: (b -&gt; Maybe (a, b)) -&gt; b -&gt; [a]\nmyUnfoldr f x | isJust $ (f x) = (fst $ head $ maybeToList (f x)) : myUnfoldr f (snd $ head $ maybeToList (f x))\n              | otherwise = []\n</code></pre>\n\n<p>This second version seems to work as expected both for <code>take 10 $ myUnfoldr (\\x -&gt; Just (x, x+1)) 0</code> and <code>take 10 $ myUnfoldr (\\x -&gt; Nothing) 0</code></p>\n\n<p>But I'm still not comfortable with my solution.</p>\n\n<p>Any ideas whether it can be written in a more concise form, without using a helper function? Or in a more idiomatic way? </p>\n"}, {"tags": ["haskell", "gtk2hs"], "answers": [{"tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": false, "score": 2, "last_activity_date": 1472906603, "creation_date": 1472906603, "answer_id": 39307016, "question_id": 39306945, "link": "https://stackoverflow.com/questions/39306945/in-gtk2hs-why-do-treemodeliface-functions-sometimes-take-an-iter-sometimes-a-m/39307016#39307016", "title": "In Gtk2hs, why do TreeModelIface functions sometimes take an Iter, sometimes a Maybe Iter", "body": "<p>It's been sometime since I used the <code>TreeModelIface</code> interface, but if I remember correctly, it all has to do with the root (or top-level) nodes of the tree. So <code>treeModelIfaceIterChilren iface Nothing</code> is used to retrieve them since they have no parent. This is not an issue when you are iteration over the siblings with <code>treeModelIfaceIterNext</code>. In other words, to traverse the entire tree, <code>treeModelIfaceIterChilren iface Nothing</code> is your starting point, and the you succesively call <code>treeModelIfaceIterNext</code> and <code>treeModelIfaceIterChilren</code> (with a <code>Just</code> value).</p>\n"}], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1535428567, "creation_date": 1472906092, "last_edit_date": 1535428567, "question_id": 39306945, "link": "https://stackoverflow.com/questions/39306945/in-gtk2hs-why-do-treemodeliface-functions-sometimes-take-an-iter-sometimes-a-m", "title": "In Gtk2hs, why do TreeModelIface functions sometimes take an Iter, sometimes a Maybe Iter", "body": "<p>In Gtk2hs there is the <code>Graphics.UI.Gtk.ModelView.CustomStore</code> module, which includes a data type containing a collection of functions, <a href=\"https://hackage.haskell.org/package/gtk-0.14.5/docs/Graphics-UI-Gtk-ModelView-CustomStore.html#t:TreeModelIface\" rel=\"nofollow\"><code>TreeModelIface</code></a>. It contains a bunch of functions for navigating around a user-defined tree type where the location is stored as a<code>TreeIter</code>. So one of the member functions is:</p>\n\n<pre><code>treeModelIfaceIterNext :: TreeIter -&gt; IO (Maybe TreeIter)\n</code></pre>\n\n<p>This returns the <code>TreeIter</code> associated with the next sibling node, if there is one. Simple enough. But the following member function is:</p>\n\n<pre><code>treeModelIfaceIterChildren :: Maybe TreeIter -&gt; IO (Maybe TreeIter)\n</code></pre>\n\n<p>This takes a <code>Maybe TreeIter</code> instead of a simple <code>TreeIter</code>. The documentation doesn't say why, or what an argument of <code>Nothing</code> is used for.</p>\n\n<p>Questions:</p>\n\n<ol>\n<li><p>Why this variation of argument types?</p></li>\n<li><p>What should <code>treeModelIfaceIterChilren iface Nothing</code> return?</p></li>\n</ol>\n"}, {"tags": ["scala", "haskell", "functional-programming", "scalaz", "scala-cats"], "comments": [{"owner": {"reputation": 1921, "user_id": 568990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/75b507da9d3253920fead8ed6ff52486?s=128&d=identicon&r=PG", "display_name": "Samar", "link": "https://stackoverflow.com/users/568990/samar"}, "edited": false, "score": 0, "creation_date": 1472899387, "post_id": 39305990, "comment_id": 65944950, "body": "About your side note: You don&#39;t find the scala doc helpful in exploring the API?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 1921, "user_id": 568990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/75b507da9d3253920fead8ed6ff52486?s=128&d=identicon&r=PG", "display_name": "Samar", "link": "https://stackoverflow.com/users/568990/samar"}, "edited": false, "score": 0, "creation_date": 1472899668, "post_id": 39305990, "comment_id": 65945022, "body": "So far not. The problem that I see a method defined as private to a class (take <code>local</code> above for instance), which means that you cannot use it directly but through one of the multiple instances of this private class. I don&#39;t think you can do this from the Scala doc alone."}, {"owner": {"reputation": 1921, "user_id": 568990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/75b507da9d3253920fead8ed6ff52486?s=128&d=identicon&r=PG", "display_name": "Samar", "link": "https://stackoverflow.com/users/568990/samar"}, "edited": false, "score": 0, "creation_date": 1472899999, "post_id": 39305990, "comment_id": 65945089, "body": "Am not sure what you mean, but you can choose to see the private members of a class heirarchy by selecting the Visibility: Public | All option to All in the scala doc."}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 1, "creation_date": 1472905974, "post_id": 39305990, "comment_id": 65946653, "body": "With regards to your side note, the Scala standard library does not come equipped with algebras such as Monad. If you want access to these facilities then either you have to hand code them yourself or as you did use Scalaz or Cats. However, due to the verbosity of the language and it&#39;s type system, it is comparatively more work to get the same thing in Haskell done in Scala. As Edward Kmett says, Haskell gives him a much higher power to weight ratio. Your frustrations prove that."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1472906374, "post_id": 39305990, "comment_id": 65946758, "body": "Power to weight ratio is maybe what I call signal to noise ratio ;) There are two major functional-programing (FP) libraries for Scala (Cats and Scalaz) which allows to do some first order FP. But as soon as I start composing types things start getting out of (my) control. I wonder how many programmers use also only this shallow core, while forfeiting the whole power of FP. I wonder how many more use Scala without knowing what FP is."}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1472907677, "post_id": 39305990, "comment_id": 65947106, "body": "From personal experience (I code in Scala for food and water), every commercial Scala developer I have met does not code Scala in the FP paradigm. In one company I worked at, Scalaz was banned :). These Scala devs just happily code Scala with a view of it being a better Java so rather than modelling their solutions using FP constructs, they resort to the traditional OOP paradigm. There&#39;s nothing wrong with that but it&#39;s funny when some of them tell me they are coding in FP when all they have done is sprinkled a few <code>map</code> and <code>flatMap</code> in their code ;)"}, {"owner": {"reputation": 1921, "user_id": 568990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/75b507da9d3253920fead8ed6ff52486?s=128&d=identicon&r=PG", "display_name": "Samar", "link": "https://stackoverflow.com/users/568990/samar"}, "reply_to_user": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 0, "creation_date": 1472908001, "post_id": 39305990, "comment_id": 65947200, "body": "@Mika&#39;il: where do the scala devs break most from FP? by not using pure functions, not using immutable values, etc? which is the part that is hard to stick to while doing FP in scala?"}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "reply_to_user": {"reputation": 1921, "user_id": 568990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/75b507da9d3253920fead8ed6ff52486?s=128&d=identicon&r=PG", "display_name": "Samar", "link": "https://stackoverflow.com/users/568990/samar"}, "edited": false, "score": 2, "creation_date": 1472908907, "post_id": 39305990, "comment_id": 65947471, "body": "@Samar, I would say that the biggest barrier is that they are unable to transfer any of their OOP knowledge over to the FP paradigm. If we even take the most basic underlying concept of referential transparency in FP, immediately the imperative programmer is stumped. Firstly they have to understand that the notion of a function in FP is that of a mathematical function, not a function/procedure in the imperative sense (which sometimes has an implied environment baggaged with it)."}, {"owner": {"reputation": 9225, "user_id": 3248346, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/377f7423a286949201e0aa8cb2257fcc?s=128&d=identicon&r=PG&f=1", "display_name": "M.K.", "link": "https://stackoverflow.com/users/3248346/m-k"}, "edited": false, "score": 1, "creation_date": 1472908911, "post_id": 39305990, "comment_id": 65947472, "body": "If we take away the basic tools of an OOP programmer such as inheritance then you have almost crippled him. And we haven&#39;t even begun to talk about other FP bread and butter concepts in FP such as HOFs, lambda calculus, ADTs, algebra and co-algebras etc..."}, {"owner": {"reputation": 1921, "user_id": 568990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/75b507da9d3253920fead8ed6ff52486?s=128&d=identicon&r=PG", "display_name": "Samar", "link": "https://stackoverflow.com/users/568990/samar"}, "edited": false, "score": 0, "creation_date": 1472910873, "post_id": 39305990, "comment_id": 65947937, "body": "Thanks. I do not yet understand why OO style inheritance does not mix well with FP. Your point led me to do some search and came across this article about the refactoring approaches in functional vs OOP worlds. <a href=\"http://www.ibm.com/developerworks/java/library/j-ft5/index.html\" rel=\"nofollow noreferrer\">ibm.com/developerworks/java/library/j-ft5/index.html</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1473060422, "post_id": 39307911, "comment_id": 65982884, "body": "Thanks (again ;)). I&#39;ve modified it slightly and I pushed the resulting code to the repository I linked above. I have a couple of questions though. How could a newcomer to Scalaz could have figured out that you needed to use <code>ReaderWriterState.rwstMonad</code>. Also, how did you figure out that you needed to use IRWS? I&#39;m really curious about this thought process, and how many experience in Scalaz it requires. If I have to continue programming Scala for food I&#39;m thinking of making my own FP library..."}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1473060451, "post_id": 39307911, "comment_id": 65982904, "body": "BTW, If I try this with <code>Seq</code> the instance for <code>Monoid</code> for <code>Seq</code> is not found. Is this defined anywhere in Scalaz?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1473060546, "post_id": 39307911, "comment_id": 65982946, "body": "And finally, I&#39;m really happy to see the two solutions (Haskell vs Scala) posted here, this clearly tells me I&#39;m not wrong in doing everything in my power to reach a point in which I can make a living programming in Haskell. I hope this helps other people as well."}, {"owner": {"reputation": 832, "user_id": 4849432, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh3.googleusercontent.com/-lqxX7n8DfJQ/AAAAAAAAAAI/AAAAAAAAACk/PUWvpvQXxFA/photo.jpg?sz=128", "display_name": "I See Voices", "link": "https://stackoverflow.com/users/4849432/i-see-voices"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1473062229, "post_id": 39307911, "comment_id": 65983770, "body": "Welcome! Staring from shortest: I think <code>Monoid</code> for <code>Seq</code> is not defined anywhere directly, because <code>Seq</code> is not specific enough. Though, you can have monoids for <code>Vector</code> or for <code>IndSeq</code> and for any other <code>PlusEmpty</code> (<code>SemigroupK</code>) instance: <code>val x1 = Seq(1)    implicit val m = scalaz.IndSeq.indSeqInstance.monoid[Int]   IndSeq.fromSeq(x1) |+| IndSeq.fromSeq(x1)</code>"}, {"owner": {"reputation": 832, "user_id": 4849432, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh3.googleusercontent.com/-lqxX7n8DfJQ/AAAAAAAAAAI/AAAAAAAAACk/PUWvpvQXxFA/photo.jpg?sz=128", "display_name": "I See Voices", "link": "https://stackoverflow.com/users/4849432/i-see-voices"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 1, "creation_date": 1473062490, "post_id": 39307911, "comment_id": 65983887, "body": "About IRWS - you can see that you need three monads - <code>Reader</code>, <code>Writer</code> and <code>State</code>. My general approach would be to go through transformers, but they are already implemented in specific traits <code>MonadReader</code>, <code>MonadWriter</code> etc.. Then just by following type hierarchies, you find out that <code>IRWST</code> implements all of them.  And by pressing dot in intellij on object ReaderWriterStateT (shows you available methods) I saw that <code>#rwst</code> returns you IRWST instance."}], "tags": [], "owner": {"reputation": 832, "user_id": 4849432, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh3.googleusercontent.com/-lqxX7n8DfJQ/AAAAAAAAAAI/AAAAAAAAACk/PUWvpvQXxFA/photo.jpg?sz=128", "display_name": "I See Voices", "link": "https://stackoverflow.com/users/4849432/i-see-voices"}, "is_accepted": true, "score": 2, "last_activity_date": 1472912259, "creation_date": 1472912259, "answer_id": 39307911, "question_id": 39305990, "link": "https://stackoverflow.com/questions/39305990/translating-this-monadic-counter-from-haskell-to-scala/39307911#39307911", "title": "Translating this monadic counter from Haskell to Scala", "body": "<p>If I understood your intentions right, this translates to very easy and comprehensible piece of code:</p>\n\n<pre><code>  import scalaz._\n  import Scalaz._\n  val SM = ReaderWriterState.rwstMonad[Id, Int, List[String], Counter]\n\n  case class Counter(value: Int)\n\n  def incWith(n: Int): State[Counter, Unit] = for {\n    v \u2190 get[Counter]\n    _ \u2190 put(Counter(v.value + n))\n  } yield ()\n\n  def inc: IRWS[Int, List[String], Counter, Counter, Unit] = for {\n    v \u2190 SM.ask\n    c \u2190 SM.get\n    _ \u2190 SM.tell(List(s\"Incrementing $c by $v \"))\n    _ \u2190 SM.modify(counter \u21d2 Counter(counter.value + v))\n  } yield ()\n\n  def compute: IRWS[Int, List[String], Counter, Counter, Unit] = {\n    for {\n      _ &lt;- SM.local[Unit](i \u21d2 3)(for {\n        _ \u2190 inc\n        _ \u2190 inc\n        _ \u2190 inc\n      } yield ())\n      _ &lt;- SM.local[Unit](i \u21d2 5)(for {\n        _ \u2190 inc\n        _ \u2190 inc\n        _ \u2190 inc\n      } yield ())\n    } yield ()\n  }\n\n  println(incWith(5)(Counter(0)))\n  println(inc.run(4, Counter(0)))\n  println(compute.run(0, Counter(0)))\n</code></pre>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 2, "accepted_answer_id": 39307911, "answer_count": 1, "score": 4, "last_activity_date": 1472912259, "creation_date": 1472899186, "question_id": 39305990, "link": "https://stackoverflow.com/questions/39305990/translating-this-monadic-counter-from-haskell-to-scala", "title": "Translating this monadic counter from Haskell to Scala", "body": "<p>I have defined a <a href=\"https://github.com/capitanbatata/sandbox/tree/master/monadic-counter\" rel=\"nofollow\">monadic counter in Haskell</a> which I'm trying to translate to Scala, failing miserably so far. The problem in a nutshell is about implementing a counter as a state monad, which reads the counter increment constant from the environment, and logs the history of the counter (its sequence of values).</p>\n\n<p>A friend of mine improved upon my solution, and came up with this simple solution:</p>\n\n<pre><code>newtype Counter = Counter Int deriving (Eq)\n\ninstance Show Counter where\n  show (Counter i) = show i\n\nincWith :: MonadState Counter m =&gt; Int -&gt; m ()\nincWith n = let incCounter n' (Counter i) = Counter $ i + n'\n            in modify (incCounter n)\n\ninc :: (MonadReader Int m, MonadState Counter m, MonadWriter [Counter] m) =&gt; m ()\ninc = ask &gt;&gt;= incWith &gt;&gt; get &gt;&gt;= tell . (:[])\n\ncompute :: (MonadReader Int m, MonadState Counter m, MonadWriter [Counter] m) =&gt; m ()\ncompute =\n  local (const 3) $ do\n    inc\n    inc\n    inc\n    local (const 5) $ do\n      inc\n      inc\n</code></pre>\n\n<p>I've tried <a href=\"https://github.com/capitanbatata/sandbox/tree/master/monadic-counter-scala-remix\" rel=\"nofollow\">without success</a> to code this into Scala + (Cats | ScalaZ). The latest stable version of Cats lacks a <code>lift</code> method for <code>WriterT</code>. And with <code>ReaderWriterState</code> in <code>Scalaz</code> I could not figure out in a couple of hours how to use the <code>local</code> method. And that's only the begining ...</p>\n\n<p>How this Haskell solution could be translated in a simple and elegant way? (to the extent allowed by the language).</p>\n\n<p>Side note: </p>\n\n<p>I'm still trying to figure out why I need to spend so much time to translate simple solutions from Haskell to Scala + FP libraries (Cats, Scalaz). In Haskell finding the instances and available functions of each type-class is a breeze, in Scala using IntelliJ, GitHub and StackOverflow this takes me days. So I'm wondering what am I doing wrong, and how could I improve this situation.</p>\n"}, {"tags": ["function", "haskell", "operator-precedence"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 2, "creation_date": 1472897504, "post_id": 39305716, "comment_id": 65944508, "body": "<code>x + pow x y-1</code> means <code>(x) + (pow x y) - (1)</code>, not <code>x + (pow x (y-1))</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2696, "user_id": 4379015, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PMGcL.jpg?s=128&g=1", "display_name": "Lazyexpert", "link": "https://stackoverflow.com/users/4379015/lazyexpert"}, "edited": false, "score": 0, "creation_date": 1472899322, "post_id": 39305763, "comment_id": 65944940, "body": "Thanks, this makes sense =)"}, {"owner": {"reputation": 2696, "user_id": 4379015, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PMGcL.jpg?s=128&g=1", "display_name": "Lazyexpert", "link": "https://stackoverflow.com/users/4379015/lazyexpert"}, "edited": false, "score": 0, "creation_date": 1472899410, "post_id": 39305763, "comment_id": 65944954, "body": "And sure not (+), but (*) =)))"}, {"owner": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "reply_to_user": {"reputation": 2696, "user_id": 4379015, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PMGcL.jpg?s=128&g=1", "display_name": "Lazyexpert", "link": "https://stackoverflow.com/users/4379015/lazyexpert"}, "edited": false, "score": 0, "creation_date": 1472899532, "post_id": 39305763, "comment_id": 65944987, "body": "@Lazyexpert Yes, but that wasn&#39;t the question :)"}], "tags": [], "owner": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "is_accepted": true, "score": 8, "last_activity_date": 1472899523, "last_edit_date": 1472899523, "creation_date": 1472897679, "answer_id": 39305763, "question_id": 39305716, "link": "https://stackoverflow.com/questions/39305716/infinite-loop-in-pow-function/39305763#39305763", "title": "Infinite loop in pow function", "body": "<pre><code>pow x y = x * pow x y-1\n</code></pre>\n\n<p>doesn't do what you think it does. It is parsed as</p>\n\n<pre><code>pow x y = (x) * (pow x y) - (1)\n                ^^^^^^^^^\n               infinite loop\n</code></pre>\n\n<p>Now you can see the infinite loop more clearly. You need to parenthesize <code>y-1</code>,</p>\n\n<pre><code>pow x y = x * pow x (y-1)\n</code></pre>\n"}], "owner": {"reputation": 2696, "user_id": 4379015, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PMGcL.jpg?s=128&g=1", "display_name": "Lazyexpert", "link": "https://stackoverflow.com/users/4379015/lazyexpert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 39305763, "answer_count": 1, "score": 0, "last_activity_date": 1472900195, "creation_date": 1472897375, "last_edit_date": 1472900195, "question_id": 39305716, "link": "https://stackoverflow.com/questions/39305716/infinite-loop-in-pow-function", "title": "Infinite loop in pow function", "body": "<p>I'm new to Haskell, and I'm getting an infinite loop here, but I don't know why.</p>\n\n<pre><code>module Main where\n\npow :: Int -&gt; Int -&gt; Int\npow x 0 = 1\npow x y = x * pow x y-1\n\nmain :: IO ()\nmain = print( pow 2 3 )\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["haskell", "opaleye"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1472907355, "post_id": 39305513, "comment_id": 65947021, "body": "<code>runQuery</code> has a very general return type - give it a type signature, or the return value a type signature. The <a href=\"https://hackage.haskell.org/package/opaleye-0.5.0.0/docs/Opaleye-RunQuery.html\" rel=\"nofollow noreferrer\">docs</a> very clearly state: &quot;runQuery&#39;s use of the Default typeclass means that the compiler will have trouble inferring types. It is strongly recommended that you provide full type signatures when using runQuery.&quot;"}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1472910500, "post_id": 39305513, "comment_id": 65947844, "body": "How do I provide the type signature exactly? The haddock always confused me there."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1472910888, "post_id": 39305513, "comment_id": 65947943, "body": "In a sense, you have given it a type signature already - <code>getUserByIden :: String -&gt; PGS.Connection -&gt; IO (Maybe User)</code> - but <code>usr</code> is unused in the body so it cannot unify with <code>User</code>. If you actually implement the function, it may be sufficient. In the meantime you can write a type signature in any number of ways: <code>(x :: X) &lt;- a</code> or <code>x &lt;- a :: IO X</code> or <code>_x &lt;- a; let x :: X; x = _x</code>"}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 1, "creation_date": 1472941638, "post_id": 39305513, "comment_id": 65956554, "body": "@atc Did you find a satisfactory solution to this?  If not feel free to ask me directly by <a href=\"https://github.com/tomjaguarpaw/haskell-opaleye/issues\" rel=\"nofollow noreferrer\">filing an issue</a> or by <a href=\"http://web.jaguarpaw.co.uk/%7Etom/contact/\" rel=\"nofollow noreferrer\">emailing me</a>."}, {"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1472943773, "post_id": 39305513, "comment_id": 65956970, "body": "Thanks Tom, I did. The accepted answer was spot-on. Would&#39;ve been nice to have this covered in the tutorial but that&#39;s me being pedantic :)"}], "answers": [{"tags": [], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "is_accepted": true, "score": 3, "last_activity_date": 1472911802, "creation_date": 1472911802, "answer_id": 39307837, "question_id": 39305513, "link": "https://stackoverflow.com/questions/39305513/opaleye-query-by-string-to-maybe/39307837#39307837", "title": "Opaleye query by String to Maybe", "body": "<p>I'm not familiar with OpalEye, but I think you might just need a judicious use of <code>listToMaybe</code> (<code>import Data.Maybe (listToMaybe)</code>)</p>\n\n<pre><code>getUserByIden :: String -&gt; PGS.Connection -&gt; IO (Maybe User)\ngetUserByIden iden c = do\n  listToMaybe &lt;$&gt; runQuery c (userByIdenQuery $ pgString iden)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1472917594, "post_id": 39308416, "comment_id": 65949880, "body": "Thanks. Another answer (similar content) was posted before yours, so I&#39;ve accepted theirs. Thank you for your help!"}], "tags": [], "owner": {"reputation": 31, "user_id": 3707634, "user_type": "registered", "profile_image": "https://graph.facebook.com/1533047132/picture?type=large", "display_name": "ThomasD", "link": "https://stackoverflow.com/users/3707634/thomasd"}, "is_accepted": false, "score": 1, "last_activity_date": 1472915633, "creation_date": 1472915633, "answer_id": 39308416, "question_id": 39305513, "link": "https://stackoverflow.com/questions/39305513/opaleye-query-by-string-to-maybe/39308416#39308416", "title": "Opaleye query by String to Maybe", "body": "<p>I think the problem lies with you using <code>undefined</code> in the end of your function <code>getUserByIden</code>. Because of some complicated type level magic Opaleye is doing under the hood, you need to specify a type for the use of <code>runQuery</code>, or simply return the value produced instead of undefined, because undefined throws the top inference algorithm off a little bit:</p>\n\n<pre><code>getUserByIden :: String -&gt; PGS.Connection -&gt; IO (Maybe User)\ngetUserByIden iden c = listToMaybe &lt;$&gt; runQuery c (userByIdenQuery $ pgString iden)\n</code></pre>\n\n<p>I also added a <code>listToMaybe</code> call to change the type of the body of the function to match the return type you specified. <code>runQuery</code>, when fully applied, returns a value of type <code>IO [SomeHaskellType]</code>, not <code>IO (Maybe SomeHaskellType)</code>.</p>\n"}], "owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "accepted_answer_id": 39307837, "answer_count": 2, "score": 0, "last_activity_date": 1472916924, "creation_date": 1472895977, "last_edit_date": 1472916924, "question_id": 39305513, "link": "https://stackoverflow.com/questions/39305513/opaleye-query-by-string-to-maybe", "title": "Opaleye query by String to Maybe", "body": "<p>I want to run a query against my table for a given value, and return a <code>Maybe a</code> depending on whether a row was found.</p>\n\n<p>I have this domain:</p>\n\n<pre><code>data User' a b c d e f = User {  usrId :: a,\n                                     usrApproved :: b,\n                                     usrIden :: c, \n                                     usrImgUrl :: d,\n                                     usrTitle :: e, \n                                     usrUrl :: f \n                                  }\n\ntype User = User' Int Bool String String String String\n\n$(makeAdaptorAndInstance \"pUser\" ''User')\n\ntype UserColumn = User' (Column PGInt4) (Column PGBool) (Column PGText) (Column PGText) (Column PGText) (Column PGText) \n</code></pre>\n\n<p>and the following definitions for the table and queries:</p>\n\n<pre><code>userTable :: Table UserColumn UserColumn\nuserTable = Table \"user\" (pUser User {  usrId       = required \"id\",\n                                                usrApproved = required \"approved\",\n                                                usrIden     = required \"identifier\",\n                                                usrImgUrl   = required \"img_url\",\n                                                usrTitle    = required \"title\",\n                                                usrUrl      = required \"url\"\n                                             })\n\nuserQuery :: Query UserColumn\nuserQuery = queryTable userTable\n</code></pre>\n\n<p>As hinted previously, I want to query by the \"identifier\" column, so I've written this query and wish to return a `IO (Maybe User)</p>\n\n<pre><code>userByIdenQuery :: (Column PGText) -&gt; Query UserColumn\nuserByIdenQuery iden = proc () -&gt; do\n  user &lt;- userQuery -&lt; ()\n  restrict -&lt; (adIden user) .=== iden\n  returnA -&lt; user    \n\ngetUserByIden :: String -&gt; PGS.Connection -&gt; IO (Maybe User)\ngetUserByIden iden c = do\n  usr &lt;- runQuery c (userByIdenQuery $ pgString iden)\n  -- But this fails to compile\n  undefined -- just to minimise compilation errors\n</code></pre>\n\n<p>this fails to compile with:</p>\n\n<pre><code>No instance for (Default\n                   Opaleye.Internal.RunQuery.QueryRunner UserColumn haskells0)\n  arising from a use of `runQuery'\nThe type variable `haskells0' is ambiguous\nNote: there is a potential instance available:\n  instance (product-profunctors-0.7.1.0:Data.Profunctor.Product.Class.ProductProfunctor\n              p,\n            Default p a1_0 a1_1, Default p a2_0 a2_1, Default p a3_0 a3_1,\n            Default p a4_0 a4_1, Default p a5_0 a5_1, Default p a6_0 a6_1) =&gt;\n           Default\n             p\n             (User' a1_0 a2_0 a3_0 a4_0 a5_0 a6_0)\n             (User' a1_1 a2_1 a3_1 a4_1 a5_1 a6_1)\n    -- Defined at src\\DB.hs:33:3\nIn a stmt of a 'do' block:\n  usr &lt;- runQuery c (userByIdenQuery $ pgString iden)\nIn the expression:\n  do { usr &lt;- runQuery c (userByIdenQuery $ pgString iden);\n       undefined }\nIn an equation for `getUserByIden':\n    getUserByIden iden c\n      = do { usr &lt;- runQuery c (userByIdenQuery $ pgString iden);\n             undefined }\n</code></pre>\n\n<p>If I try to implement the function:</p>\n\n<pre><code>getUserByIden :: String -&gt; PGS.Connection -&gt; IO (Maybe User)\ngetUserByIden iden c = do\n  (usrId, appr, idn, imUrl, tit, url) &lt;- runQuery c (userByIdenQuery $ pgString iden)\n  return $ Just $ User usrId appr idn imUrl tit url\n</code></pre>\n\n<p>Then I'm presented with this compilation error:</p>\n\n<pre><code>Couldn't match expected type `[haskells0]'\n        with actual type `(Int, Bool, String, String, String, String)'\nIn the pattern: (usrId, appr, idn, imUrl, tit, url)\nIn a stmt of a 'do' block:\n  (usrId, appr, idn, imUrl, tit, url) &lt;- runQuery\n                                          c (userByIdenQuery $ pgString iden)\nIn the expression:\n  do { (usrId, appr, idn, imUrl, tit, url) &lt;- runQuery\n                                               c (userByIdenQuery $ pgString iden);\n       return $ Just $ User usrId appr idn imUrl tit url }\n\nI really have no idea where to go with this, other than using a library other than Opaleye.\n</code></pre>\n"}, {"tags": ["haskell", "optimization", "data-structures"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472841835, "post_id": 39298795, "comment_id": 65931850, "body": "The approach looks fine to me. Maybe for strings there&#39;s some optimized trie package somewhere on hackage, but this is already good."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 7, "last_activity_date": 1472842409, "creation_date": 1472842409, "answer_id": 39299045, "question_id": 39298795, "link": "https://stackoverflow.com/questions/39298795/case-conversion-of-large-dictionary-word-set/39299045#39299045", "title": "Case conversion of large dictionary word set", "body": "<p>I would just work with <code>Text</code> directly instead of converting to/from Strings.</p>\n\n<p><code>Data.Text.IO</code> contains versions of <code>hGetContents</code>, <code>readFile</code>, etc. for reading Text from files, and <code>Data.Text</code> has <code>lines</code> for Text.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport System.IO\nimport qualified Data.Text as T\nimport qualified Data.Text.IO as T\nimport qualified Data.Set as S\n\nmain = do\n  let path = \"/usr/share/dict/american-english\"\n  h &lt;- openFile path ReadMode\n  hSetEncoding h utf8\n  contents &lt;- T.hGetContents h\n  let mySet = (S.fromList . map T.toLower . T.lines) contents\n  putStrLn $ show $ S.member \"acadia\" mySet\n</code></pre>\n\n<p>By using <code>T.tolower</code> and <code>T.lines</code> we avoid explicit pack/unpack calls.</p>\n\n<p><code>mySet</code> is now a set of Text values rather than of Strings. By using\nthe OverloadedStrings pragma the literal <code>\"acadia\"</code> will be interpreted\nas a Text value.</p>\n"}, {"tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": false, "score": 2, "last_activity_date": 1472842531, "creation_date": 1472842531, "answer_id": 39299073, "question_id": 39298795, "link": "https://stackoverflow.com/questions/39298795/case-conversion-of-large-dictionary-word-set/39299073#39299073", "title": "Case conversion of large dictionary word set", "body": "<p>Yes, what you propose is reasonable. Some few remarks, mostly unrelated to the main question:</p>\n\n<ol>\n<li>It would be more efficient to restrict your self to using only <code>Text</code> and not <code>String</code>.</li>\n<li>Prefer the <code>toCaseFold</code> function to <code>toLower</code>, it's more appropriate for this case.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1472844118, "creation_date": 1472844118, "answer_id": 39299433, "question_id": 39298795, "link": "https://stackoverflow.com/questions/39298795/case-conversion-of-large-dictionary-word-set/39299433#39299433", "title": "Case conversion of large dictionary word set", "body": "<p>Even though you found my first answer helpful, let me propose another approach...</p>\n\n<p>A boggle solver I wrote simply reads in the entire dictionary as a single ByteString, and to look up words performs a binary search on that ByteString.</p>\n\n<p>The dictionary must already be in sorted order and normalized to lower case, but usually this is not a problem since the dictionary is static\nand known in advance.</p>\n\n<p>Of course, when you compute <code>(lo+hi)/2</code> in performing the binary search you might land in the middle of word, so you simply back up to the beginning of the current word.</p>\n\n<p>The main advantage of this is that loading the dictionary is extremely fast and it is memory efficient. Moreover, the search algorithm has good memory locality. I haven't measured it, but I wouldn't be surprised if creating a <code>Data.Set</code> will more than double the size of the raw data.</p>\n\n<p>The code is available here: <a href=\"https://github.com/erantapaa/hoggle\" rel=\"nofollow\">https://github.com/erantapaa/hoggle</a></p>\n"}], "owner": {"reputation": 964, "user_id": 1913372, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/440837c3aa8fa3f3617f7029cf92d977?s=128&d=identicon&r=PG", "display_name": "RoyM", "link": "https://stackoverflow.com/users/1913372/roym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 39299045, "answer_count": 3, "score": 1, "last_activity_date": 1472916837, "creation_date": 1472841329, "last_edit_date": 1472916837, "question_id": 39298795, "link": "https://stackoverflow.com/questions/39298795/case-conversion-of-large-dictionary-word-set", "title": "Case conversion of large dictionary word set", "body": "<p>I'm trying to match words from a dictionary, case-insensitively. My initial approach\nlooks like so:</p>\n\n<ol>\n<li>read dict; convert all words to lowercase, store in set.</li>\n<li>check new word for membership in set</li>\n</ol>\n\n<p>Is there a better (more efficient) way to achieve this? I'm new to Haskell.</p>\n\n<pre><code>import System.IO\nimport Data.Text (toLower, pack, unpack)\nimport Data.Set (fromList, member)\n\nmain = do\n  let path = \"/usr/share/dict/american-english\"\n  h &lt;- openFile path ReadMode\n  hSetEncoding h utf8\n  contents &lt;- hGetContents h\n  let mySet = (fromList . map (unpack . toLower . pack) . lines) contents\n  putStrLn $ show $ member \"acadia\" mySet\n</code></pre>\n"}, {"tags": ["c++", "haskell"], "comments": [{"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1472833536, "post_id": 39296935, "comment_id": 65927613, "body": "Unfortunately, I don&#39;t that there is currently a better way than what is suggested in the linked article."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1472833559, "post_id": 39296935, "comment_id": 65927624, "body": "It would be way amazing if there was a good interface between C++ template headers and Haskell, but alas, I doubt this is ever going to happen. I think even Python basically just uses a C interface wrapper when binding to a C++ library like CGAL; perhaps this same wrapper could be used for Haskell too."}, {"owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1472834629, "post_id": 39296935, "comment_id": 65928190, "body": "@leftaroundabout Is it easy writing C interface wrappers for C++ libraries, be they template or non-template based?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1472836470, "post_id": 39296935, "comment_id": 65929117, "body": "It shouldn&#39;t be very hard if you just need a few functions."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1472854332, "post_id": 39296935, "comment_id": 65936562, "body": "@smilingbuddha Depends on what exactly you&#39;re trying to do. If the main feature of the library is that it&#39;s a template library, no it&#39;s not easy and probably not a good idea either. If it&#39;s just templated code in that it&#39;s generic and there&#39;s only a couple of special cases you&#39;re interested in, it&#39;s easy."}, {"owner": {"reputation": 1758, "user_id": 8724882, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d88f8198fb4ae68267aced911e3533f9?s=128&d=identicon&r=PG&f=1", "display_name": "sandwood", "link": "https://stackoverflow.com/users/8724882/sandwood"}, "reply_to_user": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1524484401, "post_id": 39296935, "comment_id": 86976879, "body": "@redneb : I found very surprised (to not said less) that you have to found out and call the unmangled functions. it look crazy no ? That means there is no stability whatsoever if the lib is rebuilt."}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 205, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1520245967, "creation_date": 1472833408, "question_id": 39296935, "link": "https://stackoverflow.com/questions/39296935/calling-c-libraries-especially-template-based-like-cgal-from-haskell", "title": "Calling C++ libraries (especially template based like CGAL) from Haskell", "body": "<p>I have been using Haskell for a few months and would really like to use it in one of my projects involving computational geometry. </p>\n\n<p>Haskell however, sorely lacks in good geometry libraries. Geometric algorithms are notoriously hard to implement robustly, hence I would like to use an off-the-shelf package like CGAL. It makes heavy use of C++ templates. I won't be needing an interface to all of CGAL, just a small subset of functions which I use most of the time. </p>\n\n<p>Haskell has a good C foreign function interface, but not for C++. So how can I call C++ through Haskell? </p>\n\n<p>All I found was this <a href=\"https://wiki.haskell.org/CPlusPlus_from_Haskell\" rel=\"nofollow\">https://wiki.haskell.org/CPlusPlus_from_Haskell</a> which seems a complicated way of going about the process. I am sure people have a simpler way of calling C++ from Haskell. </p>\n"}, {"tags": ["haskell", "haskell-stack", "gtk2hs"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1472862682, "post_id": 39295923, "comment_id": 65938368, "body": "Have you tried it with a more recent LTS resolver?"}, {"owner": {"reputation": 29, "user_id": 6788235, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a2X2H.png?s=128&g=1", "display_name": "E. Nerush", "link": "https://stackoverflow.com/users/6788235/e-nerush"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1472980577, "post_id": 39295923, "comment_id": 65962910, "body": "I have tried lts-3.22, that <a href=\"https://www.stackage.org/lts-3.22/docs\" rel=\"nofollow noreferrer\">should</a> use gtk-0.13.9, but get the same errors about gtk-0.14.2. I new in haskell and stack but stack with lts-3.22 asked me for another version of ghc (that means that stack really uses lts-3.22)."}, {"owner": {"reputation": 29, "user_id": 6788235, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a2X2H.png?s=128&g=1", "display_name": "E. Nerush", "link": "https://stackoverflow.com/users/6788235/e-nerush"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1472980742, "post_id": 39295923, "comment_id": 65962959, "body": "More <i>recent</i> resolver conflicts with requirements of haskell-chart dependencies."}], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 6788235, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a2X2H.png?s=128&g=1", "display_name": "E. Nerush", "link": "https://stackoverflow.com/users/6788235/e-nerush"}, "edited": false, "score": 0, "creation_date": 1472902237, "post_id": 39302261, "comment_id": 65945630, "body": "Actually this flag is already is in the stack.yaml. Also<code>stack build --flag gtk:have-quartz-gtk</code> leads to the same errors."}, {"owner": {"reputation": 29, "user_id": 6788235, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a2X2H.png?s=128&g=1", "display_name": "E. Nerush", "link": "https://stackoverflow.com/users/6788235/e-nerush"}, "edited": false, "score": 0, "creation_date": 1472980067, "post_id": 39302261, "comment_id": 65962774, "body": "My OS is Arch Linux, not mac."}, {"owner": {"reputation": 29, "user_id": 6788235, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a2X2H.png?s=128&g=1", "display_name": "E. Nerush", "link": "https://stackoverflow.com/users/6788235/e-nerush"}, "edited": false, "score": 0, "creation_date": 1472994601, "post_id": 39302261, "comment_id": 65966479, "body": "I upgrade gtk from 2.24.28 to 2.24.30 by Arch package manager, but then <code>stack build</code> leads to exactly the same errors."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 0, "last_activity_date": 1472914841, "last_edit_date": 1472914841, "creation_date": 1472863386, "answer_id": 39302261, "question_id": 39295923, "link": "https://stackoverflow.com/questions/39295923/installation-of-haskell-chart-fails-due-to-gtk-0-14-2-build-error/39302261#39302261", "title": "Installation of haskell-chart fails due to gtk-0.14.2 build error", "body": "<p>Using <strong>brew</strong> I upgraded gtk+ from version 2.24.25 to 2.24.30 and installed the latest version of XQuartz (version 2.7.9 - I couldn't determine which version I had originally installed.)</p>\n\n<p>With these changes I was able to successfully build the project with <code>stack build</code>.</p>\n\n<p>Specific commands:</p>\n\n<pre><code>$ brew cask install xquartz --force\n$ brew upgrade gtk\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "edited": false, "score": 0, "creation_date": 1501248918, "post_id": 40197851, "comment_id": 77710980, "body": "thanks for the answer. I added it to the <a href=\"https://github.com/timbod7/haskell-chart/issues/163#issuecomment-318504387\" rel=\"nofollow noreferrer\">github issue</a>"}], "tags": [], "owner": {"reputation": 29, "user_id": 6788235, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a2X2H.png?s=128&g=1", "display_name": "E. Nerush", "link": "https://stackoverflow.com/users/6788235/e-nerush"}, "is_accepted": false, "score": 2, "last_activity_date": 1477179216, "last_edit_date": 1477179216, "creation_date": 1477177149, "answer_id": 40197851, "question_id": 39295923, "link": "https://stackoverflow.com/questions/39295923/installation-of-haskell-chart-fails-due-to-gtk-0-14-2-build-error/40197851#40197851", "title": "Installation of haskell-chart fails due to gtk-0.14.2 build error", "body": "<p>In order to build haskell-chart from github sources on linux one should replace in <code>stack.yaml</code></p>\n\n<pre><code>flags:\n    gtk:\n        have-quartz-gtk: true\n</code></pre>\n\n<p>with</p>\n\n<pre><code>flags: {}\n</code></pre>\n\n<p>because Linux don't use Quartz flag <code>have-quartz-gtk</code>, and Quartz is not needed to build gtk (Windows also do not use Quartz).</p>\n"}, {"comments": [{"owner": {"reputation": 29, "user_id": 6788235, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a2X2H.png?s=128&g=1", "display_name": "E. Nerush", "link": "https://stackoverflow.com/users/6788235/e-nerush"}, "edited": false, "score": 0, "creation_date": 1477488272, "post_id": 40256602, "comment_id": 67787382, "body": "Actually, I&#39;m using <i>cairo</i> now for PDF output. I follow your <a href=\"https://github.com/timbod7/haskell-chart/issues/138\" rel=\"nofollow noreferrer\">previous suggestion</a> and make my figures as a &quot;package&quot; with its own stack.yaml and cabal files. I see now that I don&#39;t have to use gtk but I just wanted to look inside the source code, maybe make some changes etc. and learn Haskell by this."}], "tags": [], "owner": {"reputation": 781, "user_id": 659817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/9c58dfd8739853321d6cf822a77ee449?s=128&d=identicon&r=PG", "display_name": "timbod", "link": "https://stackoverflow.com/users/659817/timbod"}, "is_accepted": false, "score": 0, "last_activity_date": 1477468282, "creation_date": 1477468282, "answer_id": 40256602, "question_id": 39295923, "link": "https://stackoverflow.com/questions/39295923/installation-of-haskell-chart-fails-due-to-gtk-0-14-2-build-error/40256602#40256602", "title": "Installation of haskell-chart fails due to gtk-0.14.2 build error", "body": "<p>Note that you don't actually have to use gtk. There are two rendering backend for the chart library - one based upon <a href=\"https://hackage.haskell.org/package/cairo\" rel=\"nofollow\">cairo</a> from gtk2hs the other on the <a href=\"https://hackage.haskell.org/package/diagrams\" rel=\"nofollow\">diagrams</a> library. The cairo backend is significantly faster, whereas the diagrams backend is pure haskell, and hence is easier to build.</p>\n\n<p>By default, both backends are built, but you can build just the core library and the diagrams backend with:</p>\n\n<p><code>\nstack build ./chart ./chart-diagrams\n</code></p>\n"}], "owner": {"reputation": 29, "user_id": 6788235, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a2X2H.png?s=128&g=1", "display_name": "E. Nerush", "link": "https://stackoverflow.com/users/6788235/e-nerush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1477468282, "creation_date": 1472829930, "question_id": 39295923, "link": "https://stackoverflow.com/questions/39295923/installation-of-haskell-chart-fails-due-to-gtk-0-14-2-build-error", "title": "Installation of haskell-chart fails due to gtk-0.14.2 build error", "body": "<p>I'm trying to install haskell-chart from <a href=\"https://github.com/timbod7/haskell-chart\" rel=\"nofollow\" title=\"here\">here</a> (github), I clone it, install <em>stack</em>, ran <em>stack setup</em> (it installs GHC successfully), but then I ran <em>make</em> that fails with the messages:</p>\n\n<pre><code>...\nChart-cairo-1.8: copy/register\nChart-diagrams-1.8: copy/register\nProgress: 4/6\n--  While building package gtk-0.14.2 using:\n      /tmp/stack4807/gtk-0.14.2/.stack-work/dist/x86_64-linux/Cabal-1.22.5.0/setup/setup --builddir=.stack-work/dist/x86_64-linux/Cabal-1.22.5.0 build --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n...\n\n[ 22 of 209] Compiling Graphics.UI.Gtk.Embedding.Plug ( .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/Graphics/UI/Gtk/Embedding/Plug.hs, .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/Graphics/UI/Gtk/Embedding/Plug.o )\n\n    /tmp/stack4807/gtk-0.14.2/Graphics/UI/Gtk/Embedding/Plug.chs:120:6:\n        Couldn't match expected type \u2018CUInt\u2019\n                    with actual type \u2018Maybe DrawWindow\u2019\n        In the first argument of \u2018gtk_plug_new\u2019, namely...\n</code></pre>\n\n<p>Stack version is 1.1.2 x86_64 hpack-0.14.1, LTS Haskell 5.18 (ghc-7.10.3). What can I do with this errors?</p>\n"}, {"tags": ["haskell", "functional-programming", "scheme", "pseudocode"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 5, "creation_date": 1472828556, "post_id": 39295245, "comment_id": 65924717, "body": "I think this is highly dependent on which functional language you want to write pseudocode for. Haskell, ocaml and fsharp have a completely different approach than erlang, clojure/lisp. Thus the pseudocode will look different. For haskell I&#39;d write mostly type signatures and explain the algorithm underneath in prose. For the dynamic languages i have not enough hands on experience to give you any hints"}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 4, "creation_date": 1472831006, "post_id": 39295245, "comment_id": 65926190, "body": "Why do you want to write it? Is someone saying &quot;show me the pseudo-code&quot;, or are you trying to understand how to design code in a functional style? If the latter then pseudo-code is probably the wrong way to go about it. A bit more background to your question would be useful."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1472835126, "post_id": 39295245, "comment_id": 65928473, "body": "Often (albeit not always), functional code is very compact and high-level, so in a small space you can fit the whole algorithm, making pseudocode unneeded. IMO, pseudocode is more useful when you have a too verbose syntax (which harms understanding), or when you want to skip some boring portions (stubs would work fine here)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1472837034, "post_id": 39295245, "comment_id": 65929413, "body": "If I&#39;m sketching out some Haskell, I typically leave out obvious function and method definitions (e.g., <code>instance Sequence Seq</code> with no details), or functions with type signatures and no code. I also write it without using GHC, so some of the types can be a bit off if I&#39;m sketching something fancy."}, {"owner": {"reputation": 3197, "user_id": 3750381, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f3203f61c9d9e29b6ab0491c5727eec6?s=128&d=identicon&r=PG&f=1", "display_name": "Vasantha Ganesh", "link": "https://stackoverflow.com/users/3750381/vasantha-ganesh"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1472926760, "post_id": 39295245, "comment_id": 65952750, "body": "@PaulJohnson I am a university student and I am asked to explain everything using pseudocode be it in my assignments or my exams."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1472942297, "post_id": 39295245, "comment_id": 65956685, "body": "Do you know that they would accept functional pseudocode (however that might work)? Some teachers are actually pretty particular with the format they want the pseudocode in. You should find out what they&#39;re looking for."}, {"owner": {"reputation": 15758, "user_id": 90559, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c9ca8274294ea39ea6d92617be7cb9bb?s=128&d=identicon&r=PG", "display_name": "John Clements", "link": "https://stackoverflow.com/users/90559/john-clements"}, "edited": false, "score": 0, "creation_date": 1473195223, "post_id": 39295245, "comment_id": 66045237, "body": "The term &quot;pseudocode&quot; is an implicit admission that your programming language is too low-level to express yourself clearly."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1472828755, "creation_date": 1472828755, "answer_id": 39295561, "question_id": 39295245, "link": "https://stackoverflow.com/questions/39295245/how-to-write-pseudocode-for-functional-programming-languages/39295561#39295561", "title": "How to write pseudocode for functional programming languages?", "body": "<p>If I'm writing an algorithm in pseudo code in a functional style then I might mix and match languages but will consistently use:</p>\n\n<ul>\n<li>let-bound variables</li>\n<li>function application</li>\n<li>maps and folds</li>\n</ul>\n\n<p>Take, for example, a hash function:</p>\n\n<pre><code>hash data =\n  let blocks = chunksOf blockSize (preprocess data)\n  foldr updateContext initialContext blocks\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44043, "user_id": 1565698, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/7dace33805b9dcdec5aa63308daf88dc?s=128&d=identicon&r=PG", "display_name": "Sylwester", "link": "https://stackoverflow.com/users/1565698/sylwester"}, "is_accepted": false, "score": 6, "last_activity_date": 1472833110, "creation_date": 1472833110, "answer_id": 39296856, "question_id": 39295245, "link": "https://stackoverflow.com/questions/39295245/how-to-write-pseudocode-for-functional-programming-languages/39296856#39296856", "title": "How to write pseudocode for functional programming languages?", "body": "<p>In SICP and perhaps other tutorials you have something calle optimistic programming. Instead of pseudocode you just name things and supply the arguments they might take. So imagine you want to make a huffman tree out of a list of sorted nodes from lowest to highest frequency:</p>\n\n\n\n<pre class=\"lang-scm prettyprint-override\"><code>(define (huffman nodes)\n  (if (single-node? nodes)\n      (first nodes)\n      (let ([new-node\n             (make-node (first  nodes)\n                        (second nodes))])\n        (huffman (insert-sorted new-node        \n                                (cddr nodes))))))\n</code></pre>\n\n<p>This is the complete algorithm and it even will become a part of the resulting actual code, so it's not actual pseudo code either. <code>single-node?</code>, <code>make-node</code>, <code>insert-sorted</code> isn't defined and in Scheme you'll get an error but in CL you could actually use this and it would jump into the debugger where you are asked if you would like to define some of these so you basically would then implement the missing parts as you go and continue the execution until everything is finished. </p>\n\n<p>I guess in Haskell or any other programming language, not only functional ones, you can do this kind of optimistic programming - in the language you are implementing of course. There might be small changes in the end result, but it's not bigger than one would do in other refactorings. </p>\n"}], "owner": {"reputation": 3197, "user_id": 3750381, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f3203f61c9d9e29b6ab0491c5727eec6?s=128&d=identicon&r=PG&f=1", "display_name": "Vasantha Ganesh", "link": "https://stackoverflow.com/users/3750381/vasantha-ganesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1328, "favorite_count": 0, "closed_date": 1472854481, "answer_count": 2, "score": 3, "last_activity_date": 1472833110, "creation_date": 1472827728, "question_id": 39295245, "link": "https://stackoverflow.com/questions/39295245/how-to-write-pseudocode-for-functional-programming-languages", "closed_reason": "Needs more focus", "title": "How to write pseudocode for functional programming languages?", "body": "<p>How to write pseudocode for functional programming languages like Scheme or Haskell?\nAll that I searched for showed C style or Python style pseudocode.</p>\n"}, {"tags": ["mysql", "haskell", "cabal"], "comments": [{"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 1, "creation_date": 1472823254, "post_id": 39293599, "comment_id": 65921144, "body": "Have you tried to compile your code in a clean cabal sandbox?"}, {"owner": {"reputation": 4230, "user_id": 4592, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/5d8d81116011a01424b4dbe952846c25?s=128&d=identicon&r=PG", "display_name": "fryguybob", "link": "https://stackoverflow.com/users/4592/fryguybob"}, "edited": false, "score": 0, "creation_date": 1472823540, "post_id": 39293599, "comment_id": 65921325, "body": "I&#39;m no expert in why these things happen, but I usually list the package I want and the problematic package with the specific version I need.  So <code>cabal install mysql-simple bytestring-0.10.8.1</code>.  This usually either works or gives me a better reason why it won&#39;t work."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "edited": false, "score": 0, "creation_date": 1472824010, "post_id": 39293599, "comment_id": 65921643, "body": "@redneb I didn&#39;t use a sandbox, but I did have to install mysql-simple and utf8-bytestring. And I did it in that order. I think there may have been an old bytestring there already, but that utf8-bytestring might have brought in the new one, like a no warning disaster."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 4230, "user_id": 4592, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/5d8d81116011a01424b4dbe952846c25?s=128&d=identicon&r=PG", "display_name": "fryguybob", "link": "https://stackoverflow.com/users/4592/fryguybob"}, "edited": false, "score": 0, "creation_date": 1472824661, "post_id": 39293599, "comment_id": 65922070, "body": "@fryguybob I just tried that. Hilariously it did a lot more thinking than I expected and decided to do a version bump to pcre-light-0.4.0.4, whose config stage failed because pkg-config could not be found. I don&#39;t blame you, ok?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 4230, "user_id": 4592, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/5d8d81116011a01424b4dbe952846c25?s=128&d=identicon&r=PG", "display_name": "fryguybob", "link": "https://stackoverflow.com/users/4592/fryguybob"}, "edited": false, "score": 0, "creation_date": 1472824847, "post_id": 39293599, "comment_id": 65922206, "body": "@fryguybob and indeed, a brew install pkg-config later, all was well. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1472829262, "post_id": 39295329, "comment_id": 65925141, "body": "Great! I look forward to upgrading to ghc 8, which I will do as soon as this fix <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12007\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/12007</a> makes it out there. Demanding simultaneous cabal install of mysql-simple and the newer bytestring got me out of the hole. Cabalizing my rather small only-one-local-special-purpose program would add considerable overhead."}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 4, "last_activity_date": 1472827966, "last_edit_date": 1495542792, "creation_date": 1472827966, "answer_id": 39295329, "question_id": 39293599, "link": "https://stackoverflow.com/questions/39293599/how-has-instance-param-b-bytestring-managed-to-vanish/39295329#39295329", "title": "How has instance (Param B.ByteString) managed to vanish?", "body": "<blockquote>\n  <p>What's a good repair strategy?</p>\n</blockquote>\n\n<p>I urge you to cabalize the code and use cabal sandbox or <code>stack</code>. It should prevent the issue in the first place. To repair, you should find out what package is installed twice (it seems to be <code>bytestring</code>) and unregister it.</p>\n\n<blockquote>\n  <p>I'm a bit peeved at how much work I had to do to find that out: it would be great if \"No instance for Foo\" would add \"even though there's an instance for a whole other Foo\".</p>\n</blockquote>\n\n<p>I <a href=\"https://stackoverflow.com/questions/11068272/acid-state-monadstate-instance-for-update\">know</a> what you feel. Fortunately it is already <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9611\" rel=\"nofollow noreferrer\">fixed</a>, so you should get better error message from <code>ghc-8</code></p>\n"}], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "answer_count": 1, "score": 9, "last_activity_date": 1472827966, "creation_date": 1472822793, "question_id": 39293599, "link": "https://stackoverflow.com/questions/39293599/how-has-instance-param-b-bytestring-managed-to-vanish", "title": "How has instance (Param B.ByteString) managed to vanish?", "body": "<p>I have some old code which used to compile, but now it doesn't. I worry I may have hit a package management snafu, and I'm really bad at dealing with that sort of thing. I've cut it down to a minimal failing example.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Gremlin where\n\nimport Database.MySQL.Simple.Param\nimport qualified Data.ByteString as SB\n\nfoo :: Param x =&gt; [x]\nfoo = []\n\nshoo :: [SB.ByteString]\nshoo = foo\n</code></pre>\n\n<p>The error I get is</p>\n\n<pre><code>/.../Gremlin.hs:12:8:\nNo instance for (Param SB.ByteString) arising from a use of \u2018foo\u2019\nIn the expression: foo\nIn an equation for \u2018shoo\u2019: shoo = foo\n</code></pre>\n\n<p>But when I look at the source code for</p>\n\n<pre><code>module Database.MySQL.Simple.Param\n    (\n      Action(..)\n    , Param(..)\n    , inQuotes\n    ) where\n</code></pre>\n\n<p>I see</p>\n\n<pre><code>import qualified Data.ByteString as SB\n</code></pre>\n\n<p>and</p>\n\n<pre><code>instance Param SB.ByteString where\n    render = Escape\n    {-# INLINE render #-}\n</code></pre>\n\n<p>Relevant version information may include</p>\n\n<pre><code>$ ghci --version\nThe Glorious Glasgow Haskell Compilation System, version 7.10.2\n$ ghc-pkg latest mysql-simple\nmysql-simple-0.2.2.5\n$ ghc-pkg latest bytestring\nbytestring-0.10.8.1\n</code></pre>\n\n<p>When I ask ghci</p>\n\n<pre><code>:info Param\n</code></pre>\n\n<p>I get a shorter list than the mysql-simple documentation would lead me to expect.</p>\n\n<pre><code>Prelude&gt; :m + Database.MySQL.Simple.Param Data.ByteString\nPrelude Database.MySQL.Simple.Param Data.ByteString&gt; :info Param\nclass Param a where\n  render :: a -&gt; Action  \n    -- Defined in \u2018Database.MySQL.Simple.Param\u2019\ninstance Param [Char] -- Defined in \u2018Database.MySQL.Simple.Param\u2019\ninstance Param Word -- Defined in \u2018Database.MySQL.Simple.Param\u2019\ninstance Param a =&gt; Param (Maybe a)\n  -- Defined in \u2018Database.MySQL.Simple.Param\u2019\ninstance Param Integer -- Defined in \u2018Database.MySQL.Simple.Param\u2019\ninstance Param Int -- Defined in \u2018Database.MySQL.Simple.Param\u2019\ninstance Param Float -- Defined in \u2018Database.MySQL.Simple.Param\u2019\ninstance Param Double -- Defined in \u2018Database.MySQL.Simple.Param\u2019\ninstance Param Bool -- Defined in \u2018Database.MySQL.Simple.Param\u2019\ninstance Param Action -- Defined in \u2018Database.MySQL.Simple.Param\u2019\n</code></pre>\n\n<p>but I suppose that only tells me the instances for what's locally in scope. I then do</p>\n\n<pre><code>Prelude Database.MySQL.Simple.Param Data.ByteString&gt; :m +Data.Text\nPrelude Database.MySQL.Simple.Param Data.ByteString Data.Text&gt; :info Param\nclass Param a where\n...\ninstance Param Text -- Defined in \u2018Database.MySQL.Simple.Param\u2019\n...\n</code></pre>\n\n<p>Further investigation points to a potential source of trouble:</p>\n\n<pre><code>$ ghc-pkg describe mysql-simple\nname: mysql-simple\nversion: 0.2.2.5\n...\ndepends:\n...\n    bytestring-0.10.6.0-6e8453cb70b477776f26900f41a5e17a\n...\n</code></pre>\n\n<p>I'm guessing that the <code>ByteString</code> with the instance is from <code>0.10.6.0</code> and distinct from the version I get when write exactly the same import in my source file. If so, I'm a bit peeved at how much work I had to do to find that out: it would be great if \"No instance for Foo\" would add \"even though there's an instance for a whole other Foo\".</p>\n\n<p>This is cabal hell, right? Can I make mysql-simple rebuild with the newer version? I tried <code>ghc-pkg unregister mysql-simple</code> and then <code>cabal install mysql-simple</code>, but to no avail.</p>\n\n<p>What's a good repair strategy?</p>\n"}, {"tags": ["function", "variables", "haskell", "arguments"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1472822930, "post_id": 39293399, "comment_id": 65920922, "body": "Passing a function and a list of arguments is needed in other languages, when e.g. they are strict or ridden with side-effects. In Haskell, there&#39;s no need to do that. If the function is pure, just pass its result (it&#39;s not evaluated anyway) as an <code>a</code>; otherwise pass a <code>IO a</code> action as you are doing above (it&#39;s not executed until later)."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1472913684, "post_id": 39293399, "comment_id": 65948703, "body": "Why not pass the result of the function into <code>catchOutput</code> instead of trying to pass the function and its arguments?"}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 6465344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9968d173a0cb7704fe944394415e6729?s=128&d=identicon&r=PG&f=1", "display_name": "Tresia Burger", "link": "https://stackoverflow.com/users/6465344/tresia-burger"}, "edited": false, "score": 0, "creation_date": 1472822974, "post_id": 39293549, "comment_id": 65920958, "body": "As I understand it one cannot generate a list where the elements have different types.  Thus the usage of Data.Dynamic for the different elements of the argument list."}, {"owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "reply_to_user": {"reputation": 35, "user_id": 6465344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9968d173a0cb7704fe944394415e6729?s=128&d=identicon&r=PG&f=1", "display_name": "Tresia Burger", "link": "https://stackoverflow.com/users/6465344/tresia-burger"}, "edited": false, "score": 0, "creation_date": 1472823050, "post_id": 39293549, "comment_id": 65921004, "body": "Yes, you cannot have a list with elements of different types, but I don&#39;t see any lists in your code."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 3, "last_activity_date": 1472836069, "last_edit_date": 1472836069, "creation_date": 1472822597, "answer_id": 39293549, "question_id": 39293399, "link": "https://stackoverflow.com/questions/39293399/haskell-pass-arbitrary-function-and-argument-list-as-arguments-to-another-func/39293549#39293549", "title": "Haskell - Pass arbitrary function and argument list as arguments to another function", "body": "<p>There is not reason to use <code>Data.Dynamic</code>. You already know type the return type of <code>f</code>, it's <code>a</code> so you can use just that, i.e.</p>\n\n<pre><code>catchOutput :: IO a -&gt; IO (a, String)\n</code></pre>\n\n<p>Note though, that there some significant issues with your approach:</p>\n\n<ol>\n<li>By redirecting <code>stderr</code> to a file, this will also affect all other concurrent threads. So you could possibly get unrelated data sent to the temporary file.</li>\n<li>If an exception is thrown while <code>stderr</code> is redirected, the original <code>stderr</code> will not be restored. Any operation between the two <code>hDuplicateTo</code> lines (<code>hClose</code> and <code>f</code> in this case) could possibly throw an exception, or the thread may receive an asynchronous exception. For this reason, you have to use something like <a href=\"https://hackage.haskell.org/package/base/docs/Control-Exception-Base.html#v:bracket\" rel=\"nofollow\">bracket</a> to make your code exception safe.</li>\n</ol>\n"}], "owner": {"reputation": 35, "user_id": 6465344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9968d173a0cb7704fe944394415e6729?s=128&d=identicon&r=PG&f=1", "display_name": "Tresia Burger", "link": "https://stackoverflow.com/users/6465344/tresia-burger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 39293549, "answer_count": 1, "score": 0, "last_activity_date": 1472836069, "creation_date": 1472822174, "question_id": 39293399, "link": "https://stackoverflow.com/questions/39293399/haskell-pass-arbitrary-function-and-argument-list-as-arguments-to-another-func", "title": "Haskell - Pass arbitrary function and argument list as arguments to another function", "body": "<p>My main goal is to redirect stderr to a file.</p>\n\n<p>I got hold of the following code snippet...</p>\n\n<pre><code>catchOutput :: IO a -&gt; IO (res, String)\ncatchOutput f = do\n  tmpd &lt;- getTemporaryDirectory\n  (tmpf, tmph) &lt;- openTempFile tmpd \"haskell_stderr\"\n  stderr_dup &lt;- hDuplicate stderr\n  hDuplicateTo tmph stderr\n  hClose tmph\n  res &lt;- f\n  hDuplicateTo stderr_dup stderr\n  str &lt;- readFile tmpf\n  removeFile tmpf\n  return (res, str)\n</code></pre>\n\n<p>I hoped to make this more general and pass any function and argument list to catchOutput and get the function result as well as message written to stderr (if any).</p>\n\n<p>I thought that an argument list of type [Data.Dynamic] might work but I failed to retrieve the function result with</p>\n\n<pre><code>res &lt;- Data.List.foldl (f . fromDyn) Nothing $ args\n</code></pre>\n\n<p>Is this even possible?  Help will be greatly appreciated.</p>\n"}, {"tags": ["haskell", "dependent-type", "singleton-type", "curry-howard"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 3, "last_activity_date": 1472823773, "last_edit_date": 1472823773, "creation_date": 1472823242, "answer_id": 39293750, "question_id": 39293086, "link": "https://stackoverflow.com/questions/39293086/could-not-deduce-singi-of-predecessor-nat/39293750#39293750", "title": "Could not deduce SingI of predecessor Nat", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-TypeLits.html\" rel=\"nofollow\"><code>GHC.TypeLits</code></a>, which ultimately provides us type-level non-negative <code>Integer</code>-s, exports no functions that would let us do singleton runtime operations. For example, given <code>KnownNat a</code> and <code>KnownNat b</code>, there is no standard function to produce <code>KnownNat (a + b)</code> at runtime.</p>\n\n<p><code>singletons</code> solves this by implementing the <a href=\"https://hackage.haskell.org/package/singletons-2.2/docs/src/Data-Singletons-Prelude-Num.html#line-85\" rel=\"nofollow\">singleton <code>Nat</code> operations</a> unsafely. </p>\n\n<p><code>singletons</code> subtraction function throws an error for negative results (and doesn't truncate to 0 as we'd wish), so we can't reuse that for <code>pred</code> and have to implement it ourselves:</p>\n\n<pre><code>{-# language TypeApplications #-} -- plus all the usual exts\n\nimport Data.Singletons.Prelude\nimport Data.Singletons.TypeLits\nimport Unsafe.Coerce\n\ntype family Pred (n :: Nat) :: Nat where\n  Pred 0 = 0\n  Pred n = n :- 1\n\nsPred :: Sing n -&gt; Sing (Pred n)\nsPred sn = case fromSing sn of\n  0 -&gt; unsafeCoerce (sing @_ @0)\n  n -&gt; case toSing @Nat (n - 1) of\n    SomeSing sn -&gt; unsafeCoerce sn\n</code></pre>\n\n<p>You can use <code>sPred</code> to get <code>Sing (Pred n)</code>, then <code>withSingI</code> or <code>singInstance</code> to convert that into <code>SingI (Pred n)</code>. </p>\n\n<p>However, you probably shouldn't use <code>SingI</code> in <code>weaken</code>. The purpose of <code>SingI</code> is to plug around singleton parameters automatically in contexts where you don't use them for anything besides forwarding them to other functions. Instead just use <code>Sing</code>, and you can avoid <code>sing</code> and type annotation noise. In my experience <code>Sing</code> is preferable to <code>SingI</code> in about 90% of the time for <code>singletons</code> programming.</p>\n"}], "owner": {"reputation": 273, "user_id": 5374074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24e06dbaa357b25b6d0946f988dc223d?s=128&d=identicon&r=PG&f=1", "display_name": "denormal", "link": "https://stackoverflow.com/users/5374074/denormal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 39293750, "answer_count": 1, "score": 2, "last_activity_date": 1472823773, "creation_date": 1472821230, "question_id": 39293086, "link": "https://stackoverflow.com/questions/39293086/could-not-deduce-singi-of-predecessor-nat", "title": "Could not deduce SingI of predecessor Nat", "body": "<p>I am trying to write a <code>weaken</code> function for finite sets of integers. I am using the <code>singletons</code> package. I have defined and promoted addition, subtraction and predecessor functions, as well as proved some equations on them to help the type-checker. But the error I am getting is quite unrelated to all that.</p>\n\n<pre><code>weaken :: forall n m k . (SingI n, SingI m, SingI k, (Minus m n) ~ NatJust k) =&gt; Fin n -&gt; Fin m\nweaken ZF =  gcastWith (apply Refl $ plus_minus sm sn sk) ZF\n  where sn = sing :: SNat n\n        sm = sing :: SNat m\n        sk = sing :: SNat k\nweaken (SF n) = gcastWith (apply Refl $ succ_pred sm) (SF (weaken n))\n  where sn = sing :: SNat n\n        sm = sing :: SNat m\n        sk = sing :: SNat k\n</code></pre>\n\n<p>The error I am getting is on the recursive call of <code>weaken</code> (<code>SF (weaken n)</code>) and is the following: <code>Could not deduce (SingI n1)</code>, where <code>n1</code> is correctly inferred to be the type-level predecessor of type <code>n</code>. I <em>could</em> add a <code>SingI (Pred n)</code> constraint but this simply moves the problem one level down (GHC now says it can't deduce the equivalent of <code>(SingI (Pred (Pred n)))</code>).</p>\n\n<p>How can I convince GHC that <code>SingI (Pred n)</code> follows from <code>SingI n</code> (and why doesn't the <code>singletons</code> package already do this)?</p>\n"}, {"tags": ["haskell", "types", "typeclass"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472819513, "post_id": 39292245, "comment_id": 65918615, "body": "Did you notice the part of the error stating <code>Use FlexibleInstances if you want to disable this</code> ? Plain Haskell is fairly restrictive, especially in type classes; most modern programs make use of several extensions, so now the compiler often suggests which extension you need to turn on."}, {"owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472819699, "post_id": 39292245, "comment_id": 65918736, "body": "@chi Yep I did, but I thought <code>ghci</code> want me to replace keyword <code>instance</code> with <code>FlexibleInstances </code>, which proved to be dummy."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1472819862, "post_id": 39292245, "comment_id": 65918840, "body": "Ah, I see :) Extensions are enabled as in the answer below."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1472822680, "post_id": 39292245, "comment_id": 65920738, "body": "You can make this even more general: <code>instance Foldable t =&gt; Listable (t Int) where toList = Data.Foldable.toList</code>"}], "answers": [{"tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 4, "last_activity_date": 1518807922, "last_edit_date": 1518807922, "creation_date": 1472819056, "answer_id": 39292371, "question_id": 39292245, "link": "https://stackoverflow.com/questions/39292245/declare-list-instance-of-a-type-class/39292371#39292371", "title": "Declare list instance of a type class", "body": "<p>Just add the following line at the top of your source file</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n</code></pre>\n\n<p>This will enable the <code>FlexibleInstances</code> extension that is needed for instance declarations of this form as Haskell 98 doesn't allow them.</p>\n\n<p>Note that you can also enable the extension by adding the <code>-XFlexibleInstances</code> flag when you invoke <code>ghc</code> or <code>ghci</code>, but it is considered a bad practice to do that as it will enable the extension for all your modules. It will also mean that your program will only compile successfully depending on the command line flags passed to the compiler. This is why it is preferable to enable extensions on a per module basis as I explained above.</p>\n"}], "owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 812, "favorite_count": 0, "accepted_answer_id": 39292371, "answer_count": 1, "score": 3, "last_activity_date": 1518807922, "creation_date": 1472818647, "last_edit_date": 1592644375, "question_id": 39292245, "link": "https://stackoverflow.com/questions/39292245/declare-list-instance-of-a-type-class", "title": "Declare list instance of a type class", "body": "<p>I'm learning Haskell type classes through <a href=\"http://www.seas.upenn.edu/%7Ecis194/spring13/lectures/05-type-classes.html\" rel=\"nofollow noreferrer\">UPENN Haskell lecture notes</a>, making my own type class with example code:</p>\n<pre><code>class Listable a where\n    toList :: a -&gt; [Int]\n\ninstance Listable Int where\n    toList x = [x]\n\ninstance Listable Bool where\n    toList True  = [1]\n    toList False = [0]\n</code></pre>\n<p>It works with <code>Int</code> and <code>Bool</code> but <code>ghci</code> fails when I add an instance of <code>[Int]</code>:</p>\n<pre><code>instance Listable [Int] where\n    toList = id\n</code></pre>\n<p>Errors:</p>\n<blockquote>\n<p>Illegal instance declaration for \u2018Listable [Int]\u2019</p>\n<p>(All instance types must be of the form (T a1 ... an)</p>\n<p>where a1 ... an are <em>distinct type variables</em>,</p>\n<p>and each type variable appears at most once in the instance head.</p>\n<p>Use FlexibleInstances if you want to disable this.)</p>\n<p>In the instance declaration for \u2018Listable [Int]\u2019</p>\n</blockquote>\n<p>I try several time but all fail:</p>\n<pre><code>toList x = id x\ntoList x = x\ntoList = \\x -&gt; x\n</code></pre>\n<p>How could I fix it?</p>\n"}, {"tags": ["haskell", "testing", "quickcheck"], "comments": [{"owner": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "edited": false, "score": 0, "creation_date": 1472817048, "post_id": 39291494, "comment_id": 65916989, "body": "maybe <a href=\"http://stackoverflow.com/questions/12466580/how-to-use-modifiers-with-quickcheck-positive-in-my-case\" title=\"how to use modifiers with quickcheck positive in my case\">stackoverflow.com/questions/12466580/&hellip;</a> will help ?"}, {"owner": {"reputation": 1385, "user_id": 4464551, "user_type": "registered", "accept_rate": 52, "profile_image": "https://graph.facebook.com/10206253300199979/picture?type=large", "display_name": "Felix Ros&#233;n", "link": "https://stackoverflow.com/users/4464551/felix-ros%c3%a9n"}, "reply_to_user": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "edited": false, "score": 0, "creation_date": 1472818505, "post_id": 39291494, "comment_id": 65917940, "body": "@TomaszLewowski Not really. I did not understand this type class/definition <code>(Integral a, Show a, Read a) =&gt; ...</code>"}, {"owner": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "edited": false, "score": 0, "creation_date": 1472818835, "post_id": 39291494, "comment_id": 65918156, "body": "how about using <code>suchThat</code> modifier for generator?"}], "answers": [{"comments": [{"owner": {"reputation": 1385, "user_id": 4464551, "user_type": "registered", "accept_rate": 52, "profile_image": "https://graph.facebook.com/10206253300199979/picture?type=large", "display_name": "Felix Ros&#233;n", "link": "https://stackoverflow.com/users/4464551/felix-ros%c3%a9n"}, "edited": false, "score": 0, "creation_date": 1472820784, "post_id": 39292322, "comment_id": 65919416, "body": "Thx, it worked! A question: Why dont I need to apply the new list to the testing function, or atleast delete the existing list there (<code>[1..100]</code>)? Or maybe my question should be, what exactly is that function with that list doing now?"}, {"owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "reply_to_user": {"reputation": 1385, "user_id": 4464551, "user_type": "registered", "accept_rate": 52, "profile_image": "https://graph.facebook.com/10206253300199979/picture?type=large", "display_name": "Felix Ros&#233;n", "link": "https://stackoverflow.com/users/4464551/felix-ros%c3%a9n"}, "edited": false, "score": 0, "creation_date": 1472821827, "post_id": 39292322, "comment_id": 65920155, "body": "<code>all (&gt; 0)</code> expands to <code>\\xs -&gt; all (\\x -&gt; x &gt; 0) xs</code> which means apply <code>\\x -&gt; x &gt; 0</code> to each element of <code>xs</code> and then run <code>all</code> to check if all elements are <code>True</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472844570, "post_id": 39292322, "comment_id": 65933095, "body": "For the sake of efficiency, it might be better to generate a <code>Word</code>, add 1, cast to <code>Int</code>, take the absolute value, and then toss zero. The reason this <i>might</i> be better is that I believe QuickCheck normally tries to choose mostly &quot;small&quot; values, so you could have a lot of zeros to throw away. You&#39;d have to check some details before taking this advice, however--I could be wrong."}, {"owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "edited": false, "score": 0, "creation_date": 1472861964, "post_id": 39292322, "comment_id": 65938242, "body": "It would be nice to try if this is true. Another solution is to just add 1 to the generated number (except if it&#39;s <code>maxBound :: int</code>) instead of filter <code>&gt; 0</code>."}, {"owner": {"reputation": 63, "user_id": 3625240, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jNnFB.png?s=128&g=1", "display_name": "OthmanEmpire", "link": "https://stackoverflow.com/users/3625240/othmanempire"}, "edited": false, "score": 0, "creation_date": 1601998614, "post_id": 39292322, "comment_id": 113577501, "body": "So how exactly do you invoke this on GHCi? quickCheck (forAll genListOfPos (all (&gt; 0)) comparePower2?"}, {"owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "edited": false, "score": 0, "creation_date": 1602095719, "post_id": 39292322, "comment_id": 113615217, "body": "Define <code>genPos</code> and <code>genListOfPos</code> with <code>let</code> (e.g. <code>let genPos = ...</code>) and then you can just  run<code>quickCheck $ forAll genListOfPos $ all (&gt; 0)</code>."}], "tags": [], "owner": {"reputation": 2995, "user_id": 1095506, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07067c06a12496ca32eb400313ef4ab6?s=128&d=identicon&r=PG", "display_name": "mariop", "link": "https://stackoverflow.com/users/1095506/mariop"}, "is_accepted": true, "score": 13, "last_activity_date": 1472818871, "creation_date": 1472818871, "answer_id": 39292322, "question_id": 39291494, "link": "https://stackoverflow.com/questions/39291494/only-generate-positive-integers-with-quickcheck/39292322#39292322", "title": "Only generate positive integers with QuickCheck", "body": "<p>QuickCheck has support for <a href=\"https://hackage.haskell.org/package/QuickCheck-2.9.1/docs/Test-QuickCheck.html#t:Positive\" rel=\"noreferrer\">Positive numbers</a>, but for the sake of this tutorial I will show you how to create your own Generator. One of the main features of QuickCheck is that you can design your own generator to output just what you need. For instance</p>\n\n<pre><code>genPos :: Gen Int\ngenPos = abs `fmap` (arbitrary :: Gen Int) `suchThat` (&gt; 0)\n</code></pre>\n\n<p>Then you can create your own list genereator</p>\n\n<pre><code>genListOfPos :: Gen [Int]\ngenListOfPos = listOf genPos\n</code></pre>\n\n<p>Finally you can use forAll, pass the generator and profit.</p>\n\n<pre><code>main :: IO ()\nmain = do\n  quickCheck $ forAll genPos $ \\x -&gt; x &gt; 0\n  quickCheck $ forAll genListOfPos $ all (&gt; 0)\n</code></pre>\n"}], "owner": {"reputation": 1385, "user_id": 4464551, "user_type": "registered", "accept_rate": 52, "profile_image": "https://graph.facebook.com/10206253300199979/picture?type=large", "display_name": "Felix Ros&#233;n", "link": "https://stackoverflow.com/users/4464551/felix-ros%c3%a9n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3092, "favorite_count": 0, "accepted_answer_id": 39292322, "answer_count": 1, "score": 10, "last_activity_date": 1521297578, "creation_date": 1472816352, "last_edit_date": 1521297578, "question_id": 39291494, "link": "https://stackoverflow.com/questions/39291494/only-generate-positive-integers-with-quickcheck", "title": "Only generate positive integers with QuickCheck", "body": "<p>We have two functions that compare two different <code>power</code> functions, and return true if they return the same value (on the same input).</p>\n\n<p>Then we have two other functions that test these functions against two lists to see if there is any value that doesn't return true.</p>\n\n<p>But instead of using lists that use a range <code>[1..100]</code>, we would like to use QuickCheck.</p>\n\n<p>Is it possible to make QuickCheck only return positive integers?</p>\n\n<p>Code:</p>\n\n<pre><code>comparePower1 :: Integer -&gt; Integer -&gt; Bool\ncomparePower1 n k = power n k == power1 n k\n\ncomparePower2 :: Integer -&gt; Integer -&gt; Bool\ncomparePower2 n k = power n k == power2 n k\n\ntesting1 = and [comparePower1 n k | n &lt;- [0..100], k &lt;- [0..100]]\ntesting2 = and [comparePower2 n k | n &lt;- [0..100], k &lt;- [0..100]]\n</code></pre>\n"}, {"tags": ["haskell", "type-inference", "typeclass", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1472804240, "post_id": 39287208, "comment_id": 65908981, "body": "Ahh, of course. I ninjaedited the question inbetween, so I&#39;m actually passing a proxy for <code>sig</code> now (a <code>Tagged</code> in my actual use case). That should compensate for the missing injectivity, namely the FunDep <code>(Monadify m sig) sig -&gt; m</code> should hold. With that knowledge, is it safe to use <code>AllowAmbiguousTypes</code>? See also my edit above."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1472804617, "post_id": 39287208, "comment_id": 65909211, "body": "Specifically, I&#39;d like to know if any of <code>AllowAmbiguousTypes</code> might leak out to calling modules, giving them a hard time figuring out type errors. I know that it works just fine for my concrete uses in GHCI, but am unsure if that&#39;s the general case."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 1, "creation_date": 1472817386, "post_id": 39287208, "comment_id": 65917196, "body": "Also note that <code>type family Monadify f a = r | r a -&gt; f where ...</code> is not supported, yet: on the LHS of <code>-&gt;</code> only a single <code>r</code> is allowed. Hence, we can not even state the lesser injectivity property."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1472817813, "post_id": 39287208, "comment_id": 65917500, "body": "@SebastianGraf Well, the users will need to specify <code>m</code> in some way if there&#39;s an ambiguity. See my edit."}, {"owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "edited": false, "score": 0, "creation_date": 1472895758, "post_id": 39287208, "comment_id": 65944081, "body": "OK, so I&#39;ll stick with ambiguous types. Seems to be future proof given explicit type arguments in GHC 8 and also works quite well for what I tested it with."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1472817731, "last_edit_date": 1472817731, "creation_date": 1472803099, "answer_id": 39287208, "question_id": 39285930, "link": "https://stackoverflow.com/questions/39285930/types-dont-unify-using-a-type-class-and-a-type-family/39287208#39287208", "title": "Types don&#39;t unify using a type class and a type family", "body": "<p>The problem is with <code>monadify'</code>, not <code>monadify</code>.</p>\n\n<p>Suppose you are calling</p>\n\n<pre><code>monadify' :: forall m sig. (Monad m, Sig sig) =&gt; Monadify m sig\n</code></pre>\n\n<p>here there are no proxies around so, without assuming <code>Monadify</code> injective, it is impossible for the compiler to know what <code>m,sig</code> should be instantiated to. That is also needed to understand what instances <code>(Monad m, Sig sig)</code> should be used.</p>\n\n<p>Try instead working with</p>\n\n<pre><code>monadify' :: forall m sig. (Monad m, Sig sig) \n          =&gt; Proxy m -&gt; Proxy sig -&gt; Monadify m sig\n</code></pre>\n\n<p>Also note that <code>Monadify</code> is <em>not</em> injective:</p>\n\n<pre><code>Monadify ((-&gt;) Bool) (IO Char)      ~ Bool -&gt; IO Char\nMonadify IO          (Bool -&gt; Char) ~ Bool -&gt; IO Char\n</code></pre>\n\n<hr>\n\n<p>If you use <code>AllowAmbiguousTypes</code> the following does not type check:</p>\n\n<pre><code>test :: forall m sig. (Monad m, Sig sig)\n     =&gt; Proxy sig -&gt; Proxy m -&gt; Monadify m sig\ntest t _ = monadify' t\n-- Type variable m0 is ambiguous\n</code></pre>\n\n<p>We can however fix it by passing an explicit type argument <code>m</code>:</p>\n\n<pre><code>test :: forall m sig. (Monad m, Sig sig)\n     =&gt; Proxy sig -&gt; Proxy m -&gt; Monadify m sig\ntest t _ = monadify' @ m t\n</code></pre>\n\n<p>Personally, I'd try to remove all proxies and use type arguments instead, since I find it much cleaner, even if that requires ambiguous types.</p>\n"}], "owner": {"reputation": 3295, "user_id": 388010, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/f6c6f0feb5cb53e7023d5d9ecc443767?s=128&d=identicon&r=PG", "display_name": "Sebastian Graf", "link": "https://stackoverflow.com/users/388010/sebastian-graf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 39287208, "answer_count": 1, "score": 0, "last_activity_date": 1472817731, "creation_date": 1472798752, "last_edit_date": 1472804319, "question_id": 39285930, "link": "https://stackoverflow.com/questions/39285930/types-dont-unify-using-a-type-class-and-a-type-family", "title": "Types don&#39;t unify using a type class and a type family", "body": "<p>Consider the snippet</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeFamilies #-}\n\nimport Data.Proxy\n\nmonadify' :: forall m sig. (Monad m, Sig sig) =&gt; Proxy sig -&gt; Monadify m sig\nmonadify' p = monadify p (return () :: m ())\n\ntype family Monadify f a where\n  Monadify f (a -&gt; r) = a -&gt; Monadify f r\n  Monadify f a = f a\n\nclass Sig sig where\n    monadify :: Monad m =&gt; Proxy sig -&gt; m () -&gt; Monadify m sig\n</code></pre>\n\n<p>I've given no instances, but an example usage would be <code>f :: Int -&gt; String -&gt; Bool, monadify' f :: Int -&gt; String -&gt; IO Bool</code>.</p>\n\n<p>It fails to typecheck with the following error message:</p>\n\n<pre><code>Couldn't match expected type \u2018Monadify m sig\u2019\n            with actual type \u2018Monadify m0 sig0\u2019\nNB: \u2018Monadify\u2019 is a type function, and may not be injective\nThe type variables \u2018m0\u2019, \u2018sig0\u2019 are ambiguous\nIn the ambiguity check for the type signature for \u2018monadify'\u2019:\n  monadify' :: forall (m :: * -&gt; *) sig.\n               (Monad m, Sig sig) =&gt;\n               Monadify m sig\nTo defer the ambiguity check to use sites, enable AllowAmbiguousTypes\nIn the type signature for \u2018monadify'\u2019:\n  monadify' :: forall m sig. (Monad m, Sig sig) =&gt; Monadify m sig\n</code></pre>\n\n<p>Intuitively I'd say that it should typecheck, but GHC gets confused by the type family, which is not annotated as injective (I'd rather not for backwards compatibility). It could recover the preimage from the <code>m ()</code> and the <code>Proxy</code> though, so I don't really know what's the problem here.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>As the error message suggests, I could throw in <code>AllowAmbiguousTypes</code>, which in my case fixes all problems. But I don't know the consequences of using that extension, plus I'd rather know why my example doesn't typecheck.</p>\n\n<p>I have a feeling that it has to do with the unifier first trying to unify the <code>Monadify m sig</code>s, thereby inferring that it can't prove that the <code>sig</code>s and <code>m</code>s are identical. Although the unifier just needed to look at the passed arguments to know that they are identical, so that might be where <code>AllowAmbiguousTypes</code> helps.</p>\n"}, {"tags": ["python", "haskell", "optimization", "language-comparisons"], "comments": [{"owner": {"reputation": 1473, "user_id": 204305, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4fa6165d3bcb50e58e60304807f4090a?s=128&d=identicon&r=PG", "display_name": "Sage Mitchell", "link": "https://stackoverflow.com/users/204305/sage-mitchell"}, "edited": false, "score": 7, "creation_date": 1472780225, "post_id": 39283047, "comment_id": 65900652, "body": "Can you post the Python code and some benchmarks?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1472780333, "post_id": 39283047, "comment_id": 65900679, "body": "<code>words dict</code> is just a list, and <code>elem</code> is performing a sequential search through the list."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1472783128, "post_id": 39283047, "comment_id": 65901290, "body": "Strings are linked lists in Haskell. Use the text type."}, {"owner": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 7, "creation_date": 1472786858, "post_id": 39283047, "comment_id": 65902078, "body": "I&#39;m not sure why this is downvoted so heavily. This is a reasonable question for a beginner to have. There&#39;s not <i>really</i> enough information here to give a meaningful answer, as a lot could depend on how you&#39;re running this code. But there are some high-level improvements you could make, like using <a href=\"https://hackage.haskell.org/package/text\" rel=\"nofollow noreferrer\"><code>Text</code></a> and <a href=\"https://hackage.haskell.org/package/containers\" rel=\"nofollow noreferrer\"><code>Set</code></a>. The question of why this has different performance characteristics than an equivalent Python solution is very interesting, and if you post your Python code that could help us sort it out."}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "edited": false, "score": 2, "creation_date": 1472789662, "post_id": 39283047, "comment_id": 65902700, "body": "Of course the answer is \u201cbecause you&#39;re using the wrong data structure\u201d."}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 0, "creation_date": 1472789759, "post_id": 39283047, "comment_id": 65902722, "body": "@IanHenry: The question of why lazy linked lists perform very differently from a proper dictionary data structure isn&#39;t interesting at all. (But, FWIW, I didn&#39;t downvote this question. And I wouldn&#39;t downvote the question just because it isn&#39;t interesting.)"}, {"owner": {"reputation": 433, "user_id": 4822554, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ca77914598cf05d3339bcafaede4e562?s=128&d=identicon&r=PG&f=1", "display_name": "nilcit", "link": "https://stackoverflow.com/users/4822554/nilcit"}, "reply_to_user": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "edited": false, "score": 0, "creation_date": 1472814623, "post_id": 39283047, "comment_id": 65915468, "body": "@IanHenry thanks for your suggestions - as a total newbie tot he language I very much appreciate all help! I looked into Set, and using it significantly improved performance. I honestly don&#39;t really need this code for anything and don&#39;t particularly care about what its run time is; I was mainly just curious if I was doing something fundamentally wrong or stupid in Haskell. Aside from using the wrong data structure, would you say there&#39;s anything else glaringly bad about my code?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1472843281, "post_id": 39283047, "comment_id": 65932529, "body": "Be sure to read <a href=\"http://stackoverflow.com/tags/haskell/info\">stackoverflow.com/tags/haskell/info</a> . It&#39;s unfortunate it isn&#39;t made more visible somehow."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1472876164, "post_id": 39283047, "comment_id": 65940199, "body": "@ThomasM.DuBuisson, surely you&#39;re joking. Using <code>Text</code> does not address the fundamental problem here."}], "answers": [{"comments": [{"owner": {"reputation": 433, "user_id": 4822554, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ca77914598cf05d3339bcafaede4e562?s=128&d=identicon&r=PG&f=1", "display_name": "nilcit", "link": "https://stackoverflow.com/users/4822554/nilcit"}, "edited": false, "score": 2, "creation_date": 1472779839, "post_id": 39283078, "comment_id": 65900546, "body": "The python code stores the dictionary as a list of strings, just like the Haskell implementation. In python, to check for membership I&#39;m using  the &quot;in&quot; function"}, {"owner": {"reputation": 6779, "user_id": 1342941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a77b35477fab1e681d7e14f7ea78b178?s=128&d=identicon&r=PG", "display_name": "happydave", "link": "https://stackoverflow.com/users/1342941/happydave"}, "reply_to_user": {"reputation": 433, "user_id": 4822554, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ca77914598cf05d3339bcafaede4e562?s=128&d=identicon&r=PG&f=1", "display_name": "nilcit", "link": "https://stackoverflow.com/users/4822554/nilcit"}, "edited": false, "score": 0, "creation_date": 1472780168, "post_id": 39283078, "comment_id": 65900638, "body": "Hmm, I don&#39;t know of a clear answer to your question, then, but storing dictWords as a set still seems likely to fix your run time problem"}, {"owner": {"reputation": 433, "user_id": 4822554, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ca77914598cf05d3339bcafaede4e562?s=128&d=identicon&r=PG&f=1", "display_name": "nilcit", "link": "https://stackoverflow.com/users/4822554/nilcit"}, "edited": false, "score": 1, "creation_date": 1472815388, "post_id": 39283078, "comment_id": 65915919, "body": "I guess I was expecting Haskell to be faster than Python since it&#39;s statically typed, so when it&#39;s 3x slower I called that &quot;incredibly slow&quot;. It was bad phrasing on my part, I should&#39;ve been clearer about the situation. Other&#39;s suggested using Set as well, and it definitely improved the running time. However, I&#39;m still curious why lists in Haskell are slower than lists in Python. For the Python implementation, to look up a word it still has to iterate over a list. Are Python&#39;s lists just way more optimized than Haskell&#39;s? How is it possible to speed up iteration that much?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 433, "user_id": 4822554, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ca77914598cf05d3339bcafaede4e562?s=128&d=identicon&r=PG&f=1", "display_name": "nilcit", "link": "https://stackoverflow.com/users/4822554/nilcit"}, "edited": false, "score": 2, "creation_date": 1472846904, "post_id": 39283078, "comment_id": 65934003, "body": "@nilcit Note that python <code>list</code>s are built-ins, which means that they are implemented directly in C as &quot;resizable-arrays&quot;. This means that a single call to <code>element in sequence</code> will cost the interpreted overhead of a single method call, then the implementation for <code>list.__contains__</code> will kick-in and performs a C-loop over the underlying array and called the equality operator from C. so in the end CPython&#39;s <code>in</code> doesn&#39;t really have that much overhead compared to compiled languages because most of the work is done in compiled code, the only overhead are the generic comparisons."}], "tags": [], "owner": {"reputation": 6779, "user_id": 1342941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a77b35477fab1e681d7e14f7ea78b178?s=128&d=identicon&r=PG", "display_name": "happydave", "link": "https://stackoverflow.com/users/1342941/happydave"}, "is_accepted": false, "score": 6, "last_activity_date": 1472846671, "last_edit_date": 1472846671, "creation_date": 1472779730, "answer_id": 39283078, "question_id": 39283047, "link": "https://stackoverflow.com/questions/39283047/why-is-this-haskell-code-so-slow/39283078#39283078", "title": "Why is this Haskell code so slow?", "body": "<p>Checking if <code>x</code> is an element of <code>dictWords</code> is likely to be very slow.  I would assume that your similar python implementation stores <code>dictWords</code> in a set or sorted vector (using binary search in the latter case)?  Seems like you probably want to do the same here.</p>\n\n<p>Using <a href=\"https://www.wordgamedictionary.com/twl06/download/twl06.txt\" rel=\"nofollow\">this word list</a> and the code below, the Python version runs in about 30 seconds, and the Haskell version takes 1.5 minutes.  So Haskell is slower (perhaps because it's using a linked list, which all things being equal, is slower to iterate over), but I wouldn't call it \"incredibly slow\" compared to Python.  Switching to use a set in either version reduces the time to under 1 second.</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>from itertools import permutations\nf = open('twl06.txt')\nwords = f.read().split()\n\nprint [''.join(p) for p in permutations('apricot') if ''.join(p) in words]\n</code></pre>\n\n<p>And here's the set-based Haskell code:</p>\n\n<pre><code>import Data.Set\nimport Data.List\n\nmain = do\n    dict    &lt;- readFile \"twl06.txt\"\n    let letters = \"apricot\"\n    let dictWords = Data.Set.fromList $ words dict\n    let perms = permutations letters\n    print [x | x &lt;- perms, member x dictWords]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 433, "user_id": 4822554, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ca77914598cf05d3339bcafaede4e562?s=128&d=identicon&r=PG&f=1", "display_name": "nilcit", "link": "https://stackoverflow.com/users/4822554/nilcit"}, "edited": false, "score": 0, "creation_date": 1472814047, "post_id": 39283994, "comment_id": 65915149, "body": "Thank you very much for your response! I actually did experiment with a solution very similar to the one you provided - sorting the input and the words from the dictionary and checking for anagrams that way. I used the Set structure and checked for membership with the Set.member function. That implementation actually didn&#39;t really improve my running time terrifically. Your implementation, after initialization, is incredibly fast however! I&#39;ll definitely study up on Map. Thanks again for your input - as a newcomer to the language, I hugely appreciate the help!"}, {"owner": {"reputation": 433, "user_id": 4822554, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ca77914598cf05d3339bcafaede4e562?s=128&d=identicon&r=PG&f=1", "display_name": "nilcit", "link": "https://stackoverflow.com/users/4822554/nilcit"}, "edited": false, "score": 0, "creation_date": 1472814930, "post_id": 39283994, "comment_id": 65915630, "body": "As a follow up - when I included a forever line in my code (the one where I sorted input and dictionary words), queries after the first were instantaneous. I guess this is because of lazy evaluation? As in the code doesn&#39;t really create the dictionary until the first query, when it actually needs it, but after it&#39;s already there for subsequent ones?"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 433, "user_id": 4822554, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ca77914598cf05d3339bcafaede4e562?s=128&d=identicon&r=PG&f=1", "display_name": "nilcit", "link": "https://stackoverflow.com/users/4822554/nilcit"}, "edited": false, "score": 0, "creation_date": 1472831672, "post_id": 39283994, "comment_id": 65926583, "body": "That&#39;s right. However you have to be careful with <code>forever</code> and compiler version and options - sometime the map is recomputed for each iteration. When the map is not recomputed the second and subsequent lookups are instantaneous."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472876927, "post_id": 39283994, "comment_id": 65940297, "body": "While it may well be fast enough for this job, <code>Data.Map</code> is a pretty bad data structure if you&#39;re using strings (in any format) as keys. A <code>HashMap</code> would probably be better, but something more trie-like seems likely best."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 6, "last_activity_date": 1472788963, "last_edit_date": 1472788963, "creation_date": 1472787842, "answer_id": 39283994, "question_id": 39283047, "link": "https://stackoverflow.com/questions/39283047/why-is-this-haskell-code-so-slow/39283994#39283994", "title": "Why is this Haskell code so slow?", "body": "<blockquote>\n  <p>I'm kind of new to Haskell and tried making a scrabble solver.</p>\n</blockquote>\n\n<p>You can substantially improve things by using a better algorithm.</p>\n\n<p>Instead of testing every permutation of the input letters, if you\nsort them first you can make only one dictionary lookup and get\nall of the possible words (anagrams) which may be formed from \nthem (using all of them).</p>\n\n<p>Here is code which creates that dictionary as a Data.Map.\nThere is a start-up cost to creating the Map, but after\nthe first query subsequent lookups are very fast.</p>\n\n<pre><code>import Data.List\nimport qualified Data.Map.Strict as Map\nimport Control.Monad\nimport System.IO\n\nmain = do\n  contents &lt;- readFile \"words\"\n  let pairs = [ (sort w, [w]) | w &lt;- words contents ]\n      dict = foldl' (\\m (k,v) -&gt; Map.insertWith (++) k v m) Map.empty pairs\n      -- dict = foldr (\\(k,v) m -&gt; Map.insertWith (++) k v m) Map.empty pairs\n  forever $ do\n    putStr \"Enter letters: \" &gt;&gt; hFlush stdout\n    letters &lt;- getLine\n    case Map.lookup (sort letters) dict of\n      Nothing -&gt; putStrLn \"No words.\"\n      Just ws -&gt; putStrLn $ \"Words: \" ++ show ws\n</code></pre>\n\n<p>Map creation time for a word file of 236K words (2.5 MB) is about 4-5 seconds. Better performance is likely possible by using ByteStrings or Text instead of Strings.</p>\n\n<p>Some good letter combinations to try:</p>\n\n<pre><code>steer rat tuna lapse groan neat\n</code></pre>\n\n<p>Note: Using GHC 7.10.2 I found this code performed the best <em>without</em> compiling with -O2.</p>\n"}], "owner": {"reputation": 433, "user_id": 4822554, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ca77914598cf05d3339bcafaede4e562?s=128&d=identicon&r=PG&f=1", "display_name": "nilcit", "link": "https://stackoverflow.com/users/4822554/nilcit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 618, "favorite_count": 2, "accepted_answer_id": 39283994, "answer_count": 2, "score": 7, "last_activity_date": 1472910113, "creation_date": 1472779417, "last_edit_date": 1472910113, "question_id": 39283047, "link": "https://stackoverflow.com/questions/39283047/why-is-this-haskell-code-so-slow", "title": "Why is this Haskell code so slow?", "body": "<p>I'm kind of new to Haskell and tried making a scrabble solver. It takes in the letters you currently have, finds all permutations of them and filters out those that are dictionary words. The code's pretty simple: </p>\n\n<pre><code>import Data.List\n\nmain = do\n    dict    &lt;- readFile \"words\"\n    letters &lt;- getLine\n    let dictWords = words dict\n    let perms = permutations letters\n    print [x | x &lt;- perms, x `elem` dictWords]\n</code></pre>\n\n<p>However it's incredibly slow, compared to a very similar implementation I have with Python. Is there something fundamental I'm doing wrong?</p>\n\n<p>*edit: Here's my Python code:</p>\n\n<pre><code>from itertools import permutations\n\nletters = raw_input(\"please enter your letters (without spaces): \")\n\nd = open('words')\ndictionary = [line.rstrip('\\n') for line in d.readlines()]\nd.close()\n\nperms = [\"\".join(p) for p in permutations(letters)]\n\nvalidWords = []\n\nfor p in perms:\n    if p in dictionary: validWords.append(p)\n\n\nfor validWord in validWords:\n    print validWord\n</code></pre>\n\n<p>I didn't time them precisely, but roughly it feels like the Python implementation is about 2x as fast as the Haskell one. Perhaps I should't have said the Haskell code was \"incredibly slow\" in comparison, but since Haskell is statically typed I guess I just thought that it should've been much faster, and not slower than Python at all.</p>\n"}, {"tags": ["haskell", "types", "polymorphism"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1472766974, "post_id": 39281442, "comment_id": 65897345, "body": "Not sure how this fits in with your understanding, but: your definition for <code>constant</code> works fine with the <code>NumDecimals</code> extension turned on, and even without it, <code>constant :: Num a =&gt; a; constant = 1</code> is perfectly acceptable."}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1472767119, "post_id": 39281442, "comment_id": 65897398, "body": "@DanielWagner: I see that <code>constant = 1</code> works fine. I guess the crux of my misunderstanding is that I don&#39;t really understand why <code>constant = 1.0</code> doesn&#39;t work..."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1472767494, "post_id": 39281442, "comment_id": 65897543, "body": "In the second example, try changing the <code>3</code> to <code>3.0</code>."}, {"owner": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "edited": false, "score": 1, "creation_date": 1472767499, "post_id": 39281442, "comment_id": 65897545, "body": "because being a <code>Num</code> implies only <code>+</code>, <code>-</code>, <code>*</code>, <code>abs</code>, <code>negate</code>, <code>signum</code> and <code>fromInteger</code>. <code>fromInteger</code> is the clue here - everything that is <code>Num</code> may be constructed from <code>Integer</code>, but <code>1.0</code> is not an <code>Integer</code>. To use <code>1.0</code> you would need <code>fromRational</code> which is a member of <code>Fractional</code> - thus not guaranteed to be in every <code>Num</code>"}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 4, "last_activity_date": 1472773414, "last_edit_date": 1472773414, "creation_date": 1472767882, "answer_id": 39281642, "question_id": 39281442, "link": "https://stackoverflow.com/questions/39281442/polymorphism-a-constant-versus-a-function/39281642#39281642", "title": "Polymorphism: a constant versus a function", "body": "<p>When you have a polymorphic value, the caller chooses which concrete type to use. The <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch6.html#x13-1350006.4\" rel=\"nofollow\">Haskell report</a> defines the type of numeric literals, namely:</p>\n\n<blockquote>\n  <p>integer and floating literals have the typings (Num a) => a and\n  (Fractional a) => a, respectively</p>\n</blockquote>\n\n<p><code>3</code> is an integer literal so has type <code>Num a =&gt; a</code> and <code>(*)</code> has type <code>Num a =&gt; a -&gt; a -&gt; a</code> so <code>f</code> has type <code>Num a =&gt; a -&gt; a</code>.</p>\n\n<p>In contrast, <code>3.0</code> has type <code>Fractional a =&gt; a</code>. Since <code>Fractional</code> is a subclass of <code>Num</code> your  type signature for <code>constant</code> is invalid since the caller could choose a type for <code>a</code> which is <code>Num</code> but not <code>Fractional</code> e.g. <code>Int</code> or <code>Integer</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "is_accepted": false, "score": 1, "last_activity_date": 1472767927, "creation_date": 1472767927, "answer_id": 39281652, "question_id": 39281442, "link": "https://stackoverflow.com/questions/39281442/polymorphism-a-constant-versus-a-function/39281652#39281652", "title": "Polymorphism: a constant versus a function", "body": "<p>They don't mean the opposite - they mean exactly the same (\"as general as possible\"). Typeclass gives you all guarantees that you can rely upon - if typeclass <code>T</code> provides function <code>f</code>, you can use it for all instances of <code>T</code>, but even if some of these instances are members of <code>G</code> (providing <code>g</code>) as well, requiring to be of <code>T</code> typeclass is not sufficient to call <code>g</code>. </p>\n\n<p>In your case this means:</p>\n\n<p>Members of <code>Num</code> are guaranteed to provide conversion from integers (i.e. default type for integral values, like <code>1</code> or <code>1000</code>) - with <code>fromInteger</code> function. </p>\n\n<p>However, they are not guaranteed to provide conversion from rational numbers (like <code>1.0</code>) - <code>Fractional</code> typeclass does provide this as <code>fromRational</code> function, but it doesn't really matter, as you use only <code>Num</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1472782267, "post_id": 39281666, "comment_id": 65901107, "body": "Ahhhhhh. I see. So to sum up: basically, the implicit call to <code>FromRational</code> is the issue here. <code>Num</code> doesn&#39;t provide that, so that&#39;s the reason why it fails. Is that correct?"}, {"owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1472783034, "post_id": 39281666, "comment_id": 65901270, "body": "...and in the example for <code>f</code> the fact that the <i>function</i> can take any number input makes sense, because as long as the function definition for <code>f</code> passes the type signature test, then the constraint on the function input remains <code>Num a =&gt; a</code>, which is general enough to take any number. This makes sense to me now, but please correct if I&#39;m wrong."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "edited": false, "score": 0, "creation_date": 1472783888, "post_id": 39281666, "comment_id": 65901476, "body": "@gogurt That sounds basically right to me! Note, though, that for the function, the constraint <code>Num a</code> is not merely on the argument, which it sounds like you sort of believe with your sentence, &quot;the constraint on the function input remains <code>Num a =&gt; a</code>&quot;. In fact, the constraint <code>Num a</code> says that you have to pick a <code>Num</code> instance; then once you&#39;ve done that, you get a function of type <code>a -&gt; a</code> for that instance. The type <code>foo :: (forall a. Num a =&gt; a) -&gt; ...</code>, which sounds like what you&#39;re trying to describe, is a very different one!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1472768018, "creation_date": 1472768018, "answer_id": 39281666, "question_id": 39281442, "link": "https://stackoverflow.com/questions/39281442/polymorphism-a-constant-versus-a-function/39281666#39281666", "title": "Polymorphism: a constant versus a function", "body": "<p>It can sometimes help to read types as a game played between two actors, the implementor of the type and the user of the type. To do a good job of explaining this perspective, we have to introduce something that Haskell hides from you by default: we will add binders for all type variables. So your types would actually become:</p>\n\n<pre><code>constant :: forall a. Num a =&gt; a\nf :: forall a. Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>Now, we will read type formation rules thusly:</p>\n\n<ul>\n<li><code>forall a. t</code> means: the caller chooses a type <code>a</code>, and the game continues as <code>t</code></li>\n<li><code>c =&gt; t</code> means: the caller shows that constraint <code>c</code> holds, and the game continues as <code>t</code></li>\n<li><code>t -&gt; t'</code> means: the caller chooses a value of type <code>t</code>, and the game continues as <code>t'</code></li>\n<li><code>t</code> (where <code>t</code> is a monomorphic type such as a bare variable or <code>Integer</code> or similar) means: the implementor produces a value of type <code>a</code></li>\n</ul>\n\n<p>We will need a few other details to truly understand things here, so I will quickly say them here:</p>\n\n<ul>\n<li>When we write a number with no decimal points, the compiler implicitly converts this to a call to <code>fromInteger</code> applied to the <code>Integer</code> produced by parsing that number. We have <code>fromInteger :: forall a. Num a =&gt; Integer -&gt; a</code>.</li>\n<li>When we write a number with decimal points, the compiler implicitly converts this to a call to <code>fromRational</code> applied to the <code>Rational</code> produced by parsing that number. We have <code>fromRational :: forall a. Fractional a =&gt; Rational -&gt; a</code>.</li>\n<li>The <code>Num</code> class includes the method <code>(*) :: forall a. Num a =&gt; a -&gt; a -&gt; a</code>.</li>\n</ul>\n\n<p>Now let's try to walk through your two examples slowly and carefully.</p>\n\n<pre><code>constant :: forall a. Num a =&gt; a\nconstant = 1.0 {- = fromRational (1 % 1) -}\n</code></pre>\n\n<p>The type of <code>constant</code> says: the caller chooses a type, shows that this type implements <code>Num</code>, and then the implementor must produce a value of that type. Now the implementor tries to play his own game by calling <code>fromRational :: Fractional a =&gt; Rational -&gt; a</code>. He chooses the same type the caller did, and then makes an attempt to show that this type implements <code>Fractional</code>. Oops! He can't show that, because the only thing the caller proved to him was that <code>a</code> implements <code>Num</code> -- which doesn't guarantee that <code>a</code> also implements <code>Fractional</code>. Dang. So the implementor of <code>constant</code> isn't allowed to call <code>fromRational</code> at that type.</p>\n\n<p>Now, let's look at <code>f</code>:</p>\n\n<pre><code>f :: forall a. Num a =&gt; a -&gt; a\nf x = 3*x {- = fromInteger 3 * x -}\n</code></pre>\n\n<p>The type of <code>f</code> says: the caller chooses a type, shows that the type implements <code>Num</code>, and chooses a value of that type. The implementor must then produce another value of that type. He is going to do this by playing his own game with <code>(*)</code> and <code>fromInteger</code>. In particular, he chooses the same type the caller did. But now <code>fromInteger</code> and <code>(*)</code> only demand that he prove that this type is an instance of <code>Num</code> -- so he passes off the proof the caller gave him of this and saves the day! Then he chooses the <code>Integer</code> <code>3</code> for the argument to <code>fromInteger</code>, and chooses the result of this and the value the caller handed him as the two arguments to <code>(*)</code>. Everybody is satisfied, and the implementor gets to return a new value.</p>\n\n<p>The point of this whole exposition is this: the <code>Num</code> constraint in both cases is enforcing <em>exactly</em> the same thing, namely, that whatever type we choose to instantiate <code>a</code> at must be a member of the <code>Num</code> class. It's just that in the definition <code>constant = 1.0</code> being in <code>Num</code> isn't enough to do the operations we've written, whereas in <code>f x = 3*x</code> being in <code>Num</code> <em>is</em> enough to do the operations we've written. And since the operations we've chosen for the two things are so different, it should not be <em>too</em> surprising that one works and the other doesn't!</p>\n"}], "owner": {"reputation": 771, "user_id": 2852677, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b2589bf5e2ead9b3e7a39f30ae8a10f9?s=128&d=identicon&r=PG", "display_name": "gogurt", "link": "https://stackoverflow.com/users/2852677/gogurt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 1, "accepted_answer_id": 39281666, "answer_count": 3, "score": 3, "last_activity_date": 1472912883, "creation_date": 1472766810, "last_edit_date": 1472912883, "question_id": 39281442, "link": "https://stackoverflow.com/questions/39281442/polymorphism-a-constant-versus-a-function", "title": "Polymorphism: a constant versus a function", "body": "<p>I'm new to Haskell and come across a slightly puzzling example for me in the <em>Haskell Programming from First Principles</em> book. At the end of Chapter 6 it suddenly occurred to me that the following doesn't work:</p>\n\n<pre><code>constant :: (Num a) =&gt; a\nconstant = 1.0\n</code></pre>\n\n<p>However, the following works fine:</p>\n\n<pre><code>f :: (Num a) =&gt; a -&gt; a\nf x = 3*x\n</code></pre>\n\n<p>I can input any numerical value for <code>x</code> into the function <code>f</code> and nothing will break. It's not constrained to taking integers. This makes sense to me intuitively. But the example with the constant is totally confusing to me.</p>\n\n<p>Over on a reddit <a href=\"https://www.reddit.com/r/HaskellBook/comments/50kzh7/ch6_match_the_types/\" rel=\"nofollow\">thread</a> for the book it was explained (paraphrasing) that the reason why the constant example doesn't work is that the type declaration forces the value of <code>constant</code> to only be things which aren't more specific than <code>Num</code>. So trying to assign a value to it which is from a subclass of <code>Num</code> like <code>Fractional</code> isn't kosher.</p>\n\n<p>If that explanation is correct, then am I wrong in thinking that these two examples seem completely opposites of each other? In one case, the type declaration forces the value to be as general as possible. In the other case, the accepted values for the function can be <em>anything</em> that implements <code>Num</code>.</p>\n\n<p>Can anyone set me straight on this?</p>\n"}, {"tags": ["list", "haskell", "types", "io"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1472764241, "post_id": 39280904, "comment_id": 65896193, "body": "List of <code>TestField</code>."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1472764431, "post_id": 39280904, "comment_id": 65896280, "body": "Ah that makes sense. I didn&#39;t realize you could have an &#39;additional&#39; type after <code>IO</code>!"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1472764620, "post_id": 39280904, "comment_id": 65896360, "body": "It&#39;s not really additional; <code>[]</code> is a type constructor of kind <code>* -&gt; *</code> just like <code>IO</code>; it&#39;s just that you can write <code>[t]</code> instead of <code>[] t</code>."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1472815064, "post_id": 39280904, "comment_id": 65915714, "body": "if you look at <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#t:IO\" rel=\"nofollow noreferrer\">the prelude</a>, it declares <code>IO a</code> so IO has always an additional type... sometimes it&#39;s just the unit type: <code>IO ()</code>"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1472821038, "post_id": 39292954, "comment_id": 65919577, "body": "Right, though I&#39;d avoid saying <code>IO X</code> is \u201can <code>X</code> in an <code>IO</code> monad\u201d. It&#39;s actually <i>an <code>IO</code> action whose result has type <code>X</code></i>. So, if you execute that action you will get the <code>X</code> value, but that doesn&#39;t mean the action contained an <code>X</code> in the beginning. So for the given example: <code>IO [TestField]</code> is an <code>IO</code> action whose result is a list of <code>TestField</code>s."}, {"owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1472821378, "post_id": 39292954, "comment_id": 65919821, "body": "You&#39;re right, I added this information to the answer."}], "tags": [], "owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "is_accepted": true, "score": 3, "last_activity_date": 1472821360, "last_edit_date": 1472821360, "creation_date": 1472820829, "answer_id": 39292954, "question_id": 39280904, "link": "https://stackoverflow.com/questions/39280904/what-do-square-brackets-mean-in-a-type-declaration/39292954#39292954", "title": "What do square brackets mean in a type declaration?", "body": "<p>Simply put, an <code>IO [TestField]</code> is a list of <code>TestField</code>s in an <code>IO</code> monad.</p>\n\n<p>However, a more correct description is that it's an IO action whose result has type <code>[TestField]</code> (since the resulting value is obtained only after the IO is performed).</p>\n\n<p>You can learn more about those in the following sources:</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.9.0.0/System-IO.html#t:IO\" rel=\"nofollow\">Haskell Hierarchical Libraries - The IO Monad</a></p>\n\n<p><a href=\"http://learnyouahaskell.com/starting-out#an-intro-to-lists\" rel=\"nofollow\">LYAH - An intro to lists</a></p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "accepted_answer_id": 39292954, "answer_count": 1, "score": 2, "last_activity_date": 1472902803, "creation_date": 1472764212, "last_edit_date": 1472902803, "question_id": 39280904, "link": "https://stackoverflow.com/questions/39280904/what-do-square-brackets-mean-in-a-type-declaration", "title": "What do square brackets mean in a type declaration?", "body": "<p>For example:</p>\n\n<pre><code> r &lt;- query_ conn \"SELECT * from test\" :: IO [TestField]\n</code></pre>\n\n<p>What does <code>[TestField]</code> represent?</p>\n"}, {"tags": ["haskell", "types", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 760, "user_id": 6165079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f16b76fbe5a1972323696457c211571b?s=128&d=identicon&r=PG", "display_name": "Marvin Sielenkemper", "link": "https://stackoverflow.com/users/6165079/marvin-sielenkemper"}, "is_accepted": false, "score": 3, "last_activity_date": 1472756733, "last_edit_date": 1472756733, "creation_date": 1472756410, "answer_id": 39279022, "question_id": 39278622, "link": "https://stackoverflow.com/questions/39278622/why-do-these-haskell-functions-have-these-types/39279022#39279022", "title": "Why do these Haskell functions have these types?", "body": "<p><code>f3</code> is a function of two arguments and hence has a type <code>t2 -&gt; t1 -&gt; t</code>. Since the result of the function is <code>g x</code>, that has type <code>t</code>. <code>g</code> itself must be a function of one argument, taking an <code>x</code> of type <code>t1</code>, so <code>g</code> has type <code>t2</code> = <code>t1 -&gt; t</code>. The unused definition of <code>h y</code> requires <code>g</code> to accept its result type as argument type leading to <code>t1</code> = <code>t</code>. Together this results in <code>(t -&gt; t) -&gt; t -&gt; t</code>.</p>\n\n<p><code>f4</code> is again a function of two arguments and hence has a type <code>t3 -&gt; t2 -&gt; t</code>. Since it just returns <code>x</code>, <code>t2</code> has to equal <code>t</code>. The definition of <code>h y</code>\nconstrains <code>g y</code> to be of type <code>t2</code> aka <code>t</code> but places no constraint on the type of <code>y</code>, lets call that <code>t1</code>. This leads to <code>t1 -&gt; t</code> as type of <code>g</code>. Substituting the equalities then results in <code>(t1 -&gt; t) -&gt; t -&gt; t</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 2, "last_activity_date": 1472756623, "creation_date": 1472756623, "answer_id": 39279081, "question_id": 39278622, "link": "https://stackoverflow.com/questions/39278622/why-do-these-haskell-functions-have-these-types/39279081#39279081", "title": "Why do these Haskell functions have these types?", "body": "<pre><code>f3 g x = let h y = f3 g (g y) in g x\n</code></pre>\n\n<p>Let's look at a simpler version first:</p>\n\n<pre><code>f3' g x = g x\n</code></pre>\n\n<p>Here <code>g</code> is applied to <code>x</code>, and the result of <code>g</code> becomes the result of <code>f3'</code>. So the type of <code>f3'</code> is <code>(a -&gt; b) -&gt; a -&gt; b</code>.</p>\n\n<p>The full <code>f3</code> contains the subexpression <code>f3 g (g y)</code>, which introduces a few additional constraints: <code>f3 g</code> is harmless (no additional constraints because <code>g</code> is the argument we were called with in the beginning), but (as you said in your question) passing <code>g y</code> as the second argument means that the result of <code>g</code> must have the same type as <code>x</code> (the second parameter).</p>\n\n<p>This means <code>a = b</code> and therefore <code>f3 :: (a -&gt; a) -&gt; a -&gt; a</code>.</p>\n\n<hr>\n\n<p>In your second example we have</p>\n\n<pre><code>f4 g x = let h y = f4 g (g y) in x\n</code></pre>\n\n<p>Without the <code>let</code>, it's just:</p>\n\n<pre><code>f4' g x = x\n</code></pre>\n\n<p>which has the type <code>a -&gt; b -&gt; b</code>.</p>\n\n<p>The full <code>f4</code> contains <code>f4 g (g y)</code>. For one thing, this means <code>g</code> has to be a function (because it's applied to <code>y</code>), so our set of constraints looks like this:</p>\n\n<pre><code>f4 :: a -&gt; b -&gt; b\ng :: a\nx :: b\ng :: c -&gt; d\na = c -&gt; d\n</code></pre>\n\n<p>Then <code>(g y)</code> is used as the second argument to <code>f4</code>, which means its type has to be equal to <code>b</code>:</p>\n\n<pre><code>g y :: b\ng :: c -&gt; b\ny :: c\nd = b\n</code></pre>\n\n<p><code>h</code> isn't used so there are no additional constraints placed on <code>y</code> or <code>f4</code>. Substituting the variables in the type of <code>f4</code>, we get</p>\n\n<pre><code>f4 :: (c -&gt; b) -&gt; b -&gt; b\n</code></pre>\n\n<p>(which is equivalent to <code>(t1 -&gt; t) -&gt; t -&gt; t</code> modulo naming).</p>\n"}], "owner": {"reputation": 39, "user_id": 6784643, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-SF_zXigLtJY/AAAAAAAAAAI/AAAAAAAAACE/0aqrtMiNvHg/photo.jpg?sz=128", "display_name": "Andrei Petrescu", "link": "https://stackoverflow.com/users/6784643/andrei-petrescu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1472756733, "creation_date": 1472754752, "question_id": 39278622, "link": "https://stackoverflow.com/questions/39278622/why-do-these-haskell-functions-have-these-types", "title": "Why do these Haskell functions have these types?", "body": "<p>Can someone explain why these 2 functions have these types? I think I get that the first one should force the return value of g to be the same type like x because of the position of (g y) in the let corresponding to the position of x in the parameters of the function, but it seems that in the second function it does not work like that.</p>\n\n<pre><code>f3 g x = let h y = f3 g (g y) in g x  \n(t -&gt; t) -&gt; t -&gt; t  \nf4 g x = let h y = f4 g (g y) in x  \n(t1 -&gt; t) -&gt; t -&gt; t\n</code></pre>\n"}, {"tags": ["haskell", "haskell-snap-framework", "heist"], "comments": [{"owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "edited": false, "score": 0, "creation_date": 1472780841, "post_id": 39278102, "comment_id": 65900780, "body": "I thought that using an underscore in front of the name, e.g. &quot;_nav&quot; prevented it from being served like that, because that&#39;s the convention in the codebases I&#39;ve worked with -- but I was wrong! <code>heistServe</code> still serves those templates. I believe you could write your own <code>heistServe</code> that acted that way, though. I&#39;m very curious and will let you know if I figure out a solution!"}], "answers": [{"tags": [], "owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "is_accepted": false, "score": 0, "last_activity_date": 1478762221, "creation_date": 1478762221, "answer_id": 40521897, "question_id": 39278102, "link": "https://stackoverflow.com/questions/39278102/how-to-use-snap-heist-without-creating-routes-automatically-for-every-template/40521897#40521897", "title": "How to use Snap/Heist without creating routes automatically for every template", "body": "<p>Like Libby said, the intended solution is to prefix template names with an underscore to make them not served.  I'm not sure what she's seeing with it actually serving those templates.  This line of code does the check:</p>\n\n<p><a href=\"https://github.com/snapframework/snap/blob/master/src/Snap/Snaplet/HeistNoClass.hs#L320\" rel=\"nofollow noreferrer\">https://github.com/snapframework/snap/blob/master/src/Snap/Snaplet/HeistNoClass.hs#L320</a></p>\n\n<p>If this isn't working, then please file a bug with a way for me to reproduce the problem.</p>\n\n<p>The second approach that can be used is to call <code>heistInit'</code> os <code>heistServe</code> doesn't get added for you implicitly.  This should have no impact on whether you can see the templates using <code>&lt;apply&gt;</code> because it does not go through a route to retrieve a template.  I suspect if you were having trouble there it might be because you used emptyHeistConfig and then didn't set the scTemplateLocations field (<a href=\"http://hackage.haskell.org/package/heist-1.0.1.0/docs/Heist-Internal-Types.html#v:_scTemplateLocations\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/heist-1.0.1.0/docs/Heist-Internal-Types.html#v:_scTemplateLocations</a>).</p>\n"}], "owner": {"reputation": 89, "user_id": 1575106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/785c0f278e8d47099aab250db751a56e?s=128&d=identicon&r=PG", "display_name": "scottmsul", "link": "https://stackoverflow.com/users/1575106/scottmsul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1478762221, "creation_date": 1472752766, "question_id": 39278102, "link": "https://stackoverflow.com/questions/39278102/how-to-use-snap-heist-without-creating-routes-automatically-for-every-template", "title": "How to use Snap/Heist without creating routes automatically for every template", "body": "<p>Is it possible to use Snap/Heist in such a way that not every template has an auto-generated route? For example, suppose I have a template called \"outline\" with an <code>&lt;apply-content/&gt;</code> tag, and a template called \"index\" which calls <code>&lt;apply template=\"outline\"&gt;</code>. I want the \"index\" template to be visible under the route \"/\", and the \"outline\" template to not have a route. I've tried the following:</p>\n\n<ul>\n<li><p>Calling <code>heistInit</code> and putting both <code>index.tpl</code> and <code>outline.tpl</code> in the <code>templates</code> directory. This automatically creates a route for \"outline\".</p></li>\n<li><p>Putting <code>outline.tpl</code> in a separate directory and calling <code>addTemplatesAt</code>. This also automatically creates a route for <code>outline</code>.</p></li>\n<li><p>Calling <code>heistInit'</code> instead of <code>heistInit</code>, with an empty Config, as follows:</p>\n\n<pre><code>h &lt;- nestSnaplet \"\" heist $ heistInit' \"templates (Heist.emptyHeistConfig { Heist.Internal.Types._hcNamespace = \"\" })\n</code></pre></li>\n</ul>\n\n<p>Doing the last way means I have to add the routes by hand, which is ok. But even though I could serve the templates using <code>render</code> or <code>heistServeSingle</code>, the templates could not see each other when using <code>&lt;apply&gt;</code>.</p>\n\n<p>I know this feels like only a \"minor\" issue, I could just let the helper-templates be visible, but to me that feels sloppy. I was curious to see if <a href=\"http://snapframework.com\" rel=\"nofollow\">http://snapframework.com</a> did something to get around this, but it appears they left their helper templates visible, for example: <a href=\"http://snapframework.com/nav\" rel=\"nofollow\">http://snapframework.com/nav</a></p>\n"}, {"tags": ["haskell", "template-haskell", "type-families", "deriving"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1472743915, "post_id": 39275603, "comment_id": 65885825, "body": "What version of GHC are you using? Your snippet works fine (with only two warnings) on my GHC 8.0."}, {"owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1472744311, "post_id": 39275603, "comment_id": 65886094, "body": "Welp, that did it. Turns out this isn&#39;t an issue provided I&#39;m using GHC 8."}], "owner": {"reputation": 681, "user_id": 3961879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/pidYM.jpg?s=128&g=1", "display_name": "carpemb", "link": "https://stackoverflow.com/users/3961879/carpemb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 589, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1472743764, "creation_date": 1472743764, "last_edit_date": 1495535348, "question_id": 39275603, "link": "https://stackoverflow.com/questions/39275603/automatically-derive-unbox-for-newtype-without-th", "title": "Automatically derive Unbox for newtype without TH", "body": "<p>So I've got a pretty basic newtype:</p>\n\n<pre><code>newtype SomeID = SomeID Word64 deriving (Show,Eq)\n</code></pre>\n\n<p>And I would like to use this type in an unboxed vector, but on first inspection this seems to be more complicated than deriving...say...<code>Storable</code>. And when I say \"deriving\", I'm ideally hoping for automatic derivation via <code>GeneralizedNewtypeDeriving</code> When I look at the derivation of the default types by the <code>vector</code> library, <a href=\"http://hackage.haskell.org/package/vector-0.9.1/docs/src/Data-Vector-Unboxed-Base.html#Unbox\" rel=\"nofollow noreferrer\">I see this</a>.</p>\n\n<p>Furthermore, when searching the web, I ran across <a href=\"https://stackoverflow.com/questions/11399143/automatic-derivation-of-data-vector-unbox-with-associated-type-synonyms\">this SO post</a> that was suggesting using <code>Template Haskell</code> to solve the problem. I'm currently not using TH and it would be nice to not to be forced down that road.</p>\n\n<p>All I'm trying to do here is have an otherwise unboxable data type that happens to be semantically orthogonal to that original type because I want to use a smart constructor in my API. <strong>Is there any way to make this type unboxable without resorting to <code>Template Haskell</code> or a ton of boiler plate?</strong> This seems like something that could be generically derived given <code>newtype</code> will just be erased at compile time. Ideally, I would like to just do this:</p>\n\n<pre><code>{-# LANGUAGE DeriveAnyClass #-}\n\nimport qualified Data.Vector.Generic.Mutable as M\nimport qualified Data.Vector.Generic as G\nimport Data.Vector.Unboxed\nimport Data.Word\n\nnewtype SomeID = SomeID Word64 deriving (Show,Eq,Unbox,M.MVector MVector,G.Vector Vector)\n</code></pre>\n\n<p>Right now, when I try to automatically derive using the method above, I get this error:</p>\n\n<pre><code>Var/Type length mismatch: \n  [a_a3zv]\n  []\nVar/Type length mismatch: \n  [a_a3zv]\n  []\nVar/Type length mismatch: \n  [a_a3zS]\n  []\nVar/Type length mismatch: \n  [a_a3zS]\n  []\n\n/home/oldmanmike/so-question/Main.hs:14:50:\n    No instance for (G.Vector Vector SomeID)\n      arising from the 'deriving' clause of a data type declaration\n    Possible fix:\n      use a standalone 'deriving instance' declaration,\n        so you can specify the instance context yourself\n    When deriving the instance for (Unbox SomeID)\n\n/home/oldmanmike/so-question/Main.hs:14:56:\n    No instance for (M.MVector Word64)\n      arising from the first field of \u2018SomeID\u2019 (type \u2018Word64\u2019)\n    Possible fix:\n      use a standalone 'deriving instance' declaration,\n        so you can specify the instance context yourself\n    When deriving the instance for (M.MVector SomeID)\n\n/home/oldmanmike/so-question/Main.hs:14:75:\n    No instance for (G.Vector Word64)\n      arising from the first field of \u2018SomeID\u2019 (type \u2018Word64\u2019)\n    Possible fix:\n      use a standalone 'deriving instance' declaration,\n        so you can specify the instance context yourself\n    When deriving the instance for (G.Vector SomeID)\n</code></pre>\n\n<p>If I use <code>GeneralizedNewtypeDeriving</code> instead of <code>DeriveAnyClass</code>, I get a much longer error message about type family roles, which I'm assuming has historically been the issue with making this technique a reality. Has anything changed?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1472744968, "post_id": 39275136, "comment_id": 65886555, "body": "It is not entirely clear what you expect from getLine. Do you want be non-blocking? That is, always return immediately whether the user has typed anything or not?"}, {"owner": {"reputation": 23, "user_id": 6740944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d191d4a2efe0c97547239c478948fb9?s=128&d=identicon&r=PG&f=1", "display_name": "user5284493238", "link": "https://stackoverflow.com/users/6740944/user5284493238"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1472745825, "post_id": 39275136, "comment_id": 65887068, "body": "Yes, I wanted it to return empty line immediately if the user hasn&#39;t typed anything."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1472746398, "post_id": 39275136, "comment_id": 65887394, "body": "This is not how standard input/output works in any language. Haskell is no exception. If it worked like you want it would be rather impossible to write a program that interacts with a user in the normal fashion (get some input, process it, print output)."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6740944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d191d4a2efe0c97547239c478948fb9?s=128&d=identicon&r=PG&f=1", "display_name": "user5284493238", "link": "https://stackoverflow.com/users/6740944/user5284493238"}, "edited": false, "score": 0, "creation_date": 1472745332, "post_id": 39275783, "comment_id": 65886778, "body": "Sorry I wasn&#39;t clear, in this case I want my program to enter a loop which increments a counter every time it runs and I want my loop to run whether or not I provide input. I want my program to display the current count when I give it an input. So I expect an output along the lines of 10^7 after a few moments, not 1."}], "tags": [], "owner": {"reputation": 21248, "user_id": 223274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a6aad3c8269beb376b3e2b0bd29bec4?s=128&d=identicon&r=PG", "display_name": "Ian Henry", "link": "https://stackoverflow.com/users/223274/ian-henry"}, "is_accepted": false, "score": 0, "last_activity_date": 1472744393, "creation_date": 1472744393, "answer_id": 39275783, "question_id": 39275136, "link": "https://stackoverflow.com/questions/39275136/how-to-make-a-haskell-program-display-a-preliminary-result-in-response-to-user-i/39275783#39275783", "title": "How to make a Haskell program display a preliminary result in response to user input?", "body": "<p>It does return an empty line if you hit enter without entering text -- you just immediately prompt for more input, so it might look like nothing is happening. But if you run the program, hit enter three times, then enter something non-empty, you'll see that the final <code>count</code> reflects the multiple entries.</p>\n\n<p>Here's a modified version of your code that does the same thing, but is slightly more canonical:</p>\n\n<pre><code>main = mainhelper 0\n\nmainhelper count = do\n  let count' = count + 1\n  line &lt;- getLine\n  if null line\n    then mainhelper count'\n    else print count'\n</code></pre>\n\n<p>Rather than <code>count &lt;- return (count + 1)</code>, you can write <code>let count' = count + 1</code> -- this is a pure binding, not something that needs to invoke the <code>IO</code> monad (as you're doing with <code>&lt;-</code> and <code>return</code>). But I used <code>count'</code> instead of <code>count</code> because otherwise that will create a recursive binding. The <code>'</code>-suffixing is a standard idiom for a \"modified version\" of an identifier.</p>\n\n<p>Next I switched <code>putStrLn . show</code> to <code>print</code>, which is part of the <code>Prelude</code> and does exactly that.</p>\n\n<p>I got rid of the <code>return ()</code> because <code>print</code> (and <code>putStrLn</code>) already have the type <code>IO ()</code>. This allows you to elide the <code>do</code> statements, as there's now a single <code>IO</code> expression in each branch of the <code>if</code>.</p>\n\n<hr>\n\n<p>It's not really clear what you're trying to do here that's different from what you are doing -- the code does (in imperative terms) increment a counter every time the user presses enter, and displays the state of the counter every time the user enters some non-empty text.</p>\n\n<p>Here's another version that prints the counter every time, but only increments it when prompted, which may or may not be helpful to you:</p>\n\n<pre><code>main = mainhelper 0\n\nmainhelper count = do\n  print count\n  line &lt;- getLine\n  mainhelper (if null line then count else succ count)\n</code></pre>\n\n<p>I'm using <code>succ</code>, the successor function, instead of the explicit <code>+ 1</code>, which is just a style preference.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1472745106, "post_id": 39275837, "comment_id": 65886648, "body": "I guess it&#39;s worth noting that when the user requests the current value in this version, it waits until the <i>next</i> iteration finishes before printing. It&#39;s not hard to change, but slightly less modular, and not difficult once you have the idea to use multiple threads."}, {"owner": {"reputation": 23, "user_id": 6740944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d191d4a2efe0c97547239c478948fb9?s=128&d=identicon&r=PG&f=1", "display_name": "user5284493238", "link": "https://stackoverflow.com/users/6740944/user5284493238"}, "edited": false, "score": 0, "creation_date": 1472745951, "post_id": 39275837, "comment_id": 65887161, "body": "Thank you! This works as hoped, now time for me to go read up on the relevant modules."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1472749381, "last_edit_date": 1472749381, "creation_date": 1472744528, "answer_id": 39275837, "question_id": 39275136, "link": "https://stackoverflow.com/questions/39275136/how-to-make-a-haskell-program-display-a-preliminary-result-in-response-to-user-i/39275837#39275837", "title": "How to make a Haskell program display a preliminary result in response to user input?", "body": "<p>One simple solution is to fork a thread for the complicated computation and communicate with the main UI thread via <code>MVar</code>. For example:</p>\n\n<pre><code>import Control.Exception\nimport Control.Monad\nimport Control.Concurrent\n\nthinkReallyHard x = do\n    threadDelay 1000000 -- as a proxy for something that's actually difficult\n    evaluate (x+1)\n\nmain = do\n    v &lt;- newMVar 0\n    forkIO (forever (modifyMVar_ v thinkReallyHard))\n    forever (getLine &gt;&gt; readMVar v &gt;&gt;= print)\n</code></pre>\n\n<p>You may wonder about the role of <code>evaluate</code> in <code>thinkReallyHard</code>. The subtlety there is that <code>MVar</code>s are lazy -- they can contain thunks just as easily as computed values. In particular, this means it's easy to accidentally push all the pure computation from the forked thread into the thread that's reading and using the contents of the <code>MVar</code>. The call to <code>evaluate</code> simply forces the forked thread to finish the pure computation before writing to the <code>MVar</code>.</p>\n"}], "owner": {"reputation": 23, "user_id": 6740944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d191d4a2efe0c97547239c478948fb9?s=128&d=identicon&r=PG&f=1", "display_name": "user5284493238", "link": "https://stackoverflow.com/users/6740944/user5284493238"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 39275837, "answer_count": 2, "score": 2, "last_activity_date": 1472749381, "creation_date": 1472742448, "question_id": 39275136, "link": "https://stackoverflow.com/questions/39275136/how-to-make-a-haskell-program-display-a-preliminary-result-in-response-to-user-i", "title": "How to make a Haskell program display a preliminary result in response to user input?", "body": "<p>I am writing a program in Haskell which repeatedly takes its most recent result and uses this to compute the next result. I want to be able to see the newest result in response to user input, so I tried something like this:</p>\n\n<pre><code>main = mainhelper 0\n\nmainhelper count = do\n count &lt;- return (count + 1)\n line &lt;- getLine\n if null line\n  then do mainhelper count\n  else do\n   putStrLn $ show count\n   return ()\n</code></pre>\n\n<p>I was hoping that getLine would return an empty line if the user hasn't entered anything, but this doesn't happen, instead the program does nothing until it receives user input. Is there a way around this?</p>\n"}, {"tags": ["haskell", "printing", "int", "format"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1472739822, "post_id": 39274043, "comment_id": 65882880, "body": "<i>Don&#39;t</i> ever calculate nCr this way. It&#39;s horribly inefficient, as the factorial generates huge terms which for the result will cancel anyway (which is the only reason why you get theoretically integral result from the formula). The right way is to multiply up only the non-cancelling terms, and not divide anything at all; then you also don&#39;t need to worry about floating-point."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1472746333, "post_id": 39274043, "comment_id": 65887363, "body": "@leftaroundabout, why don&#39;t you make that an answer?"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1472741096, "post_id": 39274151, "comment_id": 65883850, "body": "With that factorial formula, you <i>must</i> use <code>Integer</code> even when you only expect rather small inputs."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 10, "last_activity_date": 1473204622, "last_edit_date": 1495541703, "creation_date": 1472739778, "answer_id": 39274151, "question_id": 39274043, "link": "https://stackoverflow.com/questions/39274043/format-float-as-int-when-printing-in-haskell/39274151#39274151", "title": "Format Float as Int when printing in Haskell", "body": "<p>By using the <code>/</code> operation, you are asking haskell to use a fractional data type. You probably don't want that in this case. It is preferable to use an integral type such as <code>Int</code> or <code>Integer</code>. So I suggest to do the following:\n 1. Add a type declaration for the <code>fact</code> function, something like <code>fact :: Integer -&gt; Integer</code>\n 2. Use <code>quot</code> instead of <code>/</code>.</p>\n\n<p>So your code should look like this:</p>\n\n<pre><code>fact :: Integer -&gt; Integer\nfact 0 = 1\nfact x = x * fact (x-1)\n\nplace :: Integer -&gt; Integer -&gt; Integer\nplace m n = (fact m) `quot` (fact n) * (fact (m-n))\n\nmain = do   \n   print (place 0 0)\n</code></pre>\n\n<p>Also, as <a href=\"https://stackoverflow.com/users/745903/leftaroundabout\">@leftaroundabout</a> pointed out, you probably want to use a better algorithm for computing those binomial numbers.</p>\n"}, {"tags": [], "owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "is_accepted": false, "score": 2, "last_activity_date": 1472741331, "last_edit_date": 1472741331, "creation_date": 1472740939, "answer_id": 39274568, "question_id": 39274043, "link": "https://stackoverflow.com/questions/39274043/format-float-as-int-when-printing-in-haskell/39274568#39274568", "title": "Format Float as Int when printing in Haskell", "body": "<p>You could just use <code>round</code>:</p>\n\n<p><code>print (round $ place 0 0)</code></p>\n\n<p>This changes the formatting to the one you want. redneb's answer is, however, the right approach.</p>\n"}], "owner": {"reputation": 135, "user_id": 2233712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/AmxEu.jpg?s=128&g=1", "display_name": "Richard Hayes", "link": "https://stackoverflow.com/users/2233712/richard-hayes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 0, "accepted_answer_id": 39274151, "answer_count": 2, "score": 6, "last_activity_date": 1473204622, "creation_date": 1472739540, "question_id": 39274043, "link": "https://stackoverflow.com/questions/39274043/format-float-as-int-when-printing-in-haskell", "title": "Format Float as Int when printing in Haskell", "body": "<p>This Haskell program prints \"1.0\" How can I get it to print \"1\"? </p>\n\n<pre><code>fact 0 = 1\nfact x = x * fact (x-1)\n\nplace m n = (fact m) / (fact n) * (fact (m-n))\n\nmain = do   \n   print (place 0 0)\n</code></pre>\n"}, {"tags": ["haskell", "continuation", "operational"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1472738507, "post_id": 39271579, "comment_id": 65881848, "body": "Not like that, I don&#39;t think (although it&#39;s possible that some GHC specials for distributed computing may be able to do it&amp;mdash;I&#39;ve never dug into those). The best standard approach is probably to trade the convenience and generality of Haskell&#39;s <code>Monad</code> class for your own custom version that represents functions in some abstract language you can interpret."}], "answers": [{"tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 5, "last_activity_date": 1472755698, "last_edit_date": 1495541785, "creation_date": 1472755698, "answer_id": 39278838, "question_id": 39271579, "link": "https://stackoverflow.com/questions/39271579/is-it-possible-to-store-haskell-operational-or-free-monad-continuation-to-di/39278838#39278838", "title": "Is it possible to store haskell &quot;operational&quot; or &quot;free monad&quot; continuation to disk?", "body": "<p>As I see it, there are two problems:</p>\n\n<ul>\n<li><p>continuations can contain arbitrary data types</p></li>\n<li><p>continuations can contain functions (ie closures)</p></li>\n</ul>\n\n<p>Especially given the second constraint, there's probably no <em>easy</em> way to do <em>exactly</em> what you want.</p>\n\n<p>The discussion on <a href=\"https://stackoverflow.com/questions/17785916/can-haskell-functions-be-serialized\">Can Haskell functions be serialized?</a> points to a library called <a href=\"https://github.com/jberthold/packman\" rel=\"nofollow noreferrer\">packman</a>. From the Readme:</p>\n\n<blockquote>\n  <p>...the functionality can be used to optimise programs by memoisation (across different program runs), and to checkpoint program execution in selected places. Both uses are exemplified in the slide set linked above.</p>\n</blockquote>\n\n<p>(<a href=\"http://www.mathematik.uni-marburg.de/~eden/\" rel=\"nofollow noreferrer\">The slides</a> it mentions, I think.)</p>\n\n<p>The limitation of this approach is that not <em>all</em> types of data can (or should!) be serialized, notably mutable types like <code>IORef</code>, <code>MVar</code> and STM-related types, and sometimes these end up in thunks and closures leading to runtime exceptions.</p>\n\n<p>Additionally, the library relies on the serialized continuation being taken up <em>by the same binary that created it</em> which may or may not be a real problem for your application.</p>\n\n<p>So you can either get more or less what you want with a slightly limited and complex approach like <code>packman</code> or you can write your own custom logic that serializes to and from a custom type that captures all the information you care about.</p>\n"}], "owner": {"reputation": 103, "user_id": 6778076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7de80b77a7d363686874f792cb7722bd?s=128&d=identicon&r=PG&f=1", "display_name": "Zoran Bo\u0161njak", "link": "https://stackoverflow.com/users/6778076/zoran-bo%c5%a1njak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 4, "accepted_answer_id": 39278838, "answer_count": 1, "score": 10, "last_activity_date": 1472755698, "creation_date": 1472732831, "question_id": 39271579, "link": "https://stackoverflow.com/questions/39271579/is-it-possible-to-store-haskell-operational-or-free-monad-continuation-to-di", "title": "Is it possible to store haskell &quot;operational&quot; or &quot;free monad&quot; continuation to disk?", "body": "<p>I have some simple primitive operations, for example:</p>\n\n<p>In case of <a href=\"https://hackage.haskell.org/package/operational\" rel=\"noreferrer\">operational</a> monad:</p>\n\n<pre><code>import Control.Monad.Operational\ntype Process a = Program ProcessI a\ndata ProcessI a where\n    GetInput :: ProcessI String\n    Dump :: String -&gt; ProcessI ()\ngetInput :: Process String\ngetInput = singleton GetInput\ndump :: String -&gt; Process ()\ndump = singleton . Dump\n</code></pre>\n\n<p>Or in case of <a href=\"http://hackage.haskell.org/package/free\" rel=\"noreferrer\">free</a> monad:</p>\n\n<pre><code>import Control.Monad.Free\ntype Process = Free ProcessF\ndata ProcessF a\n    = GetInput (String -&gt; a)\n    | Dump String a\n    deriving (Functor)\ngetInput :: Process String\ngetInput = liftF $ GetInput id\ndump :: String -&gt; Process ()\ndump s = liftF $ Dump s ()\n</code></pre>\n\n<p>Simple action is the same in both cases, for example:</p>\n\n<pre><code>proc1 :: Process ()\nproc1 = forever $ do\n    a &lt;- getInput\n    b &lt;- getInput\n    dump $ a ++ b\n    dump $ b ++ a\n</code></pre>\n\n<p><strong>My question is</strong>: Is it possible to interpret the process (proc1) in such a way that a continuation in certain step is serialized to disk, then restored during the next program execution? Could you please give an example?</p>\n\n<p>If it's not possible, what would be the closest workaround?</p>\n\n<p>I would like to start the program only when the next input is available, apply the continuation the the input, then interpret until next \"getInput\" and exit.</p>\n\n<p>I could imagine the scenario to log all inputs, then replay them to get the system to the same state before proceeding, but in this case, the log would grow without limit. I could not find any way to campact the log in the interpreter since there is no possibility to compare continuations (no EQ instance) and the process is infinite.</p>\n"}, {"tags": ["haskell", "height", "width", "screen", "gloss"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 3, "last_activity_date": 1472758019, "last_edit_date": 1472758019, "creation_date": 1472737986, "answer_id": 39273419, "question_id": 39268746, "link": "https://stackoverflow.com/questions/39268746/function-for-getting-window-width-and-height-with-haskell-gloss/39273419#39273419", "title": "function for getting window width and height with haskell gloss", "body": "<p>I don't think gloss itself exports this capability, but you can use these calls from the GLFW package to determine the screen resolution:</p>\n\n<pre><code>import Graphics.UI.GLFW\n\nmain = do\n  initialize\n  desktopMode &gt;&gt;= print\n  putStrLn \"all video modes:\"\n  videoModes &gt;&gt;= mapM_ print\n</code></pre>\n\n<p>Note that <code>gloss</code> may be compiled to use either GLUT or GLFW. If gloss uses GLFW as its interface to Open GL it will call GLFW's <code>initialize</code> function when you create a window, and it's possible there is an issue with calling <code>initialize</code> twice in the same process but I kinda doubt it.</p>\n\n<p>You can then use these dimensions to set the drawable area when creating a gloss window with the <a href=\"https://hackage.haskell.org/package/gloss-1.10.2.3/docs/Graphics-Gloss-Data-Display.html#t:Display\" rel=\"nofollow\"><code>FullScreen</code></a> constructor.</p>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 10631341, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MxZ6d1ysp7w/AAAAAAAAAAI/AAAAAAAAABE/2wpLgatm_eE/photo.jpg?sz=128", "display_name": "oskar zbiczynski", "link": "https://stackoverflow.com/users/10631341/oskar-zbiczynski"}, "is_accepted": false, "score": 6, "last_activity_date": 1541808690, "last_edit_date": 1541808690, "creation_date": 1541807266, "answer_id": 53234695, "question_id": 39268746, "link": "https://stackoverflow.com/questions/39268746/function-for-getting-window-width-and-height-with-haskell-gloss/53234695#53234695", "title": "function for getting window width and height with haskell gloss", "body": "<p>There is the function is in <code>Graphics.Gloss.Interface.Environment</code> called <code>getScreenSize</code> it return a <code>IO (Int,Int)</code> the first value is width, the second is height.</p>\n"}], "owner": {"reputation": 151, "user_id": 5872882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fc8fcfe6e5954b67ec74d3408e807c45?s=128&d=identicon&r=PG&f=1", "display_name": "Max K", "link": "https://stackoverflow.com/users/5872882/max-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 954, "favorite_count": 0, "accepted_answer_id": 39273419, "answer_count": 2, "score": 0, "last_activity_date": 1541808690, "creation_date": 1472724737, "question_id": 39268746, "link": "https://stackoverflow.com/questions/39268746/function-for-getting-window-width-and-height-with-haskell-gloss", "title": "function for getting window width and height with haskell gloss", "body": "<p>Is there a function, similar to JS <code>screen.width</code> and <code>screen.height</code> in Haskell with the gloss graphic library, which returns the screen width and height? </p>\n"}, {"tags": ["haskell", "phantom-types"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1472724607, "post_id": 39268552, "comment_id": 65871792, "body": "You didn&#39;t say what the problem is but try changing <code>Stream</code> to a <code>newtype</code> (instead of <code>data</code>)."}, {"owner": {"reputation": 23, "user_id": 6782679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/015183bf7a4a9c149e0e2a73ae4ed219?s=128&d=identicon&r=PG&f=1", "display_name": "ami", "link": "https://stackoverflow.com/users/6782679/ami"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1472725961, "post_id": 39268552, "comment_id": 65872699, "body": "(I updated the description of the problem) Yes, that seems to have solved the problem. Many thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6782679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/015183bf7a4a9c149e0e2a73ae4ed219?s=128&d=identicon&r=PG&f=1", "display_name": "ami", "link": "https://stackoverflow.com/users/6782679/ami"}, "edited": false, "score": 0, "creation_date": 1472743992, "post_id": 39271587, "comment_id": 65885887, "body": "Thanks chi.  Changing <code>Stream</code> from <code>data</code> to <code>newtype</code> did the trick."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1472732861, "creation_date": 1472732861, "answer_id": 39271587, "question_id": 39268552, "link": "https://stackoverflow.com/questions/39268552/phantom-types-in-haskell/39271587#39271587", "title": "Phantom Types in Haskell", "body": "<pre><code>preI :: Integer -&gt; Stream Int -&gt; Stream Int\npreI n (Stream s) = ...\n    -- ^^^^^^^^^^\n</code></pre>\n\n<p>This pattern matching forces the argument before any output is produced. For streams, this is bad, since it keeps the least fixed point at bottom (non-termination) instead of at an infinite stream.</p>\n\n<p>You can try a lazy/irrefutable pattern matching instead:</p>\n\n<pre><code>preI :: Integer -&gt; Stream Int -&gt; Stream Int\npreI n ~(Stream s) = Stream (PreI n s)\n    -- ^\n</code></pre>\n\n<p>This essentially means:</p>\n\n<pre><code>preI :: Integer -&gt; Stream Int -&gt; Stream Int\npreI n z = Stream (PreI n s)\n    where s = case z of Stream x -&gt; x\n</code></pre>\n\n<p>which first produces the <code>Stream, PreI</code> in the output, and only later on starts unwrapping its input (which happens when <code>s</code> is used).</p>\n\n<p>Or, even better, change <code>Stream</code> from being a <code>data</code> to being a <code>newtype</code>: in such way, the pattern matching will always be lazy. Indeed, using <code>newtype</code> we no longer have any wrapping at runtime, and pattern matching is actually a no-op.</p>\n"}], "owner": {"reputation": 23, "user_id": 6782679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/015183bf7a4a9c149e0e2a73ae4ed219?s=128&d=identicon&r=PG&f=1", "display_name": "ami", "link": "https://stackoverflow.com/users/6782679/ami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 0, "accepted_answer_id": 39271587, "answer_count": 1, "score": 2, "last_activity_date": 1472922056, "creation_date": 1472724255, "last_edit_date": 1472922056, "question_id": 39268552, "link": "https://stackoverflow.com/questions/39268552/phantom-types-in-haskell", "title": "Phantom Types in Haskell", "body": "<p>This is a simplified version of my problem.</p>\n\n<p>I have a recursive data structure (Stream1).  When I introduced phantom types (Stream a), a recursive description (i.e. t1) no longer works.  On the other hand, t2 works fine by creating an infinite structure, as it uses Stream1 directly.  I need to use the constructor preI, such as in t1.  What am I missing? I need t1 to behave like t2 - that is, return an infinite stream.</p>\n\n<pre><code>data Stream a = Stream Stream1\n  deriving (Eq, Show)\n\ndata Stream1 = PreI Integer Stream1\n  deriving (Eq, Show)\n\npreI :: Integer -&gt; Stream Int -&gt; Stream Int\npreI n (Stream s) = Stream (PreI n s)\n\nt1 :: Stream Int\nt1 = let x = preI 0 x\n     in x\n\nt2 :: Stream Int\nt2 = let x = PreI 0 x\n     in Stream x\n</code></pre>\n"}, {"tags": ["haskell", "types", "functional-programming", "language-design", "function-composition"], "comments": [{"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472723924, "post_id": 39267902, "comment_id": 65871355, "body": "In Haskell you could write <code>f x = ((gt 0) len x) &amp;&amp; ((lt 100) len x)</code>. Do you accept that in your language ?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1472723932, "post_id": 39267902, "comment_id": 65871362, "body": "What do you mean by \u201cno higher-order functions\u201d?"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1472724869, "post_id": 39267902, "comment_id": 65871964, "body": "@leftaroundabout no functions that take other functions as arguments."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "reply_to_user": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1472724901, "post_id": 39267902, "comment_id": 65871986, "body": "@V.Semeria thank you but no, you may not define new functions, only compose existing ones."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1472730996, "post_id": 39267902, "comment_id": 65876080, "body": "Your language already has one higher-order function: composition."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1472731671, "post_id": 39267902, "comment_id": 65876590, "body": "@chepner you are correct. the limitation is for userland code."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 7, "creation_date": 1472732195, "post_id": 39267902, "comment_id": 65876996, "body": "I believe that, with that list of primitives, you can never use an argument twice. Everything there looks strictly linear: you use it, you lose it. This is known, I think, to greatly reduce the expressive power of the language. You need some duplicator, like <code>S</code> in combinatory logic or <code>&amp;&amp;&amp;</code> in arrows. Or <code>let x = e in ...</code>."}], "answers": [{"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": true, "score": 2, "last_activity_date": 1472724148, "last_edit_date": 1495535628, "creation_date": 1472723833, "answer_id": 39268385, "question_id": 39267902, "link": "https://stackoverflow.com/questions/39267902/function-composition-in-boolean-operators/39268385#39268385", "title": "Function composition in boolean operators", "body": "<p>This is called <a href=\"https://wiki.haskell.org/Pointfree\" rel=\"nofollow noreferrer\">pointfree style</a> and there is a nice <a href=\"http://pointfree.io/\" rel=\"nofollow noreferrer\">tool</a> on the web for transforming Haskell code to it. Converting <code>f xs = (length xs &gt; 0) &amp;&amp; (length xs &lt; 100)</code> gives <code>f = ap ((&amp;&amp;) . (&gt; 0) . length) ((&lt; 100) . length)</code>. So you are just missing the <a href=\"https://downloads.haskell.org/~ghc/7.6-latest/docs/html/libraries/base-4.6.0.1/src/Control-Monad.html#ap\" rel=\"nofollow noreferrer\"><code>ap</code></a> function (see also <a href=\"https://stackoverflow.com/questions/33454650/understanding-ap-in-a-point-free-function-in-haskell\">Understanding `ap` in a point-free function in Haskell</a>). For your application it should have type <code>(a -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)</code> and be built-in along with <code>.</code>. </p>\n"}], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 489, "favorite_count": 1, "accepted_answer_id": 39268385, "answer_count": 1, "score": 0, "last_activity_date": 1472724148, "creation_date": 1472722530, "question_id": 39267902, "link": "https://stackoverflow.com/questions/39267902/function-composition-in-boolean-operators", "title": "Function composition in boolean operators", "body": "<p>I don't have much FP experience and I think I'm just missing a key insight from someone more versed. I'm writing a small, embedded, functional, strictly- and invariantly-typed language.</p>\n\n<p>I'll be using Haskell-like syntax in this question.</p>\n\n<p>The following signatures are for predefined functions with types that are what you'd expect:</p>\n\n<pre><code>and :: bool -&gt; bool -&gt; bool  -- boolean and\nlt  :: int -&gt; int -&gt; bool    -- less than\ngt  :: int -&gt; int -&gt; bool    -- greater than\nlen :: list -&gt; int           -- list length\n</code></pre>\n\n<p>My job is to compose these functions (and constants) to form an expression which has the following signature:</p>\n\n<pre><code>\u03bb :: list -&gt; bool\n</code></pre>\n\n<p>The result of which is whether a list has a length between 1 and 99.</p>\n\n<p>Constraints: This language (currently) only supports function application and function composition. No lambda expressions, no higher-order functions.</p>\n\n<p>This is how far I've gotten:</p>\n\n<pre><code>and . ((gt 0) . len) :: list -&gt; bool -&gt; bool\n</code></pre>\n\n<p>This takes a list, checks if it's length is greater than 0, then a boolean and returns the \"and\" of both arguments.</p>\n\n<p>But now I'm stuck. How would you continue from here in traditional functional languages? Is there a way to express a solution without lambdas/closures?</p>\n\n<p>I'm open to add new features to the language, as long as it remains underpowered and simple.</p>\n"}, {"tags": ["haskell", "big-o", "lazy-evaluation", "fibonacci"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1472690587, "post_id": 39261049, "comment_id": 65858011, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/3208258/memoization-in-haskell\">Memoization in Haskell?</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 5, "creation_date": 1472690980, "post_id": 39261049, "comment_id": 65858088, "body": "No, Haskell does not memoize functions. See something like <a href=\"http://stackoverflow.com/questions/11466284/how-is-this-fibonacci-function-memoized\">this</a>. Note that further complications for memoization also arise from polymorphic code (<a href=\"http://stackoverflow.com/questions/38879778/does-haskell-frege-ever-recalcuate-elements-of-a-lazy-list/38880106#38880106\">this</a> question is sort of relevant)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1472713323, "post_id": 39261049, "comment_id": 65864479, "body": "If you want that <i>function</i>, you should use exponentiation of matrices by squaring. That&#39;s considerably faster than linear time would be, even if you&#39;d achieved it."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472723973, "post_id": 39261049, "comment_id": 65871387, "body": "@dfeuer Technically that&#39;s still O(n). Sure, doing O(log n) multiplications + additions has probably smaller constants than the naive solution with n additions, but both do O(n) bit operations."}, {"owner": {"reputation": 994, "user_id": 5357260, "user_type": "registered", "accept_rate": 9, "profile_image": "https://graph.facebook.com/973030389423513/picture?type=large", "display_name": "Xiaojun Chen", "link": "https://stackoverflow.com/users/5357260/xiaojun-chen"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472725635, "post_id": 39261049, "comment_id": 65872487, "body": "@dfeuer You mean the Exercise 1.19 of SICP"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1472737207, "post_id": 39261049, "comment_id": 65880814, "body": "@Bakuriu, by that standard, the list approach isn&#39;t even linear, is it?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1472737864, "post_id": 39261049, "comment_id": 65881310, "body": "@Bakuriu, also, does your statement continue to hold if one uses extremely fancy multiplication algorithms (e.g., Fourier transform ones)?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472737945, "post_id": 39261049, "comment_id": 65881389, "body": "I don&#39;t have SICP in front of me, Xiaojun Chen, so I don&#39;t know."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1472738668, "post_id": 39261049, "comment_id": 65881997, "body": "@dfeuer The number of bits in fibonacci numbers is O(n) (they grow exponentially), that&#39;s pretty definitive regarding the lower bound complexity to compute them, that was my point."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1472738774, "post_id": 39261049, "comment_id": 65882101, "body": "@Bakuriu, right, I forgot just how fast they go. Are you sure the naive approach of doing <code>n</code> additions is O(n)?"}], "answers": [{"tags": [], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "is_accepted": false, "score": 3, "last_activity_date": 1472716698, "creation_date": 1472716698, "answer_id": 39265861, "question_id": 39261049, "link": "https://stackoverflow.com/questions/39261049/is-following-fibonacci-function-on-in-haskell/39265861#39265861", "title": "Is following Fibonacci function O(n) in Haskell", "body": "<p><code>Debug.Trace</code> can give the number of times <code>fib</code> is called :</p>\n\n<pre><code>import Debug.Trace\n\nfib :: Int -&gt; Int\nfib n = trace \"CALL\" $ case n of\n  0 -&gt; 0\n  1 -&gt; 1\n  _ -&gt; fib (n-1) + fib (n-2)\n</code></pre>\n\n<p>For <code>fib 5</code>, it prints CALL 15 times, so it's not O(n).</p>\n"}], "owner": {"reputation": 994, "user_id": 5357260, "user_type": "registered", "accept_rate": 9, "profile_image": "https://graph.facebook.com/973030389423513/picture?type=large", "display_name": "Xiaojun Chen", "link": "https://stackoverflow.com/users/5357260/xiaojun-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1472923603, "creation_date": 1472690236, "last_edit_date": 1472923603, "question_id": 39261049, "link": "https://stackoverflow.com/questions/39261049/is-following-fibonacci-function-on-in-haskell", "title": "Is following Fibonacci function O(n) in Haskell", "body": "<p>As I learnt in SICP, tree recursion's complexity grows exponentially with n. If in Haskell I wrote like,</p>\n\n<pre><code>fib n | n &lt;= 1 = n\n      | otherwise = fib (n-1) + fib (n-2)\n</code></pre>\n\n<p>Is it true that, since Haskell is lazy, it calculate <code>fib 1</code>, <code>fib 2</code>... all once, so the complexity is linear with n?</p>\n"}]