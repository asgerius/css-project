[{"tags": ["haskell", "frp", "netwire"], "comments": [{"owner": {"reputation": 1932, "user_id": 1784267, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/172e98db79964f9e6e4969e9f4afc452?s=128&d=identicon&r=PG", "display_name": "phaazon", "link": "https://stackoverflow.com/users/1784267/phaazon"}, "edited": false, "score": 0, "creation_date": 1424435653, "post_id": 28595783, "comment_id": 45558401, "body": "I tend not to use effects in my wires. Events are passed to the \u201cmain wire\u201d, while the monad is left polymorphic."}], "answers": [{"comments": [{"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "edited": false, "score": 0, "creation_date": 1443565524, "post_id": 28924645, "comment_id": 53543193, "body": "I think my answers of <a href=\"http://stackoverflow.com/questions/32745934/kleisli-arrow-in-netwire-5\" title=\"kleisli arrow in netwire 5\">stackoverflow.com/questions/32745934/kleisli-arrow-in-netwir&zwnj;&#8203;e-5</a> and <a href=\"http://stackoverflow.com/questions/30992299/console-interactivity-in-netwire\" title=\"console interactivity in netwire\">stackoverflow.com/questions/30992299/&hellip;</a> also helps"}], "tags": [], "owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "is_accepted": true, "score": 1, "last_activity_date": 1425804381, "last_edit_date": 1495540702, "creation_date": 1425804381, "answer_id": 28924645, "question_id": 28595783, "link": "https://stackoverflow.com/questions/28595783/correct-use-of-netwire-5/28924645#28924645", "title": "Correct use of Netwire (5)", "body": "<p>At the very top level of your program, you're going to have some wire that has (abbreviated) type <code>Wire a b</code>. This is going to need to be passed something of type <code>a</code> and it will return something of type <code>b</code> every time you take a step. For example, both <code>a</code> and <code>b</code> can be some <code>WorldState</code> for a game or maybe <code>[RigidBody]</code> for a physics simulator. In my opinion, it's OK to pass <code>Right undefined</code> at the top level.</p>\n\n<p>That being said, you're ignoring the important <code>Alternative</code> instance of <code>Wire a b</code> for the input wires. It provides an operator <code>&lt;|&gt;</code> that works in a very nice way:</p>\n\n<p>Suppose we have two wires:</p>\n\n<pre><code>w1 :: Wire a b\nw2 :: Wire a b\n</code></pre>\n\n<p>If w1 inhibits, then</p>\n\n<pre><code>w1 &lt;|&gt; w2 == w2\n</code></pre>\n\n<p>If w1 doesn't inhibit, then</p>\n\n<pre><code>w1 &lt;|&gt; w2 == w1\n</code></pre>\n\n<p>This means that <code>w1 &lt;|&gt; w2</code> will only inhibit if <em>both</em> <code>w1</code> and <code>w2</code> inhibit. This is great, this means that we can do things like:</p>\n\n<pre><code>spin :: (HasTime t s, Monad m) =&gt; Wire s e m a GL.GLfloat\nspin = integral 0 . (10 . keyPressed GLFW.Key'F &lt;|&gt; 5)\n</code></pre>\n\n<p>When you press <code>F</code>, you will spin twice as fast!</p>\n\n<p>If you want to change the semantics of a wire after pressing a button, you have to be a bit more creative, but not much. If your wire behaves differently, it means you're doing some sort of switch. The <a href=\"https://hackage.haskell.org/package/netwire-5.0.1/docs/Control-Wire-Switch.html\" rel=\"nofollow noreferrer\">documentation for switches</a> mostly requires you to <a href=\"https://stackoverflow.com/questions/25376120/confused-about-diagrams-of-yampa-switches/25396338#25396338\">follow the types</a>.</p>\n\n<p>Here's a wire that will act like the identity wire until you press the given key, and will then inhibit forever:</p>\n\n<pre><code>trigger :: GLFW.Key -&gt; GameWire a a\ntrigger key =\n  rSwitch mkId . (mkId &amp;&amp;&amp; ((now . pure mkEmpty . keyPressed key) &lt;|&gt; never))\n</code></pre>\n\n<p>With this you can do cool things like:</p>\n\n<pre><code>spin :: (HasTime t s, Monad m) =&gt; Wire s e m a GL.GLfloat\nspin = integral 0 . spinSpeed\n  where\n    spinSpeed = 5 . trigger GLFW.Key'F --&gt; \n                -5 . trigger GLFW.Key'F --&gt;\n                spinSpeed\n</code></pre>\n\n<p>This will toggle the spinner between going forwards and backwards whenever you hit <code>F</code>.</p>\n"}], "owner": {"reputation": 667, "user_id": 1004609, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3761bec22a1edb645f7cf0a94abd658?s=128&d=identicon&r=PG", "display_name": "danielpwright", "link": "https://stackoverflow.com/users/1004609/danielpwright"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 2, "accepted_answer_id": 28924645, "answer_count": 1, "score": 5, "last_activity_date": 1425804381, "creation_date": 1424301149, "last_edit_date": 1424306311, "question_id": 28595783, "link": "https://stackoverflow.com/questions/28595783/correct-use-of-netwire-5", "title": "Correct use of Netwire (5)", "body": "<p>I've been wanting to give FRP a shot for a while now, and yesterday I finally bit the bullet and had a go, using Netwire 5 to begin with (a fairly arbitrary choice in itself, but I have to start somewhere!).  I've managed to get to the point of \"code which works\" but I've noticed a couple of patterns which I'm not sure are part of how the library is expected to be used or whether they are a symptom that I'm doing something wrong somewhere.</p>\n\n<p>I started with <a href=\"http://todayincode.tumblr.com/post/96914679355/almost-a-netwire-5-tutorial\" rel=\"noreferrer\">this tutorial</a>, which was enough to get me up and running pretty easily -- I now have a spinning cube controlled by a simple \"incrementing number\" wire:</p>\n\n<pre><code>spin :: (HasTime t s, Monad m) =&gt; Wire s e m a GL.GLfloat\nspin = integral 0 . 5\n</code></pre>\n\n<p>and the application will quit when \"Esc\" is pressed, making use of the wires supplied in <a href=\"https://hackage.haskell.org/package/netwire-input-glfw\" rel=\"noreferrer\">netwire-input-glfw</a>:</p>\n\n<pre><code>shouldQuit :: (Monoid e, Functor m, Monad m) =&gt; Wire s e (GLFWInputT m) a a\nshouldQuit = keyPressed GLFW.Key'Escape\n</code></pre>\n\n<p>An important distinction between these is that <code>spin</code> never inhibits -- it should always return some value -- while <code>shouldQuit</code> inhibits all the time; until the key is actually pressed in which case I quit the application.</p>\n\n<p>The thing that makes me uneasy is the way I end up having to use these wires.  Right now, it looks something like this:</p>\n\n<pre><code>(wt', spinWire') &lt;- stepWire spinWire st $ Right undefined\n((qt', quitWire'), inp'') &lt;- runStateT (stepWire quitWire st $ Right undefined) inp'\n\ncase (qt', wt') of\n  (Right _, _) -&gt; return ()\n  (_, Left _)  -&gt; return () -- ???\n  (_, Right x) -&gt; --do things, render, recurse into next frame\n</code></pre>\n\n<p>There are two things about this pattern that make me feel uncomfortable.  First, the fact that I pass <code>Right undefined</code> to both calls to <code>stepWire</code>.  I think (if my understanding is correct) that this parameter is for sending events to a wire, and that since my wires don't make any use of events this is \"safe\", but it feels bad (<strong>EDIT</strong> maybe \"events\" is the wrong word here -- the tutorial describes it as for \"blocking values\", but the point still stands -- I never intend to block and don't make use of the <code>e</code> parameter anywhere in my wire).  I looked to see if there was a version of <code>stepWire</code> for the situation where you know you never have an event and you wouldn't respond to it even if you did have one, but couldn't see one.  I tried making the wires <code>e</code> parameter <code>()</code> and then passing <code>Right ()</code> everywhere, which feels marginally less dirty than <code>undefined</code>, but still doesn't quite seem to represent my intent.</p>\n\n<p>Similarly, the return value is also an <code>Either</code>.  That's perfect for the <code>shouldQuit</code> wire, but notice I have to pattern match on <code>wt'</code>, the output of the <code>spin</code> wire.  I really don't know what it would mean for that to inhibit, so I just <code>return ()</code>, but I can imagine this getting unwieldy as the number of wires increases, and again, it just doesn't seem that representative of my intent -- to have a wire which never inhibits and which I can rely upon always to hold the next value.</p>\n\n<p>So although I have code which works, I'm left with the uneasy feeling that I'm \"doing it wrong\" somehow, and since Netwire 5 is fairly new it's difficult to find examples of \"idiomatic\" code that I can check against and see if I'm near the mark.  Is this how the library is intended to be used or am I missing something?</p>\n\n<p><strong>EDIT</strong>: I've managed to resolve the second problem I mention (pattern matching on the <code>Either</code> result of <code>spin</code>) by combining <code>spin</code> and <code>shouldQuit</code> into a single <code>Wire</code>:</p>\n\n<pre><code>shouldContinuePlaying :: (Monoid e, Functor m, Monad m) =&gt; Wire s e (GLFWInputT m) a a\nshouldContinuePlaying = keyNotPressed GLFW.Key'Escape\n\ngame :: (HasTime t s, Monoid e, Functor m, Monad m) =&gt; Wire s e (GLFWInputT m) a GL.GLfloat\ngame = spin . shouldContinuePlaying\n</code></pre>\n\n<p>Stepping this wire gives me a much more sensible return value -- if it's <code>Left</code> I can quit, otherwise I have the piece of data to work with.  It also hints at a greater degree of composability than my original method.</p>\n\n<p>I still have to pass <code>Right undefined</code> as the input to this new wire though.  Admittedly, there's only one of them now, but I'm still not sure if this is the right approach.</p>\n"}, {"tags": ["haskell", "cabal-install"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424319172, "post_id": 28595221, "comment_id": 45503233, "body": "Do you have multiple versions of network or HTTP installed?"}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1424325795, "post_id": 28595221, "comment_id": 45505187, "body": "1. Remove your haskell folders from <code>Program Files</code> and <code>Program Files (x86)</code> and <code>%AppData%&#47;cabal</code>.  2. Reinstall haskell and cabal, from MinGW with admin privileges.  3. Let us know how that advanced...."}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 0, "creation_date": 1424336772, "post_id": 28595221, "comment_id": 45509768, "body": "@Amon 1) Do I need to uninstall the platform Haskell or manually delete the two directories of Haskell? 2) Simply delete the directory C: \\ Users \\ Alberto \\ AppData \\ Roaming? 3) Do I need to reinstall the Haskell  Platform from Cygwin64 Terminal or install separately Haskell and Cabal?"}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424336861, "post_id": 28595221, "comment_id": 45509813, "body": "@user2407038: I do not know how to test it."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1517003891, "creation_date": 1517003891, "answer_id": 48470172, "question_id": 28595221, "link": "https://stackoverflow.com/questions/28595221/failed-to-install-cabal-install-v-1-22-0-0/48470172#48470172", "title": "Failed to install cabal-install (v. 1.22.0.0)", "body": "<p>For the record, this problem had to do with installing <code>network</code> on Windows. New versions of the Haskell Platform, as well as stack all resolve this. Also, for installation of <code>cabal-install</code> in particular, binaries are provided on the cabal website.</p>\n"}], "owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 334, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1517003891, "creation_date": 1424298578, "last_edit_date": 1424312362, "question_id": 28595221, "link": "https://stackoverflow.com/questions/28595221/failed-to-install-cabal-install-v-1-22-0-0", "title": "Failed to install cabal-install (v. 1.22.0.0)", "body": "<p><strong>Failed to install cabal-install (v. 1.22.0.0) in Windows Command Prompt and in Cygwin64 Terminal.</strong> </p>\n\n<p>As usual in Windows, cabal fails to update cabal-install. I use Haskell Platform 2014.2.0.0.</p>\n\n<p>Actual cabal version:</p>\n\n<pre><code>$ cabal -V\ncabal-install version 1.20.0.4\nusing version 1.20.0.2 of the Cabal library\n</code></pre>\n\n<p><strong>Windows Command Prompt</strong></p>\n\n<pre><code>Microsoft Windows [Version 6.1.7601]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\nC:\\Windows\\system32&gt;cabal update\nDownloading the latest package list from hackage.haskell.org\nNote: there is a new version of cabal-install available.\nTo upgrade, run: cabal install cabal-install\n\nC:\\Windows\\system32&gt;cabal install cabal-install\nResolving dependencies...\nConfiguring cabal-install-1.22.0.0...\nBuilding cabal-install-1.22.0.0...\nPreprocessing executable 'cabal' for cabal-install-1.22.0.0...\n[ 1 of 77] Compiling Distribution.Client.Dependency.Modular.Version ( Distributi\non\\Client\\Dependency\\Modular\\Version.hs, dist\\build\\cabal\\cabal-tmp\\Distribution\n\\Client\\Dependency\\Modular\\Version.o )\n[ 2 of 77] Compiling Distribution.Client.Dependency.Modular.PSQ ( Distribution\\C\nlient\\Dependency\\Modular\\PSQ.hs, dist\\build\\cabal\\cabal-tmp\\Distribution\\Client\\\nDependency\\Modular\\PSQ.o )\n...\n...\nC:\\Users\\Alberto\\AppData\\Roaming\\cabal\\x86_64-windows-ghc-7.8.3\\HTTP-4000.2.19/l\nibHSHTTP-4000.2.19.a(TCP.o):fake:(.text+0x44d6): undefined reference to `shutdow\nnWinSock'\nC:\\Users\\Alberto\\AppData\\Roaming\\cabal\\x86_64-windows-ghc-7.8.3\\HTTP-4000.2.19/l\nibHSHTTP-4000.2.19.a(TCP.o):fake:(.text+0x4c8e): undefined reference to `shutdow\nnWinSock'\nC:\\Users\\Alberto\\AppData\\Roaming\\cabal\\x86_64-windows-ghc-7.8.3\\HTTP-4000.2.19/l\nibHSHTTP-4000.2.19.a(TCP.o):fake:(.text+0x4ceb): undefined reference to `initWin\nSock'\nC:\\Users\\Alberto\\AppData\\Roaming\\cabal\\x86_64-windows-ghc-7.8.3\\HTTP-4000.2.19/l\nibHSHTTP-4000.2.19.a(TCP.o):fake:(.text+0x4e36): undefined reference to `shutdow\nnWinSock'\nc:/program files/haskell platform/2014.2.0.0/mingw/bin/../lib/gcc/x86_64-w64-min\ngw32/4.6.3/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\\Users\\Alberto\\AppData\\R\noaming\\cabal\\x86_64-windows-ghc-7.8.3\\HTTP-4000.2.19/libHSHTTP-4000.2.19.a(TCP.o\n): bad reloc address 0x0 in section `.data'\nc:/program files/haskell platform/2014.2.0.0/mingw/bin/../lib/gcc/x86_64-w64-min\ngw32/4.6.3/../../../../x86_64-w64-mingw32/bin/ld.exe: final link failed: Invalid\n operation\ncollect2: ld returned 1 exit status\nFailed to install cabal-install-1.22.0.0\ncabal: Error: some packages failed to install:\ncabal-install-1.22.0.0 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n\n<p><strong>From Cygwin64  Terminal:</strong></p>\n\n<pre><code>Alberto@Alberto-PC ~\n$ cabal install cabal-install\nResolving dependencies...\nConfiguring cabal-install-1.22.0.0...\nBuilding cabal-install-1.22.0.0...\nPreprocessing executable 'cabal' for cabal-install-1.22.0.0...\n[ 1 of 77] Compiling Distribution.Client.Dependency.Modular.Version ( Distribution\\Client\\Dependency\\Modular\\Version.hs, dist\\build\\cabal\\cabal-tmp\\Distribution\\Client\\Dependency\\Modular\\Version.o )\n[ 2 of 77] Compiling Distribution.Client.Dependency.Modular.PSQ ( Distribution\\Client\\Dependency\\Modular\\PSQ.hs, dist\\build\\cabal\\cabal-tmp\\Distribution\\Client\\Dependency\\Modular\\PSQ.o )\n[ 3 of 77] Compiling Distribution.Client.Dependency.Modular.Package ( Distribution\\Client\\Dependency\\Modular\\Package.hs, dist\\build\\cabal\\cabal-tmp\\Distribution\\Client\\Dependency\\Modular\\Package.o )\n...\n...\nC:\\Users\\Alberto\\AppData\\Roaming\\cabal\\x86_64-windows-ghc-7.8.3\\HTTP-4000.2.19/libHSHTTP-4000.2.19.a(TCP.o):fake:(.text+0x4ceb): undefined reference to `initWinSock'\nC:\\Users\\Alberto\\AppData\\Roaming\\cabal\\x86_64-windows-ghc-7.8.3\\HTTP-4000.2.19/libHSHTTP-4000.2.19.a(TCP.o):fake:(.text+0x4e36): undefined reference to `shutdownWinSock'\nc:/program files/haskell platform/2014.2.0.0/mingw/bin/../lib/gcc/x86_64-w64-mingw32/4.6.3/../../../../x86_64-w64-mingw32/bin/ld.exe: C:\\Users\\Alberto\\AppData\\Roaming\\cabal\\x86_64-windows-ghc-7.8.3\\HTTP-4000.2.19/libHSHTTP-4000.2.19.a(TCP.o): bad reloc address 0x0 in section `.data'\nc:/program files/haskell platform/2014.2.0.0/mingw/bin/../lib/gcc/x86_64-w64-mingw32/4.6.3/../../../../x86_64-w64-mingw32/bin/ld.exe: final link failed: Invalid operation\ncollect2: ld returned 1 exit status\nFailed to install cabal-install-1.22.0.0\ncabal.exe: Error: some packages failed to install:\ncabal-install-1.22.0.0 failed during the building phase. The exception was:\nExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell", "gadt"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1424300266, "post_id": 28595039, "comment_id": 45497774, "body": "Why is matching on the constructors &#39;not appropriate&#39;?"}, {"owner": {"reputation": 103, "user_id": 4429970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79b8c5e6dba911ce00c539e51764b833?s=128&d=identicon&r=PG&f=1", "display_name": "Alex K.", "link": "https://stackoverflow.com/users/4429970/alex-k"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1424301296, "post_id": 28595039, "comment_id": 45498202, "body": "Because a lot constructors. I do not want to duplicate the big code. In fact. data AST = Imm Int | Arg Int | Add AST AST | Sub AST AST | Mul AST AST | Div AST AST ......"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1424301514, "post_id": 28595039, "comment_id": 45498279, "body": "Big data types are something of a code smell. It might be worth trying to simplify the design of your AST."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1424303470, "post_id": 28595039, "comment_id": 45498971, "body": "To @BenjaminHodgson&#39;s point, you can always do something like <code>data AST = ... | BinOp BinOpType AST AST</code> with <code>data BinOpType = Add | Sub | Mul | Div</code>."}], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 4429970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79b8c5e6dba911ce00c539e51764b833?s=128&d=identicon&r=PG&f=1", "display_name": "Alex K.", "link": "https://stackoverflow.com/users/4429970/alex-k"}, "edited": false, "score": 0, "creation_date": 1424300479, "post_id": 28595147, "comment_id": 45497880, "body": "Thank U. But I&#39;m too simplified real task. In fact.   data AST   = Imm Int            | Arg Int            | Add AST AST            | Sub AST AST            | Mul AST AST            | Div AST AST   reduce:: (Int-&gt;Int-&gt;Int) -&gt; AST -&gt; AST reduce f (t a b) = go a b      where go (Imm a) (Imm b) = Imm $ f a b                go a b = t a b"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1424303721, "post_id": 28595147, "comment_id": 45499055, "body": "This will still work for your use case with <code>data AST a = Imm a | Arg Int | Add (AST a) (AST a) | ...</code>. Then you just need an extra function for <code>Arg</code>, assuming that <code>Imm</code> is the constructor for values in your expression language and that <code>Arg</code> is something else. <code>Arg a</code> might work as well, depending on what the constructors represent."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 6, "last_activity_date": 1424298297, "creation_date": 1424298297, "answer_id": 28595147, "question_id": 28595039, "link": "https://stackoverflow.com/questions/28595039/how-to-get-a-constructor-as-a-function-from-the-gadt-argument-in-haskell/28595147#28595147", "title": "How to get a constructor as a function from the (G)ADT argument in Haskell?", "body": "<p>If you are ok with changing the type of <code>Ex1</code> then:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\ndata  Ex1 a =  C1 a | C2 a\n            | C3 deriving (Show, Functor)\n\nfun :: Ex1 Int -&gt; Ex1 Int\nfun y = fmap (\\x -&gt; x^2) y\n</code></pre>\n\n<p>Demo in <code>ghci</code>:</p>\n\n<pre><code>\u03bb&gt; fun $ C1 3\nC1 9\n\u03bb&gt; fun $ C2 3\nC2 9\n\u03bb&gt; fun C3\nC3\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 4429970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79b8c5e6dba911ce00c539e51764b833?s=128&d=identicon&r=PG&f=1", "display_name": "Alex K.", "link": "https://stackoverflow.com/users/4429970/alex-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1424298297, "creation_date": 1424297899, "question_id": 28595039, "link": "https://stackoverflow.com/questions/28595039/how-to-get-a-constructor-as-a-function-from-the-gadt-argument-in-haskell", "title": "How to get a constructor as a function from the (G)ADT argument in Haskell?", "body": "<p>How to get a constructor as a function from the (G)ADT argument in Haskell?\nIs it possible to do something like this?</p>\n\n<pre><code>data  Ex1 =  C1 Int | C2 Int -- | ..... \n           | C3\n\nfun :: Ex1 -&gt; Ex1\nfun C3    = C3\nfun (c i) = c $ i^2\n</code></pre>\n\n<p>It is not appropriate for me to.</p>\n\n<pre><code>fun (C1 i) = C1 $ i^2\nfun (C2 i) = C2 $ i^2\n</code></pre>\n"}, {"tags": ["unit-testing", "haskell", "testing", "functional-programming"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1424294679, "post_id": 28594186, "comment_id": 45494977, "body": "What makes you think custom functions as mocks are any more expensive or error-prone than OO objects?"}, {"owner": {"reputation": 11971, "user_id": 1100135, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e7b273722f4261cd61c3256374da73cc?s=128&d=identicon&r=PG", "display_name": "piotrek", "link": "https://stackoverflow.com/users/1100135/piotrek"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1424294993, "post_id": 28594186, "comment_id": 45495159, "body": "i don&#39;t. that&#39;s why i&#39;m asking"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1424296771, "post_id": 28594186, "comment_id": 45496121, "body": "Why would you want to mock a pure function?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1424298241, "post_id": 28594186, "comment_id": 45496895, "body": "Testing a higher-order function can be more challenging than testing a first-order one. However, it is not so different from testing a function taking objects and returning objects. If anything, it looks a bit easier, because objects have state, while functions have not. For instance, how would you test an array-sorting function taking a comparator object? How would this be different from testing a <code>sortBy</code> alternative?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1424352483, "post_id": 28594186, "comment_id": 45519177, "body": "You can use QuickCheck for higher order functions too."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1424361131, "post_id": 28594186, "comment_id": 45525163, "body": "@dfeuer You <i>can</i>, and I&#39;m always puzzled as to what on Earth that actually does..."}], "answers": [{"comments": [{"owner": {"reputation": 11971, "user_id": 1100135, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e7b273722f4261cd61c3256374da73cc?s=128&d=identicon&r=PG", "display_name": "piotrek", "link": "https://stackoverflow.com/users/1100135/piotrek"}, "edited": false, "score": 1, "creation_date": 1424353186, "post_id": 28597306, "comment_id": 45519664, "body": "regarding testing <code>g</code>. my concerns are: if each <code>h</code> has some branches then <code>g</code> has to many possible execution flows to test them all. that&#39;s the problem with integration tests - to many possibilities"}, {"owner": {"reputation": 704, "user_id": 939572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2aadfb25285dc4e9a3caf81e2277d77b?s=128&d=identicon&r=PG", "display_name": "GarethR", "link": "https://stackoverflow.com/users/939572/garethr"}, "reply_to_user": {"reputation": 11971, "user_id": 1100135, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e7b273722f4261cd61c3256374da73cc?s=128&d=identicon&r=PG", "display_name": "piotrek", "link": "https://stackoverflow.com/users/1100135/piotrek"}, "edited": false, "score": 2, "creation_date": 1424374338, "post_id": 28597306, "comment_id": 45533535, "body": "Well in your example, you&#39;re already testing h1, h2, h3 and h4, so testing g is really just testing you composed them right. You can do that with just a few sample values. You mentioned branches. In Haskell, types have branches, not just functions. The branching structure of a function mirrors the cases of the data it operates on. This makes it much easier to know what values to test. And as Mathematical Orchid says, Quickcheck and Smallcheck can generate lots of those values, giving you far better coverage than you would have otherwise."}, {"owner": {"reputation": 2299, "user_id": 1018290, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/113bcc8f198ab8a17839aab5f4f0776f?s=128&d=identicon&r=PG", "display_name": "Will Sewell", "link": "https://stackoverflow.com/users/1018290/will-sewell"}, "edited": false, "score": 0, "creation_date": 1443534791, "post_id": 28597306, "comment_id": 53525571, "body": "I have written up a walkthrough of how you can achieve your second suggestion for testing IO code using a real world example: <a href=\"https://blog.pusher.com/unit-testing-io-in-haskell/\" rel=\"nofollow noreferrer\">blog.pusher.com/unit-testing-io-in-haskell</a>"}, {"owner": {"reputation": 9489, "user_id": 614800, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/IZDYN.png?s=128&g=1", "display_name": "beluchin", "link": "https://stackoverflow.com/users/614800/beluchin"}, "reply_to_user": {"reputation": 11971, "user_id": 1100135, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e7b273722f4261cd61c3256374da73cc?s=128&d=identicon&r=PG", "display_name": "piotrek", "link": "https://stackoverflow.com/users/1100135/piotrek"}, "edited": false, "score": 0, "creation_date": 1612699866, "post_id": 28597306, "comment_id": 116843065, "body": "@piotrek - lately, I have had no qualms about mocking the dependencies (also pure functions) to avoid the combinatorial explosion of possibilities - these dependencies not being arguments to the function under test (<i>sut</i>) but simple plain old functions called within the <i>sut</i> i.e. the <i>sut</i> not being a higher order function."}], "tags": [], "owner": {"reputation": 704, "user_id": 939572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2aadfb25285dc4e9a3caf81e2277d77b?s=128&d=identicon&r=PG", "display_name": "GarethR", "link": "https://stackoverflow.com/users/939572/garethr"}, "is_accepted": false, "score": 5, "last_activity_date": 1424309912, "creation_date": 1424309912, "answer_id": 28597306, "question_id": 28594186, "link": "https://stackoverflow.com/questions/28594186/testing-in-functional-programming/28597306#28597306", "title": "testing in functional programming", "body": "<p>In your example, you can test h1, h2, h3 and h4 separately, no problem, because they don't actually depend on each other. There's nothing stopping you testing g either. But is g a 'unit'? Well a very good definition of a unit test is given by Michael Feathers in his famous unit-testing book, Working Effectively With Legacy Code. He says unit tests are fast and reliable to run in the commit phase of your build pipeline and fast enough for developers to run. So g is a 'unit' by this measure. The other excellent perspective on unit testing is from Hexagonal Architecture, see TDD Where Did It All Go Wrong? They say that you want to test your application's API via the 'ports' it uses to interface to the outside world. Your g is a unit by this definition also. But what do they mean by a 'port' and can we relate this to Haskell? Well a typical port might be the database connection that the application uses to store things in a database. In Hexagonal, you <em>would</em> want to test that interface, likely by a mock. In Haskell terms, the core of the application is pure code and the ports are IO. The point is, you want to introduce your 'seams' (such as mocks) at the IO interface. So you probably don't want to worry about splitting g up.</p>\n\n<p>But how do you introduce 'seams' for testing in Haskell? After all, there is no dependency injection framework (and nor should there be). Well the go-to answer to this is, as always in Haskell, to use functions and parameterisation. For example, suppose you have a function foo that's defined in terms of a function bar. You want to vary bar so it is a test double in your test and the regular value the rest of the time. Just make bar a parameter like this:</p>\n\n<pre><code>Module Foo\n foo bar = ... bar ...\n\nModule Test\n foo = Foo.foo testBar\n\nModule Real\n  foo = Foo.foo realBar\n</code></pre>\n\n<p>You don't need to do it exactly like that but the point is that parameterisation gets you further than you'd think.</p>\n\n<p>Alright, but what about testing IO in Haskell? How do we 'mock out' those IO actions? One way is to do it like you would in JavaScript: create data structures full of IO actions (they call them 'objects' ;-) ) and pass them around. Another way is to not use the IO type directly but instead access it through one of two monadic types - the real and the test type that are both instances of the same type class that defines the actions you want to swap out. Or you can make a Free Monad (using the free or operational packages) and write two interpreters - the test one and the real one.</p>\n\n<p>In summary, testing pure code is so easy that practically anything you try will work. Testing IO code is harder, which is why we isolate it as much as possible.</p>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 5, "last_activity_date": 1424361084, "creation_date": 1424361084, "answer_id": 28610747, "question_id": 28594186, "link": "https://stackoverflow.com/questions/28594186/testing-in-functional-programming/28610747#28610747", "title": "testing in functional programming", "body": "<p>I too have been thinking about testing in functional code. I don't have all the answers, but I'll write a little bit here.</p>\n\n<p>Functional programs are put together differently, and that demands different testing approaches.</p>\n\n<p>If you take even the most cursory look at Haskell testing, you will inevitably come across QuickCheck and SmallCheck, two very well-known Haskell testing libraries. These both do \"property-based testing\".</p>\n\n<p>In an OO language you would laboriously write individual tests to set up half a dozen mock objects, call a method or two, and verify that the expected external methods were called with the right data and / or the method ultimately returned the right answer. That's quite a bit of work. You probably only do this with one or two test cases.</p>\n\n<p>QuickCheck is something else. You might write a property that says something like \"if I sort this list, the output should have the same number of elements as the input\". This is a one-liner. The QuickCheck library will then <em>automatically</em> build hundreds of randomly-generated lists, and check that the specified condition holds for every single one of them. And if it doesn't, it'll spit out the exact input on which the test failed.</p>\n\n<p>(Both QuickCheck and SmallCheck do roughly the same thing. QuickCheck generates <em>random</em> tests, whereas SmallCheck <em>systematically</em> tries all combinations up to a specified size limit.)</p>\n\n<p>You say you're worried about the combinatorial explosion of possible flow control paths to test, but with tools like this generating the test cases for you dynamically, manually writing enough tests isn't a problem. The <em>only</em> problem is coming up with enough data to test all flow paths.</p>\n\n<p>Haskell can help with that too. I read a paper about a library [I don't know if it ever got released] which actually uses Haskell's lazy evaluation to detect what the code under test is doing with the input data. As in, it can detect whether the function you're testing looks at the contents of a list, or only the <em>size</em> of that list. It can detect which fields of that Customer record are being touched. And so forth. In this way, it automatically generates data, but doesn't waste hours generating different random variations of parts of the data that aren't even relevant for this particular code. (E.g., if you're sorting Customers by ID, it doesn't matter what's in the Name field.)</p>\n\n<p>As for testing functions that take or produce functions... yeah, I don't have an answer to that.</p>\n"}], "owner": {"reputation": 11971, "user_id": 1100135, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e7b273722f4261cd61c3256374da73cc?s=128&d=identicon&r=PG", "display_name": "piotrek", "link": "https://stackoverflow.com/users/1100135/piotrek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2479, "favorite_count": 2, "answer_count": 2, "score": 13, "last_activity_date": 1424361084, "creation_date": 1424294575, "last_edit_date": 1424328125, "question_id": 28594186, "link": "https://stackoverflow.com/questions/28594186/testing-in-functional-programming", "title": "testing in functional programming", "body": "<p>in object oriented programming i have objects and state. so i can mock all dependencies of an object and test the object. but functional programming (especially the pure) is about composing functions</p>\n\n<p>it's easy to test function that doesn't depend on other functions. we just pass parameter and check the result. but what about function that takes another functions and returns functions? </p>\n\n<p>let's say i have the code <code>g = h1 \u2218 h2 \u2218 h3 \u2218 h4</code>. should i test just function <code>g</code>? but that's integration/functional testing. it's impossible to test all branches with only integration tests. what about unit testing? and it's getting more complicated when a function takes more parameters. </p>\n\n<p>should i create custom functions and use them as mocks? wouldn't it be to expensive and error prone?</p>\n\n<p>and what about monads? for example how to test console output or disk operations in haskell?</p>\n"}, {"tags": ["scala", "haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 20561, "user_id": 7898, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/acfc954b00b2fab98555a08d7c254204?s=128&d=identicon&r=PG", "display_name": "Jean", "link": "https://stackoverflow.com/users/7898/jean"}, "edited": false, "score": 0, "creation_date": 1424292749, "post_id": 28593415, "comment_id": 45493894, "body": "doing the assignment in the for comprehension can make sense to split an rhs expression that would be too long/complex and help readbility. just the same as introducing a local variable within a map/flatmap. Having to do so may be a sign of trouble with the design but it can still be helpful :)"}, {"owner": {"reputation": 45, "user_id": 3665170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09ab42a820107ac6688a2e2f62c7569?s=128&d=identicon&r=PG", "display_name": "Benjamin Geer", "link": "https://stackoverflow.com/users/3665170/benjamin-geer"}, "reply_to_user": {"reputation": 20561, "user_id": 7898, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/acfc954b00b2fab98555a08d7c254204?s=128&d=identicon&r=PG", "display_name": "Jean", "link": "https://stackoverflow.com/users/7898/jean"}, "edited": false, "score": 0, "creation_date": 1424293455, "post_id": 28593415, "comment_id": 45494297, "body": "Exceptions are indeed caught in for-comprehensions when used with Future or Try monads. Try it yourself, you&#39;ll see. I agree that I could wrap my call to Manager.getManager() in a Future or Try constructor, and I guess this is probably the best workaround. But I don&#39;t see why I should have to. And yes, as @Jean notes, for-comprehensions often need to do lots of calculations that would be far too long to put in the yield block."}, {"owner": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "reply_to_user": {"reputation": 20561, "user_id": 7898, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/acfc954b00b2fab98555a08d7c254204?s=128&d=identicon&r=PG", "display_name": "Jean", "link": "https://stackoverflow.com/users/7898/jean"}, "edited": false, "score": 0, "creation_date": 1424294666, "post_id": 28593415, "comment_id": 45494969, "body": "@Jean - You can execute multi-line statements in the yield block too.  There may be some cases where splitting it up is clearer, though."}, {"owner": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "reply_to_user": {"reputation": 45, "user_id": 3665170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09ab42a820107ac6688a2e2f62c7569?s=128&d=identicon&r=PG", "display_name": "Benjamin Geer", "link": "https://stackoverflow.com/users/3665170/benjamin-geer"}, "edited": false, "score": 4, "creation_date": 1424295088, "post_id": 28593415, "comment_id": 45495218, "body": "@BenjaminGeer - The for-comprehension isn&#39;t catching anything.  The monad is doing all the work.  So you want the compiler to guess which monad you meant to wrap your initial assignment in?  And what if it&#39;s already the right type?  Wrap again anyway or not?  You <i>could</i> come up with consistent rules for these things, but I think being explicit (unambiguous) should win out here.  Besides: what is <code>Manager.getManager()</code> doing returning a non-monad anyway?  That&#39;s where the problem really lies.  If your methods aren&#39;t &quot;properly&quot; typed, I&#39;m not sure a quick explicit wrapping is so bad."}, {"owner": {"reputation": 45, "user_id": 3665170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09ab42a820107ac6688a2e2f62c7569?s=128&d=identicon&r=PG", "display_name": "Benjamin Geer", "link": "https://stackoverflow.com/users/3665170/benjamin-geer"}, "edited": false, "score": 0, "creation_date": 1424295442, "post_id": 28593415, "comment_id": 45495415, "body": "@RexKerr OK, strictly speaking, the monad is doing all the work, but I think you&#39;re splitting hairs. Why couldn&#39;t the for-comprehension get the monad&#39;s type from the first generator provided (or any generator, since they all have to be the same type), even if it&#39;s not the first statement in the for-comprehension?"}, {"owner": {"reputation": 45, "user_id": 3665170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09ab42a820107ac6688a2e2f62c7569?s=128&d=identicon&r=PG", "display_name": "Benjamin Geer", "link": "https://stackoverflow.com/users/3665170/benjamin-geer"}, "edited": false, "score": 0, "creation_date": 1424295558, "post_id": 28593415, "comment_id": 45495477, "body": "@RexKerr The reason that <code>Manager.getManager()</code> returns a non-monad is, for example, because it&#39;s provided by a third-party Java library, and I have no control over what it returns."}, {"owner": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "reply_to_user": {"reputation": 45, "user_id": 3665170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09ab42a820107ac6688a2e2f62c7569?s=128&d=identicon&r=PG", "display_name": "Benjamin Geer", "link": "https://stackoverflow.com/users/3665170/benjamin-geer"}, "edited": false, "score": 0, "creation_date": 1424296266, "post_id": 28593415, "comment_id": 45495858, "body": "@BenjaminGeer - Any type that &quot;works&quot;, via availability of <code>map</code>/<code>flatMap</code> of appropriate signature or implicit conversion, is allowed in a for-comprehension.  So it&#39;s not necessarily so obvious what the type is.  You also open up subtle bugs caused by e.g. dropping a <code>toOption</code> onto part of the code (suddenly, no more catching!).  Also, if you use libraries that are dangerous in ways that your normal code is not, having a <code>Try</code> or whatnot as a warning is more of an advantage than disadvantage!  So although it&#39;s <i>possible</i> to have a for-comprehension work this way, it seems unwise to me."}, {"owner": {"reputation": 45, "user_id": 3665170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09ab42a820107ac6688a2e2f62c7569?s=128&d=identicon&r=PG", "display_name": "Benjamin Geer", "link": "https://stackoverflow.com/users/3665170/benjamin-geer"}, "edited": false, "score": 0, "creation_date": 1424296811, "post_id": 28593415, "comment_id": 45496151, "body": "I agree that it would be nice if you could specify the type of a for-comprehension explicitly. I try to keep it clear via coding style: when using a monad, I generally write a method whose entire body is a for-comprehension, and whose return type is the monad, which is the result of the <code>yield</code>. Since we have to use Futures constantly anyway (because of Akka), for-comprehensions make the code vastly simpler than it would otherwise be. But the price to pay is syntactic restrictions like the one I&#39;m asking about. Hence I wonder whether these restrictions are really necessary."}, {"owner": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "reply_to_user": {"reputation": 45, "user_id": 3665170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09ab42a820107ac6688a2e2f62c7569?s=128&d=identicon&r=PG", "display_name": "Benjamin Geer", "link": "https://stackoverflow.com/users/3665170/benjamin-geer"}, "edited": false, "score": 1, "creation_date": 1424362813, "post_id": 28593415, "comment_id": 45526458, "body": "@BenjaminGeer - It isn&#39;t <i>really</i> necessary, but it is a good idea for contexts which are more mixed than yours.  It could have been implemented differently: <code>for</code> requires a <code>M[A] &lt;: Monad[A]</code> and requires all items to be the same type, at which point the early definition would be unproblematic.  But there was a different choice made (more flexibility), so at this point I think it <i>would</i> be inadvisable to change as the danger of accidental confusion or bugs is high."}], "tags": [], "owner": {"reputation": 162124, "user_id": 247533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3698349ad0b898d398a6573f4d1f867a?s=128&d=identicon&r=PG", "display_name": "Rex Kerr", "link": "https://stackoverflow.com/users/247533/rex-kerr"}, "is_accepted": true, "score": 8, "last_activity_date": 1424296714, "last_edit_date": 1424296714, "creation_date": 1424291774, "answer_id": 28593415, "question_id": 28593307, "link": "https://stackoverflow.com/questions/28593307/why-does-a-scala-for-comprehension-have-to-start-with-a-generator/28593415#28593415", "title": "Why does a Scala for-comprehension have to start with a generator?", "body": "<p><code>for</code> comprehensions <strong>do not catch exceptions</strong>.  <code>Try</code> does, and it has the appropriate methods to participate in for-comprehensions, so you can</p>\n\n<pre><code>for {\n  manager &lt;- Try { Manager.getManager() }\n  ...\n}\n</code></pre>\n\n<p>But then it's expecting <code>Try</code> all the way down unless you manually or implicitly have a way to switch container types (e.g. something that converts <code>Try</code> to a <code>List</code>).</p>\n\n<p>So I'm not sure your premises are right.  Any assignment you made in a for-comprehension can just be made early.</p>\n\n<p>(Also, there is no point doing an assignment inside a for comprehension just to yield that exact value.  Just do the computation in the yield block.)</p>\n\n<p>(Also, just to illustrate that multiple types can play a role in <code>for</code> comprehensions so there's not a super-obvious correct answer for how to wrap an early assignment in terms of later types:</p>\n\n<pre><code>// List and Option, via implicit conversion\nfor {i &lt;- List(1,2,3); j &lt;- Option(i).filter(_ &lt;2)} yield j\n\n// Custom compatible types with map/flatMap\n// Use :paste in the REPL to define A and B together\nclass A[X] { def flatMap[Y](f: X =&gt; B[Y]): A[Y] = new A[Y] }\nclass B[X](x: X) { def map[Y](f: X =&gt; Y): B[Y] = new B(f(x)) }\nfor{ i &lt;- (new A[Int]); j &lt;- (new B(i)) } yield j.toString\n</code></pre>\n\n<p>Even if you take the first type you still have the problem of whether there is a unique \"bind\" (way to wrap) and whether to doubly-wrap things that are already the correct type.  There could be rules for all these things, but for-comprehensions are already hard enough to learn, no?)</p>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 3665170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09ab42a820107ac6688a2e2f62c7569?s=128&d=identicon&r=PG", "display_name": "Benjamin Geer", "link": "https://stackoverflow.com/users/3665170/benjamin-geer"}, "edited": false, "score": 0, "creation_date": 1424293734, "post_id": 28593593, "comment_id": 45494467, "body": "As far as I understand, Haskell&#39;s do notation is also syntactic sugar for similar function calls (Scala&#39;s flatMap is analogous to Haskell&#39;s bind). So why can&#39;t Scala&#39;s for-comprehensions offer the same flexibility as Haskell&#39;s do notation?"}], "tags": [], "owner": {"reputation": 744, "user_id": 2231391, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8fGDh.jpg?s=128&g=1", "display_name": "Jorge Vicente Cantero", "link": "https://stackoverflow.com/users/2231391/jorge-vicente-cantero"}, "is_accepted": false, "score": 0, "last_activity_date": 1424292428, "creation_date": 1424292428, "answer_id": 28593593, "question_id": 28593307, "link": "https://stackoverflow.com/questions/28593307/why-does-a-scala-for-comprehension-have-to-start-with-a-generator/28593593#28593593", "title": "Why does a Scala for-comprehension have to start with a generator?", "body": "<p>I think the reason this can't be done is because for-loops are syntactic sugar for <em>flatMap</em> and <em>map</em> methods (except if you are using a condition in the for-loop, in that case it's desugared with the method <em>withFilter</em>). When you are storing in a immutable variable, you can't use these methods. That's the reason you would be ok using <strong>Try</strong> as pointed out by Rex Kerr. In that case, you should be able to use <em>map</em> and <em>flatMap</em> methods.</p>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 2, "last_activity_date": 1424296026, "creation_date": 1424296026, "answer_id": 28594567, "question_id": 28593307, "link": "https://stackoverflow.com/questions/28593307/why-does-a-scala-for-comprehension-have-to-start-with-a-generator/28594567#28594567", "title": "Why does a Scala for-comprehension have to start with a generator?", "body": "<p>Haskell translates the equivalent of <code>for { manager = Manager.getManager(); ... }</code> to the equivalent of <code>lazy val manager = Manager.getManager(); for { ... }</code>. This seems to work:</p>\n\n<pre><code>scala&gt; lazy val x: Int = throw new Exception(\"\")\nx: Int = &lt;lazy&gt;\n\nscala&gt; for { y &lt;- Future(x + 1) } yield y\nres8: scala.concurrent.Future[Int] = scala.concurrent.impl.Promise$DefaultPromise@fedb05d\n\nscala&gt; Try(Await.result(res1, Duration(\"10 seconds\")))\nres9: scala.util.Try[Int] = Failure(java.lang.Exception: )\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 3665170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09ab42a820107ac6688a2e2f62c7569?s=128&d=identicon&r=PG", "display_name": "Benjamin Geer", "link": "https://stackoverflow.com/users/3665170/benjamin-geer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1119, "favorite_count": 0, "accepted_answer_id": 28593415, "answer_count": 3, "score": 2, "last_activity_date": 1424336326, "creation_date": 1424291434, "last_edit_date": 1424336326, "question_id": 28593307, "link": "https://stackoverflow.com/questions/28593307/why-does-a-scala-for-comprehension-have-to-start-with-a-generator", "title": "Why does a Scala for-comprehension have to start with a generator?", "body": "<p>According to the <a href=\"http://www.scala-lang.org/docu/files/ScalaReference.pdf\" rel=\"nofollow\">Scala Language Specification</a> (\u00a76.19), \"An enumerator sequence always starts with a generator\". Why?</p>\n\n<p>I sometimes find this restriction to be a hindrance when using <code>for</code>-comprehensions with monads, because it means you can't do things like this:</p>\n\n<pre><code>def getFooValue(): Future[Int] = {\n  for {\n    manager = Manager.getManager() // could throw an exception\n    foo &lt;- manager.makeFoo() // method call returns a Future\n    value = foo.getValue()\n  } yield value\n}\n</code></pre>\n\n<p>Indeed, <code>scalac</code> rejects this with the error message <code>'&lt;-' expected but '=' found</code>.</p>\n\n<p>If this was valid syntax in Scala, one advantage would be that any exception thrown by <code>Manager.getManager()</code> would be caught by the <code>Future</code> monad used within the <code>for</code>-comprehension, and would cause it to yield a failed <code>Future</code>, which is what I want. The workaround of moving the call to <code>Manager.getManager()</code> outside the <code>for</code>-comprehension doesn't have this advantage:</p>\n\n<pre><code>def getFooValue(): Future[Int] = {\n  val manager = Manager.getManager()\n\n  for {\n    foo &lt;- manager.makeFoo()\n    value = foo.getValue()\n  } yield value\n}\n</code></pre>\n\n<p>In this case, an exception thrown by <code>foo.getValue()</code> will yield a failed <code>Future</code> (which is what I want), but an exception thrown by <code>Manager.getManager()</code> will be thrown back to the caller of <code>getFooValue()</code> (which is not what I want). Other possible ways of handling the exception are more verbose.</p>\n\n<p>I find this restriction especially puzzling because in Haskell's otherwise similar <code>do</code> notation, there is no requirement that a <code>do</code> block should begin with a statement containing <code>&lt;-</code>. Can anyone explain this difference between Scala and Haskell?</p>\n\n<p>Here's a complete working example showing how exceptions are caught by the <code>Future</code> monad in <code>for</code>-comprehensions:</p>\n\n<pre><code>import scala.concurrent._\nimport scala.concurrent.duration._\nimport scala.concurrent.ExecutionContext.Implicits.global\nimport scala.util.{Try, Success, Failure}\n\nclass Foo(val value: Int) {\n  def getValue(crash: Boolean): Int = {\n    if (crash) {\n      throw new Exception(\"failed to get value\")\n    } else {\n      value\n    }\n  }\n}\n\nclass Manager {\n  def makeFoo(crash: Boolean): Future[Foo] = {\n    if (crash) {\n      throw new Exception(\"failed to make Foo\")\n    } else {\n      Future(new Foo(10))\n    }\n  }\n}\n\nobject Manager {\n  def getManager(crash: Boolean): Manager = {\n    if (crash) {\n      throw new Exception(\"failed to get manager\")\n    } else {\n      new Manager()\n    }\n  }\n}\n\nobject Main extends App {\n\n  def getFooValue(crashGetManager: Boolean,\n                  crashMakeFoo: Boolean,\n                  crashGetValue: Boolean): Future[Int] = {\n    for {\n      manager &lt;- Future(Manager.getManager(crashGetManager))\n      foo &lt;- manager.makeFoo(crashMakeFoo)\n      value = foo.getValue(crashGetValue)\n    } yield value\n  }\n\n  def waitForValue(future: Future[Int]): Unit = {\n    val result = Try(Await.result(future, Duration(\"10 seconds\")))\n    result match {\n      case Success(value) =&gt; println(s\"Got value: $value\")\n      case Failure(e) =&gt; println(s\"Got error: $e\")\n    }\n  }\n\n  val future1 = getFooValue(false, false, false)\n  waitForValue(future1)\n  val future2 = getFooValue(true, false, false)\n  waitForValue(future2)\n  val future3 = getFooValue(false, true, false)\n  waitForValue(future3)\n  val future4 = getFooValue(false, false, true)\n  waitForValue(future4)\n}\n</code></pre>\n\n<p>Here's the output:</p>\n\n<pre><code>Got value: 10\nGot error: java.lang.Exception: failed to get manager\nGot error: java.lang.Exception: failed to make Foo\nGot error: java.lang.Exception: failed to get value\n</code></pre>\n\n<p>This is a trivial example, but I'm working on a project in which we have a lot of non-trivial code that depends on this behaviour. As far as I understand, this is one of the main advantages of using <code>Future</code> (or <code>Try</code>) as a monad. What I find strange is that I have to write</p>\n\n<pre><code>manager &lt;- Future(Manager.getManager(crashGetManager))\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>manager = Manager.getManager(crashGetManager)\n</code></pre>\n\n<p>(Edited to reflect @RexKerr's point that the monad is doing the work of catching the exceptions.)</p>\n"}, {"tags": ["haskell", "design-patterns", "dependencies", "spreadsheet"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424285690, "post_id": 28591552, "comment_id": 45489622, "body": "What do you mean by &quot;external references&quot;?"}, {"owner": {"reputation": 1126, "user_id": 104103, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ccf1cf3aa6e5cacc9d60e5422cb0100f?s=128&d=identicon&r=PG", "display_name": "BruceBerry", "link": "https://stackoverflow.com/users/104103/bruceberry"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424286283, "post_id": 28591552, "comment_id": 45490020, "body": "references outside the cell (and outside of your bottom-up flow of data). Imagine the excel equivalent being =A1+2, where A1 is another cell with a number and you need to <code>eval</code> that cell first if you want to evaluate this one."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1424300414, "post_id": 28591552, "comment_id": 45497850, "body": "It gets interesting when cells recursively reference one another ;)"}, {"owner": {"reputation": 1126, "user_id": 104103, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ccf1cf3aa6e5cacc9d60e5422cb0100f?s=128&d=identicon&r=PG", "display_name": "BruceBerry", "link": "https://stackoverflow.com/users/104103/bruceberry"}, "edited": false, "score": 0, "creation_date": 1424301062, "post_id": 28591552, "comment_id": 45498107, "body": "Yeah I already detect loops, but I don&#39;t think I will handle fix points. I mark <code>VTable</code> cells as &quot;Evaluating&quot; so that I can detect loops dynamically (and I have a statically constructed dependency graph that I currently use to unvalidate <code>VTable</code> cells when the table is changed, but that I could also use for this purpose)"}], "answers": [{"comments": [{"owner": {"reputation": 1126, "user_id": 104103, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ccf1cf3aa6e5cacc9d60e5422cb0100f?s=128&d=identicon&r=PG", "display_name": "BruceBerry", "link": "https://stackoverflow.com/users/104103/bruceberry"}, "edited": false, "score": 0, "creation_date": 1424360395, "post_id": 28591798, "comment_id": 45524610, "body": "I&#39;ve seen the fibonacci example where I define the data structure for memoization in terms of calls to a recursive function (but outside the recursive function, so it is lazily built by the recursive function), is that the strategy you are suggesting? I&#39;m trying to understand the benefit of the approach: is it true that the only advantage I get is that I get implicit, correct memoization instead of having to do it myself?"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 1126, "user_id": 104103, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ccf1cf3aa6e5cacc9d60e5422cb0100f?s=128&d=identicon&r=PG", "display_name": "BruceBerry", "link": "https://stackoverflow.com/users/104103/bruceberry"}, "edited": false, "score": 0, "creation_date": 1424369349, "post_id": 28591798, "comment_id": 45530791, "body": "@BruceBerry: Yep, that&#39;s the strategy. And yeah, the main advantage is that you don&#39;t have to do memoization yourself. Expressing your whole computation as a lazy data structure also lets you extend the logic by just traversing the structure again, which can make your code a bit neater."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 4, "last_activity_date": 1424286306, "creation_date": 1424286306, "answer_id": 28591798, "question_id": 28591552, "link": "https://stackoverflow.com/questions/28591552/handle-dependency-resolution-functionally-in-haskell/28591798#28591798", "title": "Handle dependency resolution functionally in Haskell", "body": "<p>Haskell doesn't memoization by default because that would generally take up too much memory, so you can't just rely on <code>eval</code> doing the right thing. However, the nature of lazy evaluation means that data structures are, in a sense, memoized: each thunk in a large lazy structure is only evaluated once. This means that you can memoize a function by defining a large lazy data structure internally and replacing recursive calls with accesses into the structure\u2014each part of the structure will be evaluated at most once.</p>\n\n<p>I think the most elegant approach to model your spreadsheet would be a large, lazy directed graph with the cells as nodes and references as edges. Then you would need to define the <code>VTable</code> graph in a recursive way such that all recursion goes through the graph itself, which will memoize the result in the way I described above.</p>\n\n<p>There are a couple of handy ways to model a graph. One option would be to use an explicit map with integers as node identifiers\u2014<a href=\"http://hackage.haskell.org/package/containers-0.2.0.1/docs/Data-IntMap.html\" rel=\"nofollow\"><code>IntMap</code></a> or even an array of some sort could work. Another option is to use an existing graph library; this will save you some work and ensure you have a nice graph abstraction, but will take some effort up front to understand. I'm a big fan of the <a href=\"https://hackage.haskell.org/package/fgl\" rel=\"nofollow\">fgl</a>, the \"functional graph library\", but it does take a bit of up-front reading and thinking to understand. The performance isn't going to be very different because it's also implemented in terms of <code>IntMap</code>.</p>\n\n<p>Tooting my own horn a bit, I've written a couple of blog posts expanding on this answer: one about <a href=\"http://jelv.is/blog/Lazy-Dynamic-Programming\" rel=\"nofollow\">memoization with lazy structures</a> (with pictures!) and one about the <a href=\"http://jelv.is/blog/Generating-Mazes-with-Inductive-Graphs\" rel=\"nofollow\">functional graph library</a>. Putting the two ideas together should get you what you want, I believe.</p>\n"}], "owner": {"reputation": 1126, "user_id": 104103, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ccf1cf3aa6e5cacc9d60e5422cb0100f?s=128&d=identicon&r=PG", "display_name": "BruceBerry", "link": "https://stackoverflow.com/users/104103/bruceberry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 28591798, "answer_count": 1, "score": 1, "last_activity_date": 1424286306, "creation_date": 1424285445, "question_id": 28591552, "link": "https://stackoverflow.com/questions/28591552/handle-dependency-resolution-functionally-in-haskell", "title": "Handle dependency resolution functionally in Haskell", "body": "<p>I'm implementing something similar to a Spreadsheet engine in Haskell.</p>\n\n<p>There are <code>ETables</code>, which have rows of cells containing expressions in the form of ASTs (e.g. <code>BinOp + 2 2</code>), which can contain references to other cells of <code>ETables</code>.</p>\n\n<p>The main function should convert these <code>ETables</code> into  <code>VTables</code>, which contain a fully resolved value in the cell (e.g. the cell <code>BinOp + 2 2</code> should be resolved to <code>IntValue 4</code>). This is pretty easy when cells have no external references, because you can just build the value bottom up from the expression AST of the cell (e.g. <code>eval (BinOpExpr op l r) = IntValue $ (eval l) op (eval r)</code>, minus unboxing and typechecking) all the way to the table (<code>evalTable = (map . map) eval rows</code>)</p>\n\n<p>However, I can't think of a \"natural\" way of handling this when external references are thrown into the mix. Am I correct to assume that I can't just call <code>eval</code> on the referenced cell and use its value, because Haskell is not smart enough to cache the result and re-use it when that cell is independently evaluated?</p>\n\n<p>The best thing I came up with is using a <code>State [VTable]</code> which is progressively filled, so the caching is explicit (each eval call updates the state with the return value before returning). This should work, however it feels \"procedural\". Is there a more idiomatic approach available that I'm missing?</p>\n"}, {"tags": ["file", "haskell", "io", "int"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1424290872, "post_id": 28590534, "comment_id": 45492818, "body": "So what format is your file actually in?  Is it a flat file of 32 bit ints?  What you want is some sort of deserialization, from what I can tell."}], "answers": [{"tags": [], "owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "is_accepted": false, "score": 8, "last_activity_date": 1424283112, "creation_date": 1424283112, "answer_id": 28590823, "question_id": 28590534, "link": "https://stackoverflow.com/questions/28590534/how-to-read-file-as-int-not-as-string/28590823#28590823", "title": "How to read file as [Int], not as String?", "body": "<p>There is <a href=\"https://hackage.haskell.org/package/bytestring-0.9.2.1/docs/Data-ByteString.html\">Data.ByteString</a> which has an internal representation of strict <strong>Word8</strong> arrays.</p>\n\n<p>You use it pretty much as what you are already used to. Import it qualified, e.g.</p>\n\n<pre><code>import qualified Data.ByteString as B\n</code></pre>\n\n<p>and then do stuff like</p>\n\n<pre><code>main = do\n  str &lt;- B.getLine\n  let bytes = B.unpack str\n  print bytes\n</code></pre>\n\n<p>I am not sure how you got to believe that you need Int. You want a proper byte representation, e.g. <a href=\"https://hackage.haskell.org/package/base-4.7.0.0/docs/Data-Word.html#t:Word8\">Word8</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 4, "last_activity_date": 1424291476, "creation_date": 1424291476, "answer_id": 28593319, "question_id": 28590534, "link": "https://stackoverflow.com/questions/28590534/how-to-read-file-as-int-not-as-string/28593319#28593319", "title": "How to read file as [Int], not as String?", "body": "<p>You likely are asking for some form of deserialization, which should be thought of as a separate step.  First consider that you're reading in a binary file of some sort (i.e. it is not text).  For this we probably want a <code>bytestring</code> and can do:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as BL\n...\n    contents &lt;- BL.readFile someFile\n</code></pre>\n\n<p>After getting the contents of the file we can convert them from whatever form (<code>String</code>, <code>Text</code>, <code>ByteString</code> etc).  You say you want <code>[Int]</code> but that doesn't tell us what form the data is in - are these 32 bit integers in big endian?  64 bits?  How many are there, do you know? Lets assume 32 bit big endian ints... and lets assume the file consists purely of these values:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as BL\nimport Data.Binary.Get\nimport Control.Monad\nimport Foreign.Storable \nimport Data.Word \n\nreadAndDecode :: FilePath -&gt; IO [Int]\nreadAndDecode someFile =\n  do contents &lt;- BL.readFile someFile\n     let nrWord32 = fromIntegral (BL.length contents) `div` sizeOf (undefined :: Word32)\n     return $ runGet (map fromIntegral `fmap` replicateM nrWord32 getWord32be) contents\n</code></pre>\n\n<p>That is, we read the file, compute the number of 32 bit words in the file, decode, and convert each <code>Word32</code> into an <code>Int</code></p>\n"}], "owner": {"reputation": 396, "user_id": 601703, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/fcd22bb5a793d4430a312336d0a9a466?s=128&d=identicon&r=PG", "display_name": "dmitry", "link": "https://stackoverflow.com/users/601703/dmitry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 0, "accepted_answer_id": 28593319, "answer_count": 2, "score": 1, "last_activity_date": 1424291476, "creation_date": 1424282222, "question_id": 28590534, "link": "https://stackoverflow.com/questions/28590534/how-to-read-file-as-int-not-as-string", "title": "How to read file as [Int], not as String?", "body": "<p>I need to read file as bytes, not as chars.\nBut when I do getLine or getContents I get IO String, and need [Int], not String.\nWhat should I do?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 4, "creation_date": 1424280656, "post_id": 28589757, "comment_id": 45486657, "body": "Here&#39;s a hint: start with the form <code>a = 0.0 : zipWith4 g ? ? ? ?</code> where <code>g</code> is a function and the four <code>?</code>s are four lists. Then work out what <code>g</code> and the four <code>?</code>s should be (one of the <code>?</code>s will refer back to <code>a</code>)."}, {"owner": {"reputation": 8165, "user_id": 1742701, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/363fd9a9d8683f3f65f78e1ecde27f5c?s=128&d=identicon&r=PG", "display_name": "spencerlyon2", "link": "https://stackoverflow.com/users/1742701/spencerlyon2"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1424281464, "post_id": 28589757, "comment_id": 45487149, "body": "@ReidBarton, excellent hint. I was able to solve it! Should I post a separate answer, or just edit my original post?"}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1424281479, "post_id": 28589757, "comment_id": 45487158, "body": "@spencerlyon2 Separate answer. You can also accept it after a while."}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1424281676, "post_id": 28589757, "comment_id": 45487257, "body": "@ReidBarton Oh, I see. It&#39;s <code>a = 0.0 : zipWith4 g [0..] a c h</code>. Clever. And if you put <code>w_ave</code> at the beginning you can even express <code>g</code> as <code>f m w_ave</code>."}, {"owner": {"reputation": 8165, "user_id": 1742701, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/363fd9a9d8683f3f65f78e1ecde27f5c?s=128&d=identicon&r=PG", "display_name": "spencerlyon2", "link": "https://stackoverflow.com/users/1742701/spencerlyon2"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1424281794, "post_id": 28589757, "comment_id": 45487322, "body": "@Jefffrey, good point about moving <code>w_ave</code> to the front and then Haskell&#39;s partial application do the job for me. I&#39;ll implement that."}], "answers": [{"comments": [{"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1424281776, "post_id": 28590364, "comment_id": 45487311, "body": "You can express <code>g</code> in terms of <code>f</code> if you move <code>w_ave</code> after <code>m</code>: <code>g = f m w_ave</code>."}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1424281885, "post_id": 28590364, "comment_id": 45487382, "body": "You should also probably be using <code>[0..]</code> instead of <code>[1..]</code>."}, {"owner": {"reputation": 8165, "user_id": 1742701, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/363fd9a9d8683f3f65f78e1ecde27f5c?s=128&d=identicon&r=PG", "display_name": "spencerlyon2", "link": "https://stackoverflow.com/users/1742701/spencerlyon2"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1424281992, "post_id": 28590364, "comment_id": 45487453, "body": "@Jefffrey I had that originally, but I&#39;m actually working off some Python code I have that I believe to be correct. When I use <code>[1..]</code> I get the same answer as python, but <code>[0..]</code> results in a different answer. Perhaps this is showing a bug in the original python..."}, {"owner": {"reputation": 8165, "user_id": 1742701, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/363fd9a9d8683f3f65f78e1ecde27f5c?s=128&d=identicon&r=PG", "display_name": "spencerlyon2", "link": "https://stackoverflow.com/users/1742701/spencerlyon2"}, "reply_to_user": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 1, "creation_date": 1424282763, "post_id": 28590364, "comment_id": 45487925, "body": "Found the bug... it was actually in the <code>f</code> function. Our initial thought of <code>[0..]</code> is correct. Thanks for commenting."}], "tags": [], "owner": {"reputation": 8165, "user_id": 1742701, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/363fd9a9d8683f3f65f78e1ecde27f5c?s=128&d=identicon&r=PG", "display_name": "spencerlyon2", "link": "https://stackoverflow.com/users/1742701/spencerlyon2"}, "is_accepted": true, "score": 4, "last_activity_date": 1424318040, "last_edit_date": 1424318040, "creation_date": 1424281727, "answer_id": 28590364, "question_id": 28589757, "link": "https://stackoverflow.com/questions/28589757/infinite-recursive-list-from-function/28590364#28590364", "title": "Infinite recursive list from function", "body": "<p>Thanks to the hint from @ReidBarton I was able to solve this. Here is what I came up with:</p>\n\n<p>NOTE: as pointed out by @Jeffrey, to simplify the code and allow partial application to define the g function for us, I have re-defined <code>f</code> so that the <code>i</code>th element of <code>a</code> will be <code>f m w_ave i \u2191 (c!!i) (h!!i)</code> (I moved <code>w_ave</code> to be the second argument instead of the last one).</p>\n\n<p>This means the type of f is now <code>f :: OLG -&gt; Double -&gt; Int -&gt; Double -&gt; Double -&gt; Double -&gt; Double</code></p>\n\n<pre><code>alist :: OLG -&gt; [Double] -&gt; [Double] -&gt; [Double]\nalist m cs hs = as\n    where as = 0.0 : zipWith4 (f m w_ave) [0..] as cs hs\n</code></pre>\n"}], "owner": {"reputation": 8165, "user_id": 1742701, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/363fd9a9d8683f3f65f78e1ecde27f5c?s=128&d=identicon&r=PG", "display_name": "spencerlyon2", "link": "https://stackoverflow.com/users/1742701/spencerlyon2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 28590364, "answer_count": 1, "score": 2, "last_activity_date": 1424318040, "creation_date": 1424279913, "last_edit_date": 1424280492, "question_id": 28589757, "link": "https://stackoverflow.com/questions/28589757/infinite-recursive-list-from-function", "title": "Infinite recursive list from function", "body": "<p>Suppose I have two infinite lists <code>c</code> and <code>h</code>. </p>\n\n<p>I also have a function </p>\n\n<p><code>f :: OLG -&gt; Int -&gt; Double -&gt; Double -&gt; Double -&gt; Double -&gt; Double</code>,</p>\n\n<p>where <code>OLG</code> is a data type I defined.</p>\n\n<p>I would like to construct a third infinite list that has the following form</p>\n\n<pre><code>a :: [Double]\na = [     0.0, \n     f m 0 \u2191 (c!!0) (h!!0) w_ave,\n     f m 1 \u2191 (c!!1) (h!!1) w_ave,\n     f m 2 \u2191 (c!!2) (h!!2) w_ave,\n     f m 3 \u2191 (c!!3) (h!!3) w_ave,\n     f m 4 \u2191 (c!!4) (h!!4) w_ave,\n     f m 5 \u2191 (c!!5) (h!!5) w_ave,\n     f m 6 \u2191 (c!!6) (h!!6) w_ave,\n     \u22ee,\n     f m i \u2191 (c!!i) (h!!i) w_ave,\n     ]\n</code></pre>\n\n<p>where  <code>m :: OLG</code>, <code>c :: [Double]</code>, <code>h :: [Double]</code> and <code>w_ave :: Double</code>. The uparrow (<code>\u2191</code>) represents a placeholder that says the third argument of <code>f</code> should be the previous element of the list we are constructing. </p>\n\n<p>I imagine there is a clean/recursive way to do this, but being new to Hasekll I can't think of it. Perhaps I need to use <code>iterate</code> somehow?</p>\n\n<p>This problem reminds me a bit of the standard implementation of the infinite list of fibonacci numbers</p>\n\n<pre><code>fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>in that successive elements of the list are computed by applying a function to previous list elements.</p>\n"}, {"tags": ["haskell", "io", "ghc"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 7, "creation_date": 1424274535, "post_id": 28587552, "comment_id": 45482424, "body": "Anything you see with <code>#</code> after the name means it&#39;s a &quot;magic&quot; hash, it&#39;s a built-in to GHC.  See <a href=\"https://www.fpcomplete.com/blog/2015/02/primitive-haskell\" rel=\"nofollow noreferrer\">this recent post</a> for a thorough explanation of how it works, at least."}], "answers": [{"comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1424281080, "post_id": 28588798, "comment_id": 45486914, "body": "Hah, now I&#39;m tempted to try acme-realworld."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 2, "creation_date": 1424293680, "post_id": 28588798, "comment_id": 45494436, "body": "I wouldn&#39;t say that the world-passing model is fundamentally broken just because it wouldn&#39;t be sound if you used internal implementation details; the same applies to many abstractions including things like Data.Map! Other languages <i>explicitly</i> use world-passing <i>and</i> expose the &quot;worlds&quot; to user code; they use type system features to ensure linearity, where Haskell ensures linearity by not exposing any operations that could possibly use the world non-linearly."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1424326638, "post_id": 28588798, "comment_id": 45505468, "body": "@Ben, it seems (to me) to make particularly little sense in the face of concurrency. It also requires some ... special care ... to prevent compiler optimizations from messing things up badly"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1424327834, "post_id": 28588798, "comment_id": 45505932, "body": "@dfeuer You can make the interpretation work for concurrency (which is always; the concurrency of your program isn&#39;t relevant because the world is concurrent) by remembering that the world returned from an IO-primitive includes <i>arbitrary</i> changes (from the point of view of the pure model), not just the ones the primitive makes. But this is exactly the same as the &quot;description-of-an-action&quot; model of IO; the changes in the real mutable world are arbitrary and unspecified by the <code>main</code> program. Either way you need to turn to operational semantics to really say anything about what&#39;s going on."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1424328084, "post_id": 28588798, "comment_id": 45506031, "body": "@dfeur I do actually prefer the &quot;description-of-an-action&quot; model for IO. But  I think the world-passing is a perfectly serviceable interpretation. They&#39;re both easier to come at from different starting points (world passing is easy to understand if you&#39;re down with state monads, actions are more intuitive if you like meta-programming). Claims that world-passing is a broken <i>model</i> (as opposed to that it has an annoying implementation in GHC) seem inconsistent with other languages using it explicitly and still having sound declarative semantics."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1452294151, "post_id": 28588798, "comment_id": 57121734, "body": "@Ben, a <i>practical</i> problem with world passing is that the compiler and libraries to be extremely conservative about inlining and reordering around <code>IO</code> actions to avoid performing real-world effects in the wrong order. This has proven to be a subtle and somewhat error-prone discipline, I believe, even as it seems to prevent some valid transformations. Operational monads and similar approaches keep the lines much clearer for much longer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452294248, "post_id": 28588798, "comment_id": 57121762, "body": "I don&#39;t really know anything about linear types, but it sounds like they at least have a smaller trusted base in this regard."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 9, "last_activity_date": 1424277688, "last_edit_date": 1424277688, "creation_date": 1424277385, "answer_id": 28588798, "question_id": 28587552, "link": "https://stackoverflow.com/questions/28587552/can-anybody-explain-ghcs-definition-of-io/28588798#28588798", "title": "Can anybody explain GHC&#39;s definition of IO?", "body": "<p>It's probably best not to think too deeply about GHC's implementation of <code>IO</code>, because that implementation is <em>weird</em> and <em>shady</em> and works most of the time by compiler magic and luck. The broken model that GHC uses is that an <code>IO</code> action is a function from the state of the entire real world to a value paired with a new state of the entire real world. For humorous proof that this is a strange model, see the <a href=\"https://hackage.haskell.org/package/acme-realworld\"><code>acme-realworld</code></a> package.</p>\n\n<p>The way this \"works\": Unless you import weird modules whose names start with <code>GHC.</code>, you can't ever touch any of these <code>State#</code> things. You're <em>only</em> given access to functions that deal in <code>IO</code> or <code>ST</code> and that ensure the <code>State#</code> can't be duplicated or ignored. This <code>State#</code> is threaded through the program, which ensures that the I/O primitives actually get called in the proper order. Since this is all for pretend, the <code>State#</code> is not a normal value at all\u2014it has a width of 0, taking 0 bits.</p>\n\n<p>Why does <code>State#</code> take a type argument? That's a much prettier bit of magic. <code>ST</code> uses that to force polymorphism needed to keep state threads separate. For <code>IO</code>, it's used with the special magic <code>RealWorld</code> type argument.</p>\n"}, {"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 2, "last_activity_date": 1424283403, "creation_date": 1424283403, "answer_id": 28590921, "question_id": 28587552, "link": "https://stackoverflow.com/questions/28587552/can-anybody-explain-ghcs-definition-of-io/28590921#28590921", "title": "Can anybody explain GHC&#39;s definition of IO?", "body": "<p>So in practice, an <code>IO x</code> is just some program (i.e. a schedule of CPU instructions, interrupts, whatever) which, when it's done executing, hands us a Haskell data structure of type <code>x</code>. The way that Haskell I/O works is by saying, \"we will (functionally) describe how to construct the program which does stuff, and then GHC will do its thing, you'll <em>get</em> that program, and then it's up to you to actually <em>run</em> it.\" The resulting program basically looks like an interleaving:</p>\n\n<pre><code>[IO stuff] -&gt; [Haskell code] -&gt; [IO stuff] -&gt; ...\n</code></pre>\n\n<p>and it's written functionally as a composition of a bunch of purely functional <code>[Haskell code] -&gt; [IO stuff]</code> blocks.</p>\n\n<p>Now, how can we <em>model</em> this with a real type class? One clever way is to accumulate all of the commands that you can send to the underlying OS as <code>Request</code> data structures, and the responses that the OS can send back as <code>Response</code> data structures. You can then model those blocks as functions between a list of requests and a list of responses. Here's a simple version of that model, heavily exploiting laziness:</p>\n\n<pre><code>type IO x = [Response] -&gt; ([Request], x)\n</code></pre>\n\n<p>The OS now provides this function with a lazy list -- don't call the head of it just yet, you have to first cons something onto the outgoing requests! -- and you produce this pair of a lazy list of requests and a lazy result. The OS reads your first request, does it, and provides the result as the first element of the Response. In this way you sort of get a fixed point operator. Now we see what <code>return</code> and <code>bind</code> look like:</p>\n\n<pre><code> -- return needs to yield a special symbol of type Request which stops the \n -- process of querying the OS.\n return x = ([Done], x) \n\n -- bind needs to split the responses between those fed to mx and the rest,\n -- assume that every request yields exactly one response  so we can examine\n -- just the length of x_requests.\n bind :: ([Response] -&gt; ([Request], x)) -&gt; \n         (x -&gt; [Response] -&gt; ([Request], y)) -&gt; \n         [Response] -&gt; ([Request], y)\n bind mx x_to_my responses = (init x_requests ++ y_requests, y)\n     where (x_requests, x) = mx responses\n           (y_requests, y) = x_to_my x $ drop (length x_requests - 1) responses\n</code></pre>\n\n<p>This should be <em>correct</em> but it's a little <em>confusing</em>. A little less confusing is to imagine a state monad with \"the real world\" inside, but unfortunately that is <em>incorrect</em>: </p>\n\n<pre><code>newtype IO x = RawIO (runIO :: RealWorld -&gt; (RealWorld, x))\n</code></pre>\n\n<p>What's wrong with this? Basically it's the fact that the original RealWorld persists. We might for example write:</p>\n\n<pre><code>RawIO $ \\world -&gt; let (world1, x) = runIO (putStrLn \"Name?\" &gt;&gt; getLine) world\n                      (world2, y) = runIO (putStrLn \"Age?\" &gt;&gt; getLine) world\n                  in (world1, y)\n</code></pre>\n\n<p>What does this do? It performs the computation in a branching universe: in world #1 it asks one question (Name?) and in world #2 it asks a different question (Age?). It then throws world #2 away, but keeps the answer that it got there.</p>\n\n<p>So we are living in world #1, it asks us our name, and then magically it knows our age. The side effect from world #2 (asking us our age) cannot happen due to referential transparency), but the result of it has been acquired. Whoops -- real I/O can't do that.</p>\n\n<p>Well, that's OK as long as we hide the <code>RawIO</code> constructor! We'll just make all of <em>our</em> functions well-behaved and be done with it. We can then write completely sane versions of bind and return:</p>\n\n<pre><code>return x = RawIO $ \\world -&gt; (world, x)\nbind mx x_to_my = RawIO $ \\world -&gt; let (world', x) = runIO mx world in \n    runIO (x_to_my x) world'\n</code></pre>\n\n<p>So when we introduce side-effectful functions into the language, we can just write them a wrapper which ignores the \"world\" argument and performs the side-effect when the function is run. We then have:</p>\n\n<pre><code>unsafePerformIO mx = let (_, x) = runIO mx (error \"RealWorld doesn't exist) in x\n</code></pre>\n\n<p>which can perform these I/O operations when GHC/GHCi <em>actually</em> needs them to happen.</p>\n"}, {"tags": [], "owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "is_accepted": false, "score": 0, "last_activity_date": 1606219865, "last_edit_date": 1606219865, "creation_date": 1605225400, "answer_id": 64813587, "question_id": 28587552, "link": "https://stackoverflow.com/questions/28587552/can-anybody-explain-ghcs-definition-of-io/64813587#64813587", "title": "Can anybody explain GHC&#39;s definition of IO?", "body": "<blockquote>\n<p>Can anybody explain GHC's definition of <code>IO</code>?</p>\n</blockquote>\n<p>It's based on the <em>pass-the-planet</em> model of I/O:</p>\n<blockquote>\n<p><em>An <code>IO</code> computation is a function that (logically) takes the state of the world, and returns a modified world as well as the return value. Of course, GHC does not actually pass the world around; instead, it passes a dummy \u201ctoken\u201d, to ensure proper sequencing of actions in the presence of lazy evaluation, and performs input and output as actual side effects!</em></p>\n</blockquote>\n<p>(from <a href=\"https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.168.4008&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">A History of Haskell</a> by Paul Hudak, John Hughes, Simon Peyton Jones and Philip Wadler; page 26 of 55.)</p>\n<p>Using that description as a guide:</p>\n<pre><code>newtype IO a   =  IO (FauxWorld -&gt; (# FauxWorld, a #))\n</code></pre>\n<p>where:</p>\n<pre><code>type FauxWorld =  State# RealWorld\n</code></pre>\n<p>Why bother with bulky world-values when the I/O model provides the option for using side-effects diligently?</p>\n<blockquote>\n<p><em>[...] a machinery whose most eminent characteristic is state [means] the gap between model and machinery is wide, and therefore costly to bridge. [...]<br>\nThis has in due time also been recognized by the protagonists of functional\nlanguages.[...]</em></p>\n<p><a href=\"https://people.inf.ethz.ch/wirth/Articles/GoodIdeas_origFig.pdf\" rel=\"nofollow noreferrer\">Niklaus Wirth.</a></p>\n</blockquote>\n<p>Now that we're on the topic of implementation details:</p>\n<blockquote>\n<p>I'm just curious as to why the particular GHC version is written like it is?</p>\n</blockquote>\n<p>It's primarily to avoid gratuitous runtime evaluation and heap usage:</p>\n<ul>\n<li><p><code>State# RealWorld</code> and the unboxed tuple <code>(# ..., ... #)</code> are <em>unlifted types</em> - in GHC, they don't take up space in the heap. Being unlifted also means they can be used immediately without prior evaluation.</p>\n</li>\n<li><p>The use of <code>State#</code> to define <code>IO</code> (rather than using a world-type directly)\nreduces <code>RealWorld</code> to an abstract tag-type:</p>\n<pre><code>type ST# s a   =  State# s -&gt; (# State# s, a #)\n\nnewtype IO a   =  IO (ST# RealWorld a)\n</code></pre>\n<p><code>ST#</code> can then be reused elsewhere:</p>\n<pre><code>newtype ST s a =  ST (ST# s a)\n</code></pre>\n<p>For more information, see John Launchbury and Simon Peyton Jones's <a href=\"https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.52.3656&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">State in Haskell</a>.</p>\n</li>\n</ul>\n<p>The <code>Realworld</code> and unlifted types are both GHC-specific extensions.</p>\n"}], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 1, "accepted_answer_id": 28588798, "answer_count": 3, "score": 5, "last_activity_date": 1606219865, "creation_date": 1424274067, "last_edit_date": 1598810493, "question_id": 28587552, "link": "https://stackoverflow.com/questions/28587552/can-anybody-explain-ghcs-definition-of-io", "title": "Can anybody explain GHC&#39;s definition of IO?", "body": "<p>The title is pretty self-descriptive, but there's one part that caught my attention:</p>\n<pre><code>newtype IO a = IO (State# RealWorld -&gt; (# State# RealWorld, a #))\n</code></pre>\n<p>Stripping the <code>newtype</code>, we get:</p>\n<pre><code>State# RealWorld -&gt; (# State# RealWorld, a #)\n</code></pre>\n<p>I don't know what <code>State#</code> stands for. Can we replace it with <code>State</code> like this:</p>\n<pre><code>State RealWorld -&gt; (State RealWorld, a)\n</code></pre>\n<p>And can that be expressed as this, then?</p>\n<pre><code>State (State RealWorld) a\n</code></pre>\n<p>This particular construct caught my attention.</p>\n<hr />\n<p>I know that conceptually,</p>\n<pre><code>type IO a  =  RealWorld -&gt; (a, RealWorld)\n</code></pre>\n<p>And @R.MartinhoFernandes told me that I can actually think about that implementation as <code>ST RealWorld a</code>, but I'm just curious why the particular GHC version is written like it is.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 3, "creation_date": 1424273629, "post_id": 28587132, "comment_id": 45481779, "body": "Why don&#39;t you just pass the current state into the functions that need it?"}], "answers": [{"comments": [{"owner": {"reputation": 2342, "user_id": 1683460, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2535857ac59d18baeda7b081c645f901?s=128&d=identicon&r=PG", "display_name": "Twan van Laarhoven", "link": "https://stackoverflow.com/users/1683460/twan-van-laarhoven"}, "edited": false, "score": 4, "creation_date": 1424273863, "post_id": 28587399, "comment_id": 45481953, "body": "It is better to define <code>read</code> as <code>read x = gets (runReader x)</code>. Then it actually works with the recent definitions of <code>Reader</code> and <code>State</code> in terms of <code>ReaderT</code> and <code>StateT</code>."}, {"owner": {"reputation": 175, "user_id": 795222, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/075eaa60bbd14440c06483a765108499?s=128&d=identicon&r=PG", "display_name": "Squid_Tamer", "link": "https://stackoverflow.com/users/795222/squid-tamer"}, "edited": false, "score": 0, "creation_date": 1424322655, "post_id": 28587399, "comment_id": 45504172, "body": "I accepted this answer because it answered the question most directly, and is probably going to be what a lot of people are looking for. I really like the other answers though, @bheklilr&#39;s answer certainly gives me a lot of food for thought."}], "tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": true, "score": 8, "last_activity_date": 1424274352, "last_edit_date": 1424274352, "creation_date": 1424273629, "answer_id": 28587399, "question_id": 28587132, "link": "https://stackoverflow.com/questions/28587132/making-read-only-functions-for-a-state-in-haskell/28587399#28587399", "title": "Making Read-Only functions for a State in Haskell", "body": "<p>It's not hard to inject the <code>Reader</code> monad into <code>State</code>:</p>\n\n<pre><code>read :: Reader s a -&gt; State s a\nread a = gets (runReader a)\n</code></pre>\n\n<p>then you could say</p>\n\n<pre><code>iReadData :: Reader MyState Int\niReadData = do\n    state &lt;- ask\n    return (getPieceOf state)\n</code></pre>\n\n<p>and call it as</p>\n\n<pre><code>x &lt;- read $ iReadData\n</code></pre>\n\n<p>this would allow you to build up <code>Reader</code>s into larger read-only sub-programs and inject them into <code>State</code> only where you need to combine them with mutators.</p>\n\n<p>It's not hard to extend this to a <code>ReaderT</code> and <code>StateT</code> at the top of your monad transformer stack (in fact, the definition above works exactly for this case, just change the type).  Extending it to a <code>ReaderT</code> and <code>StateT</code> in the middle of the stack is harder.  You basically need a function</p>\n\n<pre><code>lift1 :: (forall a. m0 a -&gt; m1 a) -&gt; t m0 a -&gt; t m1 a\n</code></pre>\n\n<p>for every monad transformer <code>t</code> in the stack above the <code>ReaderT</code>/<code>StateT</code>, which isn't part of the standard library.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1424276919, "post_id": 28588098, "comment_id": 45484119, "body": "And so we get the <code>mtl</code> vs. <code>transformers</code> philosophical disputation?"}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1424292367, "post_id": 28588098, "comment_id": 45493690, "body": "You can make this idea even simpler if you just write the instance for StateT, which is what State already newtypes to: <code>instance Monad m =&gt; MonadReader r (StateT r m) where ask = get; local = withStateT</code>. That gives you the same property that we can &quot;downgrade&quot; the type signature of iReadData to <code>MonadReader MyState m =&gt; m Int</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1424294580, "post_id": 28588098, "comment_id": 45494921, "body": "@ChrisDrost Wouldn&#39;t this overlap with the existing instance of <code>MonadReader r m =&gt; MonadReader r (StateT s m)</code>?  Besides, orphan instances are frowned upon."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "edited": false, "score": 0, "creation_date": 1424305705, "post_id": 28588098, "comment_id": 45499702, "body": "@bheklilr That&#39;s a good question; I didn&#39;t realize that MonadReader already had an instance for StateT. Yeah, scribbling it out in GHCi reveals that it <i>will</i> complain loudly about the overlapping instance even when the underlying monad doesn&#39;t fit the constraint for one of the instances."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 6, "last_activity_date": 1424275465, "creation_date": 1424275465, "answer_id": 28588098, "question_id": 28587132, "link": "https://stackoverflow.com/questions/28587132/making-read-only-functions-for-a-state-in-haskell/28588098#28588098", "title": "Making Read-Only functions for a State in Haskell", "body": "<p>I would recommend wrapping up the <code>State</code> monad in a <code>newtype</code> and defining a <code>MonadReader</code> instance for it:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nimport Control.Applicative\nimport Control.Monad.State\nimport Control.Monad.Reader\n\ndata MyState = MyState Int deriving Show\n\nnewtype App a = App\n    { runApp' :: State MyState a\n    } deriving\n        ( Functor\n        , Applicative\n        , Monad\n        , MonadState MyState\n        )\n\nrunApp :: App a -&gt; MyState -&gt; (a, MyState)\nrunApp app = runState $ runApp' app\n\ninstance MonadReader MyState App where\n    ask = get\n    local f m = App $ fmap (fst . runApp m . f) $ get\n\n\niWriteData :: MonadState MyState m =&gt; Int -&gt; m ()\niWriteData n = do\n    MyState s &lt;- get\n    put $ MyState $ s + n\n\niReadData :: MonadReader MyState m =&gt; m Int\niReadData = do\n    MyState s &lt;- ask\n    return $ s * 2\n\nbigFunction :: App ()\nbigFunction = do\n    iWriteData 5\n    iWriteData 10\n    num &lt;- iReadData\n    iWriteData num\n</code></pre>\n\n<p>This is certainly more code that @jcast's solution, but it follows the the tradition of implementing your transformer stack as a newtype wrapper, and by sticking with constraints instead of solidified types you can make strong guarantees about the use of your code while providing maximum flexibility for re-use.  Anyone using your code would be able to extend your <code>App</code> with transformers of their own while still using <code>iReadData</code> and <code>iWriteData</code> as intended.  You also don't have to wrap every call to a <code>Reader</code> monad with a <code>read</code> function, the <code>MonadReader MyState</code> functions are seamlessly integrated with functions in the <code>App</code> monad.</p>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 3, "last_activity_date": 1424306334, "last_edit_date": 1424306334, "creation_date": 1424291386, "answer_id": 28593295, "question_id": 28587132, "link": "https://stackoverflow.com/questions/28587132/making-read-only-functions-for-a-state-in-haskell/28593295#28593295", "title": "Making Read-Only functions for a State in Haskell", "body": "<p>Excellent answers by jcast and bhelkir, with exactly the first idea I thought of\u2014embedding <code>Reader</code> inside <code>State</code>.</p>\n\n<p>I think it's worthwhile to address this semi-side point of your question:</p>\n\n<blockquote>\n  <p>Using the <code>State</code> monad as usual in these functions works just fine, but I can't help but feel that I've given up Haskell's inherent safety and replicated a language where any function can mutate anything.</p>\n</blockquote>\n\n<p>That's a potential red flag, indeed.  I've always found that <code>State</code> works best for code with \"small\" states that can be contained within the lifetime of a single, brief application of <code>runState</code>.  My go-to example is numbering the elements of a <code>Traversable</code> data structure:</p>\n\n<pre><code>import Control.Monad.State\nimport Data.Traversable (Traversable, traverse)\n\ntag :: (Traversable t, Enum s) =&gt; s -&gt; t a -&gt; t (s, a)\ntag i ta = evalState (traverse step ta) init\n    where step a = do s &lt;- postIncrement\n                      return (s, a)\n\npostIncrement :: Enum s =&gt; State s s\npostIncrement = do result &lt;- get\n                   put (succ result)\n                   return result\n</code></pre>\n\n<p>You don't directly say so, but you make it sound you may have a big state value, with many different fields being used in many different ways within a long-lived <code>runState</code> call.  And perhaps it does need to be that way for your program at this point.  But one technique for coping with this might be to write your smaller <code>State</code> actions so that they only use narrower state types than the \"big\" one and then embed these into the larger <code>State</code> type with a function like this:</p>\n\n<pre><code>-- | Extract a piece of the current state and run an action that reads\n-- and modifies only that piece. \nsubstate :: (s -&gt; s') -&gt; (s' -&gt; s -&gt; s) -&gt; State s' a -&gt; State s a\nsubstate extract replace action =\n    do s &lt;- get\n       let (s', a) = runState action (extract s)\n       put (replace s' s)\n       return a\n</code></pre>\n\n<p>Schematic example</p>\n\n<pre><code>example :: State (A, B) Whatever \nexample = do foo &lt;- substate fst (,b) action1\n             bar &lt;- substate snd (a,) action2\n             return $ makeWhatever foo bar \n\n-- Can only touch the `A` component of the state\naction1 :: State A Foo\naction1 = ...\n\n-- Can only touch the `B` component of the state\naction2 :: State B Bar\naction2 = ...\n</code></pre>\n\n<p>Note that the <code>extract</code> and <code>replace</code> functions constitute a <em>lens</em>, and there are libraries for that, which may even already include a function like this.</p>\n"}], "owner": {"reputation": 175, "user_id": 795222, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/075eaa60bbd14440c06483a765108499?s=128&d=identicon&r=PG", "display_name": "Squid_Tamer", "link": "https://stackoverflow.com/users/795222/squid-tamer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 457, "favorite_count": 0, "accepted_answer_id": 28587399, "answer_count": 3, "score": 11, "last_activity_date": 1424306334, "creation_date": 1424272905, "question_id": 28587132, "link": "https://stackoverflow.com/questions/28587132/making-read-only-functions-for-a-state-in-haskell", "title": "Making Read-Only functions for a State in Haskell", "body": "<p>I often end up in a situation where it's very convenient to be using the <code>State</code> monad, due to having a lot of related functions that need to operate on the same piece of data in a semi-imperative way. </p>\n\n<p>Some of the functions need to read the data in the State monad, but will never need to change it. Using the <code>State</code> monad as usual in these functions works just fine, but I can't help but feel that I've given up Haskell's inherent safety and replicated a language where any function can mutate anything. </p>\n\n<p>Is there some type-level thing that I can do to ensure that these functions can only <em>read</em> from the <code>State</code>, and never write to it?</p>\n\n<p>Current situation:</p>\n\n<pre><code>iWriteData :: Int -&gt; State MyState ()\niWriteData n = do \n    state &lt;- get\n    put (doSomething n state)\n\n-- Ideally this type would show that the state can't change.\niReadData :: State MyState Int\niReadData = do \n    state &lt;- get\n    return (getPieceOf state)\n\nbigFunction :: State MyState ()\nbigFunction = do\n    iWriteData 5\n    iWriteData 10\n    num &lt;- iReadData  -- How do we know that the state wasn't modified?\n    iWRiteData num\n</code></pre>\n\n<p>Ideally <code>iReadData</code> would probably have the type <code>Reader MyState Int</code>, but then it doesn't play nicely with the <code>State</code>. Having <code>iReadData</code> be a regular function seems to be the best bet, but then I have to go through the gymnastics of explicitly extracting and passing it the state every time it's used. What are my options?</p>\n"}, {"tags": ["haskell", "syntax", "types", "record"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1424271938, "post_id": 28586639, "comment_id": 45480651, "body": "Note that <code>fansOfBook</code> is applied to too few arguments, in your example; it&#39;s missing its second argument, <code>bookDatabase</code>. With a list comprehension, you could do: <code>fansOfBook title db = concat [bookFans b | b &lt;- db, bookTitle b == title]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 4249860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0d3b733d436d096a8077b56186c984?s=128&d=identicon&r=PG&f=1", "display_name": "Behtx3", "link": "https://stackoverflow.com/users/4249860/behtx3"}, "edited": false, "score": 0, "creation_date": 1424272733, "post_id": 28586804, "comment_id": 45481150, "body": "Thank you for your explanation!"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 3, "last_activity_date": 1424271976, "creation_date": 1424271976, "answer_id": 28586804, "question_id": 28586639, "link": "https://stackoverflow.com/questions/28586639/haskell-record-syntax-returning-a-record-with-specified-field-value/28586804#28586804", "title": "Haskell record syntax returning a record with specified field value", "body": "<p>What you have to do is a <code>filter</code> operation on your <code>Database</code>:</p>\n\n<pre><code>filter (\\x -&gt; (bookTitle x) == title) db\n</code></pre>\n\n<p>where <code>db</code> is of type <code>Database</code> and <code>title</code> is of type <code>Title</code> which you are giving as input.</p>\n\n<p>That will give you a list of all <code>[Book]</code> with that specific title. Now you have to extract out the <code>Fan</code> from it using a <code>map</code> function. But note that this will give you a type of <code>[[Fan]]</code> as you can have multiple entries with the same title. So, you have to apply <code>concat</code> to get them as <code>[Fan]</code>. The function <code>concat</code> will concatenate the list of lists into a singe list.</p>\n"}], "owner": {"reputation": 47, "user_id": 4249860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0d3b733d436d096a8077b56186c984?s=128&d=identicon&r=PG&f=1", "display_name": "Behtx3", "link": "https://stackoverflow.com/users/4249860/behtx3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "accepted_answer_id": 28586804, "answer_count": 1, "score": 0, "last_activity_date": 1424271976, "creation_date": 1424271485, "question_id": 28586639, "link": "https://stackoverflow.com/questions/28586639/haskell-record-syntax-returning-a-record-with-specified-field-value", "title": "Haskell record syntax returning a record with specified field value", "body": "<p>I am new to Haskell and StackOverflow. I have a 'database' of books. I am trying to return the list of fans of a specified book.</p>\n\n<pre><code>type Title = String\ntype Author = String\ntype Year = Int\ntype Fan = String\n\n\ndata Book = Book { bookTitle :: Title\n                 , bookAuthor:: Author\n                 , bookYear  :: Year\n                 , bookFans  :: [Fan]\n                 }\n                 deriving (Show)\n\n\ntype Database = [Book]\n\nbookDatabase :: Database \nbookDatabase = [Book \"Harry Potter\" \"JK Rowling\" 1997 [\"Sarah\",\"Dave\"]]\n</code></pre>\n\n<p>I am not sure how to do this. I have tried using the filter function. I would like the below behavior.</p>\n\n<pre><code>fansOfBook :: Title -&gt; Database -&gt; [Fan]\n\nfansOfBook \"Harry Potter\"\n[\"Sarah\",\"Dave\"] \n</code></pre>\n"}, {"tags": ["haskell", "if-statement", "syntax"], "comments": [{"owner": {"reputation": 198, "user_id": 2505721, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EGO8H.jpg?s=128&g=1", "display_name": "Jmac", "link": "https://stackoverflow.com/users/2505721/jmac"}, "edited": false, "score": 2, "creation_date": 1424268660, "post_id": 28584303, "comment_id": 45478549, "body": "Writing your code in a text editor and importing it into GHCI raised no syntax errors for me. Are you typing this interactively into GHCI?"}, {"owner": {"reputation": 65, "user_id": 3343895, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c8cb9e9c49219c017d38152353034dff?s=128&d=identicon&r=PG&f=1", "display_name": "LewisDavie", "link": "https://stackoverflow.com/users/3343895/lewisdavie"}, "reply_to_user": {"reputation": 198, "user_id": 2505721, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EGO8H.jpg?s=128&g=1", "display_name": "Jmac", "link": "https://stackoverflow.com/users/2505721/jmac"}, "edited": false, "score": 0, "creation_date": 1424272974, "post_id": 28584303, "comment_id": 45481315, "body": "I&#39;m using Notepad++ to write the code and WinGHCi to execute it."}], "answers": [{"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1424277497, "post_id": 28584358, "comment_id": 45484544, "body": "While this answer isn&#39;t wrong, it doesn&#39;t address the question of why the original program doesn&#39;t compile, and it could give the impression that one must use guards rather than if/then/else here."}, {"owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1424288868, "post_id": 28584358, "comment_id": 45491599, "body": "Ok, thanks, I&#39;ll clarify that this is an alternative."}], "tags": [], "owner": {"reputation": 34030, "user_id": 1993366, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dGJXl.png?s=128&g=1", "display_name": "vikingsteve", "link": "https://stackoverflow.com/users/1993366/vikingsteve"}, "is_accepted": false, "score": 3, "last_activity_date": 1424288909, "last_edit_date": 1424288909, "creation_date": 1424264666, "answer_id": 28584358, "question_id": 28584303, "link": "https://stackoverflow.com/questions/28584303/syntax-of-if-else-in-haskell/28584358#28584358", "title": "Syntax of If-Else in Haskell?", "body": "<p>An alternative (and arguably more concise) approach could be considered, using <em>guards</em>:</p>\n\n<pre><code>alg n\n    | n == 0 = 1 \n    | n &lt; 5 = n \n    | otherwise = alg(n-1) * alg(n-2) * alg(n-3) * alg(n-4)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1424265287, "post_id": 28584440, "comment_id": 45476363, "body": "<i>Further</i> or at the same column."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1424267713, "post_id": 28584440, "comment_id": 45477950, "body": "This is not true, indentation plays no role in an <code>if</code> expression."}, {"owner": {"reputation": 65, "user_id": 3343895, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c8cb9e9c49219c017d38152353034dff?s=128&d=identicon&r=PG&f=1", "display_name": "LewisDavie", "link": "https://stackoverflow.com/users/3343895/lewisdavie"}, "edited": false, "score": 0, "creation_date": 1424270986, "post_id": 28584440, "comment_id": 45480086, "body": "Thank you very much, folks! You&#39;ve shown me how to use pattern guards and how to indent properly in Haskell."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1424271467, "post_id": 28584440, "comment_id": 45480374, "body": "@ReidBarton What makes you think indentation doesn&#39;t affect if-expressions?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1424273556, "post_id": 28584440, "comment_id": 45481714, "body": "Layout blocks occur only after the keywords <code>do</code>, <code>let</code>, <code>of</code> and <code>where</code> and their effect is to insert braces and semicolons. The syntax of an if-expression is just &quot;<code>if</code> expr <code>then</code> expr <code>else</code> expr&quot; which doesn&#39;t involve any semicolons. See <a href=\"https://www.haskell.org/onlinereport/lexemes.html#sect2.7\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/lexemes.html#sect2.7</a> for more information about layout."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1424274073, "post_id": 28584440, "comment_id": 45482093, "body": "Unbelievable... It turns out it <i>does</i> work if you indent it wrong. In spite of this: <a href=\"https://ghc.haskell.org/trac/haskell-prime/wiki/DoAndIfThenElse\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/haskell-prime/wiki/DoAndIfThenElse</a> How utterly bizarre..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1424280350, "post_id": 28584440, "comment_id": 45486437, "body": "The issue behind DoAndIfThenElse is not that <code>if</code> requires indentation (it does not) but that <code>do</code> requires it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1424290193, "post_id": 28584440, "comment_id": 45492446, "body": "@chi, can you expand on that?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1424297421, "post_id": 28584440, "comment_id": 45496469, "body": "@dfeuer Layout is a rule for introducing the <code>{</code>,<code>;</code>,<code>}</code> symbols in the source code. Some constructs use those symbols to split blocks into elements, e.g. <code>let</code> blocks, <code>do</code> blocks, etc. The <code>if</code> does not have any block to split, and the layout rule is immaterial for <code>if</code>. However, sometimes in a <code>do</code> block people like to start a line with <code>if ...</code> and then follow it with <code>then ...</code> and <code>else ...</code> at the same indentation level. This inserts an extra <code>;</code> since we are in a <code>do</code> block, and the parser complains (hence the proposal to loosen the parser). But a standalone <code>if</code> has no such issues."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": -3, "last_activity_date": 1424336705, "last_edit_date": 1424336705, "creation_date": 1424264884, "answer_id": 28584440, "question_id": 28584303, "link": "https://stackoverflow.com/questions/28584303/syntax-of-if-else-in-haskell/28584440#28584440", "title": "Syntax of If-Else in Haskell?", "body": "<p>The answer is right there in the error message: your indentation is wrong. Specifically, you wrote</p>\n\n<pre><code>else if ...\n  then ...\n  else ...\n</code></pre>\n\n<p>The <code>then</code> and <code>else</code> keywords needs to be indented further than the matching <code>if</code> keyword:</p>\n\n<pre><code>else if ...\n       then ...\n       else ...\n</code></pre>\n\n<p><strong>Edit:</strong> Nope, it turns it I'm wrong. I've tried with several different mis-indentations of <code>if</code>, and it all works fine. I have no idea what your original problem was. (Tab characters, maybe?)</p>\n\n<p>Regardless, as @vikingsteve rightly points out, in this instance you can do it nicer with pattern guards:</p>\n\n<pre><code>alg n\n    | condition1 = ...\n    | condition2 = ...\n    | condition3 = ...\n    | condition4 = ...\n</code></pre>\n\n<p>It's usually much more readable to do it this way when possible. (It's not always so easy, of course...)</p>\n"}, {"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 4, "last_activity_date": 1424267813, "creation_date": 1424267813, "answer_id": 28585414, "question_id": 28584303, "link": "https://stackoverflow.com/questions/28584303/syntax-of-if-else-in-haskell/28585414#28585414", "title": "Syntax of If-Else in Haskell?", "body": "<p>There is nothing wrong with the lines you wrote in isolation, as you can check by copying them into a new Haskell source file. If GHC is reporting an error on one of these lines, then the real error is probably just before these lines, perhaps an unmatched parenthesis or if-then with no else or something similar.</p>\n"}], "owner": {"reputation": 65, "user_id": 3343895, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c8cb9e9c49219c017d38152353034dff?s=128&d=identicon&r=PG&f=1", "display_name": "LewisDavie", "link": "https://stackoverflow.com/users/3343895/lewisdavie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3056, "favorite_count": 1, "accepted_answer_id": 28585414, "answer_count": 3, "score": 2, "last_activity_date": 1424336705, "creation_date": 1424264474, "question_id": 28584303, "link": "https://stackoverflow.com/questions/28584303/syntax-of-if-else-in-haskell", "title": "Syntax of If-Else in Haskell?", "body": "<p>I've been looking at other similar questions but I still can't work out the problem here. I'll preface this by saying that yes, this is homework, but I'm at the point where I don't know where I'm wrong. The task is to rewrite a recursive algorithm we were given, that returns 1 if n is 0, n if n is less than 5, else it does the last line of code here:</p>\n\n<pre><code>alg n = if (n == 0)\n    then 1 \n    else if (n&lt;5) \n        then n\n        else alg(n-1) * alg(n-2) * alg(n-3) * alg(n-4)\n</code></pre>\n\n<p>The error I get is a parse error (possibly incorrect indentation or mismatched brackets) in WinGHCi. I've checked lots of articles on how to properly structure if statements in Haskell but I'm still a beginner, so I have no idea where I'm going wrong. If somebody is able to tell me what in there is incorrect to avoid future mistakes, I'd be very grateful.</p>\n"}, {"tags": ["haskell", "gadt"], "answers": [{"comments": [{"owner": {"reputation": 1064, "user_id": 12153248, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-f7ubefVLzQg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdOhhV81djlo9daQq8Jy-mYdaQz5A/photo.jpg?sz=128", "display_name": "Ari Fordsham", "link": "https://stackoverflow.com/users/12153248/ari-fordsham"}, "edited": false, "score": 0, "creation_date": 1615913042, "post_id": 28582695, "comment_id": 117837074, "body": "Excellent answer! Technical nitpick: Whilst the core Haskell98 language uses a Hindley-Milner typesystem, GHC uses the more powerful System F."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 25, "last_activity_date": 1424259430, "creation_date": 1424259430, "answer_id": 28582695, "question_id": 28582210, "link": "https://stackoverflow.com/questions/28582210/type-inference-with-gadts-a0-is-untouchable/28582695#28582695", "title": "Type inference with GADTs - a0 is untouchable", "body": "<p>Well, first note that this has nothing to do with the particular <code>print x</code>: you get the same error when ending <code>main</code> with e.g. <code>putStrLn \"done\"</code>.</p>\n\n<p>So the problem is indeed in the case block, namely in that <em>only the last statement of a <code>do</code> is required to have the type</em> of the <code>do</code> block's signature. The other statements merely have to be in the same monad, i.e. <code>IO a0</code> rather than <code>IO ()</code>.</p>\n\n<p>Now, usually this <code>a0</code> is inferred from the statement itself, so for instance you can write</p>\n\n<pre><code>do getLine\n   putStrLn \"discarded input\"\n</code></pre>\n\n<p>though <code>getLine :: IO String</code> rather than <code>IO ()</code>. However, in your example the information <code>print :: ... -&gt; IO ()</code> comes from inside the <code>case</code> block, <em>from a GADT match</em>. And such GADT matches behave differently from other Haskell statements: basically, they don't let any type information escape its scope, because if the information came from the GADT constructor then it's not correct outside of the <code>case</code>.</p>\n\n<p>In that particular example, it seems obvious enough that <code>a0 ~ ()</code> has nothing at all to do with the <code>a1 ~ Int</code> from the GADT match, but in general, such a fact could only be proven if GHC traced <em>for all type information</em> where it came from. I don't know if that's even possible, it would certainly be more complicated than Haskell's Hindley-Milner system, which heavily relies on <em>unifying</em> type information, which essentially assumes that it doesn't matter where the information came from.</p>\n\n<p>Therefore, GADT matches simply act as a rigid &ldquo;type information diode&rdquo;: the stuff inside can never be used to determine types on the outside, like that the <code>case</code> block as a whole should be <code>IO ()</code>.</p>\n\n<p>However, you can manually assert that, with the rather ugly</p>\n\n<pre><code>  (case x of\n     A v -&gt; print v\n    ) :: IO ()\n</code></pre>\n\n<p>or by writing</p>\n\n<pre><code>  () &lt;- case x of\n          A v -&gt; print v\n</code></pre>\n"}], "owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 841, "favorite_count": 3, "accepted_answer_id": 28582695, "answer_count": 1, "score": 14, "last_activity_date": 1586890660, "creation_date": 1424258079, "question_id": 28582210, "link": "https://stackoverflow.com/questions/28582210/type-inference-with-gadts-a0-is-untouchable", "title": "Type inference with GADTs - a0 is untouchable", "body": "<p>Lets say I have this program</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata My a where\n  A :: Int  -&gt; My Int\n  B :: Char -&gt; My Char\n\n\nmain :: IO ()\nmain = do\n  let x = undefined :: My a\n\n  case x of\n    A v -&gt; print v\n\n  -- print x\n</code></pre>\n\n<p>compiles fine.</p>\n\n<p>But when I comment in the <code>print x</code>, I get:</p>\n\n<pre><code>gadt.hs: line 13, column 12:\n  Couldn't match type \u2018a0\u2019 with \u2018()\u2019\n    \u2018a0\u2019 is untouchable\n      inside the constraints (a1 ~ GHC.Types.Int)\n      bound by a pattern with constructor\n                 Main.A :: GHC.Types.Int -&gt; Main.My GHC.Types.Int,\n               in a case alternative\n      at /home/niklas/src/hs/gadt-binary.hs:13:5-7\n  Expected type: GHC.Types.IO a0\n    Actual type: GHC.Types.IO ()\n  In the expression: System.IO.print v\n  In a case alternative: Main.A v -&gt; System.IO.print v\n</code></pre>\n\n<p>Why do I get this error in line 13 (<code>A v -&gt; print v</code>) instead of only in the <code>print x</code> line?</p>\n\n<p>I thought the first occurrence should determine the type.</p>\n\n<p>Please enlighten me :)</p>\n"}, {"tags": ["string", "haskell", "filtering"], "comments": [{"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1424250438, "post_id": 28579534, "comment_id": 45467514, "body": "I don&#39;t understand the task - you want to drop all those words which contain none of the letters in <code>&quot;poultry outwits ants&quot;</code>?"}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "reply_to_user": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1424250460, "post_id": 28579534, "comment_id": 45467525, "body": "@FrerichRaabe that contain none of the letters yes, but I mean extended to something like &quot;years&quot; being filtered away as well because it contains &#39;e&#39;"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1424250495, "post_id": 28579534, "comment_id": 45467540, "body": "So you really want <code>letters :: Data.Set Char</code>, not a list?"}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1597395754, "post_id": 28579534, "comment_id": 112124694, "body": "It&#39;s funny, coming back to this five years later, and I honestly don&#39;t remember ever making this post or what the original context for this was...."}], "answers": [{"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1424251007, "post_id": 28579723, "comment_id": 45467813, "body": "I tried to think of a way to use filter, but couldn&#39;t wrap my head around it... Guess the solution was too simple... Thanks!"}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1424251224, "post_id": 28579723, "comment_id": 45467931, "body": "It you want to be a Haskell hipster you could make it point-free, shortening the definition to <code>filterWords = filter (all (`elem` &quot;poultry outwits ants&quot;)) . words</code>. Actually, now that I see it - it still looks fairly comprehensible IMHO!"}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1424251269, "post_id": 28579723, "comment_id": 45467952, "body": "I actually did... Now to filter away stuff that doesn&#39;t fit the number of letters..."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1424253521, "post_id": 28579723, "comment_id": 45469337, "body": "What does <code>doesn&#39;t fit the number of letters</code> mean?"}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1424253654, "post_id": 28579723, "comment_id": 45469423, "body": "Some of the words I get have more copies of the same letter than there are in the original"}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "reply_to_user": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1424265506, "post_id": 28579723, "comment_id": 45476490, "body": "@ElectricCoffee I extended my answer, now that you specified your requirements more exactly."}], "tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": true, "score": 4, "last_activity_date": 1424265465, "last_edit_date": 1424265465, "creation_date": 1424250666, "answer_id": 28579723, "question_id": 28579534, "link": "https://stackoverflow.com/questions/28579534/how-do-you-filter-a-list-of-strings-by-a-string-in-haskell/28579723#28579723", "title": "How do you filter a list of strings by a string in haskell?", "body": "<p>A good way to filter a list of things (e.g. words) is to use the <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:filter\" rel=\"nofollow\"><code>filter</code></a> function. What you need to provide is a predicate which tells whether a string should be included or not. You commented that you want to include those strings which consists of letters in <code>\"poultry outwits ants\"</code>, so that would be</p>\n\n<pre><code>filterWords :: String -&gt; [String]\nfilterWords str = filter acceptableWord (words str)\n  where\n    acceptableWord = all (`elem` \"poultry outwits ants\")\n</code></pre>\n\n<p>Now, in another comment you wrote that</p>\n\n<blockquote>\n  <p>Some of the words I get have more copies of the same letter than there are in the original.</p>\n</blockquote>\n\n<p>So I suspect what you <em>really</em> want is to figure out which words can be formed out of the letters in <code>\"poultry outwits ants\"</code>.</p>\n\n<p>To do this, you could count how often each character appears in the given word (and in the mgic string <code>poultry outwits ants</code>) and then verify that not only each letter in the word appears in the magic string but also that the letter doesn't appear more often than in the magic string.</p>\n\n<p>I'd start by defining a function which calculates 'character frequency table', i.e. it counts how often each character occurs in the given string:</p>\n\n<pre><code>freq :: String -&gt; [(Char, Int)]\nfreq = map (\\s -&gt; (head s, length s)) . group . sort\n</code></pre>\n\n<p>Furthermore, I'd define a function which tells whether one frequency table <code>x</code> is a \"subset\" of another table <code>y</code>, i.e. it verifies that each character in <code>x</code> also appears in <code>y</code>, but it doesn't occur more often:</p>\n\n<pre><code>subset :: [(Char, Int)] -&gt; [(Char, Int)] -&gt; Bool\nsubset x y = all f x\n  where\n    f (ch, occ) = case lookup ch y of\n                      Just occ' -&gt; occ &lt;= occ'\n                      Nothing   -&gt; False\n</code></pre>\n\n<p>You can then use this to define <code>acceptableWord</code> such that it only accepts words whose frequency table is a subset of the frequency table of the magic string, so we get:</p>\n\n<pre><code>filterWords :: String -&gt; [String]\nfilterWords str = filter acceptableWord (words str)\n  where\n    acceptableWord w = subset (freq w) (freq \"poultry outwits ants\")\n</code></pre>\n"}], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1510, "favorite_count": 0, "accepted_answer_id": 28579723, "answer_count": 1, "score": 3, "last_activity_date": 1424265465, "creation_date": 1424249981, "last_edit_date": 1424250709, "question_id": 28579534, "link": "https://stackoverflow.com/questions/28579534/how-do-you-filter-a-list-of-strings-by-a-string-in-haskell", "title": "How do you filter a list of strings by a string in haskell?", "body": "<p>I have a string containing letters I want to be sure are in the words in the list. Running it however results in it still leaving behind words that contain the undesired letters. </p>\n\n<p>Here's my function:</p>\n\n<pre><code>import Data.List    \n\nfilterWords :: String -&gt; [String]\nfilterWords str =\n  let strs      = words str\n      letters   = concat . words . nub $ \"poultry outwits ants\"\n      predicate = dropWhile (`elem` letters) ['a' .. 'z']\n  in  dropWhile (any (`elem` predicate)) strs\n</code></pre>\n\n<p>What do I need to change to make this work?</p>\n\n<p>To make it clear, I want to filter away any words that contain letters not in \"poultry outwits ants\", meaning a word like \"years\" would be dropped because despite containing <code>'y'</code>, <code>'a'</code>, <code>'r'</code>, and <code>'s'</code> which all satisfy the predicate, it also contains <code>'e'</code> which doesn't.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 1, "creation_date": 1424233760, "post_id": 28575977, "comment_id": 45461223, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/16154592/haskell-no-instance-for-eq-a-arising-from-a-use-of\">Haskell: No instance for (Eq a) arising from a use of `==&#39;</a>"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1424234005, "post_id": 28575977, "comment_id": 45461284, "body": "I don&#39;t think it&#39;s the same, because in that other question the function actually <i>needs</i> the <code>Eq a</code>, while in this one it can be rewritten to avoid it."}, {"owner": {"reputation": 4913, "user_id": 1682146, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e62f4b6f77a92fb607a5760654891592?s=128&d=identicon&r=PG", "display_name": "piojo", "link": "https://stackoverflow.com/users/1682146/piojo"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1424234452, "post_id": 28575977, "comment_id": 45461417, "body": "@&#216;rjanJohansen I think it&#39;s the same. Your function needs it, too. When you check whether [a] == [a], that implies checking the equality of a."}, {"owner": {"reputation": 1553, "user_id": 1428974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ccdfed8317b7e3c0ba237dc75ac6ab3?s=128&d=identicon&r=PG", "display_name": "Hashmush", "link": "https://stackoverflow.com/users/1428974/hashmush"}, "reply_to_user": {"reputation": 4913, "user_id": 1682146, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e62f4b6f77a92fb607a5760654891592?s=128&d=identicon&r=PG", "display_name": "piojo", "link": "https://stackoverflow.com/users/1682146/piojo"}, "edited": false, "score": 0, "creation_date": 1424234544, "post_id": 28575977, "comment_id": 45461441, "body": "@piojo No, it doesn&#39;t, because the check <code>[x] == [x]</code> isn&#39;t necessary."}, {"owner": {"reputation": 4913, "user_id": 1682146, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e62f4b6f77a92fb607a5760654891592?s=128&d=identicon&r=PG", "display_name": "piojo", "link": "https://stackoverflow.com/users/1682146/piojo"}, "reply_to_user": {"reputation": 1553, "user_id": 1428974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ccdfed8317b7e3c0ba237dc75ac6ab3?s=128&d=identicon&r=PG", "display_name": "Hashmush", "link": "https://stackoverflow.com/users/1428974/hashmush"}, "edited": false, "score": 0, "creation_date": 1424234802, "post_id": 28575977, "comment_id": 45461508, "body": "@Hashmush I mis-paraphrased, I meant <code>x == {x[0]}</code> (if you&#39;ll forgive me translating it into pseudo-code syntax). @&#216;rjanJohansen I see what you&#39;re saying about the error--while we can evaluate the first half of that check without needing the element to be in Eq, Haskell&#39;s actual equality check will have that type constraint. The  comparisons for checking <code>(equals :: [a] -&gt; [a] -&gt; Bool)</code> <code>[] == x</code> and <code>y == x</code> are not separate functions with separate signatures, so the latter needing Eq will mean the former needs it, too. In other words, different cases don&#39;t have different type signatures."}, {"owner": {"reputation": 1553, "user_id": 1428974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ccdfed8317b7e3c0ba237dc75ac6ab3?s=128&d=identicon&r=PG", "display_name": "Hashmush", "link": "https://stackoverflow.com/users/1428974/hashmush"}, "reply_to_user": {"reputation": 4913, "user_id": 1682146, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e62f4b6f77a92fb607a5760654891592?s=128&d=identicon&r=PG", "display_name": "piojo", "link": "https://stackoverflow.com/users/1682146/piojo"}, "edited": false, "score": 2, "creation_date": 1424234912, "post_id": 28575977, "comment_id": 45461547, "body": "@piojo The point is that you can write the function in such a way that it gets the type <code>[a] -&gt; Bool</code> and not <code>(Eq a) =&gt; [a] -&gt; Bool</code>."}, {"owner": {"reputation": 4913, "user_id": 1682146, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e62f4b6f77a92fb607a5760654891592?s=128&d=identicon&r=PG", "display_name": "piojo", "link": "https://stackoverflow.com/users/1682146/piojo"}, "reply_to_user": {"reputation": 1553, "user_id": 1428974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ccdfed8317b7e3c0ba237dc75ac6ab3?s=128&d=identicon&r=PG", "display_name": "Hashmush", "link": "https://stackoverflow.com/users/1428974/hashmush"}, "edited": false, "score": 0, "creation_date": 1424235265, "post_id": 28575977, "comment_id": 45461655, "body": "@Hashmush Oh, gotcha. But the OP&#39;s specific question was &quot;wtf is this error&quot;, so I&#39;m just explaining it. I&#39;m sure he&#39;ll be able to change the algorithm if he tries. :)"}, {"owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "edited": false, "score": 1, "creation_date": 1424237147, "post_id": 28575977, "comment_id": 45462183, "body": "By the way, the <code>[a] -&gt; Bool</code> part is called a <a href=\"https://wiki.haskell.org/Type_signature\" rel=\"nofollow noreferrer\">type signature</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1553, "user_id": 1428974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ccdfed8317b7e3c0ba237dc75ac6ab3?s=128&d=identicon&r=PG", "display_name": "Hashmush", "link": "https://stackoverflow.com/users/1428974/hashmush"}, "is_accepted": false, "score": 7, "last_activity_date": 1424234253, "creation_date": 1424234253, "answer_id": 28576080, "question_id": 28575977, "link": "https://stackoverflow.com/questions/28575977/haskell-no-instance-for-eq-a-arising-from-a-use-of/28576080#28576080", "title": "Haskell &quot;No instance for (Eq a) arising from a use of `/=&#39;&quot;", "body": "<p>In your code:</p>\n\n<pre><code>singleton x = x /= [] &amp;&amp; x == take 1 (x) \n</code></pre>\n\n<p>you do an equality test, <code>x == take 1 x</code>. This does a comparison of all the elements in the list to see if they are equal, so your elements must be \"comparable\". That's what <code>Eq a</code> is all about. The following fixes your problem:</p>\n\n<pre><code>singleton :: (Eq a) =&gt; [a] -&gt; Bool\nsingleton x = x /= [] &amp;&amp; x == take 1 (x)\n</code></pre>\n\n<p>But that is probably not what you want, since then your types must be comparable. You should be able to check if a list is a singleton without comparing the elements. But that is an exercise for you. Hint: It involves pattern matching.</p>\n"}], "owner": {"reputation": 47, "user_id": 3273580, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/2kSGW.png?s=128&g=1", "display_name": "Mr.Potatinator", "link": "https://stackoverflow.com/users/3273580/mr-potatinator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1288, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1424236739, "creation_date": 1424233547, "last_edit_date": 1424236739, "question_id": 28575977, "link": "https://stackoverflow.com/questions/28575977/haskell-no-instance-for-eq-a-arising-from-a-use-of", "title": "Haskell &quot;No instance for (Eq a) arising from a use of `/=&#39;&quot;", "body": "<p>I'm just starting to get into the world of functional programming in a class. As a part of an assignment, we have to write a function that determines if a list is a singleton or not (if the list has exactly 1 element inside of it)</p>\n\n<p>I've written the function and it works perfectly fine:</p>\n\n<pre><code>singleton x = x /= [] &amp;&amp; x == take 1 (x) \n</code></pre>\n\n<p>If I call singleton [1] it returns true as expected.\nIf I call singleton [] or singleton [1,2,3]  it returns false as expected.</p>\n\n<p>However, my professor wants us to properly document the code with (I'm not exactly sure what this is called, but it tell haskell what to expect as input and output from the function):</p>\n\n<pre><code>singleton :: [a] -&gt; Bool\n</code></pre>\n\n<p>As far as I can tell, this should work, but as soon as I have this, the compiler says \"No instance for (Eq a) arising from a use of '/='\"</p>\n\n<p>Could anyone point me in the right direction to get the code compiled with that (I really have no clue what it's called) bit of function declaration?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["windows", "haskell", "cabal"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1424235096, "post_id": 28575970, "comment_id": 45461604, "body": "The problem lies with the <code>network</code> package. On windows, I believe to install a newer version of <code>network</code> you need to link it with the ld which comes with the Haskell platform. If you have cygwin installed, you most certainly are using the ld which comes with cygwin. The simplest solution is to use the version of network which came with the Haskell platform. I use windows and I have never successfully been able to install a newer version of network when using the Haskell platform. The path separators are not related to this issue."}, {"owner": {"reputation": 1553, "user_id": 1428974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ccdfed8317b7e3c0ba237dc75ac6ab3?s=128&d=identicon&r=PG", "display_name": "Hashmush", "link": "https://stackoverflow.com/users/1428974/hashmush"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424237741, "post_id": 28575970, "comment_id": 45462378, "body": "I have a bit of a dependency problem, I <i>have</i> to (re)install <code>HTTP</code> and <code>network</code> because <code>taggy</code> requires a newer version of <code>attoparsec</code>. Would it help if I reinstalled, by compiling ghc, Haskell from &quot;inside&quot; cygwin?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1424242398, "post_id": 28575970, "comment_id": 45463976, "body": "This might help with installing <code>network</code> on Windows: <a href=\"http://neilmitchell.blogspot.com/2010/12/installing-haskell-network-library-on.html\" rel=\"nofollow noreferrer\">neilmitchell.blogspot.com/2010/12/&hellip;</a>"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1424242438, "post_id": 28575970, "comment_id": 45463988, "body": "Or even the <a href=\"http://neilmitchell.blogspot.com/2014/12/beta-testing-windows-minimal-ghc.html\" rel=\"nofollow noreferrer\">Minimal GHC Installer</a>"}, {"owner": {"reputation": 1553, "user_id": 1428974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ccdfed8317b7e3c0ba237dc75ac6ab3?s=128&d=identicon&r=PG", "display_name": "Hashmush", "link": "https://stackoverflow.com/users/1428974/hashmush"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1424331276, "post_id": 28575970, "comment_id": 45507269, "body": "@Cactus The MinGHC worked perfectly, thanks!"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1457852365, "post_id": 28575970, "comment_id": 59589381, "body": "@Hashmush since your question was answered, you should post the solution as an answer for the record..."}], "owner": {"reputation": 1553, "user_id": 1428974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ccdfed8317b7e3c0ba237dc75ac6ab3?s=128&d=identicon&r=PG", "display_name": "Hashmush", "link": "https://stackoverflow.com/users/1428974/hashmush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1424233525, "creation_date": 1424233525, "question_id": 28575970, "link": "https://stackoverflow.com/questions/28575970/building-on-windows-fails-during-linking", "title": "Building on Windows fails during linking", "body": "<p>I'm trying to build a small hobby project on Windows using the Haskell Platform. I've successfully run (from inside a Cygwin terminal)</p>\n\n<pre><code>$ cabal sandbox init\n$ cabal install --only-dependencies\n</code></pre>\n\n<p>But, trying to actually build the program results in a whole bunch of the following errors:</p>\n\n<pre><code>$ cabal build\n...\nC:\\cygwin\\home\\Rasmus\\haskell-subme\\.cabal-sandbox\\i386-windows-ghc-7.8.3\\HTTP-4000.2.19/libHSHTTP-4000.2.19.a(TCP.o):fake:(.text+0x196f): undefined reference to `shutdownWinSock'\n</code></pre>\n\n<p>(Full log here: <a href=\"https://gist.github.com/Prillan/8a22594fc21635e4f855\" rel=\"nofollow\">https://gist.github.com/Prillan/8a22594fc21635e4f855</a>)</p>\n\n<p><strong>I'm a complete beginner when it comes to building Haskell programs using cabal, what am I doing wrong? What's up with the combination of Windows and Linux path separators?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 0, "creation_date": 1424232007, "post_id": 28575554, "comment_id": 45460699, "body": "Provide an SSCCE please."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424235291, "post_id": 28575554, "comment_id": 45461665, "body": "What is <code>(zeroOrMore (alt parseEscapedQuotes (oneOrMore (notChar &#39;&quot;&#39;))))</code> supposed to do? What is <code>alt</code>? Why not just <code>zeroOrMore (notChar &#39;&quot;&#39;)</code>?"}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424272695, "post_id": 28575554, "comment_id": 45481118, "body": "Because I want to handle escaped quotes, @user2407038."}], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1424315229, "post_id": 28588528, "comment_id": 45502273, "body": "What&#39;s the meaning of <code>char &#39;\\\\&#39;</code> in <code>escaped</code>? PS - It&#39;s a custom parser library that I&#39;m working on."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1424315654, "post_id": 28588528, "comment_id": 45502374, "body": "also, my initial problem was that <code>zeroOrMore</code> has type <code>Parser a -&gt; Parser [a]</code>. I was trying to call <code>&lt;|&gt; (zeroOrMore (notQuote)) escaped</code>, but it was not working as expected: <code>runParser parseStringJValue &quot;\\&quot;fo\\&quot;obar\\&quot;&quot;</code> === <code>Just (S &quot;fo&quot;,&quot;obar\\&quot;&quot;)</code>"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1424330953, "post_id": 28588528, "comment_id": 45507129, "body": "The <code>char</code> function recognizes a single charater, e.g. <code>char &#39;x&#39;</code> recognizes the character &#39;x&#39;. The character literal <code>&#39;\\\\&#39;</code> is how you represent the backslash character."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1424331062, "post_id": 28588528, "comment_id": 45507179, "body": "So an escaped character sequence is a backslash character followed by a double-quote, backslash, the letter &#39;r&#39; or the letter &#39;t&#39; - and that&#39;s what the <code>escaped</code> parser recognizes."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1424276664, "creation_date": 1424276664, "answer_id": 28588528, "question_id": 28575554, "link": "https://stackoverflow.com/questions/28575554/parser-for-json-string/28588528#28588528", "title": "Parser for JSON String", "body": "<p>I don't know what parser combinator library you are using, but here is a working example using Parsec. I'm using monadic style to make it clearer what's going on, but it is easily translated to applicative style.</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.String\n\njchar :: Parser Char\njchar = escaped &lt;|&gt; anyChar\n\nescaped :: Parser Char\nescaped = do\n  char '\\\\'\n  c &lt;- oneOf ['\"', '\\\\', 'r', 't' ] -- etc.\n  return $ case c of\n            'r' -&gt; '\\r'\n            't' -&gt; '\\t'\n            _   -&gt; c\n\njstringLiteral :: Parser String\njstringLiteral = do\n  char '\"'\n  cs &lt;- manyTill jchar (char '\"') \n  return cs\n\ntest1 = parse jstringLiteral \"\" \"\\\"This is a test\\\"\"\ntest2 = parse jstringLiteral \"\" \"\\\"This is an embedded quote: \\\\\\\" after quote\\\"\"\ntest3 = parse jstringLiteral \"\" \"\\\"Embedded return: \\\\r\\\"\"\n</code></pre>\n\n<p>Note the extra level of backslashes needed to represent parser input as Haskell string literals. Reading the input from a file would make creating the parser input more convenient.</p>\n\n<p>The definition of the <code>manyTill</code> combinator is:</p>\n\n<pre><code>manyTill p end      = scan\n  where\n    scan  = do{ end; return [] }\n            &lt;|&gt;\n            do{ x &lt;- p; xs &lt;- scan; return (x:xs) }\n</code></pre>\n\n<p>and this might help you figure out why your definitions aren't working.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1424276664, "creation_date": 1424230789, "last_edit_date": 1424242102, "question_id": 28575554, "link": "https://stackoverflow.com/questions/28575554/parser-for-json-string", "title": "Parser for JSON String", "body": "<p>I'm trying to write a parser for a JSON String.</p>\n\n<p>A valid example, per my parser, would be: <code>\"\\\"foobar\\\"\"</code> or <code>\"\\\"foo\\\"bar\\\"\"</code>.</p>\n\n<p>Here's what I attempted, but it does not terminate:</p>\n\n<pre><code>parseEscapedQuotes :: Parser String\nparseEscapedQuotes = Parser f\n  where\n    f ('\"':xs) = Just (\"\\\"\", xs)\n    f _        = Nothing\n\nparseStringJValue :: Parser JValue\nparseStringJValue = (\\x -&gt; S (concat x)) &lt;$&gt; \n         ((char '\"') *&gt; \n         (zeroOrMore (alt parseEscapedQuotes (oneOrMore (notChar '\"')))) \n         &lt;* (char '\"'))\n</code></pre>\n\n<p>My reasoning is that, I can have a repetition of either escaped quotes <code>\"\\\"\"</code> or characters not equal to <code>\"</code>.</p>\n\n<p>But it's not working as I expected:</p>\n\n<pre><code>ghci&gt; runParser parseStringJValue \"\\\"foobar\\\"\"\nNothing\n</code></pre>\n"}, {"tags": ["string", "list", "haskell", "fold"], "answers": [{"comments": [{"owner": {"reputation": 765, "user_id": 2974642, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/8a3448409a891f6d3394aa81ab0b32d9?s=128&d=identicon&r=PG&f=1", "display_name": "UnworthyToast", "link": "https://stackoverflow.com/users/2974642/unworthytoast"}, "edited": false, "score": 2, "creation_date": 1424230795, "post_id": 28575509, "comment_id": 45460357, "body": "And it was that simple... Thank you. It&#39;s pretty difficult for me to get into the mindset required for developing functions in Haskell after coming right from C. And about <code>concat</code>, I know it exists, but I&#39;m trying to understand these basic functions by making my own versions. It&#39;s seemed to help in other languages in the past."}], "tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": false, "score": 12, "last_activity_date": 1424230545, "creation_date": 1424230545, "answer_id": 28575509, "question_id": 28575452, "link": "https://stackoverflow.com/questions/28575452/create-concatenate-function-in-haskell-string-string/28575509#28575509", "title": "Create concatenate function in Haskell: [String] -&gt; String", "body": "<p>You actually don't need the recursive call there. The function <code>foldr</code> already simulates a recursive call. All you need to do is use:</p>\n\n<pre><code>concatenate :: [String] -&gt; String\nconcatenate ls = foldr (++) \"\" ls\n</code></pre>\n\n<p>And remember that there's a <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:concat\" rel=\"noreferrer\"><code>concat</code> function</a> already, which is more generic, as it works on any list of list (as opposed to simply list of strings).</p>\n"}], "owner": {"reputation": 765, "user_id": 2974642, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/8a3448409a891f6d3394aa81ab0b32d9?s=128&d=identicon&r=PG&f=1", "display_name": "UnworthyToast", "link": "https://stackoverflow.com/users/2974642/unworthytoast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8186, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1424230545, "creation_date": 1424230106, "question_id": 28575452, "link": "https://stackoverflow.com/questions/28575452/create-concatenate-function-in-haskell-string-string", "title": "Create concatenate function in Haskell: [String] -&gt; String", "body": "<p>I'm having a lot of trouble getting this function to work:</p>\n\n<pre><code>concatenate :: [String] -&gt; String\n</code></pre>\n\n<p>It is designed to simply take a list of strings and return a single string that is the result of the concatenations of each element of the list from head to tail. I'm trying to stay within the <code>map</code>, <code>foldl</code>, and <code>foldr</code> functions. I feel like I know what the concept of these functions do well enough, but the most common problem I'm running into is that I'm having a conflict of types. GHC will expect a [Char] for example, and I'll put in code that is apparently trying to use a [[Char]] without me knowing it.</p>\n\n<p>For example: <code>concatenate (x:xs) = foldr (++) x (concatenate xs)</code></p>\n\n<p>And I get the following compile error:</p>\n\n<pre><code>Couldn't match type `Char' with `[Char]'\nExpected type: [[Char]]\n  Actual type: String\nIn the return type of a call of `concatenate'\nIn the third argument of `foldr', namely `(concatenate xs)'\nIn the expression: foldr (++) x (concatenate xs)\n</code></pre>\n\n<p>I'm <em>very</em> new to Haskell, so please feel free to laugh. Harshness is expected, and welcomed, as long as an explanation fit for a newbie is also included. Thank you for any and all help.</p>\n"}, {"tags": ["algorithm", "haskell", "state-monad", "breadth-first-search"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424222141, "post_id": 28573287, "comment_id": 45457992, "body": "Translating imperative algorithms to a functional language is at best difficult and sometimes essentially impossible. A &quot;one-to-one&quot; translation of your pseudocode to Haskell will likely be very ugly. A good starting point is a function <code>bfs&#39; :: Ord a =&gt; Graph a -&gt; a -&gt; State (S.Set a) (Tree a)</code> which performs the BFS starting at the given node, and the <code>S.Set a</code> is the visited nodes. You shouldn&#39;t need to keep a queue of nodes - in an imperative setting, it is just convenient, but that isn&#39;t the case here."}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 8, "last_activity_date": 1424233536, "last_edit_date": 1495541450, "creation_date": 1424225155, "answer_id": 28574768, "question_id": 28573287, "link": "https://stackoverflow.com/questions/28573287/breadth-first-search-using-state-monad-in-haskell/28574768#28574768", "title": "Breadth-First Search using State monad in Haskell", "body": "<p>Converting a graph into a <code>Tree</code> breadth-first is a bit more difficult than simply <a href=\"https://stackoverflow.com/questions/27716341/haskell-calculating-the-shortest-path-using-trees/27726136#27726136\">searching the graph breadth-first</a>. If you are searching the graph, you only ever need to return from a single branch. When converting the graph into a tree, the result needs to include results from multiple branches.</p>\n\n<p>We can use a more general type than <code>Graph a</code> for what we can search or convert to trees. We can search or convert to trees anything with a function <code>a -&gt; [a]</code>. For a <code>Graph</code> we'd use the function <code>(Map.!) m</code>, where <code>m</code> is the <code>Map</code>. Searching with a transposition table has a signature like</p>\n\n<pre><code>breadthFirstSearchUnseen:: Ord r =&gt; (a -&gt; r) -&gt; -- how to compare `a`s \n                           (a -&gt; Bool) -&gt;       -- where to stop\n                           (a -&gt; [a]) -&gt;        -- where you can go from an `a`\n                           [a] -&gt;               -- where to start\n                           Maybe [a]\n</code></pre>\n\n<p>Converting the function to a tree that contains each reachable node at the earliest depth has a signature like</p>\n\n<pre><code>shortestPathTree :: Ord r =&gt; (a -&gt; r) -&gt; -- how to compare `a`s\n                    (a -&gt; l)             -- what label to put in the tree\n                    (a -&gt; [a]) -&gt;        -- where you can go from an `a`\n                    a -&gt;                 -- where to start\n                    Tree l\n</code></pre>\n\n<p>We can slightly more generally start at any number of nodes and build a <a href=\"http://hackage.haskell.org/packages/archive/containers/latest/doc/html/Data-Tree.html#t:Forest\" rel=\"nofollow noreferrer\"><code>Forest</code></a> that contains each reachable node at the earliest depth.</p>\n\n<pre><code>shortestPathTrees :: Ord r =&gt; (a -&gt; r) -&gt; -- how to compare `a`s\n                     (a -&gt; l)             -- what label to put in the tree\n                     (a -&gt; [a]) -&gt;        -- where you can go from an `a`\n                     [a] -&gt;               -- where to start\n                     [Tree l]\n</code></pre>\n\n<h3>Searching</h3>\n\n<p>Performing the conversion to a tree doesn't really help us search, we can perform breadth first searches on the original graph.</p>\n\n<pre><code>import Data.Sequence (viewl, ViewL (..), (&gt;&lt;))\nimport qualified Data.Sequence as Seq\nimport qualified Data.Set as Set\n\nbreadthFirstSearchUnseen:: Ord r =&gt; (a -&gt; r) -&gt; (a -&gt; Bool) -&gt; (a -&gt; [a]) -&gt; [a] -&gt; Maybe [a]\nbreadthFirstSearchUnseen repr p expand = combine Set.empty Seq.empty []\n    where\n        combine seen queued ancestors unseen =\n            go\n                (seen  `Set.union` (Set.fromList . map repr            $ unseen))\n                (queued &gt;&lt;         (Seq.fromList . map ((,) ancestors) $ unseen))\n        go seen queue =\n            case viewl queue of\n                EmptyL -&gt; Nothing\n                (ancestors, a) :&lt; queued -&gt;\n                    if p a\n                    then Just . reverse $ ancestors'\n                    else combine seen queued ancestors' unseen\n                    where\n                        ancestors' = a:ancestors\n                        unseen = filter (flip Set.notMember seen . repr) . expand $ a\n</code></pre>\n\n<p>The state maintained in the above search algorithm is a <a href=\"http://hackage.haskell.org/packages/archive/containers/latest/doc/html/Data-Sequence.html#t:Seq\" rel=\"nofollow noreferrer\"><code>Seq</code></a> queue of what nodes to visit next and a <a href=\"http://hackage.haskell.org/packages/archive/containers/latest/doc/html/Data-Set.html#t:Set\" rel=\"nofollow noreferrer\"><code>Set</code></a> of nodes that have already been <em>seen</em>. If we instead kept track of nodes that have already been <em>visited</em>, then we could visit the same node multiple times if we find multiple paths to the node at the same depth. There's a <a href=\"https://stackoverflow.com/a/27726136/414413\">more complete explanation</a> in the answer I wrote this breadth first search for.</p>\n\n<p>We can easily write searching <code>Graph</code>s in terms of our general search.</p>\n\n<pre><code>import qualified Data.Map as Map\n\nnewtype Graph a = Graph (Map.Map a [a]) deriving (Ord, Eq, Show)\n\nbfsGraph :: (Ord a) =&gt; Graph a -&gt; (a -&gt; Bool) -&gt; [a] -&gt; Maybe [a]\nbfsGraph (Graph adj) test = breadthFirstSearchUnseen id test ((Map.!) adj)\n</code></pre>\n\n<p>We can also write how to search <code>Tree</code>s themselves.</p>\n\n<pre><code>import Data.Tree\n\nbfsTrees :: (Ord a) =&gt; (a -&gt; Bool) -&gt; [Tree a] -&gt; Maybe [a]\nbfsTrees test = fmap (map rootLabel) . breadthFirstSearchUnseen rootLabel (test . rootLabel) subForest\n</code></pre>\n\n<h3>Building trees</h3>\n\n<p>Building trees breadth-first is <a href=\"https://stackoverflow.com/questions/27748526/is-a-lazy-breadth-first-monadic-rose-tree-unfold-possible\">a lot more difficult</a>. Fortunately <a href=\"http://hackage.haskell.org/packages/archive/containers/latest/doc/html/Data-Tree.html\" rel=\"nofollow noreferrer\"><code>Data.Tree</code></a> already provides ways to build <code>Tree</code>s in breadth first order from a monadic unfold. The breadth first order will take care of the queuing, we will only need to keep track of the state for the nodes we've already seen.</p>\n\n<p><a href=\"http://hackage.haskell.org/packages/archive/containers/latest/doc/html/Data-Tree.html#v:unfoldTreeM-95-BF\" rel=\"nofollow noreferrer\"><code>unfoldTreeM_BF</code></a> has the type <code>Monad m =&gt; (b -&gt; m (a, [b])) -&gt; b -&gt; m (Tree a)</code>. <code>m</code> is the <code>Monad</code> our computations will be in, <code>b</code> is the type of data we are going to build the tree based on, and <code>a</code> is the type for the labels of the tree. In order to use it to build a tree we need to make a function <code>b -&gt; m (a, [b])</code>. We're going to rename <code>a</code> to <code>l</code> for label, and <code>b</code> to <code>a</code>, which is what we've been using for our nodes. We need to make an <code>a -&gt; m (l, [a])</code>. For <code>m</code>, we'll use the <a href=\"http://hackage.haskell.org/packages/archive/mtl/latest/doc/html/Control-Monad-State.html\" rel=\"nofollow noreferrer\"><code>State</code></a> monad from <a href=\"https://hackage.haskell.org/package/transformers\" rel=\"nofollow noreferrer\">transformers</a> to keep track of some state; the state will be the <code>Set</code> of nodes whose representation <code>r</code> we've already seen; we'll be using the <code>State (Set.Set r)</code> monad. Overall, we need to provide a function <code>a -&gt; State (Set.Set r) (l, [a])</code>.</p>\n\n<pre><code>expandUnseen :: Ord r =&gt; (a -&gt; r) -&gt; (a -&gt; l) -&gt; (a -&gt; [a]) -&gt; a -&gt; State (Set.Set r) (l, [a])\nexpandUnseen repr label expand a = do\n    seen &lt;- get\n    let unseen = filter (flip Set.notMember seen . repr) . uniqueBy repr . expand $ a\n    put . Set.union seen . Set.fromList . map repr $ unseen\n    return (label a, unseen)\n</code></pre>\n\n<p>To build the trees, we run the state computation built by <a href=\"http://hackage.haskell.org/packages/archive/containers/latest/doc/html/Data-Tree.html#v:unfoldForestM-95-BF\" rel=\"nofollow noreferrer\"><code>unfoldForestM_BF</code></a></p>\n\n<pre><code>shortestPathTrees :: Ord r =&gt; (a -&gt; r) -&gt; (a -&gt; l) -&gt; (a -&gt; [a]) -&gt; [a] -&gt; [Tree l]\nshortestPathTrees repr label expand = run . unfoldForestM_BF k . uniqueBy repr\n    where\n        run = flip evalState Set.empty\n        k = expandUnseen repr label expand\n</code></pre>\n\n<p><code>uniqueBy</code> is a <code>nubBy</code> that takes advantage of an <code>Ord</code> instance instead of <code>Eq</code>.</p>\n\n<pre><code>uniqueBy :: Ord r =&gt; (a -&gt; r) -&gt; [a] -&gt; [a]\nuniqueBy repr = go Set.empty\n    where\n        go seen []     = []\n        go seen (x:xs) =\n            if Set.member (repr x) seen\n            then go seen xs\n            else x:go (Set.insert (repr x) seen) xs\n</code></pre>\n\n<p>We can write building shortest path trees from <code>Graph</code>s in terms of our general shortest path tree building</p>\n\n<pre><code>shortestPathsGraph :: Ord a =&gt; Graph a -&gt; [a] -&gt; [Tree a]\nshortestPathsGraph (Graph adj) = shortestPathTrees id id ((Map.!) adj)\n</code></pre>\n\n<p>We can do the same for filtering a <code>Forest</code> to only the shortest paths through the <code>Forest</code>.</p>\n\n<pre><code>shortestPathsTree :: Ord a =&gt; [Tree a] -&gt; [Tree a]\nshortestPathsTree = shortestPathTrees rootLabel rootLabel subForest\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 0, "last_activity_date": 1429559338, "last_edit_date": 1495535431, "creation_date": 1429559338, "answer_id": 29757049, "question_id": 28573287, "link": "https://stackoverflow.com/questions/28573287/breadth-first-search-using-state-monad-in-haskell/29757049#29757049", "title": "Breadth-First Search using State monad in Haskell", "body": "<p>My solution is based on working level-by-level (wrt. to BFS), see also <a href=\"https://stackoverflow.com/q/29726454/1333025\">this question and answer</a>.</p>\n\n<p>The general idea is: Assume we already know the sets of visited elements prior each level of our BFS as a list of sets. Then we can traverse the graph, level by level, updating our list of sets, constructing the output <code>Tree</code> on the way.</p>\n\n<p>The trick is that after such a level-by-level traversal, we'll have the sets of visited elements <em>after</em> each level. And this is the same as the list <em>before</em> each level, just shifted by one. So by <a href=\"https://wiki.haskell.org/Tying_the_Knot\" rel=\"nofollow noreferrer\">tying the knot</a>, we can use the shifted output as the input for the procedure.</p>\n\n<pre><code>import Control.Monad.State\nimport qualified Data.Map as M\nimport Data.Maybe (fromMaybe, catMaybes)\nimport qualified Data.Set as S\nimport Data.Tree\n\nnewtype Graph a = Graph (M.Map a [a])\n    deriving (Ord, Eq, Show)\n\ntagBfs :: (Ord a) =&gt; Graph a -&gt; a -&gt; Maybe (Tree a)\ntagBfs (Graph g) s = let (t, sets) = runState (thread s) (S.empty : sets)\n                      in t\n  where\n    thread x = do\n        sets@(s : subsets) &lt;- get\n        case M.lookup x g of\n            Just vs | not (S.member x s) -&gt; do\n                -- recursively create sub-nodes and update the subsets list\n                let (nodes, subsets') = runState\n                                          (catMaybes `liftM` mapM thread vs) subsets\n                -- put the new combined list of sets\n                put (S.insert x s : subsets')\n                -- .. and return the node\n                return . Just $ Node x nodes\n            _ -&gt; return Nothing -- node not in the graph, or already visited\n</code></pre>\n\n<p>Running <code>tagBfs example2 'b'</code> it on the following example</p>\n\n<pre><code>example2 :: Graph Char\nexample2 = Graph $ M.fromList\n    [ ('a', ['b', 'c', 'd'])\n    , ('b', ['a'])\n    , ('c', [])\n    , ('d', [])\n    ]\n</code></pre>\n\n<p>yields </p>\n\n<pre><code>Just (Node {rootLabel = 'b',\n            subForest = [Node {rootLabel = 'a',\n                               subForest = [Node {rootLabel = 'c',\n                                                  subForest = []},\n                                            Node {rootLabel = 'd',\n                                                  subForest = []}\n                                           ]}\n                        ]}\n      )\n</code></pre>\n"}], "owner": {"reputation": 177, "user_id": 3762988, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1f24a8e49937146b135b489344d785b?s=128&d=identicon&r=PG&f=1", "display_name": "MazaYong", "link": "https://stackoverflow.com/users/3762988/mazayong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2727, "favorite_count": 4, "accepted_answer_id": 28574768, "answer_count": 2, "score": 8, "last_activity_date": 1429559338, "creation_date": 1424216064, "last_edit_date": 1495540055, "question_id": 28573287, "link": "https://stackoverflow.com/questions/28573287/breadth-first-search-using-state-monad-in-haskell", "title": "Breadth-First Search using State monad in Haskell", "body": "<p>Recently, I've asked a question for building DFS tree from Graph in Stackoverflow and had learned that it can be simply implemented by using State Monad.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/28549336/is-there-way-to-represent-static-data-in-haskell-or-is-there-any-other-elegant\">DFS in haskell</a></p>\n\n<p>While DFS requires to track only visited nodes, so that we can use 'Set' or 'List' or some sort of linear data structure to track visited nodes, BFS requires 'visited node' and 'queue' data structure to be accomplished.</p>\n\n<p>My pseudocode for BFS is</p>\n\n<pre><code>Q = empty queue\nT = empty Tree\nmark all nodes except u as unvisited\nwhile Q is nonempty do\nu = deq(Q)\n    for each vertex v \u2208 Adj(u)\n        if v is not visited \n        then add edge (u,v) to T\n             Mark v as visited and enq(v)\n</code></pre>\n\n<p>As can be inferred from pseudocode, we only have to do 3 processes per iteration.</p>\n\n<blockquote>\n  <ol>\n  <li>dequeue point from queue</li>\n  <li>add all unvisited neighbors of the point to current tree's child, queue and 'visited' list</li>\n  <li>repeat this for next in queue</li>\n  </ol>\n</blockquote>\n\n<p>Since we are not using recursive traversal for BFS search, we need some other traversal method such as while loop. I've looked up loop-while package in hackage, but it seems somewhat deprecated.</p>\n\n<p>What I assume is that I require some sort of code like this :</p>\n\n<pre><code>{-...-}\n... =   evalState (bfs) ((Set.singleton start),[start])\nwhere \n    neighbors x = Map.findWithDefault [] x adj \n    bfs =do (vis,x:queue)&lt;-get\n             map (\\neighbor -&gt;\n                  if (Set.member neighbor vis)\n                  then put(vis,queue) \n                  else put ((Set.insert neighbor vis), queue++[neighbor]) &gt;&gt; (addToTree neighbor)\n                 )  neighbors x\n            (vis,queue)&lt;-get\n         while (length queue &gt; 0)\n</code></pre>\n\n<p>I understand that this implementation is very erroneous but this should give minimalistic view for how I think BFS should be implemented. Also, I really don't know how to circumvent using while loop for do blocks.(i.e should I use recursive algorithm to overcome it or should I think of completely different strategy)</p>\n\n<p>Considering one of the answer I've found in previous question linked above, it seems like the answer should look like this :</p>\n\n<pre><code>newtype Graph a = Graph (Map.Map a [a]) deriving (Ord, Eq, Show)\ndata Tree a = Tree a [Tree a] deriving (Ord, Eq, Show)\n\nbfs :: (Ord a) =&gt; Graph a -&gt; a -&gt; Tree a\nbfs (Graph adj) start = evalState (bfs') ((Set.singleton start),[start])\n    where\n        bfs' = {-part where I don't know-}\n</code></pre>\n\n<p>Finally, if such implementation for BFS using state monad is impossible due to some reason, (which I believe not to be) please correct my false assumption.</p>\n\n<p>I've seen some of the examples for BFS in Haskell without using state monad but I want to learn more about how state monad can be processed and couldn't have found any of examples of BFS implemented using state monad.</p>\n\n<p>Thanks in advance.</p>\n\n<hr>\n\n<p>EDIT:\nI came up with some sort of algorithm using state monad but I fall in infinite loop.</p>\n\n<pre><code>bfs :: (Ord a) =&gt; Graph a -&gt; a -&gt; Tree a\nbfs (Graph adj) start = evalState (bfs' (Graph adj) start) (Set.singleton start)\n\nbfs' :: (Ord a) =&gt; Graph a -&gt; a -&gt; State (Set.Set a) (Tree a)\nbfs' (Graph adj) point= do\n                        vis &lt;- get\n                        let neighbors x = Map.findWithDefault [] x adj\n                        let addableNeighbors (x:xs) =   if Set.member x vis\n                                                        then addableNeighbors(xs)\n                                                        else x:addableNeighbors(xs)\n                        let addVisited (vis) (ns) = Set.union (vis) $ Set.fromList ns\n                        let newVisited = addVisited vis $ addableNeighbors $ neighbors point\n                        put newVisited\n                        return (Tree point $ map (flip evalState newVisited) (map (bfs' (Graph adj)) $ addableNeighbors $ neighbors point))\n</code></pre>\n\n<p>EDIT2: With some expense of space complexity, I've came out with a solution to get BFS graph using graph to return and queue to process. Despite it is not the optimal solution for generating BFS tree/graph, it will work.</p>\n\n<pre><code>bfs :: (Ord a) =&gt; Graph a -&gt; a -&gt; Graph a\nbfs (Graph adj) start = evalState (bfs' (Graph adj) (Graph(Map.empty))  [start]) (Set.singleton start)\n\n\nbfs':: (Ord a) =&gt; Graph a -&gt; Graph a -&gt; [a] -&gt; State (Set.Set a) (Graph a)\nbfs' _ (Graph ret) [] = return (Graph ret)\nbfs' (Graph adj) (Graph ret) (p:points)= do\n                                        vis &lt;- get\n                                        let neighbors x = Map.findWithDefault [] x adj\n                                        let addableNeighbors ns\n                                                | null ns = []\n                                                | otherwise =   if Set.member (head ns) vis\n                                                                then addableNeighbors(tail ns)\n                                                                else (head ns):addableNeighbors(tail ns)\n                                        let addVisited (v) (ns) = Set.union (v) $ Set.fromList ns\n                                        let unVisited = addableNeighbors $ neighbors p\n                                        let newVisited = addVisited vis unVisited\n                                        let unionGraph (Graph g1) (Graph g2) = Graph (Map.union g1 g2)\n                                        put newVisited\n                                        bfs' (Graph adj) (unionGraph (Graph ret) (Graph (Map.singleton p unVisited))) (points ++ unVisited)\n</code></pre>\n\n<p>EDIT3: I've added convert function for graph to tree. Running function in EDIT2, and EDIT3 will yield BFS Tree. It is not the best algorithm for computation time wise, but I believe it is intuitive and easy to understand for newbies like me :)</p>\n\n<pre><code>graphToTree :: (Ord a) =&gt; Graph a -&gt; a -&gt; Tree a\ngraphToTree (Graph adj) point  = Tree point $ map (graphToTree (Graph adj)) $ neighbors point\n    where neighbors x = Map.findWithDefault [] x adj\n</code></pre>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 1727, "user_id": 2014022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b5ab8fa77e562296a1b668005395762?s=128&d=identicon&r=PG", "display_name": "Peter K", "link": "https://stackoverflow.com/users/2014022/peter-k"}, "edited": false, "score": 0, "creation_date": 1424211353, "post_id": 28572071, "comment_id": 45454057, "body": "should you provide argument to concrete on call site?"}, {"owner": {"reputation": 395, "user_id": 1285443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb9a7e894ce5c90532025979b53d93e?s=128&d=identicon&r=PG", "display_name": "Nicolas Trangez", "link": "https://stackoverflow.com/users/1285443/nicolas-trangez"}, "reply_to_user": {"reputation": 1727, "user_id": 2014022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b5ab8fa77e562296a1b668005395762?s=128&d=identicon&r=PG", "display_name": "Peter K", "link": "https://stackoverflow.com/users/2014022/peter-k"}, "edited": false, "score": 0, "creation_date": 1424212176, "post_id": 28572071, "comment_id": 45454447, "body": "@PeterK That could be possible, yes, but I don&#39;t see how that changes anything here?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1424212211, "post_id": 28572071, "comment_id": 45454466, "body": "<code>Printer &quot;foo&quot;</code> is exactly the same type as <code>Printer &quot;bar&quot;</code> as both are type synonyms for <code>IO ()</code>, so this can never work in its current form."}], "answers": [{"comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1424212079, "post_id": 28572317, "comment_id": 45454402, "body": "<code>ScopedTypeVariables</code> is necessary but not sufficient: the ambiguity check still fails for the code, even with proper scoping."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1424212276, "last_edit_date": 1424212276, "creation_date": 1424211907, "answer_id": 28572317, "question_id": 28572071, "link": "https://stackoverflow.com/questions/28572071/ghc-typelits-without-values/28572317#28572317", "title": "GHC TypeLits without values", "body": "<p>This is wrong:</p>\n\n<pre><code>generic :: KnownSymbol s =&gt; Printer s\ngeneric = ...(Proxy :: Proxy s)\n</code></pre>\n\n<p>The last <code>s</code> has nothing to do with the <code>s</code> above it. It is locally implicitly universally quantified, as in top-level type annotations. The code actually means</p>\n\n<pre><code>generic :: KnownSymbol s =&gt; Printer s\ngeneric = ...(Proxy :: forall z. Proxy z)\n</code></pre>\n\n<p>To fix the above, enable <code>ScopedTypeVariables</code> and use</p>\n\n<pre><code>-- the explicit forall makes s available below\ngeneric :: forall s. KnownSymbol s =&gt; Printer s\ngeneric = ...(Proxy :: Proxy s)\n</code></pre>\n\n<p>There are other issues, though, as Tikhon Jelvis points out in his answer.</p>\n"}, {"comments": [{"owner": {"reputation": 395, "user_id": 1285443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb9a7e894ce5c90532025979b53d93e?s=128&d=identicon&r=PG", "display_name": "Nicolas Trangez", "link": "https://stackoverflow.com/users/1285443/nicolas-trangez"}, "edited": false, "score": 0, "creation_date": 1424440505, "post_id": 28572347, "comment_id": 45561259, "body": "Thank you. In retrospect, it seems so obvious the &#39;phantom&#39; args are lost when using a simple type synonym..."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 9, "last_activity_date": 1424212394, "last_edit_date": 1424212394, "creation_date": 1424212039, "answer_id": 28572347, "question_id": 28572071, "link": "https://stackoverflow.com/questions/28572071/ghc-typelits-without-values/28572347#28572347", "title": "GHC TypeLits without values", "body": "<p>Type synonyms (defined with <code>type</code>) are replaced with their definition during typechecking. The problem is that <code>Printer</code> has no reference to <code>s</code> in its definition, which leads to the following constraint:</p>\n\n<pre><code>generic :: KnonwSymbol s =&gt; IO ()\n</code></pre>\n\n<p>This type signature does not have an <code>s</code> right of the <code>=&gt;</code> and so fails the ambiguity check. It can't really work because there's nowhere to specify what <code>s</code> should be when you use it.</p>\n\n<p>Unfortunately, GHC is inconsistent about how it represents type synonyms in error messages. Sometimes they are expanded and sometimes they are preserved. Ironically, I think improvements in the error messages have made this particular error harder to track down: normally, expressing the error in terms of the types you defined is clearer, but here it hides the cause of the ambiguity. </p>\n\n<p>What you need is some way to supply the relevant type-level symbol that does not rely on type synonyms. But first, you need to enable <code>ScopedTypeVariables</code> and add a <code>forall</code> to the signature of <code>generic</code> to make sure the <code>s</code> in the type signature and the <code>s</code> in <code>Proxy :: Proxy s</code> are the same.</p>\n\n<p>There are two possibilities:</p>\n\n<ul>\n<li><p>change <code>Printer</code> to a <code>newtype</code> and unwrap it when you use it:</p>\n\n<pre><code>newtype Printer (s :: Symbol) = Printer { runPrinter :: IO () }\n\ngeneric :: forall s. KnownSymbol s =&gt; Printer s\ngeneric = Printer $ putStrLn (symbolVal (Proxy :: Proxy s))\n\nmain = runPrinter generic\n</code></pre></li>\n<li><p>pass in an extra <code>Proxy</code> argument to <code>generic</code>, just like <code>symbolVal</code>:</p>\n\n<pre><code>concrete :: Printer \"foo\"\nconcrete = generic (Proxy :: Proxy \"foo\")\n\ngeneric :: forall proxy s. KnownSymbol s =&gt; proxy s -&gt; IO ()\ngeneric _ = putStrLn (symbolVal (Proxy :: Proxy s))\n</code></pre>\n\n<p>Having <code>proxy</code> as a type variable is a neat idiom that lets you not depend on <code>Data.Proxy</code> and lets callers pass in whatever they want in its stead.</p></li>\n</ul>\n"}], "owner": {"reputation": 395, "user_id": 1285443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb9a7e894ce5c90532025979b53d93e?s=128&d=identicon&r=PG", "display_name": "Nicolas Trangez", "link": "https://stackoverflow.com/users/1285443/nicolas-trangez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 28572347, "answer_count": 2, "score": 3, "last_activity_date": 1424212394, "creation_date": 1424211026, "question_id": 28572071, "link": "https://stackoverflow.com/questions/28572071/ghc-typelits-without-values", "title": "GHC TypeLits without values", "body": "<p>Trying to design a type-driven API, I've been trying to get something like the following working (using much more complicated code/attempts, this is stripped down to the minimum required to clarify what I'm looking for):</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n\nmodule Main where\n\nimport Data.Proxy\nimport GHC.TypeLits\n\ntype Printer (s :: Symbol) = IO ()\n\nconcrete :: Printer \"foo\"\nconcrete = generic\n\ngeneric :: KnownSymbol s =&gt; Printer s\ngeneric = putStrLn (symbolVal (Proxy :: Proxy s))\n\nmain :: IO ()\nmain = concrete\n</code></pre>\n\n<p>This program would print 'foo', but doesn't:</p>\n\n<pre><code>Could not deduce (KnownSymbol s0)\n  arising from the ambiguity check for \u2018generic\u2019\nfrom the context (KnownSymbol s)\n  bound by the type signature for\n             generic :: KnownSymbol s =&gt; Printer s\n  at test5.hs:14:12-37\nThe type variable \u2018s0\u2019 is ambiguous\nIn the ambiguity check for:\n  forall (s :: Symbol). KnownSymbol s =&gt; Printer s\nTo defer the ambiguity check to use sites, enable AllowAmbiguousTypes\nIn the type signature for \u2018generic\u2019:\n  generic :: KnownSymbol s =&gt; Printer s\n</code></pre>\n\n<p>Enabling <code>AllowAmbiguousTypes</code> doesn't really help. Any way to get this working anyway?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 2, "creation_date": 1424207318, "post_id": 28571035, "comment_id": 45452161, "body": "This is quite interesting and I don&#39;t know the answer to this. But a quick and dirty solution would be to define a different function like <code>efficientEquals :: (Ord a) =&gt; [a] -&gt; [a] -&gt; Bool</code> and <code>equals :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Bool</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1424212473, "post_id": 28571035, "comment_id": 45454599, "body": "Please make it clear that we are talking about comparing lists <i>disregarding order</i> (and possibly multiplicity as well). Clearly <code>(==)</code> does not require O(n^2) on lists."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1424212798, "post_id": 28571035, "comment_id": 45454759, "body": "IIRC, GHC allows one to specify a <code>{-# RULE ... equals = efficientOrdEquals #-}</code> which gets applied only if the RHS type-checks. In this way, calls that are statically known to involve ordered types would get the efficient version."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1424214415, "post_id": 28571035, "comment_id": 45455427, "body": "@chi, I believe that ends up being very finicky. The rules don&#39;t run until simplification, when the type checker has gone away and taken all its instance info with it (something I&#39;d like it to stop doing for a different reason, as it happens, but I&#39;m not guru enough to attempt it). This means the instance info is only available in the presence of a constraint, and only if that constraint has not been specialized away. So it&#39;s very easy to have something that&#39;s <code>Ord</code>, but that the simplifier doesn&#39;t <i>know</i> is <code>Ord</code>."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1424226171, "post_id": 28571035, "comment_id": 45459132, "body": "There are some techniques using <code>OverlappingInstances</code>, or closed type families that can be used to get something like what you&#39;re looking for in some cases (though not really here; unless you&#39;re okay with, say, enumerating/duplicating all types with <code>Ord</code> instances you care about). See <a href=\"https://wiki.haskell.org/GHC/AdvancedOverlap\" rel=\"nofollow noreferrer\">the &quot;advanced overlap&quot;</a> wiki page. The <a href=\"http://brandon.si/code/how-the-haskell-prelude-avoids-overlapping-types-in-show/\" rel=\"nofollow noreferrer\">&quot;extra method trick&quot;</a> might also be relevant here."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1424226383, "post_id": 28571035, "comment_id": 45459192, "body": "&quot;if the user can provide some additional information about the type&quot; - what are you thinking of here? I can think of lots of solutions that would seem to satisfy the workaround you&#39;re looking for as stated, but they&#39;re kind of trivial and I think you&#39;d agree they&#39;re equivalent but worse than just having two functions like Jeffrey suggests"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 2, "creation_date": 1424241290, "post_id": 28571035, "comment_id": 45463569, "body": "The main problem here is that Eq is a superclass of Ord. So <i>every</i> Ord type is also an Eq type, which means you want your Eq case to be selected only for cases where there <code>Ord a</code> does <i>not</i> hold. The type class system in Haskell is strongly designed to make sure it never commits to the negative of a constraint; this property is at the heart of a lot of the consistency guarantees it provides, because with separate compilation of modules GHC can never tell the difference between &quot;no instance exists&quot; and &quot;no instance is in scope&quot;."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1424241494, "post_id": 28571035, "comment_id": 45463642, "body": "I can think of ways you could come up with an <code>equals</code> that works with both Eq and Ord instances, but I can&#39;t think of any way that wouldn&#39;t just complain about ambiguous type variables when called on things are instances of Ord. You&#39;d end up having to manually say <code>(equals :: Ord a =&gt; [a] -&gt; [a] -&gt; Bool) xs ys</code> at every call site. And if you&#39;re willing to manually declare which version of equals you want to call, they might as well have different names so it&#39;s easier to do so."}, {"owner": {"reputation": 903, "user_id": 2393937, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d35b1ec2432fbea0b75940a605a3d962?s=128&d=identicon&r=PG", "display_name": "DanielM", "link": "https://stackoverflow.com/users/2393937/danielm"}, "edited": false, "score": 0, "creation_date": 1424249875, "post_id": 28571035, "comment_id": 45467233, "body": "I edited the question to address some of the points raised in the comments. I hope I did not deviate too much from the original formulation.  In general I agree that providing two distinct methods is the more idiomatic way. However, I am not convinced that is always an option (see edit)."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1424289003, "post_id": 28571035, "comment_id": 45491695, "body": "Ah, I see. I think that actually needs quite a different solution than we&#39;ve been aiming for. The <code>equals</code> from <code>SetLike</code> is required to be polymorphic in <code>Eq a</code>, only switching between implementations on <code>s</code>. So I think even if you managed a type class overloaded function that switched on whether there was an Ord constant or not, doing <code>instance SetLike [] where equals = ordOrEqEquals</code> would just select the slow Eq version out of the overload! But if you&#39;re willing to use a different data structure than plain lists, then jberryman has shown how you can use GADTs to address this."}], "answers": [{"comments": [{"owner": {"reputation": 903, "user_id": 2393937, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d35b1ec2432fbea0b75940a605a3d962?s=128&d=identicon&r=PG", "display_name": "DanielM", "link": "https://stackoverflow.com/users/2393937/danielm"}, "edited": false, "score": 0, "creation_date": 1424380867, "post_id": 28590508, "comment_id": 45537275, "body": "Unfortunately, OverlappingInstances does away with some of the guarantees we usually get with typeclasses, doesn&#39;t it? I really like the GADT solution, though!"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 5, "last_activity_date": 1424282147, "creation_date": 1424282147, "answer_id": 28590508, "question_id": 28571035, "link": "https://stackoverflow.com/questions/28571035/is-there-a-workaround-for-the-lack-of-type-class-backtracking/28590508#28590508", "title": "Is there a workaround for the lack of type class backtracking?", "body": "<p>In the scenario from your edit, you could use a <code>GADT</code> as proof of your <code>Ord</code> constraint:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nimport Data.List\n\nclass SetLike s where\n    equals :: Eq a =&gt; s a -&gt; s a -&gt; Bool\n\ndata OrdList a where\n    OrdList :: Ord a=&gt; [a] -&gt; OrdList a\n\ninstance SetLike OrdList where\n    equals (OrdList a) (OrdList b) = sort a == sort b\n</code></pre>\n\n<p>And for fun here's something that uses makes use of the <code>OverlappingInstances</code> trick I mention in my comment. There are lots of ways to do this sort of thing:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures, OverlappingInstances, UndecidableInstances, MultiParamTypeClasses, FlexibleInstances #-}\n\nimport Data.List\n\nclass Equals a where\n    equals :: [a] -&gt; [a] -&gt; Bool\n\n    default equals :: Ord a=&gt; [a] -&gt; [a] -&gt; Bool\n    equals as bs = sort as == sort bs\n\ninstance Equals Int\ninstance Equals Integer\ninstance Equals Char\n-- etc.\n\ninstance (Eq a)=&gt; Equals a where\n    equals = error \"slow version\"\n</code></pre>\n"}], "owner": {"reputation": 903, "user_id": 2393937, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d35b1ec2432fbea0b75940a605a3d962?s=128&d=identicon&r=PG", "display_name": "DanielM", "link": "https://stackoverflow.com/users/2393937/danielm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 11, "accepted_answer_id": 28590508, "answer_count": 1, "score": 15, "last_activity_date": 1424282147, "creation_date": 1424206908, "last_edit_date": 1424249764, "question_id": 28571035, "link": "https://stackoverflow.com/questions/28571035/is-there-a-workaround-for-the-lack-of-type-class-backtracking", "title": "Is there a workaround for the lack of type class backtracking?", "body": "<p>In <a href=\"https://www.youtube.com/watch?feature=player_detailpage&amp;v=hIZxTQP1ifo#t=4830\" rel=\"nofollow\">this talk around the 1:20 mark</a>, Edward Kmett mentions the lack of \"type class backtracking\" in Haskell. Consider the problem of \"set equality\" (where order and multiplicity are disregarded) implemented on lists:</p>\n\n<pre><code>equals :: [a] -&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>By the nature of type classes I cannot provide an inefficient O(n\u00b2) comparison if all we have is <code>Eq a</code> but efficiently compare the lists in O(n log n) if we have <code>Ord a</code>.</p>\n\n<p>I did understand why such a facility would be problematic. At the same time, Edward says that there are \"tricks you could play\" mentioning for instance type families.</p>\n\n<p>Hence my question is, what would be a workaround to achieve the same effect:</p>\n\n<ul>\n<li>an (inefficient) default implementation is provided</li>\n<li>if the user can provide some additional information about the type, we \"unlock\" a more efficient implementation</li>\n</ul>\n\n<p>This workaround does not necessarily need to use type classes.</p>\n\n<p><strong>Edit</strong>: Some people suggested simply providing <code>equals</code> and <code>efficientEquals</code> as two distinct methods. In general I agree that this is the more Haskell-idiomatic approach. However, I am not convinced that this is always possible. For instance, what if the equals method above is itself part of a type class:</p>\n\n<pre><code>class SetLike s where\n    equals :: Eq a =&gt; s a -&gt; s a -&gt; Bool\n</code></pre>\n\n<p>Assume that this class has been provided by someone else so I cannot simply add a new function to the typeclass. I now want to define the instance for <code>[]</code>. I know that <code>[]</code> can always provide an implementation of <code>equals</code> no matter what constraints there are on <code>a</code> but I cannot tell my instance to use the more efficient version if more information about <code>a</code> is available.</p>\n\n<p>Maybe I could wrap the list in a newtype and tag it with some additional type information?</p>\n"}, {"tags": ["debugging", "haskell", "ghci"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1424213630, "post_id": 28570367, "comment_id": 45455103, "body": "You&#39;ve gotten further than I have. I don&#39;t even know how to use the debugging features of GHCi when they <i>are</i> available\u2014I should really RTFM sometime.  One suggestion for you: while segfaults can certainlt result from improper use of <code>unsafeCoerce</code> or <code>unsafePerformIO</code>, it seems more common to get them from bad unsafe array/vector references. Do the unsafe operation&#39;s you&#39;re using have safe equivalents, like <code>write</code> as opposed to <code>unsafeWrite</code>? If so, using the safe versions for your testing and then switching to unsafe ones for performance can make things <i>much</i> easier to deal with."}, {"owner": {"reputation": 211, "user_id": 4575693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/594cef4bfa95fd1cc807d8cf575530eb?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Semyonov", "link": "https://stackoverflow.com/users/4575693/vladimir-semyonov"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1424287646, "post_id": 28570367, "comment_id": 45490859, "body": "@dfeuer: In this case, as I discovered today, the segfault actually came from dereferencing a pointer (&quot;Ptr a&quot;), whose underlying memory was already freed by the C library (libSDL2) the package was using. That was my own fault entirely. But the question still stands, since I had to resort to Debug.Trace, and in a more complex case that might take a really long time."}, {"owner": {"reputation": 2054, "user_id": 223455, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7811c4fae93abc11edd4da5604b2ddde?s=128&d=identicon&r=PG", "display_name": "schellsan", "link": "https://stackoverflow.com/users/223455/schellsan"}, "edited": false, "score": 0, "creation_date": 1481754143, "post_id": 28570367, "comment_id": 69508492, "body": "Just to make sure - did you configure with <code>cabal configure --ghc-option=-fPIC</code> or similar? The sdl2 README mentions it."}], "answers": [{"tags": [], "owner": {"reputation": 899, "user_id": 1686629, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/783eacdab4a800eab9d786d5f5911fac?s=128&d=identicon&r=PG", "display_name": "Echo Nolan", "link": "https://stackoverflow.com/users/1686629/echo-nolan"}, "is_accepted": false, "score": 1, "last_activity_date": 1506015156, "creation_date": 1506015156, "answer_id": 46349951, "question_id": 28570367, "link": "https://stackoverflow.com/questions/28570367/debugging-io-in-a-package-module-inside-ghci/46349951#46349951", "title": "Debugging IO in a package module inside GHCi", "body": "<p>Stack has some support for this. Running <code>stack ghci --load-local-deps $TARGET</code> will load your project and any dependencies that are in the <code>packages</code> field of <code>stack.yaml</code>, including if they're marked as <code>extra-dep</code>s. Breakpoints will work then. You can debug a dependency in GHCi by running <code>stack unpack $PACKAGE</code> and adding it to <code>packages</code> in <code>stack.yaml</code>.</p>\n\n<p>This is not a panacea however. If the packages have conflicting package-global language extensions (or other dynamic flags) or module name clashes it won't work. For example, if your top-level package has <code>default-extensions: NoImplicitPrelude</code> and your dependencies don't, they won't have a prelude imported and will almost certainly not load. See <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10827\" rel=\"nofollow noreferrer\">this GHC bug</a>.</p>\n"}], "owner": {"reputation": 211, "user_id": 4575693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/594cef4bfa95fd1cc807d8cf575530eb?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Semyonov", "link": "https://stackoverflow.com/users/4575693/vladimir-semyonov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 483, "favorite_count": 5, "answer_count": 1, "score": 21, "last_activity_date": 1506015156, "creation_date": 1424204299, "last_edit_date": 1592644375, "question_id": 28570367, "link": "https://stackoverflow.com/questions/28570367/debugging-io-in-a-package-module-inside-ghci", "title": "Debugging IO in a package module inside GHCi", "body": "<p>I'm doing low-level IO (for library bindings) in Haskell and am experiencing a segfault. I would like to use GHCi's <strong>:break</strong> to figure out what's going on, but here's what happens:</p>\n<pre><code>&gt; import SDL\n&gt; :break SDL.setPaletteColors\ncannot set breakpoint on setPaletteColors: module SDL.Video.Renderer is not interpreted\n</code></pre>\n<p>Since the offending code is not inside my own modules, but rather inside a module in an external package, it's loaded as compiled code and apparently I can't use <strong>:break</strong> on compiled modules.</p>\n<p><a href=\"https://www.haskell.org/platform/doc/2014.2.0.0/ghc/users_guide/ghci-debugger.html#idm39475824768\" rel=\"noreferrer\">GHCi manual</a> confirms this and provides a hint:</p>\n<blockquote>\n<p>There is one major restriction: breakpoints and single-stepping are only available in interpreted modules; compiled code is invisible to the debugger[5].</p>\n<p>[5] Note that packages only contain compiled code, so debugging a package requires finding its source and loading that directly.</p>\n</blockquote>\n<p>Let's try it directly:</p>\n<pre><code>&gt; :load some_path/sdl2/src/SDL/Video/Renderer.hs\n\nsome_path/sdl2/src/SDL/Video/Renderer.hs:101:8:\nCould not find module \u2018Control.Monad.IO.Class\u2019\nIt is a member of the hidden package \u2018transformers-0.3.0.0\u2019.\nPerhaps you need to add \u2018transformers\u2019 to the build-depends in your .cabal file.\nUse -v to see a list of the files searched for.\n</code></pre>\n<p>I can add the dependencies to my .cabal file, but this already feels wrong. Once I've done that:</p>\n<pre><code>&gt; :load some_path/sdl2/src/SDL/Video/Renderer.hs\n\nsome_path/sdl2/src/SDL/Video/Renderer.hs:119:8:\nCould not find module \u2018SDL.Internal.Numbered\u2019\nit is a hidden module in the package \u2018sdl2-2.0.0\u2019\nUse -v to see a list of the files searched for.\n</code></pre>\n<p>I could make those modules public (probably? by modifying the package .cabal?), but at this point it seems a really awkward way to do things and I didn't pursue it further.</p>\n<p><strong>EDIT:</strong></p>\n<p>I actually tried that and got the baffling result:</p>\n<pre><code>&gt; :load some_path/sdl2/src/SDL/Video/Renderer.hs\n[1 of 1] Compiling SDL.Video.Renderer ( some_path/sdl2/src/SDL/Video/Renderer.hs, interpreted )\nOk, modules loaded: SDL.Video.Renderer.\n&gt; :break SDL.setPaletteColors\ncannot set breakpoint on SDL.setPaletteColors: module SDL.Video.Renderer is not interpreted\n</code></pre>\n<p>My (uneducated) guess: it's because the external module is still linked to my code as a binary, and loading it dynamically in interpreted mode doesn't change that.</p>\n<hr />\n<p><strong>So, to sum up the question:</strong> what is a good way to debug IO in an external package?</p>\n<p>Additional notes:</p>\n<ol>\n<li><p>I do have the source to the package I need to debug; in fact, it's been added to the project with <strong>cabal sandbox add-source</strong></p>\n</li>\n<li><p>An alternative option to using GHCi would be to add traces to the package source, but this is an unfortunate option, since it involves recompilation of the package on each modification (whenever I need more information about the execution and modify the traces), and that takes a really long time. Interactive debugging with GHCi seems a better tool for this job, if only I knew how to use it.</p>\n</li>\n</ol>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1424203128, "post_id": 28570043, "comment_id": 45449883, "body": "Your <code>minOfTwo</code> function has to have an <code>IO</code> type if it does <code>IO</code>, change it to <code>minOfTwo :: IO Int</code>."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1424203204, "post_id": 28570043, "comment_id": 45449918, "body": "As a side note, you&#39;d be better off using <code>readMaybe</code> from <code>Text.Read</code> instead of <code>read</code>, since it&#39;ll return <code>Nothing</code> if it fails to parse instead of crashing your program.  This does mean that you&#39;ll have to write a bit more code to handle it, but writing a bit more code to do proper error handling is usually considered to be a good thing.  For quick one-off scripts it&#39;s fine to use unsafe functions like <code>read</code> though."}, {"owner": {"reputation": 44, "user_id": 1268677, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bac56b813c7f43809c60e427d7f3ee16?s=128&d=identicon&r=PG", "display_name": "buck", "link": "https://stackoverflow.com/users/1268677/buck"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424270083, "post_id": 28570043, "comment_id": 45479501, "body": "Thank you bheklilr. Because this is for a learning exercise and the input is guaranteed to be correct, I&#39;m not too worried about input validation yet."}], "answers": [{"comments": [{"owner": {"reputation": 44, "user_id": 1268677, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bac56b813c7f43809c60e427d7f3ee16?s=128&d=identicon&r=PG", "display_name": "buck", "link": "https://stackoverflow.com/users/1268677/buck"}, "edited": false, "score": 0, "creation_date": 1424262534, "post_id": 28583592, "comment_id": 45474802, "body": "Thank you! Is this because when a function uses IO, the results aren&#39;t guaranteed to be the same every time it is called with the same arguments?"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1424262085, "creation_date": 1424262085, "answer_id": 28583592, "question_id": 28570043, "link": "https://stackoverflow.com/questions/28570043/haskell-issue-couldnt-match-type-io-integer-with-int/28583592#28583592", "title": "Haskell issue (Couldn&#39;t match type &#39;IO Integer&#39; with &#39;Int&#39;)", "body": "<p>The <code>getLine</code> function is in the <code>IO</code> monad, and therefore any function that calls <code>getLine</code> must also be in the <code>IO</code> monad. Change your type signature for <code>minOfTwo</code> from <code>Int</code> to <code>IO Int</code>, and that particular problem will go away.</p>\n\n<p>(You'll also need to change <code>let c = minOfTwo</code> into <code>c &lt;- minOfTwo</code>.)</p>\n\n<p>There may be other errors, but this is the one causing your error message.</p>\n"}], "owner": {"reputation": 44, "user_id": 1268677, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bac56b813c7f43809c60e427d7f3ee16?s=128&d=identicon&r=PG", "display_name": "buck", "link": "https://stackoverflow.com/users/1268677/buck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1462, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1424262085, "creation_date": 1424203075, "question_id": 28570043, "link": "https://stackoverflow.com/questions/28570043/haskell-issue-couldnt-match-type-io-integer-with-int", "title": "Haskell issue (Couldn&#39;t match type &#39;IO Integer&#39; with &#39;Int&#39;)", "body": "<p>I have a problem with a Haskell script. I'm trying to learn Haskell through doing problems I find online. The input I get is:\n    Int -> Number of test cases\n    S1 -> String 1 for each test case\n    S2 -> String 2 for each test case</p>\n\n<p>Each S1 and S2 is a space delimited string of numbers. I convert them to a list of Ints with the function <code>strToIntList</code>. I then want to process the two lists and return an integer value based on the results. I get the following error: <code>Couldn't match type 'IO Integer' with 'Int'</code> on line 24 and I stared for ages but just can't figure out why (full error at end of post).</p>\n\n<p>If someone could explain why I'm going wrong, I would be very grateful.</p>\n\n<p>This is my script:</p>\n\n<pre><code>import Data.List\nimport Data.List.Split\n\nmain = do\n    cases &lt;- readLn\n    doLoop cases\n\ntoInt x = read x :: Int\n\nstrToIntList s = [read x :: Int | x &lt;- (splitOn \" \" s)]\n\nminOfTwo :: Int\nminOfTwo = do\n    sa &lt;- getLine\n    sb &lt;- getLine\n    return $ minimum [1..50]\n    -- return $ minimum $ strToIntList sa\n\ndoLoop 0 = return ()\ndoLoop loopIndex = do\n    q &lt;- getLine\n    let c = minOfTwo\n    print(c)\n    doLoop (loopIndex-1)\n</code></pre>\n\n<p>This is the full error I'm getting:</p>\n\n<pre><code>Couldn't match type `IO Integer' with `Int'\nExpected type: IO String -&gt; (String -&gt; IO Integer) -&gt; Int\n  Actual type: IO String -&gt; (String -&gt; IO Integer) -&gt; IO Integer\nIn a stmt of a 'do' block: sa &lt;- getLine\nIn the expression:\n  do { sa &lt;- getLine;\n       sb &lt;- getLine;\n       return $ minimum [1 .. 50] }\nIn an equation for `minOfTwo':\n    minOfTwo\n      = do { sa &lt;- getLine;\n             sb &lt;- getLine;\n             return $ minimum [1 .. 50] }\n</code></pre>\n"}, {"tags": ["haskell", "pretty-print"], "comments": [{"owner": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 0, "creation_date": 1424200363, "post_id": 28568336, "comment_id": 45448470, "body": "How are you doing this? Are you reading the source code from a file and trying to print it in your format? Or do you just have hard-coded strings you are trying to format?"}, {"owner": {"reputation": 940, "user_id": 1275256, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5cd12beabbb9d483c03d843cc504e5c0?s=128&d=identicon&r=PG", "display_name": "gxtaillon", "link": "https://stackoverflow.com/users/1275256/gxtaillon"}, "edited": false, "score": 0, "creation_date": 1424200638, "post_id": 28568336, "comment_id": 45448618, "body": "Check the length of your possible output, if it fits the line, print it, otherwise, create yourself a board (2d sequence or else), fill each cell of it (column0 might be return type, column1 the name + (, column2 <code>const</code>, etc.), find the max width for each column, iterate on each row printing white space where needed according to the column&#39;s max width, done."}, {"owner": {"reputation": 950, "user_id": 890355, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4438b0be49fef6107f36fbddf30266b9?s=128&d=identicon&r=PG", "display_name": "AdelNick", "link": "https://stackoverflow.com/users/890355/adelnick"}, "reply_to_user": {"reputation": 9139, "user_id": 773228, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/baaecdda322cf4462a0dd018d7959b1e?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Wood", "link": "https://stackoverflow.com/users/773228/justin-wood"}, "edited": false, "score": 0, "creation_date": 1424200661, "post_id": 28568336, "comment_id": 45448628, "body": "@JustinWood: it should be general enough for any correct method definition, so no hard-coding"}, {"owner": {"reputation": 950, "user_id": 890355, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4438b0be49fef6107f36fbddf30266b9?s=128&d=identicon&r=PG", "display_name": "AdelNick", "link": "https://stackoverflow.com/users/890355/adelnick"}, "reply_to_user": {"reputation": 940, "user_id": 1275256, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5cd12beabbb9d483c03d843cc504e5c0?s=128&d=identicon&r=PG", "display_name": "gxtaillon", "link": "https://stackoverflow.com/users/1275256/gxtaillon"}, "edited": false, "score": 1, "creation_date": 1424200857, "post_id": 28568336, "comment_id": 45448736, "body": "@gxtaillon: I&#39;m very reluctant doing this myself, as this is exactly what we need pretty-printing libraries for. :) Another drawback is that to check the length of the output I need to render the preceding method declaration, so basically render everything twice."}, {"owner": {"reputation": 940, "user_id": 1275256, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5cd12beabbb9d483c03d843cc504e5c0?s=128&d=identicon&r=PG", "display_name": "gxtaillon", "link": "https://stackoverflow.com/users/1275256/gxtaillon"}, "edited": false, "score": 0, "creation_date": 1424201286, "post_id": 28568336, "comment_id": 45448958, "body": "@AdelNick I don&#39;t think you need to render everything twice, use the board to find out the lengths then use <code>pretty</code>&#39;s <code>($$)</code> and <code>nest</code> with the column widths it gave you. You could probably commit that to pretty afterwards as a table prettyfier."}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1424202435, "post_id": 28568336, "comment_id": 45449574, "body": "Yes I want a table prettifier sometimes (for matrices), it would be a useful addition to wl-pprint. --- No, I would never use it for the OP&#39;s purpose. I think source code indentation should not depend on (lengths of) names of identifiers (in this case, method names). Because if you change one name, you need to reformat a lot. Instead, indent/outdent by a fixed amount for each logical nesting level."}, {"owner": {"reputation": 950, "user_id": 890355, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4438b0be49fef6107f36fbddf30266b9?s=128&d=identicon&r=PG", "display_name": "AdelNick", "link": "https://stackoverflow.com/users/890355/adelnick"}, "reply_to_user": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 1, "creation_date": 1424204578, "post_id": 28568336, "comment_id": 45450677, "body": "@d8d0d65b3f7cf42: this is the whole idea of what I&#39;m trying to achieve: reformat code automatically for me if I change something :) For a table prettifier you might want to look at Text.PrettyPrint.Boxes (<a href=\"https://hackage.haskell.org/package/boxes-0.1.1/docs/Text-PrettyPrint-Boxes.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/boxes-0.1.1/docs/&hellip;</a>) for my purposes it has some drawbacks"}, {"owner": {"reputation": 950, "user_id": 890355, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4438b0be49fef6107f36fbddf30266b9?s=128&d=identicon&r=PG", "display_name": "AdelNick", "link": "https://stackoverflow.com/users/890355/adelnick"}, "reply_to_user": {"reputation": 940, "user_id": 1275256, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5cd12beabbb9d483c03d843cc504e5c0?s=128&d=identicon&r=PG", "display_name": "gxtaillon", "link": "https://stackoverflow.com/users/1275256/gxtaillon"}, "edited": false, "score": 0, "creation_date": 1424204638, "post_id": 28568336, "comment_id": 45450708, "body": "@gxtaillon: No doubt, I can implement it myself. I wonder if there is such functionality in existing pretty printing libraries"}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1424205425, "post_id": 28568336, "comment_id": 45451146, "body": "@AdelNick: didn&#39;t know about boxes package. What drawbacks? Render into the box, then <code>vcat . map text . lines</code> or something`?"}, {"owner": {"reputation": 950, "user_id": 890355, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4438b0be49fef6107f36fbddf30266b9?s=128&d=identicon&r=PG", "display_name": "AdelNick", "link": "https://stackoverflow.com/users/890355/adelnick"}, "reply_to_user": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1424251356, "post_id": 28568336, "comment_id": 45468008, "body": "@d8d0d65b3f7cf42: the problem is not that I don&#39;t know how to align the argument list in columns. The problem is that I want a pretty printing library to choose between only two layouts: aligned in columns and the compact one. Please note, that the aligned layout cannot just be flattened in one line to get the compact layout, as it contains redundant spaces."}], "answers": [{"tags": [], "owner": {"reputation": 950, "user_id": 890355, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4438b0be49fef6107f36fbddf30266b9?s=128&d=identicon&r=PG", "display_name": "AdelNick", "link": "https://stackoverflow.com/users/890355/adelnick"}, "is_accepted": true, "score": 0, "last_activity_date": 1437499836, "last_edit_date": 1495539840, "creation_date": 1437499836, "answer_id": 31545817, "question_id": 28568336, "link": "https://stackoverflow.com/questions/28568336/stick-with-2-layouts-only-when-pretty-printing/31545817#31545817", "title": "Stick with 2 layouts only when pretty printing", "body": "<p>A solution to a more general problem how to choose a layout that fits to a single line or, if none, use a substitute can be found here: <a href=\"https://stackoverflow.com/a/28440998/890355\">Optional spaces and multiple alternatives in wl-pprint-extras</a></p>\n"}], "owner": {"reputation": 950, "user_id": 890355, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4438b0be49fef6107f36fbddf30266b9?s=128&d=identicon&r=PG", "display_name": "AdelNick", "link": "https://stackoverflow.com/users/890355/adelnick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 31545817, "answer_count": 1, "score": 4, "last_activity_date": 1437499836, "creation_date": 1424197121, "last_edit_date": 1592644375, "question_id": 28568336, "link": "https://stackoverflow.com/questions/28568336/stick-with-2-layouts-only-when-pretty-printing", "title": "Stick with 2 layouts only when pretty printing", "body": "<p>I'm pretty-printing a C++ method declaration and I want arguments list to be rendered in a compact form if it fits the line:</p>\n<pre><code>void method(MyLongClassName&amp; instance, const MyClass&amp; c);\n</code></pre>\n<p>or to be formatted in columns if it doesn't:</p>\n<pre><code>void method(      MyLongClassName&amp; instance,\n            const MyClass&amp;         c,\n                  int              counter);\n</code></pre>\n<p>all other layouts I want to eliminate from consideration.\nIt seems to be simple neither with <a href=\"http://hackage.haskell.org/package/wl-pprint\" rel=\"nofollow noreferrer\">wl-pprint</a> nor with <a href=\"http://hackage.haskell.org/package/pretty\" rel=\"nofollow noreferrer\">pretty</a>, if not hacking the sources.</p>\n<p>Any ideas?</p>\n"}, {"tags": ["haskell", "llvm", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 291, "user_id": 1505906, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ac956c69d76af2f718bfaf147a7c0bc3?s=128&d=identicon&r=PG", "display_name": "meldo", "link": "https://stackoverflow.com/users/1505906/meldo"}, "edited": false, "score": 0, "creation_date": 1424200328, "post_id": 28569005, "comment_id": 45448449, "body": "ghc -fllvm -keep-llvm-files src.hs and replacing v 3.5.1 opt and llc with v 3.5.0 ones didn&#39;t help."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1424205607, "post_id": 28569005, "comment_id": 45451236, "body": "GHC works with any version of LLVM, as far as I&#39;m aware. If the files are not named <code>opt</code> and <code>llc</code>, but rather something like <code>opt-3.5</code> and <code>llc-3.5</code>, then you may need to add the options <code>-pgmlo opt-3.5 -pgmlc llc-3.5</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1010424"}, "edited": false, "score": 0, "creation_date": 1424259524, "post_id": 28569005, "comment_id": 45473022, "body": "i meant that ghc version \u2a7d 7.8 works only with llvm which version is \u2a7d 3.5"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1010424"}, "is_accepted": false, "score": 2, "last_activity_date": 1424199718, "last_edit_date": 1424199718, "creation_date": 1424199387, "answer_id": 28569005, "question_id": 28568312, "link": "https://stackoverflow.com/questions/28568312/how-to-compile-hs-to-llvm-ir-ll-using-ghc-compiler/28569005#28569005", "title": "How to compile *.hs to llvm ir (*.ll) using GHC compiler?", "body": "<p>1) <code>-pgm[letter]</code> - use this command if you only compiling into C code(in your case if you compiling without <code>-fllvm</code> flag)</p>\n\n<p>2) <code>-keep-llvm-files</code> - find .ll files in current directory, otherwise try to find them in /tmp directory(i saw this bug somewhere)</p>\n\n<p>3) <code>ghc</code> works only with llvm 3.5</p>\n"}, {"comments": [{"owner": {"reputation": 291, "user_id": 1505906, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ac956c69d76af2f718bfaf147a7c0bc3?s=128&d=identicon&r=PG", "display_name": "meldo", "link": "https://stackoverflow.com/users/1505906/meldo"}, "edited": false, "score": 0, "creation_date": 1424253974, "post_id": 28570331, "comment_id": 45469631, "body": "Force recompilation helped. Thank you."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 8, "last_activity_date": 1424204170, "creation_date": 1424204170, "answer_id": 28570331, "question_id": 28568312, "link": "https://stackoverflow.com/questions/28568312/how-to-compile-hs-to-llvm-ir-ll-using-ghc-compiler/28570331#28570331", "title": "How to compile *.hs to llvm ir (*.ll) using GHC compiler?", "body": "<p>Probably GHC didn't recompile your program since the program hadn't changed since you last ran GHC. This seems likely since <code>-pgmlo -pgmlc</code> means \"use <code>-pgmlc</code> as the LLVM optimizer\" which is not going to work. Just run</p>\n\n<pre><code>ghc -fllvm -keep-llvm-files -fforce-recomp src.hs\n</code></pre>\n\n<p>(or manually modify <code>src.hs</code> and recompile it).</p>\n"}], "owner": {"reputation": 291, "user_id": 1505906, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ac956c69d76af2f718bfaf147a7c0bc3?s=128&d=identicon&r=PG", "display_name": "meldo", "link": "https://stackoverflow.com/users/1505906/meldo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1092, "favorite_count": 3, "accepted_answer_id": 28570331, "answer_count": 2, "score": 4, "last_activity_date": 1424204170, "creation_date": 1424197055, "question_id": 28568312, "link": "https://stackoverflow.com/questions/28568312/how-to-compile-hs-to-llvm-ir-ll-using-ghc-compiler", "title": "How to compile *.hs to llvm ir (*.ll) using GHC compiler?", "body": "<p>I tried</p>\n\n<pre><code>ghc -fllvm -pgmlo -pgmlc -ddump-llvm src.hs\n</code></pre>\n\n<p>and </p>\n\n<pre><code>ghc -fllvm -pgmlo -pgmlc -keep-llvm-files src.hs\n</code></pre>\n\n<p>opt and llc (3.5.1 version) are in PATH</p>\n\n<p>But I haven't found any llvm ir after I executed commands.</p>\n"}, {"tags": ["haskell", "pretty-print"], "answers": [{"comments": [{"owner": {"reputation": 950, "user_id": 890355, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4438b0be49fef6107f36fbddf30266b9?s=128&d=identicon&r=PG", "display_name": "AdelNick", "link": "https://stackoverflow.com/users/890355/adelnick"}, "edited": false, "score": 0, "creation_date": 1424255823, "post_id": 28580833, "comment_id": 45470890, "body": "That&#39;s smart. I&#39;d like to have a more explicit and clear way to do it and not to rely on laziness, however it should work, I think."}], "tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": true, "score": 1, "last_activity_date": 1424254078, "creation_date": 1424254078, "answer_id": 28580833, "question_id": 28567722, "link": "https://stackoverflow.com/questions/28567722/no-space-concatenating-with-an-empty-doc-in-wl-pprint/28580833#28580833", "title": "No space concatenating with an empty doc in wl-pprint", "body": "<p>This answers the \"test if <code>Doc</code> is empty\" part. </p>\n\n<p><code>renderCompact</code> gives you a <code>SimpleDoc</code> which you can pattern-match for <code>SEmpty</code>. </p>\n\n<p>It seems sufficiently lazy, e.g.</p>\n\n<pre><code>case ( renderCompact $ vcat $ repeat $ text \"foobar\" ) of \n   SEmpty -&gt; True ; _ -&gt; False\n</code></pre>\n"}], "owner": {"reputation": 950, "user_id": 890355, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4438b0be49fef6107f36fbddf30266b9?s=128&d=identicon&r=PG", "display_name": "AdelNick", "link": "https://stackoverflow.com/users/890355/adelnick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 1, "accepted_answer_id": 28580833, "answer_count": 1, "score": 2, "last_activity_date": 1424256146, "creation_date": 1424195204, "last_edit_date": 1424256146, "question_id": 28567722, "link": "https://stackoverflow.com/questions/28567722/no-space-concatenating-with-an-empty-doc-in-wl-pprint", "title": "No space concatenating with an empty doc in wl-pprint", "body": "<p>I'm using <a href=\"http://hackage.haskell.org/package/wl-pprint\" rel=\"nofollow\">wl-pprint</a> to output a data type with its fields rendered and separated with spaces. Some of the fields can be <code>Nothing</code>, so I render them as <code>empty</code>. Obviously, I don't want to add an extra space next to an empty string. It was easily achievable with <a href=\"http://hackage.haskell.org/package/pretty\" rel=\"nofollow\">HughesPJ library</a>, as its <code>&lt;+&gt;</code> operator has <code>empty</code> as unit. In wl-pprint the space in <code>&lt;+&gt;</code> is not optional however.</p>\n\n<p>It would be easy to implement myself, given a function to test if <code>Doc</code> is empty. My another question is didn't anyone ever need to check for an empty <code>Doc</code>? Is it considered to be a drawback of my algorithm design?</p>\n"}, {"tags": ["haskell", "currying"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1424195328, "post_id": 28567443, "comment_id": 45445706, "body": "<code>chain x = x landLeft 1 -: landRight 4 ...</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1424201375, "creation_date": 1424201375, "answer_id": 28569586, "question_id": 28567443, "link": "https://stackoverflow.com/questions/28567443/currying-of-chain-of-functions-linked-by/28569586#28569586", "title": "Currying of chain of functions linked by -:", "body": "<p>No, you can not. The reason why is that</p>\n\n<pre><code>chain = x -: y -: z\n</code></pre>\n\n<p>means</p>\n\n<pre><code>chain = z (y x)\n</code></pre>\n\n<p>So, when you apply <code>w -: chain</code>, you would get</p>\n\n<pre><code>w -: chain = z (y x) w\n</code></pre>\n\n<p>which is essentially garbage, and likely the type checker will complain.\nYou instead want to have</p>\n\n<pre><code>w -: chain = z (y (x w)))\n</code></pre>\n\n<p>What you could do is defining the chain using the composition operator <code>(.)</code>.</p>\n\n<pre><code>chain = z . y . x\n</code></pre>\n\n<p>Note that the order is <em>opposite</em> to the one you had in <code>-:</code>. For reversing the order, you could instead use</p>\n\n<pre><code>import Control.Arrow (&gt;&gt;&gt;)\nchain = x &gt;&gt;&gt; y &gt;&gt;&gt; z\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 4, "last_activity_date": 1424201753, "last_edit_date": 1424201753, "creation_date": 1424201403, "answer_id": 28569596, "question_id": 28567443, "link": "https://stackoverflow.com/questions/28567443/currying-of-chain-of-functions-linked-by/28569596#28569596", "title": "Currying of chain of functions linked by -:", "body": "<p>You could give an explicit argument</p>\n\n<pre><code>chain x = x -: landLeft 1 -: landRight 4 -: landLeft (-1) -: landRight (-2)\n</code></pre>\n\n<p>This operator is not very conducive to chaining operations by themselves, it's really just <code>flip ($)</code>, and as we know you can't do something like <code>chain = h $ g $ f</code> to replace <code>h $ g $ f $ x</code>.  Instead, it's common to replace to the <code>$</code> with <code>.</code>, as in <code>chain = h . g . f</code>.  If you want to use the left-to-right style instead, I'd recommend making a separate operator to be the equivalent of <code>flip (.)</code>:</p>\n\n<pre><code>(-:) = flip ($)\n(-.) = flip (.)\n\nchain = landLeft 1 -. landRight 4 -. landLeft (-1) -. landRight (-2)\n</code></pre>\n\n<p>Or you could use operators from <code>Control.Arrow</code> along with your <code>-:</code> operator:</p>\n\n<pre><code>import Control.Arrow\n\nchain = landLeft 1 &gt;&gt;&gt; landRight 4 &gt;&gt;&gt; landLeft (-1) &gt;&gt;&gt; landRight (-2)\n\n&gt; x -: chain\n</code></pre>\n\n<p>Actually, given the operators in <code>Control.Arrow</code>, you can define <code>landLeft</code> and <code>landRight</code>:</p>\n\n<pre><code>landLeft c = first (+c)\nlandRight c = second (+c)\nlandBoth c = (+c) *** (+c)\n</code></pre>\n"}], "owner": {"reputation": 5242, "user_id": 50962, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e39b7acdae85aedee02487bed17ff5f6?s=128&d=identicon&r=PG", "display_name": "altern", "link": "https://stackoverflow.com/users/50962/altern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 28569596, "answer_count": 2, "score": 0, "last_activity_date": 1424201753, "creation_date": 1424194244, "question_id": 28567443, "link": "https://stackoverflow.com/questions/28567443/currying-of-chain-of-functions-linked-by", "title": "Currying of chain of functions linked by -:", "body": "<p>I am learning Haskell with <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow\">LYAH</a> tutorial. I am at <a href=\"http://learnyouahaskell.com/a-fistful-of-monads#walk-the-line\" rel=\"nofollow\">Walk the line</a> section. It introduced very helpful operator:</p>\n\n<pre><code>x -: f = f x \n</code></pre>\n\n<p>It allows taking initial state and chain functions with this operator:</p>\n\n<pre><code>(0,0) -: landLeft 1 -: landRight 4 -: landLeft (-1) -: landRight (-2)\n</code></pre>\n\n<p>My question is how could I take this chain of functions and give it a separate name? For example:</p>\n\n<pre><code>chain = landLeft 1 -: landRight 4 -: landLeft (-1) -: landRight (-2)\n(0,0) -: chain\n</code></pre>\n"}, {"tags": ["haskell", "happstack"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "edited": false, "score": 0, "creation_date": 1424276045, "post_id": 28566458, "comment_id": 45483492, "body": "about <code>$</code> symbol, not putting function arguments in brackets is the convention in haskell right..."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1424278463, "post_id": 28566458, "comment_id": 45485152, "body": "Yeah, that&#39;s right. It&#39;s for if you have something like <code>f1 (f2 (f3 (f4 x)))</code>, you can instead write <code>f1 $ f2 $ f3 $ f4 x</code>. A bit like a shell pipeline."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 4, "last_activity_date": 1424191309, "creation_date": 1424191309, "answer_id": 28566458, "question_id": 28565790, "link": "https://stackoverflow.com/questions/28565790/happstack-hello-world-server/28566458#28566458", "title": "Happstack - hello world server", "body": "<p>1) Both <code>simpleHTTP</code> and <code>nullConf</code> will be defined in whatever library you're importing.</p>\n\n<p>2) The <code>$</code> symbol is mentioned in a dozen Haskell tutorials and Stack Overflow questions; basically it allows you to avoid putting stuff in brackets.</p>\n\n<p>3) Cabal <em>already</em> downloads everything as source code. But it immediately compiles it into binaries and then deletes the sources. However, if you read the package documentation on Hackage, every page has a \"Source Code\" link that will show you syntax-highlighted code, right in your browser. (Just make sure you're reading the same package version as the one you have installed!)</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 28566458, "answer_count": 1, "score": 1, "last_activity_date": 1424191309, "creation_date": 1424189356, "question_id": 28565790, "link": "https://stackoverflow.com/questions/28565790/happstack-hello-world-server", "title": "Happstack - hello world server", "body": "<pre><code>main = simpleHTTP nullConf $ ok \"Hello, World!\"\n</code></pre>\n\n<p>i am a newbie trying out haskell with <code>happstack-server</code>. In this hello world program, i got these doubts:</p>\n\n<p>1) Server's default configuration, <code>nullConf</code>, where is it defined? at least it is not there in <code>$HOME/.cabal/Happstack/Server.hs</code></p>\n\n<p>2) What does <code>$</code> symbol in the middle of function arguments mean?</p>\n\n<p>3) Is there any way, i can force cabal to download source libraries instead of compiled haskell binaries? That will help me a lot in source code debugging.</p>\n"}, {"tags": ["haskell", "higher-order-functions"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1424186873, "post_id": 28564867, "comment_id": 45440176, "body": "It&#39;d be best to leave the type signature the same as your problem  The type <code>a -&gt; [a]</code> is not that of a function that &quot;takes a list of integer pairs as inputs and outputs a list of lists containing pairs of integers&quot;, it&#39;s that of a function that takes a value and returns a list of values.  This can be specialized to what you intend it to be, but you could also pass it e.g. a <code>Bool</code>.  Also, the point of higher order functions is to pass another function as an argument, not the result of another function, that&#39;s regular order functions.  Try <code>search function1 function1 [(0,0),(0,1)]</code>."}, {"owner": {"reputation": 17066, "user_id": 1135948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5edf3c92c5e52ed83cbd5ebd98f4c18d?s=128&d=identicon&r=PG", "display_name": "lmm", "link": "https://stackoverflow.com/users/1135948/lmm"}, "edited": false, "score": 0, "creation_date": 1424186890, "post_id": 28564867, "comment_id": 45440190, "body": "The easiest thing might be to define the functions explicitly: <code>myFunction1 :: bool -&gt; [bool] myFunction1 b = [true, false, b]</code> or whatever you want your  <code>myFunction1</code> to be. Then you can pass <code>myFunction1</code> as the argument."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424187013, "post_id": 28564867, "comment_id": 45440261, "body": "Quite literally, the <code>search</code> function is called in the same manner it&#39;s declared.  Think of the <code>map</code> function: <code>map length [&quot;this&quot;, &quot;is&quot;, &quot;a&quot;, &quot;test&quot;]</code> would return <code>[4,2,1,4]</code>, it isn&#39;t called as <code>map (length [&quot;this&quot;, &quot;is&quot;, &quot;a&quot;, &quot;test&quot;]) [&quot;this&quot;, &quot;is&quot;, &quot;a&quot;, &quot;test&quot;]</code>, which wouldn&#39;t be the same anyway, since it would reduce to something like <code>map 4 [&quot;this&quot;, &quot;is&quot;, &quot;a&quot;, &quot;test&quot;]</code>, since that argument list has length 4, and mapping the &quot;function <code>4</code>&quot; is nonsensical."}, {"owner": {"reputation": 729, "user_id": 3255571, "user_type": "registered", "accept_rate": 10, "profile_image": "https://i.stack.imgur.com/IRrQA.jpg?s=128&g=1", "display_name": "Wolff", "link": "https://stackoverflow.com/users/3255571/wolff"}, "edited": false, "score": 0, "creation_date": 1424187222, "post_id": 28564867, "comment_id": 45440422, "body": "Oops, I should say the functions function1, function2 are defined explicitly elsewhere in the document, and I&#39;m not allowed to change the type declaration used by the fuctions.  The thing that confuses me is where does function1 and function2 get its parameters? Will they take listOfIntegerPairs as their own argument?  i.e. search function1 function2 [(0,0),(1,0)]?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424187409, "post_id": 28564867, "comment_id": 45440556, "body": "@Wolff I&#39;m not saying that you should change the type declarations, just that you should edit your question so that the <code>search</code> function has the same type signature.  Haskell type signatures are very informative and useful, intentionally providing the wrong type signature when asking for help would be like asking for help finding a bug in a C++ function, but removing the lines that cause the bug in the question."}, {"owner": {"reputation": 729, "user_id": 3255571, "user_type": "registered", "accept_rate": 10, "profile_image": "https://i.stack.imgur.com/IRrQA.jpg?s=128&g=1", "display_name": "Wolff", "link": "https://stackoverflow.com/users/3255571/wolff"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424187635, "post_id": 28564867, "comment_id": 45440751, "body": "@bheklilr I changed &#39;a&#39; to [(Int,Int)]. Is that what you mean?"}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1424190292, "post_id": 28564867, "comment_id": 45442479, "body": "@Wolff: You asked &quot;The thing that confuses me is where does function1 and function2 get its parameters?&quot; and the answer is: from the function which is to be defined, <code>search</code>. <code>search</code> is given <code>listOfIntegerPairs</code> and then applies <code>function1</code> and <code>function2</code> to that list to massage it into the desired value."}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 9, "last_activity_date": 1424190073, "last_edit_date": 1424190073, "creation_date": 1424187932, "answer_id": 28565315, "question_id": 28564867, "link": "https://stackoverflow.com/questions/28564867/haskell-what-does-the-input-of-a-higher-order-function-look-like-if-it-takes-f/28565315#28565315", "title": "Haskell - What does the input of a higher-order function look like if it takes functions as arguments?", "body": "<p>The <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-List.html#v:find\"><code>find</code></a> function in <code>Data.List</code> has a similar type.</p>\n\n<pre><code>find :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe a\n</code></pre>\n\n<p>Without revealing <code>find</code>s definition, we can try using it in ghci. First we'll need to import <code>Data.List</code> since that's where it's defined.</p>\n\n<pre><code>&gt; import Data.List\n</code></pre>\n\n<h3>Pass a declared function</h3>\n\n<p>The first argument to <code>find</code> says it needs a function with the type <code>a -&gt; Bool</code>. To pass an argument to <code>find</code> we pass it the whole function. We don't need to call that function first, or give that function arguments, we can treat the function as an ordinary value and pass the entire function to <code>find</code>. This ability to treat functions as ordinary values is what is meant when we talk about \"functions as first-class citizens\" of the language; we can do anything with functions that we could do with all other types. To pass something to find, we'll need to define it first.</p>\n\n<pre><code>&gt; let divisibleBy3 x = x `mod` 3 == 0\n</code></pre>\n\n<p>Now, we'll pass the entire <code>divisibleBy3</code> function to <code>find</code> as its first argument. As the second argument, we'll pass a list that has something we want to find, <code>[4, 7, 9, 10]</code></p>\n\n<pre><code>&gt; find divisibleBy3 [4, 7, 9, 10]\nJust 9\n</code></pre>\n\n<h3>Pass a lambda</h3>\n\n<p>Haskell provides other ways to define a function that simply referencing one that has already been defined. A lambda constructs a new <a href=\"https://wiki.haskell.org/Anonymous_function\">anonymous function</a>. If the constructed function has the correct type, we can pass it as the first argument to <code>find</code>.</p>\n\n<pre><code>&gt; find (\\x -&gt; x*3 == x + 8) [1,2,3,4,5,6,7,8,9,10]\nJust 4\n</code></pre>\n\n<h3>Pass a result</h3>\n\n<p>Function types can appear both as arguments to a function and as the result of a function. This means we can make functions that make new functions. We could have written the function composition operator, <code>.</code>, as an ordinary function declaration. To do so, we first need to hide the definition from the prelude.</p>\n\n<pre><code>&gt; import Prelude hiding ((.))\n&gt; let f . g = \\x -&gt; f (g (x))\n</code></pre>\n\n<p>Writing it with a lambda on the right-hand side emphasizes that, when applied to only two arguments, function composition returns a function. Anywhere we need a function, we can pass any expression that has the correct type. This means we can pass the result of <code>.</code> into <code>find</code>. It also means we can pass functions defined any of these ways in as the arguments to <code>.</code>.</p>\n\n<pre><code>&gt; find (not . odd) [1, 1, 2, 3, 5, 8]\nJust 2\n\n&gt; find (not . divisibleBy3 . (\\x -&gt; x*(x+1))) [2, 3, 4, 5, 6]\nJust 4\n</code></pre>\n\n<h3>Pass a partial application</h3>\n\n<p>When we define a function like</p>\n\n<pre><code>same :: Int -&gt; Int -&gt; Bool\nsame x y = x - y == 0\n</code></pre>\n\n<p>The function type constructor <code>-&gt;</code> in the type of <code>same</code> is right associative, which means things on the right are grouped together before things on the left.</p>\n\n<pre><code>same :: Int -&gt; (Int -&gt; Bool)\n</code></pre>\n\n<p>With these parentheses added we can see that <code>same</code>, which looks like a function of two arguments, can be treated as a function with only one argument, <code>Int</code>, that returns a function, <code>Int -&gt; Bool</code>. We can use a <a href=\"https://wiki.haskell.org/Partial_application\">partially applied</a> function to produce functions to pass as arguments.</p>\n\n<pre><code>&gt; let same x y = x - y == 0\n&gt; find (same 7) [1..10]\nJust 7\n</code></pre>\n"}], "owner": {"reputation": 729, "user_id": 3255571, "user_type": "registered", "accept_rate": 10, "profile_image": "https://i.stack.imgur.com/IRrQA.jpg?s=128&g=1", "display_name": "Wolff", "link": "https://stackoverflow.com/users/3255571/wolff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 662, "favorite_count": 0, "accepted_answer_id": 28565315, "answer_count": 1, "score": 2, "last_activity_date": 1424190073, "creation_date": 1424186637, "last_edit_date": 1424187586, "question_id": 28564867, "link": "https://stackoverflow.com/questions/28564867/haskell-what-does-the-input-of-a-higher-order-function-look-like-if-it-takes-f", "title": "Haskell - What does the input of a higher-order function look like if it takes functions as arguments?", "body": "<p>I'm working with Haskell, and trying to implement a higher-order function, but I'm having trouble understanding and testing the function because I'm unsure what an input would look like.</p>\n\n<p>Since the function itself is part of a graded assignment, I can't ask for help regarding writing/implementing the function itself, so I've changed the function names and custom type names, so I can use the function as an example on what the input arguments would look like, if you were to type them into the console.</p>\n\n<pre><code>search :: ([(Int,Int)] -&gt; [[(Int,Int)]]) -&gt; ([(Int,Int)] -&gt; Bool) -&gt; [[(Int,Int)]] -&gt; Maybe [(Int,Int)]\nsearch function1 function2 listOfIntegerPairs\n</code></pre>\n\n<p>function1 takes a list of integer pairs as input and outputs a list of lists containing pairs of integers.</p>\n\n<p>function2 takes a list of integer pairs and outputs a boolean.</p>\n\n<p>I'm unsure as to how one might input the arguments for this higher-order function into the console.</p>\n\n<p>i.e. Would it be something like this where we include the function and it's parameters as arguments?</p>\n\n<pre><code>search (function1([(0,0),(0,1)])) (function2([(0,0),(0,1)])) [(0,0),(0,1)]\n</code></pre>\n\n<p>This form produces errors, but I can't figure out what the input arguments would look like, and having trouble locating any articles/tutorials which illustrates it. Hence I can't test the function until I work out what the input function arguments look like types out.</p>\n\n<p>Can anyone offer me some guidance? Is what I'm asking even possible?</p>\n"}, {"tags": ["haskell", "indentation", "pretty-print"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1424187053, "post_id": 28564852, "comment_id": 45440297, "body": "Have you looked for one at all?  SO is not the place to get someone to find you a library (hence why there&#39;s a close reason for that specific purpose)."}, {"owner": {"reputation": 4976, "user_id": 204851, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/fc2292d408e831e2d3ed77b8964e5ccf?s=128&d=identicon&r=PG", "display_name": "Wickoo", "link": "https://stackoverflow.com/users/204851/wickoo"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424187608, "post_id": 28564852, "comment_id": 45440720, "body": "@bheklilr I looked but couldn&#39;t find something out of box. I don&#39;t know Haskell and it&#39;s pretty hard for me to figure out how to use a library in Haskell. I read in a paper that haskell-src-exts has a pretty printer but omit comments and whitespace. So if I searched and couldn&#39;t find and don&#39;t know the language, am I allowed to ask a question on SO?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424217212, "post_id": 28564852, "comment_id": 45456456, "body": "@Ali You should include all relevant details in the question. &quot;I found this library but it doesn&#39;t quite do what I want/I can&#39;t figure it out; can I use it for my purposes&quot; is a relevant detail."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1424217466, "post_id": 28564852, "comment_id": 45456533, "body": "Also, haskell-src-exts will do exactly what you want - for example, if your file is called test.hs, you could do <code>(fmap . fmap) (prettyPrintStyleMode style (defaultMode { layout = PPSemiColon})) (parseFile &quot;test.hs&quot;)</code> (import the appropriate modules, of course). This information can be discovered quite easily by reading the documentation for haskell-src-exts; in the future, that is where you should start."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424223106, "post_id": 28564852, "comment_id": 45458297, "body": "@user2407038: does haskell-src-exts preserve comments?"}], "owner": {"reputation": 4976, "user_id": 204851, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/fc2292d408e831e2d3ed77b8964e5ccf?s=128&d=identicon&r=PG", "display_name": "Wickoo", "link": "https://stackoverflow.com/users/204851/wickoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1424223065, "creation_date": 1424186585, "last_edit_date": 1424223065, "question_id": 28564852, "link": "https://stackoverflow.com/questions/28564852/haskell-source-file-replace-indentation-with-brackets", "title": "Haskell source file replace indentation with brackets", "body": "<p>I'm trying to replace the use of indentation in a Haskell source file with explicit brackets and semicolons, while preserving whitespace and comments. For example, for the input</p>\n\n<pre><code>module Main where\n\n   import System.IO\n\n   f x = x\n\n   main = print (f 5)\n</code></pre>\n\n<p>I expect</p>\n\n<pre><code>module Main where {\n\n   import System.IO;\n\n   f x = x;\n\n   main = print (f 5)\n}\n</code></pre>\n\n<p>I read in a paper that <code>haskell-src-exts</code> has a pretty printer but omit comments and whitespace; is there a way to use the library anyway, or some other technique I can use?</p>\n"}, {"tags": ["string", "performance", "haskell", "ffi"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1424185480, "post_id": 28564351, "comment_id": 45439326, "body": "If you&#39;re considering <code>CString</code>s, the closest higher level data type is probably bytestring, in particular the use of the <a href=\"http://hackage.haskell.org/package/bytestring-0.10.4.1/docs/Data-ByteString-Unsafe.html\" rel=\"nofollow noreferrer\">Data.ByteString.Unsafe</a> module."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424186167, "post_id": 28564351, "comment_id": 45439742, "body": "@bheklilr Thanks! <a href=\"http://hackage.haskell.org/package/bytestring-0.10.4.1/docs/Data-ByteString-Unsafe.html#g:2\" rel=\"nofollow noreferrer\">Low level interaction with CStrings</a> looks similar to what I need. I will explore more whether there are &quot;safe&quot; analogues to <code>unsafePackMallocCString</code> (because if something is called &quot;unsafe&quot;, I assume there is a safer, but less efficient variant), and whether things similar to &quot;Low level interaction with CStrings&quot; can be done with <code>Text</code> (if I want to correctly work with Unicode)..."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424186456, "post_id": 28564351, "comment_id": 45439921, "body": "Since you&#39;re doing low level programming this is one of the times when unsafe functions are ok to use, but your overlying API should make their use safe.  For example, you could use <code>unsafePackMallocCString</code> to create the <code>ByteString</code>, but never allow the pointer to escape the scope of whatever function uses <code>unsafePackMallocCString</code>.  The worry is that the underlying memory can be modified after passing the ByteString to a pure function, thus breaking purity, but if you never let the pointer get somewhere that could poke to it then you&#39;d be safer."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424186538, "post_id": 28564351, "comment_id": 45439969, "body": "Alternatively, you could write a single module in your project for a <code>ReadOnlyCString</code> or something similar that uses a newtype wrapper around the Foreign type you&#39;re using, but only exports functions for reading the values at that memory location.  It&#39;d be tricky, but it&#39;s possible."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424187101, "post_id": 28564351, "comment_id": 45440326, "body": "@bheklilr And what if wrap <code>unsafePackMallocCString cstr</code> into <code>unsafePerfmormIO</code>? Because I understand that given a constant <code>cstr</code>, the result will be always the same (from the point of view of <code>String</code>-programming), no matter how many times I call it. May I hope that the resulting <code>ByteString</code> will be correctly garbage-collected and freed whenever there are no more potential uses of it in the computation?.."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424187306, "post_id": 28564351, "comment_id": 45440481, "body": "I can&#39;t comment on the GC, but I&#39;ll say that the use of <code>unsafePerformIO</code> can be appropriate when properly managed.  I&#39;m not an expert on this, I&#39;d recommend finding instance of its use in mature libraries (bytestring might be one of those, I believe the ST type is another), but I&#39;m pretty sure that you need a pragma or two like <code>NOINLINE</code> and the like to keep GHC from mangling your code causing unexpected behavior."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424219235, "post_id": 28564351, "comment_id": 45457093, "body": "@bheklilr Continuing to think over hiding <code>unsafePackMallocCString</code>&#39;s IO-ness (with <code>unsafePerformIO</code>): well, <code>unsafePackMallocCString</code> is presented as an IO, but I could look for examples where the IO is hidden in the implementation of <code>ByteString</code> itself (not initialized from a foreign CString), or of <code>Array</code> -- they must do a similar thing: allocate a buffer, and present it as Haskell data, and the initialization is not an IO. I&#39;ll look into their source code to have some examples..."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1456167593, "post_id": 28564351, "comment_id": 58811494, "body": "@bheklilr your comments here seemed on the money. it would be worth adding them as an answer..."}], "owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 159, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1424185176, "creation_date": 1424185176, "last_edit_date": 1495539899, "question_id": 28564351, "link": "https://stackoverflow.com/questions/28564351/is-there-a-string-like-data-type-in-haskell-implemented-on-top-of-plain-memory-b", "title": "Is there a String-like data type in Haskell implemented on top of plain memory buffers, to avoid conversion when FFIing with C?", "body": "<p>For efficiency of my FFI, I want to work directly with buffers holding strings which are produced by C functions, without the copying&amp;conversion to <code>String</code> done by <code>peekCString</code>, as seen for example in <a href=\"http://hackage.haskell.org/package/unix-2.7.1.0/docs/src/System-Posix-IO-Common.html#fdRead\" rel=\"nofollow noreferrer\"><code>fdRead</code></a> (see the code below).</p>\n\n<p>Are there such types analogous to <code>String</code> implemented? With standard string functions and perhaps the ability to pattern match against string literals.</p>\n\n<p>Perhaps something among the <a href=\"https://stackoverflow.com/q/9398572/94687\">Memory efficient strings in Haskell</a>?</p>\n\n<p>I've already <a href=\"https://stackoverflow.com/q/28563342/94687\">found out</a> that w.r.t. memory management, I'd need a <code>ForeignPtr</code> (to let the garbage collector free unused buffers that have been allocated to hold the data created by foreign functions).</p>\n\n<h3>Referenced code examples</h3>\n\n<p><a href=\"http://hackage.haskell.org/package/unix-2.7.1.0/docs/src/System-Posix-IO-Common.html#fdRead\" rel=\"nofollow noreferrer\"><code>fdRead</code></a> using <code>peekCString</code>:</p>\n\n<pre><code>-- -----------------------------------------------------------------------------\n-- fd{Read,Write}\n\n-- | Read data from an 'Fd' and convert it to a 'String' using the locale encoding.\n-- Throws an exception if this is an invalid descriptor, or EOF has been\n-- reached.\nfdRead :: Fd\n       -&gt; ByteCount -- ^How many bytes to read\n       -&gt; IO (String, ByteCount) -- ^The bytes read, how many bytes were read.\nfdRead _fd 0 = return (\"\", 0)\nfdRead fd nbytes = do\n    allocaBytes (fromIntegral nbytes) $ \\ buf -&gt; do\n    rc &lt;- fdReadBuf fd buf nbytes\n    case rc of\n      0 -&gt; ioError (ioeSetErrorString (mkIOError EOF \"fdRead\" Nothing Nothing) \"EOF\")\n      n -&gt; do\n       s &lt;- peekCStringLen (castPtr buf, fromIntegral n)\n       return (s, n)\n\n-- | Read data from an 'Fd' into memory.  This is exactly equivalent\n-- to the POSIX @read@ function.\nfdReadBuf :: Fd\n          -&gt; Ptr Word8 -- ^ Memory in which to put the data\n          -&gt; ByteCount -- ^ Maximum number of bytes to read\n          -&gt; IO ByteCount -- ^ Number of bytes read (zero for EOF)\nfdReadBuf _fd _buf 0 = return 0\nfdReadBuf fd buf nbytes =\n  fmap fromIntegral $\n    throwErrnoIfMinus1Retry \"fdReadBuf\" $\n      c_safe_read (fromIntegral fd) (castPtr buf) nbytes\n\nforeign import ccall safe \"read\"\n   c_safe_read :: CInt -&gt; Ptr CChar -&gt; CSize -&gt; IO CSsize\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 10595, "user_id": 758446, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/d08a0b2d56c559112b5f18ee2e975c97?s=128&d=identicon&r=PG", "display_name": "BlackVegetable", "link": "https://stackoverflow.com/users/758446/blackvegetable"}, "edited": false, "score": 1, "creation_date": 1424184004, "post_id": 28563887, "comment_id": 45438255, "body": "I suspect it is a linked list, but I&#39;m not sure what <code>push_back</code> is.  Could you explain?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 10595, "user_id": 758446, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/d08a0b2d56c559112b5f18ee2e975c97?s=128&d=identicon&r=PG", "display_name": "BlackVegetable", "link": "https://stackoverflow.com/users/758446/blackvegetable"}, "edited": false, "score": 0, "creation_date": 1424184080, "post_id": 28563887, "comment_id": 45438315, "body": "Haskell list are singly linked list. As @BlackVegetable says, what do you mean by <code>push_back</code> ?"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1424184353, "post_id": 28563887, "comment_id": 45438518, "body": "I believe C++ list&lt;T&gt; is doubly-linked whereas haskell&#39;s list is singly-linked so only adding to the front can be done efficiently."}, {"owner": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "reply_to_user": {"reputation": 10595, "user_id": 758446, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/d08a0b2d56c559112b5f18ee2e975c97?s=128&d=identicon&r=PG", "display_name": "BlackVegetable", "link": "https://stackoverflow.com/users/758446/blackvegetable"}, "edited": false, "score": 0, "creation_date": 1424184404, "post_id": 28563887, "comment_id": 45438557, "body": "@BlackVegetable I&#39;ve edited the question, thanks for your help."}, {"owner": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1424184424, "post_id": 28563887, "comment_id": 45438573, "body": "@Sibi  I&#39;ve edited the question, thanks for your help."}, {"owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "edited": false, "score": 1, "creation_date": 1424184637, "post_id": 28563887, "comment_id": 45438704, "body": "You might want to take a look at <a href=\"https://hackage.haskell.org/package/dequeue-0.1.5/docs/Data-Dequeue.html\" rel=\"nofollow noreferrer\">Data.Dequeue</a> which has support for amortised O(1) pushBack and pushFront."}], "answers": [{"comments": [{"owner": {"reputation": 5432, "user_id": 3210257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e031a73b4d825b34b8fbcdae03b76f0b?s=128&d=identicon&r=PG", "display_name": "PatJ", "link": "https://stackoverflow.com/users/3210257/patj"}, "edited": false, "score": 2, "creation_date": 1424184614, "post_id": 28564042, "comment_id": 45438685, "body": "To be noted, the cost of push_back comes from the persistent aspect of the variable, you have to generate a brand new list as you can&#39;t modify your old list in place."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 6, "last_activity_date": 1424184347, "creation_date": 1424184347, "answer_id": 28564042, "question_id": 28563887, "link": "https://stackoverflow.com/questions/28563887/haskell-whats-the-underlying-data-structure-for-list/28564042#28564042", "title": "Haskell: What&#39;s the underlying data structure for list?", "body": "<p>Haskell list are singly linked list. It supports appending to the end of the list, but it has to traverse the entire list for this operation.:</p>\n\n<pre><code>\u03bb&gt; let x = [1,2,3]\n\u03bb&gt; x ++ [4]\n[1,2,3,4]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 708, "user_id": 4553930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/308c878dca0a01a80bc9b5b9b19c7ab6?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay", "link": "https://stackoverflow.com/users/4553930/abhay"}, "is_accepted": false, "score": 3, "last_activity_date": 1424184511, "creation_date": 1424184511, "answer_id": 28564100, "question_id": 28563887, "link": "https://stackoverflow.com/questions/28563887/haskell-whats-the-underlying-data-structure-for-list/28564100#28564100", "title": "Haskell: What&#39;s the underlying data structure for list?", "body": "<p>If by <code>push_back</code> you mean adding an element to the end, of course it \"supports\" it. To add an element <code>x</code> to a list <code>list</code> (and get a new list so constructed), use the expression <code>list ++ [x]</code>.</p>\n\n<p>Beware though, that this is an O(n) operation, n being the length of <code>list</code>.</p>\n\n<p>That's because it is a singly linked list. It also answers your other question about subscript.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1424196037, "creation_date": 1424196037, "answer_id": 28568010, "question_id": 28563887, "link": "https://stackoverflow.com/questions/28563887/haskell-whats-the-underlying-data-structure-for-list/28568010#28568010", "title": "Haskell: What&#39;s the underlying data structure for list?", "body": "<p>Since the question asks about the \"underlying implementation\":</p>\n\n<p>The list type is (conceptually) defined like this:</p>\n\n<pre><code>data [a] = [] | a:[a]\n</code></pre>\n\n<p>You can't actually write this declaration, because lists have funky syntax. But you can make exactly the same kind of thing yourself</p>\n\n<pre><code>data List a = Nil | a :* List a\ninfixr 5 :*\n</code></pre>\n\n<p>When you write something like <code>[1,2,3]</code>, that's just special syntax for <code>1:2:3:[]</code>. Since <code>:</code> associates to the right, this really means <code>1:(2:(3:[]))</code>. The functions on lists are all, fundamentally, based on pattern matching, which deals with just one constructor at a time. You may have to open up a lot of <code>:</code> constructors to get to the end of a list, and then build a bunch of <code>:</code> constructors to put together a new version with an extra element at the end. Any functions (like <code>++</code>) that you may use will end up going through this sort of process internally.</p>\n"}], "owner": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 28564042, "answer_count": 3, "score": 0, "last_activity_date": 1424196037, "creation_date": 1424183872, "last_edit_date": 1424184284, "question_id": 28563887, "link": "https://stackoverflow.com/questions/28563887/haskell-whats-the-underlying-data-structure-for-list", "title": "Haskell: What&#39;s the underlying data structure for list?", "body": "<p>If it's linked list, why doesn't it support push_back?</p>\n\n<p>If it's simply array, why does it need linear time when accessed by subscript?</p>\n\n<p>Appreciated for your help.</p>\n\n<hr>\n\n<p>Edit: We can append element in front of a list like this <code>1:[2,3]</code>, that's push_front; but we can't do it this way: <code>[2,3]:4</code>, that's push_back.</p>\n\n<p>ps. actually I borrow push_front/back from C++'s STL</p>\n"}, {"tags": ["haskell", "memory-management", "garbage-collection", "ffi"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1424183432, "post_id": 28563342, "comment_id": 45437829, "body": "Have you seen <code>ForeignPtr</code>? It&#39;s like a <code>Ptr</code> with an attached finalizer that will be called whenever it is GC&#39;d: from that you should be able to call C to free the previously allocated object."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1424183527, "post_id": 28563342, "comment_id": 45437891, "body": "@chi Great! <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Foreign-ForeignPtr.html\" rel=\"nofollow noreferrer\">It sounds like</a> exactly the thing I was looking for. (Perhaps make this an answer so that I could accept it?)"}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1424184113, "post_id": 28563342, "comment_id": 45438336, "body": "@chi Now I&#39;ll have to look for <code>String</code>-analogues implemented on top of <code>ForeignPtr CChar</code>. Or on top of <code>Ptr CChar</code>: so that I can work with them inside the bracket <code>withForeignPtr</code>..."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1424192290, "creation_date": 1424192290, "answer_id": 28566796, "question_id": 28563342, "link": "https://stackoverflow.com/questions/28563342/how-can-i-make-data-that-is-allocated-manually-be-garbage-collected-in-haskell/28566796#28566796", "title": "How can I make data that is allocated manually be garbage-collected in Haskell?", "body": "<p>The <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Foreign-ForeignPtr.html\" rel=\"nofollow\"><code>ForeignPtr</code></a> type acts as a <code>Ptr</code> with an attached finalizer. When the <code>ForeignPtr</code> gets garbage collected, the finalizer is run, and can call the C side to free the pointer using the proper function. </p>\n\n<p>Since the pointer is no longer accessible from Haskell, this is typically the right moment to free it.</p>\n"}], "owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1424258075, "creation_date": 1424182228, "last_edit_date": 1495540250, "question_id": 28563342, "link": "https://stackoverflow.com/questions/28563342/how-can-i-make-data-that-is-allocated-manually-be-garbage-collected-in-haskell", "title": "How can I make data that is allocated manually be garbage-collected in Haskell?", "body": "<p>I'm thinking about a FFI calling some C functions from Haskell.</p>\n\n<p>If a memory buffer is used to hold some data and is allocated \"manually\" and then it is used in Haskell computations, can I somehow rely on the garbage collector to free it when it is not needed anymore.</p>\n\n<p>As for the manual allocations, there are basically two ways (but the difference doesn't seem to be essential for my question):</p>\n\n<ul>\n<li>allocating a buffer in Haskell, then passing it to C function, like in <a href=\"http://hackage.haskell.org/package/unix-2.7.1.0/docs/src/System-Posix-IO-Common.html#fdRead\" rel=\"nofollow noreferrer\"><code>fdRead</code></a></li>\n<li>allocating a buffer in C (with <code>malloc</code>, like in GNU's <a href=\"https://stackoverflow.com/q/28562512/94687\"><code>asprintf</code></a>), then returning the pointer to Haskell</li>\n</ul>\n\n<p>In both examples (<code>fdRead</code> or <code>asprintf</code>) there is also a problem that the data type stored in the buffer is not suitable for a Haskell program, therefore it is copied&amp;converted to be used in Haskell (with <code>peekCString</code>). (I'll put the code below.) After the copying&amp;conversion happens, the buffer is freed (in both cases).</p>\n\n<p>However, I'm thinking about a more efficient interface, where the Haskell would directly use the data as it is stored by a C function (without a conversion). (I haven't yet explored, say, alternative implementations of <code>String</code> and related functions: whether there is one among them which can work directly with some kind of C strings.)</p>\n\n<p>If I follow this route, then there is one global problem: how to control the disposal of the allocated buffers. (For side-effects-free functions--except for the allocation--I could even wrap the calls in <code>unsafePerformIO</code> or declare them so that they are not an <code>IO</code>.)</p>\n\n<h2>Examples with conversion and immediate freeing</h2>\n\n<h3>allocating in Haskell:</h3>\n\n<p><a href=\"http://hackage.haskell.org/package/unix-2.7.1.0/docs/src/System-Posix-IO-Common.html#fdRead\" rel=\"nofollow noreferrer\">fdRead</a> (here <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Foreign-Marshal-Alloc.html#v:allocaBytes\" rel=\"nofollow noreferrer\"><code>allocaBytes</code></a> must care for the freeing):</p>\n\n<pre><code>-- -----------------------------------------------------------------------------\n-- fd{Read,Write}\n\n-- | Read data from an 'Fd' and convert it to a 'String' using the locale encoding.\n-- Throws an exception if this is an invalid descriptor, or EOF has been\n-- reached.\nfdRead :: Fd\n       -&gt; ByteCount -- ^How many bytes to read\n       -&gt; IO (String, ByteCount) -- ^The bytes read, how many bytes were read.\nfdRead _fd 0 = return (\"\", 0)\nfdRead fd nbytes = do\n    allocaBytes (fromIntegral nbytes) $ \\ buf -&gt; do\n    rc &lt;- fdReadBuf fd buf nbytes\n    case rc of\n      0 -&gt; ioError (ioeSetErrorString (mkIOError EOF \"fdRead\" Nothing Nothing) \"EOF\")\n      n -&gt; do\n       s &lt;- peekCStringLen (castPtr buf, fromIntegral n)\n       return (s, n)\n\n-- | Read data from an 'Fd' into memory.  This is exactly equivalent\n-- to the POSIX @read@ function.\nfdReadBuf :: Fd\n          -&gt; Ptr Word8 -- ^ Memory in which to put the data\n          -&gt; ByteCount -- ^ Maximum number of bytes to read\n          -&gt; IO ByteCount -- ^ Number of bytes read (zero for EOF)\nfdReadBuf _fd _buf 0 = return 0\nfdReadBuf fd buf nbytes =\n  fmap fromIntegral $\n    throwErrnoIfMinus1Retry \"fdReadBuf\" $\n      c_safe_read (fromIntegral fd) (castPtr buf) nbytes\n\nforeign import ccall safe \"read\"\n   c_safe_read :: CInt -&gt; Ptr CChar -&gt; CSize -&gt; IO CSsize\n</code></pre>\n\n<h3>allocating in C</h3>\n\n<p><code>getValue.c</code>:</p>\n\n<pre><code>#define _GNU_SOURCE\n#include &lt;stdio.h&gt;\n\n#include \"getValue.h\"\n\nchar * getValue(int key) {\n  char * value;\n  asprintf(&amp;value, \"%d\", key); // TODO: No error handling!\n  // If memory allocation wasn't possible, or some other error occurs,  these  functions  will\n  // return -1, and the contents of strp is undefined.\n  return value;\n}\n</code></pre>\n\n<p><code>GetValue.hs</code> (here I explicitly call <code>free</code> after the conversion <a href=\"https://stackoverflow.com/a/1739331/94687\">is actually done</a>):</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nimport Foreign hiding (unsafePerformIO)\nimport Foreign.Ptr\nimport Foreign.C.Types\n\nimport Foreign.C.String(peekCString)\n\nimport System.IO.Unsafe\n\ngetValue :: Int -&gt; IO String\ngetValue key = do\n  valptr &lt;- c_safe_getValue (fromIntegral key)\n  value &lt;- peekCString valptr\n  c_safe_free valptr\n  return value\n\nforeign import ccall safe \"getValue.h getValue\" c_safe_getValue :: CInt -&gt; IO (Ptr CChar)\nforeign import ccall safe \"stdlib.h free\" c_safe_free :: Ptr a -&gt; IO ()\n\nvalue :: Int -&gt; String\nvalue = unsafePerformIO . getValue -- getValue has no side-effects, so we wrap it.\n\n{- A simple test: -}\nmain1 = putStrLn (value 2)\n\n{- A test with an infinite list, which employs laziness: -}\nkeys = [-5..]\nresults = map value keys\n\nmain = foldr (&gt;&gt;) \n             (return ())\n             (map putStrLn (take 20 results))\n</code></pre>\n\n<p>If there wasn't the (ineffective) conversion&amp;copying step, I would need to rely on garbage collector for freeing, but have no idea how to define such things in Haskell.</p>\n"}, {"tags": ["haskell", "quickcheck"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1424171114, "post_id": 28560179, "comment_id": 45432424, "body": "I see two ways to do this: You can define a <code>newtype</code> over <code>Double</code> and write a custom <code>Arbitrary</code> instance for that. Or you can explicitly pass a <code>Gen Double</code> to your test function(s)."}], "answers": [{"comments": [{"owner": {"reputation": 291, "user_id": 1505906, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ac956c69d76af2f718bfaf147a7c0bc3?s=128&d=identicon&r=PG", "display_name": "meldo", "link": "https://stackoverflow.com/users/1505906/meldo"}, "edited": false, "score": 0, "creation_date": 1424255639, "post_id": 28574899, "comment_id": 45470760, "body": "This helped. Thank you."}, {"owner": {"reputation": 69, "user_id": 19553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b91e75e644a302595975bfa106453855?s=128&d=identicon&r=PG", "display_name": "James Cook", "link": "https://stackoverflow.com/users/19553/james-cook"}, "edited": false, "score": 1, "creation_date": 1604607409, "post_id": 28574899, "comment_id": 114406261, "body": "Here&#39;s a hacky implementation I wrote: <a href=\"https://github.com/nick8325/quickcheck/issues/98#issuecomment-722616360\" rel=\"nofollow noreferrer\">github.com/nick8325/quickcheck/issues/98#issuecomment-722616&zwnj;&#8203;360</a>"}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 1, "last_activity_date": 1424226028, "creation_date": 1424226028, "answer_id": 28574899, "question_id": 28560179, "link": "https://stackoverflow.com/questions/28560179/rewriting-arbitrary-double-in-quickcheck2/28574899#28574899", "title": "Rewriting Arbitrary Double in QuickCheck2", "body": "<p>You don't need to make a new <code>Arbitrary</code> instance just to make a custom <code>Gen</code>erator for a type. You can just create it as a free-standing definition:</p>\n\n<pre><code>evilDouble :: Gen Double\nevilDouble = oneOf [ weirdDouble, arbitrary ]\n  where\n    weirdDouble = error \"This is where you generate inf and NaN values\"\n</code></pre>\n\n<p>and then use it explicitly with QuickCheck's <code>forAll</code>:</p>\n\n<pre><code>prop_foo = forAll evilDouble $ \\x -&gt; abs (foo x - 123) &lt; 0.1\n</code></pre>\n"}], "owner": {"reputation": 291, "user_id": 1505906, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ac956c69d76af2f718bfaf147a7c0bc3?s=128&d=identicon&r=PG", "display_name": "meldo", "link": "https://stackoverflow.com/users/1505906/meldo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 28574899, "answer_count": 1, "score": 1, "last_activity_date": 1424226028, "creation_date": 1424170043, "last_edit_date": 1424224569, "question_id": 28560179, "link": "https://stackoverflow.com/questions/28560179/rewriting-arbitrary-double-in-quickcheck2", "title": "Rewriting Arbitrary Double in QuickCheck2", "body": "<p>Sorry for a newbie question, but how can I redefine <code>Arbitrary Double</code> to produce +/- infinity and NaNs as well as usual doubles? And how to use my version of this <code>Arbitrary</code>?</p>\n"}, {"tags": ["haskell", "dependencies", "ghc", "cabal"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1424168097, "post_id": 28558932, "comment_id": 45430598, "body": "Work out this example: A depends on B and C; B depends on D version &lt;1.0; C depends on D version &gt;1.0; and A passes one of D&#39;s data structures that B returned to a function in C.  What is the right thing to do?"}, {"owner": {"reputation": 1932, "user_id": 1784267, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/172e98db79964f9e6e4969e9f4afc452?s=128&d=identicon&r=PG", "display_name": "phaazon", "link": "https://stackoverflow.com/users/1784267/phaazon"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1424168411, "post_id": 28558932, "comment_id": 45430830, "body": "In that case, fail, indeed. But I have comon shared versions ranges, why doesn\u2019t cabal pick up the higher common version?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1424168694, "post_id": 28558932, "comment_id": 45431033, "body": "I don&#39;t understand your most concrete example (&quot;However, in a lot of cases, ...&quot;).  Would you be more explicit about how you faced this problem -- e.g. when doesn&#39;t ghc let you install <code>mtl-4.2</code>; where do you have the upper bound; what else are you depending on?"}, {"owner": {"reputation": 1932, "user_id": 1784267, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/172e98db79964f9e6e4969e9f4afc452?s=128&d=identicon&r=PG", "display_name": "phaazon", "link": "https://stackoverflow.com/users/1784267/phaazon"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1424169185, "post_id": 28558932, "comment_id": 45431304, "body": "In my cases, I wanted to upgrade a package, <code>monad-control</code>. I also depend on <code>either</code> and <code>monad-journal</code>, both depending on <code>monad-control</code> as well. And I guess they both use the same upper bound than me, which is <code>&lt;= 1.1</code>. When installing <code>monad-control</code>, it fails, rejecting both <code>either</code> and <code>monad-journal</code>."}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 1, "creation_date": 1424181382, "post_id": 28558932, "comment_id": 45436588, "body": "I asked the same some time ago <a href=\"/questions/25869041\">here</a> and got great answers."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1424205969, "post_id": 28558932, "comment_id": 45451416, "body": "I don&#39;t really understand the question either, but in the third and fourth paragraphs (and perhaps the title?), you are talking about functionality that belongs to Cabal, not GHC."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1457849266, "creation_date": 1457849266, "answer_id": 35967117, "question_id": 28558932, "link": "https://stackoverflow.com/questions/28558932/how-does-ghc-really-handle-versioning/35967117#35967117", "title": "How does GHC really handle versioning?", "body": "<p>This question has many subquestions, but I'll tackle one.</p>\n\n<p>It asks: \"Another point about that: if doing so, I guess with a lot of versions, it\u2019ll be hard to track which versions we are really using. Is there a way to check that? I sometimes use the -v3 flag to get more information about what\u2019s going on, but something like cabal dep-list would be great. Maybe it already exists with ghc-pkg?\"</p>\n\n<p>If you run within a sandbox, which other elements of this question seem to imply you do, then you can call <code>cabal sandbox hc-pkg list</code> to see the sandbox environment, and generally use <code>cabal sandbox hc-pkg anywhere one might use</code>ghc-pkg<code>to do the other things one might do with</code>ghc-pkg` but sandbox-local.</p>\n"}], "owner": {"reputation": 1932, "user_id": 1784267, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/172e98db79964f9e6e4969e9f4afc452?s=128&d=identicon&r=PG", "display_name": "phaazon", "link": "https://stackoverflow.com/users/1784267/phaazon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1457849266, "creation_date": 1424166315, "question_id": 28558932, "link": "https://stackoverflow.com/questions/28558932/how-does-ghc-really-handle-versioning", "title": "How does GHC really handle versioning?", "body": "<p>We \u2013 <em>haskellers</em> \u2013 might all know what <strong>cabal hell</strong> is. When trying to upgrade our application / library, we get a failure because of different versions installed and upper bounds that don\u2019t match.</p>\n\n<p>I don\u2019t get it. I checked: GHC installs packages as versionned. That means when you install <code>mtl</code> for instance, you have several folders for <code>mtl</code>, one per version installed. That sounds great, because we could install several versions of the same package, and depending on our upper bounds in our <code>.cabal</code>, we could select the versions we\u2019d like to use.</p>\n\n<p>However, in a lot of cases, GHC doesn\u2019t work that way. If you have an upper bound, like <code>mtl &lt; 4.2</code>, you won\u2019t be able to install <code>mtl-4.2</code> or upper. And I don\u2019t get why. Why cabal/ghc doesn\u2019t say \u201cYeah, I can install that, it doesn\u2019t break anything actually, because the project uses a version I already have, so I\u2019ll just keep using that version\u201d?</p>\n\n<p>I guess there\u2019s a good reason for that, and maybe that\u2019s because of concurrent versions. If you use <code>mtl-4.2</code> and you depend on a package that uses <code>mtl-4.1</code>, you\u2019d need two versions at the same time, which mustn\u2019t be allowed. However, GHC could default to the lower version, and allow to install upper versions without breaking anything.</p>\n\n<p>Another point about that: if doing so, I guess with a lot of versions, it\u2019ll be hard to track which versions we are <em>really</em> using. Is there a way to check that? I sometimes use the <code>-v3</code> flag to get more information about what\u2019s going on, but something like <code>cabal dep-list</code>\u00a0would be great. Maybe it already exists with <code>ghc-pkg</code>?</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 2, "last_activity_date": 1424166587, "creation_date": 1424166587, "answer_id": 28559027, "question_id": 28558365, "link": "https://stackoverflow.com/questions/28558365/behaviors-of-the-operator-of-haskell-parsec/28559027#28559027", "title": "behaviors of the (&lt;|&gt;) operator of haskell parsec?", "body": "<p>It's just as Real World Haskell says.</p>\n\n<p><code>parseNum</code> first parses an <a href=\"https://hackage.haskell.org/package/parsec-3.1.8/docs/Text-ParserCombinators-Parsec-Token.html#v:integer\" rel=\"nofollow\"><code>integer</code></a>, but <code>integer</code>-s can be prefixed with <code>+</code> or <code>-</code>.</p>\n\n<p>Therefore, when parsing <code>parseNum &lt;|&gt; parseOp</code>, if the next character is <code>+</code> or <code>-</code>, and what we actually have is an operator, <code>parseNum</code> reads in that character and fails only afterwards.</p>\n\n<p>With <code>parseOp &lt;|&gt; parseNum</code>, no backtracking is needed, of course, since <code>parseOp</code> needs just one character lookahead.</p>\n"}], "owner": {"reputation": 2875, "user_id": 2299477, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/xppB7.jpg?s=128&g=1", "display_name": "Alaya", "link": "https://stackoverflow.com/users/2299477/alaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 429, "favorite_count": 0, "accepted_answer_id": 28559027, "answer_count": 1, "score": 1, "last_activity_date": 1424166587, "creation_date": 1424164581, "question_id": 28558365, "link": "https://stackoverflow.com/questions/28558365/behaviors-of-the-operator-of-haskell-parsec", "title": "behaviors of the (&lt;|&gt;) operator of haskell parsec?", "body": "<p>I want to use RPN interpreter to practice the use of Parsec, and here is my code:</p>\n\n<pre><code>module RPN where\nimport Control.Applicative hiding((&lt;|&gt;))\nimport Text.ParserCombinators.Parsec \ndata RPNVal = Add|Sub|Mul|Div|Num Double deriving(Show)\na &lt;:&gt; b  = (:) &lt;$&gt; a &lt;*&gt; b\na &lt;++&gt; b = (++) &lt;$&gt; a &lt;*&gt; b\nopSymbol = oneOf \"+-*/\"\nnumber   = many1 digit :: Parser String\nplus     = char '+' *&gt; number\nminus    = char '-' &lt;:&gt; number\ninteger  = (number &lt;|&gt; minus &lt;|&gt; plus) :: Parser String\nfloat    = integer &lt;++&gt; decimal &lt;++&gt; exponent\n    where decimal  = option \"\" $ char '.' &lt;:&gt; number\n          exponent = option \"\" $ oneOf \"eE\" &lt;:&gt; number\nparseOp :: Parser RPNVal\nparseOp = do\n    op &lt;- opSymbol\n    case op of \n         '+' -&gt; return Add \n         '-' -&gt; return Sub \n         '*' -&gt; return Mul \n         '/' -&gt; return Div\nparseNum :: Parser RPNVal\nparseNum = liftA (read::String-&gt;Double) float &gt;&gt;= return.Num\nparseRPNVal :: Parser RPNVal \n-- parseRPNVal = parseOp &lt;|&gt; parseNum\n-- parseRPNVal = parseNum &lt;|&gt; parseOp\nparseRPNVal = try parseNum &lt;|&gt; parseOp\nparseExpr :: Parser [RPNVal]\nparseExpr = parseRPNVal `sepBy1` spaces\nreadExpr :: String-&gt;[RPNVal]\nreadExpr input = case parse parseExpr \"RPN\" input of\n                      Left errMsg -&gt; error $ show errMsg\n                      Right val   -&gt; val\n</code></pre>\n\n<p>in the definition of <code>parseRPNVal</code>, I found that if I use <code>parseRPNVal = parseOp &lt;|&gt; parseNum</code>, then the parser worked well, however, if I use <code>parseRPNVal = parseNum &lt;|&gt; parseOp</code>, then the function could only parse numbers while operators would cause error.</p>\n\n<p>In <a href=\"http://book.realworldhaskell.org/read/using-parsec.html\" rel=\"nofollow\">Real World Haskell</a>, it says:</p>\n\n<blockquote>\n  <p>This operator behaves like this: it will first try the parser on the\n  left. If it consumed no input[35], it will try the parser on the right</p>\n</blockquote>\n\n<p>so could anyone please explain the behavior of <code>parseOp</code> and <code>parseNum</code> to me?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 6, "creation_date": 1424149318, "post_id": 28554842, "comment_id": 45422546, "body": "Why doesn&#39;t it meet the desired behaviour? <code>g</code> returns true for exactly the string beginning with the two characters \\ and &quot;. So <code>g &quot;\\&quot;&quot;</code> is rightfully false, because it doesn&#39;t begin with a \\. Just to be clear, the first test string is exactly &quot;  and the second is exactly \\&quot; , without the escape characters. Also note that escaping a special character with a backslash does not insert a backslash anywhere into your string - the strings &quot;\\n&quot; and &quot;\\&quot;&quot;, for example, contain no backslashes."}], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1424225511, "post_id": 28555403, "comment_id": 45458950, "body": "Thanks. and what if I wanted <code>&quot;\\&quot;F&quot;</code>. How can I pattern match on that case?"}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1424225633, "post_id": 28555403, "comment_id": 45458974, "body": "So the literal <code>&quot;\\&quot;F&quot;</code> corresponds to the <i>string</i> <code>&quot;F</code>. So you could match on it with <code>f [&#39;&quot;&#39;, &#39;F&#39;]</code>."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 1, "creation_date": 1424226012, "post_id": 28555403, "comment_id": 45459093, "body": "@KevinMeredith: The <code>[x, y]</code> pattern matches a list with two elements. To match everything after the <code>&quot;</code>, you need to use <code>:</code> in your pattern like you did originally: <code>f (&#39;&quot;&#39;:xs) = ...</code>."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 5, "last_activity_date": 1424151565, "creation_date": 1424151565, "answer_id": 28555403, "question_id": 28554842, "link": "https://stackoverflow.com/questions/28554842/pattern-matching-on-string-to-get-escaped-quote/28555403#28555403", "title": "Pattern Matching on &#39;String&#39; to get Escaped Quote", "body": "<p>There's a difference between a <em>string</em> and a <em>string literal</em>. Basically, a string is a list of characters one after the other and a string literal is just some <em>notation</em> for the same. The notation has to \"escape\" certain characters because it would otherwise lead to ambiguous syntax, but it still expresses the string <em>without</em> the escaping.</p>\n\n<p>The Haskell expression <code>\"\\\"\"</code> is <em>notation</em> for the string containing a single character <code>\"</code>. We need the backslash because writing <code>\"\"\"</code> without it would make the contents of the string look just like a closing quote and break our notation. But the string itself still only has a <code>\"</code>.</p>\n\n<p>When you're matching on a string value, you're matching on the string itself, not its notation. This means that you do not have to worry about escape characters in the string, because those only exist at the level of notation. So to match the string containing just <code>\"</code> you would use the following pattern:</p>\n\n<pre><code>foo ['\"'] = ...\n</code></pre>\n\n<p>If you tried to account for a backslash, you would be matching a different string.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 28555403, "answer_count": 1, "score": 1, "last_activity_date": 1424151565, "creation_date": 1424148638, "question_id": 28554842, "link": "https://stackoverflow.com/questions/28554842/pattern-matching-on-string-to-get-escaped-quote", "title": "Pattern Matching on &#39;String&#39; to get Escaped Quote", "body": "<p>Is it possible to pattern match on an escaped quote?</p>\n\n<p>Here's what I (incorrectly) tried:</p>\n\n<pre><code>g :: String -&gt; Bool\ng ('\\\\':'\"':_) = True\ng _            = False\n</code></pre>\n\n<p>But the results don't meet my desired function behavior.</p>\n\n<pre><code>ghci&gt; g \"\\\"\"\nFalse\nghci&gt; g \"\\\\\\\"\"\nTrue\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 5, "creation_date": 1424138997, "post_id": 28553559, "comment_id": 45419931, "body": "let expressions are recursive, so when you have <code>let x = x * x</code>, it&#39;s all the same <code>x</code>, not the one from the outer scope."}, {"owner": {"reputation": 127, "user_id": 4573908, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Y-z4lH0MjKQ/AAAAAAAAAAI/AAAAAAAAAG4/j0Rt9Ilq2H8/photo.jpg?sz=128", "display_name": "xwang", "link": "https://stackoverflow.com/users/4573908/xwang"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424139809, "post_id": 28553559, "comment_id": 45420138, "body": "if that&#39;s the same one, why it doesn&#39;t report an error because the lookup of <code>x</code> fails?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1424140059, "post_id": 28553559, "comment_id": 45420193, "body": "Recursive definitions are central to many aspects of Haskell, such as <code>map f [] = []; map f (x:xs) = f x : map f xs</code>.  We want the instance of <code>map</code> to the right of the <code>=</code> to be the same as the <code>map</code> on the left side of the <code>=</code>.  There is even the function <code>fix</code> which is defined as <code>fix f = let x = f x in x</code>, and it can actually produce valuable results, a trivial one being <code>fix (1:)</code>, which creates an infinite lazy list of <code>1</code>s that refers to the same <code>1</code> over and over again so it won&#39;t blow up in RAM."}, {"owner": {"reputation": 127, "user_id": 4573908, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Y-z4lH0MjKQ/AAAAAAAAAAI/AAAAAAAAAG4/j0Rt9Ilq2H8/photo.jpg?sz=128", "display_name": "xwang", "link": "https://stackoverflow.com/users/4573908/xwang"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424140635, "post_id": 28553559, "comment_id": 45420323, "body": "Do you mean this is infinite because of the lazy evaluation of <code>x = x * x</code>? I think if you first evaluate <code>x</code> in the RHS of <code>x = x * x</code> then there would be no problem. However, if you first evaluate <code>x = x * x</code> without first evaluating the <code>x</code> in the RHS, <code>x</code> is bound to <code>x * x</code>, then evaluating the <code>x</code> in <code>x * x</code> would lead to this non-termination, right?"}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 1, "creation_date": 1424145111, "post_id": 28553559, "comment_id": 45421400, "body": "Why is this downvoted? and the vote to close seems very unjustified too."}], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 4573908, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Y-z4lH0MjKQ/AAAAAAAAAAI/AAAAAAAAAG4/j0Rt9Ilq2H8/photo.jpg?sz=128", "display_name": "xwang", "link": "https://stackoverflow.com/users/4573908/xwang"}, "edited": false, "score": 0, "creation_date": 1424140829, "post_id": 28553809, "comment_id": 45420366, "body": "I see, that&#39;s exactly what I was thinking. Can I think of this as the lazy evaluation of Haskell?"}, {"owner": {"reputation": 127, "user_id": 4573908, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Y-z4lH0MjKQ/AAAAAAAAAAI/AAAAAAAAAG4/j0Rt9Ilq2H8/photo.jpg?sz=128", "display_name": "xwang", "link": "https://stackoverflow.com/users/4573908/xwang"}, "edited": false, "score": 0, "creation_date": 1424141043, "post_id": 28553809, "comment_id": 45420413, "body": "Seems like the environment allows binding non-values to variables."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 127, "user_id": 4573908, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Y-z4lH0MjKQ/AAAAAAAAAAI/AAAAAAAAAG4/j0Rt9Ilq2H8/photo.jpg?sz=128", "display_name": "xwang", "link": "https://stackoverflow.com/users/4573908/xwang"}, "edited": false, "score": 0, "creation_date": 1424141412, "post_id": 28553809, "comment_id": 45420500, "body": "@xwang: Yes, in a strict language recursive value definitions would not be possible (except in a few special cases like cyclic definitions using data constructors - <code>let rec xs = 42 :: xs</code> in OCaml would be an example of that)."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 7, "last_activity_date": 1424140733, "creation_date": 1424140733, "answer_id": 28553809, "question_id": 28553559, "link": "https://stackoverflow.com/questions/28553559/infinite-loop-in-haskell-when-binding-variables/28553809#28553809", "title": "infinite loop in Haskell when binding variables", "body": "<p>When evaluating a let-statement of the form <code>let foo = bar in baz</code>, <code>foo</code> is already bound to <code>bar</code> while evaluating <code>bar</code> - that is definitions are recursive and if there is an outer binding with the same name, it is simply ignored as it is no longer in scope.</p>\n\n<p>In a comment you asked why you don't then get an error about the lookup of <code>x</code> failing. The reason for that is that the lookup of <code>x</code> does not fail. Haskell knows that <code>x</code> is equal to <code>x * x</code>, so that's what the lookup produces.</p>\n\n<p>So when <code>x</code> is evaluated, it is replaced with its definition <code>x * x</code>. To evaluate that it then replaces the first of the <code>x</code>s with its definition, yielding <code>x * x * x</code>, then <code>x * x * x * x</code> and so on ad infinitum.</p>\n\n<p>You might wonder why values are allowed to be recursive that way, so here's an example that is actually useful and does not just lead to an infinite loop: <code>let xs = 42 : xs in take 2 xs</code> produces the result <code>[42, 42]</code>. Here <code>xs</code> is expanded to <code>42 : xs</code> and then <code>42 : 42 : xs</code> and then it stops because <code>take 2</code> only needs the first two elements, so that's where it stops.</p>\n\n<p>And of course when the rhs is a function, it's immediately obvious that it's useful for the definition to be recursive: <code>let fac = \\n -&gt; if n = 0 then 1 else n * fac (n-1)</code> - here you obviously want <code>fac</code> to refer to itself and not some previous definition of <code>fac</code>.</p>\n"}], "owner": {"reputation": 127, "user_id": 4573908, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Y-z4lH0MjKQ/AAAAAAAAAAI/AAAAAAAAAG4/j0Rt9Ilq2H8/photo.jpg?sz=128", "display_name": "xwang", "link": "https://stackoverflow.com/users/4573908/xwang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 323, "favorite_count": 0, "accepted_answer_id": 28553809, "answer_count": 1, "score": 3, "last_activity_date": 1424144904, "creation_date": 1424138913, "last_edit_date": 1424144904, "question_id": 28553559, "link": "https://stackoverflow.com/questions/28553559/infinite-loop-in-haskell-when-binding-variables", "title": "infinite loop in Haskell when binding variables", "body": "<p>the following Haskell code does not terminate, can someone please explain why? Thanks.</p>\n\n<pre><code>f = let x = 10 in let x = x * x in x\n</code></pre>\n\n<p>I think the interpreter first binds x : 10,\nthen evaluates x * x to 100 and binds x : 100,\nand the environment becomes x : 100,\nthen the whole expression evaluates to 100</p>\n\n<p>However, this code does not terminate.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 3258937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8af3ca2e59197dd1fb037ccaa02c181?s=128&d=identicon&r=PG&f=1", "display_name": "Mochilla", "link": "https://stackoverflow.com/users/3258937/mochilla"}, "edited": false, "score": 0, "creation_date": 1424129428, "post_id": 28552136, "comment_id": 45417282, "body": "Basically I just want to multiply a list of 3 numbers, so how would that code end up looking?"}, {"owner": {"reputation": 14609, "user_id": 667648, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/mTpbt.jpg?s=128&g=1", "display_name": "Dair", "link": "https://stackoverflow.com/users/667648/dair"}, "reply_to_user": {"reputation": 1, "user_id": 3258937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8af3ca2e59197dd1fb037ccaa02c181?s=128&d=identicon&r=PG&f=1", "display_name": "Mochilla", "link": "https://stackoverflow.com/users/3258937/mochilla"}, "edited": false, "score": 0, "creation_date": 1424129536, "post_id": 28552136, "comment_id": 45417314, "body": "@Mochilla: Ok. So what do you put for the <code>?</code>?"}, {"owner": {"reputation": 1, "user_id": 3258937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8af3ca2e59197dd1fb037ccaa02c181?s=128&d=identicon&r=PG&f=1", "display_name": "Mochilla", "link": "https://stackoverflow.com/users/3258937/mochilla"}, "edited": false, "score": 0, "creation_date": 1424129696, "post_id": 28552136, "comment_id": 45417374, "body": "Below I have a test which does this &#39;  te &quot;mult&quot; 5 (multiply [1, 2, 3]) &#39;"}, {"owner": {"reputation": 14609, "user_id": 667648, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/mTpbt.jpg?s=128&g=1", "display_name": "Dair", "link": "https://stackoverflow.com/users/667648/dair"}, "reply_to_user": {"reputation": 1, "user_id": 3258937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8af3ca2e59197dd1fb037ccaa02c181?s=128&d=identicon&r=PG&f=1", "display_name": "Mochilla", "link": "https://stackoverflow.com/users/3258937/mochilla"}, "edited": false, "score": 0, "creation_date": 1424130253, "post_id": 28552136, "comment_id": 45417575, "body": "@Mochilla: I mean fill in the blank. What should <code>?</code> be?"}, {"owner": {"reputation": 1, "user_id": 3258937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8af3ca2e59197dd1fb037ccaa02c181?s=128&d=identicon&r=PG&f=1", "display_name": "Mochilla", "link": "https://stackoverflow.com/users/3258937/mochilla"}, "edited": false, "score": 0, "creation_date": 1424131404, "post_id": 28552136, "comment_id": 45417943, "body": "Should it be 1? Then I can do <code>mult xs = foldl (*) xs</code>?"}, {"owner": {"reputation": 14609, "user_id": 667648, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/mTpbt.jpg?s=128&g=1", "display_name": "Dair", "link": "https://stackoverflow.com/users/667648/dair"}, "reply_to_user": {"reputation": 1, "user_id": 3258937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8af3ca2e59197dd1fb037ccaa02c181?s=128&d=identicon&r=PG&f=1", "display_name": "Mochilla", "link": "https://stackoverflow.com/users/3258937/mochilla"}, "edited": false, "score": 0, "creation_date": 1424132217, "post_id": 28552136, "comment_id": 45418144, "body": "@Mochilla: Yes, it should be 1. There is one parameter you are missing for <code>foldl</code>, (also I wouldn&#39;t name it <code>xs</code>... but that isn&#39;t the main point here)."}], "tags": [], "owner": {"reputation": 14609, "user_id": 667648, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/mTpbt.jpg?s=128&g=1", "display_name": "Dair", "link": "https://stackoverflow.com/users/667648/dair"}, "is_accepted": false, "score": 3, "last_activity_date": 1424129209, "creation_date": 1424129209, "answer_id": 28552136, "question_id": 28552092, "link": "https://stackoverflow.com/questions/28552092/haskell-function-multiplying-elements-of-list-using-high-order-functions/28552136#28552136", "title": "Haskell: Function multiplying elements of list using high order functions", "body": "<p>You should handle the case of an empty list:</p>\n\n<pre><code>mult [] = ?\n</code></pre>\n\n<p>Then, what are you trying to do? You want to basically take a list:</p>\n\n<pre><code>[1, 2, 3, 4]\n</code></pre>\n\n<p>And insert multiplication symbols in between:</p>\n\n<pre><code>1 * 2 * 3 * 4\n</code></pre>\n\n<p>I would recommend you look into <a href=\"https://wiki.haskell.org/Fold\" rel=\"nofollow\">how fold works</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 463, "user_id": 2976251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe393a6e3c9fe3857dc7b27ff5db473?s=128&d=identicon&r=PG&f=1", "display_name": "hasufell", "link": "https://stackoverflow.com/users/2976251/hasufell"}, "is_accepted": false, "score": 4, "last_activity_date": 1424131322, "creation_date": 1424131322, "answer_id": 28552487, "question_id": 28552092, "link": "https://stackoverflow.com/questions/28552092/haskell-function-multiplying-elements-of-list-using-high-order-functions/28552487#28552487", "title": "Haskell: Function multiplying elements of list using high order functions", "body": "<p>Start with <strong>explicit recursion</strong> first... that means do not use foldl/foldr and friends.</p>\n\n<p>Let's start by handling the corner case of an empty list:</p>\n\n<pre><code>mult [] = 1\n</code></pre>\n\n<p>Now, we can do something to the first element of a list by doing:</p>\n\n<pre><code>mult (x:xs) = x * 3\n</code></pre>\n\n<p><code>x</code> is the first element of the list, while <code>xs</code> is the remaining list. So this just multiplies the <strong>first</strong> element of your list with 3.\nNow you have to figure out what to replace <code>3</code> with in order to make the whole thing do what you want. The rest is already correct, as in:</p>\n\n<pre><code>mult :: [Int] -&gt; Int\nmult [] = 1\nmult (x:xs) = x * &lt;this part is missing, recursion maybe?&gt;\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 3258937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8af3ca2e59197dd1fb037ccaa02c181?s=128&d=identicon&r=PG&f=1", "display_name": "Mochilla", "link": "https://stackoverflow.com/users/3258937/mochilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1094, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1424140881, "creation_date": 1424128969, "last_edit_date": 1424140881, "question_id": 28552092, "link": "https://stackoverflow.com/questions/28552092/haskell-function-multiplying-elements-of-list-using-high-order-functions", "title": "Haskell: Function multiplying elements of list using high order functions", "body": "<p>I am new to Haskell so I'm trying to understand high order functions and how they work using map, filter, foldr, foldl, foldr1, foldl1, and operator.</p>\n\n<p>First I wanted to start with a function that multiplies elements in a list and multiplying an empty list returns 1.</p>\n\n<p>I have this so far, but I'm not sure where to go next.</p>\n\n<pre><code>mult :: [Int] -&gt; Int\n</code></pre>\n"}, {"tags": ["haskell", "design-patterns", "types"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1424124838, "post_id": 28551179, "comment_id": 45415641, "body": "I would say that often these types can be mutually dependent or need a lot of imports.  It can be really easy to simply define a bunch of types in a <code>.Types</code> module, then re-export them where it makes more sense."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1424145434, "post_id": 28551179, "comment_id": 45421479, "body": "I don&#39;t think this is &quot;primarily opinion based&quot; because it&#39;s the result of technical limitations of GHC."}], "answers": [{"comments": [{"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 1, "creation_date": 1424145986, "post_id": 28551707, "comment_id": 45421600, "body": "Could you elaborate? perhaps an example?"}, {"owner": {"reputation": 16397, "user_id": 303939, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3f6c98562c6d9bb188eacc2002af257?s=128&d=identicon&r=PG", "display_name": "Ming-Tang", "link": "https://stackoverflow.com/users/303939/ming-tang"}, "edited": false, "score": 0, "creation_date": 1433025636, "post_id": 28551707, "comment_id": 49176191, "body": "Look up &quot;interface file (.hi files)&quot; and &quot;separate compilation&quot;"}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 9, "last_activity_date": 1424126885, "creation_date": 1424126885, "answer_id": 28551707, "question_id": 28551179, "link": "https://stackoverflow.com/questions/28551179/why-having-a-separate-module-for-types/28551707#28551707", "title": "Why having a separate module for types?", "body": "<p>It's almost always done to avoid circular dependencies between modules. GHC handles them very poorly. They're theoretically allowed, but the mechanism is so painful they're nearly always avoided.</p>\n"}], "owner": {"reputation": 355, "user_id": 846957, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9d105bb56905d5d994839efe39968d3f?s=128&d=identicon&r=PG&f=1", "display_name": "mariusz", "link": "https://stackoverflow.com/users/846957/mariusz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 2, "accepted_answer_id": 28551707, "answer_count": 1, "score": 7, "last_activity_date": 1424126885, "creation_date": 1424124342, "question_id": 28551179, "link": "https://stackoverflow.com/questions/28551179/why-having-a-separate-module-for-types", "title": "Why having a separate module for types?", "body": "<p>Why is it common to put classes and types definitions inside special <em>Types</em> module instead of placing them within corresponding namespace? </p>\n\n<p>For example, let's take <a href=\"http://hackage.haskell.org/package/yi-0.11.2/docs/Yi-Types.html#t:Config\"><em>Config</em></a> record from Yi source code. Why has it been decided to define it inside <a href=\"https://hackage.haskell.org/package/yi-0.11.2/docs/Yi-Types.html\"><em>Yi.Types</em></a> instead of <a href=\"https://hackage.haskell.org/package/yi-0.11.2/docs/Yi-Config.html\"><em>Yi.Config</em></a>?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 17691, "user_id": 645270, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7eVm1.png?s=128&g=1", "display_name": "keyser", "link": "https://stackoverflow.com/users/645270/keyser"}, "edited": false, "score": 3, "creation_date": 1424120980, "post_id": 28550361, "comment_id": 45413815, "body": "Don&#39;t use tags to increase visibility"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1424123717, "post_id": 28550361, "comment_id": 45415119, "body": "What&#39;s supposed to happen when you sort the empty list?"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 9, "last_activity_date": 1424122411, "last_edit_date": 1424122411, "creation_date": 1424121938, "answer_id": 28550629, "question_id": 28550361, "link": "https://stackoverflow.com/questions/28550361/insertion-sort-in-haskell/28550629#28550629", "title": "Insertion sort in Haskell", "body": "<pre><code>insert x insertionSort xs\n</code></pre>\n\n<p>is calling <code>insert</code> with three arguments (<code>x</code>,<code>insertionSort</code>,<code>xs</code>).\nProbably you want</p>\n\n<pre><code>insert x (insertionSort xs)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 40406, "user_id": 336527, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4a57f523157ebdf6e5a9662d2e8754b9?s=128&d=identicon&r=PG", "display_name": "max", "link": "https://stackoverflow.com/users/336527/max"}, "edited": false, "score": 1, "creation_date": 1490318535, "post_id": 35529542, "comment_id": 73071110, "body": "What&#39;s the advantage of lambda lifting? And can&#39;t you get rid of <code>insertionSort [x] = [x]</code>?"}, {"owner": {"reputation": 24109, "user_id": 775954, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9f5a87db35489d2958945f35b457f1ee?s=128&d=identicon&r=PG", "display_name": "Matthias Braun", "link": "https://stackoverflow.com/users/775954/matthias-braun"}, "edited": false, "score": 1, "creation_date": 1526748867, "post_id": 35529542, "comment_id": 87869742, "body": "<a href=\"https://wiki.haskell.org/Lambda_lifting\" rel=\"nofollow noreferrer\">Lambda lifting</a> allows functions defined with <code>where</code> to be used as top-level functions. I&#39;m not sure this applies to OP&#39;s code since their <code>insert</code> is already top-level. Yes, you can get rid of <code>insertionSort [x] = [x]</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526751316, "post_id": 35529542, "comment_id": 87870424, "body": "There&#39;s no obvious reason to move <code>insert</code> into a <code>where</code> clause here. It&#39;s a perfectly sensible thing in its own right, and passing one more argument isn&#39;t going to hurt anyone."}, {"owner": {"reputation": 1023, "user_id": 239838, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d13341fb02e303c6b679f1184b2d81ea?s=128&d=identicon&r=PG", "display_name": "banbh", "link": "https://stackoverflow.com/users/239838/banbh"}, "edited": false, "score": 0, "creation_date": 1610230716, "post_id": 35529542, "comment_id": 116068819, "body": "Another minor tweak here is to use an as-pattern by changing <code>(y:ys)</code> to <code>yy@(y:ys)</code>, and changing <code>x : y : ys</code> to <code>x : yy</code>. This is (perhaps) slightly more efficient since <code>yy</code> doesn&#39;t need to be recreated."}], "tags": [], "owner": {"reputation": 2090, "user_id": 1610555, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3ab63b360643d119edf9347bac19492b?s=128&d=identicon&r=PG", "display_name": "Marc Juchli", "link": "https://stackoverflow.com/users/1610555/marc-juchli"}, "is_accepted": false, "score": 9, "last_activity_date": 1456005318, "creation_date": 1456005318, "answer_id": 35529542, "question_id": 28550361, "link": "https://stackoverflow.com/questions/28550361/insertion-sort-in-haskell/35529542#35529542", "title": "Insertion sort in Haskell", "body": "<p>While learning some sorting algorithms myself, I'd like to give you a few suggestions/improvements to your solution:</p>\n\n<ul>\n<li>Avoid non-exhaustive pattern matching at any case: <code>insertionSort [] = []</code></li>\n<li>Take advantage of instances of <code>Ord</code> over a fixed type</li>\n<li>Consider <em>lambda lifting</em> by integrating insert into a where statement in order to get rid of the high-level function and save the argument <code>x</code></li>\n<li>Consider <em>guards</em> over <em>if then else</em></li>\n</ul>\n\n<p>Which will result in:</p>\n\n<pre><code>insertionSort :: Ord a =&gt; [a] -&gt; [a]\ninsertionSort [] = []\ninsertionSort [x] = [x]\ninsertionSort (x:xs) = insert $ insertionSort xs\n    where insert [] = [x]\n          insert (y:ys)\n              | x &lt; y = x : y : ys\n              | otherwise = y : insert ys\n</code></pre>\n"}], "owner": {"reputation": 536, "user_id": 4364070, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/70921bd2321275b2bbf42fa255aa82fe?s=128&d=identicon&r=PG&f=1", "display_name": "eyes enberg", "link": "https://stackoverflow.com/users/4364070/eyes-enberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12775, "favorite_count": 0, "accepted_answer_id": 28550629, "answer_count": 2, "score": 3, "last_activity_date": 1543704739, "creation_date": 1424120881, "last_edit_date": 1526749124, "question_id": 28550361, "link": "https://stackoverflow.com/questions/28550361/insertion-sort-in-haskell", "title": "Insertion sort in Haskell", "body": "<p>I'm doing some exercises on Haskell. First I was asked to define a function <code>insert :: Int -&gt; [Int] -&gt; [Int]</code> so that <code>insert x xs</code>\ninserts x into the list xs in such a way that x is bigger than those\nelements before it and smaller than or equal to the element that\nfollow it:</p>\n\n<pre><code>insert :: Int -&gt; [Int] -&gt; [Int]\ninsert x [] = [x]\ninsert x (y:ys) = if x &lt; y \n                 then x:y:ys \n         else y : insert x ys\n</code></pre>\n\n<p>Now I need to use <strong>insert</strong> to define a function <code>insertionSort :: [Int] -&gt; [Int]</code>. Here's my attempt:</p>\n\n<pre><code>insertionSort :: [Int] -&gt; [Int]\ninsertionSort [x] = [x]\ninsertionSort (x:xs) = insert x insertionSort xs\n</code></pre>\n\n<blockquote>\n  <p>Error: Couldn't match expected type [Int] with actual type [Int] -> [Int]</p>\n</blockquote>\n\n<p>Anyone know how I can fix this? Any insight is highly appreciated, thanks.</p>\n"}, {"tags": ["algorithm", "haskell", "depth-first-search"], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1424120187, "post_id": 28550009, "comment_id": 45413411, "body": "This doesn&#39;t seem right. Visited nodes should be remembered between <code>dfs&#39;</code> invocations in the list comprehension."}, {"owner": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1424121217, "post_id": 28550009, "comment_id": 45413930, "body": "@Andr&#225;sKov&#225;cs You are absolute right, it&#39;s more complicated than I thought without a state monad."}, {"owner": {"reputation": 5698, "user_id": 916451, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/2902394/picture?type=large", "display_name": "jjm", "link": "https://stackoverflow.com/users/916451/jjm"}, "edited": false, "score": 1, "creation_date": 1424132619, "post_id": 28550009, "comment_id": 45418260, "body": "I don&#39;t think you&#39;re completely correct in thinking of the state monad as an a FSM.  It&#39;s just a context in which you can manipulate a normal, immutable value instead of passing and returning it.  Definitely worth learning about.  With the right abstractions (see my answer below), you can get around the state passing/state monad in a very neat way.  This is still probably a better answer than mine, in terms of illustrating concepts that can be used in general practice."}], "tags": [], "owner": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "is_accepted": false, "score": 3, "last_activity_date": 1424121936, "last_edit_date": 1424121936, "creation_date": 1424119493, "answer_id": 28550009, "question_id": 28549336, "link": "https://stackoverflow.com/questions/28549336/is-there-way-to-represent-static-data-in-haskell-or-is-there-any-other-elegant/28550009#28550009", "title": "Is there way to represent static data in Haskell? Or is there any other elegant algorithm for DFS traversal in Haskell?", "body": "<p>Nothing keeps you from encoding state in function arguments/return values. A classic DFS could look like this:</p>\n\n<pre><code>import qualified Data.Map as Map\nimport qualified Data.Set as Set\n\nnewtype Graph a = Graph (Map.Map a [a]) deriving (Ord, Eq, Show)\ndata Tree a = Tree a [Tree a] deriving (Ord, Eq, Show)\n\ndfs :: (Ord a) =&gt; Graph a -&gt; a -&gt; Tree a\ndfs (Graph adj) start = fst $ dfs' (Set.singleton start) start\n  where\n    neighbors x = Map.findWithDefault [] x adj\n    dfs' vis x =\n      let (subtrees, vis') =\n            foldr\n              (\\y (subtrees, vis) -&gt;\n                if Set.member y vis\n                  then (subtrees, vis)\n                  else let vis' = Set.insert y vis\n                           (t, vis'') = dfs' vis' y\n                       in (t : subtrees, vis'')\n              )\n              ([], vis)\n              (neighbors x)\n      in (Tree x subtrees, vis')\n</code></pre>\n\n<p>Instead of <code>Map/Set</code>, you could also use <a href=\"https://hackage.haskell.org/package/unordered-containers\" rel=\"nofollow\">persistent hash tables</a> or <a href=\"http://hackage.haskell.org/package/containers/docs/Data-IntMap.html\" rel=\"nofollow\">integer maps/sets</a>, depending on your node type.</p>\n\n<p>To avoid the explicit state, you should use a <a href=\"https://wiki.haskell.org/State_Monad\" rel=\"nofollow\">state monad</a>:</p>\n\n<pre><code>import Control.Applicative\nimport Control.Monad.State\nimport Control.Monad\nimport Data.Maybe\n{- ... -}\n\ndfs :: (Ord a) =&gt; Graph a -&gt; a -&gt; Tree a\ndfs (Graph adj) start = evalState (dfs' start) (Set.singleton start)\n  where\n    neighbors x = Map.findWithDefault [] x adj\n    dfs' x = Tree x . catMaybes &lt;$&gt;\n      forM (neighbors x) (\\y -&gt; get &gt;&gt;= \\vis -&gt;\n        if Set.member y vis\n          then return Nothing\n          else put (Set.insert y vis) &gt;&gt; Just &lt;$&gt; dfs' y)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 177, "user_id": 3762988, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1f24a8e49937146b135b489344d785b?s=128&d=identicon&r=PG&f=1", "display_name": "MazaYong", "link": "https://stackoverflow.com/users/3762988/mazayong"}, "edited": false, "score": 0, "creation_date": 1424144502, "post_id": 28552616, "comment_id": 45421237, "body": "Thanks for the answer, I would like to choose all answers as answer to my question but since this is most straightforward and generalized answer,I will take this as answer. Thanks again."}, {"owner": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "edited": false, "score": 0, "creation_date": 1424178269, "post_id": 28552616, "comment_id": 45435064, "body": "Wow this requires some serious bending to wrap my head around. I still don&#39;t understand how they encode the visited state, have to look at that paper again. Nice example and thanks for introducing me to this concept!"}, {"owner": {"reputation": 5698, "user_id": 916451, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/2902394/picture?type=large", "display_name": "jjm", "link": "https://stackoverflow.com/users/916451/jjm"}, "reply_to_user": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "edited": false, "score": 0, "creation_date": 1424192669, "post_id": 28552616, "comment_id": 45443992, "body": "@NiklasB. the really clever thing about implicit graphs is that the visited state doesn&#39;t have to be encoded at all.  The function <code>match</code> produces (in the <code>Just</code> case) a <i>decomposition</i> of the graph on <code>v</code>: the graph <code>g&#39;</code> in the example is the graph containing all the vertices except <code>v</code>, and all edges except those including <code>v</code>.  This is because the graph is essentially a list of contexts, so one can simply remove the given context (obviously doing this with immutable data in an efficient way is non-trivial, but that&#39;s what libraries are for :-))"}, {"owner": {"reputation": 84156, "user_id": 916657, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?s=128&d=identicon&r=PG", "display_name": "Niklas B.", "link": "https://stackoverflow.com/users/916657/niklas-b"}, "edited": false, "score": 0, "creation_date": 1424193744, "post_id": 28552616, "comment_id": 45444712, "body": "Yeah meanwhile I&#39;ve read the paper :) So essentially the pattern matching allows you to remove the most recently &quot;added&quot; node from the graph. And when traversing the graph, we rearrange it such that we always have an inductive definition where the current node is that added node. Clever."}], "tags": [], "owner": {"reputation": 5698, "user_id": 916451, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/2902394/picture?type=large", "display_name": "jjm", "link": "https://stackoverflow.com/users/916451/jjm"}, "is_accepted": true, "score": 6, "last_activity_date": 1424132456, "last_edit_date": 1424132456, "creation_date": 1424132108, "answer_id": 28552616, "question_id": 28549336, "link": "https://stackoverflow.com/questions/28549336/is-there-way-to-represent-static-data-in-haskell-or-is-there-any-other-elegant/28552616#28552616", "title": "Is there way to represent static data in Haskell? Or is there any other elegant algorithm for DFS traversal in Haskell?", "body": "<p>The answer involving passing and returning state or using a state monad is more transparent than this approach, but as mentioned in the paper below, it's not as efficient and doesn't generalize well.  That said, whatever your needs in this answer, it's worth learning about state monads and working with immutable data in Haskell.</p>\n\n<p><a href=\"https://web.engr.oregonstate.edu/~erwig/papers/InductiveGraphs_JFP01.pdf\" rel=\"noreferrer\">The paper linked in another</a> answer paper provides a rather academic discussion of the use of so called inductive graphs.  Fortunately, the author of the paper was kind enough to implement this approach as a Haskell library, <a href=\"https://hackage.haskell.org/package/fgl-5.5.0.1\" rel=\"noreferrer\"><code>fgl</code></a>.  I'm going to gloss over some details about attaching data to nodes and whatnot, and show how to implement DFS using this library.  It's easy to modify this algorithm to produce trees instead of lists, and the list version is significantly more concise.</p>\n\n<pre><code>dfs :: Graph gr =&gt; [Node] -&gt; gr a b -&gt; [Node]\ndfs [] _ = []  \n-- this equation isn't strictly necessary, but it can improve performance for very dense graphs.\ndfs _ g | isEmpty g = [] \ndfs (v:vs) g = case match v g of\n    (Just ctx, g') -&gt; v:dfs (suc' ctx ++ vs) g'\n    _ -&gt; dfs vs g\n</code></pre>\n\n<p>The key here is <code>match</code>, which decomposes a graph into the so called <code>Context</code> of a vertex and the remaining graph (match returns a <code>Maybe Context</code>, to cover the case of a vertex not in the graph).  </p>\n\n<p>The notion of a vertex <code>Context</code> is central to the idea of inductive graphs: it's defined as a tuple </p>\n\n<pre><code>(adjIn, nodeId, nodeLabel, adjOut)\n</code></pre>\n\n<p>where <code>adjIn</code> and <code>adjOut</code> are lists of <code>(edgeLabel, nodeId)</code> pairs.</p>\n\n<p>Note that the term label is used loosely here, and refers to general data attached to vertices or edges.</p>\n\n<p>The <code>suc'</code> function takes a context and returns a list of nodes that are successors of the node in the context (<code>adjOut</code>, with edge labels dropped).</p>\n\n<p>We can build a graph like this</p>\n\n<p><img src=\"https://i.stack.imgur.com/ryL5I.png\" alt=\"example graph\"></p>\n\n<p>with code like this</p>\n\n<pre><code>testGraph :: DynGraph g =&gt; gr a b\ntestGraph =\n    let nodes = [(i, \"N\" ++ show i) | i &lt;- [1..5]]\n        edges = [(2,1,\"E21\")\n                ,(4,1, \"E41\")\n                ,(1,3, \"E13\")\n                ,(3,4, \"E34\")\n                ,(3,5,\"E35\")\n                ,(5,2, \"E52\")]\n        withNodes = insNodes nodes empty\n        in insEdges edges withNodes\n</code></pre>\n\n<p>Calling <code>dfs testGraph</code> produces <code>[1,3,4,5,2]</code>.</p>\n\n<p>Note: I was bored and stumbled across this question, so the answer is just a writeup of a couple hours of investigation and experiments.</p>\n"}], "owner": {"reputation": 177, "user_id": 3762988, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1f24a8e49937146b135b489344d785b?s=128&d=identicon&r=PG&f=1", "display_name": "MazaYong", "link": "https://stackoverflow.com/users/3762988/mazayong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 845, "favorite_count": 1, "accepted_answer_id": 28552616, "answer_count": 2, "score": 6, "last_activity_date": 1487967241, "creation_date": 1424116566, "last_edit_date": 1487967241, "question_id": 28549336, "link": "https://stackoverflow.com/questions/28549336/is-there-way-to-represent-static-data-in-haskell-or-is-there-any-other-elegant", "title": "Is there way to represent static data in Haskell? Or is there any other elegant algorithm for DFS traversal in Haskell?", "body": "<p>I am trying to construct DFS tree using recursive algorithm.</p>\n\n<p>Pseudo code for this is :</p>\n\n<pre><code>DFF(G)\nMark all nodes u as unvisited\nwhile there is an unvisited node u do \n    DFS(u)\n</code></pre>\n\n<p>.</p>\n\n<pre><code>DFS(u)\nMark u as visited\nfor each v in u's neighbor do \n    if v is not marked\n        DFS(v)\n</code></pre>\n\n<p>While I can fairly easily accomplish this in imperative language in simple way by constructing some sort of data structure for un/visited nodes, assigning them dynamic allocation or some sort of declaration, for Haskell, it is impossible to do so since Haskell's pureness prevents me to change data while passing parameters.</p>\n\n<pre><code>data Graph a = Graph [(a,[a])] deriving (Ord, Eq, Show)\ndata Tree a = Node a [Tree a] deriving (Ord, Eq, Show)\n\ntype Point = (Int, Int)\ntype Edges = [Point]\ntype Path = [Point]\n\npathGraphFy :: Graph Point -&gt; Point -&gt; Tree (Point,Path)\npathGraphFy inputGraph point = getPathVertex inputGraph (point,[])\n\ngetPathVertex :: Graph Point -&gt; (Point, Path) -&gt; Tree (Point,Path)\ngetPathVertex inputGraph (point,path) = \n    Node (point,point:path) (map (getPathVertex inputGraph) [(x,(point:path))  | x&lt;- neighbors, x `notElem` path])\n    where neighbors = pointNeighbor inputGraph point\n\npointNeighbor :: Graph Point -&gt; Point -&gt; Edges\npointNeighbor (Graph (x:xs)) point = \n    if fst x == point then snd x else pointNeighbor (Graph(xs)) point\n</code></pre>\n\n<p>This is what I've got for graph traversal using DFS-ish(or rather BFS-ish) algorithm but the problem is that it will visit all the points again that is not in points' path. (i.e if there exists a cycle, it will traverse in both ways clockwise and counter clockwise)</p>\n\n<p>I've also tried currying another Graph with visited points but failed since Graphs passed by parameter only holds data of Graph in the traversal (i.e is not global)</p>\n\n<p>If only dynamic allocation or static data to hold data for global level was possible, this can be easily solved but I'm kinda new to Haskell and I couldn't find answers on the web on this issue. Please help me :( Thanks in advance.</p>\n\n<p>(P.S) \nI've tried using passing list of visited nodes but it didn't work because when recursion returns, the list of visited nodes will also return, making it impossible to track data. If there is a way to make 'Map' or 'List' global, it is possible to implement it this way. Answer below despite is a link only answer, has great explanation on the reason why this can't be(or shouldn't be) implemented. </p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 822, "user_id": 200916, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68b75a235d71e5dacec3e2778a561775?s=128&d=identicon&r=PG", "display_name": "codygman", "link": "https://stackoverflow.com/users/200916/codygman"}, "edited": false, "score": 0, "creation_date": 1425332388, "post_id": 28549172, "comment_id": 45911631, "body": "&quot; then did cabal install cabal-install, and removed the yum&#39;s cabal).&quot;   You have ~/.cabal/bin at the front of your path as well right?"}, {"owner": {"reputation": 822, "user_id": 200916, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68b75a235d71e5dacec3e2778a561775?s=128&d=identicon&r=PG", "display_name": "codygman", "link": "https://stackoverflow.com/users/200916/codygman"}, "edited": false, "score": 1, "creation_date": 1425337134, "post_id": 28549172, "comment_id": 45913882, "body": "Couldn&#39;t reproduce using Fedora release 20 (Heisenbug), The Glorious Glasgow Haskell Compilation System, version 7.6.3, cabal-install version 1.22.0.1 using version 1.22.1.1 of the Cabal library installing yi 0.11.2.  Does your problem still exist using these newer versions?"}, {"owner": {"reputation": 266, "user_id": 1043960, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ad00fa3e2bcf173fb7ff3f1956519ee4?s=128&d=identicon&r=PG", "display_name": "Rojo", "link": "https://stackoverflow.com/users/1043960/rojo"}, "reply_to_user": {"reputation": 822, "user_id": 200916, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68b75a235d71e5dacec3e2778a561775?s=128&d=identicon&r=PG", "display_name": "codygman", "link": "https://stackoverflow.com/users/200916/codygman"}, "edited": false, "score": 1, "creation_date": 1425353058, "post_id": 28549172, "comment_id": 45918281, "body": "Hey, thanks Codygman. I ended up fixing this with the help of the #haskell IRC channel and some fighting. I didn&#39;t end up understanding it very clearly, however, and I don&#39;t remember the details any more. Some package said in its metadata that it required some C headers instead of ncurses (I think), and it worked when I installed an older version of it. If I understood or remembered it better I would post it as an answer."}, {"owner": {"reputation": 266, "user_id": 1043960, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ad00fa3e2bcf173fb7ff3f1956519ee4?s=128&d=identicon&r=PG", "display_name": "Rojo", "link": "https://stackoverflow.com/users/1043960/rojo"}, "reply_to_user": {"reputation": 822, "user_id": 200916, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/68b75a235d71e5dacec3e2778a561775?s=128&d=identicon&r=PG", "display_name": "codygman", "link": "https://stackoverflow.com/users/200916/codygman"}, "edited": false, "score": 0, "creation_date": 1425353359, "post_id": 28549172, "comment_id": 45918350, "body": "However, my Cabal version is 1.22.0.0. It&#39;s nice to know that its possible to install yi without downgrading anything."}], "owner": {"reputation": 266, "user_id": 1043960, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ad00fa3e2bcf173fb7ff3f1956519ee4?s=128&d=identicon&r=PG", "display_name": "Rojo", "link": "https://stackoverflow.com/users/1043960/rojo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 194, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1424115861, "creation_date": 1424115861, "question_id": 28549172, "link": "https://stackoverflow.com/questions/28549172/cabal-installing-link-fails-with-undefined-references-in-fedora-20", "title": "Cabal-installing link fails with undefined references in Fedora 20", "body": "<p>Trying to install Yi fails because it fails to install vty.\nWhen trying to install vty through cabal install vty, or cabal install after cloning the vty repo, I get error messages from undefined references, related to terminfo, such as this one.</p>\n\n<blockquote>\n  <p>/usr/local/lib/terminfo-0.4.0.1/ghc-7.6.3/libHSterminfo-0.4.0.1.a(Base.o): In function s4NX_info:\n  /tmp/ghc26691_0/ghc26691_1.o:(.text+0x20b1): undefined reference to cur_term</p>\n</blockquote>\n\n<p>What does the error mean exactly?</p>\n\n<p>The file <code>/usr/local/lib/terminfo-0.4.0.1/ghc-7.6.3/libHSterminfo-0.4.0.1.a</code> does exist. I tried in a sandbox, reinstalling cabal deleting its folders, yum-installing ncurses-devel, cabal-installing terminfo, yum-installing ghc-terminfo-devel, cabal-installing terminfo from a cloned repo, and combinations of those things (without really understanding what I was doing) to no avail.</p>\n\n<p>I am in Fedora 20. Using Cabal 1.22.0.0 (installed an older Cabal with yum, then did cabal install cabal-install, and removed the yum's cabal). <code>Cabal list terminfo</code> right now shows 3 installed versions of terminfo (0.3.2.5, 0.4.0.0 and 0.4.0.1). <code>ghc-pkg list</code> shows v0.4.0.1 and 0.3.2.5 as installed (and not hidden) in the global database (I think. The one in /usr/lib64/ghc-7.6.3/package.conf.d)</p>\n\n<p>I would appreciate some help to get Yi installed and to understand how to proceed with these issues. Thanks</p>\n"}, {"tags": ["list", "haskell", "list-comprehension", "infinite-loop"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424115586, "post_id": 28548758, "comment_id": 45411154, "body": "<code>[e | x &lt;- xs, y &lt;- ys]</code> will not work if <code>ys</code> is infinite, since it will take the first element of xs and try to combine it with all of the elements of ys, and never reach the 2nd prime (in this case)."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 5, "creation_date": 1424118557, "post_id": 28548758, "comment_id": 45412553, "body": "<code>n `elem` primes = []</code> ... Is the <code>primes</code> list infinite?  If so, then ```4 <code>elem</code> primes` would never return.  Are you sure it&#39;s the list comprehension?"}, {"owner": {"reputation": 881, "user_id": 646565, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/Cu0yq.jpg?s=128&g=1", "display_name": "freinn", "link": "https://stackoverflow.com/users/646565/freinn"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424121360, "post_id": 28548758, "comment_id": 45414012, "body": "@bheklilr, you are right. Thanks."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1457139074, "post_id": 28548758, "comment_id": 59286587, "body": "@bheklilr as your comment answered the question, do you mind putting it as an answer?"}], "owner": {"reputation": 881, "user_id": 646565, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/Cu0yq.jpg?s=128&g=1", "display_name": "freinn", "link": "https://stackoverflow.com/users/646565/freinn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1424114280, "creation_date": 1424114280, "question_id": 28548758, "link": "https://stackoverflow.com/questions/28548758/list-comprehension-never-ends", "title": "list comprehension never ends", "body": "<p>This function was made for me for solving a problem in project euler, but I don't know why it doesn't end. I thought there was the \"n\" in the list comprehension as results, but I've changed to \"x + y\" and still doesn't work.</p>\n\n<pre><code>writable :: Int -&gt; [Int]\nwritable n\n  | n `elem` primes = []\n  | otherwise = [x + y | x &lt;- primes_less, y &lt;- double_of_squares, x + y == n]\nwhere\n  primes_less = takeWhile (&lt; n) primes\n  double_of_squares = takeWhile (&lt; n) $ map (\\x -&gt; 2*x*x) [1..]\n</code></pre>\n"}, {"tags": ["csv", "haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424111441, "post_id": 28547428, "comment_id": 45408990, "body": "What is the type of <code>mylist</code>?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1424111536, "post_id": 28547428, "comment_id": 45409039, "body": "Also, <a href=\"https://hackage.haskell.org/package/cassava-0.4.2.1/docs/Data-Csv.html#v:encode\" rel=\"nofollow noreferrer\"><code>encode</code></a> has the type <code>ToRecord a =&gt; [a] -&gt; ByteString</code>, not <code>Vector a -&gt; ByteString</code>.  What version of cassava are you looking at?  They switched from <code>Vector</code>s to lists in version 0.3"}, {"owner": {"reputation": 919, "user_id": 1819186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/71b04413070a897f1c5c7055ae281f02?s=128&d=identicon&r=PG", "display_name": "Anthony W", "link": "https://stackoverflow.com/users/1819186/anthony-w"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424114365, "post_id": 28547428, "comment_id": 45410495, "body": "it&#39;s the latest version. Thanks for spotting the incorrect type signature, I have updated the main question. myList is a tuple in my problem domain: <code>myList :: [(Int,Int,Float)]</code>"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1424120268, "post_id": 28547428, "comment_id": 45413460, "body": "As my second comment suggests, you&#39;re looking at the wrong version of the documentation.  You don&#39;t need to use <code>Data.Vector</code> at all, just use <code>encode myList</code> instead of <code>encode $ V.fromList myList</code>."}], "owner": {"reputation": 919, "user_id": 1819186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/71b04413070a897f1c5c7055ae281f02?s=128&d=identicon&r=PG", "display_name": "Anthony W", "link": "https://stackoverflow.com/users/1819186/anthony-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 618, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1424114433, "creation_date": 1424109180, "last_edit_date": 1424114433, "question_id": 28547428, "link": "https://stackoverflow.com/questions/28547428/creating-a-csv-file-in-haskell", "title": "Creating a csv file in haskell", "body": "<p>I suspect this a bit of a noobie question...</p>\n\n<p>So I have a list <code>myList</code> that I would like to write to a csv file, using the cassava library:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as BL\nimport qualified Data.Vector as V\nimport Data.Csv\n\nmain = BL.writeFile \"myFileLocation\" (encode $ V.fromList myList)\n</code></pre>\n\n<p>as far as I can establish, encode has type <code>ToRecord a =&gt; Vector a -&gt; ByteString</code> yet I'm getting the following error:</p>\n\n<pre><code>Couldn't match expected type `[a0]'\n                with actual type `V.Vector (a,b,c,d)'\n    In the return type of a call of `V.fromList'\n    In the second argument of `($)', namely `V.fromList myList'\n    In the second argument of `BL.writeFile', namely\n      `(encode $ V.fromList myList)'\n</code></pre>\n\n<p>I'm confused!</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1424103221, "creation_date": 1424103221, "answer_id": 28545707, "question_id": 28545545, "link": "https://stackoverflow.com/questions/28545545/why-there-is-no-an-exist-keyword-in-haskell-for-existential-quantification/28545707#28545707", "title": "Why there is no an &quot;Exist&quot; keyword in Haskell for Existential Quantification?", "body": "<p>If you look at the type of data constructors, you'll notice that we similarly use <code>-&gt;</code> to somehow mean product. E.g.</p>\n\n<pre><code>(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>really means that we are using <code>(:)</code> to pack an <code>a</code> <em>together with</em> a list of type <code>[a]</code> and deliver a list of type <code>[a]</code>.</p>\n\n<p>In your example, the use of <code>forall</code> simply means that <code>MkFoo</code>, as a constructor, is willing to pack any type <code>a</code>. When you read <code>(exists a . (a, a -&gt; Bool)) -&gt; Foo</code> in the GHC documentation, you should think of it as an uncurried version of the original type of <code>MkFoo</code>. The corresponding uncurried version of <code>(:)</code> would be <code>(a, [a]) -&gt; [a]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 159491, "user_id": 58808, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7cefc64f7b1b53513625bf3487ecd16d?s=128&d=identicon&r=PG", "display_name": "Ionu\u021b G. Stan", "link": "https://stackoverflow.com/users/58808/ionu%c8%9b-g-stan"}, "is_accepted": false, "score": 2, "last_activity_date": 1424105739, "last_edit_date": 1424105739, "creation_date": 1424104260, "answer_id": 28546026, "question_id": 28545545, "link": "https://stackoverflow.com/questions/28545545/why-there-is-no-an-exist-keyword-in-haskell-for-existential-quantification/28546026#28546026", "title": "Why there is no an &quot;Exist&quot; keyword in Haskell for Existential Quantification?", "body": "<p>The first thing to notice is that the <code>forall</code> quantifier appears on the right-hand side of the equal sign, so it is associated with a <strong>data constructor</strong> (not type): <code>MkFoo</code>. Thus, the type <code>Foo</code> says nothing about <code>a</code>.</p>\n\n<p>We encounter <code>a</code> again when we try to pattern match on values of type <code>Foo</code>. At that point you'll know pretty much nothing about the components of <code>MkFoo</code>, except that they <strong>exist</strong> (there must exist a type used to call <code>MkFoo</code>) and that the first component can be used as an argument to the second component, which is a function:</p>\n\n<pre><code>f :: Foo -&gt; Bool\nf (MkFoo val fn) = fn val\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1424136811, "post_id": 28549312, "comment_id": 45419377, "body": "Can you add the derivation steps for how <code>(exists x. p x) -&gt; q</code> and <code>forall x. (p x -&gt; q)</code> are equivalent ? I have a hard time figuring it out using the laws of classical logic."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1424137143, "post_id": 28549312, "comment_id": 45419477, "body": "You can &quot;prove&quot; the equivalence in Haskell: <code>data Ex (p :: * -&gt; *) where Ex :: p x -&gt; Ex p</code> and <code>iso1 :: (Ex p -&gt; q) -&gt; (forall x . p x -&gt; q); iso1 f a = f (Ex a)</code> <code>iso2 :: (forall x . p x -&gt; q) -&gt; (Ex p -&gt; q); iso2 f (Ex a) = f a</code>. The &quot;classical&quot; proof is found in the answer to this <a href=\"http://stackoverflow.com/questions/10753073/whats-the-theoretical-basis-for-existential-types?rq=1\">question</a>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 13, "last_activity_date": 1424162957, "last_edit_date": 1495535553, "creation_date": 1424116454, "answer_id": 28549312, "question_id": 28545545, "link": "https://stackoverflow.com/questions/28545545/why-there-is-no-an-exist-keyword-in-haskell-for-existential-quantification/28549312#28549312", "title": "Why there is no an &quot;Exist&quot; keyword in Haskell for Existential Quantification?", "body": "<p>In logic (classical or intuitionistic), the formulas</p>\n\n<pre><code>(exists x. p x) -&gt; q\nforall x. (p x -&gt; q)\n</code></pre>\n\n<p>are equivalent (note that <code>q</code> does not depend on <code>x</code> above). This can be used to express existential quantification in terms of universal quantification, provided the existential lies on the left side on an implication. (Here's a classical <a href=\"https://stackoverflow.com/a/10753957/3234959\">proof</a>.)</p>\n\n<p>In functional programming, you can achieve the same. Instead of writing</p>\n\n<pre><code>-- Pseudo-Haskell follows\nf :: (exists a. (a, a-&gt;Int)) -&gt; Int\nf (x,h) = h x\n</code></pre>\n\n<p>we can use</p>\n\n<pre><code>-- Actual Haskell\nf :: forall a. (a, a-&gt;Int) -&gt; Int\nf (x,h) = h x\n</code></pre>\n\n<p>so we can do without existential quantification, at least in cases such as the above.</p>\n\n<p>Existential quantification is still needed when it occurs not on the left of an arrow. For instance,</p>\n\n<pre><code>g :: exists a. (a, a-&gt;Int)\ng = (2 :: Int, \\x -&gt; x+3)\n</code></pre>\n\n<p>Alas, Haskell chose not to include these types. Likely, this choice was made to keep the already sophisticated type system from becoming too complex.</p>\n\n<p>Still, Haskell got existential data types, which just require to wrap/unwrap one constructor around the existential. For example, using GADT syntax, we can write:</p>\n\n<pre><code>data Ex where\n  E :: forall a. (a, a-&gt;Int) -&gt; Ex\ng :: Ex\ng = E (2 :: Int, \\x -&gt; x+3)\n</code></pre>\n\n<p>Finally, let me add that existentials can also be simulated by rank-2 types and continuation-passing:</p>\n\n<pre><code>g :: forall r. (forall a. (a, a-&gt;Int) -&gt; r) -&gt; r\ng k = k (2 :: Int, \\x -&gt; x+3)\n</code></pre>\n"}], "owner": {"reputation": 1144, "user_id": 4245823, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-czWZC6KwKYU/AAAAAAAAAAI/AAAAAAAAAYI/yBtPVyZjU4M/photo.jpg?sz=128", "display_name": "felipez", "link": "https://stackoverflow.com/users/4245823/felipez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 989, "favorite_count": 2, "accepted_answer_id": 28549312, "answer_count": 3, "score": 18, "last_activity_date": 1424162957, "creation_date": 1424102750, "last_edit_date": 1424102976, "question_id": 28545545, "link": "https://stackoverflow.com/questions/28545545/why-there-is-no-an-exist-keyword-in-haskell-for-existential-quantification", "title": "Why there is no an &quot;Exist&quot; keyword in Haskell for Existential Quantification?", "body": "<p>According to the GHC documentation, given the following declaration:</p>\n\n<pre><code>data Foo = forall a. MkFoo a (a -&gt; Bool)\n           | Nil\n</code></pre>\n\n<p>then </p>\n\n<pre><code>MkFoo :: forall a. a -&gt; (a -&gt; Bool) -&gt; Foo\n</code></pre>\n\n<p>Is (nearly) isomorphic to the following pseudo-Haskell declaration </p>\n\n<pre><code>MkFoo :: (exists a . (a, a -&gt; Bool)) -&gt; Foo\n</code></pre>\n\n<p>Therefore, there is not need for a separated \"Exist\" keyword. Because:</p>\n\n<blockquote>\n  <p>Haskell programmers can safely think of the ordinary universally\n  quantified type given above.</p>\n</blockquote>\n\n<p>But I'm not sure what that means. Can someone please explain me why can we use the universal quantifier to express Existential quantification?</p>\n"}, {"tags": ["haskell", "template-haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424115842, "post_id": 28545311, "comment_id": 45411279, "body": "I think the simplest thing to do here would be to write a custom <code>==</code> function which compares <code>Name</code>s in a way that the quoted name and not-quoted name are equal. This is the same as stripping away module qualifiers from both types and comparing them normally."}], "answers": [{"comments": [{"owner": {"reputation": 1370, "user_id": 1877752, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/yKkk4.png?s=128&g=1", "display_name": "Greg the Incredulous", "link": "https://stackoverflow.com/users/1877752/greg-the-incredulous"}, "edited": false, "score": 0, "creation_date": 1551751212, "post_id": 54994121, "comment_id": 96745482, "body": "Links to external resources are encouraged, but please add context around the link so your fellow users will have some idea what it is and why it\u2019s there. Always quote the most relevant part of an important link, in case the target site is unreachable or goes permanently offline."}], "tags": [], "owner": {"reputation": 141, "user_id": 8565175, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5jYdIxZdMlY/AAAAAAAAAAI/AAAAAAAAACU/e_9FLrZl0Og/photo.jpg?sz=128", "display_name": "Brandon Chinn", "link": "https://stackoverflow.com/users/8565175/brandon-chinn"}, "is_accepted": true, "score": 2, "last_activity_date": 1551808219, "last_edit_date": 1551808219, "creation_date": 1551749222, "answer_id": 54994121, "question_id": 28545311, "link": "https://stackoverflow.com/questions/28545311/testing-template-haskell-with-mkname/54994121#54994121", "title": "Testing Template Haskell with mkName", "body": "<p>Wow long time without an answer, but never too late to post answers on the Internet!</p>\n\n<pre><code>myFn = ConT ''MyType\n</code></pre>\n\n<p>The ticks are enabled with the <code>-XTemplateHaskell</code> language extension, and are documented here:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/template-haskell-2.13.0.0/docs/Language-Haskell-TH-Syntax.html#t:Name\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/template-haskell-2.13.0.0/docs/Language-Haskell-TH-Syntax.html#t:Name</a></p>\n"}], "owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 54994121, "answer_count": 1, "score": 3, "last_activity_date": 1551808219, "creation_date": 1424102032, "question_id": 28545311, "link": "https://stackoverflow.com/questions/28545311/testing-template-haskell-with-mkname", "title": "Testing Template Haskell with mkName", "body": "<p>I have a function that returns a dynamically-bound <code>Type</code> - in essence, <code>ConT $ mkName \"MyType\"</code>. Of course, the actual function is significantly more complicated, enough so that I'd like to write tests for it, and preferably legible ones. But the following:</p>\n\n<pre><code>import Language.Haskell.TH\nimport MyTypeModule (MyType)\n\nmyFn :: Type    \nmyFn = ConT $ mkName \"MyType\"\n\ntest = ... $ do\n  m &lt;- runQ [t| MyType |]\n  myFn `shouldBe` m\n</code></pre>\n\n<p>Will always fail, since <code>m</code> will resolve to <code>ConT MyTypeModule.MyType</code> rather than to <code>ConT MyType</code>.</p>\n\n<p>Is there a nice way to transform the <code>myFn</code> type to something fully-qualified, or otherwise check that <code>m</code> and <code>myFn</code> are the same (in the current context)? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1424098516, "post_id": 28544053, "comment_id": 45401544, "body": "You should probably not use <code>Rational</code> since <code>sqrt 5</code> is irrational.  If you want to do this computation I&#39;d just use <code>Double</code> then convert to <code>Integer</code> at the end."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 3, "creation_date": 1424099350, "post_id": 28544053, "comment_id": 45402017, "body": "@bheklilr You&#39;re better off using <a href=\"http://cs.stackexchange.com/a/7150\">exact values</a> in Z[\u221a5]..."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1424099740, "post_id": 28544053, "comment_id": 45402245, "body": "@gallais Precise values are great, but I&#39;d be willing to wager that rounding a <code>Double</code> would be more efficient.  Besides, explaining what Z[\u221a5] means would likely take more than the 500 characters allowed in a SO comment =P"}, {"owner": {"reputation": 165, "user_id": 1175959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c7807ac52ba4bf6a3b73bdf1942e03d?s=128&d=identicon&r=PG", "display_name": "Esdras Mayrink", "link": "https://stackoverflow.com/users/1175959/esdras-mayrink"}, "edited": false, "score": 0, "creation_date": 1424108893, "post_id": 28544053, "comment_id": 45407655, "body": "Thank you guys, good to know that the double is good enough in this case. I did the test and for the first 30 numbers there is no difference between the recursive function and the Double version. I&#39;ll answer my question explaining my findings. In the mean time, could you guys point me where I can learn about Z[\u221a5] ?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1424137058, "post_id": 28544053, "comment_id": 45419453, "body": "You can write a fast &amp; exact implementation of Fibonacci using <code>Integer</code>s by using the method described in SICP, <a href=\"http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-11.html#%_thm_1.19\" rel=\"nofollow noreferrer\">in exercise 1.19</a>"}, {"owner": {"reputation": 165, "user_id": 1175959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c7807ac52ba4bf6a3b73bdf1942e03d?s=128&d=identicon&r=PG", "display_name": "Esdras Mayrink", "link": "https://stackoverflow.com/users/1175959/esdras-mayrink"}, "edited": false, "score": 0, "creation_date": 1424145344, "post_id": 28544053, "comment_id": 45421457, "body": "In my previous comment I said that I got no rounding errors the using <code>Double</code>, I was mistaken. I updated my question and accepted @josejuan&#39;s answer. <code>Constructible</code> is awesome. Thank you for your feedback."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1424102199, "post_id": 28544183, "comment_id": 45403824, "body": "Something feels strange about using <code>Int</code> with <code>Construct</code>. Why not switch to <code>Integer</code>?"}, {"owner": {"reputation": 165, "user_id": 1175959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c7807ac52ba4bf6a3b73bdf1942e03d?s=128&d=identicon&r=PG", "display_name": "Esdras Mayrink", "link": "https://stackoverflow.com/users/1175959/esdras-mayrink"}, "edited": false, "score": 0, "creation_date": 1424138626, "post_id": 28544183, "comment_id": 45419831, "body": "Thank you @josejuan, wow, Construct is like magic, it is faster than Integers. It solves the problem with no rounding errors, just like the recursive function. Thank you, I&#39;m accepting your answer, it taught me a lot."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 165, "user_id": 1175959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c7807ac52ba4bf6a3b73bdf1942e03d?s=128&d=identicon&r=PG", "display_name": "Esdras Mayrink", "link": "https://stackoverflow.com/users/1175959/esdras-mayrink"}, "edited": false, "score": 0, "creation_date": 1424144325, "post_id": 28544183, "comment_id": 45421200, "body": "@EsdrasMayrink, you seem to have forgotten to actually accept it by clicking the green check mark."}, {"owner": {"reputation": 165, "user_id": 1175959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c7807ac52ba4bf6a3b73bdf1942e03d?s=128&d=identicon&r=PG", "display_name": "Esdras Mayrink", "link": "https://stackoverflow.com/users/1175959/esdras-mayrink"}, "edited": false, "score": 0, "creation_date": 1424144849, "post_id": 28544183, "comment_id": 45421332, "body": "Nah, I was updating my question, there you go :-) Thanks."}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": true, "score": 4, "last_activity_date": 1424098929, "last_edit_date": 1424098929, "creation_date": 1424098621, "answer_id": 28544183, "question_id": 28544053, "link": "https://stackoverflow.com/questions/28544053/is-there-a-better-way-to-implement-the-fibonacci-formula-using-rational-numbers/28544183#28544183", "title": "Is there a better way to implement the fibonacci formula using rational numbers?", "body": "<p>(You can't use your <code>sqrt</code> version, use <code>Data.Real.Constructible</code> instead)</p>\n\n<pre><code>import Data.Real.Constructible \n\nfib :: Int -&gt; Construct \nfib n = (((1+sqrt(5))/2)^n - ((1-sqrt(5))/2)^n)/sqrt(5)\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 1175959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3c7807ac52ba4bf6a3b73bdf1942e03d?s=128&d=identicon&r=PG", "display_name": "Esdras Mayrink", "link": "https://stackoverflow.com/users/1175959/esdras-mayrink"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 1, "accepted_answer_id": 28544183, "answer_count": 1, "score": 2, "last_activity_date": 1424144737, "creation_date": 1424098228, "last_edit_date": 1424144737, "question_id": 28544053, "link": "https://stackoverflow.com/questions/28544053/is-there-a-better-way-to-implement-the-fibonacci-formula-using-rational-numbers", "title": "Is there a better way to implement the fibonacci formula using rational numbers?", "body": "<p>I'm reading the <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">Learn you some Haskell for the Greater Good</a> book, as I was playing around with recursion in Haskell I implemented the fibonacci function, the recursive version is simple, probably can be improved:</p>\n\n<pre><code>-- recursive fibonacci numbers\nrfib :: Int -&gt; Int\nrfib 0 = 0\nrfib 1 = 1\nrfib n =   rfib (n-1) + rfib(n-2)\n</code></pre>\n\n<p>As I was googling to learn more I stumbled upon this article: \n<a href=\"http://java.dzone.com/articles/what-fibonacci-taught-me-about\" rel=\"nofollow noreferrer\">http://java.dzone.com/articles/what-fibonacci-taught-me-about</a></p>\n\n<p>The author shows the fibonacci formula:</p>\n\n<p><img src=\"https://i.stack.imgur.com/m5M3H.jpg\" alt=\"Fibonacci Formula\"></p>\n\n<p>I decided to implement it in Haskell using rational numbers to avoid floating point imprecisions. My implementation looks like this:</p>\n\n<pre><code>fibMultiplier   = (toRational 1) / (toRational (sqrt 5))\nfirstFibTerm  n = (((toRational 1)  + (toRational (sqrt 5))) / toRational 2) ^ n\nsecondFibTerm n = (((toRational 1)  - (toRational (sqrt 5))) / toRational 2) ^ n\n\nfib :: Int -&gt; Int\nfib n = truncate (fromRational (fibMultiplier * firstFibTerm n) - (fibMultiplier * secondFibTerm n))\n</code></pre>\n\n<p>As a beginner I am sure that the code above can be drastically improved, can you point me what can be improved or some mistakes I've made?</p>\n\n<p>I apreciate the help.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>So, after playing around with the suggestions, I found that using <code>Data.Real.Constructible</code> is fast and precise, with no rounding errors. My final implementation is:</p>\n\n<pre><code>fib :: Int -&gt; Construct\nfib n = ( ( (1 / (sqrt 5)) * ( (( 1 + (sqrt 5) ) / 2) ^ n ) ) -\n          ( (1 / (sqrt 5)) * ( (( 1 - (sqrt 5) ) / 2) ^ n ) ) )::Construct\n</code></pre>\n\n<p>I also implemented a function that returns a list of the n fibonacci numbers:</p>\n\n<pre><code>fibList :: Int -&gt; [Construct]\nfibList n = [fib(x) | x &lt;- [0..n]]\n</code></pre>\n\n<p>Using this function we can compare the results of the different implementations:</p>\n\n<pre><code>-- recursive fibonacci numbers\nrfib :: Int -&gt; Int\nrfib 0 = 0\nrfib 1 = 1\nrfib n =   rfib (n-1) + rfib(n-2)\n\n-- recursive fibonacci sequence\nrfibList :: Int -&gt; [Int]\nrfibList n = [rfib(x) | x &lt;- [0..n]]\n-- rfibList 20 returns: [0,1,1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,1597,2584,4181,6765]\n\n\n-----------------------------------\n\n\n-- fibonacci number using Double and truncate\ndoubleFib :: Integer -&gt; Integer\ndoubleFib n = truncate ( ( (1 / (sqrt 5)) * ( (( 1 + (sqrt 5) ) / 2) ^ n ) ) -\n                         ( (1 / (sqrt 5)) * ( (( 1 - (sqrt 5) ) / 2) ^ n ) ) )\n\n-- fibonacci list using Double and truncate\ndoubleFibList :: Integer -&gt; [Integer]\ndoubleFibList n = [doubleFib(x) | x &lt;- [0..n]]\n-- doubleFibList 20 returns: [0,1,0,2,3,5,8,13,21,34,55,89,143,232,377,610,986,1597,2584,4181,6764]\n\n\n-----------------------------------\n\n\n-- fibonacci number using Construct\nconstructFib :: Int -&gt; Construct\nconstructFib n = ( ( (1 / (sqrt 5)) * ( (( 1 + (sqrt 5) ) / 2) ^ n ) ) -\n                   ( (1 / (sqrt 5)) * ( (( 1 - (sqrt 5) ) / 2) ^ n ) ) )::Construct\n\n-- fibonacci list using construct\nconstructFibList :: Int -&gt; [Construct]\nconstructFibList n = [constructFib(x) | x &lt;- [0..n]]\n-- constructFibList 20 returns: [0,1,1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,1597,2584,4181,6765]\n</code></pre>\n\n<p>Notice that we get a rounding error on the doubleFibList, the 16th number should be <code>987</code> but we get <code>986</code>. The recursive implementation is slow, the Double implementation is imprecise, but using Construct we can get a fast and precise fibonacci sequence, much better than my old implementation using toRational.</p>\n"}, {"tags": ["algorithm", "haskell", "tree", "monads", "tarjans-algorithm"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1424083157, "post_id": 28538620, "comment_id": 45392847, "body": "What about cycles? <code>filter (&#47;= parent)</code> is not enough to detect them."}, {"owner": {"reputation": 127, "user_id": 1706754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e2845219b6901a9c6ebb1592a3858af?s=128&d=identicon&r=PG", "display_name": "user1706754", "link": "https://stackoverflow.com/users/1706754/user1706754"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1424083546, "post_id": 28538620, "comment_id": 45393091, "body": "algorithm works on the tree so parent is enough"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1424084017, "post_id": 28538620, "comment_id": 45393359, "body": "Did you compile with -O2? This code shouldn&#39;t be particularly slow."}, {"owner": {"reputation": 704, "user_id": 939572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2aadfb25285dc4e9a3caf81e2277d77b?s=128&d=identicon&r=PG", "display_name": "GarethR", "link": "https://stackoverflow.com/users/939572/garethr"}, "edited": false, "score": 2, "creation_date": 1424084372, "post_id": 28538620, "comment_id": 45393577, "body": "Have you tried making your State strict? Accumulating thunks in the State monad is a common performance problem."}, {"owner": {"reputation": 127, "user_id": 1706754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e2845219b6901a9c6ebb1592a3858af?s=128&d=identicon&r=PG", "display_name": "user1706754", "link": "https://stackoverflow.com/users/1706754/user1706754"}, "edited": false, "score": 0, "creation_date": 1424084637, "post_id": 28538620, "comment_id": 45393713, "body": "Code isn&#39;t that slow but stack overflow is bigger problem, I also compiled with -O2"}, {"owner": {"reputation": 127, "user_id": 1706754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e2845219b6901a9c6ebb1592a3858af?s=128&d=identicon&r=PG", "display_name": "user1706754", "link": "https://stackoverflow.com/users/1706754/user1706754"}, "edited": false, "score": 0, "creation_date": 1424085236, "post_id": 28538620, "comment_id": 45393994, "body": "Indeed making State monad strict got ride of the stack overflow, only performance boost is needed, if that is possible"}, {"owner": {"reputation": 134362, "user_id": 83805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68c3dd15d6cd5d99a63113843d7e1c1b?s=128&d=identicon&r=PG", "display_name": "Don Stewart", "link": "https://stackoverflow.com/users/83805/don-stewart"}, "edited": false, "score": 2, "creation_date": 1424087221, "post_id": 28538620, "comment_id": 45395018, "body": "You should also consider making time strict (<code>!Int</code>) and using an unboxed tuple for the tree components. <code>data T = T !Int !Int !Int</code> with <code>-O2 -funbox-strict-fields</code>."}, {"owner": {"reputation": 127, "user_id": 1706754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e2845219b6901a9c6ebb1592a3858af?s=128&d=identicon&r=PG", "display_name": "user1706754", "link": "https://stackoverflow.com/users/1706754/user1706754"}, "edited": false, "score": 0, "creation_date": 1424092274, "post_id": 28538620, "comment_id": 45397737, "body": "Why is data T better than tuple?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1424094683, "post_id": 28538620, "comment_id": 45399242, "body": "Tuples always have boxed lazy fields. Custom data can be declared strict/unboxed, as Don shows."}], "owner": {"reputation": 127, "user_id": 1706754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e2845219b6901a9c6ebb1592a3858af?s=128&d=identicon&r=PG", "display_name": "user1706754", "link": "https://stackoverflow.com/users/1706754/user1706754"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1424089749, "creation_date": 1424080328, "last_edit_date": 1424089749, "question_id": 28538620, "link": "https://stackoverflow.com/questions/28538620/avoiding-stack-overflow-and-increasing-performance-in-haskell", "title": "Avoiding stack overflow and increasing performance in Haskell", "body": "<p>aI am trying to implement some algorithm on the tree and one of the steps is to find discovery and finish time of node processing (similar to Tarjan's SSC), which is done with global state of time. I did that in Haskell using State monad consisting of list and timer. Yet on the bigger trees I get stack overflow and slow performance on this part of code, can you suggest something to improve that?</p>\n\n<pre><code>data DfsState = DfsState { timer :: Int\n                         , treel :: [(Int, Int, Int)]\n                         }\n\nincTimer state = state { timer = timer state + 1 }\naddElem node discovery finish state = state { treel=(node,discovery,finish):treel state }\n\ndfs :: Node -&gt; Node -&gt; State DfsState ()\ndfs node parent = do\n    modify incTimer\n    discovery &lt;- gets timer\n    mapM_ (flip dfs node) . filter (/= parent) $ graph M.! node\n    finish &lt;- gets timer\n    modify (addElem node discovery (finish + 1))\n</code></pre>\n"}, {"tags": ["haskell", "binary-search-tree"], "comments": [{"owner": {"reputation": 16592, "user_id": 278042, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/cd3a7820c69adfd1e8c62152248343c3?s=128&d=identicon&r=PG", "display_name": "jkff", "link": "https://stackoverflow.com/users/278042/jkff"}, "edited": false, "score": 2, "creation_date": 1424071988, "post_id": 28535877, "comment_id": 45387095, "body": "I think there is a much simpler solution. Hint: 1) when deleting y from a tree (x, left, right), there&#39;s 3 cases where y might be: in root, in left, or in right. 2) introduce and use an &quot;append :: Tree a -&gt; Tree a -&gt; Tree a&quot; operation."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1424086232, "post_id": 28535877, "comment_id": 45394478, "body": "Irrefutable pattern errors are likely due to <code>let Node rm Empty Empty = rightm l in ...</code> when <code>rightm l</code> returns <code>Empty</code> or a node with non empty subtrees. Maybe you should use <code>case</code> instead to catch all the possibilities?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1424086397, "post_id": 28535877, "comment_id": 45394567, "body": "Style comment: parentheses near single identifiers like <code>(l),(Empty)</code> are always redundant. I&#39;d suggest to remove them."}, {"owner": {"reputation": 2725, "user_id": 2251058, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ffc7bebb06ae9943708d99f3621c1b5?s=128&d=identicon&r=PG", "display_name": "Akshay Hazari", "link": "https://stackoverflow.com/users/2251058/akshay-hazari"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1424100756, "post_id": 28535877, "comment_id": 45402881, "body": "@chi Thanks. I&#39;ll try using case .  jkff I&#39;m trying to figure out how I could use append for delete tree. As of now I&#39;m not much comfortable with functional programming."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1424108180, "post_id": 28535877, "comment_id": 45407301, "body": "Deletion in a BST is a bit tricky, in my opinion (both in imperative and functional languages). If your goal is learning functional programming, maybe you could start with some easier task."}], "answers": [{"tags": [], "owner": {"reputation": 1040, "user_id": 4031371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/442e7ad304b6b890126c2edc315570e1?s=128&d=identicon&r=PG", "display_name": "Robin", "link": "https://stackoverflow.com/users/4031371/robin"}, "is_accepted": false, "score": 1, "last_activity_date": 1431726647, "last_edit_date": 1431726647, "creation_date": 1431726288, "answer_id": 30269229, "question_id": 28535877, "link": "https://stackoverflow.com/questions/28535877/haskell-deleting-in-a-binary-search-tree/30269229#30269229", "title": "Haskell deleting in a binary search tree", "body": "<p>Here is a similar implementation just for reference. (Without the delete part though)</p>\n\n<pre><code>-- a tree can be empty or contain a value with two other Trees\ndata Tree a = EmptyTree | Node a (Tree a) (Tree a) deriving (Show, Read, Eq)\n\ninstance Functor Tree where\n    fmap f EmptyTree = EmptyTree\n    fmap f (Node x left right) = Node (f x) (fmap f left) (fmap f right)\n\n-- create a Node with a value and two Empty subtrees (left and right)\nsingleton :: a -&gt; Tree a\nsingleton x = Node x EmptyTree EmptyTree\n\n-- insert a new Node into a tree\ninsertInTree :: (Ord a) =&gt; a -&gt; Tree a -&gt; Tree a\n\n-- insert into empty tree is equal to creating a new tree\ninsertInTree x EmptyTree = singleton x\n\n-- pattern match on value and subtrees\ninsertInTree x (Node a left right)\n    -- if element is equal to root element, return same tree\n    | x == a = Node x left right\n\n    -- if element is smaller than root, go to left\n    -- subtree and check again.\n    | x &lt; a = Node a (insertInTree x left) right\n\n    -- if element is bigger than root, go to right\n    -- subtree and check again.\n    | x &gt; a = Node a left (insertInTree x right)\n\n-- binary tree search\nsearch :: (Ord a) =&gt; a -&gt; Tree a -&gt; Bool\n\n-- search in EmptyTree is always False\nsearch x EmptyTree = False\n\n-- serach in a Node\nsearch x (Node a left right)\n\n    -- if element equals root element, great\n    | x == a = True\n\n    -- if element is smaller than root, continue search on the left side\n    | x &lt; a = search x left\n\n    -- if element is bigger than root, continue search on the right side\n    | x &gt; a = search x right\n\n-- create a test tree\nmyTree = foldr insertInTree EmptyTree [15,75,651,2,3,4,85,42,1,5,36,45,78,12,2]     \n</code></pre>\n"}], "owner": {"reputation": 2725, "user_id": 2251058, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ffc7bebb06ae9943708d99f3621c1b5?s=128&d=identicon&r=PG", "display_name": "Akshay Hazari", "link": "https://stackoverflow.com/users/2251058/akshay-hazari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1277, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1436172868, "creation_date": 1424069125, "last_edit_date": 1436172868, "question_id": 28535877, "link": "https://stackoverflow.com/questions/28535877/haskell-deleting-in-a-binary-search-tree", "title": "Haskell deleting in a binary search tree", "body": "<p>So far I have come up with something like this. What I am trying to do here is get the right most or the leftmost element depending on which is available and swapping them with root and deleting the corresponding rightmost or left most element. I just need some help figuring out why it fails when I ask it to delete root of a tree but it works for all other cases and what does Irrefutable pattern failed mean?</p>\n\n<p>If I do something like <code>delt 3 Node 3 (Node 2 (Node 1 Empty Empty) Empty) (Node 4 Empty Empty)</code> \nit gives an error like <code>Node *** Exception: delt.hs:26:40-75: Irrefutable pattern failed for pattern (Main.Node rm (Main.Empty) (Main.Empty))</code></p>\n\n<p><code>delt 2 a</code> gives <code>Node 3 (Node 1 Empty Empty) (Node 4 Empty Empty)</code></p>\n\n<pre><code>data Tree a = Empty | Node a (Tree a) (Tree a) deriving (Show, Read, Eq)\ntreeIns :: (Ord a) =&gt; a -&gt; Tree a -&gt; Tree a\ntreeIns x Empty= Node x (Empty) (Empty)\ntreeIns x (Node a l r)\n  | x == a = Node a l r\n  | x &lt; a = Node a (treeIns x l) r\n  | x &gt; a = Node a l (treeIns x r)\n\nleftm :: Tree a -&gt; Tree a\nleftm Empty = Empty\nleftm (Node a (Empty) (Empty)) = (Node a (Empty) (Empty))\nleftm (Node a (l) (Empty)) = leftm l\nleftm (Node a (l) (r)) = leftm l\n\nrightm :: Tree a -&gt; Tree a\nrightm Empty = Empty\nrightm (Node a (Empty) (Empty)) = (Node a (Empty) (Empty))\nrightm (Node a (Empty) (r)) = rightm r\nrightm (Node a (l) (r)) = rightm r\n\n\ndelt :: (Eq a, Ord a)=&gt;a -&gt; Tree a -&gt; Tree a\ndelt x Empty = Empty\ndelt x (Node a (Empty)(Empty))\n  | x== a = Empty\ndelt x (Node a l r)\n  |x == a = (if l /= (Empty) then (let (Node rm (Empty) (Empty)) = rightm l in (Node rm (delt rm l) r)) else (let (Node rm (Empty) (Empty)) = l\\\neftm r in (Node rm l (delt rm r)) ))\n  |x&gt;a = Node a (l) (delt x r)\n  |x &lt; a = Node a (delt x l ) r\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "monads"], "comments": [{"owner": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "edited": false, "score": 0, "creation_date": 1424069359, "post_id": 28535481, "comment_id": 45386012, "body": "Hint: the String in <code>notEndOfString</code> is the result of your parse, not the input to be parsed."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424116041, "post_id": 28535481, "comment_id": 45411365, "body": "You probably want <code>zeroOrMore notEndOfStringOrQuote</code>. In parsec, for example, I would probably just write <code>many (noneOf &quot;\\&quot;&quot;)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 1, "last_activity_date": 1424201547, "last_edit_date": 1424201547, "creation_date": 1424134665, "answer_id": 28552972, "question_id": 28535481, "link": "https://stackoverflow.com/questions/28535481/writing-parser-for-json-string/28552972#28552972", "title": "Writing Parser for JSON String", "body": "<p><code>notEndOfString</code> is matching and consuming any characters in the text <em>including <code>\"</code></em> until the end, so it acts greedily to consume all characters and never hands off to the <code>char '\"'</code> parser. You need to match any characters inside of the quotes that <em>aren't a quote</em>, which means you need the negation of <code>char</code>.</p>\n\n<p>If you have <code>char</code> then presumably you built it from <code>satisfy</code>, which means you can also define <code>notChar</code>:</p>\n\n<pre><code>notChar c = satisfy (/= c)\n</code></pre>\n\n<p>(Note, by the way, that <code>notEndOfString</code> is just <code>satisfy id</code>). Otherwise, you can write it similarly to <code>char</code>.</p>\n\n<p>Then you can define the parser for strings by building up a few other useful combinators:</p>\n\n<pre><code>bracket l r p = l *&gt; p &lt;* r\nquotes = bracket (char '\"') (char '\"')\n\nparseStringJValue = S &lt;$&gt; quotes (zeroOrMore (notChar '\"'))\n</code></pre>\n\n<p>Note that this won't handle escapes (<code>\"\\\"\"</code>) within quotes.</p>\n\n<hr>\n\n<p>Edit: To enforce the invariant that is implicit above, it would be nice to define</p>\n\n<pre><code>inside l r = bracket (char l) (char r) (zeroOrMore (notChar r))\n</code></pre>\n\n<p>Then <code>parseStringJValue = S &lt;$&gt; inside '\"' '\"'</code>.</p>\n"}], "migrated_from": {"other_site": {"markdown_extensions": ["MathJax", "Prettify"], "launch_date": 1436881020, "open_beta_date": 1296068400, "closed_beta_date": 1295463600, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/codereview/Img/apple-touch-icon@2.png", "twitter_account": "StackCodeReview", "favicon_url": "https://cdn.sstatic.net/Sites/codereview/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/codereview/Img/apple-touch-icon.png", "audience": "peer programmer code reviews", "site_url": "https://codereview.stackexchange.com", "api_site_parameter": "codereview", "logo_url": "https://cdn.sstatic.net/Sites/codereview/Img/logo.png", "name": "Code Review", "site_type": "main_site"}, "on_date": 1424067070, "question_id": 80646}, "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 28552972, "answer_count": 1, "score": 1, "last_activity_date": 1424201547, "creation_date": 1424062562, "question_id": 28535481, "link": "https://stackoverflow.com/questions/28535481/writing-parser-for-json-string", "title": "Writing Parser for JSON String", "body": "<p>As part of trying to write a JSON Parser, I'm working on parsing a JSON String value.</p>\n\n<p>Given the following definition from Prof. Brent Yorgey's Haskell <a href=\"http://www.cis.upenn.edu/~cis194/spring13/\" rel=\"nofollow\">course</a>:</p>\n\n<pre><code>-- A parser for a value of type a is a function which takes a String\n-- represnting the input to be parsed, and succeeds or fails; if it\n-- succeeds, it returns the parsed value along with the remainder of\n-- the input.\nnewtype Parser a = Parser { runParser :: String -&gt; Maybe (a, String) }\n</code></pre>\n\n<p>I'm running into trouble since, as I understand, my second parser, <code>zeroOrMore notEndOfString</code>, simply consumes every <em>token</em> until reaching the end of the String.</p>\n\n<p><code>data JValue = S String | ...</code></p>\n\n<pre><code>parseStringJValue :: Parser JValue\nparseStringJValue = S &lt;$&gt; ((char '\"') *&gt; (zeroOrMore notEndOfString) &lt;* (char '\"'))\n\nnotEndOfString :: Parser Char\nnotEndOfString = Parser f\n  where \n    f []     = Nothing\n    f (x:xs) = Just (x, xs)\n</code></pre>\n\n<p>Using this applicative approach, please give me a hint towards modifying my above <code>parseStringJValue</code> to actually work.</p>\n\n<p>Note - I have a faint idea on how to solve it with Monads, but I'm not sure if if they are required.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1424070877, "post_id": 28534612, "comment_id": 45386627, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/7576843/can-you-use-pattern-matching-to-bind-the-last-element-of-a-list\">Can you use pattern matching to bind the last element of a list?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1424062792, "post_id": 28534769, "comment_id": 45384039, "body": "What do you mean by <code>pattern matching language extensions</code>? Is that provided in your answer, or it&#39;s something else? thanks"}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 1, "creation_date": 1424062997, "post_id": 28534769, "comment_id": 45384088, "body": "My answer doesn&#39;t use any extensions, just a plain <code>case</code> statement. By &quot;extension&quot; I mean specifically the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ViewPatterns\" rel=\"nofollow noreferrer\">ViewPatterns</a> language extension, <a href=\"http://stackoverflow.com/questions/7576843/can-you-use-pattern-matching-to-bind-the-last-element-of-a-list\">as described in this question</a>. This is a flag you provide to the compiler / interpreter to let it know about a non-standard language feature that will be enabled (in this case, fancier pattern matching in equational definitions)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1424096814, "post_id": 28534769, "comment_id": 45400558, "body": "Why use pattern matching instead of just <code>==</code> here?"}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1424103153, "post_id": 28534769, "comment_id": 45404407, "body": "@dfeuer You&#39;re quite right. If the actual, real-life desired functionality was literally to just match to &quot;f&quot; and &quot;b&quot; in this post, it would be a one-liner with <code>==</code>. I assumed that this was a toy problem meant to ask about this kind of pattern matching because the actual operations to do would be more involved (as in, it will do different function calls in the case statements), so I opted to write it in a way that resembled the pattern match. But your point is a good one."}], "tags": [], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "is_accepted": false, "score": 7, "last_activity_date": 1424063254, "last_edit_date": 1424063254, "creation_date": 1424062555, "answer_id": 28534769, "question_id": 28534612, "link": "https://stackoverflow.com/questions/28534612/pattern-match-on-first-and-last-items-of-list/28534769#28534769", "title": "Pattern Match on First and Last Items of List", "body": "<p>There is no easy way to do this without pattern matching language extensions. I would write it as:</p>\n\n<pre><code>f :: String -&gt; Bool\nf str = case (take 1 str, drop (length str - 1) str) of\n    (\"f\", \"b\") -&gt; True\n    otherwise -&gt; False\n</code></pre>\n\n<p>(Using <code>take</code> and <code>drop</code> to avoid specially handling case of an empty string that might cause an error when using e.g. <code>head</code> or <code>!!</code>)   </p>\n\n<pre><code>Prelude&gt; f \"flub\"\nTrue\nPrelude&gt; f \"foo\"\nFalse\nPrelude&gt; f \"fb\"\nTrue\nPrelude&gt; f \"fbbbb\"\nTrue\nPrelude&gt; f \"fbbbbf\"\nFalse\nPrelude&gt; f \"\"\nFalse\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 1, "last_activity_date": 1424064286, "creation_date": 1424064286, "answer_id": 28535023, "question_id": 28534612, "link": "https://stackoverflow.com/questions/28534612/pattern-match-on-first-and-last-items-of-list/28535023#28535023", "title": "Pattern Match on First and Last Items of List", "body": "<p>No, it is not possible directly.</p>\n\n<p><code>:</code> wants a list element on the left side, and a list on the right side.</p>\n\n<p><code>'f':xs:'b'</code> is invalid because there's something that is not a list on the right side of the second <code>:</code>.</p>\n\n<p><code>'f':xs:\"b\"</code> would be valid but won't do what you want, because <code>xs</code> is inferred to be a list element, not a list.</p>\n\n<p>I would do this:</p>\n\n<pre><code>f s = f' (s, reverse s) where\n   f' ('f':_, 'b':_) = True\n   f' _              = False\n</code></pre>\n\n<p>Testing:</p>\n\n<pre><code>*Main&gt; f \"\"\nFalse\n*Main&gt; f \"f\"\nFalse\n*Main&gt; f \"b\"\nFalse\n*Main&gt; f \"fb\"\nTrue\n*Main&gt; f \"feeeeeeeb\"\nTrue\n*Main&gt; f (repeat 'b')\nFalse\n*Main&gt; f (repeat 'f')\n(hangs indefinitely)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 370, "user_id": 4557694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24e1eefea58ed065620e1b494503c0da?s=128&d=identicon&r=PG", "display_name": "Chad Groft", "link": "https://stackoverflow.com/users/4557694/chad-groft"}, "is_accepted": false, "score": 2, "last_activity_date": 1424067229, "creation_date": 1424067229, "answer_id": 28535505, "question_id": 28534612, "link": "https://stackoverflow.com/questions/28534612/pattern-match-on-first-and-last-items-of-list/28535505#28535505", "title": "Pattern Match on First and Last Items of List", "body": "<p>As the previous answers state, there's no way to pattern-match directly for this. One might implement it as follows:</p>\n\n<pre><code>f 'f':xs@(_:_) = last xs == 'b'  -- @(_:_) ensures nonempty tail\nf _            = False\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18463, "user_id": 3189923, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/5d3122866199817cdf56b96a788d406f?s=128&d=identicon&r=PG&f=1", "display_name": "elm", "link": "https://stackoverflow.com/users/3189923/elm"}, "is_accepted": false, "score": 0, "last_activity_date": 1424079715, "last_edit_date": 1424079715, "creation_date": 1424075299, "answer_id": 28537251, "question_id": 28534612, "link": "https://stackoverflow.com/questions/28534612/pattern-match-on-first-and-last-items-of-list/28537251#28537251", "title": "Pattern Match on First and Last Items of List", "body": "<p>Define a dedicated <code>String</code> data type and hence a form of pattern matching, for instance consider</p>\n\n<pre><code>data HString = Ends Char Char | Plain String \n  deriving (Show, Eq)\n</code></pre>\n\n<p>Thus</p>\n\n<pre><code>f :: HString -&gt; Bool\nf (Ends h l) = (h,l) == ('f','b')\nf (Plain \"\") = False\nf (Plain xs) = f $ Ends (head xs) (last xs)\n</code></pre>\n\n<p>and so</p>\n\n<pre><code>*Main&gt; f (Plain \"\")\nFalse\n*Main&gt; f (Plain \"fabs\")\nFalse\n*Main&gt; f (Plain \"fab\")\nTrue\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>Similarly, consider the use of an infix operator <code>:-:</code> to denote a constructor, e.g</p>\n\n<pre><code>infixr 5 :-:\n\ndata HString = Char :-: Char | Plain String \n  deriving (Show, Eq)\n</code></pre>\n\n<p>and thus </p>\n\n<pre><code>f :: HString -&gt; Bool\nf (h :-: l)  = (h,l) == ('f','b')\nf (Plain \"\") = False\nf (Plain xs) = f $ (head xs) :-: (last xs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1424088212, "creation_date": 1424088212, "answer_id": 28541036, "question_id": 28534612, "link": "https://stackoverflow.com/questions/28534612/pattern-match-on-first-and-last-items-of-list/28541036#28541036", "title": "Pattern Match on First and Last Items of List", "body": "<p>For a list-like data-structure allowing you to access both its first and last element <em>in constant time</em>, you may want to have a look at Hinze and Paterson's fingertrees.</p>\n\n<p>They are shipped by e.g. <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Sequence.html\" rel=\"nofollow\">containers</a> and <a href=\"http://hackage.haskell.org/package/containers-0.5.6.3/docs/Data-Sequence.html#g:6\" rel=\"nofollow\">here are the relevant views</a> to deconstruct them. You may want to write your own view combining deconstruction on the left and the right if you are using this pattern a lot:</p>\n\n<pre><code>data ViewLR a = EmptyLR | SingleLR a | BothSides a (Seq a) a\n\nviewlr :: Seq a -&gt; ViewLR a\nviewlr seq =\n  case viewl seq of\n    EmptyL     -&gt; EmptyLR\n    hd :&lt; rest -&gt;\n      case viewr rest of\n        EmptyR       -&gt; SingleLR hd\n        middle :&gt; tl -&gt; BothSides hd middle tl\n</code></pre>\n\n<p>You may also want to read up on <a href=\"https://ocharles.org.uk/blog/posts/2014-12-02-view-patterns.html\" rel=\"nofollow\">View Patterns</a> to be able to \"pattern match\" on the left rather than having to use <code>case ... of</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 399, "user_id": 3857075, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ofemI.jpg?s=128&g=1", "display_name": "Animesh Saxena", "link": "https://stackoverflow.com/users/3857075/animesh-saxena"}, "is_accepted": false, "score": 0, "last_activity_date": 1424096055, "creation_date": 1424096055, "answer_id": 28543359, "question_id": 28534612, "link": "https://stackoverflow.com/questions/28534612/pattern-match-on-first-and-last-items-of-list/28543359#28543359", "title": "Pattern Match on First and Last Items of List", "body": "<p>To understand the error simply check the signature of : operator</p>\n\n<pre><code>Prelude&gt; :t (:)\n(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>It can accept an element and a list to give the appended list. When you supply 'f':xs:'b', then it doesn't match the function call. </p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1047, "favorite_count": 0, "answer_count": 6, "score": 3, "last_activity_date": 1424096055, "creation_date": 1424061520, "question_id": 28534612, "link": "https://stackoverflow.com/questions/28534612/pattern-match-on-first-and-last-items-of-list", "title": "Pattern Match on First and Last Items of List", "body": "<p>Is it possible to pattern match on \"starts with <code>f</code>\", then any text, and \"ends with <code>b</code>?</p>\n\n<p>I tried:</p>\n\n<pre><code>f :: String -&gt; Bool\nf ('f':xs:'b') = True\nf _            = False\n</code></pre>\n\n<p>But I got an error:</p>\n\n<pre><code>explore/PatternMatching.hs:2:11:\n    Couldn't match expected type \u2018[Char]\u2019 with actual type \u2018Char\u2019\n    In the pattern: 'b'\n    In the pattern: xs : 'b'\n    In the pattern: 'f' : xs : 'b'\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1424064305, "post_id": 28534417, "comment_id": 45384401, "body": "There are too many possible things that that function could do. The name of the function alone is not enough; you should describe its behaviour."}, {"owner": {"reputation": 7, "user_id": 4569708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73094b620752228095796105118a8d1e?s=128&d=identicon&r=PG&f=1", "display_name": "lee1234567890", "link": "https://stackoverflow.com/users/4569708/lee1234567890"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424098387, "post_id": 28534417, "comment_id": 45401457, "body": "It returns True if all the functions applied to their corresponding pair values return True - otherwise False.It also returns false if there are different numbers of functions and pairs."}], "answers": [{"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1424133377, "post_id": 28534619, "comment_id": 45418460, "body": "That could also be written as <code>allPair fs = and . zipWith uncurry fs</code>."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1424133857, "post_id": 28534619, "comment_id": 45418580, "body": "Note that in that case, however, if the lists are of different lengths, <code>zipWith</code> will perform the zipping up to the length of the shortest. As a result, if you evaluate for example <code>allPair [(&gt;), (&lt;)] [(2, 1)]</code> you get <code>True</code>, whereas in my version (and apparently also the OP&#39;s desire based on a comment) it would evaluate to <code>False</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1424134694, "post_id": 28534619, "comment_id": 45418809, "body": "I did mention that but lost it in an edit. It does subtly differ from the behavior of yours as you mentioned."}], "tags": [], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "is_accepted": true, "score": 1, "last_activity_date": 1424061604, "creation_date": 1424061604, "answer_id": 28534619, "question_id": 28534417, "link": "https://stackoverflow.com/questions/28534417/haskell-function-given-type-signature-of-boolean/28534619#28534619", "title": "haskell function given type signature of boolean", "body": "<p>There are many possible implementations, but it seems like the one you are reaching for is a function that takes the first element of the <code>[a -&gt; b -&gt; Bool]</code> list and applies it to the values taken from the first element of the <code>[(a, b)]</code> list to produce a <code>Bool</code> which will be <code>&amp;&amp;</code>-ed together with the analogous outputs from the second elements, third elements, and so on.</p>\n\n<p>Here is a function to do this, under the assumption that the base case of no data evaluates to <code>True</code>, and that whenever there are more functions than arg-pairs, or more arg-pairs than functions, it should be <code>False</code>.</p>\n\n<pre><code>allPair :: [a -&gt; b -&gt; Bool] -&gt; [(a, b)] -&gt; Bool\nallPair [] [] = True\nallPair _ [] = False\nallPair [] _ = False\nallPair (f:fs) ((a,b):vals) = (f a b) &amp;&amp; (allPair fs vals)\n</code></pre>\n\n<p>for instance</p>\n\n<pre><code>Prelude&gt; allPair [(&gt;), (&lt;)] [(3, 1), (10, 2)]\nFalse\nPrelude&gt; allPair [(&gt;), (&lt;)] [(3, 1), (2, 10)]\nTrue\n</code></pre>\n\n<p>Note that this function assumes the arguments passed to it will be of compatible lengths (or that getting <code>False</code> back when they aren't is acceptable). It is quite tricky and involves language extensions if you want to actually use the type system to enforce matching arity of <code>List</code> arguments.</p>\n"}], "owner": {"reputation": 7, "user_id": 4569708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73094b620752228095796105118a8d1e?s=128&d=identicon&r=PG&f=1", "display_name": "lee1234567890", "link": "https://stackoverflow.com/users/4569708/lee1234567890"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 580, "favorite_count": 0, "accepted_answer_id": 28534619, "answer_count": 1, "score": 0, "last_activity_date": 1424098410, "creation_date": 1424060015, "last_edit_date": 1424098410, "question_id": 28534417, "link": "https://stackoverflow.com/questions/28534417/haskell-function-given-type-signature-of-boolean", "title": "haskell function given type signature of boolean", "body": "<p>If I have this type signature, what function should I write to satisfy it?</p>\n\n<pre><code>allPair :: [a -&gt; b -&gt; Bool] -&gt; [(a,b)] -&gt; Bool \n</code></pre>\n\n<p>The only thing I know is <code>==</code> has type <code>a -&gt; a -&gt; Bool</code>.</p>\n\n<p>It returns True if all the functions applied to their corresponding pair values return True - otherwise False.\nIt also returns false if there are different numbers of functions and pairs.</p>\n"}, {"tags": ["haskell", "design-patterns", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424064491, "post_id": 28534278, "comment_id": 45384450, "body": "&quot;But this doesn&#39;t really work ...&quot; Why not? It would seem that keeping things inside of IO or some other monad is the simplest thing to do. You can certainly still use functions from Parsec. Can you give some example code for the type of thing you&#39;d want to do, or your existing solution using <code>unsafePerformIO</code>?"}, {"owner": {"reputation": 929, "user_id": 1750683, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/918873ca1e4732f952c0baa31cfd3ba0?s=128&d=identicon&r=PG", "display_name": "Enzo", "link": "https://stackoverflow.com/users/1750683/enzo"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424065919, "post_id": 28534278, "comment_id": 45384833, "body": "I think I might be confusing myself a little bit. Let&#39;s say <code>type Frontend = StateT (Map, Int) ParsecT [Token] () m</code>. So when I write the parser, because I need to access the <code>symbol</code> feature, the signature of the parsers would have to be <code>Frontend ty</code> right? But for combinators like <code>&lt;|&gt;</code> they seem to require the two arguments to be of type <code>ParsecT ...</code>."}, {"owner": {"reputation": 929, "user_id": 1750683, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/918873ca1e4732f952c0baa31cfd3ba0?s=128&d=identicon&r=PG", "display_name": "Enzo", "link": "https://stackoverflow.com/users/1750683/enzo"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424065948, "post_id": 28534278, "comment_id": 45384847, "body": "Right now I have stuff like this      <code>symbolState :: IORef (SymbolMap, Int)     {-# NOINLINE symbolState #-}     symbolState = unsafePerformIO $ newIORef (Map.empty, 0)      symbol :: String -&gt; IO Symbol     symbol str = ...</code>"}, {"owner": {"reputation": 929, "user_id": 1750683, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/918873ca1e4732f952c0baa31cfd3ba0?s=128&d=identicon&r=PG", "display_name": "Enzo", "link": "https://stackoverflow.com/users/1750683/enzo"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1424074078, "post_id": 28534278, "comment_id": 45387935, "body": "Hmm actually I think I might have realized what&#39;s happening. First of all, I needed to import Control.Applicative for &lt;|&gt; since StateT is an instance of Alternative. But the problems with <code>try</code>, <code>optionMaybe</code> and <code>between</code> combinators from <code>Parsec</code> are still unsolved. <code>lift</code> from <code>MonadTrans</code> class lifts a monad, but these combinators are functions that takes monads and produce new monads. So How would I &quot;lift&quot; them into the <code>StateT (Map, Int) ParsecT [Token] () m</code> monad?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1424076477, "post_id": 28534278, "comment_id": 45389060, "body": "Why not have <code>ParsecT</code> on the outside? Or why not move  the state into the <code>u</code> &quot;user state&quot; param in <code>ParsecT</code>?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1424083814, "post_id": 28534278, "comment_id": 45393257, "body": "BTW, <a href=\"https://hackage.haskell.org/package/trifecta\" rel=\"nofollow noreferrer\"><code>trifecta</code></a> with <a href=\"https://hackage.haskell.org/package/parsers\" rel=\"nofollow noreferrer\"><code>parsers</code></a> allows you to add transformers on either sides freely, as the basic combinators there require only an <code>Alternative</code> constraint or are factored out in other classes. With <code>StateT s (ParsecT st u m) a</code> we have to manually write wrapping/unwrapping code for the combinators."}, {"owner": {"reputation": 929, "user_id": 1750683, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/918873ca1e4732f952c0baa31cfd3ba0?s=128&d=identicon&r=PG", "display_name": "Enzo", "link": "https://stackoverflow.com/users/1750683/enzo"}, "edited": false, "score": 0, "creation_date": 1424132888, "post_id": 28534278, "comment_id": 45418322, "body": "Having <code>ParsecT</code> on the outside would indeed work... It just felt a little weird to me because a lot of the stuff on this stack is not really parsing related, so I wasn&#39;t sure if I should do that."}], "owner": {"reputation": 929, "user_id": 1750683, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/918873ca1e4732f952c0baa31cfd3ba0?s=128&d=identicon&r=PG", "display_name": "Enzo", "link": "https://stackoverflow.com/users/1750683/enzo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1424066582, "creation_date": 1424058599, "last_edit_date": 1424066582, "question_id": 28534278, "link": "https://stackoverflow.com/questions/28534278/how-to-design-a-stack-of-monad-transformers-for-my-compiler-frontend", "title": "how to design a stack of monad transformers for my compiler frontend", "body": "<p>I'm working on a Haskell version of the assignments in Modern Compiler implementation in ML. I currently have a working front end and IR translation module, but they are using some very bad hacks which I want to avoid.</p>\n\n<p>The hacks are mainly global IORefs created through <code>unsafePerformIO</code>. Those global IORefs are used to implement the <code>symbol</code> module described in the book.</p>\n\n<p><code>symbol</code> is a light-weight representation for a String. They way the module works is is basically by keeping track of a <code>Map</code> and an <code>Int</code>. For each string that I have not yet seen before assign it the next integer, and modify the stored map and counter in the <code>IORef</code>.</p>\n\n<p><code>symbol</code> module is used by the parser and the IR translation module. The parser uses it to translate <code>String</code> into <code>symbol</code>s, while IR uses another module that's based upon the <code>symbol</code> module to create unique function labels (the language I'm implementing supports nested function declarations).</p>\n\n<p>Now, I would really like to get rid of the <code>IORef</code>s and <code>unsafePerformIO</code>s. So I was thinking I can use <code>StateT (Map, Int) ParsecT [Token] () m</code> instead so that the map and counter is kept inside a state monad. While the computation for IR translation will be kept inside the inner monad <code>m</code>.</p>\n\n<p>But this doesn't really work, because I'd like to be able to still use combinators like <code>try</code>, <code>optionMaybe</code> from the <code>Parsec</code> library.</p>\n\n<p>In short, the imperative analogy is that I have a module <code>A</code>, whose functionality is accessed by two other modules <code>B</code> and <code>C</code> (could be more). <code>A</code> itself needs to keep track of some states, and <code>B, C</code> might or might not perform stateful computations. How would one translate such a relationship into Haskell?</p>\n\n<p>I would love to hear some advice on how to structure code and how to design a stack of monads for this kind of problem. I am very new to Haskell, and if these ideas don't seem to make sense, please let me know and tell me what the right way to do things is :)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1424053371, "post_id": 28533626, "comment_id": 45382074, "body": "It&#39;d be better to use the <code>readFile</code> function, you won&#39;t have to worry about file mode or handles.  After reading it like <code>contents &lt;- readFile &quot;words.txt&quot;</code>, you&#39;ll want to perform a transformation like <code>let allLines = lines contents</code>, then you could print it out like <code>print $ take 5 all_lines</code>"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1424056482, "post_id": 28533626, "comment_id": 45382650, "body": "This is almost completely identical (including the strange <code>let list = []</code> line) to a question asked a few days ago, but I can&#39;t find it now. The previous question included some goals for what to be done with the data (sort the list of words)."}, {"owner": {"reputation": 565, "user_id": 2930793, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/bTDDD.jpg?s=128&g=1", "display_name": "Sazzad", "link": "https://stackoverflow.com/users/2930793/sazzad"}, "edited": false, "score": 1, "creation_date": 1424058426, "post_id": 28533626, "comment_id": 45383050, "body": "see here :)  <a href=\"http://stackoverflow.com/questions/7867723/haskell-file-reading\">stackoverflow.com/questions/7867723/haskell-file-reading</a>"}], "answers": [{"tags": [], "owner": {"reputation": 64980, "user_id": 954986, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/9bc332a4fccaf3e527fdc258b6990f2d?s=128&d=identicon&r=PG", "display_name": "Nathan", "link": "https://stackoverflow.com/users/954986/nathan"}, "is_accepted": false, "score": 3, "last_activity_date": 1424057148, "creation_date": 1424057148, "answer_id": 28534106, "question_id": 28533626, "link": "https://stackoverflow.com/questions/28533626/reading-in-text-file/28534106#28534106", "title": "Reading in Text File", "body": "<p>As was mentioned in the comments, the simplest way to do this is to use the <code>readFile</code> function. <code>readFile</code> is actually part of prelude (the base library), so you don't have to import anything.</p>\n\n<p><code>contents &lt;- readFile \"words.txt\"</code> will lazily load the entire file into the string <code>contents</code>. Then, you can do various string processing to parse the file as you want. The function <code>lines</code> (included by default as well) will split the <code>contents</code> into a list of strings, splitting it on line breaks. The function <code>words</code> will split <code>contents</code> into a list of strings, splitting it on whitespace. </p>\n\n<p>For more advanced methods, you can look into the System.IO library documention on <a href=\"https://hackage.haskell.org/package/base-4.5.0.0/docs/System-IO.html\" rel=\"nofollow\" title=\"hackage\">Hackage</a>. The documentation provided on Hackage tends to be clear and a really useful resource.</p>\n\n<p>Keep up with Haskell! It's worth it.</p>\n"}], "owner": {"reputation": 41, "user_id": 4490870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e9d309394ce2d7029ddfcf9451019d0?s=128&d=identicon&r=PG&f=1", "display_name": "SumYungGai", "link": "https://stackoverflow.com/users/4490870/sumyunggai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1764, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1424058507, "creation_date": 1424053078, "last_edit_date": 1424053412, "question_id": 28533626, "link": "https://stackoverflow.com/questions/28533626/reading-in-text-file", "title": "Reading in Text File", "body": "<p>I'm trying to read in a text file using Haskell, but based on my limited and little knowledge of the language, I'm have a bit of trouble an would like some help.</p>\n\n<p>I have a text file with 1000+ random words, and would like to read in the text file\nI know that I have to </p>\n\n<pre><code>import System.IO\n</code></pre>\n\n<p>and maybe </p>\n\n<pre><code>import Data.List\n</code></pre>\n\n<p>and I have something like this:</p>\n\n<pre><code>main = do \n       let list = []\n       handle &lt;- openFile \"words.txt\" ReadMode\n       contents &lt;- hGetContents handle\n</code></pre>\n\n<p>but I don't know much more to proceed.\nAny help would be great. I've been stuck for a while now and have a deadline coming soon. Thank you!</p>\n"}, {"tags": ["haskell", "recursion", "fold", "combinators"], "comments": [{"owner": {"reputation": 1192, "user_id": 3130218, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4bb68cdeb7d159067f837658ff981d0b?s=128&d=identicon&r=PG", "display_name": "bb94", "link": "https://stackoverflow.com/users/3130218/bb94"}, "edited": false, "score": 0, "creation_date": 1424049463, "post_id": 28533221, "comment_id": 45381246, "body": "Don&#39;t know, something with monads?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 1192, "user_id": 3130218, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4bb68cdeb7d159067f837658ff981d0b?s=128&d=identicon&r=PG", "display_name": "bb94", "link": "https://stackoverflow.com/users/3130218/bb94"}, "edited": false, "score": 0, "creation_date": 1424049584, "post_id": 28533221, "comment_id": 45381273, "body": "I guess monads are way too powerful for what I want. Obviously this is doable with them, but I guess something less generic can still make it. Something about folds with context... I&#39;m not sure."}, {"owner": {"reputation": 1192, "user_id": 3130218, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4bb68cdeb7d159067f837658ff981d0b?s=128&d=identicon&r=PG", "display_name": "bb94", "link": "https://stackoverflow.com/users/3130218/bb94"}, "edited": false, "score": 0, "creation_date": 1424050065, "post_id": 28533221, "comment_id": 45381360, "body": "That definitely sounds like monads!"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1424050264, "post_id": 28533221, "comment_id": 45381403, "body": "I&#39;m pretty sure <code>fold</code> is plenty strong enough. But I&#39;m on my phone right now, so I can&#39;t double-check."}, {"owner": {"reputation": 5561, "user_id": 2377920, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Q6Vzy.png?s=128&g=1", "display_name": "roo2", "link": "https://stackoverflow.com/users/2377920/roo2"}, "edited": false, "score": 0, "creation_date": 1426255024, "post_id": 28533221, "comment_id": 46309035, "body": "Try something mid strength, maybe a closure?"}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1424052141, "post_id": 28533460, "comment_id": 45381783, "body": "That is very smart. By returning a tree of functions, you are able to pass the level down the tree by mapping an application to child nodes. Stupidly, I remember now I faced a very similar situation once and someone suggested a similar solution. D&#39;oh. Thank you."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 2, "creation_date": 1424052564, "post_id": 28533460, "comment_id": 45381896, "body": "No problem! It&#39;s a fairly non-obvious trick until you&#39;ve just jammed it out enough times."}], "tags": [], "owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "is_accepted": true, "score": 15, "last_activity_date": 1424051569, "creation_date": 1424051569, "answer_id": 28533460, "question_id": 28533221, "link": "https://stackoverflow.com/questions/28533221/since-fold-isnt-powerful-enough-to-write-a-tree-pretty-printer-with-indentati/28533460#28533460", "title": "Since &quot;fold&quot; isn&#39;t powerful enough to write a tree pretty-printer with indentation, what high-order combinator is?", "body": "<p><code>fold</code> is strong enough; the trick is that we'll need to instantiate <code>r</code> as a reader monad of the current indentation level.</p>\n\n<pre><code>fold :: ([r] -&gt; r) -&gt; (a -&gt; r) -&gt; (Tree a -&gt; r)\nfold node leaf (Node children) = node (map (fold node leaf) children)\nfold node leaf (Leaf terminal) = leaf terminal\n\npretty :: forall a . Show a =&gt; Tree a -&gt; String\npretty tree = fold node leaf tree 0 where\n\n  node :: [Int -&gt; String] -&gt; Int -&gt; String\n  node children level = \n    let childLines = map ($ level + 1) children\n    in unlines ([indent level \"Node [\"] ++ childLines ++ [indent level \"]\"])\n\n  leaf :: a -&gt; Int -&gt; String\n  leaf a level = indent level (show a)\n\n  indent :: Int -&gt; String -&gt; String -- two space indentation\n  indent n s = replicate (2 * n) ' ' ++ s\n</code></pre>\n\n<p>Take careful note that I pass an extra parameter to the call to <code>fold</code>. This is the initial state of indentation and it works because with this specialization of <code>r</code>, <code>fold</code> returns a function.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1424124492, "post_id": 28543342, "comment_id": 45415489, "body": "That&#39;s a really pretty way to put it."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 4, "last_activity_date": 1424095973, "creation_date": 1424095973, "answer_id": 28543342, "question_id": 28533221, "link": "https://stackoverflow.com/questions/28533221/since-fold-isnt-powerful-enough-to-write-a-tree-pretty-printer-with-indentati/28543342#28543342", "title": "Since &quot;fold&quot; isn&#39;t powerful enough to write a tree pretty-printer with indentation, what high-order combinator is?", "body": "<p>It's simply</p>\n\n<pre><code>onLast f xs = init xs ++ [f (last xs)]\n\npretty :: Sexp -&gt; String\npretty = unlines . fold (node . concat) (:[]) where\n    node  []    = [\"\"]\n    node (x:xs) = ('(' : x) : map (\"  \" ++) (onLast (++ \")\") xs)\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 574, "favorite_count": 5, "accepted_answer_id": 28533460, "answer_count": 2, "score": 15, "last_activity_date": 1424095973, "creation_date": 1424049377, "question_id": 28533221, "link": "https://stackoverflow.com/questions/28533221/since-fold-isnt-powerful-enough-to-write-a-tree-pretty-printer-with-indentati", "title": "Since &quot;fold&quot; isn&#39;t powerful enough to write a tree pretty-printer with indentation, what high-order combinator is?", "body": "<p>Given, for example, the following tree data type:</p>\n\n<pre><code>data Tree a = Node [Tree a] | Leaf a deriving Show\ntype Sexp = Tree String\n</code></pre>\n\n<p>How do I express a \"pretty\" function using an high-order combinator, that prints the tree with proper indentation? For example:</p>\n\n<pre><code>sexp = \n    Node [\n        Leaf \"aaa\", \n        Leaf \"bbb\",\n        Node [\n            Leaf \"ccc\",\n            Leaf \"ddd\",\n            Node [\n                Leaf \"eee\",\n                Leaf \"fff\"],\n            Leaf \"ggg\",\n            Leaf \"hhh\"],\n        Leaf \"jjj\",\n        Leaf \"kkk\"]\npretty = ????\nmain = print $ pretty sexp\n</code></pre>\n\n<p>I want the result of that program to be:</p>\n\n<pre><code>(aaa \n   bbb \n   (ccc \n       ddd \n       (eee \n           fff) \n       ggg \n       hhh) \n   jjj \n   kkk) \n</code></pre>\n\n<p>Here is an incomplete solution, using a \"fold\" as the combinator, that doesn't implement the indentation:</p>\n\n<pre><code>fold f g (Node children) = f (map (fold f g) children)\nfold f g (Leaf terminal) = g terminal\npretty = fold (\\ x -&gt; \"(\" ++ (foldr1 ((++) . (++ \" \")) x) ++ \")\") show\nmain = putStrLn $ pretty sexp\n</code></pre>\n\n<p>It is obviously not possible to write the function I want using <code>fold</code>, since it forgets the tree structure. So, what is a proper high-order combinator that is generic enough to allow me to write the function I want, but less powerful than writing a direct recursive function?</p>\n"}, {"tags": ["haskell", "functional-programming", "composition"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1424046342, "post_id": 28532836, "comment_id": 45380604, "body": "You&#39;re looking for the <a href=\"http://hackage.haskell.org/package/composition-1.0.1.0/docs/Data-Composition.html\" rel=\"nofollow noreferrer\">composition</a> library."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1424046728, "post_id": 28532836, "comment_id": 45380686, "body": "@bheklilr: yes, that&#39;s it. Why doesn&#39;t this show up in <i>Hoogle</i>?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1424046966, "post_id": 28532836, "comment_id": 45380743, "body": "Hoogle doesn&#39;t search all of hackage, but you can use <a href=\"https://www.haskell.org/hoogle/?hoogle=%28c+-%3E+d%29+-%3E+%28a+-%3E+b+-%3E+c%29+-%3E+a+-%3E+b+-%3E+d+%2Bcomposition\" rel=\"nofollow noreferrer\">+composition</a> to search a particular package, but that doesn&#39;t help you find the package to search.  You can use <a href=\"https://www.fpcomplete.com/hoogle?q=%28c+-%3E+d%29+-%3E+%28a+-%3E+b+-%3E+c%29+-%3E+a+-%3E+b+-%3E+d&amp;env=ghc-7.8-stable-14.09\" rel=\"nofollow noreferrer\">fpcomplete&#39;s</a> version of hoogle which searches more packages by default."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1424088796, "post_id": 28532836, "comment_id": 100828197, "body": "Jasper Van der Jeugt has a generic operator doing precisely this. See <a href=\"http://jaspervdj.be/posts/2014-10-17-generalizing-function-composition.html\" rel=\"nofollow noreferrer\">this blog post</a>."}], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 6, "last_activity_date": 1424053998, "creation_date": 1424053998, "answer_id": 28533739, "question_id": 28532836, "link": "https://stackoverflow.com/questions/28532836/haskell-for-function-with-multiple-operands/28533739#28533739", "title": "Haskell (.) for function with multiple operands", "body": "<p>To answer-ify my comments:</p>\n\n<p>Multi-argument function composition operators are very easy to define, and luckily someone has done this for you already.  The <a href=\"http://hackage.haskell.org/package/composition-1.0.1.0/docs/Data-Composition.html\" rel=\"noreferrer\">composition</a> package has a nice set of operators for you to use to compose functions in this manner.  I also find that instead of using haskell.org's hoogle engine, <a href=\"https://www.fpcomplete.com/hoogle?q=%28c+-%3E+d%29+-%3E+%28a+-%3E+b+-%3E+c%29+-%3E+a+-%3E+b+-%3E+d&amp;env=ghc-7.8-stable-14.09\" rel=\"noreferrer\">fpcomplete's</a> version searches through more packages making it easier to find what I'm looking for.</p>\n"}], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 2, "accepted_answer_id": 28533739, "answer_count": 1, "score": 6, "last_activity_date": 1563856023, "creation_date": 1424045668, "question_id": 28532836, "link": "https://stackoverflow.com/questions/28532836/haskell-for-function-with-multiple-operands", "title": "Haskell (.) for function with multiple operands", "body": "<p>The <code>(.)</code> operator has the signature:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n(.) f g x = f $ g x\n</code></pre>\n\n<p>This looks a bit similar to the <a href=\"http://en.wikipedia.org/wiki/Primitive_recursive_function#Definition\" rel=\"noreferrer\"><em>composition function</em></a> in primitive recursive functions with one <em>g</em>.</p>\n\n<p>I'm not interested in extending the number of <em>g</em>-functions, but (a number of) functions that apply the <code>(.)</code> function on a function <code>g</code> with multiple operands. In other words something like:</p>\n\n<pre><code>(..) :: (c -&gt; d) -&gt; (a -&gt; b -&gt; c) -&gt; a -&gt; b -&gt; d\n(..) f g x y = f $ g x y\n</code></pre>\n\n<p>A search on <a href=\"https://www.haskell.org/hoogle/?hoogle=%28c-%3Ed%29-%3E%28a-%3Eb-%3Ec%29-%3Ea-%3Eb-%3Ed\" rel=\"noreferrer\"><em>Hoogle</em></a> doesn't result in any function. Is there a package that can handle this with an arbitrary number of operands?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1424038610, "post_id": 28531786, "comment_id": 45378629, "body": "As stated, it&#39;s provably impossible. There are no functions <code>Const () Void -&gt; Frank (Const ()) Void</code>, except for non-terminating ones (at least for field <code>second</code>). Concretely, <code>tofu</code> needs a way to generate a <code>b</code> from its inputs, which is currently impossible."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1424041165, "post_id": 28531786, "comment_id": 45379420, "body": "Another observation: assume that you could do this. Then, in the body of <code>Frank</code>&#39;s implementation of <code>tofu</code>, you would take a type-constructed thing <code>a b</code> and somehow pull out just the <code>b</code> part. So imagine if <code>a</code> was a Monad. Then some function used inside of <code>tofu</code> would have to have type <code>a b -&gt; b</code> (where <code>a</code> can be a Monad but doesn&#39;t have to be one). See <a href=\"http://stackoverflow.com/questions/8567743/how-to-extract-value-from-monadic-action\">here for a discussion</a> of why such a function is not generally possible."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1424041199, "post_id": 28531786, "comment_id": 45379428, "body": "While this doesn&#39;t totally rule out the possibility, it would mean that <code>Frank</code> can&#39;t make use of Monad types for &quot;a&quot;, which would be extremely limiting."}], "owner": {"reputation": 13, "user_id": 4569890, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70cf89acabefe1267150565ce69ede7a?s=128&d=identicon&r=PG&f=1", "display_name": "wdeweijer", "link": "https://stackoverflow.com/users/4569890/wdeweijer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1424038296, "creation_date": 1424038296, "question_id": 28531786, "link": "https://stackoverflow.com/questions/28531786/making-an-instance-of-a-weird-class-for-weird-data-in-haskell", "title": "Making an instance of a weird class for weird data in Haskell", "body": "<p>I was working through LYAH and I wanted to extend on the Type-foo chapter. I came up with the following type:</p>\n\n<pre><code>data Frank a b = Frank {first :: a b, second :: b}\n-- Frank :: (* -&gt; *) -&gt; * -&gt; *\n-- Frank :: a b -&gt; b -&gt; Frank a b\n</code></pre>\n\n<p>And I wanted to make  it an instance of the Tofu class:</p>\n\n<pre><code>class Tofu t where          -- Tofu :: ((* -&gt; *) -&gt; * -&gt; *) -&gt; Constraint\n    tofu :: a b -&gt; t a b\n</code></pre>\n\n<p>Can anyone come up with a simple instance?</p>\n"}, {"tags": ["haskell", "dynamic-programming"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 2614530, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46a40968618fe7a31ef34298d5167e57?s=128&d=identicon&r=PG", "display_name": "nslo", "link": "https://stackoverflow.com/users/2614530/nslo"}, "edited": false, "score": 0, "creation_date": 1424062484, "post_id": 28532187, "comment_id": 45383960, "body": "Thank you for the detailed response.  I&#39;m going to need a minute to digest it though."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 4, "last_activity_date": 1424041001, "last_edit_date": 1424041001, "creation_date": 1424040642, "answer_id": 28532187, "question_id": 28531685, "link": "https://stackoverflow.com/questions/28531685/memoize-project-euler-116-in-haskell/28532187#28532187", "title": "Memoize Project Euler 116 in Haskell", "body": "<p><code>f</code> is a very simple function. Assuming <code>fIter</code> is easy to compute, <code>f</code> will also be easy to compute. We don't need to memoize <code>f</code>. Our only goal will be to memoize <code>fIter</code>.</p>\n\n<p>When starting to memoize a recursive function in Haskell, it's useful to write the function in open-recursive form. The open recursive form of a function removes explicit recursion and instead adds an extra argument for what to do when the function needs to call itself recursively. This will give us a way to change how the function recursively calls itself.</p>\n\n<p>We'll change the signature of <code>fIter</code> from the first type to the second type</p>\n\n<pre><code>                      The type of fIter\n                       v\n                       Int -&gt; Int -&gt; Int\n(Int -&gt; Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Int\n ^                     ^\n |                     Gets back something with the type of fIter\n What to do when fIter needs to call itself recursively\n</code></pre>\n\n<p><code>fIter</code> calls itself recursively through <code>f</code>, so we'll first add the <code>(Int -&gt; Int -&gt; Int)</code> argument for how to call <code>fIter</code> to <code>f</code></p>\n\n<pre><code>f' :: (Int -&gt; Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Int\nf' r blocksize spaces\n    | blocksize &gt; spaces = 0\n    | blocksize == spaces = 1\n    | otherwise = 1 + r blocksize (spaces - blocksize)\n</code></pre>\n\n<p>The modified <code>fIter'</code> will pass how to recursively call itself (that it got from the new argument) as the new argument to <code>f'</code>.</p>\n\n<pre><code>fIter' :: (Int -&gt; Int -&gt; Int) -&gt; Int -&gt; Int -&gt; Int\nfIter' r blocksize spaces =\n    sum $ map (f' r blocksize) [1..spaces]\n</code></pre>\n\n<p>We can recover the original slow <code>fIter</code> by fixing it with <code>fix :: (a -&gt; a) -&gt; a</code> defined in <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-Function.html\" rel=\"nofollow\"><code>Data.Function</code></a> as <code>fix f = let x = f x in x</code>.</p>\n\n<pre><code>fIter :: Int -&gt; Int -&gt; Int\nfIter = fix fIter'\n</code></pre>\n\n<p>Now we're in a good place to change how <code>fIter</code> calls itself. Another \"lazy data structure that is filled in as necessary\" is provided in <code>Data.MemoTrie</code> in the <a href=\"https://hackage.haskell.org/package/MemoTrie\" rel=\"nofollow\">MemoTrie</a> package. It provides two functions that are interesting to us. <code>trie :: HasTrie a =&gt; (a -&gt; b) -&gt; a :-&gt;: b</code> builds a lazy data structure built from the supplied function. <code>untrie :: HasTrie a =&gt; (a :-&gt;: b) -&gt; a -&gt; b</code> returns a function that looks up the arguments from the lazy data structure. These only work for certain argument types <code>HasTrie a</code> for which a lazy data structure can be built. Fortunately for our problem there are already instances for <code>HasTrie Int</code> and <code>(HasTrie a, HasTrie b) =&gt; HasTrie (a, b)</code>.</p>\n\n<p><code>trie</code> from <code>Data.MemoTrie</code> only accepts a single argument, so we are going to need to pack the two arguments to <code>fIter</code> up in to a single argument. We'd normally do this with <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:uncurry\" rel=\"nofollow\"><code>uncurry</code></a>, but, since <code>fIter'</code> needs to take something with the same type as its result as an argument, we also need to <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:curry\" rel=\"nofollow\"><code>curry</code></a> the recursive call to unpack the arguments. <code>uncurryOr</code> will uncurry any open recursive function.</p>\n\n<pre><code>uncurryOR :: (( a -&gt; b  -&gt; c) -&gt;  a -&gt; b  -&gt; c) -&gt;\n              ((a,   b) -&gt; c) -&gt; (a,   b) -&gt; c\nuncurryOR or = uncurry . or . curry\n</code></pre>\n\n<p>Applying this to <code>fIter'</code> yields a satisfying result, <code>uncurryOR fIter' :: ((Int, Int) -&gt; Int) -&gt; (Int, Int) -&gt; Int</code>.</p>\n\n<p>To memoize an open recursive function in general, we build a trie for the open recursive function passing in trie lookup as how the function should get its recursive results.</p>\n\n<pre><code>import Data.MemoTrie\n\nmemoOR :: HasTrie a =&gt; ((a -&gt; b) -&gt; a -&gt; b) -&gt;\n                                    a -&gt; b\nmemoOR or = f\n    where\n        f = untrie t\n        t = trie (or f)\n</code></pre>\n\n<p>We can write <code>memoOR</code> more elegantly in terms of <code>fix</code> and <code>memo = untrie . trie</code> from <code>Data.MemoTrie</code>.</p>\n\n<pre><code>memoOR or = fix (memo . or)\n</code></pre>\n\n<p>We can now define how to compute <code>fIter</code> efficiently</p>\n\n<pre><code>fIter :: Int -&gt; Int -&gt; Int\nfIter = curry . memoOR .  uncurryOR $ fIter'\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 2614530, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46a40968618fe7a31ef34298d5167e57?s=128&d=identicon&r=PG", "display_name": "nslo", "link": "https://stackoverflow.com/users/2614530/nslo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1424041001, "creation_date": 1424037658, "question_id": 28531685, "link": "https://stackoverflow.com/questions/28531685/memoize-project-euler-116-in-haskell", "title": "Memoize Project Euler 116 in Haskell", "body": "<p>Below is my first attempt at this problem.  It is basically a transliteration of my C++ solution, minus a global hash table used to memoize the results of function f.  </p>\n\n<pre><code>f :: Int -&gt; Int -&gt; Int\nf blocksize spaces\n    | blocksize &gt; spaces = 0\n    | blocksize == spaces = 1\n    | otherwise = 1 + fIter blocksize (spaces - blocksize)\n\nfIter :: Int -&gt; Int -&gt; Int\nfIter blocksize spaces =\n    sum $ map (f blocksize) [1..spaces]\n\nmain :: IO ()\nmain = do\n    let spaces = 50\n    print $ fIter 2 spaces + fIter 3 spaces + fIter 4 spaces\n</code></pre>\n\n<p>I think I understand the basic idea of creating a lazy data structure that is filled in as necessary, as in <a href=\"https://stackoverflow.com/questions/4976908/how-are-dynamic-programming-algorithms-implemented-in-idiomatic-haskell/4984168\">this type of thing</a>, but what's throwing me here is that there are two mutually-recursive functions that call each other rather than one.  I've tried combining them into one form, as below, but haven't had any luck getting it straight in my head yet.  Any tips?</p>\n\n<pre><code>fIter2 :: Int -&gt; Int -&gt; Int\nfIter2 b s = sum $ map (\\i -&gt; memos ! i) [1..s]\n    where\n        memos = listArray (1, s) (map (f b) [1..s])\n        f blocksize spaces\n          | blocksize &gt; spaces = 0\n          | blocksize == spaces = 1\n          | otherwise = 1 + fIter2 blocksize (spaces - blocksize)\n</code></pre>\n\n<p>(I'm aware that there is a combinatoric solution to this problem, but I'm more interested in getting better at dynamic programming in Haskell right now.)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1424032403, "post_id": 28530759, "comment_id": 45376574, "body": "It&#39;s a function that applies the same <code>a</code> and every from <code>[b]</code> to the function passed as a 2nd argument and produces <code>[c]</code>. So implementation could be just a <code>map</code> of <code>a -&gt; (a -&gt; b -&gt; c) -&gt; b -&gt; c</code> over <code>[b]</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1483, "user_id": 1308994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0c47efb3b6f309f253b6e8bd038076?s=128&d=identicon&r=PG&f=1", "display_name": "cassandracomar", "link": "https://stackoverflow.com/users/1308994/cassandracomar"}, "is_accepted": true, "score": 5, "last_activity_date": 1424033159, "last_edit_date": 1424033159, "creation_date": 1424032728, "answer_id": 28530893, "question_id": 28530759, "link": "https://stackoverflow.com/questions/28530759/haskell-function-given-type-signature-dealing-with-list/28530893#28530893", "title": "haskell function given type signature dealing with list", "body": "<p>This looks a lot like a homework question. If it is, I strongly recommend you try and answer this question for yourself. With that said, I'll walk you through how I would formulate an answer to this question and hopefully give you some insight into how you should approach questions like this.</p>\n\n<p>We know that <code>mapNew</code> has type <code>a -&gt; (a -&gt; b -&gt; c) -&gt; [b] -&gt; [c]</code>. This looks a lot like the existing Prelude function <code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]</code>. So we probably want to write our answer in terms of <code>map</code>.</p>\n\n<pre><code>mapNew :: a -&gt; (a -&gt; b -&gt; c) -&gt; [b] -&gt; [c]\nmapNew a f bs = ...\n</code></pre>\n\n<p>We always start by writing out the function with the arguments it takes so that we can see what pieces we have to work with. Knowing that we only have a single <code>a</code> and need to always pass it to <code>f</code> for each element <code>b</code> in <code>bs</code>, we can add a <code>where</code> clause for this partial application:</p>\n\n<pre><code>mapNew :: a -&gt; (a -&gt; b -&gt; c) -&gt; [b] -&gt; [c]\nmapNew a f bs = ...\n    where fa :: b -&gt; c\n          fa = f a\n</code></pre>\n\n<p>Given this, we can now write our answer in terms of <code>map</code>.</p>\n\n<pre><code>mapNew :: a -&gt; (a -&gt; b -&gt; c) -&gt; [b] -&gt; [c]\nmapNew a f bs = map fa bs\n    where fa :: b -&gt; c\n          fa = f a\n</code></pre>\n\n<p>Most haskell programmers would simplify this definition to:</p>\n\n<pre><code>mapNew :: a -&gt; (a -&gt; b -&gt; c) -&gt; [b] -&gt; [c]\nmapNew a f bs = map (f a) bs\n</code></pre>\n\n<p>since <code>(f a)</code> is exactly the partially applied function <code>fa</code>. Further, we can eta-reduce this expression to:</p>\n\n<pre><code>mapNew :: a -&gt; (a -&gt; b -&gt; c) -&gt; [b] -&gt; [c]\nmapNew a f = map (f a)\n</code></pre>\n\n<p>The crux of this answer is in the statement \"Knowing that we only have a single <code>a</code> and need to always pass it to <code>f</code> for each element <code>b</code> in <code>bs</code>\". How do I know this?</p>\n\n<p>Because of parametric polymorphism we can't inspect any values of type <code>a</code>. This means that the only value of type <code>a</code> we have available to us is the one passed to <code>mapNew</code>. Further, since <code>f</code> takes a single <code>b</code> and produces a single <code>c</code>, we know that we must first get a <code>b</code> out of the provided list in order to apply <code>f</code> to it. This is exactly what <code>map</code> does, and by partially applying <code>f</code> to <code>a</code> we get the first argument we want to pass to <code>map</code>.</p>\n"}], "owner": {"reputation": 7, "user_id": 4569708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73094b620752228095796105118a8d1e?s=128&d=identicon&r=PG&f=1", "display_name": "lee1234567890", "link": "https://stackoverflow.com/users/4569708/lee1234567890"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 28530893, "answer_count": 1, "score": 0, "last_activity_date": 1424033159, "creation_date": 1424031994, "last_edit_date": 1424032361, "question_id": 28530759, "link": "https://stackoverflow.com/questions/28530759/haskell-function-given-type-signature-dealing-with-list", "title": "haskell function given type signature dealing with list", "body": "<pre><code>mapNew :: a -&gt; (a -&gt; b -&gt; c) -&gt; [b] -&gt; [c]\n</code></pre>\n\n<p>Given this type signature, what kind of function should <code>mapNew</code> be?</p>\n\n<p>I know the return type is list. </p>\n"}, {"tags": ["haskell", "typeclass", "monad-transformers"], "comments": [{"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "edited": false, "score": 2, "creation_date": 1424078984, "post_id": 28528727, "comment_id": 45390420, "body": "I haven&#39;t fully understood that topic, but the problem seems to be that different monads have different &quot;lifting&quot; capbilities. The <a href=\"https://hackage.haskell.org/package/layers\" rel=\"nofollow noreferrer\">layers</a> package tries to approach these difficulties, AFAIK."}], "answers": [{"tags": [], "owner": {"reputation": 3128, "user_id": 3040129, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/TcwLC.png?s=128&g=1", "display_name": "illabout", "link": "https://stackoverflow.com/users/3040129/illabout"}, "is_accepted": false, "score": -1, "last_activity_date": 1489679074, "last_edit_date": 1489679074, "creation_date": 1489383666, "answer_id": 42757246, "question_id": 28528727, "link": "https://stackoverflow.com/questions/28528727/providing-typeclass-instance-for-all-monadtrans-instances/42757246#42757246", "title": "Providing typeclass instance for all MonadTrans instances", "body": "<p>Let's say that I've come up with an alternative to <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad-IO-Class.html\" rel=\"nofollow noreferrer\"><code>MonadIO</code></a>, called\n<code>MyMonadIO</code>.  It's like <code>MonadIO</code> in every way, except for the name:</p>\n\n<pre><code>class Monad m =&gt; MyMonadIO m where\n  myLiftIO :: IO a -&gt; m a\n</code></pre>\n\n<p>Assuming your <code>FooT</code> type:</p>\n\n<pre><code>newtype FooT m a = FooT\n  { runFoo :: ReaderT Config (StateT AppState m) a\n  } deriving (Functor, Applicative, Monad, MonadReader Config, MonadState AppState)\n</code></pre>\n\n<p>It's possible to create an instance of <code>MyMonadIO</code> for <a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-Reader.html#t:ReaderT\" rel=\"nofollow noreferrer\"><code>ReaderT</code></a>,\n<a href=\"https://hackage.haskell.org/package/mtl-2.2.1/docs/Control-Monad-State-Lazy.html#t:StateT\" rel=\"nofollow noreferrer\"><code>StateT</code></a>, and finally <code>FooT</code>.  I've added extra type annotations to make it\neasier for the reader to figure out what's going on:</p>\n\n<pre><code>instance MyMonadIO m =&gt; MyMonadIO (ReaderT r m) where\n  myLiftIO :: IO a -&gt; ReaderT r m a\n  myLiftIO = (lift :: m a -&gt; ReaderT r m a) . (myLiftIO :: IO a -&gt; m a)\n\ninstance MyMonadIO m =&gt; MyMonadIO (StateT s m) where\n  myLiftIO :: IO a -&gt; StateT s m a\n  myLiftIO = (lift :: m a -&gt; StateT s m a) . (myLiftIO :: IO a -&gt; m a)\n\ninstance MyMonadIO m =&gt; MyMonadIO (FooT m) where\n  myLiftIO :: IO a -&gt; FooT m a\n  myLiftIO = (lift :: m a -&gt; FooT m a) . (myLiftIO :: IO a -&gt; m a)\n</code></pre>\n\n<p>It's also possbile to use <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#generalised-derived-instances-for-newtypes\" rel=\"nofollow noreferrer\"><code>GeneralizedNewtypeDeriving</code></a> to easily derive\n<code>MyMonadIO</code> for <code>FooT</code> (assuming there are already instances for <code>ReaderT</code> and\n<code>StateT</code>):</p>\n\n<pre><code>newtype FooT m a = FooT\n  { runFoo :: ReaderT Config (StateT AppState m) a\n  } deriving (Functor, Applicative, Monad, MyMonadIO, MonadReader Config, MonadState AppState)\n</code></pre>\n\n<hr>\n\n<p>If you look at the body of the <code>myLiftIO</code> function for the <code>ReaderT</code>, <code>StateT</code>,\nand <code>FooT</code> instances, they are exactly the same: <code>lift . myLiftIO</code>.</p>\n\n<p>Here's a repeat of the question:</p>\n\n<blockquote>\n  <p>Why could the author of each Monad typeclass (i.e. MonadIO, MonadCatchIO,\n  MonadFoo) not define a general instance in terms of MonadTrans, instead of\n  making me implement an instance for each new MonadTrans I come up with?</p>\n</blockquote>\n\n<p>For <code>MyMonadIO</code>, this general instance would be as follows:</p>\n\n<pre><code>instance (Monad (t n), MyMonadIO n, MonadTrans t) =&gt; MyMonadIO (t n) where\n  myLiftIO :: IO a -&gt; t n a\n  myLiftIO = (lift :: n a -&gt; t n a) . (myLiftIO :: IO a -&gt; n a)\n</code></pre>\n\n<p>With this instance defined, you don't need a specific instance for <code>ReaderT</code>,\n<code>StateT</code>, or even <code>FooT</code>.</p>\n\n<p>This requires <code>UndecidableInstances</code>.  However, the problem with this is not undecidability, but that this instance overlaps some potentially valid instances of <code>MyMonadIO</code>.</p>\n\n<p>For instance, imagine the following datatype:</p>\n\n<pre><code>newtype FreeIO f a = FreeIO (IO (Either a (f (FreeIO f a))))\n\ninstance Functor f =&gt; Functor (FreeIO f) where\n  fmap :: (a -&gt; b) -&gt; FreeIO f a -&gt; FreeIO f b\n  fmap f (FreeIO io) = FreeIO $ do\n    eitherA &lt;- io\n    pure $\n      case eitherA of\n        Left a -&gt; Left $ f a\n        Right fFreeIO -&gt; Right $ fmap f &lt;$&gt; fFreeIO\n\ninstance Functor f =&gt; Applicative (FreeIO f) where\n  pure :: a -&gt; FreeIO f a\n  pure a = FreeIO . pure $ Left a\n\n  (&lt;*&gt;) :: FreeIO f (a -&gt; b) -&gt; FreeIO f a -&gt; FreeIO f b\n  (&lt;*&gt;) (FreeIO ioA2b) (FreeIO ioA) = FreeIO $ do\n    eitherFa2b &lt;- ioA2b\n    eitherFa &lt;- ioA\n    pure $\n      case (eitherFa2b, eitherFa) of\n        (Left a2b, Left a) -&gt; Left $ a2b a\n        (Left a2b, Right fFreeIOa) -&gt; Right $ fmap a2b &lt;$&gt; fFreeIOa\n        (Right fFreeIOa2b, o) -&gt; Right $ (&lt;*&gt; FreeIO (pure o)) &lt;$&gt; fFreeIOa2b\n\ninstance Functor f =&gt; Monad (FreeIO f) where\n  (&gt;&gt;=) :: FreeIO f a -&gt; (a -&gt; FreeIO f b) -&gt; FreeIO f b\n  (&gt;&gt;=) (FreeIO ioA) mA2b = FreeIO $ do\n    eitherFa &lt;- ioA\n    case eitherFa of\n      Left a -&gt;\n        let (FreeIO ioB) = mA2b a\n        in ioB\n      Right fFreeIOa -&gt; pure . Right $ fmap (&gt;&gt;= mA2b) fFreeIOa\n</code></pre>\n\n<p>You don't necessarily need to understand this <code>FreeIO</code> datatype (especially the <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> instances).  It's enough just to know that this is a valid data type.</p>\n\n<p>(If you're interested, this is just a <a href=\"https://hackage.haskell.org/package/free-4.12.4/docs/Control-Monad-Free.html\" rel=\"nofollow noreferrer\">free monad</a> wrapped around <code>IO</code>.)</p>\n\n<p>It's possible to write a <code>MyMonadIO</code> instance for <code>FreeIO</code>:</p>\n\n<pre><code>instance Functor f =&gt; MyMonadIO (FreeIO f) where\n  myLiftIO :: IO a -&gt; FreeIO f a\n  myLiftIO ioA = FreeIO (Left &lt;$&gt; ioA)\n</code></pre>\n\n<p>We can even imagine writing a function using <code>FreeIO</code>:</p>\n\n<pre><code>tryMyLiftIOWithFreeIO :: Functor f =&gt; FreeIO f ()\ntryMyLiftIOWithFreeIO = myLiftIO $ print \"hello\"\n</code></pre>\n\n<p>If you try to compile <code>tryMyLiftIOWithFreeIO</code> with both this instance (<code>MyMonadIO (FreeIO f)</code>) and the bad instance from above, you get the following error:</p>\n\n<pre><code>test-monad-trans.hs:103:25: error:\n    \u2022 Overlapping instances for MyMonadIO (FreeIO f)\n        arising from a use of \u2018myLiftIO\u2019\n      Matching instances:\n        instance (Monad (t n), MyMonadIO n, MonadTrans t) =&gt; MyMonadIO (t n)\n          -- Defined at test-monad-trans.hs:52:10\n        instance Functor f =&gt; MyMonadIO (FreeIO f)\n          -- Defined at test-monad-trans.hs:98:10\n    \u2022 In the expression: myLiftIO $ print \"hello\"\n      In an equation for \u2018tryMyLiftIOWithFreeIO\u2019:\n          tryMyLiftIOWithFreeIO = myLiftIO $ print \"hello\"\n</code></pre>\n\n<p>Why does this happen?</p>\n\n<p>Well, in <code>instance (Monad (t n), MyMonadIO n, MonadTrans t) =&gt; MyMonadIO (t n)</code>, what is the kind of <code>t</code> and <code>n</code>?</p>\n\n<p>Since <code>n</code> is supposed to be a <code>Monad</code>, it's kind is <code>* -&gt; *</code>.  And since <code>t</code> is a monad transformer, it's kind is <code>(* -&gt; *) -&gt; * -&gt; *</code>.  <code>t n</code> is also supposed to be a <code>Monad</code>, so it's kind is also <code>* -&gt; *</code>:</p>\n\n<pre><code>n :: * -&gt; *\nt :: (* -&gt; *) -&gt; * -&gt; *\nt n :: * -&gt; *\n</code></pre>\n\n<p>Now, in <code>instance Functor f =&gt; MyMonadIO (FreeIO f)</code>, what are the kinds of <code>FreeIO</code> and <code>f</code>?</p>\n\n<p><code>f</code> is supposed to be a <code>Functor</code>, so it's kind is <code>* -&gt; *</code>.  <code>FreeIO</code>'s kind is <code>(* -&gt; *) -&gt; * -&gt; *</code>.  <code>FreeIO f</code> is a <code>Monad</code>, so it's kind is <code>* -&gt; *</code>:</p>\n\n<pre><code>f :: * -&gt; *\nFreeIO :: (* -&gt; *) -&gt; * -&gt; *\nFreeIO f :: * -&gt; *\n</code></pre>\n\n<p>Since the kinds are the same, you an see that <code>instance Functor f =&gt; MyMonadIO (FreeIO f)</code> overlaps with <code>instance (Monad (t n), MyMonadIO n, MonadTrans t) =&gt; MyMonadIO (t n)</code>.  GHC isn't sure which one to pick!</p>\n\n<p>You can get around this by marking your instance <code>FreeIO</code> instance as <code>OVERLAPPING</code>:</p>\n\n<pre><code>instance {-# OVERLAPPING #-} Functor f =&gt; MyMonadIO (FreeIO f) where\n  myLiftIO :: IO a -&gt; FreeIO f a\n  myLiftIO m = FreeIO (Left &lt;$&gt; m)\n</code></pre>\n\n<p>However, this is a treacherous route to go down.  You can find out more about why overlapping can be bad from the <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#instance-overlap\" rel=\"nofollow noreferrer\">GHC user guide</a>.</p>\n\n<p>This <code>FreeIO</code> example was created by Edward Kmett.  You can find another clever example of an overlapping instance in <a href=\"https://www.reddit.com/r/haskell/comments/5zjwym/when_is_undecidableinstances_okay_to_use/deynhlx/?utm_content=permalink&amp;utm_medium=front&amp;utm_source=reddit&amp;utm_name=haskell\" rel=\"nofollow noreferrer\">this reddit post</a>.</p>\n\n<hr>\n\n<p>If you are planning on writing a monad typeclass (like <code>MyMonadIO</code>) and\nreleasing it to Hackage, one option is to use the\n<a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#default-method-signatures\" rel=\"nofollow noreferrer\"><code>DefaultSignatures</code></a>\nfunctionality. This makes it easier for users of your library to define\ninstances.</p>\n\n<p>Using <code>DefaultSignatures</code>, defining the <code>MyMonadIO</code> class would look like this:</p>\n\n<pre><code>class Monad m =&gt; MyMonadIO m where\n  myLiftIO :: IO a -&gt; m a\n  default myLiftIO\n    :: forall t n a.\n       ( MyMonadIO n\n       , MonadTrans t\n       , m ~ t n\n       )\n    =&gt; IO a -&gt; t n a\n  myLiftIO = (lift :: n a -&gt; t n a) . (myLiftIO :: IO a -&gt; n a)\n</code></pre>\n\n<p>This says that there is a default implementation of <code>myLiftIO</code> for any <code>t n</code>,\nwhere <code>n</code> is an instance of <code>MyMonadIO</code>, and <code>t</code> is an instance of\n<code>MonadTrans</code>.</p>\n\n<p>With this default siguature for <code>myLiftIO</code>, defining instances of <code>MyMonadIO</code> for <code>ReaderT</code> and <code>StateT</code> would look like this:</p>\n\n<pre><code>instance MyMonadIO m =&gt; MyMonadIO (ReaderT r m)\ninstance MyMonadIO m =&gt; MyMonadIO (StateT s m)\n</code></pre>\n\n<p>Very simple.  You don't need to provide the function body of <code>myLiftIO</code> since\nit will use the default.</p>\n\n<p>The only drawback of this is that it is not widely done.  The\n<code>DefaultSignatures</code> machinery seems to be mainly used for <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#generic-programming\" rel=\"nofollow noreferrer\">generic\nprogramming</a>, not monad typeclasses.</p>\n"}], "owner": {"reputation": 1523, "user_id": 1392706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7df9602eeba7af579f708179876600c3?s=128&d=identicon&r=PG", "display_name": "BluePeppers", "link": "https://stackoverflow.com/users/1392706/bluepeppers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 695, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1489679074, "creation_date": 1424020400, "question_id": 28528727, "link": "https://stackoverflow.com/questions/28528727/providing-typeclass-instance-for-all-monadtrans-instances", "title": "Providing typeclass instance for all MonadTrans instances", "body": "<p>I've defined my own monad transformer:</p>\n\n<pre><code>data Config = Config { ... }\n\ndata State = State { ... }\n\nnewtype FooT m a = FooT {\n      runFoo :: ReaderT Config (StateT State m) a\n    } deriving (Functor, Monad, MonadReader Config, MonadState State)\n</code></pre>\n\n<p>And I've defined a <code>MonadTrans</code> instance for it.</p>\n\n<pre><code>instance MonadTrans FooT where\n   lift = FooT . lift . lift\n</code></pre>\n\n<p>Now, I have various monads that I can't just have be derived for me by the compiler. I'll take <code>MonadIO</code> as the example. So I've defined my <code>MonadIO</code> instance as</p>\n\n<pre><code>instance MonadIO m =&gt; MonadIO (FooT m) where\n    liftIO = lift . liftIO\n</code></pre>\n\n<p>However, I find that I'm doing a lot of lifting, for each Monad. Why could the author of each Monad typeclass (i.e. MonadIO, MonadCatchIO, MonadFoo) not define a general instance in terms of MonadTrans, instead of making me implement an instance for each new MonadTrans I come up with? a la</p>\n\n<pre><code>instance (MonadIO m, MonadTrans t, Monad (t m)) =&gt; MonadIO (t m) where\n  liftIO = lift . liftIO\n</code></pre>\n\n<p>That requires <code>UndecidableInstances</code> to compile, and I'm not certain that it's correct (in fact, pretty sure it's incorrect), but serves to express my intent for now.</p>\n\n<p>So, is this possible? If not, why not? Will it ever be?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 876, "user_id": 4537511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbb4bbc2836b3dcb6564ce5f4b3f4f2c?s=128&d=identicon&r=PG", "display_name": "Adam Sosnowski", "link": "https://stackoverflow.com/users/4537511/adam-sosnowski"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1424021553, "post_id": 28528694, "comment_id": 45373049, "body": "Ole already stated that he got base case solved. Question was about general case."}], "tags": [], "owner": {"reputation": 876, "user_id": 4537511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbb4bbc2836b3dcb6564ce5f4b3f4f2c?s=128&d=identicon&r=PG", "display_name": "Adam Sosnowski", "link": "https://stackoverflow.com/users/4537511/adam-sosnowski"}, "is_accepted": false, "score": 2, "last_activity_date": 1424020206, "creation_date": 1424020206, "answer_id": 28528694, "question_id": 28528420, "link": "https://stackoverflow.com/questions/28528420/haskell-create-an-n-ary-tuple-from-given-input/28528694#28528694", "title": "Haskell create an n-ary tuple from given input", "body": "<p>First: <code>[]</code> is a list constructor, not a tuple.  I don't know any general way to build n-ary tuple.</p>\n\n<p>However, sticking to lists, if you have <code>n = 1</code> case solved and <code>n = 2</code> case solved try to express the latter in term of the former.  Then generalize to any <code>n</code> in terms of <code>n-1</code>:</p>\n\n<pre><code>com n xs = concat [map (x:) (com (n-1) xs) | x &lt;- xs ]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 2, "creation_date": 1424025146, "post_id": 28528762, "comment_id": 45374281, "body": "I think it&#39;s more logical to have <code>com 0 _ = [[]]</code>, then you don&#39;t need the 1 case."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1424030982, "post_id": 28528762, "comment_id": 45376109, "body": "I&#39;m indifferent. I interpret <code>com 0 _</code> as basically a no-op, so nothing should have to be checked about what it returns to see that it was a no-op. If it returns <code>[[]]</code> you have to write a lot of code downstream to handle that unusual case. I could see it going either way. I&#39;d rather write one extra line in this case, and have a bang-simple pattern match for the no-op everywhere else downstream, than to squeeze one measly line out of this for possibly the cost of dealing with <code>[[]]</code> in lots of other places."}], "tags": [], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "is_accepted": false, "score": 1, "last_activity_date": 1424020578, "creation_date": 1424020578, "answer_id": 28528762, "question_id": 28528420, "link": "https://stackoverflow.com/questions/28528420/haskell-create-an-n-ary-tuple-from-given-input/28528762#28528762", "title": "Haskell create an n-ary tuple from given input", "body": "<p>A more verbose way to write it, but potentially more helpful when trying to understand <code>List</code> non-determinism and trying to understand exactly what the Haskell comprehension syntactic sugar really means, is to write with <code>do</code> notation:</p>\n\n<pre><code>com :: Int -&gt; [a] -&gt; [[a]]\ncom 0 _  = []\ncom 1 xs = [[x] | x &lt;- xs]\ncom n xs = do\n    x &lt;- xs\n    let ys = com (n - 1) xs\n    map (x:) ys\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1424032049, "post_id": 28529639, "comment_id": 45376472, "body": "<code>replicateM n = sequence . replicate n</code>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1424032600, "last_edit_date": 1424032600, "creation_date": 1424025433, "answer_id": 28529639, "question_id": 28528420, "link": "https://stackoverflow.com/questions/28528420/haskell-create-an-n-ary-tuple-from-given-input/28529639#28529639", "title": "Haskell create an n-ary tuple from given input", "body": "<p>Is this what you want?</p>\n\n<pre><code>&gt; sequence (replicate 3 \"abc\")\n[\"aaa\",\"aab\",\"aac\",\"aba\",\"abb\",\"abc\",\"aca\",\"acb\",\"acc\"\n,\"baa\",\"bab\",\"bac\",\"bba\",\"bbb\",\"bbc\",\"bca\",\"bcb\",\"bcc\"\n,\"caa\",\"cab\",\"cac\",\"cba\",\"cbb\",\"cbc\",\"cca\",\"ccb\",\"ccc\"]\n</code></pre>\n\n<p>The above exploits the fact that <code>sequence</code>, in the list monad, builds the cartesian product of a list of lists. So, we can simply replicate our list <code>n</code> times, and then take the product.</p>\n\n<p>(Note that <code>\"abc\"</code> above is a shorthand for the list of charatcters <code>['a','b','c']</code>)</p>\n\n<p>So, a solution could be</p>\n\n<pre><code>com n xs = sequence (replicate n xs)\n</code></pre>\n\n<p>or equivalently, as Daniel Wagner points out below,</p>\n\n<pre><code>com = replicateM\n</code></pre>\n\n<p>A final note: I do realize that this is probably not very helpful for actually <em>learning</em> how to program. Indeed, I pulled two \"magic\" functions from the library which solved the task. Still, it shows how the problem can be reduced to two subproblems: 1) replicating a value <code>n</code> times and 2) building a cartesian product. The second task is a nice exercise on its own, if you don't want to use the library. You may wish to solve that starting from:</p>\n\n<pre><code>sequence :: [[a]] -&gt; [[a]]\nsequence []     = [[]]\nsequence (x:xs) = ...\n       where ys = sequence xs\n</code></pre>\n"}], "owner": {"reputation": 401, "user_id": 1659642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/944d6766d5e4d06d9089163277ffad1c?s=128&d=identicon&r=PG", "display_name": "Ole-Morten Heggertveit", "link": "https://stackoverflow.com/users/1659642/ole-morten-heggertveit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 28529639, "answer_count": 3, "score": 3, "last_activity_date": 1424032600, "creation_date": 1424018601, "last_edit_date": 1424025909, "question_id": 28528420, "link": "https://stackoverflow.com/questions/28528420/haskell-create-an-n-ary-tuple-from-given-input", "title": "Haskell create an n-ary tuple from given input", "body": "<p>To put it straigth, I'm fairly new to Haskell and trying to solve a problem (programming exercise) I came over. Where it says I should create a function </p>\n\n<pre><code>com :: Int -&gt; [t] -&gt; [[t]]\n</code></pre>\n\n<p>that returns all possible choices of n elements, where n and list are the first and second arguments, respectively. Elements can be picked over again and in a different order. A result would be like:</p>\n\n<pre><code>com 2 [1,2,3] = [[1,1], [1,2]..[3,3]]\n</code></pre>\n\n<p>For the cases n = 1 and n = 2, I manage to solve the cases. The case  n = 1 is quite simple, and, for the case n = 2, I would use concatenation and build it up. However, I don't understand how it can be made n-ary and work for all n. Like if suddenly a function call would be like <code>com 10</code> ... </p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 16507, "user_id": 183828, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/83cb856db56bab131c9d21134c632c42?s=128&d=identicon&r=PG", "display_name": "Yin Zhu", "link": "https://stackoverflow.com/users/183828/yin-zhu"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1424010333, "post_id": 28526890, "comment_id": 45369674, "body": "@Sibi the answer in the above question is far from satisfactory. Implementing the typeclass in the original paper is easy. The hard part lies in the &quot;Higher-kinded polymorphism&quot;, type classes such as Monads. But I am no expert in programming, so I am asking this question."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 4, "creation_date": 1424047979, "post_id": 28526890, "comment_id": 45380961, "body": "There is no real extra complication in adding higher kinds.  It&#39;s a simple matter of changing the type checker a little."}, {"owner": {"reputation": 4738, "user_id": 917635, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2365756407af40c28c05d4d30182dbac?s=128&d=identicon&r=PG", "display_name": "artella", "link": "https://stackoverflow.com/users/917635/artella"}, "edited": false, "score": 1, "creation_date": 1429426760, "post_id": 28526890, "comment_id": 47587464, "body": "@YinZhu You might also be interested in the following posts (Edward Yang mentions some of the disadvantages of typeclasses) : <a href=\"http://blog.ezyang.com/2014/07/type-classes-confluence-coherence-global-uniqueness/\" rel=\"nofollow noreferrer\">blog.ezyang.com/2014/07/&hellip;</a> and <a href=\"http://blog.ezyang.com/2014/09/open-type-families-are-not-modular/\" rel=\"nofollow noreferrer\">blog.ezyang.com/2014/09/open-type-families-are-not-modular</a>"}, {"owner": {"reputation": 4738, "user_id": 917635, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2365756407af40c28c05d4d30182dbac?s=128&d=identicon&r=PG", "display_name": "artella", "link": "https://stackoverflow.com/users/917635/artella"}, "edited": false, "score": 0, "creation_date": 1429792032, "post_id": 28526890, "comment_id": 47773021, "body": "@YinZhu Also if you are interested in Edward&#39;s exciting work on backpack (which he mentions in the link above) you can have a look at <a href=\"http://web.mit.edu/~ezyang/Public/backpack-manual.pdf\" rel=\"nofollow noreferrer\">web.mit.edu/~ezyang/Public/backpack-manual.pdf</a>"}], "owner": {"reputation": 16507, "user_id": 183828, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/83cb856db56bab131c9d21134c632c42?s=128&d=identicon&r=PG", "display_name": "Yin Zhu", "link": "https://stackoverflow.com/users/183828/yin-zhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 136, "favorite_count": 1, "closed_date": 1431156285, "answer_count": 0, "score": 4, "last_activity_date": 1424009226, "creation_date": 1424009226, "question_id": 28526890, "link": "https://stackoverflow.com/questions/28526890/about-the-implementation-of-haskells-type-classes", "closed_reason": "Duplicate", "title": "About the implementation of Haskell&#39;s type classes", "body": "<p>In several of Simon Peyton Jones's presentations, there is a page which shows the history of Type Classes: </p>\n\n<p><img src=\"https://i.stack.imgur.com/rRK3N.png\" alt=\"enter image description here\"></p>\n\n<p>There are quite a lot of materials to understand type classes from a programmer's view, such as the typeclassopedia article and many other tutorials. However its implementation and overhead are seldom described. </p>\n\n<p>I am wondering what were the problems during the implementations and their solutions (I think there should be academic publications for the solutions). </p>\n\n<p>In other words, I am searching materials like <em>Inside the C++ Object Model</em>, but for the Haskell language. </p>\n"}, {"tags": ["haskell", "pattern-guards"], "answers": [{"comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1424008983, "post_id": 28526839, "comment_id": 45369331, "body": "If you see the second fragment of code, the OP wants do something like this also: <code>mod gd 7 == 1</code> in the first check."}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 0, "creation_date": 1424009222, "post_id": 28526839, "comment_id": 45369383, "body": "As Sibi observed, i need to test multiple conditions, even complex, and &quot;case&quot; will not allow it."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 3, "creation_date": 1424010110, "post_id": 28526839, "comment_id": 45369607, "body": "@AlbertoCapitani, <code>case</code> <i>will</i> allow it! <code>case () of _ | c1 -&gt; r1</code>, etc."}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 0, "creation_date": 1424010379, "post_id": 28526839, "comment_id": 45369687, "body": "@Jeffrey One small objection to the solution that you recommend. In this way i have to &quot;invent&quot; a name for every possible case, instead of specifying only the logical conditions. Making a comparison with the functions, i would like something similar to the lambda calculus (so I prefer the MultiWayIf solution)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1424014851, "post_id": 28526839, "comment_id": 45370959, "body": "Keep in mind that this solution is <i>not</i> always equivalent to the original code: if there&#39;s no match for the inner case/if, then the next branch in the outer case will not be tried. Of course, in the posted code the outer case has non-overlapping guards, so this is fine."}], "tags": [], "owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "is_accepted": false, "score": 7, "last_activity_date": 1424009446, "last_edit_date": 1424009446, "creation_date": 1424008843, "answer_id": 28526839, "question_id": 28526768, "link": "https://stackoverflow.com/questions/28526768/is-there-in-haskell-something-similar-to-sub-guards/28526839#28526839", "title": "Is there, in Haskell, something similar to sub-guards?", "body": "<p>I'd recommend to group each nested condition in a function:</p>\n\n<pre><code>interval :: _ -&gt; _ -&gt; (String, String)\ninterval pt1 pt2\n    | gd == 0 = doSomethingA pt1 pt2\n    | gd == 1 = doSomethingB pt1 pt2\n    | gd == 2 = doSomethingC pt1 pt2\n    ...\n</code></pre>\n\n<p>and then, for example:</p>\n\n<pre><code>doSomethingA :: _ -&gt; _ -&gt; (String, String)\ndoSomethingA pt1 pt2\n    | sd &lt;  (-2) = (\"unison\",show (abs sd) ++ \"d\") \n    | sd == (-2) = (\"unison\",\"dd\")\n    | sd == (-1) = (\"unison\",\"d\")\n    | sd == 0    = (\"unison\",\"P\")\n    | sd == 1    = (\"unison\",\"A\")\n    | sd == 2    = (\"unison\",\"AA\")\n    | sd &gt;  2    = (\"unison\",show sd ++ \"A\")\n    where sd = displacementInSemitonesOfPitches pt1 pt2  \n</code></pre>\n\n<hr>\n\n<p>Alternatively you can use the <a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/guide-to-ghc-extensions/basic-syntax-extensions#multiwayif\"><code>MultiWayIf</code></a> language extension:</p>\n\n<pre><code>interval pt1 pt2 =\n    if | gd == 0 -&gt; if | sd &lt;  (-2) -&gt; (\"unison\",show (abs sd) ++ \"d\") \n                       | sd == (-2) -&gt; (\"unison\",\"dd\")\n                       | sd == (-1) -&gt; (\"unison\",\"d\")\n                       ...\n       | gd == 1 -&gt; if | sd &lt;  (-1) -&gt; (\"second\",show (abs sd) ++ \"d\")\n                       | sd == (-1) -&gt; (\"second\",\"dd\")\n                       | sd == 0    -&gt; (\"second\",\"d\")\n                       ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1424027293, "post_id": 28529498, "comment_id": 45374928, "body": "This seems a bit like cheating, because the only reason you don&#39;t get a warning is that <code>fromJust</code> has an error branch that you promise not to take."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1424027907, "post_id": 28529498, "comment_id": 45375128, "body": "What I&#39;m thinking is that maybe a continuation monad or some such could be used to hide the ugliness of explicit join points."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1424030120, "post_id": 28529498, "comment_id": 45375828, "body": "@dfeuer I agree on the use of <code>fromJust</code> being ugly. OTOH, we are encoding multiway case, which is inherently partial. If we could assume the final case it&#39;s a catch-all one (<code>otherwise</code>), then we could use <code>maybe</code> instead of <code>fromJust</code>, so that we do not involve partial functions."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1424027223, "last_edit_date": 1424027223, "creation_date": 1424024701, "answer_id": 28529498, "question_id": 28526768, "link": "https://stackoverflow.com/questions/28526768/is-there-in-haskell-something-similar-to-sub-guards/28529498#28529498", "title": "Is there, in Haskell, something similar to sub-guards?", "body": "<p>Let me use a shorter example than the posted one:</p>\n\n<pre><code>original :: Int -&gt; Int\noriginal n\n  | n &lt; 10 &amp;&amp; n &gt; 7 = 1   -- matches 8,9\n  | n &lt; 12 &amp;&amp; n &gt; 5 = 2   -- matches 6,7,10,11\n  | n &lt; 12 &amp;&amp; n &gt; 3 = 3   -- matches 4,5\n  | n &lt; 13 &amp;&amp; n &gt; 0 = 4   -- matches 1,2,3,12\n</code></pre>\n\n<p>The code runs in GHCi as follows:</p>\n\n<pre><code>&gt; map original [1..12]\n[4,4,4,3,3,2,2,1,1,2,2,4]\n</code></pre>\n\n<p>Our aim is to \"group\" together the two branches requiring with <code>n &lt; 12</code>, factoring this condition out. (This is not a huge gain in the <code>original</code> toy example, but it could be in more complex cases.)</p>\n\n<p>We could naively think of splitting the code in two nested cases:</p>\n\n<pre><code>wrong1 :: Int -&gt; Int\nwrong1 n = case () of \n  _ | n &lt; 10 &amp;&amp; n &gt; 7 -&gt; 1\n    | n &lt; 12 -&gt; case () of\n                _ | n &gt; 5 -&gt; 2\n                  | n &gt; 3 -&gt; 3\n    | n &lt; 13 &amp;&amp; n &gt; 0 -&gt; 4\n</code></pre>\n\n<p>Or, equivalently, using the <code>MultiWayIf</code> extension:</p>\n\n<pre><code>wrong2 :: Int -&gt; Int\nwrong2 n = if \n  | n &lt; 10 &amp;&amp; n &gt; 7 -&gt; 1\n  | n &lt; 12 -&gt; if | n &gt; 5 -&gt; 2\n                 | n &gt; 3 -&gt; 3\n  | n &lt; 13 &amp;&amp; n &gt; 0 -&gt; 4\n</code></pre>\n\n<p>This however, leads to surprises:</p>\n\n<pre><code>&gt; map wrong1 [1..12]\n*** Exception: Non-exhaustive patterns in case\n\n&gt; map wrong2 [1..12]\n*** Exception: Non-exhaustive guards in multi-way if\n</code></pre>\n\n<p>The issue is that when <code>n</code> is <code>1</code>, the <code>n &lt; 12</code> branch is taken, the inner case is evaluated, and then no branch there considers <code>1</code>. The <code>original</code> code simply tries the next branch, which handles it. However, <code>wrong1,wrong2</code> are not backtracking to the outer case.</p>\n\n<p>Please note that this is not a problem when you know that the outer case has non-overlapping conditions. In the code posted by the OP, this seems to be the case, so the <code>wrong1,wrong2</code> approaches would work there (as shown by Jefffrey).</p>\n\n<p>However, what about the general case, where there might be overlaps? Fortunately, Haskell is lazy, so it's easy to roll our own control structures. For this, we can exploit the <code>Maybe</code> monad as follows:</p>\n\n<pre><code>correct :: Int -&gt; Int\ncorrect n = fromJust $ msum \n   [ guard (n &lt; 10 &amp;&amp; n &gt; 7) &gt;&gt; return 1\n   , guard (n &lt; 12)          &gt;&gt; msum\n      [ guard (n &gt; 5) &gt;&gt; return 2\n      , guard (n &gt; 3) &gt;&gt; return 3 ]\n   , guard (n &lt; 13 &amp;&amp; n &gt; 0) &gt;&gt; return 4 ]\n</code></pre>\n\n<p>It <em>is</em> a bit more verbose, but not by much. Writing code in this style is easier than it might look: a simple multiway conditional is written as</p>\n\n<pre><code>foo n = fromJust $ msum \n   [ guard boolean1 &gt;&gt; return value1\n   , guard boolean2 &gt;&gt; return value2\n   , ...\n   ]\n</code></pre>\n\n<p>and, if you want a \"nested\" case, just replace any of the <code>return value</code> with a <code>msum [ ... ]</code>.</p>\n\n<p>Doing this ensures that we get the wanted backtracking. Indeed:</p>\n\n<pre><code>&gt; map correct [1..12]\n[4,4,4,3,3,2,2,1,1,2,2,4]\n</code></pre>\n\n<p>The trick here is that when a <code>guard</code> fails, it generates a <code>Nothing</code> value. The library function <code>msum</code> simply selects the first non-<code>Nothing</code> value in the list. So, even if every element in the inner list is <code>Nothing</code>, the outer <code>msum</code> will consider the next item in the outer list -- backtracking, as wanted.</p>\n"}, {"comments": [{"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "edited": false, "score": 0, "creation_date": 1424120861, "post_id": 28539704, "comment_id": 45413753, "body": "Thank you for you detailed and valuable suggestion. My work on the intervals was at an early stage, designed for easy portability in the Logo language, I have so far used with my students (11-14 years old), as they are available music functions Tone (Hz) and Sound [Hz ms Hz ms ...] For this reason I used strings. That said, since I have encountered the problem of sub-guards at other times, I took the opportunity to show concretely the need for such a structure or something similar."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1424083788, "creation_date": 1424083788, "answer_id": 28539704, "question_id": 28526768, "link": "https://stackoverflow.com/questions/28526768/is-there-in-haskell-something-similar-to-sub-guards/28539704#28539704", "title": "Is there, in Haskell, something similar to sub-guards?", "body": "<p><em>This isn't really an answer to the title question, but adresses your particular application. Similar approaches will work for many other problems where you might wish for such sub-guards.</em></p>\n\n<p>First I'd recommend you start out less &ldquo;stringly typed&rdquo;:</p>\n\n<pre><code>interval' :: PitchSpec -&gt; PitchSpec -&gt; Interval\n\ndata Interval = Unison PureQuality\n              | Second IntvQuality\n              | Third IntvQuality\n              | Fourth PureQuality\n              | ...\n\ndata IntvQuality = Major | Minor | OtherQual IntvDistortion\ntype PureQuality = Maybe IntvDistortion\ndata IntvDistortion = Augm Int | Dimin Int   -- should actually be Nat rather than Int\n</code></pre>\n\n<p>And regardless of that, your particular task can be done much more elegantly by &ldquo;computing&rdquo; the values, rather than comparing with a bunch of\nhard-coded cases. Basically, what you need is this:</p>\n\n<pre><code>type RDegDiatonic = Int\ntype RDeg12edo = Rational  -- we need quarter-tones for neutral thirds etc., which aren't in 12-edo tuning\n\ncourseInterval :: RDegDiatonic -&gt; (Interval, RDeg12edo)\ncourseInterval 0 = ( Unison undefined, 0   )\ncourseInterval 1 = ( Second undefined, 1.5 )\ncourseInterval 2 = ( Third undefined,  3.5 )\ncourseInterval 3 = ( Fourth undefined, 5   )\n...\n</code></pre>\n\n<p>You can then &ldquo;fill in&rdquo; those undefined interval qualities by comparing the 12edo-size with the one you've given, using<sup>1</sup></p>\n\n<pre><code>class IntervalQuality q where\n  qualityFrom12edoDiff :: RDeg12edo -&gt; q\n\ninstance IntervalQuality PureQuality where\n  qualityFrom12edoDiff n = case round n of\n         0 -&gt; Nothing\n         n' | n'&gt;0       -&gt; Augm n\n            | otherwise  -&gt; Dimin n'\ninstance IntervalQuality IntvQuality where\n  qualityFrom12edoDiff n | n &gt; 1      = OtherQual . Augm $ floor n\n                         | n &lt; -1     = OtherQual . Dimin $ ceil n\n                         | n &gt; 0      = Major\n                         | otherwise  = Minor\n</code></pre>\n\n<p>With that, you can implement your function thus:</p>\n\n<pre><code>interval pt1 pt2 = case gd of\n       0 -&gt; Unison . qualityFrom12edoDiff $ sd - 0\n       1 -&gt; Second . qualityFrom12edoDiff $ sd - 1.5\n       2 -&gt; Third  . qualityFrom12edoDiff $ sd - 3.5\n       3 -&gt; Fourth . qualityFrom12edoDiff $ sd - 5\n       ...\n</code></pre>\n\n<p><hr>\n<sup>1</sup><sub>You don't <em>really</em> need a type class here, I could as well have defined two diffently-named functions for pure and other intervals.</sub></p>\n"}], "owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 872, "favorite_count": 2, "accepted_answer_id": 28529498, "answer_count": 3, "score": 13, "last_activity_date": 1424083788, "creation_date": 1424008328, "last_edit_date": 1424049088, "question_id": 28526768, "link": "https://stackoverflow.com/questions/28526768/is-there-in-haskell-something-similar-to-sub-guards", "title": "Is there, in Haskell, something similar to sub-guards?", "body": "<p>I'm writing a program on the classification of musical intervals. The conceptual structure is quite complicated and I would represent it as clearly as possible. The first few lines of code are a small extract that works properly. The second are the pseudo-code that would meet my needs of conciseness.</p>\n\n<pre><code>interval pt1 pt2\n  | gd == 0 &amp;&amp; sd &lt;  (-2) = (\"unison\",show (abs sd) ++ \"d\") \n  | gd == 0 &amp;&amp; sd == (-2) = (\"unison\",\"dd\")\n  | gd == 0 &amp;&amp; sd == (-1) = (\"unison\",\"d\")\n  | gd == 0 &amp;&amp; sd == 0    = (\"unison\",\"P\")\n  | gd == 0 &amp;&amp; sd == 1    = (\"unison\",\"A\")\n  | gd == 0 &amp;&amp; sd == 2    = (\"unison\",\"AA\")\n  | gd == 0 &amp;&amp; sd &gt;  2    = (\"unison\",show sd ++ \"A\")\n\n  | gd == 1 &amp;&amp; sd &lt;  (-1) = (\"second\",show (abs sd) ++ \"d\")\n  | gd == 1 &amp;&amp; sd == (-1) = (\"second\",\"dd\")\n  | gd == 1 &amp;&amp; sd == 0    = (\"second\",\"d\")\n  | gd == 1 &amp;&amp; sd == 1    = (\"second\",\"m\")\n  | gd == 1 &amp;&amp; sd == 2    = (\"second\",\"M\")\n  | gd == 1 &amp;&amp; sd == 3    = (\"second\",\"A\")\n  | gd == 1 &amp;&amp; sd == 4    = (\"second\",\"AA\")\n  | gd == 1 &amp;&amp; sd &gt;  4    = (\"second\",show (abs sd) ++ \"A\")\n\n  where\n  (bn1,acc1,oct1) = parsePitch pt1\n  (bn2,acc2,oct2) = parsePitch pt2\n  direction = signum sd\n  sd = displacementInSemitonesOfPitches pt1 pt2\n  gd = abs $ displacementBetweenTwoBaseNotes direction bn1 bn2\n</code></pre>\n\n<p>Is there a programming structure that could <strong>simplify the code like the following pseudo-code does?</strong></p>\n\n<pre><code>interval pt1 pt2 \n  | gd == 0  | sd &lt;  (-2) = (\"unison\",show (abs sd) ++ \"d\") \n             | sd == (-2) = (\"unison\",\"dd\")\n             | sd == (-1) = (\"unison\",\"d\")\n             | sd == 0    = (\"unison\",\"P\")\n             | sd == 1    = (\"unison\",\"A\")\n             | sd == 2    = (\"unison\",\"AA\")\n             | sd &gt;  2    = (\"unison\",show sd ++ \"A\")  \n  | gd == 1  | sd &lt;  (-1) = (\"second\",show (abs sd) ++ \"d\")\n             | sd == (-1) = (\"second\",\"dd\")\n             | sd == 0    = (\"second\",\"d\")\n             | sd == 1    = (\"second\",\"m\")\n             | sd == 2    = (\"second\",\"M\")\n             | sd == 3    = (\"second\",\"A\")\n             | sd == 4    = (\"second\",\"AA\")\n             | sd &gt;  4    = (\"second\",show (abs sd) ++ \"A\")\n  | gd == 2  | sd ...     = ...\n             | sd ...     = ...\n  ...\n  | mod gd 7 == 1 | mod sd 12 == ...\n                  | mod sd 12 == ...\n  ...\n  | otherwise = ...\n\n  where\n  (bn1,acc1,oct1) = parsePitch pt1\n  (bn2,acc2,oct2) = parsePitch pt2\n  direction = signum sd\n  sd = displacementInSemitonesOfPitches pt1 pt2\n  gd = abs $ displacementBetweenTwoBaseNotes direction bn1 bn2\n</code></pre>\n\n<p>Thank you in advance for your suggestions.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 1, "creation_date": 1423991902, "post_id": 28524471, "comment_id": 45365244, "body": "This is one of the reasons why I would like <code>$</code> to be left associative: <a href=\"https://ghc.haskell.org/trac/haskell-prime/wiki/ChangeDollarAssociativity\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/haskell-prime/wiki/&hellip;</a>. It would allow you to write code like <code>liftM2 (+) $ exp1 $ exp2</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 0, "creation_date": 1423993880, "post_id": 28524471, "comment_id": 45365666, "body": "@Sarah I should learn to read more carefully. Thanks."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 0, "creation_date": 1424026480, "post_id": 28524471, "comment_id": 45374704, "body": "@AaditMShah Sometimes I&#39;ve done things like <code>liftM2 (+) `id` exp1 `id` exp2</code> (not in that case, though.)"}, {"owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "edited": false, "score": 0, "creation_date": 1424029552, "post_id": 28524471, "comment_id": 45375629, "body": "Don&#39;t make <code>$</code> left associative, define a different operator."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1488327816, "post_id": 28524471, "comment_id": 72179144, "body": "Wouldn&#39;t it be really easy to define your own left associative <code>$</code> (with a different symbol)?"}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 3, "creation_date": 1423998612, "post_id": 28524531, "comment_id": 45366750, "body": "And even in the meantime, you can use <code>return f `ap` x `ap` y</code> for <code>f &lt;$&gt; x &lt;*&gt; y</code>"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1424056041, "post_id": 28524531, "comment_id": 45382563, "body": "@Cactus Or closer to the metal: <code>f `fmap` x `ap` y</code>."}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1424089318, "post_id": 28524531, "comment_id": 45396056, "body": "@Cactus However, every data type that&#39;s an instance of <code>Monad</code> is also usually an instance of <code>Functor</code>. All the standard data types indeed are."}], "tags": [], "owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "is_accepted": true, "score": 16, "last_activity_date": 1423990910, "creation_date": 1423990910, "answer_id": 28524531, "question_id": 28524471, "link": "https://stackoverflow.com/questions/28524471/haskell-get-rid-of-parentheses-in-liftm2/28524531#28524531", "title": "Haskell: get rid of parentheses in liftM2", "body": "<p>You can get rid of the last one by using <code>$</code>, but the other one cannot obviously be removed without introducing new names. A better solution may be to use the fact that any <code>Monad m</code> should also be <code>Applicative</code> and <code>Functor</code> (and <em>will</em> be, come GHC 7.10)</p>\n\n<p>Your example then becomes</p>\n\n<pre><code>import Control.Applicative ((&lt;$&gt;), (&lt;*&gt;))\n\n(+) &lt;$&gt; somefunc arg1 (get arg2) &lt;*&gt; somefunc arg3 (get arg3)\n</code></pre>\n"}], "owner": {"reputation": 2389, "user_id": 2345370, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7f2ad519f77a20c173a0b5174a900c2d?s=128&d=identicon&r=PG", "display_name": "Not an ID", "link": "https://stackoverflow.com/users/2345370/not-an-id"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 0, "accepted_answer_id": 28524531, "answer_count": 1, "score": 4, "last_activity_date": 1423995377, "creation_date": 1423990383, "last_edit_date": 1423995377, "question_id": 28524471, "link": "https://stackoverflow.com/questions/28524471/haskell-get-rid-of-parentheses-in-liftm2", "title": "Haskell: get rid of parentheses in liftM2", "body": "<p>How to remove the parentheses marked with <code>^</code>, without introducing new names? (better if it can be splitted into multiple lines)</p>\n\n<pre><code>liftM2 (+) (somefunc arg1 (get arg2)) (somefunc arg3 (get arg3))\n           ^                        ^ ^                        ^\n                                     -\n</code></pre>\n"}, {"tags": ["haskell", "conduit"], "answers": [{"comments": [{"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 1, "creation_date": 1424008103, "post_id": 28526509, "comment_id": 45369079, "body": "That&#39;s certainly a viable work-around. It would also be possible to use Data.Conduit.Internal and write something very similar to <a href=\"https://hackage.haskell.org/package/conduit-1.2.3.1/docs/Data-Conduit.html#v:fuseBoth\" rel=\"nofollow noreferrer\">fuseBoth</a>"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1424021035, "last_edit_date": 1424021035, "creation_date": 1424006556, "answer_id": 28526509, "question_id": 28523958, "link": "https://stackoverflow.com/questions/28523958/haskell-conduit-is-it-possible-to-optionally-have-the-result-of-a-source/28526509#28526509", "title": "Haskell Conduit: is it possible to optionally have the result of a source?", "body": "<blockquote>\n  <p>This would be useful for example if the DataAndConclusions were\n  incrementally computing an MD5 and such MD5 was only needed if the\n  entire message was processed by the downstream</p>\n</blockquote>\n\n<p>Instead of relying on the return value of the upstream conduit, in this case perhaps you could accumulate the ongoing MD5 computation in a <code>StateT</code> layer beneath <code>ConduitM</code>, and access it after running the conduit.</p>\n\n<p>The other part of the puzzle is detecting that the producer has finished first. <code>Sink</code>s can detect upstream end-of-input in <code>await</code> calls. You could write a <code>Sink</code> that notifies you of upstream termination in its own result type, perhaps with a <code>Maybe</code>.</p>\n\n<p>But what if you are given a <code>Sink</code> that doesn't already do that? We would need a function like <code>Sink i m r -&gt; Sink i m (Maybe r)</code>. \"Given a <code>Sink</code> that may halt early, return a new <code>Sink</code> that returns <code>Nothing</code> if upstream finishes first\". But I don't know how to write that function.</p>\n\n<p><strong>Edit:</strong> This conduit sets an <code>IORef</code> to <code>True</code> when it detects upstream termination:</p>\n\n<pre><code>detectUpstreamClose :: IORef Bool -&gt;  Conduit i IO i\ndetectUpstreamClose ref = conduit\n  where\n    conduit = do\n        m &lt;- await\n        case m of\n          Nothing -&gt; liftIO (writeIORef ref True)\n          Just i -&gt; do\n              yield i\n              conduit\n</code></pre>\n\n<p><code>detectUpstreamClose</code> could be inserted in a pipeline, and the <code>IORef</code> could be checked afterwards.</p>\n"}, {"comments": [{"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 1, "creation_date": 1424026346, "post_id": 28528563, "comment_id": 45374654, "body": "Well, this compiles, so it must certainly work. But I will have to do my homework and understand well all the pieces ..."}, {"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 0, "creation_date": 1424027276, "post_id": 28528563, "comment_id": 45374924, "body": "I added an issue to Conduit: <a href=\"https://github.com/snoyberg/conduit/issues/199\" rel=\"nofollow noreferrer\">github.com/snoyberg/conduit/issues/199</a> . Maybe is something that can make it to the library."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1424165353, "post_id": 28528563, "comment_id": 45428909, "body": "It&#39;s a good idea, I&#39;ve just pushed a commit with this functionality."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 3, "last_activity_date": 1424019457, "creation_date": 1424019457, "answer_id": 28528563, "question_id": 28523958, "link": "https://stackoverflow.com/questions/28523958/haskell-conduit-is-it-possible-to-optionally-have-the-result-of-a-source/28528563#28528563", "title": "Haskell Conduit: is it possible to optionally have the result of a source?", "body": "<p>There should be definitely a nice solution, but I wasn't able to construct it using <code>ConduitM</code> primitives. Something with signature</p>\n\n<pre><code>ConduitM i a m r1 -&gt; ConduitM a o m r2 -&gt; ConduitM i o m (Maybe r1, r2)\n</code></pre>\n\n<p>Looks like a primitive function with this signature would be a good addition for the <em>conduit</em> library.</p>\n\n<p>Nevertheless, @danidiaz's suggestion about <code>StateT</code> lead me to the following generic solution that lifts the whole computation to <code>WriterT</code> internally in order to remember the output of the first conduit, if it's reached:</p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans\nimport Control.Monad.Trans.Writer\nimport Data.Conduit\nimport Data.Monoid\nimport Data.Void\n\ndifficultFunction :: (Monad m)\n                  =&gt; ConduitM () a2 m r1 -&gt; ConduitM a2 Void m r2\n                  -&gt; m (r2, Maybe r1)\ndifficultFunction l r = liftM (fmap getLast) $ runWriterT (l' $$ r')\n  where\n    l' = transPipe lift l &gt;&gt;= lift . tell . Last . Just\n    r' = transPipe lift r\n</code></pre>\n\n<p>(untested!)</p>\n"}], "owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 1, "accepted_answer_id": 28528563, "answer_count": 2, "score": 4, "last_activity_date": 1424021035, "creation_date": 1423985641, "question_id": 28523958, "link": "https://stackoverflow.com/questions/28523958/haskell-conduit-is-it-possible-to-optionally-have-the-result-of-a-source", "title": "Haskell Conduit: is it possible to optionally have the result of a source?", "body": "<p>I have the following types built from <a href=\"https://hackage.haskell.org/package/conduit-1.2.3.1/docs/Data-Conduit.html\" rel=\"nofollow\">Data.Conduit</a>:</p>\n\n<pre><code>type Footers = [(ByteString, ByteString)]\n\ntype DataAndConclusion = ConduitM () ByteString IO Footers\n</code></pre>\n\n<p>The idea of the second type being \"produce a lot of ByteStrings, and <em>if</em> you can produce all of them, return a Footers\". The condition is because conduits are governed by downstream functions, so the consumer of DataAndConclusion may have no need to consume all its items, and in that case the return wouldn't be reached. Which is precisely the behavior that I need. But <em>when</em> the end of the source is reached, I would like to have the produced Footers. This would be useful for example if the DataAndConclusions were incrementally computing an MD5 and such MD5 was only needed if the entire message was processed by the downstream (for example, downstream could be simply sending it through the network, but it doesn't make sense to finish computing and send the MD5 if the socket was closed before the last piece was sent by downstream). </p>\n\n<p>So, basically I want to have something with this signature to consume a DataAndConclusions:</p>\n\n<pre><code> type MySink = Sink ByteString IO ()\n\n mySink :: MySink \n mySink = ... \n\n difficultFunction :: ConduitM () a2 m r1 -&gt; ConduitM a2 Void m r2 -&gt; m (Maybe r1)\n</code></pre>\n\n<p>Question is, is there any way to implement \"difficultFunction\"? How?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1423985511, "post_id": 28523907, "comment_id": 45364119, "body": "They have the same type on GHCi 7.8.4 and 7.10."}, {"owner": {"reputation": 26848, "user_id": 683453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/263366f6318ce617f95d7282883402c0?s=128&d=identicon&r=PG", "display_name": "Philip JF", "link": "https://stackoverflow.com/users/683453/philip-jf"}, "edited": false, "score": 5, "creation_date": 1423986109, "post_id": 28523907, "comment_id": 45364212, "body": "<a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"nofollow noreferrer\">wiki.haskell.org/Monomorphism_restriction</a> + defaulting rules"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1423986166, "post_id": 28523907, "comment_id": 45364226, "body": "Isn&#39;t there a canonical monomorphism restriction question/answer? This question gets asked <i>all the time</i>."}, {"owner": {"reputation": 855, "user_id": 480733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bddcfdc7fd288457c855c6e9746c8f0?s=128&d=identicon&r=PG", "display_name": "Curry", "link": "https://stackoverflow.com/users/480733/curry"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1423987089, "post_id": 28523907, "comment_id": 45364355, "body": "@Andr&#225;sKov&#225;cs When I define function using let in GHCi, they have same type. But when I load source code file using &quot;:l&quot; command, they have different type. I test it on GHC 7.8.3."}, {"owner": {"reputation": 855, "user_id": 480733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bddcfdc7fd288457c855c6e9746c8f0?s=128&d=identicon&r=PG", "display_name": "Curry", "link": "https://stackoverflow.com/users/480733/curry"}, "reply_to_user": {"reputation": 26848, "user_id": 683453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/263366f6318ce617f95d7282883402c0?s=128&d=identicon&r=PG", "display_name": "Philip JF", "link": "https://stackoverflow.com/users/683453/philip-jf"}, "edited": false, "score": 0, "creation_date": 1423987536, "post_id": 28523907, "comment_id": 45364406, "body": "@Philip JF I will check monomorphism restriction as your comment. Thanks."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 2, "creation_date": 1423988444, "post_id": 28523907, "comment_id": 45364569, "body": "@Bakuriu: Probably, but <a href=\"http://stackoverflow.com/search?tab=votes&amp;q=monomorphism\">none that&#39;s</a> easy to find if you don&#39;t know the term &quot;monomorphism&quot;."}, {"owner": {"reputation": 855, "user_id": 480733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bddcfdc7fd288457c855c6e9746c8f0?s=128&d=identicon&r=PG", "display_name": "Curry", "link": "https://stackoverflow.com/users/480733/curry"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1424043161, "post_id": 28523907, "comment_id": 45379909, "body": "@Zeta Your comment is correct. I can&#39;t find answer because I don&#39;t know that term."}], "owner": {"reputation": 855, "user_id": 480733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bddcfdc7fd288457c855c6e9746c8f0?s=128&d=identicon&r=PG", "display_name": "Curry", "link": "https://stackoverflow.com/users/480733/curry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "closed_date": 1457749048, "answer_count": 0, "score": 1, "last_activity_date": 1423986847, "creation_date": 1423984999, "last_edit_date": 1423986847, "question_id": 28523907, "link": "https://stackoverflow.com/questions/28523907/why-does-eta-conversioned-function-have-different-type", "closed_reason": "Duplicate", "title": "Why does eta-conversioned function have different type?", "body": "<p>When I load below haskell code file by ':l' command in GHCi.</p>\n\n<pre><code>add1 x y = x + y\nadd2 = \\x -&gt; \\y -&gt; x + y\n</code></pre>\n\n<p>Type of add1 and add2 is like below.</p>\n\n<pre><code>add1 :: Num a =&gt; a -&gt; a -&gt; a\nadd2 :: Integer -&gt; Integer -&gt; Integer\n</code></pre>\n\n<p>Why do they have different type???</p>\n\n<p>UPDATE</p>\n\n<p>When I input below codes in GHCi, they have same type 'Num a => a -> a -> a'.</p>\n\n<pre><code>let add1 x y = x + y\nlet add2 = \\x -&gt; \\y -&gt; x + y\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 708, "user_id": 4553930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/308c878dca0a01a80bc9b5b9b19c7ab6?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay", "link": "https://stackoverflow.com/users/4553930/abhay"}, "edited": false, "score": 0, "creation_date": 1423984146, "post_id": 28523810, "comment_id": 45363960, "body": "What &quot;iteration&quot;s are you referring to?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1423984267, "post_id": 28523810, "comment_id": 45363975, "body": "Relevant: <a href=\"http://en.wikipedia.org/wiki/External_sorting\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/External_sorting</a>"}, {"owner": {"reputation": 11062, "user_id": 296827, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eMQgS.jpg?s=128&g=1", "display_name": "dsign", "link": "https://stackoverflow.com/users/296827/dsign"}, "edited": false, "score": 1, "creation_date": 1423988595, "post_id": 28523810, "comment_id": 45364589, "body": "You may want to use mutable vectors an in-place sort. Check this answer: <a href=\"http://stackoverflow.com/questions/5268156/how-do-you-do-an-in-place-quicksort-in-haskell\" title=\"how do you do an in place quicksort in haskell\">stackoverflow.com/questions/5268156/&hellip;</a>"}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1424005171, "post_id": 28523810, "comment_id": 45368211, "body": "is this a trick question from some job interview - from a time when ints where small, so the intended answer was something with bucketsort?"}, {"owner": {"reputation": 1030, "user_id": 521806, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PaOw7.jpg?s=128&g=1", "display_name": "Juan Pablo Santos", "link": "https://stackoverflow.com/users/521806/juan-pablo-santos"}, "edited": false, "score": 0, "creation_date": 1424024572, "post_id": 28523810, "comment_id": 45374073, "body": "I&#39;d use an online sorting algorithm such as insertion sort and push stuff through it using conduit. I think that with a little thinking I could manage to merge sort the chunks that conduit would provide to a sink."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 0, "last_activity_date": 1428342372, "creation_date": 1428342372, "answer_id": 29476536, "question_id": 28523810, "link": "https://stackoverflow.com/questions/28523810/sorting-large-collection-with-haskell/29476536#29476536", "title": "Sorting large collection with haskell", "body": "<p>The standard mergesort algorithm in Haskell already doesn't create a copy of the whole list -- it just breaks down the list into chunks and merges those.</p>\n\n<p>The <code>vector-algorithms</code> package (<a href=\"https://hackage.haskell.org/package/vector-algorithms\" rel=\"nofollow\">https://hackage.haskell.org/package/vector-algorithms</a>) also provides a number of common and efficient in-place sort algorithms.</p>\n"}], "owner": {"reputation": 439, "user_id": 3914448, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/02717be275ce9ce15a3061b1e0880dd5?s=128&d=identicon&r=PG&f=1", "display_name": "user3914448", "link": "https://stackoverflow.com/users/3914448/user3914448"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1428342372, "creation_date": 1423983881, "question_id": 28523810, "link": "https://stackoverflow.com/questions/28523810/sorting-large-collection-with-haskell", "title": "Sorting large collection with haskell", "body": "<p>I have gigabytes of integers and I want to sort them. How this may be done in haskell without creating a copy of the initial list every iteration?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1423975942, "post_id": 28523079, "comment_id": 45362831, "body": "It also takes an <code>a</code> (the last &quot;parameter&quot;). This is kind of functions are called &quot;function composition&quot;. I highly suggest you get comfortable with the <code>(.)</code> operator which does just that, and once you do and let the idea sink in, this will be piece of cake."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 4, "creation_date": 1423976050, "post_id": 28523079, "comment_id": 45362848, "body": "That&#39;s backwards, should be <code>Example f g h x = h ( g ( f (x) ) )</code>."}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1423976486, "post_id": 28523079, "comment_id": 45362909, "body": "@AmitKumarGupta Maybe the author likes pipelines (like in F#) :P if so it&#39;s valid."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1423976732, "post_id": 28523079, "comment_id": 45362948, "body": "This question made me start singing the alphabet song for the composition of 26 functions, &quot;a to b to b to c to c to d to d to e to e to f to f to g to g to h to h to i ... to a to z&quot;."}, {"owner": {"reputation": 63, "user_id": 4568055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ece116ef5b2ed4c92acc04aff7964dd?s=128&d=identicon&r=PG&f=1", "display_name": "rribeiro", "link": "https://stackoverflow.com/users/4568055/rribeiro"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1423977165, "post_id": 28523079, "comment_id": 45363013, "body": "@AmitKumarGupta , sorry could you just explain, why is that way and not the original was isn&#39;t f = a-&gt;b , g = b-&gt;c and h = c-&gt;d and then x = a?"}, {"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 2, "creation_date": 1423977395, "post_id": 28523079, "comment_id": 45363042, "body": "It&#39;s because function composition is backwards: <code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>. If you want forward function composition then you can use the <code>(&gt;&gt;&gt;)</code> operator from the <code>Control.Category</code> module."}, {"owner": {"reputation": 63, "user_id": 4568055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ece116ef5b2ed4c92acc04aff7964dd?s=128&d=identicon&r=PG&f=1", "display_name": "rribeiro", "link": "https://stackoverflow.com/users/4568055/rribeiro"}, "edited": false, "score": 0, "creation_date": 1423977808, "post_id": 28523079, "comment_id": 45363109, "body": "Oh okay, thanks for the help. I&#39;m new to Haskell so some of these rules just boggle my mind."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 1, "creation_date": 1423981648, "post_id": 28523079, "comment_id": 45363604, "body": "@rribeiro <code>h</code> is the third argument, so its type is <code>c -&gt; d</code>.  <code>x</code> is your fourth argument so its type is <code>a</code>.  <code>h(x)</code> doesn&#39;t type check.  <code>f</code> on the other hand is <code>a -&gt; b</code>, so <code>f(x)</code> makes sense.  And then <code>g(f(x))</code> makes sense.  And then <code>h(g(f(x)))</code> makes sense, and it also has the correct type <code>d</code> since <code>h</code> is a function with codomain <code>d</code>."}, {"owner": {"reputation": 6364, "user_id": 288913, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/902e8cc4ad1dab7e25d3a2dc1eac732f?s=128&d=identicon&r=PG", "display_name": "Sarah", "link": "https://stackoverflow.com/users/288913/sarah"}, "edited": false, "score": 1, "creation_date": 1423991182, "post_id": 28523079, "comment_id": 45365087, "body": "Perhaps trying to read the signature in English rather than Haskell will help:  Given a function <code>f</code> that takes an <code>a</code> and produces a <code>b</code>,  and a function <code>g</code> that takes a <code>b</code> and produces a <code>c</code>,  and a function <code>h</code> that takes a <code>c</code> and produces a <code>d</code>,  <code>example f g h</code> takes an <code>a</code> and produces a <code>d</code>."}], "answers": [{"tags": [], "owner": {"reputation": 164, "user_id": 2295391, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/be35f59bec82281d2df7c60526b65a0a?s=128&d=identicon&r=PG", "display_name": "Totoro", "link": "https://stackoverflow.com/users/2295391/totoro"}, "is_accepted": true, "score": 1, "last_activity_date": 1424018849, "creation_date": 1424018849, "answer_id": 28528459, "question_id": 28523079, "link": "https://stackoverflow.com/questions/28523079/understanding-this-type-in-haskell/28528459#28528459", "title": "Understanding this type in Haskell?", "body": "<p>I think that you already know the theory behind the type you're writing, so I'll try to inject some intuitive way to read it (at least I hope so, your question is not totally clear to me).</p>\n\n<p>When you read something like (a -> b) inside a type, that's a function, as you said. For example (Int -> Bool) is a function.</p>\n\n<p>Let's make an example:</p>\n\n<pre><code>even :: Int -&gt; Bool -- A more generic version of that is in the Prelude\neven n = n `rem` 2 == 0\n\nfilter :: (Int -&gt; Bool) -&gt; [Int] -&gt; [Int] -- And of that, too\nfilter _ [] = []\nfilter f (x:xs)\n    | f x       = x : filter f xs\n    | otherwise = filter f xs\n\nfilteredEven :: [Int]\nfilteredEven = filter even [1..5] -- it gives [2, 4]\n</code></pre>\n\n<p>In this example we have a \"high order function\", a function that get another function and use it in some way.</p>\n\n<p>In a function like the one you're defining you simply use 3 functions (and another parameter). But you can know more.</p>\n\n<p>Each function you declare in the type accept a value returned from the previous one. So a possible solution is the one you have already showed. But the types are generic. There is not a total function that returns a generic value (where total means that it terminate always returning a value different from bottom if all the values are total and different by bottom, so it don't crash or return undefined, for example). So, if you wants a total function you have to have a way to generate the variables requested, from the context of the function (their parameters).</p>\n\n<p>In the example before, using the names used by you, you have to return a value of type d. You only have a way to produce a value of that type, the h function. But to use the h function you have to get a value of type c. You only have the g function for that. But you need a value of type c. Fortunately you have the function f, that in exchange of a value of type a returns the value needed. We have this value (and don't have any other way to obtain a value of that type), so the function can be written. We can't in any way alter the values obtained (call multiple times the functions don't work, for purity and the fact that we have only a way to produce the values), so that's the only way to construct the function, if we wants it to be total:</p>\n\n<pre><code>Example (a -&gt; b) -&gt; (b -&gt; c) -&gt; (c -&gt; d) -&gt; a -&gt; d\nExample f g h x = h (g (f x)))\n</code></pre>\n\n<p>We can write the function in many other ways, but the results they give will be always the same (if Example, f, g and h are total and x is not bottom). So the type can express really well the function, because we can understand how the function works only looking at the type!</p>\n"}], "owner": {"reputation": 63, "user_id": 4568055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ece116ef5b2ed4c92acc04aff7964dd?s=128&d=identicon&r=PG&f=1", "display_name": "rribeiro", "link": "https://stackoverflow.com/users/4568055/rribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 28528459, "answer_count": 1, "score": 0, "last_activity_date": 1424018849, "creation_date": 1423975557, "last_edit_date": 1423975730, "question_id": 28523079, "link": "https://stackoverflow.com/questions/28523079/understanding-this-type-in-haskell", "title": "Understanding this type in Haskell?", "body": "<p>I'm having some trouble understanding, how this type declaration works. </p>\n\n<p>The type is: <code>(a -&gt; b) -&gt; (b -&gt; c) -&gt; (c -&gt; d) -&gt; a -&gt; d</code></p>\n\n<p>So, to me I interpret this as a function that takes a function and that function takes another function which outputs a value d.</p>\n\n<p>So, this is how I make my function: </p>\n\n<pre><code>Example :: (a -&gt; b) -&gt; (b -&gt; c) -&gt; (c -&gt; d) -&gt; a -&gt; d\nExample f g h x = f ( g ( h (x) )\n</code></pre>\n\n<p>I'd really appreciate it, if you guys could help me clarify. Thank you!</p>\n"}, {"tags": ["haskell", "offline", "cabal", "cabal-install"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1423982757, "post_id": 28522998, "comment_id": 45363767, "body": "There is no terrible difficulty in getting Cabal to install a package offline as long as the package and all its dependencies are locally available."}], "tags": [], "owner": {"reputation": 7292, "user_id": 1276128, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Jat1U.jpg?s=128&g=1", "display_name": "Marko Gresak", "link": "https://stackoverflow.com/users/1276128/marko-gresak"}, "is_accepted": false, "score": 1, "last_activity_date": 1423974644, "creation_date": 1423974644, "answer_id": 28522998, "question_id": 28522887, "link": "https://stackoverflow.com/questions/28522887/install-haskell-packages-using-cabal-without-internet-connection/28522998#28522998", "title": "Install Haskell packages using cabal without internet connection", "body": "<p>Package managers, such as <a href=\"https://www.haskell.org/cabal/\" rel=\"nofollow\">cabal</a>, work internally to get a package from a remote repository. I doubt there exist an easy workaround to make cabal install a package in offline mode.</p>\n\n<p>Probably the easiest way is to find a compressed version of package, find a way to get them on the offline computer (local sharing, thumb drive, etc.) and <a href=\"https://wiki.haskell.org/Cabal/How_to_install_a_Cabal_package\" rel=\"nofollow\">install a package manually</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 40039, "user_id": 699224, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4feb08afcd7c57acb72bd49fc2bf834d?s=128&d=identicon&r=PG", "display_name": "DNA", "link": "https://stackoverflow.com/users/699224/dna"}, "edited": false, "score": 1, "creation_date": 1424001446, "post_id": 28523072, "comment_id": 45367345, "body": "Is there a quick way to find the dependencies of the package and download those as well, or must this be done manually?"}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "reply_to_user": {"reputation": 40039, "user_id": 699224, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4feb08afcd7c57acb72bd49fc2bf834d?s=128&d=identicon&r=PG", "display_name": "DNA", "link": "https://stackoverflow.com/users/699224/dna"}, "edited": false, "score": 1, "creation_date": 1424004383, "post_id": 28523072, "comment_id": 45368028, "body": "@DNA Not that I know of, but writing a tool for that should be very easy since Cabal is also on Hackage. You could get the package (however you want; e.g. you could call <code>cabal get</code> using <code>System.Process</code>), then simply use the Cabal package to parse the cabal file, and then just recursively do the same for package dependencies."}], "tags": [], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "is_accepted": true, "score": 8, "last_activity_date": 1423996480, "last_edit_date": 1423996480, "creation_date": 1423975467, "answer_id": 28523072, "question_id": 28522887, "link": "https://stackoverflow.com/questions/28522887/install-haskell-packages-using-cabal-without-internet-connection/28523072#28523072", "title": "Install Haskell packages using cabal without internet connection", "body": "<p>From a machine you can access the internet you can either:</p>\n\n<ul>\n<li>Run <code>cabal get pkg-name</code> where <code>pkg-name</code> is the package you want.</li>\n<li>Go to the package's page on <a href=\"http://hackage.haskell.org/\">Hackage</a> and on the Downloads section there's a <code>.tar.gz</code> file you can download.</li>\n</ul>\n\n<p>After you get it, transfer it to your other machine, extract it anywhere you'd like (a sandbox if you want it just in a sandbox). Then from that directory (where there's a <code>.cabal</code> file) run <code>cabal install</code>.</p>\n"}], "owner": {"reputation": 63, "user_id": 4561417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68ddceeaf0cb3183dc3c3a2031a22aad?s=128&d=identicon&r=PG&f=1", "display_name": "kjit123", "link": "https://stackoverflow.com/users/4561417/kjit123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1419, "favorite_count": 3, "accepted_answer_id": 28523072, "answer_count": 2, "score": 6, "last_activity_date": 1423998269, "creation_date": 1423973228, "last_edit_date": 1423998269, "question_id": 28522887, "link": "https://stackoverflow.com/questions/28522887/install-haskell-packages-using-cabal-without-internet-connection", "title": "Install Haskell packages using cabal without internet connection", "body": "<p>I have a machine that doesn't have internet access at all.<br />\nI installed the Haskell Platform on it using the installer which I got from another machine through a pendrive.</p>\n\n<p>Now I want to install the package <code>repa</code> on my home machine which has no internet access. How should I do that?</p>\n\n<p>My home machine is running Linux (Debian) and my office machine is Windows 7.</p>\n"}, {"tags": ["haskell", "bit-manipulation"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1423971972, "post_id": 28522395, "comment_id": 45362317, "body": "<code>Word8</code> certainly seems a more economical choice for this than <code>[Bool]</code> on the surface. Can you say a bit more about why you prefer the latter?"}, {"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1423972552, "post_id": 28522395, "comment_id": 45362392, "body": "It&#39;s going to populate a <code>UArray</code> and from what I&#39;ve read it should bit pack the <code>Bool</code>s. Though in their temporary <code>[Bool]</code> state they will take up an unnecessary amount of memory. Reading the bits will trigger the activation of Nodes in a neural network, which will then run its own processing of the inputs. The activated outputs nodes get read as bit values that trigger an <code>Int</code> outputs."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1423974423, "post_id": 28522395, "comment_id": 45362627, "body": "Close vote: should be migrated to <a href=\"http://codereview.stackexchange.com/\">codereview.stackexchange.com</a>"}, {"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 0, "creation_date": 1423974798, "post_id": 28522395, "comment_id": 45362668, "body": "Well I was hoping that there might exist something of the form <code>Word8 -&gt; Array ix Bool</code> or <code>Word8 -&gt; [Bool]</code> that could break a <code>Word8</code> into its constituent bits in one go (where as my map and fold require 8 steps each)."}, {"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 0, "creation_date": 1423974955, "post_id": 28522395, "comment_id": 45362690, "body": "Though that said, having found that snippet from <code>bitwise</code> suggests to me that this is the most practical approach. Assuming there is nothing else than the answer to my question &quot;I&#39;m wondering if this (or something similar) might be in standard library?&quot; is &quot;No&quot;."}, {"owner": {"reputation": 6639, "user_id": 1157100, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/1f9W9.png?s=128&g=1", "display_name": "200_success", "link": "https://stackoverflow.com/users/1157100/200-success"}, "edited": false, "score": 0, "creation_date": 1423975346, "post_id": 28522395, "comment_id": 45362742, "body": "Your Rev 2 would be better as a self-answer."}, {"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "reply_to_user": {"reputation": 6639, "user_id": 1157100, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/1f9W9.png?s=128&g=1", "display_name": "200_success", "link": "https://stackoverflow.com/users/1157100/200-success"}, "edited": false, "score": 0, "creation_date": 1423984413, "post_id": 28522395, "comment_id": 45363997, "body": "Fair enough @200_success I&#39;ll do that."}], "answers": [{"comments": [{"owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 0, "creation_date": 1423971270, "post_id": 28522641, "comment_id": 45362210, "body": "I&#39;m not necessarily looking for an approach that only uses the prelude. Data.Bits is in base and provides a very clean bitiwse API."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "reply_to_user": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "edited": false, "score": 0, "creation_date": 1423974346, "post_id": 28522641, "comment_id": 45362615, "body": "In that case, I do not understand the question. Can you supply a specific criterion you&#39;re looking for when you say your current implementation doesn&#39;t &quot;feel&quot; like a great implementation? I&#39;m going to vote to close the question under the current description since it seems to better belong at <a href=\"http://codereview.stackexchange.com/\">the code review site</a>. I&#39;m happy to revoke the close vote pending more details or possibly answers from others."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423993524, "post_id": 28522641, "comment_id": 45365586, "body": "Using <code>2^n</code> at every step looks overkill. I&#39;d expect each step to need O(1) operations only (e.g. <code>x `div` 2 </code> or <code>x*2</code>)."}], "tags": [], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "is_accepted": false, "score": 0, "last_activity_date": 1423970341, "last_edit_date": 1423970341, "creation_date": 1423969772, "answer_id": 28522641, "question_id": 28522395, "link": "https://stackoverflow.com/questions/28522395/converting-an-int-to-a-list-of-bits-represented-by-bool/28522641#28522641", "title": "Converting an Int to a list of bits represented by [Bool]", "body": "<p>This isn't thoroughly tested, but it's a proposal for a native implementation.</p>\n\n<pre><code>toBitsBySize :: Int -&gt; Int -&gt; [Bool]\ntoBitsBySize  0 x = []\ntoBitsBySize sz 0 = [False | i &lt;- [1..sz]]\ntoBitsBySize sz x =  if k == 0 \n    then False : (toBitsBySize n x) \n    else True  : (toBitsBySize n (x - k*m))\n    where n = sz - 1\n          m = 2^n\n          k = x `div` m\n\ntoBits8 = toBitsBySize 8\n</code></pre>\n\n<p>Some examples:</p>\n\n<pre><code>*Main&gt; toBits8 2\n[False,False,False,False,False,False,True,False]\n*Main&gt; toBits8 255\n[True,True,True,True,True,True,True,True]\n*Main&gt; toBits8 129\n[True,False,False,False,False,False,False,True]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423993820, "post_id": 28523900, "comment_id": 45365653, "body": "Or and shift is what I&#39;d use in C, and for bit-level maniputation it&#39;s very efficient: I&#39;d expect that iterating over the list (i.e. following pointers) takes much, much more time than the bit operations. With modern superscalar CPU the bit ops could be performed in parallel while the CPU reads the next list element."}], "tags": [], "owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "is_accepted": false, "score": 1, "last_activity_date": 1423984918, "creation_date": 1423984918, "answer_id": 28523900, "question_id": 28522395, "link": "https://stackoverflow.com/questions/28522395/converting-an-int-to-a-list-of-bits-represented-by-bool/28523900#28523900", "title": "Converting an Int to a list of bits represented by [Bool]", "body": "<p>This was previously an edit in my question. I would still like to know if there is anything better. I'm imagining something that literally coerces a <code>Word8</code> into an array of its constituent bits but perhaps that's a bit lofty...</p>\n\n<p>The package <code>bitwise</code> which does a similar implementation to my own but using <a href=\"https://hackage.haskell.org/package/bitwise-0.1.0.1/docs/src/Data-Bits-Bitwise.html#fromListLE\" rel=\"nofollow\">bitshifting for their <code>fromList</code> function</a>. In lieu of a better idea this suggests that using <code>Data.Bits</code> combined with some sort of <code>map</code> and some sort of <code>fold</code> is the canonical solution:</p>\n\n<pre><code>-- | Convert a little-endian list of bits to 'Bits'.\n{-# INLINE fromListLE #-}\nfromListLE :: (Num b, Bits b) =&gt; [Bool] {- ^ \\[least significant bit, ..., most significant bit\\] -} -&gt; b\nfromListLE = foldr f 0\n  where\n    f b i = fromBool b .|. (i `shiftL` 1)\n\n-- | Convert a 'Bits' (with a defined 'bitSize') to a list of bits, in\n--   little-endian order.\n{-# INLINE toListLE #-}\ntoListLE :: (Num b, Bits b) =&gt; b -&gt; [Bool] {- ^ \\[least significant bit, ..., most significant bit\\] -}\ntoListLE b = P.map (testBit b) [0 .. bitSize b - 1]\n</code></pre>\n"}], "owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2179, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1618603740, "creation_date": 1423966345, "last_edit_date": 1618603740, "question_id": 28522395, "link": "https://stackoverflow.com/questions/28522395/converting-an-int-to-a-list-of-bits-represented-by-bool", "title": "Converting an Int to a list of bits represented by [Bool]", "body": "<p>I'm aware that with <a href=\"https://hackage.haskell.org/package/base-4.15.0.0/docs/Data-Bits.html\" rel=\"nofollow noreferrer\"><code>Data.Bits</code></a> I can do bitwise manipulation on anything with an instance of <code>Bits</code>. That however is not what I want. I explicitly want to manipulate a list of <code>Bool</code>s which represent the bit value at each bit index.</p>\n<p>More precisely I want to manipulate the bits of a 1-byte integer.</p>\n<p>I have managed to get this to work using <code>map</code>/<code>testBit</code> and <code>foldl'</code>/<code>setBit</code>. Which you can see from my tests in ghci below:</p>\n<pre><code>\u03bb import Data.Bits\n\u03bb import Data.List\n\n\u03bb let convertToBits :: Int -&gt; [Bool] ; convertToBits x = map (testBit x) [7,6..0]\n\n\u03bb let convertFromBits :: [Bool] -&gt; Int ; \n   convertFromBits bs = foldl' (\\acc (i,b) -&gt; if b then setBit acc i else acc) 0 $ zip [7,6..0] bs\n\n\u03bb convertToBits 255\n[True,True,True,True,True,True,True,True]\n\n\u03bb convertToBits 2\n[False,False,False,False,False,False,True,False]\n\n\u03bb convertFromBits [False,False,False,True,True,False,False,True]\n25\n\n\u03bb convertFromBits $ convertToBits 255\n255\n\n\u03bb convertFromBits $ convertToBits 10\n10\n</code></pre>\n<p>However this doesn't feel like a particularly great implementation. I'm wondering if this (or something similar) might be in standard library?</p>\n<p>EDIT ------</p>\n<p>A quick final note, even though I have answered the question below, I thought I'd add a bit more in case anyone stumbles on this and knows a better answer. I'll be storing all of the bits in a <code>UArray</code> which will bit-pack the <code>Bool</code> values.</p>\n<p>In thinking about it, what would be really good is a function that converts a <code>Word8</code> into a <code>UArray ix Bool</code>. I'd like to think there is some efficient / simple way to do this but I don't know enough about the low level stuff to work it out.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1423962634, "post_id": 28522038, "comment_id": 45360841, "body": "You can <a href=\"http://stackoverflow.com/questions/28511329/converting-a-binarytree-to-a-tree\">convert the <code>BinTree</code> to a <code>Tree</code></a> and compare the <code>Tree</code>s."}, {"owner": {"reputation": 47363, "user_id": 146780, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/48ea519fede5177604945a5c430e6e19?s=128&d=identicon&r=PG", "display_name": "jmasterx", "link": "https://stackoverflow.com/users/146780/jmasterx"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423962686, "post_id": 28522038, "comment_id": 45360848, "body": "@Cirdec Yes, but is there a way to do that in a way where I can use the &#39;&lt;&#39; operator?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1423962829, "post_id": 28522038, "comment_id": 45360875, "body": "No, <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:-60-\" rel=\"nofollow noreferrer\"><code>&lt;</code> has the type <code>Ord a =&gt; a -&gt; a -&gt; Bool</code></a>. The two arguments must be the same type."}, {"owner": {"reputation": 47363, "user_id": 146780, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/48ea519fede5177604945a5c430e6e19?s=128&d=identicon&r=PG", "display_name": "jmasterx", "link": "https://stackoverflow.com/users/146780/jmasterx"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1423962989, "post_id": 28522038, "comment_id": 45360907, "body": "How does haskell compare floats to integers?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 5, "creation_date": 1423963525, "post_id": 28522038, "comment_id": 45360996, "body": "Haskell doesn&#39;t compare floats to integers. When you write <code>1.7 &lt; 3</code> the real types are <code>1.7 :: Fractional a =&gt; a</code> and <code>3 :: Num a =&gt; a</code>. Haskell has <a href=\"https://www.haskell.org/onlinereport/decls.html#default-decls\" rel=\"nofollow noreferrer\">built in defaults for dealing with number types</a>, and will decide that <code>a</code> is <code>Double</code> (by default it tries <code>Integer</code> then <code>Double</code> then gives up). If we explicitly write <code>1.7 &lt; (3 :: Integer)</code> we get a type error; Haskell can not compare the <code>Double</code> <code>1.7</code> to an <code>Integer</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1423964148, "last_edit_date": 1423964148, "creation_date": 1423963575, "answer_id": 28522159, "question_id": 28522038, "link": "https://stackoverflow.com/questions/28522038/comparing-2-similar-types/28522159#28522159", "title": "Comparing 2 Similar Types?", "body": "<p>Not in such way that it becomes an instance of the <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#t:Eq\"><code>Eq</code></a> or <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#t:Ord\"><code>Ord</code></a> classes. These classes have the signature:</p>\n\n<pre><code>(==) :: a -&gt; a -&gt; Bool\n(/=) :: a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>and so on...</p>\n\n<p>You could write your own <code>(==)</code> function, but then that function becomes ambiguous, and as a result you will always need to specify about which <code>(==)</code> operator you are actually talking.</p>\n\n<p>The answer to your comment \"<em>How does haskell compare floats to integers?</em>\" is that it doesn't. If you write:</p>\n\n<pre><code>&gt; (1 :: Int) == (1.0 :: Float)\n\n&lt;interactive&gt;:56:16:\n    Couldn't match expected type `Int' with actual type `Float'\n    In the second argument of `(==)', namely `(1.0 :: Float)'\n    In the expression: (1 :: Int) == (1.0 :: Float)\n    In an equation for `it': it = (1 :: Int) == (1.0 :: Float)\n</code></pre>\n\n<p>You see that the comparison can't be done. You can do this by converting:</p>\n\n<pre><code>&gt; fromIntegral (1 :: Int) == (1.0 :: Float)\nTrue\n</code></pre>\n\n<p>Where <code>fromIntegral</code> is a function that converts the <code>Int</code> into - in this case - a <code>Float</code>. You can do the same by implementing a <code>bin2tree</code> function.</p>\n\n<p>You can of course define your own similar class:</p>\n\n<pre><code>class Similar a b where\n    (=~) :: a -&gt; b -&gt; Bool\n    (/=~) :: a -&gt; b -&gt; Bool\n    (/=~) x y = not $ x =~ y\n</code></pre>\n\n<p>(and add <code>{-# LANGUAGE MultiParamTypeClasses #-}</code> in the file as modifier).</p>\n\n<p>And then for instance:</p>\n\n<pre><code>instance (Similar a b) =&gt; Similar [a] [b] where\n    (=~) [] [] = True\n    (=~) _  [] = False\n    (=~) [] _  = True\n    (=~) (x:xs) (y:ys) = (x =~ y) &amp;&amp; (xs =~ ys)\n</code></pre>\n\n<p>But the problem is that you will have to redefine a lot of methods yourself (that take use of <code>Eq</code> like <code>nub</code>) such that they work with your <code>Similar</code> class.</p>\n"}], "owner": {"reputation": 47363, "user_id": 146780, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/48ea519fede5177604945a5c430e6e19?s=128&d=identicon&r=PG", "display_name": "jmasterx", "link": "https://stackoverflow.com/users/146780/jmasterx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 28522159, "answer_count": 1, "score": 3, "last_activity_date": 1424629299, "creation_date": 1423962297, "last_edit_date": 1424629299, "question_id": 28522038, "link": "https://stackoverflow.com/questions/28522038/comparing-2-similar-types", "title": "Comparing 2 Similar Types?", "body": "<p>I have 2 types, Tree and BinTree. The way I implement compare is like so:</p>\n\n<pre><code>instance (Eq a) =&gt; Ord (Tree a) where\n  t &lt;= u = traces t `subseteq` traces u\n\ninstance (Eq a) =&gt; Eq (Tree a) where\n  t == u = traces t `subseteq` traces u &amp;&amp; traces u `subseteq` traces t\n\ninstance (Eq a) =&gt; Ord (BinTree a) where\n  t &lt;= u = traces t `subseteq` traces u\n\ninstance (Eq a) =&gt; Eq (BinTree a) where\n  t == u = traces t `subseteq` traces u &amp;&amp; traces u `subseteq` traces t\n</code></pre>\n\n<p>As you can see, my traces function is happy to operate on both Tree and BinTree, thus there should be a way for me to do:\nmyBinTree &lt; myTree</p>\n\n<p>Thus comparing a BinTree to a Tree</p>\n\n<p>How does one go about implementing this so that BinTrees and Trees can be compared, since a BinTree is a subset of a Tree.</p>\n"}, {"tags": ["haskell", "clojure", "haskell-lens", "nested-map"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1423957085, "post_id": 28521394, "comment_id": 45359708, "body": "&quot;Clojure eschews a type system, preferring to solve the problem with data structures&quot; is a very strange claim. Data structures and functions are the basis of Haskell&#39;s type system. Haskell just requires you to prove you&#39;re using the correct one instead of letting it blow up at runtime."}, {"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1423957975, "post_id": 28521394, "comment_id": 45359902, "body": "Thanks - that wasn&#39;t very clear. Within the Clojure community there is a truism quoted &quot;Data &gt; Functions &gt; Macros&quot; which means where you have a choice about encoding your logic in data structures, or functions or macros, first choose data structures, then functions, then macros if you really have to. For example (:hello {:hello #(println &quot;Hello World&quot;)}) is a way of encoding logic for a hello world function."}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1423958614, "post_id": 28521394, "comment_id": 45360042, "body": "I&#39;m not familiar with Clojure&#39;s key sequences, but if I had to guess the main difference would be that Haskell&#39;s lenses are typed and statically checked at compile time, avoiding runtime failures."}, {"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1423960076, "post_id": 28521394, "comment_id": 45360360, "body": "Maybe I&#39;ll update the assumptions - but in Clojure I can wrap the above in a macro-expansion and get a &#39;compile-time-check&#39;. Does that help?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1423984603, "post_id": 28521394, "comment_id": 45364023, "body": "@hawkeye what if the function and/or the arguments are statically unknown in an application? Then at best you get a runtime check, using macros, and failure must be handled somehow all the same. A core point of type checking is to prove invariants about all kinds of statically unknown things without running the program."}, {"owner": {"reputation": 25192, "user_id": 1756702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2aeb0631b89c7948ca82c71a725e8f4?s=128&d=identicon&r=PG&f=1", "display_name": "A. Webb", "link": "https://stackoverflow.com/users/1756702/a-webb"}, "edited": false, "score": 0, "creation_date": 1424179014, "post_id": 28521394, "comment_id": 45435449, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/21291712/when-manipulating-immutable-datastructures-whats-the-difference-between-clojur\">When manipulating immutable datastructures, what&#39;s the difference between Clojure&#39;s assoc-in and Haskell&#39;s lenses?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": true, "score": 3, "last_activity_date": 1423995961, "last_edit_date": 1423995961, "creation_date": 1423995659, "answer_id": 28525081, "question_id": 28521394, "link": "https://stackoverflow.com/questions/28521394/what-are-the-similarities-and-differences-between-a-lens-in-haskell-and-using-a/28525081#28525081", "title": "What are the similarities and differences between a lens in Haskell and using a key-sequence in Clojure?", "body": "<p>Lenses in Haskell are not restricted to keys. You could for example write a lens for the length of a string:</p>\n\n<pre><code>lengthLens = lens length setLength\n\nsetLength s l = take l s ++ take (l - length s) (repeat '\\0')\n</code></pre>\n\n<p>Clojure key sequences are restricted to map/vector/etc keys. I personally don't think this is a loss since I've never had a need for lenses for non-key-like getters and setters.</p>\n\n<p>As for types vs data, a lens composition in Haskell is data much like functions are data. This is similar to how vectors of keys are data in Clojure.</p>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 0, "accepted_answer_id": 28525081, "answer_count": 1, "score": 2, "last_activity_date": 1423995961, "creation_date": 1423956123, "last_edit_date": 1423960149, "question_id": 28521394, "link": "https://stackoverflow.com/questions/28521394/what-are-the-similarities-and-differences-between-a-lens-in-haskell-and-using-a", "title": "What are the similarities and differences between a lens in Haskell and using a key-sequence in Clojure?", "body": "<p><strong>Assumptions:</strong></p>\n\n<ul>\n<li>I know that Haskell encourages solving problems with a type system, and Clojure eschews a type system, preferring to solve the problem with data structures. </li>\n</ul>\n\n<p>We can see that we can create a <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow\">lens</a> <a href=\"http://www.haskellforall.com/2013/05/program-imperatively-using-haskell.html\" rel=\"nofollow\">like this</a> in Haskell:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Control.Lens\n\ninitialState :: Game\ninitialState = Game\n    { _score = 0\n    , _units =\n        [ Unit\n            { _health = 10\n            , _position = Point { _x = 3.5, _y = 7.0 }\n            }\n        ]\n    }\n\nhealth :: Lens' Unit Int\nhealth = lens _health (\\unit v -&gt; unit { _health = v })\n</code></pre>\n\n<p>It's purpose is to get the <code>health</code> value from the <code>game</code> data structure. </p>\n\n<p>We can access a nested structure using a key-sequence like this in Clojure:</p>\n\n<pre><code>(def initialState {:score 0 \n                   :units {:health 10\n                           :position {:x 3.5\n                                      :y 7.0}}})\n\n(def health [:units :health])\n\n(defn initialState-getter [lens]\n  (get-in initialState lens))\n\n(initialState-getter health)\n&gt; 10\n\n(defn initialState-setter [lens value]\n  (assoc-in initialState lens value))\n\n(initialState-setter health 22)\n&gt; {:score 0, :units {:health 22, :position {:y 7.0, :x 3.5}}}\n</code></pre>\n\n<p>Here we see a nested structure being updated by a key sequence. </p>\n\n<p>My question is: <strong>What are the similarities and differences between a lens in Haskell and using a key-sequence in Clojure?</strong></p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1423952934, "post_id": 28520918, "comment_id": 45358681, "body": "Try <code>svgtex x = return x</code>."}, {"owner": {"reputation": 19332, "user_id": 2192488, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/6JFOF.png?s=128&g=1", "display_name": "Serge Stroobandt", "link": "https://stackoverflow.com/users/2192488/serge-stroobandt"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423953104, "post_id": 28520918, "comment_id": 45358726, "body": "@chi That did it! Thank you very much. Feel free to post it as an answer to give you more reputation."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1423953624, "creation_date": 1423953624, "answer_id": 28521098, "question_id": 28520918, "link": "https://stackoverflow.com/questions/28520918/how-to-combine-a-readprocess-monad-with-where-in-haskell/28521098#28521098", "title": "How to combine a readProcess monad with where in Haskell?", "body": "<p>The problem lies here:</p>\n\n<pre><code>    svgtex x = x\n</code></pre>\n\n<p>The complier complains that</p>\n\n<pre><code>Couldn't match expected type `IO Inline' with actual type `Inline'\n</code></pre>\n\n<p>because <code>x</code> is an <code>Inline</code>, while <code>svgtex</code> must return an <code>IO Inline</code>. To inject the <code>x</code> into the <code>IO</code> monad, we can simply use the <code>return</code> function</p>\n\n<pre><code>    svgtex x = return x\n</code></pre>\n\n<p>To fully understand what's going on see any monad tutorial (or LYAH). Roughly put, a value of type <code>IO Inline</code> represents an action that can perform any amount of I/O and finally return a value of type <code>Inline</code>. The <code>return</code> function is used to turn a pure value into a dummy <code>IO</code> action which does not do any I/O, but simply return the result.</p>\n"}], "owner": {"reputation": 19332, "user_id": 2192488, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/6JFOF.png?s=128&g=1", "display_name": "Serge Stroobandt", "link": "https://stackoverflow.com/users/2192488/serge-stroobandt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 1, "accepted_answer_id": 28521098, "answer_count": 1, "score": 0, "last_activity_date": 1423953624, "creation_date": 1423952250, "last_edit_date": 1423952943, "question_id": 28520918, "link": "https://stackoverflow.com/questions/28520918/how-to-combine-a-readprocess-monad-with-where-in-haskell", "title": "How to combine a readProcess monad with where in Haskell?", "body": "<p>Below script is intended as an extension of a published and working <a href=\"http://johnmacfarlane.net/pandoc/scripting.html#latex-for-wordpress\" rel=\"nofollow\">Pandoc Haskell filter script</a>. What has been added is a call to the shell command <code>curl</code>.</p>\n\n<pre><code>#!/usr/bin/env runhaskell\n-- svgtex.hs\nimport Text.Pandoc.JSON\nimport System.Process\n\ncurl latex = readProcess \"curl\" [\"-d\", \"type=tex&amp;q=\" ++ latex, \"http://localhost:16000\"] \"\"\n\nmain = toJSONFilter svgtex\n  where svgtex (Math style latex) = do\n            svg &lt;- curl latex\n            return (Math style (svg))\n        svgtex x = x\n</code></pre>\n\n<p>However, being completely new to Haskell functional programming, it is not surprising that my script fails with:</p>\n\n<pre><code>Couldn't match expected type `IO Inline' with actual type `Inline'\nIn the expression: x\nIn an equation for `svgtex': svgtex x = x\nIn an equation for `main':\n...\n</code></pre>\n\n<p>Despite having skipped over a number on-line Haskell tutorials and StackExchange Q&amp;As, the concept of monads has still not entirely dawned upon me. Hence, a detailed explanation about all things wrong in above script would be very much appreciated!</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "is_accepted": false, "score": 3, "last_activity_date": 1423950747, "creation_date": 1423950747, "answer_id": 28520717, "question_id": 28520649, "link": "https://stackoverflow.com/questions/28520649/define-data-type-and-use-in-function/28520717#28520717", "title": "Define data type and use in function", "body": "<p>As you have defined it, the <code>Quartet</code> value constructor takes one argument, which is a 4-tuple. You could also define it like this:</p>\n\n<pre><code>data Quartet = Quartet Int Int Bool Bool\n</code></pre>\n\n<p>and it will work pretty much the same except the pattern matching will be slightly different.</p>\n\n<p>You can also make a type synonym for 4-tuples of this particular type:</p>\n\n<pre><code>type Quartet = (Int, Int, Bool, Bool)\n</code></pre>\n\n<p>If you opt for this final approach, your functions will work just as you've written them, because pattern matching in this last case is nothing more than matching against a plain tuple.</p>\n\n<p>However, if you use either of the first two cases, the key idea is that in your function definition, you have to pattern match the value constructor, so you need to include the <code>Quartet</code> value constructor as part of the pattern:</p>\n\n<pre><code>--firstPair :: Quartet -&gt; [Int, Int]\nfirstPair (Quartet (a, b, _, _)) = [a, b]\n\n--secondPair :: Quartet -&gt; [Bool, Bool]\nsecondPair (Quartet (_, _, a, b)) = [a, b]\n</code></pre>\n"}], "owner": {"reputation": 2338, "user_id": 1729641, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/NIClY.png?s=128&g=1", "display_name": "Tymek", "link": "https://stackoverflow.com/users/1729641/tymek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1423950747, "creation_date": 1423950239, "question_id": 28520649, "link": "https://stackoverflow.com/questions/28520649/define-data-type-and-use-in-function", "title": "Define data type and use in function", "body": "<p>How should I define tuple type <code>Quartet</code>, that will contain four elements \u2013 two <code>Integral</code>s and two <code>Boolean</code>s, and functions <code>firstTwo</code> returning table of Integrals and <code>secondTwo</code> returning table of two Booleans?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Quartet = Quartet (Int, Int, Bool, Bool)\n\n--firstPair :: Quartet -&gt; [Int, Int]\nfirstPair (a, b, _) = [a, b]\n\n--secondPair :: Quartet -&gt; [Bool, Bool]\nsecondPair (_, _, a, b) = [a, b]\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 177, "user_id": 3762988, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1f24a8e49937146b135b489344d785b?s=128&d=identicon&r=PG&f=1", "display_name": "MazaYong", "link": "https://stackoverflow.com/users/3762988/mazayong"}, "edited": false, "score": 0, "creation_date": 1423950210, "post_id": 28520619, "comment_id": 45358015, "body": "Thank you, I understand it better now :) I&#39;ve also noticed that I should fix (xs) part to (Graph (xs)) too."}], "tags": [], "owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "is_accepted": true, "score": 2, "last_activity_date": 1423950269, "last_edit_date": 1423950269, "creation_date": 1423949965, "answer_id": 28520619, "question_id": 28520560, "link": "https://stackoverflow.com/questions/28520560/couldnt-match-expected-type-with-actual-type/28520619#28520619", "title": "Couldn&#39;t match expected type with actual type", "body": "<p>Your function expects the first argument to be of type <code>Graph</code>. As <code>Graph</code> is defined, there is only one way to do this: with the <code>Graph</code> value constructor (the ocurrence of the word <code>'Graph'</code> on the <em>right hand side</em> of the <code>=</code> in the <code>data</code> definition).</p>\n\n<p>However, the pattern match you are trying to perform pretends like the first argument is plain <code>List</code>, instead of a <code>List</code> that has been made part of the <code>Graph</code> value constructor.</p>\n\n<p>The pattern match should be for <code>(Graph (x:xs))</code> and also the recursive call in the <code>else</code> clause should use <code>(Graph xs)</code> like this:</p>\n\n<pre><code>pointNeighbor :: Graph Point -&gt; Point -&gt; [Point]\npointNeighbor (Graph (x:xs)) point = \n    if fst x == point \n        then snd x \n        else pointNeighbor (Graph xs) point\n</code></pre>\n\n<p>Note also that you don't define a base case when the list is empty.</p>\n"}, {"comments": [{"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 0, "creation_date": 1423950133, "post_id": 28520620, "comment_id": 45358005, "body": "I just realized that my solution, like yours, needs another use of <code>Graph</code> around the recursive call to <code>pointNeighbor</code> in the <code>else</code> clause ... <code>(Graph xs)</code> or the recursive call will suffer the same fate as the OP&#39;s original."}, {"owner": {"reputation": 177, "user_id": 3762988, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1f24a8e49937146b135b489344d785b?s=128&d=identicon&r=PG&f=1", "display_name": "MazaYong", "link": "https://stackoverflow.com/users/3762988/mazayong"}, "edited": false, "score": 0, "creation_date": 1423950342, "post_id": 28520620, "comment_id": 45358053, "body": "Thank you, I understand it better now :)"}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 2, "last_activity_date": 1423949975, "creation_date": 1423949975, "answer_id": 28520620, "question_id": 28520560, "link": "https://stackoverflow.com/questions/28520560/couldnt-match-expected-type-with-actual-type/28520620#28520620", "title": "Couldn&#39;t match expected type with actual type", "body": "<p>Because <code>Graph</code> is a data constructor, you have to pattern match against it:</p>\n\n<pre><code>pointNeighbor :: Graph Point -&gt; Point -&gt; [Point]\npointNeighbor (Graph (x:xs)) point = if fst x == point then snd x else pointNeighbor (Graph xs) point\n               ^^^^^                                                                  ^^^^^\n</code></pre>\n"}], "owner": {"reputation": 177, "user_id": 3762988, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1f24a8e49937146b135b489344d785b?s=128&d=identicon&r=PG&f=1", "display_name": "MazaYong", "link": "https://stackoverflow.com/users/3762988/mazayong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1617, "favorite_count": 0, "accepted_answer_id": 28520619, "answer_count": 2, "score": 1, "last_activity_date": 1423950269, "creation_date": 1423949525, "question_id": 28520560, "link": "https://stackoverflow.com/questions/28520560/couldnt-match-expected-type-with-actual-type", "title": "Couldn&#39;t match expected type with actual type", "body": "<p>I've recently started learning Haskell and is having trouble figuring out what is wrong with my code but ended up in failure.</p>\n\n<p>This is part of my code showing that I've declared data Constructor for Graph type, which is a list of tuple of a value and a list of that value.</p>\n\n<pre><code>data Graph a = Graph [(a,[a])] deriving (Ord, Eq, Show)\n</code></pre>\n\n<p>This is type synonym for tuple of two ints, </p>\n\n<pre><code>type Point = (Int, Int)\n</code></pre>\n\n<p>And finally this code is to find second argument of a graph using first argument(i.e searching / hashing value)</p>\n\n<pre><code>pointNeighbor :: Graph Point -&gt; Point -&gt; [Point]\npointNeighbor (x:xs) point = if fst x == point then snd x else pointNeighbor (xs) point\n</code></pre>\n\n<p>This is the error message I get when I try to load module</p>\n\n<blockquote>\n  <p>hw1.hs:37:16:\n      Couldn't match expected type \u2018Graph Point\u2019\n                  with actual type \u2018[(Point, [Point])]\u2019\n      In the pattern: x : xs\n      In an equation for \u2018pointNeighbor\u2019:\n          pointNeighbor (x : xs) point\n            = if fst x == point then snd x else pointNeighbor (xs) point</p>\n  \n  <p>hw1.hs:37:79:\n      Couldn't match expected type \u2018Graph Point\u2019\n                  with actual type \u2018[(Point, [Point])]\u2019\n      In the first argument of \u2018pointNeighbor\u2019, namely \u2018(xs)\u2019\n      In the expression: pointNeighbor (xs) point</p>\n</blockquote>\n\n<p>It seems like Graph Point should be recognized as [(Point,[Point])] but apparently it is giving me this error and I can't find any solution on web. </p>\n\n<p>Thanks in advance :)</p>\n"}, {"tags": ["haskell", "file-io"], "comments": [{"owner": {"reputation": 490, "user_id": 635669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0408d7a07f6d5460814d9016aef947c?s=128&d=identicon&r=PG", "display_name": "Guiraldelli", "link": "https://stackoverflow.com/users/635669/guiraldelli"}, "edited": false, "score": 0, "creation_date": 1423955876, "post_id": 28520406, "comment_id": 45359425, "body": "First thing I have noticed and I think you should get rid of: <code>let intList = []</code>. Haskell is an <a href=\"https://en.wikipedia.org/wiki/Immutable_object\" rel=\"nofollow noreferrer\">immutable</a> language and, hence, you don&#39;t have to (actually, you can&#39;t) define a value of a variable before its use: once you set a value, you won&#39;t be able to change it. In your case it works because you&#39;re inside the <code>do</code> block, but get rid of this habit as soon as you can. :)"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1423948758, "creation_date": 1423948758, "answer_id": 28520444, "question_id": 28520406, "link": "https://stackoverflow.com/questions/28520406/how-to-return-the-list-formed-in-haskell-from-file/28520444#28520444", "title": "How to return the list formed in haskell from file?", "body": "<p>Try this:</p>\n\n<pre><code>listfromfile = do\n           ...\n           return (foldl insertBST Nil intList)\n</code></pre>\n\n<p>You should also add some type signature to your definition. E.g.</p>\n\n<pre><code>listfromfile :: IO (MyBST Int)\n</code></pre>\n\n<p>It's not strictly needed, but it is a very common practice to add, since it serves as documentation.</p>\n"}], "owner": {"reputation": 235, "user_id": 3213348, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/ac84bd452c178db7fd06c5182af30c1c?s=128&d=identicon&r=PG&f=1", "display_name": "user3213348", "link": "https://stackoverflow.com/users/3213348/user3213348"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1423948758, "creation_date": 1423948495, "question_id": 28520406, "link": "https://stackoverflow.com/questions/28520406/how-to-return-the-list-formed-in-haskell-from-file", "title": "How to return the list formed in haskell from file?", "body": "<p>I am trying to create BST by reading the numbers from file. I am able to read the file and form the list. But I cannot seem to do anything like return to create the BST. </p>\n\n<p>The following is the code:</p>\n\n<pre><code>listfromfile = do\n           let intList = []\n           fhandle &lt;- openFile \"randNumbers.txt\" ReadMode\n           contents &lt;- hGetContents fhandle\n           let wordList = words contents\n               intList = stringListToInt wordList\n           print intList\n           hClose fhandle\n           foldl insertBST Nil intList\n\nstringListToInt :: [String] -&gt; [Int]\nstringListToInt = map read\n</code></pre>\n\n<p>Error says cannot match expected type. Essentially I want to return the bst created. </p>\n"}, {"tags": ["haskell", "vector"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1423945491, "post_id": 28519899, "comment_id": 45356679, "body": "What do you mean by vector? Please be specific..."}, {"owner": {"reputation": 62908, "user_id": 567620, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/g8HIM.jpg?s=128&g=1", "display_name": "ely", "link": "https://stackoverflow.com/users/567620/ely"}, "edited": false, "score": 3, "creation_date": 1423945647, "post_id": 28519899, "comment_id": 45356729, "body": "First you&#39;re going to need a way to get science numbers in Haskell. It unfortunately only has limited-precision numeric types, not actual real numbers or complex numbers like science does. This could be a good reason to create a science-to-haskell compiler."}, {"owner": {"reputation": 9855, "user_id": 7780, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf9668c1ebea8ecea9f1ac4474236b5e?s=128&d=identicon&r=PG", "display_name": "dsm", "link": "https://stackoverflow.com/users/7780/dsm"}, "edited": false, "score": 0, "creation_date": 1423946600, "post_id": 28519899, "comment_id": 45356972, "body": "To make a &quot;Math&quot; vector you just need a type with two fields: magnitude and direction. Is this what you mean?"}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 3, "creation_date": 1423946648, "post_id": 28519899, "comment_id": 45356985, "body": "<a href=\"http://hackage.haskell.org/package/linear\" rel=\"nofollow noreferrer\">linear</a> might interest you."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423946705, "post_id": 28519899, "comment_id": 45357006, "body": "I would be surprised if on Hackage there isn&#39;t already a package defining a vector type with the usual linear operations. I&#39;m not familiar with such packages, but surely a linear algebra package is present."}, {"owner": {"reputation": 1649, "user_id": 2394634, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/GhVqX.jpg?s=128&g=1", "display_name": "147pm", "link": "https://stackoverflow.com/users/2394634/147pm"}, "reply_to_user": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1423947412, "post_id": 28519899, "comment_id": 45357228, "body": "@MasterMastic This seems to be the boy. Thanks."}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1423950875, "post_id": 28519899, "comment_id": 45358186, "body": "@LawrenceBottorff Great, I&#39;ll post it as an answer in a moment with some extra details."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1423955086, "post_id": 28520853, "comment_id": 45359203, "body": "C++? Unlikely in the extreme. C++ didn&#39;t even have templates until C++ 2.0 in 1989. The Revised^3 Report on the Algorithmic Language Scheme came out in 1986 and already used the term &quot;vector&quot; this way. I seriously doubt it was the first. The best I can gather is that the term &quot;vector&quot; has been used to refer to one-dimensional arrays for a long time, probably going back to early FORTRAN and APL, but I couldn&#39;t guarantee it."}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423957278, "post_id": 28520853, "comment_id": 45359754, "body": "@dfeuer That&#39;s good to know +1, however I&#39;m not referring to the first appearance of the term in that context. I mean that it makes sense to me that modern languages (and packages in this case) still keep naming it as they do because of the C++ standard library; C++ is directly influencing a real lot, from what I can tell FORTAN, for example -- not so much (I&#39;m sure it does indirectly). I&#39;m a new blood though, so I may be completely off-based. In either case thank you, I had no idea of what you said."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423958946, "post_id": 28520853, "comment_id": 45360119, "body": "Well, the thing is that Haskell and C++ are about as far from each other as any two typed programming languages can be. Haskell is a functional language (thus coming somewhat from the Lisp tradition, but more directly from Miranda, and I imagine likely influenced by ML). Haskell&#39;s type system also puts it in contact, to some degree, with the logic programming tradition, which goes back to Prolog. The combination of (relative) purity and strong typing also ties it to proof languages like Coq and Agda. C++ comes from a very different direction, more Algol, BCPL, Fortran, PL/I."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423959074, "post_id": 28520853, "comment_id": 45360143, "body": "There are certainly things that cross over from one language group to another from time to time, but it seems, to me, more likely that Haskell would steal terminology from something more closely related than a distant step-cousin twice removed, when in fact more closely related languages <i>have</i> used the term &quot;vector&quot; in that way for many years."}], "tags": [], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "is_accepted": false, "score": 1, "last_activity_date": 1423951710, "last_edit_date": 1495540171, "creation_date": 1423951710, "answer_id": 28520853, "question_id": 28519899, "link": "https://stackoverflow.com/questions/28519899/haskell-vector-not-scientific-engineering-vectors/28520853#28520853", "title": "Haskell Vector: not scientific, engineering vectors?", "body": "<p>I assume you are referring to <a href=\"http://hackage.haskell.org/package/vector/docs/Data-Vector.html\" rel=\"nofollow noreferrer\"><code>Data.Vector</code></a>, and yes, you're right. It's not the vector the mathematical parts of us know. For a \"legit\" vector and any other linear algebra on free vector spaces there is the <a href=\"http://hackage.haskell.org/package/linear\" rel=\"nofollow noreferrer\">linear</a> package.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/vector/docs/Data-Vector.html\" rel=\"nofollow noreferrer\"><code>Data.Vector</code></a> is pretty much a memory array (very optimized, very good API).</p>\n\n<hr />\n\n<p><a href=\"http://hackage.haskell.org/package/vector/docs/Data-Vector.html\" rel=\"nofollow noreferrer\"><code>Data.Vector</code></a> really is a misleading name, and I assume it's directly or indirectly inspired from C++'s standard library <a href=\"http://www.cplusplus.com/reference/vector/vector/\" rel=\"nofollow noreferrer\">vector</a> class template which is also misleading.</p>\n\n<p>From <a href=\"https://stackoverflow.com/a/758548/825637\">here</a>, in C++'s standard library...</p>\n\n<blockquote>\n  <p>It's called a vector because Alex Stepanov, the designer of the\n  Standard Template Library, was looking for a name to distinguish it\n  from built-in arrays. He admits now that he made a mistake, because\n  mathematics already uses the term 'vector' for a fixed-length sequence\n  of numbers.<br />\n  ...<br />\n  Alex's lesson: be very careful every time you name something.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 4568413, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/48c1e90404525af360bf566ead5dbf41?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/4568413/lemming"}, "is_accepted": false, "score": 0, "last_activity_date": 1423991482, "creation_date": 1423991482, "answer_id": 28524602, "question_id": 28519899, "link": "https://stackoverflow.com/questions/28519899/haskell-vector-not-scientific-engineering-vectors/28524602#28524602", "title": "Haskell Vector: not scientific, engineering vectors?", "body": "<p>I guess you want hmatrix, a Haskell interface to LAPACK and BLAS.</p>\n"}], "owner": {"reputation": 1649, "user_id": 2394634, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/GhVqX.jpg?s=128&g=1", "display_name": "147pm", "link": "https://stackoverflow.com/users/2394634/147pm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1423991482, "creation_date": 1423945310, "question_id": 28519899, "link": "https://stackoverflow.com/questions/28519899/haskell-vector-not-scientific-engineering-vectors", "title": "Haskell Vector: not scientific, engineering vectors?", "body": "<p>When I see Haskell's Vector, that's not a physics, linear algebra vector, is it? Vectors in Java (as I recall) is an array one can dynamically add to. But that's not usable as a science vector, is it? How could I have a science vector data structure in Haskell?</p>\n"}, {"tags": ["opengl", "haskell", "gloss", "openglraw"], "answers": [{"tags": [], "owner": {"reputation": 1106, "user_id": 440753, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b239d4f03d117b19b981cc8e4533fb8?s=128&d=identicon&r=PG&f=1", "display_name": "Gareth Charnock", "link": "https://stackoverflow.com/users/440753/gareth-charnock"}, "is_accepted": false, "score": 17, "last_activity_date": 1423934652, "creation_date": 1423934652, "answer_id": 28518169, "question_id": 28518168, "link": "https://stackoverflow.com/questions/28518168/missing-c-library-gl-when-installing-gloss-specifically-the-openglraw-depe/28518169#28518169", "title": "&quot;* Missing C library: GL&quot; when installing gloss (specifically the OpenGLRaw dependency) on Ubuntu", "body": "<p>With most missing C libraries it's obvious what to install; no so for openGL. For me, installing following packages got things moving again.</p>\n\n<pre><code>sudo apt-get install freeglut3 freeglut3-dev\n</code></pre>\n"}], "owner": {"reputation": 1106, "user_id": 440753, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b239d4f03d117b19b981cc8e4533fb8?s=128&d=identicon&r=PG&f=1", "display_name": "Gareth Charnock", "link": "https://stackoverflow.com/users/440753/gareth-charnock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2807, "favorite_count": 0, "answer_count": 1, "score": 10, "last_activity_date": 1423934652, "creation_date": 1423934652, "question_id": 28518168, "link": "https://stackoverflow.com/questions/28518168/missing-c-library-gl-when-installing-gloss-specifically-the-openglraw-depe", "title": "&quot;* Missing C library: GL&quot; when installing gloss (specifically the OpenGLRaw dependency) on Ubuntu", "body": "<p>I get the following error when trying to install gloss:</p>\n\n<pre><code>Configuring OpenGLRaw-1.5.0.1...\nFailed to install OpenGLRaw-1.5.0.1\nBuild log ( /home/&lt;homdir&gt;/.cabal/logs/OpenGLRaw-1.5.0.1.log ):\nConfiguring OpenGLRaw-1.5.0.1...\nsetup-Simple-Cabal-1.18.1.5-x86_64-linux-ghc-7.8.4: Missing dependency on a\nforeign library:\n* Missing C library: GL\nThis problem can usually be solved by installing the system package that\nprovides this library (you may need the \"-dev\" version). If the library is\nalready installed but in a non-standard location then you can use the flags\n</code></pre>\n\n<p>Normally I would try installing <code>libgl-dev</code> based on the usual naming convention, but there is no such library.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1423933172, "post_id": 28517459, "comment_id": 45352975, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/10672981/export-template-haskell-generated-definitions\">Export template haskell generated definitions</a>"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423933215, "post_id": 28517459, "comment_id": 45352988, "body": "This seems like it would be a problem for anything using template haskell, not just fclabels."}], "owner": {"reputation": 28845, "user_id": 238232, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/ccda2293fc93c7a871956102004ac19d?s=128&d=identicon&r=PG", "display_name": "cnd", "link": "https://stackoverflow.com/users/238232/cnd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 2, "answer_count": 0, "score": 1, "last_activity_date": 1423930449, "creation_date": 1423930110, "last_edit_date": 1423930449, "question_id": 28517459, "link": "https://stackoverflow.com/questions/28517459/how-to-automatically-export-modified-with-fclabels-data-fields", "title": "How to automatically export modified with fclabels data fields?", "body": "<p>For example if I have:</p>\n\n<p>fclabels on hackage: <a href=\"https://hackage.haskell.org/package/fclabels\" rel=\"nofollow\">https://hackage.haskell.org/package/fclabels</a></p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, TypeOperators #-}\nmodule Yaml\n  ( Config(..) )\n  where\n\ndata Config = Config { _a :: String }\n\n$(mkLabel ''Config)\n</code></pre>\n\n<p><code>_a</code> is exported because of <code>Config(..)</code> there in line 3, I can also add <code>a</code> there for manual exporting but is it possible to export all generated with <code>mkLabel</code> fields automatically?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 6, "last_activity_date": 1423930200, "last_edit_date": 1423930200, "creation_date": 1423929504, "answer_id": 28517370, "question_id": 28517053, "link": "https://stackoverflow.com/questions/28517053/is-it-possible-to-implement-maybet-with-applicative-only/28517370#28517370", "title": "Is it possible to implement MaybeT with Applicative only?", "body": "<p>I think you do need <code>Monad</code>. Basically, if you have</p>\n\n<pre><code>f :: MaybeT m (a -&gt; b)\nx :: MaybeT m a\n</code></pre>\n\n<p>and if, when evaluating <code>f &lt;*&gt; x</code>, running the unwrapped <code>f</code> in <code>m</code> returns a <code>Nothing</code>, then the action for <code>x</code> shouldn't run at all - but you cannot achieve that without using that <code>m</code> is a <code>Monad</code>, since <code>Applicative</code> combinators intuitively always run all the subactions.</p>\n\n<p>By the way, the simplest way to generate an <code>Applicative</code> just to satisfy the new AMP requirement, is to use</p>\n\n<pre><code>import Control.Monad (ap)\n\ninstance Applicative ... where\n    pure = return\n    (&lt;*&gt;) = ap\n</code></pre>\n\n<p>For <code>Functor</code> you can either use <code>fmap = liftM</code>, or the <code>DeriveFunctor</code> extension.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1423938926, "post_id": 28517607, "comment_id": 45354739, "body": "The problem with this, as &#216;rjan Johansen explains in their answer, is that it doesn&#39;t short-circuit as expected\u2014<code>runMaybeT x</code> will be run even if <code>runMaybeT f</code> produces <code>Nothing</code>. Of course, your application may not care, but this is incompatible with the <code>Monad</code> instance of <code>MaybeT m</code>. The laws for the classes specify that (at least &quot;morally&quot;), <code>(&lt;*&gt;)=ap</code>. So if you use this <code>Applicative</code> instance, you must use a matching <code>Monad</code> instance as well."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423942984, "post_id": 28517607, "comment_id": 45355943, "body": "@dfeuer, thanks for the correction. I edited the answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423944065, "post_id": 28517607, "comment_id": 45356263, "body": "Er ... forget that deleted comment. I do think you probably should remove/modify the bit about &quot;strictness&quot;, since this isn&#39;t a strictness issue, per se, although it can affect strictness."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423945204, "post_id": 28517607, "comment_id": 45356587, "body": "@dfeuer, I haven&#39;t seen a comment about strictness, that&#39;s just my understanding of what&#39;s going on. The second argument of <code>(&lt;*&gt;)</code> is forced, while it shouldn&#39;t. Could you explain, what is wrong?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1423945389, "post_id": 28517607, "comment_id": 45356646, "body": "Well, as your own example indicates, the issue is not that a thunk is <i>forced</i>, but rather that a monadic action is <i>executed</i>."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423946562, "post_id": 28517607, "comment_id": 45356960, "body": "@dfeuer, I confused two concepts. Thanks again."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 3, "last_activity_date": 1423946447, "last_edit_date": 1495542617, "creation_date": 1423931042, "answer_id": 28517607, "question_id": 28517053, "link": "https://stackoverflow.com/questions/28517053/is-it-possible-to-implement-maybet-with-applicative-only/28517607#28517607", "title": "Is it possible to implement MaybeT with Applicative only?", "body": "<p><code>MaybeT</code> could be defined as</p>\n\n<pre><code>newtype Compose f g x = Composed (f (g x))\nnewtype MaybeT m x = MaybeT (Compose m Maybe x)\n</code></pre>\n\n<p>and applicatives do <a href=\"https://stackoverflow.com/questions/7040844/applicatives-compose-monads-dont\">compose</a>. Hence you can write an applicative instance for <code>MaybeT</code> like this:</p>\n\n<pre><code>instance Applicative m =&gt; Applicative (MaybeT m) where\n  pure = MaybeT . pure . Just\n  f &lt;*&gt; x = MaybeT $ (&lt;*&gt;) &lt;$&gt; runMaybeT f &lt;*&gt; runMaybeT x\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>As @\u00d8rjan Johansen and @dfeuer explain, this is not a true instance for the <code>MaybeT</code> transformer, since the definition of <code>(&lt;*&gt;)</code> violates the <code>f &lt;*&gt; x == ap f x</code> law. Here is an example:</p>\n\n<pre><code>test :: MaybeT IO ()\ntest = MaybeT (return Nothing) &lt;*&gt; MaybeT (putStrLn \"test\" &gt;&gt; return Nothing)\n\nmain = runMaybeT test\n</code></pre>\n\n<p>This code prints <code>test</code> with my wrong definition and doesn't print anything with the right one.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 1, "accepted_answer_id": 28517370, "answer_count": 2, "score": 3, "last_activity_date": 1448926021, "creation_date": 1423927308, "question_id": 28517053, "link": "https://stackoverflow.com/questions/28517053/is-it-possible-to-implement-maybet-with-applicative-only", "title": "Is it possible to implement MaybeT with Applicative only?", "body": "<p>After revisiting my <code>MaybeT</code> excercise I got warning that I should also have <code>Applicative</code> instance. I tried to implement it but got stuck as I cannot find way to apply <code>m x</code> to <code>m f</code> with <code>Applicative m</code>. Do I need <code>Monad m</code>?</p>\n\n<pre><code>newtype MaybeT m x = MaybeT { runMaybeT :: m (Maybe x) }\n\ninstance Functor m =&gt; Functor (MaybeT m) where\n  fmap f m = MaybeT $ fmap z $ runMaybeT m where\n    z (Just x) = Just $ f x\n    z Nothing = Nothing\n\ninstance Applicative m =&gt; Applicative (MaybeT m)\n</code></pre>\n"}, {"tags": ["haskell", "comonad", "tying-the-knot"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1423927416, "post_id": 28516819, "comment_id": 45351338, "body": "At a glance it seems to me that &quot;rat race&quot; has a 2D field. How does that map to the 1D zipper?"}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1423933599, "post_id": 28516819, "comment_id": 45353080, "body": "I simplified it for Stackoverflow. I use a 2-dimensional field <code>U2</code> that <a href=\"http://blog.sigfpe.com/2006/12/evaluating-cellular-automata-is.html#c3054291011950765946\" rel=\"nofollow noreferrer\">Dan Pipponi explains in the comments</a>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1423940103, "post_id": 28516819, "comment_id": 45355083, "body": "I don&#39;t  know just what a comonad is or why it&#39;s important, but it seems pretty clear that you haven&#39;t included enough information in this question. 1. What does the <code>Comonad</code> instance declaration for <code>U</code> look like? 2. What knot are you trying to tie, exactly? I see now that Cirdec has (probably) read your mind and come up with an answer, but these details should be in the question."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1423940727, "post_id": 28516819, "comment_id": 45355265, "body": "@dfeuer The <code>Comonad</code> instance for <code>Zipper</code>s (<code>U</code> is the zipper for a list) is treated everywhere like it&#39;s well known, which means its hard to find the definition for it anywhere. I see now that there&#39;s a definition in the linked <a href=\"http://blog.sigfpe.com/2006/12/evaluating-cellular-automata-is.html\" rel=\"nofollow noreferrer\">comonad article</a> from &quot;A Neighborhood of Infinity&quot;. I reinvented the <code>Comonad</code> instance for zippers for my answer. The <a href=\"http://stackoverflow.com/questions/25554062/zipper-comonads-generically\">comonad instance for the zipper for a differentiable type</a> can be derived generically."}], "answers": [{"comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 4, "creation_date": 1423941137, "post_id": 28519019, "comment_id": 45355381, "body": "But this doesn&#39;t tie the knot, does it? The OP explicitly stated &quot;I want to be really sure that circles actually point to the same thunk.&quot;."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1423941309, "post_id": 28519019, "comment_id": 45355444, "body": "@PetrPudl&#225;k Ahh, then I will need to go further with the answer."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1423946657, "post_id": 28519019, "comment_id": 45356988, "body": "@PetrPudl&#225;k There&#39;s no need to tie a knot for this problem. I have edited my answer to explain why."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1423947562, "post_id": 28519019, "comment_id": 45357289, "body": "@Franky If what you really want to do is build a graph in memory I can write another answer for that. The two-dimensional case of building a graph is much more challenging than the one-dimensional one."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 2, "last_activity_date": 1423946618, "last_edit_date": 1423946618, "creation_date": 1423939974, "answer_id": 28519019, "question_id": 28516819, "link": "https://stackoverflow.com/questions/28516819/tie-the-knot-in-2-dimensions-was-tying-the-knot-with-a-comonad/28519019#28519019", "title": "Tie-the-knot in 2 dimensions (was: tying the knot with a comonad)", "body": "<p>The whole problem will be easier with the <code>Comonad</code> instance for <code>U</code>. We'll use the <code>Comonad</code> class from <a href=\"https://hackage.haskell.org/package/comonad\" rel=\"nofollow\">comonad</a>.</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\nimport Data.List\nimport Control.Comonad\n\ndata U a = U [a] a [a]\n    deriving (Functor)\n</code></pre>\n\n<p>There are two main things you can do with a zipper besides the <code>Comonad</code> methods. You can move towards the left or move towards the right. Both of these can fail if there's nothing remaining on the left or right side.</p>\n\n<pre><code>moveLeft :: U a -&gt; Maybe (U a)\nmoveLeft (U (l:ls) h r) = Just $ U ls l (h:r)\nmoveLeft u              = Nothing\n\nmoveRight :: U a -&gt; Maybe (U a)\nmoveRight (U l h (r:rs)) = Just $ U (h:l) r rs\nmoveRight u              = Nothing\n</code></pre>\n\n<p>The interesting part of <code>Comonad</code> is <code>duplicate :: w a -&gt; w (w a)</code> which builds a structure holding the context in every location. We can define <code>duplicate</code> for the <code>Comonad</code> instance in terms of unfolding <code>moveLeft</code> and <code>moveRight</code>.</p>\n\n<pre><code>instance Comonad U where\n    extract (U _ here _) = here\n    duplicate u = U (unfoldr (fmap dup . moveLeft) u) u (unfoldr (fmap dup . moveRight) u)\n        where\n            dup x = (x, x)\n</code></pre>\n\n<p>We are going to tackle the problem implied by your <code>tieKnot</code>. The <code>duplicate</code> we wrote for the <code>Comonad</code> instance for <code>U</code> is going to solve all of your problems - we don't need a <code>FullCell</code> data type at all. You have some function <code>limitTo5x5 :: U Int -&gt; [[Int]]</code>, an instance of a specific subtype of <code>U a -&gt; b</code>.</p>\n\n<pre><code>limitTo5x5 :: U Int -&gt; [[Int]]\nlimitTo5x5 = undefined\n</code></pre>\n\n<p>If we first <code>duplicate</code> the <code>U Int</code> we will have a zipper holding the complete context in every location. If we then <code>fmap limitTo5x5</code> over this we will have a zipper holding the results</p>\n\n<pre><code>tieKnot :: U Int -&gt; U [[Int]]\ntieKnot = fmap limitTo5x5 . duplicate\n</code></pre>\n\n<p>This pattern, <code>fmap f . duplicate</code>, is the <code>Comonad</code>'s dual to <code>Monad</code>s bind, <code>&gt;&gt;=</code>. In the <code>Comonad</code> class it's called <code>extend f = fmap f . duplicate</code>.</p>\n\n<pre><code>tieKnot :: U Int -&gt; U [[Int]]\ntieKnot = extend limitTo5x5\n</code></pre>\n\n<p>It's time for us to make a critical observation. When we built the outer <code>U</code> in <code>duplicate</code>, we only ever constructed a single <code>U _ _ _ :: U (U a)</code>. There's only one of them, and it doesn't recursively need to refer to anything else. We can freely move left and right along the resulting zipper without any large costs. Each time we move we need to allocate a <code>U</code> and a list cons <code>(:)</code> and simultaneously free up a <code>U</code> and a list cons.</p>\n"}, {"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1423957024, "post_id": 28521443, "comment_id": 45359694, "body": "@dfeuer What happened to all of your interesting comments on my other answer? Perhaps they belong with this answer instead? I agree that building a graph for 2d will require forcing <code>O(n^2)</code> memory when traversing paths of length <code>n</code>. In this specific case, I believe Franky is planning on using zippers for nested lists, so there&#39;s a spine of the outer list that can be relied on to simplify what needs to be forced to the nodes between the path and the spine, which should be a small constant (about 4) times less to force than forcing a spiral."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1423958292, "post_id": 28521443, "comment_id": 45359974, "body": "Cirdec, I deleted them because some of them seemed non-constructive and I thought some of them might be wrong. I no longer believe O(n^2) memory will be needed for that, but I could be wrong. I&#39;m considering using <code>data Ring a = Ring a a a a a a a a</code> (8 \u0fbe <code>a</code>) with <code>data Grid a = Grid a (Grid (Ring a))</code> to make a structure reminiscent of a random-access list (a la Okasaki PFDS or Hinze Numerical Representations ...). Zip to the center of a grid section, then zip out/zoom in from there. Not sure if the idea works, but I think it may give asymptotically better allocation."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423959448, "post_id": 28521443, "comment_id": 45360210, "body": "That is, asymptotically better when only accessing a portion of the structure. Still working out the details, and devils lie in those."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1423959799, "post_id": 28521443, "comment_id": 45360285, "body": "That type I suggested is wrong, but I still think the idea makes sense. Start with a central square. Surround it with 8 squares. Now make 8 things like that and surround with them. Then repeat ad infinitum. Dealing with a finite grid will be more complicated than I can handle, so I&#39;m attempting the case where the grid extends forever in all directions."}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1424016908, "post_id": 28521443, "comment_id": 45371603, "body": "@Cirdec that helped a lot. For the final step, see my edited question, I do not think it that fits into a comment."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1423968101, "last_edit_date": 1495542339, "creation_date": 1423956598, "answer_id": 28521443, "question_id": 28516819, "link": "https://stackoverflow.com/questions/28516819/tie-the-knot-in-2-dimensions-was-tying-the-knot-with-a-comonad/28521443#28521443", "title": "Tie-the-knot in 2 dimensions (was: tying the knot with a comonad)", "body": "<p>It's possible to build a graph from a zipper so that moving around on the graph doesn't require allocating new memory. This can be a performance improvement if you are going to hold on to multiple pointers into the structure.</p>\n\n<p>We'll start with the zipper for lists.</p>\n\n<pre><code>data U a = U [a] a [a]\n</code></pre>\n\n<p>The corresponding graph holds references to the nodes to the left and right, if they exist.</p>\n\n<pre><code>data UGraph a = UGraph {\n    _left :: Maybe (UGraph a),\n    _here :: a,\n    _right :: Maybe (UGraph a)\n    }\n</code></pre>\n\n<p>Any instances of this structure should obey the following laws, which say that going one direction and then back the other brings you back to where you started.</p>\n\n<pre><code>_right &gt;=&gt; _left  == \\x -&gt; (_right &gt;=&gt; const (return x)) x\n_left  &gt;=&gt; _right == \\x -&gt; (_left  &gt;=&gt; const (return x)) x\n</code></pre>\n\n<p>The <code>UGraph</code> data type doesn't enforce this, so it would be wise to put it in a module and not export the <code>UGraph</code> constructor.</p>\n\n<p>To convert a zipper to a graph we start in the middle and work our way out both sides. We tie recursive knots between the already built portion of the graph and the parts of the graph that haven't already been built.</p>\n\n<pre><code>toUGraph :: U a -&gt; UGraph a\ntoUGraph (U ls h rs) = g\n    where\n        g = UGraph (build ugraph' g ls) h (build UGraph g rs)\n        ugraph' r h l = UGraph l h r\n        build _ _    []          = Nothing\n        build f prev (here:next) = Just g\n            where\n                g = f (Just prev) here (build f g next)\n</code></pre>\n\n<p>Combined with <a href=\"https://stackoverflow.com/a/28519019/414413\">my other answer</a>, you can build a graph of the visible portions of your <code>U Int</code> with</p>\n\n<pre><code>tieKnot :: U Int -&gt; UGraph [[Int]]\ntieKnot = toUGraph . extend limitTo5x5\n</code></pre>\n\n<h2>Two dimensions</h2>\n\n<p>Ultimately you want to build a 2d field. Building a graph like we did for the one dimensional list zipper in two dimensions is much trickier, and in general will require forcing <code>O(n^2)</code> memory to traverse arbitrary paths of length <code>n</code>.</p>\n\n<p>You plan on using the <a href=\"http://blog.sigfpe.com/2006/12/evaluating-cellular-automata-is.html#c3054291011950765946\" rel=\"nofollow noreferrer\">two-dimensional list zipper Dan Piponi described</a>, so we'll reproduce it here.</p>\n\n<pre><code>data U2 a = U2 (U (U a))\n</code></pre>\n\n<p>We might be tempted to make a graph for <code>U2</code> that's a straight up analog</p>\n\n<pre><code>data U2Graph a = U2Graph (UGraph (UGraph a))\n</code></pre>\n\n<p>This has a fairly complicated structure. Instead, we're going to do something much simpler. A node of the graph corresponding to <code>U2</code> will hold references to adjacent nodes in each of the four cardinal directions, if those nodes exist.</p>\n\n<pre><code>data U2Graph a = U2Graph {\n    _down2  :: Maybe (U2Graph a),\n    _left2  :: Maybe (U2Graph a),\n    _here2  :: a,\n    _right2 :: Maybe (U2Graph a),\n    _up2    :: Maybe (U2Graph a)\n    }\n</code></pre>\n\n<p>Instances of <code>U2Graph</code> should obey the same bidirectional iterator laws we defined for <code>UGraph</code>. Once again, the structure doesn't enforce these laws itself, so the <code>U2Graph</code> constructor probably shouldn't be exposed.</p>\n\n<pre><code>_right2 &gt;=&gt; _left2  == \\x -&gt; (_right2 &gt;=&gt; const (return x)) x\n_left2  &gt;=&gt; _right2 == \\x -&gt; (_left2  &gt;=&gt; const (return x)) x\n_up2    &gt;=&gt; _down2  == \\x -&gt; (_up2    &gt;=&gt; const (return x)) x\n_down2  &gt;=&gt; _up2    == \\x -&gt; (_down2  &gt;=&gt; const (return x)) x\n</code></pre>\n\n<p>Before we convert a <code>U2 a</code> to a <code>U2Graph a</code>, let's take a look at the structure of a <code>U2 a</code>. I'm going to assign the outer list to be the left-right direction and the inner list to be the up-down direction. A <code>U2</code> has a spine going all the way across the data, with the focal point anywhere along the spine. Each sublist can be slid perpendicular to the spine so that it is focusing on a specific point on the sublist. A <code>U2</code> in the middle of use might look like the folloing. The <code>+</code>s are the outer spine, the vertical dashes <code>|</code> are the inner spines, and <code>*</code> is the focal point of the structure.</p>\n\n<pre><code>|\n||     \n|||   ||\n|||| |||| |\n+++*++++++++\n |||||| ||\n  ||||   \n   ||\n</code></pre>\n\n<p>Each of the inner spines is continuous - it can't have a gap. That means that if we are considering a location off the spine, it can only have a neighbor to the left or right if the location one closer to the spine also had a neighbor on that side. This gives rise to how we will build a <code>U2Graph</code>. We will build connections to the left and right along the outer spine, with recursive references back towards the focal point just like we did in <code>toUGraph</code>. We will build connections up and down along the inner spines, with recursive references back towards the spine, just like we did in <code>toUGraph</code>. To build the connections to the left and right from a node on an inner spine we'll move one step closer to the outer spine, move sideways at that node, and then move one step farther away from the outer spine on the adjacent inner spine.</p>\n\n<pre><code>toU2Graph :: U2 a -&gt; U2Graph a\ntoU2Graph (U2 (U ls (U ds h us) rs)) = g\n    where\n        g = U2Graph (build u2down g ds) (build u2left g ls) h (build u2right g rs) (build u2up g us)\n        build f _    []          = Nothing\n        build f prev (here:next) = Just g\n            where\n                g = f (Just prev) here (build f g next)\n        u2up   d h u = U2Graph d (d &gt;&gt;= _left2 &gt;&gt;= _up2  ) h (d &gt;&gt;= _right2 &gt;&gt;= _up2  ) u\n        u2down u h d = U2Graph d (u &gt;&gt;= _left2 &gt;&gt;= _down2) h (u &gt;&gt;= _right2 &gt;&gt;= _down2) u\n        u2left r (U ds h us) l = g\n            where\n                g = U2Graph (build u2down g ds) l h r (build u2up g us)\n        u2right l (U ds h us) r = g\n            where\n                g = U2Graph (build u2down g ds) l h r (build u2up g us)\n</code></pre>\n"}], "owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 3, "accepted_answer_id": 28521443, "answer_count": 2, "score": 3, "last_activity_date": 1424016742, "creation_date": 1423925645, "last_edit_date": 1495540928, "question_id": 28516819, "link": "https://stackoverflow.com/questions/28516819/tie-the-knot-in-2-dimensions-was-tying-the-knot-with-a-comonad", "title": "Tie-the-knot in 2 dimensions (was: tying the knot with a comonad)", "body": "<p><em>Edit:</em> The original question was \"tying the knot with a comonad\", but what really helped here is a two-dimensional knot tying with <code>U2Graph</code> from <a href=\"https://stackoverflow.com/a/28521443/412549\">cirdec</a>. <em>Original question (until Anwser):</em></p>\n\n<p>I want to tie the knot with data that originates from a comonad</p>\n\n<pre><code>data U a = U [a] a [a]\n</code></pre>\n\n<p>into a richer data structure</p>\n\n<pre><code>data FullCell = FullCell {\n   vision   :: [[Int]],\n   move     :: Int -&gt; Maybe FullCell -- tie the knot here!\n}\n</code></pre>\n\n<p>with a function</p>\n\n<pre><code>tieKnot :: U Int -&gt; U FullCell\n</code></pre>\n\n<p>However, my brain encounters an \"occurs check\" when I try to fill in for <code>undefined</code>:</p>\n\n<pre><code>tieKnot :: U Int -&gt; U FullCell\ntieKnot u = u =&gt;&gt; (\\z -&gt; FullCell {\n      vision = limitTo5x5 z,\n      move = move'\n})  where\n         move'   1  = Just undefined -- tie the knot to neighbor here\n         move' (-1) = Just undefined -- ...\n         move'   _  = Nothing\n         limitTo5x5 = undefined -- not of interest, but the cause why a comonad is used\n</code></pre>\n\n<p>The problem I cannot solve is, I need to refer to something I am just constructing, and it is buried deep in a comonad. And I want to be really sure that circles actually point to the same thunk.</p>\n\n<p>What is the best way to solve it? Is that comonad <code>U a</code> the way to go? A doubly linked list <code>data T a = T (Maybe (T a)) a (Maybe (T a))</code> seems to run into the same problem, but will be much harder to extend to 2 dimensions.</p>\n\n<hr>\n\n<p>Background: I try to implement <a href=\"https://codegolf.stackexchange.com/questions/44707/lab-rat-race-an-exercise-in-genetic-algorithms\">codegolf's rat race</a> in haskell. So with tying-the-know I want to refer to the same thunk owing the time-consuming computation.</p>\n\n<h1>Answer</h1>\n\n<p>The solution comes from <a href=\"https://stackoverflow.com/a/28521443/412549\">Cirdec's Answer</a>. It is just missing a small step that I do not want to squeeze into a comment.</p>\n\n<p>What caused my brain to run into an \"occurs check\" is: To construct a <code>FullCell</code> and tie the knot on its field <code>move</code> I need the already constructed <code>U2Graph FullCell</code>. Now that I stated it, the requirement is easy to write as:</p>\n\n<pre><code>toU2Graph :: (U2Graph b -&gt; a -&gt; b) -&gt; U2 a -&gt; U2Graph b\n</code></pre>\n\n<p>where the first argument is a function that constructs my <code>FullCell</code>. Cirdec's function can be adapted easily. The final step is to bring the comonad back in:</p>\n\n<pre><code>toU2GraphW :: (U2Graph b -&gt; U2 a -&gt; b) -&gt; U2 a -&gt; U2Graph b\ntoU2GraphW f u = toU2Graph f (duplicate u)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "edited": false, "score": 1, "creation_date": 1423924684, "post_id": 28516665, "comment_id": 45350571, "body": "What was the actual error you got?"}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 4158329, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh4.googleusercontent.com/-zXrd052BpiI/AAAAAAAAAAI/AAAAAAAAABI/EXqUd4x05pk/photo.jpg?sz=128", "display_name": "Himanshu Saini", "link": "https://stackoverflow.com/users/4158329/himanshu-saini"}, "edited": false, "score": 0, "creation_date": 1423925642, "post_id": 28516717, "comment_id": 45350833, "body": "thanku,it works.but how it is right and my way is wrong."}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "reply_to_user": {"reputation": 35, "user_id": 4158329, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh4.googleusercontent.com/-zXrd052BpiI/AAAAAAAAAAI/AAAAAAAAABI/EXqUd4x05pk/photo.jpg?sz=128", "display_name": "Himanshu Saini", "link": "https://stackoverflow.com/users/4158329/himanshu-saini"}, "edited": false, "score": 0, "creation_date": 1423928275, "post_id": 28516717, "comment_id": 45351552, "body": "Take a look at this to see how <code>foldl</code> and <code>foldr</code> work, and you will see why you needed to swap the position of your parameters: <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:foldl\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.7.0.2/docs/&hellip;</a>"}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 2, "last_activity_date": 1423925359, "last_edit_date": 1423925359, "creation_date": 1423924922, "answer_id": 28516717, "question_id": 28516665, "link": "https://stackoverflow.com/questions/28516665/foldr-and-foldl-function-in-haskell/28516717#28516717", "title": "Foldr and Foldl function in haskell", "body": "<p>Change your function signature to <code>map' ::(a-&gt;b)-&gt;[a]-&gt;[b]</code>. </p>\n\n<p>The <code>map</code> operation basically takes a function that transforms an element of type 'a' to an element of type 'b', and a list of elements of type 'a', to produce a list of elements of type 'b' using the transforming function. Your function signature containing another type 'c' is contrary to this, because 'b' and 'c' cannot implicitly be assumed to be the same type.</p>\n\n<p>Next, to use <code>foldl</code>, you have to reverse the order of your input parameters, like so:</p>\n\n<pre><code>map' :: (a-&gt;b)-&gt;[a]-&gt;[b]\nmap' f xs = foldl (\\acc x -&gt;f x:acc) [] xs\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 4158329, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh4.googleusercontent.com/-zXrd052BpiI/AAAAAAAAAAI/AAAAAAAAABI/EXqUd4x05pk/photo.jpg?sz=128", "display_name": "Himanshu Saini", "link": "https://stackoverflow.com/users/4158329/himanshu-saini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 0, "accepted_answer_id": 28516717, "answer_count": 1, "score": 1, "last_activity_date": 1423925465, "creation_date": 1423924598, "last_edit_date": 1423925465, "question_id": 28516665, "link": "https://stackoverflow.com/questions/28516665/foldr-and-foldl-function-in-haskell", "title": "Foldr and Foldl function in haskell", "body": "<p>There is code of fold function in Haskell programming.</p>\n\n<pre><code>map' ::(a-&gt;b)-&gt;[a]-&gt;[b]\nmap' f xs=foldr(\\x acc -&gt;f x:acc)[] xs\n</code></pre>\n\n<p>INPUT:</p>\n\n<pre><code>map' (+3) [1,2,3]\n</code></pre>\n\n<p>OUTPUT:</p>\n\n<pre><code>[4,5,6]\n</code></pre>\n\n<p>It takes the element from right side due to foldr function and I Want to take the element from left side and append into list and i want a output [6,5,4].i did it through foldl function but it gives error.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>ERROR: Couldn't match expected type `a' with actual type `[b]'\n      `a' is a rigid type variable bound by\n          the type signature for map' :: (a -&gt; b) -&gt; [a] -&gt; [b]\n          at doubleme.hs:1:8\n    In the first argument of `f', namely `x'\n    In the first argument of `(:)', namely `f x'\n    In the expression: f x : acc\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 3127, "user_id": 7096763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c1843972ea822c36c0c024d2ddcc8d7?s=128&d=identicon&r=PG&f=1", "display_name": "MikaelF", "link": "https://stackoverflow.com/users/7096763/mikaelf"}, "edited": false, "score": 0, "creation_date": 1585190277, "post_id": 28516603, "comment_id": 107678253, "body": "Or just <code>united f s = s &lt;$ f ()</code>, it&#39;s a bit simpler to read IMH(umble)O."}], "answers": [{"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 2, "last_activity_date": 1423947684, "creation_date": 1423947684, "answer_id": 28520269, "question_id": 28516603, "link": "https://stackoverflow.com/questions/28516603/what-is-the-purpose-of-united-lens/28520269#28520269", "title": "What is the purpose of united lens?", "body": "<p>I've never actually seen or used this before. But I imagine it's useful in the same way as the <code>id</code> function (which returns it's argument unmodified) or the <code>Identity</code> monad (which is a monad with no \"effects\"; exactly equivalent to not using monads at all) are useful.</p>\n\n<p>These and other similar concepts (including the <code>()</code> type!) are basically \"do-nothing\" structures, so they seem useless when you look at them by themselves. But they become useful when polymorphism is involved, by giving you a \"do-nothing\" option to pass to general operations.</p>\n"}], "owner": {"reputation": 1510, "user_id": 1576064, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/47c868b652ffdc287498a8c604a30013?s=128&d=identicon&r=PG", "display_name": "Lubom&#237;r Sedl&#225;\u0159", "link": "https://stackoverflow.com/users/1576064/lubom%c3%adr-sedl%c3%a1%c5%99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 28520269, "answer_count": 1, "score": 6, "last_activity_date": 1423947684, "creation_date": 1423924204, "question_id": 28516603, "link": "https://stackoverflow.com/questions/28516603/what-is-the-purpose-of-united-lens", "title": "What is the purpose of united lens?", "body": "<p>While reading through the <a href=\"http://artyom.me/lens-over-tea-1\">Lens over Tea #1</a> article, I found the <code>united</code> lens. My implementation is</p>\n\n<pre><code>united :: Lens' a ()\nunited f v = const v &lt;$&gt; f ()\n</code></pre>\n\n<p>which is pretty much the same as the <a href=\"http://hackage.haskell.org/package/lens-4.7/docs/Control-Lens-Lens.html#v:united\">implementation in the Lens library</a>.</p>\n\n<p>What leaves me completely baffled is why would I want a function like this in the first place? Are there any uses of this lens?</p>\n"}, {"tags": ["haskell", "partial-application"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1423923224, "post_id": 28516422, "comment_id": 45350169, "body": "<code>writeFile</code> has two arguments, a path and a string. We get the path from <code>getLine</code>, but what&#39;s the string to write?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1423923259, "post_id": 28516422, "comment_id": 45350183, "body": "@Andr&#225;sKov&#225;cs The string is what is returned by <code>computeSomething</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1423923318, "post_id": 28516422, "comment_id": 45350203, "body": "So, <code>getLine &gt;&gt;= flip writeFile computeSomething</code> ?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1423923560, "post_id": 28516422, "comment_id": 45350264, "body": "@Zeta <i>facepalm</i> Yes, thank you. This is a sign I have to take a break ;) Do you want to answer it or should I delete this question?"}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1423925390, "creation_date": 1423925390, "answer_id": 28516773, "question_id": 28516422, "link": "https://stackoverflow.com/questions/28516422/is-there-a-way-to-partially-apply-getline/28516773#28516773", "title": "Is there a way to partially apply getLine?", "body": "<p>You can use <code>flip</code> to flip the order of arguments:</p>\n\n<pre><code>getLine &gt;&gt;= flip writeFile computeSomething\n</code></pre>\n\n<p>The tool <a href=\"http://hackage.haskell.org/package/pointfree\" rel=\"nofollow\"><code>pointfree</code></a> is helpful if you want to eta-reduce a function.</p>\n"}], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 28516773, "answer_count": 1, "score": 0, "last_activity_date": 1423925390, "creation_date": 1423922928, "last_edit_date": 1423923294, "question_id": 28516422, "link": "https://stackoverflow.com/questions/28516422/is-there-a-way-to-partially-apply-getline", "title": "Is there a way to partially apply getLine?", "body": "<p>Is there a way to partially apply <code>getLine</code> to <code>writeFile</code> or a similar function (for file naming purposes)? I want to do something like this:</p>\n\n<pre><code>main = writeFile ??? . computeSomething =&lt;&lt; somethingElse\n</code></pre>\n\n<p><code>???</code> should be a line entered by the user to name the output file but I have no idea what to insert for <code>???</code>. I tried inserting <code>=&lt;&lt; getLine</code> and similar snippets but nothing worked for me.</p>\n\n<p>Is it possible to achieve this without using do-notation in a readable way?</p>\n"}, {"tags": ["haskell", "precision"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1423940863, "post_id": 28516337, "comment_id": 45355304, "body": "Please don&#39;t edit your question so as to make the existing answer look like nonsense."}], "answers": [{"comments": [{"owner": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "edited": false, "score": 0, "creation_date": 1423922705, "post_id": 28516378, "comment_id": 45350027, "body": "Where to add this line ?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423923034, "post_id": 28516378, "comment_id": 45350123, "body": "Erm, actually it doesn&#39;t seem necessary in this case."}, {"owner": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423923064, "post_id": 28516378, "comment_id": 45350129, "body": "@&#216;rjanJohansen I didnt get you"}, {"owner": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423923197, "post_id": 28516378, "comment_id": 45350163, "body": "@&#216;rjanJohansen But now I am getting compile time error in my code. I am not able to edit my code"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423923234, "post_id": 28516378, "comment_id": 45350172, "body": "You also need <code>import Text.Printf</code> at the top."}, {"owner": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423923315, "post_id": 28516378, "comment_id": 45350202, "body": "@&#216;rjanJohansen Yeah i had done that. And will g function be like this : g j=printf &quot;%.12f&quot; $sum$map f[0..j-1]"}, {"owner": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "edited": false, "score": 0, "creation_date": 1423923346, "post_id": 28516378, "comment_id": 45350208, "body": "@Lee Can&#39;t it be done in g function only instead of making different function ?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "edited": false, "score": 0, "creation_date": 1423923566, "post_id": 28516378, "comment_id": 45350266, "body": "@user3786422 Oh I see, my deleted comment was right anyhow, sigh, it&#39;s just that the whole file somehow loaded for me in GHCi. I think Lee&#39;s extra function is simplest, then."}, {"owner": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "edited": false, "score": 0, "creation_date": 1423923901, "post_id": 28516378, "comment_id": 45350361, "body": "@Lee Can&#39;t it be done in g function only instead of making different function ? I want to minimise the characters used in my code"}, {"owner": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "edited": false, "score": 0, "creation_date": 1423924992, "post_id": 28516378, "comment_id": 45350649, "body": "@Lee Can we merge f function in g also ?? Or f with p ? I want to minimise the size of code"}, {"owner": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423925021, "post_id": 28516378, "comment_id": 45350656, "body": "@&#216;rjanJohansen Instead of making separate f function can that f function me merged in g only ?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "edited": false, "score": 0, "creation_date": 1423926019, "post_id": 28516378, "comment_id": 45350942, "body": "@user3786422 Ah golfing... <code>g j=printf&quot;%.12f&quot;$sum[(-1)**i&#47;(2*i+1)::Double|i&lt;-[0..j-1]] </code>"}, {"owner": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423926177, "post_id": 28516378, "comment_id": 45350988, "body": "@&#216;rjanJohansen Yeah..:) And what about P function ?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "edited": false, "score": 0, "creation_date": 1423926217, "post_id": 28516378, "comment_id": 45351001, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/70915/discussion-between-orjan-johansen-and-user3786422\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 3, "last_activity_date": 1423924046, "last_edit_date": 1423924046, "creation_date": 1423922612, "answer_id": 28516378, "question_id": 28516337, "link": "https://stackoverflow.com/questions/28516337/set-precision-in-haskell/28516378#28516378", "title": "Set precision in Haskell", "body": "<p>You can use <code>printf</code> from Text.Printf</p>\n\n<pre><code>printf \"%.12f\" 0.7604599047323508\n</code></pre>\n\n<p><code>printf</code> is overloaded so you need to specify the return type but you can do:</p>\n\n<pre><code>showPrec :: Double -&gt; String\nshowPrec = printf \"%.12f\"\n</code></pre>\n\n<p>then you can replace the use of <code>show</code> in <code>g</code>:</p>\n\n<pre><code>g j = showPrec $ sum $ map f[0..j-1]\n</code></pre>\n\n<p>you can use <code>printf</code> directly in <code>g</code> if you specify the type:</p>\n\n<pre><code>g :: Double -&gt; String\ng j = printf \"%.12f\" $ sum $ map f[0..j-1]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 588, "user_id": 5857711, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e64nA.png?s=128&g=1", "display_name": "Hugo Rivera", "link": "https://stackoverflow.com/users/5857711/hugo-rivera"}, "is_accepted": false, "score": 2, "last_activity_date": 1454266385, "creation_date": 1454266385, "answer_id": 35117914, "question_id": 28516337, "link": "https://stackoverflow.com/questions/28516337/set-precision-in-haskell/35117914#35117914", "title": "Set precision in Haskell", "body": "<p>The main question is whether you want more accurate presentation or more accurate numbers.\nSee @Lee's answer for <code>printf</code> if you're more concerned about presentation. </p>\n\n<h1>Arbitrary Precision</h1>\n\n<p>If you want numbers that are (arbitrarily) more accurate than <code>Double</code> or <code>Float</code>, use <code>Scientific</code> offered by the scientific package. Note the <code>Integer</code> type already has arbitrary precision.</p>\n\n<p>Scientific numbers can be written as literals, they only need type annotations:</p>\n\n<pre><code>&gt; let d = 3.14159265358979323846264338327950288419716939937510 :: Scientific\n&gt; :t d\nd :: Scientific\n</code></pre>\n\n<h3>Scientific -> String</h3>\n\n<pre><code>&gt; formatScientific Exponent (Just 3) d\n\"3.142e0\"\n\n&gt; formatScientific Generic (Just 3) d\n\"3.142\"\n\n&gt; formatScientific Generic (Just 100) d\n\"3.1415926535897932384626433832795028841971693993751000000000000000000000000000000000000000000000000000\"\n\n&gt; formatScientific Generic (Just 16) d\n\"3.1415926535897932\"\n</code></pre>\n\n<h3>Float -> Scientific</h3>\n\n<pre><code>&gt; fromFloatDigits 3.1415\n3.1415\n</code></pre>\n\n<h3>String -> Scientific</h3>\n\n<pre><code>&gt; read \"1e1000000000\" :: Scientific\n1.0e1000000000\n</code></pre>\n\n<h3>General use</h3>\n\n<p>You only need to specify the type of one of your numbers as <code>Scientific</code>. After this, you can simply write literals and use Numeric, Floating and RealFrac function as usual. Note <code>/</code> might diverge if the representation has infinite decimals. <a href=\"https://hackage.haskell.org/package/scientific\" rel=\"nofollow\">See the documentation for more details.</a></p>\n\n<pre><code>&gt; d / 2\n1.57079632679489661923132169163975144209858469968755\n\n&gt; (d * 1000000000) + 1 == 1000000000 * (d + 1/1000000000)\nTrue\n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 3786422, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/d6342716794dbf11d521342ce9a3d678?s=128&d=identicon&r=PG&f=1", "display_name": "user3786422", "link": "https://stackoverflow.com/users/3786422/user3786422"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1121, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1454266385, "creation_date": 1423922273, "last_edit_date": 1423940788, "question_id": 28516337, "link": "https://stackoverflow.com/questions/28516337/set-precision-in-haskell", "title": "Set precision in Haskell", "body": "<p>I am having a code that take input T and followed by T lines. I want to set precision to 12 decimal places. How can I increase precision in Haskell?</p>\n\n<p>Code:</p>\n\n<pre><code>f i=(-1)**i/(2*i+1) \ng j=show$sum$map f[0..j-1]\np(_:l)=map(g.read)l\nmain=interact$unlines.p.lines\n</code></pre>\n\n<p>Like if input is:</p>\n\n<pre><code>1\n10\n</code></pre>\n\n<p>Then output is 0.7604599047323508, but I want only 0.760459904732.</p>\n"}, {"tags": ["haskell", "yesod", "hamlet"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1423934995, "creation_date": 1423934995, "answer_id": 28518217, "question_id": 28516294, "link": "https://stackoverflow.com/questions/28516294/is-there-a-way-to-pass-a-hamlet-block-as-an-argument-to-a-function/28518217#28518217", "title": "Is there a way to pass a Hamlet block as an argument to a function?", "body": "<p>No, such syntax does not exist.</p>\n"}], "owner": {"reputation": 79487, "user_id": 72583, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/16a5eec5eca4550033c0e19dba3b32b8?s=128&d=identicon&r=PG", "display_name": "Jakub Arnold", "link": "https://stackoverflow.com/users/72583/jakub-arnold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 28518217, "answer_count": 1, "score": 0, "last_activity_date": 1423934995, "creation_date": 1423921859, "question_id": 28516294, "link": "https://stackoverflow.com/questions/28516294/is-there-a-way-to-pass-a-hamlet-block-as-an-argument-to-a-function", "title": "Is there a way to pass a Hamlet block as an argument to a function?", "body": "<p>Let's say that I have a generic <code>content :: Widget -&gt; Widget</code> helper, which takes a <code>Widget</code> and wraps it in some HTML.</p>\n\n<p>Is is possible to call this function giving it the argument inline in the Hamlet file, similarly to what one would do in Ruby on Rails? For example let's say we have a helper <code>link_to</code>, which takes an URL and its content, we could call it something like</p>\n\n<pre><code>= link_to \"/some_url\" do\n  &lt;span class=\"icon\"&gt;\n  Click me\n</code></pre>\n\n<p>yielding <code>&lt;a href=\"/some_url\"&gt;&lt;span class=\"icon\"/&gt;Click me&lt;/a&gt;</code>.</p>\n\n<p><strong>Is there a similar pattern in Hamlet, where I could pass arbitrary Hamlet snippet as an argument to a function, direclty in the template?</strong></p>\n"}, {"tags": ["haskell", "yesod", "hamlet"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 1, "last_activity_date": 1423935124, "creation_date": 1423935124, "answer_id": 28518240, "question_id": 28516209, "link": "https://stackoverflow.com/questions/28516209/how-can-i-embed-both-text-and-widget-in-another-widget-in-yesod/28518240#28518240", "title": "How can I embed both Text and Widget in another Widget in Yesod?", "body": "<p>I wouldn't go this route, specifically because of the type inference issue you already discovered. Explicitly having to call toWidget occasionally is probably the best compromise here.</p>\n"}], "owner": {"reputation": 79487, "user_id": 72583, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/16a5eec5eca4550033c0e19dba3b32b8?s=128&d=identicon&r=PG", "display_name": "Jakub Arnold", "link": "https://stackoverflow.com/users/72583/jakub-arnold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 28518240, "answer_count": 1, "score": 0, "last_activity_date": 1423935124, "creation_date": 1423921284, "question_id": 28516209, "link": "https://stackoverflow.com/questions/28516209/how-can-i-embed-both-text-and-widget-in-another-widget-in-yesod", "title": "How can I embed both Text and Widget in another Widget in Yesod?", "body": "<p>Given a simple example like this</p>\n\n<pre><code>glyphicon :: Text -&gt; Widget\nglyphicon name = toWidget [hamlet|&lt;span class=\"glyphicon glyphicon-#{name}\"&gt;|]\n\nfoo :: ToMarkup a =&gt; a -&gt; Widget\nfoo content = toWidget [hamlet|&lt;div class=\"foo\"&gt;#{content}&lt;/div&gt;|]\n</code></pre>\n\n<p>Is there a builtin mechanism in Yesod which would allow me to do both <code>foo \"some text\"</code> and <code>foo (glyphicon \"pencil\")</code>? I've managed to work around this by using a custom typeclass which converts both Text and Widget to Widget</p>\n\n<pre><code>class MakeWidget a where\n  makeWidget :: a -&gt; Widget\n\ninstance MakeWidget Widget where\n  makeWidget = id\n\ninstance MakeWidget Text where\n  makeWidget x = toWidget [hamlet|#{x}|]\n\nglyphicon :: Text -&gt; Widget\nglyphicon name = toWidget [hamlet|&lt;span class=\"glyphicon glyphicon-#{name}\"&gt;|]\n\nfoo :: MakeWidget a =&gt; a -&gt; Widget\nfoo content = toWidget [whamlet|&lt;div class=\"foo\"&gt;^{makeWidget content}&lt;/div&gt;|]\n</code></pre>\n\n<p>but this doesn't feel right, especially since I can't even do <code>^{foo \"hello\"}</code> due to ambiguous types, and have to do <code>^{foo (T.pack \"hello\")}</code> instead.</p>\n\n<p>Is there a better way of embedding both <code>Text</code> and <code>Widget</code> inside another <code>Widget</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1423919618, "post_id": 28515901, "comment_id": 45349206, "body": "BTW, <code>cond</code> is <code>flip bool</code> if you import <code>Data.Bool</code>."}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 2, "last_activity_date": 1423919290, "creation_date": 1423919290, "answer_id": 28515952, "question_id": 28515901, "link": "https://stackoverflow.com/questions/28515901/simplest-way-to-mix-anonymous-conditions-with-io/28515952#28515952", "title": "Simplest way to mix anonymous conditions with IO", "body": "<p><code>LambdaCase</code> is applicable here:</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\n\nimport System.Directory\nimport System.Environment\n\nmain = do\n  path:_ &lt;- getArgs    \n\n  doesDirectoryExist path &gt;&gt;= \\case\n    True -&gt; putStrLn $ path ++ \" Exists\"\n    _    -&gt; putStrLn $ path ++ \" Does not exist\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 191, "user_id": 1706102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/319c7db14cdc84490c79aee3cac8a9dd?s=128&d=identicon&r=PG", "display_name": "Izabel", "link": "https://stackoverflow.com/users/1706102/izabel"}, "is_accepted": false, "score": 0, "last_activity_date": 1423922922, "last_edit_date": 1423922922, "creation_date": 1423920904, "answer_id": 28516160, "question_id": 28515901, "link": "https://stackoverflow.com/questions/28515901/simplest-way-to-mix-anonymous-conditions-with-io/28516160#28516160", "title": "Simplest way to mix anonymous conditions with IO", "body": "<p>Or same with \"if\":</p>\n\n<pre><code>doesDirectoryExist path &gt;&gt;= \\x -&gt;\n if x then (putStrLn \"Exists\") else putStrLn (\"Does not\") \n</code></pre>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 28515952, "answer_count": 2, "score": 1, "last_activity_date": 1423922922, "creation_date": 1423918833, "question_id": 28515901, "link": "https://stackoverflow.com/questions/28515901/simplest-way-to-mix-anonymous-conditions-with-io", "title": "Simplest way to mix anonymous conditions with IO", "body": "<p>How to avoid boilerplate assignments like <code>doesExist &lt;- doesDirectoryExist path</code> and <code>case doesExist of ...</code> within IO?</p>\n\n<p>Is there a more idiomatic way than this?</p>\n\n<pre><code>import System.Directory\nimport System.Environment\n\nmain = do\n  path:_ &lt;- getArgs\n  doesDirectoryExist path &gt;&gt;= cond\n    (putStrLn $ path ++ \" Exists\")\n    (putStrLn $ path ++ \" Does not exist\")\n\ncond b c a = if a then b else c\n</code></pre>\n"}, {"tags": ["haskell", "clojure", "haskell-lens", "lenses", "destructuring"], "comments": [{"owner": {"reputation": 356, "user_id": 697026, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/984013ed37f21f0ea7b0f1bab3e4830b?s=128&d=identicon&r=PG", "display_name": "mdorman", "link": "https://stackoverflow.com/users/697026/mdorman"}, "edited": false, "score": 0, "creation_date": 1423920169, "post_id": 28514930, "comment_id": 45349359, "body": "Clojure&#39;s destructuring is actually more analogous to Pattern Matching in Haskell."}], "answers": [{"comments": [{"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1423955377, "post_id": 28516073, "comment_id": 45359270, "body": "Yeah - fair enough - I&#39;ll give this one to you. I feel like I didn&#39;t ask the question properly.  I think the question I had in my mind was &quot;What&#39;s the difference between a lens in Haskell and using a key sequence to access a nested structure in Clojure?&quot; like this: <a href=\"https://gist.github.com/anonymous/240e024625923d99cfd6\" rel=\"nofollow noreferrer\">gist.github.com/anonymous/240e024625923d99cfd6</a>"}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 3, "last_activity_date": 1423920274, "creation_date": 1423920274, "answer_id": 28516073, "question_id": 28514930, "link": "https://stackoverflow.com/questions/28514930/what-are-the-similarities-and-differences-between-a-lens-in-haskell-and-destruct/28516073#28516073", "title": "What are the similarities and differences between a lens in Haskell and destructuring in Clojure?", "body": "<p>Your Clojure code would most closely be expressed like this in Haskell:</p>\n\n<pre><code>book :: Book\nbook = Book {name = \"SICP\", details = Details {pages = 657, isbn_10: \"0262011530\"}}\n\nmain = do\n  let Book {name = name, details = Details {pages = pages, isbn_10 = isbn_10}} = book\n  putStrLn $ \"name:\" ++ name ++ \"pages:\" ++ (show pages) ++ \"isbn-10:\" ++ isbn-10\n</code></pre>\n\n<p>Here we used Haskell's pattern matching, which is basically a more general form of Clojure's destructuring bind, to get at the contents of the record. This has nothing to do with lenses.</p>\n\n<p>Now let's look at your Haskell code with lenses. This code has three record types, Game, Unit and Point, and those types each have an automatically-defined set of functions to access their members without pattern matching. These functions are called <code>_score</code>, <code>_health</code>, <code>_x</code> and so on (just like the member names). They take a <code>Game</code>, <code>Unit</code> or <code>Point</code> respectively and produce the value of their respective member. If these functions would have to be defined manually (which they don't because Haskell defines such functions for all record types automatically), it'd look like this:</p>\n\n<pre><code>_health (Unit {health = h}) = h\n</code></pre>\n\n<p>So far this still has nothing to do with lenses.</p>\n\n<p>The lens in the code is <code>health</code>. It contains the function <code>_health</code> (which, as described, takes a <code>Unit</code> and produces its health) and the function <code>(\\unit v -&gt; unit { _health = v })</code>, which takes a unit and a value and produces a new unit whose health has been set to that value. In other words the lens contains the code to both get and set the health of a unit. The Lens library now contains various functions that you can use to compose and work with such lenses.</p>\n\n<p>So to answer your question: There are no similarities between lenses and destructuring.</p>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 28516073, "answer_count": 1, "score": 1, "last_activity_date": 1423920274, "creation_date": 1423911648, "question_id": 28514930, "link": "https://stackoverflow.com/questions/28514930/what-are-the-similarities-and-differences-between-a-lens-in-haskell-and-destruct", "title": "What are the similarities and differences between a lens in Haskell and destructuring in Clojure?", "body": "<p><strong>Assumptions:</strong></p>\n\n<ul>\n<li>I want to parse a nested JSON String. </li>\n<li>I know that Haskell encourages solving problems with a type system, and Clojure eschews a type system, preferring to solve the problem with data structures. </li>\n<li>I'm aware that in both languages this process is referred to as <em>destructuring</em> - but it doesn't have another name in Clojure, whereas in Haskell this is also called <em>using a lens</em>, so I'm calling the Clojure one <em>destructuring</em>, and moving on</li>\n</ul>\n\n<p>We can see that we can create a <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow\">lens</a> <a href=\"http://www.haskellforall.com/2013/05/program-imperatively-using-haskell.html\" rel=\"nofollow\">like this</a> in Haskell:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Control.Lens\n\ninitialState :: Game\ninitialState = Game\n    { _score = 0\n    , _units =\n        [ Unit\n            { _health = 10\n            , _position = Point { _x = 3.5, _y = 7.0 }\n            }\n        ]\n    }\n\nhealth :: Lens' Unit Int\nhealth = lens _health (\\unit v -&gt; unit { _health = v })\n</code></pre>\n\n<p>It's purpose is to get the <code>health</code> value from the <code>game</code> data structure. </p>\n\n<p>We can do destructuring <a href=\"http://blog.jayfields.com/2010/07/clojure-destructuring.html\" rel=\"nofollow\">like this</a> in Clojure:</p>\n\n<pre><code>user=&gt; (def book {:name \"SICP\" :details {:pages 657 :isbn-10 \"0262011530\"}})\n#'user/book\n\nuser=&gt; (let [{name :name {pages :pages isbn-10 :isbn-10} :details} book]\n     (println \"name:\" name \"pages:\" pages \"isbn-10:\" isbn-10))\nname: SICP pages: 657 isbn-10: 0262011530\n</code></pre>\n\n<p>The purpose is to get the nested values for name, pages etc from the nested structure. </p>\n\n<p>In both cases you're coming up with a mechanism to reusably retrieve values from a nested structure. </p>\n\n<p>My question is: <strong>What are the similarities and differences between a lens in Haskell and destructuring in Clojure?</strong></p>\n"}, {"tags": ["haskell", "types", "functional-programming", "lazy-evaluation", "purely-functional"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1423909391, "post_id": 28514487, "comment_id": 45346855, "body": "<code>map f $ zip xs ys</code> is the same as <code>zipWith (curry f) xs ys</code>. You can simplify <code>laserPaths&#39;</code> to <code>zipWith (\\p r -&gt; case r of {...}) laserPaths laserCollisionResults</code>."}, {"owner": {"reputation": 1414, "user_id": 2156925, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ee041d4510b80b51b16002867ba30663?s=128&d=identicon&r=PG", "display_name": "Mickael Bergeron N&#233;ron", "link": "https://stackoverflow.com/users/2156925/mickael-bergeron-n%c3%a9ron"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423909511, "post_id": 28514487, "comment_id": 45346884, "body": "@Cirdec Thanks for that."}], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 2, "last_activity_date": 1423908897, "creation_date": 1423908897, "answer_id": 28514550, "question_id": 28514487, "link": "https://stackoverflow.com/questions/28514487/haskell-if-then-else-blocks-and-data-with-asymmetrical-constructors/28514550#28514550", "title": "Haskell: if-then-else blocks and data with asymmetrical constructors", "body": "<p>You need to match on <code>r</code> e.g.</p>\n\n<pre><code>laserPaths' = map (\\(p,r) -&gt; if isLaserCollision r then doSomethingWith p else p) $ zip laserPaths laserCollisionResults\n  where isLaserCollision (LaserToLaserCollision _) = True\n        isLaserCollision _ = False\n</code></pre>\n\n<p>or you can match inline:</p>\n\n<pre><code> laserPaths' = map (\\(p, r) -&gt; case r of { (LaserToLaserCollision _) -&gt; doSomethingWith p ; _ -&gt; p}) $ zip laserPaths laserCollisionResults\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 299, "user_id": 4564562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b22c7f74a15c15cb4999a3947bcaeace?s=128&d=identicon&r=PG&f=1", "display_name": "Nicolas Malebranche", "link": "https://stackoverflow.com/users/4564562/nicolas-malebranche"}, "is_accepted": false, "score": 5, "last_activity_date": 1423909366, "last_edit_date": 1423909366, "creation_date": 1423908952, "answer_id": 28514557, "question_id": 28514487, "link": "https://stackoverflow.com/questions/28514487/haskell-if-then-else-blocks-and-data-with-asymmetrical-constructors/28514557#28514557", "title": "Haskell: if-then-else blocks and data with asymmetrical constructors", "body": "<p>Replace your lambda by</p>\n\n<pre><code>(\\(p,r) -&gt; case r of {LaserToLaserCollision _ -&gt; doSomethingWith p; _ -&gt; p})\n</code></pre>\n\n<p>By the way, for this you don't need to derive an <code>Eq</code> instance.</p>\n"}], "owner": {"reputation": 1414, "user_id": 2156925, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ee041d4510b80b51b16002867ba30663?s=128&d=identicon&r=PG", "display_name": "Mickael Bergeron N&#233;ron", "link": "https://stackoverflow.com/users/2156925/mickael-bergeron-n%c3%a9ron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 28514550, "answer_count": 2, "score": 2, "last_activity_date": 1423909366, "creation_date": 1423908468, "question_id": 28514487, "link": "https://stackoverflow.com/questions/28514487/haskell-if-then-else-blocks-and-data-with-asymmetrical-constructors", "title": "Haskell: if-then-else blocks and data with asymmetrical constructors", "body": "<p>I have the following data which can have a Ship or not:</p>\n\n<pre><code>data LaserCollisionResult = NoCollision | LaserToLaserCollision Ship | LaserToShipCollision Ship deriving (Eq, Show)\n</code></pre>\n\n<p>then, later on, I am trying to check if a LaserCollisionResult is of type LaserToLaserCollision, but I get an error. My [lambda] function is this:</p>\n\n<pre><code>laserPaths' = map (\\(p,r) -&gt; if r == LaserToLaserCollision then doSomethingWith p else p) $ zip laserPaths laserCollisionResults\n</code></pre>\n\n<p>The error I am getting is:</p>\n\n<pre><code>Couldn't match type 'LaserCollisionResult' with 'Ship -&gt; LaserCollisionResult'\nExpected type: [Ship -&gt; LaserCollisionResult]\nActual type: [LaserCollisionResult]\nIn the second argument of 'zip', namely laserCollisionResults.\n</code></pre>\n\n<p>How can I check whether a LaserCollisionResult in laserCollisionResults is of type LaserToLaserCollision?</p>\n"}, {"tags": ["regex", "haskell"], "comments": [{"owner": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "edited": false, "score": 0, "creation_date": 1423903270, "post_id": 28513828, "comment_id": 45345765, "body": "If you would show us some Haskell (even if completely wrong) this would give us a better idea of what exactly you are asking, and what exactly you don&#39;t understand about <a href=\"https://hackage.haskell.org/package/regex-compat-0.92/docs/Text-Regex.html\" rel=\"nofollow noreferrer\">matchRegex</a>. It might even make you find the answer yourself!"}, {"owner": {"reputation": 79, "user_id": 4502849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b92666b25871078476ab9bcfa4a14285?s=128&d=identicon&r=PG&f=1", "display_name": "custosat", "link": "https://stackoverflow.com/users/4502849/custosat"}, "reply_to_user": {"reputation": 5054, "user_id": 548515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55624bebc921a03713d00a91c9e58a36?s=128&d=identicon&r=PG", "display_name": "Hans Lub", "link": "https://stackoverflow.com/users/548515/hans-lub"}, "edited": false, "score": 0, "creation_date": 1423905676, "post_id": 28513828, "comment_id": 45346168, "body": "Actually I have figured it out. I am using Test.Regix.Posix. This will return true if the input string matches  (x =~ &quot; what is [0-9]* plus [0-9]*&quot; ::Bool)"}], "answers": [{"tags": [], "owner": {"reputation": 79, "user_id": 4502849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b92666b25871078476ab9bcfa4a14285?s=128&d=identicon&r=PG&f=1", "display_name": "custosat", "link": "https://stackoverflow.com/users/4502849/custosat"}, "is_accepted": false, "score": 1, "last_activity_date": 1423953900, "last_edit_date": 1423953900, "creation_date": 1423907090, "answer_id": 28514320, "question_id": 28513828, "link": "https://stackoverflow.com/questions/28513828/matchregex-function-example-in-haskell/28514320#28514320", "title": "matchRegex function example in Haskell", "body": "<p>I figured it out. Posting it here for the benefit of others</p>\n\n<p>I am using <code>Text.Regix.Posix</code>. This will return <code>True</code> if the input string matches: </p>\n\n<pre><code>x = \"34n5n5: What is 5 plus 0\"\nresult = (x =~ \" what is [0-9]* plus [0-9]*\" ::Bool)\n</code></pre>\n\n<p>will bind <code>result</code> to <code>True</code></p>\n"}], "owner": {"reputation": 79, "user_id": 4502849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b92666b25871078476ab9bcfa4a14285?s=128&d=identicon&r=PG&f=1", "display_name": "custosat", "link": "https://stackoverflow.com/users/4502849/custosat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1423953900, "creation_date": 1423902433, "question_id": 28513828, "link": "https://stackoverflow.com/questions/28513828/matchregex-function-example-in-haskell", "title": "matchRegex function example in Haskell", "body": "<p>Hi I am getting Text responses and I want to match them using Regex and apply the necessary function\nFor instance suppose if I get a text\n\"34n5n5: What is the result of 5 plus 0\" I pass it to a function to get required output</p>\n\n<p>How do I use the <a href=\"https://hackage.haskell.org/package/regex-compat-0.92/docs/Text-Regex.html\" rel=\"nofollow\">matchRegex</a> function in haskell to match this Text.\nIf there is a better way to match then please tell that also.</p>\n\n<p>For example for this request       </p>\n\n<p>\"34n5n5: What is the result of 5 plus 0\"</p>\n\n<p>Here \"34n5n5\" can be different for different requests</p>\n\n<p>The numbers (5 0) can change</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1423900128, "post_id": 28513294, "comment_id": 45345257, "body": "If <code>Car</code> and <code>Plane</code> are the same as <code>Vehicle</code> (<code>accelerate = go</code> and <code>takeoff = go</code>), then why even have the <code>Car</code> and <code>Plane</code> type classes? If they aren&#39;t necessarily the same as <code>Vehicle</code>, then e.g. trying to provide the <code>Vehicle</code> instance for all <code>Plane</code>s is misdirected and you&#39;d be better off with <code>class Vehicle p =&gt; Plane p where takeoff :: p -&gt; String; takeoff = go</code>."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423900632, "post_id": 28513294, "comment_id": 45345346, "body": "What if they&#39;re not?"}, {"owner": {"reputation": 325, "user_id": 2841309, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dd89b9b62cd483082b3f1a20acff659?s=128&d=identicon&r=PG&f=1", "display_name": "coffeequant", "link": "https://stackoverflow.com/users/2841309/coffeequant"}, "edited": false, "score": 1, "creation_date": 1423902259, "post_id": 28513294, "comment_id": 45345600, "body": "class (Eq a) =&gt; Num a where   When I write this, it says that type a must be an instance of Eq. In your case you are similarly saying Vehicle to be an instance of Plane and also Vehicle to be an instance of Car, which is not possible. This is not overlapping instance error. Overlapping instance error can be removed by using {-# LANGUAGE TypeSynonymInstances, OverlappingInstances #-} (although it&#39;s not recomended)."}, {"owner": {"reputation": 325, "user_id": 2841309, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dd89b9b62cd483082b3f1a20acff659?s=128&d=identicon&r=PG&f=1", "display_name": "coffeequant", "link": "https://stackoverflow.com/users/2841309/coffeequant"}, "edited": false, "score": 0, "creation_date": 1423902396, "post_id": 28513294, "comment_id": 45345612, "body": "I think it should be Vehicle at the top and then both Car and Plane def&#39;s should contain Vehicle as a constraint. Class vehicle can define both methods and whichever is appropriate can be chosen by Plane or Car"}], "answers": [{"tags": [], "owner": {"reputation": 325, "user_id": 2841309, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dd89b9b62cd483082b3f1a20acff659?s=128&d=identicon&r=PG&f=1", "display_name": "coffeequant", "link": "https://stackoverflow.com/users/2841309/coffeequant"}, "is_accepted": false, "score": -1, "last_activity_date": 1423904263, "last_edit_date": 1423904263, "creation_date": 1423903883, "answer_id": 28513995, "question_id": 28513294, "link": "https://stackoverflow.com/questions/28513294/translating-object-orientated-class-structure-to-haskell/28513995#28513995", "title": "Translating object orientated class structure to Haskell", "body": "<pre><code>data Ford = Ford\ndata Ferrari = Ferrari\n\nclass Vehicle v where\n    go :: v -&gt; String\n\nclass (Vehicle v) =&gt; Car v where\n    accelerate :: v-&gt;String\n\ninstance Vehicle Ford where\n     go = accelerate\n\n instance Car Ford where\n     accelerate _ = \"Vrrom I am ford\"\n</code></pre>\n\n<p>Similarly for plane</p>\n\n<pre><code>class (Vehicle v) =&gt; Plane v where\n    takeoff :: v-&gt; String\n\n   instance Vehicle Bowing747 where\n        go = takeoff\n\n   instance Plane Bowing747 where\n      takeoff _ = \"taking off from plane\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11593, "user_id": 2494803, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b4b1d0d8887426a51330a990936ac1?s=128&d=identicon&r=PG", "display_name": "bennofs", "link": "https://stackoverflow.com/users/2494803/bennofs"}, "is_accepted": false, "score": 2, "last_activity_date": 1423904747, "creation_date": 1423904747, "answer_id": 28514076, "question_id": 28513294, "link": "https://stackoverflow.com/questions/28513294/translating-object-orientated-class-structure-to-haskell/28514076#28514076", "title": "Translating object orientated class structure to Haskell", "body": "<p>In Haskell, you usually don't model OOP by using typeclasses. Instead, you can just write plain data types that contain functions. In your code, a vehicle is anything that has a <code>go</code> method, which returns a <code>String</code> given a Vehicle. So let's define a datatype that expresses this:</p>\n\n<pre><code>data Vehicle = Vehicle { go :: String }\n</code></pre>\n\n<p>Now it's very easy to make new vehicles. For example, to convert a <code>Plane</code> to a <code>Vehicle</code> you could write a function <code>plane</code>:</p>\n\n<pre><code>data Plane = Plane { takeoff :: String }\n\nplane :: Plane -&gt; Vehicle\nplane p = Vehicle { go = takeoff p }\n</code></pre>\n\n<p>Or you can make a <code>Car</code> type:</p>\n\n<pre><code>data Car = Car { accelerate :: String }\n\ncar :: Car -&gt; Vehicle\ncar c = Vehicle { go = accelerate c }\n</code></pre>\n\n<p>If you want, you could even make a <code>ToVehicle</code> typeclass so that you can use the same function to convert <code>Car -&gt; Vehicle</code> as you use to convert <code>Plane -&gt; Vehicle</code> and functions can be generic in which type of <code>Vehicle</code> they accept (without forcing the user to convert to a <code>Vehicle</code> first)</p>\n\n<pre><code>class IsVehicle v where\n  toVehicle :: v -&gt; Vehicle\ninstance IsVehicle Car where\n  toVehicle = car\ninstance IsVehicle Plane where\n  toVehicle = plane\n</code></pre>\n\n<p>But I'd suggest to avoid the typeclass if you can. It's better to rethink your design in this case if you want to do this in Haskell.</p>\n\n<p>This approach isn't exactly OOP because you do not have real subtyping (you cannot pass a <code>Car</code> where a <code>Vehicle</code> was expected, if you don't use the typeclass, so you have to manually convert first), but if you adapt your design to this style I found that is enough in practice. So I'd suggest not to try to translate an OOP-based structure to Haskell, but instead thinking of ways to solve this in the Haskell way. </p>\n\n<p>If you are OK with fixing the types of <code>Vehicles</code>, you can even use Haskell's sum types to express it even simpler:</p>\n\n<pre><code>data Vehicle = Car String | Plane String\n</code></pre>\n\n<p>This approach is quite different to your original approach, as you don't have separate types here anymore, but maybe it fits your use case if you adopt your architecture a little.</p>\n"}, {"comments": [{"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1423909704, "post_id": 28514294, "comment_id": 45346925, "body": "+1 for mentioning  <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">Luke Palmer&#39; blog post</a>. The <code>data</code> approach is better than type class (ab)use."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1423906748, "creation_date": 1423906748, "answer_id": 28514294, "question_id": 28513294, "link": "https://stackoverflow.com/questions/28513294/translating-object-orientated-class-structure-to-haskell/28514294#28514294", "title": "Translating object orientated class structure to Haskell", "body": "<p>First things first: every language has a different approach at programming. Translating a concept which lies at the core of language X into language Y will often lead to a very poor design. This is because the nice features of Y not present in X are neglected, while trying to put square pegs into round holes.</p>\n\n<p>OOP in Haskell simply does not fit well.</p>\n\n<p>And, for the sake of fairness, many features of Haskell don't fit well in most other languages.</p>\n\n<p>That being said, a common attempt to do some OOP in Haskell is through existential types. E.g.</p>\n\n<pre><code>data Car where\n   Car :: state -&gt; (state -&gt; String) -&gt; Car\n       -- ^^^^^ the internal representation\n                -- ^^^^^^^^^^^^^^^^^ a method\n</code></pre>\n\n<p>However, in many cases, encoding OOP with existentials is just an anti-pattern. Luke Palmer describes this in a famous <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow\">blog post</a>. (While I don't fully agree with some points, I find the general argument solid.) For instance, the type above is isomorphic to the simpler type</p>\n\n<pre><code>data Car where\n   Car :: String -&gt; Car\n       -- ^^^^^^ the method result\n</code></pre>\n\n<p>and because of laziness, the above works just as well as the original.</p>\n\n<p>Subtyping being non-existent in Haskell, you have to up-cast your types into <code>Car</code>, up-casting meaning converting the \"object\" into its <code>Car</code> form. Type classes can mitigate this, but often up-casting is not that annoying.</p>\n\n<p>Finally, let me confess I find an OOP a nice but vastly overrated approach to modelling. Just because a few \"big\" languages are OO-centered, does not mean that OO is the unquestionably best way to model everything.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 1, "answer_count": 3, "score": 2, "last_activity_date": 1423906748, "creation_date": 1423896982, "last_edit_date": 1423897475, "question_id": 28513294, "link": "https://stackoverflow.com/questions/28513294/translating-object-orientated-class-structure-to-haskell", "title": "Translating object orientated class structure to Haskell", "body": "<p>The below instances for <code>Vehicle</code> are illegal due to overlapping instances:</p>\n\n<pre><code>data Ford = Ford\ndata Ferrari = Ferrari\n\nclass Car c where\n  accelerate :: c -&gt; String\n\ninstance Car Ford where\n  accelerate _ = \"Broom broom I'm a Ford\"\n\ninstance Car Ferrari where\n  accelerate _ = \"Rrrr I'm a fast red Ferrari!\"\n\ndata Bowing747 = Bowing747\ndata JetFighter = JetFighter\n\nclass Plane p where\n  takeoff :: p -&gt; String\n\ninstance Plane Bowing747 where\n  takeoff _ = \"My passengers and I are taking off!\"\n\ninstance Plane JetFighter where\n  takeoff _ = \"RAWW I'm a loud jet fighter!\"\n\nclass Vehicle v where\n  go :: v -&gt; String\n\ninstance (Car c) =&gt; Vehicle c where\n  go = accelerate\n\ninstance (Plane p) =&gt; Vehicle p where\n  go = takeoff\n\nmain = return ()\n</code></pre>\n\n<p>I'm obviously approaching this in a very object orientated way, and perhaps this is where I'm going wrong.</p>\n\n<p>So how in Haskell can I have a structure like below that allows me to call generic functions in a hierarchy without:</p>\n\n<ol>\n<li>Keeping in sync repeated sets of instances.</li>\n<li>Requiring extra \"tag\" arguments to be added at the call site.</li>\n</ol>\n\n<p>That being said, I've got no need for <code>Car</code>, <code>Plane</code> or <code>Vehicle</code> to be clases, nor <code>Ford</code>, <code>Ferrari</code> etc to be defined how they are, as long as I can call <code>go (some vehicle)</code> and get the same result, and clients can add new cars, planes, and vehicle types without repeating myself. </p>\n\n<p>The vehicles for each type need to be open to users to add their own. The vehicle types themselves could be closed, I'd prefer if they weren't though.</p>\n"}, {"tags": ["string", "haskell", "char", "list-comprehension"], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 9, "last_activity_date": 1423898741, "last_edit_date": 1423898741, "creation_date": 1423897529, "answer_id": 28513362, "question_id": 28513264, "link": "https://stackoverflow.com/questions/28513264/how-to-combine-the-letters-in-two-strings-in-haskell/28513362#28513362", "title": "How to combine the letters in two strings in haskell", "body": "<p><code>++</code> works only for lists, but <code>x</code> and <code>y</code> are only <code>Char</code>. After all, they're elements from a <code>String</code> (= <code>[Char]</code>), whereas the LYAH example had lists of lists of <code>Char</code>: <code>[String] = [[Char]]</code>:</p>\n\n<pre><code>-- [a] -&gt; [a] -&gt; [a]\n-- vv     vv\n[y ++ ' ' ++ y | x &lt;- \"abd\", y &lt;- \"bcd\"]\n--           ^   ^           ^\n--           Char           Char\n\n-- vs\n\n--                                        [String]          [String]\n--                                       vvvvvvvvvv          vvvvv\n[adjective ++ \" \" ++ noun | adjective &lt;- adjectives, noun &lt;- nouns]  \n-- ^^^^^^^           ^^^^\n-- String           String\n</code></pre>\n\n<p>Instead, use <code>(:)</code> to cons the characters on each other and onto the empty list:</p>\n\n<pre><code>[x : ' ' : y : [] | x &lt;- \"abd\", y &lt;- \"bcd\"]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423915475, "post_id": 28513411, "comment_id": 45348214, "body": "I find <code>[x,&#39; &#39;,y]</code> visually nice here."}], "tags": [], "owner": {"reputation": 204954, "user_id": 1903116, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/w6Ffg.jpg?s=128&g=1", "display_name": "thefourtheye", "link": "https://stackoverflow.com/users/1903116/thefourtheye"}, "is_accepted": false, "score": 6, "last_activity_date": 1423923787, "last_edit_date": 1495540376, "creation_date": 1423897995, "answer_id": 28513411, "question_id": 28513264, "link": "https://stackoverflow.com/questions/28513264/how-to-combine-the-letters-in-two-strings-in-haskell/28513411#28513411", "title": "How to combine the letters in two strings in haskell", "body": "<pre><code>x ++ ' ' ++ y\n</code></pre>\n\n<p>The actual problem here is, you are trying to concatenate three characters, with a function defined only for list of items.\n<a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Prelude.html#v:-43--43-\" rel=\"nofollow noreferrer\"><code>++</code></a> will actually concatenate two lists, not two individual items and give a list.</p>\n\n<ol>\n<li><p>So, you can fix your program either by converting all the characters to strings, like this</p>\n\n<pre><code>&gt; [[x] ++ \" \" ++ [y] | x &lt;- \"ab\", y &lt;- \"cd\"]\n[\"a c\",\"a d\",\"b c\",\"b d\"]\n</code></pre>\n\n<p>Note the <code>\" \"</code>, not <code>' '</code>. Because <code>\" \"</code> means a string with just a space character, but <code>' '</code> means just the space character.</p></li>\n<li><p>Or, convert <code>y</code> to a String, use <code>cons</code> operator with the <code>' '</code>, and concatenate it to <code>x</code> converted to a string, like this</p>\n\n<pre><code>&gt; [[x] ++ (' ' : [y]) | x &lt;- \"ab\", y &lt;- \"cd\"]\n[\"a c\",\"a d\",\"b c\",\"b d\"]\n</code></pre></li>\n<li><p>Or, even simpler and intutive, <a href=\"https://stackoverflow.com/questions/28513264/how-to-combine-the-letters-in-two-strings-in-haskell/28513411#comment45348214_28513411\">as suggested by chi</a>, create a list of characters, like this</p>\n\n<pre><code>&gt; [[x, ' ', y] | x &lt;- \"ab\", y &lt;- \"cd\"]\n[\"a c\",\"a d\",\"b c\",\"b d\"]\n</code></pre></li>\n</ol>\n\n<p><strong>Note:</strong> Wrapping a character with <code>[]</code> makes it a list of characters with just one character in it. It basically becomes a String.</p>\n"}], "owner": {"reputation": 5679, "user_id": 1188760, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tDpUZ.png?s=128&g=1", "display_name": "Mimo", "link": "https://stackoverflow.com/users/1188760/mimo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10199, "favorite_count": 0, "accepted_answer_id": 28513362, "answer_count": 2, "score": 3, "last_activity_date": 1423923787, "creation_date": 1423896590, "last_edit_date": 1423898015, "question_id": 28513264, "link": "https://stackoverflow.com/questions/28513264/how-to-combine-the-letters-in-two-strings-in-haskell", "title": "How to combine the letters in two strings in haskell", "body": "<p>I am learning Haskell and following the guide on <a href=\"http://learnyouahaskell.com/starting-out\" rel=\"nofollow\">http://learnyouahaskell.com/starting-out</a>. I am at the point where it is shown:</p>\n\n<pre><code>ghci&gt; let nouns = [\"hobo\",\"frog\",\"pope\"]  \nghci&gt; let adjectives = [\"lazy\",\"grouchy\",\"scheming\"]  \nghci&gt; [adjective ++ \" \" ++ noun | adjective &lt;- adjectives, noun &lt;- nouns]  \n[\"lazy hobo\",\"lazy frog\",\"lazy pope\",\"grouchy hobo\",\"grouchy frog\",  \n\"grouchy pope\",\"scheming hobo\",\"scheming frog\",\"scheming pope\"]   \n</code></pre>\n\n<p>What I'd like to achieve, it is something similar, but combining the letters contained in two strings, and since strings are basically lists of char in Haskell, this is what I tried:</p>\n\n<pre><code> [x ++ ' ' ++ y | x &lt;- \"ab\", y &lt;- \"cd\"]\n</code></pre>\n\n<p>But the compiler is complaining:</p>\n\n<pre><code>Prelude&gt; [y ++ ' ' ++ y | x &lt;- \"abd\", y &lt;- \"bcd\"]\n\n&lt;interactive&gt;:50:2:\n    Couldn't match expected type \u2018[a]\u2019 with actual type \u2018Char\u2019\n    Relevant bindings include it :: [[a]] (bound at &lt;interactive&gt;:50:1)\n    In the first argument of \u2018(++)\u2019, namely \u2018y\u2019\n    In the expression: y ++ ' ' ++ y\n\n&lt;interactive&gt;:50:7:\n    Couldn't match expected type \u2018[a]\u2019 with actual type \u2018Char\u2019\n    Relevant bindings include it :: [[a]] (bound at &lt;interactive&gt;:50:1)\n    In the first argument of \u2018(++)\u2019, namely \u2018' '\u2019\n    In the second argument of \u2018(++)\u2019, namely \u2018' ' ++ y\u2019\n    In the expression: y ++ ' ' ++ y\n\n&lt;interactive&gt;:50:14:\n    Couldn't match expected type \u2018[a]\u2019 with actual type \u2018Char\u2019\n    Relevant bindings include it :: [[a]] (bound at &lt;interactive&gt;:50:1)\n    In the second argument of \u2018(++)\u2019, namely \u2018y\u2019\n    In the second argument of \u2018(++)\u2019, namely \u2018' ' ++ y\u2019\n</code></pre>\n\n<p>I did a number of tries, such as wrapping the expression in brackets to get a list, changed the space to be a String rather than a char... How can I get it working?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "classy-prelude", "peano-numbers"], "answers": [{"tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": false, "score": 1, "last_activity_date": 1423894121, "creation_date": 1423894121, "answer_id": 28512988, "question_id": 28512675, "link": "https://stackoverflow.com/questions/28512675/is-there-a-convenient-way-to-construct-larger-type-level-peano-numbers-using-mon/28512988#28512988", "title": "Is there a convenient way to construct larger type level Peano numbers using mono-traversable?", "body": "<p>You could port <a href=\"http://hackage.haskell.org/package/type-natural-0.2.3.2/docs/Data-Type-Natural.html#g:7\" rel=\"nofollow\"><code>type-natural</code>'s <code>QuasiQuoter</code>s</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1423896330, "last_edit_date": 1423896330, "creation_date": 1423895013, "answer_id": 28513100, "question_id": 28512675, "link": "https://stackoverflow.com/questions/28512675/is-there-a-convenient-way-to-construct-larger-type-level-peano-numbers-using-mon/28513100#28513100", "title": "Is there a convenient way to construct larger type level Peano numbers using mono-traversable?", "body": "<p>There is a package for this sort of thing: <a href=\"https://hackage.haskell.org/package/type-level\" rel=\"nofollow\">type-level</a>. It's a bit intimidating, and I haven't really explored it yet. But you shouldn't need that much power, so you can roll your own simple bits.</p>\n\n<p>If you're willing to use <code>UndecidableInstances</code>, things are pretty easy. Something approximately like this (I don't know exactly how the naturals are defined in that library; if it doesn't use <code>DataKinds</code>, you may have to use the <code>*</code> kind instead of the <code>Nat</code> kind, and you may have to write <code>'Succ</code> and <code>'Zero</code> instead of <code>Succ</code> and <code>Zero</code>--I'm not too clear on that aspect):</p>\n\n<pre><code>{-# LANGUAGE UndecidableInstances, TypeFamilies, DataKinds, TypeOperators #-}\n\nmodule TAR where\n\n-- You wouldn't actually use this line, because the library\n-- provides the naturals\ndata Nat = Zero | Succ Nat\n\n-- Digits and Ten to get things started\ntype One = Succ Zero\ntype Two = Succ One\ntype Three = Succ Two\ntype Four = Succ Three\ntype Five = Succ Four\ntype Six = Succ Five\ntype Seven = Succ Six\ntype Eight = Succ Seven\ntype Nine = Succ Eight\ntype Ten = Succ Nine\n\ntype family Plus (a::Nat) (b::Nat) where\n  Plus Zero n = n\n  Plus (Succ m) n = Plus m (Succ n)\n\ntype family Times (a::Nat) (b::Nat) where\n  Times Zero n = Zero\n  Times (Succ m) n = Plus n (Times m n)\n\ntype Decimal (a::[Nat]) = Decimal' a Zero\n\ntype family Decimal' (a::[Nat]) (n::Nat) where\n  Decimal' '[] n = n\n  Decimal' (a ': bs) n = Decimal' bs (Plus a (Times Ten n))\n</code></pre>\n\n<p>Then you can write something like</p>\n\n<pre><code>Decimal '[One, Two, Five]\n</code></pre>\n\n<p>to mean 125.</p>\n"}, {"comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1423935270, "post_id": 28513809, "comment_id": 45353577, "body": "Am I  understanding correctly that if we added some code like that to mono-traversable then users would be able to use type level literals more easily?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1423936241, "post_id": 28513809, "comment_id": 45353859, "body": "I think yes. But note that this is available only from GHC 7.8."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1423902271, "creation_date": 1423902271, "answer_id": 28513809, "question_id": 28512675, "link": "https://stackoverflow.com/questions/28512675/is-there-a-convenient-way-to-construct-larger-type-level-peano-numbers-using-mon/28513809#28513809", "title": "Is there a convenient way to construct larger type level Peano numbers using mono-traversable?", "body": "<p><code>TypeLits</code> is perfectly good for type-level numerals. Also, it's easy to use  it only for syntactic sugar and leave the underlying library-specific implementation unchanged.</p>\n\n<pre><code>{-# LANGUAGE\n  UndecidableInstances, TypeFamilies,\n  DataKinds, TypeOperators #-}\n\nimport qualified GHC.TypeLits as TL\n\ndata Nat = Zero | Succ Nat\n\nnewtype MinLen (n :: Nat) a = MinLen a\n</code></pre>\n\n<p>We have to define a type family that converts a literal to the number type:</p>\n\n<pre><code>type family Lit (n :: TL.Nat) :: Nat where\n  Lit 0 = Zero\n  Lit n = Succ (Lit (n TL.- 1))\n</code></pre>\n\n<p>Now you can use <code>Lit n</code> whenever you need a <code>Nat</code> literal. In GHCi:</p>\n\n<pre><code>&gt;:kind! MinLen (Lit 3)\nMinLen (Lit 3) :: * -&gt; *\n= MinLen ('Succ ('Succ ('Succ 'Zero)))\n</code></pre>\n"}], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 28513809, "answer_count": 3, "score": 4, "last_activity_date": 1423902271, "creation_date": 1423890904, "question_id": 28512675, "link": "https://stackoverflow.com/questions/28512675/is-there-a-convenient-way-to-construct-larger-type-level-peano-numbers-using-mon", "title": "Is there a convenient way to construct larger type level Peano numbers using mono-traversable?", "body": "<p>The mono-traversable package uses type level Peano numbers for <code>MinLen</code>. I can construct them using chained <code>Succ</code>s:</p>\n\n<pre><code>toMinLen [1,2,3] :: Maybe (MinLen (Succ (Succ Zero)) [Int])\n</code></pre>\n\n<p>but this quickly gets out of hand:</p>\n\n<pre><code>toMinLen [1,2,3] :: Maybe (MinLen (Succ (Succ (Succ (Succ (Succ Zero))))) [Int])\n</code></pre>\n\n<p>Is there a convenient way to construct larger Peano numbers? I see GHC has a TypeLiterals extension but I'm not sure if I can use it here. Alternatively, I can make synonyms like:</p>\n\n<pre><code>type One = Succ Zero\ntype Two = Succ One\n</code></pre>\n\n<p>and so on; does something like that already exist somewhere?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 3, "creation_date": 1423896245, "post_id": 28511329, "comment_id": 45344616, "body": "These are datatypes, not classes."}], "answers": [{"tags": [], "owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "is_accepted": true, "score": 5, "last_activity_date": 1423876652, "creation_date": 1423876652, "answer_id": 28511356, "question_id": 28511329, "link": "https://stackoverflow.com/questions/28511329/converting-a-binarytree-to-a-tree/28511356#28511356", "title": "Converting a BinaryTree to a Tree?", "body": "<p>Sure. The structure of the <code>Tree</code> allows us to put the two subtrees into the list:</p>\n\n<pre><code>convert EmptyBin = EmptyTree\nconvert (Node a l r) = Tree a [convert l,convert r]\n</code></pre>\n\n<p>If you wanted to convert the other way, that might be more complex, depending on how you wanted to branch a long list of subtrees, but you could use an <code>Ord a</code> context to help you there.</p>\n"}], "owner": {"reputation": 47363, "user_id": 146780, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/48ea519fede5177604945a5c430e6e19?s=128&d=identicon&r=PG", "display_name": "jmasterx", "link": "https://stackoverflow.com/users/146780/jmasterx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 28511356, "answer_count": 1, "score": 1, "last_activity_date": 1423876652, "creation_date": 1423876399, "question_id": 28511329, "link": "https://stackoverflow.com/questions/28511329/converting-a-binarytree-to-a-tree", "title": "Converting a BinaryTree to a Tree?", "body": "<p>I have 2 classes: One which is a Tree which can have N subtrees, and BinaryTree can have at most 2 subtrees.</p>\n\n<p>The classes are defined like so:</p>\n\n<pre><code>data Tree a = EmptyTree | Tree a [Tree a] deriving (Show, Ord, Eq)\ndata BinTree a = EmptyBin | Node a (BinTree a) (BinTree a) deriving (Show, Ord, Eq)\n</code></pre>\n\n<p>Is there a way I could convert a BinaryTree into a Tree?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1517072781, "post_id": 28510625, "comment_id": 83949654, "body": "Slightly related: Is there a ready-to-use haskell library for this purpose?"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 2725333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca5e5a583bf86118cbc6543c05f77d72?s=128&d=identicon&r=PG&f=1", "display_name": "user2725333", "link": "https://stackoverflow.com/users/2725333/user2725333"}, "edited": false, "score": 0, "creation_date": 1423879972, "post_id": 28511149, "comment_id": 45342093, "body": "Thanks for the quick reply with a great explanation."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1423874739, "creation_date": 1423874739, "answer_id": 28511149, "question_id": 28510625, "link": "https://stackoverflow.com/questions/28510625/how-do-you-parse-an-intel-hex-record-with-applicative-functors-using-the-haskell/28511149#28511149", "title": "How do you parse an Intel Hex Record with applicative functors using the haskell parsec library?", "body": "<p>There are a number of things not included in your question that you need in order to use parsec. To define things like <code>startOfRecord</code>, we need to disable the dreaded monomorphism restriction. If we want to write type signatures for anything like <code>startOfRecord</code> we also need to enable <code>FlexibleContexts</code>. We also need to import parsec, <code>Control.Applicative</code>, and <code>Numeric (readHex)</code></p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nimport Text.Parsec\nimport Control.Applicative\nimport Numeric (readHex)\n</code></pre>\n\n<p>I'm also going to use <code>Word8</code> and <code>Word16</code> from <code>Data.Word</code> since they exactly match the types used in intel hex records.</p>\n\n<pre><code>import Data.Word\n</code></pre>\n\n<p>Ignoring the <code>recordData</code> for a momement, we can define how to read hex values for bytes (<code>Word8</code>) and 16 bit integer addresses (<code>Word16</code>).</p>\n\n<pre><code>hexWord8 :: (Stream s m Char) =&gt; ParsecT s u m Word8\nhexWord8 = toHexValue &lt;$&gt; count 2 hexDigit\n\nhexWord16 :: (Stream s m Char) =&gt; ParsecT s u m Word16\nhexWord16 = toHexValue &lt;$&gt; count 4 hexDigit\n\ntoHexValue :: (Num a, Eq a) =&gt; String -&gt; a\ntoHexValue = fst . head . readHex\n</code></pre>\n\n<p>This lets us define all of the pieces except for <code>recordData</code>.</p>\n\n<pre><code>startOfRecord = char ':'\nbyteCount = hexWord8\naddress = hexWord16\nrecordType = hexWord8\nchecksum = hexWord8\n</code></pre>\n\n<p>Leaving out <code>recordData</code>, we can now write something like your <code>line</code> in <code>Applicative</code> style. Application in <code>Applicative</code> style is written as <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Control-Applicative.html#v:-60--42--62-\" rel=\"nofollow\"><code>&lt;*&gt;</code></a> (<code>.</code> is function composition or <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Control-Category.html\" rel=\"nofollow\">composition in <code>Category</code>s</a>).</p>\n\n<pre><code>line = _ &lt;$&gt; startOfRecord &lt;*&gt; byteCount &lt;*&gt; address &lt;*&gt; recordType &lt;*&gt; checksum\n</code></pre>\n\n<p>The compiler will tell us about the type of the hole <code>_</code>. It says</p>\n\n<pre><code>    Found hole `_'\n      with type: Char -&gt; Word8 -&gt; Word16 -&gt; Word8 -&gt; Word8 -&gt; b\n</code></pre>\n\n<p>If we had a function with that type, we could use it here and make a <code>ParserT</code> that reads something like a record, but still missing the <code>recordData</code>. We'll make a data type to hold all of an intel hex record except for the actual data.</p>\n\n<pre><code>data IntelHexRecord = IntelHexRecord Word8 Word16 Word8 {- [Word8] -} Word8\n</code></pre>\n\n<p>If we drop this into <code>line</code> (with <code>const</code> to discard the <code>startOfRecord</code>)</p>\n\n<pre><code>line = const IntelHexRecord &lt;$&gt; startOfRecord &lt;*&gt; byteCount &lt;*&gt; address &lt;*&gt; recordType &lt;*&gt; checksum\n</code></pre>\n\n<p>the compiler will tell us that the type of <code>line</code> is a parser for our pseudo-<code>IntelHexRecord</code>.</p>\n\n<pre><code>*&gt; :t line\nline :: Stream s m Char =&gt; ParsecT s u m IntelHexRecord\n</code></pre>\n\n<p>This is as far as we can go with <code>Applicative</code> style. Let's define how to read the <code>recordData</code> assuming we already somehow know the <code>byteCount</code>.</p>\n\n<pre><code>recordData :: (Stream s m Char) =&gt; Word8 -&gt; ParsecT s u m [Word8]\nrecordData c = count (fromIntegral c) hexWord8\n</code></pre>\n\n<p>We'll also modify <code>IntelHexRecord</code> to have a place to hold the data.</p>\n\n<pre><code>data IntelHexRecord = IntelHexRecord Word8 Word16 Word8 [Word8] Word8\n</code></pre>\n\n<p>If you have an <code>Applicative f</code>, there's no way, in general, to choose the structure based on the contents. That's the big difference between an <code>Applicative</code> and a <code>Monad</code>; a <code>Monad</code>'s bind, <code>(&gt;&gt;=) :: forall a b. m a -&gt; (a -&gt; m b) -&gt; m b</code>, allows you to choose the structure based on the contents. This is exactly what we need to do to determine how to read the <code>recordData</code> based on the result we obtained earlier by reading the <code>byteCount</code>.</p>\n\n<p>The easiest way to use one bind <code>&gt;&gt;=</code> in the definition of <code>line</code> is to switch entirely to <code>Monad</code>ic style and <code>do</code>-notation.</p>\n\n<pre><code>line = do\n    startOfRecord\n    bc   &lt;- byteCount\n    addr &lt;- address\n    rt   &lt;- recordType\n    rd   &lt;- recordData bc\n    cs   &lt;- checksum\n    return $ IntelHexRecord bc addr rt rd cs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 43, "user_id": 3235073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07b4b42d1b430c43c4b13cc199b18c40?s=128&d=identicon&r=PG&f=1", "display_name": "Hauke", "link": "https://stackoverflow.com/users/3235073/hauke"}, "is_accepted": false, "score": 1, "last_activity_date": 1423880888, "creation_date": 1423880888, "answer_id": 28511779, "question_id": 28510625, "link": "https://stackoverflow.com/questions/28510625/how-do-you-parse-an-intel-hex-record-with-applicative-functors-using-the-haskell/28511779#28511779", "title": "How do you parse an Intel Hex Record with applicative functors using the haskell parsec library?", "body": "<p>As far as my understanding goes, the limitation of Applicative Parsers (compared with Monadic Parsers) is that you are limited to parsing <em>context-free</em> expressions.</p>\n\n<p>By this I mean that decisions about how to parse at a certain point cannot depend on <em>values</em> parsed before, only on the structure (i.e. a parser failed, so we try to apply a different one).</p>\n\n<p>I find that this can be explained from the operators themselves:</p>\n\n<pre><code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>For <code>&lt;*&gt;</code> you can see that everything takes place at the level of the values 'contained in' the Applicative whereas for <code>&gt;&gt;=</code> the value can be used to influence the containing structure. This is precicely what makes Monads more powerful than Applicatives.</p>\n\n<p>For your Problem this means that you nedd to use a monadic parser to stick all the individual pieces together, appoximaly like this:</p>\n\n<pre><code>parseRecord = do\n  count &lt;- byteCount\n  ...\n  rData &lt;- recordData count\n  ...\n  return (count,rData,...)\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 2725333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca5e5a583bf86118cbc6543c05f77d72?s=128&d=identicon&r=PG&f=1", "display_name": "user2725333", "link": "https://stackoverflow.com/users/2725333/user2725333"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 0, "accepted_answer_id": 28511149, "answer_count": 2, "score": 4, "last_activity_date": 1423880888, "creation_date": 1423870976, "question_id": 28510625, "link": "https://stackoverflow.com/questions/28510625/how-do-you-parse-an-intel-hex-record-with-applicative-functors-using-the-haskell", "title": "How do you parse an Intel Hex Record with applicative functors using the haskell parsec library?", "body": "<p>I would like to parse an Intel Hex Record with parsec using the applicative functor style.  A typical records looks like the following:</p>\n\n<p>:10010000214601360121470136007EFE09D2190140</p>\n\n<p>The first character is always ':', the next two characters are a hex string representing the number of bytes in the record.  The next four characters are a hex string identifying the start address of the data.  I had code like the following, but I don't know how to applicatively pass the byte count to the parser that parses the data bytes.  My non-working code looks like the following.</p>\n\n<pre><code>line = startOfRecord . byteCount . address . recordType . recordData . checksum\nstartOfRecord = char ':'\nbyteCount = toHexValue &lt;$&gt; count 2 hexDigit\naddress = toHexValue &lt;$&gt; count 4 hexDigit\nrecordType = toHexValue &lt;$&gt; count 2 hexDigit\nrecordData c = toHexValue &lt;$&gt; count c hexDigit\nrecordData c CharParser = count c hexDigit\nchecksum = toHexValue &lt;$&gt; count 2 hexDigit\n\ntoHexValue :: String -&gt; Int\ntoHexValue = fst . head . readHex\n</code></pre>\n\n<p>Could anyone help me?  Thanks.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 5, "creation_date": 1423870075, "post_id": 28510425, "comment_id": 45339922, "body": "A list of lists is still a list. That is, the <code>a</code> in <code>any</code>&#39;s type can be a list type."}, {"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423871058, "post_id": 28510425, "comment_id": 45340205, "body": "@&#216;rjanJohansen But when I code <code>any (&gt;5) [[6]]</code> it returns an error. When I code <code>any (&gt;5) [6]</code>, it returns <code>True</code>. Also, I was hoping that someone could illuminate me as to how the <code>isInfixOf</code> function works, because there must be some Haskell features there that I couldn&#39;t understand yet."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423871230, "post_id": 28510425, "comment_id": 45340250, "body": "Well in that case you are trying to make <code>a</code> be both a list and a <i>number</i> at the same time. <i>That</i> doesn&#39;t work."}, {"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "reply_to_user": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423872623, "post_id": 28510425, "comment_id": 45340586, "body": "@&#216;rjanJohansen Thanks to your insight, I think I got it: <code>isPrefixOf needle</code> is a function that will take a list and return a <code>Bool</code>, and it&#39;s applied to every element in the list returned by <code>tails haystack</code>, just like <code>&gt;5</code> was applied to <code>[6]</code>. Is that it? How can I thank you for your time man?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423875019, "post_id": 28510425, "comment_id": 45341164, "body": "(1) Yep. (2) I think you already did."}], "answers": [{"tags": [], "owner": {"reputation": 490, "user_id": 635669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0408d7a07f6d5460814d9016aef947c?s=128&d=identicon&r=PG", "display_name": "Guiraldelli", "link": "https://stackoverflow.com/users/635669/guiraldelli"}, "is_accepted": true, "score": 6, "last_activity_date": 1423872949, "last_edit_date": 1423872949, "creation_date": 1423872577, "answer_id": 28510860, "question_id": 28510425, "link": "https://stackoverflow.com/questions/28510425/haskell-how-does-the-data-list-isinfixof-function-work/28510860#28510860", "title": "Haskell: How does the Data.List.isInfixOf function work?", "body": "<p>We could read <code>isInfixOf needle haystack = any (isPrefixOf needle) (tails haystack)</code> as: <strong>return <code>True</code> if <code>needle</code> <code>isPrefixOf</code> <code>any</code> subdivision of <code>haystack</code> taking away the first elements (i.e., taking the <code>tails</code>) of it.</strong></p>\n\n<p>Isn't it clear yet? Let's try another approach, using your example.</p>\n\n<pre><code>isInfixOf \"Haskell\" \"I really like Haskell.\"\n</code></pre>\n\n<p>Giving that <code>String</code> is the same as <code>[Char]</code>, we have the following signature for your example:</p>\n\n<pre><code>isInfixOf :: (Eq [Char]) =&gt; [Char] -&gt; [Char] -&gt; Bool\n</code></pre>\n\n<p>So far so good, huh? Let's see <code>any</code>? No. Let's see <code>isPrefixOf</code>, because it is actually called first and fill the type blanks of <code>any</code>.</p>\n\n<pre><code>isPrefixOf :: (Eq Char) -&gt; [Char] -&gt; [Char] -&gt; Bool\n</code></pre>\n\n<p>So what <code>isPrefixOf</code> doing? It is comparing, <code>Char</code> by <code>Char</code>, if the first <code>String</code> (or array of <code>Char</code>s) is in the begining of the second <code>String</code>. Now, let's get back to <code>any</code>: <code>any :: (a -&gt; Bool) -&gt; [a] -&gt; Bool</code>. But the function being passed to <code>any</code>, in the example, is <code>isPrefixOf needle</code>, i.e., <code>isPrefixOf \"Haskell\"</code>. Or, in other words, the function begin passed to <code>any</code>, of the type <code>(a -&gt; Bool)</code>, is actually <code>(String -&gt; Bool)</code> or, if you prefer, <code>([Char] -&gt; Bool)</code>. Got it? It is about the partial application functions: <code>isPrefixOf</code> is, originally (in our example), </p>\n\n<pre><code>isPrefixOf :: (Eq Char) -&gt; [Char] -&gt; [Char] -&gt; Bool\n</code></pre>\n\n<p>However, I am passing, as a function, <code>isPrefixOf \"Haskell\"</code>, so it is fixed as <code>isPrefixOf \"Haskell\" :: \"Haskell\" -&gt; [Char] -&gt; Bool</code>, a notation that doesn't exist as you can imagine. Let's make it \"real\"? Just take away what seems strange: </p>\n\n<pre><code>isPrefixOf \"Haskell\" :: [Char] -&gt; Bool\n</code></pre>\n\n<p>or</p>\n\n<pre><code>isPrefixOf \"Haskell\" :: String -&gt; Bool\n</code></pre>\n\n<p>Back, again, to <code>any</code>. As you can imagine, <code>any</code>, now, is </p>\n\n<pre><code>any :: (String -&gt; Bool) -&gt; [String] -&gt; Bool\n</code></pre>\n\n<p>or</p>\n\n<pre><code>any :: ([Char] -&gt; Bool) -&gt; [[Char]] -&gt; Bool\n</code></pre>\n\n<p>Well, I think that now the idea of <code>tails</code> is totally clear for you.</p>\n\n<pre><code>tails \"I really like Haskell.\" :: String -&gt; [String]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>tails \"I really like Haskell.\" :: [Char] -&gt; [[Char]]\n</code></pre>\n\n<p>At the end, the execution is:</p>\n\n<pre><code>isInfixOf \"Haskell\" \"I really like Haskell.\" = \nany (isPrefixOf \"Haskell\") (tails \"I really like Haskell.\") = \nany (isPrefixOf \"Haskell\") [\n    \"I really like Haskell.\",\n    \" really like Haskell.\",\n    \"really like Haskell.\",\n    \"eallylike Haskell.\",\n    \"ally like Haskell.\",\n    \"lly like Haskell.\",\n    \"ly like Haskell.\",\n    \"y like Haskell.\",\n    \" like Haskell.\",\n    \"like Haskell.\",\n    \"ike Haskell.\",\n    \"ke Haskell.\",\n    \"e Haskell.\",\n    \"Haskell.\",\n    \"Haskell.\",\n    \"askell.\",\n    \"skell.\",\n    \"kell.\",\n    \"ell.\",\n    \"ll.\",\n    \"l.\",\n    \".\",\n    \"\"]\n</code></pre>\n\n<p>Well, it is easy to very that <code>\"Haskell\"</code> is prefix of <code>\"Haskell.\"</code>.</p>\n\n<p>I hope I have explained it clearly. :)</p>\n"}], "owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2625, "favorite_count": 0, "accepted_answer_id": 28510860, "answer_count": 1, "score": 1, "last_activity_date": 1423872949, "creation_date": 1423869842, "question_id": 28510425, "link": "https://stackoverflow.com/questions/28510425/haskell-how-does-the-data-list-isinfixof-function-work", "title": "Haskell: How does the Data.List.isInfixOf function work?", "body": "<p>I've been trying to understand the <code>isInfixOf</code> function from the <code>Data.List</code> module, to no avail. Here's the code:</p>\n\n<pre><code>     isInfixOf               :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Bool\n     isInfixOf needle haystack = any (isPrefixOf needle) (tails haystack)\n\n     -- Example:\n     --\n     -- &gt;isInfixOf \"Haskell\" \"I really like Haskell.\" -&gt; True\n     -- &gt;isInfixOf \"Ial\" \"I really like Haskell.\" -&gt; False\n</code></pre>\n\n<p>The <code>any</code> returns True if at least one item in the list fulfills the condition. It's type is <code>(a -&gt; Bool) -&gt; [a] -&gt; Bool</code></p>\n\n<p>The <code>isPrefixOf</code> and the <code>tails</code> functions codes are these:</p>\n\n<pre><code>    isPrefixOf :: (Eq a) =&gt; [a] -&gt; [a] -&gt; Bool\n    isPrefixOf [] _ = True\n    isPrefixOf _ [] = False\n    isPrefixOf (x:xs) (y:ys) = x == y &amp;&amp; isPrefixOf xs ys\n\n    tails :: [a] -&gt; [[a]]\n    tails xs = xs : case xs of \n                    [] -&gt; [] \n                    _  : xs' -&gt; tails xs'\n\n    -- Example: \n    -- tails \"abc\" == [\"abc\", \"bc\", \"c\",\"\"]\n</code></pre>\n\n<p>I've read about curried functions and partial applied functions but I couldn't understand it yet, neither could I understand how this particular function works. How can it work if <code>any</code> takes lists, not a list of lists, as a parameter?</p>\n"}, {"tags": ["haskell", "types", "haskell-lens", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1423869192, "post_id": 28510035, "comment_id": 45339679, "body": "This example also requires <code>RankNTypes</code> to talk about the lens type synonyms, <code>FlexibleInstances</code> for the <code>IsString</code> instance, either <code>TypeFamilies</code> or <code>GADTs</code> for <code>~</code>, and <code>hiding ((.=))</code> when importing <code>Data.Aeson</code>."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 5, "last_activity_date": 1423874973, "last_edit_date": 1423874973, "creation_date": 1423867550, "answer_id": 28510035, "question_id": 28509424, "link": "https://stackoverflow.com/questions/28509424/is-it-possible-to-make-traversal-an-instance-of-isstring/28510035#28510035", "title": "Is it possible to make Traversal an instance of IsString", "body": "<p>I couldn't get your code to compile, but that shouldn't matter. I assume that you have a function of type </p>\n\n<pre><code>fromStringTraversal :: (AsValue t, FromJSON v, ToJSON v, Default v) \n                    =&gt; String -&gt; Traversal' t v \nfromStringTraversal = undefined\n</code></pre>\n\n<p>Then to write your instance, simply inline the definition of <code>Traversal'</code> into the instance head. This works because any type variables in an instance are universally quantified over implicitly anyways. </p>\n\n<pre><code>{-# LANGUAGE RankNTypes, FlexibleInstances, GADTs #-}\n\ninstance (a ~ a', b ~ b', AsValue b, Default a, FromJSON a, ToJSON a, Applicative f) \n       =&gt; IsString ((a -&gt; f a') -&gt; b -&gt; f b') where\n  fromString = fromStringTraversal\n</code></pre>\n\n<p>The <code>a ~ a', b ~ b'</code> constraints could be moved from the context to the instance head, but this way gives better type inference. Then</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, NoMonomorphismRestriction #-}\n\n-- Infered type:\n-- test :: (AsValue s, MonadState s m) =&gt; m ()\ntest = \"some-key\" .= (3 :: Int)\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 1371685, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57ac5aabbe1139d8811790a873fac763?s=128&d=identicon&r=PG", "display_name": "Pavel", "link": "https://stackoverflow.com/users/1371685/pavel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 28510035, "answer_count": 1, "score": 3, "last_activity_date": 1423874973, "creation_date": 1423864487, "last_edit_date": 1423869235, "question_id": 28509424, "link": "https://stackoverflow.com/questions/28509424/is-it-possible-to-make-traversal-an-instance-of-isstring", "title": "Is it possible to make Traversal an instance of IsString", "body": "<p>I want to use string literal as Traversal, but I am a bit lost in types.\nIs it possible to create this instance?</p>\n\n<pre><code>import Control.Lens\nimport Data.Aeson\nimport Data.Aeson.Lens\nimport Data.String\nimport Data.Default\n\n{- Having:\nkey'  :: AsValue t =&gt; Text -&gt; Traversal' t (Maybe Value)\n_JSON :: (ToJSON a, FromJSON a) =&gt; Traversal' t a\n-}\n\ninstance (AsValue t, FromJSON v, ToJSON v, Default v) =&gt; IsString (Traversal' t v) where\n  fromString k = key' (fromString k) . non (toJSON def) . _JSON\n</code></pre>\n\n<p>To achieve something like this inside State monad:</p>\n\n<pre><code>\"some-key\" .= (3 :: Int)\n</code></pre>\n\n<p>Problem with universally quantified type instances. Thanks!</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1423866559, "post_id": 28508895, "comment_id": 45338730, "body": "<code>cabal run</code> is for running executables in a cabal environment. This is not your use case. You just want to run an executable which is created by a cabal package, namely ghc-mod. By default, cabal places executables in the cabal directory (on windows this is %APPDATA%/cabal - hopefully you can figure out which directory it is on your machine)."}, {"owner": {"reputation": 145, "user_id": 4171919, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5614376d41f80ff368cb2c7c5dd46c49?s=128&d=identicon&r=PG&f=1", "display_name": "hjkml", "link": "https://stackoverflow.com/users/4171919/hjkml"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1423871078, "post_id": 28508895, "comment_id": 45340213, "body": "Thanks. My executables seem to have been placed in <code>$HOME&#47;Library&#47;Haskell&#47;bin</code>, which I added to my <code>PATH</code>, but I can&#39;t run <code>ghc-mod</code>."}, {"owner": {"reputation": 145, "user_id": 4171919, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5614376d41f80ff368cb2c7c5dd46c49?s=128&d=identicon&r=PG&f=1", "display_name": "hjkml", "link": "https://stackoverflow.com/users/4171919/hjkml"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1423932206, "post_id": 28508895, "comment_id": 45352671, "body": "Never mind, there was a typo in my PATH. Thanks for your help."}], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 4171919, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5614376d41f80ff368cb2c7c5dd46c49?s=128&d=identicon&r=PG&f=1", "display_name": "hjkml", "link": "https://stackoverflow.com/users/4171919/hjkml"}, "edited": false, "score": 0, "creation_date": 1423871170, "post_id": 28509633, "comment_id": 45340236, "body": "Thanks. Cabal seems to have placed <code>ghc-mod</code> and other executables automatically in <code>$HOME&#47;Library&#47;Haskell&#47;bin</code>, which is in my <code>PATH</code>, but I can&#39;t run it, and <code>which ghc-mod</code> doesn&#39;t find it."}, {"owner": {"reputation": 145, "user_id": 4171919, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5614376d41f80ff368cb2c7c5dd46c49?s=128&d=identicon&r=PG&f=1", "display_name": "hjkml", "link": "https://stackoverflow.com/users/4171919/hjkml"}, "edited": false, "score": 0, "creation_date": 1423932225, "post_id": 28509633, "comment_id": 45352687, "body": "Never mind, there was a typo in my PATH. Thanks for your help."}], "tags": [], "owner": {"reputation": 1030, "user_id": 521806, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PaOw7.jpg?s=128&g=1", "display_name": "Juan Pablo Santos", "link": "https://stackoverflow.com/users/521806/juan-pablo-santos"}, "is_accepted": false, "score": -2, "last_activity_date": 1423867775, "last_edit_date": 1423867775, "creation_date": 1423865498, "answer_id": 28509633, "question_id": 28508895, "link": "https://stackoverflow.com/questions/28508895/installing-ghc-mod-with-cabal/28509633#28509633", "title": "Installing `ghc-mod` with Cabal", "body": "<p>The standard way to install stuff on Haskell nowadays is within sandboxes.</p>\n\n<p>Go to the terminal and create an empty folder that will house your ghc-mod sandbox. cd into that folder and:</p>\n\n<p><code>cabal sandbox init</code><br>\n<code>cabal install ghc-mod</code>  </p>\n\n<p>After it finishes you will find the <code>ghc-mod</code> binary you seek within <code>.cabal-sandbox/bin</code>. Since it's statically linked it's safe to move it to somewhere in your $PATH.</p>\n\n<p>I strongly encourage you use a sandbox but if you don't want to go to .cabal in your home directory and you will find the binary with <code>bin</code></p>\n"}], "owner": {"reputation": 145, "user_id": 4171919, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5614376d41f80ff368cb2c7c5dd46c49?s=128&d=identicon&r=PG&f=1", "display_name": "hjkml", "link": "https://stackoverflow.com/users/4171919/hjkml"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2804, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1423867775, "creation_date": 1423862282, "question_id": 28508895, "link": "https://stackoverflow.com/questions/28508895/installing-ghc-mod-with-cabal", "title": "Installing `ghc-mod` with Cabal", "body": "<p><code>cabal install ghc-mod</code> seems to work, but when I try <code>cabal run ghc-mod</code> I get the following error:</p>\n\n<pre><code>Package has never been configured. Configuring with default flags. If this fails, please configure manually.\ncabal: No cabal file found.\nPlease create a package description file &lt;pkgname&gt;.cabal\n</code></pre>\n\n<p>The resources I've found seem to suggest that creating a package description file shouldn't be necessary to install a package.</p>\n\n<p>Any ideas?</p>\n"}]