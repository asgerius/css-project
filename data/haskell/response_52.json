[{"tags": ["haskell", "recursion", "memoization"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 5, "creation_date": 1452123214, "post_id": 34644761, "comment_id": 57035563, "body": "This is a scoping issue.  Try <code>nders = (map der [0..] !!)</code> instead, which indicates that <code>n</code> does not need to be known to evaluate the <code>map</code>  (The reason the compiler doesn&#39;t do this automatically is that it can create unwanted memory leaks .. which is what you are doing here, except that you want the memory leak ;-)"}, {"owner": {"reputation": 1178, "user_id": 1568590, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/b6bb720c28219294cf31d0693ed47388?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1568590/alasdair"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1452123832, "post_id": 34644761, "comment_id": 57035784, "body": "Many thanks!  Yep, that works perfectly.  These are fiddly matters I&#39;ve yet to get my head around.  Curiously, the map needs to be defined on <code>[0..]</code>; if I define it on <code>[1..]</code> the function doesn&#39;t work."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1452124651, "post_id": 34644761, "comment_id": 57036047, "body": "Yeah that&#39;s because <code>!!</code> is zero-based.  The strategy hinges on the fact that <code>[0..] !! n = n</code> for all the <code>n</code>s we&#39;re interested in (because we need <code>map f [0..] !! n = f n</code>, so it had better work for <code>f = id</code>)"}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 3, "last_activity_date": 1452141176, "creation_date": 1452141176, "answer_id": 34647439, "question_id": 34644761, "link": "https://stackoverflow.com/questions/34644761/haskell-memoization/34647439#34647439", "title": "Haskell: memoization", "body": "<p>With</p>\n\n<pre><code>nders :: Int -&gt; Integer\nnders n = (map der [0 ..]) !! n\n  where der 0 = 1\n        der 1 = 0\n        der n = (nders (n-2) + nders (n-1)) * toInteger (n-1)\n</code></pre>\n\n<p>the <code>map der [0..]</code> part will be recomputed for any application of <code>nders</code>, especially including the recursive calls in <code>der</code>.</p>\n\n<p>You can move out the definition of the tabulation so that it doesn't (syntactically) depend on <code>n</code>, which should do the right thing:</p>\n\n<pre><code>nders :: Int -&gt; Integer\nnders = (memoized !!)\n  where \n    memoized = map der [0 ..]\n\n    der 0 = 1\n    der 1 = 0\n    der n = (nders (n-2) + nders (n-1)) * toInteger (n-1)\n</code></pre>\n"}], "owner": {"reputation": 1178, "user_id": 1568590, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/b6bb720c28219294cf31d0693ed47388?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1568590/alasdair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1452141232, "creation_date": 1452122624, "last_edit_date": 1452141232, "question_id": 34644761, "link": "https://stackoverflow.com/questions/34644761/haskell-memoization", "title": "Haskell: memoization", "body": "<p>I'm trying to relearn Haskell, after many years away and forgetting everything, and I find myself still confused my <em>memoization</em>. In particular, I'm trying to write a program to generate the number of derangements <code>D[n]</code> of <code>n</code> objects (permutations with no item in its original place); the numbers <code>D[n]</code> can be defined recursively by <code>D[1]=0</code>, <code>D[2]=1</code>, <code>D[n]=(n-1)(D[n-1]+D[n-2])</code>.</p>\n\n<p>So this works:</p>\n\n<pre><code>der :: Int -&gt; Integer\nder n = lder !! n\n  where lder = 1 : 0 : zipWith3 (\\n d1 d2 -&gt; n * (d1+d2)) [1..] lder (tail lder)\n</code></pre>\n\n<p>as does this (which is a bit clumsy as it requires three functions):</p>\n\n<pre><code>nder :: Int -&gt; Integer\nnder n = nderTab !! n\n\nnderTab :: [Integer]\nnderTab = [nderCalc n | n &lt;- [0..]]\n\nnderCalc :: Int -&gt; Integer\nnderCalc n\n  | n == 0    = toInteger 1\n  | n == 1    = toInteger 0\n  | otherwise = toInteger (n-1) * (nder (n-1) + nder (n-2))\n</code></pre>\n\n<p>But this doesn't:</p>\n\n<pre><code>nders :: Int -&gt; Integer\nnders n = (map der [0 ..]) !! n\n  where der 0 = 1\n        der 1 = 0\n        der n = (nders (n-2) + nders (n-1)) * toInteger (n-1)\n</code></pre>\n\n<p>You'll recognize this last as a copy of the standard memoized Fibonacci number function.  My function works, but isn't memoized, as it hangs on values larger than about 30.  Also, if I write this function to operate only on values greater than or equal to 1:</p>\n\n<pre><code>nders :: Int -&gt; Integer\nnders n = (map der [1 ..]) !! n\n  where der 1 = 0\n        der 2 = 1\n        der n = (nders (n-2) + nders (n-1)) * toInteger (n-1)\n</code></pre>\n\n<p>it doesn't work at all. I'm curious to know what's wrong with these last two functions.</p>\n"}, {"tags": ["class", "haskell", "instance"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1452111172, "post_id": 34641364, "comment_id": 57029659, "body": "<code>Float</code> isn&#39;t really a <i>legitimate</i> instance of <code>Eq</code>. This doesn&#39;t relate to your present problem, but it&#39;s likely to cause you trouble down the road. If you switch to a better-behaved type like <code>Rational</code> (from <code>Data.Ratio</code>), you&#39;ll run into fewer gotchas in general (but won&#39;t be able to take square roots and such)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1452113087, "post_id": 34641364, "comment_id": 57030754, "body": "If you want to define &quot;standard&quot; instances, don&#39;t forget to try <code>deriving (Show, Eq)</code>. For custom ones, you do have to write your own code."}], "answers": [{"comments": [{"owner": {"reputation": 428, "user_id": 5328252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3a3f30bb9bddbfd2fbaf8b75c889f87?s=128&d=identicon&r=PG&f=1", "display_name": "jacosro", "link": "https://stackoverflow.com/users/5328252/jacosro"}, "edited": false, "score": 0, "creation_date": 1452110752, "post_id": 34641434, "comment_id": 57029372, "body": "I changed it exactly like you say and I get this error:       &#39; [1 of 1] Compiling Shape          ( Shape.hs, interpreted )  Shape.hs:19:5: parse error on input `instance&#39; Failed, modules loaded: none.&#39;"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "reply_to_user": {"reputation": 428, "user_id": 5328252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3a3f30bb9bddbfd2fbaf8b75c889f87?s=128&d=identicon&r=PG&f=1", "display_name": "jacosro", "link": "https://stackoverflow.com/users/5328252/jacosro"}, "edited": false, "score": 0, "creation_date": 1452110821, "post_id": 34641434, "comment_id": 57029420, "body": "Which line is line 19? What comes before it?  That suggests a missing parenthesis or other syntax error."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "reply_to_user": {"reputation": 428, "user_id": 5328252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3a3f30bb9bddbfd2fbaf8b75c889f87?s=128&d=identicon&r=PG&f=1", "display_name": "jacosro", "link": "https://stackoverflow.com/users/5328252/jacosro"}, "edited": false, "score": 0, "creation_date": 1452111339, "post_id": 34641434, "comment_id": 57029764, "body": "@xBlackout I don&#39;t have any problems with that code, I&#39;m not sure what&#39;s happening for you? <a href=\"https://ideone.com/Ydq6Oc\" rel=\"nofollow noreferrer\">ideone.com/Ydq6Oc</a>"}, {"owner": {"reputation": 428, "user_id": 5328252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3a3f30bb9bddbfd2fbaf8b75c889f87?s=128&d=identicon&r=PG&f=1", "display_name": "jacosro", "link": "https://stackoverflow.com/users/5328252/jacosro"}, "edited": false, "score": 0, "creation_date": 1452112755, "post_id": 34641434, "comment_id": 57030589, "body": "The problem was related with tabulation, not code errors. Thank you!"}], "tags": [], "owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "is_accepted": true, "score": 6, "last_activity_date": 1452109316, "creation_date": 1452109316, "answer_id": 34641434, "question_id": 34641364, "link": "https://stackoverflow.com/questions/34641364/instances-and-class-in-haskell/34641434#34641434", "title": "Instances and class in Haskell", "body": "<p>Split out the instances for each type and each typeclass it's an instance of.</p>\n\n<pre><code>instance Eq Rectangle where\n    (==) (Rectangle h w) (Rectangle c d) = (h == c) &amp;&amp; (w == d)\ninstance Show Rectangle where\n    show (Rectangle h w) = \"rectangle \"  ++ (show h) ++ \" \" ++ (show w)\ninstance Shape Rectangle where\n    area (Rectangle h w) = h * w\n    perimeter (Rectangle h w) = h*2 + w*2\n</code></pre>\n\n<p>It's just that the <code>show</code> and <code>==</code> definitions for each type aren't part of the <code>Shape</code> instance, they're part of typeclass instances for <code>Show</code> and <code>Eq</code> that happen to be dependencies of <code>Shape</code>.</p>\n"}], "owner": {"reputation": 428, "user_id": 5328252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f3a3f30bb9bddbfd2fbaf8b75c889f87?s=128&d=identicon&r=PG&f=1", "display_name": "jacosro", "link": "https://stackoverflow.com/users/5328252/jacosro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 0, "accepted_answer_id": 34641434, "answer_count": 1, "score": 2, "last_activity_date": 1452111217, "creation_date": 1452109060, "last_edit_date": 1452111217, "question_id": 34641364, "link": "https://stackoverflow.com/questions/34641364/instances-and-class-in-haskell", "title": "Instances and class in Haskell", "body": "<p>I have the following code in Haskell:</p>\n\n<pre><code>module Shape where\ntype Height = Float\ntype Width  = Float\ntype Radius = Float\ndata Rectangle  = Rectangle Height Width \ndata Circle = Circle Radius\n\nclass (Eq a, Show a) =&gt; Shape a where\n   area :: a -&gt; Float\n   perimeter :: a -&gt; Float\n\ninstance Shape Rectangle where\n    area (Rectangle h w) = h * w\n    perimeter (Rectangle h w) = h*2 + w*2\n    show (Rectangle h w) = \"rectangle \"  ++ (show h) ++ \" \" ++ (show w)\n    (==) (Rectangle h w) (Rectangle c d) = (h == c) &amp;&amp; (w == d)\n\n\ninstance Shape Circle where\n   area (Circle r) = pi * r**2\n   perimeter (Circle r) = 2 * pi * r\n   show (Circle r) = \"circle \" ++ (show r)\n   (==) (Circle r) (Circle x) = r == x\n</code></pre>\n\n<p>and I want to add the instances of Show and Eq in order to define the new cases (e.g Rectangle * * == Rectangle * *) but I get the following problem:</p>\n\n<pre><code>[1 of 1] Compiling Shape           ( Shape.hs, interpreted )\nShape.hs:24:17: `show' is not a (visible) method of class `Shape'\nShape.hs:25:17: `==' is not a (visible) method of class `Shape'\nShape.hs:31:12: `show' is not a (visible) method of class `Shape'\nShape.hs:32:12: `==' is not a (visible) method of class `Shape'\nFailed, modules loaded: none.\n</code></pre>\n\n<p>What that it means? And how can I make it work?</p>\n\n<hr>\n\n<p>EDIT: \nThe code now:\n(line 13 to 31)</p>\n\n<pre><code>instance Eq Rectangle where\n    (Rectangle h w) == (Rectangle c d) = (h == c) &amp;&amp; (w == d)\n\ninstance Show Rectangle where\n    show (Rectangle h w) = \"rectangle \"  ++ (show h) ++ \" \" ++ (show w)\n\ninstance Shape Rectangle where\n    area (Rectangle h w) = h * w\n    perimeter (Rectangle h w) = h*2 + w*2\n\ninstance Eq Circle where\n    (Circle r) == (Circle x) = r == x\n\ninstance Show Circle where\n    show (Circle r) = \"circle \" ++ (show r)\n\ninstance Shape Circle where\n   area (Circle r) = pi * r**2\n   perimeter (Circle r) = 2 * pi * r\n</code></pre>\n\n<p>The error: </p>\n\n<pre><code>[1 of 1] Compiling Shape           ( Shape.hs, interpreted )\nShape.hs:19:5: parse error on input `instance'\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["haskell", "types", "monads"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1452108965, "post_id": 34641279, "comment_id": 57028225, "body": "You cannot define a class (<code>Monad</code> or something else) twice..."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 2, "creation_date": 1452109448, "post_id": 34641279, "comment_id": 57028528, "body": "Since that paper, <code>Monad</code> gained an <code>Applicative</code> dependency.  You should be able to implement it just with <code>ap</code> and <code>return</code>, though."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 1, "creation_date": 1452110754, "post_id": 34641279, "comment_id": 57029374, "body": "To be really, really explicit about it, the problem you&#39;re experiencing is that this code worked in older versions of Haskell, but not anymore in very recent versions of GHC. Recent versions don&#39;t allow you to define a <code>Monad</code> instance unless the type in question also has <code>Functor</code> and <code>Applicative</code> instances as well."}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 9, "last_activity_date": 1452110148, "last_edit_date": 1452110148, "creation_date": 1452109590, "answer_id": 34641501, "question_id": 34641279, "link": "https://stackoverflow.com/questions/34641279/getting-a-no-instance-of-applicative-error-when-declaring-a-monad/34641501#34641501", "title": "Getting a &quot;No instance of Applicative&quot; error when declaring a Monad", "body": "<p>To expand on Louis Wasserman's comment, you need to add an <code>Applicative</code> (and therefore <code>Functor</code>) instance now when you are declaring a <code>Monad</code> instance.  Once you have written the <code>Monad</code> instance, the other instances are always the same:</p>\n\n<pre><code>import Control.Monad (liftM, ap)\n\ninstance Functor Tree where\n    fmap = liftM\ninstance Applicative Tree where \n    pure = return\n    (&lt;*&gt;) = ap\n</code></pre>\n\n<p>This changed because every <code>Monad</code> is an <code>Applicative</code> (using this instance), but not the other way around, so it's morally a superclass. However, <code>Applicative</code> was added to the standard library after <code>Monad</code> so it wasn't made a real superclass for a long time since that would break people's code.  Recently, since <code>Applicative</code> has come into very common use, the community decided to make <code>Applicative</code> a real superclass of <code>Monad</code>, breaking everybody's code once but improving it for the future.  So that's what you're seeing.</p>\n"}, {"comments": [{"owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 0, "creation_date": 1452110944, "post_id": 34641557, "comment_id": 57029496, "body": "Do all monad instances require this same kind of hierarchical definition?  (Functor, Applicative, Monad)?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 2, "creation_date": 1452111106, "post_id": 34641557, "comment_id": 57029599, "body": "@MarkKaravan: you need to define all three of them if you use the latest version of <code>base</code> (most of the stuff in <code>Prelude</code>). But - as in most programming languages - you can of course write them in any order you like in your file."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "edited": false, "score": 3, "creation_date": 1452142008, "post_id": 34641557, "comment_id": 57040604, "body": "@MarkKaravan, fortunately, most people find <code>Monad</code> instance declarations to be a very small portion of their code."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1452244894, "post_id": 34641557, "comment_id": 57091896, "body": "@WillemVanOnsem Not only that, but you can also define them &quot;backwards&quot;, so first implement <code>Monad</code> and implement functor and applicative based on the monad operators (this isn&#39;t always good, but it can save a bit of time)."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1452245171, "post_id": 34641557, "comment_id": 57092052, "body": "@Cubic: well you can indeed for instance use a cyclic definition like luqui shows). But you have to define all the instances <code>Functor</code>, <code>Applicative</code> and <code>Monad</code>. My point was to show how one could implement these instances. Introducing all kinds of library functions is indeed how one can do it, but you do not see what&#39;s behind these functions."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1452109799, "creation_date": 1452109799, "answer_id": 34641557, "question_id": 34641279, "link": "https://stackoverflow.com/questions/34641279/getting-a-no-instance-of-applicative-error-when-declaring-a-monad/34641557#34641557", "title": "Getting a &quot;No instance of Applicative&quot; error when declaring a Monad", "body": "<p>The problem is that, like the <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#t:Monad\">documentation</a> specifies. The <code>Monad</code> class signature is:</p>\n\n<pre><code>class Applicative m =&gt; Monad m where\n    --...\n</code></pre>\n\n<p>This means that in order to define the instance of a type to be <code>Monad</code>, you first need to define that type to be <code>Applicative</code>. The problem is even more severe since the <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#t:Applicative\">signature of <code>Applicative</code></a> states:</p>\n\n<pre><code>class Functor f =&gt; Applicative f where\n    --...\n</code></pre>\n\n<p>So you first need to make <code>Tree</code> an instance of <code>Functor</code>. The reason that in the paper, this wasn't necessary, is because - as far as I know, in the early versions of <code>Prelude</code> these constraints were not necessary.</p>\n\n<p>Now in order to let it work, we first make <code>Tree</code> an instance of <code>Functor</code>. We therefore need to define a function <code>fmap</code>, which - for a given function <code>f :: a -&gt; b</code>, maps a <code>Tree a</code> to a <code>Tree b</code>:</p>\n\n<pre><code>instance Functor Tree where\n   fmap f (Leaf a) = Leaf $ f a\n   fmap f (Fork u v) = Fork (fmap f u) (fmap f v)\n   fmap _ Nil = Nil\n</code></pre>\n\n<p>Now that we have defined this, we can define <code>Applicative</code>:</p>\n\n<pre><code>instance Applicative Tree where\n    pure = Leaf\n    (&lt;*&gt;) (Leaf f) = fmap f\n    (&lt;*&gt;) Nil = const $ Nil\n</code></pre>\n\n<p>and finally we can define the <code>Monad</code> instance:</p>\n\n<pre><code>instance Monad Tree where\n   return a = Leaf a\n   Nil &gt;&gt;= f = Nil\n   Leaf a &gt;&gt;= f = f a\n   Fork u v &gt;&gt;= f = Fork (u &gt;&gt;= f) (v &gt;&gt;= f)\n</code></pre>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1703, "favorite_count": 1, "accepted_answer_id": 34641557, "answer_count": 2, "score": 3, "last_activity_date": 1452140784, "creation_date": 1452108789, "last_edit_date": 1452140784, "question_id": 34641279, "link": "https://stackoverflow.com/questions/34641279/getting-a-no-instance-of-applicative-error-when-declaring-a-monad", "title": "Getting a &quot;No instance of Applicative&quot; error when declaring a Monad", "body": "<p>I'm trying to implement the example from the first chapter of <a href=\"https://dl.dropboxusercontent.com/u/828035/Monads/monads.pdf\" rel=\"nofollow\">this paper</a>, which goes like this:</p>\n\n<pre><code>data Tree a = Fork (Tree a) (Tree a) | Leaf a | Nil deriving (Show)\n\ninstance Monad Tree where\n   return a = Leaf a\n   Nil &gt;&gt;= f = Nil\n   Leaf a &gt;&gt;= f = f a\n   Fork u v &gt;&gt;= f = Fork (u &gt;&gt;= f) (v &gt;&gt;= f)\n\ntree1 = Fork \n         (Fork (Leaf 2) Nil) \n         (Fork (Leaf 2) (Leaf 3))\n\ntree2 = Fork (Leaf 2) (Leaf 3)\n\nf 2 = Fork Nil (Leaf \"Two\")\nf 3 = Fork (Leaf \"Three\") (Leaf \"String\")\n\ntree3 = tree2 &gt;&gt;= f\n</code></pre>\n\n<p>When I run it in GHC, I get this error:</p>\n\n<pre><code>monads.hs:3:10:\n    No instance for (Applicative Tree)\n      arising from the superclasses of an instance declaration\n    In the instance declaration for \u2018Monad Tree\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I've tried adding this to the beginning</p>\n\n<pre><code>class Monad m where\n    return :: a -&gt; m a\n    (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>but I get this error:</p>\n\n<pre><code>monads.hs:7:10:\n    Ambiguous occurrence \u2018Monad\u2019\n    It could refer to either \u2018Main.Monad\u2019, defined at monads.hs:1:1\n                          or \u2018Prelude.Monad\u2019,\n                             imported from \u2018Prelude\u2019 at monads.hs:1:1\n                             (and originally defined in \u2018GHC.Base\u2019)\n</code></pre>\n\n<p>What is the most correct fix?</p>\n"}, {"tags": ["haskell", "haskell-stack", "hoogle"], "comments": [{"owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "edited": false, "score": 1, "creation_date": 1452107235, "post_id": 34637832, "comment_id": 57027097, "body": "Keeping an eye on this <a href=\"https://github.com/commercialhaskell/stack/issues/55\" rel=\"nofollow noreferrer\">this github issue</a>, might be useful. From that I&#39;d say the answer today is probably &quot;not yet&quot;."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 1, "creation_date": 1503478695, "post_id": 34637832, "comment_id": 78627275, "body": "<code>stack hoogle generate -- --local</code> worked for me..."}], "answers": [{"comments": [{"owner": {"reputation": 806, "user_id": 1527537, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5cac7130ae6a4029c6fc00eadc5868e6?s=128&d=identicon&r=PG", "display_name": "Joe Shanahan", "link": "https://stackoverflow.com/users/1527537/joe-shanahan"}, "edited": false, "score": 1, "creation_date": 1476104159, "post_id": 34657809, "comment_id": 67197114, "body": "This did not work for me. I get a big long list of <code>Packages not found: aeson ...</code>"}, {"owner": {"reputation": 806, "user_id": 1527537, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5cac7130ae6a4029c6fc00eadc5868e6?s=128&d=identicon&r=PG", "display_name": "Joe Shanahan", "link": "https://stackoverflow.com/users/1527537/joe-shanahan"}, "edited": false, "score": 0, "creation_date": 1476104500, "post_id": 34657809, "comment_id": 67197363, "body": "^ when trying to use <code>hoogle generate</code>"}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1503505024, "post_id": 34657809, "comment_id": 78647564, "body": "With stack 1.5.1, hoogle 5.0.13, after rather lengthy haddock phase in a project I got <code>Packages missing documentation: adjunctions aeson ...</code> and most packages are not indexed. I would prefer answer that explains what is needed, as tooling is not reliable and needs to be manually corrected."}, {"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1505816241, "post_id": 34657809, "comment_id": 79557748, "body": "I had to <code>$ find .&#47;src&#47; -name &#39;*.hs&#39; -print0 | xargs -r0 stack exec haddock --  --hoogle --package-name MyPackage --package-version 0.1.1.1</code> to get hoogle docs for the library itself. Simply running <code>stack exec -- hoogle generate --local</code> just made it for the dependencies."}, {"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1505817376, "post_id": 34657809, "comment_id": 79558505, "body": "That is, <code>find .&#47;src&#47; -name &#39;*.hs&#39; -print0 | xargs -r0 stack exec haddock -- --hoogle --package-name MyPackage --package-version 0.1.1.1 &amp;&amp; stack exec hoogle -- generate --local &amp;&amp; stack exec hoogle -- myQuery</code> instead of <code>stack haddock &amp;&amp; stack exec -- hoogle generate --local &amp;&amp; stack exec -- hoogle myQuery</code>"}], "tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": false, "score": 6, "last_activity_date": 1452177419, "creation_date": 1452177419, "answer_id": 34657809, "question_id": 34637832, "link": "https://stackoverflow.com/questions/34637832/manage-hoogle-index-using-stack-tool/34657809#34657809", "title": "Manage hoogle index using stack tool", "body": "<p>For the Hoogle part I recommend using the latest git version, which will become version 5. To install that, do:</p>\n\n<pre><code>git clone https://github.com/ndmitchell/hoogle.git\ncd hoogle\nstack init\nstack install\n</code></pre>\n\n<p>Then generate it and use it with:</p>\n\n<pre><code># generate Haddock docs for all your packages\nstack haddock\n# generate the Hoogle index\nstack exec -- hoogle generate --local --database=.stack-work/hoogle\n# perform a search for map\nstack exec -- hoogle map --database=.stack-work/hoogle\n# start a server at http://127.0.0.1/ to browse docs\nstack exec -- hoogle server --local --database=.stack-work/hoogle\n</code></pre>\n\n<p>To make this work with Cabal instead of Stack, do <code>cabal install</code> initially, set your <code>haddock</code>/<code>hoogle</code> preference in your Cabal config file to <code>True</code>, and remove the <code>stack exec</code> bits.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1061, "favorite_count": 3, "answer_count": 1, "score": 7, "last_activity_date": 1452177419, "creation_date": 1452097425, "question_id": 34637832, "link": "https://stackoverflow.com/questions/34637832/manage-hoogle-index-using-stack-tool", "title": "Manage hoogle index using stack tool", "body": "<p>Context: Before <code>stack</code> I stopped using <code>hoogle</code> locally because my index would somehow lose sync with installed packages. If I recall correctly, I had issues with different results in <code>ghci</code>, command line and <code>cabal</code> sandboxes. </p>\n\n<p>Can I leverage <code>stack</code> environment manage my local <code>hoogle</code> databases?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 24126, "user_id": 368864, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/76e6f95b06ade13607a4dd999f7f72e5?s=128&d=identicon&r=PG", "display_name": "cambraca", "link": "https://stackoverflow.com/users/368864/cambraca"}, "edited": false, "score": 0, "creation_date": 1452099458, "post_id": 34637976, "comment_id": 57022201, "body": "I&#39;m getting a compile error on <code>run</code>: &quot;Non type-variable argument in the constraint: MonadRandom ((,) t) (Use FlexibleContexts to permit this) When checking that &#39;run&#39; has the inferred type&quot;. Any idea why? (I tested doing <code>type MyType = Int</code>, <code>check p = p == 0</code>, and a simple function for <code>newP</code> that just substracts 1 from <code>p</code>)"}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "reply_to_user": {"reputation": 24126, "user_id": 368864, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/76e6f95b06ade13607a4dd999f7f72e5?s=128&d=identicon&r=PG", "display_name": "cambraca", "link": "https://stackoverflow.com/users/368864/cambraca"}, "edited": false, "score": 0, "creation_date": 1452100307, "post_id": 34637976, "comment_id": 57022822, "body": "@cambraca - Sorry, you can use <code>fmap</code> instead of <code>&gt;&gt;=</code>, see update."}, {"owner": {"reputation": 24126, "user_id": 368864, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/76e6f95b06ade13607a4dd999f7f72e5?s=128&d=identicon&r=PG", "display_name": "cambraca", "link": "https://stackoverflow.com/users/368864/cambraca"}, "edited": false, "score": 0, "creation_date": 1452100357, "post_id": 34637976, "comment_id": 57022861, "body": "That worked perfectly, thanks! I&#39;ll look up both of those, I haven&#39;t used them yet (just starting with Haskell..)"}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 4, "last_activity_date": 1452100094, "last_edit_date": 1452100094, "creation_date": 1452097879, "answer_id": 34637976, "question_id": 34637777, "link": "https://stackoverflow.com/questions/34637777/iterating-until-with-monads/34637976#34637976", "title": "&quot;Iterating until&quot; with monads", "body": "<p>It looks like you want to use <code>iterateUntilM</code> which has type <code>(a -&gt; Bool) -&gt; (a -&gt; m a) -&gt; a -&gt; m a</code>, where the state type <code>a</code> is <code>(Int, MyType)</code>. Then <code>run</code> should look like:</p>\n\n<pre><code>let run (i, p) = fmap (\\p' -&gt; (i + 1, p')) (newP p)\n</code></pre>\n\n<p>then you can do</p>\n\n<pre><code>(_, p') &lt;- iterateUntilM stopCondition run (0, p)\n</code></pre>\n"}], "owner": {"reputation": 24126, "user_id": 368864, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/76e6f95b06ade13607a4dd999f7f72e5?s=128&d=identicon&r=PG", "display_name": "cambraca", "link": "https://stackoverflow.com/users/368864/cambraca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 34637976, "answer_count": 1, "score": 1, "last_activity_date": 1452100094, "creation_date": 1452097224, "question_id": 34637777, "link": "https://stackoverflow.com/questions/34637777/iterating-until-with-monads", "title": "&quot;Iterating until&quot; with monads", "body": "<p>I have something like this, which is working:</p>\n\n<pre><code>main = do\n  let p = something :: MyType\n  p' &lt;- newP p\n  p'' &lt;- newP p'\n  p''' &lt;- newP p''\n  print p'''\n</code></pre>\n\n<p>See the pattern? I want to repeat this until a certain condition is met, or until a maximum number of iterations passed.</p>\n\n<p>I found <code>Control.Monad.Loops.iterateUntil</code>, but I can't get it to work. Here's the code I have (<code>check</code> looks something like this <code>check :: MyType -&gt; Bool</code>):</p>\n\n<pre><code>main = do\n  let p = something :: MyType\n  let stopCondition (i, p) = i == 100 || check p\n  let run (i, p) = (i + 1, newP p)\n  p' &lt;- iterateUntil stopCondition (run (0, p))\n  print p'\n</code></pre>\n\n<p>It doesn't even compile.</p>\n\n<p>Note that it's important that each time this thing runs, the result of <code>run</code> is fed to the next iteration (I'm not sure <code>iterateUntil</code> will do that).</p>\n"}, {"tags": ["haskell", "types", "gadt"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1452097199, "post_id": 34637593, "comment_id": 57020697, "body": "It&#39;s kinda the point of hiding type information that you <i>can&#39;t</i> do this, isn&#39;t it?"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1452097484, "post_id": 34637593, "comment_id": 57020891, "body": "absolutely. but not forgetting = forgetting + having a proof of type equality. and that&#39;s what I would like to do to not carry all those parameters around. as a client, other should never be allowed to see what type it is. but I write it also as an implementor, hence I want to keep the proof"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1452097693, "post_id": 34637593, "comment_id": 57021054, "body": "Could you give an example of a full scenario in which you intend to do this?"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1452098637, "post_id": 34637593, "comment_id": 57021661, "body": "I have a bunch of code using a type. I want to add a type variable which does not concern other libraries. I am the only one who instatiate this type so I know it is safe. When I explicitly forget about that type variable so that other code does not have to be polluted with my type which they should treat abstractly, I would like to have a proof of what I forgot that I can still use that extra type variable which I have just added."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1452098836, "post_id": 34637593, "comment_id": 57021784, "body": "I agree its totally wrong though... was just wondering if there was a way to cheat ..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 6, "creation_date": 1452100764, "post_id": 34637593, "comment_id": 57023157, "body": "If you just keep the type variable visible \u2013 but universally-quantified \u2013 then everybody else has to treat it abstractly too, but it&#39;s still there for when you want to access it and apply whatever constraints you have floating around. \u2014 If you actually have a global proof that <i>all <code>key</code>s have the same type</i>, then you should not make it a variable at all. If you have only two or three such types (and don&#39;t plan to allow many more), you shouldn&#39;t use a type variable either, but a variant type which has discrete options for the different instantiations."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1452118129, "post_id": 34637593, "comment_id": 57033413, "body": "@leftaroundabout: your comment makes for a very appropriate answer."}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1461501490, "post_id": 34637593, "comment_id": 61217742, "body": "Figured I wanted to have &lt;&gt; part of the system know that some existentials were the same. &quot;In general, we need to open an existential datatype with a scope that covers all terms that need to share a particular implementation type. This enforces an strict block structure on the program, and prevents us from defining these terms in separate compilation units for example. This is one of the most important reasons that existential types are generally dismissed as the basis for abstract types in module systems&quot; <a href=\"http://research.microsoft.com/en-us/um/people/daan/download/papers/existentials.pdf\" rel=\"nofollow noreferrer\">research.microsoft.com/en-us/um/people/daan/download/papers/&zwnj;&#8203;&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "is_accepted": true, "score": 1, "last_activity_date": 1461501186, "creation_date": 1461501186, "answer_id": 36823151, "question_id": 34637593, "link": "https://stackoverflow.com/questions/34637593/gadt-and-proof-of-equality/36823151#36823151", "title": "GADT and proof of equality", "body": "<p>\u2013 leftaroundabout Jan 6 at 17:19 </p>\n\n<p>If you just keep the type variable visible \u2013 but universally-quantified \u2013 then everybody else has to treat it abstractly too, but it's still there for when you want to access it and apply whatever constraints you have floating around. \u2014 If you actually have a global proof that all keys have the same type, then you should not make it a variable at all. If you have only two or three such types (and don't plan to allow many more), you shouldn't use a type variable either, but a variant type which has discrete options for the different instantiations. </p>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 1, "accepted_answer_id": 36823151, "answer_count": 1, "score": 1, "last_activity_date": 1461501186, "creation_date": 1452096575, "question_id": 34637593, "link": "https://stackoverflow.com/questions/34637593/gadt-and-proof-of-equality", "title": "GADT and proof of equality", "body": "<p>I want to hide some type information in a GADT, here forgetting about the <code>key</code> type</p>\n\n<pre><code>data Query  where\n   Query :: Ord key =&gt;  Map.Map key String  -&gt; Query\n\n one ::  Ord key =&gt; key -&gt; Query\n one  k =\n   let m = Map.insert k \"hello\" Map.empty\n   in Query m\n</code></pre>\n\n<p>How can I pass on some equality constraint to use it elsewhere as in :</p>\n\n<pre><code>other :: Ord key =&gt; key -&gt; Query -&gt; Maybe String\nother k (Query ad) =  Map.lookup k ad\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "is_accepted": false, "score": 1, "last_activity_date": 1452093914, "last_edit_date": 1452093914, "creation_date": 1452093594, "answer_id": 34636616, "question_id": 34636369, "link": "https://stackoverflow.com/questions/34636369/cant-input-values-into-function-because-type-cannot-be-deduced/34636616#34636616", "title": "Can&#39;t input values into function, because type cannot be deduced", "body": "<p>That's because <code>ceiling</code> returns an <code>Integral</code>, and you're recursively calling <code>fun</code> with that value, so it deduces that <code>fun</code> must accept <code>Integral</code> values, but <code>ceiling</code> takes <code>RealFrac</code> values, and you're passing to <code>ceiling</code> the argument you got from the application of <code>fun</code>, so it deduces that <code>fun</code> must also take <code>RealFrac</code> values. Hence the constraints. </p>\n\n<p>In situations like this, it's best to limit the options Haskell considers during type inference by annotation your function with the type you think it should have \u2014 the error message will become more concrete/narrowed down then and will be more localized to the code under question; otherwise, type inference will analyze your entire program and consider too many options.</p>\n\n<p>(also the function itself is ill-defined as the other answer points out, but that is not causing the type error, obviously)</p>\n"}, {"comments": [{"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "edited": false, "score": 0, "creation_date": 1452096488, "post_id": 34636619, "comment_id": 57020211, "body": "well, the function is defined the way it was in the math problem, so if it never hits 1, that&#39;s why"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 3, "last_activity_date": 1452093605, "creation_date": 1452093605, "answer_id": 34636619, "question_id": 34636369, "link": "https://stackoverflow.com/questions/34636369/cant-input-values-into-function-because-type-cannot-be-deduced/34636619#34636619", "title": "Can&#39;t input values into function, because type cannot be deduced", "body": "<p>Look at the inferred type signature, you have <code>Integral a1</code> and <code>RealFrac a1</code> as constraints, and the function overall just returns a <code>Num a</code>.  What you're saying is that this function takes a type that is both an <code>Integral</code> and <code>RealFrac</code>, already a contradiction logically but technically possible to implement in Haskell, and returns any numeric type whatsoever.  This comes from your use of <code>ceiling</code>, which has the type <code>(Integral b, RealFrac a) =&gt; a -&gt; b</code>, which you then pass to <code>fun</code> again.  So <code>n</code> must be an <code>Integral</code>, but since you pass the result of <code>ceiling n</code> to <code>fun</code> it must also be a <code>RealFrac</code>.  The second problem is that you simply haven't given the compiler enough information to know exactly which types you're wanting to use.</p>\n\n<p>My first suggestion is to give <code>fun</code> the type signature you think it should have, which I'm guessing is probably <code>Double -&gt; Int</code>.  If you do this you'll get a type error of <code>No instance for (Integral Double) arising from use of ceiling ...</code>, meaning that you're trying to use a <code>Double</code> as an <code>Integral</code> when <code>Double</code> doesn't implement <code>Integral</code> for obvious reasons.  This tells you precisely which part of your definition is suspect.  You can choose to cast the result of <code>ceiling</code> to <code>Double</code> using <code>fromIntegral</code> or <code>fromInteger</code>.</p>\n\n<p>Beyond all this, this function will never terminate unless it's called with the value <code>1</code>.  It will essentially just build up a giant thunk of adding <code>3</code> over and over again and will just eat up RAM and CPU.</p>\n"}], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 34636619, "answer_count": 2, "score": 0, "last_activity_date": 1452093914, "creation_date": 1452092918, "question_id": 34636369, "link": "https://stackoverflow.com/questions/34636369/cant-input-values-into-function-because-type-cannot-be-deduced", "title": "Can&#39;t input values into function, because type cannot be deduced", "body": "<p>I wanted to write a simple recursive function to help me check some values of a maths problem, however I can't seem to add any valid inputs.</p>\n\n<p>Here's the function in question</p>\n\n<pre><code>fun 1 = 1\nfun n = fun (ceiling n) + 3\n</code></pre>\n\n<p>It appears to be of type <code>(Integral a1, Num a, RealFrac a1) =&gt; a1 -&gt; a</code></p>\n\n<p>Giving <code>fun</code> any number as input yields the following error:</p>\n\n<pre><code>Could not deduce (Integral a10) arising from a use of \u2018fun\u2019\n    from the context (Num a)\n      bound by the inferred type of it :: Num a =&gt; \n</code></pre>\n"}, {"tags": ["debugging", "haskell", "random", "monads", "trace"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1452091436, "post_id": 34635495, "comment_id": 57016641, "body": "The functions from <code>Debug.Trace</code> generally don&#39;t offer really <i>reliable output</i>. They&#39;re just meant as a quick way of seeing \u201cwhat the heck is going one there\u201d. But what is shown and in which order depends a lot on the evaluation order of your expressions, and since this is Haskell the compiler has <i>a lot</i> of freedoms in reordering that etc.: because of referential transparency, it knows some transformations can&#39;t make any difference at all. But <code>trace</code> is not referentially transparent. \u2014 If you want any sort of reliable logging, you should insert a <code>WriterT</code> in your monad stack."}, {"owner": {"reputation": 21, "user_id": 5221534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd2fc725bc1aade11ef67617b6d5d88d?s=128&d=identicon&r=PG&f=1", "display_name": "STH", "link": "https://stackoverflow.com/users/5221534/sth"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1452216509, "post_id": 34635495, "comment_id": 57081955, "body": "@leftaroundabout: Thanks. That helps answer why the debugging and tracing for the last iteration does not show up. However, I am still uncertain about why replacing <code>if battleOver bfield then return bfield</code> with <code>if battleOver bfield then randBfield</code> yields an incorrect result. The result  that was returned, <code>[attackers = 3, defenders = 7]</code>, should not have ended the recursion."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1452239898, "post_id": 34635495, "comment_id": 57089272, "body": "Ah. Well that of course <i>should</i> be different. You&#39;re generating two different randomised values. It&#39;s the whole point of randomness that two subsequent calls to a random action will not give the same result, but merely different samples from a single well-defined random distribution."}, {"owner": {"reputation": 21, "user_id": 5221534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd2fc725bc1aade11ef67617b6d5d88d?s=128&d=identicon&r=PG&f=1", "display_name": "STH", "link": "https://stackoverflow.com/users/5221534/sth"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1452608465, "post_id": 34635495, "comment_id": 57237760, "body": "@leftaround. Got it. Thanks. thomie explained it very well below. Thanks to both of you"}], "answers": [{"tags": [], "owner": {"reputation": 1375, "user_id": 420038, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14e486867defc84340f1837639ca54ee?s=128&d=identicon&r=PG", "display_name": "thomie", "link": "https://stackoverflow.com/users/420038/thomie"}, "is_accepted": false, "score": 1, "last_activity_date": 1452352822, "creation_date": 1452352822, "answer_id": 34695249, "question_id": 34635495, "link": "https://stackoverflow.com/questions/34635495/tracing-and-debugging-in-rand-stdgen-monad-in-haskell/34695249#34695249", "title": "Tracing and Debugging in Rand StdGen Monad in Haskell", "body": "<h2>Question 1</h2>\n\n<blockquote>\n  <p>What I don't understand is why the last round of tracing does not get printed. </p>\n</blockquote>\n\n<p>You can't \"trust\" <code>traceM</code>. This is the implementation:</p>\n\n<pre><code>traceM :: (Monad m) =&gt; String -&gt; m ()\ntraceM string = trace string $ return ()\n</code></pre>\n\n<p>As the documentation  says:</p>\n\n<blockquote>\n  <p>Note that the application of <code>trace</code> is not an action in the monad, as <code>traceIO</code> is in the IO monad.</p>\n</blockquote>\n\n<p>Here is another confusing <a href=\"https://mail.haskell.org/pipermail/libraries/2013-January/019322.html\" rel=\"nofollow\">example</a> with <code>traceM</code>:</p>\n\n<pre><code>import Debug.Trace\n\nf n action = if n &gt; 0\n                 then action &gt;&gt; f (n - 1) action\n                 else return ()\n\nmain = f 4 $ do \n         traceM \"traceM\"\n         traceIO \"traceIO\"\n</code></pre>\n\n<p>Result when compiled with <code>-O0</code>:</p>\n\n<pre><code>traceM\ntraceIO\ntraceIO\ntraceIO\ntraceIO\n</code></pre>\n\n<p>Result when compiled with <code>-O</code>:</p>\n\n<pre><code>traceM\ntraceIO\ntraceM\ntraceIO\ntraceM\ntraceIO\ntraceM\ntraceIO\n</code></pre>\n\n<p>That said, I don't exactly know why your code runs all <code>traceM</code> statements, except the last one. You would have to investigate the strictness properties of the <code>Rand StdGen</code> monad. See for example this <a href=\"https://mail.haskell.org/pipermail/libraries/2013-January/019319.html\" rel=\"nofollow\">email</a>, where it is shown that <code>runIdentity $ traceM \"test\" &gt;&gt;\nreturn ()</code> doesn't print anything at all, because the <code>Identity</code> monad is not strict in the first argument of <code>&gt;&gt;=</code>. Since you call <code>evalRandIO</code>, which calls <code>evalRand</code>, which calls <code>runIdentity</code>, this might have something to do with your problem as well.</p>\n\n<p>(someone please update the answer)</p>\n\n<h2>Question 2</h2>\n\n<blockquote>\n  <p>Why do I have to wrap the pure value <code>bfield</code> instead of returning the original monadic value <code>randBfield</code>?</p>\n</blockquote>\n\n<p>Maybe if you changed the signature of <code>battleUntilOver</code> to take a <code>Battlefield</code>, it becomes more clear:</p>\n\n<pre><code>invade :: Battlefield -&gt; Rand StdGen Battlefield\ninvade bfield = do\n  if battleOver bfield then return bfield\n    else battleUntilOver bfield\n\nbattleUntilOver :: Battlefield -&gt; Rand StdGen Battlefield\nbattleUntilOver bfield = do\n  bfield' &lt;- battle bfield\n  traceM $ \"bfield::\" ++ show bfield' ++ \"::\"\n  if battleOver bfield' then return bfield'\n    else battleUntilOver bfield'\n</code></pre>\n\n<p>Do you agree this does the same thing as your original program?</p>\n\n<p>Now, you wonder why doing the following didn't give you the same result: </p>\n\n<pre><code>battleUntilOver :: Battlefield -&gt; Rand StdGen Battlefield\nbattleUntilOver bfield = do\n  bfield' &lt;- battle bfield\n  traceM $ \"bfield::\" ++ show bfield' ++ \"::\"\n  if battleOver bfield' then battle bfield   -- Here is the change\n    else battleUntilOver bfield'\n</code></pre>\n\n<p>When the battle is supposedly over, you are asking for a rematch of the last battle (using the pen-ultimate battlefield)! This final final battle will use different random values, as @leftroundabout said, so it should give you a different result every now and then. Other times, the result will be the same, all depending on the initial seed of the random number generator.</p>\n"}], "owner": {"reputation": 21, "user_id": 5221534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd2fc725bc1aade11ef67617b6d5d88d?s=128&d=identicon&r=PG&f=1", "display_name": "STH", "link": "https://stackoverflow.com/users/5221534/sth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1452352822, "creation_date": 1452090397, "last_edit_date": 1452090738, "question_id": 34635495, "link": "https://stackoverflow.com/questions/34635495/tracing-and-debugging-in-rand-stdgen-monad-in-haskell", "title": "Tracing and Debugging in Rand StdGen Monad in Haskell", "body": "<p>As something of a Haskell newbie, I've been going through the UPenn Haskell course and working through the homework problems. In order to facilitate debugging, I turn on Tracing with:</p>\n\n<pre><code>import Debug.Trace\n</code></pre>\n\n<p>The problem that I have is that I don't quite understand the behavior of one of my programs when tracing is enabled.</p>\n\n<p>In particular, I have been working on the last homework assignment of the Haskell course, in which students are asked to simulate the game of Risk (a popular boardgame in the US) in which 2 players roll dice to play the game.</p>\n\n<p><a href=\"http://www.seas.upenn.edu/~cis194/fall14/spring13/hw/12-monads.pdf\" rel=\"nofollow\">http://www.seas.upenn.edu/~cis194/fall14/spring13/hw/12-monads.pdf</a></p>\n\n<p>In Exercise 2, the assignment calls for writing a function <code>battle</code> which takes a <code>Battlefield</code> data type and returns a monadic <code>Battlefield</code></p>\n\n<pre><code>           battle :: Battlefield -&gt; Rand StdGen Battlefield\n</code></pre>\n\n<p>to simulate the result of a single battle in which the attacking player and the defending player roll dice to determine the outcome of the battle.</p>\n\n<p>Then in Exercise 3, we simulate a full invasion, in which round after round of battles are waged until one of the players' armies is too depleted to continue.</p>\n\n<pre><code>           invade :: Battlefield -&gt; Rand StdGen Battlefield\n</code></pre>\n\n<p>I wrote up the following:</p>\n\n<pre><code>invade :: Battlefield -&gt; Rand StdGen Battlefield\ninvade bfield = do\n  if battleOver bfield then return bfield\n    else battleUntilOver $ battle bfield\n\nbattleOver :: Battlefield -&gt; Bool\nbattleOver bfield\n  | attackers bfield &lt; 2        = True\n  | defenders bfield == 0       = True\n  | otherwise                   = False\n\nbattleUntilOver :: Rand StdGen Battlefield -&gt; Rand StdGen Battlefield\nbattleUntilOver randBfield = do\n  bfield &lt;- randBfield\n  traceM $ \"bfield::\" ++ show bfield ++ \"::\"\n  if battleOver bfield then return bfield\n    else battleUntilOver $ battle bfield\n</code></pre>\n\n<p>Here is the output:</p>\n\n<pre><code>*Risk&gt; evalRandIO $ invade Battlefield {attackers=10,defenders=10}\nbfield::Battlefield {attackers = 10, defenders = 8}::\nbfield::Battlefield {attackers = 8, defenders = 8}::\nbfield::Battlefield {attackers = 6, defenders = 8}::\nbfield::Battlefield {attackers = 4, defenders = 8}::\nbfield::Battlefield {attackers = 4, defenders = 6}::\nbfield::Battlefield {attackers = 2, defenders = 6}::\nbfield::Battlefield {attackers = 2, defenders = 5}::\nBattlefield {attackers = 1, defenders = 5}\n</code></pre>\n\n<p>What I don't understand is why the last round of tracing does not get printed. The function <code>battleUntilOver</code> is called recursively until the the result of the <code>battleOver</code> function ends the recursion. Thus I would expect the <code>traceM</code> function to print out</p>\n\n<pre><code>bfield::Battlefield {attackers = 1, defenders = 5}::\n</code></pre>\n\n<p>before the <code>battleOver</code> function returns True and the game ends. I don't understand why it doesn't.</p>\n\n<p>Also, I have noticed that in the <code>battleUntilOver</code> function, if I replace</p>\n\n<pre><code>if battleOver bfield then return bfield \n</code></pre>\n\n<p>with</p>\n\n<pre><code>if battleOver bfield then randBfield\n</code></pre>\n\n<p>then the program does not work properly, outputting a faulty result.</p>\n\n<pre><code>*Risk&gt; evalRandIO $ invade Battlefield {attackers=10,defenders=10}\nbfield::Battlefield {attackers = 8, defenders = 10}::\nbfield::Battlefield {attackers = 7, defenders = 9}::\nbfield::Battlefield {attackers = 5, defenders = 9}::\nbfield::Battlefield {attackers = 3, defenders = 9}::\nBattlefield {attackers = bfield::Battlefield {attackers = 1, defenders = 9}::\n3, defenders = 7}\n</code></pre>\n\n<p>The last line is reproduced as I see it in GHCI, in which the tracing output is interspersed into the output of the evaluation of the <code>invade</code> function.</p>\n\n<p>Here the program seems to be ending because within the monad, <code>battleOver</code> evaluates to True, and </p>\n\n<pre><code>[attackers = 1, defenders = 9]\n</code></pre>\n\n<p>ends the game, indicating that the defenders won the last round, yet the evaluated output appears to be</p>\n\n<pre><code>[attackers = 3, defenders = 7]\n</code></pre>\n\n<p>a condition in which the attackers had won that round instead (and in which the game should continue).</p>\n\n<p>Why do I have to wrap the pure value <code>bfield</code> instead of returning the original monadic value <code>randBfield</code>?</p>\n"}, {"tags": ["haskell", "ambiguous-call"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 11, "creation_date": 1452090424, "post_id": 34635468, "comment_id": 57015960, "body": "Your indentation looks wrong, indent your <code>show</code> definition beyond the starting column of the <code>instance Show a =&gt; Show (Stack a) where</code> line."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1452099970, "post_id": 34635468, "comment_id": 57022575, "body": "Duplicate of <a href=\"https://stackoverflow.com/questions/27314929/creating-an-instance-of-the-fractional-typeclass-in-haskell/27315168#27315168\" title=\"creating an instance of the fractional typeclass in haskell\">stackoverflow.com/questions/27314929/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/14848978/haskell-show-instance-ambiguity?rq=1\" title=\"haskell show instance ambiguity\">stackoverflow.com/questions/14848978/&hellip;</a> or any other question that&#39;s about wrong indentation."}, {"owner": {"reputation": 47, "user_id": 5752529, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IwDEsU0nCMM/AAAAAAAAAAI/AAAAAAAAE6I/FMEF7weMs7Q/photo.jpg?sz=128", "display_name": "Raul Coroban", "link": "https://stackoverflow.com/users/5752529/raul-coroban"}, "edited": false, "score": 0, "creation_date": 1452108866, "post_id": 34635468, "comment_id": 57028155, "body": "Ok, sorry I didn&#39;t notice the tabulations are relevant in Haskell."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1452112524, "post_id": 34639678, "comment_id": 57030452, "body": "Actually, I believe that the first <code>show</code> line is already parsed <i>outside</i> the instance, since it is indented at the module level. (Not that it really matters ...)"}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1452116222, "post_id": 34639678, "comment_id": 57032393, "body": "@chi: also possible, but only if a <code>where</code> clause is allowed to be blank. (But maybe <code>where {}</code> is legal; I don&#39;t know. It would certainly help me understand the parser better.)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1452119239, "post_id": 34639678, "comment_id": 57033950, "body": "It is indeed legal to define classes with no methods, and instances with no methods."}, {"owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1452131114, "post_id": 34639678, "comment_id": 57037809, "body": "@chi I have changed this to follow what you&#39;ve said but I was pretty sure that those were done without <code>where</code> clauses (they can be!) so I looked it up specifically. In the Syntax reference it does say &quot;If the first token after a <code>where</code> (say) is not indented more than the enclosing layout context, then the block must be empty, so empty braces are inserted.&quot;"}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": true, "score": 1, "last_activity_date": 1452129885, "last_edit_date": 1452129885, "creation_date": 1452103244, "answer_id": 34639678, "question_id": 34635468, "link": "https://stackoverflow.com/questions/34635468/ambiguous-occurrence-in-haskell-with-show/34639678#34639678", "title": "Ambiguous occurrence in Haskell with &quot;show&quot;", "body": "<p>So the first problem is that you've got a <code>`</code> character in the code you pasted for us. Your second problem is that you don't need to indent all of the lines in the module; most Haskell modules that I see will <em>not</em> indent the body of the module. Your third problem is that you do not need parentheses around <code>show a</code> and <code>show b</code>: precedence in Haskell is really simple; parentheses always take top priority, followed by function application (left-associative or \"greedy nom\", a function always gobbles up the first thing that it sees in front of it), followed by operators in their defined precedence, followed by special syntactic forms like <code>\\a -></code>, <code>let</code>, <code>do</code>, <code>where</code>. Those are generally aesthetic concerns but you probably still care.</p>\n\n<p>Your final problem is here:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Show a =&gt; Show (Stack a) where\nshow EmptyStack = \"|\"\nshow (Stk a b) = (show a) ++ \" &lt;- \" ++ (show b)\n</code></pre>\n\n<p>You want Haskell to turn this into the single statement:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Show a =&gt; Show (Stack a) where show tmpvar = case tmpvar of { EmptyStack -&gt; \"|\"; Stk a b -&gt; show a ++ \" &lt;- \" ++ show b }\n</code></pre>\n\n<p>However Haskell has instead turned this into two separate lines:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Show a =&gt; Show (Stack a) where {} \n\nshow tmpvar = case tmpvar of { EmptyStack -&gt; \"|\"; Stk a b -&gt; show a ++ \" &lt;- \" ++ show b }\n</code></pre>\n\n<p>So the multiple-definition is correctly converted into a case-dispatch, but it's not put within the curly braces above! So, you can omit curly braces <code>{}</code> by using whitespace to indent lines. After <code>where</code>, Haskell does not see any explicit <code>{}</code> so it starts looking for indented lines, and it sees 0 of them, so it converts the clause to <code>where {}</code> (thanks @chi). </p>\n\n<p>Without being in curly braces, either because of indentation or not, that new line defines a different function, <code>Stack.show</code>, distinct from the imported <code>Prelude.show</code> that belongs to the <code>Show</code> typeclass. The problem is that it also references a function called <code>show</code>, which is now ambiguous: is this a <em>recursive</em> call for a function with infinite type <code>show :: Stack (Stack (Stack ...)) -&gt; String</code> or a <em>dispatching</em> call for a function with finite type <code>show :: (Show a) =&gt; Stack a -&gt; String</code>? Before it even tries to figure out those types it says \"stop it, I don't know what you mean, please clarify.\"</p>\n\n<p>Probably what you intended was instead:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Show a =&gt; Show (Stack a) where\n    show EmptyStack = \"|\"\n    show (Stk a b) = show a ++ \" &lt;- \" ++ show b\n</code></pre>\n\n<p>This indentation clues the Haskell compiler to accepti the two following statements into the <code>where</code> clause.</p>\n"}], "owner": {"reputation": 47, "user_id": 5752529, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IwDEsU0nCMM/AAAAAAAAAAI/AAAAAAAAE6I/FMEF7weMs7Q/photo.jpg?sz=128", "display_name": "Raul Coroban", "link": "https://stackoverflow.com/users/5752529/raul-coroban"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1701, "favorite_count": 0, "accepted_answer_id": 34639678, "answer_count": 1, "score": 1, "last_activity_date": 1452129885, "creation_date": 1452090298, "question_id": 34635468, "link": "https://stackoverflow.com/questions/34635468/ambiguous-occurrence-in-haskell-with-show", "title": "Ambiguous occurrence in Haskell with &quot;show&quot;", "body": "<p>I'm new in functional programming and I'm trying to create and show a Stack with Haskell. I'd like my program to show me the Stack I'm building  with it. This is my code:</p>\n\n<pre><code>module Stack (Stack, empty, push, pop, top, isEmpty) where\n    data Stack a       = EmptyStack | Stk a (Stack a)\n    push x s           = Stk x s\n    top (Stk x s)      = x\n    pop (Stk _ s)      = s\n    empty              = EmptyStack\n    isEmpty EmptyStack = True\n    isEmpty (Stk x s)  = False`\n\n    instance Show a =&gt; Show (Stack a) where\n    show EmptyStack = \"|\"\n    show (Stk a b) = (show a) ++ \" &lt;- \" ++ (show b)\n</code></pre>\n\n<p>With \"show (push 1 empty)\" I'd expect an answer (more or less) like: \" 1 &lt;- | \" \nBut I'm not able to compile the code. When I try it shows the following error:</p>\n\n<pre><code>[1 of 1] Compiling Stack            ( Stack.hs, interpreted )\n\nStack.hs:12:27:\n    Ambiguous occurrence \u2018show\u2019\n    It could refer to either \u2018Stack.show\u2019, defined at Stack.hs:11:9\n                      or \u2018Prelude.show\u2019,\n                         imported from \u2018Prelude\u2019 at Stack.hs:1:8-12\n                         (and originally defined in \u2018GHC.Show\u2019)\n\nStack.hs:12:47:\n    Ambiguous occurrence \u2018show\u2019\n    It could refer to either \u2018Stack.show\u2019, defined at Stack.hs:11:9\n                      or \u2018Prelude.show\u2019,\n                         imported from \u2018Prelude\u2019 at Stack.hs:1:8-12\n                         (and originally defined in \u2018GHC.Show\u2019)\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I understand the error where program could confuse the \"show\" from Prelude with an \"show\" defined by be, but I cannot see that error in my code. Besides, some mates have the same code, and the program works well.</p>\n\n<p>There is something I have to change or I have missed?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["sql", "performance", "haskell", "webserver", "n-tier-architecture"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452091005, "post_id": 34634328, "comment_id": 57016337, "body": "What does this have to do with the Haskell programming language?"}, {"owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1452092827, "post_id": 34634328, "comment_id": 57017692, "body": "@dfeuer ideally one would like a fair performance benchmark for haskell based web frameworks and how they compare to other setups, see discussion, links and presented misinformation in: <a href=\"https://www.reddit.com/r/haskell/comments/3wb0zx/what_happened_to_haskell_on_the_web_framework/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/3wb0zx/&hellip;</a>"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 1, "creation_date": 1452114671, "post_id": 34634328, "comment_id": 57031565, "body": "As a note: virtualized hardware usually has somehow different disk I/O and network I/O performance. CPU-wise, you can probably run on &#39;real&#39; or &#39;virtual&#39; hardware without much difference, as long as no other VM or the host is loading the physical CPU. Unless you decide what part network and disk play in your test, it&#39;s hard to tell anything. Do you have a database, for instance? Haskell does not have any particular execution penalties, like interpretation; it does have GC pauses, though, not unlike most everything else."}, {"owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1452115862, "post_id": 34634328, "comment_id": 57032198, "body": "@9000 thanks for your excellent points. network I/O performance is not really important for the setup, everything is not Network I/O bound. Disk is quite important for the relational db."}, {"owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "edited": false, "score": 0, "creation_date": 1452115973, "post_id": 34634328, "comment_id": 57032262, "body": "On real hardware I could see strange effects where twice the cores, switching from ~60 to ~120 cores reduced(!!) the web server performance by half. It was a strange effect related that correlated with interrupts. Perhaps in that corner cases CPU &#39;real&#39; versus &#39;virtual&#39; can make a difference."}, {"owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1452116051, "post_id": 34634328, "comment_id": 57032296, "body": "@9000 any pointers on what is the more common scenario \u2013 &#39;real&#39; vs. &#39;virtual&#39; hardware \u2013 for large, but not extremly large (n-tier) web servers?"}, {"owner": {"reputation": 703, "user_id": 5094838, "user_type": "registered", "profile_image": "https://graph.facebook.com/964350473610021/picture?type=large", "display_name": "Dennis Anikin", "link": "https://stackoverflow.com/users/5094838/dennis-anikin"}, "edited": false, "score": 0, "creation_date": 1453023400, "post_id": 34634328, "comment_id": 57414674, "body": "I would suggest to test your system in the environment that most of your customers have. For example if you assume that most of your customers sit in AWS or other clouds then do test your system on AWS/EC2 virtual instances. As the icing on the cake you will get the distribution of performance of your system across different types of EC2 instances which helps your user to pick the most reasonable instance type."}, {"owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "reply_to_user": {"reputation": 703, "user_id": 5094838, "user_type": "registered", "profile_image": "https://graph.facebook.com/964350473610021/picture?type=large", "display_name": "Dennis Anikin", "link": "https://stackoverflow.com/users/5094838/dennis-anikin"}, "edited": false, "score": 0, "creation_date": 1453028524, "post_id": 34634328, "comment_id": 57415922, "body": "@DennisAnikin Thanks for your reply. The work is for scientific research considering real world medium and large websites. For this I would need some reference or statistics on how does websites are hosted on average (real vs virtual hardware)."}, {"owner": {"reputation": 703, "user_id": 5094838, "user_type": "registered", "profile_image": "https://graph.facebook.com/964350473610021/picture?type=large", "display_name": "Dennis Anikin", "link": "https://stackoverflow.com/users/5094838/dennis-anikin"}, "edited": false, "score": 0, "creation_date": 1453029834, "post_id": 34634328, "comment_id": 57416303, "body": "@mrsteve You&#39;re welcome. Now I understand this clearly. These days everything goes cloud. If you&#39;re in the cloud then you&#39;re hosted virtually. Even if you&#39;re on your own premise like Google then you&#39;re also probably running on virtual servers for the sake of better operability for your fleet of machines. So I would probably bet on virtual environment. Don&#39;t have any statistics within touch though."}], "owner": {"reputation": 3902, "user_id": 391399, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/61f56a38bf46f807b5ef431c46813c99?s=128&d=identicon&r=PG", "display_name": "mrsteve", "link": "https://stackoverflow.com/users/391399/mrsteve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1452095243, "creation_date": 1452086892, "last_edit_date": 1452095243, "question_id": 34634328, "link": "https://stackoverflow.com/questions/34634328/real-hardware-or-virtualized-hardware-for-performance-benchmarks-of-realistic-we", "title": "Real hardware or virtualized hardware for performance benchmarks of realistic web servers", "body": "<p>I am interested in performing realistic web server performance tests. As realistic I define a typical scenario of today's medium to large web sites that serve dynamic content which is often based on data stored in relational databases. Think of a large e-commerce site, a large web forum, etc., where performance problems arise.</p>\n\n<p>Not of interest are websites like blogs with low traffic, or any aspect of web servers that concerns the performance of serving static content. Further, I exclude from this scenario very large websites that use a highly distributed approach like faceobook, google, amazon, reddit, etc. use., or any website that uses nosql data bases.</p>\n\n<p>The question is, in the above defined 'realistic scenario', are web server (e.g., apache, programming logic, relational database, etc.) run on real hardware or on virtualized hardware? With virtualized I mean something like \"Kernel-based Virtual Machine (KVM)\" or similar would be involved.</p>\n\n<p>The reason why I think about this is that often web performance tests are done in my subjective eyes poorly. For example all performance test are run on a relational db table with 12 rows and 2 columns, e.g., see: <a href=\"https://www.techempower.com/benchmarks/\" rel=\"nofollow\">Web Framework Benchmarks</a> as well as related discussions on <a href=\"https://www.reddit.com/r/haskell/comments/3wb0zx/what_happened_to_haskell_on_the_web_framework/\" rel=\"nofollow\">reddit</a>. </p>\n\n<p>I want to look into performing more realistic web server benchmarks in a setting with the aforementioned realistic scenario. </p>\n\n<p>(Just why I think about that: In my work we don't have any virtualization on our web server hardware. We have servers with over 100gb ram and more than 100 cores. Virtualization in our setting means a dramatic penalty in performance.)</p>\n\n<p>The question is, should I run the perform my performance analysis on:</p>\n\n<ul>\n<li>real hardware (non-virtualized, as much 'bare metal' as possible)</li>\n<li>virtualized hardware</li>\n<li>on both</li>\n</ul>\n\n<p>From my subjective work experience I would say performance tests on real (non-virtualized) hardware are enough. Testing on both would mean more effort so I would avoid it unless a necessity.</p>\n\n<p>(With my performance analysis I would later be interested to test haskell based web frameworks.)</p>\n"}, {"tags": ["haskell", "monads", "string-parsing", "free-monad"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1452078230, "post_id": 34631446, "comment_id": 57008162, "body": "best to upload a fully working example to e.g. <a href=\"http://lpaste.net\" rel=\"nofollow noreferrer\">lpaste.net</a> or for multiple files <a href=\"https://gist.github.com/\" rel=\"nofollow noreferrer\">gist.github.com</a>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1452080640, "post_id": 34631446, "comment_id": 57009608, "body": "Suppose you can write a parser that returns <code>forall a. Example a</code>. What would you do with the result?"}, {"owner": {"reputation": 5145, "user_id": 600545, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d34ee2348ea695f1a5b3408e11e2dca0?s=128&d=identicon&r=PG", "display_name": "romeovs", "link": "https://stackoverflow.com/users/600545/romeovs"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1452082219, "post_id": 34631446, "comment_id": 57010531, "body": "@n.m. It&#39;s to be used in a TCP interaction. The client sends commands and the server responds to them. Your question makes me feel I&#39;m not totally getting it though \u30fb\u203f\u30fb Perhaps I should parse to an <code>Example Response</code> or something like <code>Response a =&gt; Example a</code>?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1452085793, "post_id": 34631446, "comment_id": 57012845, "body": "Ok so you want <code>Example Response</code>. That&#39;s much easier. What happens if the string actually parses to <code>Example Int</code>? A parse error. Your parser should be able to handle errors, shouldn&#39;t it?"}, {"owner": {"reputation": 5145, "user_id": 600545, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d34ee2348ea695f1a5b3408e11e2dca0?s=128&d=identicon&r=PG", "display_name": "romeovs", "link": "https://stackoverflow.com/users/600545/romeovs"}, "edited": false, "score": 0, "creation_date": 1452098588, "post_id": 34631446, "comment_id": 57021629, "body": "Ok but then the last argument for every constructor of <code>ExampleF</code> has to be <code>(Response -&gt; a)</code> right. This loses a lot of the expressivity of the <code>Example</code> monad. It feels more like a type-free language then, with <code>Response</code> just soaking up every possible type... Hmm have to think this through."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1452099710, "post_id": 34631446, "comment_id": 57022393, "body": "You are essentially expecting your parser to also do typechecking for you - your example expression is valid at one type <code>Example ()</code> but not at <code>Example Int</code> - therefore, if you have a parser of type <code>forall a . Parser (Example a)</code> then this parser must discriminate based on type, but it clearly does not (being parametric in <code>a</code>). So you need a function like <code>TypeWitness a -&gt; Parser (Example a)</code>, where <code>TypeWitness</code> is a GADT indexed on your type language - or you just write one parser function for each type, the simpler solution."}], "answers": [{"comments": [{"owner": {"reputation": 5145, "user_id": 600545, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d34ee2348ea695f1a5b3408e11e2dca0?s=128&d=identicon&r=PG", "display_name": "romeovs", "link": "https://stackoverflow.com/users/600545/romeovs"}, "edited": false, "score": 0, "creation_date": 1452113864, "post_id": 34641928, "comment_id": 57031151, "body": "Wow, this is a long answer. Thanks! I&#39;ll go trough it tonight when I have the time."}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 2, "last_activity_date": 1452111290, "creation_date": 1452111290, "answer_id": 34641928, "question_id": 34631446, "link": "https://stackoverflow.com/questions/34631446/parsing-to-free-monads/34641928#34641928", "title": "Parsing to Free Monads", "body": "\n\n<p>So, I worry that this is the same sort of premature abstraction that you see in object-oriented languages, getting in the way of things. For example, I am not 100% sure that you are using the structure of the free monad -- your helpers for example simply seem to use <code>id</code> and <code>()</code> in a rather boring way, in fact I'm not sure if your <code>Int -&gt; x</code> is ever anything other than either <code>Pure :: Int -&gt; Free ExampleF Int</code> or <code>const (something :: Free ExampleF Int)</code>.</p>\n\n<p>The free monad for a functor F can basically be described as a tree whose data is stored in leaves and whose branching factor is controlled by the recursion in each constructor of the functor F. So for example <code>Free Identity</code> has no branching, hence only one leaf, and thus has the same structure as the monad:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data MonoidalFree m x = MF m x deriving (Functor)\ninstance Monoid m =&gt; Monad (MonoidalFree m) where\n    return x = MF mempty x\n    MF m x &gt;&gt;= my_x = case my_x x of MF n y -&gt; MF (mappend m n) y\n</code></pre>\n\n<p>In fact <code>Free Identity</code> is isomorphic to <code>MonoidalFree (Sum Integer)</code>, the difference is just that instead of <code>MF (Sum 3) \"Hello\"</code> you see <code>Free . Identity . Free . Identity . Free . Identity $ Pure \"Hello\"</code> as the means of tracking this integer. On the other hand if you have <code>data E x = L x | R x deriving (Functor)</code> then you get a sort of \"path\" of Ls and Rs before you hit this one leaf, <code>Free E</code> is going to be isomorphic to <code>MonoidalFree [Bool]</code>. </p>\n\n<p>The reason I'm going through this is that when you combine <code>Free</code> with an <code>Integer -&gt; x</code> functor, you get an <em>infinitely branching tree</em>, and when I'm looking through your code to figure out how you're <strong>actually using</strong> this tree, all I see is that you use the <code>id</code> function with it. As far as I can tell, that restricts the recursion to either have the form <code>Free (Bar \"string\" Pure)</code> or else <code>Free (Bar \"string\" (const subExpression)),</code> in which case the system would seem to reduce completely to the <code>MonoidalFree [Either Int String]</code> monad.</p>\n\n<p>(At this point I should pause to ask: Is that correct as far as you know? Was this what was intended?)</p>\n\n<p>Anyway. Aside from my problems with your premature abstraction, the specific problem that you're citing with your monad (you can't tell the difference between <code>()</code> and <code>Int</code> has a bunch of really complicated solutions, but one really easy one. The really easy solution is to yield a value of type <code>Example (Either () Int)</code> and if you have a <code>()</code> you can <code>fmap Left</code> onto it and if you have an <code>Int</code> you can <code>fmap Right</code> onto it.</p>\n\n<p>Without a much better understanding of <strong>how</strong> you're using this thing over TCP/IP we can't recommend a better structure for you than the generic free monads that you seem to be finding -- in particular we'd need to know how you're planning on using the infinite-branching of <code>Int -&gt; x</code> options in practice.</p>\n"}, {"comments": [{"owner": {"reputation": 5145, "user_id": 600545, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d34ee2348ea695f1a5b3408e11e2dca0?s=128&d=identicon&r=PG", "display_name": "romeovs", "link": "https://stackoverflow.com/users/600545/romeovs"}, "edited": false, "score": 0, "creation_date": 1452185560, "post_id": 34643032, "comment_id": 57066866, "body": "nice answer! You&#39;re probably right that I just need a Free Applicative instead. I&#39;m still quite new to the type Zoo so it&#39;s hard to find my way. More particular. I just need to be able to write simple embedded programs, and I wanted to partly capture their semantics (what command may return what value) in a nice way, so I stumbled on Free monads, which seem to be all the hype. Perhaps more people should write nice articles and blogposts on Free applicative too!"}, {"owner": {"reputation": 5145, "user_id": 600545, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d34ee2348ea695f1a5b3408e11e2dca0?s=128&d=identicon&r=PG", "display_name": "romeovs", "link": "https://stackoverflow.com/users/600545/romeovs"}, "edited": false, "score": 0, "creation_date": 1452188302, "post_id": 34643032, "comment_id": 57068680, "body": "To be honest, I just tried to use Free Monads because of <a href=\"http://degoes.net/articles/modern-fp/\" rel=\"nofollow noreferrer\">this post</a>. It&#39;s hard to see if Free Applicatives give me the same advantages as the article claims for Free Applicatives (mainly having multiple independent interpreters that are composable)."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 5145, "user_id": 600545, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d34ee2348ea695f1a5b3408e11e2dca0?s=128&d=identicon&r=PG", "display_name": "romeovs", "link": "https://stackoverflow.com/users/600545/romeovs"}, "edited": false, "score": 0, "creation_date": 1452194902, "post_id": 34643032, "comment_id": 57072530, "body": "If all you need is <code>Applicative</code> then that&#39;s what you should use. Every <code>Monad</code> is an <code>Applicative</code> but not every <code>Applicative</code> is a <code>Monad</code>; the difference is that <code>Monad</code> allows future computations to depend on past results (whereas <code>Applicative</code> effects are purely static). <code>Applicative</code>s are easier to compose than <code>Monad</code>s, not harder."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1452302423, "post_id": 34643032, "comment_id": 57123923, "body": "Did you know that type operators don&#39;t need to start with colon anymore?  It makes code like this extra great."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1593926473, "last_edit_date": 1593926473, "creation_date": 1452115405, "answer_id": 34643032, "question_id": 34631446, "link": "https://stackoverflow.com/questions/34631446/parsing-to-free-monads/34643032#34643032", "title": "Parsing to Free Monads", "body": "<p>Not every <code>Example</code> value can be represented on the page without reimplementing some portion of Haskell. For example, <code>return putStrLn</code> has a type of <code>Example (String -&gt; IO ())</code>, but I don't think it makes sense to attempt to parse that sort of <code>Example</code> value out of a file.</p>\n<p>So let's restrict ourselves to parsing the examples you've given, which consist only of calls to <code>foo</code> and <code>bar</code> sequenced with <code>&gt;&gt;</code> (that is, no variable bindings and no arbitrary computations)*. The Backus-Naur form for our grammar looks approximately like this:</p>\n<pre><code>&lt;program&gt; ::= &quot;&quot; | &lt;expr&gt; &quot;\\n&quot; &lt;program&gt;\n&lt;expr&gt; ::= &quot;foo &quot; &lt;integer&gt; | &quot;bar &quot; &lt;string&gt;\n</code></pre>\n<p>It's straightforward enough to parse our two types of expression...</p>\n<pre><code>type Parser = Parsec String ()\n\nint :: Parser Int\nint = fmap read (many1 digit)\n\nparseFoo :: Parser (Example ())\nparseFoo = string &quot;foo &quot; *&gt; fmap foo int\n\nparseBar :: Parser (Example Int)\nparseBar = string &quot;bar &quot; *&gt; fmap bar (many1 alphaNum)\n</code></pre>\n<p>... but how can we give a type to the composition of these two parsers?</p>\n<pre><code>parseExpr :: Parser (Example ???)\nparseExpr = parseFoo &lt;|&gt; parseBar\n</code></pre>\n<p><code>parseFoo</code> and <code>parseBar</code> have different types, so we can't compose them with <code>&lt;|&gt; :: Alternative f =&gt; f a -&gt; f a -&gt; f a</code>. Moreover, there's no way to know ahead of time which type the program we're given will be: as you point out, the <em>type</em> of the parsed program depends on the <em>value</em> of the input string. &quot;Types depending on values&quot; is called <em>dependent types</em>; Haskell doesn't feature a proper dependent type system, but it comes close enough for us to have a stab at making this example work.</p>\n<hr />\n<p>Let's start by forcing the expressions on either side of <code>&lt;|&gt;</code> to have the same type. This involves erasing <code>Example</code>'s type parameter using <a href=\"https://downloads.haskell.org/%7Eghc/7.8.3/docs/html/users_guide/data-type-extensions.html#existential-quantification\" rel=\"nofollow noreferrer\"><em>existential quantification</em></a>.\u2020</p>\n<pre><code>data Ex a = forall i. Wrap (a i)\n\nparseExpr :: Parser (Ex Example)\nparseExpr = fmap Wrap parseFoo &lt;|&gt; fmap Wrap parseBar\n</code></pre>\n<p>This typechecks, but the parser now returns an <code>Example</code> containing a value of an unknown type. A value of unknown type is of course useless - but we do know <em>something</em> about <code>Example</code>'s parameter: it must be either <code>()</code> or <code>Int</code> because those are the return types of <code>parseFoo</code> and <code>parseBar</code>. Programming is about getting knowledge out of your brain and onto the page, so we're going to wrap up the <code>Example</code> value with a bit of <a href=\"https://downloads.haskell.org/%7Eghc/latest/docs/html/users_guide/data-type-extensions.html#gadt\" rel=\"nofollow noreferrer\">GADT</a> evidence which, when unwrapped, will tell you whether <code>a</code> was <code>Int</code> or <code>()</code>.</p>\n<pre><code>data Ty a where\n    IntTy :: Ty Int\n    UnitTy :: Ty ()\n\ndata (a :*: b) i = a i :&amp;: b i\n\ntype Sig a b = Ex (a :*: b)\npattern Sig x y = Wrap (x :&amp;: y)\n\nparseExpr :: Parser (Sig Ty Example)\nparseExpr = fmap (\\x -&gt; Sig UnitTy x) parseFoo &lt;|&gt;\n            fmap (\\x -&gt; Sig IntTy x) parseBar\n</code></pre>\n<p><code>Ty</code> is (something like) a runtime &quot;singleton&quot; representative of <code>Example</code>'s type parameter. When you pattern match on <code>IntTy</code>, you learn that <code>a ~ Int</code>; when you pattern match on <code>UnitTy</code> you learn that <code>a ~ ()</code>. (Information can be made to flow the other way, from types to values, using classes.) <code>:*:</code>, the <a href=\"https://hackage.haskell.org/package/transformers-0.5.0.0/docs/Data-Functor-Product.html\" rel=\"nofollow noreferrer\">functor product</a>, pairs up two type constructors ensuring that their parameters are equal; thus, pattern matching on the <code>Ty</code> tells you about its accompanying <code>Example</code>.</p>\n<p><code>Sig</code> is therefore called a <em>dependent pair</em> or <em>sigma</em> type - the <em>type</em> of the second component of the pair depends on the <em>value</em> of the first. This is a common technique: when you erase a type parameter by existential quantification, it usually pays to make it recoverable by bundling up a runtime representative of that parameter.</p>\n<p>Note that this use of <code>Sig</code> is equivalent to <code>Either (Example Int) (Example ())</code> - <a href=\"https://stackoverflow.com/questions/26542350/dependent-types-how-is-the-dependent-pair-type-analogous-to-a-disjoint-union\">a sigma type is a sum</a>, after all - but this version scales better when you're summing over a large (or possibly infinite) set.</p>\n<p>Now it's easy to build our expression parser into a program parser. We just have to repeatedly apply the expression parser, and then manipulate the dependent pairs in the list.</p>\n<pre><code>parseProgram :: Parser (Sig Ty Example)\nparseProgram = fmap (foldr1 combine) $ parseExpr `sepBy1` (char '\\n')\n    where combine (Sig _ val) (Sig ty acc) = Sig ty (val &gt;&gt; acc)\n</code></pre>\n<p>The code I've shown you is not exemplary. It doesn't separate the concerns of parsing and typechecking. In production code I would modularise this design by first parsing the data into an untyped syntax tree - a separate data type which doesn't enforce the typing invariant - then transform that into a typed version by type-checking it. The dependent pair technique would still be necessary to give a type to the output of the type-checker, but it wouldn't be tangled up in the parser.</p>\n<p><sub>*If binding is not a requirement, have you thought about using a <a href=\"https://hackage.haskell.org/package/free-4.12.1/docs/Control-Applicative-Free.html\" rel=\"nofollow noreferrer\">free applicative</a> to represent your data?</sub></p>\n<p><sub>\u2020<code>Ex</code> and <code>:*:</code> are reusable bits of machinery which I lifted from the <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow noreferrer\">Hasochism paper</a></sub></p>\n"}], "owner": {"reputation": 5145, "user_id": 600545, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d34ee2348ea695f1a5b3408e11e2dca0?s=128&d=identicon&r=PG", "display_name": "romeovs", "link": "https://stackoverflow.com/users/600545/romeovs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 528, "favorite_count": 2, "accepted_answer_id": 34643032, "answer_count": 2, "score": 5, "last_activity_date": 1593926473, "creation_date": 1452077958, "last_edit_date": 1452108105, "question_id": 34631446, "link": "https://stackoverflow.com/questions/34631446/parsing-to-free-monads", "title": "Parsing to Free Monads", "body": "<p>Say I have the following free monad:</p>\n\n<pre><code>data ExampleF a\n  = Foo Int a\n  | Bar String (Int -&gt; a)\n  deriving Functor\n\ntype Example = Free ExampleF  -- this is the free monad want to discuss\n</code></pre>\n\n<p>I know how I  can work with this monad, eg. I could write some nice helpers:</p>\n\n<pre><code>foo :: Int -&gt; Example ()\nfoo i = liftF $ Foo i ()\n\nbar :: String -&gt; Example Int\nbar s = liftF $ Bar s id\n</code></pre>\n\n<p>So I can write programs in haskell like:</p>\n\n<pre><code>fooThenBar :: Example Int\nfooThenBar =\n  do\n    foo 10\n    bar \"nice\"\n</code></pre>\n\n<p>I know how to print it, interpret it, etc. But what about parsing it?</p>\n\n<p>Would it be possible to write a parser that could parse arbitrary\nprograms like:</p>\n\n<pre><code>foo 12\nbar nice\nfoo 11\nfoo 42\n</code></pre>\n\n<p>So I can store them, serialize them, use them in cli programs etc.</p>\n\n<p>The problem I keep running into is that the type of the program depends on which program is being parsed. If the program ends with a <code>foo</code> it's of\ntype <code>Example ()</code> if it ends with a <code>bar</code> it's of type <code>Example Int</code>.</p>\n\n<p>I do not feel like writing parsers for every possible permutation (it's simple here because there are only two possibilities, but imagine we add\n<code>Baz Int (String -&gt; a)</code>, <code>Doo (Int -&gt; a)</code>, <code>Moz Int a</code>, <code>Foz String a</code>, .... This get's tedious and error-prone).</p>\n\n<p>Perhaps I'm solving the wrong problem?</p>\n\n<h3>Boilerplate</h3>\n\n<p>To run the above examples, you need to add this to the beginning of the file:</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n\nimport Control.Monad.Free\nimport Text.ParserCombinators.Parsec\n</code></pre>\n\n<p><em>Note: I put up <a href=\"https://gist.github.com/4402caeedad10ff56e90\" rel=\"nofollow\">a gist containing this code</a>.</em></p>\n"}, {"tags": ["haskell", "mathjax", "happstack"], "comments": [{"owner": {"reputation": 4766, "user_id": 1339651, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LCE8Q.png?s=128&g=1", "display_name": "Peter Krautzberger", "link": "https://stackoverflow.com/users/1339651/peter-krautzberger"}, "edited": false, "score": 0, "creation_date": 1452137231, "post_id": 34631307, "comment_id": 57039362, "body": "The link to MathJax&#39;s CDN is outdated. Try replacing <code>d3eoax9i5htok0.cloudfront.net</code> with <code>cdn.mathjax.org</code>. To run MathJax from your own server, see the documentation at <a href=\"http://docs.mathjax.org/en/latest/installation.html\" rel=\"nofollow noreferrer\">docs.mathjax.org/en/latest/installation.html</a>."}, {"owner": {"reputation": 4766, "user_id": 1339651, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LCE8Q.png?s=128&g=1", "display_name": "Peter Krautzberger", "link": "https://stackoverflow.com/users/1339651/peter-krautzberger"}, "edited": false, "score": 1, "creation_date": 1492067297, "post_id": 34631307, "comment_id": 73832802, "body": "Note from the future: cdn.mathjax.org is nearing its end-of-life, check mathjax.org/cdn-shutting-down for migration tips."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 5751672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71133b424428eb5b375356d4bd6d3e11?s=128&d=identicon&r=PG&f=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/5751672/anonymous"}, "edited": false, "score": 0, "creation_date": 1452093074, "post_id": 34635899, "comment_id": 57017872, "body": "But how do I set up localhost:1234 in the first place? Sorry if I wasn&#39;t clear."}, {"owner": {"reputation": 63, "user_id": 5751672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71133b424428eb5b375356d4bd6d3e11?s=128&d=identicon&r=PG&f=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/5751672/anonymous"}, "edited": false, "score": 0, "creation_date": 1452093382, "post_id": 34635899, "comment_id": 57018075, "body": "Sorry didn&#39;t see you said port 5001 not 1234"}, {"owner": {"reputation": 63, "user_id": 5751672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71133b424428eb5b375356d4bd6d3e11?s=128&d=identicon&r=PG&f=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/5751672/anonymous"}, "edited": false, "score": 1, "creation_date": 1452162271, "post_id": 34635899, "comment_id": 57050346, "body": "I tried this but can&#39;t get it to work. There is a data/static/js directory structure inside the gitit root directory, I tried to place the files there. But it seems the base URL localhost:5001 actually points to the wiki/wikidata directory. I tried putting files there, but it didn&#39;t work either. Perhaps I&#39;m doing this wrong. Also, URL needs to be of the form (in Apache) <code>http:&#47;&#47;localhost&#47;MathJax&#47;MathJax.js?config=TeX-AMS-MML_HTMLo&zwnj;&#8203;rMML</code>"}], "tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": false, "score": 0, "last_activity_date": 1452093175, "last_edit_date": 1452093175, "creation_date": 1452091532, "answer_id": 34635899, "question_id": 34631307, "link": "https://stackoverflow.com/questions/34631307/how-do-i-serve-mathjax-from-a-local-happstack-server/34635899#34635899", "title": "How do I serve MathJax from a local Happstack server?", "body": "<p>Download the <code>MathJax.js</code> file from e.g. <a href=\"https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML\" rel=\"nofollow\">cdn.mathjax.org</a> and place it in <code>data/static/js/MathJax.js</code>. Then change the config you quote to:</p>\n\n<pre><code>mathjax-script: http://localhost:5001/js/MathJax.js\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 5751672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71133b424428eb5b375356d4bd6d3e11?s=128&d=identicon&r=PG&f=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/5751672/anonymous"}, "is_accepted": false, "score": 1, "last_activity_date": 1452164496, "last_edit_date": 1452164496, "creation_date": 1452159142, "answer_id": 34651615, "question_id": 34631307, "link": "https://stackoverflow.com/questions/34631307/how-do-i-serve-mathjax-from-a-local-happstack-server/34651615#34651615", "title": "How do I serve MathJax from a local Happstack server?", "body": "<p>Ok I got MathJax working using portable Apache and the MathJax archive downloaded from <a href=\"http://docs.mathjax.org/en/latest/installation.html\" rel=\"nofollow\">docs.mathjax.org</a>. The URL needs to be of the form (assuming you extracted the files into apache2/htdocs/MathJax): </p>\n\n<pre><code>http://localhost/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML\n</code></pre>\n\n<p>I wanted to keep this lightweight by reusing the same instance of Happstack as Gitit, but that seems beyond my skills/available time right now.</p>\n\n<p>EDIT: Just found out that ghc will pack everything into one exe when building. So I doubt it is even possible to use the same Happstack instance, as the root directory of the server doesn't exist?</p>\n"}, {"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 1, "last_activity_date": 1457404513, "creation_date": 1457404513, "answer_id": 35857874, "question_id": 34631307, "link": "https://stackoverflow.com/questions/34631307/how-do-i-serve-mathjax-from-a-local-happstack-server/35857874#35857874", "title": "How do I serve MathJax from a local Happstack server?", "body": "<p>From the documentation, the <code>static</code> directory should work just fine:</p>\n\n<blockquote>\n  <p>On receiving a request, gitit always looks first in the static\n  directory (or in whatever directory is specified for static-dir in the\n  configuration file). If a file corresponding to the request is found\n  there, it is served immediately. If the file is not found in static,\n  gitit next looks in the static subdirectory of gitit's data file\n  ($CABALDIR/share/gitit-x.y.z/data). This is where default css, images,\n  and javascripts are stored. If the file is not found there either,\n  gitit treats the request as a request for a wiki page or wiki command.</p>\n  \n  <p>So, you can throw anything you want to be served statically (for\n  example, a robots.txt file or favicon.ico) in the static directory.\n  You can override any of gitit's default css, javascript, or image\n  files by putting a file with the same relative path in static. Note\n  that gitit has a default robots.txt file that excludes all URLs\n  beginning with /_.</p>\n</blockquote>\n\n<p>(source: <a href=\"https://github.com/jgm/gitit\" rel=\"nofollow\">https://github.com/jgm/gitit</a>)</p>\n"}], "owner": {"reputation": 63, "user_id": 5751672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71133b424428eb5b375356d4bd6d3e11?s=128&d=identicon&r=PG&f=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/5751672/anonymous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 1, "answer_count": 3, "score": 2, "last_activity_date": 1457404513, "creation_date": 1452077539, "last_edit_date": 1452093225, "question_id": 34631307, "link": "https://stackoverflow.com/questions/34631307/how-do-i-serve-mathjax-from-a-local-happstack-server", "title": "How do I serve MathJax from a local Happstack server?", "body": "<p>I'm not a developer/programmer. I'm just someone trying to use <a href=\"https://github.com/jgm/gitit\" rel=\"nofollow\">Gitit</a> to take notes. I've got it to the point where it runs on Windows, but the math looks best using MathJax. I don't want to rely on a remote CDN to get the MathJax working (power cuts and internet disconnections are very frequent here). The author of the app mentions it can be setup in \"4 lines of code\" in Happstack:</p>\n\n<pre><code>mathjax-script: https://d3eoax9i5htok0.cloudfront.net/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML\n# specifies the path to MathJax rendering script.\n# You might want to use your own MathJax script to render formulas without\n# Internet connection or if you want to use some special LaTeX packages.\n# Note: path specified there cannot be an absolute path to a script on your hdd, \n# instead you should run your (local if you wish) HTTP server which will \n# serve the MathJax.js script. You can easily (in four lines of code) serve\n# MathJax.js using http://happstack.com/docs/crashcourse/FileServing.html\n# Do not forget the \"http://\" prefix (e.g. http://localhost:1234/MathJax.js)\n</code></pre>\n\n<p>The link to the tutorial is broken, so I'd be grateful for some assistance. Is there is any MathJax configuration I need to change, or simply extracting the files will do? I'll be writing lots of math in gitit. I'd prefer not to set up Apache etc. to serve MathJax. Gitit already uses Happstack, I'd prefer using that. Thanks!</p>\n\n<p><em>EDIT:</em> Just to be clear I'm not sure how to assign the port 1234 to serve this script </p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1452085427, "post_id": 34629132, "comment_id": 57012584, "body": "By the way, this is obfuscated code that hopefully no one would ever write in a real program. More natural would be <code>map ($ 3) [(+3),(+2),(+1)]</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1452091338, "post_id": 34629132, "comment_id": 57016563, "body": "@ReidBarton, or <code>[(+3),(+2),(+1)] &lt;*&gt; [3]</code>, or much better, <code>(3+) &lt;$&gt; [3,2,1]</code>."}], "answers": [{"comments": [{"owner": {"reputation": 16438, "user_id": 312896, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/57c5b6cdd1a94aef510d5dce28992494?s=128&d=identicon&r=PG", "display_name": "Yola", "link": "https://stackoverflow.com/users/312896/yola"}, "edited": false, "score": 0, "creation_date": 1452077246, "post_id": 34631083, "comment_id": 57007573, "body": "so <code>(+3)</code> is kinda an instance of <code>(-&gt;) a</code>"}, {"owner": {"reputation": 419, "user_id": 1942841, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5bdd8f9e2c620732bed9603b39b647e5?s=128&d=identicon&r=PG", "display_name": "Thomas Smith", "link": "https://stackoverflow.com/users/1942841/thomas-smith"}, "edited": false, "score": 0, "creation_date": 1452087742, "post_id": 34631083, "comment_id": 57014058, "body": "<code>(-&gt; a)</code> is a partially applied type contructor. You could say that <code>(+3)</code> is compatible with <code>(-&gt; a)</code>. You can check this in ghci: <code>:t (+3) :: Num a =&gt; (-&gt;) a a</code>"}], "tags": [], "owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "is_accepted": true, "score": 3, "last_activity_date": 1452076886, "creation_date": 1452076886, "answer_id": 34631083, "question_id": 34629132, "link": "https://stackoverflow.com/questions/34629132/how-sequencea-works/34631083#34631083", "title": "How `sequenceA` works", "body": "<p>it is using <code>instance Applicative ((-&gt;) a)</code>.</p>\n\n<p>Try this in ghci:</p>\n\n<pre><code>Prelude&gt; :t [(+3),(+2),(+1)]\n[(+3),(+2),(+1)] :: Num a =&gt; [a -&gt; a]\n\nPrelude&gt; :t sequenceA\nsequenceA :: (Applicative f, Traversable t) =&gt; t (f a) -&gt; f (t a)\n</code></pre>\n\n<p>and pattern match the argument type: <code>t = [], f = (-&gt;) a</code>\nand the Applicative constraint is on f.</p>\n"}, {"comments": [{"owner": {"reputation": 16438, "user_id": 312896, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/57c5b6cdd1a94aef510d5dce28992494?s=128&d=identicon&r=PG", "display_name": "Yola", "link": "https://stackoverflow.com/users/312896/yola"}, "edited": false, "score": 0, "creation_date": 1452097146, "post_id": 34634473, "comment_id": 57020661, "body": "Sorry, what does const mean in <code>const []</code>."}, {"owner": {"reputation": 419, "user_id": 1942841, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5bdd8f9e2c620732bed9603b39b647e5?s=128&d=identicon&r=PG", "display_name": "Thomas Smith", "link": "https://stackoverflow.com/users/1942841/thomas-smith"}, "reply_to_user": {"reputation": 16438, "user_id": 312896, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/57c5b6cdd1a94aef510d5dce28992494?s=128&d=identicon&r=PG", "display_name": "Yola", "link": "https://stackoverflow.com/users/312896/yola"}, "edited": false, "score": 2, "creation_date": 1452153073, "post_id": 34634473, "comment_id": 57044955, "body": "It is a functuion defined as: <code>const a b = a</code> So when you evaluate <code>const []</code> it returns a function that always produces an empty list as result, regardless of what argument you pass to that function."}], "tags": [], "owner": {"reputation": 419, "user_id": 1942841, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5bdd8f9e2c620732bed9603b39b647e5?s=128&d=identicon&r=PG", "display_name": "Thomas Smith", "link": "https://stackoverflow.com/users/1942841/thomas-smith"}, "is_accepted": false, "score": 8, "last_activity_date": 1513537086, "last_edit_date": 1513537086, "creation_date": 1452087382, "answer_id": 34634473, "question_id": 34629132, "link": "https://stackoverflow.com/questions/34629132/how-sequencea-works/34634473#34634473", "title": "How `sequenceA` works", "body": "<p>This can be seen from the type of sequenceA:</p>\n\n<p><code>sequenceA :: (Applicative f, Traversable t) =&gt; t (f a) -&gt; f (t a)</code></p>\n\n<p>The argument's outer type has to be a <code>Traverable</code>, and its inner type has to be <code>Applicative</code>.</p>\n\n<p>Now, when you give sequenceA a list of functions <code>(Num a) =&gt; [a -&gt; a]</code> the list will be the <code>Traversable</code>, and the things inside the list should be  <code>Applicative</code>. Therefore, it uses the applicative instance for functions.</p>\n\n<p>So when you apply sequenceA to <code>[(+3),(+2),(+1)]</code>, the following computation is built:</p>\n\n<pre><code>sequenceA [(+3),(+2),(+1)] = (:) &lt;$&gt; (+3) &lt;*&gt; sequenceA [(+2),(+1)]\nsequenceA [(+2),(+1)]      = (:) &lt;$&gt; (+2) &lt;*&gt; sequenceA [(+1)]\nsequenceA [(+1)]           = (:) &lt;$&gt; (+1) &lt;*&gt; sequenceA []\nsequenceA []               = pure []\n</code></pre>\n\n<p>Let's look at the last line. <code>pure []</code> takes an empty list and puts it inside some applicative structure. As we've just seen, the applicative structure in this case is <code>((-&gt;) r)</code>. Because of this, <code>sequenceA [] = pure [] = const []</code>.</p>\n\n<p>Now, line 3 can be written as:</p>\n\n<pre><code>sequenceA [(+1)] = (:) &lt;$&gt; (+1) &lt;*&gt; const []\n</code></pre>\n\n<p>Combining functions this way with <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> results in parallel application. <code>(+1)</code> and <code>const []</code> are both applied to the same argument, and the results are combined using <code>(:)</code></p>\n\n<p>Therefore <code>sequenceA [(+1)]</code> returns a function that takes a <code>Num a =&gt; a</code> type value, applies <code>(+1)</code> to it, and then prepends the result to an empty list, <code>\\x -&gt; (:) ((1+) x) (const [] x)</code> = <code>\\x -&gt; [(+1) x]</code>.</p>\n\n<p>This concept can be extended further to <code>sequenceA [(+3), (+2), (+1)]</code>. It results in a function that takes one argument, applies all three functions to that argument, and combines the three results with <code>(:)</code> collecting them in a list: <code>\\x -&gt; [(+3) x, (+2) x, (+1) x]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 781, "user_id": 5057805, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9USavIbjP-M/AAAAAAAAAAI/AAAAAAAAADk/5fj7tZo247s/photo.jpg?sz=128", "display_name": "Paul Parker", "link": "https://stackoverflow.com/users/5057805/paul-parker"}, "is_accepted": false, "score": 3, "last_activity_date": 1513750839, "last_edit_date": 1513750839, "creation_date": 1513494697, "answer_id": 47852986, "question_id": 34629132, "link": "https://stackoverflow.com/questions/34629132/how-sequencea-works/47852986#47852986", "title": "How `sequenceA` works", "body": "<p>For anyone who has trouble accepting that an argument to <code>sequenceA [(+1)]</code> just magically applies itself to BOTH <code>(+1)</code> and <code>const []</code>, this is for you. It was the only sticking point for me after realizing that <code>pure [] = const []</code>.</p>\n\n<pre><code>sequenceA [(+1)] = (:) &lt;$&gt; (+1) &lt;*&gt; const []\n</code></pre>\n\n<p>Using lambdas (so we can explicitly show and move things around when we start treating function application like a functor and an applicative):</p>\n\n<pre><code>sequenceA [(+1)] = \\b c -&gt; ( (:) b c ) &lt;$&gt; ( \\a -&gt; (+1) a ) &lt;*&gt; ( \\a -&gt; const [] a )\n</code></pre>\n\n<p>Both <code>(&lt;$&gt;)</code> and <code>(&lt;*&gt;)</code> are infixl 4. Which means we read and evaluate from left to right, i.e. we start with <code>(&lt;$&gt;)</code>.</p>\n\n<p>Where <code>(&lt;$&gt;) :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code>. </p>\n\n<p>The effect of <code>&lt;$&gt;</code> is to pluck <code>(+1)</code> out of it's wrapper <code>((-&gt;) r)</code>, OR <code>\\a -&gt;</code> from our lambda code, and apply it to <code>\\b c -&gt; ( (:) b c )</code> where it will take the place of <code>b</code>, then re-apply the wrapper (that's the <code>\\a</code> that appears after the equals sign on the line below):</p>\n\n<pre><code>sequenceA [(+1)] = \\a c -&gt; ( (:) ((+1) a) c ) &lt;*&gt; ( \\a -&gt; const [] a )\n</code></pre>\n\n<p>Notice that <code>(:)</code> is still waiting for an argument <code>c</code>, and <code>(+1)</code> is still waiting for an <code>a</code>. Now, we get to the applicative part.</p>\n\n<p>Remember that: <code>(&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b</code>. Our <code>f</code> here is the function application <code>\\a -&gt;</code>. </p>\n\n<p>Both sides now have the same wrapper, namely <code>\\a -&gt;</code>. <em>I'm keeping the <code>a</code>'s in there to remind us where the <code>a</code>'s will be applied later, so it does become a little pseudo-y here. The function application will be connected back up in just a jiffy</em>. Both functions depend on the same <code>a</code>, precisely because they had the same function application wrapper i.e. an applicative. Without their <code>\\a -&gt;</code> wrappers (thanks to <code>&lt;*&gt;</code>), it goes like this:</p>\n\n<pre><code>( \\c -&gt; ( (:) ((+1) a) c ) ) (const [] a)\n\n= ( (:) ((+1) a) (const [] a) ) -- Ignore those a's, they're placeholders.\n</code></pre>\n\n<p>Now, the very last thing that <code>&lt;*&gt;</code> does is to pop this result back into it's wrapper <code>\\a -&gt;</code>:</p>\n\n<pre><code>sequenceA [(+1)] = \\a -&gt; ( (:) ((+1) a) (const [] a) )\n</code></pre>\n\n<p>Sugaring this up a little bit gives:</p>\n\n<pre><code>sequenceA [(+1)] = \\a -&gt; (+1) a : const [] a\n</code></pre>\n\n<p>See! It makes perfect sense that an argument to <code>sequenceA [(+1)]</code> goes to both <code>(+1)</code> and <code>const</code>. Applying a 2, for instance, gives:</p>\n\n<pre><code>sequenceA [(+1)] 2 = (+1) 2 : const [] 2\n</code></pre>\n\n<p>Remember that <code>const a b :: a -&gt; b -&gt; a</code>, and therefore just ignores it's input:</p>\n\n<pre><code>sequenceA [(+1)] 2 = 3 : []\n</code></pre>\n\n<p>OR, more sweetly:</p>\n\n<pre><code>sequenceA [(+1)] 2 = [3]\n</code></pre>\n"}], "owner": {"reputation": 16438, "user_id": 312896, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/57c5b6cdd1a94aef510d5dce28992494?s=128&d=identicon&r=PG", "display_name": "Yola", "link": "https://stackoverflow.com/users/312896/yola"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1913, "favorite_count": 4, "accepted_answer_id": 34631083, "answer_count": 3, "score": 8, "last_activity_date": 1513750839, "creation_date": 1452070912, "last_edit_date": 1452071582, "question_id": 34629132, "link": "https://stackoverflow.com/questions/34629132/how-sequencea-works", "title": "How `sequenceA` works", "body": "<p>I'm new to Haskell and trying to understand how does this work?</p>\n\n<pre><code>sequenceA [(+3),(+2),(+1)] 3\n</code></pre>\n\n<p>I have started from the definition </p>\n\n<pre><code>sequenceA :: (Applicative f) =&gt; [f a] -&gt; f [a]  \nsequenceA [] = pure []  \nsequenceA (x:xs) = (:) &lt;$&gt; x &lt;*&gt; sequenceA xs\n</code></pre>\n\n<p>And then  unfolded recursion into this</p>\n\n<pre><code>(:) &lt;$&gt; (+3) &lt;*&gt; $ (:) &lt;$&gt; (+2) &lt;*&gt; $ (:) &lt;$&gt; (+1) &lt;*&gt; pure [] \n(:) &lt;$&gt; (+3) &lt;*&gt; $ (:) &lt;$&gt; (+2) &lt;*&gt; $ (:) &lt;$&gt; (+1) &lt;*&gt; []\n</code></pre>\n\n<p>But here i don't understand for which applicative functor operator <code>&lt;*&gt;</code> will be called, for <code>((-&gt;) r)</code> or for <code>[]</code></p>\n\n<pre><code>(:) &lt;$&gt; (+1) &lt;*&gt; []\n</code></pre>\n\n<p>Can somebody go step by step and parse <code>sequenceA [(+3),(+2),(+1)] 3</code> step by step? Thanks.</p>\n"}, {"tags": ["haskell", "pretty-print"], "comments": [{"owner": {"reputation": 416, "user_id": 5729872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oxgSz.jpg?s=128&g=1", "display_name": "Adam Burke", "link": "https://stackoverflow.com/users/5729872/adam-burke"}, "edited": false, "score": 0, "creation_date": 1605766895, "post_id": 34626405, "comment_id": 114753880, "body": "See also <a href=\"https://stackoverflow.com/questions/41095748/how-to-convert-arbitrary-type-to-string-without-adding-extra-quotes-to-strings\" title=\"how to convert arbitrary type to string without adding extra quotes to strings\">stackoverflow.com/questions/41095748/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": true, "score": 3, "last_activity_date": 1452059981, "creation_date": 1452059981, "answer_id": 34626590, "question_id": 34626405, "link": "https://stackoverflow.com/questions/34626405/haskell-how-to-pretty-print-a-string-without-quotes/34626590#34626590", "title": "Haskell: How to pretty print a string without quotes?", "body": "<p>In the last instance you are assuming that <code>Show a</code> and compiler uses only this information to choose appropriate instance for <code>prettyPrint x</code>.</p>\n\n<p>You can add more information by requiring <code>PrettyPrint a</code> as a base class:</p>\n\n<pre><code>instance PrettyPrint a =&gt; PrettyPrint (SomeDataType a) where\n    prettyPrint (SomeDataType x) = prettyPrint x\n</code></pre>\n"}], "owner": {"reputation": 449, "user_id": 878298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d5910505de191043ea9aa614073ae05?s=128&d=identicon&r=PG", "display_name": "Sergey Mitskevich", "link": "https://stackoverflow.com/users/878298/sergey-mitskevich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1980, "favorite_count": 0, "accepted_answer_id": 34626590, "answer_count": 1, "score": 5, "last_activity_date": 1452059981, "creation_date": 1452059021, "question_id": 34626405, "link": "https://stackoverflow.com/questions/34626405/haskell-how-to-pretty-print-a-string-without-quotes", "title": "Haskell: How to pretty print a string without quotes?", "body": "<p>Let's assume I have this data type:</p>\n\n<pre><code>data SomeDataType a = SomeDataType a\n</code></pre>\n\n<p>I want to show its representation to the user (in the console output), so I need a \"pretty print\" function. I don't want to use <code>show</code>, because it will return an expression and I just want the value of my type's only field converted to a string. </p>\n\n<p>I expect this behaviour:</p>\n\n<pre><code>&gt;&gt;&gt; let myintdata = SomeDataType (22::Int)\n&gt;&gt;&gt; putStrLn $ prettyPrint myintdata\n22\n&gt;&gt;&gt; let alice = SomeDataType \"Alice\"\n&gt;&gt;&gt; let bob = SomeDataType \"Bob\"\n&gt;&gt;&gt; putStrLn $ prettyPrint alice ++ \" loves \" ++ prettyPrint bob\nAlice loves Bob\n</code></pre>\n\n<p>So I implement it like this:</p>\n\n<pre><code>prettyPrint :: Show a =&gt; SomeDataType a -&gt; String\nprettyPrint (SomeDataType x) = show x\n</code></pre>\n\n<p>It's working fine for numbers, but strings are getting quoted and escaped:</p>\n\n<pre><code>&gt;&gt;&gt; let alice = SomeDataType \"Alice\"\n&gt;&gt;&gt; let bob = SomeDataType \"Bob\"\n&gt;&gt;&gt; putStrLn $ prettyPrint alice ++ \" loves \" ++ prettyPrint bob\n\"Alice\" loves \"Bob\"\n</code></pre>\n\n<p>Also, I want full control on how different content types are converted to strings in the future. So, I'm off to create my own typeclass! It goes like this:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\ndata SomeDataType a = SomeDataType a\n\nclass PrettyPrint a where\n    prettyPrint :: a -&gt; String\n\ninstance {-# OVERLAPPABLE #-} PrettyPrint a where\n    -- I don't care about this right now,\n    -- let's learn how to print strings without quotes first!\n    prettyPrint = const \"Stupid Robot\" \n\ninstance PrettyPrint String where\n    prettyPrint = id\n\ninstance Show a =&gt; PrettyPrint (SomeDataType a) where\n    prettyPrint (SomeDataType x) = prettyPrint x\n</code></pre>\n\n<p>I'm happy with the first test:</p>\n\n<pre><code>&gt;&gt;&gt; putStrLn $ prettyPrint \"No quotes!\"\nNo quotes!\n</code></pre>\n\n<p>But when I'm trying to pretty print my data type, somehow general instance is being invoked instead of String's:</p>\n\n<pre><code>&gt;&gt;&gt; let alice = SomeDataType \"Alice\"\n&gt;&gt;&gt; let bob = SomeDataType \"Bob\"\n&gt;&gt;&gt; putStrLn $ prettyPrint alice ++ \" loves \" ++ prettyPrint bob\nStupid Robot loves Stupid Robot\n</code></pre>\n\n<p>At this point I suspect there is a completely different way to approach this \"pretty printing\" problem. Is that so? Or am I missing some simple obvious mistake in my code?</p>\n"}, {"tags": ["haskell", "data-structures", "compilation", "monads", "functor"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 4, "creation_date": 1452069861, "post_id": 34626119, "comment_id": 57002975, "body": "&quot;contents&quot; does not necessarily imply a box, it can be a transmission carrying a signal. Not just burritos, rum-soaked cakes are monads too. and holograms."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1452090933, "post_id": 34626119, "comment_id": 57016287, "body": "@WillNess, where do you live and can you teach me to make rum-soaked cakes?"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 8, "last_activity_date": 1452058754, "creation_date": 1452058754, "answer_id": 34626349, "question_id": 34626119, "link": "https://stackoverflow.com/questions/34626119/what-kind-of-data-structure-is-a-monad/34626349#34626349", "title": "What kind of data structure is a monad?", "body": "<p>A monad may or may not be a data structure. To get some data-structural intuition into monads, you should definitely read Dan Piponi's blog post <a href=\"http://blog.sigfpe.com/2010/01/monads-are-trees-with-grafting.html?m=1\">Monads are Trees with Grafting</a>.</p>\n\n<p>The most boring data structural monad is the free monad over a functor,</p>\n\n<pre><code>data Free f a = Pure a\n              | Free (f (Free a))\n\ninstance Functor f =&gt; Monad (Free f) where ...\n</code></pre>\n\n<p>Since you mention lists, you should probably look into the operational monad and perhaps the codensity monad.</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 10, "last_activity_date": 1452075441, "last_edit_date": 1452075441, "creation_date": 1452061578, "answer_id": 34626923, "question_id": 34626119, "link": "https://stackoverflow.com/questions/34626119/what-kind-of-data-structure-is-a-monad/34626923#34626923", "title": "What kind of data structure is a monad?", "body": "<p>Monad is not a data structure \u2014 it's a property.</p>\n\n<p>You can define a class of data types that have some default values (like <code>[]</code> for lists, <code>0</code> for <code>Int</code>, <code>False</code> for <code>Bool</code> and so on). Let's call this class <code>Defaultable</code>. Then you postulate that the default integer is <code>0</code> and thus prove that the type of integers is <code>Defaultable</code>. <code>Bool</code> is <code>Defaultable</code> in the same way.</p>\n\n<p>Another example is the <code>ToStringable</code> class (<code>Show</code> in Haskell): A type is <code>ToStringable</code> if there is a function from it to <code>String</code>. <code>Int</code> and <code>Bool</code> are <code>ToStringable</code>, because you can write functions</p>\n\n<pre><code>intToString  :: Int  -&gt; String\nboolToString :: Bool -&gt; String\n</code></pre>\n\n<p>(and lists of type <code>[a]</code> are meaningfully <code>ToStringable</code> if <code>a</code> is <code>ToStringable</code>)</p>\n\n<p>Likewise, the type of lists is a monad: you can define two operations (that obey certain laws) <code>return</code> and <code>(&gt;&gt;=)</code> and thus prove that the type of lists forms a monad. And that is: if you can define two operations</p>\n\n<pre><code>return :: a -&gt; m a\n(&gt;&gt;=)  :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>for some concrete <code>m</code>, then this <code>m</code> is a monad. So <code>Monad</code> is a class and classes very much remind interfaces in OOP.</p>\n\n<p>Internally it's just <a href=\"https://www.schoolofhaskell.com/user/jfischoff/instances-and-dictionaries\">dictionaries passing</a>.</p>\n"}], "owner": {"reputation": 2512, "user_id": 2325380, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SvFan.jpg?s=128&g=1", "display_name": "Mark Karavan", "link": "https://stackoverflow.com/users/2325380/mark-karavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1452075441, "creation_date": 1452057574, "last_edit_date": 1452057915, "question_id": 34626119, "link": "https://stackoverflow.com/questions/34626119/what-kind-of-data-structure-is-a-monad", "title": "What kind of data structure is a monad?", "body": "<p>I have a half-competent understanding of what a monad is (a parameterized type that provides a context for useful computation building), why it exists (so you can do things that require context, like IO), how to use it (bind returned variables with <code>&gt;&gt;=</code>), and a very rough understanding of where it fits in in category theory (a category that guarantees homogeneity of contexts of functions)**.</p>\n\n<p>What, however, is a monad in terms of the underlying data structure?  Since it is related to an applicative functor (which seems like a list), my guess is that GHC takes the monad's contents and puts them into a linked list of some sort, and passes them around throughout the computation.</p>\n\n<p>What is really going on underneath the hood?</p>\n\n<p>** feel free to correct any of this if you know better. </p>\n"}, {"tags": ["database", "haskell", "yesod", "persistent"], "comments": [{"owner": {"reputation": 197, "user_id": 2994769, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NrJZ6.jpg?s=128&g=1", "display_name": "hhefesto", "link": "https://stackoverflow.com/users/2994769/hhefesto"}, "edited": false, "score": 1, "creation_date": 1452046133, "post_id": 34624469, "comment_id": 56994830, "body": "My first thoughts are on reducing <code>runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do     flip runSqlPersistMPool pool $ do         runMigration migrateAll</code>  to a function, and calling it in each instance, but I don&#39;t really understand it very well, and failed to do such function."}], "answers": [{"comments": [{"owner": {"reputation": 2815, "user_id": 4394797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92f29f3a02e559366d897f287948c6ca?s=128&d=identicon&r=PG&f=1", "display_name": "cgold", "link": "https://stackoverflow.com/users/4394797/cgold"}, "edited": false, "score": 0, "creation_date": 1505674253, "post_id": 34625061, "comment_id": 79497942, "body": "Wonderful! I had spent a long time trying to factor out that code, without succeeding, before seeing this!"}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 5, "last_activity_date": 1452050275, "creation_date": 1452050275, "answer_id": 34625061, "question_id": 34624469, "link": "https://stackoverflow.com/questions/34624469/crud-pattern-on-haskell-persistent/34625061#34625061", "title": "CRUD pattern on Haskell Persistent", "body": "<p>First, recognize what it is that you're repeating. Here it's </p>\n\n<pre><code>runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n  flip runSqlPersistMPool pool $ do\n    runMigration migrateAll\n    &lt;some-action&gt;\n</code></pre>\n\n<p>The solution is just to abstract that out, creating a function that lets you specify <code>some-action</code>:</p>\n\n<pre><code>inBackend :: ReaderT SqlBackend (NoLoggingT (ResourceT IO)) a-&gt; IO a\ninBackend action = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n  flip runSqlPersistMPool pool $ do\n    runMigration migrateAll\n    action\n</code></pre>\n\n<p>Then your CRUD code becomes much cleaner and DRYer:</p>\n\n<pre><code>--User CRUD\nget_user :: Int64 -&gt; IO (Maybe User)\nget_user = inBackend . get . toUserId\n\nnew_user :: User -&gt; IO ()\nnew_user (User email pass alias image_url show_email _) = inBackend $ do\n  now &lt;- liftIO getCurrentTime\n  usrid &lt;- insert $ User email pass alias image_url show_email now\n  usr &lt;- get usrid\n  liftIO $ print usr\n\nupdate_user :: String -&gt; User -&gt; IO()\nupdate_user em user = inBackend $ do\n  Just (Entity userId _) &lt;- getBy $ UniqueEmail em\n  replace userId user\n\ndelete_user :: Int64 -&gt; IO ()\ndelete_user = inBackend . delete . toUserId\n\n--Post CRUD\nget_post :: Int64 -&gt; IO(Maybe Post)\nget_post = inBackend . get . toPostId\n\nnew_post :: Post -&gt; IO ()\nnew_post (Post atom material processing params image_url reference owner material_url _) = inBackend $ do\n  now &lt;- liftIO getCurrentTime\n  postId &lt;- insert $ Post atom material processing params image_url reference owner material_url now\n  post &lt;- get postId\n  liftIO $ print post\n\nupdate_post :: Int64 -&gt; Post -&gt; IO()\nupdate_post id post = inBackend $ replace (toPostId id) post\n\ndelete_post :: Int64 -&gt; IO ()\ndelete_post = inBackend . delete . toPostId\n\n-- Comments CRUD\nget_comment :: Int64 -&gt; IO(Maybe Comment)\nget_comment = inBackend . get . toCommentId\n\nnew_comment :: Comment -&gt; IO ()\nnew_comment (Comment owner post _ text) = inBackend $ do\n  now &lt;- liftIO getCurrentTime\n  commentId &lt;- insert $ Comment owner post now text\n  comment &lt;- get commentId\n  liftIO $ print comment\n\nupdate_comment :: Int64 -&gt; Comment -&gt; IO()\nupdate_comment id comment = inBackend $ replace (toCommentId id) comment\n\ndelete_comment :: Int64 -&gt; IO ()\ndelete_comment = inBackend . delete . toCommentId\n</code></pre>\n\n<p>For completeness:</p>\n\n<pre><code>{-# LANGUAGE EmptyDataDecls             #-}\n{-# LANGUAGE FlexibleContexts           #-}\n{-# LANGUAGE GADTs                      #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE OverloadedStrings          #-}\n{-# LANGUAGE QuasiQuotes                #-}\n{-# LANGUAGE TemplateHaskell            #-}\n{-# LANGUAGE TypeFamilies               #-}\n\nmodule Model where\n\nimport Control.Monad.IO.Class  (liftIO)\nimport Control.Monad.Logger    (runStderrLoggingT, NoLoggingT)\nimport Control.Monad.Trans.Reader (ReaderT)\nimport Control.Monad.Trans.Resource (ResourceT)\nimport Database.Persist\nimport Database.Persist.Postgresql\nimport Database.Persist.TH\nimport Data.Time\nimport Data.Int\n\nshare [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nUser\n    email String\n    password String\n    alias String\n    image_url String\n    show_email Bool\n    UniqueEmail email\n    date UTCTime default=CURRENT_TIMESTAMP\n    deriving Show\nPost\n    atom Int\n    material String\n    processing String\n    params String\n    image_url String\n    reference String\n    owner UserId\n    material_url String\n    date UTCTime default=CURRENT_TIMESTAMP\n    deriving Show\nComment\n    owner UserId\n    post PostId\n    date UTCTime default=CURRENT_TIMESTAMP\n    text String\n    deriving Show\n|]\n\nconnStr = \"host=localhost dbname=communis-db user=communis password=facilderecordar789 port=5432\"\n\n-- this is the repeated code that can be factored out\ninBackend :: ReaderT SqlBackend (NoLoggingT (ResourceT IO)) a-&gt; IO a\ninBackend action = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n  flip runSqlPersistMPool pool $ do\n    runMigration migrateAll\n    action\n\n-- I prefer this to (toSqlKey :: ...), but YMMV\ntoUserId :: Int64 -&gt; UserId\ntoUserId = toSqlKey\n\ntoPostId :: Int64 -&gt; PostId\ntoPostId = toSqlKey\n\ntoCommentId :: Int64 -&gt; CommentId\ntoCommentId = toSqlKey\n\n--User CRUD\nget_user :: Int64 -&gt; IO (Maybe User)\nget_user = inBackend . get . toUserId\n\nnew_user :: User -&gt; IO ()\nnew_user (User email pass alias image_url show_email _) = inBackend $ do\n  now &lt;- liftIO getCurrentTime\n  usrid &lt;- insert $ User email pass alias image_url show_email now\n  usr &lt;- get usrid\n  liftIO $ print usr\n\nupdate_user :: String -&gt; User -&gt; IO()\nupdate_user em user = inBackend $ do\n  Just (Entity userId _) &lt;- getBy $ UniqueEmail em\n  replace userId user\n\ndelete_user :: Int64 -&gt; IO ()\ndelete_user = inBackend . delete . toUserId\n\n--Post CRUD\nget_post :: Int64 -&gt; IO(Maybe Post)\nget_post = inBackend . get . toPostId\n\nnew_post :: Post -&gt; IO ()\nnew_post (Post atom material processing params image_url reference owner material_url _) = inBackend $ do\n  now &lt;- liftIO getCurrentTime\n  postId &lt;- insert $ Post atom material processing params image_url reference owner material_url now\n  post &lt;- get postId\n  liftIO $ print post\n\nupdate_post :: Int64 -&gt; Post -&gt; IO()\nupdate_post id post = inBackend $ replace (toPostId id) post\n\ndelete_post :: Int64 -&gt; IO ()\ndelete_post = inBackend . delete . toPostId\n\n-- Comments CRUD\nget_comment :: Int64 -&gt; IO(Maybe Comment)\nget_comment = inBackend . get . toCommentId\n\nnew_comment :: Comment -&gt; IO ()\nnew_comment (Comment owner post _ text) = inBackend $ do\n  now &lt;- liftIO getCurrentTime\n  commentId &lt;- insert $ Comment owner post now text\n  comment &lt;- get commentId\n  liftIO $ print comment\n\nupdate_comment :: Int64 -&gt; Comment -&gt; IO()\nupdate_comment id comment = inBackend $ replace (toCommentId id) comment\n\ndelete_comment :: Int64 -&gt; IO ()\ndelete_comment = inBackend . delete . toCommentId\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5146195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SMtpiIUi3bo/AAAAAAAAAAI/AAAAAAAAABM/GQ4TOh42mRo/photo.jpg?sz=128", "display_name": "Kunle Arewa", "link": "https://stackoverflow.com/users/5146195/kunle-arewa"}, "is_accepted": false, "score": 0, "last_activity_date": 1538587585, "last_edit_date": 1538587585, "creation_date": 1538586399, "answer_id": 52632264, "question_id": 34624469, "link": "https://stackoverflow.com/questions/34624469/crud-pattern-on-haskell-persistent/52632264#52632264", "title": "CRUD pattern on Haskell Persistent", "body": "<p>I would prefer a situation where the transactions are separated from running them.</p>\n\n<pre><code>import           Control.Monad.IO.Class (MonadIO, liftIO)\nimport           Control.Monad.Logger (NoLoggingT, runNoLoggingT, runStderrLoggingT)\nimport           Control.Monad.Trans.Reader (ReaderT)\nimport           Control.Monad.Trans.Resource (ResourceT)\nimport           Data.Int (Int64)\nimport           Database.Persist (ToBackendKey)\nimport           Database.Persist.Postgresql (ConnectionString, Key, SqlBackend)\nimport qualified Database.Persist.Postgresql as Psql\nimport qualified Database.Persist.Sql as Sql\nimport           Database.PostgreSQL.Simple (SqlError)\n\ntype Mod m a = ReaderT SqlBackend m a\n\nfromInt :: ToBackendKey SqlBackend record =&gt; Int64 -&gt; Key record\nfromInt = Sql.toSqlKey\n\ntoInt :: ToBackendKey SqlBackend record =&gt; Key record -&gt; Int64\ntoInt = Sql.fromSqlKey\n\nwithPostgres :: ReaderT SqlBackend (NoLoggingT (ResourceT IO)) a -&gt; IO a\nwithPostgres =\n  runNoLoggingT . Psql.withPostgresqlPool conn 10 . Psql.liftSqlPersistMPool\n\nconn = \"host=localhost dbname=communis-db user=communis password=facilderecordar789 port=5432\"\n\ngetUser :: MonadIO m =&gt; Int64 -&gt; Mod m (Maybe User)\ngetUser = get . fromInt\n\nnewUser :: MonadIO m =&gt; User -&gt; Mod m Int64\nnewUser (User email pass alias image_url show_email _) = do\n  now &lt;- liftIO getCurrentTime\n  userId &lt;- insert $ User email pass alias image_url show_email now\n  return $ toInt userId\n\nupdateUser :: MonadIO m =&gt; String -&gt; User -&gt; Mod m ()\nupdateUser em user = inBackend $ do\n  Just (Entity userId _) &lt;- getBy $ UniqueEmail em\n  replace userId user\n\ndeleteUser :: MonadIO m =&gt; Int64 -&gt; Mod m ()\ndeleteUser = delete . fromInt\n\n\ngetPost :: MonadIO m =&gt; Int64 -&gt; Mod m (Maybe Post)\ngetPost = get . fromInt\n\nnewPost :: MonadIO m =&gt; Post -&gt; Mod m Int64\nnewPost (Post atom material processing params image_url reference owner material_url _) = do\n  now &lt;- liftIO getCurrentTime\n  postId &lt;- insert $ Post atom material processing params image_url reference owner material_url now\n  toInt postId\n\nupdatePost :: MonadIO m =&gt; Int64 -&gt; Post -&gt; Mod m ()\nupdatePost id post = replace (fromInt id) post\n\ndeletePost :: Int64 -&gt; IO ()\ndeletePost = delete . fromInt\n\n-- and so on\n</code></pre>\n\n<p>This allows you to do decide when to run migration, or combine any of these operations in one transaction i.e.</p>\n\n<pre><code>withPostgresDebug :: ReaderT SqlBackend (NoLoggingT (ResourceT IO)) a -&gt; IO a\nwithPostgresDebug =\n  runStderrLoggingT . Psql.withPostgresqlPool conn pools . Psql.liftSqlPersistMPool . (migrationAction &gt;&gt;)\n  where migrationAction = runMigration migrateAll\n-- then run you transaction\nwithPostgresDebug $ do\n    Just user &lt;- getUser 1\n    let user' = user { userEmail = \"makenoise@example.com\" }\n    newUserId &lt;- insertUser user'\n    liftIO $ print newUserId\n</code></pre>\n"}], "owner": {"reputation": 197, "user_id": 2994769, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NrJZ6.jpg?s=128&g=1", "display_name": "hhefesto", "link": "https://stackoverflow.com/users/2994769/hhefesto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 924, "favorite_count": 0, "accepted_answer_id": 34625061, "answer_count": 2, "score": 3, "last_activity_date": 1538587585, "creation_date": 1452045665, "question_id": 34624469, "link": "https://stackoverflow.com/questions/34624469/crud-pattern-on-haskell-persistent", "title": "CRUD pattern on Haskell Persistent", "body": "<p>This is the second time I am trying to learn Haskell, and one of the things that I keep hearing is not to repeat myself (that's actually also true for other languages).</p>\n\n<p>Anyway... I am trying to implement a blog and found the need to implement CRUD operations on a database, but when I implemented CRUD for Comments, Posts and Users, it seemed to me that I was just repeating myself.</p>\n\n<p>The problem is that I can't see how not to repeat myself.</p>\n\n<pre><code>{-# LANGUAGE EmptyDataDecls             #-}\n{-# LANGUAGE FlexibleContexts           #-}\n{-# LANGUAGE GADTs                      #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE OverloadedStrings          #-}\n{-# LANGUAGE QuasiQuotes                #-}\n{-# LANGUAGE TemplateHaskell            #-}\n{-# LANGUAGE TypeFamilies               #-}\n\nmodule Model where\n\nimport Control.Monad.IO.Class  (liftIO)\nimport Control.Monad.Logger    (runStderrLoggingT)\nimport Database.Persist\nimport Database.Persist.Postgresql\nimport Database.Persist.TH\nimport Data.Time\nimport Data.Int\n\nshare [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nUsers\n    email String\n    password String\n    alias String\n    image_url String\n    show_email Bool\n    UniqueEmail email\n    date UTCTime default=CURRENT_TIMESTAMP\n    deriving Show\nPost\n    atom Int\n    material String\n    processing String\n    params String\n    image_url String\n    reference String\n    owner UsersId\n    material_url String\n    date UTCTime default=CURRENT_TIMESTAMP\n    deriving Show\nComment\n    owner UsersId\n    post PostId\n    date UTCTime default=CURRENT_TIMESTAMP\n    text String\n    deriving Show\n|]\n\nconnStr = \"host=localhost dbname=communis-db user=communis password=facilderecordar789 port=5432\"\n\n--User CRUD\nget_user :: Int64 -&gt; IO(Maybe Users)\nget_user i = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n        get (toSqlKey i :: UsersId)\n\nnew_user :: Users -&gt; IO ()\nnew_user(Users email pass alias image_url show_email _) = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n        now &lt;- liftIO getCurrentTime\n        usrid &lt;- insert $ Users email pass alias image_url show_email now\n        usr &lt;- get usrid\n        liftIO $ print usr\n\nupdate_user :: String -&gt; Users -&gt; IO()\nupdate_user em u = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n        usr &lt;- getBy $ UniqueEmail em\n        case usr of\n          Just (Entity userId user) -&gt; replace userId user\n\ndelete_user :: Int64 -&gt; IO ()\ndelete_user i = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n        delete (toSqlKey i :: UsersId)\n\n--Post CRUD\nget_post :: Int64 -&gt; IO(Maybe Post)\nget_post i = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n        get (toSqlKey i :: PostId)\n\nnew_post :: Post -&gt; IO ()\nnew_post (Post atom material processing params image_url reference owner material_url _) = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n        now &lt;- liftIO getCurrentTime\n        postId &lt;- insert $ Post atom material processing params image_url reference owner material_url now\n        post &lt;- get postId\n        liftIO $ print post\n\nupdate_post :: Int64 -&gt; Post -&gt; IO()\nupdate_post id post = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n        replace (toSqlKey id) post\n\ndelete_post :: Int64 -&gt; IO ()\ndelete_post i = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n        delete (toSqlKey i :: PostId)\n\n-- Comments CRUD\nget_comment :: Int64 -&gt; IO(Maybe Comment)\nget_comment i = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n        get (toSqlKey i :: CommentId)\n\nnew_comment :: Comment -&gt; IO ()\nnew_comment (Comment owner post _ text) = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n        now &lt;- liftIO getCurrentTime\n        commentId &lt;- insert $ Comment owner post now text\n        comment &lt;- get commentId\n        liftIO $ print comment\n\nupdate_comment :: Int64 -&gt; Comment -&gt; IO()\nupdate_comment id comment = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n        replace (toSqlKey id) comment\n\ndelete_comment :: Int64 -&gt; IO ()\ndelete_comment i = runStderrLoggingT $ withPostgresqlPool connStr 10 $ \\pool -&gt; liftIO $ do\n    flip runSqlPersistMPool pool $ do\n        runMigration migrateAll\n        delete (toSqlKey i :: CommentId)\n</code></pre>\n\n<p>p.s. Stack rules.</p>\n"}, {"tags": ["haskell", "coding-style"], "comments": [{"owner": {"reputation": 403, "user_id": 3187369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ld5fs.gif?s=128&g=1", "display_name": "Akaberto", "link": "https://stackoverflow.com/users/3187369/akaberto"}, "edited": false, "score": 0, "creation_date": 1452054823, "post_id": 34624465, "comment_id": 56997106, "body": "A bit more detail will be more helpful.  However, I think two different value constructor having a very similar structure might let you merge them into one."}, {"owner": {"reputation": 2227, "user_id": 3942186, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/OnOyW.jpg?s=128&g=1", "display_name": "Emna Ayadi", "link": "https://stackoverflow.com/users/3942186/emna-ayadi"}, "edited": false, "score": 0, "creation_date": 1460720083, "post_id": 34624465, "comment_id": 60885292, "body": "you should give more details !"}, {"owner": {"reputation": 327, "user_id": 3705854, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/5c43b9964018d1f3e2f65c35ab0b0c54?s=128&d=identicon&r=PG&f=1", "display_name": "JKS", "link": "https://stackoverflow.com/users/3705854/jks"}, "edited": false, "score": 0, "creation_date": 1460722060, "post_id": 34624465, "comment_id": 60886694, "body": "What&#39;s unclear about that question? Two blocks that look the same but different name of type."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 4, "last_activity_date": 1452058552, "creation_date": 1452058552, "answer_id": 34626307, "question_id": 34624465, "link": "https://stackoverflow.com/questions/34624465/haskell-similar-types-copy-paste-elimination-in-case/34626307#34626307", "title": "Haskell similar types copy-paste elimination in case", "body": "<p>You could just make a local definition which is a function of <code>expr</code> and <code>stmt</code>:</p>\n\n<pre><code>-- I assume this is all inside a 'do' block\nlet conditionalLike expr stmt = do\n        checkExprType expr Bool\n        processStmt env stmt\n        return env\ncase x of\n    Cond expr stmt -&gt; conditionalLike expr stmt\n    AnotherCond expr stmt -&gt; conditionalLike expr stmt\n</code></pre>\n"}], "owner": {"reputation": 327, "user_id": 3705854, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/5c43b9964018d1f3e2f65c35ab0b0c54?s=128&d=identicon&r=PG&f=1", "display_name": "JKS", "link": "https://stackoverflow.com/users/3705854/jks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 34626307, "answer_count": 1, "score": -3, "last_activity_date": 1452131104, "creation_date": 1452045656, "last_edit_date": 1452131104, "question_id": 34624465, "link": "https://stackoverflow.com/questions/34624465/haskell-similar-types-copy-paste-elimination-in-case", "title": "Haskell similar types copy-paste elimination in case", "body": "<pre><code>case x of \n  Cond expr stmt -&gt; do\n        checkExprType expr Bool\n        processStmt env stmt\n        return env\n  AnotherCond expr stmt -&gt; do\n        checkExprType expr Bool\n        processStmt env stmt\n        return env\n</code></pre>\n\n<p>How can this copy-paste be eliminated?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 2, "creation_date": 1452047205, "post_id": 34624402, "comment_id": 56995088, "body": "Can&#39;t reproduce this error with your code, but there is another error: <a href=\"http://rextester.com/MRV79991\" rel=\"nofollow noreferrer\">rextester.com/MRV79991</a>"}], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 3676951, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000140066986/picture?type=large", "display_name": "user3676951", "link": "https://stackoverflow.com/users/3676951/user3676951"}, "is_accepted": true, "score": 1, "last_activity_date": 1454084923, "creation_date": 1454084923, "answer_id": 35089355, "question_id": 34624402, "link": "https://stackoverflow.com/questions/34624402/parse-error-in-let-binding-missing-required-in/35089355#35089355", "title": "parse error in let binding: missing required &#39;in&#39;", "body": "<p>I already discovered the answer since the <code>let</code> and <code>in</code> statement must be lined up by the same TAB column on the code, SPACE lining is not enough.</p>\n"}], "owner": {"reputation": 41, "user_id": 3676951, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000140066986/picture?type=large", "display_name": "user3676951", "link": "https://stackoverflow.com/users/3676951/user3676951"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 516, "favorite_count": 0, "accepted_answer_id": 35089355, "answer_count": 1, "score": -2, "last_activity_date": 1454084923, "creation_date": 1452045194, "question_id": 34624402, "link": "https://stackoverflow.com/questions/34624402/parse-error-in-let-binding-missing-required-in", "title": "parse error in let binding: missing required &#39;in&#39;", "body": "<p>I was solving a problem where is needed to split a full binary tree into a matching duble of binary tree and leaf tree, like:</p>\n\n<pre><code>splitFTree :: (FTree a b)  -&gt; (BTree a, LTree b)\n</code></pre>\n\n<p>where </p>\n\n<pre><code>data FTree a b = Leaf b | No a (FTree a b) (FTree a b)\ndata BTree a = Empty | Node a (BTree a) (BTree a)\ndata LTree a = Tip a | Fork (LTree a) (LTree a)\n</code></pre>\n\n<p>And my solution to this was the next code:</p>\n\n<pre><code>splitFTree :: (FTree a b)  -&gt; (BTree a, LTree b)\nsplitFTree (Leaf a) = ( Node a Empty Empty , Tip a )\nsplitFTree (No a e d) = let (b1,l1) = splitFTree e\n                            (b2,l2) = splitFTree d \n                        in  (Node a b1 b2 , Fork l1 l2) \n</code></pre>\n\n<p>While compiling with GHCI i get the following error, that I do not know how where i got wrong:</p>\n\n<pre><code>solucaoficha9.hs:89:25:\nparse error in let binding: missing required 'in'\n</code></pre>\n\n<p>Can someone help me about this?</p>\n"}, {"tags": ["haskell", "opengl", "glfw", "frame-rate", "vsync"], "comments": [{"owner": {"reputation": 18146, "user_id": 646619, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/bd61a0f309ebc135d2661710c2faf379?s=128&d=identicon&r=PG", "display_name": "Colonel Thirty Two", "link": "https://stackoverflow.com/users/646619/colonel-thirty-two"}, "edited": false, "score": 0, "creation_date": 1452055638, "post_id": 34624376, "comment_id": 56997333, "body": "Most graphics drivers have configurations to either always enable vsync, completely disable vsync, or enable vsync if the application requests it. That&#39;s likely what &quot;in the system&quot; means."}, {"owner": {"reputation": 39713, "user_id": 2423205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EX7y2.png?s=128&g=1", "display_name": "Andon M. Coleman", "link": "https://stackoverflow.com/users/2423205/andon-m-coleman"}, "edited": false, "score": 0, "creation_date": 1452107746, "post_id": 34624376, "comment_id": 57027442, "body": "That&#39;s really not how you want to implement some sort of VSYNC system of your own. D3D&#39;s a lot more sophisticated here, and you can use event-based timing to wait for the VBLANK signal from the driver even if VSYNC is disabled. Various vendor extensions to do this in GL may exist, though I&#39;ve never even bothered. Unless you&#39;re doing something rather exotic that needs low input latency + VSYNC, simply using a non-zero swap interval is usually adequate."}, {"owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "edited": false, "score": 0, "creation_date": 1452199016, "post_id": 34624376, "comment_id": 57074886, "body": "Thank you both, that answers one question. But what about a manually controlled FPS rate? Could I asynchronously swap the context buffers? What would be a good method to controlling this?"}, {"owner": {"reputation": 19889, "user_id": 906839, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5bce6d276ec5c9b7b97804d0add55084?s=128&d=identicon&r=PG", "display_name": "Brett Hale", "link": "https://stackoverflow.com/users/906839/brett-hale"}, "edited": false, "score": 0, "creation_date": 1452237121, "post_id": 34624376, "comment_id": 57088010, "body": "You might find the documentation for <a href=\"http://www.glfw.org/docs/latest/group__context.html\" rel=\"nofollow noreferrer\">glfwSwapInterval</a> useful."}], "answers": [{"tags": [], "owner": {"reputation": 111, "user_id": 5775500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b51929ee4bffd3be650835e5cd111fd7?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Bexelius", "link": "https://stackoverflow.com/users/5775500/tobias-bexelius"}, "is_accepted": true, "score": 1, "last_activity_date": 1452545205, "creation_date": 1452545205, "answer_id": 34730758, "question_id": 34624376, "link": "https://stackoverflow.com/questions/34624376/gpipe-vsync-fps/34730758#34730758", "title": "GPipe VSync &amp; FPS", "body": "<p>Setting the swap interval is specific for the window manager in OpenGl. In the case of GLFW, you need to call <a href=\"http://www.glfw.org/docs/latest/group__context.html\" rel=\"nofollow\">glfwSwapInterval</a>. Unfortunately, you cannot do it yourself in GPipe since the thread your ContextT is running on doesn't have the GL context current. This should really be implemented in GPipe-GLFW's context creation instead, i.e. inside <a href=\"https://hackage.haskell.org/package/GPipe-GLFW-1.2.1/docs/src/Graphics-GPipe-Context-GLFW.html#newContext%27\" rel=\"nofollow\">newContext'</a>.</p>\n\n<p>And no, you cannot asynchronously swap the buffers in GPipe (but you wouldn't want to do that even if it was possible).</p>\n"}], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 34730758, "answer_count": 1, "score": 0, "last_activity_date": 1452545205, "creation_date": 1452044907, "question_id": 34624376, "link": "https://stackoverflow.com/questions/34624376/gpipe-vsync-fps", "title": "GPipe VSync &amp; FPS", "body": "<p>I'm starting to learn the <a href=\"https://hackage.haskell.org/package/GPipe\" rel=\"nofollow\">GPipe library</a>, and was wondering how someone could accomplish vsync and FPS control with it. Initially, I was thinking a separate thread could block every <code>1 * 1000000 / FPS</code> microseconds and run <code>swapContextBuffers</code>, but that would mean the separate thread would need to <em>build</em> its own <code>ContextT</code>, and thus it's own window.</p>\n\n<p>The <a href=\"https://hackage.haskell.org/package/GPipe-2.1.5/docs/Graphics-GPipe-Context.html#v:swapContextBuffers\" rel=\"nofollow\">docs on the function itself</a> mentions briefly that it could block if VSync is enabled <em>in the system</em> - what does this mean? How would I enable it?</p>\n"}, {"tags": ["haskell", "either"], "comments": [{"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 3, "creation_date": 1452041876, "post_id": 34623871, "comment_id": 56993541, "body": "Why do you need this? If your code uses <code>fromRight</code> because it expects a <code>Right</code> value, then maybe it shouldn&#39;t deal with <code>Either</code> in the first place. I.e. callers of <code>fromRight</code> would have to first check whether it&#39;s <code>Right</code> value. After having seen that other question you linked to, something like <code>case parseCVS contents of Left error -&gt; print error; Right data -&gt; handle data</code>."}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1452052793, "post_id": 34623871, "comment_id": 56996513, "body": "@FrerichRaabe 1) I need this to avoid writing the <code>case</code> statement you wrote every time. I need to extract the return from another function that contains error info. The errors are rare and only happens when the input is invalid. 2) I don&#39;t want to use heavy stuff like Monads. The from here is ideal in that it&#39;s one function wrapper/one word longer. More succinct to use than the other options."}, {"owner": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "edited": false, "score": 0, "creation_date": 1452060072, "post_id": 34623871, "comment_id": 56998807, "body": "The Either Monad usually helps to do computation without resorting to numerous case/if statement. Using the <code>fromRight</code> pattern inside a function makes it difficult to know that this particular function may fail and difficult to handle the failure, even it the failure rarely occurs."}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 1657, "user_id": 4183787, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XedpJ.png?s=128&g=1", "display_name": "zigazou", "link": "https://stackoverflow.com/users/4183787/zigazou"}, "edited": false, "score": 0, "creation_date": 1452061011, "post_id": 34623871, "comment_id": 56999141, "body": "@zigazou I am aware of the <code>Either&#47;Maybe</code> monad. The same can be said about <code>fromJust</code>. All depends on the use case. Whether you want go bullet-proof with dependent types or allow yourself occasional use of things like <code>head</code> and <code>fromJust</code> or <code>fromEither</code> here, it depends on the cost benefit ratio."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1452069826, "post_id": 34623871, "comment_id": 57002953, "body": "As it happens, something like <code>head</code> or <code>fromJust</code> or <code>fromEither</code> not only tend to be a code smell for correctness reasons (it means you&#39;re dealing with partial functions, something which is frowned upon by many Haskellers), there&#39;s also often a much simpler way to solve the problem. Maybe it would be worthwhile to post another question where you outline why/where you need to write the <code>case</code> expression multiple times with some sample code."}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1452098697, "post_id": 34623871, "comment_id": 57021691, "body": "@FrerichRaabe I don&#39;t think it has much to do with <code>correctness reasons</code>. Partial functions are still correct. You get the correct answer when there is one and none when no. The solution I get from here and the linked post is simple enough. I doubt that there is <code>a much simpler way</code> and certainly don&#39;t think there is much point to post another question. Regarding the <code>case</code> expression you mention, I need to use something like fromRight in multiple occasions, each time a single call. I don&#39;t want to expand it into <code>case</code> as you suggested. Hence this question."}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 0, "creation_date": 1452098735, "post_id": 34623871, "comment_id": 57021710, "body": "On the other hand, if it&#39;s a string of <code>fromEither</code> or <code>fromJust</code>, I agree with you that using a Monad is probably better."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1452623654, "post_id": 34623871, "comment_id": 57248392, "body": "@tinlyx Partial functions <i>do</i> have a lot to do with correctness since a compiler won&#39;t tell you if you are using the function incorrectly. You only notice it at runtime (and only if you have proper tests to actually exercise that condition). It&#39;s must better to express the possibility of failure via types, because then your compile will tell you if you neglected to consider that possibility. <i>That</i> is why partial functions like <code>head</code> or <code>fromJust</code> or <code>fromEither</code> are a code smell."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1452042820, "last_edit_date": 1452042820, "creation_date": 1452041586, "answer_id": 34623922, "question_id": 34623871, "link": "https://stackoverflow.com/questions/34623871/how-to-extract-a-eithers-right-and-keep-information-about-its-left-in-case-of-e/34623922#34623922", "title": "How to extract a Either&#39;s Right and keep information about its Left in case of error in Haskell?", "body": "<p>Instead of using <code>const ...</code> in the first argument of <code>either</code>, use something else.</p>\n\n<pre><code>either oops .... where\n  oops x = error $ \"Oops! Got an \" ++ show x\n</code></pre>\n\n<p>Or whatever.</p>\n\n<hr>\n\n<p>Note, however, that <code>error</code> should only be used for <em>internal</em> errors. User errors, connectivity errors, etc., should be allowed to bubble out to <code>IO</code> and then reported with <code>throwIO</code> or handled gracefully. </p>\n"}, {"tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": false, "score": 4, "last_activity_date": 1452041615, "creation_date": 1452041615, "answer_id": 34623927, "question_id": 34623871, "link": "https://stackoverflow.com/questions/34623871/how-to-extract-a-eithers-right-and-keep-information-about-its-left-in-case-of-e/34623927#34623927", "title": "How to extract a Either&#39;s Right and keep information about its Left in case of error in Haskell?", "body": "<p>Instead of</p>\n\n<pre><code>const $ error \"Left encountered\"\n</code></pre>\n\n<p>you can use a lambda to get the value and use it, e.g.</p>\n\n<pre><code>\\v -&gt; error $ \"Left encountered: \" ++ v\n</code></pre>\n"}], "owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 522, "favorite_count": 0, "accepted_answer_id": 34623922, "answer_count": 2, "score": 0, "last_activity_date": 1452055777, "creation_date": 1452041265, "last_edit_date": 1495539994, "question_id": 34623871, "link": "https://stackoverflow.com/questions/34623871/how-to-extract-a-eithers-right-and-keep-information-about-its-left-in-case-of-e", "title": "How to extract a Either&#39;s Right and keep information about its Left in case of error in Haskell?", "body": "<p>I am trying to extract the value in the <code>Right</code> constructor of a <code>Either</code> value, while giving an error if the <code>Either</code> in question is actually a <code>Left</code> (i.e. an error). The answers in <a href=\"https://stackoverflow.com/questions/19839042/either-right-left-how-to-read-value\">Either Right Left how to read value</a> gives me something like:</p>\n\n<pre><code>fromRight e = either (const $ error \"Either Left encountered while expecting Right\") id e\n</code></pre>\n\n<p>This works but discards useful information in the error message of the <code>Left</code> ctor of <code>Either</code>. How can I post an error message about the <code>Left</code> instead?</p>\n\n<p>-- EDIT --</p>\n\n<p>Thanks for the input. I wanted this as a more informational version of <code>fromJust</code>.</p>\n\n<p>Also, I'd like to avoid writing a <code>case</code> statement every time, and want to avoid Monads whenever it's not too complicated (to keep the function \"eval\" style). For my use case, it's computation-oriented, and errors occur only when something like invalid input was supplied (when there is no remedy).</p>\n\n<p>I ended up using:</p>\n\n<pre><code>fromRight e = either (error.show) id e\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "functional-programming"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1452040267, "post_id": 34623658, "comment_id": 56993052, "body": "<code>reverse&#39;</code> doesn&#39;t mean &quot;reverse the tail elements&quot;. <code>reverse&#39; xs</code> means &quot;reverse the tail elements&quot;, because <code>xs</code> is the tail elements and <code>reverse&#39;</code> means to reverse."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 1, "creation_date": 1452043000, "post_id": 34623658, "comment_id": 56993874, "body": "Note that in the recursive case, the functions <code>maximum&#39;</code> and <code>reverse&#39;</code> are called on the <i>tail</i> (i.e. anything but the first element) of the given list, e.g. <code>maximum&#39; [1,2,3]</code> is applied recursively on the list <code>[2,3]</code>. The idea being that the maximum of a list of integers is the larger value of 1. the first list element and 2. the maximum of the rest of the list. When pattern matching on a list via <code>(x:xs)</code>, the <code>x</code> is the first list element and <code>xs</code> is the rest (the &quot;tail&quot;)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1452048283, "post_id": 34623658, "comment_id": 56995362, "body": "&quot;how does it know that reverse&#39; means reverse the tails elements.&quot; it doesn&#39;t; but you can prove it by induction. Start with <code>[]</code> and <code>[a]</code> cases; then check out <code>[a,b]</code>, ...., then assume that it holds for the general <code>[a,b,...,n]</code> case and prove that it follows that the next case, <code>[a,b,...,n,m]</code>, is getting reversed too."}, {"owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "edited": false, "score": 0, "creation_date": 1452209916, "post_id": 34623658, "comment_id": 57080103, "body": "FYI: You can take a tour here: <a href=\"https://stackoverflow.com/tour\">tour</a> and get a quick overview of the site and all the functions/features."}], "answers": [{"comments": [{"owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1452043716, "post_id": 34623765, "comment_id": 56994090, "body": "@luqui Thanks :), I tried my best so it&#39;s easy to follow and easy to understand."}, {"owner": {"reputation": 155, "user_id": 5750005, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/075e7f5530ccf969ca746ece6c42e824?s=128&d=identicon&r=PG&f=1", "display_name": "Lucy S.", "link": "https://stackoverflow.com/users/5750005/lucy-s"}, "edited": false, "score": 0, "creation_date": 1452209651, "post_id": 34623765, "comment_id": 57080013, "body": "Thanks for the great reply, the diagram and breakdown really helped me! :)"}], "tags": [], "owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "is_accepted": false, "score": 10, "last_activity_date": 1452043039, "last_edit_date": 1452043039, "creation_date": 1452040419, "answer_id": 34623765, "question_id": 34623658, "link": "https://stackoverflow.com/questions/34623658/understanding-haskell-recursion-in-functions/34623765#34623765", "title": "Understanding Haskell recursion in functions", "body": "<p>Going through the lines, line by line, so you hopefully understand it better:</p>\n\n<pre><code>1| maximum' :: (Ord a) =&gt; [a] -&gt; a  \n2| maximum' [] = error \"maximum of empty list\"  \n3| maximum' [x] = x  \n4| maximum' (x:xs)   \n    | x &gt; maxTail = x  \n    | otherwise = maxTail  \n    where maxTail = maximum' xs\n</code></pre>\n\n<p>In line 1: you say that you get a list of a's and return one element of that type. Plus the elements in that list have to be ordable, so you can put them into a order.</p>\n\n<p>In line 2: you have an edge case, where you say that if you get an empty list as input, there can't be a \"highest value\" in that empty list, so you end the function with an error.</p>\n\n<p>In line 3: you have another edge case, where you say if you get a list with 1 element, that element has to be the highest element, so you return it.</p>\n\n<p>In line 4: you use pattern matching to match the first element(<code>x</code>) and the rest of the list(<code>xs</code>). Then you check if <code>x</code> is bigger than the <code>maxTail</code>, where <code>maxTail</code> the result of the function  call <code>maximum'</code> with the rest of the list <code>xs</code>.</p>\n\n<p>If that <code>x</code> is bigger than <code>maxTail</code> then you return <code>x</code> and otherwise <code>maxTail</code> is bigger than <code>x</code> and you return <code>maxTail</code>.</p>\n\n<p><br></p>\n\n<p>I think an example with some numbers should also help here:</p>\n\n<p>input:</p>\n\n<pre><code>[2, 5, 4, 13]\n</code></pre>\n\n<p>call:</p>\n\n<pre><code>maximum' [2, 5, 4, 13]\n</code></pre>\n\n<p>What happens:</p>\n\n<pre><code>maximum' (x  :  xs)\n          \u2193     \u2193\nmaximum' (2:[5, 4, 13]) \n           \u2502\n           \u2193                               result 13\n     x &gt; maxTail = x                         \u2191\n     2 &gt; maximum' [5, 4, 13] = x  //2 &gt; 13 = 13 \u2190 \u2500\u2500\u2500\u2500\u2510\n         \u2502                                            \u2502\n         \u2514  maximum' (x :  xs)                        \u2502\n                      \u2193    \u2193                          \u2502\n            maximum' (5:[4, 13])                      \u2502\n                       \u2502                              \u2502\n                       \u2193                              \u2191\n                 x &gt; maxTail = x                      \u2502\n                 5 &gt; maximum' [4, 13] = x  //5 &gt; 13 = 13 \u2190 \u2500\u2500\u2500\u2500\u2500\u2510\n                     \u2502                                          \u2502\n                     \u2514  maximum' (x: xs)                        \u2502\n                                  \u2193  \u2193                          \u2502\n                        maximum' (4:[13])                       \u2502\n                                   \u2502                            \u2502\n                                   \u2193                            \u2191\n                              x &gt; maxTail = x                   \u2502\n                              4 &gt; maximum' [13] = x  //4 &gt; 13 = 13  \u2510\n                                  \u2502                                 \u2502\n                                  \u2514 maximum' [x] = x                \u2191\n                                    maximum' [13] = 13 \u2192 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>\n\n<hr>\n\n<p>In your second example it's pretty much the same:</p>\n\n<pre><code>1| reverse' :: [a] -&gt; [a]  \n2| reverse' [] = []  \n3| reverse' (x:xs) = reverse' xs ++ [x]\n</code></pre>\n\n<p>In line 1: you say that you get a list of a's and return a list of a's.</p>\n\n<p>In line 2: you have an edge case, where you say if you get an empty list, the reversed list is also just empty.</p>\n\n<p>In line 3: you again use pattern matching to match the first element(<code>x</code>) of the list and the tail(<code>xs</code>) of it.</p>\n\n<p>Now you just use <code>++</code> to append two lists together, which is the first element of the list with the reversed tail.</p>\n\n<p><br></p>\n\n<p>And again I hope with an example it will be a bit clearer:</p>\n\n<p>input:</p>\n\n<pre><code>[1, 2, 3]\n</code></pre>\n\n<p>call:</p>\n\n<pre><code>reverse' [1, 2, 3]\n</code></pre>\n\n<p>What happens:</p>\n\n<pre><code>reverse' (x : xs)\n          \u2193   \u2193\nreverse' (1:[2, 3])\n           \u2502                               result [3, 2, 1]\n           \u2193                                       \u2191\n   (reverse' [2, 3]) ++ [1]  //[3, 2] ++ [1] = [3, 2, 1] \u2190 \u2500\u2500\u2500\u2500\u2510\n    \u2502                                                          \u2502\n    \u2514 reverse' (x: xs)                                         \u2502\n                \u2193  \u2193                                           \u2502\n      reverse' (2:[3])                                         \u2502\n                 \u2502                                             \u2191\n                 \u2193                                             \u2502\n         (reverse' [3]) ++ [2]  //[3] ++ [2] = [3, 2] \u2190 \u2500\u2500\u2500\u2510 \u2192 \u2518\n          \u2502                                                \u2502\n          \u2514 reverse' (x:xs)                                \u2502\n                      \u2193 \u2193                                  \u2502\n            reverse' (3:[])                                \u2502\n                       \u2502                                   \u2191\n                       \u2193                                   \u2502\n               (reverse' []) ++ [3]  //[] ++ [3] = [3] \u2510 \u2192 \u2518\n                \u2502                                      \u2191           \n                \u2514 reverse' [] = [] \u2192 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 155, "user_id": 5750005, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/075e7f5530ccf969ca746ece6c42e824?s=128&d=identicon&r=PG&f=1", "display_name": "Lucy S.", "link": "https://stackoverflow.com/users/5750005/lucy-s"}, "edited": false, "score": 0, "creation_date": 1452209708, "post_id": 34624871, "comment_id": 57080034, "body": "Thanks for your answer. It was good to see it using if and else, helped me understand it a lot better :)!"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 1, "last_activity_date": 1452049079, "creation_date": 1452049079, "answer_id": 34624871, "question_id": 34623658, "link": "https://stackoverflow.com/questions/34623658/understanding-haskell-recursion-in-functions/34624871#34624871", "title": "Understanding Haskell recursion in functions", "body": "<h1>Length</h1>\n\n<pre><code>length' [] = 0\n</code></pre>\n\n<p>Case 1: the length of an empty list is 0.</p>\n\n<pre><code>length' (x:xs) = 1 + length' xs\n</code></pre>\n\n<p>Case 2: the length of a list with at least one element is 1 more than the length of the tail of the list, which we find by repeating case 2 until no more elements remain, satisfying case 1.</p>\n\n<pre><code>length' [1, 2, 3]\n=\nlength' (1 : (2 : (3 : [])))\n=\n1 + length' (2 : (3 : []))\n=\n1 + (1 + length' (3 : []))\n=\n1 + (1 + (1 + length' []))\n=\n1 + (1 + (1 + 0))\n=\n1 + (1 + 1)\n=\n1 + 2\n=\n3\n</code></pre>\n\n<hr>\n\n<h1>Reverse</h1>\n\n<pre><code>reverse' [] = []  \n</code></pre>\n\n<p>Case 1: if a list is empty, its reverse is also an empty list.</p>\n\n<pre><code>reverse' (x:xs) = reverse' xs ++ [x]\n</code></pre>\n\n<p>Case 2: if a list has at least one element, then we can pull off the first element, move it to the end, and reverse the rest in the same way\u2014by proceeding down the list with case 2 until no elements remain, satisfying case 1.</p>\n\n<pre><code>reverse' [1, 2, 3]\n=\nreverse' (1 : (2 : (3 : [])))\n=\nreverse' (2 : (3 : [])) ++ [1]\n=\nreverse' (3 : []) ++ [2] ++ [1]\n=\nreverse' [] ++ [3] ++ [2] ++ [1]\n=\n[] ++ [3] ++ [2] ++ [1]\n=\n[3, 2, 1]\n</code></pre>\n\n<hr>\n\n<h1>Maximum</h1>\n\n<pre><code>maximum' [x] = x  \n</code></pre>\n\n<p>Case 1: if a list has only one element, that element is the maximum.</p>\n\n<pre><code>maximum' (x:xs)   \n</code></pre>\n\n<p>Case 2: if a list has at least one element, then either\u2026</p>\n\n<pre><code>    | x &gt; maxTail = x  \n</code></pre>\n\n<p>\u2026the first one is greater than all the others, in which case it\u2019s the maximum; or\u2026</p>\n\n<pre><code>    | otherwise = maxTail  \n</code></pre>\n\n<p>\u2026it\u2019s not, so the maximum is the greatest of all the others\u2026</p>\n\n<pre><code>    where maxTail = maximum' xs\n</code></pre>\n\n<p>\u2026which we find by proceeding down the list with case 2 until only one element remains, satisfying case 1.</p>\n\n<p>I\u2019ll rephrase the definition of <code>maximum'</code> to make it easier to show how it substitutes:</p>\n\n<pre><code>maximum' (x:xs) = let maxTail = maximum' xs in\n    if x &gt; maxTail then x else maxTail\n</code></pre>\n\n<p>Now:</p>\n\n<pre><code>maximum' [1, 3, 2]\n=\nmaximum' (1 : (3 : (2 : [])))\n=\nlet maxTail1 = maximum' (3 : (2 : [])) in\n    if 1 &gt; maxTail1 then 1 else maxTail1\n=\nlet maxTail1 =\n    (let maxTail2 = maximum' (2 : []) in\n        if 3 &gt; maxTail2 then 3 else maxTail2) in\n    if 1 &gt; maxTail1 then 1 else maxTail1\n=\nlet maxTail1 =\n    (let maxTail2 = 2 in\n        if 3 &gt; maxTail2 then 3 else maxTail2) in\n    if 1 &gt; maxTail1 then 1 else maxTail1\n=\nlet maxTail1 = (if 3 &gt; 2 then 3 else 2) in\n    if 1 &gt; maxTail1 then 1 else maxTail1\n=\nlet maxTail1 = 3 in\n    if 1 &gt; maxTail1 then 1 else maxTail1\n=\nif 1 &gt; 3 then 1 else 3\n=\n3\n</code></pre>\n"}], "owner": {"reputation": 155, "user_id": 5750005, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/075e7f5530ccf969ca746ece6c42e824?s=128&d=identicon&r=PG&f=1", "display_name": "Lucy S.", "link": "https://stackoverflow.com/users/5750005/lucy-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 696, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1452049079, "creation_date": 1452039835, "question_id": 34623658, "link": "https://stackoverflow.com/questions/34623658/understanding-haskell-recursion-in-functions", "title": "Understanding Haskell recursion in functions", "body": "<p>I've been using a few resources for Haskell: Learn you a Haskell and the wikibook. However, I'm struggling to find an explanation that helps me understand recursion a bit more. I've attached a sample piece of code from the 'Learn you a Haskell' book which I partially understand.</p>\n\n<pre><code>maximum' :: (Ord a) =&gt; [a] -&gt; a  \nmaximum' [] = error \"maximum of empty list\"  \nmaximum' [x] = x  \nmaximum' (x:xs)   \n    | x &gt; maxTail = x  \n    | otherwise = maxTail  \n    where maxTail = maximum' xs\n</code></pre>\n\n<p>I understand all of the above code until the last line 'where maxTail = maximum' xs'. What I don't understand is how the code is evaluated to return the maximum, from just calling maximum'. Or how it knows that the maximum' is the highest element of the list.</p>\n\n<p>Another example:</p>\n\n<pre><code>reverse' :: [a] -&gt; [a]  \nreverse' [] = []  \nreverse' (x:xs) = reverse' xs ++ [x]\n</code></pre>\n\n<p>Understand everything up until reverse' is called on the tail of the list. In other words, how does it know that reverse' means reverse the tails elements.</p>\n\n<p>I would really appreciate an explanation, and apologies if it's simple, I'm new to this language.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 58948, "user_id": 857807, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/297e4dba223f5103614030100eab78ca?s=128&d=identicon&r=PG", "display_name": "dcastro", "link": "https://stackoverflow.com/users/857807/dcastro"}, "edited": false, "score": 5, "creation_date": 1452034745, "post_id": 34622482, "comment_id": 56991178, "body": "I&#39;m glad you asked because this was driving me crazy too x.x"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1452085370, "post_id": 34622482, "comment_id": 57012543, "body": "By the way, <code>ap fromMaybe</code> is obfuscated code that hopefully no one would ever write in a real program."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 21, "last_activity_date": 1452169072, "last_edit_date": 1452169072, "creation_date": 1452034796, "answer_id": 34622805, "question_id": 34622482, "link": "https://stackoverflow.com/questions/34622482/how-does-ap-frommaybe-compose/34622805#34622805", "title": "How does ap fromMaybe compose?", "body": "<p>But that use of <code>ap</code> is <em>not</em> in the context of <code>Maybe</code>. We're using it with a function, <code>fromMaybe</code>, so it's in the context of functions, where</p>\n\n<pre><code>ap f g x = f x (g x)\n</code></pre>\n\n<p>Among the various <code>Monad</code> instances we have</p>\n\n<pre><code>instance Monad ((-&gt;) r)\n</code></pre>\n\n<p>so it is</p>\n\n<pre><code>ap :: Monad m =&gt;    m  (a       -&gt; b)  -&gt;    m  a  -&gt;    m  b\nfromMaybe     ::  r -&gt; (Maybe r -&gt; r)\nap            :: (r -&gt; (a       -&gt; b)) -&gt; (r -&gt; a) -&gt; (r -&gt; b)   \nap                   f                        g        x :: b\nap  fromMaybe ::                          (r -&gt; a) -&gt; (r -&gt; b)  , a ~ Maybe r , b ~ r\n</code></pre>\n\n<p>because <code>-&gt;</code> in types associates to the right: <code>a -&gt; b -&gt; c ~ a -&gt; (b -&gt; c)</code>. Trying to plug the types together, we can only end up with that definition above.</p>\n\n<p>And with <code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b</code>, we can write it as <code>(fromMaybe &lt;*&gt;)</code>, if you like this kind of graffiti:</p>\n\n<pre><code> #&gt; :t (fromMaybe &lt;*&gt;)\n(fromMaybe &lt;*&gt;) :: (r -&gt; Maybe r) -&gt; r -&gt; r\n</code></pre>\n\n<hr>\n\n<p>As is rightfully noted in another answer here, when used with functions, <code>&lt;*&gt;</code> is just your good ole' <a href=\"http://en.wikipedia.org/wiki/SKI_combinator_calculus\" rel=\"nofollow noreferrer\"><strong>S</strong> combinator</a>. We can't very well have function named <code>S</code> in Haskell, so <code>&lt;*&gt;</code> is just a part of standard repertoire of the point-free style of coding. Monadic bind (more so, flipped), <code>=&lt;&lt;</code>, can be even more mysterious, but a pointfree coder just doesn't care and will happily  use it to encode another, similar pattern, </p>\n\n<pre><code>(f =&lt;&lt; g) x = f (g x) x \n</code></pre>\n\n<p>in <a href=\"http://en.wikipedia.org/wiki/Combinatory_logic\" rel=\"nofollow noreferrer\">combinatory</a> function calls, mystery or no mystery (<code>zipWith (-) =&lt;&lt; drop 1</code> comes to mind). </p>\n"}, {"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 8, "last_activity_date": 1452035464, "last_edit_date": 1452035464, "creation_date": 1452035100, "answer_id": 34622864, "question_id": 34622482, "link": "https://stackoverflow.com/questions/34622482/how-does-ap-frommaybe-compose/34622864#34622864", "title": "How does ap fromMaybe compose?", "body": "<p>I'm going to relabel the type arguments, for clarity.</p>\n\n<pre><code>ap :: Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b\nfromMaybe :: c -&gt; Maybe c -&gt; c\n</code></pre>\n\n<blockquote>\n  <p>Which Monad instance does the compiler infer that m is?</p>\n</blockquote>\n\n<p><code>((-&gt;) r)</code> is a <code>Monad</code>. This is all functions that have type <code>r</code> as their argument, for some <em>specific</em> <code>r</code>.</p>\n\n<p>So in the type:</p>\n\n<pre><code>ap :: Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b\n</code></pre>\n\n<p><code>m</code> ~ <code>(c -&gt;)</code>, <code>a</code> ~ <code>Maybe c</code> and <code>b</code> ~ <code>c</code>. </p>\n\n<p>The return type, <code>m a -&gt; m b</code>, expands to <code>(c -&gt; Maybe c) -&gt; c -&gt; c</code> - which is the type of <code>ap fromMaybe</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 885, "user_id": 321143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cce7b70d30f42045bc6c8569f5549e2?s=128&d=identicon&r=PG", "display_name": "Ellie Kesselman", "link": "https://stackoverflow.com/users/321143/ellie-kesselman"}, "edited": false, "score": 4, "creation_date": 1452038140, "post_id": 34622951, "comment_id": 56992362, "body": "This answer is neither laconic nor mechanical. It is lively and detailed!"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 3, "creation_date": 1452111095, "post_id": 34622951, "comment_id": 57029592, "body": "Thank you, that was very helpful. I particularly found the definitions of <code>mFmap</code>, <code>funcMap</code> and <code>funcAp</code> useful to further my understanding."}], "tags": [], "owner": {"reputation": 1601, "user_id": 1205702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c2fd2313df8f6f65266cf7a4f1979b?s=128&d=identicon&r=PG", "display_name": "bitemyapp", "link": "https://stackoverflow.com/users/1205702/bitemyapp"}, "is_accepted": true, "score": 16, "last_activity_date": 1452038822, "last_edit_date": 1452038822, "creation_date": 1452035553, "answer_id": 34622951, "question_id": 34622482, "link": "https://stackoverflow.com/questions/34622482/how-does-ap-frommaybe-compose/34622951#34622951", "title": "How does ap fromMaybe compose?", "body": "<p>Apologies for laconic and mechanical answer. I don't like cherry-picking things like Applicative or Monad, but I don't know where you're at. This is <a href=\"http://haskellbook.com/\" rel=\"noreferrer\">not my usual approach to teaching Haskell</a>.</p>\n\n<p>First, <code>ap</code> is really <code>(&lt;*&gt;)</code> under the hood.</p>\n\n<pre><code>Prelude&gt; import Control.Monad\nPrelude&gt; import Data.Maybe\nPrelude&gt; import Control.Applicative\nPrelude&gt; :t ap\nap :: Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b\nPrelude&gt; :t (&lt;*&gt;)\n(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>What does this mean? It means we don't need something as \"strong\" as Monad to describe what we're doing. Applicative suffices. Functor doesn't, though.</p>\n\n<pre><code>Prelude&gt; :info Applicative\nclass Functor f =&gt; Applicative (f :: * -&gt; *) where\n  pure :: a -&gt; f a\n  (&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\nPrelude&gt; :info Functor\nclass Functor (f :: * -&gt; *) where\n  fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Here's <code>ap</code>/<code>(&lt;*&gt;)</code> with the Maybe Monad/Applicative:</p>\n\n<pre><code>Prelude&gt; ap (Just (+1)) (Just 1)\nJust 2\nPrelude&gt; (&lt;*&gt;) (Just (+1)) (Just 1)\nJust 2\n</code></pre>\n\n<p>First thing to figure out is, which instance of the typeclass Applicative are we talking about?</p>\n\n<pre><code>Prelude&gt; :t fromMaybe\nfromMaybe :: a -&gt; Maybe a -&gt; a\n</code></pre>\n\n<p>Desugaring fromMaybe's type a bit gives us:</p>\n\n<pre><code>(-&gt;) a (Maybe a -&gt; a)\n</code></pre>\n\n<p>So the type constructor we're concerned with here is <code>(-&gt;)</code>. What does GHCi tell us about <code>(-&gt;)</code> also known as function types?</p>\n\n<pre><code>Prelude&gt; :info (-&gt;)\ndata (-&gt;) a b   -- Defined in \u2018GHC.Prim\u2019\ninstance Monad ((-&gt;) r) -- Defined in \u2018GHC.Base\u2019\ninstance Functor ((-&gt;) r) -- Defined in \u2018GHC.Base\u2019\ninstance Applicative ((-&gt;) a) -- Defined in \u2018GHC.Base\u2019\n</code></pre>\n\n<p>Hrm. What about Maybe?</p>\n\n<pre><code>Prelude&gt; :info Maybe\ndata Maybe a = Nothing | Just a     -- Defined in \u2018GHC.Base\u2019\ninstance Monad Maybe -- Defined in \u2018GHC.Base\u2019\ninstance Functor Maybe -- Defined in \u2018GHC.Base\u2019\ninstance Applicative Maybe -- Defined in \u2018GHC.Base\u2019\n</code></pre>\n\n<p>What happened with the use of <code>(&lt;*&gt;)</code> for Maybe was this:</p>\n\n<pre><code>Prelude&gt; (+1) 1\n2\nPrelude&gt; (+1) `fmap` Just 1\nJust 2\nPrelude&gt; Just (+1) &lt;*&gt; Just 1\nJust 2\nPrelude&gt; :t fmap\nfmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nPrelude&gt; let mFmap = fmap :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\nPrelude&gt; (+1) `mFmap` Just 1\nJust 2\nPrelude&gt; :t (&lt;*&gt;)\n(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\nPrelude&gt; let mAp = (&lt;*&gt;) :: Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\nPrelude&gt; :t (+1)\n(+1) :: Num a =&gt; a -&gt; a\nPrelude&gt; :t Just (+1)\nJust (+1) :: Num a =&gt; Maybe (a -&gt; a)\nPrelude&gt; Just (+1) `mAp` Just 1\nJust 2\n</code></pre>\n\n<p>Okay, what about the function type's Functor and Applicative? One of the tricky parts here is that <code>(-&gt;)</code> has be to be partially applied <em>in the type</em> to be a Functor/Applicative/Monad. So your <code>f</code> becomes <code>(-&gt;) a</code> of the overall <code>(-&gt;) a b</code> where <code>a</code> is an argument type and <code>b</code> is the result.</p>\n\n<pre><code>Prelude&gt; (fmap (+1) (+2)) 0\n3\nPrelude&gt; (fmap (+1) (+2)) 0\n3\nPrelude&gt; :t fmap\nfmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nPrelude&gt; let funcMap = fmap :: (a -&gt; b) -&gt; (c -&gt; a) -&gt; c -&gt; b\nPrelude&gt; -- f ~ (-&gt;) c \nPrelude&gt; (funcMap (+1) (+2)) 0\n3\n\nPrelude&gt; :t (&lt;*&gt;)\n(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\nPrelude&gt; let funcAp = (&lt;*&gt;) :: (c -&gt; a -&gt; b) -&gt; (c -&gt; a) -&gt; (c -&gt; b)\nPrelude&gt; :t fromMaybe\nfromMaybe :: a -&gt; Maybe a -&gt; a\nPrelude&gt; :t funcAp fromMaybe\nfuncAp fromMaybe :: (b -&gt; Maybe b) -&gt; b -&gt; b\nPrelude&gt; :t const\nconst :: a -&gt; b -&gt; a\nPrelude&gt; :t funcAp const\nfuncAp const :: (b -&gt; b1) -&gt; b -&gt; b\n</code></pre>\n\n<p>Not guaranteed to be useful. You can tell <code>funcAp const</code> isn't interesting just from the type and knowing how parametricity works.</p>\n\n<p>Edit: speaking of compose, the Functor for <code>(-&gt;) a</code> is just <code>(.)</code>. Applicative is that, but with an extra argument. Monad is the Applicative, but with arguments flipped.</p>\n\n<p>Further whuttery: Applicative <code>&lt;*&gt;</code> for <code>(-&gt;) a</code>) is S and <code>pure</code> is K of the SKI combinator calculus. (You can derive I from K and S. Actually you can derive any program from K and S.)</p>\n\n<pre><code>Prelude&gt; :t pure\npure :: Applicative f =&gt; a -&gt; f a\nPrelude&gt; :t const\nconst :: a -&gt; b -&gt; a\nPrelude&gt; :t const\nconst :: a -&gt; b -&gt; a\nPrelude&gt; let k = pure :: a -&gt; b -&gt; a\nPrelude&gt; k 1 2\n1\nPrelude&gt; const 1 2\n1\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 6, "last_activity_date": 1492599219, "last_edit_date": 1492599219, "creation_date": 1452035654, "answer_id": 34622971, "question_id": 34622482, "link": "https://stackoverflow.com/questions/34622482/how-does-ap-frommaybe-compose/34622971#34622971", "title": "How does ap fromMaybe compose?", "body": "<p>The monad you are looking for is <code>(-&gt;) r</code> or <code>r -&gt; _</code> if you prefer infix syntax. </p>\n\n<p>Then the signature of <code>ap</code> expands to:</p>\n\n<pre><code> m (a -&gt; b) -&gt; m a -&gt; m b =\n (r -&gt; (a -&gt; b)) -&gt; (r -&gt; a) -&gt; r -&gt; b = -- now we use the signature of fromMaybe \n (b -&gt; (Maybe b -&gt; b)) -&gt; (b -&gt; Maybe b) -&gt; b -&gt; b\n</code></pre>\n\n<p>Now if you consider <code>ap fromMaybe</code> as a partially applied function and  voila you get the desired result. </p>\n"}], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 720, "favorite_count": 3, "accepted_answer_id": 34622951, "answer_count": 4, "score": 19, "last_activity_date": 1492599219, "creation_date": 1452033267, "question_id": 34622482, "link": "https://stackoverflow.com/questions/34622482/how-does-ap-frommaybe-compose", "title": "How does ap fromMaybe compose?", "body": "<p>There I was, writing a function that takes a value as input, calls a function on that input, and if the result of that is <code>Just x</code>, it should return <code>x</code>; otherwise, it should return the original input.</p>\n\n<p>In other words, this function (that I didn't know what to call):</p>\n\n<pre><code>foo :: (a -&gt; Maybe a) -&gt; a -&gt; a\nfoo f x = fromMaybe x (f x)\n</code></pre>\n\n<p>Since it seems like a general-purpose function, I wondered if it wasn't already defined, so <a href=\"https://twitter.com/ploeh/status/684418608454352896\">I asked on Twitter</a>, and <a href=\"https://twitter.com/bitemyapp/status/684467784793886720\">Chris Allen replied</a> that it's <code>ap fromMaybe</code>.</p>\n\n<p>That sounded promising, so I fired up GHCI and started experimenting:</p>\n\n<pre><code>Prelude Control.Monad Data.Maybe&gt; :type ap\nap :: Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b\nPrelude Control.Monad Data.Maybe&gt; :type fromMaybe\nfromMaybe :: a -&gt; Maybe a -&gt; a\nPrelude Control.Monad Data.Maybe&gt; :type ap fromMaybe\nap fromMaybe :: (b -&gt; Maybe b) -&gt; b -&gt; b\n</code></pre>\n\n<p>The type of <code>ap fromMaybe</code> certainly looks correct, and a couple of experiments seem to indicate that it has the desired behaviour as well.</p>\n\n<p>But <strong>how does it work?</strong></p>\n\n<p>The <code>fromMaybe</code> function seems clear to me, and in isolation, I think I understand what <code>ap</code> does - at least in the context of <code>Maybe</code>. When <code>m</code> is <code>Maybe</code>, it has the type <code>Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b</code>.</p>\n\n<p>What I don't understand is how <code>ap fromMaybe</code> even compiles. To me, this expression looks like partial application, but I may be getting that wrong. If this is the case, however, I don't understand how the types match up.</p>\n\n<p>The first argument to <code>ap</code> is <code>m (a -&gt; b)</code>, but <code>fromMaybe</code> has the type <code>a -&gt; Maybe a -&gt; a</code>. How does that match? Which <code>Monad</code> instance does the compiler infer that <code>m</code> is? How does <code>fromMaybe</code>, which takes two (curried) arguments, turn into a function that takes a single argument?</p>\n\n<p>Can someone help me connect the dots?</p>\n"}, {"tags": ["haskell", "maybe"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1452123533, "last_edit_date": 1452123533, "creation_date": 1452032733, "answer_id": 34622339, "question_id": 34622265, "link": "https://stackoverflow.com/questions/34622265/haskell-maybe-type-type/34622339#34622339", "title": "Haskell Maybe type -&gt; type", "body": "<p>Yes, you can use the <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Data-Maybe.html#v:fromMaybe\" rel=\"nofollow\"><code>fromMaybe</code></a> function:</p>\n\n<pre><code>fromMaybe :: a -&gt; Maybe a -&gt; a\n</code></pre>\n\n<p>It works as follows, the first argument is the <em>default value</em>, something you use in case the second is <code>Nothing</code>, next follows the <code>Maybe a</code>, if that value is <code>Just x</code>, <code>x</code> is returned. So an implementation of <code>fromMaybe</code> could be:</p>\n\n<pre><code>fromMaybe _ (Just x) = x\nfromMaybe d Nothing = d\n</code></pre>\n\n<p>So you could use:</p>\n\n<pre><code>import Data.Maybe(fromMaybe)\n\n--...\n\nputStrLn(fancyPrint2 $ kaasasOlevList !! (fromMaybe 0 index))\n</code></pre>\n\n<p>Without all the <code>if-then-else</code> wich is rather <em>un-Haskell</em>.</p>\n\n<hr>\n\n<p><strong>Why</strong> does it loop? Well in case that your <code>index</code> is of the form <code>Just x</code>, it goes into the following branch:</p>\n\n<pre><code>do \n   let index = index\n   putStrLn(fancyPrint2 $ kaasasOlevList !! index)\n</code></pre>\n\n<p>Now the expression:</p>\n\n<pre><code>   let index = index\n</code></pre>\n\n<p>means that you assign <code>index</code> <strong>to itself</strong> (not the outer <code>index</code>). That's not really a problem in a functional programming language, although it becomes problematic if you want <strong>to use such function</strong>.</p>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1452034165, "post_id": 34622600, "comment_id": 56990914, "body": "I would advice not to use <code>if</code>, unless it is quite necessary. Not that you do this in a <i>monadic</i> environment, which means that you enforce an order of computation, which is against the lazy programming principle of Haskell."}, {"owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1452034227, "post_id": 34622600, "comment_id": 56990940, "body": "@WillemVanOnsem Oh I agree completely. I just wanted to demonstrate a few different ways to do this"}], "tags": [], "owner": {"reputation": 10492, "user_id": 1351298, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/KJKqs.jpg?s=128&g=1", "display_name": "Electric Coffee", "link": "https://stackoverflow.com/users/1351298/electric-coffee"}, "is_accepted": true, "score": 5, "last_activity_date": 1452034540, "last_edit_date": 1452034540, "creation_date": 1452033857, "answer_id": 34622600, "question_id": 34622265, "link": "https://stackoverflow.com/questions/34622265/haskell-maybe-type-type/34622600#34622600", "title": "Haskell Maybe type -&gt; type", "body": "<p>You have several different options to get around this</p>\n\n<p>First is using your <code>if</code> statement, but with a small modification (Avoid doing this though)</p>\n\n<pre><code>if index == Nothing \n   then \n     do \n       let index' = 0\n       putStrLn $ fancyPrint2 $ kaasasOlevList !! index'\n   else \n     do \n       let (Just index') = index\n       putStrLn $ fancyPrint2 $ kaasasOlevList !! index'\n</code></pre>\n\n<p>I'm writing <code>index'</code> here, because Haskell doesn't allow you to overwrite existing variables, it does however let you hide them. But generally it's better practice to label \"modified\" versions of a variable with a \"prime\" symbol (<code>'</code>) at the end. That way you can always access the original if need be.</p>\n\n<p>Second you can use a <code>case</code> expression which turns your code into</p>\n\n<pre><code>case index of\n  Just i  -&gt; putStrLn $ fancyPrint2 $ kaasasOlevList !! i\n  Nothing -&gt; putStrLn $ fancyPrint2 $ kaasasOlevList !! 0\n</code></pre>\n\n<p>Or if you clean it up a bit using a <code>where</code> clause:</p>\n\n<pre><code>case index of\n  Just i  -&gt; putIndex i\n  Nothing -&gt; putIndex 0\nwhere putIndex x = putStrLn $ fancyPrint2 $ kaasasOlevList !! x\n</code></pre>\n\n<p>Lastly there's <code>fromMaybe</code> which lets you do this:</p>\n\n<pre><code>import Data.Maybe (fromMaybe)\n\n-- ...\n\ndo\n  let index' = fromMaybe 0 index\n  putStrLn $ fancyPrint2 $ kaasasOlevList !! index'\n</code></pre>\n\n<p>You can also use guards. But seeing as I don't know where your code-snippet comes from, I don't know if it's reasonable to use guards. </p>\n\n<p>You can read more about guards, case expressions and pattern matching <a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"nofollow\">here</a></p>\n"}], "owner": {"reputation": 151, "user_id": 5460243, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fb851e54f92c2e481868a7160f8731ea?s=128&d=identicon&r=PG&f=1", "display_name": "Fiedberg Nichenko", "link": "https://stackoverflow.com/users/5460243/fiedberg-nichenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 850, "favorite_count": 0, "accepted_answer_id": 34622600, "answer_count": 2, "score": 2, "last_activity_date": 1452123533, "creation_date": 1452032470, "last_edit_date": 1452032816, "question_id": 34622265, "link": "https://stackoverflow.com/questions/34622265/haskell-maybe-type-type", "title": "Haskell Maybe type -&gt; type", "body": "<p>I am running into this problem :</p>\n\n<pre><code>Couldn't match expected type \u2018Int\u2019 with actual type \u2018Maybe Int\u2019\n</code></pre>\n\n<p>Can I somehow convert \u2018Maybe Int\u2019 into \u2018Int\u2019??</p>\n\n<pre><code>if index == Nothing \n   then \n     do \n       let index = 0\n       putStrLn(fancyPrint2 $ kaasasOlevList !! index)\n   else \n     do \n       let index = index\n       putStrLn(fancyPrint2 $ kaasasOlevList !! index)\n</code></pre>\n\n<p>I tried like this, but this gives me :</p>\n\n<pre><code>Exception: &lt;&lt;loop&gt;&gt;\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1452020442, "post_id": 34618883, "comment_id": 56983971, "body": "How are you learning Haskell? Are you reading some book or something? There are so many wrong things in that code. But that particular error message just reveals simple controversion: you&#39;re declaring <code>isCorrectInput</code> to be pure function (despite its name, it is not anything like a predicate) but you put <code>displayErrorMsg</code> there, which prints something on the screen, thus it&#39;s in <code>IO</code> monad and cannot be used in pure function."}, {"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "reply_to_user": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1452021175, "post_id": 34618883, "comment_id": 56984416, "body": "I took a class in this fall where we were teached Haskell, Prolog, Ocaml, C and Scala. The project deadline is coming up (this is the project code) and i&#39;m trying to work some things out to get the points. I&#39;m more into imperative programming and writing functional is just not my style, i just want to pass the class and put as much as possible behind my ear. The most difficult thing is with this course that it teaches you the whole language in about 3 weeks and then moves onto really similar one."}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1452028425, "post_id": 34618883, "comment_id": 56988298, "body": "&quot;writing functional is just not my style, i just want to pass the class&quot; That&#39;s very sad to hear :("}], "answers": [{"tags": [], "owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "is_accepted": true, "score": 2, "last_activity_date": 1452020248, "creation_date": 1452020248, "answer_id": 34619271, "question_id": 34618883, "link": "https://stackoverflow.com/questions/34618883/type-error-evaluating-user-input-io-with-actual-type-char-haskell/34619271#34619271", "title": "Type error evaluating user input: IO () with actual type [[Char]]. Haskell", "body": "<p>Your problem is that the function <code>isCorrectInput</code> isn't in <code>IO</code> monad. Look at its type:</p>\n\n<pre><code>isCorrectInput :: String -&gt; [[Char]] -&gt; [[Char]]\n</code></pre>\n\n<p>and the error message</p>\n\n<pre><code>Couldn't match expected type `IO ()' with actual type `[[Char]]'\nIn the expression: isCorrectInput str tableArr\n</code></pre>\n\n<p>Since your is monadic (because of the <code>do</code> used) it is assumed that it should return a monadic result. Since it appears to be using the <code>IO</code> monad, you should correct its type signature to (note that String = [Char]):</p>\n\n<pre><code>isCorrectInput :: String -&gt; [String] -&gt; IO [String]\n</code></pre>\n\n<p>and each expression that represents a result in your function should be a monadic expression or use a <code>return</code> in order to put the result in a given monad. So to fix this error, just add <code>return</code>:</p>\n\n<pre><code>if length str == 3 then\n    return (isCorrectInput str tableArr)\nelse ...\n</code></pre>\n\n<p>My suggestion is to first understand Haskell IO and Monads. The Chapters 9 and 12 of <a href=\"http://learnyouahaskell.com/chapters\" rel=\"nofollow\">Learn you a Haskell</a> provide the necessary background.</p>\n"}, {"comments": [{"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1452021287, "post_id": 34619306, "comment_id": 56984486, "body": "Well, I/O has to come up eventually although, i&#39;m reading a game table in from a txt file. I&#39;ll try to keep up with your suggestions but guards are not what i&#39;m used to in programming (mostly javascript/python) and then if-else  conditions seem more familiar and easier for me, however they might not be as efficient."}, {"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1452021385, "post_id": 34619306, "comment_id": 56984526, "body": "Could you give ma an advice how could i set it to print out and continue on command <code>table</code>. Currently it&#39;ll just go on with userInput tableArr and not printing the table."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1452025333, "post_id": 34619306, "comment_id": 56986719, "body": "you can nest <code>do</code>-blocks inside <code>do</code>-blocks - see the <code>_ -&gt; do let ..</code> for example"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 3, "last_activity_date": 1452025268, "last_edit_date": 1452025268, "creation_date": 1452020388, "answer_id": 34619306, "question_id": 34618883, "link": "https://stackoverflow.com/questions/34618883/type-error-evaluating-user-input-io-with-actual-type-char-haskell/34619306#34619306", "title": "Type error evaluating user input: IO () with actual type [[Char]]. Haskell", "body": "<p>Your code is messy - on more than one level, so bear with me while I try to tidy it up and help you understand this error and most importantly avoid it in the future.</p>\n\n<p>TL,DR for you claim that <code>isCorrectInput :: String -&gt; [[Char]] -&gt; [[Char]]</code> in the type signature but all the functions at the end of your abundant ifs are of type <code>IO ()</code> so the signature should be <code>isCorrectInput :: String -&gt; [[Char]] -&gt; IO ()</code> probably (for there are some functions without implementation here).</p>\n\n<p>But first of all try to work with the following principles</p>\n\n<ul>\n<li>try to avoid <code>IO ()</code> where possible and stick to \"pure\" functions</li>\n<li>use guards/case statements instead of nested <code>if</code>s</li>\n<li>unless you have good reasons for it - code \"walking\" to the right side of the screen - is a bad sign</li>\n<li>write small and understandable functions</li>\n<li><p>if you cannot figure out the signature of a code piece - use <code>ghci</code></p>\n\n<pre><code>Prelude&gt; :type functionnamewhosesignatureidontknow\n</code></pre>\n\n<p>will help you</p></li>\n<li>read \"learn you a haskell for great good\" or some other literature linked in the info section of this stackoverflow tag</li>\n<li>if you have a haskell/functional programming user group near you join them</li>\n</ul>\n\n<hr>\n\n<p>Now to your code - I'll update this section as I get more on with it</p>\n\n<p>I try to start with a skeleton of functions just with a type signature and no implementation </p>\n\n<p><code>Main.hs</code></p>\n\n<pre><code>type GameBoard = [String]\ndata Direction = L|R|U|D deriving (Eq,Show)\ntype Move = (Int,Direction)\n\nmainLoop :: IO ()\n-- checks for abort condition and gives helpful information,\n-- while playing the game\nmainLoop = undefined\n\nparseMove :: GameBoard -&gt; String -&gt; Maybe Move\n-- checks if a given (pure) input string is a valid move for\n-- a given game state, for now I use Maybe to indicate all versions of invalid\n-- input\nparseMove = undefined\n\nhelp :: IO ()\n-- prints the rules of the game\nhelp = undefined\n\nprintErr :: String -&gt; IO ()\nprintErr = undefined\n</code></pre>\n\n<p>now this should compile - let's fill up the <code>mainLoop</code> - oh I noticed we want to use the current <code>GameBoard in that one so add it as a parameter - note that there are techniques to make this a bit more convenient (notably the so called</code>State` monad)</p>\n\n<pre><code>mainLoop :: GameBoard -&gt; IO ()\nmainLoop gb = do\n   str &lt;- getLine\n  case str of \"help\" -&gt; do help\n                           mainLoop gb\n\n              \"gg\" -&gt; putStrLn \"Game Over\"\n\n          -- \"table\" I omit for sake of shortness\n              _  -&gt; do let nextMove = parseMove gb str\n                       mainLoop (nextBoard gb nextMove)\n\nnextBoard :: GameBoard -&gt; Move -&gt; GameBoard\nnextBoard = undefined -- try to implement this one on your own\n</code></pre>\n\n<p>Ooops there's an error in my code - but hey the compiler told us nextMove is <code>Maybe Move</code> where <code>nextBoard</code> expects a <code>Move</code> so tidy that up quickly</p>\n\n<pre><code>              _  -&gt; case parseMove gb str\n                      of Just nextMove -&gt; mainLoop (nextBoard gb nextMove)\n                         _ -&gt; do putStrLn \"incorrect move - please repeat\"\n                                 mainLoop gb\n</code></pre>\n\n<p>next challenge is to tidy up is parsing the input, but first I redefine my <code>GameBoard</code>, knowing that haskell is a statically typed language I want to make use of that and actually use this to my advantage</p>\n\n<pre><code>type Tile = Empty | Movable | Fixed | Player deriving (Eq)\ninstance Show Tile where\n  -- I usally use my favourite unicode box characters for games like this one\n  show Empty   = \" \"\n  show Movable = \"0\"\n  show Fixed   = \"#\"\n  show Player  = \"@\"\ntype GameBoard = [[Tile]]\n</code></pre>\n\n<p>first I will split the <code>String</code> at the ' ' but how if I don't know the name of that function?</p>\n\n<p>=> use HOOGLE <a href=\"https://www.haskell.org/hoogle/?hoogle=%28a+-%3E+Bool%29+-%3E+%5Ba%5D+-%3E+%28%5Ba%5D%2C%5Ba%5D%29\" rel=\"nofollow\">https://www.haskell.org/hoogle/?hoogle=%28a+-%3E+Bool%29+-%3E+%5Ba%5D+-%3E+%28%5Ba%5D%2C%5Ba%5D%29</a></p>\n\n<p>and using ghci for the two candidates in <code>Prelude</code> we get <code>break</code> as the desired one</p>\n\n<pre><code>parseMove :: GameBoard -&gt; String -&gt; Maybe Move\n-- note despite us changing what Gameboard is this signature has not changed!\n-- first of all I assume that number and dir are separated by a space\n-- watch out there is still a space at _dir\n-- and both tuple entries are still Strings\nparseMove gb = do let (_n, _dir) = break (== ' ') str\n                  n &lt;- parseInt n\n                  dir &lt;- parseDir _dir\n                  if canPlayerMove gb (n,dir) then return (n,dir)\n                                              else Nothing\n\n  where parseInt :: String -&gt; Maybe Int\n        parseInt s = if all isDigit s -- you might import or define `isDigit` yourself\n                       then Just (read s)\n                       else Nothing\n        parseDir :: String -&gt; Maybe Direction\n        parseDir \"L\" = Just L\n        parseDir \"R\" = Just R\n        -- ..\n        parseDir _ = Nothing\n\ncanPlayerMove :: GameBoard -&gt; Move -&gt; Bool\ncanPlayerMove = undefined -- here you take care that the Game logic is respected\n</code></pre>\n\n<p>I hope you get a bit of a picture how to tidy up code.\nAlso note that this code is by far the best, I hope I wrote it understandably</p>\n\n<p>Btw. that <code>do</code> .. <code>&lt;-</code> .. <code>return</code> in <code>parseMove</code> is a neat trick when working with <code>Maybe</code> the right arrow takes a <code>Maybe value</code> on the right hand side and pulls out a <code>value</code> if it is <code>Just x</code>, otherwise the whole computation below that point is discarded and <code>Nothing</code> is returned.</p>\n"}], "owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 34619271, "answer_count": 2, "score": 0, "last_activity_date": 1452025268, "creation_date": 1452018895, "question_id": 34618883, "link": "https://stackoverflow.com/questions/34618883/type-error-evaluating-user-input-io-with-actual-type-char-haskell", "title": "Type error evaluating user input: IO () with actual type [[Char]]. Haskell", "body": "<p>I'm trying to implement the game on which i can move different blocks on the board. I've set the conditions for moving and an actual moving of the blocks, now what i tried to add was a recursive loop on user input, which would ideally solve the game.</p>\n\n<p>That's what i've written:</p>\n\n<pre><code>userInput tableArr = do\n  str &lt;- getLine\n  if str == \"help\"\n    then printHelp tableArr\n    else if str == \"gg\"\n      then putStrLn \"Game over, you lose\"\n      else if length str == 3\n         then isCorrectInput str tableArr\n         else if str == \"table\"\n           then let printer = printTable tableArr in userInput tableArr\n           else displayErrorMsg tableArr\n\nisCorrectInput :: String -&gt; [[Char]] -&gt; [[Char]]\nisCorrectInput str tableArr = do\n  let val = filter (not . isSpace) str\n  let move = val !! 1\n  let number = digitToInt(val !! 0)\n  let posArr = findBlock (myElem number) tableArr\n  if length val == 2\n    then (if move == 'R'\n            then let newArr = moveRIGHT tableArr number posArr in userInput newArr\n            else if move == 'L'\n              then let newArr = moveLEFT tableArr number posArr in userInput newArr\n              else if move == 'U'\n                then let newArr = moveUP tableArr number posArr in userInput newArr\n                else if move == 'D'\n                  then let newArr = moveDOWN tableArr number posArr in userInput newArr\n                  else displayErrorMsg tableArr)\n    else displayErrorMsg tableArr\n\ndisplayErrorMsg tableArr = do\n  putStr \"Wrong input, type again: \"\n  userInput tableArr\n</code></pre>\n\n<p>Now a-bit clarification on what's happening here. </p>\n\n<p>Function <code>userInput</code> takes in a <code>[[Char]]</code> (i have not set the signature cause i got confused on the return type of this thing). Now there's several conditions for the user input, but the error is thrown in <code>isCorrectInput</code>. (Also is <code>let printer = printTable tableArr in userInput tableArr</code> written correctly? I didn't want to add recursive end to function printTable which basically contains only <code>putStrLn</code>s to print out my game board).</p>\n\n<p>Now let's take a quick look at <code>isCorrectInput</code>. This evaluates the user input abit more accurately and takes an action based on the user input (Usually the user input is expected in manner \"4 R\" which means basically block with number 4 to right. Anyways if one of the moving conditions are matched then the move function is called, added to the new variable and then the function <code>userInput</code> is called out recursively once again. </p>\n\n<p>The function <code>displayErrorMsg</code> is just to display message and call-out recursion again.</p>\n\n<p>Now the error that i'm getting is:</p>\n\n<pre><code>Couldn't match expected type `IO ()' with actual type `[[Char]]'\nIn the expression: isCorrectInput str tableArr\nIn the expression:\n  if length str == 3 then\n      isCorrectInput str tableArr\n  else\n      if str == \"table\" then\n          let printer = ... in userInput tableArr\n      else\n          displayErrorMsg tableArr\nIn the expression:\n  if str == \"gg\" then\n      putStrLn \"Game over, you lose\"\n  else\n      if length str == 3 then\n          isCorrectInput str tableArr\n      else\n          if str == \"table\" then\n              let ... in userInput tableArr\n          else\n              displayErrorMsg tableArr\n</code></pre>\n\n<p>I hope that my explanation was clear enough as i'm not a native English speaker and one of you could show what's wrong with my code. </p>\n\n<p>Thank you :)</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 4, "creation_date": 1452017665, "post_id": 34618496, "comment_id": 56982471, "body": "Among other somewhat magical properties users seem to think a functional compiler has over common compilers... automatic memoization, arbitrary partial evaluation, algebraic rewriting..."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1452038894, "post_id": 34618496, "comment_id": 56992622, "body": "@ThomasM.DuBuisson to be fair, haskell enthusiasts do love to praise GHC for being hella smart, so I can see where this comes from."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 7, "last_activity_date": 1452017588, "creation_date": 1452017588, "answer_id": 34618496, "question_id": 34618366, "link": "https://stackoverflow.com/questions/34618366/haskell-infinite-lists-how-lazy-is-haskell/34618496#34618496", "title": "Haskell: infinite lists - how lazy is Haskell?", "body": "<p>Just because 11^2 is more than 100 doesn't mean 13^2 is more than 100. Well... okay, it does, but how is GHC supposed to figure that out? It's a compiler, not a prover of arbitrary mathematical truths.</p>\n"}, {"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 4, "creation_date": 1452017785, "post_id": 34618512, "comment_id": 56982529, "body": "And the property depends on the types too.  Imagine a ring where <code>x^2 &gt; 100</code> but <code>(succ x)^2 &lt; 100</code> - the first filtered element does not imply there would be no more filtered elements for all types."}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1452017866, "post_id": 34618512, "comment_id": 56982567, "body": "Indeed, and given that there are no type annotations, it&#39;s probably possibly to instantiate this expression to a type that is <code>Num</code> and represents unsigned integers modulo say 512."}], "tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": false, "score": 12, "last_activity_date": 1452017640, "creation_date": 1452017640, "answer_id": 34618512, "question_id": 34618366, "link": "https://stackoverflow.com/questions/34618366/haskell-infinite-lists-how-lazy-is-haskell/34618512#34618512", "title": "Haskell: infinite lists - how lazy is Haskell?", "body": "<p>This isn't about how lazy it is, but rather whether there is any way it can possibly know that <code>n^2 &lt; 100</code> will never be true again once it was false once. Which it doesn't.</p>\n\n<p>These parts of an array comprehension are <em>filter expressions</em>, not <em>stop conditions</em>.</p>\n"}, {"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 2, "last_activity_date": 1452037660, "last_edit_date": 1452037660, "creation_date": 1452018507, "answer_id": 34618766, "question_id": 34618366, "link": "https://stackoverflow.com/questions/34618366/haskell-infinite-lists-how-lazy-is-haskell/34618766#34618766", "title": "Haskell: infinite lists - how lazy is Haskell?", "body": "<p>The expression you've given effectively desugars into:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>sum $ do\n    n &lt;- [1..]\n    _ &lt;- if odd (n^2) then [()] else []\n    _ &lt;- if n^2 &lt; 100 then [()] else []\n    return (n^2)\n</code></pre>\n\n<p>If you have never seen the List monad then this probably seems like a weird way to use <code>do</code> but it turns ultimately into:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sum $ concatMap (\\n -&gt; if odd (n^2) &amp;&amp; (n^2 &lt; 100) then [n^2] else []) [1..]\n</code></pre>\n\n<p>where <code>concatMap</code> is in the Prelude (in earlier versions you can define it as <code>(concat .) . map</code> but now it applies to any <code>Foldable</code>, not just lists, and is therefore closer to <code>(concat .) . fmap</code>).</p>\n\n<p>Now the key thing here is that when Haskell sees this function it stops analyzing! It is a theorem of computer science that the only general way to prove properties about arbitrary general functions is to run them -- Haskell does not peek inside, and does not give <code>concatMap</code> any way to peek inside, a function to try to determine if it will eventually yield <code>[]</code> for all further inputs!</p>\n\n<p>Computers are <strong>dumb</strong>, and that is <strong>good</strong>: the smarter a program is, the harder it is to model it in your head. <code>concatMap</code> is a very dumb function, it just applies its function-argument to every element of the list and puts them all together with <code>concat</code>, and that's all it does. List comprehensions are a very dumb syntax replacement for the <code>do</code> notation of the list monad, that's all they do. The <code>do</code> notation is just a very dumb syntax replacement for the function <code>&gt;&gt;=</code> in the <code>Monad</code> typeclass, which for lists is <code>concatMap</code>. Because all of these things are very dumb, you can understand everything that goes on very easily.</p>\n"}], "owner": {"reputation": 10448, "user_id": 784980, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d9c4540c5478352227f3ed3c3316ad8c?s=128&d=identicon&r=PG", "display_name": "rapt", "link": "https://stackoverflow.com/users/784980/rapt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "closed_date": 1452028420, "answer_count": 3, "score": 3, "last_activity_date": 1452037660, "creation_date": 1452017137, "question_id": 34618366, "link": "https://stackoverflow.com/questions/34618366/haskell-infinite-lists-how-lazy-is-haskell", "closed_reason": "Duplicate", "title": "Haskell: infinite lists - how lazy is Haskell?", "body": "<p>How lazy is Haskell?</p>\n\n<p>Why does the following not know when to stop?</p>\n\n<pre><code>sum ([n^2 | n &lt;- [1..], odd (n^2), n^2 &lt; 100])\n</code></pre>\n"}, {"tags": ["haskell", "template-haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1452018457, "post_id": 34618698, "comment_id": 56982904, "body": "Yep, I&#39;m heading down that road, but it wouldn&#39;t be great if the template library would do that for me? Code I don&#39;t write is code I don&#39;t have to debug."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1452018292, "creation_date": 1452018292, "answer_id": 34618698, "question_id": 34617973, "link": "https://stackoverflow.com/questions/34617973/make-lenses-th-with-the-same-field-name-using-makeclassy/34618698#34618698", "title": "Make Lenses (TH) with the Same Field Name using makeClassy", "body": "<p>The templates are optional; you can always make your own classes and lenses.</p>\n\n<pre><code>class Capacitor s where\n  capacitance :: Lens' s Int\n</code></pre>\n\n<p>Now any type with a capacity can be made an instance of this class.</p>\n\n<hr>\n\n<p>An alternative approach is to factor out the capacity:</p>\n\n<pre><code>data Luggage a = Luggage { clothes :: a, capacity :: !Int }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1251, "user_id": 1417275, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/998042e119962eca25996a34372a4a7a?s=128&d=identicon&r=PG", "display_name": "Sammy S.", "link": "https://stackoverflow.com/users/1417275/sammy-s"}, "edited": false, "score": 0, "creation_date": 1468496347, "post_id": 34620429, "comment_id": 64156783, "body": "<code>makeFields &#39;&#39;Structure</code> doesn&#39;t compile (even if you enable the <code>TypeSynonymInstances</code> extension). The reasons for this are outlined here: <a href=\"http://stackoverflow.com/a/8663534/1417275\">stackoverflow.com/a/8663534/1417275</a>. I find this rather restricting since I can&#39;t use <code>makeFields</code> for any data types with higher order fields."}], "tags": [], "owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "is_accepted": false, "score": 0, "last_activity_date": 1452024817, "creation_date": 1452024817, "answer_id": 34620429, "question_id": 34617973, "link": "https://stackoverflow.com/questions/34617973/make-lenses-th-with-the-same-field-name-using-makeclassy/34620429#34620429", "title": "Make Lenses (TH) with the Same Field Name using makeClassy", "body": "<p>Prefix the field name with an underscore and the data type name, then use <code>makeFields</code>:</p>\n\n<pre><code>data Structure = Structure { _structureCapacity :: Int }\nmakeFields ''Structure\n\ndata OtherStructure = OtherStructure { _otherStructureCapacity :: String }\nmakeFields ''Structure\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 5, "last_activity_date": 1452045317, "creation_date": 1452045317, "answer_id": 34624414, "question_id": 34617973, "link": "https://stackoverflow.com/questions/34617973/make-lenses-th-with-the-same-field-name-using-makeclassy/34624414#34624414", "title": "Make Lenses (TH) with the Same Field Name using makeClassy", "body": "<p>I found the documentation a bit unclear too; had to figure out what the various things Control.Lens.TH did by experimentation.</p>\n\n<p>What you want is makeFields:</p>\n\n<pre><code>{-# LANGUAGE FunctionalDependencies\n           , MultiParamTypeClasses\n           , TemplateHaskell\n  #-}\n\nmodule Foo\nwhere\n\nimport Control.Lens\n\ndata Foo\n  = Foo { fooCapacity :: Int }\n  deriving (Eq, Show)\n$(makeFields ''Foo)\n\ndata Bar\n  = Bar { barCapacity :: Double }\n  deriving (Eq, Show)\n$(makeFields ''Bar)\n</code></pre>\n\n<p>Then in ghci:</p>\n\n<pre><code>*Foo\n\u03bb let f = Foo 3\n|     b = Bar 7\n| \nb :: Bar\nf :: Foo\n\n*Foo\n\u03bb fooCapacity f\n3\nit :: Int\n\n*Foo\n\u03bb barCapacity b\n7.0\nit :: Double\n\n*Foo\n\u03bb f ^. capacity\n3\nit :: Int\n\n*Foo\n\u03bb b ^. capacity\n7.0\nit :: Double\n\n\u03bb :info HasCapacity \nclass HasCapacity s a | s -&gt; a where\n  capacity :: Lens' s a\n    -- Defined at Foo.hs:14:3\ninstance HasCapacity Foo Int -- Defined at Foo.hs:14:3\ninstance HasCapacity Bar Double -- Defined at Foo.hs:19:3\n</code></pre>\n\n<p>So what it's actually done is declared a class <code>HasCapacity s a</code>, where capacity is a Lens' from s to a (a is fixed once s is known). It figured out the name \"capcity\" by stripping off the (lowercased) name of the data type from the field; I find it pleasant not to have to use an underscore on either the field name or the lens name, since sometimes record syntax is actually what you want. You can use makeFieldsWith and the various lensRules to have some different options for calculating the lens names.</p>\n\n<p>In case it helps, using <code>ghci -ddump-splices Foo.hs</code>:</p>\n\n<pre><code>[1 of 1] Compiling Foo              ( Foo.hs, interpreted )\nFoo.hs:14:3-18: Splicing declarations\n    makeFields ''Foo\n  ======&gt;\n    class HasCapacity s a | s -&gt; a where\n      capacity :: Lens' s a\n    instance HasCapacity Foo Int where\n      {-# INLINE capacity #-}\n      capacity = iso (\\ (Foo x_a7fG) -&gt; x_a7fG) Foo\nFoo.hs:19:3-18: Splicing declarations\n    makeFields ''Bar\n  ======&gt;\n    instance HasCapacity Bar Double where\n      {-# INLINE capacity #-}\n      capacity = iso (\\ (Bar x_a7ne) -&gt; x_a7ne) Bar\nOk, modules loaded: Foo.\n</code></pre>\n\n<p>So the first splace made the class HasCapcity and added an instance for Foo; the second used the existing class and made an instance for Bar.</p>\n\n<p>This also works if you import the HasCapcity class from another module; makeFields can add more instances to the existing class and spread your types out across multiple modules. But if you use it again in another module where you <em>haven't</em> imported the class, it'll make a <em>new</em> class (with the same name), and you'll have two separate overloaded <code>capacity</code> lenses that are not compatible.</p>\n\n<hr>\n\n<p>makeClassy is a bit different. If I had:</p>\n\n<pre><code>data Foo\n  = Foo { _capacity :: Int }\n  deriving (Eq, Show)\n$(makeClassy ''Foo)\n</code></pre>\n\n<p>(noticing that makeClassy prefers you to have an underscore prefix on the fields, rather than the data type name)</p>\n\n<p>Then, again using -ddump-splices:</p>\n\n<pre><code>[1 of 1] Compiling Foo              ( Foo.hs, interpreted )\nFoo.hs:14:3-18: Splicing declarations\n    makeClassy ''Foo\n  ======&gt;\n    class HasFoo c_a85j where\n      foo :: Lens' c_a85j Foo\n      capacity :: Lens' c_a85j Int\n      {-# INLINE capacity #-}\n      capacity = (.) foo capacity\n    instance HasFoo Foo where\n      {-# INLINE capacity #-}\n      foo = id\n      capacity = iso (\\ (Foo x_a85k) -&gt; x_a85k) Foo\nOk, modules loaded: Foo.\n</code></pre>\n\n<p>The class it's created is HasFoo, rather than HasCapacity; it's saying that anything from anything where you can get a Foo you can also get the capacity of the Foo. And the <em>class</em> hard-codes that the capcity is an <code>Int</code>, rather than overloading it as you had with <code>makeFields</code>. So this still works (because <code>HasFoo Foo</code>, where you just get the Foo by using <code>id</code>):</p>\n\n<pre><code>*Foo\n\u03bb let f = Foo 3\n| \nf :: Foo\n\n*Foo\n\u03bb f ^. capacity\n3\nit :: Int\n</code></pre>\n\n<p>But you can't use this <code>capcity</code> lens to also get the capacity of an unrelated type.</p>\n"}], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 753, "favorite_count": 4, "accepted_answer_id": 34624414, "answer_count": 3, "score": 5, "last_activity_date": 1452045317, "creation_date": 1452015660, "last_edit_date": 1452039307, "question_id": 34617973, "link": "https://stackoverflow.com/questions/34617973/make-lenses-th-with-the-same-field-name-using-makeclassy", "title": "Make Lenses (TH) with the Same Field Name using makeClassy", "body": "<blockquote>\n  <p>This question is regarding Edward A. Kmett's <a href=\"https://hackage.haskell.org/package/lens-4.13\" rel=\"nofollow\">lens package</a> (version 4.13)</p>\n</blockquote>\n\n<p>I have a number of different <code>data</code> types all of which have a field that denotes the maximum number of elements contained (a business rule subject to run time change, not a collection implementation issue.) I would like to call this field <code>capacity</code> in all cases, but I quickly run into namespace conflicts.</p>\n\n<p>I see in the <code>lens</code> documentation that there is a <code>makeClassy</code> template, but I cannot find documentation for it that I con understand.  Will this template function allow me to have multiple lenses with the same field name? </p>\n\n<hr>\n\n<p><strong>EDITED</strong>:\nLet me add that I am quite capable of coding <em>around</em> the problem.  I would like to know if <code>makeClassy</code> will <em>solve</em> the problem.</p>\n"}, {"tags": ["function", "haskell", "math", "functional-programming", "purely-functional"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1452042756, "post_id": 34617662, "comment_id": 56993791, "body": "@HarryDeveloper1212 I think this is a good question. I&#39;ve made some edits in order to (I hope) clarify what I understood the question to mean. If you&#39;re unhappy with my changes, feel free to <a href=\"http://stackoverflow.com/posts/34617662/edit\">edit your question</a> again to put it back."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 19, "last_activity_date": 1452016034, "creation_date": 1452016034, "answer_id": 34618084, "question_id": 34617662, "link": "https://stackoverflow.com/questions/34617662/are-all-pure-functions-in-functional-programming-continuous/34618084#34618084", "title": "Are all pure functions in functional programming continuous?", "body": "<p>Computable functions are continuous in the sense of Scott continuity, mentioned in the second paragraph of the Wikipedia page you linked to.</p>\n\n<p>An example of a function which is <em>not</em> continuous is (pseudo-Haskell)</p>\n\n<pre><code>isInfinite :: [a] -&gt; Bool\nisInfinite xs\n    | {- xs is an infinite list x0 : x1 : x2 : ... -}        = True\n    | {- xs is a finite list x0 : x1 : x2 : ... : xn : [] -} = False\n    | {- xs is a list with diverging spine\n                            x0 : x1 : x2 : ... : xn : _|_ -} = _|_\n</code></pre>\n\n<p>It fails to be continuous because</p>\n\n<pre><code>() : () : () : ...\n</code></pre>\n\n<p>is the supremum of the sequence</p>\n\n<pre><code>_|_\n() : _|_\n() : () : _|_\n...\n</code></pre>\n\n<p>but</p>\n\n<pre><code>True = isInfinite (() : () : () : ...)\n</code></pre>\n\n<p>is not the supremum of the sequence</p>\n\n<pre><code>_|_ = isInfinite (_|_)\n_|_ = isInfinite (() : _|_)\n_|_ = isInfinite (() : () : _|_)\n...\n</code></pre>\n\n<p>Computable functions are continuous, essentially because in a finite amount of time a function can only inspect a finite amount of its input. So if a computable function returns, say, <code>True</code> on a particular input, it must return <code>True</code> on every input in the set of inputs which agree with the original input on a certain finite collection of observations. Any increasing sequence which converges to the original input will eventually land and stay inside this set, so the sequence of values of the function on this increasing sequence will converge to <code>True</code>.</p>\n\n<p>A continuous function is not necessarily computable. For example any order-preserving (i.e. <code>f _|_ = _|_</code>, or <code>f</code> is constant) function <code>Integer -&gt; Bool</code> is continuous, since <code>Integer</code> is a flat domain. But of course only countably many of them are computable.</p>\n"}], "owner": {"reputation": 8046, "user_id": 1774391, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/96ec1a791090d470daa3338f3dfdf996?s=128&d=identicon&r=PG", "display_name": "MainstreamDeveloper00", "link": "https://stackoverflow.com/users/1774391/mainstreamdeveloper00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 553, "favorite_count": 2, "accepted_answer_id": 34618084, "answer_count": 1, "score": 7, "last_activity_date": 1452042524, "creation_date": 1452014670, "last_edit_date": 1452042524, "question_id": 34617662, "link": "https://stackoverflow.com/questions/34617662/are-all-pure-functions-in-functional-programming-continuous", "title": "Are all pure functions in functional programming continuous?", "body": "<p>I know that the set of Haskell functions is only a subset of all mathematical functions, because it is a programming language, so all of its functions must be computable. But is it true that all Haskell functions (and pure functions in general) are <a href=\"https://en.wikipedia.org/wiki/Continuous_function\" rel=\"noreferrer\">continuous</a>, from a mathematical point of view?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 30577, "user_id": 476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85197b0087c5bee323d2690c977878f8?s=128&d=identicon&r=PG", "display_name": "Vincent Savard", "link": "https://stackoverflow.com/users/476496/vincent-savard"}, "edited": false, "score": 4, "creation_date": 1452012463, "post_id": 34616886, "comment_id": 56979258, "body": "Look at your function signature, then at <code>recursion [] = []</code>. Don&#39;t you see something wrong? Your function doesn&#39;t return an <code>Int</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1452012603, "post_id": 34616886, "comment_id": 56979354, "body": "What are you trying to do here anyway? Perhaps describe it in words."}, {"owner": {"reputation": 49, "user_id": 5540673, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/b13a2f2244972806167de44bbfea026d?s=128&d=identicon&r=PG&f=1", "display_name": "Jane Doe", "link": "https://stackoverflow.com/users/5540673/jane-doe"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1452012659, "post_id": 34616886, "comment_id": 56979392, "body": "@leftaroundabout count how many numbers are divisible by 3 in a giving list."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1452012757, "post_id": 34616886, "comment_id": 56979453, "body": "Oh, it&#39;s right in the title. Sorry."}], "answers": [{"tags": [], "owner": {"reputation": 55943, "user_id": 3933332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zuzev.png?s=128&g=1", "display_name": "Rizier123", "link": "https://stackoverflow.com/users/3933332/rizier123"}, "is_accepted": true, "score": 2, "last_activity_date": 1452012995, "last_edit_date": 1452012995, "creation_date": 1452012676, "answer_id": 34617002, "question_id": 34616886, "link": "https://stackoverflow.com/questions/34616886/counting-how-many-numbers-are-divisible-by-3-in-a-list-using-recursion/34617002#34617002", "title": "Counting how many numbers are divisible by 3 in a list using recursion?", "body": "<p>This should work for you:</p>\n\n<p>Use the empty list as an edge case where you return 0, so you can add 1 every time one element of the list is dividable by 3 without rest. If you can divide the element by 3 without rest you add 1 and call the function again with the list else you just add 0, e.g.</p>\n\n<pre><code>recursion :: [Int] -&gt; Int\nrecursion [] = 0\nrecursion (x:xs) = if x `mod` 3 == 0 then 1 + recursion xs else 0 + recursion xs\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 49, "user_id": 5540673, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/b13a2f2244972806167de44bbfea026d?s=128&d=identicon&r=PG&f=1", "display_name": "Jane Doe", "link": "https://stackoverflow.com/users/5540673/jane-doe"}, "edited": false, "score": 0, "creation_date": 1452013119, "post_id": 34617092, "comment_id": 56979701, "body": "its GCHI :) Thank you!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1452013183, "post_id": 34617092, "comment_id": 56979741, "body": "FTR, the OP does not contain <code>if x `mod` 3 then ...</code>, but <code>if x `mod` == 3 then ...</code> (which is actually not even a valid expression, but if it were it would have the correct type <code>Bool</code>)."}, {"owner": {"reputation": 49, "user_id": 5540673, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/b13a2f2244972806167de44bbfea026d?s=128&d=identicon&r=PG&f=1", "display_name": "Jane Doe", "link": "https://stackoverflow.com/users/5540673/jane-doe"}, "edited": false, "score": 0, "creation_date": 1452013377, "post_id": 34617092, "comment_id": 56979873, "body": "AH i was wondering why I kept getting parse errors on the &#39;==&#39;, brilliant, thank you guys!"}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": false, "score": 6, "last_activity_date": 1452013123, "last_edit_date": 1452013123, "creation_date": 1452012990, "answer_id": 34617092, "question_id": 34616886, "link": "https://stackoverflow.com/questions/34616886/counting-how-many-numbers-are-divisible-by-3-in-a-list-using-recursion/34617092#34617092", "title": "Counting how many numbers are divisible by 3 in a list using recursion?", "body": "<p>To write a recursive solution, you first need to consider the base case. As Vincent pointed out, you have a serious problem with your base case. The output <code>[]</code> has type <code>[a]</code>, but should have type <code>Int</code>. Ask yourself: </p>\n\n<ol>\n<li>What type should the result have?</li>\n<li>In an empty list, how many list elements are divisible by 3?</li>\n</ol>\n\n<p>For the recursive case, it's unclear what you're missing, but it might just be syntax. You have the general idea. </p>\n\n<pre><code>recursion :: [Int] -&gt; Int\nrecursion [] = -- base case goes here\nrecursion (x:xs) = if x `mod` 3 -- what is the type of (x `mod` 3)? Haskell isn't C!\n                   then 1 + something\n                   else somethingelse\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 5540673, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/b13a2f2244972806167de44bbfea026d?s=128&d=identicon&r=PG&f=1", "display_name": "Jane Doe", "link": "https://stackoverflow.com/users/5540673/jane-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1075, "favorite_count": 0, "accepted_answer_id": 34617002, "answer_count": 2, "score": 1, "last_activity_date": 1452013123, "creation_date": 1452012362, "last_edit_date": 1452012652, "question_id": 34616886, "link": "https://stackoverflow.com/questions/34616886/counting-how-many-numbers-are-divisible-by-3-in-a-list-using-recursion", "title": "Counting how many numbers are divisible by 3 in a list using recursion?", "body": "<p>This is confusing me a lot here, I thnk I have an OK knowledge in haskell but I just cant get the whole \"counting\" part to work.</p>\n\n<pre><code>recursion :: [Int] -&gt; Int\nrecursion [] = []\nrecursion (x:xs) = if x `mod` == 3 then.. +1 +  recursion xs\n</code></pre>\n\n<p>I know where its going wrong, the whole then +1 part but just cannot do it</p>\n\n<p>count how many numbers are divisible by 3 in a giving list.</p>\n"}, {"tags": ["haskell", "functional-programming", "lambda-calculus", "program-transformation"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1452005326, "post_id": 34610962, "comment_id": 56974272, "body": "without reading the book, you can&#39;t float <code>a y</code> above <code>letrec</code> which defines <code>a</code>, obviously, and your 2nd transformation looks correct."}, {"owner": {"reputation": 101, "user_id": 5747113, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-rqVv2qSNNfs/AAAAAAAAAAI/AAAAAAAAADk/28TADKB_2Qg/photo.jpg?sz=128", "display_name": "\u898b\u5d0e\u9cf4", "link": "https://stackoverflow.com/users/5747113/%e8%a6%8b%e5%b4%8e%e9%b3%b4"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1452017506, "post_id": 34610962, "comment_id": 56982388, "body": "@WillNess yes, just capture the floated definitions which has same free level with the let(rec) expression and put them together will fix this issue. But I&#39;m not sure if I missed sth when reading the paper or made some mistakes."}], "owner": {"reputation": 101, "user_id": 5747113, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-rqVv2qSNNfs/AAAAAAAAAAI/AAAAAAAAADk/28TADKB_2Qg/photo.jpg?sz=128", "display_name": "\u898b\u5d0e\u9cf4", "link": "https://stackoverflow.com/users/5747113/%e8%a6%8b%e5%b4%8e%e9%b3%b4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 192, "favorite_count": 2, "answer_count": 0, "score": 10, "last_activity_date": 1452013655, "creation_date": 1451994294, "last_edit_date": 1452013655, "question_id": 34610962, "link": "https://stackoverflow.com/questions/34610962/floating-pass-of-fully-lazy-lambda-lifting", "title": "floating pass of fully lazy lambda lifting?", "body": "<p>I'm reading <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/Papers/pj-lester-book/\">implementing functional languages: a tutorial</a>, and encountered a problem when implementing floating pass of fully lazy lambda lifting.</p>\n\n<p>I would like to describe how floating works to make this question clear, if you are familiar with it, <strong>just skip to the question below</strong>.</p>\n\n<p>The concept is introduced at page 246 in the paper, and mainly implemented at page 256-257.</p>\n\n<p>In case of <code>let(rec)</code> expression, it says:</p>\n\n<blockquote>\n  <p>we must put floated definitions of right-hand side before the <code>let(rec)</code> expression itself, since the right-hand side may depend on them.</p>\n</blockquote>\n\n<p>for example:</p>\n\n<pre><code>\\a -&gt;\n  let f = \\b -&gt; b + (let $mfe = a * a in $mfe)\n  in f\n</code></pre>\n\n<p>The variable <code>$mfe</code> is a <em>maximal free expression (MFE)</em> which identified by previous pass, when dealing with <code>let f</code> expression, we float <code>f</code> out as one group and append it to <code>[(1, [($mfe, a * a)])]</code>, which was obtained from right-hand side of <code>let f</code>. Here, the first component <code>1</code> indicates the <em>free level</em> of the group.</p>\n\n<p>When backtracking to <code>\\a -&gt; f</code> abstraction, we found that both <code>$mfe</code> and <code>f</code> are bound by it, hence we should install them here:</p>\n\n<pre><code>\\a -&gt;\n  let $mfe = a * a\n  in\n    let f = \\b -&gt; b + $mfe\n    in f\n</code></pre>\n\n<h1>The Question</h1>\n\n<p>Suppose we have a program like this:</p>\n\n<pre><code>f = \\x -&gt; \\y -&gt;\n  letrec\n    a = \\p -&gt; cons p (b x)\n    b = \\q -&gt; cons q (a y)\n  in pair (a 1) (b 2)\n</code></pre>\n\n<p>The <em>free level</em> of <code>b x</code> and <code>a y</code> will be 2, since <code>y</code> has level 2 and they are in a same group.</p>\n\n<p>While <em>free level</em> of <code>cons p (b x)</code> and <code>cons q (a y)</code> is 3, thus <code>b x</code> and <code>a y</code> will be marked as MFEs (Did I make mistakes here?).</p>\n\n<p>Using the algorithm given by SPJ, the program will be transformed into:</p>\n\n<pre><code>f = \\x -&gt; \\y -&gt;\n  let $ay = a y -- `a` is not defined yet!\n  in\n    let $bx = b x -- and `b`\n    in\n      letrec\n        a = \\p -&gt; cons p $bx\n        b = \\q -&gt; cons q $ay\n      in pair (a 1) (b 2)\n</code></pre>\n\n<p>I think the MFEs in the right-hand side of <code>let(rec)</code> expression should <strong>not</strong> escape the <code>let(rec)</code> scope whenever it referenced to the left-hand side, and the correct result might like this:</p>\n\n<pre><code>f = \\x -&gt; \\y -&gt;\n  letrec\n    $ay = a y\n    $bx = b x\n    a = \\p -&gt; cons p $bx\n    b = \\q -&gt; cons q $ay\n  in pair (a 1) (b 2)\n</code></pre>\n\n<p>Does the paper wrong? or I just misunderstood it.</p>\n"}, {"tags": ["haskell", "dependent-type"], "answers": [{"comments": [{"owner": {"reputation": 169, "user_id": 711316, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/fa662528f2f8ecddad27a568d037d80f?s=128&d=identicon&r=PG", "display_name": "dfordivam", "link": "https://stackoverflow.com/users/711316/dfordivam"}, "edited": false, "score": 0, "creation_date": 1451994429, "post_id": 34610295, "comment_id": 56966903, "body": "Thanks chi! this works. But I would really like to not put this in every API. So using type classes would be much better. I tried to implement one using the answer you gave in another post, but still could not understand how to do it :( Can you post an answer using type classes also ?"}, {"owner": {"reputation": 169, "user_id": 711316, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/fa662528f2f8ecddad27a568d037d80f?s=128&d=identicon&r=PG", "display_name": "dfordivam", "link": "https://stackoverflow.com/users/711316/dfordivam"}, "edited": false, "score": 0, "creation_date": 1451994627, "post_id": 34610295, "comment_id": 56967016, "body": "I tried to get something like this to work <code>intermediate_func :: (IsB b) =&gt; Int -&gt; D b</code>"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1451999009, "post_id": 34610295, "comment_id": 56969752, "body": "I think I understand why, but I still find it a bit disappointing that <a href=\"https://gist.github.com/rampion/704d3b906e937b931793\" rel=\"nofollow noreferrer\">using data kinds to restrict the domain of <code>RestT</code> to <code>B1</code> or <code>B2</code> doesn&#39;t satisfy the proof obligation</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1451999122, "post_id": 34610295, "comment_id": 56969818, "body": "@rampion Indeed. In a true dependently typed language you could pattern match over the kind. In Haskell we need auxiliary singletons / type classes, which is more burdensome."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1451999039, "last_edit_date": 1495541722, "creation_date": 1451992271, "answer_id": 34610295, "question_id": 34610054, "link": "https://stackoverflow.com/questions/34610054/haskell-how-to-construct-object-having-dependent-types/34610295#34610295", "title": "Haskell how to construct object having dependent types", "body": "<p>You need a proof that <code>b</code> is either <code>B1</code> or <code>B2</code>, and not anything else. As written, one might call <code>intermediate_func :: Int \u2192  D String</code>.</p>\n\n<p>You can pass such proof through a singleton:</p>\n\n<pre><code>data S b where\n   SB1 :: S B1\n   SB2 :: S B2\n\nintermediate_func :: S b \u2192 Int \u2192  D b\nintermediate_func SB1 i = D2 (C1 i) (C1 i)\nintermediate_func SB2 i = D2 (C1 i) (C1 i)\n</code></pre>\n\n<p>If you want to hide the singleton argument of type <code>S b</code>, check out <a href=\"https://stackoverflow.com/q/34575361/3234959\">this recent question</a>. You can achieve that using type classes. E.g.</p>\n\n<pre><code>class CB b where getSB :: S b\ninstance CB B1 where getSB = SB1\ninstance CB B2 where getSB = SB2\n\nintermediate_func :: SB b \u2192 Int \u2192 D b\nintermediate_func SB1 i = D2 (C1 i) (C1 i)\nintermediate_func SB2 i = D2 (C1 i) (C1 i)\n\nintermediate_func_short :: CB b =&gt; Int \u2192 D b\nintermediate_func_short = intermediate_func getSB\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1451998789, "creation_date": 1451998789, "answer_id": 34612353, "question_id": 34610054, "link": "https://stackoverflow.com/questions/34610054/haskell-how-to-construct-object-having-dependent-types/34612353#34612353", "title": "Haskell how to construct object having dependent types", "body": "<p>A solution using type classes:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}                                                                                             \n{-# LANGUAGE TypeFamilies #-}                                                                                      \nmodule Temp where                                                                                                  \n\ndata A1                                                                                                            \ndata A2                                                                                                            \ndata B1                                                                                                            \ndata B2                                                                                                            \n\ndata C a b where                                                                                                   \n  C1 :: Int -&gt;  C a b                                                                                              \n  C2 :: Char -&gt;  C A1 b                                                                                            \n  C3 :: Bool -&gt;  C A1 B1                                                                                           \n\nclass Intermediate b where                                                                                         \n  type ResT b                                                                                                      \n  intermediate_func :: Int -&gt;  D b                                                                                 \n\ndata D b where                                                                                                     \n  D1 :: ResT B1 -&gt;  C A1 B1 -&gt;  D B1                                                                               \n  D2 :: ResT b -&gt;  C A1 b -&gt;  D b                                                                                  \n\ninstance Intermediate B1 where                                                                                     \n  type ResT B1 = C A1 B1                                                                                           \n  intermediate_func i = D2 (C1 i) (C1 i)                                                                           \n\ninstance Intermediate B2 where                                                                                     \n  type ResT B2 = C A2 B2                                                                                           \n  intermediate_func i = D2 (C1 i) (C1 i)                                                                           \n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 711316, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/fa662528f2f8ecddad27a568d037d80f?s=128&d=identicon&r=PG", "display_name": "dfordivam", "link": "https://stackoverflow.com/users/711316/dfordivam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 34610295, "answer_count": 2, "score": 0, "last_activity_date": 1451999039, "creation_date": 1451991561, "question_id": 34610054, "link": "https://stackoverflow.com/questions/34610054/haskell-how-to-construct-object-having-dependent-types", "title": "Haskell how to construct object having dependent types", "body": "<p>I have used type family in the data 'D' to constraint the type of first item in it.\nNow I need to create object of either type 'D B1' or 'D B2' from some common functions (like intermediate_func). But the below code does not work.\nAny suggestions how to do this? or to put similar constraints in another manner.</p>\n\n<pre><code>data A1 = A1\ndata A2 = A2\n\ndata B1 = B1\ndata B2 = B2\n\ndata C a b where\n  C1 :: Int \u2192  C a b\n  C2 :: Char \u2192  C A1 b\n  C3 :: Bool \u2192  C A1 B1\n\ntype family ResT b where\n  ResT B1 = C A1 B1\n  ResT B2 = C A2 B2\n\ndata D b where\n  D1 :: ResT B1 \u2192  C A1 B1 \u2192  D B1\n  D2 :: ResT b \u2192  C A1 b \u2192  D b\n\n-- This does not compile\nintermediate_func :: Int \u2192  D b\nintermediate_func i = D2 (C1 i) (C1 i)\n\n-- This works\n-- intermediate_func :: Int -&gt; D B2\n-- intermediate_func i = D2 (C1 i) (C1 i)\n-- So does this\n-- intermediate_func :: Int -&gt; D B1\n-- intermediate_func i = D2 (C1 i) (C1 i)\n</code></pre>\n"}, {"tags": ["haskell", "yesod", "hamlet"], "answers": [{"comments": [{"owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "edited": false, "score": 0, "creation_date": 1451995425, "post_id": 34610557, "comment_id": 56967507, "body": "Thanks Mark. Apologies if my question is not very clear, but among the code&#39;s three consecutive instructions : <code>toWidget ham1</code>, <code>toWidget ham2</code> and <code>ham2</code>, <code>toWidget ham2</code> is the one I do not understand, type-wise, since ham2 is already defined as a <code>toWidget something</code> type, so <code>toWidget ham2</code> seems to &quot;compound&quot; toWidget twice into a <code>toWidget (toWidget something)</code>. (I&#39;ll try to find ways to clarify my question and will edit it)"}, {"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "reply_to_user": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "edited": false, "score": 0, "creation_date": 1451995704, "post_id": 34610557, "comment_id": 56967668, "body": "@JeanAnthelme, <code>Widget</code> is instance of <code>ToWidget</code> (which may be consfusing from certain point of view), so you can do <code>toWidget widget</code> where <code>widget</code> is already a <code>Widget</code>."}, {"owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "edited": false, "score": 0, "creation_date": 1451995924, "post_id": 34610557, "comment_id": 56967787, "body": "thanks. Yes I agree, and my question is equivalent to &quot;is Widget an instance of ToWidget&quot;, which I could not understand immediately from ToWidget&#39;s instance definition, but you put me on the right tracks and I&#39;ll go through it again."}], "tags": [], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "is_accepted": false, "score": 2, "last_activity_date": 1451994251, "last_edit_date": 1451994251, "creation_date": 1451993078, "answer_id": 34610557, "question_id": 34609651, "link": "https://stackoverflow.com/questions/34609651/confusion-about-yesod-widget-related-types/34610557#34610557", "title": "Confusion About Yesod Widget Related Types", "body": "<p>I'm not entirely sure what's being asked, so I'll just explain how it works,\nI hope it'll be relevant.</p>\n\n<p><code>defaultLayout</code> takes a widget to put it in well\u2026 default layout. Thus your\n<code>do</code>-block combines widgets monadically. To pass type-checker, every line in\nthat <code>do</code>-block should be of type <code>Widget a</code> (or <code>WidgetT App IO a</code>, is your\nsite's data type is <code>App</code>). Instances of <code>ToWidget</code> are things that can be\ntransformed to widgets. <code>Widget</code>s are instances of this type class, as well\nas <code>render -&gt; Html</code> things. Given that <code>Html</code> is a type synonym for\n<code>Text.Blaze.Internal.Markup</code>, your <code>ham1</code> is a perfect candidate to be\npassed to <code>toWidget</code>, see in source code:</p>\n\n<pre><code>instance render ~ RY site =&gt; ToWidget site (render -&gt; Html) where\n    toWidget x = \u2026\n</code></pre>\n\n<p><code>(~)</code> puts additional constraint, it tells type checker (after this instance\nis already chosen by it) that by the way <code>render</code> must have type <code>RY site</code>.\n<code>site</code> a phantom type, it ensures that different parts of system\nbelong to the same site, it's usually <code>App</code> if you're using scaffolding.\n<code>RY site</code> uses another type-synonym <code>RY</code> passing it <code>site</code> variable, it results\nin type like this:</p>\n\n<pre><code>Route App -&gt; [(Text, Text)] -&gt; Text\n</code></pre>\n\n<p>This is the type of argument <code>ham1</code> takes.</p>\n\n<p>So those instances allow you to transform different things into widgets,\nincluding functions like that produced by <code>hamlet</code> quasi-quoter, no magic\nhere.</p>\n"}], "owner": {"reputation": 896, "user_id": 2518338, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/a6ab599e92773610e7eed102bd4e2499?s=128&d=identicon&r=PG", "display_name": "Janthelme", "link": "https://stackoverflow.com/users/2518338/janthelme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451994251, "creation_date": 1451990355, "last_edit_date": 1451992137, "question_id": 34609651, "link": "https://stackoverflow.com/questions/34609651/confusion-about-yesod-widget-related-types", "title": "Confusion About Yesod Widget Related Types", "body": "<p>I have just started playing with Yesod, and although I can already get some interesting results, I am struggling understanding clearly some of its types (maybe because I am not familiar with Template Haskell). </p>\n\n<p>The <a href=\"http://www.yesodweb.com/book/widgets#widgets_constructing_widgets\" rel=\"nofollow noreferrer\">usual way</a> to pass a hamlet snippet to the defaultLayout function is via the toWidget function. So following the definitions of ham1 and ham2 below, the proper instructions within defaultLayout are respectively <code>toWidget ham1</code> and <code>ham2</code>.</p>\n\n<p><strong>My question:</strong> In the following (working) code why does the instruction <code>toWidget ham2</code> compile, while it is a very different animal from ham1? I guess that it means that both ham1's type (<code>ham1 :: t -&gt; Text.Blaze.Internal.Markup</code> <strong>(*)</strong>) and ham2's type (<code>ham2 :: Widget</code>) are instances of the ToWidget class but that's not completely obvious to me when reading this <a href=\"http://haddock.stackage.org/nightly-2016-01-05/yesod-core-1.4.18.1/Yesod-Core-Widget.html#t:ToWidget\" rel=\"nofollow noreferrer\">class' instance definitions</a>.</p>\n\n<p><strong>(*)</strong> Also, it'd be great if someone could let me know if there is a \"nicer\" type synonym than <code>t -&gt; Text.Blaze.Internal.Markup</code> for ham1.</p>\n\n<p>Code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n\nmodule Main where\n\nimport Yesod\nimport Text.Blaze.Internal (Markup)\n\ndata App = App\ninstance Yesod App\n\nmkYesod \"App\" [parseRoutes|\n/ HomeR GET\n|]\n\ngetHomeR :: Handler Html\ngetHomeR = defaultLayout $ do\n    setTitle \"Some Title\"\n\n    toWidget ham1   -- usual way to produce a Widget from hamlet snippet\n    toWidget ham2   -- ??\n    ham2            -- already of type Widget\n\n\nham1 :: t -&gt; Text.Blaze.Internal.Markup -- explicit signature for reference only\nham1 = [hamlet|\n&lt;h1&gt; 1) Hello\n&lt;h2&gt; World!\n |]\n\nham2 :: Widget\nham2 = \n    toWidget [hamlet|\n&lt;h1&gt; 2) Hello\n&lt;h2&gt; World!\n |]\n\nmain :: IO ()\nmain = do\n    warp 3000 App\n</code></pre>\n\n<p>Output :</p>\n\n<p><a href=\"https://i.stack.imgur.com/9AXus.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/9AXus.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "types", "data-kinds"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1451993132, "post_id": 34610329, "comment_id": 56966088, "body": "In other words, promoted constructors are never exported \u2013 rather, the ordinary constructors are only promoted whereever you import them."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1451992423, "creation_date": 1451992423, "answer_id": 34610329, "question_id": 34608911, "link": "https://stackoverflow.com/questions/34608911/how-to-export-type-constructors-when-using-datakinds-extension/34610329#34610329", "title": "How to export type constructors when using DataKinds extension?", "body": "<p>Use the usual syntax for exporting constructors:</p>\n\n<pre><code>module MyModule (Subject(..)) where\n\ndata Subject = New | Existing\n</code></pre>\n\n<p>Currently, lifted and unlifted constructors are tied together, so we can only export/import them together. </p>\n\n<p>Also, you don't need to have <code>DataKinds</code> in <code>MyModule</code>, only in the module where you intend to use lifted constructors. </p>\n"}], "owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 344, "favorite_count": 2, "accepted_answer_id": 34610329, "answer_count": 1, "score": 5, "last_activity_date": 1451992423, "creation_date": 1451988310, "last_edit_date": 1451989643, "question_id": 34608911, "link": "https://stackoverflow.com/questions/34608911/how-to-export-type-constructors-when-using-datakinds-extension", "title": "How to export type constructors when using DataKinds extension?", "body": "<p>Playing with advanced type-system stuff. I want to have named kind and a\ncouple of type constructors that produce types of that kind:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n\ndata Subject = New | Existing\n</code></pre>\n\n<p>Here, as I understand, we have named kind <code>Subject</code> and type constructors\n<code>New</code> and <code>Existing</code> that are <code>:: Subject</code>. These type constructors do not\ntake arguments (I plan to use them as phantom types), it should be roughly\nequivalent to:</p>\n\n<pre><code>{-# LANGUAGE EmptyDataDecls #-}\n\ndata New\ndata Existing\n</code></pre>\n\n<p>With the difference that now I can write:</p>\n\n<pre><code>{-# LANGUAGE DataKinds      #-}\n{-# LANGUAGE GADTs          #-}\n{-# LANGUAGE KindSignatures #-}\n\n-- \u2026\n\ndata MyConfig :: Subject -&gt; * -&gt; * where\n  MyConfig\n    { mcOneThing :: Path t File\n    } :: MyConfig k t\n</code></pre>\n\n<p>This even compiles. What is confusing is that declaration of data kinds is\nindistinguishable from data type declarations, so this code seems to produce\ndata type <code>Subject</code> as well as named kind <code>Subject</code> (?) It would be clearer\nfor me it we could specify on which level do we declare things (kinds, and\nthen <code>New</code> and <code>Existing</code> are type constructors; or types, and then <code>New</code>\nand <code>Existing</code> are value constructors for things of <code>Subject</code> type). I don't\nget this design decision with \u201cpromote everything that seems to work\u201d.</p>\n\n<p>Now, my problem is that I cannot export <code>New</code> and <code>Existing</code> as\ntype-constructors to use in other module, e.g. to declare things like:</p>\n\n<pre><code>foo :: MyConfig New Dir -&gt; \u2026\n</code></pre>\n\n<p>where at the same time</p>\n\n<pre><code>foo :: MyConfig Int Dir -&gt; \u2026\n</code></pre>\n\n<p>should be ill-kinded and it should not compile.</p>\n\n<p>Here is how I'm trying to export them:</p>\n\n<pre><code>module MyModule\n  ( New\n  , Existing\n  -- \u2026\n  )\nwhere\n</code></pre>\n\n<p>What I get:</p>\n\n<blockquote>\n  <p>Not in scope type constructor or class \u2018New\u2019</p>\n  \n  <p>Not in scope type constructor or class \u2018Existing\u2019</p>\n</blockquote>\n\n<p>GHC manual in\n<a href=\"https://downloads.haskell.org/~ghc/7.10.3/docs/html/users_guide/promotion.html#promotion-syntax\" rel=\"nofollow\">section 7.9.3</a>\nsays that to distinguish between \u201ctypes and constructors\u201d one can use single quote <code>'</code>, so I tried:</p>\n\n<pre><code>module MyModule\n  ( 'New\n  , 'Existing\n  -- \u2026\n  )\nwhere\n</code></pre>\n\n<p>\u2026but now it's a parse error.</p>\n\n<hr>\n\n<p>How do I export <code>New</code> and <code>Existing</code> type constructors, and most\nimportantly, is there anything wrong with my current understanding?</p>\n"}, {"tags": ["haskell", "monads", "io-monad"], "answers": [{"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451987156, "post_id": 34608411, "comment_id": 56962054, "body": "As far as I understand the situation, yes. I think however you better get some insights in Monads because everything that has to do with IO in Haskell requires some knowledge of Monads."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1451987315, "last_edit_date": 1451987315, "creation_date": 1451986835, "answer_id": 34608411, "question_id": 34608331, "link": "https://stackoverflow.com/questions/34608331/haskell-couldnt-match-expected-type-io-b-with-actual-type-bool/34608411#34608411", "title": "Haskell: Couldn&#39;t match expected type &#39;IO b&#39; with actual type bool", "body": "<p>The problem is that your function <code>gameFunc</code> uses a do expression which is syntactical sugar for a <em>monad</em> (in this case the <code>IO</code> monad). You can turn any non-monadic result into a monadic one by using the <code>return</code> function:</p>\n\n<pre><code>return :: Monad m =&gt; a -&gt; m a\n</code></pre>\n\n<p>So you can rewrite your <code>gameFunc</code> to (see last line):</p>\n\n<pre><code>gameFunc = do\n  s &lt;- readFile \"projekt-board.txt\"\n  let content = lines s\n  printTable content\n  printHelp\n  return $ upCheck [\"########\",\"#11xxx3#\",\"#xx2xx3\",\"#002xx3\",\"#7x2x44#\"] 2 [2,3,4]\n</code></pre>\n\n<p>Now <code>gameFunc</code> has the type <code>IO Bool</code>. You can use <code>gameFunc</code> in other monadic environment like:</p>\n\n<pre><code>main = do\n    b &lt;- gameFunc\n    print b\n</code></pre>\n\n<p>in order to print the result of <code>gameFunc</code>.</p>\n"}], "owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1419, "favorite_count": 0, "accepted_answer_id": 34608411, "answer_count": 1, "score": 1, "last_activity_date": 1451987315, "creation_date": 1451986571, "last_edit_date": 1451986850, "question_id": 34608331, "link": "https://stackoverflow.com/questions/34608331/haskell-couldnt-match-expected-type-io-b-with-actual-type-bool", "title": "Haskell: Couldn&#39;t match expected type &#39;IO b&#39; with actual type bool", "body": "<p>I get the following error:</p>\n\n<pre><code>Couldn't match expected type `IO b' with actual type `Bool'\nIn the expression:\n  upCheck\n    [\"########\", \"#11xxx3#\", \"#xx2xx3\", \"#002xx3\", ....] 2 [2, 3, 4]\nIn the expression:\n  do { s &lt;- readFile \"projekt-board.txt\";\n       let content = lines s;\n       printTable content;\n       printHelp;\n       .... }\nIn an equation for `gameFunc':\n    gameFunc\n      = do { s &lt;- readFile \"projekt-board.txt\";\n             let content = ...;\n             printTable content;\n             .... }\n</code></pre>\n\n<p>With the definition for <code>gameFunc</code>:</p>\n\n<pre><code>gameFunc = do\n  s &lt;- readFile \"projekt-board.txt\"\n  let content = lines s\n  printTable content\n  printHelp\n  upCheck [\"########\",\"#11xxx3#\",\"#xx2xx3\",\"#002xx3\",\"#7x2x44#\"] 2 [2,3,4] \n</code></pre>\n\n<p>and function <code>upCheck</code>:</p>\n\n<pre><code>upCheck :: [[Char]] -&gt; Int -&gt; [Int] -&gt; Bool\nupCheck tableArr number posArr = do\n  --posArr saadakse findBlock funktsiooniga\n  let arv = findVIndex (findVertIndex tableArr number)\n  let str = tableArr !! (posArr !! 0)\n  if ((posArr !! 0) == 1)\n  then False\n  else if arv == (-1)\n    then False\n    else if isHorizontal str number\n      then False\n      else if (tableArr !! ((posArr !! 0)-1)) !! arv /= 'x'\n        then False\n        else True\n</code></pre>\n\n<p>So basically what is happening here is that <code>upCheck</code> is a function to check whether some conditions are matched and when I call it out the same way from ghci as i call it out from the function <code>gameFunc</code>, i will get a result <code>True</code>. However, if I call it out from the function <code>gameFunc</code> I get an error described above. Any ideas what went wrong?</p>\n"}, {"tags": ["python", "haskell", "foldable"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1451986418, "post_id": 34608165, "comment_id": 56961595, "body": "I&#39;m not familiar with Haskell, but it sounds like the Python equivalent is a <code>for</code> loop. Python&#39;s functional features are specifically not designed for operations with side effects."}], "answers": [{"comments": [{"owner": {"reputation": 1932, "user_id": 1784267, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/172e98db79964f9e6e4969e9f4afc452?s=128&d=identicon&r=PG", "display_name": "phaazon", "link": "https://stackoverflow.com/users/1784267/phaazon"}, "edited": false, "score": 0, "creation_date": 1451986779, "post_id": 34608277, "comment_id": 56961802, "body": "It\u2019s not monadic, it\u2019s applicative. I should edit my post. Thanks anyways :)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1451986399, "creation_date": 1451986399, "answer_id": 34608277, "question_id": 34608165, "link": "https://stackoverflow.com/questions/34608165/traverse-equivalent-in-python/34608277#34608277", "title": "traverse_ equivalent in Python?", "body": "<p>Wouldn't this simply be a higher order function that takes as input a function a function <code>f</code>, a list <code>l</code> and calls <code>f</code> on all lists:</p>\n\n<pre><code>def traverse_ (f,l) :\n    for li in l :\n        f(li)\n</code></pre>\n\n<p>This will work on lists, tuples, generators, strings,... Which can be seen as a bit the equivalent of <code>Foldable</code>.</p>\n\n<p>Using this in <code>python3</code> gives:</p>\n\n<pre><code>$ python3\nPython 3.4.3 (default, Mar 26 2015, 22:03:40) \n[GCC 4.9.2] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; def traverse_ (f,l) :\n...     for li in l :\n...         f(li)\n... \n&gt;&gt;&gt; traverse_(print,[\"Hello, \",\"world!\"])\nHello, \nworld!\n</code></pre>\n\n<p><code>traverse_</code> thus basically comes down to a monadic <code>for</code> loop I think. Where the Applicative is performed on all items.</p>\n"}, {"tags": [], "owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "is_accepted": false, "score": 0, "last_activity_date": 1451986566, "creation_date": 1451986566, "answer_id": 34608330, "question_id": 34608165, "link": "https://stackoverflow.com/questions/34608165/traverse-equivalent-in-python/34608330#34608330", "title": "traverse_ equivalent in Python?", "body": "<p>Not sure I understand it correctly, but may be you're looking for a <code>map</code> wrapper:</p>\n\n<pre><code>def traverse(f):\n    return lambda L : map(f, L)\n\nprint traverse(lambda x : x*x) (range(5)) # [0, 1, 4, 9, 16]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1932, "user_id": 1784267, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/172e98db79964f9e6e4969e9f4afc452?s=128&d=identicon&r=PG", "display_name": "phaazon", "link": "https://stackoverflow.com/users/1784267/phaazon"}, "edited": false, "score": 0, "creation_date": 1451986858, "post_id": 34608346, "comment_id": 56961852, "body": "Ok for the loop, but the two later would actually yield a list, right? A list of <code>None</code>?"}, {"owner": {"reputation": 44584, "user_id": 2617068, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0nSBO.png?s=128&g=1", "display_name": "TigerhawkT3", "link": "https://stackoverflow.com/users/2617068/tigerhawkt3"}, "reply_to_user": {"reputation": 1932, "user_id": 1784267, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/172e98db79964f9e6e4969e9f4afc452?s=128&d=identicon&r=PG", "display_name": "phaazon", "link": "https://stackoverflow.com/users/1784267/phaazon"}, "edited": false, "score": 0, "creation_date": 1451987182, "post_id": 34608346, "comment_id": 56962079, "body": "That&#39;s right, because the calls have to actually be evaluated. Technically, <code>print()</code> also has a return value - <code>None</code>. You just don&#39;t see <code>None</code> in the interpreter after a <code>print()</code> call because it specifically skips the output if it&#39;s just <code>None</code> - you&#39;d have to print it if you wanted to see it (try <code>print(print(&#39;hi&#39;))</code>). It outputs <code>[None, None]</code> because that&#39;s not just <code>None</code>, it&#39;s a <code>list</code>. Again, this is just in the interactive interpreter. It&#39;s not an issue in a saved script."}], "tags": [], "owner": {"reputation": 44584, "user_id": 2617068, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/0nSBO.png?s=128&g=1", "display_name": "TigerhawkT3", "link": "https://stackoverflow.com/users/2617068/tigerhawkt3"}, "is_accepted": false, "score": 2, "last_activity_date": 1451986626, "creation_date": 1451986626, "answer_id": 34608346, "question_id": 34608165, "link": "https://stackoverflow.com/questions/34608165/traverse-equivalent-in-python/34608346#34608346", "title": "traverse_ equivalent in Python?", "body": "<p>Just use a simple loop, or <code>list(map(...))</code> or a comprehension, and don't save references.</p>\n\n<p>For <code>traverse_ putStrLn [\"Hello, \",\"world!\"]</code>:</p>\n\n<pre><code>for i in [\"Hello, \", \"world!\"]:\n    print(i)\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>list(map(print, [\"Hello, \", \"world!\"]))\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>[print(i) for i in [\"Hello, \", \"world!\"]\n</code></pre>\n\n<p>Note that <code>list(map(...))</code> and the comprehension will output the returned value <code>[None, None]</code> if you use it at the interactive interpreter. If you want to suppress it there, save a reference. If you use it in a saved script, you don't need to save a reference to suppress the output of the returned value.</p>\n"}], "owner": {"reputation": 1932, "user_id": 1784267, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/172e98db79964f9e6e4969e9f4afc452?s=128&d=identicon&r=PG", "display_name": "phaazon", "link": "https://stackoverflow.com/users/1784267/phaazon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1451986798, "creation_date": 1451986035, "last_edit_date": 1451986798, "question_id": 34608165, "link": "https://stackoverflow.com/questions/34608165/traverse-equivalent-in-python", "title": "traverse_ equivalent in Python?", "body": "<p>In <em>Haskell</em>, we have <code>traverse_</code>, a function that works on <code>Foldable</code> types to fold a structure with an <em>applicative function</em>, discarding any result:</p>\n\n<pre><code>traverse_ :: (Applicative f,Foldable t) =&gt; (a -&gt; f b) -&gt; t a -&gt; f ()\n</code></pre>\n\n<p>So we can for instance do this:</p>\n\n<pre><code>traverse_ putStrLn [\"Hello, \",\"world!\"]\ntraverse_ print (Just 3)\n</code></pre>\n\n<p>What is the <em>Python</em> equivalent to <code>traverse_</code>? At least for lists?</p>\n"}, {"tags": ["haskell", "haskell-vector"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451975160, "post_id": 34604313, "comment_id": 56956302, "body": "Why do you want that <code>Vector</code> constraint? It doesn&#39;t seem to have any purpose."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451975554, "post_id": 34604313, "comment_id": 56956428, "body": "@dfeuer: Oh, yeah, you&#39;re right.  When I remove it, however, I still do get the <code>NFData v (Entry a)</code> error if I don&#39;t use the extension.  I&#39;ll edit the question."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451975635, "post_id": 34604313, "comment_id": 56956464, "body": "Also, why are you wary of <code>UndecidableInstances</code>? Haskell has a really pitiful excuse for a termination checker."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451975916, "post_id": 34604313, "comment_id": 56956572, "body": "@dfeuer: Not out of any actual knowledge, but rather because &quot;undecidable&quot; is a scary word."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1452110772, "last_edit_date": 1452110772, "creation_date": 1451976921, "answer_id": 34605808, "question_id": 34604313, "link": "https://stackoverflow.com/questions/34604313/is-there-a-way-to-avoid-undecidableinstances-in-this-example/34605808#34605808", "title": "Is there a way to avoid UndecidableInstances in this example?", "body": "<p>Warning: I haven't tested any of this code.</p>\n\n<p>The approach that seems cleanest to me is to follow a <code>Prelude.Extras</code>-style path:</p>\n\n<pre><code>class NFData1 f where\n  rnf1 :: NFData a =&gt; f a -&gt; ()\n</code></pre>\n\n<p>You can now write, for each vector type, something like</p>\n\n<pre><code>instance NFData1 V where\n  rnf1 = rnf\n</code></pre>\n\n<p>And then</p>\n\n<pre><code>instance (NFData1 v, NFData a) =&gt; NFData (DenseIntMap v a) where ...\n</code></pre>\n\n<hr>\n\n<p>An alternative approach that may fit your current code better is to think about <code>v</code> as a <code>Vector</code> explicitly. Instead of worrying about how <code>v a</code> would prefer to force itself, ram your own notion down its throat by folding: something like</p>\n\n<pre><code>instance (Vector v a, NFData a) =&gt; NFData (DenseIntMap v a) where\n  rnf = V.foldl' (\\() e -&gt; rnf e) ()\n</code></pre>\n\n<p>This second approach seems likely to play poorly with vector fusion unless you're careful about which vectors you want to force from left to right and which from right to left.</p>\n"}], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "accepted_answer_id": 34605808, "answer_count": 1, "score": 0, "last_activity_date": 1452110772, "creation_date": 1451969131, "last_edit_date": 1451975648, "question_id": 34604313, "link": "https://stackoverflow.com/questions/34604313/is-there-a-way-to-avoid-undecidableinstances-in-this-example", "title": "Is there a way to avoid UndecidableInstances in this example?", "body": "<p>When I try this:</p>\n\n<pre><code>import GHC.Generics (Generic)\nimport Control.DeepSeq (NFData(..))\nimport Data.Vector.Generic (Vector)\n\ndata Entry a = Entry !Bool a\n             deriving (Generic, NFData)\n\n-- The variable @v@ is meant to be instantiated with a 'Vector'\n-- type.  Most operations for the type have a @Vector v (Entry a)@\n-- constraint.\nnewtype DenseIntMap v a = DenseIntMap (v (Entry a))\n\ninstance NFData (v (Entry a)) =&gt; NFData (DenseIntMap v a) where\n  rnf (DenseIntMap va) = rnf va\n</code></pre>\n\n<p>...I get this error:</p>\n\n<pre><code>/Users/casillas/GitHub/tau-sigma/src/TauSigma/Util/DenseIntMap.hs:53:10:\n    Constraint is no smaller than the instance head\n      in the constraint: Vector v (Entry a)\n    (Use UndecidableInstances to permit this)\n    In the instance declaration for \u2018NFData (DenseIntMap v a)\u2019\n\n/Users/casillas/GitHub/tau-sigma/src/TauSigma/Util/DenseIntMap.hs:53:10:\n    Constraint is no smaller than the instance head\n      in the constraint: NFData (v (Entry a))\n    (Use UndecidableInstances to permit this)\n    In the instance declaration for \u2018NFData (DenseIntMap v a)\u2019\n</code></pre>\n\n<p>Using <code>UndecidableInstances</code> indeed makes it go away, but I'm wary of using that extension.  Is there some other way to make things work in this case?  (Without changing the types too much, preferably.)</p>\n"}, {"tags": ["haskell", "pcap"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user862787"}, "is_accepted": true, "score": 5, "last_activity_date": 1452043771, "last_edit_date": 1452043771, "creation_date": 1451968927, "answer_id": 34604274, "question_id": 34603107, "link": "https://stackoverflow.com/questions/34603107/decoding-haskell-pcap-header/34604274#34604274", "title": "decoding haskell pcap header", "body": "<p>That library looks as if it's a Haskell version of the libpcap/WinPcap library for C/C++, which means it does nothing more (other than \"being callable from Haskell) tha libpcap/WinPcap does.</p>\n\n<p>I.e., it does absolutely <em>no</em> dissection of the packet data; you're on your own there.  It just hands you raw packet data.</p>\n\n<p>So, yes, you have to analyze the packet bytes yourself, just as you would with a C/C++ program using libpcap/WinPcap.</p>\n\n<p>Some quick Web searching for</p>\n\n<pre><code>\"haskell\" packet analysis\n</code></pre>\n\n<p>found <a href=\"http://hackage.haskell.org/package/Etherbunny\" rel=\"nofollow\">Etherbunny</a>, which is described as \"Currently not very useful, but getting there.\"  It was uploaded almost 8 years ago, and the home page link is broken, and I couldn't find anything more recent, but, hey, it's a start, and it <em>does</em> appear to include code to parse Ethernet, IPv4, and TCP headers.</p>\n"}], "owner": {"reputation": 372, "user_id": 2069580, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7af641215097654ec710c221903c1ba4?s=128&d=identicon&r=PG", "display_name": "djh", "link": "https://stackoverflow.com/users/2069580/djh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 34604274, "answer_count": 1, "score": 1, "last_activity_date": 1452043771, "creation_date": 1451959595, "last_edit_date": 1451961832, "question_id": 34603107, "link": "https://stackoverflow.com/questions/34603107/decoding-haskell-pcap-header", "title": "decoding haskell pcap header", "body": "<p>I am trying to get more information out of <a href=\"https://hackage.haskell.org/package/pcap-0.4.5.2/docs/Network-Pcap.html#t:PktHdr\" rel=\"nofollow\"><code>PktHdr</code></a> in the \n<a href=\"https://hackage.haskell.org/package/pcap\" rel=\"nofollow\">pcap</a> Haskell library.</p>\n\n<p>But it seems like the type does not give me much. How can I get things like source address, destination address and port? Do I have to translate the bytes myself, or am I not reading the doc for this library correctly?</p>\n"}, {"tags": ["mysql", "haskell", "yesod"], "comments": [{"owner": {"reputation": 83063, "user_id": 2310830, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P6rM1.png?s=128&g=1", "display_name": "RiggsFolly", "link": "https://stackoverflow.com/users/2310830/riggsfolly"}, "edited": false, "score": 0, "creation_date": 1451955246, "post_id": 34602574, "comment_id": 56950843, "body": "Please read <a href=\"http://stackoverflow.com/help/on-topic\">What topics can I ask about</a> and <a href=\"http://stackoverflow.com/help/how-to-ask\">How to ask a good question</a> And <a href=\"http://codeblog.jonskeet.uk/2010/08/29/writing-the-perfect-question/\" rel=\"nofollow noreferrer\">the perfect question</a>"}, {"owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "reply_to_user": {"reputation": 83063, "user_id": 2310830, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P6rM1.png?s=128&g=1", "display_name": "RiggsFolly", "link": "https://stackoverflow.com/users/2310830/riggsfolly"}, "edited": false, "score": 0, "creation_date": 1451955447, "post_id": 34602574, "comment_id": 56950908, "body": "@RiggsFolly It may be useful for other users, there are very little resources on the web about this."}, {"owner": {"reputation": 83063, "user_id": 2310830, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P6rM1.png?s=128&g=1", "display_name": "RiggsFolly", "link": "https://stackoverflow.com/users/2310830/riggsfolly"}, "edited": false, "score": 0, "creation_date": 1451955587, "post_id": 34602574, "comment_id": 56950935, "body": "Thats fine, 4 other people have to agree with me for the close to be actioned"}, {"owner": {"reputation": 2501, "user_id": 2868481, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d32920192c6bebcffb83fffd557b9553?s=128&d=identicon&r=PG&f=1", "display_name": "d8d0d65b3f7cf42", "link": "https://stackoverflow.com/users/2868481/d8d0d65b3f7cf42"}, "edited": false, "score": 0, "creation_date": 1451957024, "post_id": 34602574, "comment_id": 56951337, "body": "One actual question here is: what is the reason of GHC&#39;s (a Haskell compiler) error message &quot;cannot match type package-foo:Bar with Bar&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 3, "last_activity_date": 1451993940, "creation_date": 1451993940, "answer_id": 34610848, "question_id": 34602574, "link": "https://stackoverflow.com/questions/34602574/yesod-and-mysql-connection-issue/34610848#34610848", "title": "Yesod and MySQL connection issue", "body": "<p>It looks like you have two versions of a package installed. If you install with Stack, it will ensure that you have just a single version of each package in scope. I go into some detail on describing this situation in <a href=\"http://www.yesodweb.com/blog/2014/09/woes-multiple-package-versions\" rel=\"nofollow\">this blog post</a>.</p>\n"}], "owner": {"reputation": 1336, "user_id": 2801316, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cqx1a.jpg?s=128&g=1", "display_name": "FtheBuilder", "link": "https://stackoverflow.com/users/2801316/fthebuilder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 34610848, "answer_count": 1, "score": -3, "last_activity_date": 1451993940, "creation_date": 1451955166, "question_id": 34602574, "link": "https://stackoverflow.com/questions/34602574/yesod-and-mysql-connection-issue", "title": "Yesod and MySQL connection issue", "body": "<p>I have been looking for a working example on the web to connect <code>Yesod</code> - <code>Persistent</code> to a MySQL db, and I found this <a href=\"https://github.com/yesodweb/yesod/wiki/Example-MySQL-Connection-code\" rel=\"nofollow\">resource on GitHub</a></p>\n\n<pre><code>{-# LANGUAGE EmptyDataDecls             #-}\n{-# LANGUAGE FlexibleContexts           #-}\n{-# LANGUAGE GADTs                      #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses      #-}\n{-# LANGUAGE OverloadedStrings          #-}\n{-# LANGUAGE QuasiQuotes                #-}\n{-# LANGUAGE TemplateHaskell            #-}\n{-# LANGUAGE TypeFamilies               #-}\nimport           Control.Monad.IO.Class  (liftIO)\nimport           Control.Monad.Logger    (runStderrLoggingT)\nimport           Database.Persist\nimport           Database.Persist.MySQL\nimport           Database.Persist.TH\n\nshare [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nPerson\n    name String\n    age Int Maybe\n    address Int\n    deriving Show\nBlogPost\n    title String\n    authorId PersonId\n    deriving Show\n|]\n\nconnectionInfo = defaultConnectInfo { connectPort = 5000,\n                                      connectPassword = \"password\",\n                                      connectDatabase = \"database\"}\n\nmain :: IO ()\nmain = runStderrLoggingT $ withMySQLPool connectionInfo 10 $ \\pool -&gt; liftIO $ do\n         flip runSqlPersistMPool pool $ do\n           printMigration migrateAll\n</code></pre>\n\n<p>When I try out this code with <code>ghci</code> I get the following error:</p>\n\n<pre><code>Prelude&gt; :l test3.hs \n[1 of 1] Compiling Main             ( test3.hs, interpreted )\n\ntest3.hs:35:27:\n    Couldn't match type `persistent-2.2.2.1:Database.Persist.Sql.Types.SqlBackend'\n                  with `SqlBackend'\n    Expected type: Migration\n      Actual type: persistent-2.2.2.1:Database.Persist.Sql.Types.Migration\n    In the first argument of `printMigration', namely `migrateAll'\n    In a stmt of a 'do' block: printMigration migrateAll\n    In the second argument of `($)', namely\n      `do { printMigration migrateAll }'\nFailed, modules loaded: none.\n</code></pre>\n\n<p>And I got stuck in it.</p>\n\n<p>Another question I have is: Has anybody experience with Yesod + MySQL? If yes, I would like to know if it is a good or a problematic choice.</p>\n"}, {"tags": ["linux", "haskell", "amazon-ec2", "haskell-stack"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1451950677, "post_id": 34601661, "comment_id": 56949462, "body": "Perhaps stack has a verbose mode that will show what commands it&#39;s trying to run. Seeing what it passes to ld would probably help with your debugging efforts."}, {"owner": {"reputation": 145, "user_id": 1592289, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0268c867641bc01f28ee03b43c57dc4d?s=128&d=identicon&r=PG", "display_name": "Guillaume Depardon", "link": "https://stackoverflow.com/users/1592289/guillaume-depardon"}, "edited": false, "score": 0, "creation_date": 1453383759, "post_id": 34601661, "comment_id": 57584157, "body": "See <a href=\"https://github.com/commercialhaskell/stack/issues/1603\" rel=\"nofollow noreferrer\">this issue</a> on the stack repository. This guy named <code>ben</code> is about to become famous for being part of a widely distributed GHC binary :)"}], "answers": [{"comments": [{"owner": {"reputation": 7397, "user_id": 27385, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ad2304dd68978c01b9bf45daa6d9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/27385/alex"}, "edited": false, "score": 0, "creation_date": 1483283761, "post_id": 34602069, "comment_id": 70037316, "body": "Don&#39;t suppose you know how this could be done on Ubuntu? There&#39;s no <code>glibc-static</code> AFAIK!"}], "tags": [], "owner": {"reputation": 5289, "user_id": 11002, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e442a53d36f9351aee11b5ecb8369691?s=128&d=identicon&r=PG", "display_name": "tgdavies", "link": "https://stackoverflow.com/users/11002/tgdavies"}, "is_accepted": true, "score": 4, "last_activity_date": 1452062650, "last_edit_date": 1452062650, "creation_date": 1451952026, "answer_id": 34602069, "question_id": 34601661, "link": "https://stackoverflow.com/questions/34601661/statically-linking-haskell-program-using-stack-on-amazon-linux-to-use-on-aws-la/34602069#34602069", "title": "Statically linking Haskell program using stack on Amazon Linux, to use on AWS Lambda", "body": "<p>So what worked for me was:</p>\n\n<p>Add the fpcomplete repo:</p>\n\n<pre><code>curl -sSL https://s3.amazonaws.com/download.fpcomplete.com/centos/7/fpco.repo | \\\nsudo tee /etc/yum.repos.d/fpco.repo\n</code></pre>\n\n<p>Install stack:</p>\n\n<pre><code>sudo yum -y install stack\n</code></pre>\n\n<p>Install ghc:</p>\n\n<pre><code>stack setup\n</code></pre>\n\n<p>Create a new stack project:</p>\n\n<pre><code>stack new lambdatest simple\n</code></pre>\n\n<p>Modify stack.yaml with the following flags:</p>\n\n<pre><code>ghc-options:\n    \"*\": -static -optc-static -optl-static -optl-pthread\n</code></pre>\n\n<p>Install static versions of libraries:</p>\n\n<pre><code>sudo yum install glibc-static\nsudo yum install gmp-static\n</code></pre>\n\n<p>Then run <code>stack build</code> <em>twice</em>!</p>\n\n<p>The resulting executable runs OK on my EC2 instance and also runs on AWS Lambda when started by a Node.js launcher function.</p>\n"}], "owner": {"reputation": 5289, "user_id": 11002, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e442a53d36f9351aee11b5ecb8369691?s=128&d=identicon&r=PG", "display_name": "tgdavies", "link": "https://stackoverflow.com/users/11002/tgdavies"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 594, "favorite_count": 3, "accepted_answer_id": 34602069, "answer_count": 1, "score": 4, "last_activity_date": 1452062650, "creation_date": 1451949608, "last_edit_date": 1451985345, "question_id": 34601661, "link": "https://stackoverflow.com/questions/34601661/statically-linking-haskell-program-using-stack-on-amazon-linux-to-use-on-aws-la", "title": "Statically linking Haskell program using stack on Amazon Linux, to use on AWS Lambda", "body": "<p>I'm trying to build a statically linked 'hello world' Haskell program on an EC2 instance, with a view to running it on AWS Lambda.</p>\n\n<p>My only modification to the 'simple' stack.yaml is:</p>\n\n<pre><code>ghc-options:\n    \"*\": -static -optc-static -optl-static -optl-pthread\n</code></pre>\n\n<p>I first got the following errors:</p>\n\n<pre><code>[ec2-user@ip-172-31-0-238 lambdatest]$ stack build\nlambdatest-0.1.0.0: configure\nConfiguring lambdatest-0.1.0.0...\nlambdatest-0.1.0.0: build\nPreprocessing executable 'lambdatest' for lambdatest-0.1.0.0...\nLinking .stack-work/dist/x86_64-linux/Cabal-1.22.4.0/build/lambdatest/lambdatest ...\n/usr/bin/ld: cannot find -lgmp\n/usr/bin/ld: cannot find -lm\n/usr/bin/ld: cannot find -lrt\n/usr/bin/ld: cannot find -ldl\n/usr/bin/ld: cannot find -lpthread\n/usr/bin/ld: cannot find -lc\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>The first thing I tried was to install gmp-devel:</p>\n\n<pre><code>[ec2-user@ip-172-31-0-238 lambdatest]$ sudo yum install gmp-devel.x86_64\nLoaded plugins: priorities, update-motd, upgrade-helper\nPackage gmp-devel-6.0.0-11.16.amzn1.x86_64 already installed and latest version\nNothing to do\n</code></pre>\n\n<p>but it looks like that isn't the issue.</p>\n\n<p>Next I installed glibc-static and gmp-static, and now the error I see is:</p>\n\n<pre><code>[ec2-user@ip-172-31-0-238 lambdatest]$ stack build\nlambdatest-0.1.0.0: build\nPreprocessing executable 'lambdatest' for lambdatest-0.1.0.0...\nLinking .stack-work/dist/x86_64-linux/Cabal-1.22.4.0/build/lambdatest/lambdatest ...\n/home/ec2-user/.stack/programs/x86_64-linux/ghc-7.10.2/lib/ghc-7.10.2/rts/libHSrts.a(Linker.o): In function `internal_dlopen':\n\nCould not resolve file /home/ben/ghc-7.10.2/rts/Linker.c\n</code></pre>\n\n<p>But when I run the identical 'stack build' command a second time, it completes without error.</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 4, "creation_date": 1451917330, "post_id": 34593030, "comment_id": 56931560, "body": "I&#39;ve installed yesod sites with only 128M (on archlinux) and runs fine. But you should upload precompiled binaries to your production machine. Read how to deploy Yesod <a href=\"http://www.yesodweb.com/book/deploying-your-webapp\" rel=\"nofollow noreferrer\">yesodweb.com/book/deploying-your-webapp</a>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 3, "creation_date": 1451919210, "post_id": 34593030, "comment_id": 56932745, "body": "Try to add swap space: <a href=\"http://stackoverflow.com/a/13106205/1651941\">stackoverflow.com/a/13106205/1651941</a>"}, {"owner": {"reputation": 5787, "user_id": 2331095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/54DTz.png?s=128&g=1", "display_name": "user2331095", "link": "https://stackoverflow.com/users/2331095/user2331095"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1451920810, "post_id": 34593030, "comment_id": 56933756, "body": "@josejuan Is the compile time very long ? I&#39;ve try the quick start guide on my Macbook air 2013 too. The compile/build time is really long. Is this normal ?"}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 0, "creation_date": 1451921388, "post_id": 34593030, "comment_id": 56934133, "body": "As Sibi suggests, add swap. The linked answer suggests 1GB of swap, but you might want that to be 2GB. For good measure, chown the swapfile to root and chmod it to 600. As josejuan suggests, in the long run you may want binary deployment simply because it&#39;s faster, puts less responsibility on your server nodes making deployment to multiple servers less time-consuming."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1451924771, "post_id": 34593030, "comment_id": 56936216, "body": "I have a (very simple) Yesod server that I both compile and run on a Raspberry Pi B with only 512 M in total. Of course, that&#39;s a 32-bit architecture. I definitely needed extra swap for compiling GHC, and I think also for compiling Yesod. The server itself needs 103 MB right now."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1451925632, "post_id": 34593030, "comment_id": 56936707, "body": "@user2331095 yes, compile all needed packages may take long time, stack is other recommended (I love it!) tool that minimize compilation time <a href=\"http://docs.haskellstack.org/en/stable/README.html\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/README.html</a>"}], "owner": {"reputation": 5787, "user_id": 2331095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/54DTz.png?s=128&g=1", "display_name": "user2331095", "link": "https://stackoverflow.com/users/2331095/user2331095"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1451923787, "creation_date": 1451916626, "last_edit_date": 1451923787, "question_id": 34593030, "link": "https://stackoverflow.com/questions/34593030/can-one-install-yesod-with-768-mb-of-ram", "title": "Can one install yesod with 768 MB of RAM?", "body": "<p>I am new to haskell and yesod. I've follow the <a href=\"http://www.yesodweb.com/page/quickstart\" rel=\"nofollow\">quick start guide</a> to install yesod.</p>\n\n<p>But at the 3rd step, when I run <code>stack install yesod-bin cabal-install --install-ghc</code> command, the CPU usage became 100%, and after a while, it throw an error:</p>\n\n<pre><code>~/my-project$ stack install yesod-bin cabal-install --install-ghc\nCabal-1.22.6.0: configure\nProgress: 1/108\n....\n[19 of 79] Compiling Distribution.PackageDescription ( Distribution/PackageDescription.hs, /tmp/stack2919/Cabal-1.22.6.0/.stack-work/dist/x86_64-linux/Cabal-1.22.5.0/setup/Distribution/PackageDescription.o )\n    ghc: out of memory (requested 2097152 bytes)\n</code></pre>\n\n<p>I also find that other program was been killed (a Node.js server)...</p>\n\n<p>Here is my server information:</p>\n\n<pre><code>~/my-project$ lscpu\nArchitecture:          x86_64\nCPU op-mode(s):        32-bit, 64-bit\nByte Order:            Little Endian\nCPU(s):                1\nOn-line CPU(s) list:   0\nThread(s) per core:    1\nCore(s) per socket:    1\nSocket(s):             1\nNUMA node(s):          1\nVendor ID:             GenuineIntel\nCPU family:            6\nModel:                 60\nStepping:              1\nCPU MHz:               2399.996\nBogoMIPS:              4799.99\nHypervisor vendor:     KVM\nVirtualization type:   full\nL1d cache:             32K\nL1i cache:             32K\nL2 cache:              4096K\nNUMA node0 CPU(s):     0\n</code></pre>\n\n<hr>\n\n<pre><code>~/my-project$ free -h\n             total       used       free     shared    buffers     cached\nMem:          741M       276M       465M       2.0M       7.2M        68M\n-/+ buffers/cache:       201M       540M\nSwap:           0B         0B         0B\n</code></pre>\n\n<hr>\n\n<p>However, I can not find any hardware in yesod's official website.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1451911153, "post_id": 34591002, "comment_id": 56927629, "body": "Please always add type signatures to your functions. Not only does this make it much easier for us to understand what you&#39;re trying to do, it will also guide yourself while defining the functions."}, {"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1451913304, "post_id": 34591002, "comment_id": 56928955, "body": "Hey @leftaroundabout , I added type signatures, i think they&#39;re correct (i&#39;m fairly beginner in haskell) and i tried out in ghci with :t to get the signatures."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1451913685, "post_id": 34591002, "comment_id": 56929185, "body": "The signatures look reasonable, but I don&#39;t think you&#39;d still get the same error message (it&#39;s probably a more useful one now!)."}, {"owner": {"reputation": 413, "user_id": 5683109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62c83659808b54d9596183ee00c4eb9b?s=128&d=identicon&r=PG&f=1", "display_name": "I3ck", "link": "https://stackoverflow.com/users/5683109/i3ck"}, "edited": false, "score": 0, "creation_date": 1451913727, "post_id": 34591002, "comment_id": 56929213, "body": "god rid of my answer. misread <code>let str = tableArr !! (posArr !! 0)</code> to be accessing with two indexes, sorry"}, {"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451913738, "post_id": 34591002, "comment_id": 56929223, "body": "I also added a new error message in the end if you didn&#39;t notice at first, could you take a look on that ?"}, {"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451913977, "post_id": 34591002, "comment_id": 56929363, "body": "I think i found the mistake right now, i&#39;m trying to fix it and post back my results."}, {"owner": {"reputation": 413, "user_id": 5683109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62c83659808b54d9596183ee00c4eb9b?s=128&d=identicon&r=PG&f=1", "display_name": "I3ck", "link": "https://stackoverflow.com/users/5683109/i3ck"}, "edited": false, "score": 0, "creation_date": 1451914356, "post_id": 34591002, "comment_id": 56929590, "body": "I need the definition of <code>findVertexIndex</code> then, since I guess this is ill-defined"}], "answers": [{"comments": [{"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451914522, "post_id": 34592337, "comment_id": 56929696, "body": "The problem was actually in findVerticalIndex function which took in [Char] but had to take in [[Char]], after doing a bit reprogramming i managed to reconfigure my things. Thanks for pointing out the usefulness of signatures, i&#39;ll mark you as an answer for your help :)"}, {"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451914585, "post_id": 34592337, "comment_id": 56929740, "body": "So basically let-in works in a manner that whatever is in &quot;let&quot; will be variable definitions and whatever is in <code>in</code> is for &quot;calculations&quot;?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451914918, "post_id": 34592337, "comment_id": 56929954, "body": "@Banana: <code>f = let x = a in y</code> (or <code>f = y where x=a</code>)  works in fact like what would you would write, in an imperative language, as <code>f () { x = a; return y; }</code>, except the order in which you write it doesn&#39;t matter."}, {"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451915209, "post_id": 34592337, "comment_id": 56930142, "body": "Would it be possible for you to have a chat with me and answer some follow up questions i have?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451915374, "post_id": 34592337, "comment_id": 56930262, "body": "@Banana: rather not, it&#39;s not like I don&#39;t have other stuff to do... but I&#39;ve already written a couple of suggestions now. And if you&#39;re serious about learning Haskell, do read a book (<a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">LYAH</a> is great)."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451915574, "post_id": 34592337, "comment_id": 56930403, "body": "@Banana: Remark: If <code>posArr !! 0</code> is always used, use <code>Int</code> instead of <code>[Int]</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1451916455, "post_id": 34592337, "comment_id": 56930977, "body": "@Zeta: right of course, indeed use of indices is generally a code smell in Haskell."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451941441, "post_id": 34592337, "comment_id": 56945188, "body": "Strange fact I only learned recently: <code>do</code> (in GHC, at least) does not itself impose a monadic context--that only shows up if the desugaring actually inserts a <code>&gt;&gt;=</code> or <code>&gt;&gt;</code> or the user inserts something monadic."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451943054, "post_id": 34592337, "comment_id": 56946015, "body": "@dfeuer: interesting. I thought this was only the case when using <code>RebindableSyntax</code>... but apparently that extension doesn&#39;t actually change the way the compiler handles <code>do</code>, only how it resolves the names of <code>&gt;&gt;=</code> and <code>&gt;&gt;</code>."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1451943347, "post_id": 34592337, "comment_id": 56946159, "body": "@dfeuer: this lends itself to some weird code: <code>let silly = do do do do do do do do do do do do do do do do ()</code>"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1492853304, "last_edit_date": 1492853304, "creation_date": 1451914309, "answer_id": 34592337, "question_id": 34591002, "link": "https://stackoverflow.com/questions/34591002/haskell-expected-type-char-actual-type-char/34592337#34592337", "title": "Haskell: expected type [Char] actual type [[Char]]", "body": "<p>You're trying to define pure functions here. (And that's great, pure functions give you <a href=\"https://en.wikipedia.org/wiki/Referential_transparency\" rel=\"nofollow noreferrer\">referential transparency</a>: very nice for reasoning about how you programs will behave!)</p>\n\n<p>However, <code>do</code> notation is procedural. You need that for when you're doing <em>impure</em> stuff<sup>&dagger;</sup> (for instance if you had the signature <code>[[Char]] -&gt; Int -&gt; [Int] -&gt; IO Bool</code>, it would mean your &ldquo;function&rdquo; were also allowed to do impure sequential IO operations). But you don't need that when writing a simple pure function.</p>\n\n<p>So instead of </p>\n\n<pre><code>upCheck tableArr number posArr = do\n    let arv = findVertIndex (tableArr !! (posArr !! 0)) number\n    let str = tableArr !! (posArr !! 0)\n    if ((posArr !! 0) == 1)\n      then False\n      else if isHorizontal str number\n        then False\n        else if (tableArr !! ((posArr !! 0)-1)) !! arv /= 'x'\n          then False\n          else True\n</code></pre>\n\n<p>you probably want</p>\n\n<pre><code>upCheck tableArr number posArr\n  = let arv = findVertIndex (tableArr !! (posArr !! 0)) number\n        str = tableArr !! (posArr !! 0)\n    in if ((posArr !! 0) == 1)\n        then False\n        else if isHorizontal str number\n              then False\n              else if (tableArr !! ((posArr !! 0)-1)) !! arv /= 'x'\n                    then False\n                    else True\n</code></pre>\n\n<p>This looks similar, but actually does something quite different: instead of hard-baking a sequence of steps to be taken with <code>do</code> (which only works in a monad like <code>IO</code>), you merely tell the compiler some definitions, but leave it free to figure out the best order in which to evaluate these.</p>\n\n<p>Indeed, it's customary to write out definitions more in a style like</p>\n\n<pre><code>upCheck tableArr number posArr\n     = if ((posArr !! 0) == 1)\n        then False\n        else if isHorizontal str number\n              then False\n              else if (tableArr !! ((posArr !! 0)-1)) !! arv /= 'x'\n                    then False\n                    else True\n  where arv = findVertIndex (tableArr !! (posArr !! 0)) number\n        str = tableArr !! (posArr !! 0)\n</code></pre>\n\n<p>Which is in fact exactly the same as the code with <code>let...in</code>.</p>\n\n<p>Note that chains of <code>if</code> staments can be written much nicer as <em>guards</em>:</p>\n\n<pre><code>upCheck tableArr number posArr\n     | posArr!!0 == 1                                = False\n     | isHorizontal str number                       = False\n     | tableArr !! ((posArr !! 0)-1)) !! arv /= 'x'  = False\n     | otherwise                                     = True\n  where arv = findVertIndex (tableArr !! (posArr !! 0)) number\n        str = tableArr !! (posArr !! 0)\n</code></pre>\n\n<p>...though actually, you don't need conditionals at all when writing <em>boolean</em> functions. The whole beast is equivalent to simply</p>\n\n<pre><code>upCheck tableArr number posArr\n    = not (   posArr!!0 == 1\n           || isHorizontal str number\n           || tableArr !! ((posArr !! 0)-1)) !! arv /= 'x'\n          )\n  where arv = findVertIndex (tableArr !! (posArr !! 0)) number\n        str = tableArr !! (posArr !! 0)\n</code></pre>\n\n<p>This is possible in most programming languages, not just in Haskell.</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>Actually, <code>do</code> in itself is not impure at all. It uses <em>monads</em>, which just happen to allow (amongst other thing) to embed impure code into pure Haskell (in a marvelously safe manner). But you probably want to learn about that later.</sub></p>\n"}], "owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 572, "favorite_count": 0, "accepted_answer_id": 34592337, "answer_count": 1, "score": 2, "last_activity_date": 1492853304, "creation_date": 1451909930, "last_edit_date": 1451913256, "question_id": 34591002, "link": "https://stackoverflow.com/questions/34591002/haskell-expected-type-char-actual-type-char", "title": "Haskell: expected type [Char] actual type [[Char]]", "body": "<p>I'm trying to do a checker function but i'm getting an error:</p>\n\n<pre><code>Couldn't match expected type `Char' with actual type `[Char]'\nExpected type: [Char]\n  Actual type: [[Char]]\nIn the first argument of `isHorizontal', namely `str'\nIn the expression: isHorizontal str number\n</code></pre>\n\n<p>This is the function triggering it:</p>\n\n<pre><code>upCheck :: [[Char]] -&gt; Int -&gt; [Int] -&gt; Bool\nupCheck tableArr number posArr = do\n    let arv = findVertIndex (tableArr !! (posArr !! 0)) number\n    let str = tableArr !! (posArr !! 0)\n    if ((posArr !! 0) == 1)\n      then False\n      else if isHorizontal str number\n        then False\n        else if (tableArr !! ((posArr !! 0)-1)) !! arv /= 'x'\n          then False\n          else True\n</code></pre>\n\n<p>Where <code>tableArr</code> is an array which contains strings: <code>[\"2323\",\"3232\",\"3231\",\"3232\"]</code> and <code>posArr</code> is an array which contains correct positions, for example <code>[1,3]</code>. <code>number</code> is the number we're checking, let's say it's <code>1</code>.</p>\n\n<p>Now the <code>isHorizontal</code> function is this which tells me basically whether there are two elements in the same row.</p>\n\n<pre><code>isHorizontal :: [Char] -&gt; Int -&gt; Bool\nisHorizontal [] _ = False\nisHorizontal [x] _ = False\nisHorizontal (x:y:xs) number =\n   if (firstCheck x &amp;&amp; firstCheck y)\n   then (if digitToInt(x) == number &amp;&amp; digitToInt(y) == number then  True else isHorizontal xs number)else isHorizontal (y:xs) number\n</code></pre>\n\n<p>However function isHorizontal works on input \"55x32\" 5 for example, so the problem is in my upCheck function. And by the looks of it the code: <code>tableArr !! (posArr !! 0)</code> should give a string back aswell, so this should fit for isHorizontal function, however it won't..</p>\n\n<p>What am I missing?</p>\n\n<p>Edit:</p>\n\n<p>After adding type to functions the error changed to:</p>\n\n<pre><code> Couldn't match expected type `[Char]' with actual type `Char'\nExpected type: [[[Char]]]\n  Actual type: [[Char]]\nIn the first argument of `(!!)', namely `tableArr'\nIn the first argument of `findVertIndex', namely\n  `(tableArr !! (posArr !! 0))'\n</code></pre>\n"}, {"tags": ["haskell", "purescript", "free-monad"], "answers": [{"comments": [{"owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "edited": false, "score": 0, "creation_date": 1452056204, "post_id": 34615381, "comment_id": 56997496, "body": "Yup, just as I feared :) I am less concerned whether it&#39;s pleasant, and more with if it is possible at all. In another bit of code I have in Haskell, I pattern match on the Free constructor to unwrap the onion one layer at a time. Looks like that is not possible either with the current purescript formulation :("}], "tags": [], "owner": {"reputation": 4314, "user_id": 139614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3f2ea13b0b182e926e8bd5ff59be201?s=128&d=identicon&r=PG", "display_name": "gb.", "link": "https://stackoverflow.com/users/139614/gb"}, "is_accepted": true, "score": 1, "last_activity_date": 1452007867, "creation_date": 1452007867, "answer_id": 34615381, "question_id": 34590002, "link": "https://stackoverflow.com/questions/34590002/manipulating-free-monads-in-purescript/34615381#34615381", "title": "Manipulating Free Monads in Purescript", "body": "<p>I tried for a while to do this with <code>runFreeM</code> and the like but without success, so no, I don't think it is possible to a transformation directly like this.</p>\n\n<p>The usual formulation of <code>Free</code> you mention is unsuitable for use in PureScript as it cannot be made stack safe, so unfortunately direct manipulation of the tree is obscured. The constructors are not exported at all now as we're using internal unsafe coercions to make the implementation possible in the style of <a href=\"http://okmij.org/ftp/Haskell/zseq.pdf\" rel=\"nofollow\">Reflection without Remorse</a>.</p>\n\n<p>We previously had a <a href=\"https://github.com/purescript/purescript-free/blob/v0.6.1/src/Control/Monad/Free.purs#L40-L42\" rel=\"nofollow\">slightly different implementation</a> without coercions that was similar to the scalaz <code>Free</code>, as that also requires a stack safe implementation, but I think this would have had the same problem also.</p>\n\n<p>Maybe if we exposed more internals (<code>fromView</code>, <code>toView</code>, etc.) it would be possible, but it still be less pleasant than the direct pattern matching approach, and I think exposing those may have safety issues.</p>\n"}], "owner": {"reputation": 7283, "user_id": 348716, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9d46cbdc3830248a0615f14ae4b7b33d?s=128&d=identicon&r=PG", "display_name": "Anupam Jain", "link": "https://stackoverflow.com/users/348716/anupam-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 0, "accepted_answer_id": 34615381, "answer_count": 1, "score": 2, "last_activity_date": 1452056248, "creation_date": 1451906495, "last_edit_date": 1452056248, "question_id": 34590002, "link": "https://stackoverflow.com/questions/34590002/manipulating-free-monads-in-purescript", "title": "Manipulating Free Monads in Purescript", "body": "<p>Why does <code>Control.Monad.Free</code> in <code>purescript-free</code> hide the \"view\" data structure <code>FreeView</code> and associated operators <code>toView</code> etc?</p>\n\n<p>With the usual formulation of a Free Monad -</p>\n\n<pre><code>data Free f a = Pure a | Free (f (Free f a))\n</code></pre>\n\n<p>And given a Functor such as -</p>\n\n<pre><code>data TeletypeF a = PutStrLn String a | GetLine (String -&gt; a)\n</code></pre>\n\n<p>I can write some simple (albeit ugly) code to collapse chained PutStrLn calls like so -</p>\n\n<pre><code>collapseChained :: Free TeletypeF a -&gt; Free TeletypeF a\ncollapseChained (Free (PutStrLn s1 (Free (PutStrLn s2 c)))) = Free PutStrLn (s1 ++ s2) c\ncollapseChained f = f\n</code></pre>\n\n<p>Is something equivalent to <code>collapseChained</code> possible using the functions exported by Purescript's <code>Control.Monad.Free</code>, without using any actual data constructors?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "either", "lifting"], "comments": [{"owner": {"reputation": 669, "user_id": 3714434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06a65866e8ef0ee97ab4cd4c4ffaadc6?s=128&d=identicon&r=PG&f=1", "display_name": "ibotty", "link": "https://stackoverflow.com/users/3714434/ibotty"}, "edited": false, "score": 2, "creation_date": 1451903874, "post_id": 34588488, "comment_id": 56923361, "body": "What about <code>ExceptT . return</code>? <code>ExceptT = ExceptT (m (Either e a))</code>, so <code>return</code> gets you to <code>IO (Either String User)</code> and <code>ExceptT</code> (as constructor/function) to <code>ExceptT String IO User</code>."}, {"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 0, "creation_date": 1528321205, "post_id": 34588488, "comment_id": 88467739, "body": "Your <code>liftEither</code> sounds like the right answer to me (or Cactus&#39;s answer about generalizing the type of <code>parseUser</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3792, "user_id": 905686, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/68312b9902d9ba7e1128d8afa7d3c247?s=128&d=identicon&r=PG", "display_name": "user905686", "link": "https://stackoverflow.com/users/905686/user905686"}, "edited": false, "score": 2, "creation_date": 1488540410, "post_id": 34590741, "comment_id": 72287905, "body": "Note that for the contraint <code>MonadError String m</code> ghc needs the <code>FlexibleContexts</code> extension (see <a href=\"http://stackoverflow.com/a/22795830/905686\">stackoverflow.com/a/22795830/905686</a>)."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 9, "last_activity_date": 1451908996, "creation_date": 1451908996, "answer_id": 34590741, "question_id": 34588488, "link": "https://stackoverflow.com/questions/34588488/lift-either-to-exceptt-automatically/34590741#34590741", "title": "lift Either to ExceptT automatically", "body": "<p>You can generalise <code>parseUser</code>'s type to </p>\n\n<pre><code>parseUser :: (MonadError String m) =&gt; String -&gt; m User \n</code></pre>\n\n<p>and then it would work both at <code>m ~ Either String</code> and at <code>m ~ ExceptT String m'</code> (if only <code>Monad m'</code>) without any manual lifting necessary. </p>\n\n<p>The way to do it is to basically replace <code>Right</code> with <code>return</code> and <code>Left</code> with <code>throwError</code> in <code>parseUser</code>'s definition.</p>\n"}, {"tags": [], "owner": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "is_accepted": false, "score": 2, "last_activity_date": 1528644872, "last_edit_date": 1528644872, "creation_date": 1528320970, "answer_id": 50729972, "question_id": 34588488, "link": "https://stackoverflow.com/questions/34588488/lift-either-to-exceptt-automatically/50729972#50729972", "title": "lift Either to ExceptT automatically", "body": "<p>If you are using <code>transformers</code> instead of <code>mtl</code>, then you can use <a href=\"https://hackage.haskell.org/package/errors-2.3.0/docs/Control-Error-Safe.html#v:tryRight\" rel=\"nofollow noreferrer\"><code>tryRight</code></a> from <code>Control.Error.Safe</code>.</p>\n\n<pre><code>tryRight :: Monad m =&gt; Either e a -&gt; ExceptT e m a\n</code></pre>\n"}], "owner": {"reputation": 5145, "user_id": 600545, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d34ee2348ea695f1a5b3408e11e2dca0?s=128&d=identicon&r=PG", "display_name": "romeovs", "link": "https://stackoverflow.com/users/600545/romeovs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1356, "favorite_count": 2, "accepted_answer_id": 34590741, "answer_count": 2, "score": 8, "last_activity_date": 1528644872, "creation_date": 1451901306, "last_edit_date": 1451909205, "question_id": 34588488, "link": "https://stackoverflow.com/questions/34588488/lift-either-to-exceptt-automatically", "title": "lift Either to ExceptT automatically", "body": "<p>Let's say I have this (arguably mislead) piece of code laying around:</p>\n\n<pre><code>import System.Environment (getArgs)\nimport Control.Monad.Except\n\nparseArgs :: ExceptT String IO User\nparseArgs =\n  do\n    args &lt;- lift getArgs\n    case safeHead args of\n      Just admin -&gt; parseUser admin\n      Nothing    -&gt; throwError \"No admin specified\"\n\nparseUser :: String -&gt; Either String User\n-- implementation elided\n\nsafeHead :: [a] -&gt; Maybe a\n-- implementation elided\n\nmain =\n  do\n    r &lt;- runExceptT parseArgs\n    case r of\n      Left  err -&gt; putStrLn $ \"ERROR: \" ++ err\n      Right res -&gt; print res\n</code></pre>\n\n<p><code>ghc</code> gives me the following error:</p>\n\n<pre><code>Couldn't match expected type \u2018ExceptT String IO User\u2019\n            with actual type \u2018Either String User\u2019\nIn the expression: parseUser admin\nIn a case alternative: Just admin -&gt; parseUser admin\n</code></pre>\n\n<p>What's the most standard way of lifting an <code>Either</code> into an <code>ExceptT</code>?\nI feel there must be some way since <code>Either String</code> is an instance of <code>MonadError</code>.</p>\n\n<p>I wrote my own lifting function:</p>\n\n<pre><code>liftEither :: (Monad m, MonadError a (Either a)) =&gt; Either a b -&gt; ExceptT a m b\nliftEither = either throwError return\n</code></pre>\n\n<p>But to me this still feels wrong since I'm already working inside the\n<code>ExceptT</code> monad transformer.</p>\n\n<p>What am I doing wrong here? Should I structure my code differently?</p>\n"}, {"tags": ["haskell", "shake-build-system"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1451949774, "post_id": 34588058, "comment_id": 56949139, "body": "More generally, idle garbage collection is primarily for <i>interactive</i> applications, and also for concurrent situations where the application in question is likely to delay many other threads in a major collection."}], "tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": true, "score": 19, "last_activity_date": 1451899786, "creation_date": 1451899786, "answer_id": 34588058, "question_id": 34588057, "link": "https://stackoverflow.com/questions/34588057/why-does-shake-recommend-disabling-idle-garbage-collection/34588058#34588058", "title": "Why does Shake recommend disabling idle garbage collection?", "body": "<p>By default (without the flag) GHC performs a garbage collection (GC) if all Haskell threads have been idle for 0.3 seconds. Since a build system is regularly running external processes, it is quite common for all Haskell threads to be idle for > 0.3s, which causes a lot of unnecessary garbage collections. Since the machine is likely to be fully loaded from the processes Shake is running, the GC will take time away that could otherwise be doing useful work. The problem is exacerbated if the GC runs multi-threaded.</p>\n"}], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 635, "favorite_count": 3, "accepted_answer_id": 34588058, "answer_count": 1, "score": 16, "last_activity_date": 1451899786, "creation_date": 1451899786, "question_id": 34588057, "link": "https://stackoverflow.com/questions/34588057/why-does-shake-recommend-disabling-idle-garbage-collection", "title": "Why does Shake recommend disabling idle garbage collection?", "body": "<p>In the Shake documentation it recommends compiling using the flag <code>-with-rtsopts=-I0</code> to disable idle garbage collection. Why does Shake recommend that?</p>\n"}, {"tags": ["matlab", "haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1451886929, "post_id": 34585304, "comment_id": 56916022, "body": "Well, you could probably write a class much like <code>Monoid</code> with different instances."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1451899505, "post_id": 34585304, "comment_id": 56920855, "body": "To make this interesting, you need to provide more thorough examples. What do you want <code>[1,2] &lt;+&gt; [3,4]</code> to give? What about <code>[[1,2],[3,4]] &lt;+&gt; [[5,6],[7,8]]</code>? What about <code>[1,2,3,4] &lt;+&gt; []</code>? There are lots of edge cases to consider."}, {"owner": {"reputation": 15219, "user_id": 1272950, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O1MQy.jpg?s=128&g=1", "display_name": "y\u01dds\u029e\u01ddla", "link": "https://stackoverflow.com/users/1272950/y%c7%9ds%ca%9e%c7%9dla"}, "edited": false, "score": 1, "creation_date": 1451900026, "post_id": 34585304, "comment_id": 56921146, "body": "Matlab/Octave will give dimensions don&#39;t match error in the last example, otherwise it&#39;s an <code>X(i,j) + Y(i,j)</code>."}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1451916874, "post_id": 34585304, "comment_id": 56931276, "body": "@ReinHenrichs Matlab behavior is what I had in mind: element-wise operation to be precise. But I guess the tolerance of zipWith would be nice too, depending on each user."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1451933521, "post_id": 34585304, "comment_id": 56941082, "body": "@tinlyx The reason your attempt to use @DanielWagner&#39;s answer didn&#39;t work is that you left <code>LANGUAGE</code> out of your compiler pragmas. Instead of <code>{-# FlexibleInstances #-}</code>, try <code>{-# LANGUAGE FlexibleInstances #-}</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1451948160, "post_id": 34585304, "comment_id": 56948511, "body": "Even if it&#39;s possible, it&#39;s a bad idea. Matlab actually proves that point well enough, if you ask me..."}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1451953817, "post_id": 34585304, "comment_id": 56950450, "body": "@leftaroundabout I think it&#39;s a bad idea for Matlab because dimensions are collapsed arbitrarily to allow e.g.  1 + [2]. Not the case here?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1451981948, "post_id": 34585304, "comment_id": 56959279, "body": "@tinlyx: yeah, I suppose it&#39;s not <i>that</i> bad. But still you&#39;ll have either runtime errors (as in Matlab), or silent extension with zeroes (as <i>sometimes</i> in Matlab), or cutoff of significant elements (as with <code>zipWith</code>) whenever some length doesn&#39;t match. IMO it&#39;s better to make that possibility explicit by actually using <code>zip</code>s or something else as appropriate when you have dynamic-length lists, and only use <a href=\"http://hackage.haskell.org/package/vector-space\" rel=\"nofollow noreferrer\">shorthand operators for vectors</a> (including scalars or linear operators) where the dimension is confirmed to match at compile-time."}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1451995585, "post_id": 34585304, "comment_id": 56967606, "body": "@leftaroundabout Agreed. Probably a variant of <code>zipWith</code> that checks for dimensions or ensures dimensions are the same (at run time), or even fancier techniques to check it at compile time if that is possible? That&#39;s probably beyond this question.."}], "answers": [{"comments": [{"owner": {"reputation": 15219, "user_id": 1272950, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O1MQy.jpg?s=128&g=1", "display_name": "y\u01dds\u029e\u01ddla", "link": "https://stackoverflow.com/users/1272950/y%c7%9ds%ca%9e%c7%9dla"}, "edited": false, "score": 0, "creation_date": 1451899482, "post_id": 34587860, "comment_id": 56920843, "body": "Any elegant way to replace <code>Integer</code> with <code>Num</code>?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1451899562, "post_id": 34587860, "comment_id": 56920888, "body": "Sure: <code>instance Num a =&gt; Additive a where (&lt;+&gt;) = (+)</code>"}, {"owner": {"reputation": 15219, "user_id": 1272950, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O1MQy.jpg?s=128&g=1", "display_name": "y\u01dds\u029e\u01ddla", "link": "https://stackoverflow.com/users/1272950/y%c7%9ds%ca%9e%c7%9dla"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1451899900, "post_id": 34587860, "comment_id": 56921064, "body": "@ReinHenrichs that works only with <code>FlexibleInstances</code> enabled right?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 15219, "user_id": 1272950, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O1MQy.jpg?s=128&g=1", "display_name": "y\u01dds\u029e\u01ddla", "link": "https://stackoverflow.com/users/1272950/y%c7%9ds%ca%9e%c7%9dla"}, "edited": false, "score": 0, "creation_date": 1451900195, "post_id": 34587860, "comment_id": 56921230, "body": "@AlekseyIzmailov Yes, but <code>FlexibleInstances</code> is certainly part of the common GHC dialect of Haskell."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 15219, "user_id": 1272950, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O1MQy.jpg?s=128&g=1", "display_name": "y\u01dds\u029e\u01ddla", "link": "https://stackoverflow.com/users/1272950/y%c7%9ds%ca%9e%c7%9dla"}, "edited": false, "score": 0, "creation_date": 1451900389, "post_id": 34587860, "comment_id": 56921328, "body": "@AlekseyIzmailov In fact you need <code>UndecidableInstances</code> too, but afaik this is a safe use. It&#39;s only letting the compiler know that it&#39;s ok that <code>Additive</code> is the same size as <code>Num</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1451909385, "post_id": 34587860, "comment_id": 56926575, "body": "@ReinHenrichs Won&#39;t that instance overlap with the <code>[]</code> one?"}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 0, "creation_date": 1451916583, "post_id": 34587860, "comment_id": 56931065, "body": "Could you show how to make <code>Num a</code> work? Please see my update"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 1, "creation_date": 1451925394, "post_id": 34587860, "comment_id": 56936565, "body": "@tinlyx You cannot, in general, make this work with <code>Num a</code> as the base case. Instead make instances of <code>Additive</code> for each type you care about -- <code>Int</code>, <code>Double</code>, whatever. (Consider what should happen if I write <code>instance Num a =&gt; Num [a] where ...</code>!)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 0, "creation_date": 1451931976, "post_id": 34587860, "comment_id": 56940258, "body": "@tinlyx ...although it occurs to me that <code>DefaultSignatures</code> would at least make those instances quite short. I&#39;ll add a comment about this to my answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451940678, "post_id": 34587860, "comment_id": 56944783, "body": "As nice as <code>DefaultSignatures</code> is sometimes, it really annoys me. The class needs to choose just one lucky context to get the free default. Blech."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1451932240, "last_edit_date": 1451932240, "creation_date": 1451899157, "answer_id": 34587860, "question_id": 34585304, "link": "https://stackoverflow.com/questions/34585304/how-to-add-two-lists-like-matlab-in-haskell/34587860#34587860", "title": "How to add two lists like matlab in Haskell?", "body": "<p>Yes, it's possible:</p>\n\n<pre><code>class Additive a where (&lt;+&gt;) :: a -&gt; a -&gt; a\ninstance Additive Integer where (&lt;+&gt;) = (+)\ninstance Additive a =&gt; Additive [a] where (&lt;+&gt;) = zipWith (&lt;+&gt;)\n</code></pre>\n\n<p>Your three test cases in ghci:</p>\n\n<pre><code>*Main&gt; 1 &lt;+&gt; 2\n3\n*Main&gt; [1] &lt;+&gt; [2]\n[3]\n*Main&gt; [[1]] &lt;+&gt; [[2]]\n[[3]]\n</code></pre>\n\n<p>If you want lots of instances where <code>(&lt;+&gt;) = (+)</code>, you can make this a default implementation with <code>DefaultSignatures</code>:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\nclass Additive a where\n    (&lt;+&gt;) :: a -&gt; a -&gt; a\n    default (&lt;+&gt;) :: Num a =&gt; a -&gt; a -&gt; a\n    (&lt;+&gt;) = (+)\n</code></pre>\n\n<p>The advantage is that some instances can be quite short, e.g.</p>\n\n<pre><code>instance Additive Integer\ninstance Additive Int\ninstance Additive Double\ninstance Additive Float\n</code></pre>\n\n<p>will all work as expected without any additional method definitions.</p>\n"}], "owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 1, "accepted_answer_id": 34587860, "answer_count": 1, "score": 3, "last_activity_date": 1451941101, "creation_date": 1451886136, "last_edit_date": 1495540747, "question_id": 34585304, "link": "https://stackoverflow.com/questions/34585304/how-to-add-two-lists-like-matlab-in-haskell", "title": "How to add two lists like matlab in Haskell?", "body": "<p>I was wondering if it is possible to write a Haskell add operator that can work on two numbers, two lists of numbers, two matrices of numbers, ... and so on. That is, is it possible to define an <code>&lt;+&gt;</code> such that all of the following works?:</p>\n\n<pre><code>1 &lt;+&gt; 2 = 3\n[1] &lt;+&gt; [2] = [3]\n[[1]] &lt;+&gt; [[2]] = [[3]]\n...\n</code></pre>\n\n<p>I know that as in <a href=\"https://stackoverflow.com/questions/4776750/what-is-an-idiomatic-way-to-add-lists-in-haskell\">What is an idiomatic way to add lists in Haskell?</a> , we can do <code>+</code> for <code>a</code>, <code>zipWith (+)</code> for <code>[a]</code>. Probably <code>zipWith (zipWith (+))</code> for <code>[[a]]</code>, along the same line, and so on...</p>\n\n<p>But can it be done using one operator (as Matlab was able) using type classes or other features of Haskell?</p>\n\n<p>I know this is syntatic sugar, but it would be sweet if possible. </p>\n\n<p>-- update --</p>\n\n<p>I see that maybe it's problematic to use <code>(Num a)</code> as explained in @DanielWagner's answer, and it's probably the best to define it individually for <code>Integer, Double</code> etc. for base cases.</p>\n\n<p>Just for the record, I just tried as suggested:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances #-}\nclass Additive a where (&lt;+&gt;) :: a -&gt; a -&gt; a\ninstance Num a =&gt; Additive a where (&lt;+&gt;) = (+)\ninstance Additive a =&gt; Additive [a] where (&lt;+&gt;) = zipWith (&lt;+&gt;)\n</code></pre>\n\n<p>Or </p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\nclass Additive a where\n    (&lt;+&gt;) :: a -&gt; a -&gt; a\n    default (&lt;+&gt;) :: Num a =&gt; a -&gt; a -&gt; a\n    (&lt;+&gt;) = (+)\n</code></pre>\n\n<p>In either case, there is an error when loading the <code>.hs</code> file or when evaluating <code>[[1,2]] &lt;+&gt; [[3,4]]</code>.</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 542, "user_id": 584839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/0458b30ca5c58099f9d06a57497b2900?s=128&d=identicon&r=PG", "display_name": "Tetigi", "link": "https://stackoverflow.com/users/584839/tetigi"}, "is_accepted": true, "score": 3, "last_activity_date": 1452447708, "creation_date": 1452447708, "answer_id": 34708684, "question_id": 34583127, "link": "https://stackoverflow.com/questions/34583127/yesod-scaffolded-site-slow-to-release-database-pool-connection/34708684#34708684", "title": "Yesod scaffolded site slow to release database pool connection", "body": "<p>The issue lies within Data.Random - replacing the <code>choice</code> call with something like:</p>\n\n<pre><code>import System.Random (randomRIO)\n\n...\n\n -- Pick an entity at random\nrandomInt1 &lt;- liftIO $ randomRIO (0, length entities -1) \nlet Entity _ thisThingEntity = entities !! randomInt1\n</code></pre>\n\n<p>Fixed everything and we no longer get slow down. Not really sure why Data.Random is doing this, but at least it works now!</p>\n\n<p>Another interesting thing to note - the issue is NOT present on Mac OS X, only on Linux flavours (CentOS, Arch, Ubuntu being the ones we tried)</p>\n"}], "owner": {"reputation": 542, "user_id": 584839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/0458b30ca5c58099f9d06a57497b2900?s=128&d=identicon&r=PG", "display_name": "Tetigi", "link": "https://stackoverflow.com/users/584839/tetigi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 3, "accepted_answer_id": 34708684, "answer_count": 1, "score": 6, "last_activity_date": 1452447708, "creation_date": 1451866160, "last_edit_date": 1452127451, "question_id": 34583127, "link": "https://stackoverflow.com/questions/34583127/yesod-scaffolded-site-slow-to-release-database-pool-connection", "title": "Yesod scaffolded site slow to release database pool connection", "body": "<p><strong>UPDATE</strong></p>\n\n<p>I have simplified the demonstration of this with an actual project created from the scaffold - you can check it out here: <a href=\"https://github.com/tetigi/yesod-bug-test\" rel=\"nofollow\">https://github.com/tetigi/yesod-bug-test</a></p>\n\n<p>Follow the README to set up the repo and replicate the issue! Thanks :)</p>\n\n<p><strong>ORIGINAL POST</strong></p>\n\n<p>I've recently been trying to create a simple website using yesod - in one particular handler, it makes a couple of runDB calls (selecting and inserting some values into a ~200 item DB). However, on medium load, such as reloading the page rapidly in a browser, the page starts to hang.</p>\n\n<p>Doing some debugging, I found that it seems the yesod app is not releasing the connections to the DB pool in a timely fashion and ends up waiting for them to release. To correborate this, I found the other following things:</p>\n\n<ul>\n<li>Reducing the DB pool to 2 gave me a freeze after only a couple of clicks</li>\n<li>The default (10) froze after about 5 seconds of clicking</li>\n<li>Increasing the DB pool to 100 gave me a much longer click period, up to about 10-15 seconds of rapid clicking</li>\n<li>The issue is the same whether I'm using postgres or sqlite</li>\n<li>In postgres, it was possible to see the 'COMMIT' transactions stacking up over time</li>\n<li>These transactions would eventually dissappear over time and the website would be responsive again</li>\n</ul>\n\n<p>Is there something I'm missing here? The webpage does not do anything complicated, as the snippet below will show. Any ideas? As it stands, the website will be unuseable for multiple users until I find a way to fix this!</p>\n\n<p>I'm using the standard scaffolded yesod application via stack as is recommended in the documentation.</p>\n\n<p>Cheers!</p>\n\n<p>Luke</p>\n\n<p><strong>Example handler code (abridged)</strong></p>\n\n<pre><code>getCompareR :: Handler Html\ngetCompareR = do\n\n    -- Get all entities from the db. Throws error if &lt; 2 elems in the DB.\n    entities &lt;- fmap (\\xs -&gt; assert (length xs &gt;= 2) xs) $ runDB $ selectList [] []\n\n    -- Pick an entity at random\n    Entity _ thisThingEntity &lt;- liftIO $ runRVar (choice entities) DevRandom\n\n    -- Pull out everything NOT the thing we just picked\n    otherEntities &lt;- runDB $ selectList [ComparisonHash !=. (comparisonHash thisThingEntity)] []\n\n    -- Pick one at random\n    Entity _ thatThingEntity &lt;- liftIO $ runRVar (choice otherEntities) DevRandom\n\n    -- Some stuff including some inserts\n    -- ...\n    -- ...\n\n    runDB $ sequence [update thisId [ComparisonElo =. thisElo], update thatId [ComparisonElo =. thatElo]]\n\n    -- Start laying out the webpage\n    defaultLayout $ do\n        -- Fill in the rest with compare.hamlet\n        $(widgetFile \"compare\")\n</code></pre>\n"}, {"tags": ["java", "haskell", "serialization", "aeson", "haskell-spock"], "comments": [{"owner": {"reputation": 39861, "user_id": 1076640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e0VNy.jpg?s=128&g=1", "display_name": "yshavit", "link": "https://stackoverflow.com/users/1076640/yshavit"}, "edited": false, "score": 6, "creation_date": 1451852061, "post_id": 34581016, "comment_id": 56907251, "body": "Do you have control of both the Haskell code and the Java code? If so, you might want to consider using a language-agnostic protocol like <a href=\"https://developers.google.com/protocol-buffers/?hl=en\" rel=\"nofollow noreferrer\">Protobuf</a>, <a href=\"http://thrift.apache.org/\" rel=\"nofollow noreferrer\">Thrift</a> or others."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "reply_to_user": {"reputation": 39861, "user_id": 1076640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e0VNy.jpg?s=128&g=1", "display_name": "yshavit", "link": "https://stackoverflow.com/users/1076640/yshavit"}, "edited": false, "score": 1, "creation_date": 1451852114, "post_id": 34581016, "comment_id": 56907266, "body": "If you&#39;re just sending a Java object serialized using Java&#39;s default serialization...don&#39;t.  Serialize it some custom way, as @yshavit mentioned."}, {"owner": {"reputation": 101, "user_id": 1223327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16c38847b48953b9d4074b79900e56ed?s=128&d=identicon&r=PG", "display_name": "Garrett M", "link": "https://stackoverflow.com/users/1223327/garrett-m"}, "reply_to_user": {"reputation": 39861, "user_id": 1076640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e0VNy.jpg?s=128&g=1", "display_name": "yshavit", "link": "https://stackoverflow.com/users/1076640/yshavit"}, "edited": false, "score": 0, "creation_date": 1451852341, "post_id": 34581016, "comment_id": 56907328, "body": "@yshavit I don&#39;t have access to the Java codebase. It is an external service I call. The only thing I have from them is the compiled Java class for the response to deserialize back into."}, {"owner": {"reputation": 39861, "user_id": 1076640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e0VNy.jpg?s=128&g=1", "display_name": "yshavit", "link": "https://stackoverflow.com/users/1076640/yshavit"}, "edited": false, "score": 0, "creation_date": 1451852501, "post_id": 34581016, "comment_id": 56907392, "body": "@GarrettM And they require it serialized by native Java serialization? Ugh. First thing you should do is email their support people to tell them that that&#39;s unacceptable. After that, I&#39;m not sure the best approach. I might almost suggest writing a very small Java service with an API that accepts Protobuf/Thrift/etc, and returns back a byte array of the serialized Java object. So, you send over a message describing what you want, the service creates the Java object, serializes it, and sends back those bytes. Pretty ugly, but also pretty simple."}, {"owner": {"reputation": 101, "user_id": 1223327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16c38847b48953b9d4074b79900e56ed?s=128&d=identicon&r=PG", "display_name": "Garrett M", "link": "https://stackoverflow.com/users/1223327/garrett-m"}, "reply_to_user": {"reputation": 39861, "user_id": 1076640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e0VNy.jpg?s=128&g=1", "display_name": "yshavit", "link": "https://stackoverflow.com/users/1076640/yshavit"}, "edited": false, "score": 0, "creation_date": 1451852938, "post_id": 34581016, "comment_id": 56907553, "body": "@yshavit What counts as native Java serialization? We can use any serialization package we want but I haven&#39;t heard of a Haskell serialization package that can take a Java file as the type. For your middle layer, are you suggesting I write my Haskell codebase to send and receive Protobuf or Thrift messages and have a middle Java layer that converts each of those messages into the appropriate Java object?      Doesn&#39;t that just move the problem down and force me to manually convert from Protobuf or Thrift to Java? Would something like Swagger help at all?"}, {"owner": {"reputation": 39861, "user_id": 1076640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e0VNy.jpg?s=128&g=1", "display_name": "yshavit", "link": "https://stackoverflow.com/users/1076640/yshavit"}, "edited": false, "score": 1, "creation_date": 1451853905, "post_id": 34581016, "comment_id": 56907882, "body": "@GarrettM By native Java serialization, I meant <a href=\"https://docs.oracle.com/javase/tutorial/jndi/objects/serial.html\" rel=\"nofollow noreferrer\">this</a>. I assumed that&#39;s what you meant by &quot;sending a serialized Java object,&quot; but it&#39;s not clear. I haven&#39;t used Swagger. And yes, you understood my suggestion. The advantage is that you don&#39;t need to understand the Java serialization protocol, you can just have the middle layer deserialize the object (which it already knows how to do), construct a Thrift/etc object (which is easy), and then send that to your Haskell app (which is easy to send and use)."}, {"owner": {"reputation": 101, "user_id": 1223327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16c38847b48953b9d4074b79900e56ed?s=128&d=identicon&r=PG", "display_name": "Garrett M", "link": "https://stackoverflow.com/users/1223327/garrett-m"}, "reply_to_user": {"reputation": 39861, "user_id": 1076640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e0VNy.jpg?s=128&g=1", "display_name": "yshavit", "link": "https://stackoverflow.com/users/1076640/yshavit"}, "edited": false, "score": 0, "creation_date": 1451854129, "post_id": 34581016, "comment_id": 56907966, "body": "@yshavit In that case, we do use Java serialization. I haven&#39;t looked at those options yet but doesn&#39;t protobuf and thrift require knowing the model they&#39;ll be transforming into? I&#39;m really trying to avoid copying the model from the Java class to anything else."}, {"owner": {"reputation": 39861, "user_id": 1076640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e0VNy.jpg?s=128&g=1", "display_name": "yshavit", "link": "https://stackoverflow.com/users/1076640/yshavit"}, "edited": false, "score": 1, "creation_date": 1451855180, "post_id": 34581016, "comment_id": 56908313, "body": "Yes, they do. I think you&#39;re out of luck, unless you can find a Haskell library that knows how to read native Java serialization (asking for one is off topic for SO (see item 4 <a href=\"http://stackoverflow.com/help/on-topic\">here</a>). Sorry!"}, {"owner": {"reputation": 101, "user_id": 1223327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16c38847b48953b9d4074b79900e56ed?s=128&d=identicon&r=PG", "display_name": "Garrett M", "link": "https://stackoverflow.com/users/1223327/garrett-m"}, "reply_to_user": {"reputation": 39861, "user_id": 1076640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e0VNy.jpg?s=128&g=1", "display_name": "yshavit", "link": "https://stackoverflow.com/users/1076640/yshavit"}, "edited": false, "score": 0, "creation_date": 1451856446, "post_id": 34581016, "comment_id": 56908735, "body": "@yshavit Thanks for all the help. I appreciate it."}], "owner": {"reputation": 101, "user_id": 1223327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16c38847b48953b9d4074b79900e56ed?s=128&d=identicon&r=PG", "display_name": "Garrett M", "link": "https://stackoverflow.com/users/1223327/garrett-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1451851416, "creation_date": 1451851416, "question_id": 34581016, "link": "https://stackoverflow.com/questions/34581016/how-to-deserialize-a-web-server-response-into-a-haskell-object-using-a-java-clas", "title": "How to deserialize a web server response into a Haskell object using a Java class", "body": "<p>My Haskell code needs to call a Java web server. The web server will be sending a serialized Java object as a response. I have the compiled Java class but am unsure how to use it in Haskell. Is there a way to properly deserialize the response into a Haskell object without copying and pasting the Java class into a Haskell type?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 12923, "user_id": 1530508, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fG8z0.png?s=128&g=1", "display_name": "ApproachingDarknessFish", "link": "https://stackoverflow.com/users/1530508/approachingdarknessfish"}, "edited": false, "score": 1, "creation_date": 1451847853, "post_id": 34580049, "comment_id": 56905777, "body": "&quot;if (firstCheck x) then if digitToInt(x) == number then True else False else False&quot; Can be simplified to just &quot;(firstCheck x)&amp;&amp;(digitToInt(x) == number)&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 1, "creation_date": 1451847395, "post_id": 34580303, "comment_id": 56905592, "body": "Could you explain a bit what&#39;s happening here?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451848428, "post_id": 34580303, "comment_id": 56906007, "body": "@Banana, I&#39;m a bit tied up right now, but I&#39;ve expanded my answer."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1451854355, "last_edit_date": 1451854355, "creation_date": 1451847262, "answer_id": 34580303, "question_id": 34580049, "link": "https://stackoverflow.com/questions/34580049/get-positions-of-elements-in-list-of-strings-in-haskell/34580303#34580303", "title": "Get positions of elements in list of strings in Haskell", "body": "<p>You're trying to work your way through a list, keeping track of where you are in the list. The simplest function for doing this is</p>\n\n<pre><code>mapWithIndex :: (Int -&gt; a -&gt; b) -&gt; [a] -&gt; [b]\nmapWithIndex = mwi 0 where\n  mwi i _f [] = i `seq` []\n  mwi i f (x:xs) = i `seq` f i x : mwi (i+1) f xs\n</code></pre>\n\n<p>This takes a function and a list, and applies the function to each index and element. So</p>\n\n<pre><code>mapWithIndex (\\i x -&gt; (i, x)) ['a', 'b', 'c'] =\n[(0,'a'), (1,'b'),(2,'c')]\n</code></pre>\n\n<p>Once you've done that, you can <code>filter</code> the list to get just the pairs you want:</p>\n\n<pre><code>filter (elem '5' . snd)\n</code></pre>\n\n<p>and then <code>map fst</code> over it to get the list of indices.</p>\n\n<p>A more integrated approach is to use <code>foldrWithIndex</code>.</p>\n\n<pre><code>foldrWithIndex :: (Int -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldrWithIndex = fis 0 where\n  fis i _c n [] = i `seq` n\n  fis i c n (x:xs) = i `seq` c i x (fis (i+1) c n xs)\n</code></pre>\n\n<p>This lets you do everything in one step.</p>\n\n<p>It turns out that you can implement <code>foldrWithIndex</code> using <code>foldr</code> pretty neatly, which makes it available for any <code>Foldable</code> container:</p>\n\n<pre><code>foldrWithIndex :: (Foldable f, Integral i) =&gt;\n  (i -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; f a -&gt; b\nfoldrWithIndex c n xs = foldr go (`seq` n) xs 0 where\n  go x r i = i `seq` c i x (r (i + 1))\n</code></pre>\n\n<p>Anyway,</p>\n\n<pre><code>findIndices p = foldrWithIndex go [] where\n  go i x r | p x = i : r\n           | otherwise = r\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": false, "score": 7, "last_activity_date": 1451855164, "last_edit_date": 1451855164, "creation_date": 1451850113, "answer_id": 34580832, "question_id": 34580049, "link": "https://stackoverflow.com/questions/34580049/get-positions-of-elements-in-list-of-strings-in-haskell/34580832#34580832", "title": "Get positions of elements in list of strings in Haskell", "body": "<p>The function you want already exists in the <code>Data.List</code> module, by the name of <code>findIndices</code>. You can simply use <code>(elem '5')</code> as the predicate.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:findIndices\">http://hackage.haskell.org/package/base-4.8.1.0/docs/Data-List.html#v:findIndices</a></p>\n\n<p>If, for some reason, you're not allowed to use the built-in one, it comes with a very pretty definition (although the one actually used has a more complicated, more efficient one):</p>\n\n<pre><code>findIndices p xs = [ i | (x,i) &lt;- zip xs [0..], p x]\n</code></pre>\n\n<p>By the way, I found this function by searching Hoogle for the type <code>[a] -&gt; (a -&gt; Bool) -&gt; [Int]</code>, which (modulo parameter ordering) is obviously the type such a function must have. The best way to find out of Haskell has something is to think about the type it would need to have and search Hoogle or Hayoo for the type. Hoogle is better IMO because it does slightly fuzzy matching on the type; e.g. Hayoo wouldn't find the function here by the type I've given, because it take the arguments in the reverse order.</p>\n"}, {"tags": [], "owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "is_accepted": true, "score": 3, "last_activity_date": 1451850762, "creation_date": 1451850762, "answer_id": 34580927, "question_id": 34580049, "link": "https://stackoverflow.com/questions/34580049/get-positions-of-elements-in-list-of-strings-in-haskell/34580927#34580927", "title": "Get positions of elements in list of strings in Haskell", "body": "<p>An implementation of <code>findIndices</code>, for instructional purposes:</p>\n\n<pre><code>findIndices ok list = f list 0 where\n  f [] _ = []\n  f (x:xs) ix\n    | ok x      = ix : f xs (ix+1)\n    | otherwise =      f xs (ix+1)\n</code></pre>\n\n<p>Use it like <code>findIndices (elem '5') my_list_o_strings</code></p>\n"}], "owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3684, "favorite_count": 0, "accepted_answer_id": 34580927, "answer_count": 3, "score": 2, "last_activity_date": 1451855223, "creation_date": 1451845818, "question_id": 34580049, "link": "https://stackoverflow.com/questions/34580049/get-positions-of-elements-in-list-of-strings-in-haskell", "title": "Get positions of elements in list of strings in Haskell", "body": "<p>my title might be a bit off and i'll try to explain a bit better what i'm trying to achieve.</p>\n\n<p>Basically let's say i have a list:</p>\n\n<pre><code>[\"1234x4\",\"253x4\",2839\",2845\"]\n</code></pre>\n\n<p>Now i'd like to add all the positions of the strings which contain element 5 to a new list. On a current example the result list would be:</p>\n\n<pre><code>[1,3]\n</code></pre>\n\n<p>For that i've done similar function for <code>elem</code>:</p>\n\n<pre><code>myElem [] _ = False\nmyElem [x] number =\n  if (firstCheck x) then if digitToInt(x) == number then True else False else False\nmyElem (x:xs) number =\nif (firstCheck x) then (if digitToInt(x) == number then True else myElem xs number) else myElem xs number\n</code></pre>\n\n<p>where <code>firstCheck x</code> checks that the checked element isn't 'x' or '#'</p>\n\n<p>Now in my current function i get the first element position which contains the element, however my head is stuck around on how to get the full list:</p>\n\n<pre><code>findBlock (x:xs) number arv =\n  if myElem x number then arv else findBlock xs number arv+1\n</code></pre>\n\n<p>Where <code>arv</code> is 0 and <code>number</code> is the number i'm looking for.</p>\n\n<p>For example on input:</p>\n\n<pre><code>findBlock [\"1234x4\",\"253x4\",2839\",2845\"] 5 0 \n</code></pre>\n\n<p>The result would be 1</p>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["haskell", "lambda", "evaluation", "lambda-calculus"], "answers": [{"comments": [{"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1451846560, "post_id": 34580162, "comment_id": 56905255, "body": "Similarly, for <code>tx2 = (\\x y z -&gt; y.z.z);</code> you can see that 1. <code>x</code> is unused, 2. <code>y</code> can be composed with <code>z</code> and 3. <code>z</code> can be composed with itself, so you get <code>tx2 :: a -&gt; (b -&gt; c) -&gt; (b -&gt; b) -&gt; b -&gt; c</code>."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1451857527, "post_id": 34580162, "comment_id": 56909093, "body": "How do you (or should we) parse <code>y.x.y</code>? If it&#39;s <code>y (x y)</code>, then your type doesn&#39;t seem right, if it&#39;s <code>y x y</code>, then it&#39;s an occurs check."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1451857824, "post_id": 34580162, "comment_id": 56909174, "body": "I read it as function composition, I.e. <code>x.y</code> meaning <code>\\a -&gt; x (y a)</code>."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1451857874, "post_id": 34580162, "comment_id": 56909186, "body": "Oh. I guess the lack of spaces threw me off."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451891804, "post_id": 34580162, "comment_id": 56917644, "body": "Since <code>.</code> is <i>actually</i> associative, the &quot;right-associative&quot; aspect of its syntax is irrelevant here."}], "tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": false, "score": 3, "last_activity_date": 1451863827, "last_edit_date": 1451863827, "creation_date": 1451846401, "answer_id": 34580162, "question_id": 34579683, "link": "https://stackoverflow.com/questions/34579683/haskell-evaluating-lambda-expressions-manually-determine-general-types/34580162#34580162", "title": "Haskell: Evaluating lambda expressions manually - determine general types", "body": "<p>There are three basic properties you can exploit:</p>\n\n<ol>\n<li>Due to currying, <code>\\x y -&gt; z</code> is equivalent to <code>\\x -&gt; \\y -&gt; z</code>.</li>\n<li>For any <code>x(y)</code>, you know that <code>x</code> must be a function and its first argument matches the type of the expression <code>y</code>.</li>\n<li>You know the type of <code>.</code>, which is <code>(b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code>. Furthermore, <code>.</code> is right-associative (i.e. <code>a.b.c</code> is the same as <code>a.(b.c)</code>).</li>\n</ol>\n\n<p>With this in mind, consider your first example:</p>\n\n<pre><code>t2 = ( \\x y z  -&gt; y.x.y );\n</code></pre>\n\n<p>Clearly, it's a function of three arguments, so its type will be something akin to</p>\n\n<pre><code>t2 :: ty0 -&gt; ty1 -&gt; ty2 -&gt; ty3\n</code></pre>\n\n<p>I use <code>ty0</code> through <code>ty3</code> here to denote the types to infer. <code>ty0</code> is the type of the <code>x</code> argument, <code>ty1</code> is for <code>y</code>, <code>ty2</code> for <code>z</code> and <code>ty3</code> is the type of the result value (i.e. the type of the expression <code>y.x.y</code>).</p>\n\n<p>I'd start with determining the type <code>ty3</code> (which is defined by the expression <code>y.x.y</code>) because while doing so you'll also find the types of the <em>used</em> arguments. Unused arguments can have any type:</p>\n\n<ol>\n<li><code>y.x.y</code> is equivalent to <code>y.(x.y)</code> (due to right-associativity of <code>.</code>, see item #3 above). So you can start by considering the subexpression <code>x.y</code>.</li>\n<li>This means that <code>x :: (b -&gt; c)</code> and <code>y :: (a -&gt; b)</code> and hence <code>x.y :: a -&gt; c</code> (due to the type of <code>.</code>, again see #3 above).</li>\n<li>So we know that <code>y :: (a -&gt; b)</code> and <code>x.y :: a -&gt; c</code>. With this in mind, the only way <code>y.(x.y)</code> can type check (i.e. match the type of <code>.</code>) is when <code>c ~ a</code>, i.e. <code>c</code> and <code>a</code> are the same type.</li>\n</ol>\n\n<p>Hence, <code>x :: b -&gt; a</code> (our <code>ty0</code>!) and <code>y :: a -&gt; b</code> <code>(</code>ty1<code>) and</code>y.(x.y) :: a -> b<code>(what we called</code>ty3` above). You can plug this into our primitive 'three-argument function type' above.</p>\n\n<pre><code>t2 :: ty0 -&gt; ty1 -&gt; ty2 -&gt; ty3\n=&gt;\nt2 :: (b -&gt; a) -&gt; (a -&gt; b) -&gt; ty2 -&gt; (a -&gt; b)\n</code></pre>\n\n<p>...and since <code>-&gt;</code> is right-associative, you can omit the last parens (and instead of <code>ty2</code> you could have used <code>c</code>, of course).</p>\n\n<p>Let's try the same strategy on your last example:</p>\n\n<pre><code>tm2 = (\\z -&gt; \\y -&gt; \\x -&gt; z.y.x);\n</code></pre>\n\n<ol>\n<li>This is equivalent to <code>\\z y x -&gt; z.y.x</code> (due to currying, see #1 in the list at the top).</li>\n<li>This means it's another three-argument function of the form <code>tm2 :: ty0 -&gt; ty1 -&gt; ty2 -&gt; ty3</code>. Again, we start by inferring the type <code>ty3</code> by considering the definition of the function.</li>\n<li>The type <code>ty3</code> is the type of the expression <code>z.y.x</code>, which is equivalent to <code>z.(y.x)</code> (due to right-associativity of <code>.</code>).</li>\n<li>All three variables must be functions to satisfy the type of <code>.</code> (see #3 in the list at the top).</li>\n<li>So <code>x :: a -&gt; b</code>, <code>y :: b -&gt; c</code>, <code>y.x :: a -&gt; c</code>.</li>\n<li>From this, it follows that <code>z :: c -&gt; d</code> and hence <code>z.y.x :: a -&gt; d</code>.</li>\n</ol>\n\n<p>Since <code>z</code> is the first argument to <code>tm2</code>, <code>y</code> is the second and <code>x</code> is the third argument, you can tell that</p>\n\n<pre><code>tm2 :: (c -&gt; d) -&gt; (b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; d)\n</code></pre>\n"}], "owner": {"reputation": 477, "user_id": 4254033, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/bf1ada35cd0755b213121663b1140f91?s=128&d=identicon&r=PG&f=1", "display_name": "skulpt", "link": "https://stackoverflow.com/users/4254033/skulpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 830, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1451863827, "creation_date": 1451843795, "question_id": 34579683, "link": "https://stackoverflow.com/questions/34579683/haskell-evaluating-lambda-expressions-manually-determine-general-types", "title": "Haskell: Evaluating lambda expressions manually - determine general types", "body": "<p>First of all, sorry if I'm not not posting this on the correct site since I'm not sure if it's more of a mathematical question than a programming one, but since I'm using this with Haskell and comparing the results with a Haskell interpreter, I just thought I'd ask it here.</p>\n\n<p>So I'm basically trying to evaluate lambda expressions in Haskell and I'm doing it manually (in preparation for an exam, since I'll be forced to do it on paper). I'm given some expressions and I have to write down their general types after they're evaluated. To do so, I'm using an interpreter to get a somewhat correct answer.</p>\n\n<p>In particular, I'm going to evaluate the following expressions:</p>\n\n<pre><code>t2 = ( \\x y z  -&gt; y.x.y );\ntx2 = (\\x y z -&gt; y.z.z);\ntp2 = (\\x -&gt; \\y -&gt; (x.y.x));\ntd2 = (\\x y z f -&gt; y(z(z(f))));\ntm2 = (\\z -&gt; \\y -&gt; \\x -&gt; z.y.x);\n</code></pre>\n\n<p>Since I don't 100% understand how to do this, I've devised a method. First, I create a template that somewhat resembles what the evaluated expression will look like. I.E. if part of the left-size ('lambda'd') variable is featured on the right side (as it's pretty much functional composition in every case), it's a function. If not, it's just a variable. Afterwards, I'm trying to fit the general types of the functions as best as I can and I'm getting some semi-right results, but I'm sure I'm still making some mistakes. Here's my whole evaluation process:</p>\n\n<pre><code>t2 = ( \\x y z -&gt; y.x.y );\n\n(_ -&gt; _) -&gt; (_ -&gt; _) -&gt; c -&gt; _ -&gt; _\n\ny(x(y))\nassume: \ny :: a -&gt; b\nx :: b -&gt; a\n\nresult: (b -&gt; a) -&gt; (a -&gt; b) -&gt; c -&gt; a -&gt; b\ninterpreter: (a -&gt; b) -&gt; (b -&gt; a) -&gt; c -&gt; b -&gt; a\n</code></pre>\n\n<p>z isn't featured on the right side, so it's not a function in this case. I'm assigning it c. Now I'm looking at the composition on the right side. I'm going right to left and I assign a -> b to y since I have no idea about it's input or output. Since x uses the result of y as an input, and y uses x' output as an input again, x is b -> a. Which I can just insert into my template.\nAs you can see, it's not exactly the same result as I get via the interpreter, but it's only a and b being switched around, so it doesn't seem that wrong.</p>\n\n<pre><code>tx2 = (\\x y z -&gt; y.z.z);\n\na -&gt; (_ -&gt; _) -&gt; (_ -&gt; _) -&gt; _ -&gt; _\n\ny(z(z))\nassume: \nz :: b -&gt; b\ny :: b -&gt; c\n\nresult: a -&gt; (b -&gt; c) -&gt; (b -&gt; b) -&gt; b -&gt; c\ninterpreter: a -&gt; (b -&gt; c) -&gt; (b -&gt; b) -&gt; b -&gt; c\n</code></pre>\n\n<p>Same as above. Since z uses itself in functional composition, I assume it has the same input and output. y uses z's output as input and has some unknown output, hence c. This appears to be in line with my interpreter.</p>\n\n<pre><code>tp2 = (\\x -&gt; \\y -&gt; (x.y.x));\n\n(_ -&gt; _) -&gt; (_ -&gt; _) -&gt; _ -&gt; _\n\nx(y(x))\nassume: \nx :: a -&gt; b\ny :: b -&gt; a\n\nresult: (a -&gt; b) -&gt; (b -&gt; a) -&gt; a -&gt; b\ninterpreter: (a -&gt; b) -&gt; (b -&gt; a) -&gt; a -&gt; b\n</code></pre>\n\n<p>Pretty much the same as the first example, only I don't have an unused lambda variable.</p>\n\n<pre><code>td2 = (\\x y z f -&gt; y(z(z(f))));\n\na -&gt; (_ -&gt; _) -&gt; (_ -&gt; _) -&gt; (_ -&gt; _) -&gt; _ -&gt; _\n\ny(z(z(f)))\nassume:\nf :: _ -&gt; b\nz :: b -&gt; b\ny :: b -&gt; c\n\nassume: a -&gt; (b -&gt; c) -&gt; (b -&gt; b) -&gt; (_ -&gt; b) -&gt; b -&gt; c\nresult: a -&gt; (b -&gt; c) -&gt; (b -&gt; b) -&gt; (b -&gt; b) -&gt; b -&gt; c\ninterpreter: a -&gt; (b -&gt; c) -&gt; (b -&gt; b) -&gt; b -&gt; c\n</code></pre>\n\n<p>Everything but x is a function in this case. f's Input isn't initially known to me and I'm just leaving it empty at the time. z uses f's output and it's own output in composition, so I just assign it b -> b. y uses z's output, and has an unknown output itself, so it gets b -> c. \nNow I insert it into my template, but I'm still missing an input for f. Since there's a b right after f, I just assume it uses b as an input, too.\n<strong>Now there's the first real question:</strong> where did f disappear to in the answer given by the interpreter? I can only assume since it uses the same input/output as z and it's basically in composition with it, it just got simplified into a single b->b, but I'm not sure about this.</p>\n\n<pre><code>tm2 = (\\z -&gt; \\y -&gt; \\x -&gt; z.y.x);\ntm2 = (\\z y x -&gt; z.y.x);\n\n(_ -&gt; _) -&gt; (_ -&gt; _) -&gt; (_ -&gt; _) -&gt; _ -&gt; _\n\nz(y(x))\nassume:\nx = a -&gt; b\ny = b -&gt; _\nz = _ -&gt; _\n\nassume: (_ -&gt; _) -&gt; (b -&gt; _) -&gt; (a -&gt; b) -&gt; _ -&gt; _\nresult?: (a -&gt; c) -&gt; (b -&gt; a) -&gt; (a -&gt; b) -&gt; a -&gt; c\ninterpreter: (a -&gt; b) -&gt; (c -&gt; a) -&gt; (d -&gt; c) -&gt; d -&gt; b\n</code></pre>\n\n<p><strong>Here's where it all falls apart:</strong> z, y, and x are functions. So I'm just assigning a -> b to x, which means that y's input is b. The output is unknown to me at this time. Same goes for z, since I have no idea about y's output.\nSo after I enter them in my template, the only thing that's really left for me is just to fill in the blanks for unknown values. Since x would require a as input, it means that there's an a right after it. Which would mean that it's z's input, too. Since it's z's input, I can assume it's y's output. The only thing left to fill in is z's output, and I just assign it a c since I don't really know what it could be.</p>\n\n<p>As you can see, this isn't what the interpreter gives me, at all. While the left hand side might be still somewhat similar, I don't understand what happens on the right hand side, at all. Why is it d -> b? Shouldn't it be whatever's the result of (z(y(x))), which should have z's input/output?</p>\n\n<p>Thanks in advance for any help you might offer me.</p>\n"}, {"tags": ["arrays", "haskell", "repa"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1451853808, "post_id": 34581269, "comment_id": 56907852, "body": "But you&#39;d first have to concat the arrays, wouldn&#39;t you? That incurs a runtime cost and also the question of how to treat the lengths."}, {"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1451858575, "post_id": 34581269, "comment_id": 56909429, "body": "An Unboxed array is kept in a memory chunk, so you have to reserve the chunk to fill it with data. If you&#39;ve got a group of such chunks (the 1D&#39;s arrays) then you have to copy the memory into new, bigger chunk - no matter if you&#39;re using Haskell, C++ or any other high-performance language here. If you want to create a 2D array from a list of 1D&#39;s you have to copy all the data from those 1D&#39;s into a new reserved chunk of memory.  What do you mean by &quot;how to treat the lengths&quot;?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451859609, "post_id": 34581269, "comment_id": 56909757, "body": "He may be referring to the fact that arrays are not indexed by size."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1452022847, "post_id": 34581269, "comment_id": 56985348, "body": "Sounds good. Is there a built-in way how to concatenate a collection of arrays (of equal lengths)?"}], "tags": [], "owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "is_accepted": false, "score": 1, "last_activity_date": 1451853099, "creation_date": 1451853099, "answer_id": 34581269, "question_id": 34579177, "link": "https://stackoverflow.com/questions/34579177/how-to-create-a-2-dimensional-unboxed-array-from-a-list-of-1-dimensional-ones/34581269#34581269", "title": "How to create a 2-dimensional unboxed array from a list of 1-dimensional ones?", "body": "<p>Use the <code>reshape</code> function: <code>reshape :: (Shape sh1, Shape sh2, Source r1 e) =&gt; sh2 -&gt; Array r1 sh1 e -&gt; Array D sh2 e</code>.\nIt's compile-time only (no runtime overhead).</p>\n"}, {"tags": [], "owner": {"reputation": 677, "user_id": 3536806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c5321e2babfa1c70186599163a3c188?s=128&d=identicon&r=PG&f=1", "display_name": "Dominik Schrempf", "link": "https://stackoverflow.com/users/3536806/dominik-schrempf"}, "is_accepted": false, "score": 0, "last_activity_date": 1551093368, "creation_date": 1551093368, "answer_id": 54864994, "question_id": 34579177, "link": "https://stackoverflow.com/questions/34579177/how-to-create-a-2-dimensional-unboxed-array-from-a-list-of-1-dimensional-ones/54864994#54864994", "title": "How to create a 2-dimensional unboxed array from a list of 1-dimensional ones?", "body": "<p>I also stumbled upon this problem. I resolved it by converting the list of\narrays to unboxed vectors, concatenating those, and converting them back to a\nrepa array. Very clumsy, but that's all I could think about.</p>\n\n<pre><code>import           Data.Array.Repa     as R\nimport           Data.Vector.Unboxed as V\nimport           Prelude             as P\n\narrs = P.replicate 5 $ fromListUnboxed (ix1 10) [0..9 :: Int]\n\nmain = print concatenatedArrs\n  where vectors = P.map toUnboxed arrs\n        concatenatedVectors = V.concat vectors\n        concatenatedArrs = fromUnboxed (R.ix2 5 10) concatenatedVectors\n</code></pre>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1551093368, "creation_date": 1451840667, "last_edit_date": 1451855569, "question_id": 34579177, "link": "https://stackoverflow.com/questions/34579177/how-to-create-a-2-dimensional-unboxed-array-from-a-list-of-1-dimensional-ones", "title": "How to create a 2-dimensional unboxed array from a list of 1-dimensional ones?", "body": "<p>Repa has <a href=\"https://hackage.haskell.org/package/repa-3.4.0.2/docs/Data-Array-Repa-Repr-Unboxed.html#v:fromListUnboxed\" rel=\"nofollow\"><code>fromListUnboxed</code></a> that allows to create a 1-dimensional array from a list of values. But how can I create a 2-dimensional one given a list of 1-dimensional unboxed ones (of equal lengths)?</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 1, "creation_date": 1451867051, "post_id": 34577312, "comment_id": 56911717, "body": "You want <code>readTable &gt;&gt;= printTable</code>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451831460, "post_id": 34577526, "comment_id": 56899891, "body": "Add some remark about what happens when the input file has too few lines?"}, {"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451831552, "post_id": 34577526, "comment_id": 56899924, "body": "What i&#39;d like to achieve would be manipulating the data i gather from the file, so the readTable function is just there to read the table into the list and printTable would be a function which would print the changes. Now let&#39;s say table contains elements [1,2,3] and i&#39;d like to change it to [3,2,1] (and do other stuff with different functions later on) and then print it out (and not do it in readTable function). Is this type of manipulation possible?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451831827, "post_id": 34577526, "comment_id": 56900014, "body": "@Banana so have a function <code>changeTable :: String -&gt; String</code> and call it inside your <code>do</code> block too, like <code>...; let s2 = changeTable removeHead ; printTable s2</code>."}, {"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451832016, "post_id": 34577526, "comment_id": 56900087, "body": "Okay, so all the action basically has to happen inside the readTable function as i understand? If i do any other I/O with user action, it has to be called out from there aswell?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1451832303, "post_id": 34577526, "comment_id": 56900193, "body": "inside a <code>do</code> block. You can have <code>readTable :: IO String</code>, then you use it inside another <code>do</code> block as <code>do { ... ; s &lt;- readTable ; let s2 = trasnformTable s ; print s2 }</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451832411, "post_id": 34577526, "comment_id": 56900230, "body": "@dfeuer perhaps  it&#39;s better to let the user ask another question about handling errors, to keep this focused on the basics?.."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451832593, "post_id": 34577526, "comment_id": 56900299, "body": "@Banana and you write the <code>readTable</code> as <code>do { .... ; s &lt;- ... ; return s }</code>, so it has type <code>IO String</code>, meaning, an <code>IO</code> computation producing a <code>String</code>. Then the <code>s</code> in <code>s &lt;- readTable</code> will have type <code>String</code> (the pure type)."}, {"owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "edited": false, "score": 0, "creation_date": 1451832721, "post_id": 34577526, "comment_id": 56900342, "body": "Okay, i&#39;ll try it out from here on. Thanks for explaining, marking you as an answer :)"}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 2, "last_activity_date": 1451831377, "last_edit_date": 1451831377, "creation_date": 1451830872, "answer_id": 34577526, "question_id": 34577312, "link": "https://stackoverflow.com/questions/34577312/haskell-io-string-to-string/34577526#34577526", "title": "Haskell: IO [String] to [String]", "body": "<p>Just use your <code>printTable</code> <em>inside</em> the <code>do</code>-block to process the string that <code>readTable</code> produces:</p>\n\n<pre><code>readTable = do\n  s &lt;- readFile \"projekt-board.txt\"\n  let content = lines s\n  let removeEnd = init(content)\n  let removeHead = tail(removeEnd)\n  printTable removeHead\n</code></pre>\n\n<p>You can't get a pure value from the IO monad <code>do</code>-block out into the pure Haskell world; but you don't need to.</p>\n\n<p>Each line in the IO <code>do</code>-block must have the same type, <code>IO a</code> -- <code>a</code> may vary of course, but it must be of the same form <code>IO a</code>. The type of the last line in <code>do</code> block is the type of the <code>do</code> block as a whole. For instance,</p>\n\n<pre><code> #&gt; :t putStr \"\"\nputStr \"\" :: IO ()\n</code></pre>\n\n<p>So, </p>\n\n<pre><code>printTable            :: String -&gt; IO ()\n           removeHead :: String\nprintTable removeHead ::           IO ()\n</code></pre>\n\n<p>fits.</p>\n"}], "owner": {"reputation": 604, "user_id": 5353712, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c3786108965edf49a986898c82ab8bfa?s=128&d=identicon&r=PG&f=1", "display_name": "Banana", "link": "https://stackoverflow.com/users/5353712/banana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3058, "favorite_count": 1, "closed_date": 1451833496, "accepted_answer_id": 34577526, "answer_count": 1, "score": 2, "last_activity_date": 1451831377, "creation_date": 1451829648, "last_edit_date": 1495540746, "question_id": 34577312, "link": "https://stackoverflow.com/questions/34577312/haskell-io-string-to-string", "closed_reason": "Duplicate", "title": "Haskell: IO [String] to [String]", "body": "<p>Now this is a thread that has been through stackoverflow a lot this also is covered by other sites but i still can't wrap my head around it fully. I've read different stuff from this site, i'm linking them in the bottom, but now to the question.</p>\n\n<p>As usual, i'm trying to read lines from file:</p>\n\n<pre><code>readTable = do\n  s &lt;- readFile \"projekt-board.txt\"\n  let content = lines s\n  let removeEnd = init(content)\n  let removeHead = tail(removeEnd)\n  return removeHead\n\nprintTable [] = putStr \"\"\nprintTable [x] = putStrLn x\nprintTable (x:xs) = do\n  let element = x\n  putStrLn element\n  printTable xs\n</code></pre>\n\n<p>I can't wrap my head around that why i don't get IO [String] -> [String] exception in function readTable, however calling out printTable with an argument of readTable gives me an error.</p>\n\n<p>Is there a way to hoax around IO [String] type, maybe by accessing every element in IO [String] list and then creating a new, pure one? Or can i still do basic list operations with IO [String] type (however with this i have failed so far).</p>\n\n<p>Some reading material that i've gone through however it has gotten me even more confused:</p>\n\n<p><a href=\"http://blog.sigfpe.com/2007/11/io-monad-for-people-who-simply-dont.html\" rel=\"nofollow noreferrer\">The IO Monad for people who simply don't care</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/11229854/how-can-i-parse-the-io-string-in-haskell\">How can i parse IO string in haskell (stackoverflow)</a></p>\n\n<p><a href=\"https://www.haskell.org/tutorial/io.html\" rel=\"nofollow noreferrer\">A gentle introduction to Haskell</a></p>\n\n<p><a href=\"https://wiki.haskell.org/Tutorials/Programming_Haskell/String_IO\" rel=\"nofollow noreferrer\">Haskell IO from Haskell Wiki</a></p>\n\n<p>EDIT:</p>\n\n<p>An error thrown on call-out:</p>\n\n<pre><code>printTable readTable\n\nCouldn't match expected type `[String]'\n            with actual type `IO [String]'\nIn the first argument of `printTable', namely `readTable'\nIn the expression: printTable readTable\nIn an equation for `it': it = printTable readTable\n</code></pre>\n"}, {"tags": ["html", "xml", "haskell", "html-parsing", "xml-conduit"], "comments": [{"owner": {"reputation": 7134, "user_id": 3687048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/i0GDr.jpg?s=128&g=1", "display_name": "Mark Karpov", "link": "https://stackoverflow.com/users/3687048/mark-karpov"}, "edited": false, "score": 0, "creation_date": 1452077337, "post_id": 34577021, "comment_id": 57007627, "body": "Try  <a href=\"https://hackage.haskell.org/package/tagsoup\" rel=\"nofollow noreferrer\"><code>tagsoup</code></a>."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 3684733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddffb7d306182c1088d6e478916d39d4?s=128&d=identicon&r=PG&f=1", "display_name": "\u0412\u043b\u0430\u0434\u0438\u043c\u0438\u0440", "link": "https://stackoverflow.com/users/3684733/%d0%92%d0%bb%d0%b0%d0%b4%d0%b8%d0%bc%d0%b8%d1%80"}, "edited": false, "score": 0, "creation_date": 1451844758, "post_id": 34577645, "comment_id": 56904591, "body": "I understand that the unclosed tags do not correspond to the format of XML, but it is a third-party site and modify the data can not. Using a library obtained tagsoup disassemble site without errors, but it is not convenient to work with. I would like to find a solution to Text.XML."}, {"owner": {"reputation": 88945, "user_id": 290085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/306077a2fb7af6587f470214a1b337ff?s=128&d=identicon&r=PG", "display_name": "kjhughes", "link": "https://stackoverflow.com/users/290085/kjhughes"}, "reply_to_user": {"reputation": 25, "user_id": 3684733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddffb7d306182c1088d6e478916d39d4?s=128&d=identicon&r=PG&f=1", "display_name": "\u0412\u043b\u0430\u0434\u0438\u043c\u0438\u0440", "link": "https://stackoverflow.com/users/3684733/%d0%92%d0%bb%d0%b0%d0%b4%d0%b8%d0%bc%d0%b8%d1%80"}, "edited": false, "score": 0, "creation_date": 1451846273, "post_id": 34577645, "comment_id": 56905145, "body": "Third party doesn&#39;t matter.  Inconvenient doesn&#39;t matter.  <b>It&#39;s not XML, so you can&#39;t expect to use an XML library.</b>  I&#39;m trying to help you by explaining your options, but if you&#39;re holding out for an XML library to help you parse non-XML data, neither I nor anyone else can help you.  Good luck."}], "tags": [], "owner": {"reputation": 88945, "user_id": 290085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/306077a2fb7af6587f470214a1b337ff?s=128&d=identicon&r=PG", "display_name": "kjhughes", "link": "https://stackoverflow.com/users/290085/kjhughes"}, "is_accepted": true, "score": 1, "last_activity_date": 1451832080, "last_edit_date": 1451832080, "creation_date": 1451831589, "answer_id": 34577645, "question_id": 34577021, "link": "https://stackoverflow.com/questions/34577021/how-to-ignore-unclosed-tags-in-xml-or-html/34577645#34577645", "title": "How to ignore unclosed tags in XML or HTML?", "body": "<p>A text object with unclosed tags is not <a href=\"http://www.w3.org/TR/REC-xml/#sec-well-formed\" rel=\"nofollow\"><strong><em>well-formed</em></strong></a> and <strong><em>is therefore not XML.</em></strong></p>\n\n<p>So, forget about using any XML libraries, parsers, or tools.  They are, by definition and design, not able to help you.</p>\n\n<p>You have two options.  Either,</p>\n\n<ol>\n<li>Repair the textual object to be well-formed by closing the unclosed\ntags.  You might do this manually or try using <a href=\"http://www.w3.org/People/Raggett/tidy/\" rel=\"nofollow\">TIDY</a>, or</li>\n<li>Define a new data format that allows unclosed tags, and write a\nparser from the ground up for it.</li>\n</ol>\n"}], "owner": {"reputation": 25, "user_id": 3684733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddffb7d306182c1088d6e478916d39d4?s=128&d=identicon&r=PG&f=1", "display_name": "\u0412\u043b\u0430\u0434\u0438\u043c\u0438\u0440", "link": "https://stackoverflow.com/users/3684733/%d0%92%d0%bb%d0%b0%d0%b4%d0%b8%d0%bc%d0%b8%d1%80"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1389, "favorite_count": 0, "accepted_answer_id": 34577645, "answer_count": 1, "score": 1, "last_activity_date": 1451832080, "creation_date": 1451827604, "last_edit_date": 1451831868, "question_id": 34577021, "link": "https://stackoverflow.com/questions/34577021/how-to-ignore-unclosed-tags-in-xml-or-html", "title": "How to ignore unclosed tags in XML or HTML?", "body": "<p>I'm writing a parser in Haskell for the site using the packages Text.XML and Text.XML.Cursor.</p>\n\n<p>There are unclosed tags and get an error:</p>\n\n<blockquote>\n  <p>Main.hs: Error parsing XML file dat.html: 29:1-29:8: Expected end\n  element for: Name {nameLocalName = \"br\", nameNamespace = Nothing,\n  namePrefix = Nothing}, but received: EventEndElement (Name\n  {nameLocalName = \"body\", nameNamespace = Nothing, namePrefix =\n  Nothing})</p>\n</blockquote>\n\n<p>What to do? How to ignore such tags?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 178, "user_id": 4556658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/176748782a450651ab1ef750943e5f35?s=128&d=identicon&r=PG&f=1", "display_name": "sdx23", "link": "https://stackoverflow.com/users/4556658/sdx23"}, "edited": false, "score": 0, "creation_date": 1451821770, "post_id": 34575911, "comment_id": 56897077, "body": "BangPatterns are just an extension, they can/will be substituted by <code>case</code> statements with a single case."}, {"owner": {"reputation": 6824, "user_id": 2144227, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/BiCrB.jpg?s=128&g=1", "display_name": "Manuel Eberl", "link": "https://stackoverflow.com/users/2144227/manuel-eberl"}, "reply_to_user": {"reputation": 178, "user_id": 4556658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/176748782a450651ab1ef750943e5f35?s=128&d=identicon&r=PG&f=1", "display_name": "sdx23", "link": "https://stackoverflow.com/users/4556658/sdx23"}, "edited": false, "score": 1, "creation_date": 1451823874, "post_id": 34575911, "comment_id": 56897693, "body": "Did I say they were not an extension? And by <code>case</code> statement, you mean in the GHC Core output? Yes, that is what I would expect to happen, but I still do not know of any way to achieve this in Haskell without using the built-in <code>seq</code>, or something like <code>BangPatterns</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 178, "user_id": 4556658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/176748782a450651ab1ef750943e5f35?s=128&d=identicon&r=PG&f=1", "display_name": "sdx23", "link": "https://stackoverflow.com/users/4556658/sdx23"}, "edited": false, "score": 2, "creation_date": 1451826541, "post_id": 34575911, "comment_id": 56898409, "body": "@sdx23 In general that&#39;s not true: a function-valued expression can not be forced by <code>case</code> in Haskell (unlike in GHC Core, where <code>case</code> does evaluate). You can define a <code>seq</code>-like function for all algebraic data types, by pattern matching against a constructor: for that <code>case</code> in indeed enough."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1451827014, "post_id": 34575911, "comment_id": 56898537, "body": "@ManuelEberl In plain lambda calculus, even when enriched with algebraic data types, you can&#39;t define <code>seq</code>. Otherwise, it wouldn&#39;t be a primitive. Theoretically, IIRC, some parametricity results are broken by <code>seq</code> but do hold in the LC, so ..."}, {"owner": {"reputation": 6824, "user_id": 2144227, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/BiCrB.jpg?s=128&g=1", "display_name": "Manuel Eberl", "link": "https://stackoverflow.com/users/2144227/manuel-eberl"}, "edited": false, "score": 0, "creation_date": 1451832569, "post_id": 34575911, "comment_id": 56900291, "body": "That&#39;s what I thought, but the Haskell standard is big and I don&#39;t know it that well. Anyway, <code>case</code> is also strict on tuples. <code>case undefined of (_, _) -&gt; 42</code> will return \u22a5. If one annotates the pattern match as irrefutable explicitly with <code>~</code>, it returns 42: <code>case undefined of ~(_, _) -&gt; 42</code>."}, {"owner": {"reputation": 2642, "user_id": 3034482, "user_type": "registered", "accept_rate": 14, "profile_image": "https://i.stack.imgur.com/62QDU.jpg?s=128&g=1", "display_name": "MichaelMoser", "link": "https://stackoverflow.com/users/3034482/michaelmoser"}, "edited": false, "score": 0, "creation_date": 1451833931, "post_id": 34575911, "comment_id": 56900727, "body": "what is the point of forcing the evaluation of the first parameter if the return value is ignored and its evaluation can&#39;t leave any side effects? (i am trying to learn)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2642, "user_id": 3034482, "user_type": "registered", "accept_rate": 14, "profile_image": "https://i.stack.imgur.com/62QDU.jpg?s=128&g=1", "display_name": "MichaelMoser", "link": "https://stackoverflow.com/users/3034482/michaelmoser"}, "edited": false, "score": 1, "creation_date": 1451837832, "post_id": 34575911, "comment_id": 56902050, "body": "@MichaelMoser, sometimes it&#39;s a lot cheaper (especially in terms of memory, but often also time) to perform a calculation immediately than to delay it until it&#39;s needed. The classic example is something using an accumulating argument to, e.g., sum a list. You want to actually add each number to the sum as you go, rather than building up a huge chain of things to sum later. <code>seq</code> is a way to do that. Bang patterns are, typically, a nicer one. The theoretical concerns chi mentioned get pretty annoying; I wish the Haskell designers had stuck to a more limited <code>seq</code>."}], "tags": [], "owner": {"reputation": 6824, "user_id": 2144227, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/BiCrB.jpg?s=128&g=1", "display_name": "Manuel Eberl", "link": "https://stackoverflow.com/users/2144227/manuel-eberl"}, "is_accepted": false, "score": 6, "last_activity_date": 1451819983, "creation_date": 1451819983, "answer_id": 34575911, "question_id": 34575816, "link": "https://stackoverflow.com/questions/34575816/haskell-prelude-definition-of-seq/34575911#34575911", "title": "haskell prelude : definition of seq", "body": "<p>As you can see in the <a href=\"https://wiki.haskell.org/Seq\" rel=\"noreferrer\">Haskell Wiki entry on <code>seq</code></a>, the <code>seq</code> function must fulfil the following two equations:</p>\n\n<pre><code>\u22a5 `seq` b = \u22a5\na `seq` b = b\n</code></pre>\n\n<p>(where <code>\u22a5</code> is the undefined value, which is what non-terminating function applications or things like <code>hd []</code> and <code>undefined</code> evaluate to logically)</p>\n\n<p>Your definition clearly does not fulfil the first equation.</p>\n\n<p>The typical use case for <code>seq</code> is to force evaluation of the first parameter (to weak head normal form) before evaluating the second one. (although, strictly speaking, <code>seq</code> does not guarantee that; see again the wiki article)</p>\n\n<p>Such a function is, to my knowledge, not definable in pure Haskell without any compiler extensions like <code>-XBangPatterns</code>.</p>\n"}], "owner": {"reputation": 2642, "user_id": 3034482, "user_type": "registered", "accept_rate": 14, "profile_image": "https://i.stack.imgur.com/62QDU.jpg?s=128&g=1", "display_name": "MichaelMoser", "link": "https://stackoverflow.com/users/3034482/michaelmoser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 399, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1451876932, "creation_date": 1451819304, "last_edit_date": 1451876932, "question_id": 34575816, "link": "https://stackoverflow.com/questions/34575816/haskell-prelude-definition-of-seq", "title": "haskell prelude : definition of seq", "body": "<p>In the <a href=\"https://www.haskell.org/onlinereport/standard-prelude.html\" rel=\"nofollow\">definition of the haskell prelude</a> we see that <code>...</code> is reserved for expressions that cannot be implemented in Haskell. Now the <code>IO</code> monad for example can't be implemented in haskell.</p>\n\n<p>What surprised me is that <code>seq</code> is defined as follows in the prelude </p>\n\n<pre><code>seq :: a -&gt; b -&gt; b\nseq = ...       -- Primitive\n</code></pre>\n\n<p>Why not the following? what am i missing?</p>\n\n<pre><code>seq _ b = b\n</code></pre>\n"}, {"tags": ["haskell", "monads", "category-theory", "free-monad"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 7, "last_activity_date": 1451821892, "last_edit_date": 1451821892, "creation_date": 1451821485, "answer_id": 34576153, "question_id": 34575522, "link": "https://stackoverflow.com/questions/34575522/free-monad-and-the-free-operation/34576153#34576153", "title": "Free monad and the free operation", "body": "<p>The Haskell translation seems wrong. A big hint is that your <code>free</code> implementation doesn't use monadic bind (or join) anywhere. You can find <code>free</code> as <a href=\"https://hackage.haskell.org/package/free-4.12/docs/src/Control-Monad-Free.html#foldFree\"><code>foldFree</code></a> with the following definition:</p>\n\n<pre><code>free :: Monad m =&gt; (forall x. t x -&gt; m x) -&gt; (forall a. Free t a -&gt; m a)\nfree f (Pure a)  = return a\nfree f (Free fs) = f fs &gt;&gt;= free f\n</code></pre>\n\n<p>The key point is that <code>f</code> specializes to <code>t (Free t a) -&gt; m (Free t a)</code>, thus eliminating one <code>Free</code> layer in one fell swoop.</p>\n"}, {"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 1, "creation_date": 1451822186, "post_id": 34576179, "comment_id": 56897185, "body": "indeed, and it&#39;s a nice alternative to the other answer using join instead of bind. I wish I could mark those two answers as correct"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1451822657, "post_id": 34576179, "comment_id": 56897327, "body": "Note that this <code>free</code> is in terms of the recursion principle for <code>Free</code>: <code>free f = fold (join . f) return</code> where <code>fold :: Functor f =&gt; (f b -&gt; b) -&gt; (a -&gt; b) -&gt; Free f a -&gt; b</code>. In comparison, the library <a href=\"https://hackage.haskell.org/package/free-4.12/docs/src/Control-Monad-Free.html#foldFree\" rel=\"nofollow noreferrer\"><code>foldFree</code></a> with <code>&gt;&gt;=</code> doesn&#39;t require a <code>Functor</code> constraint, because the <code>Free</code> data type in Haskell is valid for all <code>f :: * -&gt; *</code> parameters, and we can compute on that structure directly (although <code>Free f a</code> with non-functor <code>f</code> isn&#39;t very useful)."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 3, "last_activity_date": 1451821665, "creation_date": 1451821665, "answer_id": 34576179, "question_id": 34575522, "link": "https://stackoverflow.com/questions/34575522/free-monad-and-the-free-operation/34576179#34576179", "title": "Free monad and the free operation", "body": "<p>I don't know about the category theory part, but the Haskell part is definitely not well-typed with your original implementation and original type signature.</p>\n\n<p>Given</p>\n\n<pre><code>free :: (Functor t, Monad m) =&gt; (\u2200 a. t a \u2192 m a) \u2192 (\u2200 a. Free t a \u2192 m a)\n</code></pre>\n\n<p>when you pattern match on <code>Free tfta</code>, you get</p>\n\n<pre><code>tfta :: t (Free t a)\nf :: forall a. t a -&gt; m a \nfree :: (forall a. t a -&gt; m a) -&gt; forall a. Free t a -&gt; m a\n</code></pre>\n\n<p>And thus</p>\n\n<pre><code>free f :: forall a. Free t a -&gt; m a\n</code></pre>\n\n<p>leading to</p>\n\n<pre><code>fmap (free f) :: forall a. t (Free t a) -&gt; t (m a) \n</code></pre>\n\n<p>So to be able to collapse that <code>t (m a)</code> into your desired <code>m a</code>, you need to apply <code>f</code> on it (to \"turn the <code>t</code> into an <code>m</code>\") and then exploit the fact that <code>m</code> is a Monad:</p>\n\n<pre><code>f . fmap (free f) :: forall a. t (Free t a) -&gt; m (m a)\njoin . f . fmap (free f) :: forall a. t (Free t a) -&gt; m a\n</code></pre>\n\n<p>which means you can fix your original definition by changing the second branch of <code>free</code>:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, UnicodeSyntax #-}\n\nimport Control.Monad.Free\nimport Control.Monad\n\nfree :: (Functor t, Monad m) =&gt; (\u2200 a. t a \u2192 m a) \u2192 (\u2200 a. Free t a \u2192 m a)\nfree f (Pure  a) = return a\nfree f (Free tfta) = join . f . fmap (free f) $ tfta\n</code></pre>\n\n<p>This typechecks, and is probably maybe could be what you want :)</p>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "accepted_answer_id": 34576153, "answer_count": 2, "score": 6, "last_activity_date": 1451821892, "creation_date": 1451817102, "last_edit_date": 1451820545, "question_id": 34575522, "link": "https://stackoverflow.com/questions/34575522/free-monad-and-the-free-operation", "title": "Free monad and the free operation", "body": "<p>One way to describe the Free monad is to say it is an <em>initial</em> monoid in the category of endofunctors (of some category <code>C</code>) whose objects are the endofunctors from <code>C</code> to <code>C</code>, arrows are the natural transformations between them. If we take <code>C</code> to be <code>Hask</code>, the endofunctor are what is called <code>Functor</code> in haskell, which are functor from <code>* -&gt; *</code> where <code>*</code> represents the objects of <code>Hask</code></p>\n\n<p>By initiality, any map from an endofunctor <code>t</code> to a monoid <code>m</code> in <code>End(Hask)</code> induces a map from <code>Free t</code> to <code>m</code>.</p>\n\n<p>Said otherwise, any natural transformation from a Functor <code>t</code> to a Monad <code>m</code> induces a natural transformation from <code>Free t</code> to <code>m</code></p>\n\n<p>I would have expected to be able to write a function </p>\n\n<pre><code>free :: (Functor t, Monad m) =&gt; (\u2200 a. t a \u2192 m a) \u2192 (\u2200 a. Free t a \u2192 m a)\nfree f (Pure  a) = return a\nfree f (Free (tfta :: t (Free t a))) =\n    f (fmap (free f) tfta) \n</code></pre>\n\n<p>but this fails to unify, whereas the following works</p>\n\n<pre><code>free :: (Functor t, Monad m) =&gt; (t (m a) \u2192 m a) \u2192 (Free t a \u2192 m a)\nfree f (Pure  a) = return a\nfree f (Free (tfta :: t (Free t a))) =\n    f (fmap (free f) tfta)\n</code></pre>\n\n<p>or its generalization with signature</p>\n\n<pre><code>free :: (Functor t, Monad m) =&gt; (\u2200 a. t a \u2192 a) \u2192 (\u2200 a. Free t a \u2192 m a)\n</code></pre>\n\n<p>Did I make a mistake in the category theory, or in the translation to Haskell ?</p>\n\n<p>I'd be interested to hear about some wisdom here..</p>\n\n<p>PS : code with that enabled</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, UnicodeSyntax #-}\nimport Control.Monad.Free\n</code></pre>\n"}, {"tags": ["haskell", "dependent-type", "idris"], "comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 1, "creation_date": 1451816599, "post_id": 34575361, "comment_id": 56895594, "body": "Ps, for those who wonder how this can be written in Idris, the Idris book, chapter &quot;3.4.3 Using Implicit Arguments in Functions&quot; seems to where the answer is."}], "answers": [{"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1451817436, "post_id": 34575485, "comment_id": 56895831, "body": "This is useful, &#39;coz it simplifies the caller code."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1451816667, "creation_date": 1451816667, "answer_id": 34575485, "question_id": 34575361, "link": "https://stackoverflow.com/questions/34575361/simple-dependently-typed-temperature-converter-in-haskell-is-it-possible-to-mak/34575485#34575485", "title": "Simple dependently typed Temperature converter in Haskell, is it possible to make this code shorter?", "body": "<p>If you want to remove the first two arguments, in Haskell you need a typeclass.</p>\n\n<pre><code>class IsUnit a where\n   getSUnit :: SUnit a\ninstance IsUnit Celsius where getSUnit = SCelsius\ninstance IsUnit Kelvin  where getSUnit = SKelvin\n\nconvertShort :: (IsUnit fromUnit, IsUnit toUnit) =&gt; Value fromUnit -&gt; Value toUnit\nconvertShort = convert getSUnit getSUnit\n</code></pre>\n\n<p>Note that this makes the code longer, not shorter -- but it allows the callers to omit the first singleton values.</p>\n\n<p>The above code also assumes that every unit is convertible to any other one, which is unrealistic. The original code also contains this issue. If that is not wanted, one could use a two-parameters type class:</p>\n\n<pre><code>class C from to where convert :: Value from -&gt; Value to\ninstance C Kelvin Celsius where ...\n-- etc.\n</code></pre>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 34575485, "answer_count": 1, "score": 0, "last_activity_date": 1451816667, "creation_date": 1451815906, "question_id": 34575361, "link": "https://stackoverflow.com/questions/34575361/simple-dependently-typed-temperature-converter-in-haskell-is-it-possible-to-mak", "title": "Simple dependently typed Temperature converter in Haskell, is it possible to make this code shorter?", "body": "<p>The function <code>convert</code> below has the type signature :</p>\n\n<p><code>SUnit fromUnit-&gt; SUnit toUnit -&gt;Value fromUnit -&gt; Value toUnit</code>, </p>\n\n<p>which has <strong>redundancy</strong>, because the same information could be expressed by : </p>\n\n<p><code>Value fromUnit -&gt; Value toUnit</code>. </p>\n\n<p>1) Is there a way to get rid of the first two arguments (<code>SUnit fromUnit-&gt; SUnit toUnit</code>) ?</p>\n\n<p>2) Is there some other way by which this simple dependently typed program could be written more elegantly ?</p>\n\n<p>3) How would this program look like in Idris ?</p>\n\n<pre><code>{-# LANGUAGE GADTs,DataKinds,KindSignatures #-}\nmain=do\n    putStrLn \"Hello !\"\n--  putStrLn $ show $ convert SCelsius  SCelsius kelvinZero -- this line does not compile\n    putStrLn $ show $ convert SKelvin SKelvin  kelvinZero -- prints Value 0.0\n    putStrLn $ show $ convert SKelvin SCelsius kelvinZero -- prints Value (-273.16)\n\nnewtype Value (unit::Unit) = Value Double deriving Show\ndata Unit = Celsius | Kelvin\n\ndata SUnit u where\n  SCelsius:: SUnit Celsius\n  SKelvin::  SUnit Kelvin\n\noffset=273.16\nconvert :: SUnit fromUnit-&gt; SUnit toUnit -&gt;Value fromUnit -&gt; Value toUnit\nconvert          SCelsius         SKelvin  (Value tempCel) = Value $tempCel+offset\nconvert          SCelsius         SCelsius (Value tempCel) = Value $tempCel\nconvert          SKelvin          SCelsius (Value tempK)   = Value $tempK-offset\nconvert          SKelvin          SKelvin  (Value tempK)   = Value $tempK\n\nkelvinZero::(Value 'Kelvin)\nkelvinZero= Value 0\n</code></pre>\n"}, {"tags": ["haskell", "reactive-programming", "frp", "arrows"], "comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 2, "creation_date": 1451815408, "post_id": 34572387, "comment_id": 56895259, "body": "which FRP and GUI library are you using?"}, {"owner": {"reputation": 227, "user_id": 3814154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f088a7b1bd081b844b1f28c3a8a186fb?s=128&d=identicon&r=PG&f=1", "display_name": "Lovaz", "link": "https://stackoverflow.com/users/3814154/lovaz"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 1, "creation_date": 1451816284, "post_id": 34572387, "comment_id": 56895498, "body": "@ErikAllik library for gui is UISF. And for sound - Euterpea."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1452009696, "post_id": 34572387, "comment_id": 56977329, "body": "very interesting paper btw. have you had any success though?"}, {"owner": {"reputation": 227, "user_id": 3814154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f088a7b1bd081b844b1f28c3a8a186fb?s=128&d=identicon&r=PG&f=1", "display_name": "Lovaz", "link": "https://stackoverflow.com/users/3814154/lovaz"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1452014300, "post_id": 34572387, "comment_id": 56980472, "body": "@ErikAllik I focused on other things. I don&#39;t want to have anything in common with functional GUIs. There are pain the ass. As a hobbyist haskeller I have too little knowledge. And I really need to finish my thesis so I abandoned the GUI idea :)"}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1452014398, "post_id": 34572387, "comment_id": 56980537, "body": "Understood. But actually functional GUI&#39;s are kind of becoming mainstream: just consider ReactJS and Angular 2.0 and many others \u2014 because it just scales and composes well. Also, Event Sourcing seems more mainstream than FRP but Event Sourcing is just a special case of FRP in disguise. So I think actually FP GUI&#39;s are pretty neat, just that you should choose a more mature library for real work, such as Reflex, Sodium or Reactive Banana."}, {"owner": {"reputation": 227, "user_id": 3814154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f088a7b1bd081b844b1f28c3a8a186fb?s=128&d=identicon&r=PG&f=1", "display_name": "Lovaz", "link": "https://stackoverflow.com/users/3814154/lovaz"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1452082645, "post_id": 34572387, "comment_id": 57010776, "body": "@ErikAllik Euterpea (library I have to work with) uses a lot ideas from UISF so I didn&#39;t have a choice. But thanks for clearing the FRP GUII stuff out :)"}], "owner": {"reputation": 227, "user_id": 3814154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f088a7b1bd081b844b1f28c3a8a186fb?s=128&d=identicon&r=PG&f=1", "display_name": "Lovaz", "link": "https://stackoverflow.com/users/3814154/lovaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1452083644, "creation_date": 1451783198, "last_edit_date": 1452083644, "question_id": 34572387, "link": "https://stackoverflow.com/questions/34572387/is-it-possible-to-create-another-signal-function-instancerestart-it-haskell", "title": "Is it possible to create another signal function instance?(restart it) Haskell", "body": "<p>I'm going to present you my ultimate problem.</p>\n\n<p>I'm trying to build a GUI app that generates some wave and displays it.</p>\n\n<p>Generating the sound is done and working:</p>\n\n<pre><code>lastKarplus :: forall p. Clock p =&gt; Double -&gt; SigFun p Double Double\nlastKarplus m = proc input -&gt; do\n            rec added &lt;- delayLine (m/(rate (undefined :: p)))  -&lt; input + feedback\n                feedback &lt;- fb -&lt; added\n            outA -&lt; added\n</code></pre>\n\n<p>which is a  part of a string function:</p>\n\n<pre><code>string :: Clock c =&gt; Int -&gt; SigFun c () Double\nstring 1 =  proc flag -&gt; do\n          out &lt;- lastKarplus2 535.3 &lt;&lt;&lt; burst1 535.3 -&lt; ()\n          outA -&lt; out\n</code></pre>\n\n<p>It produces time-varying Double values. They aree fed to Fourier transformat function and this data is fed to the graph I'm displaying</p>\n\n<p>The problematic part:</p>\n\n<pre><code>fftEx :: UISF () ()\nfftEx = let graLay = makeLayout (Stretchy 200) (Stretchy 300)\n    in proc () -&gt; do\n    rec b1value &lt;- withDisplay (button \"Reset\") -&lt; ()\n        b1pressed &lt;- unique -&lt; b1value\n        graphData &lt;- fftDataGenerator -&lt; b1pressed\n        _ &lt;- realtimeGraph graLay 2 Black -&lt; graphData\n    outA -&lt; ()\n\n\n\nfftDataGenerator :: UISF  (SEvent Bool) [(Double, Time)]\nfftDataGenerator = proc e -&gt; do\n            d &lt;- clockedSFToUISF 0.1 $ toFFT $ K.string 1  -&lt; ()\n            let (s, fft) = unzip d\n                (a1, _) =  unzip s\n            outA -&lt; zip a1 fft\n</code></pre>\n\n<p>At this point event <strong>b1pressed</strong> is ignored by the <strong>fftDataGenerator</strong> signal function. But I want it to behave like this:</p>\n\n<ul>\n<li>it doesn't start right away after launching the program</li>\n<li>event b1pressed can start the  signal function from time 0.</li>\n</ul>\n\n<p>I tried adding state to the signal functions, something along these lines:\n<a href=\"http://haskell.cs.yale.edu/wp-content/uploads/2015/10/dwc-yale-formatted-dissertation.pdf\" rel=\"nofollow\">Daniel Winograd-Cort - Effects, Asynchrony, and Choice in Arrowized Functional\nReactive Programming</a> page 43, but it's too much for me, I have to say.</p>\n\n<p>Even if I can remember if the funtion is running or not it always boils down to regenerating the wave from time zero. </p>\n\n<p>I would love to know if it's even possible. If someone wants to see the rest of this \"code\" I will provide it.</p>\n"}, {"tags": ["haskell", "bytestring"], "comments": [{"owner": {"reputation": 10220, "user_id": 2720372, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/olQxk.jpg?s=128&g=1", "display_name": "w.b", "link": "https://stackoverflow.com/users/2720372/w-b"}, "edited": false, "score": 0, "creation_date": 1451780358, "post_id": 34572007, "comment_id": 56889104, "body": "<code>fromString</code> function in Data.ByteString.UTF8 &quot;converts a Haskell string into a UTF8 encoded bytestring.&quot; - see <a href=\"https://hackage.haskell.org/package/utf8-string-0.3.8/docs/Data-ByteString-UTF8.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/utf8-string-0.3.8/docs/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2384183"}, "reply_to_user": {"reputation": 10220, "user_id": 2720372, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/olQxk.jpg?s=128&g=1", "display_name": "w.b", "link": "https://stackoverflow.com/users/2720372/w-b"}, "edited": false, "score": 1, "creation_date": 1451780868, "post_id": 34572007, "comment_id": 56889216, "body": "@w.b That may work, but ideally I want to process the argument in the character-encoding scheme in which it was provided (e.g. UTF-16)."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1451808078, "post_id": 34572007, "comment_id": 56893632, "body": "If you want to process Unicode, why don&#39;t you use <code>Text</code>? ByteString isn&#39;t really that Unicode friendly. Apart from that issue, you could transform the <code>String</code> to a <code>CStringLen</code> and create a <code>ByteString</code> from that. After all, you&#39;re already in <code>IO</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1451838979, "post_id": 34572007, "comment_id": 56902488, "body": "&quot;process the argument in the character-encoding scheme in which it was provided&quot;. Why? Normally one wants to forget about the encoding ASAP, and work with characters rather than their codes. Anyway, Unix arguments may be sequences of bytes, but Windows arguments are not, they are sequences of characters."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2384183"}, "edited": false, "score": 0, "creation_date": 1451852902, "post_id": 34572007, "comment_id": 56907539, "body": "I am not necessarily process Unicode; what&#39;s important for my purposes is processing the straight bits. I&#39;ll edit the question to clarify."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2384183"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1451854301, "post_id": 34572007, "comment_id": 56908021, "body": "@n.m. So are Windows arguments guaranteed to be in a certain character-encoding scheme?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1451856369, "post_id": 34572007, "comment_id": 56908699, "body": "Why? Why encoding schemes? Who needs them? The users certainly don&#39;t type any encoding schemes as they run your program. They type characters. You get characters they type. Who needs to know how these characters travel from the keyboard to your program?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1451857061, "post_id": 34572007, "comment_id": 56908938, "body": "As for Windows, yes, it operates in UTF-16 internally, or maybe in UCS-2, who knows. They probably can&#39;t tell the difference themselves. Why anyone should care, I have no idea."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1451867310, "post_id": 34572007, "comment_id": 56911781, "body": "How about using a <code>String</code> with <code>ord</code> and <code>chr</code>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2384183"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1451871976, "post_id": 34572007, "comment_id": 56912705, "body": "@DavidYoung Unfortunately no; I need to compare bytes from one source to bytes from another source, and <code>ord</code>/<code>chr</code> would yield Unicode codepoints above 255, which I would need to translate into bytes, and there&#39;s no certainty that the method I might use to do so would match the character-encoding scheme in which it was provided (if it is indeed provided in a valid character-encoding scheme)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1451878138, "post_id": 34572007, "comment_id": 56913937, "body": "I think that you&#39;re going to have to copy the sources from <code>System.Environment</code> - if you look at these sources, <code>getArgs</code> converts to the system encoding at the last moment, it reads the data as &quot;raw bytes&quot;. It seems that the code you want already exists, the piece you want is simply not exported as a function."}], "owner": {"user_type": "does_not_exist", "display_name": "user2384183"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 253, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1451853323, "creation_date": 1451779284, "last_edit_date": 1451853323, "question_id": 34572007, "link": "https://stackoverflow.com/questions/34572007/parse-command-line-arguments-as-bytestring", "title": "Parse command-line arguments as ByteString", "body": "<p>Is there a cross-platform way to parse program arguments into a list of <code>ByteString</code> (instead of a list of <code>String</code>, as in <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/System-Environment.html#v:getArgs\" rel=\"nofollow\"><code>System.Environment.getArgs</code></a>)?</p>\n\n<p>I am aware of <a href=\"http://hackage.haskell.org/package/unix-2.7.1.0/docs/System-Posix-Env-ByteString.html#v:getArgs\" rel=\"nofollow\"><code>System.Posix.Env.ByteString.getArgs</code></a> from the <a href=\"http://hackage.haskell.org/package/unix-2.7.1.0\" rel=\"nofollow\"><code>unix</code></a> package, but I would like to be able to run my program on Windows without cygwin. I am also aware of <a href=\"http://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString-Char8.html#v:pack\" rel=\"nofollow\"><code>Data.ByteString.Char8.pack</code></a>, but that truncates characters to 8 bits, and I would like to be able to process any <s>Unicode character</s> sequence of bytes.</p>\n\n<p>EDIT: My program is a simple cipher which xor's the bits of the key against the bits of the message. For that reason, I would prefer to process the exact bits that were provided to the program instead of translating them into UTF-8 and back first.</p>\n"}, {"tags": ["haskell", "lenses"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1451771182, "post_id": 34568958, "comment_id": 56886582, "body": "&quot;Functor makes a 1-1 relation&quot;. Does it?"}, {"owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1452104528, "post_id": 34568958, "comment_id": 57025416, "body": "<code>Functor</code> allows us to apply a pure function when declaring a <code>Lens</code>, thus presenting a <i>logical</i> &quot;1-1&quot; dataflow. The <code>Applicative</code> allows us to &quot;merge boxes&quot; (&quot;n-1&quot;), and the <code>Prism</code> gives us a way to break things."}, {"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 1, "creation_date": 1454938283, "post_id": 34568958, "comment_id": 58253040, "body": "Here is an interesting thread where the feature request necessitates the type <code>forall m. (Monad m) =&gt; (a -&gt; m b) -&gt; s -&gt; m t</code>. The resulting discussion is about why that type doesn&#39;t play well with the lens ecosystem. <a href=\"https://github.com/ekmett/lens/issues/109\" rel=\"nofollow noreferrer\">github.com/ekmett/lens/issues/109</a>"}], "owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 1, "answer_count": 0, "score": 5, "last_activity_date": 1452104578, "creation_date": 1451757585, "last_edit_date": 1452104578, "question_id": 34568958, "link": "https://stackoverflow.com/questions/34568958/additional-kinds-of-lenses-for-monad-monadplus-etc", "title": "Additional kinds of lenses for Monad/MonadPlus/etc?", "body": "<p>So, the <code>Functor</code> makes a 1-1 logical dataflow - a <code>Lens</code>.\nThe <code>Applicative</code> makes a n-1 logical dataflow - a <code>Traversal</code>.\nThe <code>Applicative</code> on the <code>Choice</code> <code>Profunctor</code> makes a \"break to parts\" mechanism - a <code>Prism</code>.</p>\n\n<p>Are there any interesting known structures involving a <code>Monad</code>, <code>MonadPlus</code>, etc capabilities or some other subsets of <code>Profunctors</code>?</p>\n"}, {"tags": ["haskell", "data-kinds", "phantom-types"], "comments": [{"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 6, "creation_date": 1451736501, "post_id": 34565655, "comment_id": 56875039, "body": "Remember that <code>type</code> is not generative. <code>Length Meter = Double = Length Km</code>. You have not introduced any unit-based distinctions here at all, I&#39;m afraid. You may do better with <code>newtype</code> or <code>data</code>."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1451736633, "post_id": 34565655, "comment_id": 56875071, "body": "Ok, so the key is that <code>type</code> is not generative, so I need to read up on what is generative and what is not :) thanks for guiding me towards the right direction."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1451737132, "post_id": 34565655, "comment_id": 56875234, "body": "Is this a good intro to what generative means ? <a href=\"http://www.seas.upenn.edu/~sweirich/papers/popl163af-weirich.pdf\" rel=\"nofollow noreferrer\">seas.upenn.edu/~sweirich/papers/popl163af-weirich.pdf</a>"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1451771661, "post_id": 34565655, "comment_id": 56886725, "body": "No. But it&#39;s not tricky. Generative definitions make new things. Non-generative definitions make new names for old things."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1451807034, "post_id": 34565655, "comment_id": 56893420, "body": "Thanks :) that indeed does not sound very scary."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 9, "last_activity_date": 1451738950, "creation_date": 1451738950, "answer_id": 34566058, "question_id": 34565655, "link": "https://stackoverflow.com/questions/34565655/how-to-use-data-kinds-phantom-types-to-encode-units-in-haskell/34566058#34566058", "title": "How to use Data Kinds + Phantom types to encode units in Haskell?", "body": "<p>It compiles because <code>type</code> doesn't introduce a <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-730004.2.2\" rel=\"noreferrer\">new <strong>distinct</strong> type</a>:</p>\n\n<blockquote>\n  <p>A type synonym declaration introduces a new type that is equivalent to an old type. \n  [...]</p>\n  \n  <p>Type synonyms are a convenient, but strictly syntactic, mechanism to make type signatures more readable. <strong><em>A synonym and its definition are completely interchangeable,</em></strong> [...]</p>\n</blockquote>\n\n<p>Completely, without restrictions, at any level, including type signatures. You can see this with an even shorter example:</p>\n\n<pre><code>type Clown a b = Double\n\nproof :: Clown a b -&gt; Clown b a\nproof = id\n</code></pre>\n\n<p>Since <code>Clown a b</code> and <code>Clown b a</code> are both <code>Double</code>&mdash;regardless of the actual <code>a</code> and <code>b</code>&mdash;both can be exchanged for <code>Double</code>, and <code>proof</code>'s type is <code>Double -&gt; Double</code>.</p>\n\n<p>While your constraint limits the possible types for <code>a</code> in <code>Length a</code>, it doesn't actually change the se&shy;man&shy;tics of the resulting type. Instead, use a <code>newtype</code>:</p>\n\n<pre><code>data LengthUnit = Km | Meter\nnewtype Length (unit::LengthUnit) = MkLength {getLength :: Double}\n\nonLength  :: (Double -&gt; Double) -&gt; Length a -&gt; Length a\nonLength f = MkLength . f . getLength\n\ndivideByTwo ::Length l -&gt; Length l\ndivideByTwo = onLength (/ 2)\n\ngetKm ::Double -&gt; Length Km\ngetKm = MkLength\n\n-- other code omitted\n</code></pre>\n\n<p>Now you will get the desired compile term errors, because <code>Length Km</code> and <code>Length Meter</code> are distinct types:</p>\n\n<pre><code>test.hs:25:44:\n    Couldn't match type 'Meter with 'Km\n    Expected type: Length 'Km\n      Actual type: Length 'Meter\n    In the second argument of `($)', namely `divideByTwo $ getMeter 1'\n    In the expression: isKm $ divideByTwo $ getMeter 1\n    In an equation for `this_should_not_compile_but_it_does':\n        this_should_not_compile_but_it_does\n          = isKm $ divideByTwo $ getMeter 1\n\ntest.hs:27:53:\n    Couldn't match type 'Meter with 'Km\n    Expected type: Length 'Km\n      Actual type: Length 'Meter\n    In the second argument of `($)', namely `getMeter 1'\n    In the expression: isKm $ getMeter 1\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 221, "user_id": 4005988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84134c950b0b002689b67c899f051deb?s=128&d=identicon&r=PG", "display_name": "HEGX64", "link": "https://stackoverflow.com/users/4005988/hegx64"}, "is_accepted": false, "score": 6, "last_activity_date": 1451739002, "creation_date": 1451739002, "answer_id": 34566065, "question_id": 34565655, "link": "https://stackoverflow.com/questions/34565655/how-to-use-data-kinds-phantom-types-to-encode-units-in-haskell/34566065#34566065", "title": "How to use Data Kinds + Phantom types to encode units in Haskell?", "body": "<p>The <code>type</code> keyword only creates an alias. For example <code>type Foo = Bar</code> just means that the compiler knows that you mean <code>Bar</code> whenever you say <code>Foo</code>. In this case this means that <code>Length Km</code> is equivalent to <code>Double</code>. The same is true for <code>Length Meter</code>. The compiler treats them both as <code>Double</code> and thus there is no difference between them.</p>\n\n<p>The <code>Data</code> keyword however creates a new type rather than pointing to another one. by replacing <code>type Length (unit::LengthUnit)= Double</code> with <code>data Length (unit::LengthUnit)= Len Double</code> we create a new type which holds the <code>Double</code> within itself (constructed with <code>Len</code>).</p>\n\n<p>The following code fails as desired:</p>\n\n<pre><code>{-# LANGUAGE GADTs,StandaloneDeriving,DataKinds,ConstraintKinds,KindSignatures #-}\n\nmain=putStrLn \"hw\"\n\ndata Length (unit::LengthUnit)= LenD Double\n--type Length (unit::LengthUnit)= Double\ndata LengthUnit= Km | Meter\n\ndivideByTwo ::Length lu-&gt;Length lu\ndivideByTwo (LenD l) =LenD (l/2)\n\ngetKm ::Double-&gt;Length Km\ngetKm d =LenD d\n\ngetMeter ::Double-&gt;Length Meter\ngetMeter d =LenD d\n\nisKm :: Length Km -&gt;Bool\nisKm _ = True\n\nthis_should_not_compile_but_it_does=isKm $ divideByTwo $ getMeter 1\n\nthis_is_even_stranger_that_it_does_compile = isKm $ getMeter 1\n</code></pre>\n\n<p>The following error was given from <code>ghc code.hs</code>:</p>\n\n<pre><code>[1 of 1] Compiling Main             ( code.hs, code.o )\n\ncode.hs:20:44:\n    Couldn't match type 'Meter with 'Km\n    Expected type: Length 'Km\n      Actual type: Length 'Meter\n    In the second argument of `($)', namely `divideByTwo $ getMeter 1'\n    In the expression: isKm $ divideByTwo $ getMeter 1\n    In an equation for `this_should_not_compile_but_it_does':\n        this_should_not_compile_but_it_does\n          = isKm $ divideByTwo $ getMeter 1\n\ncode.hs:22:53:\n    Couldn't match type 'Meter with 'Km\n    Expected type: Length 'Km\n      Actual type: Length 'Meter\n    In the return type of a call of `getMeter'\n    In the second argument of `($)', namely `getMeter 1'\n    In the expression: isKm $ getMeter 1\n</code></pre>\n\n<p>The error points out that we are getting <code>Km</code> and <code>Meter</code> mixed up.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 0, "accepted_answer_id": 34566058, "answer_count": 2, "score": 3, "last_activity_date": 1451739002, "creation_date": 1451736069, "question_id": 34565655, "link": "https://stackoverflow.com/questions/34565655/how-to-use-data-kinds-phantom-types-to-encode-units-in-haskell", "title": "How to use Data Kinds + Phantom types to encode units in Haskell?", "body": "<p>The code below <strong>does not work</strong> because it <strong>does</strong> compile. It should not (intuitively).</p>\n\n<p>1) Why does this code compile ?</p>\n\n<p>2) How can I \"fix\" this program so that \"bad\" programs like <code>isKm $ getMeter 1</code> is rejected during compile time ?</p>\n\n<pre><code>{-# LANGUAGE GADTs,StandaloneDeriving,DataKinds,ConstraintKinds,KindSignatures #-}\n\nmain=putStrLn \"hw\"\n\ntype Length (unit::LengthUnit)= Double\ndata LengthUnit= Km | Meter\n\ndivideByTwo ::Length lu-&gt;Length lu\ndivideByTwo l =l/2\n\ngetKm ::Double-&gt;Length Km\ngetKm d = d\n\ngetMeter ::Double-&gt;Length Meter\ngetMeter d =d\n\nisKm :: Length Km -&gt;Bool\nisKm _ = True\n\nthis_should_not_compile_but_it_does=isKm $ divideByTwo $ getMeter 1\n\nthis_is_even_stranger_that_it_does_compile = isKm $ getMeter 1\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2442, "user_id": 3666302, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e9aed854fcd666aba1316ef908ad5913?s=128&d=identicon&r=PG&f=1", "display_name": "TomTom", "link": "https://stackoverflow.com/users/3666302/tomtom"}, "edited": false, "score": 1, "creation_date": 1451739622, "post_id": 34565821, "comment_id": 56875942, "body": "I assume that Haskell remembers the prime numbers already calculated with <code>primes</code> so you can just take up to the square root without recalculation?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 2442, "user_id": 3666302, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e9aed854fcd666aba1316ef908ad5913?s=128&d=identicon&r=PG&f=1", "display_name": "TomTom", "link": "https://stackoverflow.com/users/3666302/tomtom"}, "edited": false, "score": 1, "creation_date": 1451749857, "post_id": 34565821, "comment_id": 56879249, "body": "@TomTom yes, exactly."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 6, "last_activity_date": 1451737321, "creation_date": 1451737321, "answer_id": 34565821, "question_id": 34565651, "link": "https://stackoverflow.com/questions/34565651/intermediate-results-in-a-recursive-function/34565821#34565821", "title": "Intermediate results in a recursive function", "body": "<p>Here's one possible way:</p>\n\n<pre><code>primes = 2 : go [3..]\n    where\n        go (t:ts)\n            | all (\\x -&gt; t `rem` x /= 0) (takeWhile (\\x-&gt;x*x&lt;=t) primes)  = t:(go ts)\n            | otherwise = go ts\n</code></pre>\n\n<p>Here we use the already-calculated part of <code>primes</code> up to the square root of <code>t</code>. Note that we need not to specify the upper bound in <code>primes</code>, it will simply produce an infinite list that you can later chop:</p>\n\n<pre><code>print $ take 1000 primes\n</code></pre>\n\n<p>Note also that we need to bootstrap <code>primes</code> such that the very first prime is not calculated from previous primes, so that <code>takeWhile</code> could work.</p>\n"}, {"comments": [{"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1451737932, "post_id": 34565824, "comment_id": 56875486, "body": "One of my attempts was virtually the same but I kept getting <code>Occurs check: cannot construct the infinite type: a1 ~ [a1]</code> error. The only difference was that you had <code>()</code> around <code>t:ps</code>. I put <code>()</code> in and it worked! Thank you very much!"}], "tags": [], "owner": {"reputation": 2442, "user_id": 3666302, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e9aed854fcd666aba1316ef908ad5913?s=128&d=identicon&r=PG&f=1", "display_name": "TomTom", "link": "https://stackoverflow.com/users/3666302/tomtom"}, "is_accepted": true, "score": 3, "last_activity_date": 1451814990, "last_edit_date": 1451814990, "creation_date": 1451737340, "answer_id": 34565824, "question_id": 34565651, "link": "https://stackoverflow.com/questions/34565651/intermediate-results-in-a-recursive-function/34565824#34565824", "title": "Intermediate results in a recursive function", "body": "<p>You could do that with tail recursion. Where you carry the already calculated primes <code>ps</code> along.</p>\n\n<pre><code>primes = go [2..100] []\n    where go (t:ts) ps\n            | all (\\x -&gt; (t `rem` x) /= 0) ps = go ts (t:ps)\n            | otherwise = go ts ps\n          go [] ps = ps\n</code></pre>\n\n<p>Note that primes are now reversed. It is faster to concatenate them than appending it. </p>\n\n<p>You can also limit the number of divisions:</p>\n\n<pre><code>| all (\\x -&gt; (t `rem` x) /= 0) (takeWhile (\\x -&gt; x*x &lt;= t) ps) = go ts (t:ps)\n</code></pre>\n\n<p>Also use <code>Int</code> if speed matters because it is unboxed.</p>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 1, "accepted_answer_id": 34565824, "answer_count": 2, "score": 2, "last_activity_date": 1451814990, "creation_date": 1451736036, "question_id": 34565651, "link": "https://stackoverflow.com/questions/34565651/intermediate-results-in-a-recursive-function", "title": "Intermediate results in a recursive function", "body": "<p>I'm trying to write a function which will find all prime numbers from 2 to 100. I can do so by testing if a number is prime by looking at remainder when the number <code>n</code> is divided by all numbers in <code>2..n-1</code>.</p>\n\n<p>I would however like only to test against prime numbers I have already found. This is how far I got writing my recursive function, but I don't know how to replace <code>[2..t-1]</code> with the prime numbers I have already worked out (the intermediate result of my recursive function I guess). How can I do that?</p>\n\n<pre><code>primes = go [2..100]\n    where\n        go l@(t:ts)\n            | all (\\x -&gt; t `rem` x /= 0) [2..t-1] = t:(go ts)\n            | otherwise = go ts\n        go [] = []\n\nmain = print primes\n</code></pre>\n"}, {"tags": ["haskell", "category-theory", "free-monad"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 3, "creation_date": 1451740558, "post_id": 34565277, "comment_id": 56876190, "body": "Just so that innocent bystanders learn more: If possible with two or three sentence, can you elaborate why the powerset functor does not admit to a monad (and what <a href=\"http://math.stackexchange.com/questions/927832/adjoint-functors-for-the-power-set-monad\">this</a> is then about)?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 2, "creation_date": 1451749749, "post_id": 34565277, "comment_id": 56879213, "body": "@JoachimBreitner The powerset functor is itself a monad (with pure = singleton and join = union), but it does not admit a <i>free</i> monad <i>over</i> it. Why it doesn&#39;t is a bit involved question. A free monad is equivalent to the initial algebra for the endofunctor, and Powerset does not have an initial algebra (this follows from the Cantor&#39;s theorem: powerset(S) /= S). Note I don&#39;t quite understand these notions myself; I guess if I did I wouldn&#39;t be asking this question."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1451759480, "post_id": 34565277, "comment_id": 56882846, "body": "Thanks, that bit of extra context is already helpful."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451784099, "post_id": 34565277, "comment_id": 56889814, "body": "There&#39;s a <a href=\"http://www.paolocapriotti.com/blog/2013/12/04/free-monads-part-2/\" rel=\"nofollow noreferrer\">detailed discussion of these matters</a> on Paolo Capriotti&#39;s blog. Most of it goes way over my head."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451880200, "post_id": 34565277, "comment_id": 56914345, "body": "Categories in Haskell only form small categories (or is it locally small?). <a href=\"http://math.stackexchange.com/questions/211560/do-free-monads-on-seti-functor-category-always-exist\">This</a> answer seems to make the argument that the free monad over a endofunctor exists iff it is &quot;locally presentable&quot; (which requries a small cat.) Furthermore, <a href=\"https://ncatlab.org/nlab/show/free+monad\" rel=\"nofollow noreferrer\">this</a> seems to claim that the free monad as constructed in the OP is <i>only</i>  &quot;algebriacally free&quot; but the algebriacally free monad exists only for endofunctors over small classes (which is every class in Haskell)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451880263, "post_id": 34565277, "comment_id": 56914355, "body": "Disclaimer: I am by no means an expert an may have misinterpreted all of the sources I&#39;ve cited."}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1451760094, "post_id": 34569145, "comment_id": 56883101, "body": "That would be my conjecture too, but what are these troublesome functors? Can we characterise them?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 5, "creation_date": 1451760172, "post_id": 34569145, "comment_id": 56883123, "body": "The covariant power set functor cannot be expressed in Haskell, but the equally troublesome &quot;double power set functor&quot; <code>(a -&gt; Bool) -&gt; Bool</code> can be. So, this is not relevant."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1451762860, "post_id": 34569145, "comment_id": 56883983, "body": "@ReidBarton, good point. Power sets of infinite types are rather smaller in Hask than in Set. Perhaps that&#39;s the real difference."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1451764264, "post_id": 34569145, "comment_id": 56884508, "body": "@ReidBarton How do you write a Functor instance for it?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1451767431, "post_id": 34569145, "comment_id": 56885562, "body": "@n.m., I think <code>fmap f (DP g) = DP (contramap (contramap f) g)</code>, or <code>fmap f (DP g) = DP (g . (. f))</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1451768003, "post_id": 34569145, "comment_id": 56885745, "body": "@n.m., sorry, the first expression was wrong; it should&#39;ve been <code>fmap f (DP g) = DP (lmap (lmap f) g)</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1451768321, "post_id": 34569145, "comment_id": 56885837, "body": "@dfeuer hmm, lmap of what?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1451769120, "post_id": 34569145, "comment_id": 56886050, "body": "@n.m., <code>newtype DP a = DP ((a -&gt; Bool) -&gt; Bool)</code>, so <code>lmap</code> for <code>-&gt;</code>. More generally, you could do <code>newtype D p q b c a = D (p (q a b) c)</code> and <code>instance (Profunctor p, Profunctor q) =&gt; Functor (D p q b c) where fmap f (D x) = D (lmap (lmap f) x)</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1451769292, "post_id": 34569145, "comment_id": 56886107, "body": "This is just like doubled contravariant functors, but with different kinds."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1451798777, "post_id": 34569145, "comment_id": 56892129, "body": "Just remember that <code>(-&gt;)</code> means <i>computable</i> function in Haskell, so <code>a -&gt; Bool</code> isn&#39;t the powerset of <code>a</code>, but the computable powerset of <code>a</code>, which is smaller.  This allows us to form set-theoretically impossible types such as <code>newtype S = S (S -&gt; Bool)</code>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1451803415, "post_id": 34569145, "comment_id": 56892828, "body": "@luqui I am a simple man. I do not possess an engineering degree, nor am I mechanically inclined. Sorry to have taken up so much of your time, but how can we use this wonderful type? It looks like S is its own computable powerset, but how do we proceed from here?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1451814124, "post_id": 34569145, "comment_id": 56894947, "body": "@n.m. Two easy elements: <code>empty = S (const False)</code> and <code>full = S (const True)</code>.  A more sophisticated one <code>containingEmpty = S (\\(S f) -&gt; f empty)</code>. Etc.  As far as how you use it to answer your question, I am not sure, I just felt it to be related."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1452125310, "last_edit_date": 1452125310, "creation_date": 1451758710, "answer_id": 34569145, "question_id": 34565277, "link": "https://stackoverflow.com/questions/34565277/does-the-free-monad-always-exist/34569145#34569145", "title": "Does the free monad always exist?", "body": "<p>It's become clear that this answer is <em>wrong</em>. I'm leaving it here to preserve valuable discussion in the comments until someone formulates a <em>correct</em> answer.</p>\n\n<hr>\n\n<p>Consider the power set in <code>Set</code>. If we have a function <code>f : S -&gt; T</code>, we can form <code>f' : PS S -&gt; PS T</code> by <code>f' X = f [X]</code>. Nice covariant functor (I think). We could also form <code>f'' X = f^(-1) [X]</code>, a nice contravariant functor (I think).</p>\n\n<p>Let's look at the \"power set\" in Haskell:</p>\n\n<pre><code>newtype PS t = PS (t -&gt; Bool)\n</code></pre>\n\n<p>This is <em>not</em> a <code>Functor</code>, but only a <code>Contravariant</code>:</p>\n\n<pre><code>instance Contravariant PS where\n  contramap f (PS g) = PS (g . f)\n</code></pre>\n\n<p>We recognize this because <code>t</code> is in negative position. Unlike <code>Set</code>, we cannot get at the \"elements\" of the characteristic functions that make up the power set, so the covariant functor isn't available.</p>\n\n<p>I would conjecture, therefore, that the reason Haskell admits a free monad for every covariant functor is that it excludes those covariant functors that cause trouble for <code>Set</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1451844152, "post_id": 34579601, "comment_id": 56904387, "body": "I think we do assume finite number of applications. The fixpoint need not be unique, as we always take the least fixpoint, because inductive. Whether it always exists in Haskell (look at the title ;) is the gist of the question."}, {"owner": {"reputation": 1338, "user_id": 770110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dae11b30544529b3c0836855a14cd653?s=128&d=identicon&r=PG", "display_name": "Vlad Patryshev", "link": "https://stackoverflow.com/users/770110/vlad-patryshev"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1467245036, "post_id": 34579601, "comment_id": 63657480, "body": "I&#39;m afraid using &quot;we&quot; invalidates all the arguments. The (not exactly proven) fact that in some categories it does exist (e.g. in Hask, which, I wonder, is it even defined properly?) does not prove the statement."}], "tags": [], "owner": {"reputation": 1338, "user_id": 770110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dae11b30544529b3c0836855a14cd653?s=128&d=identicon&r=PG", "display_name": "Vlad Patryshev", "link": "https://stackoverflow.com/users/770110/vlad-patryshev"}, "is_accepted": false, "score": 1, "last_activity_date": 1451843255, "creation_date": 1451843255, "answer_id": 34579601, "question_id": 34565277, "link": "https://stackoverflow.com/questions/34565277/does-the-free-monad-always-exist/34579601#34579601", "title": "Does the free monad always exist?", "body": "<p>I (rather) have a suspicion that this is not exactly a definition.\nSay, this recursive formula specifies <em>a</em> fixpoint; now, how do we know this fixpoint exists? How do we know there's only one fixpoint? And more, how does <code>Free m &gt;&gt;=</code> define anything, except maybe in the case where we <em>assume</em> that we only have finite sequences of applications of <code>Free</code>?</p>\n"}], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 576, "favorite_count": 11, "answer_count": 2, "score": 38, "last_activity_date": 1452125310, "creation_date": 1451733563, "last_edit_date": 1451832798, "question_id": 34565277, "link": "https://stackoverflow.com/questions/34565277/does-the-free-monad-always-exist", "title": "Does the free monad always exist?", "body": "<p>We know from the category theory that not all endofunctors in <strong>Set</strong> admit a free monad. The canonical counterexample is the powerset functor. </p>\n\n<p>But Haskell can turn any functor into a free monad.</p>\n\n<pre><code>data Free f a = Pure a | Free (f (Free f a))\ninstance Functor f =&gt; Monad (Free f) where\n  return = Pure\n  Pure a &gt;&gt;= f = f a\n  Free m &gt;&gt;= f = Free ((&gt;&gt;= f) &lt;$&gt; m)\n</code></pre>\n\n<p>What makes this construction work for any Haskell functor but break down in <strong>Set</strong>?</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "edited": false, "score": 0, "creation_date": 1451730667, "post_id": 34564386, "comment_id": 56873262, "body": "This looks like it was generated with some tool, like <a href=\"https://hackage.haskell.org/package/pointfree\" rel=\"nofollow noreferrer\">pointfree</a>....  <code>(+1) . (flip const)</code> basically means add one for every application of this function, regardless of the first parameter (that&#39;s what the flip const is there for). It&#39;s like <code>(\\a b -&gt; (b+1))</code>"}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 7, "last_activity_date": 1451731193, "last_edit_date": 1451731193, "creation_date": 1451730870, "answer_id": 34564908, "question_id": 34564386, "link": "https://stackoverflow.com/questions/34564386/haskell-function-for-list-length/34564908#34564908", "title": "Haskell function for list length", "body": "<p>First of all, let's focus why <code>foldr ((+1) . (flip const)) 0</code> is wrong. You want to increment the second argument only and forget the first one. Semantically, that's</p>\n\n<pre><code>\\_ a -&gt; a + 1\n</code></pre>\n\n<p>However, you wrote the following:</p>\n\n<pre><code>(+1) . flip const\n= (+1) . (\\_ a -&gt; a)\n= \\x -&gt; (+1) . (\\_ a -&gt; a) $ x\n= \\x -&gt; (+1) $ (\\_ a -&gt; a) $ x\n= \\x -&gt; (+1) $ \\a -&gt; a\n= \\_ -&gt; (+1) (\\a -&gt; a)\n= const ( (+1) (\\a -&gt; a))\n</code></pre>\n\n<p>Which is why you suddenly need <code>Num (c -&gt; c)</code>, since you're trying to apply <code>(+1)</code> on <code>id</code>. </p>\n\n<p>But you actually meant:</p>\n\n<pre><code>\\_ a -&gt; a + 1\n= \\_ a -&gt; (+1) a\n= \\_   -&gt; (+1)\n= const (+1)\n</code></pre>\n\n<p>After all, you want to forget the first argument and use a function <code>f</code> on the second. All you have to to is to use <code>const f</code>.</p>\n\n<p>The composition <code>((+1).).(flip const)</code> is overly verbose and probably generated by <a href=\"https://wiki.haskell.org/Pointfree#Tool_support\">pointfree</a>:</p>\n\n<pre><code>((+1).).(flip const)\n= ((\\x -&gt; x + 1).) . (\\a _ -&gt; a)\n= \\c -&gt; ((\\x -&gt; x + 1).) . (\\a _ -&gt; a) $ c\n= \\c -&gt; ((\\x -&gt; x + 1).) $ \\_ -&gt; c\n= \\c -&gt; \\f -&gt; (\\x -&gt; x + 1) . f $ \\_ -&gt; c\n= \\c -&gt;   (\\x -&gt; x + 1) . \\_ -&gt; c\n= \\_ c -&gt; (\\x -&gt; x + 1) $ c\n= \\_ c -&gt; c + 1\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1451772121, "post_id": 34568632, "comment_id": 56886873, "body": "<code>foldl&#39; (flip ((+).const 1)) 0</code> works, too. <code>flip</code> goes to <code>foldl&#39;</code>s reversed order of arguments to the combining function, and <code>((+).f)</code> is fold+map fusion; so it is semi-readable. --- another one is  <code>foldl&#39; ((. const 1).(+)) 0</code>. :)"}, {"owner": {"reputation": 1713, "user_id": 2058121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fc3f5c71b3c9d6425618046e15d8646?s=128&d=identicon&r=PG", "display_name": "Alvin", "link": "https://stackoverflow.com/users/2058121/alvin"}, "edited": false, "score": 0, "creation_date": 1497313046, "post_id": 34568632, "comment_id": 76014018, "body": "I really like you answer! <code>foldl&#39; (const . (1+)) 0</code> is definitely the best. Here is another version which increments the argument inside const: <code>foldl (on const (+1)) 0</code>"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1451756386, "last_edit_date": 1451756386, "creation_date": 1451755721, "answer_id": 34568632, "question_id": 34564386, "link": "https://stackoverflow.com/questions/34564386/haskell-function-for-list-length/34568632#34568632", "title": "Haskell function for list length", "body": "<p>This is really a comment, but much too long for one.</p>\n\n<p>Unless you're dealing with weird numbers like lazy <code>Nat</code>s, you really want</p>\n\n<pre><code>length xs = foldl' (\\acc _ -&gt; 1 + acc) 0 xs\n</code></pre>\n\n<p>Making this pointless,</p>\n\n<pre><code>length = foldl' (\\acc -&gt; const ((1+) acc)) 0\nlength = foldl' (const . (1+)) 0\n</code></pre>\n\n<p>If you like, you can transform the original <code>foldl'</code> expression into a <code>foldr</code> form like so:</p>\n\n<pre><code>length xs = foldr go id xs 0 where\n  go _ r acc = r $! 1 + acc\n</code></pre>\n\n<p>Chewing on <code>go</code>,</p>\n\n<pre><code>go _ r acc = ($!) r $ (+) 1 acc\ngo _ r = ($!) r . (+1)\ngo _ r = (. (+1)) (($!) r)\ngo _ = (. (+1)) . ($!)\ngo = const ((. (+1)) . ($!))\n</code></pre>\n\n<p>Chewing on <code>length</code>,</p>\n\n<pre><code>length = flip (foldr go id) 0\n</code></pre>\n\n<p>Putting it all together,</p>\n\n<pre><code>length = flip (foldr (const ((. (+1)) . ($!))) id) 0\n</code></pre>\n\n<p>I, for one, find this point-free form utterly opaque.</p>\n"}], "owner": {"reputation": 343, "user_id": 5737686, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh3.googleusercontent.com/-NxMDXN7k3Ks/AAAAAAAAAAI/AAAAAAAAAZA/GwCslJbriao/photo.jpg?sz=128", "display_name": "sa___", "link": "https://stackoverflow.com/users/5737686/sa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1058, "favorite_count": 2, "accepted_answer_id": 34564908, "answer_count": 2, "score": 8, "last_activity_date": 1451756386, "creation_date": 1451726738, "last_edit_date": 1495541047, "question_id": 34564386, "link": "https://stackoverflow.com/questions/34564386/haskell-function-for-list-length", "title": "Haskell function for list length", "body": "<p>To calculate length of a list, using a foldr, one would do something like:</p>\n\n<pre><code>foldr (\\_ acc -&gt; acc + 1) 0\n</code></pre>\n\n<p>Expanding further on the idea that the folding function needs to increment the second argument, i came up with this (and it's wrong):</p>\n\n<pre><code>foldr ((+1) . (flip const)) 0`\n</code></pre>\n\n<p>Further inspection of the type reveals this:</p>\n\n<pre><code>(+1) . (flip const) :: Num (c -&gt; c) =&gt; a -&gt; c -&gt; c\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/questions/9297320/haskell-higher-order-function-to-calculate-length\">Haskell higher order function to calculate length</a>\nThere's an interesting comment on that page, which i can't understand really</p>\n\n<pre><code>foldr (((+1).).(flip const)) 0\n</code></pre>\n\n<p>Can someone explain how does that composition actually work ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1451688198, "post_id": 34560471, "comment_id": 56865127, "body": "It&#39;s not clear to me what the &quot;obvious&quot; problem is. Your code doesn&#39;t make sense (<code>pure_instances</code> isn&#39;t fully applied in <code>build_tree</code>), so it&#39;s hard to figure out what the problem is, or what you are asking."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1451693677, "post_id": 34560471, "comment_id": 56866379, "body": "Do you know about guards?"}, {"owner": {"reputation": 1412, "user_id": 1857674, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/00756e69256f719e2b9c4965a730a89e?s=128&d=identicon&r=PG", "display_name": "Yamen Ajjour", "link": "https://stackoverflow.com/users/1857674/yamen-ajjour"}, "edited": false, "score": 0, "creation_date": 1451861579, "post_id": 34560471, "comment_id": 56910347, "body": "@ReidBatron Thank you for your clue , it inspired me !"}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 1, "last_activity_date": 1451705361, "creation_date": 1451705361, "answer_id": 34562313, "question_id": 34560471, "link": "https://stackoverflow.com/questions/34560471/predicate-application-on-an-argument-for-haskell-pattern-matching/34562313#34562313", "title": "Predicate application on an argument for Haskell pattern matching", "body": "<p>I think you are looking for guards? (thanks Reid Barton)</p>\n\n<pre><code>build_tree list\n    | pure_instances list = Leaf get_label list\n    | otherwise           = build_tree list\n</code></pre>\n\n<p>The infinite loop when <code>pure_instances</code> returns <code>False</code> is another matter...</p>\n"}], "owner": {"reputation": 1412, "user_id": 1857674, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/00756e69256f719e2b9c4965a730a89e?s=128&d=identicon&r=PG", "display_name": "Yamen Ajjour", "link": "https://stackoverflow.com/users/1857674/yamen-ajjour"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 439, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1484259569, "creation_date": 1451685644, "last_edit_date": 1484259569, "question_id": 34560471, "link": "https://stackoverflow.com/questions/34560471/predicate-application-on-an-argument-for-haskell-pattern-matching", "title": "Predicate application on an argument for Haskell pattern matching", "body": "<p>I am developing a function in Haskell whose argument is a list of pairs. Recursively, this list will be split further until a base case is satisfied based on a predefined predicate.  Usually, for simpler data types e.g. lists , literals could be used for base case matching, such as '[ ]'. How can I apply pattern matching using a boolean predicate?  </p>\n\n<p>The only way I came up with is using if else statement. But apparently this would lead to obvious problem.</p>\n\n<p>The pattern</p>\n\n<pre><code>pure_instances [(_,_)] = True\npure_instances ((c1,_):(c2,attrs):xs) = (c1 == c2) &amp;&amp; (pure_instances ((c2,attrs):xs))\n</code></pre>\n\n<p>The method</p>\n\n<pre><code>build_tree list  = if (pure_instances list) then (Leaf get_label list) else (build_tree list) \nbuild_ tree list = ...\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 12, "creation_date": 1451671827, "post_id": 34558636, "comment_id": 56860667, "body": "That seems like a XY problem. You wouldn&#39;t do something like this in Haskell. What&#39;s your <i>actual</i> problem you&#39;re trying to solve?"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 2, "creation_date": 1451672133, "post_id": 34558636, "comment_id": 56860763, "body": "You can&#39;t write a function that takes either a <code>String -&gt; IO()</code> or a <code>String -&gt; String -&gt; IO() </code> as parameter. You&#39;d need <code>Either (String -&gt; IO()) (String -&gt; String -&gt; IO())</code>. (But over-reliance of <code>IO ()</code> is a strong sign that you&#39;re trying to write a program in a different language.)"}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1451674782, "post_id": 34558636, "comment_id": 56861609, "body": "<code>hPutStrLn</code> takes a <code>Handle</code> as its first argument, not a <code>String</code>.  Assuming you meant to use <code>putStrLn</code>, the type of the expression in the <code>else</code> is <code>IO ()</code>, and the type of the expression in the <code>then</code> must have the same type.  Therefore, if you change <code>hPutStrLn</code> to <code>putStrLn</code>, the <code>(???)</code> must have type <code>IO ()</code>, so neither <code>functionB</code> nor <code>functionC</code> can be passed."}, {"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1451675198, "post_id": 34558636, "comment_id": 56861693, "body": "@molbdnilo, that&#39;s not strictly true.  <code>f :: (String -&gt; a) -&gt; IO ()</code> would accept either <code>String -&gt; IO ()</code> or <code>String -&gt; String -&gt; IO ()</code> (as well as any other function whose first argument was of type <code>String</code>).  Now, whether you could make a useful function with that type is another matter!"}], "answers": [{"tags": [], "owner": {"reputation": 1120, "user_id": 4017850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6a76c9f963ab1a978a267c5b2e14cca?s=128&d=identicon&r=PG", "display_name": "beigel", "link": "https://stackoverflow.com/users/4017850/beigel"}, "is_accepted": false, "score": 0, "last_activity_date": 1451680373, "creation_date": 1451680373, "answer_id": 34559793, "question_id": 34558636, "link": "https://stackoverflow.com/questions/34558636/function-that-can-work-with-function-with-different-type-signatures/34559793#34559793", "title": "function that can work with function with different type signatures", "body": "<p>The given code wouldn't perform as expected. As mentioned above, <code>hPutStrln</code> requires a file handle, did you intend <code>putStrLn</code>? If so, the signature of <code>putStrLn</code> is <code>String -&gt; IO ()</code> and so <code>putStrLn \"error\"</code> is just <code>IO ()</code>. Since the line <code>else f</code> provides no argument for f, the type signature of f must be <code>IO ()</code> - the type signature would be <code>functionA :: String -&gt; String -&gt; IO () -&gt; IO ()</code> (actually, it could be <code>functionA :: Eq t =&gt; t -&gt; t -&gt; IO () -&gt; IO ()</code> since the there is nothing requiring a string yet). </p>\n\n<p>The problem is if you can't make it so that f can take in one or two inputs, it only only be or the other. You could replace <code>else f</code> with <code>else f parm1</code> and then f would be of type <code>String -&gt; IO ()</code> or with <code>else parm1 parm2</code> and then f would be of type <code>String -&gt; String -&gt; IO ()</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1451707139, "last_edit_date": 1451707139, "creation_date": 1451706419, "answer_id": 34562400, "question_id": 34558636, "link": "https://stackoverflow.com/questions/34558636/function-that-can-work-with-function-with-different-type-signatures/34562400#34562400", "title": "function that can work with function with different type signatures", "body": "<p>It is possible for a function to have \"two different signatures\" based on an argument.  The function will really only have one most general signature, but you can fake it so it works like that.</p>\n\n<pre><code>functionA :: String -&gt; String -&gt; a -&gt; a\nfunctionA parm1 parm2 f = if parm1 == parm2 \n                          then f\n                          else putStrLn \"error\" -- uh oh\n</code></pre>\n\n<p>The signature says that this will return the same kind of thing as its third argument. So:</p>\n\n<pre><code>functionA \"foo\" \"bar\" functionB :: String -&gt; IO ()\nfunctionA \"foo\" \"bar\" functionC :: String -&gt; String -&gt; IO ()\n</code></pre>\n\n<p>In other words, the first line takes one additional argument (four total), and the second line takes two (five total).</p>\n\n<p>The trouble is that it doesn't work, because <code>putStrLn \"error\"</code> doesn't have either of those types, and we need it to have \"both\".</p>\n\n<p>One way through this is to make a typeclass which characterizes the operations you need on both of those types.  In this case, maybe printing an error is the thing you want?</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\nclass CanPrintError a where\n    printError :: String -&gt; a\n\ninstance CanPrintError (IO ()) where\n    -- specialized to:\n    -- printError :: String -&gt; IO ()\n    printError = putStrLn\n\ninstance (CanPrintError b) =&gt; CanPrintError (a -&gt; b) where\n    -- specialized to:\n    -- printError :: (CanPrintError b) =&gt; String -&gt; a -&gt; b\n    printError err _ = printError err\n</code></pre>\n\n<p>Notice that I have made the second instance recursive, so <code>CanPrintError</code> doesn't only have instances for <code>String -&gt; IO ()</code> and <code>String -&gt; String -&gt; IO ()</code>, it has instances for all multiple-arg functions ending in <code>IO ()</code> such as</p>\n\n<pre><code>String -&gt; Int -&gt; (Int -&gt; Maybe Bool) -&gt; IO ()\n</code></pre>\n\n<p>It is possible to just make it for the two specific types in question, though it makes me question your motivations.</p>\n\n<p>Now we just add the necessary constraint to <code>functionA</code>'s signature:</p>\n\n<pre><code>functionA :: (CanPrintError a) =&gt; String -&gt; String -&gt; a -&gt; a\nfunctionA parm1 parm2 f = if parm1 == parm2\n                          then f\n                          else printError \"error\"\n</code></pre>\n\n<p>You can imagine substituting for <code>printError</code> whatever operation you need to do.  This is pretty much what typeclasses are for. :-)</p>\n\n<p>However, I do suggest posting a question with more specific details of your problem, since it smells like something that might have a cleaner solution.</p>\n"}, {"tags": [], "owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "is_accepted": false, "score": 3, "last_activity_date": 1451775441, "creation_date": 1451775441, "answer_id": 34571587, "question_id": 34558636, "link": "https://stackoverflow.com/questions/34558636/function-that-can-work-with-function-with-different-type-signatures/34571587#34571587", "title": "function that can work with function with different type signatures", "body": "<p>The function <code>const</code> creates a new function that always returns the first parameter regardless of what you pass to it. It's type signature is:</p>\n\n<pre><code>const :: a -&gt; b -&gt; a\n</code></pre>\n\n<p>This means we can create things like:</p>\n\n<pre><code>&gt; const 4 \"String\"\n4\n\n&gt; let fn = const (\\x -&gt; print x)\n&gt; :t fn\nfn :: Show a =&gt; b -&gt; a -&gt; IO ()\n&gt; fn [1, 2, 3, 4, 5] (Just 3)\nJust 3\n</code></pre>\n\n<p>In your example, you can use this function to pass a \"<code>const</code>'d\" version of <code>functionB</code> to <code>functionA</code>:</p>\n\n<pre><code>functionB x = putStrLn x\nfunctionC x y = putStrLn x &gt;&gt; putStrLn y \n\nfunctionA :: String -&gt; String -&gt; (String -&gt; String -&gt; IO()) -&gt; IO()\nfunctionA parm1 parm2 f = if parm1 == parm2\n                          then f parm1 parm2\n                          else putStrLn \"error\"\n\n&gt; functionA \"Foo\" \"Foo\" (const functionB)\nFoo\n&gt; functionA \"Foo\" \"Foo\" functionC\nFoo\nFoo\n&gt; functionA \"Foo\" \"Bar\" undefined\nerror\n</code></pre>\n"}], "owner": {"reputation": 367, "user_id": 4716940, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/363a400a9b096b10c2ba8070f7b12f35?s=128&d=identicon&r=PG&f=1", "display_name": "demathieu", "link": "https://stackoverflow.com/users/4716940/demathieu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 34562400, "answer_count": 3, "score": 1, "last_activity_date": 1451775441, "creation_date": 1451671540, "question_id": 34558636, "link": "https://stackoverflow.com/questions/34558636/function-that-can-work-with-function-with-different-type-signatures", "title": "function that can work with function with different type signatures", "body": "<p>I'm trying to write a function in haskell that takes two parameters and a function. Depending on the two parameters it will perform the given function or not. The problem is that the given functions can have a different type signatures. In pseudo code: </p>\n\n<pre><code>functionB:: String -&gt; IO()\n\n\nfunctionC:: String -&gt; String -&gt; IO() \n\nfunctionA :: String -&gt; String -&gt;(???)-&gt; IO()\nfunctionA parm1 parm2 f = if parm1 == parm2\n                          then f\n                          else hPutStrLn \"error\"\n</code></pre>\n\n<p>FunctionA should be able to work with function C or B and as you can see B and C have a different type signature. Can you do this in Haskell? If so what will be the type signature of functionA? </p>\n"}, {"tags": ["haskell", "ocaml"], "comments": [{"owner": {"reputation": 9, "user_id": 5255906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebcb66457f9c082d281f8c93b8291284?s=128&d=identicon&r=PG&f=1", "display_name": "John Malick", "link": "https://stackoverflow.com/users/5255906/john-malick"}, "reply_to_user": {"reputation": 6096, "user_id": 5333147, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/c9f89e11a6bfe4f8098bdad1b036add3?s=128&d=identicon&r=PG&f=1", "display_name": "tiny sunlight", "link": "https://stackoverflow.com/users/5333147/tiny-sunlight"}, "edited": false, "score": 0, "creation_date": 1451671944, "post_id": 34558612, "comment_id": 56860702, "body": "I&#39;ve edited question. Maybe now it&#39;s more clear."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1451672245, "post_id": 34558612, "comment_id": 56860810, "body": "@JohnMalick: I think the other question+answer provides what you&#39;re looking for."}, {"owner": {"reputation": 4074, "user_id": 4154350, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/70e00ce9458ef1e59ce5734fd6e377f6?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre G.", "link": "https://stackoverflow.com/users/4154350/pierre-g"}, "edited": false, "score": 0, "creation_date": 1451672416, "post_id": 34558612, "comment_id": 56860876, "body": "use type coercition of Ocaml (refer also to the already answered question)."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 4074, "user_id": 4154350, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/70e00ce9458ef1e59ce5734fd6e377f6?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre G.", "link": "https://stackoverflow.com/users/4154350/pierre-g"}, "edited": false, "score": 0, "creation_date": 1451673065, "post_id": 34558612, "comment_id": 56861092, "body": "@PierreG.: Did you revenge downvote this question?"}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 5255906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebcb66457f9c082d281f8c93b8291284?s=128&d=identicon&r=PG&f=1", "display_name": "John Malick", "link": "https://stackoverflow.com/users/5255906/john-malick"}, "edited": false, "score": 6, "creation_date": 1451672038, "post_id": 34558693, "comment_id": 56860733, "body": "In Haskell I also don&#39;t need to write types. Is not an answer to my question."}, {"owner": {"reputation": 1289, "user_id": 1375434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rQFKV.png?s=128&g=1", "display_name": "Str.", "link": "https://stackoverflow.com/users/1375434/str"}, "reply_to_user": {"reputation": 9, "user_id": 5255906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebcb66457f9c082d281f8c93b8291284?s=128&d=identicon&r=PG&f=1", "display_name": "John Malick", "link": "https://stackoverflow.com/users/5255906/john-malick"}, "edited": false, "score": 0, "creation_date": 1451679285, "post_id": 34558693, "comment_id": 56862767, "body": "@JohnMalick If you want to define the function type your question is a duplicate. If you just want a working polymorphic define then this is the answer."}, {"owner": {"reputation": 9, "user_id": 5255906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebcb66457f9c082d281f8c93b8291284?s=128&d=identicon&r=PG&f=1", "display_name": "John Malick", "link": "https://stackoverflow.com/users/5255906/john-malick"}, "edited": false, "score": 0, "creation_date": 1451680450, "post_id": 34558693, "comment_id": 56863050, "body": "I wanted to define own type. Because of that my question is duplicate."}], "tags": [], "owner": {"reputation": 4074, "user_id": 4154350, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/70e00ce9458ef1e59ce5734fd6e377f6?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre G.", "link": "https://stackoverflow.com/users/4154350/pierre-g"}, "is_accepted": false, "score": 0, "last_activity_date": 1451671981, "creation_date": 1451671981, "answer_id": 34558693, "question_id": 34558612, "link": "https://stackoverflow.com/questions/34558612/declarate-function-type-in-ocaml-like-in-haskell/34558693#34558693", "title": "Declarate function type in OCaml (like in Haskell)", "body": "<p>why do you want to do so ? Ocaml infers type, so you do not need to declare the type of your function (except when you want to export your function).\nIn your example :</p>\n\n<pre><code>let rec f a = match a with \n[] -&gt; 0\n| x::xs -&gt; 1 + f xs\n</code></pre>\n\n<p>Ocaml will deduce that f is expecting a list, and will result an Int.</p>\n"}], "owner": {"reputation": 9, "user_id": 5255906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebcb66457f9c082d281f8c93b8291284?s=128&d=identicon&r=PG&f=1", "display_name": "John Malick", "link": "https://stackoverflow.com/users/5255906/john-malick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 0, "closed_date": 1451671992, "answer_count": 1, "score": -4, "last_activity_date": 1451704943, "creation_date": 1451671374, "last_edit_date": 1451704943, "question_id": 34558612, "link": "https://stackoverflow.com/questions/34558612/declarate-function-type-in-ocaml-like-in-haskell", "closed_reason": "Duplicate", "title": "Declarate function type in OCaml (like in Haskell)", "body": "<p>Is it possible to function in OCaml with given type?<br>\nFor example in Haskell I can create something like that:</p>\n\n<pre><code>f :: [a] -&gt; Int\nf [] = 0\nf (x:xs) = 1 + f xs\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1451679547, "post_id": 34558417, "comment_id": 56862836, "body": "If you <i>really</i> want to make a monad with restrictions, package <a href=\"https://hackage.haskell.org/package/rmonad\" rel=\"nofollow noreferrer\">rmonad</a> could help."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1451679052, "creation_date": 1451679052, "answer_id": 34559619, "question_id": 34558417, "link": "https://stackoverflow.com/questions/34558417/haskell-type-constraint/34559619#34559619", "title": "Haskell type constraint", "body": "<p>You can't have it both ways.</p>\n\n<p>The <code>Functor</code> class, of which <code>Monad</code> is a subclass, insists on full polymorphism (<code>fmap</code> can be applied to functions with arbitrary return types). So you can't restrict things on that end. You also can't restrict them within <code>Bind</code> because <code>&gt;&gt;=</code> must accept arbitrary left operands.</p>\n\n<p>An alternative is to use different notions of functor and monad (look up \"indexed monad\"). The following code is completely untested.</p>\n\n<pre><code>{-# Language DataKinds, Gadts, KindSignatures #-}\n\n-- (type-level) free magma\ndata FM a = Leaf | Bin (FM a) a (FM a)\n\ndata Ast :: FM * -&gt; * -&gt; * where\n  Return :: a -&gt; Ast 'Leaf a\n  Bind :: Ast ts a -&gt; (a -&gt; Ast us b) -&gt; Ast ('Bin ts a us) b\n\nclass Showy (mag :: FM *) where\n  showy :: Show a =&gt; Ast mag a -&gt; String\n\ninstance Showy 'Nil where\n  showy (Return a) = \"Return \" ++ show a\n\ninstance (Showy as, Show b) =&gt; Showy ('Bin as b cs) where\n  showy (Bind m f) = \"Bind \" ++ showy m\n\ninstance (Showy as, Show b) =&gt; Show (Ast as b) where\n  show = showy\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 1881560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a6fd652c6caaeeaa46cea340fb433a0?s=128&d=identicon&r=PG", "display_name": "dlgd", "link": "https://stackoverflow.com/users/1881560/dlgd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1451679052, "creation_date": 1451669888, "question_id": 34558417, "link": "https://stackoverflow.com/questions/34558417/haskell-type-constraint", "title": "Haskell type constraint", "body": "<p>I'm struggling with the haskell type system. Basically what I'm trying to do is define a data structure (cf <em>Ast</em> data type in the code sample) that represents a monad (it could be something else). This type is parameterized by <em>a</em> and there is no constraint on it. My issue is when I want to introspect this type, I might need some constraints on the type parameter, for instance:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nimport Control.Monad\n\ndata Ast a where\n    Bind :: Ast a -&gt; (a -&gt; Ast b) -&gt; Ast b\n    Return :: a -&gt; Ast a\n\ninstance Functor Ast where\n    fmap = liftM\n\ninstance Applicative Ast where\n    pure = Return\n    (&lt;*&gt;) = ap\n\ninstance Monad Ast where\n    (&gt;&gt;=) = Bind\n\ninstance Show a =&gt; Show (Ast a) where\n    show (Bind x y) = \"bind \" ++ {- begin error -} show x {- end error -} \n    show (Return y) = \"return \" ++ show y\n</code></pre>\n\n<p>This yields the following error:</p>\n\n<pre><code>Could not deduce (Show a1) arising from a use of \u2018show\u2019\nfrom the context (Show a)\n  bound by the instance declaration at src/Main.hs:21:10-31\nPossible fix:\n  add (Show a1) to the context of the data constructor \u2018Bind\u2019\nIn the second argument of \u2018(++)\u2019, namely \u2018show x\u2019\nIn the expression: \"bind \" ++ show x\nIn an equation for \u2018show\u2019: show (Bind x y) = \"bind \" ++ show x\n</code></pre>\n\n<p>And that makes sense, the compiler doesn't know that <em>x</em> is an instance of <em>Show</em>. My question is could I express this constraint? Ideally I'd like to have the constraint only on my <em>Show</em> instance but I also tried to add the <em>Show</em> constraint in the <em>Ast</em> constructor:</p>\n\n<pre><code>data Ast a where\n    Bind :: (Show a, Show b) =&gt; Ast a -&gt; (a -&gt; Ast b) -&gt; Ast b\n    Return :: a -&gt; Ast a\n</code></pre>\n\n<p>And I get this error:</p>\n\n<pre><code>No instance for (Show a) arising from a use of \u2018Bind\u2019\nPossible fix:\n  add (Show a) to the context of\n    the type signature for (&gt;&gt;=) :: Ast a -&gt; (a -&gt; Ast b) -&gt; Ast b\nIn the expression: Bind\nIn an equation for \u2018&gt;&gt;=\u2019: (&gt;&gt;=) = Bind\nIn the instance declaration for \u2018Monad Ast\u2019\n</code></pre>\n\n<p>I understand the <em>Show</em> constraint should be added at the <em>monad</em> class type definition level.</p>\n\n<p>Any idea how to manage that?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1451670005, "post_id": 34558374, "comment_id": 56860072, "body": "<i>e</i> is usually called Euler&#39;s number. (Though it&#39;s arguable whether it really deserves a name of its own, seeing that basically its <i>only</i> use is as the base of the natural exponential function, and that is written <code>exp</code> anyway. It doesn&#39;t really make any sense to calculate <i>e</i> itself, instead of <code>exp</code> directly.) \u2014 Regarding your compilation errors: please <i>always add type signatures</i>, they tend to make such errors far less incomprehensible."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1451671500, "post_id": 34558374, "comment_id": 56860578, "body": "<code>(1 0)</code> is surely not what you want. <code>f x y</code> means <code>(f x) y</code>, not <code>f (x y)</code>."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 1, "creation_date": 1451672388, "post_id": 34558374, "comment_id": 56860861, "body": "A more common name for <code>foldr (*) 1</code> is <code>product</code>."}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1451711800, "post_id": 34558638, "comment_id": 56869325, "body": "Or, you could just pass <code>uncurry iter</code> instead of <code>iter</code> to <code>until</code>, and keep using the pairs..."}, {"owner": {"reputation": 25, "user_id": 4642017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81a64df5938ab8e21c24c3a5a4f73131?s=128&d=identicon&r=PG&f=1", "display_name": "dotnetdeveloperboi", "link": "https://stackoverflow.com/users/4642017/dotnetdeveloperboi"}, "edited": false, "score": 0, "creation_date": 1451733273, "post_id": 34558638, "comment_id": 56874102, "body": "Can you please give me an example (related to my problem, if possible), using the <code>scanl</code> function?"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1451736860, "last_edit_date": 1451736860, "creation_date": 1451671550, "answer_id": 34558638, "question_id": 34558374, "link": "https://stackoverflow.com/questions/34558374/calculating-the-e-constant-using-haskells-until-function/34558638#34558638", "title": "Calculating the &quot;e&quot; constant using Haskell&#39;s until function", "body": "<pre><code>enumber = until (&gt;2.7) iter (1 0)\n                  --        ^^^^^\n</code></pre>\n\n<p>Above you are applying \"function\" <code>1</code> to argument <code>0</code>. This can't work.</p>\n\n<p>You may want to use a pair instead <code>(1, 0)</code>. In that case, not that <code>iter</code> must be changed to accept and return a pair. Also, the predicate <code>&gt;2.7</code> must be adapted to pairs.</p>\n\n<p>If you don't want to use pairs, you need a different approach. Look up the <code>scanl</code> function, which you can use to compute partial sums. Then, you can use <code>dropWhile</code> to discard partial sums until some good-enough predicate is satisfied.</p>\n\n<hr>\n\n<p>An example: the first ten partial sums of <code>n^2</code>.</p>\n\n<pre><code>&gt; take 10 $ scanl (+) 0 [ n^2 | n&lt;-[1..] ]\n[0,1,5,14,30,55,91,140,204,285]\n</code></pre>\n\n<p>Note that this approach works only if you compute all the list elements independently. If you want to reuse some computed value from one element to another, you need something else. E.g.</p>\n\n<pre><code>&gt; take 10 $ snd $ mapAccumL (\\(s,p) x -&gt; ((s+p,p*2),s+p)) (0,1) [1..]\n[1,3,7,15,31,63,127,255,511,1023]\n</code></pre>\n\n<p>Dissected:</p>\n\n<pre><code>mapAccumL (\\(s,p) x -&gt; ((s+p,p*2),s+p)) (0,1) [1..]\n                         a   b    c      d e\n\ns previous sum\np previous power of two\nx current element of [1..]\na next sum\nb next power of two\nc element in the generated list\nd first sum\ne first power of two\n</code></pre>\n\n<p>Still, I am not a big fan of <code>mapAccumL</code>. Using <code>iterate</code> and pairs looks nicer.</p>\n"}, {"comments": [{"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 1, "creation_date": 1451677167, "post_id": 34558704, "comment_id": 56862156, "body": "scanl is also useful for efficiently generating the list of all factorials by defining <code>factorials = scanl (*) 1 [1..]</code>. With this at hand, <code>recipFacts</code> is just <code>map (1&#47;) factorials</code>."}, {"owner": {"reputation": 25, "user_id": 4642017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81a64df5938ab8e21c24c3a5a4f73131?s=128&d=identicon&r=PG&f=1", "display_name": "dotnetdeveloperboi", "link": "https://stackoverflow.com/users/4642017/dotnetdeveloperboi"}, "edited": false, "score": 0, "creation_date": 1451678898, "post_id": 34558704, "comment_id": 56862676, "body": "Thanks for your precise explanation! I liked the method with the tuples, so I used it like this:<code>type Index = Double  iter :: (Double, Index) -&gt; (Double, Index) iter (x,k) = ( x + 1&#47;(fact (k + 1)), k+1 )  enumber = fst$until ((&gt;10) . snd) iter (1,0)</code>  Here, by checking the index, I can get the desired result."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 1, "creation_date": 1451707441, "post_id": 34558704, "comment_id": 56868642, "body": "@FrerichRaabe <code>scanl (&#47;) 1 [1..]</code> is better, because it is incremental (avoids recalculations of products)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1451707694, "post_id": 34558704, "comment_id": 56868694, "body": "<code>takeWhile (&gt;1e-16)</code> stops after producing 20 numbers instead of 179 for (&gt;0) --  with the same result."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1451735296, "post_id": 34558704, "comment_id": 56874682, "body": "@WillNess: right, but I don&#39;t like hard-coding finite precision limits. I&#39;d rather use a scan summation then, and choose the first element that&#39;s equal to the one before it."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1451739768, "post_id": 34558704, "comment_id": 56875986, "body": "<i>&quot;the first that&#39;s equal to the one before it&quot;</i> that&#39;s the same as using <code>(&gt;0)</code> isn&#39;t it? The problem with it is, if we were to switch to an exact number type, like ratios, it&#39;d never stop. I don&#39;t see a way around using <i>some</i> tolerance value there."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1451740840, "post_id": 34558704, "comment_id": 56876265, "body": "@WillNess: \u201csame as using <code>(&gt;0)</code>\u201d \u2013 conceptually right of course, but no. A decreasing sequence of floating-point numbers has much more accuracy than its accumulated series can make use of. As you&#39;ve noticed yourself, those elements below 10\u207b&#185;\u2076 simply <i>won&#39;t contribute at all</i> to the sum, though they are themselves <code>&#47;=0</code>. \u2014 Switching to a type like <code>Ratio</code> doesn&#39;t make any sense, because <i>e</i> \u2209 \u211a."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1451741017, "post_id": 34558704, "comment_id": 56876308, "body": "@leftaroundabout you&#39;re of course entirely correct, thanks for the clarifications! :) --- switching to ratios may be justified if you want to have control over a precision of representation (have 10^-100, say). Speaking <i>hypothetically</i> of course, as pertaining the <i>e</i>, but there <i>are</i> converging series whose initial members grow enormously large, at first, like e.g. Fresnel integral."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1451737464, "last_edit_date": 1451737464, "creation_date": 1451672053, "answer_id": 34558704, "question_id": 34558374, "link": "https://stackoverflow.com/questions/34558374/calculating-the-e-constant-using-haskells-until-function/34558704#34558704", "title": "Calculating the &quot;e&quot; constant using Haskell&#39;s until function", "body": "<p>The concrete mistake that causes this error is the notation <code>(1 0)</code>. This doesn't make any sense in Haskell, it is parsed such that <code>1</code> is a function which is applied to <code>0</code>, and the result then used. You apparently mean to pass both 1 and 0 as (initial) arguments. That's what we have <em>tuples</em> for, written <code>(1,0)</code>.</p>\n\n<p>Now, before trying to make anything definitions, we should make clear what <em>types</em> we need and write them out. Always start with your type signatures, they guide you a lot to you the actual definitions should look!</p>\n\n<pre><code>enumber :: Double -- could also be a polymorphic number type, but let's keep it simple.\n\ntype Index = Double -- this should, perhaps, actually be an integer, but again for simlicity use only `Double`\n\nfact :: Index -&gt; Double\n</code></pre>\n\n<p>now, if you want to do something like <code>enumber = until (&gt;2.7) iter (1,0)</code>, then <code>iter</code> would need to both add up the series expansion, and increment the <code>k</code> index (<code>until</code> knows nothing about indices), i.e. something like</p>\n\n<pre><code>iter :: (Double, Index) -&gt; (Double, Index)\n</code></pre>\n\n<p>But right now your <code>iter</code> has a signature more like</p>\n\n<pre><code>iter :: Double -&gt; Index -&gt; Double\n</code></pre>\n\n<p>i.e. it does not do the index-incrementing. Also, it's curried, i.e. doesn't accept the arguments as a tuple.</p>\n\n<p>Let's try to work with a tuple signature:</p>\n\n<pre><code>iter :: (Double, Index) -&gt; (Double, Index)\niter (x,k) = ( x + 1/(fact (k + 1)), k+1 )\n</code></pre>\n\n<p>If you want to use this with <code>until</code>, you have the problem that you're always working with tuples, not just with the accumulated results. You need to throw away the index, both in the termination condition and in the final result: this can easily be done with the <code>fst</code> function</p>\n\n<pre><code>enumber = fst $ until ((&gt;2.7) . fst) iter (1,0)\n</code></pre>\n\n<p>Now, while this version of the code will type-check, it's neither elegant nor efficient nor accurate (being greater than 2.7 is hardly a meaningful condition here...). As chi remarks, a good way of summing up stuff is the <code>scanl</code> function.</p>\n\n<p>Apart from avoiding to manually increment and pass around an index, you should also avoid calculating the entire factorial over and over again. Doing that is a pretty general code smell (there's a reason <code>fact</code> isn't defined in the standard libraries)</p>\n\n<pre><code>recipFacts :: [Double] -- Infinite list of reciprocal factorials, starting from 1/0!\nrecipFacts = go 1\n where go k = 1 : map (/k) (go (k+1))\n</code></pre>\n\n<p>Incidentally, this can also be written as a scan: <code>scanl (/) 1 [1..]</code> (courtesy of Will Ness).</p>\n\n<p>Next we can use <code>scanl</code> to calculate the partial sums, and use some termination condition. However, because the series converges so quickly, there's actually a hack that works fine and is even simpler:</p>\n\n<pre><code>enumber :: Double\nenumber = sum $ takeWhile (&gt;0) recipFacts\n           -- result: 2.7182818284590455\n</code></pre>\n\n<p>Here I've used the fact that the fast-growing factorial quickly causes the floating-point reciprocals to underflow to zero.</p>\n\n<p>Of course, <em>really</em> there's not a need to sum anything up yourself at all here: the most to-the-point definition is</p>\n\n<pre><code>enumber = exp 1\n</code></pre>\n\n<p>and nothing else.</p>\n"}], "owner": {"reputation": 25, "user_id": 4642017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81a64df5938ab8e21c24c3a5a4f73131?s=128&d=identicon&r=PG&f=1", "display_name": "dotnetdeveloperboi", "link": "https://stackoverflow.com/users/4642017/dotnetdeveloperboi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2220, "favorite_count": 0, "accepted_answer_id": 34558704, "answer_count": 2, "score": 1, "last_activity_date": 1451737464, "creation_date": 1451669650, "question_id": 34558374, "link": "https://stackoverflow.com/questions/34558374/calculating-the-e-constant-using-haskells-until-function", "title": "Calculating the &quot;e&quot; constant using Haskell&#39;s until function", "body": "<p>I want to calculate the \"e\" constant using Haskell's (Prelude) built-in until function. I want to do something like this:</p>\n\n<pre><code>enumber = until (&gt;2.7) iter (1 0)\n\niter x k = x + (1/(fact (k + 1)))\n\nfact k = foldr (*) 1 [1..k]\n</code></pre>\n\n<p>When I try to run this code, I get this error: </p>\n\n<pre><code>Occurs check: cannot construct the infinite type: a ~ a -&gt; a\nExpected type: (a -&gt; a) -&gt; a -&gt; a\n  Actual type: a -&gt; a -&gt; a\nRelevant bindings include enumber :: a -&gt; a (bound at Lab2.hs:65:1)\nIn the second argument of \u2018until\u2019, namely \u2018iter\u2019\nIn the expression: until (&gt; 2.7) iter (1 0)\n</code></pre>\n\n<p>By \"e\" I mean e = 2.71828..</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 58948, "user_id": 857807, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/297e4dba223f5103614030100eab78ca?s=128&d=identicon&r=PG", "display_name": "dcastro", "link": "https://stackoverflow.com/users/857807/dcastro"}, "edited": false, "score": 1, "creation_date": 1513843764, "post_id": 34558480, "comment_id": 82808568, "body": "Also: <code>stack ghci --test :spec</code> is shorthand for <code>stack ghci --test chapterexercises:test:spec</code>"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 14, "last_activity_date": 1451670321, "creation_date": 1451670321, "answer_id": 34558480, "question_id": 34558002, "link": "https://stackoverflow.com/questions/34558002/haskell-stack-ghci-test-suite/34558480#34558480", "title": "Haskell Stack Ghci test-suite", "body": "<pre><code>stack ghci --test\n</code></pre>\n\n<p>Note that this will only work if there's a single test suite and no other executable. Otherwise it will give you a warning:</p>\n\n<pre>* * * * * * * *\nThe main module to load is ambiguous. Candidates are:\nPackage `project' component exe:project-exe with main-is file: T:\\project\\app\\Main.hs\nPackage `project' component test:project-test with main-is file: T:\\project\\test\\Spec.hs\nNone will be loaded. You can specify which one to pick by:\n 1) Specifying targets to stack ghci e.g. stack ghci project:exe:project-exe\n 2) Specifying what the main is e.g. stack ghci --main-is project:exe:project-exe\n* * * * * * * *</pre>\n\n<p>In this case you have to use</p>\n\n<pre><code>stack ghci --test chapterexercises:test:spec\n</code></pre>\n\n<p>Without <code>--test</code> stack is going to ignore the tests. That's why you don't get the ambiguity error in the first place.</p>\n"}], "owner": {"reputation": 1953, "user_id": 899723, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f68bcc2d6f5196fa090d578eb8356b9c?s=128&d=identicon&r=PG", "display_name": "mac10688", "link": "https://stackoverflow.com/users/899723/mac10688"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 945, "favorite_count": 5, "accepted_answer_id": 34558480, "answer_count": 1, "score": 12, "last_activity_date": 1451670321, "creation_date": 1451666918, "question_id": 34558002, "link": "https://stackoverflow.com/questions/34558002/haskell-stack-ghci-test-suite", "title": "Haskell Stack Ghci test-suite", "body": "<p>I'm trying to use stack to load my test-suite in ghci and have it load the QuickCheck and hspec dependency.</p>\n\n<p>How can I do this?</p>\n\n<p>I'm using the franklinchen template. <br />\n<a href=\"https://github.com/commercialhaskell/stack-templates/blob/master/franklinchen.hsfiles\">https://github.com/commercialhaskell/stack-templates/blob/master/franklinchen.hsfiles</a></p>\n\n<p>I have tried <br />\nstack ghci spec <br />\nstack ghci test-suite <br />\nstack ghci --main-is spec <br /></p>\n\n<p>I modified the test-suite spec to target the main-is: LibSpec.hs file</p>\n\n<pre><code>test-suite spec\n  default-language:    Haskell2010\n  ghc-options:         -Wall\n  type:                exitcode-stdio-1.0\n  hs-source-dirs:      test\n  main-is:             LibSpec.hs\n  build-depends:       base\n                     , chapterexercises\n                     , hspec\n                     , QuickCheck\n</code></pre>\n"}, {"tags": ["haskell", "jvm", "frege", "spineless-tagless-graph"], "comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 2, "creation_date": 1451640982, "post_id": 34554926, "comment_id": 56852750, "body": "Your version of the &#39;Java compilation process&#39; bears no relationship with reality. It isn&#39;t on the same level as your version of the Haskell compilation process, whether accurate or not. Compilation via any process involves screening, scanning, parsing, semantic analysis, allocation, flow analysis, optimization, code generation, ... and maybe a lot of other things as well. And execution isn&#39;t part of compilation."}, {"owner": {"reputation": 381960, "user_id": 276052, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/UcrhR.jpg?s=128&g=1", "display_name": "aioobe", "link": "https://stackoverflow.com/users/276052/aioobe"}, "edited": false, "score": 1, "creation_date": 1451641171, "post_id": 34554926, "comment_id": 56852798, "body": "Note that <code>javac</code> (and afaik all other java compilers) do very few optimizations when going from Java code to bytecode. All optimizations are deferred to the JIT compiler which takes bytecode to machine code. So your question would perhaps be better phrased if you referred to the JIT compilation process."}, {"owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1451642024, "post_id": 34554926, "comment_id": 56852952, "body": "That&#39;s helpful feedback. I&#39;ve updated the question to remove the issues you&#39;ve talked about."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1451644586, "post_id": 34554926, "comment_id": 56853486, "body": "As far as I understand, running the STG machine efficiently requires some low-level tricks, which the JVM does not allow. For instance, every closure needs two pointers: one for an information table, and another one for the actual entry code. GHC optimizes this by placing the read-only info table right before the entry point, so that only one pointer is needed per closure."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1451858403, "post_id": 34554926, "comment_id": 56909365, "body": "There is no such thing as <b>THE</b> JVM language compilation process."}], "answers": [{"comments": [{"owner": {"reputation": 539, "user_id": 3635927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9xvoS.jpg?s=128&g=1", "display_name": "MB Reynolds", "link": "https://stackoverflow.com/users/3635927/mb-reynolds"}, "reply_to_user": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "edited": false, "score": 0, "creation_date": 1451732079, "post_id": 34555099, "comment_id": 56873703, "body": "For my edification it would be useful for whomever down voted my answer to state the reason."}], "tags": [], "owner": {"reputation": 539, "user_id": 3635927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9xvoS.jpg?s=128&g=1", "display_name": "MB Reynolds", "link": "https://stackoverflow.com/users/3635927/mb-reynolds"}, "is_accepted": false, "score": 1, "last_activity_date": 1451757373, "last_edit_date": 1451757373, "creation_date": 1451641737, "answer_id": 34555099, "question_id": 34554926, "link": "https://stackoverflow.com/questions/34554926/what-would-change-if-a-jvm-language-compilation-process-had-an-stg-phase-like-ha/34555099#34555099", "title": "What would change if a JVM Language Compilation process had an STG phase like Haskell?", "body": "<p>You need to clarify if you mean Java the language or some language running on the JVM.</p>\n\n<p>My knowledge of Java the language is limited to having read the specification, and I know nothing about the Haskell IR you're talking about.  However, Java is, by spec, a dynamic language, and it would be illegal to perform any AOT xform which uses any information outside of each end classfile. </p>\n\n<p>Of course a project that doesn't use these features could break these rules.</p>\n"}], "owner": {"reputation": 30852, "user_id": 15441, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f5fdef7fa815d59023c2eaa95f274c3f?s=128&d=identicon&r=PG&f=1", "display_name": "hawkeye", "link": "https://stackoverflow.com/users/15441/hawkeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1451757373, "creation_date": 1451639827, "last_edit_date": 1451675578, "question_id": 34554926, "link": "https://stackoverflow.com/questions/34554926/what-would-change-if-a-jvm-language-compilation-process-had-an-stg-phase-like-ha", "title": "What would change if a JVM Language Compilation process had an STG phase like Haskell?", "body": "<p>I had a friend say:</p>\n\n<blockquote>\n  <p>For me the most interesting thing about Haskell is not the language and the types. It is the Spineless Tagless Graph Machine behind it. </p>\n</blockquote>\n\n<p>Because Haskell people talk about types all the time, this quote really caught my attention. Now we can look at the Haskell compilation process <a href=\"http://jozefg.bitbucket.org/posts/2014-10-28-stg.html\" rel=\"nofollow\">like this</a>:</p>\n\n<ol>\n<li>Parsing</li>\n<li>Type checking</li>\n<li>Desugaring + a few bobs and bits</li>\n<li>Translation to core</li>\n<li>Lion share of optimization</li>\n<li>Translation to STG language</li>\n<li>STG language to C\u2013</li>\n<li>C\u2013 to assembly or llvm</li>\n</ol>\n\n<p>Which we can simplify down to:</p>\n\n<ol>\n<li>.. front end stuff ..</li>\n<li>Translate IL to STG language</li>\n<li>Compile STG language to C/ASM/LLVM/Javascript</li>\n</ol>\n\n<p>Ie - there is an intermediate 'graph language' that Haskell is compiled to, and various optimisations happen there, prior to it being compiled to LLVM/C etc.  </p>\n\n<p>This contrasts to a potential JVM Language compilation process that looks like this:</p>\n\n<ol>\n<li>Convert JVM Language Code to Java bytecode inside a class. </li>\n<li>Run the Bytecode on a Java Virtual Machine. </li>\n</ol>\n\n<p>Assuming it were possible to add an intermediate STG Compilation step to the Java Compilation process, I'm wondering what impact would this change have? What would change about the compiled code? </p>\n\n<p>(I'm aware that you need a pure functional language to get the most use out of the spineless tagless graph machine, so if it is helpful to answer the question, assume we're compiling <a href=\"https://github.com/Frege/frege\" rel=\"nofollow\">Frege</a> [Haskell for the JVM].)</p>\n\n<p>My question is: <strong>What would change if the JVM Language Compilation process had an STG phase like Haskell?</strong></p>\n"}, {"tags": ["macos", "haskell", "haskell-platform", "homebrew-cask"], "answers": [{"tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 1, "last_activity_date": 1451756260, "creation_date": 1451756260, "answer_id": 34568733, "question_id": 34553482, "link": "https://stackoverflow.com/questions/34553482/where-is-ghci-conf-if-installing-ghc-using-brew-cask-in-mac/34568733#34568733", "title": "Where is ghci.conf if installing GHC using brew cask in mac?", "body": "<p>You will have to create a new file in your user directory; the final path should be <code>~/.ghci</code> or <code>/Users/&lt;username&gt;/.ghci</code>. The file does not exist by default. See <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/ghci-dot-files.html\" rel=\"nofollow\">the documentation</a> for the full details.</p>\n"}], "owner": {"reputation": 1751, "user_id": 4093741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f6530be07a7886c6db95fbac40b41fbc?s=128&d=identicon&r=PG&f=1", "display_name": "Da Tong", "link": "https://stackoverflow.com/users/4093741/da-tong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 34568733, "answer_count": 1, "score": 0, "last_activity_date": 1451756260, "creation_date": 1451621874, "question_id": 34553482, "link": "https://stackoverflow.com/questions/34553482/where-is-ghci-conf-if-installing-ghc-using-brew-cask-in-mac", "title": "Where is ghci.conf if installing GHC using brew cask in mac?", "body": "<p>I used homebrew-cask to install haskell-platform in my mac (OS X 10.11.2) by running:</p>\n\n<pre><code>brew cask install haskell-platform\n</code></pre>\n\n<p>and it is working well until the day I want to enable syntax highlight in GHCi. I found in <a href=\"https://wiki.haskell.org/GHCi_in_colour\" rel=\"nofollow\">this post</a> that I should add one line in <code>ghci.conf</code>. But I could not found where this file is.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "reply_to_user": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "edited": false, "score": 0, "creation_date": 1451616467, "post_id": 34553156, "comment_id": 56849147, "body": "Running the code using <code>runhaskell</code> provided by <code>Glasgow Haskell Compiler, Version 7.10.2</code>"}, {"owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "edited": false, "score": 5, "creation_date": 1451616524, "post_id": 34553156, "comment_id": 56849152, "body": "Have you considered using line-breaks? (They won&#39;t help the parallelism, but they will help everyone reading your code.)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 6, "creation_date": 1451617617, "post_id": 34553156, "comment_id": 56849269, "body": "Haskell does not automatically parallelize computations. Firstly it must be enabled by command line options (<code>-threaded</code> or something like that) but more importantly you have to tell it which things to evaluate in parallel, which at the most basic level corresponds to <code>par</code> and <code>parSeq</code> in <code>Control.Parallel</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 9, "creation_date": 1451618225, "post_id": 34553156, "comment_id": 56849347, "body": "As a side note, this is probably a bad example.. doing the filters &quot;in parallel&quot; will not help you, if you do them sequentially then ghc will optimize all the filters and the map into one wicked fast loop. If you seperate them with <code>par</code> I don&#39;t think it could do this optimization."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1451619101, "post_id": 34553156, "comment_id": 56849433, "body": "The sort of parallelism you <i>want</i> here is best left to your friendly CPU. The main thing you should do here is add a type signature to force those numbers to have type <code>Int</code> instead of defaulting to <code>Integer</code>. I also think the code would be a lot cleaner if you fused all the filters into one."}], "answers": [{"comments": [{"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1451642721, "post_id": 34555119, "comment_id": 56853099, "body": "The most amazing answer I have ever received on SO, thank you very much! I didn&#39;t do any optimization of the problem size so that I can talk about parallelism alone, but I get the point about reducing it."}, {"owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "edited": false, "score": 0, "creation_date": 1451642767, "post_id": 34555119, "comment_id": 56853113, "body": "I&#39;m a Haskell beginner and the readability of your code is awesome. Will give me something to aim for."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 15, "last_activity_date": 1451642384, "last_edit_date": 1451642384, "creation_date": 1451641975, "answer_id": 34555119, "question_id": 34553156, "link": "https://stackoverflow.com/questions/34553156/should-this-run-in-parallel/34555119#34555119", "title": "Should this run in parallel?", "body": "<blockquote>\n  <p>Should this run in parallel?</p>\n</blockquote>\n\n<p>No, because GHC doesn't add parallelism by default (see below). Also, parallelism isn't a convenient orbital cannon that just blasts away any kind of problem (see further below).</p>\n\n<blockquote>\n  <p>Why is my expectation wrong?</p>\n</blockquote>\n\n<p>First of all, using <code>runhaskell</code> is mostly the same as using GHCi: it doesn't use optimization since <code>-O</code> con&shy;flicts with <code>--interactive</code>, it doesn't give you additional RTS options, and you cannot use all those nice compiler flags that give you a little bit more juice.</p>\n\n<p>But even if you compile your code with a threaded runtime, you won't end up with a faster ex&shy;e&shy;cu&shy;ta&shy;ble:</p>\n\n<pre>\n$ ghc --make -O2 -rtsopts -with-rtsopts -N -threaded SO.hs \n$ .\\SO +RTS -s\n[31875000]\n   2,863,269,440 bytes allocated in the heap\n       1,135,584 bytes copied during GC\n         100,016 bytes maximum residency (2 sample(s))\n          31,152 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0      5471 colls,  5471 par    0.266s   0.283s     0.0001s    0.0126s\n  Gen  1         2 colls,     1 par    0.000s   0.001s     0.0004s    0.0007s\n\n  Parallel GC work balance: 0.00% (serial 0%, perfect 100%)\n\n  TASKS: 4 (1 bound, 3 peak workers (3 total), using -N2)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.000s  (  0.001s elapsed)\n  <b>MUT     time   20.328s  ( 21.671s elapsed)</b>     &lt;-------\n  GC      time    0.266s  (  0.284s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time   20.609s  ( 21.956s elapsed)\n\n  Alloc rate    140,852,608 bytes per MUT second\n\n  Productivity  98.7% of total user, 92.7% of total elapsed\n</pre>\n\n<p>That's because GHC doesn't add parallelism automatically. While it would be nice to just flip a switch and be done, parallelism can cause a pretty high overhead if done wrong. For example, if <code>f :: Int -&gt; T</code> is a complex function, then running <code>head $ filter p $ parallelMap f [1..100]</code> is probably fine. But calling <code>head $ filter p $ parallelMap f [1..]</code> isn't anymore. After all, Haskell is lazy.</p>\n\n<h1>Speeding things up without parallelism</h1>\n\n<p>Now that you know why there's no automagical parallelism in Haskell, what can you do to speed up your program? First of all, structure it:</p>\n\n<pre><code>triples :: [(Int, Int, Int)]\ntriples = filter pythagoras . filter smaller . filter sum1000 $ ts\n  where \n    pythagoras (a,b,c) = a ^ 2 + b ^ 2 == c ^ 2\n    sum1000    (a,b,c) = a + b + c == 1000\n    smaller    (a,b,c) = a &lt; b &amp;&amp; b &lt; c\n\n    ts = [(a,b,c) | a &lt;- [0..1000], b &lt;- [0..1000], c &lt;- [0..1000]]\n\nmain :: IO ()\nmain = print $ map (\\(a,b,c) -&gt; a * b * c) $ triples\n</code></pre>\n\n<p>Now, this is a lot easier to read than your previous program. Hm. You generate a list and then apply three filters afterwards. Wait a second. <code>sum1000</code> and <code>smaller</code> seem off. For any given range, the number of triples that fulfil <code>smaller</code> is usually relatively small, and for any given <code>a</code> and <code>b</code>, there is only <em>one</em> <code>c</code> that fulfils <code>sum1000</code>!</p>\n\n<p>We can fuse both conditions together to get the following ones on <code>a</code>, <code>b</code> and <code>c</code> directly:</p>\n\n<ul>\n<li><code>a</code> can never be larger than <code>332</code>, since we cannot split <code>1000 - 333</code> into <code>b</code> and <code>c</code> so that <code>smaller</code> still holds (<code>667 = 333 + 334</code>)</li>\n<li><code>b</code> is always greater than <code>a</code></li>\n<li><code>b</code> can never be larger than <code>(1000 - a) / 2</code>, otherwise there's no suitable <code>c</code></li>\n<li><code>c</code> is always <code>1000 - a - b</code>, but there is no <code>c</code> for <code>a = 0</code> and <code>b = 500</code>.</li>\n</ul>\n\n<p>We end up with the following list instead:</p>\n\n<pre><code>triples :: [(Int, Int, Int)]\ntriples = filter pythagoras . filter smaller . filter sum1000 $ ts\n  where\n    pythagoras (a,b,c) = a ^ 2 + b ^ 2 == c ^ 2\n    sum1000    (a,b,c) = a + b + c == 1000\n    smaller    (a,b,c) = a &lt; b &amp;&amp; b &lt; c\n\n    ts = [(a,b,c) | a &lt;- [0..332]\n                  , b &lt;- [a+1 .. (1000 - a)`div` 2]\n                  , let c = 1000 - a - b]\n\n-- Old list for documentation\n--  ts = [(a,b,c) | a &lt;- [0..1000], b &lt;- [0..1000], c &lt;- [0..1000]]\n</code></pre>\n\n<p>You could also remove the filters, but then don't forget the check for <code>b &lt; c</code>.</p>\n\n<p>This is a lot faster, since we're now using an <em>O(n\u00b2)</em> approach instead of an <em>O(n\u00b3)</em> one. <code>runhaskell SO.hs</code> will finish after 2 seconds on my PC, and if we actually compile it, we end up with an almost immediately finishing executable:</p>\n\n<pre>\n$ ghc --make -O2 SO.hs\n$ ./SO +RTS -s\n[31875000]\n         104,960 bytes allocated in the heap\n           1,752 bytes copied during GC\n          42,664 bytes maximum residency (1 sample(s))\n          18,776 bytes maximum slop\n               1 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0         0 colls,     0 par    0.000s   0.000s     0.0000s    0.0000s\n  Gen  1         1 colls,     0 par    0.000s   0.000s     0.0005s    0.0005s\n\n  INIT    time    0.000s  (  0.001s elapsed)\n  <b>MUT     time    0.000s  (  0.002s elapsed)</b>  &lt;----------------\n  GC      time    0.000s  (  0.000s elapsed)\n  EXIT    time    0.000s  (  0.001s elapsed)\n  Total   time    0.000s  (  0.003s elapsed)\n\n  %GC     time       0.0%  (13.9% elapsed)\n\n  Alloc rate    0 bytes per MUT second\n\n  Productivity 100.0% of total user, 0.0% of total elapsed\n</pre>\n\n<h1>TL;DR</h1>\n\n<p>Decreasing the work to a minuscule of its original size always trumps running far too much work in parallel.</p>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 1, "accepted_answer_id": 34555119, "answer_count": 1, "score": 4, "last_activity_date": 1451643762, "creation_date": 1451616125, "last_edit_date": 1451643762, "question_id": 34553156, "link": "https://stackoverflow.com/questions/34553156/should-this-run-in-parallel", "title": "Should this run in parallel?", "body": "<p>I was under impression that Haskell would run a program like the one below in parallel (each <code>a,b,c</code> combination would get pushed through all the <code>filter</code>s independently).</p>\n\n<pre><code>main = print $ \n       map (\\(a,b,c) -&gt; a * b * c) $\n       filter (\\(a,b,c) -&gt; a^2 + b^2 == c^2) $\n       filter (\\(a,b,c) -&gt; a + b + c == 1000) $\n       filter (\\(a,b,c) -&gt; a &lt; b &amp;&amp; b &lt; c) $\n       [(a,b,c) | a &lt;- [0..1000], b &lt;- [0..1000], c &lt;- [0..1000]]\n</code></pre>\n\n<p>But when I run the program I can see that only one of the four threads on my machine are utilised.</p>\n\n<p>Why is my expectation wrong?</p>\n"}, {"tags": ["haskell", "gtk", "gtk3", "gtk2hs"], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1451588371, "creation_date": 1451588371, "question_id": 34550620, "link": "https://stackoverflow.com/questions/34550620/how-can-i-have-a-widget-as-a-cellrenderer-in-gtk2hs", "title": "How can I have a widget as a CellRenderer in gtk2hs?", "body": "<p>I want to put a custom widget in my <code>TreeView</code> but <code>TreeViewColumn</code>s will only let me pack instances of <code>CellRenderer</code> and there is no instance that will let me just put any widget. Or maybe it's just not possible with gtk2hs?</p>\n"}, {"tags": ["haskell", "garbage-collection", "ghc"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1451602980, "post_id": 34550506, "comment_id": 56847123, "body": "Can you include all the code (CSV.getFileRaw) and maybe the file you are testing with?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1451624855, "post_id": 34550506, "comment_id": 56850171, "body": "@user2407038 I updated the previous question with the full test code including a function to generate test data. The results shown here are actually for the full application which does a lot more work before/after the step that seems to be the problem."}], "answers": [{"comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1451596022, "post_id": 34551515, "comment_id": 56845516, "body": "I recently converted from <code>HashMap</code> in <code>unordered-containers</code> to <code>HashTable</code> in <code>hashtables</code> hoping migration to <code>ST</code> would gain something - it slightly decreased the run time, but didn&#39;t change GC time which overshadows everything. I&#39;ve been looking into and would like to move to using unboxed values, but I&#39;m not sure I can because of the data structures stored in the vectors. Regarding pinning, I recently moved from lazy bytestrings (pinned) to <code>ShortByteStrings</code> which didn&#39;t change the proportion of GC time, but <i>hugely</i> reduced the total heap size and slightly reduced the total run time."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1451596132, "post_id": 34551515, "comment_id": 56845539, "body": "Is there any way to pin arbitrary data? Like somehow make the GC ignore the map/table? At a minimum doing so might provide further insight."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 1, "creation_date": 1451597197, "post_id": 34551515, "comment_id": 56845804, "body": "@ryachza, I don&#39;t <i>think</i> that&#39;s possible. I was talking about crazy things like replacing a bunch of <code>ByteString</code>s with a single huge one and a vector of indices into it. Yucky stuff."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1451598007, "post_id": 34551515, "comment_id": 56846047, "body": "Ah interesting I had actually considered doing something like that when when I was comparing <code>Short</code> and <code>Plain</code> bytestrings - short took much less space, but plain was much faster. I was thinking I could try to get the best of both, but just went with short for now to get something done. Would you have any idea for proving that something like that would make a significant difference before doing it? It seems like it would be a lot of effort to &quot;try out&quot;."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1451600558, "post_id": 34551515, "comment_id": 56846665, "body": "@ryachza, try more detailed profiling, such as constructor profiling. Also, check again for other sources of trouble. I&#39;ll try to do so later, but I&#39;m on a beach vacation with family."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "edited": false, "score": 2, "creation_date": 1502140432, "post_id": 34551515, "comment_id": 78071601, "body": "In 2017, with GHC 8.2, it is now possible to pin arbitrary data using the interface provided by <code>Data.Compact</code>."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 3, "last_activity_date": 1451595253, "last_edit_date": 1592644375, "creation_date": 1451595253, "answer_id": 34551515, "question_id": 34550506, "link": "https://stackoverflow.com/questions/34550506/how-can-i-trace-reduce-gc-time-in-ghc/34551515#34551515", "title": "How can I trace/reduce GC time in GHC?", "body": "<p>I haven't looked at your code yet, so you should take this as an extended comment rather than an answer. If, as you say, you <em>must</em> build up a very large structure, there are two things you can do to limit the performance impact:</p>\n<h3>Limit pointers</h3>\n<p>The first and easiest (but not easy!) step is to cut down on pointers as much as you can. A gigantic <code>HashMap</code> is likely to be much more expensive to build than a gigantic hash <em>table</em> backed by, and indexed by, an unboxed vector. Unboxed things never have to be traced by the GC, a huge advantage, but they'll still get copied by it. You may find this acceptable, because copying large contiguous vectors should be really cheap.</p>\n<h3>Pin everything</h3>\n<p>The next step is to hide things from the garbage collector by putting them in pinned memory. I believe standard (not small) <code>ByteString</code>s do this, as well as arrays created through the foreign function interface.</p>\n"}], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1451595253, "creation_date": 1451587666, "last_edit_date": 1495542681, "question_id": 34550506, "link": "https://stackoverflow.com/questions/34550506/how-can-i-trace-reduce-gc-time-in-ghc", "title": "How can I trace/reduce GC time in GHC?", "body": "<p>I recently posted a question about <a href=\"https://stackoverflow.com/questions/34457098/profiling-improving-memory-usage-and-or-gc-time\">improving memory usage/GC</a> and have since been able to reduce the memory consumption to what I believe is an appropriate/proportional level using <code>ShortByteString</code>s (and in the process go from \"never completing\" to just \"very, very slow\" for current tests), but there still seems to be what I would consider excessive GC time.</p>\n\n<p>Profiling a test results in the following output:</p>\n\n<pre>\n49,463,229,848 bytes allocated in the heap\n68,551,129,400 bytes copied during GC\n   212,535,336 bytes maximum residency (500 sample(s))\n     3,739,704 bytes maximum slop\n           602 MB total memory in use (0 MB lost due to fragmentation)\n\n                                   Tot time (elapsed)  Avg pause  Max pause\nGen  0     14503 colls,     0 par    1.529s   1.681s     0.0001s    0.0164s\nGen  1       500 colls,     0 par   79.202s  79.839s     0.1597s    0.3113s\n\nTASKS: 3 (1 bound, 2 peak workers (2 total), using -N1)\n\nSPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\nINIT    time    0.000s  (  0.001s elapsed)\nMUT     time   29.500s  ( 82.361s elapsed)\nGC      time   47.253s  ( 47.983s elapsed)\nRP      time    0.000s  (  0.000s elapsed)\nPROF    time   33.478s  ( 33.537s elapsed)\nEXIT    time    0.000s  (  0.025s elapsed)\nTotal   time  110.324s  (130.372s elapsed)\n\nAlloc rate    1,676,731,643 bytes per MUT second\n\nProductivity  26.8% of total user, 22.7% of total elapsed\n\ngc_alloc_block_sync: 0\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</pre>\n\n<p>And the following heap visualization:</p>\n\n<p><a href=\"https://i.stack.imgur.com/einBs.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/einBs.png\" alt=\"Heap Visualization\"></a></p>\n\n<p>Currently I'm using <code>-H</code> which seemed to have helped, and have experimented with combinations of increasing threads, generations, factor, and using compacting (<code>-N -G -F -c</code>) all of which resulted in no apparent change or a decrease in performance. It's clear that everything is long lived (when I increased <code>-G</code> then gen 1 statistics essentially moved to the oldest generation, with nothing between it and gen 0), but I don't understand why the GC can't just \"leave it alone\". From what I've read I thought the GC only runs when it's out of allocation space, but increasing the allocation/factor/heap seemed to have no effect.</p>\n\n<p>Is there anything else I can try in order to decrease the GC effort? Or is there some way that I can know that there is a fundamental problem with my code that makes it impossible to decrease this time? I am and believe I must build up a large data structure in memory, currently a hashtable of mutable vectors inside <code>ST</code>. My only other thought is that internally my data structure is being [needlessly?] copied and forcing the GC to run, but I'm using <code>ST</code> with the expectation of avoiding that behavior.</p>\n"}, {"tags": ["parsing", "haskell", "attoparsec"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1451596670, "post_id": 34548475, "comment_id": 56845682, "body": "Note that instead of writing <code>_ &lt;- foo</code> you can always write just <code>foo</code>."}, {"owner": {"reputation": 2442, "user_id": 3666302, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e9aed854fcd666aba1316ef908ad5913?s=128&d=identicon&r=PG&f=1", "display_name": "TomTom", "link": "https://stackoverflow.com/users/3666302/tomtom"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1451642891, "post_id": 34548475, "comment_id": 56853129, "body": "I know but I get warnings in Atom about that and I don&#39;t know how to turn them off."}], "answers": [{"tags": [], "owner": {"reputation": 13362, "user_id": 260584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f9744d1d903eef5f9954fa31d25a26?s=128&d=identicon&r=PG", "display_name": "erisco", "link": "https://stackoverflow.com/users/260584/erisco"}, "is_accepted": false, "score": 1, "last_activity_date": 1451583414, "creation_date": 1451583414, "answer_id": 34549758, "question_id": 34548475, "link": "https://stackoverflow.com/questions/34548475/how-to-skip-unwanted-text-with-attoparsec/34549758#34549758", "title": "How to skip unwanted text with attoparsec", "body": "<p>Instead of ignoring text with the parser, another approach is to parse the email normally and then project only the headers you are interested in.</p>\n\n<pre><code>-- After parsing, say we end up with this data.\ndata Email = Email { headers :: [Header], message :: Text }\n\ndata Header = Header { label :: Text, value :: Text }\n\n-- Helper to find headers in an Email.\nfindHeader :: Text -&gt; Email -&gt; Maybe Header\nfindHeader x = find ((==x) . label) . headers\n\n-- Project the Email's \"Subject\" header.\nsubject :: Email -&gt; Maybe Header\nsubject = findHeader \"Subject\"\n\n-- Project the Email's \"From\" header.\nfrom :: Email -&gt; Maybe Header\nfrom = findHeader \"From\"\n</code></pre>\n\n<p>Also, <a href=\"http://hackage.haskell.org/package/hsemail\" rel=\"nofollow\">hsemail</a> and <a href=\"http://hackage.haskell.org/package/hsemail-ns\" rel=\"nofollow\">hsemail-ns</a> have defined Parsec email parsers.</p>\n"}], "owner": {"reputation": 2442, "user_id": 3666302, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e9aed854fcd666aba1316ef908ad5913?s=128&d=identicon&r=PG&f=1", "display_name": "TomTom", "link": "https://stackoverflow.com/users/3666302/tomtom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1452062355, "creation_date": 1451576002, "last_edit_date": 1452062355, "question_id": 34548475, "link": "https://stackoverflow.com/questions/34548475/how-to-skip-unwanted-text-with-attoparsec", "title": "How to skip unwanted text with attoparsec", "body": "<p>I'd like to parse E-Mails similar to this</p>\n\n<pre><code>Random Info: ........\nFrom: email@domain.com\nOther Info: .......\nSubject: ima subject\nSome More Info: .....\n\nThis is a message.\n</code></pre>\n\n<p>But I don't need all the information from this E-Mail. Only \"From\", \"Subject\" and the message itself. How can I parse a message like this? More specifically how can I skip the unwanted data?</p>\n\n<p>Here is the code I have so far</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule MailParser where\n\nimport qualified Data.Text as T\nimport Data.Attoparsec.Text\n\ntype From    = Address\ntype Message = T.Text\ntype Subject = T.Text\ntype Local   = T.Text\ntype Domain  = T.Text\n\ndata Address = Address Local Domain\ndata Mail = Mail From Subject Message\n\naddressParser :: Parser Address\naddressParser = do\n    _ &lt;- string \"From: \"\n    local  &lt;- takeWhile1 (/= '@')\n    _ &lt;- char '@'\n    domain &lt;- takeWhile1 (/= '\\n')\n    return $ Address local domain\n\nsubjectParser :: Parser T.Text\nsubjectParser = do\n    _ &lt;- string \"Subject: \"\n    takeWhile1 (/= '\\n')\n\nmessageParser :: Parser Message\nmessageParser = do\n    _ &lt;- char '\\n'\n    takeText\n\nmailParser :: Parser Mail\nmailParser = do\n    -- skip unwanted info\n    from &lt;- addressParser\n    -- skip unwanted info\n    subject &lt;- subjectParser\n    -- skip unwanted info\n    message &lt;- messageParser\n    return $ Mail from subject message\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1451574210, "post_id": 34547937, "comment_id": 56838016, "body": "You probably don&#39;t need the <code>data A ; ...; data T</code> type definitions. The value constructors are enough, provided you export and import them as pointed out in the answer below."}], "answers": [{"comments": [{"owner": {"reputation": 287, "user_id": 3191372, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jqFzX.jpg?s=128&g=1", "display_name": "Thibaud Dauce", "link": "https://stackoverflow.com/users/3191372/thibaud-dauce"}, "edited": false, "score": 0, "creation_date": 1451574130, "post_id": 34548070, "comment_id": 56837988, "body": "it&#39;s not working with DNA(..), I get the same errors\u2026"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 287, "user_id": 3191372, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jqFzX.jpg?s=128&g=1", "display_name": "Thibaud Dauce", "link": "https://stackoverflow.com/users/3191372/thibaud-dauce"}, "edited": false, "score": 0, "creation_date": 1451575863, "post_id": 34548070, "comment_id": 56838744, "body": "Are you sure?  You should be getting different errors now, such as <code>&quot;Not in scope &#39;A&#39; Perhaps you ment one of these: &#39;DNA.A&#39; ...&quot;</code>.  After that&#39;s done you&#39;ll probably get a type error with expected type vs actual type DNA/RNA."}, {"owner": {"reputation": 287, "user_id": 3191372, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jqFzX.jpg?s=128&g=1", "display_name": "Thibaud Dauce", "link": "https://stackoverflow.com/users/3191372/thibaud-dauce"}, "edited": false, "score": 0, "creation_date": 1451576867, "post_id": 34548070, "comment_id": 56839155, "body": "I updated my first post with the modification for the import and the definition of RNA type."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1451578242, "post_id": 34548070, "comment_id": 56839682, "body": "The OP is already importing everything from <code>Bioinformatics.DNA</code>, so it must be an issue with the export list of that module."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1451578346, "post_id": 34548070, "comment_id": 56839721, "body": "@ReidBarton Right!  @Thibaud I see your RNA export list is <code>RNA</code> instead of <code>RNA(..)</code>, do you do the same thing in DNA?  You need to export the constructors.  Also, this question is a case-study in why you should paste a complete example and not fragments."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 3, "last_activity_date": 1451576291, "last_edit_date": 1451576291, "creation_date": 1451573775, "answer_id": 34548070, "question_id": 34547937, "link": "https://stackoverflow.com/questions/34547937/haskell-import-qualified-and-not-in-scope-data-constructor/34548070#34548070", "title": "Haskell &quot;import qualified&quot; and &quot;Not in scope: data constructor&quot;", "body": "<p>Use <code>(..)</code>  to import all the constructors of a data type.</p>\n\n<pre><code>import qualified Bioinformatics.DNA as DNA (DNA(..), A, C, G, T)\n</code></pre>\n\n<p><strong>Code Breakdown</strong></p>\n\n<p>EDIT:  Let's break down your code a little since its not quite idiomatic.</p>\n\n<pre><code>import qualified Bioinformatics.DNA as DNA (DNA(..), A, C, G, T)\n</code></pre>\n\n<p>That's already an odd one. Typically people import things qualified or selectively, not both.  Try just:</p>\n\n<pre><code>import qualified Bioinfomatics.DNA as DNA\n</code></pre>\n\n<p>So lets keep the quantification and drop the explicit list of symbols.</p>\n\n<p>Now for the use, you have:</p>\n\n<pre><code>fromDna :: DNA.DNA -&gt; RNA\nfromDna DNA.A = A\nfromDna DNA.C = C\nfromDna DNA.G = G\nfromDna DNA.T = U\n</code></pre>\n\n<p>The claim that this function converts from DNA to RNA.  Note your questino never presented an RNA type or constructors - are those in your code somewhere?  The remaining error from the code you posted is with respect to RNA, consider something like:</p>\n\n<pre><code>import qualified Bioinformatics.RNA as RNA\n\nfromDna :: DNA.DNA -&gt; RNA.RNA\nfromDna DNA.A = RNA.A\nfromDna DNA.C = RNA.C\nfromDna DNA.G = RNA.G\nfromDna DNA.T = RNA.U\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2351, "user_id": 1661465, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/8x0xD.jpg?s=128&g=1", "display_name": "serghei", "link": "https://stackoverflow.com/users/1661465/serghei"}, "is_accepted": false, "score": 2, "last_activity_date": 1548540654, "last_edit_date": 1548540654, "creation_date": 1548415204, "answer_id": 54364296, "question_id": 34547937, "link": "https://stackoverflow.com/questions/34547937/haskell-import-qualified-and-not-in-scope-data-constructor/54364296#54364296", "title": "Haskell &quot;import qualified&quot; and &quot;Not in scope: data constructor&quot;", "body": "<p>Let's imagine we need a <code>Geometry.Shape</code> module for operations on a shapes. First, we'll make a folder called <code>Geometry</code>. Mind the capital <code>G</code>. In it, we'll place the <code>Shape.hs</code> file. Here's what the file will contain:</p>\n\n<pre><code>module Geometry.Shape\n  ( Shape(Circle,Rectangle)\n  , Point\n  ) where\n\ndata Point = Point Float Float deriving (Show)\ndata Shape = Circle Point Float | Rectangle Point Point deriving (Show)\n</code></pre>\n\n<p><em>Notice that when defining a point, we used the same name for the data type and the value constructor.</em> </p>\n\n<p>So let's assume that we need the <code>Geometry</code> module for various geometric calculations. We will create the <code>Geometry.hs</code> file and place it at the same level as the <code>Geometry</code> directory:</p>\n\n<pre><code>module Geometry (area) where\n\nimport qualified Geometry.Shape as Shape\n\narea :: Shape.Shape -&gt; Float\narea (Shape.Circle _ r) = pi * r ^ 2\narea (Shape.Rectangle (Shape.Point x1 y1) (Shape.Point x2 y2)) =\n    (abs $ x2 - x1) * (abs $ y2 - y1)\n</code></pre>\n\n<p>The file structure should now look like this:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 Geometry\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Shape.hs\n\u2514\u2500\u2500 Geometry.hs\n</code></pre>\n\n<p>Well, let's check our <code>area</code> function. First we need to open GHCi in the same directory as the <code>Geometry.hs</code> file.</p>\n\n<pre><code>$ ghci\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt;\n</code></pre>\n\n<p>Then let's load <code>Geometry</code> module:</p>\n\n<pre><code>Prelude&gt; :l Geometry.hs\n[1 of 2] Compiling Geometry.Shape   ( Geometry/Shape.hs, interpreted )\n[2 of 2] Compiling Geometry         ( Geometry.hs, interpreted )\n\nGeometry.hs:7:24: Not in scope: data constructor \u2018Shape.Point\u2019\n\nGeometry.hs:7:44: Not in scope: data constructor \u2018Shape.Point\u2019\nFailed, modules loaded: Geometry.Shape.\n</code></pre>\n\n<p>Oops! Something went wrong. But wait! Look again at the error message:</p>\n\n<blockquote>\n  <p>Not in scope: data constructor \u2018Shape.Point\u2019 </p>\n</blockquote>\n\n<p>Well, simply speaking, it means that the type constructor is not in the reachable scope. So let's fix it by changing the <code>Shape.hs</code> file as follows:</p>\n\n<pre><code>module Geometry.Shape\n  ( Shape(Circle,Rectangle)\n  , Point(..)\n  ) where\n</code></pre>\n\n<p>Notice we changed <code>Point</code> to <code>Point(..)</code>. Reload module as follows:</p>\n\n<pre><code>Prelude&gt; :r\n[1 of 2] Compiling Geometry.Shape   ( Geometry/Shape.hs, interpreted )\n[2 of 2] Compiling Geometry         ( Geometry.hs, interpreted )\nOk, modules loaded: Geometry, Geometry.Shape.\n</code></pre>\n\n<p>and test it:</p>\n\n<pre><code>Prelude&gt; area (Shape.Circle (Shape.Point 0 0) 24)\n1809.5574\n</code></pre>\n\n<p>Yay, it works! I want to draw your attention to the fact that we used <code>(..)</code> to import all the constructors of the <code>Point</code> data type. It's the same as writing <code>Point (Point)</code>. Similarly, we could use <code>Shape(..)</code> instead of <code>Shape(Circle,Rectangle)</code>. For more see: <a href=\"https://www.haskell.org/tutorial/modules.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/tutorial/modules.html</a></p>\n\n<p>Not exporting the value constructors of a data types makes them more abstract in such a way that we hide their implementation. Also, whoever uses our module can't pattern match against the value constructors. This is why previously we get compilation error in the <code>Geometry</code> module.</p>\n\n<p>I hope this example will help you understand the reason for such errors. </p>\n"}], "owner": {"reputation": 287, "user_id": 3191372, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jqFzX.jpg?s=128&g=1", "display_name": "Thibaud Dauce", "link": "https://stackoverflow.com/users/3191372/thibaud-dauce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2189, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1548540654, "creation_date": 1451573032, "last_edit_date": 1453173471, "question_id": 34547937, "link": "https://stackoverflow.com/questions/34547937/haskell-import-qualified-and-not-in-scope-data-constructor", "title": "Haskell &quot;import qualified&quot; and &quot;Not in scope: data constructor&quot;", "body": "<p>I have an import like this:</p>\n\n<pre><code>import qualified Bioinformatics.DNA as DNA\n</code></pre>\n\n<p>from an other file looking like this:</p>\n\n<pre><code>data DNA = A | C | G | T\n    deriving (Eq, Ord, Show)\n</code></pre>\n\n<p>And in this function in the module RNA where:</p>\n\n<pre><code>module Bioinformatics.RNA\n  ( RNA\n  , fromDna\n  ) where\n\nimport qualified Bioinformatics.DNA as DNA\n\ndata RNA = A | C | G | U\n    deriving (Eq, Ord, Show)\n\nfromDna :: DNA.DNA -&gt; RNA\nfromDna DNA.A = A\nfromDna DNA.C = C\nfromDna DNA.G = G\nfromDna DNA.T = U\n</code></pre>\n\n<p>I receive errors:</p>\n\n<pre><code>/home/thibaud/code/bioinformatics/src/Bioinformatics/RNA.hs:46:9:\n    Not in scope: data constructor \u2018DNA.A\u2019\n\n/home/thibaud/code/bioinformatics/src/Bioinformatics/RNA.hs:47:9:\n    Not in scope: data constructor \u2018DNA.C\u2019\n\n/home/thibaud/code/bioinformatics/src/Bioinformatics/RNA.hs:48:9:\n    Not in scope: data constructor \u2018DNA.G\u2019\n\n/home/thibaud/code/bioinformatics/src/Bioinformatics/RNA.hs:49:9:\n    Not in scope: data constructor \u2018DNA.T\u2019\n</code></pre>\n\n<p>Do you have an idea why?\nThanks</p>\n"}, {"tags": ["haskell", "functional-programming", "bind", "monads", "category-theory"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 2, "creation_date": 1451570670, "post_id": 34545818, "comment_id": 56836661, "body": "The similarity is even clearer with their flipped variants: <code>(=&lt;&lt;) :: Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b</code> and <code>(&lt;=&lt;) :: (b -&gt; m c) -&gt; (a -&gt; m b) -&gt; (a -&gt; m c)</code>."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1451570886, "post_id": 34545818, "comment_id": 56836740, "body": "There&#39;s also the <code>Applicative</code> version: <code>(&lt;*&gt;) :: Applicative m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b</code> and <code>liftA2 (.) :: Applicative m =&gt; m (b -&gt; c) -&gt; m (a -&gt; b) -&gt; m (a -&gt; c)</code>"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "edited": false, "score": 0, "creation_date": 1451607142, "post_id": 34545818, "comment_id": 56847843, "body": "Your question doesn&#39;t have a real answer. Ultimately, monadic bind is what it is, no less and no more. That said, your point is completely *reasonable*\u2014it&#39;s just that instead of trying to discover a &quot;truth&quot; here, perhaps you ought to just accept that the &quot;composition&quot; analogy got you this far (which is plenty far!) and not worry about its flaws."}, {"owner": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "edited": false, "score": 1, "creation_date": 1451708184, "post_id": 34545818, "comment_id": 56868767, "body": "One way to think about it is that function application takes a value of a <i>plain type</i> and applies a function to it. Bind, on the other hand, takes a value of an <i>embellished</i> type, <code>m a</code>. This value must have been created by some embellished function (possibly <code>return</code>). So bind really composes the function that created the value with another function  (continuation). Application may be used for composition too, but it may also act on literals. Of course, a literal can be replaced with a lambda taking a unit, and then application is just simplified composition."}], "answers": [{"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1451567819, "post_id": 34546816, "comment_id": 56835629, "body": "I thought that the quote about representing function composition refers to <code>&gt;&gt;=</code>=<code>.</code> for functions as a monad instance."}, {"owner": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "edited": false, "score": 2, "creation_date": 1451569665, "post_id": 34546816, "comment_id": 56836317, "body": "I don&#39;t think it is correct to say that let bindings are sugar for lambdas in Haskell: <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-440003.12\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/haskell2010/&hellip;</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 11612, "user_id": 204218, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3ee571049ff6ff0361be53e554b877e6?s=128&d=identicon&r=PG", "display_name": "adamse", "link": "https://stackoverflow.com/users/204218/adamse"}, "edited": false, "score": 0, "creation_date": 1451572961, "post_id": 34546816, "comment_id": 56837555, "body": "@adamse: right, <code>let</code> is indeed more general than lambdas."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 23, "last_activity_date": 1451572928, "last_edit_date": 1451572928, "creation_date": 1451566445, "answer_id": 34546816, "question_id": 34545818, "link": "https://stackoverflow.com/questions/34545818/is-monad-bind-operator-closer-to-function-composition-chaining-or-functi/34546816#34546816", "title": "Is monad bind (&gt;&gt;=) operator closer to function composition (chaining) or function application?", "body": "<p>Clearly, <code>&gt;&gt;=</code> is not a way to represent <em>function composition</em>. Function composition is simply done with <code>.</code>. However, I don't think any of the articles you've read meant this, either.</p>\n\n<p>What they meant was &ldquo;upgrading&rdquo; function composition to work directly with &ldquo;monadic functions&rdquo;, i.e. functions of the form <code>a -&gt; m b</code>. The technical term for such functions is <em>Kleisli arrows</em>, and indeed they can be composed with <code>&lt;=&lt;</code> or <code>&gt;=&gt;</code>. (Alternatively, you can use the <a href=\"http://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Arrow.html#t:Kleisli\"><code>Category</code> instance</a>, then you can also compose them with <code>.</code> or <code>&gt;&gt;&gt;</code>.)</p>\n\n<p>However, talking about arrows / categories tends to be confusing especially to beginners, just like <a href=\"https://wiki.haskell.org/Point-free\">point-free definitions</a> of ordinary functions are often confusing. Luckily, Haskell allows us to express functions also in a more familiar style that focuses on the <em>results</em> of functions, rather the functions themselves as abstract morphisms<sup>&dagger;</sup>. It's done with lambda abstraction: instead of</p>\n\n<pre><code>q = h . g . f\n</code></pre>\n\n<p>you may write</p>\n\n<pre><code>q = (\\x -&gt; (\\y -&gt; (\\z -&gt; h z) (g y)) (f x))\n</code></pre>\n\n<p>...of course the preferred style would be <sup><sub>(this being only syntactic sugar for lambda abstraction!)</sub>&ddagger;</sup></p>\n\n<pre><code>q x = let y = f x\n          z = g y\n      in h z\n</code></pre>\n\n<p>Note how, in the lambda expression, basically composition was replaced by application:</p>\n\n<pre><code>q = \\x -&gt; (\\y -&gt; (\\z -&gt; h z) $ g y) $ f x\n</code></pre>\n\n<p>Adapted to Kleisli arrows, this means instead of</p>\n\n<pre><code>q = h &lt;=&lt; g &lt;=&lt; f\n</code></pre>\n\n<p>you write</p>\n\n<pre><code>q = \\x -&gt; (\\y -&gt; (\\z -&gt; h z) =&lt;&lt; g y) =&lt;&lt; f x\n</code></pre>\n\n<p>which again looks of course much nicer with flipped operators or syntactic sugar:</p>\n\n<pre><code>q x = do y &lt;- f x\n         z &lt;- g y\n         h z\n</code></pre>\n\n<p>So, indeed, <code>=&lt;&lt;</code> is to <code>&lt;=&lt;</code> like <code>$</code> is to <code>.</code>. The reason it still makes sense to call it a composition operator is that, apart from &ldquo;applying to values&rdquo;, the <code>&gt;&gt;=</code> operator also does the nontrivial bit about Kleisli arrow composition, which function composition doesn't need: joining the monadic layers.</p>\n\n<hr>\n\n<p><sup>&dagger;</sup><sub>The reason this works is that <strong>Hask</strong> is a <a href=\"https://en.wikipedia.org/wiki/Cartesian_closed_category\">cartesian closed category</a>, in particular a <a href=\"https://en.wikipedia.org/wiki/Well-pointed_category\">well-pointed category</a>. In such a category, arrows can, broadly speaking, be defined by the collection of all their results when applied to simple argument values.</sub></p>\n\n<p><sup>&ddagger;</sup><sub>@adamse remarks that <code>let</code> is not really syntactic sugar for lambda abstraction. This is particularly relevant in case of recursive definitions, which you can't directly write with a lambda. But in simple cases like this here, <code>let</code> does behave like syntactic sugar for lambdas, just like <code>do</code> notation is syntactic sugar for lambdas and <code>&gt;&gt;=</code>. (BTW, there's an extension which allows recursion <a href=\"https://wiki.haskell.org/MonadFix\">even in <code>do</code> notation</a>... it circumvents the lambda-restriction by using fixed-point combinators.)</sub></p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 19, "last_activity_date": 1587764350, "last_edit_date": 1587764350, "creation_date": 1451696740, "answer_id": 34561605, "question_id": 34545818, "link": "https://stackoverflow.com/questions/34545818/is-monad-bind-operator-closer-to-function-composition-chaining-or-functi/34561605#34561605", "title": "Is monad bind (&gt;&gt;=) operator closer to function composition (chaining) or function application?", "body": "<p>Just as an illustration, consider this:</p>\n\n<pre><code>($)                ::   (a -&gt; b) -&gt;   a -&gt;   b\nlet g=g in (g  $)  ::                 a -&gt;   b\n            g      ::   (a -&gt; b)\n                                     _____\nFunctor f =&gt;                        /     \\\n(&lt;$&gt;)              ::   (a -&gt; b) -&gt; f a -&gt; f b\nlet g=g in (g &lt;$&gt;) ::               f a -&gt; f b\n            g      ::   (a -&gt; b) \n                       ___________________\nApplicative f =&gt;      /             /     \\\n(&lt;*&gt;)              :: f (a -&gt; b) -&gt; f a -&gt; f b\nlet h=h in (h &lt;*&gt;) ::               f a -&gt; f b\n            h      :: f (a -&gt; b)\n                             _____________\nMonad m =&gt;                  /.------.     \\\n(=&lt;&lt;)              :: (a -&gt; m b) -&gt; m a -&gt; m b\nlet k=k in (k =&lt;&lt;) ::               m a -&gt; m b\n            k      :: (a -&gt; m b)\n</code></pre>\n\n<p>So yes, each one of those, <code>(g &lt;$&gt;)</code>, <code>(h &lt;*&gt;)</code> or <code>(k =&lt;&lt;)</code>, is some kind of a function application, promoted into either Functor, Applicative Functor, or a Monad \"context\". And <code>(g $)</code> is just a regular kind of application of a regular kind of function.</p>\n\n<p>With Functors, functions have no influence on the <code>f</code> component of the overall <em>thing</em>. They work strictly on the inside and can't influence the <em>\"wrapping\"</em>.</p>\n\n<p>With Applicatives, the functions come wrapped in an <code>f</code>, which wrapping combines with that of an argument (as part of the application) to produce the wrapping of the result. </p>\n\n<p>With Monads, functions themselves now produce the wrapped results, pulling their arguments somehow from the wrapped argument (as part of the application). </p>\n\n<p>We can see the three operators as some kind of a marking on a function, like mathematicians like to write say <code>f'</code> or <code>f^</code> or <code>f*</code> (and in the original work by Eugenio Moggi<sup>(1)</sup> <code>f*</code> is exactly what was used, denoting the promoted function <code>(f =&lt;&lt;)</code>).</p>\n\n<p>And of course, with the promoted functions <code>:: f a -&gt; f b</code>, we get to chain them, because now the types line up. The promotion is what allows the composition.</p>\n\n<hr>\n\n<p><sup>(1)</sup> \"Notions of computation and monads\", Eugenio Moggi, July 1991.</p>\n\n<ul>\n<li>more about compositionality, with a picture: <a href=\"https://stackoverflow.com/questions/11234632/monads-with-join-instead-of-bind/11249714#11249714\">Monads with Join() instead of Bind()</a></li>\n</ul>\n\n<hr>\n\n<p>So the functor is \"magically working inside\" \"the pipes\"; applicative is \"prefabricated pipes built from components in advance\"; and monads are \"building pipe networks as we go\". An illustration:</p>\n\n<p><a href=\"https://i.stack.imgur.com/TBhBu.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/TBhBu.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 1397, "user_id": 3975711, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/756de1bfefa4329d2d23dd5975c24306?s=128&d=identicon&r=PG&f=1", "display_name": "Sergii Vorobei", "link": "https://stackoverflow.com/users/3975711/sergii-vorobei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3475, "favorite_count": 10, "accepted_answer_id": 34546816, "answer_count": 2, "score": 24, "last_activity_date": 1587764350, "creation_date": 1451561340, "question_id": 34545818, "link": "https://stackoverflow.com/questions/34545818/is-monad-bind-operator-closer-to-function-composition-chaining-or-functi", "title": "Is monad bind (&gt;&gt;=) operator closer to function composition (chaining) or function application?", "body": "<p>In many articles I have read that monad <code>&gt;&gt;=</code> operator is a way to represent function composition. But for me it is closer to some kind of advanced function application</p>\n\n<pre><code>($)   :: (a -&gt; b) -&gt; a -&gt; b\n(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>For composition we have</p>\n\n<pre><code>(.)   :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n(&gt;=&gt;) :: Monad m =&gt; (a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c\n</code></pre>\n\n<p>Please clarify.</p>\n"}, {"tags": ["haskell", "type-families", "higher-order-types"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1451552075, "post_id": 34543660, "comment_id": 56829006, "body": "Good question. The main reason is (2).  For example, you can&#39;t pass a partially-applied type family to another type family, which would be very powerful and create undecidability.  You can only pattern match on type constructors, which are never reducible."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1451552922, "post_id": 34543660, "comment_id": 56829346, "body": "Thanks luqui, could you please explain this in more detail ? I don&#39;t really understand what you mean by reducible."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 4, "creation_date": 1451554372, "post_id": 34543660, "comment_id": 56829971, "body": "&quot;Pattern matching&quot; on types works by unification - unifying two types is a decidable procedure, types are simply compared structurally and then nominally to decide if they are equal. Value level functions, on the other hand, have no such procedure for deducing if they are equal (except comparing all inputs and outputs - which is much too slow to be even close to practical). If you declare two identical Maybe types, the compiler will insist they are distinct (rightfully so) but in the hypothetical world with function equality, this would probably be very unexpected behaviour."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1451556366, "post_id": 34543660, "comment_id": 56830874, "body": "Many thanks, this does clarify a lot of things."}], "answers": [{"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1451556493, "post_id": 34544551, "comment_id": 56830926, "body": "This is a very nice analogy, thanks for the answer chi !"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1451556617, "last_edit_date": 1451556617, "creation_date": 1451555755, "answer_id": 34544551, "question_id": 34543660, "link": "https://stackoverflow.com/questions/34543660/pattern-match-on-functions-on-the-type-level-is-possible-but-not-on-the-value-l/34544551#34544551", "title": "Pattern match on functions on the type level is possible, but not on the value level, why is this difference?", "body": "<p>Briefly put, there is no pattern matching on type-level function <em>values</em>, but only on their <em>name</em>.</p>\n\n<p>In Haskell, as in many other languages, types are kept apart by their name, even if their representation is identical.</p>\n\n<pre><code>data A x = A Int x\ndata B x = B Int x\n</code></pre>\n\n<p>Above, <code>A</code> and <code>B</code> are two different type constructors, even if they describe the same type-level function: in pseudo-code <code>\\x -&gt; (Int, x)</code>, roughly.\nIn a sense, these two identical type-level functions have a different name/identity.</p>\n\n<p>This is different from</p>\n\n<pre><code>type C x = (Int, x)\ntype D x = (Int, x)\n</code></pre>\n\n<p>which both describe the same type-level function as above, but do not introduce two new type names. The above are just synonyms: they denote a function, but do not have their own distinct identity.</p>\n\n<p>This is why one can add a class instance for <code>A x</code> or <code>B x</code>, but not for <code>C x</code> or <code>D x</code>: attempting to do the latter would add an instance to the type <code>(Int, x)</code> instead, relating the instance to the type names <code>(,)</code>, <code>Int</code> instead.</p>\n\n<p>At the value level, the situation is not so much different. Indeed, there we have value constructors, which are special functions with a name/identity, and regular functions without an actual identity. We can pattern match against a <em>pattern</em>, built from constructors, but not against anything else</p>\n\n<pre><code>case expOfTypeA   of A n t -&gt; ... -- ok\ncase someFunction of succ -&gt; ...  -- no\n</code></pre>\n\n<p>Note that at the type level we can't do pattern matching that easily. Haskell allows to do that exploiting type classes, only. This is done to preserve some theoretical properties (parametricity), and to allow an efficient implementation as well (allowing type erasure -- we do not have to tag every value with its type at runtime). These features come at the price of restricting type-level pattern matching to type classes -- this does put some burden on the programmer, but the benefits outweigh the drawbacks.</p>\n"}, {"comments": [{"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1451567629, "post_id": 34544817, "comment_id": 56835570, "body": "Many thanks for the answer Roman, I wonder if the first example, <code>IsF</code> would work if you were to use <code>data family</code> ?"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1451568634, "post_id": 34544817, "comment_id": 56835903, "body": "Also, is  the &quot;term&quot; <code>True</code> - in the first example - in line <code>IsF F = True</code> a type with the kind <code>Bool</code> created by the <code>-XDataKinds</code> extension ? What extensions do I need to enable if I wish to compile the code examples in your answer ? I suspect <code>DataKinds</code> is among them, right?"}, {"owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "reply_to_user": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1451569325, "post_id": 34544817, "comment_id": 56836174, "body": "Yes, data families are generative, so that&#39;d make the difference. You&#39;re also right about DataKinds, they are used here to promote things like Bool, Just, and Left to kind/type-level. I&#39;ve added a preamble with extensions and imports."}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1451581697, "post_id": 34544817, "comment_id": 56841057, "body": "Many thanks Roman ! Happy New Year to You and to every reader of this comment :)"}], "tags": [], "owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "is_accepted": false, "score": 7, "last_activity_date": 1451569300, "last_edit_date": 1451569300, "creation_date": 1451556945, "answer_id": 34544817, "question_id": 34543660, "link": "https://stackoverflow.com/questions/34543660/pattern-match-on-functions-on-the-type-level-is-possible-but-not-on-the-value-l/34544817#34544817", "title": "Pattern match on functions on the type level is possible, but not on the value level, why is this difference?", "body": "<pre><code>{-# LANGUAGE TypeFamilies, DataKinds, PolyKinds #-}\nimport GHC.TypeLits\n</code></pre>\n\n<p>Let's draw some parallels between the type and value level in Haskell.</p>\n\n<p><strong>First</strong>, we have unrestricted functions on both type and value level. On the type level, you can express almost anything using type families. You <em>cannot</em> pattern match on arbitrary functions on either type or value level. E.g. you can't say</p>\n\n<pre><code>type family F (a :: *) :: *\ntype family IsF  (f :: * -&gt; *) :: Bool where\n  IsF F = True\n  IsF notF = False\n\n-- Illegal type synonym family application in instance: F\n-- In the equations for closed type family \u2018IsF\u2019\n-- In the type family declaration for \u2018IsF\u2019\n</code></pre>\n\n<p><strong>Second</strong>, we have fully applied data and type constructors, such as <code>Just 5 :: Maybe Integer</code> on the value level or <code>Just 5 :: Maybe Nat</code> on the type level.</p>\n\n<p>It is possible to pattern match on these:</p>\n\n<pre><code>isJust5 :: Maybe Integer -&gt; Bool\nisJust5 (Just 5) = True\nisJust5 _ = False\n\ntype family IsJust5 (x :: Maybe Nat) :: Bool where\n  IsJust5 (Just 5) = True\n  IsJust5 x = False\n</code></pre>\n\n<p>Note the difference between arbitrary functions and type/data <em>constructors</em>. The property of constructors is sometimes called <em>generativity</em>. For two different functions <code>f</code> and <code>g</code>, it very well may be possible that <code>f x = g x</code> for some <code>x</code>. On the other hand, for constructors, <code>f x = g x</code> implies <code>f = g</code>. This difference makes the first case (pattern-matching on arbitrary functions) undecidable, and the second case (pattern-matching on fully applied constructors) decidable and tractable.</p>\n\n<p>So far we have seen consistency across the type and value level.</p>\n\n<p><strong>Finally</strong>, we have partially applied (including un-applied) constructors. On the type level, these include <code>Maybe</code>, <code>IO</code>, and <code>[]</code> (unapplied), as well as <code>Either String</code> and <code>(,) Int</code> (partially applied). On the value level, we have unapplied <code>Just</code> and <code>Left</code>, and partially applied <code>(,) 5</code> and <code>(:) True</code>.</p>\n\n<p>The generativity condition doesn't care whether the application is full or not; so there's nothing precluding pattern matching for partially applied constructors. That's what you see on the type level; and we <em>could</em> have it on the value level, too.</p>\n\n<pre><code>type family IsLeft (x :: k -&gt; k1) :: Bool where\n  IsLeft Left = True\n  IsLeft x = False\n\nisLeft :: (a -&gt; Either a b) -&gt; Bool\nisLeft Left = True\nisLeft _ = False\n-- Constructor \u2018Left\u2019 should have 1 argument, but has been given none\n-- In the pattern: Left\n-- In an equation for \u2018isLeft\u2019: isLeft Left = True\n</code></pre>\n\n<p>The reason this is not supported is efficiency. Computations on the type level\nare carried out during compile time in interpreted mode; so we can afford to\ncarry around lots of metadata about types and type functions to pattern match on\nthem.</p>\n\n<p>Computations on the value level are compiled, and need to be as fast as\npossible. Keeping enough metadata to support pattern matching on partially\napplied constructors would complicate the compiler and slow down the program at\nruntime; it's just too much to pay for such an exotic feature.</p>\n"}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 726, "favorite_count": 1, "accepted_answer_id": 34544551, "answer_count": 2, "score": 8, "last_activity_date": 1451569300, "creation_date": 1451551702, "last_edit_date": 1495541042, "question_id": 34543660, "link": "https://stackoverflow.com/questions/34543660/pattern-match-on-functions-on-the-type-level-is-possible-but-not-on-the-value-l", "title": "Pattern match on functions on the type level is possible, but not on the value level, why is this difference?", "body": "<p>In <a href=\"http://research.microsoft.com/en-us/um/people/simonpj/papers/assoc-types/fun-with-type-funs/typefun.pdf\" rel=\"nofollow noreferrer\">this</a> paper by SPJ, on page 3 and 4, it is written:</p>\n\n<pre><code>class Mutation m where\n  type Ref m :: * -&gt; *\n  newRef :: a -&gt; m (Ref m a)\n  readRef :: Ref m a -&gt; m a\n  writeRef :: Ref m a -&gt; a -&gt; m ()\n\ninstance Mutation IO where\n  type Ref IO = IORef\n  newRef = newIORef\n  readRef = readIORef\n  writeRef = writeIORef\n\ninstance Mutation (ST s) where\n  type Ref (ST s) = STRef s\n  newRef = newSTRef\n  readRef = readSTRef\n  writeRef = writeSTRef\n</code></pre>\n\n<p>and:</p>\n\n<blockquote>\n  <p>The class declaration now introduces a type function Ref (with a\n  specified kind) alongside the usual value functions such as newRef\n  (each with a specified type). Similarly, each instance declaration\n  contributes a clause defining the type function at the instance type\n  alongside a witness for each value function. </p>\n  \n  <p>We say that Ref is a type\n  family, or an associated type of the class Mutation. It behaves like a\n  <strong>function at the type level</strong>, so we also call Ref a type function.\n  Applying a type function uses the same syntax as applying a type\n  constructor: Ref m a above means to apply the type function Ref to m,\n  then apply the resulting type constructor to a.</p>\n</blockquote>\n\n<p>So, in other words,</p>\n\n<p><code>Ref :: (*-&gt;*)-&gt;*-&gt;*</code></p>\n\n<p>that is, <code>Ref</code> takes a type level function as argument, like <code>Maybe</code> or <code>IO</code> or <code>[]</code> and produces another type level function, such as <code>IORef</code> using a <strong>pattern match</strong>,i.e. <code>Ref</code> is defined by a <strong>pattern match</strong>.</p>\n\n<p>So, how is it possible that it is possible to pattern match on functions at the type level but not on the value level ?</p>\n\n<p>For example, </p>\n\n<pre><code>fun2int:: (Int-&gt;Int)-&gt;Int\nfun2int (+)=2\nfun2int (*)=3\n</code></pre>\n\n<p>is not possible to write because equality on functions is <a href=\"https://stackoverflow.com/questions/1132051/is-finding-the-equivalence-of-two-functions-undecidable\">undecidable</a>. </p>\n\n<p>1) So how is it possible that on the type level this causes no problem ?</p>\n\n<p>2) Is it because the functions on the type level are of very restricted sort ? So not any kind of function on the type level can be an argument to <code>Ref</code>, only a selected few, namely the ones declared by the programmer and not functions like (+), which are more general than the ones declared by the programmer ? Is this the reason why on the type level function pattern match causes no problem ? </p>\n\n<p>3) Is the answer to this question related to <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/type-families.html#type-family-decidability\" rel=\"nofollow noreferrer\">this</a> part of the GHC spec?</p>\n"}, {"tags": ["c++", "haskell", "bison"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1451533946, "post_id": 34540653, "comment_id": 56823558, "body": "I&#39;m not at all sure I understand what your problems are.  I don&#39;t understand where you added the semicolon and how that resolved some problems.  A single recursive rule sounds like an unusual language; most languages end up with many recursive rules.  You can have the parser provide feedback to the lexical analyzer; indeed, languages such as C, where <code>typedef</code> changes an identifier from being a mere identifier into an alias for a type name, is a classic example.  That tends to be a fairly limited &#39;two-way communication&#39; though.  Maybe you should show us some code that represents your problem."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 1, "creation_date": 1451535478, "post_id": 34540653, "comment_id": 56823850, "body": "Push parsers are only available with the C api. (<a href=\"https://www.gnu.org/software/bison/manual/html_node/_0025define-Summary.html#index-_0025define-api_002epush_002dpull-1\" rel=\"nofollow noreferrer\">gnu.org/software/bison/manual/html_node/&hellip;</a> : &quot;Language(s): C&quot;). To parse indentation-aware languages, you usually need to synthesize INDENT and DEDENT tokens, which definitely is easier with a push interface, but it can be done with the pull interface and a small queue."}, {"owner": {"reputation": 4143, "user_id": 400048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/c8282b525f39ea9cb9e1c2d78474339a?s=128&d=identicon&r=PG", "display_name": "zcourts", "link": "https://stackoverflow.com/users/400048/zcourts"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1451536924, "post_id": 34540653, "comment_id": 56824198, "body": "@rici thanks, I overlooked the language in the docs."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1451537357, "post_id": 34540653, "comment_id": 56824319, "body": "I don&#39;t think the so-called lexer hack is relevant here. Whether or not a line ending is necessary at that point is not semantic, so sharing semantic information like the symbol table between lexer and parser (though it is easy enough to do) is not going to help. I&#39;ve never tried a haskell parser -- perhaps I should -- but it sounds somewhat similar to the javascript algorithm, which can be solved by constructing a dictionary of token pairs; if two consecutive tokens are separated by a newline, the pair is looked up in the dictionary and a semicolon inserted if the pair is found..."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1451537422, "post_id": 34540653, "comment_id": 56824335, "body": "... if that helps, I can add it to the answer. (The dictionary of pairs is constructed at parser build time by analysis of FIRST and FOLLOW sets, with a small amount of manual intervention to cope with some other javascript rules.)"}, {"owner": {"reputation": 4143, "user_id": 400048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/c8282b525f39ea9cb9e1c2d78474339a?s=128&d=identicon&r=PG", "display_name": "zcourts", "link": "https://stackoverflow.com/users/400048/zcourts"}, "edited": false, "score": 0, "creation_date": 1451537972, "post_id": 34540653, "comment_id": 56824492, "body": "Please go ahead and add it - I&#39;d be interested to see"}], "answers": [{"comments": [{"owner": {"reputation": 4143, "user_id": 400048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/c8282b525f39ea9cb9e1c2d78474339a?s=128&d=identicon&r=PG", "display_name": "zcourts", "link": "https://stackoverflow.com/users/400048/zcourts"}, "edited": false, "score": 0, "creation_date": 1451537799, "post_id": 34541055, "comment_id": 56824432, "body": "Interesting approach - I know Python, I&#39;ll have a go at this in the morning."}, {"owner": {"reputation": 4143, "user_id": 400048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/c8282b525f39ea9cb9e1c2d78474339a?s=128&d=identicon&r=PG", "display_name": "zcourts", "link": "https://stackoverflow.com/users/400048/zcourts"}, "edited": false, "score": 0, "creation_date": 1451569661, "post_id": 34541055, "comment_id": 56836315, "body": "Read the python answer linked. Layout tracker I have already does that and quite a bit more to handle special cases. In my case I create a stack of <code>Block</code>s and record the token that created it, position, whether its inside a <code>do</code> (where layout rules change), if it&#39;s virtual (virtual block doesn&#39;t insert braces but expressions created in it do and when the virtual block ends it needs to close all the nested blocks within it e.g. inside lists,list comprehensions, or tuples which can have arbitrary expressions). The dictionary idea sounds promising though, I&#39;ll have a go after work today and see"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 4143, "user_id": 400048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/c8282b525f39ea9cb9e1c2d78474339a?s=128&d=identicon&r=PG", "display_name": "zcourts", "link": "https://stackoverflow.com/users/400048/zcourts"}, "edited": false, "score": 0, "creation_date": 1451595279, "post_id": 34541055, "comment_id": 56845374, "body": "@zcourts: Yeah, I took a closer look at the Haskell language spec and I&#39;ll rewrite my answer in light of that. But not right now :) The wording in the Haskell2010 report is more promising since it specifies roughly the same rule as ecmascript uses, i.e. automatic insertion only if the next token cannot extend a valid prefix, which as I read it means that you don&#39;t need to run the fixity algorithm to decide, making it actually potentially solvable. I don&#39;t know if you can reduce that condition to a small window, as you can in ecmascript, but it may well be &quot;close enough&quot;."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 4143, "user_id": 400048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/c8282b525f39ea9cb9e1c2d78474339a?s=128&d=identicon&r=PG", "display_name": "zcourts", "link": "https://stackoverflow.com/users/400048/zcourts"}, "edited": false, "score": 0, "creation_date": 1451597331, "post_id": 34541055, "comment_id": 56845842, "body": "@zcourts: Also, I&#39;m pretty sure that the reduce/reduce conflict is not at all related to layout-aware parsing, so that was a bit of a red herring. Although it&#39;s probably my fault; I reread your question and I&#39;m not sure whether or not you were assuming that; it seems that you are just looking for a similar way to insert a semicolon to avoid the R/R conflict. Anyway, I&#39;ll take another look later if I get a chance."}, {"owner": {"reputation": 4143, "user_id": 400048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/c8282b525f39ea9cb9e1c2d78474339a?s=128&d=identicon&r=PG", "display_name": "zcourts", "link": "https://stackoverflow.com/users/400048/zcourts"}, "edited": false, "score": 0, "creation_date": 1451757615, "post_id": 34541055, "comment_id": 56882138, "body": "I just had a go at the dictionary approach, ended up with 89 permutations. The problem with the tokens in the dictionary is that many of those permutations also occur in a large number of other situations where ; isn&#39;t appropriate. Why do you suspect this was a red herring? I&#39;ll update the post with a pastebin to the debug info with the conflicts."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 4143, "user_id": 400048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/c8282b525f39ea9cb9e1c2d78474339a?s=128&d=identicon&r=PG", "display_name": "zcourts", "link": "https://stackoverflow.com/users/400048/zcourts"}, "edited": false, "score": 0, "creation_date": 1451762049, "post_id": 34541055, "comment_id": 56883727, "body": "@zcourts: Because a shift/reduce conflict is (somewhat) expected. (&quot;The grammar is ambiguous regarding the extent of lambda abstractions, let expressions, and conditionals. The ambiguity is resolved by the meta-rule that each of these constructs extends as far to the right as possible.&quot;) I still haven&#39;t read the entire report, the holidays got in the way. But that quote indicates an expected s/r conflict. My hunch is that the r/r conflict comes from something parsed as one non-terminal at the beginning of an expr and as a different one at the end. I know that&#39;s hand-wavy, and ..."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 4143, "user_id": 400048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/c8282b525f39ea9cb9e1c2d78474339a?s=128&d=identicon&r=PG", "display_name": "zcourts", "link": "https://stackoverflow.com/users/400048/zcourts"}, "edited": false, "score": 0, "creation_date": 1451762069, "post_id": 34541055, "comment_id": 56883735, "body": "... I might have some time to get more involved in it this weekend."}], "tags": [], "owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "is_accepted": true, "score": 2, "last_activity_date": 1451539471, "last_edit_date": 1495535303, "creation_date": 1451536501, "answer_id": 34541055, "question_id": 34540653, "link": "https://stackoverflow.com/questions/34540653/bison-get-next-possible-tokens-or-determine-which-rule-is-being-attempted/34541055#34541055", "title": "Bison get next possible tokens or determine which rule is being attempted", "body": "<p>The usual way to handle indentation-aware languages is to fabricate INDENT and DEDENT tokens in the lexical scanner. That's easier with a push interface, so it's unfortunate that you are using the bison C++ API which does not implement that feature.</p>\n\n<p>But it can also be done without too much trouble using a shim in between the lexical scanner and the parser. You can see an example of a Python shim in <a href=\"https://stackoverflow.com/a/28260482/1566221\">this answer</a>; <code>ply</code> doesn't offer a push parser interface either, so the shim keeps a small persistent queue of tokens which will be sent to the parser and checks that queue before asking the real lexical scanner for the next token.</p>\n\n<p>As that answer indicates, in most layout-aware languages not all newlines are actually semantically significant. For example, in Python itself a newline inside parentheses, braces or brackets is just ordinary whitespace. That rule can easily be implemented by the shim as well (although I didn't complicate the code by doing so in the linked answer), simply by tracking the level of parentheses. </p>\n\n<p>Not all languages make life so easy; you may have a language in which indentation could reassert itself inside a bracketed list because of the presence of a function literal, for example. Or you may have a language like ecmascript where the semi-colon insertion rule allows run-on lines even outside of parentheses, if the alternative parse would not be possible. Haskell has a similar rule, where a brace can be inserted if an alternative parse would not be possible.</p>\n\n<p>The ecmascript rule was drafted with a view to making it possible to write a parser. (Or, more accurately I think, the rule was drafted by reverse-engineering an existing parser, but I can't prove that.) As it turns out, it is possible to implement ecmascript automatic semi-colon insertion by constructing a dictionary of pairs of tokens which can be separated by a newline without a semicolon being inserted. (Or, alternatively, pairs of tokens which must have a semicolon inserted between them if possible, which is the inverse of the other set.) These sets can be constructed automatically by grammar analysis, using the FIRST and FOLLOW sets of each production. (The details of the ecmascript rules require a bit of adjustment because there are some token pairs which could appear in a valid program but which are not allowed to be separated by a newline. For example, <code>return 3</code> is a valid statement, but if the <code>return</code> is at the end of a line and the 3 is on the following line, a semicolon must be automatically inserted'). Bison does not do this analysis automatically, so it depends on a custom tool, but it is not particularly difficult.</p>\n\n<p>Haskell does not seem to be so accommodating. I see in the <a href=\"https://www.haskell.org/onlinereport/syntax-iso.html#layout\" rel=\"nofollow noreferrer\">Haskell report, section 9.3</a>, at the end of that section:</p>\n\n<blockquote>\n  <p>The parse-error rule is hard to implement in its full generality, because doing so involves fixities. For example, the expression</p>\n\n<pre><code>do a == b == c\n</code></pre>\n  \n  <p>has a single unambiguous (albeit probably type-incorrect) parse, namely</p>\n\n<pre><code>(do { a == b }) == c\n</code></pre>\n  \n  <p>because (==) is non-associative. Programmers are therefore advised to avoid writing code that requires the parser to insert a closing brace in such situations.</p>\n</blockquote>\n\n<p>That's not very promising, but it also suggests that implementations are not expected to be perfect, and that programmers are kindly requested to not expect a perfect parser implementation :)</p>\n\n<p>I think translating the <code>IndentWrapper</code> shim in the linked answer into C++ would not be difficult even for someone not too familiar with Python, so I haven't bothered doing it here. If that assumption is incorrect, let me know.</p>\n"}], "owner": {"reputation": 4143, "user_id": 400048, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/c8282b525f39ea9cb9e1c2d78474339a?s=128&d=identicon&r=PG", "display_name": "zcourts", "link": "https://stackoverflow.com/users/400048/zcourts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 283, "favorite_count": 0, "accepted_answer_id": 34541055, "answer_count": 1, "score": 0, "last_activity_date": 1451781845, "creation_date": 1451532795, "last_edit_date": 1451781845, "question_id": 34540653, "link": "https://stackoverflow.com/questions/34540653/bison-get-next-possible-tokens-or-determine-which-rule-is-being-attempted", "title": "Bison get next possible tokens or determine which rule is being attempted", "body": "<p>I'm using bison to parse a lang from a spec I don't have control over it. In its definition there is a recursive rule and since the language uses indentation this resulted in reduce/reduce errors. So to get rid of the reduce/reduce I added a semi colon. I have a layout tracker which auto inserts semi colons and braces already. I was thinking of extending the rules for inserting semi colons to support the one I added that's not in the spec but I can't think of a way of knowing when we're at the end of the recursive rule. </p>\n\n<p>Is there a reliable way of knowing when I'm at the end of the recursive rule or any suggestions on a different approach? Or as messy as it'd be is there some way to get two way comms between the parser and lexer? </p>\n\n<p>Currently using a pull parser. I thought using a push parser would enable me to keep better track of where I am in the lexer but when I try the define directive to generate a push parser the option isn't recognised.\nI'm using bison 3.0.4 with a custom lexer, generating a pure parser with the C++ api.</p>\n\n<p>EDIT:</p>\n\n<pre><code>exp                     : infixexp  TYPE_SEP  type                                                      {}                     \n                        | infixexp  TYPE_SEP  context RIGHT_ARROW type                                  {}\n                        | infixexp                                                                      {}\n\ninfixexp                : lexp qop infixexp                                                             {}    \n                        | MINUS infixexp                                                                {}      \n                        | lexp                                                                          {}\n\nlexp                    : BACKSLASH apat_list FUNC_TYPE_CONS exp                                        {}   \n                        | KW_LET decls KW_IN exp                                                        {}    \n                        | KW_IF exp SEMI_COLON KW_THEN exp SEMI_COLON KW_ELSE exp                       {}    //conditional\n                        | KW_CASE exp KW_OF L_BRACE alts R_BRACE                                        {}   \n                        | KW_DO L_BRACE stmts R_BRACE                                                   {}   \n                        | fexp SEMI_COLON                                                               {}\n\nfexp                    : aexp                                                                          {}   \n                        | fexp  aexp                                                                    {}  \n\nliteral                 : INTEGER                                                                       {}\n                        | FLOAT                                                                         {}\n                        | CHAR                                                                          {}\n                        | STRING                                                                        {}\n\naexp                    : qvar                                                                          {}  \n                        | gcon                                                                          {}   \n                        | literal\n                        | L_PAREN exp R_PAREN                                                           {}   \n                        | L_PAREN exp_list R_PAREN                                                      {}   \n                        | L_BRACKET exp R_BRACKET                                                       {}  \n                        | L_BRACKET exp_list R_BRACKET                                                  {}  \n                        | L_BRACKET exp DOTDOT R_BRACKET                                                {}  \n                        | L_BRACKET exp DOTDOT exp R_BRACKET                                            {}  \n                        | L_BRACKET exp COMMA exp DOTDOT exp R_BRACKET                                  {}  \n                        | L_BRACKET exp PIPE qual_list R_BRACKET                                        {}  \n                        | L_PAREN infixexp qop  R_PAREN                                                 {}  \n                        | L_PAREN qop infixexp R_PAREN                                                  {}   \n                        | qcon  L_BRACE fbind_list R_BRACE                                              {}   \n                        | aexp  L_BRACE fbind_list R_BRACE                                              {}   \napat                    : qvar                                                                          {}  \n                        | qvar AT_SYM  apat                                                             {}  \n                        | gcon                                                                          {}  \n                        | qcon  L_BRACE fpat_list R_BRACE                                               {}  \n                        | literal                                                                       {}\n                        | WILDCARD                                                                      {}\n                        | L_PAREN pat R_PAREN                                                           {}  \n                        | L_PAREN pat COMMA pat_list R_PAREN                                            {}  \n                        | L_BRACKET pat_list  R_BRACKET                                                 {} \n                        | TILDE apat                                                                    {}  \n</code></pre>\n\n<p>Added a section from the grammar. It's basically a modified version of the Haskell 2010 spec. The reduce/reduce conflicts were resolved by adding the semi colon after <code>fexp</code> in the definition of  <code>lexp</code>. </p>\n\n<p>I am simulating indent/dedents and inserting open and curly braces. And I was basically thinking of <a href=\"https://en.wikipedia.org/wiki/The_lexer_hack\" rel=\"nofollow\">the lexer hack</a> but couldn't figure out how to do it with Bison. And there are multiple recursive rules but only the one was causing reduce/reduce errors.</p>\n\n<p>EDIT 2:</p>\n\n<p><a href=\"http://jsfiddle.net/woygqv9w/2/show/\" rel=\"nofollow\">jsfiddle with the original reduce/reduce errors</a></p>\n"}]