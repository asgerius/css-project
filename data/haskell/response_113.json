[{"tags": ["haskell", "purescript"], "answers": [{"tags": [], "owner": {"reputation": 8635, "user_id": 41652, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/463081085388ffb3890dbcdeb64e8415?s=128&d=identicon&r=PG", "display_name": "Hugo Sereno Ferreira", "link": "https://stackoverflow.com/users/41652/hugo-sereno-ferreira"}, "is_accepted": false, "score": 1, "last_activity_date": 1489022870, "last_edit_date": 1489022870, "creation_date": 1489019505, "answer_id": 42684550, "question_id": 42684230, "link": "https://stackoverflow.com/questions/42684230/idiomatic-haskell-rle-in-purescript/42684550#42684550", "title": "Idiomatic Haskell RLE in Purescript", "body": "<p>This was my own answer so far (albeit not completely 1:1), though I don't expect to accept it:</p>\n\n<pre><code>data RleItem \u03b1 = Pair Int \u03b1 | Single \u03b1\n\nencode :: forall \u03b1. (Eq \u03b1) =&gt; List \u03b1 -&gt; List (RleItem \u03b1)\nencode Nil = Nil\nencode p@(x:_) = let s = span ((==) x) p in\n  pack (length s.init) : encode s.rest where\n    pack 0 = Single x\n    pack y = Pair y x\n\ndecode :: forall \u03b1. List (RleItem \u03b1) -&gt; List \u03b1\ndecode = (=&lt;&lt;) unpack where\n  unpack (Single x) = pure x\n  unpack (Pair y x) = replicate y x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1354, "user_id": 3027554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a52e97f946b17d363caca57df2692b0?s=128&d=identicon&r=PG&f=1", "display_name": "Christoph Hegemann", "link": "https://stackoverflow.com/users/3027554/christoph-hegemann"}, "is_accepted": true, "score": 5, "last_activity_date": 1489045348, "last_edit_date": 1489045348, "creation_date": 1489044474, "answer_id": 42689184, "question_id": 42684230, "link": "https://stackoverflow.com/questions/42684230/idiomatic-haskell-rle-in-purescript/42689184#42689184", "title": "Idiomatic Haskell RLE in Purescript", "body": "<blockquote>\n  <p>There's no [] shorthand</p>\n</blockquote>\n\n<p>In PureScript we explicitly call the type constructor <code>List</code></p>\n\n<blockquote>\n  <p>There's no (,) tuples</p>\n</blockquote>\n\n<p>In PureScript we either use the <code>Tuple</code> type, or another common pattern is to use records with descriptive names, like I did in my solution below.</p>\n\n<blockquote>\n  <p>We need to quantify polymorphic functions with an explicit forall</p>\n</blockquote>\n\n<p>yes</p>\n\n<blockquote>\n  <p>No pattern matching with cons (:) operator for the Array type</p>\n</blockquote>\n\n<p>We can pattern match on the <code>List</code> type with <code>:</code>. Pattern matching the head of an <code>Array</code> is almost never a good idea as it's very bad for performance.</p>\n\n<p>I've translated your solution into PureScript using the points mentioned above. The example can also be tried and run at: <a href=\"http://try.purescript.org/?gist=f45651a7f4d134d466d575b1c4dfb614&amp;backend=core\" rel=\"noreferrer\">http://try.purescript.org/?gist=f45651a7f4d134d466d575b1c4dfb614&amp;backend=core</a></p>\n\n<pre><code>-- Problem 10\n\nrle :: forall a. (Eq a) =&gt; List a -&gt; List {repetitions :: Int, value :: a}\nrle Nil = Nil\nrle (x:xs) = case span (_ == x) xs of\n  {init: h, rest: t} -&gt; {repetitions: length h + 1, value: x} : rle t\n\n-- Problem 11\n\ndata RleItem a = Pair Int a | Single a\n\nencode :: forall a. Eq a =&gt; List a -&gt; List (RleItem a)\nencode = map unpack &lt;&lt;&lt; rle \n   where \n    unpack = case _ of\n      {repetitions: 1, value} -&gt; Single value\n      {repetitions, value} -&gt; Pair repetitions value\n\n-- Problem 12\n\ndecode :: forall a. List (RleItem a) -&gt; List a\ndecode = concatMap unroll\n  where unroll (Pair y x) = replicate y x\n        unroll (Single x) = singleton x \n</code></pre>\n"}], "owner": {"reputation": 8635, "user_id": 41652, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/463081085388ffb3890dbcdeb64e8415?s=128&d=identicon&r=PG", "display_name": "Hugo Sereno Ferreira", "link": "https://stackoverflow.com/users/41652/hugo-sereno-ferreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 0, "accepted_answer_id": 42689184, "answer_count": 2, "score": 4, "last_activity_date": 1489045348, "creation_date": 1489017405, "last_edit_date": 1489022294, "question_id": 42684230, "link": "https://stackoverflow.com/questions/42684230/idiomatic-haskell-rle-in-purescript", "title": "Idiomatic Haskell RLE in Purescript", "body": "<p>So, I'm trying to learn Purescript by converting some Haskell code I had from the <a href=\"http://haskell%2099%20problems%20github\" rel=\"nofollow noreferrer\">99 Haskell Problems</a>, and quickly got into a situation where I know how to solve it, but it is simply <em>too ugly\u2122</em>. Here's the Haskell code for problems 10, 11 and 12; basically some RLE encode and decode functions:</p>\n\n<pre><code>-- Problem 10\n\nrle :: Eq \u03b1 =&gt; [\u03b1] -&gt; [(Int, \u03b1)]\nrle [] = []\nrle (x:xs) = let (h, t) = span (== x) xs \n              in (length h + 1, x) : rle t\n\n-- Problem 11\n\ndata RleItem \u03b1 = Pair Int \u03b1 | Single \u03b1 deriving (Show)\n\nencode :: Eq \u03b1 =&gt; [\u03b1] -&gt; [RleItem \u03b1]\nencode = map unpack . rle \n   where unpack (1, x) = Single x\n         unpack (y, x) = Pair y x\n\n-- Problem 12\n\ndecode :: [RleItem \u03b1] -&gt; [\u03b1]\ndecode = concatMap unroll\n  where unroll (Pair y x) = replicate y x\n        unroll (Single x) = [x] \n</code></pre>\n\n<p>I quickly learned that: </p>\n\n<ul>\n<li>There's no <code>[]</code> shorthand;</li>\n<li>There's no <code>(,)</code> tuples;</li>\n<li>We need to quantify polymorphic functions with an explicit <code>forall</code>;</li>\n<li>No pattern matching with <code>cons (:)</code> operator for the <code>Array</code> type;</li>\n<li>...</li>\n</ul>\n\n<p>So here's the question: <em>what is the most idiomatic way to write the above solution in Purescript</em>?</p>\n"}, {"tags": ["haskell", "ghc", "ffi"], "comments": [{"owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "edited": false, "score": 3, "creation_date": 1489019618, "post_id": 42684129, "comment_id": 72493098, "body": "Possibly relevant: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/13108\" rel=\"nofollow noreferrer\">#13108 Improve poor Access Violation reporting on Windows</a> (<a href=\"https://git.haskell.org/ghc.git/commitdiff/c13151e5ac774d38d7c5a807692851022c18fe6b\" rel=\"nofollow noreferrer\">committed</a>)."}, {"owner": {"reputation": 1998, "user_id": 79475, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a7d29c825581e5a220b2ae0c27e4cdce?s=128&d=identicon&r=PG", "display_name": "The_Ghost", "link": "https://stackoverflow.com/users/79475/the-ghost"}, "reply_to_user": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "edited": false, "score": 1, "creation_date": 1489059670, "post_id": 42684129, "comment_id": 72510922, "body": "Wow, great! Thanks!"}], "owner": {"reputation": 1998, "user_id": 79475, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a7d29c825581e5a220b2ae0c27e4cdce?s=128&d=identicon&r=PG", "display_name": "The_Ghost", "link": "https://stackoverflow.com/users/79475/the-ghost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 625, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1489016861, "creation_date": 1489016861, "question_id": 42684129, "link": "https://stackoverflow.com/questions/42684129/disable-segmentation-fault-access-violation-in-generated-code", "title": "Disable &quot;Segmentation fault/access violation in generated code&quot;?", "body": "<p>We're using FFI to call potentially unsafe C functions. Sometimes bugs in such functions made our Haskell code that is using them to popup \"Segmentation fault/access violation in generated code\" message in the console. Under Windows I cannot do anything with that. I cannot see the source of the problem.</p>\n\n<p>Is there a way to disable that message so the unhandled exception propagate to the OS, so we could catch it and see which C-compiled DLL on the call chain gives the error and where there?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1488995024, "post_id": 42678254, "comment_id": 72480948, "body": "What do you mean with <i>define <code>Succ</code> and <code>Zero</code></i>? You defined them in your file..."}, {"owner": {"reputation": 3, "user_id": 7679871, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ZMYW.jpg?s=128&g=1", "display_name": "learninghaskell", "link": "https://stackoverflow.com/users/7679871/learninghaskell"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1488995109, "post_id": 42678254, "comment_id": 72481004, "body": "@WillemVanOnsem I think they&#39;re being interpreted as strings."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1488995218, "post_id": 42678254, "comment_id": 72481061, "body": "No, you defined them as: <code>data Nat = Zero | Succ Nat</code>. Since <code>Nat</code> is deriving from <code>Show</code>, you convert them to a string with <code>show (Succ Nat)</code> for instance. You can also derive from <code>Read</code> such that you are able to parse <code>&quot;Succ Zero&quot;</code> into <code>Succ Zero</code>."}, {"owner": {"reputation": 3, "user_id": 7679871, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ZMYW.jpg?s=128&g=1", "display_name": "learninghaskell", "link": "https://stackoverflow.com/users/7679871/learninghaskell"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1488995344, "post_id": 42678254, "comment_id": 72481153, "body": "@WillemVanOnsem But I want Zero to equal 0."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1488995426, "post_id": 42678254, "comment_id": 72481202, "body": "you have to define <code>show</code> yourself then."}, {"owner": {"reputation": 3, "user_id": 7679871, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ZMYW.jpg?s=128&g=1", "display_name": "learninghaskell", "link": "https://stackoverflow.com/users/7679871/learninghaskell"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1488995762, "post_id": 42678254, "comment_id": 72481413, "body": "@karakfa I don&#39;t get how to do that.<code>Instance Show Nat where</code> <code>Zero = 0</code> <code>Succ n = -- ?</code>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1488996323, "post_id": 42678254, "comment_id": 72481722, "body": "Yup, that&#39;s about it. I recommend you first implement <code>div</code> and <code>mod</code> operations, that makes the <code>Show</code> instance much easier. (Or you \u201ccheat\u201d by converting to standard <code>Integer</code> before showing.)"}, {"owner": {"reputation": 3, "user_id": 7679871, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ZMYW.jpg?s=128&g=1", "display_name": "learninghaskell", "link": "https://stackoverflow.com/users/7679871/learninghaskell"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1488996739, "post_id": 42678254, "comment_id": 72481943, "body": "@leftaroundabout Wouldn&#39;t implementing <code>div</code> and <code>mod</code> mean I&#39;d have to change my addition, multiplication and exponentiation functions, too?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1488997038, "post_id": 42678254, "comment_id": 72482133, "body": "If you want <code>Succ (Succ ... (Succ Zero))</code> to be written in decimal form, it&#39;s easier if you &quot;cheat&quot; and convert that to <code>Integer</code> before printing, as leftaroundabout suggests. Writing division/modulo operations for your unary numbers is feasible, but longish. (And no, you don&#39;t need to change what you have already written) I&#39;d go for a custom <code>toInteger</code> function."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7679871, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ZMYW.jpg?s=128&g=1", "display_name": "learninghaskell", "link": "https://stackoverflow.com/users/7679871/learninghaskell"}, "edited": false, "score": 0, "creation_date": 1488998572, "post_id": 42679030, "comment_id": 72483049, "body": "I definitely mean the third case, I&#39;ll try implementing that."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1489007961, "post_id": 42679030, "comment_id": 72488308, "body": "The third point leaves me wishing <code>Num</code> was split into a hierarchy with a <code>SemiRing</code>. Something like <code>class SemiGroup a where { zero :: a, (+) :: a -&gt; a -&gt; a }</code>, <code>class SemiGroup a =&gt; Group a where { negate :: a -&gt; a, (-) :: a -&gt; a -&gt; a }</code>, <code>class SemiGroup a =&gt; SemiRing a where { one :: a, (*) :: a -&gt; a -&gt; a }</code>, <code>class (SemiRing a, Group a) =&gt; Ring a where { fromInteger :: Integer -&gt; a }</code>, <code>class Ring a =&gt; IntegralDomain a where { div :: a -&gt; a -&gt; a }</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1489013584, "post_id": 42679030, "comment_id": 72491021, "body": "@Alec There&#39;s always <a href=\"https://hackage.haskell.org/package/numeric-prelude\" rel=\"nofollow noreferrer\">numeric-prelude</a> for when you want to discover just how painful a properly fine-grained class hierarchy can be."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1489013725, "post_id": 42679030, "comment_id": 72491070, "body": "@DanielWagner Yeah - especially with every class named <code>C</code>. But even they don&#39;t have <code>SemiRing</code>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1488997456, "last_edit_date": 1495541373, "creation_date": 1488997456, "answer_id": 42679030, "question_id": 42678254, "link": "https://stackoverflow.com/questions/42678254/trouble-implementing-natural-number-arithmetic-from-scratch/42679030#42679030", "title": "Trouble implementing Natural Number Arithmetic from scratch", "body": "<blockquote>\n  <p>But I want Zero to equal 0</p>\n</blockquote>\n\n<p>The underlying issue is what you mean by \"I want <code>Zero</code> to equal <code>0</code>\". One literal reading of that might be \"I want <code>Zero == (0 :: Integer)</code>\", but that's impossible, as <code>Zero</code> and <code>0 :: Integer</code> have different types -- your <code>Zero</code> is really its own thing. Nothing stops you, of course, from defining functions that interconvert between them:</p>\n\n<pre><code>natToInteger :: Nat -&gt; Integer\nintegerToNat :: Integer -&gt; Maybe Nat\n</code></pre>\n\n<p>On the other hand, if you just want GHCi to print <code>Zero</code> as \"0\"...</p>\n\n<pre><code>GHCi&gt; Zero\n0\n</code></pre>\n\n<p>... all you need is a custom <code>Show</code> instance, as karakfa and leftaroundabout suggest <a href=\"https://stackoverflow.com/questions/42678254/trouble-implementing-natural-number-arithmetic-from-scratch#comment72481202_42678254\">in the comments</a>. That, however, won't change what <code>Zero</code> actually is; you are just changing the way it is displayed.</p>\n\n<p>Finally, a third possibility is that you want to use numeric literal syntax for your <code>Nat</code>s:</p>\n\n<pre><code>GHCi&gt; 0 + 2 :: Nat\n2\nit :: Nat\n</code></pre>\n\n<p>That is actually possible if you give <code>Nat</code> a <code>Num</code> instance. That would probably be a bad idea, though, because <code>(-)</code> would be partial and there would be no sensible implementation for <code>negate</code> (incidentally, that is also why I put a <code>Maybe</code> in the signature of <code>integerToNat</code> above). Also, just like in the case of <code>Show</code>, adding a <code>Num</code> instance wouldn't essentially change what your <code>Nat</code>s are -- in particular, at the end of the day numeric literal syntax is just syntax.</p>\n\n<p><sup>(You might question what I mean by \"essentially\" if you take the point of view that things are characterised by what you can do with them; but I will stop here before we get too sidetracked.)</sup></p>\n"}], "owner": {"reputation": 3, "user_id": 7679871, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ZMYW.jpg?s=128&g=1", "display_name": "learninghaskell", "link": "https://stackoverflow.com/users/7679871/learninghaskell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 42679030, "answer_count": 1, "score": -2, "last_activity_date": 1488997456, "creation_date": 1488994892, "question_id": 42678254, "link": "https://stackoverflow.com/questions/42678254/trouble-implementing-natural-number-arithmetic-from-scratch", "title": "Trouble implementing Natural Number Arithmetic from scratch", "body": "<p>I've been through LYAH, but I felt it was not a very good introduction to Haskell. I came across \"A gentle introduction to Haskell\", which recommended Richard Bird's \"Introduction to Functional Programming using Haskell\". That's the book I'm reading right now. Chapter 3 makes a datatype Nat and implements basic arithmetic with it. </p>\n\n<p>This is the code I have written until now:</p>\n\n<pre><code>module Main where\nimport Prelude hiding ((^^))\n\ndata Nat = Zero | Succ Nat\n        deriving (Eq, Ord, Show)\nxx :: Nat -&gt; Nat -&gt; Nat\nm `xx` Zero   = Zero\nm `xx` Succ n = (m `xx` n) `add` m\n\n(^^) :: Nat -&gt; Nat -&gt; Nat\nm ^^ Zero   = Succ Zero\nm ^^ Succ n = (m ^^ n) `xx` m\n\nadd :: Nat -&gt; Nat -&gt; Nat\nm `add` Zero   = m\nm `add` Succ n = Succ(m `add` n)\n\nfactsu :: Nat -&gt; Nat\nfactsu Zero     = Succ Zero\nfactsu (Succ n) = Succ n `xx` factsu n\n\n--Zero = 0\n\nshowNat :: Nat -&gt; String\nshowNat Zero = \"Zero\"\nshowNat (Succ Zero) = \"Succ Zero\"\nshowNat (Succ (Succ n)) = \"Succ (\" ++ showNat (Succ n) ++ \")\"\n\nmain :: IO ()\nmain = return ()\n</code></pre>\n\n<p>This is what happens:</p>\n\n<pre><code>factsu Zero\nSucc Zero\nit :: Nat\n</code></pre>\n\n<p>How do I define Succ and Zero?</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "comments": [{"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 3, "creation_date": 1488997097, "post_id": 42675764, "comment_id": 72482162, "body": "You are using Pipes.Text.IO for input rather than Pipes.Bytestring+ decoding as the library advises. The error message is from the text library which is making a judgment about system decoding for each chunk. I assume it is saying it can&#39;t understand the chunk according to whatever it thinks the encoding is."}], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 604955, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dee8e0c8c4b36334c2379c62b3e12054?s=128&d=identicon&r=PG", "display_name": "Charles Durham", "link": "https://stackoverflow.com/users/604955/charles-durham"}, "edited": false, "score": 0, "creation_date": 1489172175, "post_id": 42676477, "comment_id": 72571155, "body": "Not sure if this is the best place to ask, but when I do a foldC in place of sumC over my parsed lines on a 3 int constant size monoid, it seems to blow out all my memory again. Am I leaving anything out? I also tried foldlC."}, {"owner": {"reputation": 1655, "user_id": 604955, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dee8e0c8c4b36334c2379c62b3e12054?s=128&d=identicon&r=PG", "display_name": "Charles Durham", "link": "https://stackoverflow.com/users/604955/charles-durham"}, "edited": false, "score": 0, "creation_date": 1489172919, "post_id": 42676477, "comment_id": 72571516, "body": "Nevermind, did a deepseq instead of seq and everything worked fine"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 7, "last_activity_date": 1488989842, "creation_date": 1488989842, "answer_id": 42676477, "question_id": 42675764, "link": "https://stackoverflow.com/questions/42675764/read-large-lines-in-huge-file-without-buffering/42676477#42676477", "title": "Read large lines in huge file without buffering", "body": "<p>The following code uses Conduit, and will:</p>\n\n<ul>\n<li>UTF8-decode standard input</li>\n<li>Run the <code>lineC</code> combinator as long as there is more data available</li>\n<li>For each line, simply <code>yield</code> the value <code>1</code> and discard the line content, without ever read the entire line into memory at once</li>\n<li>Sum up the <code>1</code>s yielded and print it</li>\n</ul>\n\n<p>You can replace the <code>yield 1</code> code with something which will do processing on the individual lines.</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-8.4 --install-ghc runghc --package conduit-combinators\nimport Conduit\n\nmain :: IO ()\nmain = (runConduit\n     $ stdinC\n    .| decodeUtf8C\n    .| peekForeverE (lineC (yield (1 :: Int)))\n    .| sumC) &gt;&gt;= print\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1655, "user_id": 604955, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dee8e0c8c4b36334c2379c62b3e12054?s=128&d=identicon&r=PG", "display_name": "Charles Durham", "link": "https://stackoverflow.com/users/604955/charles-durham"}, "edited": false, "score": 0, "creation_date": 1489082007, "post_id": 42680522, "comment_id": 72526457, "body": "Thanks! I&#39;ll give this a try too when I get a chance"}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": false, "score": 3, "last_activity_date": 1489012587, "last_edit_date": 1489012587, "creation_date": 1489002164, "answer_id": 42680522, "question_id": 42675764, "link": "https://stackoverflow.com/questions/42675764/read-large-lines-in-huge-file-without-buffering/42680522#42680522", "title": "Read large lines in huge file without buffering", "body": "<p>This is probably easiest as a fold over the decoded text stream</p>\n\n<pre><code>{-#LANGUAGE BangPatterns #-}\nimport Pipes \nimport qualified Pipes.Prelude as P\nimport qualified Pipes.ByteString as PB\nimport qualified Pipes.Text.Encoding as PT\nimport qualified Control.Foldl as L\nimport qualified Control.Foldl.Text as LT\nmain = do\n  n &lt;- L.purely P.fold (LT.count '\\n') $ void $ PT.decodeUtf8 PB.stdin\n  print n\n</code></pre>\n\n<p>It takes about 14% longer than <code>wc -l</code> for the file I produced which was just long lines of commas and digits. IO should properly be done with <code>Pipes.ByteString</code> as the documentation says, the rest is conveniences of various sorts.</p>\n\n<p>You can map an attoparsec parser over each line, distinguished by <code>view lines</code>, but keep in mind that an attoparsec parser can accumulate the whole text as it pleases and this might not be a great idea over a 1 gigabyte chunk of text.  If there is a repeated figure on each line (e.g. word separated numbers) you can use <code>Pipes.Attoparsec.parsed</code> to stream them. </p>\n"}], "owner": {"reputation": 1655, "user_id": 604955, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dee8e0c8c4b36334c2379c62b3e12054?s=128&d=identicon&r=PG", "display_name": "Charles Durham", "link": "https://stackoverflow.com/users/604955/charles-durham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 1, "accepted_answer_id": 42676477, "answer_count": 2, "score": 6, "last_activity_date": 1489012587, "creation_date": 1488987926, "last_edit_date": 1488992485, "question_id": 42675764, "link": "https://stackoverflow.com/questions/42675764/read-large-lines-in-huge-file-without-buffering", "title": "Read large lines in huge file without buffering", "body": "<p>I was wondering if there's an easy way to get lines one at a time out of a file without eventually loading the whole file in memory. I'd like to do a fold over the lines with an <em>attoparsec</em> parser. I tried using <code>Data.Text.Lazy.IO</code> with <code>hGetLine</code> and that blows through my memory. I read later that eventually loads the whole file.</p>\n\n<p>I also tried using <em>pipes-text</em> with <code>folds</code> and <code>view lines</code>: </p>\n\n<pre><code>s &lt;- Pipes.sum $ \n    folds (\\i _ -&gt; (i+1)) 0 id (view Text.lines (Text.fromHandle handle))\nprint s\n</code></pre>\n\n<p>to just count the number of lines and it seems to be doing some wonky stuff \"hGetChunk: invalid argument (invalid byte sequence)\" and it takes 11 minutes where <code>wc -l</code> takes 1 minute. I heard that <em>pipes-text</em> might have some issues with gigantic lines? (Each line is about 1GB)</p>\n\n<p>I'm really open to any suggestions, can't find much searching except for newbie <code>readLine</code> how-tos.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "monads", "idioms", "lifting"], "comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1489006649, "post_id": 42674517, "comment_id": 72487623, "body": "I find myself using <code>=&lt;&lt;</code> more often than <code>&gt;&gt;=</code>, to stay consistent with composition and ordinary application. That nicely avoids the direction reversal in the first example."}, {"owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1489009456, "post_id": 42674517, "comment_id": 72489073, "body": "That&#39;s nice; I wasn&#39;t aware of it. I can then write <code>return . (*2) . (+1) =&lt;&lt; [1,2,3]</code>. And, yes, as @user2297560 says below, readability is all quite subjective."}], "answers": [{"comments": [{"owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "edited": false, "score": 0, "creation_date": 1488986201, "post_id": 42674802, "comment_id": 72474654, "body": "I could define my <code>(&gt;&gt;$)</code> in terms of <code>fmap</code> then. I wouldn&#39;t want to use <code>(&lt;$&gt;)</code> directly, since it spoils the sequential appearance. I would like my code to read as &quot;take numbers out of <code>[1,2,3]</code>, add <code>1</code> to them, and multiply them with <code>2</code> (my actual code would be larger than that)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "edited": false, "score": 1, "creation_date": 1488986424, "post_id": 42674802, "comment_id": 72474817, "body": "@marc_r The easiest way of maintaining the sequential appearance in this kind of monadic code is using do-notation."}, {"owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "edited": false, "score": 0, "creation_date": 1488987229, "post_id": 42674802, "comment_id": 72475427, "body": "Thus my <code>leftLift</code> function. I&#39;ll edit my post to include the <code>do</code> version."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "edited": false, "score": 0, "creation_date": 1488988132, "post_id": 42674802, "comment_id": 72476112, "body": "@marc_r I have edited the answer to add a suggestion related to that."}, {"owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "edited": false, "score": 0, "creation_date": 1488990096, "post_id": 42674802, "comment_id": 72477670, "body": "<code>let</code>s are a possibility. I am unsure about which version is the nicest. I was also thinking that my <code>leftLift</code> could perhaps be of more general usefulness (although I don&#39;t know yet how)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "edited": false, "score": 0, "creation_date": 1488992189, "post_id": 42674802, "comment_id": 72479158, "body": "@marc_r Between your <code>leftLift</code> and your <code>(&gt;&gt;$)</code>, I would definitely pick <code>(&gt;&gt;$)</code>. In the relvant use case here (i.e. left-to-right pointfree monadic code), you only need <code>leftLift</code> because you have used <code>(&gt;&gt;=)</code> beforehand, and you can replace them both with <code>(&gt;&gt;$)</code>. In other situations in which it might be used, I would just write <code>return . f</code> rather than using a special-purpose combinator like <code>leftLift</code>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1488988754, "last_edit_date": 1488988754, "creation_date": 1488985383, "answer_id": 42674802, "question_id": 42674517, "link": "https://stackoverflow.com/questions/42674517/using-a-pure-function-in-a-haskell-monad-left-lifting/42674802#42674802", "title": "Using a pure function in a Haskell monad / left-lifting?", "body": "<p>Every <code>Monad</code> is a <code>Functor</code> (and an <code>Applicative</code> too). Your <code>(&gt;&gt;$)</code> is (flipped) <code>fmap</code>.</p>\n\n<pre><code>GHCi&gt; :t fmap\nfmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nGHCi&gt; :t (&lt;$&gt;) -- Infix synonym for 'fmap'\n(&lt;$&gt;) -- Infix synonym for 'fmap'\n  :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nGHCi&gt; fmap ((*2) . (+1)) [1,2,3]\n[4,6,8]\nGHCi&gt; (*2) . (+1) &lt;$&gt; ([1,2,3] &gt;&gt;= \\x -&gt; [1..x])\n[4,4,6,4,6,8]\n</code></pre>\n\n<p>(By the way, a common name for flipped <code>fmap</code> is <code>(&lt;&amp;&gt;)</code>. That is, for instance, what <em>lens</em> calls it.)</p>\n\n<hr>\n\n<p>If you are using do-notation, there is little reason to use any variant of <code>fmap</code> explicitly for this kind of transformation. Just switch your <code>&lt;-</code> monadic bindings for let-bindings:</p>\n\n<pre><code>bazDo = do\n  x &lt;- [1,2,3]\n  let y = (+1) x\n      z = (*2) y\n  return z\n</code></pre>\n\n\n\n<pre><code>bazDo = do\n  x &lt;- [1,2,3]\n  let y = (+1) x\n  return ((*2) z)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "edited": false, "score": 0, "creation_date": 1489006857, "post_id": 42680224, "comment_id": 72487728, "body": "Good to know about <code>(&amp;)</code>. In my particular application (beyond the toy example in my post), I am using the State monad, and I&#39;m actually happy to remain in it."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 1, "last_activity_date": 1489001199, "creation_date": 1489001199, "answer_id": 42680224, "question_id": 42674517, "link": "https://stackoverflow.com/questions/42674517/using-a-pure-function-in-a-haskell-monad-left-lifting/42680224#42680224", "title": "Using a pure function in a Haskell monad / left-lifting?", "body": "<blockquote>\n  <p>For better readability...</p>\n</blockquote>\n\n<p>That's going to be subjective as people disagree on what constitutes readable.</p>\n\n<p>That being said, I agree that sometimes it's easier to understand data transformations when they are written left to right. I think your <code>&gt;&gt;$</code> is overkill, though. The <code>&amp;</code> operator in <code>Data.Function</code> does the job:</p>\n\n<pre><code>import Data.Function\n\nfoo = [1,2,3] &amp; fmap (+1) &amp; fmap (*2)\n</code></pre>\n\n<p>I like that this says exactly what to start with and exactly what to do at each step from left to right. And unlike <code>&gt;&gt;$</code>, you aren't forced to remain in the monad:</p>\n\n<pre><code>bar = [1,2,3] &amp; fmap (+1) &amp; fmap (*2) &amp; sum &amp; negate\n</code></pre>\n\n<p>Or you can just assemble your transformation beforehand and map it over your monad:</p>\n\n<pre><code>import Control.Category\n\nf = (+1) &gt;&gt;&gt; (*2)\nquuz = fmap f [1,2,3]\n</code></pre>\n"}], "owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "accepted_answer_id": 42674802, "answer_count": 2, "score": 1, "last_activity_date": 1489066607, "creation_date": 1488984706, "last_edit_date": 1489066607, "question_id": 42674517, "link": "https://stackoverflow.com/questions/42674517/using-a-pure-function-in-a-haskell-monad-left-lifting", "title": "Using a pure function in a Haskell monad / left-lifting?", "body": "<p>Consider the following function:</p>\n\n<pre><code>foo =\n  [1,2,3] &gt;&gt;=\n  return . (*2) . (+1)\n</code></pre>\n\n<p>For better readability and logic, I would like to move my pure functions <code>(*2)</code> and <code>(+1)</code> to the left of the return. I could achieve this like this:</p>\n\n<pre><code>infixr 9 &lt;.\n(&lt;.) :: (a -&gt; b) -&gt; (b -&gt; c) -&gt; (a -&gt; c)\n(&lt;.) f g = g . f\n\nbar =\n  [1,2,3] &gt;&gt;=\n  (+1) &lt;.\n  (*2) &lt;.\n  return\n</code></pre>\n\n<p>However, I don't like the right-associativity of <code>(&lt;.)</code>.</p>\n\n<p>Let's introduce a function <code>leftLift</code>:</p>\n\n<pre><code>leftLift :: Monad m =&gt; (a -&gt; b) -&gt; a -&gt; m b\nleftLift f = return . f\n\nbaz =\n  [1,2,3] &gt;&gt;=\n  leftLift (+1) &gt;&gt;=\n  leftLift (*2) &gt;&gt;=\n  return\n</code></pre>\n\n<p>I quite like this. Another possibility would be to define a variant of <code>bind</code>:</p>\n\n<pre><code>infixl 1 &gt;&gt;$\n(&gt;&gt;$) :: Monad m =&gt; m a -&gt; (a -&gt; b) -&gt; m b\n(&gt;&gt;$) m f = m &gt;&gt;= return . f\n\nqux =\n  [1,2,3] &gt;&gt;$\n  (+1) &gt;&gt;$\n  (*2) &gt;&gt;=\n  return\n</code></pre>\n\n<p>I am not sure whether that is a good idea, since it would not allow me to use <code>do</code> notation should I want that. <code>leftLift</code> I can use with <code>do</code>:</p>\n\n<pre><code>bazDo = do\n  x &lt;- [1,2,3]\n  y &lt;- leftLift (+1) x\n  z &lt;- leftLift (*2) y\n  return z\n</code></pre>\n\n<p>I didn't find a function on Hoogle with the signature of <code>leftLift</code>. Does such a function exist, and, if, what is it called? If not, what should I call it? And what would be the most idiomatic way of doing what I am trying to do?</p>\n\n<hr>\n\n<p>Edit: Here's a version inspired by @dunlop's answer below:</p>\n\n<pre><code>infixl 4 &lt;&amp;&gt;\n(&lt;&amp;&gt;) :: Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b\n(&lt;&amp;&gt;) = flip fmap\n\nblah =\n  [1,2,3] &lt;&amp;&gt;\n  (+1) &lt;&amp;&gt;\n  (*2) &gt;&gt;=\n  return\n</code></pre>\n\n<p>I should also add that I was after a <code>bind</code>-variant, because I wanted to write my code in point-free style. For <code>do</code>-notation, I guess I don't need to \"pretend\" that I'm doing anything monadic, so I can use <code>let</code>s.</p>\n"}, {"tags": ["haskell", "generics"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1488989387, "post_id": 42674354, "comment_id": 72477114, "body": "Here is something you may want to ponder - what should the type of <code>toX&#39;</code> be? Does it even <i>have</i> a type?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1488989636, "post_id": 42674354, "comment_id": 72477307, "body": "On needs to have more type-level information to do this. An <code>HList</code> just might be enough."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1488994014, "post_id": 42674354, "comment_id": 72480281, "body": "It&#39;s not clear why you want to do this using Generics. Defining functions with Generic should involve defining type classes. I would guess you have multiple types, which are simple records of values, is that right? Could you clarify your problem by showing various examples of types you want to handle and simple unit tests?"}, {"owner": {"reputation": 1189, "user_id": 348201, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b5c1cb1e1615645078717836ffc3eaf?s=128&d=identicon&r=PG", "display_name": "somesoaccount", "link": "https://stackoverflow.com/users/348201/somesoaccount"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1488997887, "post_id": 42674354, "comment_id": 72482604, "body": "@Li-yaoXia Currently I am just playing around to see what&#39;s possible with generics. I&#39;m trying to reimplement something like cassava/csv-conduit (parse CSV into a datatype) but only a minimal example for learning purposes. I came up with the code in my question and thought it would be more elegant with a recursive definition."}, {"owner": {"reputation": 1189, "user_id": 348201, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b5c1cb1e1615645078717836ffc3eaf?s=128&d=identicon&r=PG", "display_name": "somesoaccount", "link": "https://stackoverflow.com/users/348201/somesoaccount"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1488998059, "post_id": 42674354, "comment_id": 72482700, "body": "@Alec The type of <code>toX&#39;</code> is a mystery to me because the type of <code>:*:</code> is a mystery to me :) Not sure how a <code>HList</code> would help here, will think about it these days."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1489010111, "post_id": 42679748, "comment_id": 72489435, "body": "All these <code>read</code> partial functions! I would expect something more like <code>gReadFields :: MaybeT (State [String]) (f p)</code>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1489023812, "post_id": 42679748, "comment_id": 72494165, "body": "Okay, I hope this looks better now!"}, {"owner": {"reputation": 1189, "user_id": 348201, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b5c1cb1e1615645078717836ffc3eaf?s=128&d=identicon&r=PG", "display_name": "somesoaccount", "link": "https://stackoverflow.com/users/348201/somesoaccount"}, "edited": false, "score": 0, "creation_date": 1489051640, "post_id": 42679748, "comment_id": 72505412, "body": "Thanks for the version without generics as well, very interesting!"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1489069658, "post_id": 42679748, "comment_id": 72517630, "body": "You might want to take a look at my latest paragraph about <code>one-liner</code>."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1489069623, "last_edit_date": 1489069623, "creation_date": 1488999709, "answer_id": 42679748, "question_id": 42674354, "link": "https://stackoverflow.com/questions/42674354/how-do-i-map-over-parameters/42679748#42679748", "title": "How do I map over parameters?", "body": "<p>This defines a function <code>readFields :: [String] -&gt; Maybe X</code> for any <code>Generic</code> data type  <code>X</code> which has only one constructor (with at least one field).</p>\n\n<p><code>readFields</code> is defined using a generic version <code>gReadFields</code> which works with generic representations (i.e., types constructed using type constructors that appear in <code>GHC.Generics</code>: <code>M1</code>, <code>(:*:)</code>, <code>K1</code>...).</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeOperators #-}\n\nmodule A where\n\nimport GHC.Generics\nimport Control.Monad.Trans.State\nimport Text.Read\n\ndata X = X Int Int deriving (Generic, Show)\n\nmain = print (readFields [\"14\", \"41\"] :: Maybe X)\n\nreadFields :: (Generic a, GReadableFields (Rep a)) =&gt; [String] -&gt; Maybe a\nreadFields xs = fmap to (evalStateT gReadFields xs)\n\nclass GReadableFields f where\n  gReadFields :: StateT [String] Maybe (f p)\n\ninstance GReadableFields f =&gt; GReadableFields (M1 i c f) where\n  gReadFields = fmap M1 gReadFields\n\n-- When your type is a large product, you cannot assume that\n-- the generic product structure formed using `(:*:)` is list-\n-- like (field1 :*: (field2 :*: (field3 ...)), so it is not\n-- clear how to split the input list of strings to read each\n-- component. For that reason we use `State`. Another possible way\n-- is to compute the number of fields of the two operands `f` and `g`.\ninstance (GReadableFields f, GReadableFields g) =&gt; GReadableFields (f :*: g) where\n  gReadFields = do\n    f &lt;- gReadFields\n    g &lt;- gReadFields\n    return (f :*: g)\n\ninstance Read c =&gt; GReadableFields (K1 i c) where\n  gReadFields = StateT $ \\(x : xs) -&gt; do\n    c &lt;- readMaybe x\n    return (K1 c, xs)\n</code></pre>\n\n<p>Just for fun, here is a way of achieving a similar results which does not use generics. The user has to provide a constructor (or a function), and a type class takes care of filling all its arguments with values read from the list of strings.</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, TypeFamilies #-}\n\nmodule A where\n\ndata X = X Int Int deriving Show\n\nmain = print (readFields X [\"14\", \"41\"])\n\ntype family Result a where\n  Result (a -&gt; b) = Result b\n  Result a = a\n\nclass ReadableFields a where\n  readFields :: a -&gt; [String] -&gt; Maybe (Result a)\n\ninstance {-# OVERLAPPING #-} (ReadableFields b, Read a) =&gt; ReadableFields (a -&gt; b) where\n  readFields f (x : xs) = do\n    a &lt;- readMaybe x\n    readFields (f a) xs\n  readFields _ _ = Nothing\n\ninstance (Result a ~ a) =&gt; ReadableFields a where\n  readFields a _ = Just a\n</code></pre>\n\n<hr>\n\n<h2>EDIT</h2>\n\n<p>That use of <code>Generic</code> is straightforward enough that the underlying pattern is packaged in <a href=\"http://hackage.haskell.org/package/one-liner\" rel=\"nofollow noreferrer\">one-liner</a>.</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\n\nimport Generics.OneLiner\nimport Control.Monad.Trans.State\nimport Text.Read\n</code></pre>\n\n<p>Define an action to read a single field. It is important that there is an instance <code>Applicative (StateT [String] Maybe)</code> so that it can be composed.</p>\n\n<pre><code>-- Takes a string from the state and reads it out.\nreadM :: Read a =&gt; StateT [String] Maybe a\nreadM = StateT readM'\n  where \n    readM' (x : xs) | Just a &lt;- readMaybe x = Just (a, xs)\n    readM' _ = Nothing\n</code></pre>\n\n<p>This is now a one-liner, using <code>createA</code> from the one-liner library.</p>\n\n<pre><code>readFields xs = evalStateT (createA (For :: For Read) readM) xs\n\nmain = print (readFields [\"14\", \"42\"] :: Maybe (Int, Int))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": false, "score": 2, "last_activity_date": 1489057686, "creation_date": 1489057686, "answer_id": 42693764, "question_id": 42674354, "link": "https://stackoverflow.com/questions/42674354/how-do-i-map-over-parameters/42693764#42693764", "title": "How do I map over parameters?", "body": "<p>Here is a solution using <a href=\"https://hackage.haskell.org/package/generics-sop\" rel=\"nofollow noreferrer\">generics-sop</a>:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeFamilies, FlexibleContexts, TypeApplications #-}\n{-# LANGUAGE TemplateHaskell #-}\nmodule ReadFields where\n\nimport Data.Maybe\nimport Generics.SOP\nimport Generics.SOP.TH\n\nreadFields ::\n  (Generic a, Code a ~ '[ xs ], All Read xs) =&gt; [String] -&gt; Maybe a\nreadFields xs =\n  to . SOP . Z . hcmap (Proxy @Read) (I . read . unK) &lt;$&gt; fromList xs\n\ndata X = X Int Int\n  deriving Show\n\nderiveGeneric ''X\n</code></pre>\n\n<p>Testing:</p>\n\n<pre><code>GHCi&gt; readFields @X [\"3\", \"4\"]\nJust (X 3 4)\nGHCi&gt; readFields @X [\"3\"]\nNothing\n</code></pre>\n"}], "owner": {"reputation": 1189, "user_id": 348201, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b5c1cb1e1615645078717836ffc3eaf?s=128&d=identicon&r=PG", "display_name": "somesoaccount", "link": "https://stackoverflow.com/users/348201/somesoaccount"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 42679748, "answer_count": 2, "score": 1, "last_activity_date": 1489069623, "creation_date": 1488984304, "question_id": 42674354, "link": "https://stackoverflow.com/questions/42674354/how-do-i-map-over-parameters", "title": "How do I map over parameters?", "body": "<p>Given the type <code>X = X Int Int</code>, I want to define a function <code>toX :: [String] -&gt; X</code> which constructs an <code>X</code> during runtime with generics.</p>\n\n<p>This is easy when I just write it down like this:</p>\n\n<pre><code>toX :: [String] -&gt; X\ntoX (x:[y]) = to (M1 (M1 (M1 (K1 $ read x) :*: (M1 (K1 $ read y)))))\n</code></pre>\n\n<p>But I don't know how to do it recursive (in case we have a lot more than two parameters). My first try was something like this:</p>\n\n<pre><code>toX xs = to (M1 (M1 (toX' xs)))\n\ntoX' (x:[]) = M1 (K1 x)\ntoX' (x:xs) = M1 (K1 x) :*: (toX' xs)\n</code></pre>\n\n<p>which (of course) fails with a type error. Looking at the type of <code>(:*:)</code> confuses me even more: <code>(:*:) :: f p -&gt; g p -&gt; (:*:) f g p</code>. I have absolutely no idea what this type is supposed to mean and how to proceed from here.\nAny hints?</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack --resolver lts-8.4 runghc-}\n{-# LANGUAGE DeriveGeneric #-}\nimport GHC.Generics\ndata X = X Int Int deriving (Generic, Show)\n\nmain :: IO ()\nmain = do\n    print $ toXeasy [\"2\",\"4\"]\n--    print $ toX [\"2\",\"4\"]\n\ntoXeasy :: [String] -&gt; X\ntoXeasy (x:[y]) = to (M1 (M1 (M1 (K1 $ read x) :*: (M1 (K1 $ read y)))))\n\n--toX :: [String] -&gt; X\n--toX xs = to (M1 (M1 (toX' xs)))\n\n--toX' (x:[]) = M1 (K1 x)\n--toX' (x:xs) = M1 (K1 x) :*: (toX' xs)\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1489052374, "post_id": 42672584, "comment_id": 72505863, "body": "Btw. Purging a cache should never be necessary using stack as it is designed to work with lots of different versions, be it libraries or executables"}], "answers": [{"comments": [{"owner": {"reputation": 4734, "user_id": 736508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2b30f4fcb5b2b34a8468a8d378cab9d1?s=128&d=identicon&r=PG", "display_name": "Gal", "link": "https://stackoverflow.com/users/736508/gal"}, "edited": false, "score": 0, "creation_date": 1489049509, "post_id": 42674527, "comment_id": 72504027, "body": "Maybe I&#39;m missing something obvious, but in <code>stack --resolver lts-4.2 install ghc-mod</code>, where is the <code>5.4.0.0</code> hiding in?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 4734, "user_id": 736508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2b30f4fcb5b2b34a8468a8d378cab9d1?s=128&d=identicon&r=PG", "display_name": "Gal", "link": "https://stackoverflow.com/users/736508/gal"}, "edited": false, "score": 0, "creation_date": 1489052022, "post_id": 42674527, "comment_id": 72505656, "body": "Stack packages have a fixed version within a certain resolver, <a href=\"https://www.stackage.org/lts-4.2\" rel=\"nofollow noreferrer\">stackage.org/lts-4.2</a> shows that ghc-mod has the correct version there"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 4, "last_activity_date": 1489052172, "last_edit_date": 1489052172, "creation_date": 1488984739, "answer_id": 42674527, "question_id": 42672584, "link": "https://stackoverflow.com/questions/42672584/stack-how-do-i-force-install-an-old-version-of-a-package/42674527#42674527", "title": "Stack - How do I (force?) install an old version of a package", "body": "<p>I think something like</p>\n\n<pre><code>stack --resolver lts-4.2 install ghc-mod\n</code></pre>\n\n<p>should do the trick, otherwise I would do something along the lines of <code>cabal get ghc-mod-5.4.0.0</code> and <code>stack init</code>, <code>stack install</code> there. You might need to install/switch to a different ghc-version or use the stack equivalent of <code>--allow-newer</code></p>\n"}], "owner": {"reputation": 4734, "user_id": 736508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2b30f4fcb5b2b34a8468a8d378cab9d1?s=128&d=identicon&r=PG", "display_name": "Gal", "link": "https://stackoverflow.com/users/736508/gal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 964, "favorite_count": 0, "accepted_answer_id": 42674527, "answer_count": 1, "score": 1, "last_activity_date": 1489052172, "creation_date": 1488979547, "question_id": 42672584, "link": "https://stackoverflow.com/questions/42672584/stack-how-do-i-force-install-an-old-version-of-a-package", "title": "Stack - How do I (force?) install an old version of a package", "body": "<p>So I'm trying to install <code>ghc-mod-5.4.0.0</code>, which crashes with a bunch of other installation:</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nIn the dependencies for ghc-mod-5.4.0.0:\n    async-2.1.1 must match &lt;2.1 &amp;&amp; &gt;=2.0.2 (latest applicable is 2.0.2)\n    cabal-helper-0.7.3.0 must match &lt;0.7 &amp;&amp; &gt;=0.6.1.0 (latest applicable is 0.6.3.1)\n    cereal-0.5.4.0 must match &lt;0.5 &amp;&amp; &gt;=0.4 (latest applicable is 0.4.1.1)\n    directory-1.3.0.0 must match &lt;1.3 (latest applicable is 1.2.7.1)\n    extra-1.5.1 must match ==1.4.* (latest applicable is 1.4.12)\n    ghc-8.0.2 must match &gt;=7.4 &amp;&amp; &lt;7.11\n    haskell-src-exts-1.18.2 must match &lt;1.18 &amp;&amp; &gt;=1.16.0.1 (latest applicable is 1.17.1)\n    pipes-4.3.2 must match ==4.1.* (latest applicable is 4.1.9)\n    process-1.4.3.0 must match &lt;1.3 (latest applicable is 1.2.3.0)\n    time-1.6.0.1 must match &lt;1.6 (latest applicable is 1.5.0.1)\n    transformers-0.5.2.0 must match &lt;0.5 (latest applicable is 0.4.3.0)\n\nPlan construction failed.\n</code></pre>\n\n<p>So how do I force it to install that version? Is there a simple way to purge the stack installation cache or something like that?</p>\n"}, {"tags": ["haskell", "higher-kinded-types", "higher-order-types", "rank-n-types"], "comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1488979529, "post_id": 42670673, "comment_id": 72469748, "body": "Try changing &#39;$&#39; to ordinary parenthesis."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1488984017, "post_id": 42670673, "comment_id": 72473044, "body": "This is not possible. As suggested by the error message, the function <code>f</code> requires a <code>(ToJSON (b b1))</code> constraint which is not provided by pattern matching on <code>(Hide a)</code>. The &quot;context&quot; in the error message gives the actually provided constraints. Could you give more details about what you are trying to do?"}, {"owner": {"reputation": 2535, "user_id": 634020, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/044be669886e6b2e625776ff8be167b7?s=128&d=identicon&r=PG", "display_name": "Philip Kamenarsky", "link": "https://stackoverflow.com/users/634020/philip-kamenarsky"}, "edited": false, "score": 0, "creation_date": 1488990340, "post_id": 42670673, "comment_id": 72477842, "body": "Ultimately I got it to work by removing the <code>A.ToJSON (a b)</code> constraint, thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "is_accepted": true, "score": 1, "last_activity_date": 1488986898, "creation_date": 1488986898, "answer_id": 42675354, "question_id": 42670673, "link": "https://stackoverflow.com/questions/42670673/mapping-over-constrained-existentially-qualified-higher-order-type/42675354#42675354", "title": "Mapping over constrained existentially qualified higher order type", "body": "<p>Changing the function type to something like this might do the trick:</p>\n\n<pre><code> (A.ToJSON (b c2), A.ToJSON c2) \u21d2\n (\u2200 c. (A.ToJSON (a c), A.ToJSON c) \u21d2 a c) \n    \u2192 b c2)\n</code></pre>\n\n<p>Also avoid using '$' as it kills polymorphism. </p>\n"}], "owner": {"reputation": 2535, "user_id": 634020, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/044be669886e6b2e625776ff8be167b7?s=128&d=identicon&r=PG", "display_name": "Philip Kamenarsky", "link": "https://stackoverflow.com/users/634020/philip-kamenarsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 42675354, "answer_count": 1, "score": 1, "last_activity_date": 1488986898, "creation_date": 1488974046, "question_id": 42670673, "link": "https://stackoverflow.com/questions/42670673/mapping-over-constrained-existentially-qualified-higher-order-type", "title": "Mapping over constrained existentially qualified higher order type", "body": "<p>I hope I got the terminology right.</p>\n\n<p>I want to do the following:</p>\n\n<pre><code>data Hide a = \u2200 b. (A.ToJSON (a b), A.ToJSON b) \u21d2 Hide (a b)\n\nmapHide \u2237 (\u2200 c. (A.ToJSON (b c), A.ToJSON c) \u21d2 a c \u2192 b c) \u2192 Hide a \u2192 Hide b\nmapHide f (Hide a) = (Hide $ f a)\n</code></pre>\n\n<p>Unfortunately, GHC seemingly can't infere the constraints right and complains with:</p>\n\n<pre><code>Could not deduce (A.ToJSON (b b1)) arising from a use of \u2018Hide\u2019\n    from the context (A.ToJSON (a b1), A.ToJSON b1)\n</code></pre>\n\n<p>Is this somehow possible?</p>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "edited": false, "score": 1, "creation_date": 1488971697, "post_id": 42669557, "comment_id": 72464165, "body": "Indeed, I got confused. Thank you. I found out thought that I had to edit the function main: <code>main = do check; return ()</code> to give it type IO (). <code>check</code> has type IO Bool"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "edited": false, "score": 0, "creation_date": 1488973755, "post_id": 42669557, "comment_id": 72465670, "body": "@GuillaumeCh&#233;rel: as far as I know any <code>IO a</code> as <code>main</code> is acceptable. But indeed now it conflicts with the type signature."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1488993191, "last_edit_date": 1488993191, "creation_date": 1488971004, "answer_id": 42669557, "question_id": 42669087, "link": "https://stackoverflow.com/questions/42669087/complete-minimal-example-for-using-quickcheckall/42669557#42669557", "title": "Complete minimal example for using quickCheckAll", "body": "<p>I think you misread <a href=\"http://hackage.haskell.org/package/QuickCheck-2.9.2/docs/Test-QuickCheck-All.html#v:quickCheckAll\" rel=\"nofollow noreferrer\">the documentation</a> a bit. It specifies that you should write <code>return []</code> as a naked expression, and that you have to use <code>TemplateHaskell</code>:</p>\n\n<blockquote>\n  <p>Test all properties in the current module, using Template Haskell. <strong>You need to have a <code>{-# LANGUAGE TemplateHaskell #-}</code> pragma in your module</strong> for any of these to work.</p>\n  \n  <p>(...)</p>\n  \n  <p>To use <code>quickCheckAll</code>, add a definition to your module along the lines\n  of</p>\n\n<pre><code>return []\nrunTests = $quickCheckAll\n</code></pre>\n  \n  <p>and then execute <code>runTests</code>.</p>\n  \n  <p>(...)</p>\n  \n  <p>Note: the bizarre <code>return []</code> in the example above is needed on GHC 7.8; <strong>without it, <code>quickCheckAll</code> will not be able to find any of the properties</strong>. For the curious, the <code>return []</code> is a Template Haskell splice that <strong>makes GHC insert the empty list of declarations at that point in the program</strong>; GHC typechecks everything before the <code>return []</code> before it starts on the rest of the module, which means that the later call to <code>quickCheckAll</code> can see everything that was <strong>defined before the <code>return []</code></strong>. Yikes!</p>\n</blockquote>\n\n<p>So your first file should be:</p>\n\n<pre><code><b>{-# LANGUAGE TemplateHaskell #-}</b>\n\nmodule A where\n\nimport Test.QuickCheck\n\nprop_a = 1 == 0\n\n<b>return []\ncheck = $quickCheckAll</b></code></pre>\n\n<p>all properties you want to test (here <code>prop_a</code>) should be defined before the <code>return []</code>.</p>\n\n<p>and the main file:</p>\n\n<pre><code>import A\n\nmain :: IO <b>Bool</b>\nmain = <b>check</b></code></pre>\n\n<p>You are allowed to use <code>do</code>, but it does not add any value. Or in case you want the <code>main</code> to be <code>IO ()</code>, you can write:</p>\n\n<pre><code>import A\n\nmain :: IO ()\nmain = <b>do\n    check\n    return ()</b></code></pre>\n\n<p>Running this in <code>ghci</code> gives:</p>\n\n<pre><code>*A&gt; :t check\ncheck :: IO Bool\n*A&gt; check\n=== prop_a from ha.hs:7 ===\n*** Failed! Falsifiable (after 1 test):  \n\nFalse\n</code></pre>\n"}], "owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 551, "favorite_count": 1, "accepted_answer_id": 42669557, "answer_count": 1, "score": 5, "last_activity_date": 1489002240, "creation_date": 1488969693, "last_edit_date": 1489002240, "question_id": 42669087, "link": "https://stackoverflow.com/questions/42669087/complete-minimal-example-for-using-quickcheckall", "title": "Complete minimal example for using quickCheckAll", "body": "<p>I could use a complete example of how to use <code>quickCheckAll</code>. Here's what I've tried so far:</p>\n\n<p>In a file <code>A.hs</code>:</p>\n\n<pre><code>module A where\n    import Test.QuickCheck\n\n    prop_a = 1 == 0\n\n    check = do\n        return []\n        $quickCheckAll\n</code></pre>\n\n<p>In another file that's supposed to drive the tests:</p>\n\n<pre><code>import A\n\nmain :: IO ()\nmain = do\n    check\n</code></pre>\n\n<p>This doesn't work, because check doesn't have type <code>IO ()</code>. How I am supposed to \"execute check\" as instructed <a href=\"https://hackage.haskell.org/package/QuickCheck-2.7.6/docs/Test-QuickCheck-All.html\" rel=\"nofollow noreferrer\">in the documentation</a>?</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack", "happy"], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1488989025, "post_id": 42670558, "comment_id": 72476859, "body": "I may be wrong, but aren&#39;t <code>happy</code> and <code>alex</code> special in this regard? Or are they treated as any other package? Note this isn&#39;t the <code>build-depends</code> section..."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1489017857, "post_id": 42670558, "comment_id": 72492566, "body": "@Alec Ah, I was under the impression it was under <code>build-depends</code> section. This thread may help you: <a href=\"https://github.com/commercialhaskell/stack/issues/782#issuecomment-131417028\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/&hellip;</a> . Let us know how it goes."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 1, "last_activity_date": 1488973738, "creation_date": 1488973738, "answer_id": 42670558, "question_id": 42668419, "link": "https://stackoverflow.com/questions/42668419/specify-to-stack-which-version-of-happy-to-use/42670558#42670558", "title": "Specify to Stack which version of Happy to use", "body": "<p>You need to put the following in your <code>stack.yaml</code> file to have a particular package treated as a dependency package:</p>\n\n<pre><code>packages:\n- location: .\n- location:\n    git: git@github.com:orgname/project_name\n    commit: &lt;commitid&gt;\n  extra-dep: true\n</code></pre>\n\n<p>Replace with the proper git url and commit id for referencing the happy project. You can read more information about that <a href=\"https://github.com/commercialhaskell/stack/blob/master/doc/yaml_configuration.md#local-dependency-packages-extra-dep\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488979961, "creation_date": 1488967897, "last_edit_date": 1488979961, "question_id": 42668419, "link": "https://stackoverflow.com/questions/42668419/specify-to-stack-which-version-of-happy-to-use", "title": "Specify to Stack which version of Happy to use", "body": "<p>I'm running up against <a href=\"https://github.com/simonmar/happy/issues/35\" rel=\"nofollow noreferrer\">a bug</a> in the latest version of Happy (1.19.5). How do I tell stack to go look for an even newer version of Happy (1.19.6) found only at the git repo? Right now, I'm letting stack manage everything; the only reference to Happy is in my cabal file. The relevant section is:</p>\n\n<pre><code>...\n\nlibrary:\n  hs-source-dirs:      src\n  ghc-options:         -Wall\n  build-tools:         alex, happy\n\n...\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1488968105, "post_id": 42668032, "comment_id": 72461734, "body": "It was interesting to learn that the actual signature of <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#t:Read\" rel=\"nofollow noreferrer\"><code>Read</code></a> is more complex and interesting, though for the scope of the question it&#39;s not relevant."}, {"owner": {"reputation": 9272, "user_id": 241544, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d27ca4e9a9a41ec8732046e6a272f091?s=128&d=identicon&r=PG", "display_name": "Matthew Walton", "link": "https://stackoverflow.com/users/241544/matthew-walton"}, "reply_to_user": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 2, "creation_date": 1488968623, "post_id": 42668032, "comment_id": 72462068, "body": "@bereal in Haskell, the type signature is almost always extremely relevant. But <code>read</code> is a particularly interesting case IMO as it&#39;s one of the most common uses I&#39;ve come across of return type inference which does not depend on the type of the inputs."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1488976037, "post_id": 42668032, "comment_id": 72467316, "body": "@bereal If <code>read</code> had the type signature <code>String -&gt; Int</code> there would not have been any problem with the OP code. It seems the crux of the matter is indeed that <code>read</code> is polymorphic in the output type. I&#39;m not sure how the problem can be explained without mentioning that general type, unless one only mentions the quick fix &quot;add an annotation&quot; without explaining why is that necessary."}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1488977441, "post_id": 42668032, "comment_id": 72468318, "body": "@chi @Matthew what I meant, is that in fact <code>read :: String -&gt; a</code> is not a method of <code>Read a</code>, but <code>Read a</code> is defined in terms of <code>readsPrec :: Int -&gt; ReadS a</code> etc. Sorry if I didn&#39;t make it clear."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1488968842, "last_edit_date": 1488968842, "creation_date": 1488966788, "answer_id": 42668032, "question_id": 42667675, "link": "https://stackoverflow.com/questions/42667675/haskell-just-using-the-read-function-signals-an-error/42668032#42668032", "title": "Haskell just using the read function signals an error", "body": "<p><code>\"5\"</code> <strong>itself is not ambiguous</strong>, it's more that Haskell does not know <strong>to what type you want to <code>read</code></strong>. <code>read</code> is a function defined as:</p>\n\n<pre><code>read :: <b>Read a</b> => String -> <b>a</b></code></pre>\n\n<p>and you can define multiple types that support the <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#t:Read\" rel=\"nofollow noreferrer\"><code>Read</code></a> class. For instance <code>Int</code> is an instance of <code>Read</code>, but also <code>Float</code> and you can define your own type that is an instance of <code>Read</code>. You could for instance have defined your own type:</p>\n\n<pre><code>data WeirdNumbers = Five | Twelve\n</code></pre>\n\n<p>and then define an <code>instance Read WeirdNumbers</code> where you map <code>\"5\"</code> on <code>Five</code>, etc. Now <code>\"5\"</code> thus maps on several types.</p>\n\n<p>You can simply solve the problem by telling Haskell to what type you want to read. Like:</p>\n\n<pre><code>Prelude&gt; read \"5\" :: Int\n5\nPrelude&gt; read \"5\" :: Float\n5.0\n</code></pre>\n\n<p>The reason why <code>read \"5\" + 3</code> works by the way is because here you provide a <code>3</code> and a <code>(+) :: Num a =&gt; a -&gt; a -&gt; a</code>. So Haskell reasons \"Well 3 is an Integer and <code>+</code> requires that the left and the right operand to be of the same type, I know I have to use <code>read</code> such that it reads to an Integer as well.\"</p>\n"}], "owner": {"reputation": 16645, "user_id": 402322, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/GWEWt.gif?s=128&g=1", "display_name": "ceving", "link": "https://stackoverflow.com/users/402322/ceving"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 42668032, "answer_count": 1, "score": 1, "last_activity_date": 1488968842, "creation_date": 1488965814, "question_id": 42667675, "link": "https://stackoverflow.com/questions/42667675/haskell-just-using-the-read-function-signals-an-error", "title": "Haskell just using the read function signals an error", "body": "<p>Can anybody explain, why it is valid to read a number to add it to a another number, although reading just a number is not valid?</p>\n\n<pre>\nPrelude> read \"5\" + 3\n8\nPrelude> read \"5\"\n\n:33:1:\n    No instance for (Read a0) arising from a use of `read'\n    The type variable `a0' is ambiguous\n    Possible fix: add a type signature that fixes these type variable(s)\n    Note: there are several potential instances:\n      instance Read () -- Defined in `GHC.Read'\n      instance (Read a, Read b) => Read (a, b) -- Defined in `GHC.Read'\n      instance (Read a, Read b, Read c) => Read (a, b, c)\n        -- Defined in `GHC.Read'\n      ...plus 25 others\n    In the expression: read \"5\"\n    In an equation for `it': it = read \"5\"\n</pre>\n\n<p>Why is \"5\" ambiguous?</p>\n"}, {"tags": ["multithreading", "haskell", "asynchronous", "cancellation"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1488962723, "post_id": 42664692, "comment_id": 72458276, "body": "It seems to me that since your proposed <code>cancelSelf</code> function needs you to be in IO at the point at which you&#39;d want to cancel, it would be equally easy to be in <code>EitherT String IO</code> instead, and just &quot;cancel&quot; by returning <code>Left &quot;cancelled&quot;</code> or whatever."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1488963435, "post_id": 42665343, "comment_id": 72458695, "body": "&quot;<code>mfix f</code> executes the action <code>f</code> only once, with the eventual output fed back as the input. Hence <code>f</code> should not be strict, for then <code>mfix f</code> would diverge&quot;. Yep, in a really bad way - it&#39;ll block on the <code>takeMVar</code>."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 5, "last_activity_date": 1489072291, "last_edit_date": 1489072291, "creation_date": 1488958032, "answer_id": 42665343, "question_id": 42664692, "link": "https://stackoverflow.com/questions/42664692/canceling-an-async-thread-from-within-the-thread-itself/42665343#42665343", "title": "Canceling an Async thread from within the thread itself", "body": "<p>An async action can cancel itself.  It involves a bit of a trick, though.</p>\n\n<pre><code>{-# LANGUAGE RecursiveDo #-}\n\nimport Control.Concurrent.Async\n\nmain :: IO ()\nmain = do\n    rec let doCancel = cancel calculate\n        calculate &lt;- async doCancel\n    wait calculate\n</code></pre>\n\n<p>In theory, you can do that without <code>RecursiveDo</code>, but I've never wanted to write an <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad-Fix.html#v:mfix\" rel=\"nofollow noreferrer\"><code>mfix</code></a> expression (what <code>RecursiveDo</code> bindings desugar to) by hand.</p>\n\n<p><code>RecursiveDo</code> allows you to create a mutually-recursive set of definitions inside a do block, even if some of the definitions are bound with <code>&lt;-</code> and some are defined inside a <code>let</code> statement.  As always, if there is a real circularity involved, the calculation will diverge.  But there are lots of cases where all you want to do is be able to refer to the name of something else like the example above, and <code>RecursiveDo</code> works just fine.</p>\n\n<p>Oh, and <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/System.IO.html#fixIO\" rel=\"nofollow noreferrer\">the implementation of <code>mfix</code> for <code>IO</code></a> is terrifying. I'm glad I didn't have to write it myself.</p>\n\n<p>-- Edit --</p>\n\n<p>Since this has received almost no feedback, I've realized it's not completely obvious how to use this in order to solve your problem.  So here's an expanded example that uses a combinator to spawn an <code>Async</code> that can cancel itself:</p>\n\n<pre><code>{-# LANGUAGE RecursiveDo #-}\n\n-- obviously want the async library\nimport Control.Concurrent.Async\n\n-- used in selfCancelableAsync\nimport Control.Monad      (forever)\nimport Control.Concurrent (threadDelay)\n\n-- only used for demonstration\nimport System.Random      (randomIO)\n\nmain :: IO ()\nmain = do\n    a &lt;- selfCancelableAsync $ \\selfCancel -&gt; do\n        choice &lt;- randomIO\n        if choice then return \"Success!\" else selfCancel\n    result &lt;- wait a\n    putStrLn result\n\n-- spawns an Async that has the ability to cancel itself by\n-- using the action passed to the IO action it's running\nselfCancelableAsync :: (IO a -&gt; IO b) -&gt; IO (Async b)\nselfCancelableAsync withCancel = do\n    rec let doCancel = do\n                cancel calculate\n                -- This must never return to ensure it has the correct type.\n                -- It uses threadDelay to ensure it's not hogging resources\n                -- if it takes a moment to get killed.\n                forever $ threadDelay 1000\n\n        calculate &lt;- async $ withCancel doCancel\n\n    return calculate\n</code></pre>\n"}], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 1, "accepted_answer_id": 42665343, "answer_count": 1, "score": 2, "last_activity_date": 1489072291, "creation_date": 1488955563, "question_id": 42664692, "link": "https://stackoverflow.com/questions/42664692/canceling-an-async-thread-from-within-the-thread-itself", "title": "Canceling an Async thread from within the thread itself", "body": "<p>Is there a way to use <code>cancel</code> from within a thread invoked with <code>async</code> from the <a href=\"https://hackage.haskell.org/package/async\" rel=\"nofollow noreferrer\">async</a> package? I can see that you can cancel it from outside the thread, but I'm wondering if there could be a <code>cancelSelf :: IO ()</code> function which stops its own execution. I <em>could</em> staple something together with unique id generation and a shared <code>Map</code> of <code>Async</code> thread references, which the thread itself could reference, but that just seems too much. Could I get away with an uncaught exception or something?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488962037, "post_id": 42663721, "comment_id": 72457942, "body": "What error do you get ? Or is this about printing to standard out"}, {"owner": {"reputation": 1, "user_id": 7216280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5674056502036c69badd0f113278984?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Case", "link": "https://stackoverflow.com/users/7216280/justin-case"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488965536, "post_id": 42663721, "comment_id": 72459995, "body": "It&#39;s about printing to standard out"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488969541, "post_id": 42663721, "comment_id": 72462677, "body": "so what does my current answer lack - that you cannot print it to stdout?"}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1488963223, "last_edit_date": 1488963223, "creation_date": 1488961833, "answer_id": 42666436, "question_id": 42663721, "link": "https://stackoverflow.com/questions/42663721/show-months-first-weekday-with-haskell/42666436#42666436", "title": "Show months first weekday with Haskell", "body": "<h2>Why not use <code>Data.Time.Format</code>?</h2>\n\n<pre><code>import Data.Time.Format\n\nweekDay = formatTime defaultTimeLocale \"%a\"\n</code></pre>\n\n<p>Should do the trick. I am on the bus so this code is untested.</p>\n\n<h2>Edit</h2>\n\n<p>Tested it \u2714</p>\n\n<p>If this is an issue about printing to stdout, then you have to call this function either in ghci</p>\n\n<pre><code>ghci&gt; let d = fromGregorian 2017 03 08\nghci&gt; let weekday = formatTime defaultTimeLocale \"%a\"\nghci&gt; weekday d\n\"Wed\"\n</code></pre>\n\n<p>or have a main function</p>\n\n<pre><code>import Data.Time\nimport Data.Time.Format\n\nmain :: IO ()\nmain = print $ weekday d\n\nd = fromGregorian 2017 03 08\nweekday = formatTime defaultTimeLocale \"%a\"\n</code></pre>\n\n<p>then you can <code>runhaskell</code> or compile and run and get</p>\n\n<pre><code>Wed\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7216280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5674056502036c69badd0f113278984?s=128&d=identicon&r=PG&f=1", "display_name": "Justin Case", "link": "https://stackoverflow.com/users/7216280/justin-case"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488963223, "creation_date": 1488951293, "question_id": 42663721, "link": "https://stackoverflow.com/questions/42663721/show-months-first-weekday-with-haskell", "title": "Show months first weekday with Haskell", "body": "<p>I'm trying to get Haskell to output/print months first weekday.\nI came up with following code:</p>\n\n<pre><code>import Data.Time.Calendar\nimport Data.Time.Calendar.WeekDate\nimport Data.Char\nday=[\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\",\"Sun\"]\nyear=2017\nmonth=5\n\nweekday = day!!(digitToInt(last(showWeekDate (fromGregorian year month 01)))\n</code></pre>\n\n<p>How do I get Haskell to print weekday, when I run code?\nI think there is still some problems with last line of code also.</p>\n"}, {"tags": ["sorting", "haskell", "types"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1488942370, "post_id": 42662178, "comment_id": 72450175, "body": "Any reason why you want to do it like this ? This is not the recommended way to write haskell code."}, {"owner": {"reputation": 354, "user_id": 3777717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b2cf577b7fcab545f75f6e1bcc6ca72?s=128&d=identicon&r=PG&f=1", "display_name": "ByteEater", "link": "https://stackoverflow.com/users/3777717/byteeater"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1488942880, "post_id": 42662178, "comment_id": 72450305, "body": "I&#39;ve seen it in examples (some of them linked below) showcasing the Ordering monoid. It makes me wonder if the repetition of comparing can be abstracted. I&#39;ve come across similar cases in mine and others&#39; programmes, not related to sorting.  Additional question, prompted by your second sentence: what would be the recommended way in such cases?  <a href=\"http://www.mjoldfield.com/atelier/2015/04/monoid.html\" rel=\"nofollow noreferrer\">mjoldfield.com/atelier/2015/04/monoid.html</a> <a href=\"https://byorgey.wordpress.com/2011/04/18/monoids-for-maybe/\" rel=\"nofollow noreferrer\">byorgey.wordpress.com/2011/04/18/monoids-for-maybe</a> <a href=\"http://martijn.van.steenbergen.nl/journal/2008/12/21/comparing-multiple-criteria/\" rel=\"nofollow noreferrer\">martijn.van.steenbergen.nl/journal/2008/12/21/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 7, "last_activity_date": 1560646129, "last_edit_date": 1560646129, "creation_date": 1488943907, "answer_id": 42662476, "question_id": 42662178, "link": "https://stackoverflow.com/questions/42662178/map-comparing-over-heterogeneous-criteria/42662476#42662476", "title": "Map comparing over heterogeneous criteria", "body": "<p>It goes quite smoothly as long as you don't mind not putting the functions in a list:</p>\n\n<pre><code>GHCi&gt; :t comparing length &lt;&gt; comparing last &lt;&gt; comparing id\ncomparing length &lt;&gt; comparing last &lt;&gt; comparing id\n  :: Ord a =&gt; [a] -&gt; [a] -&gt; Ordering\nGHCi&gt; (comparing length &lt;&gt; comparing last &lt;&gt; comparing id) \"abcd\" \"abc\"\nGT\nGHCi&gt; (comparing length &lt;&gt; comparing last &lt;&gt; comparing id) \"abd\" \"abc\"\nGT\nGHCi&gt; (comparing length &lt;&gt; comparing last &lt;&gt; comparing id) \"aac\" \"abc\"\nLT\n</code></pre>\n\n<p>This exploits both the monoid instance for functions (a monoid on the results) and the one for <code>Ordering</code> (which does <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.Base.html#line-302\" rel=\"nofollow noreferrer\">the intuitvely obvious thing</a>).</p>\n\n<p>Given that the result type of the projection function you give to <code>comparing</code> doesn't actually appear in the final result, if you really want a list you can appeal to an existential type:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\nimport Data.Ord\n\ndata Measurement a where\n    Measurement :: Ord b =&gt; (a -&gt; b) -&gt; Measurement a\n\ncomparingHet :: Measurement a -&gt; a -&gt; a -&gt; Ordering\ncomparingHet (Measurement f) = comparing f\n</code></pre>\n\n\n\n<pre><code>GHCi&gt; criteria = [Measurement length, Measurement last, Measurement id]\nGHCi&gt; mconcat (comparingHet &lt;$&gt; criteria) \"aac\" \"abc\"\nLT\nGHCi&gt; foldMap comparingHet criteria \"aac\" \"abc\"  -- Alternative spelling.\nLT\n</code></pre>\n\n<p>Alternatively, you can use <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Functor-Contravariant.html#t:Comparison\" rel=\"nofollow noreferrer\"><code>Comparison</code> from <code>Data.Functor.Contravariant</code></a>, which is only a little bit less tidy:</p>\n\n<pre><code>GHCi&gt; import Data.Functor.Contravariant\nGHCi&gt; criteria = Comparison &lt;$&gt; [comparing length, comparing last, comparing id]\nGHCi&gt; getComparison (mconcat criteria) \"aac\" \"abc\"\nLT\n</code></pre>\n"}], "owner": {"reputation": 354, "user_id": 3777717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b2cf577b7fcab545f75f6e1bcc6ca72?s=128&d=identicon&r=PG&f=1", "display_name": "ByteEater", "link": "https://stackoverflow.com/users/3777717/byteeater"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1560646129, "creation_date": 1488942137, "question_id": 42662178, "link": "https://stackoverflow.com/questions/42662178/map-comparing-over-heterogeneous-criteria", "title": "Map comparing over heterogeneous criteria", "body": "<pre><code>mconcat (map comparing [length, last, id]) \"abc\" \"def\"\n</code></pre>\n\n<p>This of course doesn't typecheck. The list contains functions from the same domain to different codomains. But I hope the intent is clear. Can some type annotation or another workaround (not putting comparing in 3 places or something alike) make it work?</p>\n"}, {"tags": ["haskell", "monads", "comonad", "writer-monad"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1488931337, "post_id": 42660343, "comment_id": 72447116, "body": "Can you further motivate the need for <code>unsequence</code>? Why isn&#39;t binding and then pattern-matching on the resulting list (which, as you observe, will correctly propagate your dirty bit to any computation done with the list elements you bound in the pattern match) good enough?"}, {"owner": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1488932720, "post_id": 42660343, "comment_id": 72447492, "body": "Basically, it is a matter of convenience. I would like to use a mix of lifted and unlifted functions on individual values and lists. For example, some function could generate a list of elements of type [Int], then I would like to use binary function <code>f: CInt-&gt;Cint</code> to map over this list."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1488936642, "post_id": 42660343, "comment_id": 72448606, "body": "How does <code>unsequence</code> make that more convenient? For <code>action :: M [Int]</code> and <code>f :: Int -&gt; Int</code>, the two expressions are <code>map f &lt;$&gt; action</code>  and <code>mapM (f &lt;$&gt;) (unsequence action)</code>; of the two, I much prefer the former even before I look at whether <code>unsequence</code> is implementable or not. Or if you meant <code>f&#39; :: Int -&gt; M Int</code>, then the two are <code>action &gt;&gt;= mapM f&#39;</code> vs <code>mapM (&gt;&gt;= f&#39;) (unsequence action)</code>, and again I prefer the one that doesn&#39;t use <code>unsequence</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1488936858, "post_id": 42660343, "comment_id": 72448654, "body": "I&#39;m not saying <code>unsequence</code> is unwarranted. I am just encouraging you to try to sharpen your description of why it&#39;s needed -- the more clear your goals are, the better advice folks can give about how to achieve your goals!"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1488938191, "post_id": 42661517, "comment_id": 72449011, "body": "&quot;unsequence1 works because... it&#39;s actually sequence&quot;. My brains are leaking out my ears. This is way too cool."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1488939372, "post_id": 42661517, "comment_id": 72449316, "body": "@DanielWagner <code>Traversable</code> is a beautiful thing :)"}, {"owner": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "edited": false, "score": 0, "creation_date": 1488944777, "post_id": 42661517, "comment_id": 72450843, "body": "Thank you for the excellent answer! It was indeed surprising that two seemingly inverse operations could be both mapped to <code>sequence</code>!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "edited": false, "score": 0, "creation_date": 1557387295, "post_id": 42661517, "comment_id": 98749427, "body": "@krokodil matrix transpose function is its own inverse."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1491193715, "last_edit_date": 1495541854, "creation_date": 1488937524, "answer_id": 42661517, "question_id": 42660343, "link": "https://stackoverflow.com/questions/42660343/writer-monad-and-unsequence/42661517#42661517", "title": "Writer monad and unsequence", "body": "<blockquote>\n  <p>The <code>ex1</code> produces correct value, while <code>ex2</code> output is incorrectly not preserving collision flag:</p>\n</blockquote>\n\n<p><code>unsequence</code> (and, as a consequence, <code>ex2</code>) doesn't work because it throws away the <code>Writer</code> log.</p>\n\n<pre><code>unsequence :: (Comonad w, Monad m) =&gt; w [a] -&gt; [m a]\nunsequence = map return . extract\n</code></pre>\n\n<p><code>extract</code> for your <code>Comonad</code> instance gives the result of the computation, discarding the log. <code>return</code> adds a <code>mempty</code> log to the bare results. That being so, the flags are cleared in <code>ex2</code>.</p>\n\n<p><code>unsequence1</code>, on the other hand, does what you want. That clearly doesn't have anything to do with <code>Comonad</code> (your definition doesn't use its methods); rather, <code>unsequence1</code> works because... it's actually <code>sequence</code>! Under the hood, <code>Writer</code> is just a pair of a result and a (monoidal) log. If you have a second look at <code>unsequence1</code> with that in mind, you will note that (modulo irrelevant details) it does essentially the same thing than <code>sequence</code> for pairs -- it annotates the values in the other functor with the log:</p>\n\n<pre><code>GHCi&gt; sequence (3, [1..10])\n[(3,1),(3,2),(3,3),(3,4),(3,5),(3,6),(3,7),(3,8),(3,9),(3,10)]\n</code></pre>\n\n<p>In fact, <code>Writer</code> already has a <code>Traversable</code> instance just like that, so you don't even need to define it:</p>\n\n<pre><code>GHCi&gt; import Control.Monad.Writer\nGHCi&gt; import Data.Monoid -- 'Any' is your 'Bool' monoid.\nGHCi&gt; el = tell (Any True) &gt;&gt; return [1,2,3] :: Writer Any [Int]\nGHCi&gt; sequence el\n[WriterT (Identity (1,Any {getAny = True})),WriterT (Identity (2,Any {getAny = True})),WriterT (Identity (3,Any {getAny = True}))]\n</code></pre>\n\n<p>It is worth mentioning that <code>sequence</code> isn't an essentially monadic operation -- the <code>Monad</code> constraint in <code>sequence</code> is unnecessarily restrictive. The real deal is <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Traversable.html\" rel=\"nofollow noreferrer\"><code>sequenceA</code></a>, which only requires an <code>Applicative</code> constraint on the inner functor. (If the outer <code>Functor</code> -- i.e. the one with the <code>Traversable</code> instance -- is like <code>Writer w</code> in that it always \"holds\" exactly one value, then you don't even need <code>Applicative</code>, but <a href=\"https://stackoverflow.com/q/31978596/2751851\">that's another story</a>.)</p>\n\n<blockquote>\n  <p>Is it possible to define 'unsequence' using monadic and comonadic operators, not specific to 'Writer'</p>\n</blockquote>\n\n<p>As discussed above, you don't actually want <code>unsequence</code>. There is a class called <a href=\"https://hackage.haskell.org/package/distributive-0.5.2/docs/Data-Distributive.html\" rel=\"nofollow noreferrer\"><code>Distributive</code></a> that does provide <code>unsequence</code> (under the name of <code>distribute</code>); however, there is relatively little overlap between things with <code>Distributive</code> instances and things with <code>Traversable</code> ones, and in any case it doesn't essentially involve comonads.</p>\n\n<blockquote>\n  <p>Is there is a more elegant implementatoin of extend function above, perhaps similar to this one?</p>\n</blockquote>\n\n<p>Your <code>Comonad</code> instance is fine (it does follow <a href=\"https://hackage.haskell.org/package/comonad-5/docs/Control-Comonad.html#t:Comonad\" rel=\"nofollow noreferrer\">the comonad laws</a>), except that you don't actually need the <code>Monoid</code> constraint in it. The pair comonad is usually known as <a href=\"https://hackage.haskell.org/package/comonad-5/docs/Control-Comonad-Trans-Env.html#t:EnvT\" rel=\"nofollow noreferrer\"><code>Env</code></a>; see <a href=\"https://stackoverflow.com/a/42311754/2751851\">this answer</a> for discussion of what it does. </p>\n"}], "owner": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 42661517, "answer_count": 1, "score": 0, "last_activity_date": 1491193715, "creation_date": 1488929555, "last_edit_date": 1495539985, "question_id": 42660343, "link": "https://stackoverflow.com/questions/42660343/writer-monad-and-unsequence", "title": "Writer monad and unsequence", "body": "<p>I am using the <code>Writer</code> monad to keep track of an error (\"collision\") flag on arbitrary values (such as <code>Int</code>). Once the flag is set it is \"sticky\" and attaches itself to all values produced as a result of any operation with the marked one.</p>\n\n<p>Sometimes the collision flag is associated with individual values, sometimes I would like to associate with composite structures such as lists. Of course, once the collision flag is set for a whole list, it also makes sense to assume it is set for an individual element. So for a writer monad <code>m</code> I need the two following operations:</p>\n\n<pre><code>sequence :: [m a] -&gt; m [a]\nunsequence :: m [a] -&gt; [m a]\n</code></pre>\n\n<p>The first one is defined in the Prelude, while the second one has to be defined. <a href=\"https://stackoverflow.com/questions/27342863/unsequence-monad-function-within-haskell\" title=\"Here\">Here</a> is a good discussion of how it could be defined using <em>comonads</em>. A native comonad implementation does not preserve the state. Here is an example:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\n\nmodule Foo where    \n\nimport Control.Monad.Writer\nimport Control.Comonad\n\nunsequence :: (Comonad w, Monad m) =&gt; w [a] -&gt; [m a]\nunsequence = map return . extract\n\ninstance Monoid Bool where\n    mempty = False\n    mappend = (||)\n\ntype CM = Writer Bool\ntype CInt = CM Int\n\ninstance (Monoid w) =&gt; Comonad (Writer w) where\n    extract x = fst $ runWriter x\n    extend f wa = do { tell $ execWriter wa ; return (f wa)}\n\nmkCollision :: t -&gt; Writer Bool t\nmkCollision x = do (tell True) ; return x\n\nunsequence1 :: CM [Int] -&gt; [CInt]\nunsequence1 a = let (l,f) = runWriter a in\n              map (\\x -&gt; do { tell f ; return x}) l\n\nel = mkCollision [1,2,3]\n\nex2:: [CInt]      \nex2 = unsequence el\nex1 = unsequence1 el\n</code></pre>\n\n<p>The <code>ex1</code> produces the correct value, while <code>ex2</code> output is incorrectly not preserving collision flag:</p>\n\n<pre><code>*Foo&gt; ex1\n[WriterT (Identity (1,True)),WriterT (Identity (2,True)),WriterT (Identity (3,True))]\n*Foo&gt; ex2\n[WriterT (Identity (1,False)),WriterT (Identity (2,False)),WriterT (Identity (3,False))]\n*Foo&gt; \n</code></pre>\n\n<p>In view of this I have 2 questions:</p>\n\n<ol>\n<li>Is it possible to define <code>unsequence</code> using monadic and comonadic operators, not specific to <code>Writer</code>?</li>\n<li>Is there is a more elegant implementation of the <code>extend</code> function above, perhaps similar to <a href=\"https://www.olivierverdier.com/posts/2014/12/31/reader-writer-monad-comonad/\" rel=\"nofollow noreferrer\" title=\"this one\">this one</a>?</li>\n</ol>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "idioms", "pointfree"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 5, "creation_date": 1488928597, "post_id": 42660083, "comment_id": 72446217, "body": "Seems a bit obvious, but what about an operator section - <code>(:[])</code>. 5 characters, technically longer than <code>pure</code> but it certainly better expresses the intent of &#39;making a singleton list&#39;."}, {"owner": {"reputation": 5408, "user_id": 1793220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Onk4P.jpg?s=128&g=1", "display_name": "Hisham H M", "link": "https://stackoverflow.com/users/1793220/hisham-h-m"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1488929271, "post_id": 42660083, "comment_id": 72446469, "body": "Indeed, solutions using <code>return</code> or <code>pure</code> are interesting because they look beyond the list, but I agree that <code>(:[])</code> represents the intent in that particular case better!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1488931866, "post_id": 42660083, "comment_id": 72447258, "body": "@user2407038 I think I saw that called the &quot;monkey head operator&quot; a few years ago. I&#39;d guess it&#39;s fairly idiomatic."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1488957017, "post_id": 42660083, "comment_id": 72455302, "body": "I does indeed look like a monkey head ! Lol"}], "answers": [{"tags": [], "owner": {"reputation": 5408, "user_id": 1793220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Onk4P.jpg?s=128&g=1", "display_name": "Hisham H M", "link": "https://stackoverflow.com/users/1793220/hisham-h-m"}, "is_accepted": false, "score": 3, "last_activity_date": 1488948435, "last_edit_date": 1488948435, "creation_date": 1488928510, "answer_id": 42660143, "question_id": 42660083, "link": "https://stackoverflow.com/questions/42660083/what-is-the-idiomatic-way-to-refer-to-a-singleton-list-constructor-in-haskell/42660143#42660143", "title": "What is the idiomatic way to refer to a singleton list constructor in Haskell?", "body": "<p>Just found the answer, thanks to <a href=\"http://pointfree.io\" rel=\"nofollow noreferrer\">pointfree.io</a>, which was linked to in another question. A nice, point-free way to write <code>wrapAndG</code> is</p>\n\n<pre><code>wrapAndG = g . return\n</code></pre>\n\n<p>This uses the fact that lists are instances of <code>Monad</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 10, "last_activity_date": 1488928529, "creation_date": 1488928529, "answer_id": 42660150, "question_id": 42660083, "link": "https://stackoverflow.com/questions/42660083/what-is-the-idiomatic-way-to-refer-to-a-singleton-list-constructor-in-haskell/42660150#42660150", "title": "What is the idiomatic way to refer to a singleton list constructor in Haskell?", "body": "<p>For lists <code>pure</code> does what you want:</p>\n\n<pre><code>wrapAndG = g . pure\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 10, "last_activity_date": 1488932912, "last_edit_date": 1495539990, "creation_date": 1488932912, "answer_id": 42660855, "question_id": 42660083, "link": "https://stackoverflow.com/questions/42660083/what-is-the-idiomatic-way-to-refer-to-a-singleton-list-constructor-in-haskell/42660855#42660855", "title": "What is the idiomatic way to refer to a singleton list constructor in Haskell?", "body": "<p>Echoing the <a href=\"https://stackoverflow.com/questions/42660083/what-is-the-idiomatic-way-to-refer-to-a-singleton-list-constructor-in-haskell#comment72446217_42660083\">comments</a> by user2407038 and chi, <code>(:[])</code> is a fine way of spelling it if you want something specific to lists:</p>\n\n<pre><code>wrapAndG = g . (:[])\n</code></pre>\n"}], "owner": {"reputation": 5408, "user_id": 1793220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Onk4P.jpg?s=128&g=1", "display_name": "Hisham H M", "link": "https://stackoverflow.com/users/1793220/hisham-h-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 679, "favorite_count": 0, "accepted_answer_id": 42660855, "answer_count": 3, "score": 4, "last_activity_date": 1488948435, "creation_date": 1488928220, "question_id": 42660083, "link": "https://stackoverflow.com/questions/42660083/what-is-the-idiomatic-way-to-refer-to-a-singleton-list-constructor-in-haskell", "title": "What is the idiomatic way to refer to a singleton list constructor in Haskell?", "body": "<p>Short form: is there a more idiomatic way to write <code>(\\a-&gt;[a])</code> ?</p>\n\n<p>Long form: For any data type <code>Foo a</code>, if I have a function <code>f :: Foo a -&gt; b</code> and I need to write something like...</p>\n\n<pre><code>wrapAndF a = f $ Foo a\n</code></pre>\n\n<p>...I can make it point-free by writing</p>\n\n<pre><code>wrapAndF = f . Foo\n</code></pre>\n\n<p>But if my function <code>g :: [a] -&gt; b</code> operates on lists and my wrapper looks like this...</p>\n\n<pre><code>wrapAndG a = g [a]\n</code></pre>\n\n<p>...what is the most idiomatic way to write it point-free? I know I can write an explicit lambda:</p>\n\n<pre><code>wrapAndG = g . (\\x-&gt;[x])\n</code></pre>\n\n<p>or, mirroring the use of the constructor in the Foo example, use the list constructor <code>(:)</code>, but then I have to flip the arguments:</p>\n\n<pre><code>wrapAndG = g . flip (:) []\n</code></pre>\n\n<p>...but what is the idiomatic way to refer to the singleton list constructor function? I expected to find a standard function with signature <code>a -&gt; [a]</code>, but I couldn't find it on Hoogle or Data.List.</p>\n\n<p>There is of course the alternative of simply not writing it point-free (and that is certainly a valid answer) but since passing type constructors around as wrapper functions seems really useful, it felt odd that I couldn't find a standard function to wrap a value into a list, so I figured I may be missing something.</p>\n"}, {"tags": ["haskell", "monads", "lazy-evaluation"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1488918057, "post_id": 42657529, "comment_id": 72440996, "body": "Related, but probably not a duplicate: <a href=\"http://stackoverflow.com/questions/6647852/haskell-actual-io-monad-implementation-in-different-language\" title=\"haskell actual io monad implementation in different language\">stackoverflow.com/questions/6647852/&hellip;</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1488919212, "post_id": 42657529, "comment_id": 72441663, "body": "Also related: <a href=\"http://stackoverflow.com/q/12226624/2751851\"><i>Newbie: understanding main and IO()</i></a>"}, {"owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "edited": false, "score": 0, "creation_date": 1602079129, "post_id": 42657529, "comment_id": 113606806, "body": "Possibly related: <a href=\"https://stackoverflow.com/questions/41829618/functional-programming-where-does-the-side-effect-actually-happen\" title=\"functional programming where does the side effect actually happen\">stackoverflow.com/questions/41829618/&hellip;</a> ."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1488922547, "post_id": 42657942, "comment_id": 72443468, "body": "<code>RealWorld</code> is fake.  I didn&#39;t know Haskell was so philosophical"}], "tags": [], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "is_accepted": false, "score": 0, "last_activity_date": 1488967370, "last_edit_date": 1488967370, "creation_date": 1488919329, "answer_id": 42657942, "question_id": 42657529, "link": "https://stackoverflow.com/questions/42657529/difference-between-evaluating-and-performing-io-actions-what-causes-haskell-to/42657942#42657942", "title": "Difference between evaluating and performing IO actions: what causes Haskell to perform IO?", "body": "<p>According to <a href=\"https://wiki.haskell.org/IO_inside#Welcome_to_the_RealWorld.2C_baby\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/IO_inside#Welcome_to_the_RealWorld.2C_baby</a>, there is a \"fake\" type that represents the real world, <code>RealWorld</code>, and <code>IO (a)</code> is actually a function.</p>\n\n<pre><code>type IO a  =  RealWorld -&gt; (a, RealWorld)\n</code></pre>\n\n<p>So <code>main</code>, as you might expect in other languages, is actually a function</p>\n\n<pre><code>main :: RealWorld -&gt; ((), RealWorld)\n</code></pre>\n\n<p>that is called when the program runs. So to evaluate the final output, which is of type <code>((), RealWorld)</code>, Haskell needs to get the value of the <code>RealWorld</code> component, and in order to do that, it must run the <code>main</code> function. Note: it's the runtime that cause this function to run. There is no way in Haskell to trigger the execution of this function.</p>\n\n<p>In the case of</p>\n\n<pre><code>main = getLine &gt;&gt;= putStrLn &gt;&gt; getLine &gt;&gt;= putStrLn\n</code></pre>\n\n<p>each of the actions are actually functions, and to work out the <code>RealWorld</code> value output at the end of the final <code>putStrLn</code>, it would need to run it, and all the actions leading up to it.</p>\n\n<p>So it <em>is</em> lazy evaluation, but of the <em>hidden</em> <code>RealWorld</code> value.</p>\n"}, {"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 12, "last_activity_date": 1488924015, "last_edit_date": 1488924015, "creation_date": 1488919437, "answer_id": 42657972, "question_id": 42657529, "link": "https://stackoverflow.com/questions/42657529/difference-between-evaluating-and-performing-io-actions-what-causes-haskell-to/42657972#42657972", "title": "Difference between evaluating and performing IO actions: what causes Haskell to perform IO?", "body": "<p>As a first order approximation, the <em>only</em> source of evaluation in a Haskell program is <code>main</code>. What that means is that:</p>\n\n<ul>\n<li><code>IO</code> actions can be assembled and composed through <code>&gt;&gt;=</code>, <code>&gt;&gt;</code>, <code>&lt;*&gt;</code>, <code>fmap</code>, etc to produce any other <code>IO</code> actions but</li>\n<li>only the <code>main</code> <code>IO</code> action will ever produce effects.</li>\n</ul>\n\n<p>In a sense all a Haskell program ever does is run <code>main :: IO ()</code>. For anything to be evaluated, it has to stand in the way of running the <code>IO</code> action (this is where laziness fits). That begs the question: <em>what does it mean to actually run an <code>IO</code> action</em>?</p>\n\n<p>Under the hood, <code>IO</code> ends up behaving like a (strict) <code>State</code> monad that threads through it a <a href=\"https://hackage.haskell.org/package/ghc-prim-0.5.0.0/docs/GHC-Prim.html#t:RealWorld\" rel=\"noreferrer\"><code>RealWorld</code></a> state (which contains no information - it is symbolic of the state that side-effects encompass on the world), so \"running\" <code>IO</code> (sort of equivalent to <code>State RealWorld</code>) is like calling <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-State-Lazy.html#v:runState\" rel=\"noreferrer\"><code>runState</code></a>. Naturally, this <code>runState</code> can occur only once for any program - and this is exactly what <code>main</code> does (and what makes it magical)!</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 8, "last_activity_date": 1488923896, "last_edit_date": 1488923896, "creation_date": 1488923137, "answer_id": 42658936, "question_id": 42657529, "link": "https://stackoverflow.com/questions/42657529/difference-between-evaluating-and-performing-io-actions-what-causes-haskell-to/42658936#42658936", "title": "Difference between evaluating and performing IO actions: what causes Haskell to perform IO?", "body": "<p>It may seem strange, but running IO actions is actually outside the scope of ordinary Haskell language!<sup>1</sup></p>\n\n<p>The Haskell built in libraries provide \"basic\" IO actions like <code>getLine :: IO String</code>, functions that return IO actions like <code>putStrLn :: String -&gt; IO ()</code>, and ways of building IO actions out of other IO actions (mostly by providing a <code>Monad</code> interface, so anything that works on any monad like all the stuff in <code>Control.Monad</code> is a way of working with <code>IO</code>).</p>\n\n<p>All of that is pure and lazy, in exactly the same way that non-IO Haskell code is. <code>IO</code> is <em>not</em> a special case for anything you can do with ordinary Haskell code (which is why you can use Monad-generic code on IO; all that code is written and compiled without any knowledge of any special rules that IO has, so it could only work if there aren't any).</p>\n\n<p>But none of that actually ever performs an IO action; it just makes new IO actions out of other ones. This is what people mean when they talk about how \"evaluating an IO action doesn't produce an effect\". A value <code>\"apple\" ++ \"banana\"</code> of type <code>String</code> can be represented by an unevaluated thunk; when it gets evaluated to <code>\"applebanana\"</code> it still represents exactly the same value, the system just has it recorded as data in memory rather than a pointer to some code that could be run to produce it<sup>1</sup>. In exactly the same way a value <code>putStrLn \"apple\" &gt;&gt; putStrLn \"banana\"</code> of type <code>IO ()</code> can be represented by an unevaluated thunk, and when it gets evaluated all that means is that the system is now representing <em>that same value</em> with a data structure instead of a pointer to code that will run the (pure, lazy) function <code>&gt;&gt;</code> on two other IO actions. But we've only talked about the system's in-memory representation of the IO action, nothing about actually running them to produce some side effects.</p>\n\n<p>And there actually <strong>are</strong> no language features of Haskell that talk about how IO actions are performed. The runtime system \"just knows\" how to execute the <code>main</code> IO action from the <code>Main</code> module<sup>3</sup>. The Haskell language has no way of talking about how or whether that happens; that's all handled by the system that provides Haskell to you (GHC, or another Haskell system). The only option the Haskell language gives you is that <code>main</code> is defined as a Haskell action; any IO actions that you incorporate as part of the definition of <code>main</code> will get run.</p>\n\n<hr>\n\n<p><sup>1</sup> I'm pretending that things like <code>unsafePerformIO</code> do not exist for the purpose of this discussion. As the name implies, it <em>deliberately</em> breaks the normal rules. It's also not intended for introducing \"performing IO actions\" as a normal part of the Haskell language, but only for use in the internals of something that presents a \"normal Haskell\" interface.</p>\n\n<p><sup>2</sup> Usually this happens partially: only very basic types like <code>Int</code> are \"all-or-nothing\" evaluated. Most can be partially evaluated to data structures that contain thunks deeper down (which may or may not themselves get evaluated later).</p>\n\n<p><sup>3</sup> Or GHCi \"just knows\" how to execute IO actions that you enter at its prompt.</p>\n"}], "owner": {"reputation": 23111, "user_id": 1319998, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/9f600f4583bec89109ce8c0c098951ae?s=128&d=identicon&r=PG", "display_name": "Michal Charemza", "link": "https://stackoverflow.com/users/1319998/michal-charemza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 2, "answer_count": 3, "score": 6, "last_activity_date": 1488967370, "creation_date": 1488917927, "question_id": 42657529, "link": "https://stackoverflow.com/questions/42657529/difference-between-evaluating-and-performing-io-actions-what-causes-haskell-to", "title": "Difference between evaluating and performing IO actions: what causes Haskell to perform IO?", "body": "<p>What mechanism does Haskell use to actually decide to invoke the 4 actions below?</p>\n\n<pre><code>main :: IO ()\nmain = getLine &gt;&gt;= putStrLn &gt;&gt; getLine &gt;&gt;= putStrLn\n</code></pre>\n\n<p>Initially I thought it was to do with lazy evaluation, but... as from Real Word Haskell, about IO actions, they</p>\n\n<blockquote>\n  <p>produce an effect when performed, but not when evaluated</p>\n</blockquote>\n\n<p>So I suspect it's some other mechanism rather than the system wanting to \"evaluate\" <code>main</code>. What is this mechanism? Or if it is evaluation, what is Haskell \"wanting\" to evaluate that causes it to execute the chain of actions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488932624, "post_id": 42657004, "comment_id": 72447472, "body": "this reminds me of an issue I filed in the turtle library - <a href=\"https://github.com/Gabriel439/Haskell-Turtle-Library/issues/102\" rel=\"nofollow noreferrer\">github.com/Gabriel439/Haskell-Turtle-Library/issues/102</a> - the solution was to replace <code>&quot;&quot;</code> with <code>Text.empty</code> - I have not studied your problem thouroughly so I just post this as a comment."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1492527199, "post_id": 42657004, "comment_id": 74006173, "body": "interesting comment (and the linked issue) . I will try it, but do not expect too much, given that the empty string is here only in the error return."}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 165, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1488917181, "creation_date": 1488915984, "last_edit_date": 1488917181, "question_id": 42657004, "link": "https://stackoverflow.com/questions/42657004/getresponsebody-resultsin-hgetbuf-resource-vanished-connection-reset-by-peer", "title": "getResponseBody resultsin hGetBuf: resource vanished (Connection reset by peer)", "body": "<p>calling a slow (> secs) on the web with a HTTP call in haskell (package HTTP) works, but occasionally i experience an error <code>\"&lt;socket: 3&gt;: hGetBuf: resource vanished (Connection reset by peer)</code>. the same server served a dozen requests before and is available afterwards. what do is wrong? </p>\n\n<p>the code - with error catching to pinpoit the source of the problem - is </p>\n\n<pre><code>    callHTTP3 :: Http.Request B.ByteString -&gt; ErrIO Text\n-- | executes the HTTP call (e.g. simpleHTTP) and deals with first level of failure\ncallHTTP3 req = do\n        putIOwords [\"callHTTP3:\"]\n        body1 &lt;- callIO $  do\n                    -- body &lt;- Http.httpLBS req  -- would be from conduit\n                    response &lt;- Http.simpleHTTP req\n                    body &lt;-  Http.getResponseBody response\n                    return body\n                `catchError` \\(e) -&gt; do\n                    putIOwords [\"callHTTP3 error in simpleHTTP or getResponseBody\", showT e]\n                    fail . unwords $  [ \"callHTTP3 httperror 4\", show e]\n                    -- return . Left , unlines' $  [ \"callHTTP3 httperror 4 throw \", show e]\n        let body2 = checkUTF8 $ body1\n        putIOwords [\"callHTTP3:  show checked body\", showT body2]\n        return  body2\n    `catchError` (\\e -&gt; do\n            putIOwords [\"callHTTP3 error caught\", showT e] -- \" showT msg])\n            return \"\"\n            )\n</code></pre>\n"}, {"tags": ["haskell", "z3", "smt"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1488916038, "post_id": 42656147, "comment_id": 72439845, "body": "A rather wild guess: This Z3 monad has a <a href=\"https://hackage.haskell.org/package/z3-4.1.0/docs/Z3-Monad.html\" rel=\"nofollow noreferrer\"><code>MonadFix</code> instance</a>; it may well be possible to use it to specify the mutually recursive definition."}, {"owner": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488927875, "post_id": 42656147, "comment_id": 72445976, "body": "Thanks for the suggestion.  I&#39;ve never used MonadFix before, so perhaps I&#39;m just missing something, but unfortunately I&#39;m not sure it can solve this issue.  Because to correctly create the constructor for X using it, you must create Y, but to do that you need X... and so on.  It can never finish evaluating a function... but again perhaps I&#39;m using it wrong... thanks for the idea, I&#39;ll try and play around with it a bit more later."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1488940152, "post_id": 42656147, "comment_id": 72449543, "body": "Sorry -- I pasted the wrong link in that comment. I meant to link to <a href=\"https://wiki.haskell.org/MonadFix\" rel=\"nofollow noreferrer\">this page</a>, which gives a few usage examples for <code>MonadFix</code>. I&#39;m specifically thinking of the second example there, the one with two nodes that point at each other. It is possible that something in that vein will work for your use case (it will mainly depend on whether <code>mkConstructor</code> can build the value without looking &quot;into&quot; the reference to the other value)."}, {"owner": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488998450, "post_id": 42656147, "comment_id": 72482977, "body": "I see, thanks.  It&#39;s certainly quite interesting... Since it&#39;s basically a (relatively direct, I think) wrapper around a C function, and it has to feed all the information into Z3, I suspect I might not benefit much from laziness.  Definitely I&#39;ll experiment with it though!  Again, thanks."}, {"owner": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1489008878, "post_id": 42656147, "comment_id": 72488788, "body": "Unfortunately, it does <code>mkConstructor</code> has to look into the other values reference.  Thanks anyway though!"}], "owner": {"reputation": 343, "user_id": 6637204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/873781c7b317aaa81b4361cf4500fe6e?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/6637204/bill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 176, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1488913150, "creation_date": 1488913150, "question_id": 42656147, "link": "https://stackoverflow.com/questions/42656147/mutually-recursive-datatype-declaration-with-haskell-z3-api", "title": "Mutually recursive datatype declaration with Haskell Z3 API", "body": "<p>I'm attempting to use this Haskell package:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/z3\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/z3</a></p>\n\n<p>which is a wrapper of the Z3 C API, to work with mutually recursive datatypes.  As a test, I am attempting to convert the following SMT2 script to a Haskell function.</p>\n\n<pre><code>(declare-datatypes () ((X (a (y Y)) ac)\n                  (Y (b (x X)) bc)))\n\n(declare-const a_v (X))\n(declare-const b_v (Y))\n\n(assert (= a_v (a b_v)))\n\n(check-sat)\n(get-model)\n</code></pre>\n\n<p>Currently, the closest I can figure out how to get is:</p>\n\n<pre><code>mutuallyRecursive :: IO (Result, Maybe Model)\nmutuallyRecursive = evalZ3 mutuallyRecursive'\n    where\n        mutuallyRecursive' :: Z3 (Result, Maybe Model)\n        mutuallyRecursive' = do\n            x' &lt;- mkStringSymbol \"X\"\n            y' &lt;- mkStringSymbol \"Y\"\n            _x &lt;- mkStringSymbol \"x\"\n            _y &lt;- mkStringSymbol \"y\"\n\n            a' &lt;- mkStringSymbol \"a\"\n            ac' &lt;- mkStringSymbol \"ac\"\n            b' &lt;- mkStringSymbol \"b\"\n            bc' &lt;- mkStringSymbol \"bc\"\n\n            is_a &lt;- mkStringSymbol \"is-a\"\n            is_ac &lt;- mkStringSymbol \"is-ac\"\n            is_b &lt;- mkStringSymbol \"is-b\"\n            is_bc &lt;- mkStringSymbol \"is-bc\"\n\n            b &lt;- mkConstructor b' is_b [] --Should contain an X\n            bc &lt;- mkConstructor bc' is_bc []\n            y &lt;- mkDatatype y' [b, bc]\n\n            a  &lt;- mkConstructor a' is_a [(_x, Just y, 0)]\n            ac &lt;- mkConstructor ac' is_ac []\n            x &lt;- mkDatatype x' [a, ac]\n\n            a_v' &lt;- mkStringSymbol \"a_v\"\n            b_v' &lt;- mkStringSymbol \"b_v\"\n            a_v &lt;- mkConst a_v' x\n            b_v &lt;- mkConst b_v' y\n\n            [a_func, _] &lt;- getDatatypeSortConstructors x\n            a_b_v &lt;- mkApp a_func [b_v]\n\n            assert =&lt;&lt; mkEq a_v a_b_v\n\n            solverCheckAndGetModel\n</code></pre>\n\n<p>Note that the constructor b, of datatype Y, is incorrect in my Haskell implementation.  It is missing the argument of type X.  However, I cannot directly include the sort X, because it has not yet been declared.  But if I swap the order of the definitions of X and Y, I clearly run into the same problem, just reversed (i.e., I then need to, but cannot, reference Y in X.)</p>\n\n<p>Based on the definition of MkConstructor on this page (which concerns the C api, not the Haskell api):</p>\n\n<p><a href=\"http://z3prover.github.io/api/html/class_microsoft_1_1_z3_1_1_context.html#a2a421919ab766bf028ec422723b42e37\" rel=\"nofollow noreferrer\">http://z3prover.github.io/api/html/class_microsoft_1_1_z3_1_1_context.html#a2a421919ab766bf028ec422723b42e37</a></p>\n\n<p>I think maybe I have to pass something of the form [(symbol, Nothing, #)] to mkConstructor, where # is some non-zero identifier of datatype X.  But I'm not 100% sure that's right, and even if it is, I don't know how to obtain #.  Any help figuring this out would be greatly appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1488911851, "post_id": 42655596, "comment_id": 72437237, "body": "You could zip the indices with the rows/columns."}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 4583687, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/0lHfL.jpg?s=128&g=1", "display_name": "someoneb100", "link": "https://stackoverflow.com/users/4583687/someoneb100"}, "edited": false, "score": 0, "creation_date": 1488913042, "post_id": 42655987, "comment_id": 72437968, "body": "So i should remove <code>map</code> and perhaps iterate field to field with recursions version of <code>for (r=0,...,r++){for(c=0,...,c++)}</code>? I just hoped there is a recursion-friendly solution"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 141, "user_id": 4583687, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/0lHfL.jpg?s=128&g=1", "display_name": "someoneb100", "link": "https://stackoverflow.com/users/4583687/someoneb100"}, "edited": false, "score": 0, "creation_date": 1488931093, "post_id": 42655987, "comment_id": 72447040, "body": "@someoneb100, one useful function is <code>mapWithIndex :: (Int -&gt; a -&gt; b) -&gt; [a] -&gt; [b]</code>. You can similarly write indexed versions of <code>foldMap</code> and <code>traverse</code>."}], "tags": [], "owner": {"reputation": 1, "user_id": 7662334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63e39249f490bf35d8fe6c57668015d2?s=128&d=identicon&r=PG&f=1", "display_name": "Beemo", "link": "https://stackoverflow.com/users/7662334/beemo"}, "is_accepted": false, "score": 0, "last_activity_date": 1488912540, "creation_date": 1488912540, "answer_id": 42655987, "question_id": 42655596, "link": "https://stackoverflow.com/questions/42655596/how-to-know-in-haskell-in-what-row-and-column-of-a-table-a-you-are/42655987#42655987", "title": "How to know in Haskell in what row and column of a table ([[a]]) you are", "body": "<p><code>[[Int]]</code> is a good type for a sodoku. But map does not give any info regarding the place it is in. This is one of the ideas behind map. </p>\n\n<p>You could zip together the index with the value. But a better idea would be to pass the whole <code>[[Int]]</code> and the indexes to to the function. So its type would become:</p>\n\n<pre><code>f :: [[Int]] -&gt; Int -&gt; Int -&gt; [[Int]]\n</code></pre>\n\n<p>inside the function you can now access the current element by</p>\n\n<pre><code>t !! x !! y\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "reply_to_user": {"reputation": 141, "user_id": 4583687, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/0lHfL.jpg?s=128&g=1", "display_name": "someoneb100", "link": "https://stackoverflow.com/users/4583687/someoneb100"}, "edited": false, "score": 0, "creation_date": 1488913469, "post_id": 42656124, "comment_id": 72438240, "body": "I did not want to spoil it to you. If you want more details just indicate so :)"}, {"owner": {"reputation": 141, "user_id": 4583687, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/0lHfL.jpg?s=128&g=1", "display_name": "someoneb100", "link": "https://stackoverflow.com/users/4583687/someoneb100"}, "edited": false, "score": 0, "creation_date": 1488915303, "post_id": 42656124, "comment_id": 72439382, "body": "So this would be part of the &quot;guessing&quot; algorithm once the proper one is done (It&#39;s a strict set of rules, i doubt it&#39;s less efficient ). Would it be practical to turn the sudoku table into a graph with 81 nodes, and each node having it&#39;s value and pointers to the 20 other fields it should not have the same value as? I am trying to replicate the map colouring problem, but am perhaps doing it roughly."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "reply_to_user": {"reputation": 141, "user_id": 4583687, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/0lHfL.jpg?s=128&g=1", "display_name": "someoneb100", "link": "https://stackoverflow.com/users/4583687/someoneb100"}, "edited": false, "score": 0, "creation_date": 1488917123, "post_id": 42656124, "comment_id": 72440498, "body": "Normally, you would make every cell a list of all possibilities, i.e. <code>[1..9]</code> initially, over time you would remove possibilities that are in conflict with neighboring cells, when a cell becomes unit (i.e. a list of length 1, you can <i>unit propagate</i> this fact to remove possibilities in neighboring cells). When a cell becomes empty, you found a dead end and need to <i>backtrack</i> in your search. So it is fine to represent the partial solution with a table of cells that instead of being either 0 or a definitive digit keep all the possibilities."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "reply_to_user": {"reputation": 141, "user_id": 4583687, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/0lHfL.jpg?s=128&g=1", "display_name": "someoneb100", "link": "https://stackoverflow.com/users/4583687/someoneb100"}, "edited": false, "score": 0, "creation_date": 1488917347, "post_id": 42656124, "comment_id": 72440611, "body": "Whenever you cannot propagate any more facts, you make a non-deterministic guess (i.e. you resort to a primitive search). Eventually (if the initial state of the sudoku did not include conflicts) you will end up with a table where every cell has exactly one possibility, which is your solution. So the initial state of a sudoku already fixes some of the cells to singleton lists. The fact that you model each cell with a list of possibilities is closely related to <i>domain allocation</i> from CSP."}], "tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": true, "score": 3, "last_activity_date": 1488957788, "last_edit_date": 1488957788, "creation_date": 1488913084, "answer_id": 42656124, "question_id": 42655596, "link": "https://stackoverflow.com/questions/42655596/how-to-know-in-haskell-in-what-row-and-column-of-a-table-a-you-are/42656124#42656124", "title": "How to know in Haskell in what row and column of a table ([[a]]) you are", "body": "<p>I know this is not really an answer to your question, but I would argue, that usually you would want a different representation (one that keeps a more detailed view of what you know about the sudoku puzzle, in your attempted solution you can only distinguish a solved cell from a cell that is free to assume any value). Sudoku is a classical instance of <a href=\"https://en.wikipedia.org/wiki/Constraint_satisfaction_problem\" rel=\"nofollow noreferrer\">CSP</a>. Where modern approaches offer many fairly general smart <em>propagation</em> rules, such as <em>unit propagation</em> (blocking a digit in neighboring cells once used somewhere), but also many other, see <a href=\"https://en.wikipedia.org/wiki/AC-3_algorithm\" rel=\"nofollow noreferrer\">AC-3</a> for further details. Other related topics include <a href=\"https://en.wikipedia.org/wiki/Boolean_satisfiability_problem\" rel=\"nofollow noreferrer\">SAT</a>/<a href=\"https://en.wikipedia.org/wiki/Satisfiability_modulo_theories\" rel=\"nofollow noreferrer\">SMT</a> and you might find the algorithm <a href=\"https://en.wikipedia.org/wiki/DPLL_algorithm\" rel=\"nofollow noreferrer\">DPLL</a> also interesting. In the heart of most solvers there usually is some kind of a <a href=\"https://en.wikipedia.org/wiki/Combinatorial_search\" rel=\"nofollow noreferrer\">search</a> engine to deal with non-determinism (not every instance must have a single solution that is directly derivable from the initial configuration of the instance by application of inference rules). There are also techniques such as <a href=\"https://en.wikipedia.org/wiki/Conflict-Driven_Clause_Learning\" rel=\"nofollow noreferrer\">CDCL</a> to direct the search.</p>\n\n<hr>\n\n<p>To address the question in the title, to know where you are, its probably best if you abstract the traversal of your <em>table</em> so that each step has access to the coordinates, you can for example <code>zip</code> a list of rows with <code>[0..]</code> (<code>zip [0..] rows</code>) to number the rows, when you then <code>map</code> a function over the zipped lists, you will have access to pairs <code>(index, row)</code>, the same applies to columns. Just a sketch of the idea:</p>\n\n<pre><code>mapTable :: (Int -&gt; Int -&gt; a -&gt; b) -&gt; [[a]] -&gt; [[b]]\nmapTable f rows = map (\\(r, rs) -&gt; mapRow (f r) rs) $ zip [0..] rows\n\nmapRow :: (Int -&gt; a -&gt; b) -&gt; [a] -&gt; [b]\nmapRow f cols = map (uncurry f) $ zip [0..] cols\n</code></pre>\n\n<p>or use <code>fold</code> to turn your table into something else (for example to search for a <em>unit cell</em>):</p>\n\n<pre><code>foldrTable :: (Int -&gt; Int -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; [[a]] -&gt; b\nfoldrTable f z rows = foldr (\\(r, rs) b -&gt; foldrRow (f r) b rs) z $ zip [0..] rows\n\nfoldrRow :: (Int -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldrRow f z cols = foldr (uncurry f) z $ zip [0..] cols\n</code></pre>\n\n<p>to find which cell is <em>unital</em>:</p>\n\n<pre><code>foldrTable\n    (\\x y v acc -&gt; if length v == 1 then Just (x, y) else acc)\n    Nothing\n    [[[1..9],[1..9],[1..9]],[[1..9],[1..9],[1..9]],[[1..9],[1],[1..9]]]\n</code></pre>\n\n<p>by using <code>Monoid</code> you can refactor it:</p>\n\n<pre><code>import Data.Monoid\n\nfoldrTable' :: Monoid b =&gt; (Int -&gt; Int -&gt; a -&gt; b) -&gt; [[a]] -&gt; b\nfoldrTable' f rows = foldrTable (\\r c a b -&gt; b &lt;&gt; f r c a) mempty rows\n\nunit :: Int -&gt; Int -&gt; [a] -&gt; Maybe (Int, Int)\nunit x y c | length c == 1 = Just (x, y)\n           | otherwise     = Nothing\n\nfirstUnit :: [[[a]]] -&gt; Maybe (Int, Int)\nfirstUnit = getFirst . foldrTable' (\\r c v -&gt; First $ unit r c v)\n</code></pre>\n\n<p>so now you would do</p>\n\n<pre><code>firstUnit [[[1..9],[1..9],[1..9]],[[1,2],[3,4],[5]]]\n</code></pre>\n\n<p>to obtain</p>\n\n<pre><code>Just (1, 2)\n</code></pre>\n\n<p>correctly determining that the first unit cell is at position <code>1,2</code> in the table.</p>\n"}, {"tags": [], "owner": {"reputation": 5008, "user_id": 5762796, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b3acb5c2021f4c279f29d61481b28e15?s=128&d=identicon&r=PG&f=1", "display_name": "Aleph0", "link": "https://stackoverflow.com/users/5762796/aleph0"}, "is_accepted": false, "score": 0, "last_activity_date": 1491293795, "creation_date": 1491293795, "answer_id": 43201805, "question_id": 42655596, "link": "https://stackoverflow.com/questions/42655596/how-to-know-in-haskell-in-what-row-and-column-of-a-table-a-you-are/43201805#43201805", "title": "How to know in Haskell in what row and column of a table ([[a]]) you are", "body": "<p>Already did this a while ago as a learning example. It is definitely not the nicest solution, but it worked for me.</p>\n\n<pre><code>import Data.List\nimport Data.Maybe\nimport Data.Char\n\nsodoku=\"\\\n \\-9-----1-\\\n \\8-4-2-3-7\\\n \\-6-9-7-2-\\\n \\--5-3-1--\\\n \\-7-5-1-3-\\\n \\--3-9-8--\\\n \\-2-8-5-6-\\\n \\1-7-6-4-9\\\n \\-3-----8-\"\n\nsodoku2=\"\\\n\\----13---\\\n\\7-5------\\\n\\1----547-\\\n\\--418----\\\n\\951-67843\\\n\\-2---4--1\\\n\\-6235-9-7\\\n\\--7-98--4\\\n\\89----1-5\"\n\ndata Position = Position (Int, Int) deriving (Show)\n\ndata Sodoku = Sodoku [Int] \n\ninsertAtN :: Int -&gt; a -&gt; [a] -&gt; [a]\ninsertAtN n y xs = intercalate [y] . groups n $ xs\n  where\n    groups n xs = takeWhile (not.null) . unfoldr (Just . splitAt n) $ xs\n\ninstance Show Sodoku where\n   show (Sodoku s) = (insertAtN 9 '\\n' $ map intToDigit s) ++ \"\\n\"\n\nconvertDigit :: Char -&gt; Int\nconvertDigit x = case x of \n    '-' -&gt; 0\n    x -&gt; if digit&gt;=1 &amp;&amp; digit&lt;=9 then\n            digit\n         else\n            0\n         where digit=digitToInt x\n\nconvertSodoku :: String -&gt; Sodoku\nconvertSodoku x = Sodoku $ map convertDigit x\n\nadjacentFields :: Position -&gt; [Position]\nadjacentFields (Position (x,y)) = \n    [Position (i,y) | i&lt;-[0..8]] ++ \n    [Position (x,j) | j&lt;-[0..8]] ++ \n    [Position (u+i,v+j) | i&lt;-[0..2], j&lt;-[0..2]] \n    where \n        u=3*(x `div` 3)\n        v=3*(y `div` 3)\n\npositionToField :: Position -&gt; Int\npositionToField (Position (x,y)) = x+y*9\n\nfieldToPosition :: Int -&gt; Position\nfieldToPosition x = Position (x `mod` 9, x `div` 9)\n\ngetDigit :: Sodoku -&gt; Position -&gt; Int\ngetDigit (Sodoku x) pos = x !! (positionToField pos )\n\ngetAdjacentDigits :: Sodoku -&gt; Position -&gt; [Int]\ngetAdjacentDigits s p = nub digitList \n    where \n        digitList=filter (\\x-&gt;x/=0) $ map (getDigit s) (adjacentFields p)\n\ngetFreePositions :: Sodoku -&gt; [Position]\ngetFreePositions (Sodoku x) = map fieldToPosition $ elemIndices 0 x\n\nisSolved :: Sodoku -&gt; Bool\nisSolved s = (length $ getFreePositions s)==0\n\nisDeadEnd :: Sodoku -&gt; Bool\nisDeadEnd s = any (\\x-&gt;x==0) $ map length $ map (getValidDigits s)$ getFreePositions s\n\nsetDigit :: Sodoku -&gt; Position -&gt; Int -&gt; Sodoku\nsetDigit (Sodoku x) pos digit = Sodoku $ h ++ [digit] ++ t\n    where \n        field=positionToField pos\n        h=fst $ splitAt field x\n        t=tail$ snd $ splitAt field x\n\ngetValidDigits :: Sodoku -&gt; Position -&gt; [Int]        \ngetValidDigits s p = [1..9] \\\\ (getAdjacentDigits s p)\n\n\n-- Select numbers with few possible choices first to increase execution time       \nsortImpl :: (Position, [Int]) -&gt; (Position, [Int]) -&gt; Ordering\nsortImpl (_, i1) (_, i2) \n    | length(i1)&lt;length(i2) = LT\n    | length(i1)&gt;length(i2) = GT\n    | length(i1)==length(i2) = EQ\n\nselectMoves :: Sodoku -&gt; Maybe (Position, [Int])\nselectMoves s\n    | length(posDigitList)&gt;0 = Just (head posDigitList)\n    | otherwise = Nothing\n    where\n        posDigitList=sortBy sortImpl $ zip freePos validDigits\n        validDigits=map (getValidDigits s) freePos\n        freePos=getFreePositions s\n\ncreateMoves :: Sodoku -&gt; [Sodoku]\ncreateMoves s=\n    case selectMoves s of\n        Nothing -&gt; []\n        (Just (pos, digits)) -&gt; [setDigit s pos d|d&lt;-digits] \n\nsolveStep :: Sodoku -&gt; [Sodoku]\nsolveStep s \n    | (isSolved s) = [s]\n    | (isDeadEnd s )==True = []\n    | otherwise = createMoves s \n\nsolve :: Sodoku -&gt; [Sodoku]        \nsolve s \n    | (isSolved s) = [s]\n    | (isDeadEnd s)==True = []\n    | otherwise=concat $ map solve (solveStep s)\n\n\ns=convertSodoku sodoku2\n\nreadSodoku :: String -&gt; Sodoku\nreadSodoku x = Sodoku []\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 4583687, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/0lHfL.jpg?s=128&g=1", "display_name": "someoneb100", "link": "https://stackoverflow.com/users/4583687/someoneb100"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 836, "favorite_count": 0, "accepted_answer_id": 42656124, "answer_count": 3, "score": 1, "last_activity_date": 1491293795, "creation_date": 1488911127, "question_id": 42655596, "link": "https://stackoverflow.com/questions/42655596/how-to-know-in-haskell-in-what-row-and-column-of-a-table-a-you-are", "title": "How to know in Haskell in what row and column of a table ([[a]]) you are", "body": "<p>I want to make a sudoku solver in Haskell (as an exercise). My idea is:</p>\n\n<p>I have <code>t :: [[Int]]</code> representing a 9x9 grid so that it contains 0 in an empty field and 1-9 in a solved field. </p>\n\n<p>A function <code>solve :: [[Int]] -&gt; [[Int]]</code> returns the solved sudoku.</p>\n\n<p>Here is a rough sketch of it (i'd like to point out i'm a beginner, i know it is not the most optimal code):</p>\n\n<pre><code>solve :: [[Int]] -&gt; [[Int]]\nsolve t\n        | null (filter (elem 0) t) = t\n        | t /= beSmart t           = solve (beSmart t)\n        | otherwise                = guess t\n</code></pre>\n\n<p>The function <code>beSmart :: [[Int]] -&gt; [[Int]]</code> tries to solve it by applying some solving algorithms, but if methodical approach fails (<code>beSmart</code> returns the unchanged sudoku table in that case) it should try to guess some numbers (and i'll think of that function later). In order to fill in an empty field, i have to find it first. And here's the problem:</p>\n\n<pre><code>beSmart :: [[Int]] -&gt; [[Int]]\nbeSmart t = map f t \n        where f row \n                | elem 0 row = map unsolvedRow row\n                | otherwise  = row                            \n                         where unsolvedRow a\n                                | a == 0    = tryToDo t r c --?!?!?!?! skip\n                                | otherwise = a\n</code></pre>\n\n<p>The function <code>tryToDo :: [[Int]]] -&gt; Int -&gt; Int - &gt; Int</code> needs the row and column of the field i'm trying to change, but i have no idea how to get that information. How do i get from <code>map</code> what element of the list i am in at the moment? Or is there a better way to move around in the table? I come from iterative and procedural programing and i understand that perhaps my approach to the problem is wrong when it comes to functional programing.</p>\n"}, {"tags": ["haskell", "linker"], "answers": [{"comments": [{"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "reply_to_user": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "edited": false, "score": 1, "creation_date": 1488914231, "post_id": 42655272, "comment_id": 72438703, "body": "You&#39;re welcome.  If you consider this to be the correct answer would you please accept it by clicking the checkbox."}], "tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 1, "last_activity_date": 1488910004, "creation_date": 1488910004, "answer_id": 42655272, "question_id": 42654599, "link": "https://stackoverflow.com/questions/42654599/haskell-error-while-linking-two-files/42655272#42655272", "title": "Haskell, error while linking two files", "body": "<p>The compiler should recognize that <code>Main</code> depends on <code>SimpleJSON</code> by virtue of the <code>import SimpleJSON</code> statement.  This means that when you compile Main.hs, SimpleJSON.hs will also be compiled and linked into the resulting executable.   </p>\n\n<p>By specifying SimpleJSON.o explicitly on the command line you are probably linking that file twice into the resulting executable, which causes the failure you see.</p>\n\n<p><code>ghc -o simple Main.hs</code> should be enough to get your program to link.</p>\n"}], "owner": {"reputation": 320, "user_id": 7255965, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/201ab93839e2c4184b8b6930fb434e58?s=128&d=identicon&r=PG&f=1", "display_name": "Yotam Ohad", "link": "https://stackoverflow.com/users/7255965/yotam-ohad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 0, "accepted_answer_id": 42655272, "answer_count": 1, "score": 3, "last_activity_date": 1488910004, "creation_date": 1488907951, "question_id": 42654599, "link": "https://stackoverflow.com/questions/42654599/haskell-error-while-linking-two-files", "title": "Haskell, error while linking two files", "body": "<p>I've started reading about haskell with the book \"Real World Haskell\" and I've come into a problem I can't figure out.\nI have two files. The first, SimpleJSON.hs, contains the following code:</p>\n\n<pre><code>module SimpleJSON\n    (\n        JValue(..)\n      , getString\n      , getInt\n      , getDouble\n      , getBool\n      , getObject\n      , getArray\n      , isNull\n    ) where\n\ndata JValue = JString String\n            | JNumber Double\n            | JBool Bool\n            | JNull\n            | JObject [(String, JValue)]\n            | JArray [JValue]\n              deriving (Eq, Ord, Show)\n\ngetString :: JValue -&gt; Maybe String\ngetString (JString s) = Just s\ngetString _           = Nothing\n\ngetInt (JNumber n) = Just n\ngetInt _           = Nothing\n\ngetDouble (JNumber n) = Just n\ngetDouble _           = Nothing\n\ngetBool (JBool b) = Just b\ngetBool _         = Nothing\n\ngetObject (JObject o) = Just o\ngetObject _           = Nothing\n\ngetArray (JArray a) = Just a\ngetArray _          = Nothing\n\nisNull v = v == JNull\n</code></pre>\n\n<p>I've used \"ghc -c SimpleJSON.hs\" to get the object file. Then in my Main.hs</p>\n\n<pre><code>module Main (main) where\n\nimport SimpleJSON\n\nmain = print (JObject [(\"foo\", JNumber 1), (\"bar\", JBool False)])\n</code></pre>\n\n<p>I'm import the second file, but when I run \"ghc -o simple Main.hs SimpleJSON.o\" to get a .exe file I get the following error:</p>\n\n<pre><code>collect2.exe: error: ld returned 1 exit status\n`gcc.exe' failed in phase `Linker'. (Exit code: 1)\n</code></pre>\n\n<p>Thanks for your help</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 0, "creation_date": 1488897776, "post_id": 42651115, "comment_id": 72428277, "body": "What does <code>GHCi&gt;:i lines</code> give you? That should show where the <code>lines</code> you&#39;re seeing is defined."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1488897898, "post_id": 42651115, "comment_id": 72428375, "body": "In GHCi it says <code>lines :: String -&gt; [String]</code>. So you have imported a different `lines."}, {"owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "edited": false, "score": 0, "creation_date": 1488898178, "post_id": 42651115, "comment_id": 72428593, "body": "Yes mine shows GHCi&gt;:i lines lines :: Num t =&gt; [t]   -- Defined at &lt;interactive&gt;:14:1. Can you please tell me how I can get the correct one?"}, {"owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "edited": false, "score": 0, "creation_date": 1488898358, "post_id": 42651115, "comment_id": 72428697, "body": "Thanks I fixed it, i just restarted it and it works fine."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1488902157, "post_id": 42651115, "comment_id": 72431420, "body": "When GHCi says &quot;Defined at &lt;interactive&gt;:14:1&quot;, it means that <code>lines</code> was re-defined in GHCi (input line 14). Hence, you are not using the standard <code>lines</code>."}], "answers": [{"tags": [], "owner": {"reputation": 7323, "user_id": 343957, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/FAVPm.jpg?s=128&g=1", "display_name": "mathk", "link": "https://stackoverflow.com/users/343957/mathk"}, "is_accepted": false, "score": 4, "last_activity_date": 1488897877, "creation_date": 1488897877, "answer_id": 42651180, "question_id": 42651115, "link": "https://stackoverflow.com/questions/42651115/lines-function-not-working-as-expected/42651180#42651180", "title": "lines function not working as expected", "body": "<p>Are you sure that you are not shadowing the <code>lines</code> function:</p>\n\n<pre><code>:t lines\nlines :: String -&gt; [String]\n</code></pre>\n\n<p>Make sure you have not define a <code>lines</code> variable.\nAs @ChadGilbert mention you can use <code>:i</code></p>\n"}], "owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488897877, "creation_date": 1488897682, "question_id": 42651115, "link": "https://stackoverflow.com/questions/42651115/lines-function-not-working-as-expected", "title": "lines function not working as expected", "body": "<p>In Prelude, unlines work as expected. Below is the example</p>\n\n<pre><code>GHCi&gt;unlines [\"aa\",\"bb\",\"bb\"]\n\"aa\\nbb\\nbb\\n\"\n</code></pre>\n\n<p>But why does lines not work. Even the type signature says that it can only take numbers.</p>\n\n<pre><code>GHCi&gt;:t lines\nlines :: Num t =&gt; [t]\n</code></pre>\n\n<p>So, if I try </p>\n\n<pre><code>GHCi&gt;lines \"aa\\nbb\\nbb\\n\"\n</code></pre>\n\n<p>why do I get an error? Is there a lines that I need to import?</p>\n\n<p>Regards,</p>\n"}, {"tags": ["haskell", "megaparsec"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 7672798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0973cdfbe1d380ff34f4897f09b8a26?s=128&d=identicon&r=PG&f=1", "display_name": "Angus Dingus", "link": "https://stackoverflow.com/users/7672798/angus-dingus"}, "edited": false, "score": 0, "creation_date": 1488897001, "post_id": 42650754, "comment_id": 72427703, "body": "<code>now :: Head -&gt; Table</code>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1488896647, "creation_date": 1488896647, "answer_id": 42650754, "question_id": 42650523, "link": "https://stackoverflow.com/questions/42650523/how-to-match-megaparsec-result/42650754#42650754", "title": "How to match megaparsec result?", "body": "<pre><code>parse :: Stream s Identity t =&gt; Parsec s () a -&gt; SourceName -&gt; s -&gt; Either ParseError a \n                                              -- ^^^^^^^^^^ --\n</code></pre>\n\n<p>You forgot that argument. Try</p>\n\n<pre><code>case parse semiParser \"input name here\" input of\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 7672798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0973cdfbe1d380ff34f4897f09b8a26?s=128&d=identicon&r=PG&f=1", "display_name": "Angus Dingus", "link": "https://stackoverflow.com/users/7672798/angus-dingus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 42650754, "answer_count": 1, "score": 1, "last_activity_date": 1488896647, "creation_date": 1488895967, "last_edit_date": 1488896365, "question_id": 42650523, "link": "https://stackoverflow.com/questions/42650523/how-to-match-megaparsec-result", "title": "How to match megaparsec result?", "body": "<p>I wrote a small parser with megaparsec:</p>\n\n<pre><code>module App (main) where\n\nimport Control.Monad (void)\nimport Text.Megaparsec\nimport Text.Megaparsec.String\nimport qualified Text.Megaparsec.Lexer as L\n\nsc :: Parser ()\nsc = L.space (void spaceChar) lineCmnt blockCmnt\n  where lineCmnt  = L.skipLineComment \"//\"\n        blockCmnt = L.skipBlockComment \"/*\" \"*/\"\n\nsymbol :: String -&gt; Parser String\nsymbol = L.symbol sc\n\nsemiParser :: Parser String\nsemiParser = symbol \";\"\n\nmain :: IO()\nmain = do\n  input &lt;- getLine\n  case parse semiParser input of\n    Left val -&gt; putStrLn $ \"Failed! \"\n    Right val -&gt; putStrLn $ \"Passed! \"\n  print \"Done\"\n</code></pre>\n\n<p>where <code>sc</code> and symbol and <code>semiParser</code> are from the tutorials. Now I would like to work with my result but I get a type error:</p>\n\n<pre><code>App.hs:23:5: error:\n    \u2022 Couldn't match expected type \u2018String\n                                    -&gt; Either (ParseError (Token String) Dec) String\u2019\n                  with actual type \u2018Either t0 t1\u2019\n    \u2022 In the pattern: Left val\n      In a case alternative: Left val -&gt; putStrLn $ \"Failed! \"\n      In a stmt of a 'do' block:\n        case parse semiParser input of {\n          Left val -&gt; putStrLn $ \"Failed! \"\n          Right val -&gt; putStrLn $ \"Passed! \" }\n\nApp.hs:24:5: error:\n    \u2022 Couldn't match expected type \u2018String\n                                    -&gt; Either (ParseError (Token String) Dec) String\u2019\n                  with actual type \u2018Either t2 t3\u2019\n    \u2022 In the pattern: Right val\n      In a case alternative: Right val -&gt; putStrLn $ \"Passed! \"\n      In a stmt of a 'do' block:\n        case parse semiParser input of {\n          Left val -&gt; putStrLn $ \"Failed! \"\n          Right val -&gt; putStrLn $ \"Passed! \" }\n</code></pre>\n\n<p>So, my question is: how do I match against <code>String -&gt; Either (ParseError (Token String) Dec) String</code> and get the error message or the result, if parsing failed?</p>\n\n<p>I guess that the general form of this question is: How does pattern matching work? And I am confused in general how I can bind the result of a monad (such as <code>Either</code> in another monad, such as <code>IO</code> (I guess I have to pattern match and then lift the value into the context of the monad).</p>\n"}, {"tags": ["haskell", "emacs", "haskell-mode"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 3, "creation_date": 1488888083, "post_id": 42646771, "comment_id": 72421732, "body": "please post the entire error message..."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488893461, "post_id": 42646771, "comment_id": 72425272, "body": "I guess you have a cabal project - did you list all the modules in there?"}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488905018, "post_id": 42653592, "comment_id": 72433316, "body": "I would also advise you to use <code>cabal</code> or <code>stack</code> to build your executable instead of calling ghc directly (via build.bat)"}, {"owner": {"reputation": 21, "user_id": 6783203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95678f50efad2db8c198cdf17c2eb4b6?s=128&d=identicon&r=PG&f=1", "display_name": "N. Silvestrin", "link": "https://stackoverflow.com/users/6783203/n-silvestrin"}, "edited": false, "score": 0, "creation_date": 1488919422, "post_id": 42653592, "comment_id": 72441786, "body": "Ah thank you. I don&#39;t have much experience with cabal/stack so i wouldn&#39;t have known."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 0, "last_activity_date": 1488904704, "creation_date": 1488904704, "answer_id": 42653592, "question_id": 42646771, "link": "https://stackoverflow.com/questions/42646771/haskell-mode-could-not-find-module/42653592#42653592", "title": "Haskell-mode &quot;could not find module&quot;", "body": "<p>I had a look at the project you linked to and inspected the cabal file - as I suggested you are not mentioning Haskeroids stuff there.</p>\n\n<pre><code> ..\n\nExecutable haskeroids\n    Main-is:            main.hs\n\n    Other-modules:      Haskeroids.Geometry\n                 ,      Haskeroids.Geometry.Transform\n\n    Build-Depends:      base &gt;= 4, transformers &gt;= 0.2.2.0,\n                        ...\n</code></pre>\n\n<p>add the <code>Other-modules</code> part to your cabal file and everything should work well and dandy.</p>\n"}], "owner": {"reputation": 21, "user_id": 6783203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95678f50efad2db8c198cdf17c2eb4b6?s=128&d=identicon&r=PG&f=1", "display_name": "N. Silvestrin", "link": "https://stackoverflow.com/users/6783203/n-silvestrin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 477, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1488904704, "creation_date": 1488885104, "last_edit_date": 1488901671, "question_id": 42646771, "link": "https://stackoverflow.com/questions/42646771/haskell-mode-could-not-find-module", "title": "Haskell-mode &quot;could not find module&quot;", "body": "<p>I am following an Asteroids tutorial in Haskell(<a href=\"https://github.com/shangaslammi/haskeroids/wiki\" rel=\"nofollow noreferrer\">Haskeroids</a>) and I'm having a problem with my submodules. Basically, my folder structure is like this:</p>\n\n<pre><code>project/\n|-- main.hs\n|-- Haskeroids/\n    |-- Geometry.hs\n    |-- Geometry/\n        |-- Transform.hs\n</code></pre>\n\n<p>The Geometry.hs file has</p>\n\n<pre><code>module Haskeroids.Geometry where\n</code></pre>\n\n<p>while the Transform.hs file has</p>\n\n<pre><code>module Haskeroids.Geometry.Transform where\nimport Haskeroids.Geometry\n</code></pre>\n\n<p>for some reason, ghc seems to look for Geometry/Haskeroids/Geometry.hs.\nis there some setting to set so that ghc knows where to look for the file, and what is the way to set it for haskell-mode?</p>\n\n<p>Edit: the error message was: Could not find module Haskeroids.Geometry. Use - v to see a list of the files searched </p>\n"}, {"tags": ["haskell", "ghc", "higher-kinded-types"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1488838492, "post_id": 42636509, "comment_id": 72400826, "body": "I&#39;m not sure you can. As far as I know, kind polymorphism is prenex, and you want higher-rank kind polymorphism."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1488838747, "post_id": 42636509, "comment_id": 72400941, "body": "For what it&#39;s worth, the error you&#39;re getting is analogous to the type error in <code>foo :: Num a =&gt; (a -&gt; a) -&gt; (Int, Double) ; foo f = (f 0, f 0)</code>. Sure <code>a</code> can have any type, but it must be a monotype."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1488839440, "post_id": 42636509, "comment_id": 72401239, "body": "@Carl See the first link. I got higher-rank kind polymorphism with the GADT by adding a CUSK."}], "answers": [{"comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1488841016, "post_id": 42637106, "comment_id": 72401972, "body": "Can you explain how this is different than the GADT example? Why do I need <code>TypeInType</code> here, but not there?"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 2, "creation_date": 1488841621, "post_id": 42637106, "comment_id": 72402187, "body": "Well, before <code>TypeInType</code>, the correct kind annotation on <code>f</code> was a syntax error. And there&#39;s a genuine question of where <code>k</code> should be quantified: is it local to <code>f</code> or to <code>Foo</code>? Your GADT example, where you say &quot;GADTs require kind signatures where they should be inferred...it&#39;s clear from the GADT constructors that <code>a :: *</code>&quot; makes unwarranted assumptions about what is inferrable. For interesting patterns of abstraction, &quot;guess the pattern&quot; inference is now hopeless; &quot;instantiate the pattern&quot; inference is still pretty good, though."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1488842306, "post_id": 42637106, "comment_id": 72402461, "body": "In my GADT example, I managed to apply the first type parameter of <code>Foo</code> to two types of different kinds (namely <code>Nat</code> and <code>*</code>), without needing <code>TypeInType</code>. I think that&#39;s exactly what I&#39;m trying to do in my example, so I&#39;m not sure why the extension is required."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1488843325, "post_id": 42637106, "comment_id": 72402828, "body": "Write down the types (that we used to call &quot;kinds&quot;) of the GADT constructor and the type class, with all <code>forall</code>s explicit. Your GADT has iiuc rank-1 polymorphism, but your typeclass has rank-2. Before <code>TypeInType</code> that (like a bunch of other stuff, e.g. GADT promotion) was beyond what was obviously manageable in GHC core. The <code>TypeInType</code> generalisation makes the treatment of polymorphism and equality constraints more uniform: equations between polymorphic types now work sensibly (i.e., heterogeneously), allowing higher-rank types in more places."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1488844786, "post_id": 42637106, "comment_id": 72403293, "body": "I edited the question to include a concrete GADT example. My understanding is that the constructor <code>C</code> requires rank-2 polymorphism, because we can never unify the kinds of <code>x</code> and <code>&#39;(x,x)</code>. This is accomplished without <code>TypeInType</code>."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1488845285, "post_id": 42637106, "comment_id": 72403434, "body": "You are incorrect, as you can easily find out for yourself by asking <code>ghci</code>. Neither your GADT type constructor <code>Foo</code>, nor its value constructor <code>C</code> has a rank-2 polymorphic type: they do not need to abstract over polymorphic things. Your class <code>Foo</code> is not a translation to classes of your GADT, so you are making an apples-oranges comparison. The type of the class <code>Foo</code> is <code>(forall k. k -&gt; *) -&gt; Constraint</code> which really is rank-2."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1488845982, "post_id": 42637106, "comment_id": 72403615, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/137392/discussion-between-crockeea-and-pigworker\">continue this discussion in chat</a>."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1488846512, "post_id": 42637106, "comment_id": 72403750, "body": "I gotta go to bed, but I&#39;ll look in in the morning. It&#39;s certainly possible that some things were disabled before <code>TypeInType</code> that might have been just about achievable, but once <code>TypeInType</code> became clearly the direction of travel, it wasn&#39;t worth thinking about how to squeeze them out of the old rules."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1488849312, "post_id": 42637106, "comment_id": 72404565, "body": "Ah. I thought <code>TypeInType</code> might have made this work, since it means kinds are no longer treated differently from types. I have no experience with it, though, obviously."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1488877247, "post_id": 42637106, "comment_id": 72415014, "body": "@Carl One way in which kinds are no longer treated differently from types is that you can have equational constraints on them (without needing a new level of constraint, as constraints on types will do). That&#39;s what allows GADT promotion, indexing by polymorphic things, etc."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 9, "last_activity_date": 1488840789, "creation_date": 1488840789, "answer_id": 42637106, "question_id": 42636509, "link": "https://stackoverflow.com/questions/42636509/kind-polymorphism-in-classes/42637106#42637106", "title": "Kind-polymorphism in classes", "body": "<p>This is a job for GHC 8 and <code>TypeInType</code>, which allows much more amusing forms of dependency. The following minor edit of your code typechecks.</p>\n\n<pre><code>{-# LANGUAGE PolyKinds, RankNTypes, KindSignatures,\n    DataKinds, TypeInType  #-}\n\nmodule KP where\n\nimport Data.Kind\n\nclass Foo (f :: forall k. k -&gt; *) where\n  foo :: (f :: k1 -&gt; *) (x :: k1) -&gt; (f :: (k1,k1) -&gt; *) ('(x,x) :: (k1,k1))\n</code></pre>\n\n<p>Crucially, it is no longer a syntax error to use <code>forall</code> in the (ha ha!) <em>type</em> of a type class parameter.  </p>\n"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 605, "favorite_count": 1, "accepted_answer_id": 42637106, "answer_count": 1, "score": 5, "last_activity_date": 1488844808, "creation_date": 1488837991, "last_edit_date": 1488844808, "question_id": 42636509, "link": "https://stackoverflow.com/questions/42636509/kind-polymorphism-in-classes", "title": "Kind-polymorphism in classes", "body": "<p>I <a href=\"https://ghc.haskell.org/trac/ghc/ticket/13365\" rel=\"nofollow noreferrer\">recently ran into a problem</a> using kind polymorphism with GADTs. The answer there was to give a \"complete user-specified kind\" (CUSK) for my data type. I've read the <a href=\"https://downloads.haskell.org/~ghc/master/users-guide/glasgow_exts.html#complete-user-supplied-kind-signatures-and-polymorphic-recursion\" rel=\"nofollow noreferrer\">relevant documentation</a>, but I'm still getting essentially the same error when I try to apply that to a class. </p>\n\n<p>Concretely, once I give a CUSK, the following <em>does</em> compile:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, PolyKinds, GADTs #-}\n\ndata Foo (x :: k) where\n  C :: Foo x -&gt; Foo '(x,x)\n</code></pre>\n\n<p>but when I move that definition to a class:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, PolyKinds #-}\n\nclass Foo (f :: k -&gt; *) where\n  foo :: (f :: k1 -&gt; *) (x :: k1) -&gt; (f :: (k1,k1) -&gt; *) ('(x,x) :: (k1,k1))\n</code></pre>\n\n<p>I get the error:</p>\n\n<pre><code>\u2022 Expected kind \u2018(k1, k1) -&gt; *\u2019, but \u2018f\u2019 has kind \u2018k -&gt; *\u2019\n\u2022 In the type signature:\n    foo :: (f :: k1 -&gt; *) (x :: k1) -&gt; (f :: (k1, k1) -&gt; *) ('(x, x) :: (k1, k1))\n  In the class declaration for \u2018Foo\u2019\n</code></pre>\n\n<p>I expect there's something small I need to do to convince GHC that <code>f</code> is kind-polymorphic in the second example.</p>\n"}, {"tags": ["haskell", "text", "numbers"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1488828538, "post_id": 42633897, "comment_id": 72395633, "body": "Perhaps it is time to define a real data structure representing your document, a parser that turns flat text into that structure, and some operations on that structure!"}, {"owner": {"reputation": 343, "user_id": 3413510, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a4bb04e8e539c57a6b5e1d43e3478579?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/3413510/omar"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1488828811, "post_id": 42633897, "comment_id": 72395774, "body": "@Daniel Wagner Yes I tried to create a type: data Author = Author String String String deriving(Show) . And the functions: name(Author name _ _ )= name, title(Author _ title _)= title, and finally code(Author _ _ code)= code. But how do I inject this data into the text?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1488829027, "post_id": 42633897, "comment_id": 72395886, "body": "That looks like a decent type for authors, but doesn&#39;t cover documents (which can include both plain text and authors) very well yet. No problem: add more data types!"}, {"owner": {"reputation": 343, "user_id": 3413510, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a4bb04e8e539c57a6b5e1d43e3478579?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/3413510/omar"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1488829975, "post_id": 42633897, "comment_id": 72396416, "body": "@Daniel Wagner: but suppose I want to limit myself to the authors. How do I extract the information into the data type and then put it back into the text again. Sorry if I sound redundant, I am a noob in Haskell and I don&#39;t understand how to inject the info in a data structure back to a text. Thanks"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1488830718, "post_id": 42633897, "comment_id": 72396801, "body": "<code>renderAuthor (Author first last) = first ++ &quot; &quot; ++ last</code>.  There are better ways to &quot;pretty print&quot; ASTs into text but simple string concatenation as shown here can get your fairly far."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488844644, "post_id": 42633897, "comment_id": 72403243, "body": "Just making sure - you know that there already exist systems like bibtex that already do a tremendous job at what you want to achieve."}, {"owner": {"reputation": 343, "user_id": 3413510, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a4bb04e8e539c57a6b5e1d43e3478579?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/3413510/omar"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488846922, "post_id": 42633897, "comment_id": 72403870, "body": "@epsilonhalbe Thanks for pointing out this library. but my request is more pedagogical, I am learning haskell, and I wanted a direction/ hint on how to create a data structure to map the text structure. So I started with Author but I guess I could just extend it to include plain text that does not refer to an author, as suggested by Daniel Wagner. And I am not looking for a ready-made solution either, because this is an assignment and I want to know how to solve it by myself."}], "answers": [{"comments": [{"owner": {"reputation": 343, "user_id": 3413510, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a4bb04e8e539c57a6b5e1d43e3478579?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/3413510/omar"}, "edited": false, "score": 0, "creation_date": 1488865906, "post_id": 42640758, "comment_id": 72409456, "body": "thank you very much for taking the time to answer, especially for the data structure and how to use it on the text.!!!"}], "tags": [], "owner": {"reputation": 309, "user_id": 6222757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48fdecaf00efb53f6ed0ee200fa9ba2b?s=128&d=identicon&r=PG&f=1", "display_name": "evzh", "link": "https://stackoverflow.com/users/6222757/evzh"}, "is_accepted": true, "score": 3, "last_activity_date": 1488864235, "last_edit_date": 1488864235, "creation_date": 1488863865, "answer_id": 42640758, "question_id": 42633897, "link": "https://stackoverflow.com/questions/42633897/haskell-successive-modifications-of-a-text/42640758#42640758", "title": "Haskell: successive modifications of a text", "body": "<p>EDIT: I didn't mean to make the answer this long, but the problem turned out a non-trivial task, and I'm not quite sure how much detail I should put in the answer. In case you understand all the tools I'm using, the full code is just at the end of this answer.</p>\n\n<hr>\n\n<p>In your case, you'll need:</p>\n\n<ul>\n<li>an approach to parse your input document</li>\n<li>a suitable data structure to store the input information</li>\n<li>displaying the data as output format</li>\n</ul>\n\n<p>For the parsing part, perhaps Regex is enough (maybe), but I guess the <a href=\"https://hackage.haskell.org/package/parsec\" rel=\"nofollow noreferrer\">Parsec</a> library is a better choice. For detailed usage of Parsec please refer to the link, and I'll only try to show how to use it in your case:</p>\n\n<p>First, <code>import Text.ParserCombinators.Parsec</code>.</p>\n\n<p>A document is a <code>list</code> of</p>\n\n<ul>\n<li>a literal string</li>\n<li>a <code>definition</code>, with format <code>#&lt;Author&gt;/&lt;Title&gt;/&lt;Code&gt;/</code>, as in \"#chomsky/syntactic structures/chomskySynt/\"</li>\n<li>a <code>citation</code>, with format <code>#see/&lt;Code&gt;/</code>, as in \"#see/chomskyAsp/\"</li>\n</ul>\n\n<p>Hence we define</p>\n\n<pre><code>data Index = Index {\n    getAuthor      :: String,\n    getTitle       :: String,\n    getSpecialCode :: String,\n    getAuthorCount :: Int\n        -- For counting author later.\n} deriving (Show)\n\ndata Content = Def Index\n             | Cite String Index\n             -- We'll fill in Index later.\n             | Literal String\n    deriving (Show)\n</code></pre>\n\n<p>and our input document will just be turned into <code>[Content]</code>.</p>\n\n<p>Correspondingly, we'll use the following function (actually, parser) to parse the input:</p>\n\n<pre><code>document = many (try def &lt;|&gt; try cite &lt;|&gt; literal)\n\nliteral = Literal &lt;$&gt; many1 (noneOf \"#\")\n\ndef = do\n    char '#'\n    author &lt;- many1 $ noneOf \"/\"\n    char '/'\n    title &lt;- many1 $ noneOf \"/\"\n    char '/'\n    code &lt;- many1 $ noneOf \"/\"\n    char '/'\n    return $ Def author title code\n\ncite = do\n    try $ string \"#see/\"\n    code &lt;- many1 $ noneOf \"/\"\n    char '/'\n    return $ Cite code nullIndex\n</code></pre>\n\n<p>A short explanation:</p>\n\n<ol>\n<li><p>A <code>document</code> is <code>many</code> (<code>def</code> or <code>cite</code> or <code>literal</code>), with operator <code>&lt;|&gt;</code> combining parsers.</p></li>\n<li><p>A <code>literal</code> is a string, stopping at <code>'#'</code>, with at least 1 char (using <code>many1</code>); a parser inside <code>many</code> should not accept empty input, think of why!</p></li>\n<li><p>A <code>def</code> is <code>#&lt;Author&gt;/&lt;Title&gt;/&lt;Code&gt;/</code>, and we can write in do-notation since <code>Parser</code> is a monad.</p></li>\n<li><p>A <code>cite</code> goes similarly.</p></li>\n<li><p>A <code>def</code>, <code>cite</code>, or <code>string \"#see/\"</code> parse multiple characters, hence is possible to fail when they <em>have consumed</em> some chars; therefore, we use the combinator <code>try</code>.</p></li>\n<li><p>By the way, <code>nullIndex</code> is just a placeholder before we actually fill this record:</p>\n\n<pre><code>nullIndex :: Index\nnullIndex = Index \"\" \"\" \"\" 0\n</code></pre></li>\n</ol>\n\n<hr>\n\n<p>Now we only need a function with signiture <code>[Content] -&gt; String</code>.</p>\n\n<p>We can start with captializing the author name:</p>\n\n<pre><code>capitalizeAuthor :: Content -&gt; Content\ncapitalizeAuthor (Def x) = Def (x {getAuthor = author'}) where\n    author' = toUpper (head author) : tail author\n    author  = getAuthor x\ncapitalizeAuthor y = y\n</code></pre>\n\n<p>The other tasks are not <em>local</em>, since the relation between <code>Content</code>s should be observed, hence we will use a <code>foldl</code> across the list.</p>\n\n<p>Define</p>\n\n<pre><code>import           Data.Map.Strict               ((!))\nimport qualified Data.Map.Strict               as M\n\ntype CodeDict = M.Map String Index\n    -- Map Code Index\ntype AuthorDict = M.Map String Int\n    -- Map Author Count\ntype Fold = (CodeDict, AuthorDict, [Content])\n\nemptyFold :: Fold\nemptyFold = (M.empty, M.empty, [])\n</code></pre>\n\n<p>The <code>Fold</code> type will store the state when we modify along the original <code>[Content]</code>.</p>\n\n<p>(I realize that the code will be much clearer if I use the <code>State</code> monad, but I'm not sure if I need to explain it then ...)</p>\n\n<p>In addition, a folding function for <code>foldl</code></p>\n\n<pre><code>accum :: Fold -&gt; Content -&gt; Fold\naccum (c,a,ls) (Def x) = (c',a',Def x':ls) where\n    a' = M.insertWith (+) author 1 a\n    c' = M.insert code x' c\n    x' = x {getAuthorCount = count}\n    count = maybe 1 (+1) $ a !? author\n    author = getAuthor x\n    code = getSpecialCode x\naccum (c,a,ls) (Cite code _) = (c,a,Cite code (c ! code) : ls)\naccum (c,a,ls) y = (c,a,y:ls)\n</code></pre>\n\n<p>After <code>foldr</code>, the resulted list will contain the contents with</p>\n\n<ul>\n<li><p><code>getAuthorCount</code> correctly filled</p></li>\n<li><p><code>Cite</code>s transferred into <code>Def</code>s, since they have the same outputting format. </p></li>\n<li><p>The resulted list is reversed, so you'll need <code>Data.List.reverse</code>.</p></li>\n</ul>\n\n<p>Finally, you can define your own version of <code>Show</code> for <code>Content</code>. For example,</p>\n\n<pre><code>instance Show Index where\n    show x = getAuthor x ++ \" \"\n          ++ show (getAuthorCount x) ++ \": \"\n          ++ getTitle x ++ \" \"\n\ninstance Show Content where\n    show (Def idx)     = show idx\n    show (Cite x idx)  = getAuthor idx ++ \" \"\n                      ++ show (getAuthorCount idx)\n    show (Literal x)   = x\n</code></pre>\n\n<p>as I figured out from your output sample.</p>\n\n<hr>\n\n<p>The full length code:</p>\n\n<pre><code>import           Data.Char\nimport           Data.List                     (reverse)\nimport           Data.Map.Strict               ((!),(!?))\nimport qualified Data.Map.Strict               as M\nimport           Text.ParserCombinators.Parsec\n\ndata Index = Index {\n    getAuthor      :: String,\n    getTitle       :: String,\n    getSpecialCode :: String,\n    getAuthorCount :: Int\n        -- For counting author later.\n}\n\nnullIndex :: Index\nnullIndex = Index \"\" \"\" \"\" 0\n\ninstance Show Index where\n    show x = getAuthor x ++ \" \"\n          ++ show (getAuthorCount x) ++ \": \"\n          ++ getTitle x ++ \" \"\n\ndata Content = Def Index\n             | Cite String Index\n             | Literal String\n\ninstance Show Content where\n    show (Def idx)     = show idx\n    show (Cite x idx)  = getAuthor idx ++ \" \"\n                      ++ show (getAuthorCount idx)\n    show (Literal x)   = x\n\ndocument = many (try cite &lt;|&gt; try def &lt;|&gt; literal)\n\nliteral = Literal &lt;$&gt; many1 (noneOf \"#\")\n\ndef = do\n    char '#'\n    author &lt;- many1 $ noneOf \"/\"\n    char '/'\n    title &lt;- many1 $ noneOf \"/\"\n    char '/'\n    code &lt;- many1 $ noneOf \"/\"\n    char '/'\n    return $ Def $ Index author title code 0\n\ncite = do\n    try $ string \"#see/\"\n    code &lt;- many1 $ noneOf \"/\"\n    char '/'\n    return $ Cite code nullIndex\n\ncapitalizeAuthor :: Content -&gt; Content\ncapitalizeAuthor (Def x) = Def (x {getAuthor = author'}) where\n    author' = toUpper (head author) : tail author\n    author  = getAuthor x\ncapitalizeAuthor y = y\n\ntype CodeDict = M.Map String Index\n    -- Map Code Index\ntype AuthorDict = M.Map String Int\n    -- Map Author Count\ntype Fold = (CodeDict, AuthorDict, [Content])\n\nemptyFold :: Fold\nemptyFold = (M.empty, M.empty, [])\n\naccum :: Fold -&gt; Content -&gt; Fold\naccum (c,a,ls) (Def x) = (c',a',Def x':ls) where\n    a' = M.insertWith (+) author 1 a\n    c' = M.insert code x' c\n    x' = x {getAuthorCount = count}\n    count = maybe 1 (+1) $ a !? author\n    author = getAuthor x\n    code = getSpecialCode x\naccum (c,a,ls) (Cite code _) = (c,a,Cite code (c ! code) : ls)\naccum (c,a,ls) y = (c,a,y:ls)\n\nmain :: IO ()\nmain = do\n    line &lt;- getLine\n    let parsed = parse document \"\" line\n    case parsed of\n      Left x -&gt; print x\n      Right cs -&gt; do\n        let cs1 = map capitalizeAuthor cs\n        let (_,_,cs2) = foldl accum emptyFold cs1\n        let output = concatMap show $ reverse cs2\n        putStrLn output\n</code></pre>\n"}], "owner": {"reputation": 343, "user_id": 3413510, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a4bb04e8e539c57a6b5e1d43e3478579?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/3413510/omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 42640758, "answer_count": 1, "score": 0, "last_activity_date": 1500811914, "creation_date": 1488828175, "last_edit_date": 1500811914, "question_id": 42633897, "link": "https://stackoverflow.com/questions/42633897/haskell-successive-modifications-of-a-text", "title": "Haskell: successive modifications of a text", "body": "<p>I want to know how to make modifications to a text that is full of special characters and codes and replace those codes with strings.</p>\n\n<p>I have the following text:</p>\n\n<p>text= </p>\n\n<blockquote>\n  <p>\"#chomsky/syntactic structures/chomskySynt/: published in 1957. #bloomfield/language/bloomfieldLan/: published in 1933. #chomsky/aspects of a theory of syntax/chomskyAsp/: published in 1965. ... #see/chomskySynt/ is considered the starting point of generative linguistics.... Another hypothesis was introduced in #see/chomskyAsp/.\"</p>\n</blockquote>\n\n<p>I want to turn it into= </p>\n\n<blockquote>\n  <p>\"Chomsky 1: Syntactic structures : published in 1957. Bloomfield 1: Language : published in 1933. Chomsky 2: Aspects of a theory of syntax : published in 1965. ... Chomsky 1 is considered the starting point of generative linguistics ... Another hypothesis was introduced in Chomsky 2...\"</p>\n</blockquote>\n\n<p>Explanation of the special characters and codes: the information on a book starts with # followed by the name of the author (chomsky for example) followed by / then title of the book / then the special code for the book (chomskyAsp)  then /</p>\n\n<p>The citation of a book starts with #see followed by / then the special code of the book (ex. chomskySyn) /</p>\n\n<p>The modifications are:</p>\n\n<ol>\n<li>To count how many times an author is cited and concatenate the number to the name: Chomsky 1, for example. </li>\n<li><p>Author name will start with a capital letter</p></li>\n<li><p>Remove the special code : chomskySynt which serves only as an identification code.</p></li>\n<li><p>Replace the reference : #see/chomskyAsp   with the Chomsky 2. That is replace the reference with the actual author and number.</p></li>\n</ol>\n\n<p>Here is my code:</p>\n\n<pre><code>  RemoveSlash = myReplace \"/\"\" \" text\n\n  removeDash = map lines $ (filter(any isLetter) . groupBy ( (==) `on`       (=='#'))) $ removeSlash\n\n  flattenList= concat removeDash \n\n   splitIntoWords = map words flattenList\n</code></pre>\n\n<p>And here is the myReplace function:</p>\n\n<pre><code>     myReplace _ _ [] = []\n     myReplace a b s@(x:xs)= if isPrefixOf a s\n              then b++myReplace a b (drop(length a)s)\n              else x: myReplace a b xs\n</code></pre>\n\n<p>Here is the result so far:</p>\n\n<blockquote>\n  <p>[[\"chomsky syntactic structures chomskySynt  published in 1957. \"],    [\"bloomfield language bloomfieldLan  published in 1933.  \"],[\"chomsky aspects of a theory of syntax chomskyAsp  published in 1965. ... \"],[\"see chomskySynt  is considered the starting point of generative linguistics.... Another hypothesis was introduced in \"],[\"see chomskyAsp\"]]</p>\n</blockquote>\n\n<p>The reason I flattened the list and split it into words is now if I do:</p>\n\n<pre><code>      map head splitIntoWords\n</code></pre>\n\n<p>I get [\"chomsky\",\"bloomfield\",\"chomsky\",\"see\",\"see\"]</p>\n\n<p>I am stuck at this stage. How do I count how many times an author is cited and concatenate the number to the name. I thought of using the zip function:</p>\n\n<pre><code>    zipChomsky =zip [1, 2][x | x &lt;- diviser,(head x) == \"chomsky\"]\n</code></pre>\n\n<p>This gives:</p>\n\n<blockquote>\n  <p>[(1[\"chomsky\",\"syntactic\",\"structures\",\"chomskySynt\",\"published\",\"in\",\"1957.\"]),(2,[\"chomsky\",\"aspects\",\"of\",\"a\",\"theory\",\"of\",\"syntax\",\"chomskyAsp\",\"published\",\"in\",\"1965.\",\"...\"])]</p>\n</blockquote>\n\n<p>But the result is very different from:  Chomsky 1: ...</p>\n"}, {"tags": ["list", "function", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1488825942, "post_id": 42633046, "comment_id": 72394197, "body": "A <code>where</code> block is not attached to an expression, i.e. <code>x where decls</code> is not an expression (in contrast to <code>let decls in x</code>, which is an expression). A <code>where</code> block must be attached to a declaration, in this case you presumably want it attached to the <code>addElem</code> declaration, and so must be placed <i>after</i> the declaration body, of which the last guard statement also forms part. Note that parse errors never have to do with using the wrong type - it means the compiler doesn&#39;t even understand your code, let alone judge it to be wrong. This also is not an indentation error."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1488826023, "post_id": 42633046, "comment_id": 72394241, "body": "@user2407038 that should be an answer"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1488837389, "post_id": 42633046, "comment_id": 72400280, "body": "Do you really mean to ignore <code>elem</code> if <code>index</code> is too big? That&#39;s a bit asymmetrical compared to prepending the element when <code>index</code> is &lt; 0. I would think <code>otherwise = list ++ [elem]</code> would make sense."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 11, "last_activity_date": 1488827097, "last_edit_date": 1488827097, "creation_date": 1488826154, "answer_id": 42633289, "question_id": 42633046, "link": "https://stackoverflow.com/questions/42633046/how-to-properly-use-guards-in-haskell/42633289#42633289", "title": "How to properly use guards in Haskell?", "body": "<p><code>where</code> blocks need to occur at the end of the whole function, and are shared amongst all the cases. You probably meant to use a <code>let</code>:</p>\n\n<pre><code>addElem :: a -&gt; [a] -&gt; Int -&gt; [a]\naddElem elem list index\n | index &lt;= 0            = elem:list\n | index &lt; (length list) = let a = take index list; b = drop index list in a ++ (elem:b)\n | otherwise             = list\n</code></pre>\n\n<p>Also, note that <code>let</code> could be written more concisely as <code>let (a,b) = splitAt index list in ...</code>. <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:splitAt\" rel=\"noreferrer\"><code>splitAt</code></a> is also in the Prelude. Of course, you could also just move the <code>where</code> block to the end of the function (Haskell's laziness makes this easy to reason about). </p>\n\n<pre><code>addElem :: a -&gt; [a] -&gt; Int -&gt; [a]\naddElem elem list index\n | index &lt;= 0            = elem:list\n | index &lt; (length list) = a ++ (elem:b)\n | otherwise             = list\n where\n   a = take index list\n   b = drop index list\n</code></pre>\n\n<p>Personally, I like this less because it suggests that <code>a</code> and <code>b</code> may be used elsewhere in the function.</p>\n\n<p>Section 4.4.3 of the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-620004\" rel=\"noreferrer\">2010 Haskell Report</a> goes into more detail on where <code>where</code> is allowed.</p>\n"}], "owner": {"reputation": 693, "user_id": 7564554, "user_type": "registered", "accept_rate": 82, "profile_image": "https://lh3.googleusercontent.com/-h7KkTmgJty0/AAAAAAAAAAI/AAAAAAAAAAo/ZFEGeg_bQ6Y/photo.jpg?sz=128", "display_name": "Eben Kadile", "link": "https://stackoverflow.com/users/7564554/eben-kadile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1382, "favorite_count": 0, "accepted_answer_id": 42633289, "answer_count": 1, "score": 4, "last_activity_date": 1488827097, "creation_date": 1488825236, "last_edit_date": 1488825491, "question_id": 42633046, "link": "https://stackoverflow.com/questions/42633046/how-to-properly-use-guards-in-haskell", "title": "How to properly use guards in Haskell?", "body": "<p>I'm new to Haskell and I'm trying to write simple functions to get myself used to the syntax, I want to write my own function for adding a certain element to a list at a specific index. Here's what I wrote in Atom (my text editor):</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>addElem :: a-&gt;[a]-&gt;Int-&gt;[a]\naddElem elem list index\n | index &lt;= 0            = elem:list\n | index &lt; (length list) = a ++ (elem:b) where a = take index list; b = drop index list\n | otherwise             = list\n</code></pre>\n\n<p>The idea is that it won't freak out as long as index is an <code>Int</code> and <code>elem</code> is of the same type as the elements of <code>list</code>, but when I try to load this into ghci I get \"parse error on `|'.\" Do I need to constrain the types of the arguments? I'm reading Learn You A Haskell but I haven't gotten to the part where they fully explain how the indentations work, so my error might also be there.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1488817651, "post_id": 42630586, "comment_id": 72389217, "body": "you can always use <code>($)</code> in those cases! - I don&#39;t really see the necessity - can you give an example where you would need this?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1488818356, "post_id": 42630586, "comment_id": 72389705, "body": "For a known number of arguments, you can compose partial applications of <code>(.)</code>. For example, <code>((g .) . f)</code> does what you want. It gets uglier as <code>f</code> takes more arguments, though. <code>h x y z = g (f x y z)</code> turns into <code>h = (((g .) . f) .) . f</code>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1488819472, "post_id": 42630586, "comment_id": 72390535, "body": "The &quot;Variadic compose function?&quot; suggested question covers your literal question (though you probably don&#39;t really want that -- cf. luqui&#39;s comment there). The other two discuss alternatives for when you know how many arguments you want to handle, along the lines of @chepner &#39;s comment."}], "owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "closed_date": 1488818895, "answer_count": 0, "score": 0, "last_activity_date": 1488818976, "creation_date": 1488817448, "question_id": 42630586, "link": "https://stackoverflow.com/questions/42630586/is-there-a-composition-function-that-works-with-functions-taking-any-number-of-a", "closed_reason": "Duplicate", "title": "Is there a composition function that works with functions taking any number of arguments?", "body": "<p>The function <code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code> composes two functions which take only one argument each. I would sometimes find useful if the second function passed could take more than one argument:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a1 -&gt; ... -&gt; an -&gt; b) -&gt; a1 -&gt; ... -&gt; an -&gt; c\n</code></pre>\n\n<p>If I use a function <code>f</code> as below with more than one argument as the second argument, this is what happens:</p>\n\n<pre><code>(g . f) val1 ... valn = g (f val1) val2 ... valn\n</code></pre>\n\n<p>Whereas I would like:</p>\n\n<pre><code>(g . f) val1 ... valn = g (f val1 ... valn)\n</code></pre>\n\n<p>Is there an alternative to <code>.</code> or another way to achieve this?</p>\n"}, {"tags": ["haskell", "zipper"], "comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1488800354, "post_id": 42622107, "comment_id": 72377159, "body": "You can find some information in this related question: <a href=\"http://stackoverflow.com/questions/2990689/how-do-i-code-a-tree-of-objects-in-haskell-with-pointers-to-parent-and-children\" title=\"how do i code a tree of objects in haskell with pointers to parent and children\">stackoverflow.com/questions/2990689/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 781, "user_id": 1163717, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/cbba7289a669e4ca1fcf1064d0cf22fd?s=128&d=identicon&r=PG&f=1", "display_name": "The Red Fox", "link": "https://stackoverflow.com/users/1163717/the-red-fox"}, "edited": false, "score": 0, "creation_date": 1488817532, "post_id": 42629846, "comment_id": 72389133, "body": "Interesting. But aren&#39;t scars then just combined zippers? Because now you replaced the list in the Rose tree with a list zipper."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 781, "user_id": 1163717, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/cbba7289a669e4ca1fcf1064d0cf22fd?s=128&d=identicon&r=PG&f=1", "display_name": "The Red Fox", "link": "https://stackoverflow.com/users/1163717/the-red-fox"}, "edited": false, "score": 0, "creation_date": 1488818644, "post_id": 42629846, "comment_id": 72389909, "body": "@TheRedFox Exactly."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 10, "last_activity_date": 1533935881, "last_edit_date": 1533935881, "creation_date": 1488815264, "answer_id": 42629846, "question_id": 42622107, "link": "https://stackoverflow.com/questions/42622107/what-are-scars-useful-for/42629846#42629846", "title": "What are scars useful for?", "body": "<p>It's just a minor adjustment to the tree type to make certain operations more efficient.</p>\n\n<p>The paper focuses (ha ha) on <em>rose trees</em> - trees whose nodes have an arbitrary number of children. The code from the paper is in OCaml but translating it to Haskell doesn't require much adjustment:</p>\n\n<pre><code>data Rose a = Leaf a | Rose [Rose a]\n</code></pre>\n\n<p>To briefly recap, the idea of zippers is to represent a <em>position</em> in a data structure by its <em>context</em>. The context of a node in a rose tree consists of the path you took down the tree to reach the node's parent, and the path you took along the list of siblings to reach the node itself.</p>\n\n<pre><code>data Path a = Top | Node (Path a) [Rose a] [Rose a]\n\ndata Pos a = Pos { focus :: Rose a, path :: Path a }\n</code></pre>\n\n<p>This allows you to zoom in on a position in a tree without forgetting where you've been by walking <code>right</code> and <code>down</code>, and then rebuild the tree by retreating <code>left</code> and zooming out <code>up</code>.</p>\n\n<pre><code>right, down, left, up :: Pos a -&gt; Maybe (Pos a)\nright (Pos _ Top) = Nothing\nright (Pos _ (Node _ _ [])) = Nothing\nright (Pos t (Node p ls (r:rs))) = Just $ Pos r (Node p (t:ls) rs)\n\ndown (Pos (Leaf _) _) = Nothing\ndown (Pos (Rose []) _) = Nothing\ndown (Pos (Rose (t:ts)) p) = Just $ Pos t (Node p [] ts)\n\nleft (Pos _ Top) = Nothing\nleft (Pos _ (Node _ [] _)) = Nothing\nleft (Pos t (Node p (l:ls) rs) = Just $ Pos l (Node p ls (t:rs))\n\nup (Pos _ Top) = Nothing\nup (Pos t (Node p l r)) = Just $ Pos (Rose (l ++ t:r)) p\n</code></pre>\n\n<p>Look at the definition of <code>up</code>. It takes <code>t</code>, <code>l</code>, and <code>r</code> - the currently focused node and its siblings - and smashes them together into a single list of children. It forgets which node you were looking at. Accordingly, <code>down</code> focuses you on the left-most child of the current focus. If you need to go <code>up</code> and then back down to the previously focused node you have to walk <code>right</code> along the list back to where you were, which is an <em>O(n)</em> operation.</p>\n\n<p>Huet's idea of leaving 'scars' in the tree is about making it more convenient to return to a previously focused child. He equips the <code>Rose</code> constructor with a focus of its own, replacing the list of children with a list zipper.</p>\n\n<pre><code>data SRose a =  -- for \"scarred rose\"\n      SLeaf a\n    | SEmpty  -- replaces (Rose [])\n    | SRose [SRose a] (SRose a) [SRose a]\n</code></pre>\n\n<p>The <code>Path</code> and <code>Pos</code> types remain unchanged:</p>\n\n<pre><code>data SPath a = STop | SNode (SPath a) [SRose a] [SRose a]\ndata SPos a = SPos { sfocus :: Rose a, spath :: SPath a }\n</code></pre>\n\n<p>Now, when you go <code>up</code> and then back <code>down</code>, you don't forget what you were previously looking at.</p>\n\n<pre><code>up' (SPos _ STop) = Nothing\nup' (SPos t (SNode p l r)) = Just $ SPos (SRose l t r) p\n\ndown' (SPos (SLeaf _) _) = Nothing\ndown' (SPos SEmpty _) = Nothing\ndown' (SPos (SRose l t r) p) = Just $ SPos t (SNode p l r)\n</code></pre>\n"}], "owner": {"reputation": 781, "user_id": 1163717, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/cbba7289a669e4ca1fcf1064d0cf22fd?s=128&d=identicon&r=PG&f=1", "display_name": "The Red Fox", "link": "https://stackoverflow.com/users/1163717/the-red-fox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 5, "accepted_answer_id": 42629846, "answer_count": 1, "score": 16, "last_activity_date": 1533935881, "creation_date": 1488793135, "question_id": 42622107, "link": "https://stackoverflow.com/questions/42622107/what-are-scars-useful-for", "title": "What are scars useful for?", "body": "<p>In the paper titled \"The Zipper\" by Huet, he also mentions scars as a variation of zippers. Compared to zippers, which became pretty well known in the Haskell community, scars are pretty much unheard of. There is very little information about them in the paper itself and anywhere on the internet from what I could find.</p>\n\n<p>So I have to ask, are they just not useful at all or is there something they are useful for, but most people just don't know about them?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 5, "creation_date": 1488787616, "post_id": 42620331, "comment_id": 72369284, "body": "Why do you suppose they are not executing? Find a minimal example that demonstrates the problem, since this code is not it. Also, check your whitespace: it looks like there are tabs mixed with spaces, which will certainly do some weird things to you."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1488835329, "post_id": 42620331, "comment_id": 72399161, "body": "You pressed y and then enter, right? So y followed by a blank line. So getChar reads the y and getLine reads the blank line."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1488806362, "post_id": 42622129, "comment_id": 72381037, "body": "I&#39;m not sure <code>readLn</code> is a step in the right direction. You&#39;ve gone from treating anything other than <code>&#39;y&#39;</code> as a negative response to treating anything other than <code>&quot;Y&quot;</code> or <code>&quot;N&quot;</code> as a run-time error."}, {"owner": {"reputation": 7323, "user_id": 343957, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/FAVPm.jpg?s=128&g=1", "display_name": "mathk", "link": "https://stackoverflow.com/users/343957/mathk"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1488811046, "post_id": 42622129, "comment_id": 72384437, "body": "@chepner I was too lazy to define the Read instance to follow this behaviour and left that as an exercise for the OP ;)."}], "tags": [], "owner": {"reputation": 7323, "user_id": 343957, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/FAVPm.jpg?s=128&g=1", "display_name": "mathk", "link": "https://stackoverflow.com/users/343957/mathk"}, "is_accepted": true, "score": 2, "last_activity_date": 1488793612, "last_edit_date": 1488793612, "creation_date": 1488793192, "answer_id": 42622129, "question_id": 42620331, "link": "https://stackoverflow.com/questions/42620331/io-action-in-a-when-statement/42622129#42622129", "title": "IO action in a when statement", "body": "<p><code>getChar</code> will peak the <code>y</code> char but will let the <code>\\n</code> in the input stream.\nSo you need to flush the input stream before going further.</p>\n\n<p>Alternatively you can use the <code>readLn</code> providing you define a new data type:</p>\n\n<pre><code>data Choice = Y | N \n               deriving (Read, Show, Eq)\n\nputStrLn \"Do you want to add a task. Press y to add:\"\noption &lt;- readLn\nwhen (option == Y) $ do\n    print \"test\"\n    getLine &gt;&gt;= appendFile \"todoList.txt\" . (++\"\\n\")\n</code></pre>\n"}], "owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 42622129, "answer_count": 1, "score": 0, "last_activity_date": 1488793612, "creation_date": 1488787139, "question_id": 42620331, "link": "https://stackoverflow.com/questions/42620331/io-action-in-a-when-statement", "title": "IO action in a when statement", "body": "<p>Can anyone tell me why I cannot add a IO statement within a do block? This code only prints \"test\" and then completes execution. The last two lines do not seem to be executing.</p>\n\n<pre><code>putStrLn \"Do you want to add a task. Press y to add:\"\noption &lt;- getChar\nwhen (option == 'y') $ do \n  print \"test\"\n  newText &lt;- getLine\n  appendFile \"todoList.txt\" (newText ++ \"\\n\")\n</code></pre>\n"}, {"tags": ["arrays", "list", "haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1488832912, "post_id": 42616544, "comment_id": 72397895, "body": "No, you cannot use anything but a list in a list comprehension."}, {"owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1488885357, "post_id": 42616544, "comment_id": 72420011, "body": "I see what you did there..."}], "answers": [{"tags": [], "owner": {"reputation": 5058, "user_id": 1653187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3942782a314cdc7d6a7364cd32bfd3b3?s=128&d=identicon&r=PG", "display_name": "nickie", "link": "https://stackoverflow.com/users/1653187/nickie"}, "is_accepted": true, "score": 4, "last_activity_date": 1488767330, "creation_date": 1488767330, "answer_id": 42616598, "question_id": 42616544, "link": "https://stackoverflow.com/questions/42616544/using-an-array-in-a-list-comprehension/42616598#42616598", "title": "Using an Array in a List Comprehension?", "body": "<p>I believe you're looking for <code>indices</code>, <code>elems</code> or <code>assoc</code>:</p>\n\n<pre><code>Prelude&gt; import Data.Array\nPrelude Data.Array&gt; let arr = accumArray (+) 0 (0, 7) [(0,1),(1,1),(2,1),(3,1),(4,1),(5,1),(6,1)]\nPrelude Data.Array&gt; indices arr\n[0,1,2,3,4,5,6,7]\nPrelude Data.Array&gt; elems arr\n[1,1,1,1,1,1,1,0]\nPrelude Data.Array&gt; [2*k + x | (k, x) &lt;- assocs arr]\n[1,3,5,7,9,11,13,14]\n</code></pre>\n\n<p>The last one shows you how to write a generic list comprehension.</p>\n\n<p>For more information, you should consult the <a href=\"https://hackage.haskell.org/package/array/docs/Data-Array.html\" rel=\"nofollow noreferrer\">documentation of <code>Data.Array</code></a>.</p>\n"}], "owner": {"reputation": 13393, "user_id": 1772334, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/36bbc437a85c7654d1841ad508c78acb?s=128&d=identicon&r=PG", "display_name": "Abraham P", "link": "https://stackoverflow.com/users/1772334/abraham-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 42616598, "answer_count": 1, "score": 3, "last_activity_date": 1488767330, "creation_date": 1488766884, "question_id": 42616544, "link": "https://stackoverflow.com/questions/42616544/using-an-array-in-a-list-comprehension", "title": "Using an Array in a List Comprehension?", "body": "<p>I am working through The Pearls of Functional Algorithm Design book. I am having issues with a provided example. In the book, the author uses an array in a list comprehension like so:</p>\n\n<pre><code>countlist :: [Int] \u2192 Array Int Int\ncountlist xs = accumArray (+) 0 (0, n ) (zip xs (repeat 1))\n\nsort xs = concat [replicate k x | (x,k)\u2190countlist xs]\n</code></pre>\n\n<p>I've then transposed this (with minimal modification) into real runnable code:    </p>\n\n<pre><code>countlist :: [Int] -&gt; Array Int Int   \ncountlist xs = accumArray (+) 0 (0, n)(zip xs (repeat 1))\n               where n = length xs \n\nsortLinearTime :: [Int] -&gt; [Int]\nsortLinearTime xs = concat [replicate k x | (x, k) &lt;- countlist xs]\n</code></pre>\n\n<p>This however does not compile with:</p>\n\n<pre><code>Couldn't match expected type \u2018[(Int, Int)]\u2019\n                  with actual type \u2018Array Int Int\u2019\n    \u2022 In the expression: countlist xs\n      In a stmt of a list comprehension: (x, k) &lt;- countlist xs\n      In the first argument of \u2018concat\u2019, namely\n        \u2018[replicate k x | (x, k) &lt;- countlist xs]\u2019\n</code></pre>\n\n<p>Using <code>ghci</code> to construct a minimal example:</p>\n\n<pre><code>import Data.Array\nlet arr = accumArray (+) 0 (0, 7) [(0,1),(1,1),(2,1),(3,1),(4,1),(5,1),(6,1)]\n[x | (k, x) &lt;- arr]\n</code></pre>\n\n<p>Which results in:</p>\n\n<pre><code>Couldn't match expected type \u2018[(t0, t)]\u2019\n            with actual type \u2018Array Integer Integer\u2019\nRelevant bindings include it :: [t] (bound at &lt;interactive&gt;:38:1)\nIn the expression: arr\nIn a stmt of a list comprehension: (k, x) &lt;- arr\n</code></pre>\n\n<p>So how is it possible for me to use a <code>Data.Array</code> in a list comprehension?</p>\n"}, {"tags": ["javascript", "haskell", "functional-programming", "pattern-matching", "gadt"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 6, "creation_date": 1488751614, "post_id": 42614524, "comment_id": 72358183, "body": "Could you please show the definition of the Haskell type you&#39;re trying to imitate?"}, {"owner": {"reputation": 1, "user_id": 2801559, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/9538ef609067e6d6a842dfef189b77d2?s=128&d=identicon&r=PG", "display_name": "guest271314", "link": "https://stackoverflow.com/users/2801559/guest271314"}, "edited": false, "score": 0, "creation_date": 1488751639, "post_id": 42614524, "comment_id": 72358192, "body": "Not sure what expected result it?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1488753376, "post_id": 42614524, "comment_id": 72358744, "body": "I have no idea about how the code above would be related to a sum type. A sum type has two constructors (or N&gt;=2 constructors, in its N-ary variant), and one destructor/eliminator with 2 (or N) arguments. You might wish to look up the Church encoding of sum types."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1488755064, "post_id": 42614524, "comment_id": 72359196, "body": "Cross-language questions in general are okay on SO, but my only caution is that you don&#39;t waste too much of your time trying to squeeze a language until it looks like another. The syntax and features will be different, so instead focus on how you would do it in that particular language. JavaScript is unique in that it allows you to use many different paradigms, but don&#39;t forget about readability. Try to keep it simple."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1488763882, "post_id": 42614524, "comment_id": 72361418, "body": "This implementation of a &#39;sum type&#39; seems to do two things which differentiate it from actual sum types; firstly, it is the CPS encoding, but not of the sum, rather of the product in each variant of the sum (the &#39;sum&#39; is the switch); and what is typically called a &#39;smart constructor&#39; is embedded in the type definition itself. You also have a &#39;type&#39; which is essentially <code>Either Char String</code>, but this is much easier to write as <code>(Bool, String)</code> especially in JS. While I see how this is &#39;technically&#39; a sum type, it&#39;s not used like this in Haskell (esp. embedding smart constructors in the type)."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1488765201, "post_id": 42614524, "comment_id": 72361696, "body": "Yes, mixing up types with constructors is a very bad idea. You should implement the same distinction in your JS code."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1488765247, "post_id": 42614524, "comment_id": 72361710, "body": "Btw, your <code>switch</code> statement looks quite like you <i>did</i> successfully map the concept of pattern matching over to JS."}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488769292, "post_id": 42614524, "comment_id": 72362631, "body": "@user2407038 The CPS encoding is most certainly familiar to OO practitioners. They call it the \u201cvisitor pattern\u201d."}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1488769356, "post_id": 42614524, "comment_id": 72362646, "body": "@Bergi The JavaScript encoding of pattern matching is lossy. With genuine pattern matching, constructor arguments are only available in the branch that handles that specific constructor."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488788005, "post_id": 42614524, "comment_id": 72369485, "body": "@user2407038, bergi this was helpful, thanks. I think you pushed me in the right direction."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1488788288, "post_id": 42614524, "comment_id": 72369619, "body": "@4castle I added the Haskell type as I would define it."}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "edited": false, "score": 1, "creation_date": 1488796928, "post_id": 42614524, "comment_id": 72375056, "body": "@ftor Something like <a href=\"https://github.com/fantasyland/daggy/blob/master/src/daggy.js\" rel=\"nofollow noreferrer\"><code>daggy</code></a>, perhaps? It uses a kind of Church encoding, with some syntactic niceties."}], "answers": [{"comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1488810943, "post_id": 42627454, "comment_id": 72384365, "body": "Functional programming includes immutability, so the loss of that first feature shouldn&#39;t be a problem."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1489190067, "post_id": 42627454, "comment_id": 72578762, "body": "@4castle No, &quot;modify the type&quot; there refers to editing the source code to change the number of fields in one of the cases (e.g. realising that we need an extra field in the Fullname case for the person&#39;s title), nothing to do with mutability of values at runtime."}], "tags": [], "owner": {"reputation": 224912, "user_id": 33518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d06834fe3fb105f62b2186aba4a430d5?s=128&d=identicon&r=PG", "display_name": "Tomas Petricek", "link": "https://stackoverflow.com/users/33518/tomas-petricek"}, "is_accepted": true, "score": 4, "last_activity_date": 1488808542, "creation_date": 1488808542, "answer_id": 42627454, "question_id": 42614524, "link": "https://stackoverflow.com/questions/42614524/how-to-implement-sum-types-in-dynamically-typed-languages-without-pattern-matchi/42627454#42627454", "title": "How to implement sum types in dynamically typed languages without pattern matching", "body": "<p>I think your encoding is a bit too complex because it involves not just the data type itself, but also the <code>show</code> operation. </p>\n\n<p>The essence of sum types is that they give you a way to create values that represent one or more cases and then write processing code using pattern matching. A slightly simpler version of your example with just full name or a short name would be:</p>\n\n<pre><code>data Name = \n    FullName String String\n  | NickName String\n</code></pre>\n\n<p>Then you can write a function to process a name by handling the two cases separately:</p>\n\n<pre><code>case name of\n  FullName first last -&gt; \"Full name: \" ++ first ++ \" \" ++ last\n  NickName nick -&gt; \"Nick name: \" ++ nick\n</code></pre>\n\n<p>The key idea is that when you have a name, you can detect which of the two cases it is and write code to handle the two cases separately. In JavaScript, you can do this by including some sort of tag in your value:</p>\n\n<pre><code>function FullName(first, last) { \n  return { Tag: \"FullName\", Values: [first, last] };\n}\nfunction NickName(nick) { \n  return { \"Tag\": \"NickName\", Values: [nick] };\n}\n</code></pre>\n\n<p>Now you can write code akin to pattern matching using <code>switch</code> on the <code>Tag</code>:</p>\n\n<pre><code>switch(name.Tag) { \n  case \"FullName\": \n    let [first, last] = name.Values;\n    return \"Full name: \" + first + \" \" + last;\n  case \"NickName\":\n    let [nick] = name.Values\n    \"Nick name: \" + nick;\n}\n</code></pre>\n\n<p>However, without the language support, you lose many of the nice features:</p>\n\n<ul>\n<li>There are no checks when extracting values. If you modify the type and add more fields, then the pattern matching will start failing.</li>\n<li>There are no checks whether you are covering all cases - when you add another kind of name, the switch statements will not cover that</li>\n<li>There is no checking on tag names. It is easy to make a typo.</li>\n</ul>\n\n<p>So, you can certainly use this kind of encoding in JavaScript, but it does not give you as much as in languages that support sum types directly. If there is a more idiomatic JavaScript solution to the problem you are having, it will probably work better.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 864, "favorite_count": 0, "accepted_answer_id": 42627454, "answer_count": 1, "score": 3, "last_activity_date": 1547912449, "creation_date": 1488750689, "last_edit_date": 1547912449, "question_id": 42614524, "link": "https://stackoverflow.com/questions/42614524/how-to-implement-sum-types-in-dynamically-typed-languages-without-pattern-matchi", "title": "How to implement sum types in dynamically typed languages without pattern matching", "body": "<p>I have only a theoretical idea of Haskell's sum types. And yet I sense that they really matter in Haskell and change the way you model your data in a fundamental way. Since I believe that they can be useful in dynamically typed languages as well, I tried to implement a sensible approximation in Javascript (I have only a superficial knowledge of Haskell).</p>\n\n<p>Here is a more or less useful example of a <code>Name</code> sum type, that is able to handle various name formats. I know that Haskell distinguishes between type and data constructors and probably has good reasons to make such distinction. However, I guess that it is not possible to map this concept to Javascript. And pattern matching neither.</p>\n\n<p>Anyway, my actual question is: Does the following implementation embody the nature of sum types and the way they are applied in Haskell?</p>\n\n<p>Please note: I am not sure if this kind of cross-language questions are welcome on SO. Please let me know in case I should avoid them.</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>// auxiliary functions\r\n\r\nconst A = f =&gt; x =&gt; f(x);\r\nconst show = api =&gt; api.show;\r\n\r\n// the type constructor\r\n\r\nconst Name = (...xs) =&gt; A(({length: len}) =&gt; {\r\n  switch (len) {\r\n    case 1: {\r\n      let [{length: len}] = xs; // no pattern matching but destructuring\r\n\r\n      if (len &gt; 1) { // no Char type in JS\r\n        return k =&gt; k({show: () =&gt; xs[0]}); // returns the API\r\n      }\r\n\r\n      break;\r\n    }\r\n\r\n    case 2: {\r\n      let [{length: len}, {length: len2}] = xs;\r\n\r\n      if (len &gt; 1 &amp;&amp; len2 &gt; 1) {\r\n        return k =&gt; k({show: () =&gt; `${xs[0]} ${xs[1]}`});\r\n      }\r\n\r\n      if (len === 1 &amp;&amp; len2 &gt; 1) {\r\n        return k =&gt; k({show: () =&gt; `${xs[0]}. ${xs[1]}`});\r\n      }\r\n\r\n      break;\r\n    }\r\n\r\n    case 3: {\r\n      let [{length: len}, {length: len2}, {length: len3}] = xs;\r\n\r\n      if (len &gt; 1 &amp;&amp; len2 &gt; 1 &amp;&amp; len3 &gt; 1) {\r\n        return k =&gt; k({show: () =&gt; `${xs[0]} ${xs[1]} ${xs[2]}`});\r\n      }\r\n\r\n      if (len &gt; 1 &amp;&amp; len2 === 1 &amp;&amp; len3 &gt; 1) {\r\n        return k =&gt; k({show: () =&gt; `${xs[0]} ${xs[1]}. ${xs[2]}`});\r\n      }\r\n\r\n      if (len === 1 &amp;&amp; len2 === 1 &amp;&amp; len3 &gt; 1) {\r\n        return k =&gt; k({show: () =&gt; `${xs[0]}. ${xs[1]}. ${xs[2]}`});\r\n      }\r\n    }\r\n\r\n    default: throw new TypeError();\r\n  }\r\n}) (xs);\r\n\r\n// run\r\n\r\nconsole.log(Name(\"Kerouac\") (show) ());\r\nconsole.log(Name(\"Hans\", \"H\u00f6lzel\") (show) ());\r\nconsole.log(Name(\"H\", \"Curry\") (show) ());\r\nconsole.log(Name(\"Jean\", \"Luc\", \"Godard\") (show) ());\r\nconsole.log(Name(\"William\", \"S\", \"Burroughs\") (show) ());\r\nconsole.log(Name(\"E\", \"W\", \"Dijkstra\") (show) ());</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p><strong>[EDIT]</strong></p>\n\n<p>Sorry, I should have provided some Haskell code:</p>\n\n<pre><code>type FirstName = String\ntype LastName = String\ntype MiddleName = String\n\ndata Name = FullName FirstName LastName\n  | NameWithMiddle FirstName MiddleName LastName\n  | NameWithMiddleInitial FirstName Char LastName\n  | TwoInitialsWithLast Char Char LastName\n  | OneInitialWithLast Char LastName\n  | LastNameOnly LastName\n</code></pre>\n\n<p>I am not sure if this is valid though.</p>\n\n<p>I guess the problem with my approach is that I try to implement the type constructor <code>Name</code>, while I should implement the value constructors, right?</p>\n"}, {"tags": ["performance", "haskell", "pattern-matching"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488739485, "post_id": 42612107, "comment_id": 72353813, "body": "The <code>-ddump-simpl</code> for the four (including from previous question edits) example functions doesn&#39;t seem to exhibit any difference. Their core is identical. I&#39;m not sure if this is generalizable though."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1488743458, "post_id": 42612107, "comment_id": 72355323, "body": "The fact that <code>(:)</code> takes arguments isn&#39;t really relevant. <code>list</code> is a value that is constructed by either <code>[]</code> or <code>(:)</code>; that&#39;s the only thing the underlying code needs to look at."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1488744828, "post_id": 42612107, "comment_id": 72355824, "body": "@chepner Yes, but the underscores in <code>(_ : _)</code> aren&#39;t omittable. <code>[]</code> is nullary and the <code>:</code> constructor binary."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1488744921, "post_id": 42612107, "comment_id": 72355845, "body": "I didn&#39;t say they could be omitted. The compiler just doesn&#39;t generate any code to see what the arguments might be, because you&#39;ve said with the <code>_</code> that their values won&#39;t be used. <code>list</code> will be a value of some kind that is tagged with (the equivalent of) either <code>[]</code> or <code>(:)</code>, and the compiler just needs to look at the tag."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1488745192, "post_id": 42612107, "comment_id": 72355944, "body": "You could pass either function the value <code>undefined : undefined</code>, and each one would still return <code>False</code> without any error."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1488746362, "post_id": 42612488, "comment_id": 72356357, "body": "In your first sentence, &quot;[do] not expect performance to change predictably&quot; and &quot;expect the generated code to be identical&quot; appear to be at odds: surely &quot;I expect the performance not to change&quot; is a prediction!"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1488747281, "post_id": 42612488, "comment_id": 72356688, "body": "the <code>bar = foo</code> line is why I recommended using two different files - because  I think I heard brian o&#39;sullivan once saying that the optimizer might do stuff like that, therefore he benchmarks similar functions in different modules/packages."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1488748095, "post_id": 42612488, "comment_id": 72356972, "body": "@DanielWagner what I meant was: I usually find doing superficial changes like the op&#39;s results in the same code, but in cases where the generated code is different I find both performance differences and generated code differences were unpredictable looking at the original source (thinking here of things like the ordering of branches in the final generated code; it&#39;s not clear to me if and how this relates to the boolean operators used, ordering of case statements, etc). But I would be interested if you disagree!"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 12, "last_activity_date": 1488739674, "creation_date": 1488739674, "answer_id": 42612488, "question_id": 42612107, "link": "https://stackoverflow.com/questions/42612107/implicit-pattern-matching-in-haskell/42612488#42612488", "title": "Implicit pattern matching in Haskell", "body": "<p>In general you should not expect performance to change predictably between trivial fiddling around with patterns like what you're asking about, and can often expect the generated code to be identical.</p>\n\n<p>But the way to actually check is to look at core and or benchmark with criterion. In this case the generated code is the same, and indeed GHC seems to actually combine them:</p>\n\n<p>I compiled the snippet above with</p>\n\n<pre><code>ghc -Wall -O2 -ddump-to-file -ddump-simpl -dsuppress-module-prefixes -dsuppress-uniques -fforce-recomp  YourCode.hs\n</code></pre>\n\n<p>And we see this core:</p>\n\n<pre><code>foo :: forall t. [t] -&gt; Bool\n[GblId,\n Arity=1,\n Caf=NoCafRefs,\n Str=DmdType &lt;S,1*U&gt;,\n Unf=Unf{Src=InlineStable, TopLvl=True, Value=True, ConLike=True,\n         WorkFree=True, Expandable=True,\n         Guidance=ALWAYS_IF(arity=1,unsat_ok=True,boring_ok=False)\n         Tmpl= \\ (@ t) (list [Occ=Once!] :: [t]) -&gt;\n                 case list of _ [Occ=Dead] {\n                   [] -&gt; True;\n                   : _ [Occ=Dead] _ [Occ=Dead] -&gt; False\n                 }}]\nfoo =\n  \\ (@ t) (list :: [t]) -&gt;\n    case list of _ [Occ=Dead] {\n      [] -&gt; True;\n      : ds ds1 -&gt; False\n    }\n\n-- RHS size: {terms: 1, types: 0, coercions: 0}\nbar :: forall t. [t] -&gt; Bool\n[GblId,\n Arity=1,\n Caf=NoCafRefs,\n Str=DmdType &lt;S,1*U&gt;,\n Unf=Unf{Src=InlineStable, TopLvl=True, Value=True, ConLike=True,\n         WorkFree=True, Expandable=True,\n         Guidance=ALWAYS_IF(arity=1,unsat_ok=True,boring_ok=False)\n         Tmpl= \\ (@ t) (list [Occ=Once!] :: [t]) -&gt;\n                 case list of _ [Occ=Dead] {\n                   [] -&gt; True;\n                   : _ [Occ=Dead] _ [Occ=Dead] -&gt; False\n                 }}]\nbar = foo\n</code></pre>\n\n<p>I think the <code>Tmpl</code> stuff is the original implementation exposed for inlining in other modules, but I'm not certain.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1503412421, "creation_date": 1488737759, "last_edit_date": 1503412421, "question_id": 42612107, "link": "https://stackoverflow.com/questions/42612107/implicit-pattern-matching-in-haskell", "title": "Implicit pattern matching in Haskell", "body": "<p>Should one expect performance differences between these two <code>empty</code>s, or is it merely a matter of stylistic preference?</p>\n\n<pre><code>foo list = case list of\n   []      -&gt; True\n   (_ : _) -&gt; False\n\nbar list = case list of\n   (_ : _) -&gt; False\n   _       -&gt; True\n</code></pre>\n"}, {"tags": ["haskell", "casting", "functional-programming"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1488729212, "post_id": 42610448, "comment_id": 72350123, "body": "I don&#39;t know much Haskell, but I cannot understand how a <code>read</code> function can be pure: by definition it has <i>significant</i> side effects."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 10, "creation_date": 1488729247, "post_id": 42610448, "comment_id": 72350139, "body": "@BasileStarynkevitch <code>read</code> doesn&#39;t read from input; it merely converts its argument to a <code>String</code> (like the Python <code>__str__</code> method)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1488729425, "post_id": 42610448, "comment_id": 72350205, "body": "It&#39;s one of several functions in the Prelude (including <code>head</code> and <code>tail</code>) that could have been made total, but were defined as partial functions for the sake of simplicity."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 4, "creation_date": 1488730781, "post_id": 42610448, "comment_id": 72350700, "body": "@BasileStarynkevitch Why do you think that parsing a string requires significant side effects?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1488751067, "post_id": 42610448, "comment_id": 72358012, "body": "@BasileStarynkevitch Are you possibly confusing <code>read</code> with <code>getLine</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1488809496, "post_id": 42610448, "comment_id": 72383225, "body": "@chepner Nitpick: I think you are describing <code>show</code> rather than <code>read</code>, which goes in the opposite direction. Still the general point stands: <code>read</code> converts from a <code>String</code> to some type, but does not perform any input/output."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1488809755, "post_id": 42610448, "comment_id": 72383414, "body": "Bah, I am. <code>s&#47;to&#47;from&#47;</code>, and ignore the Python reference."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1488749184, "post_id": 42610544, "comment_id": 72357353, "body": "Adding <code>readMaybe</code> to the Prelude <a href=\"https://mail.haskell.org/pipermail/libraries/2016-December/027496.html\" rel=\"nofollow noreferrer\">cam up recently in the libraries mailing list</a>."}], "tags": [], "owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "is_accepted": true, "score": 24, "last_activity_date": 1488737358, "last_edit_date": 1488737358, "creation_date": 1488729552, "answer_id": 42610544, "question_id": 42610448, "link": "https://stackoverflow.com/questions/42610448/is-there-a-total-alternative-to-the-read-function/42610544#42610544", "title": "Is there a total alternative to the `read` function?", "body": "<p>The function you are looking for is called <code>readMaybe</code> and is defined in the module <code>Text.Read</code>:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Text-Read.html#v:readMaybe\" rel=\"noreferrer\">https://hackage.haskell.org/package/base-4.9.1.0/docs/Text-Read.html#v:readMaybe</a></p>\n\n<p>It is available since GHC 7.6. Before that you had to call <code>reads</code>, which returns a (potentially empty) list of parsed values, and pattern match on it.</p>\n"}], "owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 778, "favorite_count": 1, "accepted_answer_id": 42610544, "answer_count": 1, "score": 17, "last_activity_date": 1490780215, "creation_date": 1488729062, "last_edit_date": 1490780215, "question_id": 42610448, "link": "https://stackoverflow.com/questions/42610448/is-there-a-total-alternative-to-the-read-function", "title": "Is there a total alternative to the `read` function?", "body": "<p>Why does the function <code>read</code> terminate the executable when it cannot parse its argument?</p>\n\n<p>It seems to me that it would be more convenient to have a function of type <code>String -&gt; Maybe a</code>, which returns <code>Nothing</code> if the string couldn't be parsed to the type <code>a</code>, but I can't find anything like it. What am I missing?</p>\n"}, {"tags": ["haskell", "scope"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 4, "creation_date": 1488726233, "post_id": 42609508, "comment_id": 72349134, "body": "note: you can always use hoogle to search for something like that <a href=\"http://hoogle.haskell.org/?hoogle=catch\" rel=\"nofollow noreferrer\">hoogle.haskell.org/?hoogle=catch</a>"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1488736777, "post_id": 42609508, "comment_id": 72352858, "body": "This presumably arose because <code>catch</code> used to be in the <code>Prelude</code>."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 21, "last_activity_date": 1488724827, "creation_date": 1488724827, "answer_id": 42609708, "question_id": 42609508, "link": "https://stackoverflow.com/questions/42609508/not-in-scope-catch/42609708#42609708", "title": "Not in scope: `catch&#39;", "body": "<p><code>catch</code> is exported by the <code>Control.Exception</code> module.</p>\n\n<pre><code>import Control.Exception\n</code></pre>\n"}], "owner": {"reputation": 309, "user_id": 2372684, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AW7Sa.jpg?s=128&g=1", "display_name": "bling5630", "link": "https://stackoverflow.com/users/2372684/bling5630"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1194, "favorite_count": 1, "accepted_answer_id": 42609708, "answer_count": 1, "score": 9, "last_activity_date": 1490034973, "creation_date": 1488723754, "last_edit_date": 1490034973, "question_id": 42609508, "link": "https://stackoverflow.com/questions/42609508/not-in-scope-catch", "title": "Not in scope: `catch&#39;", "body": "<p>I am reading learn you a haskell for great good but i faced an error of Not in scope: `catch' when I read the exception section in input &amp; output chapter</p>\n\n<p>here is my code:</p>\n\n<pre><code>import System.Environment  \nimport System.IO  \nimport System.IO.Error  \n\nmain = toTry `catch` handler  \n\ntoTry :: IO ()  \ntoTry = do (fileName:_) &lt;- getArgs  \n           contents &lt;- readFile fileName  \n           putStrLn $ \"The file has \" ++ show (length (lines contents)) ++ \" lines!\"  \n\nhandler :: IOError -&gt; IO ()  \nhandler e = putStrLn \"Whoops, had some trouble!\"  \n</code></pre>\n\n<p>and I get this error message:</p>\n\n<pre><code>Not in scope: `catch'\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1488723017, "post_id": 42609145, "comment_id": 72348114, "body": "This feels a bit like you have a problem with the solution you came up with. Can you give us a bit more context of what you try to achieve?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1488723644, "post_id": 42609145, "comment_id": 72348290, "body": "Please be so kind and add signatures to all function definitions - so you can make sure your functions are as expected"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1488728647, "post_id": 42609145, "comment_id": 72349937, "body": "It seems as if you want to both update the state in the state monad and perform IO access (to the array). You can&#39;t do that at the same time: either you work in state monad or in the IO one. If you want to do both, you have to pick a monad which allows both e.g. <code>StateT (IOArray ...) IO</code>, using monad transformers and <code>liftIO</code> to embed the IO actions. This requires some advanced understanding of monads, though. However, maybe what you need is much simpler than that. You should explain your task better: using state monad+IO arrays+IO+Map is a bit weird to see."}, {"owner": {"reputation": 2370, "user_id": 1234909, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/b3bdc7ab5eb0c5d8cc22e3b44baea868?s=128&d=identicon&r=PG", "display_name": "Mohan Radhakrishnan", "link": "https://stackoverflow.com/users/1234909/mohan-radhakrishnan"}, "edited": false, "score": 0, "creation_date": 1488729437, "post_id": 42609145, "comment_id": 72350209, "body": "Maybe what you suggest is better. I just need a &#39;global&#39; array which I can read and write to."}, {"owner": {"reputation": 2370, "user_id": 1234909, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/b3bdc7ab5eb0c5d8cc22e3b44baea868?s=128&d=identicon&r=PG", "display_name": "Mohan Radhakrishnan", "link": "https://stackoverflow.com/users/1234909/mohan-radhakrishnan"}, "edited": false, "score": 0, "creation_date": 1488730901, "post_id": 42609145, "comment_id": 72350744, "body": "But it should be globally accessible. Multiple functions read and write to it."}], "answers": [{"tags": [], "owner": {"reputation": 2370, "user_id": 1234909, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/b3bdc7ab5eb0c5d8cc22e3b44baea868?s=128&d=identicon&r=PG", "display_name": "Mohan Radhakrishnan", "link": "https://stackoverflow.com/users/1234909/mohan-radhakrishnan"}, "is_accepted": true, "score": 0, "last_activity_date": 1488800634, "creation_date": 1488800634, "answer_id": 42624798, "question_id": 42609145, "link": "https://stackoverflow.com/questions/42609145/state-monad-mix-io-and-non-io/42624798#42624798", "title": "State Monad mix IO and non-IO", "body": "<p>My own answer. I think this is the idiomatic Haskell answer. Other experts can opine. Not sure how to make the array globally accessible though. I am told that isn't correct Haskell.</p>\n\n<pre><code>   type ArrayAccess = ReaderT  (IOArray Int Int)  IO \n   type ArrayWriteAccess = ReaderT  (IOArray Int Int)  IO() \n\n   readvalue ::  Int -&gt; ArrayAccess Int   \n   readvalue x    = do \n   a &lt;- ask\n   b &lt;- liftIO( readArray a x);    \n   return b\n\n   writevalue ::  Int -&gt; Int -&gt; ArrayWriteAccess   \n   writevalue x y   = do \n   a &lt;- ask\n   liftIO( writeArray a x y)    \n\n   -- Test array accesses\n   readfromarray = do { a &lt;- createarray; liftIO (runReaderT (readvalue 1) a) }\n   writetoarray = do { a &lt;- createarray; liftIO (runReaderT (writevalue 1 2) a) }\n</code></pre>\n"}], "owner": {"reputation": 2370, "user_id": 1234909, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/b3bdc7ab5eb0c5d8cc22e3b44baea868?s=128&d=identicon&r=PG", "display_name": "Mohan Radhakrishnan", "link": "https://stackoverflow.com/users/1234909/mohan-radhakrishnan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 1, "accepted_answer_id": 42624798, "answer_count": 1, "score": 0, "last_activity_date": 1489038620, "creation_date": 1488721835, "last_edit_date": 1489038620, "question_id": 42609145, "link": "https://stackoverflow.com/questions/42609145/state-monad-mix-io-and-non-io", "title": "State Monad mix IO and non-IO", "body": "<p>I tried to use State Monad for simple variables and it work. But here it seems that I am trying mix IO and non-IO.\nThe intention to have a array managed by the State Monad. I want to read and write to this array.</p>\n\n<p>Seems harder than I thought.</p>\n\n<pre><code>        funarray :: Map.Map String (IOArray Int Int)\n        funarray = Map.empty\n\n        storearray :: String -&gt;  (IOArray Int Int)-&gt; State (Map.Map String  (IOArray Int Int)) ()\n        storearray x value = do\n        funarray &lt;- get\n        put (Map.insert x value funarray)\n\n        retrievearray :: String -&gt; State (Map.Map String  (IOArray Int Int)) (Maybe ( (IOArray Int Int)))\n        retrievearray arr = do\n        funarray &lt;- get\n        return (Map.lookup arr funarray)\n\n        putmutablearray = do {\n                   arr &lt;- newArray (512,512) 0 ;\n                   storearray \"value-table\" arr\n                 }\n        getmutablearray = do { retrievearray \"value-table\";}\n\n        putthenget = do {putmutablearray; getmutablearray;}\n\n        value :: BoardState -&gt; IO Int\n        value  (BoardState xloc oloc index) = do {\n          arr &lt;- (runState putthenget funarray);\n          v &lt;- (readArray arr index);\n          return v\n        }\n</code></pre>\n\n<p>Multiple errors starting with this.</p>\n\n<pre><code>* Couldn't match expected type `IOArray Int Int'\n              with actual type `IO (IOArray Int Int)'\n* In the second argument of `storearray', namely `createarray'\n  In a stmt of a 'do' block: storearray \"value-table\" createarray\n  In the expression: do { storearray \"value-table\" createarray }\n</code></pre>\n\n<p>Can I mix them ?</p>\n\n<p>This is just a global array. A large one. I need large ones for Machine Learning tasks.</p>\n\n<p>Update : In an imperative language I would store this globally.</p>\n\n<pre><code>          createarray :: IO ( IOArray Int Int)\n          createarray =  do {\n                   arr &lt;- newArray (512,512) 0;\n                   return arr\n              }\n</code></pre>\n"}, {"tags": ["haskell", "type-signature"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1488721811, "post_id": 42608888, "comment_id": 72347704, "body": "There are no automatic type conversions in Haskell. If you have <code>a*b</code>, <code>a</code> and <code>b</code> must be of the same type. How do you expect to get an <code>Integral</code> type out of <code>0.8</code> in some power multiplied by something else?"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 4, "last_activity_date": 1488722268, "creation_date": 1488722268, "answer_id": 42609209, "question_id": 42608888, "link": "https://stackoverflow.com/questions/42608888/haskell-type-signature-error/42609209#42609209", "title": "Haskell Type Signature Error", "body": "<p>Use <code>fromIntegral</code> to convert the return value of <code>ncr</code> to something you can multiply with <code>Num a =&gt; a</code> values.</p>\n\n<pre><code>bTable n p k = fromIntegral (ncr n k) * p^k * (1-p)^(n-k)\n</code></pre>\n\n<p>Note the inferred type of this function is then </p>\n\n<pre><code>bTable :: (Num a, Integral b) =&gt; b -&gt; a -&gt; b -&gt; a\n</code></pre>\n\n<p>which is slightly different from your attempted declared type (with constraints renamed for comparison to the type above)</p>\n\n<pre><code>bTable :: (Num a, Integral b) =&gt; b -&gt; a -&gt; b -&gt; b \n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 7661734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d07c93a7259a1a5c2cde52d29e3f3f4?s=128&d=identicon&r=PG&f=1", "display_name": "A. Ano", "link": "https://stackoverflow.com/users/7661734/a-ano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1488722268, "creation_date": 1488720409, "last_edit_date": 1488721142, "question_id": 42608888, "link": "https://stackoverflow.com/questions/42608888/haskell-type-signature-error", "title": "Haskell Type Signature Error", "body": "<p>My function does not work. I tried many different Type signatures. If I remove the Type Signature it does not work with a point number as \"p\".</p>\n\n<pre><code>fak :: (Num a, Ord a) =&gt; a-&gt;a\nfak x\n    | x &lt;= 1 = 1\n    | otherwise = x*fak (x-1)\n\nncr :: Integral a =&gt; a -&gt; a -&gt; a\nncr n k = (fak n) `div` (fak(n-k) * fak k)\n\nbTable :: (Integral a, Num b) =&gt; a-&gt;b-&gt;a-&gt;a \nbTable n p k = (ncr n k) * p^k * (1-p)^(n-k)\n</code></pre>\n\n<p>Inferred type is not general enough</p>\n\n<pre><code>*** Expression    : bTable\n*** Expected type : (Integral a, Num b) =&gt; a -&gt; b -&gt; a -&gt; a\n*** Inferred type : (Integral a, Num a) =&gt; a -&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>If I remove the Type Signature I get:</p>\n\n<pre><code>:t bTable\nbTable :: Integral a =&gt; a -&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>But If I enter:</p>\n\n<pre><code>bTable 50 0.8 10\n</code></pre>\n\n<p>I get </p>\n\n<pre><code>Unresolved overloading\n*** Type       : (Fractional a, Integral a) =&gt; a\n*** Expression : bTable 50 0.8 10\n</code></pre>\n"}, {"tags": ["haskell", "ocaml"], "answers": [{"comments": [{"owner": {"reputation": 8560, "user_id": 1633665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b603faf464ae55fcdd7dc2fb3b7ac063?s=128&d=identicon&r=PG", "display_name": "Virgile", "link": "https://stackoverflow.com/users/1633665/virgile"}, "edited": false, "score": 1, "creation_date": 1488787279, "post_id": 42605675, "comment_id": 72369111, "body": "You can also have a generic definition by extending the functor: <code>module MyMap(O:Map.OrderedType) = struct include Map.Make(O) let find_with_default dflt map key = try find map key with Not_found -&gt; dflt end</code>"}], "tags": [], "owner": {"reputation": 57265, "user_id": 821679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64f564c4721ee3125fa835f6c3a5283c?s=128&d=identicon&r=PG", "display_name": "Jeffrey Scofield", "link": "https://stackoverflow.com/users/821679/jeffrey-scofield"}, "is_accepted": true, "score": 1, "last_activity_date": 1488700889, "last_edit_date": 1488700889, "creation_date": 1488698687, "answer_id": 42605675, "question_id": 42605486, "link": "https://stackoverflow.com/questions/42605486/haskells-map-findwithdefault-ocaml-equivalent/42605675#42605675", "title": "Haskell&#39;s Map.findwithdefault ocaml equivalent", "body": "<p>There's no such function in the OCaml standard Map library. You can implement a version for a single map module (i.e., a single key type) something like this:</p>\n\n<pre><code>module M = Map.Make(String)\n\nlet find_with_default dflt map key =\n    try M.find map key with Not_found -&gt; dflt\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 3441514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXQwu.jpg?s=128&g=1", "display_name": "Massinissa", "link": "https://stackoverflow.com/users/3441514/massinissa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 42605675, "answer_count": 1, "score": 1, "last_activity_date": 1488700889, "creation_date": 1488697199, "question_id": 42605486, "link": "https://stackoverflow.com/questions/42605486/haskells-map-findwithdefault-ocaml-equivalent", "title": "Haskell&#39;s Map.findwithdefault ocaml equivalent", "body": "<p>Is there an equivalent of Haskell's <code>findWithDefault</code> function in OCaml?</p>\n\n<p>Recall that the type of findWithDefault is\n<code>findWithDefault :: Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a</code></p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 1, "creation_date": 1488698102, "post_id": 42602796, "comment_id": 72341017, "body": "This seems to be a case of <a href=\"https://ghc.haskell.org/trac/ghc/ticket/10833\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/10833</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1488700290, "post_id": 42602796, "comment_id": 72341523, "body": "At the moment injective type families are not very useful IMO. Injectivity only allows to express some types which would be ambiguous (see the GHC docs) but nothing more. One surely would expect the above to compile."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1488754189, "post_id": 42602796, "comment_id": 72358977, "body": "Thanks kosmikus. chi: I sure expected it to compile! That&#39;s a pretty worthless &quot;feature&quot;..."}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 260, "favorite_count": 2, "answer_count": 0, "score": 5, "last_activity_date": 1488671728, "creation_date": 1488671728, "question_id": 42602796, "link": "https://stackoverflow.com/questions/42602796/injective-type-families-with-gadts", "title": "Injective type families with GADTs", "body": "<p>I tried a very simple example involving injective type families, but I can't get it to work.</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeFamilyDependencies #-}\n\ntype family F c = result | result -&gt; c\n\ndata G b where\n  G :: G b -&gt; G (F b)\n\nfoo :: G (F a) -&gt; G a\nfoo (G a) = a\n</code></pre>\n\n<p>This results in a compile error</p>\n\n<pre><code>Inject.hs:10:13: error:\n    \u2022 Could not deduce: b ~ a\n      from the context: F a ~ F b\n        bound by a pattern with constructor: G :: forall b. G b -&gt; G (F b),\n                 in an equation for \u2018foo\u2019\n        at Inject.hs:10:6-8\n      \u2018b\u2019 is a rigid type variable bound by\n        a pattern with constructor: G :: forall b. G b -&gt; G (F b),\n        in an equation for \u2018foo\u2019\n        at Inject.hs:10:6\n      \u2018a\u2019 is a rigid type variable bound by\n        the type signature for:\n          foo :: forall a. G (F a) -&gt; G a\n        at Inject.hs:9:8\n      Expected type: G a\n        Actual type: G b\n    \u2022 In the expression: a\n      In an equation for \u2018foo\u2019: foo (G a) = a\n    \u2022 Relevant bindings include\n        a :: G b (bound at Inject.hs:10:8)\n        foo :: G (F a) -&gt; G a (bound at Inject.hs:10:1)\n</code></pre>\n\n<p>which is the same error I get if I use a non-injective/ordinary type family for <code>F</code>. What gives? </p>\n"}, {"tags": ["windows", "haskell", "dll", "icu", "haskell-stack"], "comments": [{"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1488698047, "post_id": 42602789, "comment_id": 72341004, "body": "I can&#39;t test with <code>text-icu</code> for a private reason, but I would try replacing stack&#39;s msys to 20161025 revision and <code>pacman -Sy icu-devel</code>. Of course build command should be done with msys shell."}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1488698972, "post_id": 42602789, "comment_id": 72341186, "body": "And above one is for static linking. I don&#39;t know your error message after dll copying, but if it was additional dependency problem then dependency walker would be help."}, {"owner": {"reputation": 7, "user_id": 2757973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae69f5dc98e5ccdd8693af905513fe9f?s=128&d=identicon&r=PG&f=1", "display_name": "shaegis", "link": "https://stackoverflow.com/users/2757973/shaegis"}, "reply_to_user": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1488853998, "post_id": 42602789, "comment_id": 72405772, "body": "I still try to resolve this... but don&#39;t work. I try to replace stack&#39;s msys, but fail. So I tyr to find another method. (\u3160_\u3160)"}], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 2757973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae69f5dc98e5ccdd8693af905513fe9f?s=128&d=identicon&r=PG&f=1", "display_name": "shaegis", "link": "https://stackoverflow.com/users/2757973/shaegis"}, "edited": false, "score": 0, "creation_date": 1488972931, "post_id": 42657658, "comment_id": 72465053, "body": "Thank you so much to your kind reply. Have a nice day~ =)"}], "tags": [], "owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "is_accepted": true, "score": 0, "last_activity_date": 1488918946, "last_edit_date": 1495535404, "creation_date": 1488918370, "answer_id": 42657658, "question_id": 42602789, "link": "https://stackoverflow.com/questions/42602789/execution-error-when-out-of-stack-enviroment-using-text-icu-on-windows/42657658#42657658", "title": "Execution error when out-of stack enviroment, using text-icu on windows", "body": "<p>I was able to test it recently, and share my solution.</p>\n\n<p>First of all, I assume environment of latest msys2 which is installed <code>mingw64/mingw-w64-x86_64-icu 57.1-2</code> package.</p>\n\n<h2>Dynamic linking</h2>\n\n<p>Executable which dynamically linked has dependencies to <code>libgcc_s_seh-1.dll libicudt57.dll libicuin57.dll libicuuc57.dll libstdc++-6.dll libwinpthread-1.dll</code> under stack's msys2 <code>mingw64/bin</code> path. If you have already built dynamic linked executable, copying all of them to same directory will solve the problem.</p>\n\n<p><a href=\"http://www.dependencywalker.com\" rel=\"nofollow noreferrer\">Dependency walker</a> in my comment can help to reveal all of these dependencies.</p>\n\n<h2>Static linking</h2>\n\n<p>Currently <code>text-icu</code> package doesn't seem to support static linking. So we should modify it ourselves. If you don't know how to make it into local package, note the third option of <a href=\"https://stackoverflow.com/a/42147218\">this</a>.</p>\n\n<p>Modify <code>text-icu-0.7.0.1</code>'s .cabal file <code>extra-libraries</code> section to the following.</p>\n\n<pre><code>  extra-libraries: sicuin sicuuc sicudt\n--  if os(mingw32)\n--    extra-libraries: icuin icudt\n--  else\n--    extra-libraries: icui18n icudata\n</code></pre>\n\n<p>Append <code>-pgmlC:\\Users\\[USERNAME]\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.0.2\\mingw\\bin\\g++.exe</code> to your executable's <code>ghc-options</code> cabal entry. This is required to link to ICU's C++ symbols.</p>\n\n<p>Then just do <code>stack build</code>.</p>\n"}], "owner": {"reputation": 7, "user_id": 2757973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae69f5dc98e5ccdd8693af905513fe9f?s=128&d=identicon&r=PG&f=1", "display_name": "shaegis", "link": "https://stackoverflow.com/users/2757973/shaegis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 42657658, "answer_count": 1, "score": 0, "last_activity_date": 1488931046, "creation_date": 1488671689, "last_edit_date": 1488931046, "question_id": 42602789, "link": "https://stackoverflow.com/questions/42602789/execution-error-when-out-of-stack-enviroment-using-text-icu-on-windows", "title": "Execution error when out-of stack enviroment, using text-icu on windows", "body": "<p>I wrote some code. and fixed some errors with the help of good persons.\nNow, this utility(samChecker-exe.exe) works properly in Stack environment.\nThis utility use text-icu and I coded this utility on windows. Of course, I want to work this utility on other windows OS.</p>\n\n<p>I copied %stackPath%.stack-work\\install\\~\\bin\\samCheceker-exe.exe to some other folder, and execution through CMD.\nBut I got error message that says \"libicuuc57.dll dose not exist. so program can't start. please re-install the program.\"\nI copied libicuuc57.dll, and so... as like programming newbies, but failed. \"stack install\" command was the same result.\n(I installed text-icu and installed ICU lib. on windows. The input file encoded in \"MS949\")</p>\n\n<p>With help of Francesco Ariis from (beginners@haskell.org), I stepped forward.\nBut still got error message.</p>\n\n<pre><code>C:\\Users\\shaeg\\Documents\\Haskell\\samChecker3&gt; stack build  --ghc-options=\"-static -optl-static\"\nWarning: File listed in samChecker3.cabal file does not exist: README.md\nsamChecker3-0.1.0.0: unregistering (local file changes: app\\Main.hs samChecker3.cabal src\\Lib.hs test\\Spec.hs)\nsamChecker3-0.1.0.0: configure (lib + exe)\nConfiguring samChecker3-0.1.0.0...\nsamChecker3-0.1.0.0: build (lib + exe)\nPreprocessing library samChecker3-0.1.0.0...\n[1 of 1] Compiling Lib              ( src\\Lib.hs, .stack-work\\dist\\ca59d0ab\\build\\Lib.o )\nPreprocessing executable 'samChecker3-exe' for samChecker3-0.1.0.0...\n[1 of 1] Compiling Main             ( app\\Main.hs, .stack-work\\dist\\ca59d0ab\\build\\samChecker3-exe\\samChecker3-exe-tmp\\Main.o )\nLinking .stack-work\\dist\\ca59d0ab\\build\\samChecker3-exe\\samChecker3-exe.exe ...\nC:/Users/shaeg/AppData/Local/Programs/stack/x86_64-windows/ghc-8.0.2/mingw/bin/ld.exe: cannot find -licuuc\nC:/Users/shaeg/AppData/Local/Programs/stack/x86_64-windows/ghc-8.0.2/mingw/bin/ld.exe: cannot find -licuin\nC:/Users/shaeg/AppData/Local/Programs/stack/x86_64-windows/ghc-8.0.2/mingw/bin/ld.exe: cannot find -licudt\ncollect2.exe: error: ld returned 1 exit status\n`gcc.exe' failed in phase `Linker'. (Exit code: 1)\nWarning: File listed in samChecker3.cabal file does not exist: README.md\n\n--  While building package samChecker3-0.1.0.0 using:\n      C:\\sr\\setup-exe-cache\\x86_64-windows\\Cabal-simple_Z6RU0evB_1.24.2.0_ghc-8.0.2.exe --builddir=.stack-work\\dist\\ca59d0ab build lib:samChecker3 exe:samChecker3-exe --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>[stack path] results</p>\n\n<pre><code>extra-include-dirs: C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\include\nextra-library-dirs: C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\lib\n</code></pre>\n\n<p>According to first error message(libicuuc57.dll dose not exist. so program can't start. please re-install the program.), I find the path for libicuuc57.dll, and re-set the extra-library-dirs.</p>\n\n<pre><code>C:\\Users\\shaeg\\Documents\\Haskell\\samChecker3&gt;stack build --extra-lib-dirs=C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\bin --ghc-options=\"-static -optl-static\"\n</code></pre>\n\n<p>But got the same result.</p>\n\n<p>libicuuc75.dll, libicuin57.dll etc files is located in C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\bin</p>\n\n<p>Someones says, this is Linker Acting.\nHow can I fix this error?\nThank you so much.</p>\n\n<p>Sincerely, S. Chang.</p>\n\n<hr>\n\n<p>Here is my stack path.</p>\n\n<pre><code>C:\\Users\\shaeg\\Documents\\Haskell\\samChecker3&gt;stack path\nstack-root: C:\\sr\nproject-root: C:\\Users\\shaeg\\Documents\\Haskell\\samChecker3\nconfig-location: C:\\Users\\shaeg\\Documents\\Haskell\\samChecker3\\stack.yaml\nbin-path: .;C:\\sr\\snapshots\\7dd4ddea\\bin;C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.0.2\\bin;C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.0.2\\mingw\\bin;C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\bin;C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\usr\\bin;C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\usr\\local\\bin;C:\\Program Files (x86)\\Intel\\iCLS Client\\;C:\\Program Files\\Intel\\iCLS Client\\;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\Program Files (x86)\\Intel\\Intel(R) Management Engine Components\\DAL;C:\\Program Files\\Intel\\Intel(R) Management Engine Components\\DAL;C:\\Program Files (x86)\\Intel\\Intel(R) Management Engine Components\\IPT;C:\\Program Files\\Intel\\Intel(R) Management Engine Components\\IPT;C:\\Program Files\\Intel\\IntelSGXPSW\\bin\\x64\\Release\\;C:\\Program Files\\Intel\\IntelSGXPSW\\bin\\win32\\Release\\;c:\\Program Files\\Intel\\WiFi\\bin\\;c:\\Program Files\\Common Files\\Intel\\WirelessCommon\\;C:\\Program Files\\Hewlett-Packard\\SimplePass\\;C:\\Users\\shaeg\\AppData\\Roaming\\local\\bin;C:\\Users\\shaeg\\AppData\\Local\\Microsoft\\WindowsApps\nprograms: C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\ncompiler-exe: C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.0.2\\bin\\ghc.EXE\ncompiler-bin: C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.0.2\\bin\nlocal-bin: C:\\Users\\shaeg\\AppData\\Roaming\\local\\bin\nextra-include-dirs: C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\include\nextra-library-dirs: C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\msys2-20150512\\mingw64\\lib\nsnapshot-pkg-db: C:\\sr\\snapshots\\7dd4ddea\\pkgdb\nlocal-pkg-db: C:\\Users\\shaeg\\Documents\\Haskell\\samChecker3\\.stack-work\\install\\02136e14\\pkgdb\nglobal-pkg-db: C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.0.2\\lib\\package.conf.d\nghc-package-path: C:\\Users\\shaeg\\Documents\\Haskell\\samChecker3\\.stack-work\\install\\02136e14\\pkgdb;C:\\sr\\snapshots\\7dd4ddea\\pkgdb;C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc-8.0.2\\lib\\package.conf.d\nsnapshot-install-root: C:\\sr\\snapshots\\7dd4ddea\nlocal-install-root: C:\\Users\\shaeg\\Documents\\Haskell\\samChecker3\\.stack-work\\install\\02136e14\nsnapshot-doc-root: C:\\sr\\snapshots\\7dd4ddea\\doc\nlocal-doc-root: C:\\Users\\shaeg\\Documents\\Haskell\\samChecker3\\.stack-work\\install\\02136e14\\doc\ndist-dir: .stack-work\\dist\\ca59d0ab\nlocal-hpc-root: C:\\Users\\shaeg\\Documents\\Haskell\\samChecker3\\.stack-work\\install\\02136e14\\hpc\nlocal-bin-path: C:\\Users\\shaeg\\AppData\\Roaming\\local\\bin\nghc-paths: C:\\Users\\shaeg\\AppData\\Local\\Programs\\stack\\x86_64-windows\n</code></pre>\n"}, {"tags": ["algorithm", "haskell", "permutation", "agda", "dependent-type"], "comments": [{"owner": {"reputation": 18942, "user_id": 894328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3db17c5296335f63e856be44aa821bf6?s=128&d=identicon&r=PG", "display_name": "Ahmed Masud", "link": "https://stackoverflow.com/users/894328/ahmed-masud"}, "edited": false, "score": 0, "creation_date": 1488670996, "post_id": 42602677, "comment_id": 72335868, "body": "you may be better off asking this at cs.stackexchange.com"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1488685235, "post_id": 42602677, "comment_id": 72338714, "body": "I don&#39;t work with lifted code like this very often so having trouble reasoning about above, but I wonder whether there are cases where GHC will be able to typecheck this but won&#39;t fully evaluate everything at compile time."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1488702734, "post_id": 42602677, "comment_id": 72342080, "body": "Maybe we need a O(1) dependent array <code>Array [k]</code> to achieve this. Anyway, in a fully dependent system, you would be able to keep around the permutation (as a position array) and a proof that it relates the two lists. To apply the permutation you can then use the simple O(n) algorithm you mention. Perhaps one can do the same with GADTs, type-level nats, and singletons."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1488718976, "post_id": 42602677, "comment_id": 72346795, "body": "@jberryman Maybe if the lists are small enough and the permutation is known at compile time, inlining might erase the whole computation. But, in this situations I&#39;m thinking of, we don&#39;t know the permutation until runtime, so all of the work is definitely going to be done then."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1488719278, "post_id": 42602677, "comment_id": 72346890, "body": "@chi I agree that some kind of dependent array would be needed to recover <code>O(n)</code> performance. It&#39;s actually a little more problematic. You need a mutable dependent array (for the list that&#39;s getting filled in) that somehow ends up with a proof that something was assigned to every index. However, dependent types and arrays just don&#39;t seem to go well together. The standard <code>Vec</code> type in every DT language is inductively defined and has <code>O(n)</code> lookups. The structure is needed for the type system to be able to do anything with it."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 5, "creation_date": 1488720762, "post_id": 42602677, "comment_id": 72347359, "body": "Your <code>Belongs x ys zs</code> datatype says &quot;<code>zs</code> is <code>ys</code> with <code>x</code> inserted somewhere&quot;, and its (<code>Nat</code>-like) representation gives you  <i><code>x</code>&#39;s position in <code>zs</code></i>. So <code>Permutation</code> is a list of indexes; applying a permutation amounts to <i>sorting that list of indexes</i>. IOW it&#39;s your choice of sorting algo that&#39;s to blame, not your data structures. You&#39;re using insertion sort; switching to (e.g.) merge sort would give you O(n log n). Of course the challenge now is to write a typed merge sort! See <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/Pivotal.pdf\" rel=\"nofollow noreferrer\"><i>How to Keep Your Neighbours in Order</i></a>"}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1488727855, "post_id": 42602677, "comment_id": 72349682, "body": "@BenjaminHodgson Thanks for the link to the McBride paper. I&#39;ll give that a read. It looks like it might help. I compeletely agree that the problem is insertion sort. However, I would be really impressed if I could somehow switch to merge sort without changing the <code>Permutation</code> data structure. Currently, <code>Permutation</code> is <code>n^2</code> is its size, so any algorithm that touches all of its contents must be at least <code>O(n^2)</code>."}, {"owner": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 5, "creation_date": 1488847127, "post_id": 42602677, "comment_id": 72403931, "body": "You are currently effectively &#39;counting&#39; up to the desired position in the original list in unary. If you switch to a way to encode the position in binary or skew binary then you can encode the same information in O(n log n) and your offsets will take log n space rather than n space to encode. Implementing this so that you can get an O(n log n) implementation will require some form of tree based encoding of the original input as well, lest you spend too long walking to the appropriate element to perform the permutation."}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1488853877, "post_id": 42602677, "comment_id": 72405736, "body": "I&#39;m not sure I&#39;m interpreting the problem correctly, but if your records are anything like lists, and if you don&#39;t need to know the details of the permutation, then you could O(n log n) sort both records, then O(n) compare them for equality, allowing an overall O(n log n) permutation check."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 0, "creation_date": 1488854166, "post_id": 42602677, "comment_id": 72405819, "body": "@EdwardKMETT Ah, changing the original list to a tree-like representation was the crucial insight that I had overlooked entirely. I think that I can start working toward a solution, although if anyone has any links to code where a similar data algorithm has been implemented in some dependently typed ML, that would be appreciated."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 28832, "user_id": 34707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c51a8b8afa2366a2ef4650c411f187a?s=128&d=identicon&r=PG", "display_name": "Edward KMETT", "link": "https://stackoverflow.com/users/34707/edward-kmett"}, "edited": false, "score": 1, "creation_date": 1488912233, "post_id": 42602677, "comment_id": 72437487, "body": "It might even be possible to use @EdwardKMETT&#39;s solution without losing the original record implementation. I suspect that <code>TypeInType</code> should allow you state useful claims about <code>toTree</code> and <code>fromTree</code>. None of this is going to be easy though."}, {"owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1488920678, "post_id": 42602677, "comment_id": 72442501, "body": "@dfeuer Yeah, I was hoping that would be possible since I do still need to ultimately end working with a record that&#39;s parameterized by the list. It seems like it should be possible to write some data type ListTreeRefl that let&#39;s me go back and forth between the two (in subquadratic time), but as you say, it&#39;s not going to be easy."}], "answers": [{"tags": [], "owner": {"reputation": 2357, "user_id": 1412279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ed063a064c32fc39ba05866f1edc9f3?s=128&d=identicon&r=PG", "display_name": "bebbo", "link": "https://stackoverflow.com/users/1412279/bebbo"}, "is_accepted": false, "score": 2, "last_activity_date": 1493644745, "last_edit_date": 1493644745, "creation_date": 1493635632, "answer_id": 43717879, "question_id": 42602677, "link": "https://stackoverflow.com/questions/42602677/provably-correct-permutation-in-less-than-on2/43717879#43717879", "title": "Provably correct permutation in less than O(n^2)", "body": "<p>A faster simple solution is to compare the sorted permutation of the permutations.</p>\n\n<ol>\n<li><p>Given permutation A and B.</p></li>\n<li><p>Then there exist the sorted permutations, </p>\n\n<p>As = sort(A)\n  Bs = sort(B)</p></li>\n<li><p>As is a permutation of A and Bs is a permutation of B.</p></li>\n<li><p>If As == Bs then A is a permutation of B.</p></li>\n</ol>\n\n<p>Thus the order of this algorithm is O(n log(n)) &lt; O(n\u00b2)</p>\n\n<p>And this is leading to the optimal solution.</p>\n\n<p><strong>Using a different storage of permutation yields O(n)</strong></p>\n\n<p>Using the statements from above, we are changing the storage format of each permutation into</p>\n\n<ul>\n<li>the sorted data</li>\n<li>the original unsorted data</li>\n</ul>\n\n<p>To determine if a list is a permutation of another one, simple a comparison of the sorted data is necessary -> O(n).</p>\n\n<p>This answers the question correctly, but the effort is hidden in creating the doubled data storage ^^ So it will depend on the use if this is a real advantage or not.</p>\n"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 961, "favorite_count": 3, "answer_count": 1, "score": 17, "last_activity_date": 1493644745, "creation_date": 1488670843, "last_edit_date": 1488856343, "question_id": 42602677, "link": "https://stackoverflow.com/questions/42602677/provably-correct-permutation-in-less-than-on2", "title": "Provably correct permutation in less than O(n^2)", "body": "<p>Written in Haskell, here is the data type that proves that one list is a permutation of another:</p>\n\n<pre><code>data Belongs (x :: k) (ys :: [k]) (zs :: [k]) where\n  BelongsHere :: Belongs x xs (x ': xs)\n  BelongsThere :: Belongs x xs xys -&gt; Belongs x (y ': xs) (y ': xys)\n\ndata Permutation (xs :: [k]) (ys :: [k]) where\n  PermutationEmpty :: Permutation '[] '[]\n  PermutationCons :: Belongs x ys xys -&gt; Permutation xs ys -&gt; Permutation (x ': xs) xys\n</code></pre>\n\n<p>With a <code>Permutation</code>, we can now permute a record:</p>\n\n<pre><code>data Rec :: (u -&gt; *) -&gt; [u] -&gt; * where\n  RNil :: Rec f '[]\n  (:&amp;) :: !(f r) -&gt; !(Rec f rs) -&gt; Rec f (r ': rs)\n\ninsertRecord :: Belongs x ys zs -&gt; f x -&gt; Rec f ys -&gt; Rec f zs\ninsertRecord BelongsHere v rs = v :&amp; rs\ninsertRecord (BelongsThere b) v (r :&amp; rs) = r :&amp; insertRecord b v rs\n\npermute :: Permutation xs ys -&gt; Rec f xs -&gt; Rec f ys\npermute PermutationEmpty RNil = RNil\npermute (PermutationCons b pnext) (r :&amp; rs) = insertRecord b r (permute pnext rs)\n</code></pre>\n\n<p>This works fine. However, permute is <code>O(n^2)</code> where <code>n</code> is the length of the record. I'm wondering if there is a way to get it to be any faster by using a different data type to represent a permutation.</p>\n\n<p>For comparison, in a mutable and untyped setting (which I know is a <strong>very</strong> different setting indeed), we could apply a permutation to a heterogeneous record like this in <code>O(n)</code> time. You represent the record as an array of values and the permutation as an array of new positions (no duplicates are allowed and all digits must be between 0 and n). Applying the permutation is just iterating that array and indexing into the record's array with those positions.</p>\n\n<p>I don't expect that an <code>O(n)</code> permutation is possible in a more rigorously typed settings. But it seems like <code>O(n*log(n))</code> might be possible. I appreciate any feedback, and let me know if I need to clarify anything. Also, answers to this can use Haskell, Agda, or Idris depending on what it feels easier to communicate with.</p>\n"}, {"tags": ["performance", "haskell", "inline", "ghc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1488703314, "post_id": 42602021, "comment_id": 72342238, "body": "What if in the instance you define <code>hash s n = myHash s n</code> (inlined) and then outside you declare a specialized <code>myHash</code> for your case? (Just a wild guess)"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1488733960, "post_id": 42602021, "comment_id": 72351831, "body": "@chi if I follow you, one issue there is I&#39;m not able to actually specialize manually on every combination of <code>H</code> and <code>S</code> since their defined by different users. But I played around with various things like what you suggested and got various combinations of no effect and ghc panics (which look to have probably been fixed in head). Thanks though, I&#39;ll definitely post if I find a good workaround"}], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1488689398, "creation_date": 1488665722, "last_edit_date": 1495542310, "question_id": 42602021, "link": "https://stackoverflow.com/questions/42602021/specializing-related-polymorphic-functions-without-inlining", "title": "Specializing related polymorphic functions without inlining", "body": "<p>Here's a minimal example reproducing a real problem I'm working on:</p>\n\n<p>One library module:</p>\n\n<pre><code>module Lib where\n\nclass H h where\n  hash :: (S s)=&gt; s -&gt; h -&gt; s\n\nclass S s where\n  mix :: s -&gt; Int -&gt; s\n\ninstance (H x, H y)=&gt; H (x,y) where\n  hash s = \\(x,y) -&gt;\n    s `hash` x `hash` y\n      -- make this look \"big\":\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n      `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y `hash` x `hash` y\n\ninstance H Int where\n  hash s = \\n -&gt; s `mix` n\n</code></pre>\n\n<p>Another, possibly defined by a user:</p>\n\n<pre><code>module S where\n\nimport Lib\n\nnewtype Foo = Foo Int\n    deriving Show\n\ninstance S Foo where\n  mix (Foo x) y = Foo (x+y)\n</code></pre>\n\n<p>And our <code>Main</code>:</p>\n\n<pre><code>module Main where\n\nimport Lib\nimport S\n\nimport Criterion.Main\n\nmain = defaultMain [\n    bench \"foo\" $ whnf (hash (Foo 1)) (2::Int,3::Int)\n  ]\n</code></pre>\n\n<p>Compiling with ghc 8.0.1 with <code>ghc --make -Wall -O2 -rtsopts -ddump-to-file -ddump-simpl -dsuppress-module-prefixes -dsuppress-uniques -ddump-core-stats -ddump-inlinings -fforce-recomp Main.hs</code>.</p>\n\n<p>The benchmark above runs in <strong>4 \u03bcs</strong>. If however we put <code>INLINE</code> pragmas on the two <code>hash</code> declarations in <code>Lib</code> we see the expected specializations we want and get a runtime of <strong>66 ns</strong>.</p>\n\n<p>But I don't really want to inline everything (in the user's real <code>Main</code> she might be calling <code>hash</code> many many times on the same type), I just want the function specialized for every combination of <code>H</code> and <code>S</code> instance in the user's code. </p>\n\n<p>Changing <code>INLINE</code> pragmas to <code>INLINABLE</code> caused a regression to the old behavior (expected I think, since GHC's inlining heuristics are still at play). I then tried adding</p>\n\n<pre><code>{-# SPECIALIZE hash :: H a=&gt; Foo -&gt; a -&gt; Foo #-}\n</code></pre>\n\n<p>to both <code>Main</code> and <code>S</code> modules but this generates</p>\n\n<pre><code>Ignoring useless SPECIALISE pragma for class method selector \u2018hash\u2019\n</code></pre>\n\n<p>...warnings and the same bad code.</p>\n\n<p>Some constraints:</p>\n\n<ul>\n<li>It would be acceptable though not ideal to require every <code>S</code> instance declaration to include a finite number of pragmas (possibly related to <code>H</code>)</li>\n<li>likewise for <code>H</code></li>\n<li>it's not acceptable to require users to do a <code>SPECIALIZE</code> for every combination of <code>S</code> and <code>H</code>.</li>\n</ul>\n\n<p>Is it possible to do this without INLINE?</p>\n\n<p>This is probably the same as <a href=\"https://stackoverflow.com/questions/21071706/specialization-with-constraints\">Specialization with Constraints</a> and related trac ticket <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8668\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/8668</a>, but I thought I would ask again and possibly post this as a simpler example to the GHC Trac.</p>\n\n<hr>\n\n<p><strong>EDIT</strong>: went ahead and opened a ghc ticket: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/13376\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/13376</a></p>\n"}, {"tags": ["loops", "haskell", "dictionary"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1488666848, "post_id": 42601831, "comment_id": 72334780, "body": "To those who voted to close: Take note I suggested the asker make a separate question based on the fact that the first one was really an almost off-topic &quot;I&#39;ve no idea where to start&quot; where as this is a &quot;I&#39;ve a syntax or type error and can not understand it&quot; style issue.  In my eyes they are sufficiently different."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1488674675, "post_id": 42601831, "comment_id": 72336630, "body": "Also, to load <code>Control.Lens</code> you&#39;ll first need to install the <code>lens</code> package likely by <code>cabal install lens</code> or perhaps <code>stack install lens</code>.  After that you should be able to write <code>import Control.Lens</code> at the top of the file to get access to the mentioned <code>ifor_</code> function.  Notice we can decompose <code>ifor_</code> into  &quot;indexed (the &#39;i&#39;) for loop (the &#39;for&#39;) that ignores the result of each iteration (the &#39;_&#39;)&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1488667413, "post_id": 42601871, "comment_id": 72334939, "body": "Unifying this answer with Daniel&#39;s.  A <code>Map</code> is a distinct type from a <code>List</code>.  The syntax <code>[val1, val2]</code> is traditionally a list but the language extension <code>OverloadedLists</code> makes the syntax include an implicit <code>fromList</code> call, making the fully de-sugared translation <code>[val1,val2] ~&gt; fromList (val1 : val2 : [])</code>."}, {"owner": {"reputation": 53, "user_id": 3480820, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a5f1a937d12dbfcd7683f2e7a0efb7d8?s=128&d=identicon&r=PG&f=1", "display_name": "user3480820", "link": "https://stackoverflow.com/users/3480820/user3480820"}, "edited": false, "score": 0, "creation_date": 1488745926, "post_id": 42601871, "comment_id": 72356197, "body": "This now works. I can&#39;t get the for_i to work, after downloading lens, but I&#39;m not too worried about this. Thank you again."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1488664538, "creation_date": 1488664538, "answer_id": 42601871, "question_id": 42601831, "link": "https://stackoverflow.com/questions/42601831/looping-over-a-map-in-haskell/42601871#42601871", "title": "Looping over a map in haskell", "body": "<p><code>Map String String</code> is not just an alias for lists of tuples; it is a distinct data type, and so your assignment does not type-check. You need to use the function <code>Data.Map.fromList</code> to convert your list to a proper <code>Map k v</code> value.</p>\n\n<pre><code>m = Data.Map.fromList [(\"a\",\"1\"),(\"b\",\"2\")]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1488664678, "last_edit_date": 1495540813, "creation_date": 1488664678, "answer_id": 42601889, "question_id": 42601831, "link": "https://stackoverflow.com/questions/42601831/looping-over-a-map-in-haskell/42601889#42601889", "title": "Looping over a map in haskell", "body": "<p>You have taken the code from <a href=\"https://stackoverflow.com/a/42566616/791604\">this answer to a previous question</a>, but omitted the first line:</p>\n\n<pre><code>{-# LANGUAGE OverloadedLists #-}\n</code></pre>\n\n<p>Don't omit the first line.</p>\n"}], "owner": {"reputation": 53, "user_id": 3480820, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a5f1a937d12dbfcd7683f2e7a0efb7d8?s=128&d=identicon&r=PG&f=1", "display_name": "user3480820", "link": "https://stackoverflow.com/users/3480820/user3480820"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 746, "favorite_count": 0, "accepted_answer_id": 42601889, "answer_count": 2, "score": 0, "last_activity_date": 1488664678, "creation_date": 1488664295, "last_edit_date": 1488664387, "question_id": 42601831, "link": "https://stackoverflow.com/questions/42601831/looping-over-a-map-in-haskell", "title": "Looping over a map in haskell", "body": "<pre><code>import Data.Foldable (for_)\nimport Data.Map (Map,toList)\n\nm :: Map String String\nm = [(\"a\",\"1\"),(\"b\",\"2\")]\n\nmain =\n  for_ (toList m) $ \\(q,a) -&gt;\n    do putStrLn q\n       x &lt;- getLine\n       putStrLn (if x == a\n                    then \"Yes\"\n                    else \"No: \" ++ a)\n</code></pre>\n\n<p>I get the error:-</p>\n\n<pre><code>foo.hs:5:5: error:\n    * Couldn't match expected type `Map String String'\n                  with actual type `[([Char], [Char])]'\n    * In the expression: [(\"a\", \"1\"), (\"b\", \"2\")]\n      In an equation for `m': m = [(\"a\", \"1\"), (\"b\", \"2\")]\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Thanks for your help. I was interested in the for_i solution , but I cannot load Control.Lens</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 9, "last_activity_date": 1488654675, "last_edit_date": 1488654675, "creation_date": 1488654207, "answer_id": 42600084, "question_id": 42599845, "link": "https://stackoverflow.com/questions/42599845/can-i-do-branch-control-with-promoted-type/42600084#42600084", "title": "Can I do branch control with promoted type?", "body": "<p>This is impossible. Types are erased, so you can't use them directly to make decisions at run time. The usual approach is to replace the proxy with a singleton. In this case, I think the type family is overkill, so I've dropped it.</p>\n\n<pre><code>data Out a where\n  ToInt :: Out Int\n  ToBool :: Out Bool\n\nfoo :: forall k. Out k -&gt; Int -&gt; k\nfoo p = case p of\n    ToInt -&gt; id\n    ToBool -&gt; (== 0)\n</code></pre>\n\n<p>If you wanted, you could instead use <code>DataKinds</code> to promote your <code>Out</code> constructors and index a singleton type by those:</p>\n\n<pre><code>data OutS a where\n  ToIntS :: OutS 'ToInt\n  ToBoolS :: OutS 'ToBool\n\nfoo :: forall k. OutS k -&gt; Int -&gt; F k\nfoo p = case p of\n   ToIntS -&gt; id\n   ToBoolS -&gt; (== 0)\n</code></pre>\n\n<p>But in this case I'm not sure there's much of a point.</p>\n\n<p>Another design option (which you can use with either of the above) is to tie a type to its singleton using a class:</p>\n\n<pre><code>class SConv t where\n  sConv :: proxy t -&gt; OutS t\ninstance SConv 'ToInt where\n  sConv _ = ToIntS\ninstance SConv 'ToBool where\n  sConv _ = ToBoolS\n</code></pre>\n\n<p>This makes the singleton passing a bit more implicit in some cases.</p>\n\n<p>Hopefully, Richard Eisenberg will finish his <code>DependentHaskell</code> work within the next couple years, at which point all this will become much less painful.</p>\n"}], "owner": {"reputation": 2966, "user_id": 315302, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1d57a52c98eee46fb4bc92e0b4ffe163?s=128&d=identicon&r=PG", "display_name": "Javran", "link": "https://stackoverflow.com/users/315302/javran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 42600084, "answer_count": 1, "score": 3, "last_activity_date": 1488654675, "creation_date": 1488652706, "question_id": 42599845, "link": "https://stackoverflow.com/questions/42599845/can-i-do-branch-control-with-promoted-type", "title": "Can I do branch control with promoted type?", "body": "<p>I create a toy program for trying to do branch on a promoted type:</p>\n\n<pre><code>{-# LANGUAGE KindSignatures, DataKinds, TypeFamilies, ScopedTypeVariables, GADTs #-}\nmodule Foo where\n\nimport Data.Proxy\n\ndata Out = ToInt | ToBool\n\ntype family F (a :: Out) where\n    F ToInt = Int\n    F ToBool = Bool\n\nfoo :: forall k. Proxy (k :: Out) -&gt; Int -&gt; F k\nfoo p = case p of\n    (Proxy :: Proxy 'ToInt) -&gt; id\n    (Proxy :: Proxy 'ToBool) -&gt; (== 0)\n</code></pre>\n\n<p>Here I tried to branch on <code>Proxy</code> and use explicit type signature on them, but this doesn't work, GHC complains:</p>\n\n<pre><code>[1 of 1] Compiling Foo              ( Foo.hs, Foo.o )\n\nFoo.hs:15:6: error:\n    \u2022 Couldn't match type \u2018k\u2019 with \u2018'ToBool\u2019\n      \u2018k\u2019 is a rigid type variable bound by\n        the type signature for:\n          foo :: forall (k :: Out). Proxy k -&gt; Int -&gt; F k\n        at Foo.hs:12:15\n      Expected type: Proxy 'ToBool\n        Actual type: Proxy k\n    \u2022 When checking that the pattern signature: Proxy 'ToBool\n        fits the type of its context: Proxy k\n      In the pattern: Proxy :: Proxy ToBool\n      In a case alternative: (Proxy :: Proxy ToBool) -&gt; (== 0)\n    \u2022 Relevant bindings include\n        p :: Proxy k (bound at Foo.hs:13:5)\n        foo :: Proxy k -&gt; Int -&gt; F k (bound at Foo.hs:13:1)\n</code></pre>\n\n<p>I think this basically says GHC have trouble figuring out <code>k ~ 'ToBool</code> on the second branch. (actually first branch doesn't work either for a very similar error message)</p>\n\n<p>is this actually possible or am I doing something wrong?</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1488648208, "post_id": 42598845, "comment_id": 72328833, "body": "You can just pass in empty strings and lists and always-failing parsers for the options that do not apply to you (which I guess is all of them)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1488648359, "post_id": 42598845, "comment_id": 72328887, "body": "If you can, please use <code>megaparsec</code>. It is a better modern rewrite of <code>parsec</code> (and is actually b king maintained)."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 6, "last_activity_date": 1488654372, "last_edit_date": 1495540433, "creation_date": 1488652390, "answer_id": 42599781, "question_id": 42598845, "link": "https://stackoverflow.com/questions/42598845/batteries-for-parsec-in-haskell/42599781#42599781", "title": "&quot;Batteries&quot; for Parsec in Haskell", "body": "<blockquote>\n  <p>Are the functions in Parsec.Token the right way to go here?</p>\n</blockquote>\n\n<p>Yes, they are. If you don't care about the <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec-Token.html#t:GenLanguageDef\" rel=\"nofollow noreferrer\">minutiae specified by a language definition</a> (i.e. you don't plan to use the parsers which depend on them, such as <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec-Token.html#t:GenTokenParser\" rel=\"nofollow noreferrer\"><code>identifier</code> or <code>reserved</code></a>), just use <a href=\"https://hackage.haskell.org/package/parsec-3.1.11/docs/Text-Parsec-Language.html#v:emptyDef\" rel=\"nofollow noreferrer\"><code>emptyDef</code></a> as a default:</p>\n\n<pre><code>import Text.Parsec\nimport qualified Text.Parsec.Token as P\nimport Text.Parsec.Language (emptyDef)\n\nlexer = P.makeTokenParser emptyDef\n\ninteger = P.integer lexer\n</code></pre>\n\n<p>As you noted, this feels unnecesarily clunky for your use case. It is worth mentioning that <em>megaparsec</em> (cf. <a href=\"https://stackoverflow.com/questions/42598845/batteries-for-parsec-in-haskell#comment72328887_42598845\">Alec's suggestion</a>) provides a corresponding <a href=\"https://hackage.haskell.org/package/megaparsec-5.2.0/docs/Text-Megaparsec-Lexer.html#v:integer\" rel=\"nofollow noreferrer\"><code>integer</code></a> parser without the ceremony. (The flip side is that <em>megaparsec</em> doesn't try to bake in support for e.g. reserved words, but that <a href=\"https://mrkkrp.github.io/megaparsec/tutorials/parsing-simple-imperative-language.html#lexer\" rel=\"nofollow noreferrer\">isn't difficult to implement</a> in the cases you actually need it.)</p>\n"}], "owner": {"reputation": 1422, "user_id": 2061651, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/8b10b1584758207cd9ec3e2a15d95e63?s=128&d=identicon&r=PG", "display_name": "josteinb", "link": "https://stackoverflow.com/users/2061651/josteinb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 42599781, "answer_count": 1, "score": 4, "last_activity_date": 1488654372, "creation_date": 1488647569, "last_edit_date": 1495540433, "question_id": 42598845, "link": "https://stackoverflow.com/questions/42598845/batteries-for-parsec-in-haskell", "title": "&quot;Batteries&quot; for Parsec in Haskell", "body": "<p>I am new to Haskell, and I have been trying to write a JSON parser using Parsec as an exercise. This has mostly been going well, I am able to parse lists and objects with relatively little code which is also readable (great!). However, for JSON I also need to parse primitives like</p>\n\n<ul>\n<li>Integers (possibly signed)</li>\n<li>Floats (possibly using scientific notation such as \"3.4e-8\")</li>\n<li>Strings with e.g. escaped quotes</li>\n</ul>\n\n<p>I was hoping to find ready to use parsers for things like these as part of Parsec. The closest I get is the Parsec.Tokens module (defines <code>integer</code> and friends), but those parsers require a \"language definition\" that seems way beyond what I should have to make to parse something as simple as JSON -- it appears to be designed for programming languages.</p>\n\n<p>So my questions are:</p>\n\n<ol>\n<li><p>Are the functions in Parsec.Token the right way to go here? If so, how to make a suitable language definition?</p></li>\n<li><p>Are \"primitive\" parsers for integers etc defined somewhere else? Maybe in another package?</p></li>\n<li><p>Am I supposed to write these kinds of low-level parsers myself? I can see myself reusing them frequently... (obscure scientific data formats etc.)</p></li>\n</ol>\n\n<p>I have noticed that a question on this site says Megaparsec has these primitives included [1], but I suppose these cannot be used with parsec.</p>\n\n<p>Related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/10726085/how-do-i-get-parsec-to-let-me-call-read-int/10726784#10726784\">How do I get Parsec to let me call `read` :: Int?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/24171005/how-to-parse-an-integer-with-parsec\">How to parse an Integer with parsec</a></p>\n"}, {"tags": ["list", "haskell", "swap"], "answers": [{"comments": [{"owner": {"reputation": 962, "user_id": 4921099, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/aqAiW.png?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/4921099/martin"}, "edited": false, "score": 0, "creation_date": 1496301068, "post_id": 44300702, "comment_id": 75606809, "body": "nice\u200c\u200b\u200d\u200b\u200d\u200b\u200d\u200b\u200d\u200b\u200d\u200b\u200d"}, {"owner": {"reputation": 431, "user_id": 2423002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/857ed0fe0d30694c2c87e42a917e90bb?s=128&d=identicon&r=PG", "display_name": "John Stef", "link": "https://stackoverflow.com/users/2423002/john-stef"}, "edited": false, "score": 0, "creation_date": 1496317783, "post_id": 44300702, "comment_id": 75618483, "body": "Your implementation help me a lot to understand how this function works. I&#39;m new to Haskell and many times I&#39;m thinking more complicated than I should be."}], "tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 3, "last_activity_date": 1496300688, "creation_date": 1496300688, "answer_id": 44300702, "question_id": 42598584, "link": "https://stackoverflow.com/questions/42598584/swap-adjacent-input-characters-in-a-given-list-in-haskell/44300702#44300702", "title": "swap adjacent input characters in a given list, in Haskell", "body": "<p>You are doing a lot of unnecessary work here. Here's an implementation to consider.</p>\n\n<pre><code>swapIfAdjacent a b (x:y:xys) | (a, b) == (x, y) || (b, a) == (x, y) = y:x:xys\n                             | otherwise = x : swapIfAdjacent a b (y:xys)\nswapIfAdjacent _ _ xys = xys\n</code></pre>\n\n<p>You don't need any of <code>elem</code>, <code>adjacent</code> or <code>swap</code>.</p>\n"}], "owner": {"reputation": 431, "user_id": 2423002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/857ed0fe0d30694c2c87e42a917e90bb?s=128&d=identicon&r=PG", "display_name": "John Stef", "link": "https://stackoverflow.com/users/2423002/john-stef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 44300702, "answer_count": 1, "score": 0, "last_activity_date": 1496300688, "creation_date": 1488646169, "last_edit_date": 1496263809, "question_id": 42598584, "link": "https://stackoverflow.com/questions/42598584/swap-adjacent-input-characters-in-a-given-list-in-haskell", "title": "swap adjacent input characters in a given list, in Haskell", "body": "<p>Given the declaration of the swapIfAdjacent function I need to do the following:</p>\n\n<pre><code>swapIfAdjacent :: Eq a =&gt; a -&gt; a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>If either a,b or b,a are consecutive items, then for the first and only occurrence the order of these two items should be swapped. </p>\n\n<p>My code so far:</p>\n\n<pre><code>swapIfAdjacent _ _ [] = []\nswapIfAdjacent a b (x:xs) | a `elem` xs &amp;&amp; b `elem` xs\n                          = if adjacent a b xs then swap a b (x:xs) else (x:xs) \n                          | otherwise = error \"not adjacent\"   \n                             where\n                             swap _ _ [] = []\n                             swap a b (x:xs) \n                                 |    a == x = b : swap a b xs\n                                 |    b == x = a : swap a b xs\n                                 | otherwise = x : swap a b xs    \n</code></pre>\n\n<p>The adjacent function that I'm using is already defined as follows:</p>\n\n<pre><code>adjacent :: Eq a =&gt; a -&gt; a -&gt; [a] -&gt; Bool\nadjacent a b (x:y:etc)  |  x == a\n                        =  y == b\n                        |  x == b\n                        =  y == a\n                        |  otherwise\n                        =  adjacent a b (y:etc)\nadjacent _ _ _          =  False   \n</code></pre>\n\n<p>I have observed that according to my implementation the swapping procedure occurs for every element and not only for the first ones and also the following error:</p>\n\n<pre><code>swapIfAdjacent 'a' 'a' \"banana\" --&gt; banana\n</code></pre>\n\n<p>while </p>\n\n<pre><code>swapIfAdjacent 'b' 'b' \"banana\" --&gt; error \"not adjacent\"\n</code></pre>\n\n<p>Both of the above examples should produce as output the whole list and not errors. I assume the error has to do with the fact that 'b' is appearing in the list only once \"banana\" while 'a' multiple times.</p>\n"}, {"tags": ["multithreading", "haskell", "jobs"], "answers": [{"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1488649322, "post_id": 42598458, "comment_id": 72329179, "body": "<code>forkOS</code> doesn&#39;t give new OS threads.  It&#39;s rather poorly named in that sense.  The only difference <code>forkOS</code> has from <code>forkIO</code> is that it guarantees all FFI calls from the new thread will happen from the same native thread. It says nothing about no other haskell code running on that native thread."}, {"owner": {"reputation": 578, "user_id": 3967758, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/18386db8285f48189eb7b61d2433aaa4?s=128&d=identicon&r=PG&f=1", "display_name": "Vorpulus Lyphane", "link": "https://stackoverflow.com/users/3967758/vorpulus-lyphane"}, "edited": false, "score": 0, "creation_date": 1488649660, "post_id": 42598458, "comment_id": 72329283, "body": "@chi Thank you. Would it be a straightforward task to instead add the &#39;spooler&#39; function to the channel together with the word, and then, in the new thread, have a higher-level function that applies the lower-level function (&#39;spooler&#39;) to the word?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 578, "user_id": 3967758, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/18386db8285f48189eb7b61d2433aaa4?s=128&d=identicon&r=PG&f=1", "display_name": "Vorpulus Lyphane", "link": "https://stackoverflow.com/users/3967758/vorpulus-lyphane"}, "edited": false, "score": 1, "creation_date": 1488654672, "post_id": 42598458, "comment_id": 72331163, "body": "@VorpulusLyphane I&#39;m not sure I completely understand, but you can pass IO actions if you make e.g. <code>Chan (IO ())</code>. In such way the spooler thread can fetch the action and run it. You can <code>writeChan ch (do print 1; print 2)</code> and the numbers will be printed by the spooler thread using something like <code>do act &lt;- readChan ch ; act</code>"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1488655515, "last_edit_date": 1488655515, "creation_date": 1488645470, "answer_id": 42598458, "question_id": 42598146, "link": "https://stackoverflow.com/questions/42598146/haskell-job-pool/42598458#42598458", "title": "Haskell Job Pool", "body": "<p>Here's a pretty close translation.</p>\n\n<p><code>Chan</code> is a FIFO queue for message passing between Haskell threads.</p>\n\n<p>Below I use a <code>MVar</code> for waiting that the spooler has exited. This is like a regular mutable variable, but it is protected with a mutex. It can either be empty (only a <code>put</code> is allowed, <code>take</code>s wait) or full (only a <code>take</code> is allowed, <code>put</code>s wait).</p>\n\n<p>I also use Haskell threads below, which might be run on separate OS-level threads or not -- the Haskell runtime chooses that. Haskell threads are very cheap, compared with OS threads.</p>\n\n<p>See e.g. <a href=\"http://book.realworldhaskell.org/read/concurrent-and-multicore-programming.html\" rel=\"nofollow noreferrer\">Real World Haskell</a> for more discussion.</p>\n\n<pre><code>{-# OPTIONS -Wall #-}\nmodule JobPool where\n\nimport Control.Monad (when)\nimport Control.Concurrent\n\nspooler :: Chan String -&gt; MVar () -&gt; IO ()\nspooler ch stop = do\n   word &lt;- readChan ch\n   if word == \"quit\"\n   then putMVar stop ()\n   else do\n      threadDelay 1000000 -- us\n      putStrLn (reverse word)\n      spooler ch stop\n\nmain :: IO ()\nmain = do\n   stop &lt;- newEmptyMVar\n   ch &lt;- newChan\n   _ &lt;- forkIO $ spooler ch stop\n   let loop = do\n          word &lt;- getLine\n          writeChan ch word\n          when (word /= \"quit\") loop\n   loop\n   takeMVar stop\n</code></pre>\n"}], "owner": {"reputation": 578, "user_id": 3967758, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/18386db8285f48189eb7b61d2433aaa4?s=128&d=identicon&r=PG&f=1", "display_name": "Vorpulus Lyphane", "link": "https://stackoverflow.com/users/3967758/vorpulus-lyphane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 42598458, "answer_count": 1, "score": 0, "last_activity_date": 1488655515, "creation_date": 1488643802, "last_edit_date": 1488645501, "question_id": 42598146, "link": "https://stackoverflow.com/questions/42598146/haskell-job-pool", "title": "Haskell Job Pool", "body": "<p>I'm interested in Haskell programming, but I'd want to create a job pool system, and I wonder if that will be a problem in Haskell.</p>\n\n<p>Below is a simple program in Ruby.  On one thread of execution, words are taken from a user and added to a list.  On another thread, words are taken from the list and processed in some way (in this case, reversed and printed back to the user).</p>\n\n<pre><code>words = []\n\n# Create new thread to take words from array, one at a time, and process them\nt = Thread.new {\n  loop do\n    unless words.empty?\n      word = words.pop\n      break if word == 'quit'\n      sleep 1\n      puts word.reverse\n    end\n  end\n}\n\n# Take words from user and add to array\nloop do\n  puts \"Enter word:\"\n  word = gets.chomp\n  words &lt;&lt; word\n  break if word == 'quit'\nend\n\nt.join\n</code></pre>\n\n<p>What is the equivalent Haskell code?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1488641981, "post_id": 42597791, "comment_id": 72326704, "body": "There&#39;s no mistake - this principle only applies to pure functions. (Note even that isn&#39;t true, due to <code>seq</code> and friends). You only see the difference because you are executing the <code>IO</code> action, which is &#39;technically&#39; only possible in <code>main</code> - all other manipulation with <code>IO</code> just builds new terms, or, you cannot observe the value of a term of type <code>IO x</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1488644362, "post_id": 42597791, "comment_id": 72327502, "body": "<code>seq</code> does not violate the principle being discussed here."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1488655397, "post_id": 42597791, "comment_id": 72331366, "body": "<code>catch</code> turns out to be really hard to get right. I&#39;ve actually been working on fixing relevant GHC bugs over the past week or two."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1488657414, "post_id": 42597791, "comment_id": 72332038, "body": "@dfeuer I reckon there is a theoretical problem with <code>catch</code>. By Curry-Howard, bottom is associated to mathematical falsity. And False is a logical black hole : for any proposition <code>P</code>, False implies <code>P</code>. Once you&#39;ve entered bottom you cannot get out, you&#39;re doomed to speaking nonsense, as happens in infinite loops. <code>catch</code> intends to convert a bottom back to a defined value, I cannot see how it can do it right."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1488767924, "post_id": 42597791, "comment_id": 72362294, "body": "By that reasoning does <code>f x = \\y -&gt; print (x, y)</code> not use x?"}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1488801482, "post_id": 42597791, "comment_id": 72377892, "body": "@immibis Indeed, <code>\\_ -&gt; undefined</code> is different from <code>undefined</code>. Still, what <code>catch</code> does above seems a lot more defined than <code>\\_ -&gt; undefined</code>, as it has no latent bottoms."}], "answers": [{"comments": [{"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1488652283, "post_id": 42598320, "comment_id": 72330284, "body": "If there was provably only one <code>IO a</code> as you wrote (only one constructor <code>MkIO</code> without parameters), the compiler would optimize <code>f</code>, forcing it to be constant, equal to this unique <code>IO a</code>. This is not what happens, as the execution in GHCi shows. I understand from the paper about imprecise exceptions that GHC distinguishes several kinds of bottoms : ones that can be caught, others, such as infinite loops, that can&#39;t. I wonder how that translates via Curry-Howard, bottom is associated to mathematical falsity and there&#39;s only one of it."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 1, "creation_date": 1488658076, "post_id": 42598320, "comment_id": 72332257, "body": "Sure, I explicitly said that this denotational semantics (with exceptions identified with nontermination, and IO treated as a singleton) does not help you predict what will happen when you execute an IO action."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 8, "last_activity_date": 1488648999, "last_edit_date": 1488648999, "creation_date": 1488644751, "answer_id": 42598320, "question_id": 42597791, "link": "https://stackoverflow.com/questions/42597791/catch-violates-the-semantic-approximation-order/42598320#42598320", "title": "catch violates the semantic approximation order?", "body": "<p>To model exceptions and <code>catch</code> properly you need a richer denotational semantics for terms, that distinguishes exceptions from nontermination (and that distinguishes different exceptions from each other). See <a href=\"https://www.microsoft.com/en-us/research/wp-content/uploads/1999/05/except.pdf\" rel=\"nofollow noreferrer\">A semantics for imprecise exceptions (pdf)</a> for the semantics that GHC implements.</p>\n\n<p>Note that this has no effect on the denotational semantics of the \"pure fragment\" of Haskell, since you have no way to observe distinctions between <code>IO a</code> values in pure code (aside from bottom vs. not-bottom).</p>\n\n<p>To clarify what I mean by the \"pure fragment\" of Haskell, imagine defining the <code>IO</code> type as</p>\n\n<pre><code>data IO a = MkIO\n</code></pre>\n\n<p>and <code>catch</code> as</p>\n\n<pre><code>catch a h = MkIO\n</code></pre>\n\n<p>Now there's no problem with your <code>f</code>, since both <code>f undefined</code> and <code>f \"test\"</code> are equal to <code>MkIO</code>. From the viewpoint of denotational semantics this corresponds to the interpretation</p>\n\n<blockquote>\n  <p>[[<code>IO t</code>]] = {\u22a5 &lt; \u22a4}</p>\n</blockquote>\n\n<p>Since the only operations we can do with IO actions are <code>seq</code>ing them and combining them into other IO actions, it's a perfectly consistent denotational semantics which does not compromise your ability to talk about the semantics of things like <code>length :: [Bool] -&gt; Integer</code>. It just happens to be useless for understanding what happens when you execute an IO action. But if you wanted to treat that in a denotational semantics, you'd encounter many difficulties besides exceptions.</p>\n"}], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 42598320, "answer_count": 1, "score": 4, "last_activity_date": 1488648999, "creation_date": 1488641639, "question_id": 42597791, "link": "https://stackoverflow.com/questions/42597791/catch-violates-the-semantic-approximation-order", "title": "catch violates the semantic approximation order?", "body": "<p>The semantic approximation order states that if a function <code>f</code> is defined when one its arguments is not, then <code>f</code> is constant in that argument (it doesn't use it). But consider this function,</p>\n\n<pre><code>import Control.Exception\n\nhandleAll :: SomeException -&gt; IO ()\nhandleAll e = putStrLn \"caught\"\n\nf :: String -&gt; IO ()\nf x = catch (putStrLn x) handleAll\n</code></pre>\n\n<p><code>f undefined</code> displays <code>caught</code> in GHCi, so it looks defined. However <code>f</code> is not constant in its argument, because <code>f \"test\"</code> displays <code>test</code>. </p>\n\n<p>Is there a mistake somewhere ?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1488641673, "post_id": 42596742, "comment_id": 72326602, "body": "<code>Value</code> used to be a type which was only defined for a single type constructor <code>M</code> with kind <code>* -&gt; *</code>. You are generalizing <code>Value</code> to be a type constructor itself, but one that takes a value of kind <code>* -&gt; *</code> instead of a concrete type. This means you need to apply <code>Value</code> to <code>m</code> <i>everywhere</i> in the definition so that your definition kind-checks."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 4, "last_activity_date": 1488635166, "creation_date": 1488635166, "answer_id": 42596742, "question_id": 42596675, "link": "https://stackoverflow.com/questions/42596675/how-do-i-declare-new-type-with-type-constraints-in-haskell/42596742#42596742", "title": "How do I declare new type with type constraints in Haskell?", "body": "<p>Since <code>Value</code> takes a type parameter, you need to supply that parameter any time you use <code>Value</code>. That is, you should refer to it as <code>Value m</code>, not just <code>Value</code>. So your type definition should be:</p>\n\n<pre><code>data Value m = Wrong | Num Int | Fun ((Value m) -&gt; m (Value m))\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 7658110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa8fbb93db8838e2005a78c9e70cb752?s=128&d=identicon&r=PG&f=1", "display_name": "wtl", "link": "https://stackoverflow.com/users/7658110/wtl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 42596742, "answer_count": 1, "score": 0, "last_activity_date": 1488636682, "creation_date": 1488634690, "last_edit_date": 1488636682, "question_id": 42596675, "link": "https://stackoverflow.com/questions/42596675/how-do-i-declare-new-type-with-type-constraints-in-haskell", "title": "How do I declare new type with type constraints in Haskell?", "body": "<p>I\u2019m tring to declare a new type Value as below:</p>\n\n<pre><code>data Value m = Wrong | Num Int | Fun (Value -&gt; m Value)\n</code></pre>\n\n<p>And GHCI complains:</p>\n\n<pre><code>&lt;interactive&gt;:160:39:\n    Expecting one more argument to \u2018Value\u2019\n    Expected a type, but \u2018Value\u2019 has kind \u2018k0 -&gt; *\u2019\n    In the type \u2018Value -&gt; m Value\u2019\n    In the definition of data constructor \u2018Fun\u2019\n    In the data declaration for \u2018Value\u2019\n</code></pre>\n\n<p>PS: I'm trying to implement code of <a href=\"https://i.stack.imgur.com/FuJGO.png\" rel=\"nofollow noreferrer\"><code>The essence of functional programming</code></a></p>\n"}, {"tags": ["haskell", "ghci"], "answers": [{"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": false, "score": 5, "last_activity_date": 1488620066, "last_edit_date": 1488620066, "creation_date": 1488613699, "answer_id": 42593573, "question_id": 42593284, "link": "https://stackoverflow.com/questions/42593284/function-definition-by-special-cases-in-ghci/42593573#42593573", "title": "Function definition by special cases in GHCi", "body": "<p>ghci is  an interactive tool and as such allows to redefine a function when it's already be define. In your case, it doesn't see it as a two lines function definition but as two attempts of defining it. So <code>f n = print n</code> overrides <code>f 0 = print 999</code> instead of completing it.</p>\n\n<p>To enter multiple lines statement in ghci there is a special syntax. You need to do</p>\n\n<pre><code>Prelude&gt; :{\nPrelude&gt; let foo 0 = print 999\nPrelude&gt;     foo n = print n\nPrelude&gt; :}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1585586115, "post_id": 42593586, "comment_id": 107806445, "body": "<code>:{</code> and <code>:}</code> are GHCi <i>commands</i> though. <code>{</code>, <code>;</code>, <code>}</code> are what I would call the explicit delimiters. :)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1585588077, "post_id": 42593586, "comment_id": 107807402, "body": "@WillNess A valid point. I have rephrased that sentence a bit."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 18, "last_activity_date": 1585588034, "last_edit_date": 1585588034, "creation_date": 1488613784, "answer_id": 42593586, "question_id": 42593284, "link": "https://stackoverflow.com/questions/42593284/function-definition-by-special-cases-in-ghci/42593586#42593586", "title": "Function definition by special cases in GHCi", "body": "<p>To use those definition in GHCi exactly as they were written (i.e. with multiple equations or type signatures in separate lines), you need to use multiline input in GHCi through the <code>:{</code> and <code>:}</code> delimiters:</p>\n\n<pre><code>GHCi&gt; :{\nGHCi| foo 0 = print 999\nGHCi| foo n = print n\nGHCi| :}\nGHCi&gt; foo 0\n999\n</code></pre>\n\n<p>One alternative would be turing on multiline input for the rest of your session with the <code>+m</code> option. In this case, though, you also need an explicit <code>let</code>, as without it GHCi won't figure out you want to continue the definition:</p>\n\n<pre><code>GHCi&gt; :set +m\nGHCi&gt; let foo 0 = print 999\nGHCi|     foo n = print n\nGHCi| \nGHCi&gt; foo 0\n999\n</code></pre>\n\n<p>(You can turn <code>+m</code> off with <code>:unset +m</code>.)</p>\n\n<p>Yet another possibility is eschewing line breaks altogether, and using explicit braces and semicolons:</p>\n\n<pre><code>GHCi&gt; foo 0 = print 999; foo n = print n\nGHCi&gt; foo 0\n999\n</code></pre>\n\n<p>Between the multiline input options, I personally prefer <code>:{</code> and <code>:}</code>  over <code>+m</code>, as they require less changes with respect to how I usually phrase my definitions, and are more likely to work straight away if I paste code from somewhere else.</p>\n\n<p>As for why your way of entering it didn't work, it was because, unless you use multiline input, bindings to the same name in separate GHCi lines shadow each other:</p>\n\n<pre><code>GHCi&gt; x = 3\nGHCi&gt; x = 4\nGHCi&gt; x\n4\n</code></pre>\n\n<p>This seems less surprising if we note that we get the same behaviour from a chain of <code>let</code>-expressions:</p>\n\n<pre><code>GHCi&gt; let x = 3 in let x = 4 in x\n4\n</code></pre>\n"}], "owner": {"reputation": 7463, "user_id": 1145760, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/065408758852145010d28c2aa811ca68?s=128&d=identicon&r=PG", "display_name": "Vorac", "link": "https://stackoverflow.com/users/1145760/vorac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 338, "favorite_count": 0, "accepted_answer_id": 42593586, "answer_count": 2, "score": 9, "last_activity_date": 1585588034, "creation_date": 1488611721, "last_edit_date": 1585584141, "question_id": 42593284, "link": "https://stackoverflow.com/questions/42593284/function-definition-by-special-cases-in-ghci", "title": "Function definition by special cases in GHCi", "body": "<p>From a Haskell <a href=\"http://www.cis.upenn.edu/~cis194/spring13/lectures.html\" rel=\"nofollow noreferrer\">tutorial</a>:</p>\n\n<blockquote>\n  <p>We can write functions on integers by cases.</p>\n  \n  <pre class=\"lang-hs prettyprint-override\"><code>-- Compute the sum of the integers from 1 to n.\nsumtorial :: Integer -&gt; Integer\nsumtorial 0 = 0\nsumtorial n = n + sumtorial (n-1)\n</code></pre>\n</blockquote>\n\n<p>However, here's what happens when I try it:</p>\n\n<pre><code>$ ghci\nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; foo 0 = print 999\nPrelude&gt; foo n = print n\nPrelude&gt; foo 0\n0\n</code></pre>\n\n<p>What am I missing?</p>\n"}, {"tags": ["haskell", "recursion", "functional-programming", "iteration", "tail-recursion"], "answers": [{"comments": [{"owner": {"reputation": 258, "user_id": 7121181, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pYVm3.jpg?s=128&g=1", "display_name": "Abhishek Kumar", "link": "https://stackoverflow.com/users/7121181/abhishek-kumar"}, "edited": false, "score": 0, "creation_date": 1488612670, "post_id": 42593252, "comment_id": 72318256, "body": "Worked like a charm. Just one thing, the function is actually <code>tail</code> not <code>tails</code>."}, {"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 1, "creation_date": 1488613868, "post_id": 42593252, "comment_id": 72318559, "body": "<code>tails</code>, from <code>Data.List</code>, is correct. <code>tails [1,2,3] == [[1,2,3], [2,3], [3], []]</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1488611510, "creation_date": 1488611510, "answer_id": 42593252, "question_id": 42593200, "link": "https://stackoverflow.com/questions/42593200/functional-way-of-finding-if-string-contains-substring/42593252#42593252", "title": "Functional way of finding if string contains substring?", "body": "<p>You can start by writing a function which computes all the suffixes:</p>\n\n<pre><code>suffixes :: [a] -&gt; [[a]]\nsuffixes [1,2,3] = [[1,2,3], [2,3], [3], []]\n</code></pre>\n\n<p>This can be implemented by recursion. In the libraries, this is called <code>tails</code>.</p>\n\n<p>Then, you can write a function to check whether a string is a prefix of another string</p>\n\n<pre><code>isPrefix :: String -&gt; String -&gt; Bool\nisPrefix \"a\" \"abc\" = True\nisPrefix \"bc\" \"abc\" = False\n</code></pre>\n\n<p>Again, recursion suffices.</p>\n\n<p>Finally, exploit both functions to check whether a given string is a prefix of some suffix of another given string.</p>\n\n<p>(This is not as efficient as <a href=\"https://en.wikipedia.org/wiki/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm\" rel=\"nofollow noreferrer\">Knuth-Morris-Pratt</a>, but it's simple to code.)</p>\n"}], "owner": {"reputation": 258, "user_id": 7121181, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pYVm3.jpg?s=128&g=1", "display_name": "Abhishek Kumar", "link": "https://stackoverflow.com/users/7121181/abhishek-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 499, "favorite_count": 0, "closed_date": 1488649580, "accepted_answer_id": 42593252, "answer_count": 1, "score": 1, "last_activity_date": 1488611510, "creation_date": 1488611136, "question_id": 42593200, "link": "https://stackoverflow.com/questions/42593200/functional-way-of-finding-if-string-contains-substring", "closed_reason": "Needs more focus", "title": "Functional way of finding if string contains substring?", "body": "<p>I am new to Haskell and Functional programming and wondering how nested loops can be implemented using functional recursive iteration. In particular, I want to write a function that will return True or False depending on whether a substring is present in a string.</p>\n\n<p>Note: There must be a function in the standard library to do this but, because I am trying to learn functional programming, I want to implement such a function myself.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1488600950, "post_id": 42591536, "comment_id": 72315827, "body": "I&#39;m pretty sure GHC doesn&#39;t allow that with a type family, for <a href=\"http://stackoverflow.com/questions/4922560/why-doesnt-typesynonyminstances-allow-partially-applied-type-synonyms-to-be-use\">the reason it doesn&#39;t allow it with a type synonym</a>."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1488601053, "post_id": 42591536, "comment_id": 72315849, "body": "It is possible if it&#39;s the type family ends in the type <code>Constraint</code> though with some with some class trickery as shown. I was just wondering whether I could extend that trickery to type families that don&#39;t end in the type <code>Constraint</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1488612780, "post_id": 42591536, "comment_id": 72318285, "body": "One could use <code>type family T a :: * -&gt; Constraint</code> but then instances can only depend on <code>a</code> e.g. <code>type instance T Int = K</code> where <code>K</code> is a one argument type class."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488620734, "post_id": 42591536, "comment_id": 72320259, "body": "The types of <code>C</code> and <code>T</code> are not <code>C :: * -&gt; * -&gt; Constraint</code> and <code>T :: * -&gt; * -&gt; *</code> - if they were, you wouldn&#39;t have this problem, as they would already be injective type constructors. The kinds of type families are currently inexpressible, but they are not function arrows. You can write <code>newtype T&#39; a b = T&#39; (T a b)</code> but it isn&#39;t really useful."}, {"owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "edited": false, "score": 0, "creation_date": 1488627714, "post_id": 42591536, "comment_id": 72322208, "body": "You want T to be an ordinary type contructor? Like <code>Either Int :: * -&gt; *</code>"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1488635855, "post_id": 42591536, "comment_id": 72324767, "body": "The <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow noreferrer\">singletons</a> library may be relevant (or more generally, the <a href=\"https://typesandkinds.wordpress.com/2013/04/01/defunctionalization-for-the-win/\" rel=\"nofollow noreferrer\">defunctionalization trick</a> used therein)."}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 206, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1488596174, "creation_date": 1488596174, "question_id": 42591536, "link": "https://stackoverflow.com/questions/42591536/partially-applied-type-families", "title": "Partially applied type families", "body": "<p>Given the following type family:</p>\n\n<pre><code>type family C a b :: Constraint\n</code></pre>\n\n<p>This has type:</p>\n\n<pre><code> C :: * -&gt; * -&gt; Constraint\n</code></pre>\n\n<p>Whilst <code>C Int</code> is invalid (one can not partially apply a type family).</p>\n\n<p>We can write the following:</p>\n\n<pre><code>class (C a b) =&gt; C' a b \ninstance (C a b) =&gt; C' a b \n</code></pre>\n\n<p>And now I can write:</p>\n\n<pre><code>C' Int\n</code></pre>\n\n<p>Which is of type:</p>\n\n<pre><code>C' Int :: * -&gt; Constraint.\n</code></pre>\n\n<p>My question is, lets say I've got</p>\n\n<pre><code>type family T a b\n</code></pre>\n\n<p>i.e. of type:</p>\n\n<pre><code> T :: * -&gt; * -&gt; *\n</code></pre>\n\n<p>Is there a way I can define <code>T'</code> such that I can write:</p>\n\n<pre><code> T' Int\n</code></pre>\n\n<p>With type:</p>\n\n<pre><code> T' :: * -&gt; *\n</code></pre>\n\n<p>Much like I've done with the constraint type?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "writer-monad"], "answers": [{"comments": [{"owner": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "edited": false, "score": 0, "creation_date": 1488585042, "post_id": 42590261, "comment_id": 72312849, "body": "Thanks. If I may ask a follow-up question. How can I define function unwrapping all this, similar to <code>runWriter</code>.  Signature:  <code>runW :: CSInt -&gt; (Int, Bool, Bool)</code>"}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "edited": false, "score": 0, "creation_date": 1488586288, "post_id": 42590261, "comment_id": 72313147, "body": "You can use <code>runWriter</code>/<code>runWriterT</code>, or just pattern match on the <code>CSInt</code> (see the definition of <code>WriterT</code>)."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1488584480, "creation_date": 1488584480, "answer_id": 42590261, "question_id": 42590149, "link": "https://stackoverflow.com/questions/42590149/writer-monad-nested-twice/42590261#42590261", "title": "Writer Monad Nested Twice", "body": "<p>Having multiple similar layers is in fact one case where the <code>mtl</code> approach, which is meant to make <code>lift</code> implicit, has trouble as you mentionned. So you can use <code>lift</code> explicitly.</p>\n\n<pre><code>lift :: Writer Struct Bool -&gt; WriterT Collision (Writer Struct) Bool\n</code></pre>\n\n<p>Thus</p>\n\n<pre><code>foo x = do lift (tell (S False)) ; return x\n</code></pre>\n"}], "owner": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 42590261, "answer_count": 1, "score": 2, "last_activity_date": 1488584480, "creation_date": 1488583771, "question_id": 42590149, "link": "https://stackoverflow.com/questions/42590149/writer-monad-nested-twice", "title": "Writer Monad Nested Twice", "body": "<p>I am trying to nest writer monad twice using Monad Transformers. Here is a sketch:</p>\n\n<pre><code>import Control.Monad.Identity\nimport Control.Monad.Writer\n\ndata Struct = S Bool\n\ninstance Monoid Struct where\n    mempty =  S True\n    mappend (S a) (S b) = S (a &amp;&amp; b)\n\ndata Collision = C Bool\n\ninstance Monoid Collision where\n    mempty =  C False\n    mappend (C a) (C b) = C (a || b)\n\ntype CSInt = WriterT Collision (WriterT Struct Identity) Int\n\nfoo :: Int -&gt; CSInt\nfoo x = do (tell (S False)) ; return x\n</code></pre>\n\n<p>The <code>foo</code> function does not compile, as I need to use <code>tell</code> on <code>Struct</code> monad, not <code>Collision</code>. Is it possible at all?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1488580808, "post_id": 42589622, "comment_id": 72311580, "body": "We demand <code>Num a</code> so that <code>1 :: a</code> makes sense."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1488580911, "post_id": 42589622, "comment_id": 72311612, "body": "As a side note, this question really sucks: the &quot;correct&quot; answer depends dearly on some of the less interesting vagaries of the Haskell type system, notably defaulting and number literal polymorphism and depending on how you interpret the question also the monomorphism restriction. If you had used a different class than <code>Num</code> for the <code>Num b</code> constraint (and an appropriate alternate argument to <code>2</code>, of course), likely the correct answer would have been &quot;it&#39;s an ambiguous type error&quot;, and if you write <code>foo = kessel 1 2</code> in a file and ask ghci about its type it will tell you <code>foo :: Integer</code>!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1488581395, "post_id": 42589622, "comment_id": 72311780, "body": "...and to be clear, by &quot;this question&quot; I don&#39;t mean the question you&#39;re asking sucks. I think you did a great job of setting up your question. I&#39;m saying the question from &quot;Haskell Programming from first principals&quot; is confusing and (in my opinion) badly-framed question."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1488591733, "post_id": 42589622, "comment_id": 72314331, "body": "@DanielWagner I can&#39;t figure out how to produce any of the problematic results you&#39;re describing. If I type <code>:t (undefined :: (Ord a, Monoid b) =&gt; a -&gt; b -&gt; a) 1 &quot;x&quot;</code> into ghci, I get <code>(Num a, Ord a) =&gt; a</code>. What am I missing?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 1, "creation_date": 1488603879, "post_id": 42589622, "comment_id": 72316337, "body": "@ChrisMartin Try <code>:t (undefined :: (Ord a, Monoid b) =&gt; a -&gt; b -&gt; a) 1 mempty</code>. The parallel here is that <code>2</code> is polymorphic over all <code>Num</code> instances, and <code>mempty</code> is polymorphic over all <code>Monoid</code> instances. Using <code>&quot;x&quot;</code> instead of <code>mempty</code> selects a particular <code>Monoid</code> and avoids the ambiguity problem."}], "answers": [{"comments": [{"owner": {"reputation": 1581, "user_id": 2319806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4aeddf919979c1ade0de68de94fc3b88?s=128&d=identicon&r=PG", "display_name": "ericky", "link": "https://stackoverflow.com/users/2319806/ericky"}, "edited": false, "score": 0, "creation_date": 1488600099, "post_id": 42590972, "comment_id": 72315669, "body": "&quot;...then the type of kessel 1 would still be (Num a, Ord a) =&gt; a. The Num is there because that&#39;s the type of 1, not because of the type of kessel.&quot; Ahh... that lifted the veil. Thank you for that."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 5, "last_activity_date": 1488590247, "creation_date": 1488590247, "answer_id": 42590972, "question_id": 42589622, "link": "https://stackoverflow.com/questions/42589622/haskell-return-type-confusion/42590972#42590972", "title": "Haskell return type confusion", "body": "<p>The type of <code>1</code> is <code>Num a =&gt; a</code>. When you pass it as the first argument to <code>kessel</code>, its type is restricted to <code>(Num a, Ord a) =&gt; a</code> because <code>kessel</code> requires <code>Ord</code> for its first argument. And since the type of the result is the same as that of the first argument, you get <code>(Num a, Ord a) =&gt; a</code> as the result type.</p>\n\n<p>Note that this has nothing to do with the type of the second argument. I imagine the second argument is just there to confuse you. If the function were:</p>\n\n<pre><code>kessel :: Ord a =&gt; a -&gt; a\n</code></pre>\n\n<p>then the type of <code>kessel 1</code> would still be <code>(Num a, Ord a) =&gt; a</code>. The <code>Num</code> is there because that's the type of <code>1</code>, not because of the type of <code>kessel</code>.</p>\n\n<p>The type of <code>kessel 'd' 2</code> is <code>Char</code>, as opposed to <code>Ord Char =&gt; Char</code>, because <code>Char</code> is already a concrete type that implements <code>Ord</code>, so the restriction is not necessary.</p>\n"}, {"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 1, "last_activity_date": 1488596139, "last_edit_date": 1592644375, "creation_date": 1488596139, "answer_id": 42591528, "question_id": 42589622, "link": "https://stackoverflow.com/questions/42589622/haskell-return-type-confusion/42591528#42591528", "title": "Haskell return type confusion", "body": "<blockquote>\n<p><code>kessel 'd' 2</code></p>\n<p>is valid and it is of type <code>Char</code> - nothing about <code>Num</code>!</p>\n</blockquote>\n<p>Yes! <code>kessel 1 2</code> and <code>kessel 'd' 2</code> have different types,</p>\n<pre><code>\u03bb&gt; kessel = undefined :: (Ord a, Num b) =&gt; a -&gt; b -&gt; a\nkessel :: (Num b, Ord a) =&gt; a -&gt; b -&gt; a\n\n\u03bb&gt; :t kessel 1 2\nkessel 1 2 :: (Num a, Ord a) =&gt; a\n\n\u03bb&gt; :t kessel 'd' 2\nkessel 'd' 2 :: Char\n</code></pre>\n<p>which is possible because <code>kessel</code> is <em>polymorphic</em>.</p>\n"}], "owner": {"reputation": 1581, "user_id": 2319806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4aeddf919979c1ade0de68de94fc3b88?s=128&d=identicon&r=PG", "display_name": "ericky", "link": "https://stackoverflow.com/users/2319806/ericky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 42590972, "answer_count": 2, "score": 4, "last_activity_date": 1488596139, "creation_date": 1488580550, "last_edit_date": 1488581570, "question_id": 42589622, "link": "https://stackoverflow.com/questions/42589622/haskell-return-type-confusion", "title": "Haskell return type confusion", "body": "<p>In working through \"Haskell Programming from first principles\" I am puzzled by the answer to the following question:</p>\n\n<blockquote>\n  <p>If the type of <code>kessel</code> is <code>(Ord a, Num b) =&gt; a -&gt; b -&gt; a</code>, then the type of\n  <code>kessel 1 2</code> is</p>\n  \n  <p>a) <code>Integer</code><br>\n  b) <code>Int</code><br>\n  c) <code>a</code><br>\n  d) <code>(Num a, Ord a) =&gt; a</code><br>\n  e) <code>Ord a =&gt; a</code><br>\n  f) <code>Num a =&gt; a</code></p>\n</blockquote>\n\n<p>The answer is d) - but I think the answer should be e), since the only requirement in the type signature for the first argument (a) is that it be an <code>Ord</code>. So why not the return?</p>\n\n<pre><code>kessel 'd' 2\n</code></pre>\n\n<p>is valid and it is of type <code>Char</code> - nothing about <code>Num</code>!</p>\n\n<p>What don't I understand?</p>\n\n<p>Thank you for your help.</p>\n"}, {"tags": ["haskell", "haskell-lens", "state-monad", "free-monad"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488588128, "post_id": 42589612, "comment_id": 72313609, "body": "You should probably link and/or allude to <a href=\"http://stackoverflow.com/q/42543095/2751851\">your earlier question</a>, as I feel it makes it a little more evident what you are trying to achieve."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488588197, "post_id": 42589612, "comment_id": 72313625, "body": "Consider it done! Thanks for being patient with me @duplode , you&#39;ve personally helped me with a lot of my questions :)"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1489380952, "post_id": 42725567, "comment_id": 72629517, "body": "Let&#39;s see if I got this: an <code>ActionT</code> is an action on the substate that carries along a bunch of actions on the global state. An action on the global state can be lifted to the substate by adding it to the bunch; while an action on the substate can be lifted to the global state by zooming as usual. The bunch of global state actions is eventually ran using <code>unLift</code>."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1489381305, "post_id": 42725567, "comment_id": 72629591, "body": "Yes, seems like you&#39;ve got an understanding of it. The FreeT allows interspersing of &#39;global&#39; state monads inline amidst the &#39;substate&#39; state monad; when we&#39;re unpacking the stack we use unLift to sequence the two sets of state monads <i>if and only if</i> the two state types are the same. We can &#39;zoom&#39; to convert substate actions down to the base state so they can eventually be run. I&#39;m currently testing out your answer to the other question, it&#39;s tricky, but it should work if I can figure out my &#39;Zoom&#39; instances. Thanks for taking an interest in my problem :)"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1489381363, "post_id": 42725567, "comment_id": 72629599, "body": "@duplode btw this is all for the event-driven application framework <a href=\"https://github.com/ChrisPenner/eve/\" rel=\"nofollow noreferrer\">&#39;Eve&#39;</a>; this particular part is found <a href=\"https://github.com/ChrisPenner/eve/blob/master/src/Eve/Internal/Actions.hs\" rel=\"nofollow noreferrer\">here</a>. It&#39;s currently the backbone for the <a href=\"https://github.com/chrispenner/rasa\" rel=\"nofollow noreferrer\">Rasa</a> Text editor."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1489384387, "post_id": 42725567, "comment_id": 72630354, "body": "That&#39;s really interesting; I wasn&#39;t quite aware of how far you have already gone with this project! By the way, <a href=\"https://github.com/ChrisPenner/rasa/blob/master/docs/Building-An-Extension.md#interacting-with-other-extensions\" rel=\"nofollow noreferrer\">this passage</a> clarifies a lot: what I initially missed is that, even though you are using <code>zoom</code>, zooming is not a good metaphor for what you are doing. You don&#39;t want isolation, but just to turn the state around and look at its different facets. In other words, you aren&#39;t building a microscope, but a kaleidoscope :)"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1489428452, "post_id": 42725567, "comment_id": 72656524, "body": "Right! I could tell people weren&#39;t quite understanding the use case, but it&#39;s tough to explain. Thanks for taking a look! Zoom seems to still fit the use case, but there&#39;s likely a better abstraction somewhere out there!"}], "tags": [], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "is_accepted": true, "score": 1, "last_activity_date": 1489375091, "last_edit_date": 1489375091, "creation_date": 1489171254, "answer_id": 42725567, "question_id": 42589612, "link": "https://stackoverflow.com/questions/42589612/zoom-instance-over-free-monad/42725567#42725567", "title": "Zoom instance over Free Monad", "body": "<p>While I couldn't ever get the previous to compile, I came up with an acceptable solution using FreeT as a wrapper around the State monad which simply defers the zooming of the lifted values till later, unfortunately I needed to manually implement <code>MonadTrans</code> and <code>MonadFree</code> as a result, which wasn't terribly easy to figure out. Also interpreting FreeT is a bit tricky without too many good tutorials out there except a (slightly out of date) guide by Gabriel Gonzalez.</p>\n\n<p>Here's what I ended up with </p>\n\n<pre><code>{-# language GeneralizedNewtypeDeriving #-}\n{-# language DeriveFunctor #-}\n{-# language FlexibleInstances #-}\n{-# language MultiParamTypeClasses #-}\n{-# language RankNTypes #-}\n{-# language TypeFamilies #-}\n{-# language UndecidableInstances #-}\n{-# language ScopedTypeVariables #-}\nmodule Eve.Internal.Actions\n( AppF(..)\n, ActionT(..)\n, AppT\n\n, execApp\n, liftAction\n) where\n\nimport Control.Monad.State\nimport Control.Monad.Trans.Free\nimport Control.Lens\n\n-- | An 'App' has the same base and zoomed values.\ntype AppT s m a = ActionT s s m a\n\n-- | A Free Functor for storing lifted App actions.\nnewtype AppF base m next = LiftAction (StateT base m next)\n    deriving (Functor, Applicative)\n\n-- | Base Action type. Allows paramaterization over application state,\n-- zoomed state and underlying monad.\nnewtype ActionT base zoomed m a = ActionT\n    { getAction :: FreeT (AppF base m) (StateT zoomed m) a\n    } deriving (Functor, Applicative, Monad, MonadIO, MonadState zoomed)\n\ninstance Monad n =&gt; MonadFree (AppF base n) (ActionT base zoomed n) where\n    wrap (LiftAction act) = join . ActionT . liftF . LiftAction $ act\n\ninstance MonadTrans (ActionT base zoomed) where\n    lift = ActionT . lift . lift\n\n-- | Helper method to run FreeTs.\nunLift :: Monad m =&gt; FreeT (AppF base m) (StateT base m) a -&gt; StateT base m a\nunLift m = do\n    step &lt;- runFreeT m\n    case step of\n        Pure a -&gt; return a\n        Free (LiftAction next) -&gt; next &gt;&gt;= unLift\n\n-- | Allows 'zoom'ing 'Action's.\ntype instance Zoomed (ActionT base zoomed m) =\n    Zoomed (FreeT (AppF base m) (StateT zoomed m))\ninstance Monad m =&gt; Zoom (ActionT base s m) (ActionT base t m) s t where\n    zoom l (ActionT action) = ActionT $ zoom l action\n\n-- | Given a 'Lens' or 'Traversal' or something similar from \"Control.Lens\"\n-- which focuses the state (t) of an 'Action' from a base state (s),\n-- this will convert @Action t a -&gt; Action s a@.\n--\n-- Given a lens @HasStates s =&gt; Lens' s t@ it can also convert \n-- @Action t a -&gt; App a@\nrunAction :: Zoom m n s t =&gt; LensLike' (Zoomed m c) t s -&gt; m c -&gt; n c\nrunAction = zoom\n\n-- | Allows you to run an 'App' or 'AppM' inside of an 'Action' or 'ActionM'\nliftAction :: Monad m =&gt; AppT base m a -&gt; ActionT base zoomed m a\nliftAction = liftF .  LiftAction . unLift . getAction\n\n-- | Runs an application and returns the value and state.\nrunApp :: Monad m =&gt; base -&gt; AppT base m a -&gt; m (a, base)\nrunApp baseState = flip runStateT baseState . unLift . getAction\n\n-- | Runs an application and returns the resulting state.\nexecApp :: Monad m =&gt; base -&gt; AppT base m a -&gt; m base\nexecApp baseState = fmap snd . runApp baseState\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 42725567, "answer_count": 1, "score": 1, "last_activity_date": 1489375091, "creation_date": 1488580510, "last_edit_date": 1495540429, "question_id": 42589612, "link": "https://stackoverflow.com/questions/42589612/zoom-instance-over-free-monad", "title": "Zoom instance over Free Monad", "body": "<p>I'm attempting to build a free monad (using <a href=\"https://hackage.haskell.org/package/free\" rel=\"nofollow noreferrer\"><code>free</code></a>) which acts just like a StateT monad, but which allows you to also run monads over a base state <code>AppState</code>. I have a separate constructor <code>LiftAction</code> which holds those types. The idea is that you keep <code>zoom</code>ing Actions down until they reach AppState, which can store different states inside its extension map.</p>\n\n<p>Here was my earlier (failed) attempt using mtl: <a href=\"https://stackoverflow.com/questions/42543095/lift-through-nested-state-transformers-mtl\">Lift through nested state transformers (mtl)</a></p>\n\n<p>Anyways, since it's basically a wrapper over <code>StateT</code> I've given it a <code>MonadState</code> instance, but now I'm working on adding the ability to zoom the monad's state using the <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Zoom.html\" rel=\"nofollow noreferrer\">lens library</a>; I'm getting some weird compiler errors I'm having trouble understanding (the lens errors aren't usually terribly user friendly).</p>\n\n<p>Here's my code and initial attempt:</p>\n\n<pre><code>{-# language GeneralizedNewtypeDeriving #-}\n{-# language DeriveFunctor #-}\n{-# language FlexibleInstances #-}\n{-# language MultiParamTypeClasses #-}\n{-# language RankNTypes #-}\n{-# language TypeFamilies #-}\n{-# language UndecidableInstances #-}\nmodule Eve.Internal.AppF\n  ( Action(..)\n  , App\n  , AppState(..)\n  , liftAction\n  , execApp\n  ) where\n\nimport Control.Monad.State\nimport Control.Monad.Free\nimport Control.Lens\n\ntype App a = Action AppState a\ndata AppState = AppState\n  { baseExts :: Int -- Assume this actually contains many nested states which we can zoom\n  }\n\ndata ActionF s next =\n    LiftAction (Action AppState next)\n    | LiftIO (IO next)\n    | StateAction (StateT s IO next)\n    deriving Functor\n\nnewtype Action s a = Action\n  { getAction :: Free (ActionF s) a\n  } deriving (Functor, Applicative, Monad)\n\nliftActionF :: ActionF s next -&gt; Action s next\nliftActionF = Action . liftF\n\ninstance MonadState s (Action s) where\n  state = liftActionF . StateAction . state\n\nliftAction :: Action AppState a -&gt; Action s a\nliftAction = liftActionF . LiftAction\n\nexecApp :: Action AppState a -&gt; StateT AppState IO a\nexecApp (Action actionF) = foldFree toState actionF\n  where\n    toState (LiftAction act) = execApp act\n    toState (LiftIO io) = liftIO io\n    toState (StateAction st) = st\n\ntype instance Zoomed (Action s) = Zoomed (StateT s IO)\ninstance Zoom (Action s) (Action t) s t where\n  zoom l (Action actionF) = Action $ hoistFree (zoomActionF l) actionF\n    where\n      zoomActionF _ (LiftAction act) = LiftAction act\n      zoomActionF _ (LiftIO io) = LiftIO io\n      zoomActionF lns (StateAction act) = StateAction $ zoom lns act\n</code></pre>\n\n<p>I'm getting the error:</p>\n\n<pre><code>/Users/chris/dev/eve/src/Eve/Internal/AppF.hs:53:65: error:\n    \u2022 Couldn't match type \u2018a\u2019 with \u2018c\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n        a type expected by the context:\n          forall a. ActionF s a -&gt; ActionF t a\n        at /Users/chris/dev/eve/src/Eve/Internal/AppF.hs:53:42\n      \u2018c\u2019 is a rigid type variable bound by\n        the type signature for:\n          zoom :: forall c.\n                  LensLike' (Zoomed (Action s) c) t s -&gt; Action s c -&gt; Action t c\n        at /Users/chris/dev/eve/src/Eve/Internal/AppF.hs:53:7\n      Expected type: LensLike'\n                       (Control.Lens.Internal.Zoom.Focusing IO a) t s\n        Actual type: LensLike' (Zoomed (Action s) c) t s\n    \u2022 In the first argument of \u2018zoomActionF\u2019, namely \u2018l\u2019\n      In the first argument of \u2018hoistFree\u2019, namely \u2018(zoomActionF l)\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018hoistFree (zoomActionF l) actionF\u2019\n    \u2022 Relevant bindings include\n        actionF :: Free (ActionF s) c\n          (bound at /Users/chris/dev/eve/src/Eve/Internal/AppF.hs:53:22)\n        l :: LensLike' (Zoomed (Action s) c) t s\n          (bound at /Users/chris/dev/eve/src/Eve/Internal/AppF.hs:53:12)\n        zoom :: LensLike' (Zoomed (Action s) c) t s\n                -&gt; Action s c -&gt; Action t c\n          (bound at /Users/chris/dev/eve/src/Eve/Internal/AppF.hs:53:7)\n</code></pre>\n\n<p>So far as I can tell it's getting confused because the StateT is embedded in the Free constructor and it loses track of the type of <code>a</code>.</p>\n\n<p>I previously had a working version by defining my own zoom function which zoomed the underlying StateT given a 'Lens', but the trick is that I'd like this to also work with <code>Traversal'</code>s, so the cleanest way would be to write the zoom instance.</p>\n\n<p>Anyone have an idea of how to get this to compile? Thanks in advance!! If at all possible please try compiling your answers before posting, thanks!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 4, "creation_date": 1488571660, "post_id": 42587528, "comment_id": 72307223, "body": "hi, welcome to stackoverflow and haskell! Can you tell us - what have you tried, where are you stuck - what functions of <code>Data.List</code> can you think of that would be helpful?"}, {"owner": {"reputation": 15, "user_id": 7655516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75097ac6224c4954632118bcd16dd1f5?s=128&d=identicon&r=PG&f=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/7655516/andrey"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488571839, "post_id": 42587528, "comment_id": 72307310, "body": "[By Naive implementation I find subsequence but not a sequence] increasing :: Ord a =&gt; [a] -&gt; [a]  increasing = maximumBy (comparing length) . map nub . filter isSorted . subsequences"}, {"owner": {"reputation": 12066, "user_id": 3924118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/abb01e1c2a8e3d9e1534dca14b19b3d8?s=128&d=identicon&r=PG&f=1", "display_name": "nbro", "link": "https://stackoverflow.com/users/3924118/nbro"}, "edited": false, "score": 0, "creation_date": 1488572179, "post_id": 42587528, "comment_id": 72307488, "body": "What do you mean by &quot;section&quot;?"}, {"owner": {"reputation": 15, "user_id": 7655516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75097ac6224c4954632118bcd16dd1f5?s=128&d=identicon&r=PG&f=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/7655516/andrey"}, "edited": false, "score": 0, "creation_date": 1488572413, "post_id": 42587528, "comment_id": 72307612, "body": "I don&#39;t know the word, may be line segment? For example [5,4,2,1] result --[5], [4], [2] or [1]. And for [3,2,6,4,5,1] result [2, 6] or [4, 5]."}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 7655516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75097ac6224c4954632118bcd16dd1f5?s=128&d=identicon&r=PG&f=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/7655516/andrey"}, "edited": false, "score": 0, "creation_date": 1488574370, "post_id": 42587985, "comment_id": 72308620, "body": "Ok, thanks you. I understood this one. Also a question: if I need a function increasingSequences :: Ord a =&gt; [a] -&gt; [a] with only one sequence in result? What should I use?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 15, "user_id": 7655516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75097ac6224c4954632118bcd16dd1f5?s=128&d=identicon&r=PG&f=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/7655516/andrey"}, "edited": false, "score": 2, "creation_date": 1488575582, "post_id": 42587985, "comment_id": 72309218, "body": "what do you need - any one? the first one ? the longest one? - you can use <code>head . sortBy (compare `on` length)</code>, in combination with this one - you just need to make sure that the original list is not empty - otherwise <code>head</code> will fail."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1488575972, "last_edit_date": 1488575972, "creation_date": 1488573248, "answer_id": 42587985, "question_id": 42587528, "link": "https://stackoverflow.com/questions/42587528/how-can-i-find-the-longest-increasing-section-of-numbers-at-list-in-haskell/42587985#42587985", "title": "How can I find the longest increasing section of numbers at list in Haskell?", "body": "<p>It seems you are on a good way - and you already seem to know a lot - so I won't spoil the result for you.</p>\n\n<p>At first I think you should change the type signature of your function</p>\n\n<pre><code>increasingSequences :: Ord a =&gt; [a] -&gt; [[a]]\n</code></pre>\n\n<p>There is already one function that promises to be a solution to that problem from <code>Data.List</code> namely - <code>groupBy</code>, in the form of <code>groupBy (&lt;=)</code>.</p>\n\n<p>But <code>groupBy</code> does not work as expected, it compares with the first element of each group - which is ok for <code>groupBy (==)</code> - but not for your case.</p>\n\n<pre><code>&gt; ghci\nGHCi, version 8.0.2: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from /home/epsilonhalbe/.ghc/ghci.conf\nPrelude&gt; import Data.List\nPrelude Data.List&gt; groupBy (&lt;=) [10,9..6]\n[[10],[9],[8],[7],[6]]\nPrelude Data.List&gt; groupBy (&lt;=) (1:[10,9..6])\n[[1,10,9,8,7,6]]\n</code></pre>\n\n<p>so you need to implement that one yourself - the easiest version IMHO would be to use pattern matching and recursion - <strong>I would strongly suggest writing it and posting it here as an answer (I will check in the next few days and vote that one up if you do!)</strong></p>\n\n<p>If you <em>really</em> want a spoiler there is actually a <a href=\"https://wiki.haskell.org/List_function_suggestions#Generalize_groupBy_and_friends\" rel=\"nofollow noreferrer\">wiki page</a> that gives a solution to your problem.</p>\n\n<blockquote class=\"spoiler\">\n  <p><code>\ngroupBy                 :: (a -> a -> Bool) -> [a] -> [[a]]\ngroupBy rel []          =  []\ngroupBy rel (x:xs)      =  (x:ys) : groupBy rel zs\n    where (ys,zs) = groupByAux x xs\n          groupByAux x0 (x:xs) | rel x0 x = (x:ys, zs)\n            where (ys,zs) = groupByAux x xs\n          groupByAux y xs = ([], xs)</code></p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488627792, "post_id": 42590044, "comment_id": 72322229, "body": "Is there any particular reason why you use case expressions over pattern matching in the function definition? Also do you know that you can pattern match on <code>(x:y:xy)</code>?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1488643298, "post_id": 42590044, "comment_id": 72327123, "body": "ah - it is just a matter of style - +1 for including the alternative style"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "is_accepted": true, "score": 2, "last_activity_date": 1520089981, "last_edit_date": 1520089981, "creation_date": 1488583149, "answer_id": 42590044, "question_id": 42587528, "link": "https://stackoverflow.com/questions/42587528/how-can-i-find-the-longest-increasing-section-of-numbers-at-list-in-haskell/42590044#42590044", "title": "How can I find the longest increasing section of numbers at list in Haskell?", "body": "<p>Binary-predicate cut of a sequence; the cut occurs at the first pair <code>(x1, x2)</code> for which <code>x1 &lt;&gt; x2</code> doesn\u2019t hold:</p>\n\n<pre><code>biCut :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])\nbiCut (&lt;&gt;) (x1 : xs@(x2 : _)) | x1 &lt;&gt; x2  = let (tk, dp) = biCut (&lt;&gt;) xs\n                                            in  (x1 : tk, dp)\n                              |\u00a0otherwise = ([x1], xs)\nbiCut _    xs                             = (xs, [])\n</code></pre>\n\n<p>(analogous to <code>splitAt</code>) or in terms of</p>\n\n<pre><code>biFst :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]\nbiFst (&lt;&gt;) (x1 : xs@(x2 : _)) | x1 &lt;&gt; x2  = x1 : biFst (&lt;&gt;) xs\n                              | otherwise = [x1]\nbiFst _    xs                             = xs\n\nbiSnd :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]\nbiSnd (&lt;&gt;) (x1 : xs@(x2 : _)) | x1 &lt;&gt; x2  = biSnd (&lt;&gt;) xs\n                              | otherwise = xs\nbiSnd _    _                              = []\n</code></pre>\n\n<p>(<code>take</code> and <code>drop</code>) such that <code>forall (&lt;&gt;) xs.</code></p>\n\n<pre><code>biFst (&lt;&gt;) xs ++ biSnd (&lt;&gt;) xs  =  xs\n                 biCut (&lt;&gt;) xs  =  (biFst (&lt;&gt;) xs, biSnd (&lt;&gt;) xs)    [CUT]\n</code></pre>\n\n<p>then</p>\n\n<pre><code>sections :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]\nsections _    [] = []\nsections (&lt;&gt;) xs = let (tk, dp) = biCut (&lt;&gt;) xs\n                   in  tk : sections (&lt;&gt;) dp\n</code></pre>\n\n<p>such that</p>\n\n<pre><code>        concat . sections (&lt;&gt;)  =  id\n</code></pre>\n\n<p>\u201cSections\u201d are non-empty subsequences for which the binary predicate <code>&lt;&gt;</code> holds between successors. Reformulating the standard <code>maximumBy</code> as a <em>total function</em>:</p>\n\n<pre><code>maximumBy :: Foldable t =&gt; (a -&gt; a -&gt; Ordering) -&gt; t a -&gt; Maybe a\nmaximumBy cmp xs | null xs   = Nothing\n                 | otherwise = Just (foldl1 max' xs)\n   where\n      max' x y = case x `cmp` y of\n                    LT -&gt; y            -- Leftmost-biased\n                    _  -&gt; x\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>longestAsc :: Ord a =&gt; [a] -&gt; Maybe [a]\nlongestAsc = maximumBy (compare `on` length) . sections (&lt;)\n</code></pre>\n\n<p>is the function.</p>\n\n<pre><code>      longestAsc [2,3,2,1,2,3]  =  Just [1,2,3]\n              longestAsc [2,1]  =  Just [2]\n                 longestAsc []  =  Nothing\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 7655516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75097ac6224c4954632118bcd16dd1f5?s=128&d=identicon&r=PG&f=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/7655516/andrey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 724, "favorite_count": 0, "accepted_answer_id": 42590044, "answer_count": 2, "score": 1, "last_activity_date": 1520089981, "creation_date": 1488571509, "last_edit_date": 1488572093, "question_id": 42587528, "link": "https://stackoverflow.com/questions/42587528/how-can-i-find-the-longest-increasing-section-of-numbers-at-list-in-haskell", "title": "How can I find the longest increasing section of numbers at list in Haskell?", "body": "<p>For example list <code>[1,3,4,3,6,7,3]</code> gives result <code>[1,3,4]</code> or <code>[3,6,7]</code>. I can find only subsequence but not a section.</p>\n\n<h2>Edit</h2>\n\n<p>By Naive implementation I find subsequence</p>\n\n<pre><code>increasing :: Ord a =&gt; [a] -&gt; [a]\nincreasing = maximumBy (comparing length) . map nub \n                                          . filter isSorted\n                                          . subsequences\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1488567619, "post_id": 42586432, "comment_id": 72305123, "body": "The original is equivalent to <code>(map (&gt;= 16) . take 5) (iterate (\\x -&gt; x^2) 2)</code>. <code>.</code> expects its operands to be functions. You could also write <code>map (&gt;= 16) $ take 5 (iterate (\\x -&gt; x^2) 2)</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1488568304, "post_id": 42586432, "comment_id": 72305434, "body": "<code>map (&gt;= 16) . take 5 (iterate  (\\x -&gt; x^2) 2)</code> actually means <code>(map (&gt;= 16)) . (take 5 (iterate  (\\x -&gt; x^2) 2))</code> so <code>(.)</code> is passed a function and a list instead of two functions. Remember that application <code>f x y z</code> has higher priority over any infix like <code>+</code> or <code>.</code>."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 1, "creation_date": 1488568335, "post_id": 42586432, "comment_id": 72305450, "body": "I often follow the rule: separate functions by <code>.</code> and the argument by <code>$</code> This would give <code>map (&gt;=16) . take 5 . iterate (^2) $ 2</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1488578925, "post_id": 42586432, "comment_id": 72310840, "body": "You need to pay careful attention to currying and partial application. <code>take</code> is not a function of two arguments; it is a function of one argument that returns another function. Adding some redundant parentheses,  <code>(map (&gt;= 16)) . take</code> does not type check, but <code>(map (&gt;= 16)) . (take 5)</code> does."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1488632263, "last_edit_date": 1488632263, "creation_date": 1488567605, "answer_id": 42586521, "question_id": 42586432, "link": "https://stackoverflow.com/questions/42586432/confusion-about-the-operator-and-parentheses/42586521#42586521", "title": "Confusion about the $ operator and parentheses", "body": "<p>The <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:-36-\" rel=\"nofollow noreferrer\"><code>($) :: (a -&gt; b) -&gt; a -&gt; b</code></a> operator is a function that simply has a <strong>the lowest priority</strong> (<code>infixr 0</code>, only <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-820004.4.2\" rel=\"nofollow noreferrer\"><code>($!)</code> and <code>seq</code> have the same priority</a>). As a result:</p>\n\n<pre><code>map (&gt;= 16) . take 5 $ iterate  (\\x -&gt; x^2) 2\n</code></pre>\n\n<p>is equivalent to:</p>\n\n<pre><code><b>(</b>map (&gt;= 16) . take 5<b>) (</b>iterate  (\\x -> x^2) 2<b>)</b></code></pre>\n\n<p>so also with brackets for the left operand as well.</p>\n\n<p>It is actually a nice thing about Haskell that you can use operators as a grouping mechanism: <code>($)</code> is simply defined as <code>($) f x = f x</code>, but because of the fact that it is an operator, it can be used as a way to avoid brackets.</p>\n"}], "owner": {"reputation": 1487, "user_id": 2755279, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2cb83d1ea49b73b69a918141938876d5?s=128&d=identicon&r=PG&f=1", "display_name": "netik", "link": "https://stackoverflow.com/users/2755279/netik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 42586521, "answer_count": 1, "score": 1, "last_activity_date": 1488632263, "creation_date": 1488567254, "question_id": 42586432, "link": "https://stackoverflow.com/questions/42586432/confusion-about-the-operator-and-parentheses", "title": "Confusion about the $ operator and parentheses", "body": "<p>I'm working my way through the first haskell book and struggle with the <code>$</code> operator:</p>\n\n<p>The following line works:</p>\n\n<pre><code>map (&gt;= 16) . take 5 $ iterate  (\\x -&gt; x^2) 2\n</code></pre>\n\n<p>However, the following doesn't:</p>\n\n<pre><code>map (&gt;= 16) . take 5 (iterate  (\\x -&gt; x^2) 2)\n</code></pre>\n\n<blockquote>\n  <p>Possible cause: `take' is applied to too many arguments</p>\n</blockquote>\n\n<p>I don't see the problem here. <code>take</code> takes an int and a list. To my understanding, I provided both arguments.</p>\n\n<p>What do I have to do if I want to avoid the <code>$</code> operator?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488567117, "post_id": 42586335, "comment_id": 72304894, "body": "are you sure you want <code>data BitSet c a = BitSet c</code> and not <code>data BitSet c a = BitSet a</code>?"}, {"owner": {"reputation": 1349, "user_id": 7655081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b23af7029d2ec53c15d8d9d2cccb0bb?s=128&d=identicon&r=PG&f=1", "display_name": "0xd34df00d", "link": "https://stackoverflow.com/users/7655081/0xd34df00d"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488567451, "post_id": 42586335, "comment_id": 72305022, "body": "@epsilonhalbe yep, <code>c</code> defines the underlying representation and <code>a</code> is there to just allow distinguishing between <code>BitSet</code>s storing different values on type level."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488568847, "post_id": 42586335, "comment_id": 72305743, "body": "If &quot;a is assumed to be Enum so that it could be converted to an integer&quot;, then what you really want is to simply store an integer. The Foldable instance doesn&#39;t really make sense, precisely because you need a constraint on the &#39;contained&#39; type to make sense of it. If you change your type to <code>data BitSet c = BitSet Integer</code> then it should be apparent why Foldable doesn&#39;t make sense - you have no tyvar to fold over. Furthermore, your type should be abstract, and as such, <code>Data</code> and <code>Generic</code> instances (at least the derived ones) for it don&#39;t make sense as they allow you to break the abstraction."}, {"owner": {"reputation": 1349, "user_id": 7655081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b23af7029d2ec53c15d8d9d2cccb0bb?s=128&d=identicon&r=PG&f=1", "display_name": "0xd34df00d", "link": "https://stackoverflow.com/users/7655081/0xd34df00d"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488569169, "post_id": 42586335, "comment_id": 72305945, "body": "@user2407038 Let&#39;s fix <code>c = Word</code> for clariy (assuming <code>Word</code> is big enough to hold bits for all possible values of <code>a</code>), then <code>BitSet Word a</code>  is isomorphic to <code>Data.Set a</code> (for some <code>a</code>), and <code>Data.Set</code> is indeed <code>Foldable</code>. The only reason why an additional constraint for <code>a</code> is there is due to the implementation details, namely, the way the values of <code>a</code> are recovered from the internal representation. Doesn&#39;t reasoning like this make sense?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488569868, "post_id": 42586335, "comment_id": 72306306, "body": "@0xd34df00d If you pack the <code>Enum</code> instance into the type, and you only use <code>toEnum</code> (from the Enum class) this is morally the same as <code>exists x . (x, x -&gt; Integer)</code> which is isomorphic to <code>Integer</code>. But you are correct, it is just an implementation detail, and you should be free to implement it however you like. Replace <code>a</code> with <code>Integer</code> or pack the <code>Enum a</code> constraint into the type - from the point of view of a user of your type, it doesn&#39;t make a difference. Again, the real issue is your type is an abstract type and it the <code>Data</code> and <code>Generic</code> instances which need to be changed."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488570026, "post_id": 42586335, "comment_id": 72306397, "body": "@0xd34df00d Perhaps my comment &quot;Foldable doesn&#39;t make sense&quot; has mislead you... I meant it doesn&#39;t make sense <i>to the compiler</i>. Yes, it make sense semantically, but the goal is to convince the compiler you are correct. You could write <code>data BitSet c = BitSet Integer</code> because the <code>a</code> becomes redundant (from the compilers point of view), or you could write <code>data BitSet c a = BitSet Integer</code> if that <code>a</code> has semantic meaning to you, or you could write <code>data BitSet c a where BitSet :: Enum a =&gt; c -&gt; BitSet c a</code> if you wish to use the <code>Enum</code> instance directly. It is up to you!"}, {"owner": {"reputation": 1349, "user_id": 7655081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b23af7029d2ec53c15d8d9d2cccb0bb?s=128&d=identicon&r=PG&f=1", "display_name": "0xd34df00d", "link": "https://stackoverflow.com/users/7655081/0xd34df00d"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488570291, "post_id": 42586335, "comment_id": 72306542, "body": "@user2407038 You mean like <code>data Enum a =&gt; BitSet c a = BitSet c</code>? I&#39;ve heard that&#39;s a bad practice, and it requires carrying <code>Enum a</code> basically everywhere, while, say, <code>Eq</code> or <code>Monoid</code> instances don&#39;t need this constraint. And, anyway, datatype contexts break Generic derivation as well, which brings us to the second part: I&#39;m not sure I follow why would it be breaking the abstraction? <code>Data.Set</code> is <code>Data</code> as well (though it&#39;s not <code>Generic</code>), for instance."}, {"owner": {"reputation": 1349, "user_id": 7655081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b23af7029d2ec53c15d8d9d2cccb0bb?s=128&d=identicon&r=PG&f=1", "display_name": "0xd34df00d", "link": "https://stackoverflow.com/users/7655081/0xd34df00d"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488570478, "post_id": 42586335, "comment_id": 72306624, "body": "@user2407038 Thanks for the clarification! From what I know, only the third option (with GADTs) would work - the other two still suffer from the same issue of typechecker not knowing that <code>c</code> is <code>Enum c</code> for all instantiations of <code>BitSet</code> at the point of defining the <code>Foldable</code> instance. But then it brings us again to whether we need generics."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488570509, "post_id": 42586335, "comment_id": 72306640, "body": "@0xd34df00d If you look at the <a href=\"https://hackage.haskell.org/package/containers-0.5.10.1/docs/src/Data-Set-Internal.html#line-345\" rel=\"nofollow noreferrer\"><code>Data (Set a)</code></a> instance, it is not the auto-derived one, it is hand written (so as to not allow the breaking of the abstraction). You can have a <code>Data</code> instance as well, but it <i>cannot</i> be the auto-derived one. And nowhere have I written a type with a datatype context. I mean exactly what I wrote, what you asked about - a GADT."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488571398, "post_id": 42586335, "comment_id": 72307087, "body": "All this being said, even if you get your Foldable instance, you will not be able to get Functor, nor Traversable, with the same &#39;trick&#39;, which semantically make sense as well. It seems you want a library like <a href=\"https://hackage.haskell.org/package/mono-traversable\" rel=\"nofollow noreferrer\">mono-traversable</a> which is specifically designed to solve this problem. Note that <code>Set</code> has a <code>map</code> function, but it doesn&#39;t abide by Functor laws - likewise for your type. Luckily, (or maybe unluckily), Foldable is pretty much lawless (or at least nobody can agree on the laws), so you can do anything you want there."}], "owner": {"reputation": 1349, "user_id": 7655081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2b23af7029d2ec53c15d8d9d2cccb0bb?s=128&d=identicon&r=PG&f=1", "display_name": "0xd34df00d", "link": "https://stackoverflow.com/users/7655081/0xd34df00d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1488569227, "creation_date": 1488566909, "last_edit_date": 1495539968, "question_id": 42586335, "link": "https://stackoverflow.com/questions/42586335/constraints-for-instances-of-typeclasses-not-mentioning-the-constrained-type-var", "title": "Constraints for instances of typeclasses not mentioning the constrained type variable", "body": "<p>Let's say we're writing a simple bitset that uses a field of type <code>c</code> (think <code>Word</code>) to signify the presence of different values of type <code>a</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data BitSet c a = BitSet c\n            deriving (Eq, Ord, Data, Typeable, Generic, NFData)\n\nisSet :: (Bits c, Enum a) =&gt; a -&gt; BitSet c a -&gt; Bool\nisSet e (BitSet c) = testBit c $ fromEnum e\n</code></pre>\n\n<p><code>a</code> is assumed to be <code>Enum</code> so that it could be converted to an integer corresponding to the bit index.</p>\n\n<p>Let's now try writing a <code>Foldable</code> instance for <code>BitSet c</code>, starting with the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance FiniteBits c =&gt; Foldable (BitSet c) where\n    foldr f b0 (BitSet c) = foldr f b0 list\n        where (list :: [a]) = toEnum &lt;$&gt; filter (testBit c) [0..finiteBitSize c - 1]\n</code></pre>\n\n<p>But this won't work: it doesn't have the constraint that <code>a</code> should satisfy <code>Enum a</code>, and I don't see any way to provide it (and I have a gut feel that it doesn't make much sense from more theoretical point of view if <code>a</code> isn't listed in the instance declaration, but that's probably another story).</p>\n\n<p>The most voted answer <a href=\"https://stackoverflow.com/questions/12497542/type-parameters-constraints-for-instances-of-typeclasses-with-kind\">here</a> suggests that using GADTs might help, but GADTs have their own shortcomings:</p>\n\n<ol>\n<li>One would need to use standalone deriving, which gets particularly ugly for Data and Typeable, and, what's worse,</li>\n<li>GADTs seem to break derivation of Generic for this type at all.</li>\n</ol>\n\n<p>Is there any other way to write a <code>Foldable</code> instance while still keeping autoderived Generic instance?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1488558719, "post_id": 42583838, "comment_id": 72300355, "body": "Generics can do this.  You could build a generic parser on top of something like attoparsec with a <code>Parseable</code> typeclass that provides a default implementation for anything implementing <code>Generic</code>.  Then you just need <code>instance Parseable User where</code> to be able to parse it."}, {"owner": {"reputation": 447, "user_id": 2812201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a5900e009117b30b90fb5bce64d6fd8e?s=128&d=identicon&r=PG&f=1", "display_name": "user2812201", "link": "https://stackoverflow.com/users/2812201/user2812201"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1488559312, "post_id": 42583838, "comment_id": 72300704, "body": "Good to know. Where can I find more detail? I did google &quot;attoparsec generic parsable&quot; however, the search result was not very helpful."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1488560260, "post_id": 42583838, "comment_id": 72301324, "body": "<code>Parsable</code> would be the type class you write yourself.  Attoparsec is a library that is decent at parsing bytestrings.  Generic is a built-in typeclass that provides functions for getting a generic representation of a data type that can be manipulated in code.  For example, aeson provides a <code>FromJSON</code> typeclass that can take advantage of <code>Generic</code> so that you can do <code>instance FromJSON MyType where</code> without any extra work to get the ability to parse JSON to values of <code>MyType</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1488560696, "post_id": 42583838, "comment_id": 72301611, "body": "@user2812201 The <code>GHC.Generics</code> docs has <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-Generics.html#g:10\" rel=\"nofollow noreferrer\">an example of generic programming for an <code>Encode</code> type class</a>. Similar sort of idea, except encoding instead of decoding."}, {"owner": {"reputation": 447, "user_id": 2812201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a5900e009117b30b90fb5bce64d6fd8e?s=128&d=identicon&r=PG&f=1", "display_name": "user2812201", "link": "https://stackoverflow.com/users/2812201/user2812201"}, "edited": false, "score": 0, "creation_date": 1488560717, "post_id": 42583838, "comment_id": 72301629, "body": "Thank you bheklilr. So I do sth in line of <code>class Parsable where parse :: ByteString -&gt; Parser Parsable</code> and <code>data User ... deriving Generic</code> and <code>instance Parsable User where parse = ...</code> ? I will check the src code of aeson and figure it out."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1488561837, "post_id": 42583838, "comment_id": 72302279, "body": "Related: <a href=\"http://stackoverflow.com/questions/38248692/whats-a-better-way-of-managing-large-haskell-records\" title=\"whats a better way of managing large haskell records\">stackoverflow.com/questions/38248692/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 5, "last_activity_date": 1488722871, "last_edit_date": 1488722871, "creation_date": 1488563433, "answer_id": 42585429, "question_id": 42583838, "link": "https://stackoverflow.com/questions/42583838/generically-build-parsers-from-custom-data-types/42585429#42585429", "title": "(Generically) Build Parsers from custom data types?", "body": "<p>For these kinds of problems I turn to <a href=\"http://hackage.haskell.org/package/generics-sop\" rel=\"nofollow noreferrer\">generics-sop</a> instead of using generics directly. <em>generics-sop</em> is built on top of Generics and provides functions for manipulating all the fields in a record in a uniform way.</p>\n\n<p>In this answer I use the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Text-ParserCombinators-ReadP.html#t:ReadP\" rel=\"nofollow noreferrer\">ReadP</a> parser which comes with <em>base</em>, but any other <code>Applicative</code> parser would do. Some preliminary imports:</p>\n\n<pre><code>{-# language DeriveGeneric #-}\n{-# language FlexibleContexts #-}\n{-# language FlexibleInstances #-}\n{-# language TypeFamilies #-}\n{-# language DataKinds #-}\n{-# language TypeApplications #-} -- for the Proxy\n\nimport Text.ParserCombinators.ReadP (ReadP,readP_to_S)\nimport Text.ParserCombinators.ReadPrec (readPrec_to_P)\nimport Text.Read (readPrec)\nimport Data.Proxy\nimport qualified GHC.Generics as GHC\nimport Generics.SOP\n</code></pre>\n\n<p>We define a typeclass that can produce an <code>Applicative</code> parser for each of its instances. Here we define only the instances for <code>Int</code> and <code>Bool</code>:</p>\n\n<pre><code>class HasSimpleParser c where\n    getSimpleParser :: ReadP c\n\ninstance HasSimpleParser Int where\n    getSimpleParser = readPrec_to_P readPrec 0\n\ninstance HasSimpleParser Bool where\n    getSimpleParser = readPrec_to_P readPrec 0\n</code></pre>\n\n<p>Now we define a generic parser for records in which every field has a <code>HasSimpleParser</code> instance:</p>\n\n<pre><code>recParser :: (Generic r, Code r ~ '[xs], All HasSimpleParser xs) =&gt; ReadP r\nrecParser = to . SOP . Z &lt;$&gt; hsequence (hcpure (Proxy @HasSimpleParser) getSimpleParser)\n</code></pre>\n\n<p>The <code>Code r ~ '[xs], All HasSimpleParser xs</code> constraint means \"this type has only one constructor, the list of field types is <code>xs</code>, and all the field types have <code>HasSimpleParser</code> instances\".</p>\n\n<p><a href=\"http://hackage.haskell.org/package/generics-sop-0.2.4.0/docs/Generics-SOP.html#v:hcpure\" rel=\"nofollow noreferrer\"><code>hcpure</code></a> constructs an n-ary product (<a href=\"http://hackage.haskell.org/package/generics-sop-0.2.4.0/docs/Generics-SOP.html#t:NP\" rel=\"nofollow noreferrer\"><code>NP</code></a>) where each component is a parser for the corresponding field of <code>r</code>. (<code>NP</code> products wrap each component in a type constructor, which in our case is the parser type <code>ReadP</code>).</p>\n\n<p>Then we use <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.4.0/docs/Generics-SOP.html#v:hsequence\" rel=\"nofollow noreferrer\"><code>hsequence</code></a> to turn a n-ary product of parsers into the parser of an n-ary product.</p>\n\n<p>Finally, we fmap into the resulting parser and turn the n-ary product back into the original <code>r</code> record using <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.4.0/docs/Generics-SOP.html#v:to\" rel=\"nofollow noreferrer\"><code>to</code></a>. The <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.4.0/docs/Generics-SOP.html#t:NS\" rel=\"nofollow noreferrer\"><code>Z</code></a> and <a href=\"http://hackage.haskell.org/package/generics-sop-0.2.4.0/docs/Generics-SOP.html#t:SOP\" rel=\"nofollow noreferrer\"><code>SOP</code></a> constructors are required for turning the n-ary product into the sum-of-products the <code>to</code> function expects.</p>\n\n<hr>\n\n<p>Ok, let's define an example record and make it an instance of <code>Generics.SOP.Generic</code>:</p>\n\n<pre><code>data Foo = Foo { x :: Int, y :: Bool } deriving (Show, GHC.Generic)\n\ninstance Generic Foo -- Generic from generics-sop\n</code></pre>\n\n<p>Let's check if we can parse <code>Foo</code> with <code>recParser</code>:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    print $ readP_to_S (recParser @Foo) \"55False\"\n</code></pre>\n\n<p>The result is</p>\n\n<pre><code>[(Foo {x = 55, y = False},\"\")]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 4, "last_activity_date": 1488573946, "last_edit_date": 1488573946, "creation_date": 1488566327, "answer_id": 42586193, "question_id": 42583838, "link": "https://stackoverflow.com/questions/42583838/generically-build-parsers-from-custom-data-types/42586193#42586193", "title": "(Generically) Build Parsers from custom data types?", "body": "<p>You can write your own parser - but there is already a package that can do the parsing for you: <a href=\"https://hackage.haskell.org/package/cassava\" rel=\"nofollow noreferrer\">cassava</a> and while SO is usually not a place to search for library recommendations, I want to include this answer for people looking for a solution, but not having the time to implement this themselves and looking for a solution that works out of the box.</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Data.Csv\nimport Data.Vector\nimport Data.ByteString.Lazy as B\nimport GHC.Generics\n\ndata Person = P { personId :: Int\n                , firstName :: String\n                , lastName :: String\n                } deriving (Eq, Generic, Show)\n\n -- the following are provided by friendly neighborhood Generic\ninstance FromRecord Person\ninstance ToRecord Person\n\nmain :: IO ()\nmain = do B.writeFile \"test\" \"1\\NULThomas\\NULof Aquin\"\n          Right thomas &lt;- decodeWith (DecodeOptions 0) NoHeader &lt;$&gt; \n                              B.readFile \"test\"\n\n          print (thomas :: Vector Person)\n</code></pre>\n\n<p>Basically cassava allows you to parse all X-separated structures into a <code>Vector</code>, provided you can write down a <code>FromRecord</code> instance (which needs a <code>parseRecord :: Parser \u2026</code> function to work.</p>\n\n<p>Side note on <code>Generic</code> until recently I thought - EVERYTHING - in haskell has a Generic instance, or can derive one. Well this is not the case I wanted to serialize some <code>ThreadId</code> to CSV/JSON and happened to find out unboxed types are not so easily \"genericked\"!</p>\n\n<p>And before I forget it - when you speak of streaming and server and so on there is <a href=\"https://github.com/domdere/cassava-conduit\" rel=\"nofollow noreferrer\">cassava-conduit</a> that might be of help.</p>\n"}], "owner": {"reputation": 447, "user_id": 2812201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a5900e009117b30b90fb5bce64d6fd8e?s=128&d=identicon&r=PG&f=1", "display_name": "user2812201", "link": "https://stackoverflow.com/users/2812201/user2812201"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1488722871, "creation_date": 1488558250, "question_id": 42583838, "link": "https://stackoverflow.com/questions/42583838/generically-build-parsers-from-custom-data-types", "title": "(Generically) Build Parsers from custom data types?", "body": "<p>I'm working on a network streaming client that needs to talk to the server. The server encodes the responses in bytestrings, for example, \"1\\NULJohn\\NULTeddy\\NUL501\\NUL\", where '\\NUL' is the separator. The above response translates to \"This is a message of type 1(hard coded by the server), which tells the client what the ID of a user is(here, the user id of \"John Teddy\" is \"501\").</p>\n\n<p>So naively I define a custom data type</p>\n\n<pre><code>data User\n  { firstName :: String\n  , lastName :: String\n  , id :: Int\n  }\n</code></pre>\n\n<p>and a parser for this data type</p>\n\n<pre><code>parseID :: Parser User\nparseID = ...\n</code></pre>\n\n<p>Then one just writes a handler to do some job(e.g., write to a database) after the parser succesfully mathes a response like this. This is very straightforward. </p>\n\n<p>However, the server has almost 100 types of different responses like this that the client needs to parse. I suspect that there must be a much more elegant way to do the job rather than writing 100 almost identical parsers like this, because, after all, all haksell coders are lazy. I am a total newbie to generic programming so can some one tell me if there is a package that can do this job?</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488570360, "post_id": 42583263, "comment_id": 72306567, "body": "If you mean shared across all calls of <code>toTF</code>, everywhere, then you can&#39;t (except perhaps by changing <code>TFSig</code> to <code>type TFSig s i o = IO (...)</code>, but I suspect this isn&#39;t what you want). If you mean shared across all the same invocations within a single token stream, then you must implement this sharing in the function which consumes the entire token stream, not in the function consuming a single token. But there isn&#39;t nearly enough information here about the types involved even to determine how you are consuming the entire token stream, let alone how to implement sharing in that function."}, {"owner": {"reputation": 381, "user_id": 6162031, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c2087196e379c933f145a94453e5e592?s=128&d=identicon&r=PG&f=1", "display_name": "MLev", "link": "https://stackoverflow.com/users/6162031/mlev"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488817756, "post_id": 42583263, "comment_id": 72389293, "body": "Thanks for the feedback!"}], "answers": [{"tags": [], "owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "is_accepted": true, "score": 3, "last_activity_date": 1488570959, "creation_date": 1488570959, "answer_id": 42587368, "question_id": 42583263, "link": "https://stackoverflow.com/questions/42583263/memoization-of-intermediate-values-in-a-typeclass-instance/42587368#42587368", "title": "Memoization of Intermediate Values In a Typeclass Instance", "body": "<p>In general, this will be difficult to do.</p>\n\n<p>One possibility is to refactor your type class so that it provides a single memo trie with no arguments, that lazy contains the results of all possible tokens. You could use something like <a href=\"https://hackage.haskell.org/package/MemoTrie\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/MemoTrie</a> for this purpose. But this assumes that you can actually treat <code>ctx</code> as a domain in a map, which may not be possible.</p>\n"}], "owner": {"reputation": 381, "user_id": 6162031, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c2087196e379c933f145a94453e5e592?s=128&d=identicon&r=PG&f=1", "display_name": "MLev", "link": "https://stackoverflow.com/users/6162031/mlev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 42587368, "answer_count": 1, "score": 0, "last_activity_date": 1488570959, "creation_date": 1488556491, "question_id": 42583263, "link": "https://stackoverflow.com/questions/42583263/memoization-of-intermediate-values-in-a-typeclass-instance", "title": "Memoization of Intermediate Values In a Typeclass Instance", "body": "<p>I have the following function toTF that, given some context and an item, gives back a function that consumes a piece of input, an input state and produces the next state:</p>\n\n<pre><code>class TFSource s' where\n    type S s' :: *\n    type I s' :: *\n    type O s' :: *\n    toTF :: Context -&gt; s' -&gt; TFSig (S s') (I s') (O s')\n\ntype TFSig s i o = [i] -&gt; s -&gt; Output s i o\n</code></pre>\n\n<p>The instance of this stuff for Token, which I am trying to implement, produces a function that applies the recognizers for the literal value of the token, its stem and part of speech, and, if all is well, accepts this token, otherwise fails.</p>\n\n<p>Here is my attempted instance declaration:</p>\n\n<pre><code>instance TFSource Token where\n    toTF ctx (Token literal stem) = f\n        where (litTF, stemTF) = (toTF ctx literal, toTF ctx stem)\n              f (InputToken { .. } : ts) s = ... some computation ...\n              f [] _ = Fail\n</code></pre>\n\n<p>How can I make sure that litTF and stemTF are shared (memoized?) across calls to toTF with the same values for ctx and the token?</p>\n"}, {"tags": ["shell", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "edited": false, "score": 0, "creation_date": 1488551854, "post_id": 42581582, "comment_id": 72295542, "body": "Good clarification. Is there any easy way to make optparse interpret the &quot;\\n&quot; given as command line argument as a newline character?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "edited": false, "score": 0, "creation_date": 1488552541, "post_id": 42581582, "comment_id": 72296013, "body": "@GuillaumeCh&#233;rel You&#39;d have to do that yourself and implement your own escape syntax."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 5, "last_activity_date": 1488551687, "creation_date": 1488551687, "answer_id": 42581582, "question_id": 42581059, "link": "https://stackoverflow.com/questions/42581059/read-newline-character-from-command-line-arguments-with-optparse-applicative/42581582#42581582", "title": "Read newline character from command line arguments with optparse-applicative", "body": "<p>The problem is not that the newline character is escaped; the problem is that you don't have a newline character in the first place.</p>\n\n<p>As far as the shell is concerned, <code>'\\n'</code> is literally a two-character string (backslash, n), and that's what gets passed to your program.</p>\n\n<p>How to pass a literal newline character on the command line depends on your shell, but try the following:</p>\n\n<pre><code>$ ./myProg -a '\n&gt; '\n</code></pre>\n\n<p>(The <code>&gt;</code> in there is a secondary shell prompt. What you type is <kbd>'</kbd> <kbd>Return</kbd> <kbd>'</kbd>.)</p>\n\n<p>Or in bash:</p>\n\n<pre><code>$ ./myProg -a $'\\n'\n</code></pre>\n"}], "owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 42581582, "answer_count": 1, "score": 1, "last_activity_date": 1488551694, "creation_date": 1488550191, "last_edit_date": 1488551694, "question_id": 42581059, "link": "https://stackoverflow.com/questions/42581059/read-newline-character-from-command-line-arguments-with-optparse-applicative", "title": "Read newline character from command line arguments with optparse-applicative", "body": "<p>Below is an example of a program which takes one optional argument <code>a</code> which has as default value the newline character. The program only prints the value of the sole argument. Thus, calling the program with no argument or with <code>-a '\\n'</code> should give the same value, but it doesn't:</p>\n\n<pre><code>$ ./myProg\n\n\n$ ./myProg -a '\\n'\n\\n\n</code></pre>\n\n<p>The problem is that when it's read from the command line arguments, the newline character is escaped. Is it possible to make the two calls behave the same?</p>\n\n<pre><code>import Options.Applicative\n\ndata Options = Options String\n\noptsParser :: Parser Options\noptsParser = Options\n    &lt;$&gt; strOption\n         ( short 'a'\n        &lt;&gt; metavar \"A\"\n        &lt;&gt; value \"\\n\" )\n\nopts :: IO Options\nopts = execParser $ info (helper &lt;*&gt; optsParser) ( fullDesc )\n\nmain = do\n    Options a &lt;- opts\n    putStrLn $ a\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 4014, "user_id": 239117, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/f6WTW.jpg?s=128&g=1", "display_name": "watain", "link": "https://stackoverflow.com/users/239117/watain"}, "edited": false, "score": 1, "creation_date": 1488546449, "post_id": 42579475, "comment_id": 72291848, "body": "Thanks a lot, it works perfectly. What exactly is the string &quot;entry body&quot; for?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 4014, "user_id": 239117, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/f6WTW.jpg?s=128&g=1", "display_name": "watain", "link": "https://stackoverflow.com/users/239117/watain"}, "edited": false, "score": 3, "creation_date": 1488547126, "post_id": 42579475, "comment_id": 72292399, "body": "@watain It&#39;s the argument to pass to <code>typeMismatch</code> if you apply the given function is applied to a value of the wrong type."}, {"owner": {"reputation": 144, "user_id": 6844896, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mmQx5QYVBG0/AAAAAAAAAAI/AAAAAAAACPI/XmWi8zLqUQw/photo.jpg?sz=128", "display_name": "rlefevre", "link": "https://stackoverflow.com/users/6844896/rlefevre"}, "edited": false, "score": 0, "creation_date": 1536071694, "post_id": 42579475, "comment_id": 91287575, "body": "Using this exact example, including the language extensions, with ghc-8.4.3 and aeson-1.3.1.1, I get an &quot;Overlapping instances for FromJSON [Entry]&quot;. Has something changed?"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 144, "user_id": 6844896, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mmQx5QYVBG0/AAAAAAAAAAI/AAAAAAAACPI/XmWi8zLqUQw/photo.jpg?sz=128", "display_name": "rlefevre", "link": "https://stackoverflow.com/users/6844896/rlefevre"}, "edited": false, "score": 0, "creation_date": 1540588564, "post_id": 42579475, "comment_id": 92936356, "body": "@rlefevre I think GHC 7 used to accept the overlapping instance without requiring an <code>{-# OVERLAPPING #-}</code> pragma, whereas GHC 8 is more strict and requires it."}], "tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 6, "last_activity_date": 1488545774, "creation_date": 1488545774, "answer_id": 42579475, "question_id": 42578331, "link": "https://stackoverflow.com/questions/42578331/aeson-parse-json-with-unknown-key-in-haskell/42579475#42579475", "title": "Aeson: parse JSON with unknown key in Haskell", "body": "<p>This should work:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, OverloadedStrings #-}\n\nimport Data.Aeson\nimport Data.Aeson.Types\nimport Data.HashMap.Strict\n\ndata Entry = Entry\n  { id :: String\n  , name :: String\n  , location :: String\n  }\n  deriving Show\n\ninstance FromJSON [Entry] where\n  parseJSON x =\n    parseJSON x &gt;&gt;= mapM parseEntry . toList\n\nparseEntry :: (String, Value) -&gt; Parser Entry\nparseEntry (i, v) =\n  withObject \"entry body\" (\\ o -&gt;\n    Entry i &lt;$&gt; o .: \"name\" &lt;*&gt; o .: \"location\")\n    v\n</code></pre>\n\n<p>Considering the way you want to parse entries,\nyou cannot really parse single entries, only\nseveral at once, because you need the outer object structure.</p>\n\n<p>The JSON parser for <code>[Entry]</code> then proceeds by first parsing the outer\nobject as a hashmap and turning that into a list of pairs using <code>toList</code>,\nthen processing each resulting <code>(String, Value)</code> pair with <code>parseEntry</code>.</p>\n"}], "owner": {"reputation": 4014, "user_id": 239117, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/f6WTW.jpg?s=128&g=1", "display_name": "watain", "link": "https://stackoverflow.com/users/239117/watain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 684, "favorite_count": 1, "accepted_answer_id": 42579475, "answer_count": 1, "score": 2, "last_activity_date": 1488545774, "creation_date": 1488542339, "last_edit_date": 1488542689, "question_id": 42578331, "link": "https://stackoverflow.com/questions/42578331/aeson-parse-json-with-unknown-key-in-haskell", "title": "Aeson: parse JSON with unknown key in Haskell", "body": "<p>I would like to parse the following JSON using Aeson in Haskell:</p>\n\n<pre><code>{\n    \"foo\": {\n        \"name\": \"name 1\",\n        \"location\": \"location 1\"\n    },\n    \"bar\": {\n        \"name\": \"name 2\",\n        \"location\": \"location 2\"\n    }\n}\n</code></pre>\n\n<p>The keys <code>name</code> and <code>location</code> are known, but <code>foo</code> and <code>bar</code> are unknown.</p>\n\n<p>I would like to load the JSON data as a list of the following data type (<code>[Entry]</code>):</p>\n\n<pre><code>data Entry = Entry\n        { id :: String       -- \"foo\" or \"bar\" etc.\n        , name :: String     -- \"name 1\" or \"name 2\" etc.\n        , location :: String -- \"location 1\" or \"location 2\" etc.\n        } deriving Show\n</code></pre>\n\n<p>My first try looks as follows (it does not work, yet):</p>\n\n<pre><code>instance FromJSON Entry where\n        parseJSON (Object o) = do\n                map (\\(id, (name, location)) -&gt; Entry id name location) o\n                parseJSON o\n</code></pre>\n\n<p>How would I parse the JSON correctly?</p>\n"}, {"tags": ["haskell", "types", "monads"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1488538610, "creation_date": 1488538610, "answer_id": 42577029, "question_id": 42576886, "link": "https://stackoverflow.com/questions/42576886/explicitly-specifying-the-return-type-of-a-class-method/42577029#42577029", "title": "Explicitly specifying the return type of a class method?", "body": "<p>Annotate the full call to <code>t</code>:</p>\n\n<pre><code>print (t 22 :: Maybe Int)\n</code></pre>\n\n<p>or annotate <code>t</code> itself</p>\n\n<pre><code>print $ (t :: Int -&gt; Maybe Int) 22\n</code></pre>\n\n<p>As a more advanced alternative, with the proper extensions on, one can pass the type level arguments explicitly</p>\n\n<pre><code>print $ t @Maybe @Int 22\n</code></pre>\n\n<p>depending on the class at hand, this may save you to type a very long annotation.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 1, "accepted_answer_id": 42577029, "answer_count": 1, "score": 1, "last_activity_date": 1488538610, "creation_date": 1488538174, "question_id": 42576886, "link": "https://stackoverflow.com/questions/42576886/explicitly-specifying-the-return-type-of-a-class-method", "title": "Explicitly specifying the return type of a class method?", "body": "<p>Consider the below:</p>\n\n<pre><code>class Test m a where\n   t :: Int -&gt; m a\n\ninstance Test [] Int where\n   t i = [i]\n\ninstance Test Maybe Int where\n   t i | i == 0   = Nothing\n       | otherwise = Just i\n\nmain = do \n  print $ t (22 :: Int) --Error! \n</code></pre>\n\n<p>This will throw with the following error: </p>\n\n<pre><code>Ambiguous type variables \u2018m0\u2019, \u2018a0\u2019 arising from a use of \u2018print\u2019\n  prevents the constraint \u2018(Show (m0 a0))\u2019 from being solved.\n</code></pre>\n\n<p>This is due to the fact the compiler has no way of identifying what instance of <code>m a</code> to use. How can I explicitly state this? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 1, "creation_date": 1488530311, "post_id": 42573862, "comment_id": 72281353, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/4557394/how-do-you-use-the-bounded-typeclass-in-haskell-to-define-a-type-with-a-floating\">How do you use the Bounded typeclass in Haskell to define a type with a floating point range?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 835, "user_id": 6301341, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/bb987d3e8cfa45185a84db4232af8312?s=128&d=identicon&r=PG&f=1", "display_name": "jyet", "link": "https://stackoverflow.com/users/6301341/jyet"}, "edited": false, "score": 0, "creation_date": 1488532154, "post_id": 42574167, "comment_id": 72282430, "body": "This make sense, also why does adding <code>(127 :: Int8) + (10 :: Int8)</code> results in negative value?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 835, "user_id": 6301341, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/bb987d3e8cfa45185a84db4232af8312?s=128&d=identicon&r=PG&f=1", "display_name": "jyet", "link": "https://stackoverflow.com/users/6301341/jyet"}, "edited": false, "score": 4, "creation_date": 1488533409, "post_id": 42574167, "comment_id": 72283236, "body": "@jyet Because of overflow: <code>Int8</code> goes from -128 to 127. When you compute 127+1 you get -128. Basically, 256 is added/subtracted to the result as many times as needed to fit in the range. This happens with any fixed-bound integer type, in almost any programming language."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1570347391, "last_edit_date": 1570347391, "creation_date": 1488530386, "answer_id": 42574167, "question_id": 42573862, "link": "https://stackoverflow.com/questions/42573862/how-does-bounded-typeclass-works-for-custom-datatype/42574167#42574167", "title": "How does Bounded typeclass works for custom datatype?", "body": "<p><code>Bounded</code> does not affect arithmetical operations, it only provides for two constants <code>minBound, maxBound</code>. Whoever writes the <code>Bounded</code> instance is expected to define there the bounds for the values which can be represented inside the type. </p>\n\n<p>If you want to restrict arithmetics with an error, define your own <code>Num</code> instance.</p>\n\n<pre><code>instance Num Boost where\n   (Boost a) + (Boost b) | 0 &lt;= a+b &amp;&amp; a+b &lt; 8 = Boost (a+b)\n                         | otherwise = error \"out of range\"\n   -- other operations here\n</code></pre>\n"}], "owner": {"reputation": 835, "user_id": 6301341, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/bb987d3e8cfa45185a84db4232af8312?s=128&d=identicon&r=PG&f=1", "display_name": "jyet", "link": "https://stackoverflow.com/users/6301341/jyet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 42574167, "answer_count": 1, "score": 3, "last_activity_date": 1570347391, "creation_date": 1488529310, "question_id": 42573862, "link": "https://stackoverflow.com/questions/42573862/how-does-bounded-typeclass-works-for-custom-datatype", "title": "How does Bounded typeclass works for custom datatype?", "body": "<p>For Int8, the bounded range is </p>\n\n<pre><code>minBound :: Int8 -- -128\nmaxBound :: Int8 -- 127\n</code></pre>\n\n<p>If I add two Int8 integers</p>\n\n<pre><code>(127 :: Int8) + (10 :: Int8) --  -119\n</code></pre>\n\n<p>Why does it not show out of bound error instead?</p>\n\n<p>If I create a datatype and add an instance of Bounded:</p>\n\n<pre><code>newtype Boost = Boost Int\n    deriving (Eq, Show)\n\ninstance Num Boost where\n    (Boost a) + (Boost b) = Boost (a+b)\n\ninstance Bounded Boost where\n    minBound = Boost 1\n    maxBound = Boost 10\n\n(Boost 10) + (Boost 12) -- Boost 22\n</code></pre>\n\n<p>Clearly it did not behave like the Int8, So how can I make a bounded instance for my custom datatype?</p>\n"}, {"tags": ["haskell", "ambiguous-type-variable"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 6, "creation_date": 1488524834, "post_id": 42572673, "comment_id": 72278589, "body": "No types satisfy <code>(Fractional a, Integral a)</code>. You want to drop the <code>Fractional</code> and use <code>`div`</code> instead of <code>&#47;</code>"}, {"owner": {"reputation": 13568, "user_id": 33404, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fuBWU.jpg?s=128&g=1", "display_name": "urig", "link": "https://stackoverflow.com/users/33404/urig"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1488544190, "post_id": 42572673, "comment_id": 72290321, "body": "Thank you - that works and I&#39;ve learned something new. Would you like to post an answer so I can accept it?"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 1, "creation_date": 1488580513, "post_id": 42572673, "comment_id": 72311482, "body": "I suggest using a more specific type: <code>Int -&gt; Int</code>."}], "answers": [{"tags": [], "owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "is_accepted": true, "score": 1, "last_activity_date": 1488655166, "creation_date": 1488655166, "answer_id": 42600255, "question_id": 42572673, "link": "https://stackoverflow.com/questions/42572673/ambiguous-type-variable-a0-arising-from-a-use-of-print/42600255#42600255", "title": "Ambiguous type variable `a0&#39; arising from a use of `print&#39;?", "body": "<p>I believe Collatz sequence is an integer sequence, so it wouldn't be necessary making the result Fractional.</p>\n\n<pre><code>next :: (Integral a) =&gt; a -&gt; a\n</code></pre>\n\n<p>To be able to get an integer from a division, you should use <code>div</code> function. Note that division will always be exact as you are going to divide only even numbers:</p>\n\n<pre><code>next x\n    | odd x = x * 3 + 1\n    | otherwise = x `div` 2\n</code></pre>\n"}], "owner": {"reputation": 13568, "user_id": 33404, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fuBWU.jpg?s=128&g=1", "display_name": "urig", "link": "https://stackoverflow.com/users/33404/urig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4300, "favorite_count": 0, "accepted_answer_id": 42600255, "answer_count": 1, "score": 1, "last_activity_date": 1602239768, "creation_date": 1488524697, "last_edit_date": 1602239768, "question_id": 42572673, "link": "https://stackoverflow.com/questions/42572673/ambiguous-type-variable-a0-arising-from-a-use-of-print", "title": "Ambiguous type variable `a0&#39; arising from a use of `print&#39;?", "body": "<p>While learning Haskell I'm trying to write a function that given a number will give its successor in a <a href=\"https://en.wikipedia.org/wiki/Collatz_conjecture\" rel=\"nofollow noreferrer\">Collatz sequence</a>:</p>\n\n<pre><code>next :: (Fractional a, Integral a) =&gt; a -&gt; a\nnext x\n    | odd x = x * 3 + 1\n    | otherwise = x / 2\n</code></pre>\n\n<p>When I run <code>next 7</code> I get:</p>\n\n<pre><code>&lt;interactive&gt;:150:1: error:\n* Ambiguous type variable `a0' arising from a use of `print'\n  prevents the constraint `(Show a0)' from being solved.\n  Probable fix: use a type annotation to specify what `a0' should be.\n  These potential instances exist:\n    instance Show Ordering -- Defined in `GHC.Show'\n    instance Show Integer -- Defined in `GHC.Show'\n    instance Show a =&gt; Show (Maybe a) -- Defined in `GHC.Show'\n    ...plus 22 others\n    ...plus 12 instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n* In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>Two questions:  </p>\n\n<ol>\n<li>Am I using the best class constraints in my signature?</li>\n<li>Assuming I am, how can I <code>show</code> the result of <code>next 7</code> ?</li>\n</ol>\n"}, {"tags": ["haskell", "type-constraints"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1488511832, "post_id": 42569784, "comment_id": 72274035, "body": "I think you may be interested in <a href=\"https://hackage.haskell.org/package/constraints-0.9/docs/Data-Constraint-Forall.html\" rel=\"nofollow noreferrer\">this</a>."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 6, "last_activity_date": 1488513794, "creation_date": 1488513794, "answer_id": 42570442, "question_id": 42569784, "link": "https://stackoverflow.com/questions/42569784/constraint-to-see-if-one-type-satisfies-another/42570442#42570442", "title": "Constraint to see if one type &quot;satisfies&quot; another", "body": "<p>The basic answer is no. Haskell's type system is <em>predicative</em>: a type variable can only be instantiated to a monotype. So if you had</p>\n\n<pre><code>class C t u\n</code></pre>\n\n<p>or</p>\n\n<pre><code>type family C t u\n</code></pre>\n\n<p>the <code>t</code> and <code>u</code> simply <em>can't</em> be instantiated to the polymorphic types you want to talk about.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 42570442, "answer_count": 1, "score": 2, "last_activity_date": 1488513794, "creation_date": 1488509525, "question_id": 42569784, "link": "https://stackoverflow.com/questions/42569784/constraint-to-see-if-one-type-satisfies-another", "title": "Constraint to see if one type &quot;satisfies&quot; another", "body": "<p>Is there a way to write a constraint:</p>\n\n<pre><code>C t1 t2 :: Constraint\n</code></pre>\n\n<p>Such that it \"satisfies\" (is that the right word) if <code>t2</code> matches against <code>t1</code>.</p>\n\n<p>For example:</p>\n\n<pre><code>C (forall a. Num a =&gt; a -&gt; a -&gt; a) (forall a. Num a =&gt; a -&gt; a -&gt; a) -- good\nC (forall a. Num a =&gt; a -&gt; a -&gt; a) (Int -&gt; Int -&gt; Int) -- good\nC (forall a. Num a =&gt; a -&gt; a -&gt; a) (Bool -&gt; Bool -&gt; Bool) -- fails\nC (Int -&gt; Int -&gt; Int) (forall a. Num a =&gt; a -&gt; a -&gt; a) -- fails\n</code></pre>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1488508431, "post_id": 42569216, "comment_id": 72273207, "body": "I&#39;m voting to close this question as off-topic because it&#39;s not a question anymore (OP figured it out)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1488511334, "post_id": 42569216, "comment_id": 72273910, "body": "Tail recursion is less important than guarded recursion in Haskell. <a href=\"https://wiki.haskell.org/Tail_recursion\" rel=\"nofollow noreferrer\">wiki.haskell.org/Tail_recursion</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488512336, "post_id": 42569216, "comment_id": 72274166, "body": "Also relevant: <a href=\"http://stackoverflow.com/q/13042353/2751851\"><i>Does Haskell have tail-recursive optimization?</i></a>"}, {"owner": {"reputation": 81, "user_id": 7586444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d33f9e15fcfce22ec47935ddeee0e90?s=128&d=identicon&r=PG&f=1", "display_name": "Anabra", "link": "https://stackoverflow.com/users/7586444/anabra"}, "edited": false, "score": 0, "creation_date": 1488532889, "post_id": 42569216, "comment_id": 72282892, "body": "You&#39;re right about guarded recursion, it would still work here because of the Cons ctor."}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 7586444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d33f9e15fcfce22ec47935ddeee0e90?s=128&d=identicon&r=PG&f=1", "display_name": "Anabra", "link": "https://stackoverflow.com/users/7586444/anabra"}, "is_accepted": true, "score": 3, "last_activity_date": 1488541148, "creation_date": 1488541148, "answer_id": 42577915, "question_id": 42569216, "link": "https://stackoverflow.com/questions/42569216/propagating-information-backwards-in-a-recursive-call/42577915#42577915", "title": "Propagating information backwards in a recursive call", "body": "<p>You can always use extra parameters, and return a tuple with the accumulated results. This way you still benefit from TCO, and get the information you needed.</p>\n\n<p>An example:</p>\n\n<pre><code>f :: [Int] -&gt; Bool -&gt; [Int] -&gt; (Bool, [Int])\nf (x:xs) l accum\n  | x `mod` 17 == 0 = (False, accum)\n  | otherwise       = f xs l ((x+1) : accum)\nf [] l accum = (True, accum)\n</code></pre>\n\n<p>Or in a more elegant way:</p>\n\n<pre><code>data CheckedValue a = Valid a | Invalid a\n  deriving Show\n\nf :: [Int] -&gt; [Int] -&gt; CheckedValue [Int]\nf (x:xs) accum\n  | x `mod` 17 == 0 = Invalid accum\n  | otherwise       = f xs ((x+1) : accum)\nf [] accum = Valid accum\n</code></pre>\n\n<p>Note: These functions also reverse the list, but pay no attention to that.</p>\n"}], "owner": {"reputation": 81, "user_id": 7586444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d33f9e15fcfce22ec47935ddeee0e90?s=128&d=identicon&r=PG&f=1", "display_name": "Anabra", "link": "https://stackoverflow.com/users/7586444/anabra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 42577915, "answer_count": 1, "score": 3, "last_activity_date": 1488541148, "creation_date": 1488505735, "last_edit_date": 1488536713, "question_id": 42569216, "link": "https://stackoverflow.com/questions/42569216/propagating-information-backwards-in-a-recursive-call", "title": "Propagating information backwards in a recursive call", "body": "<p>How can I propagate information backwards in a recursive call-chain?</p>\n\n<p>For example:</p>\n\n<pre><code>f :: [Int] -&gt; [Int]\nf (x:xs)\n  | x `mod` 17 = ...\n  | otherwise = (x + 1) : f xs\nf [] = []\n</code></pre>\n\n<p>I want to stop the evaluation at the ..., and I also want to propagate that information back to the caller (the fact that it stopped). I tried to use return types like Maybe, but then I had to pattern-match the recursive call, and thus lost tail-call optimization, since I had to evaluate it after the call returned (note: one could easily transform the above code to TR form, but I left it like this for easier understanding).</p>\n\n<p>Can you come up with a better solution that still benefits from TCO?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1488505516, "post_id": 42569089, "comment_id": 72272376, "body": "Why GADTs and not ADTs? Is <a href=\"https://hackage.haskell.org/package/template-haskell-2.11.1.0/docs/Language-Haskell-TH.html#g:17\" rel=\"nofollow noreferrer\"><code>template-haskell</code></a> what you are looking for?"}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1488506272, "post_id": 42569089, "comment_id": 72272567, "body": "I don&#39;t mind if it&#39;s a GADT or not, as long as I can do things like pretty print them etc."}], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 4, "last_activity_date": 1488507089, "creation_date": 1488507089, "answer_id": 42569411, "question_id": 42569089, "link": "https://stackoverflow.com/questions/42569089/haskell-data-type-that-represents-valid-types/42569411#42569411", "title": "Haskell data type that represents valid types", "body": "<p>You are looking for <a href=\"https://hackage.haskell.org/package/template-haskell-2.11.1.0/docs/Language-Haskell-TH.html#g:21\" rel=\"nofollow noreferrer\">the type-related ADTs in <code>template-haskell</code></a>. Note that <code>Type</code> is an instance of <a href=\"https://hackage.haskell.org/package/template-haskell-2.11.1.0/docs/Language-Haskell-TH.html#t:Ppr\" rel=\"nofollow noreferrer\"><code>Ppr</code></a>, which has the <code>ppr</code> pretty-print function.</p>\n\n<pre><code>ghci&gt; import Language.Haskell.TH\nghci&gt; :{\nghci&gt; x &lt;- runQ $ do\nghci|        a &lt;- newName \"a\"\nghci|        b &lt;- newName \"b\"\nghci|        pure $ ForallT [PlainTV a,PlainTV b] [AppT (ConT (mkName \"Num\")) (VarT a)] (AppT (AppT ArrowT (VarT a)) (AppT (AppT ArrowT (VarT b)) (VarT a)))\nghci| :}\nghci&gt; x\nForallT [PlainTV a_4,PlainTV b_5] [AppT (ConT Num) (VarT a_4)] (AppT (AppT ArrowT (VarT a_4)) (AppT (AppT ArrowT (VarT b_5)) (VarT a_4)))\nghci&gt; ppr x\nforall a_0 b_1 . Num a_0 =&gt; a_0 -&gt; b_1 -&gt; a_0\n</code></pre>\n\n<p>In fact, the <code>TemplateHaskell</code> language extension GHC has will make playing with this surprisingly easy. Instead of having to write out the <code>ForallT ...</code> stuff, I can just \"quote\" the type I am looking for</p>\n\n<pre><code>ghci&gt; :set -XTemplateHaskell -XExplicitForall\nghci&gt; x' &lt;- runQ [t| forall a b. Num a =&gt; a -&gt; b -&gt; a |]\n</code></pre>\n\n<p>And <code>x'</code> is the same as <code>x</code> (well maybe <code>a</code> and <code>b</code> end up being slightly different <code>Name</code>s, but still)!</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1488507089, "creation_date": 1488504859, "question_id": 42569089, "link": "https://stackoverflow.com/questions/42569089/haskell-data-type-that-represents-valid-types", "title": "Haskell data type that represents valid types", "body": "<p>Is there a library that defines a data type that defines valid Haskell types (presumably this would be a GADT).</p>\n\n<p>To explain, let me suggest what this might look like:</p>\n\n<pre><code>data A\ndata B\n\nclass Free t\ninstance Free A\ninstance Free B\n\nx = Forall A (Forall B (Constraint (NumConstraint A) \n      (Constructor Function A (Constructor Function B A))))\n</code></pre>\n\n<p>This would represent:</p>\n\n<pre><code>forall a b. Num a =&gt; a -&gt; b -&gt; a\n</code></pre>\n\n<p>I'm not saying what I've suggested is a good implementation, I'm just trying to show what I mean.</p>\n\n<p>Surely, if you can define the grammar of a type definition, you can create a GADT to represent it. Is there anything that already does this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1488495083, "post_id": 42567416, "comment_id": 72268914, "body": "hi - welcome to stackoverflow and haskell! Congratulations I think you are on the best way to discover the usefulness of <code>(&gt;&gt;=)</code> and the concept of monads see <a href=\"http://blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.html\" rel=\"nofollow noreferrer\">this blog post</a>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488495132, "post_id": 42567416, "comment_id": 72268943, "body": "also <code>sequence</code> or <code>traverse</code> = <code>mapM</code> might be useful"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1488495136, "post_id": 42567416, "comment_id": 72268946, "body": "<code>join . fmap sequence :: IO [IO a] -&gt; IO [a]</code> is pretty short. But it seems you just want, e.g. <code>mapM getConfigs</code>, to begin with."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 7648933, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-pLpgvitwJ1g/AAAAAAAAAAI/AAAAAAAASjM/rbG1gYOmmF8/photo.jpg?sz=128", "display_name": "Nathan Hemingway", "link": "https://stackoverflow.com/users/7648933/nathan-hemingway"}, "edited": false, "score": 0, "creation_date": 1488497105, "post_id": 42567659, "comment_id": 72269762, "body": "Thanks. Can&#39;t upvote you because I&#39;m too new to SO, but that was what I needed. I&#39;d read about mapM too, but didn&#39;t quite get my head around it. For anybody else that stumbles on this (need to reread it myself)...  <a href=\"http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html\" rel=\"nofollow noreferrer\">Monad tutorial in pictures</a>"}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": true, "score": 9, "last_activity_date": 1488495777, "creation_date": 1488495777, "answer_id": 42567659, "question_id": 42567416, "link": "https://stackoverflow.com/questions/42567416/idiomatic-way-to-handle-nested-io-in-haskell/42567659#42567659", "title": "Idiomatic way to handle nested IO in Haskell", "body": "<p>I think you want something like this for your <code>main</code>:</p>\n\n<pre><code>main = do\n    paths &lt;- getPaths \"./configs\"\n    flatConfigs &lt;- traverse getConfig paths\n    let blockConfigs = fmap chunk flatConfigs\n    -- Parse and do stuff with config data.\n    return ()\n</code></pre>\n\n<p>Compare </p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>and</p>\n\n<pre><code>traverse :: (Applicative f, Traversable t) =&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)\n</code></pre>\n\n<p>They are quite similar, but <code>traverse</code> lets you use effects like <code>IO</code>.</p>\n\n<p>Here are the types again specialized a little for comparison:</p>\n\n<pre><code>fmap     :: (a -&gt; b)    -&gt; [a] -&gt; [b]\ntraverse :: (a -&gt; IO b) -&gt; [a] -&gt; IO [b]\n</code></pre>\n\n<p>(<code>traverse</code> is also known as <code>mapM</code>)</p>\n"}, {"tags": [], "owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "is_accepted": false, "score": 5, "last_activity_date": 1488500317, "creation_date": 1488500317, "answer_id": 42568416, "question_id": 42567416, "link": "https://stackoverflow.com/questions/42567416/idiomatic-way-to-handle-nested-io-in-haskell/42568416#42568416", "title": "Idiomatic way to handle nested IO in Haskell", "body": "<p>Your idea of 'nestedness' is actually a pretty good insight into what monads are. Monads can be seen as Functors with two additional operations, return with type <code>a -&gt; m a</code> and join with type <code>m (m a) -&gt; m a</code>. We can then make functions of type <code>a -&gt; m b</code> composable:</p>\n\n<pre><code>fmap :: (a -&gt; m b) -&gt; m a -&gt; m (m b)\nf =&lt;&lt; v = join (fmap f v) :: (a -&gt; m b) -&gt; m a -&gt; m b\n</code></pre>\n\n<p>So we want to use join here but have <code>m [m a]</code> at the moment so our monad combinators won't help directly. Lets search for <code>m [m a] -&gt; m (m [a])</code> using <a href=\"https://www.haskell.org/hoogle/?hoogle=m%20%5Bm%20a%5D%20-%3E%20m%20%28m%20%5Ba%5D%29\" rel=\"noreferrer\">hoogle</a> and our first result looks promising. It is <code>sequence:: [m a] -&gt; m [a]</code>.<br>\nIf we look at the related function we also find <code>traverse :: (a -&gt; IO b) -&gt; [a] -&gt; IO [b]</code> which is similarly <code>sequence (fmap f v)</code>.</p>\n\n<p>Armed with that knowledge we can just write:</p>\n\n<pre><code>readConfigFiles path = traverse getConfig =&lt;&lt; getPaths path\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 7648933, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-pLpgvitwJ1g/AAAAAAAAAAI/AAAAAAAASjM/rbG1gYOmmF8/photo.jpg?sz=128", "display_name": "Nathan Hemingway", "link": "https://stackoverflow.com/users/7648933/nathan-hemingway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 701, "favorite_count": 0, "accepted_answer_id": 42567659, "answer_count": 2, "score": 10, "last_activity_date": 1488500317, "creation_date": 1488494670, "question_id": 42567416, "link": "https://stackoverflow.com/questions/42567416/idiomatic-way-to-handle-nested-io-in-haskell", "title": "Idiomatic way to handle nested IO in Haskell", "body": "<p>I'm learning Haskell, and writing a short parsing script as an exercise. Most of my script consists of pure functions, but I have two, nested IO components:</p>\n\n<ol>\n<li>Read a list of files from a path.</li>\n<li>Read the contents of each file, which, in turn, will be the input for most of the rest of the program.</li>\n</ol>\n\n<p>What I have works, but the nested IO and layers of fmap \"feel\" clunky, like I should either be avoiding nested IO (somehow), or more skillfully using do notation to avoid all the fmaps. I'm wondering if I'm over-complicating things, doing it wrong, etc. Here's some relevant code:</p>\n\n<pre><code>getPaths :: FilePath -&gt; IO [String]\ngetPaths folder = do\n    allFiles &lt;- listDirectory folder\n    let txtFiles = filter (isInfixOf \".txt\") allFiles\n        paths = map ((folder ++ \"/\") ++) txtFiles\n    return paths\n\ngetConfig :: FilePath -&gt; IO [String]\ngetConfig path = do\n    config &lt;- readFile path\n    return $ lines config\n\nmain = do\n    paths = getPaths \"./configs\"\n    let flatConfigs = map getConfigs paths\n        blockConfigs = map (fmap chunk) flatConfigs\n    -- Parse and do stuff with config data.\n    return\n</code></pre>\n\n<p>I end up dealing with <code>IO [IO String]</code> from using listDirectory as input for readFile. Not unmanageable, but if I use do notation to unwrap the <code>[IO String]</code> to send to some parser function, I still end up either using nested <code>fmap</code> or pollute my supposedly pure functions with IO awareness (fmap, etc). The latter seems worse, so I'm doing the former. Example:</p>\n\n<pre><code>type Block = [String]\ngetTrunkBlocks :: [Block] -&gt; [Block]\ngetTrunkBlocks = filter (liftM2 (&amp;&amp;) isInterface isMatchingInt)\n    where isMatchingInt line = isJust $ find predicate line\n          predicate = isInfixOf \"switchport mode trunk\"\n\nmain = do\n    paths &lt;- getPaths \"./configs\"\n    let flatConfigs = map getConfig paths\n        blockConfigs = map (fmap chunk) flatConfigs\n        trunks = fmap (fmap getTrunkBlocks) blockConfigs\n    return $ \"Trunk count: \" ++ show (length trunks)\n</code></pre>\n\n<p>fmap, fmap, fmap... I feel like I've inadvertently made this more complicated than necessary, and can't imagine how convoluted this could get if I had deeper IO nesting.</p>\n\n<p>Suggestions?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1488491724, "post_id": 42566673, "comment_id": 72267406, "body": "What do you think it should equal, and why?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1488491763, "post_id": 42566673, "comment_id": 72267425, "body": "You can compute it step by step, start by replacing <code>snd (a,b)</code> with <code>b</code>..."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1488491837, "post_id": 42566673, "comment_id": 72267455, "body": "Are you asking why it doesn&#39;t equal something else or why it doesn&#39;t produce an error?"}, {"owner": {"reputation": 10248, "user_id": 268396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4220afde4dd928ef33648797c7415ada?s=128&d=identicon&r=PG", "display_name": "user268396", "link": "https://stackoverflow.com/users/268396/user268396"}, "edited": false, "score": 1, "creation_date": 1488491841, "post_id": 42566673, "comment_id": 72267458, "body": "The <code>fst</code> and <code>snd</code> do not need to evaluate the <code>let</code> expression or indeed any value for <code>x</code> at all in order to produce their result."}], "answers": [{"tags": [], "owner": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "is_accepted": false, "score": 3, "last_activity_date": 1488493081, "last_edit_date": 1488493081, "creation_date": 1488491952, "answer_id": 42566824, "question_id": 42566673, "link": "https://stackoverflow.com/questions/42566673/why-does-let-x-x3-in-fst-snd-x1-5-x-2-equal-5/42566824#42566824", "title": "Why does (let x = x+3 in fst (snd (x+1,(5,x-2)))) equal 5", "body": "<p><code>snd(x+1,(5,x-2))</code> equals to <code>(5,x-2)</code>, then <code>fst(5,x-2)</code>equals to <code>5</code>. All of this doesn't require any evaluation of expression containing <code>x</code> (Haskell is lazy, means that it evaluates things only when needed).</p>\n"}, {"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 7, "last_activity_date": 1488492123, "creation_date": 1488492123, "answer_id": 42566873, "question_id": 42566673, "link": "https://stackoverflow.com/questions/42566673/why-does-let-x-x3-in-fst-snd-x1-5-x-2-equal-5/42566873#42566873", "title": "Why does (let x = x+3 in fst (snd (x+1,(5,x-2)))) equal 5", "body": "<p>Let's ignore the <code>let x = x + 3 in</code> part for now and focus on what comes after the <code>in</code>:</p>\n\n<pre><code>fst (snd (x + 1, (5, x - 2)))\n</code></pre>\n\n<p>With the definitions of <code>fst</code> and <code>snd</code> being</p>\n\n<pre><code>fst (a, b) = a\nsnd (a, b) = b\n</code></pre>\n\n<p>So reducing what's in the parentheses first</p>\n\n<pre><code>snd (x + 1, (5, x - 2)) ==&gt; (5, x - 2)\n</code></pre>\n\n<p>Now this gets passed to <code>fst</code>:</p>\n\n<pre><code>fst (5, x - 2) ==&gt; 5\n</code></pre>\n\n<p>So in the end the value of <code>x</code> doesn't actually matter.</p>\n\n<p>This can happen in Haskell because of something called lazy evaluation.  Essentially, the compiler won't resolve a value until it's needed.  With the definition</p>\n\n<pre><code>x = x + 3\n</code></pre>\n\n<p>If you tried to print <code>x</code> you would get an infinite loop and probably an error at some point when you run out of memory trying to evaluate this.  Since the value of <code>x</code> is never actually printed out, the compiler is free to not resolve its value.  The value that is printed out to the console when you evaluate that expression in the REPL is 5, it has no dependencies on the value of <code>x</code>, so <code>x</code> can be safely ignored.</p>\n\n<p>Another example of where lazy programming comes in to play is the expression</p>\n\n<pre><code>&gt; let ones = 1:ones in take 5 ones\n[1,1,1,1,1]\n</code></pre>\n\n<p>The definition <code>let ones = 1:ones</code> defines an infinite list of 1s, but since we only grab 5 of them with <code>take 5 ones</code>, this expression is able to resolve.</p>\n"}], "owner": {"reputation": 53, "user_id": 6917543, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DWZQR.png?s=128&g=1", "display_name": "DrExpresso", "link": "https://stackoverflow.com/users/6917543/drexpresso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1488534840, "creation_date": 1488491406, "last_edit_date": 1488534840, "question_id": 42566673, "link": "https://stackoverflow.com/questions/42566673/why-does-let-x-x3-in-fst-snd-x1-5-x-2-equal-5", "title": "Why does (let x = x+3 in fst (snd (x+1,(5,x-2)))) equal 5", "body": "<p>Can someone explain to me why this equals 5?</p>\n\n<pre><code>let x = x+3 in fst (snd (x+1,(5,x-2)))\n</code></pre>\n"}, {"tags": ["loops", "haskell", "dictionary"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1488487235, "post_id": 42565394, "comment_id": 72264979, "body": "Why do you use a map for this? A map is for <i>looking up</i> values according to keys. If you just want to store / process <i>values and also keys</i>, why not just use a list of tuples? Looping over such a list is <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#v:forM_\" rel=\"nofollow noreferrer\">trivial</a>. (If a map is all you&#39;ve given, then just convert it to a tuple-list...)"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1488487332, "post_id": 42565394, "comment_id": 72265025, "body": "Why is that a <code>Map String String</code> instead of just a <code>[(String, String) ]</code>?"}, {"owner": {"reputation": 1436, "user_id": 331402, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/2e1a9840e3933650ab29f65e165233ed?s=128&d=identicon&r=PG", "display_name": "Icid", "link": "https://stackoverflow.com/users/331402/icid"}, "edited": false, "score": 0, "creation_date": 1488487653, "post_id": 42565394, "comment_id": 72265209, "body": "Check out <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"nofollow noreferrer\">learnyouahaskell.com/input-and-output</a>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1488488391, "post_id": 42565394, "comment_id": 72265598, "body": "one simple seed code is <code>sequence_ [print (k,v) | (k,v) &lt;- toList theMap]</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1488488816, "post_id": 42565394, "comment_id": 72265831, "body": "Convert the map to a list and then use a &quot;for loop&quot;: <code>forM_ (Map.toList m) $ \\(k,v) -&gt; do ...</code> from <code>Data.Foldable</code>"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1488489175, "post_id": 42565394, "comment_id": 72266022, "body": "<code>Data.Map.traverseWithKey</code> can be useful as well."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1488492134, "post_id": 42565394, "comment_id": 72267619, "body": "Why is everyone assuming &quot;map&quot; means <code>Data.Map.Map</code>?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1488558341, "post_id": 42565394, "comment_id": 72300098, "body": "@ReidBarton Because the word <code>map</code> is used to refer to a type of structure.  No, it is not a reasonable assumption given that the asker is a self-professed Haskell beginner."}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 3480820, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a5f1a937d12dbfcd7683f2e7a0efb7d8?s=128&d=identicon&r=PG&f=1", "display_name": "user3480820", "link": "https://stackoverflow.com/users/3480820/user3480820"}, "edited": false, "score": 0, "creation_date": 1488651939, "post_id": 42566616, "comment_id": 72330157, "body": "Haskell is not accepting m::Map String String as valid, I have tried m :: ([Char],[Char]) but that does not work either."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 53, "user_id": 3480820, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a5f1a937d12dbfcd7683f2e7a0efb7d8?s=128&d=identicon&r=PG&f=1", "display_name": "user3480820", "link": "https://stackoverflow.com/users/3480820/user3480820"}, "edited": false, "score": 0, "creation_date": 1488656557, "post_id": 42566616, "comment_id": 72331762, "body": "@user3480820 I suggest you post this issue as a separate question.  I don&#39;t know what code you are using, what compilation command you ran, or what &quot;not accepting&quot; really means here.  When you ask the next question please be sure to include the exact code you are using and the compiler error.  Notice the first code block in my answer is complete and should work fine if you copy and paste it into a <code>foo.hs</code> file and interpret or compile it with a reasonably recent version of <code>ghc</code>."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 8, "last_activity_date": 1488491246, "creation_date": 1488491246, "answer_id": 42566616, "question_id": 42565394, "link": "https://stackoverflow.com/questions/42565394/looping-through-a-map-data-structure-in-haskell/42566616#42566616", "title": "Looping through a map data structure in Haskell", "body": "<p>The issue with using <code>Map</code> in this manner is a lot of the traversals over <code>Map</code> values assume you don't care about the key and only care about the contained value.  There are traversals inside <code>Data.Map</code> that suffice, and @danidiaz has pointed on out, but it's totally reasonable to call <code>toList</code> since that list will be generated lazily, not forced into memory all at once.  Given a list of tuples (key, value) you can traverse that using <code>for</code> or <code>mapM</code> or <code>fmap</code> or .... basically any of the constructs you love so long as you can use an IO monad.</p>\n\n<pre><code>{-# LANGUAGE OverloadedLists #-}\nimport Data.Foldable (for_)\nimport Data.Map (Map,toList)\n\nm :: Map String String\nm = [(\"a\",\"1\"),(\"b\",\"2\")]\n\nmain =\n  for_ (toList m) $ \\(q,a) -&gt;\n    do putStrLn q\n       x &lt;- getLine\n       putStrLn (if x == a\n                    then \"Yes\"\n                    else \"No: \" ++ a)\n</code></pre>\n\n<p>EDIT: I feel compelled to add what most people would call more idiomatic Haskell using <code>mapM_</code>:</p>\n\n<pre><code>main :: IO ()\nmain = mapM_ ask (toList m)\n\nask :: (String,String) -&gt; IO ()\nask (q,a) = do putStrLn q\n               x &lt;- getLine\n               putStrLn (if x == a then \"Yes\" else \"No: \" ++ a)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 2, "last_activity_date": 1488493685, "creation_date": 1488493685, "answer_id": 42567212, "question_id": 42565394, "link": "https://stackoverflow.com/questions/42565394/looping-through-a-map-data-structure-in-haskell/42567212#42567212", "title": "Looping through a map data structure in Haskell", "body": "<p><code>lens</code>'s <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Indexed.html#v:ifor_\" rel=\"nofollow noreferrer\"><code>ifor_</code> combinator</a> allows you to write @ThomasM.DuBuisson's code without going via <code>toList</code>. The traversal function gets access to the index at each iteration.</p>\n\n<pre><code>main = ifor_ m $ \\(q, a) -&gt; do\n    putStrLn q\n    x &lt;- getLine\n    putStrLn (if x == a then \"Yes\" else \"No: \" ++ a)\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 3480820, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a5f1a937d12dbfcd7683f2e7a0efb7d8?s=128&d=identicon&r=PG&f=1", "display_name": "user3480820", "link": "https://stackoverflow.com/users/3480820/user3480820"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2397, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1488493685, "creation_date": 1488486781, "question_id": 42565394, "link": "https://stackoverflow.com/questions/42565394/looping-through-a-map-data-structure-in-haskell", "title": "Looping through a map data structure in Haskell", "body": "<p>I have a map data structure that has the following structure:-\n\"What is the capital of UK\"-> \"London\"\n\"What is the capital of France\"-> \"Paris\"\nI want to loop through this map displaying the question: \"What is the capital of UK\", asking for user input. If the user answers \"London\" I print correct, otherwise, I print the correct answer \"London\". This is easy in an imperative language like C# but I haven't figured how to do it in Haskell.</p>\n"}, {"tags": ["windows", "haskell", "cabal", "haskell-platform"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 1, "creation_date": 1488484265, "post_id": 42564296, "comment_id": 72263269, "body": "Just looking through the output here it looks like the problem is between <code>hfmt</code> requiring <code>stylish-haskell ==0.5.*</code>, and the <code>stylish-haskell 0.5.*</code> requiring <code>directory &lt;1.3</code> but <code>directory 1.3.0.0</code> is installed. Possibly a similar issue with <code>bytestring &lt;0.10</code>. Could you try perhaps a <code>cabal sandbox init</code> and then retry? Maybe that would allow the <code>directory</code> and <code>bytestring</code> versions to be resolved. I&#39;m no expert with Cabal though and have never encountered this issue before."}, {"owner": {"reputation": 25603, "user_id": 45843, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/55f76441107f14055f95e08bb7bd01df?s=128&d=identicon&r=PG&f=1", "display_name": "rwallace", "link": "https://stackoverflow.com/users/45843/rwallace"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1488484992, "post_id": 42564296, "comment_id": 72263628, "body": "@ryachza Tried that, same result."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 1, "creation_date": 1488486649, "post_id": 42564296, "comment_id": 72264653, "body": "Interesting. I was just able to install to a sandbox it seems to have worked with <code>hfmt-0.0.2.3</code> and <code>stylish-haskell-0.5.16</code>. Had you received a notice that Cabal was installing to a sandbox? What version of GHC/Cabal are you using? I currently have GHC 7.10.2 and Cabal 1.24.0.0."}, {"owner": {"reputation": 25603, "user_id": 45843, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/55f76441107f14055f95e08bb7bd01df?s=128&d=identicon&r=PG&f=1", "display_name": "rwallace", "link": "https://stackoverflow.com/users/45843/rwallace"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1488486860, "post_id": 42564296, "comment_id": 72264776, "body": "@ryachza I did receive the notice that it was installing to a sandbox, along with the same error message as before. I&#39;m using the latest version of Haskell downloaded this afternoon, which seems to be 8.0.2."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 1, "creation_date": 1488487359, "post_id": 42564296, "comment_id": 72265049, "body": "Sorry I couldn&#39;t help. Travis CI shows the build passing on 8.0.2 but that&#39;s on Linux. Had you used the Haskell Platform to install? I&#39;m thinking that&#39;s where the new versions of <code>bytestring</code> and <code>directory</code> might be coming from. Perhaps you could try just installing GHC and Cabal, or perhaps unregister some of the packages that are causing issues? I wouldn&#39;t unregister packages lightly, but you could take a look with <code>ghc-pkg list</code> at least."}, {"owner": {"reputation": 25603, "user_id": 45843, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/55f76441107f14055f95e08bb7bd01df?s=128&d=identicon&r=PG&f=1", "display_name": "rwallace", "link": "https://stackoverflow.com/users/45843/rwallace"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1488487600, "post_id": 42564296, "comment_id": 72265172, "body": "@ryachza I used the Haskell platform, yes. What you say sounds right; Haskell is probably just one of these tools that&#39;s for Unix, not Windows. Thank you for trying anyway."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1488487656, "post_id": 42564296, "comment_id": 72265211, "body": "Actually I think it&#39;s very specifically the <code>directory</code> version, which is preventing <code>stylish-haskell 0.5.16</code> from being considered, and that version accepts <code>bytestring</code> up to 0.11."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1488487661, "post_id": 42564296, "comment_id": 72265212, "body": "@ryachza <i>directory</i> and <i>bytestring</i> are bundled with GHC, so even in a sandbox cabal-install will still pick the globally installed versions. Option #4 in <a href=\"http://stackoverflow.com/a/27850571/2751851\">this answer</a> <i>might</i> work -- do note, though, that options #1 and #2 do not apply here (you really don&#39;t want to unregister <i>bytestring</i> and *directory from the global database), and that you should <b>never</b> use <code>--force-reinstalls</code> outside of a sandbox."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1488487793, "post_id": 42564296, "comment_id": 72265281, "body": "@rwallace I certainly understand your frustration, though I would disagree with Haskell/GHC being a Linux only tool. I have been using GHC professionally for years exclusively on Windows. I have definitely encountered some pain points (mostly with shared libraries and linking) but Cabal version resolution has never been one of them."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488487963, "post_id": 42564296, "comment_id": 72265370, "body": "@duplode Ah thank you I thought that a sandbox would allow everything outside <code>base</code> to be local."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1488487971, "post_id": 42564296, "comment_id": 72265374, "body": "@rwallace As ryachza points out, the issue in this specific question isn&#39;t a general problem with cabal-install, or with Haskell in Windows; it&#39;s just that the <i>hfmt</i> version in Hackage is too old relatively to your GHC version. Beyond getting it to build in a sandbox, as we are trying to do in this discussion, alternatives include using Stack (once you get it to work) to set up an isolated installation of an older GHC and getting the <i>hfmt</i> sources and attempting to update the required versions of its dependencies."}], "owner": {"reputation": 25603, "user_id": 45843, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/55f76441107f14055f95e08bb7bd01df?s=128&d=identicon&r=PG&f=1", "display_name": "rwallace", "link": "https://stackoverflow.com/users/45843/rwallace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1488482979, "creation_date": 1488482979, "question_id": 42564296, "link": "https://stackoverflow.com/questions/42564296/haskell-on-windows-cabal-fails", "title": "Haskell on Windows - Cabal fails", "body": "<p>Fresh install of Haskell on Windows, I just accepted the defaults in the installer, didn't touch anything, then tried to use cabal:</p>\n\n<pre><code>C:\\t&gt;cabal install hfmt\nWarning: The package list for 'hackage.haskell.org' does not exist. Run 'cabal\nupdate' to download it.\ncabal: There is no package named 'hfmt'.\nYou may need to run 'cabal update' to get the latest list of available\npackages.\n\nC:\\t&gt;cabal update\nDownloading the latest package list from hackage.haskell.org\n\nC:\\t&gt;cabal install hfmt\nResolving dependencies...\ncabal: Could not resolve dependencies:\ntrying: hfmt-0.0.2.3 (user goal)\ntrying: process-1.4.3.0/installed-1.4... (dependency of\noptparse-applicative-0.13.1.0)\ntrying: Win32-2.3.1.1/installed-2.3... (dependency of\nprocess-1.4.3.0/installed-1.4...)\nnext goal: stylish-haskell (dependency of hfmt-0.0.2.3)\nrejecting: stylish-haskell-0.7.1.0, stylish-haskell-0.7.0.0,\nstylish-haskell-0.6.5.0, stylish-haskell-0.6.4.0, stylish-haskell-0.6.3.0,\nstylish-haskell-0.6.2.0, stylish-haskell-0.6.1.0, stylish-haskell-0.6.0.0\n(conflict: hfmt =&gt; stylish-haskell&lt;0.6)\nrejecting: stylish-haskell-0.5.17.0, stylish-haskell-0.5.16.0,\nstylish-haskell-0.5.15.2, stylish-haskell-0.5.15.1, stylish-haskell-0.5.15.0,\nstylish-haskell-0.5.14.4, stylish-haskell-0.5.14.3, stylish-haskell-0.5.14.2,\nstylish-haskell-0.5.14.1, stylish-haskell-0.5.14.0, stylish-haskell-0.5.13.0,\nstylish-haskell-0.5.12.0, stylish-haskell-0.5.11.2, stylish-haskell-0.5.11.1,\nstylish-haskell-0.5.11.0, stylish-haskell-0.5.10.2, stylish-haskell-0.5.10.1,\nstylish-haskell-0.5.10.0, stylish-haskell-0.5.9.1, stylish-haskell-0.5.9.0,\nstylish-haskell-0.5.8.0, stylish-haskell-0.5.7.0, stylish-haskell-0.5.6.1,\nstylish-haskell-0.5.6.0, stylish-haskell-0.5.5.2, stylish-haskell-0.5.5.1,\nstylish-haskell-0.5.5.0, stylish-haskell-0.5.4.0, stylish-haskell-0.5.3.0,\nstylish-haskell-0.5.2.0, stylish-haskell-0.5.1.0 (conflict: process =&gt;\ndirectory==1.3.0.0/installed-1.3..., stylish-haskell =&gt; directory&gt;=1.1 &amp;&amp;\n&lt;1.3)\nrejecting: stylish-haskell-0.5.0.2, stylish-haskell-0.5.0.1,\nstylish-haskell-0.5.0.0 (conflict: Win32 =&gt;\nbytestring==0.10.8.1/installed-0.1..., stylish-haskell =&gt; bytestring&gt;=0.9 &amp;&amp;\n&lt;0.10)\nrejecting: stylish-haskell-0.4.0.0, stylish-haskell-0.3.2.0,\nstylish-haskell-0.3.1.0, stylish-haskell-0.3.0.0, stylish-haskell-0.2.0.2,\nstylish-haskell-0.2.0.1, stylish-haskell-0.2.0.0, stylish-haskell-0.1.1.0,\nstylish-haskell-0.1.0.0 (conflict: hfmt =&gt; stylish-haskell&gt;=0.5)\nBackjump limit reached (currently 2000, change with --max-backjumps or try to\nrun with --reorder-goals).\n</code></pre>\n\n<p>Tried rerunning that last command with <code>--max-backjumps=20000</code> and <code>--reorder-goals</code>, same result in both cases.</p>\n\n<p>Is there something I'm missing?</p>\n"}, {"tags": ["windows", "haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "edited": false, "score": 2, "creation_date": 1488477903, "post_id": 42562702, "comment_id": 72259474, "body": "Did you try to run cmd as Administrator? Even if you have write access to the folder, it might try to install some temporary files inside a system folder."}, {"owner": {"reputation": 25603, "user_id": 45843, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/55f76441107f14055f95e08bb7bd01df?s=128&d=identicon&r=PG&f=1", "display_name": "rwallace", "link": "https://stackoverflow.com/users/45843/rwallace"}, "reply_to_user": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "edited": false, "score": 0, "creation_date": 1488478084, "post_id": 42562702, "comment_id": 72259557, "body": "@Rakete1111 I didn&#39;t try to run as administrator. Are you sure it wouldn&#39;t have the result of letting it break something (modify a program folder in some weird way)?"}, {"owner": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "edited": false, "score": 1, "creation_date": 1488478428, "post_id": 42562702, "comment_id": 72259783, "body": "I honestly have no idea, I mean it shouldn&#39;t break your system, as I&#39;m pretty sure Stack isn&#39;t malicious :) But I can&#39;t guarantee anything..."}, {"owner": {"reputation": 25603, "user_id": 45843, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/55f76441107f14055f95e08bb7bd01df?s=128&d=identicon&r=PG&f=1", "display_name": "rwallace", "link": "https://stackoverflow.com/users/45843/rwallace"}, "reply_to_user": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "edited": false, "score": 0, "creation_date": 1488478767, "post_id": 42562702, "comment_id": 72259972, "body": "@Rakete1111 Fair enough :) Tried that just now, posted result."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488482296, "post_id": 42562702, "comment_id": 72262030, "body": "I have temporarily deleted my answer (which pointed at <a href=\"https://github.com/commercialhaskell/stack/issues/2426\" rel=\"nofollow noreferrer\">Stack issue #2426</a> -- you may still want to have a look at that, as it might be relevant) because the nature of the &quot;was unexpected at this time&quot; error is not clear to me. It makes it look like something is feeding a batch script a bad path (<code>&quot;--git-dir=.git&quot;</code>). Have you changed any configuration settings during or after instaling the Platform?"}, {"owner": {"reputation": 25603, "user_id": 45843, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/55f76441107f14055f95e08bb7bd01df?s=128&d=identicon&r=PG&f=1", "display_name": "rwallace", "link": "https://stackoverflow.com/users/45843/rwallace"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488482535, "post_id": 42562702, "comment_id": 72262179, "body": "@duplode No, I didn&#39;t touch any settings. I even skipped step 3 as per <a href=\"http://stackoverflow.com/questions/42555250/installing-haskell-on-windows-cabal-config\" title=\"installing haskell on windows cabal config\">stackoverflow.com/questions/42555250/&hellip;</a>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1488489642, "post_id": 42562702, "comment_id": 72266297, "body": "The failure is due to <code>git</code>, the &quot;removeDirectoryRecursive: permission denied (Access is denied.)&quot; error is a red herring - the task has already failed before that, the most likely situation is that stack simply trudges along and then fails to delete a directory which should have been created by git. As far as I remember, stack will happily use its own version of git if it does not find it on your machine, so try removing your installation of <code>git</code> from the path. Regardless, you should run <code>stack update -v</code> (as I said in the other question....) to actually see what is happening."}], "owner": {"reputation": 25603, "user_id": 45843, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/55f76441107f14055f95e08bb7bd01df?s=128&d=identicon&r=PG&f=1", "display_name": "rwallace", "link": "https://stackoverflow.com/users/45843/rwallace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 254, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1517004590, "creation_date": 1488477828, "last_edit_date": 1517004590, "question_id": 42562702, "link": "https://stackoverflow.com/questions/42562702/haskell-on-windows-stack-fails-to-fetch-package-index", "title": "Haskell on Windows - Stack fails to fetch package index", "body": "<p>I'm trying to install Haskell on Windows. Downloaded the installer and just clicked through everything, then tried to use Stack to install a package, ran it from a temporary folder in which everything has write access:</p>\n\n<pre><code>C:\\t&gt;stack install hfmt\nUsing latest snapshot resolver: lts-8.3\nWriting implicit global project config file to: C:\\sr\\global-project\\stack.yaml\nNote: You can change the snapshot via the resolver field there.\nDownloaded lts-8.3 build plan.\nFetching package index ...=.git\"\"==\"gui\" was unexpected at this time.\nC:\\sr\\indices\\Hackage\\git-update\\all-cabal-hashes&gt;@if \"\"--git-dir=.git\"\"==\"gui\" @goto gui\nProcess exited with ExitFailure 255: C:\\Program Files (x86)\\Git\\cmd\\git.CMD --git-dir=.git fetch --tags\nFailed to fetch package index, retrying.\nremoveDirectoryRecursive: permission denied (Access is denied.)\n</code></pre>\n\n<p>What's going wrong, and how can I fix it? Or should I forget about Stack and just use Cabal instead?</p>\n\n<p>Tried rerunning the command as administrator. This time the response was instant:</p>\n\n<pre><code>C:\\t&gt;stack install hfmt\nFetching package index ...=.git\"\"==\"gui\" was unexpected at this time.\nC:\\sr\\indices\\Hackage\\git-update\\all-cabal-hashes&gt;@if \"\"--git-dir=.git\"\"==\"gui\" @goto gui\nProcess exited with ExitFailure 255: C:\\Program Files (x86)\\Git\\cmd\\git.CMD --git-dir=.git fetch --tags\nFailed to fetch package index, retrying.\nremoveDirectoryRecursive: permission denied (Access is denied.)\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "pattern-matching"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1488478051, "post_id": 42562695, "comment_id": 72259541, "body": "The pattern that has to fail for the code to move on to <code>eval x = x</code> is only <code>Plus lhs rhs</code>. Once that is matched, the code for that case will be executed (and in your case, it throws a pattern match error in the <code>where</code>)."}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1488478393, "post_id": 42562695, "comment_id": 72259761, "body": "so how should i rewrite this ?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1488478616, "post_id": 42562695, "comment_id": 72259889, "body": "Not at all. How do you expect this to work, what output do you want to get? How would the variable evaluate to something that you can add to a number? Should every expression evaluate to a rational number?"}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1488478883, "post_id": 42562695, "comment_id": 72260048, "body": "I want the <code>eval</code> function to evaluate the expression until it hits a variable, meaning whenever the two expressions within <code>Plus</code> evaluate to a <code>Number</code> you can collapse it to a new <code>Number</code>, otherwise you cannot collapse the <code>Plus</code> but maybe you can collapse only one side of the <code>Plus</code>.  eg:  <code>eval (Plus (Number a) (Number b)) == Number (a + b)</code>                                      <code>eval (Plus (Var &quot;a&quot;) b) == Plus (Var &quot;a&quot;) (eval b)</code>"}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1488479089, "post_id": 42562695, "comment_id": 72260168, "body": "so that <code>eval</code> boils the expression to the simplest form, it computes all that can be computed without knowing the variables, and returns a new simpler expression"}], "answers": [{"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1488479572, "post_id": 42563077, "comment_id": 72260439, "body": "The viewpattern helps at evaluating only numbers, but doesn&#39;t simplify (&quot;collapse&quot;) other patterns. You&#39;d need a second case <code>eval (Plus a b) = Plus (eval a) (eval b)</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1488479609, "post_id": 42563077, "comment_id": 72260462, "body": "@Bergi His original code does not do this; and I believe I point out this flaw in the answer text. I&#39;ll be more explicit about the additional failure case you discuss, though."}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1488479671, "post_id": 42563077, "comment_id": 72260503, "body": "Thanks! your code works, and your suggestion is great for a situation with only <code>Plus</code> operations, but I intend to have all kinds of operations."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1488479699, "post_id": 42563077, "comment_id": 72260523, "body": "@DanielWagner  Yes (and I agree with that flaw), but it&#39;s what he says he wants in the comments. Of course that is not an <code>eval</code>uation function but rather a <code>simplify</code>cation or <code>normalise</code>tion one."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1488479727, "post_id": 42563077, "comment_id": 72260551, "body": "@Bergi Do you have a suggestion for improving the answer to go along with this criticism?"}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1488479824, "post_id": 42563077, "comment_id": 72260603, "body": "I realize i didn&#39;t put the code that continues the simplification for <code>Plus (Var a) b</code>, that was done to simplify the question a bit."}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1488480088, "post_id": 42563077, "comment_id": 72260764, "body": "AN IMPROVEMENT: <code>Plus [Expr]</code> how would you do it ?  <code>eval Plus [(Number 1),(Number 2),(Variable &quot;a&quot;),(Number 3)] = Plus [(Number 6), (Variable &quot;a&quot;)]</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1488480697, "post_id": 42563077, "comment_id": 72261117, "body": "@user47376 I would <code>instance Monoid Sum where mempty = Sum 0 empty; mappend (Sum r vs) (Sum r&#39; vs&#39;) = Sum (r+r&#39;) (union vs vs&#39;)</code> and then <code>eval (Plus terms) = foldMap eval terms</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1488479686, "last_edit_date": 1488479686, "creation_date": 1488479111, "answer_id": 42563077, "question_id": 42562695, "link": "https://stackoverflow.com/questions/42562695/why-is-this-pattern-irrefulable/42563077#42563077", "title": "Why is this pattern irrefulable?", "body": "<p>You can use <code>ViewPatterns</code> to make this relatively pretty:</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\neval (Plus (eval -&gt; Number a) (eval -&gt; Number b)) = Number (a+b)\neval x = x\n</code></pre>\n\n<p>Given your comments, I would be remiss if I didn't point out there are some flaws with your proposed algorithm, though; for example:</p>\n\n<pre><code>&gt; eval (Number 3 `Plus` Number 4 `Plus` Variable \"a\") -- doesn't know about associativity of Plus\nPlus (Plus (Number (3 % 1)) (Number (4 % 1))) (Variable \"a\")\n&gt; eval (Variable \"a\" `Plus` (Number 3 `Plus` Number 4)) -- doesn't simplify recursively when it hits a variable\nPlus (Variable \"a\") (Plus (Number (3 % 1)) (Number (4 % 1)))\n</code></pre>\n\n<p>Consider normalizing to a less structured type; perhaps something like</p>\n\n<pre><code>data Sum = Sum Rational (MultiSet String)\n</code></pre>\n\n<p>telling the sum of all the <code>Number</code>s in the first part and how often each variable appeared in <a href=\"http://hackage.haskell.org/package/multiset-0.3.3/docs/Data-MultiSet.html\" rel=\"nofollow noreferrer\">the second part</a>. Then</p>\n\n<pre><code>eval :: Expr -&gt; Sum\neval (Number r) = Sum r empty\neval (Variable v) = Sum 0 (singleton v)\neval (Plus l r) = Sum (r+r') (union vs vs') where\n    Sum r  vs  = eval l\n    Sum r' vs' = eval r\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1488479948, "post_id": 42563151, "comment_id": 72260682, "body": "Thanks! that works as I want and does not use extra compiler features like <code>ViewPatterns</code>"}, {"owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1488480373, "post_id": 42563151, "comment_id": 72260924, "body": "AN IMPROVEMENT: <code>Plus [Expr]</code> how would you do it ?  <code>eval Plus [(Number 1),(Number 2),(Variable &quot;a&quot;),(Number 3)] = Plus [(Number 6), (Variable &quot;a&quot;)]</code>"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "edited": false, "score": 0, "creation_date": 1488480817, "post_id": 42563151, "comment_id": 72261209, "body": "I wouldn&#39;t ever write my <code>Plus</code> constructor as a list of expression exactly because that only makes it harder\u2026 rather write the function to deal with nested <code>Plus</code>es by always moving <code>Number</code>s to the top level (applying the commutative/associative laws of addition).  But have a look at <code>List.partition</code> to separate Numbers from non-Numbers. Or even better use a <code>fold</code> with a tuple of the numeric sum and a list of variables."}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 4, "last_activity_date": 1488480046, "last_edit_date": 1488480046, "creation_date": 1488479347, "answer_id": 42563151, "question_id": 42562695, "link": "https://stackoverflow.com/questions/42562695/why-is-this-pattern-irrefulable/42563151#42563151", "title": "Why is this pattern irrefulable?", "body": "<p>You will want to use a <code>case</code> expression to match all the possible outcomes of the inner <code>eval</code> calls, not just <code>Number</code>s:</p>\n\n<pre><code>eval (Plus lhs rhs) = case (eval lhs, eval rhs) of\n  (Number a, Number b) -&gt; Number (a + b)     -- two numbers can be summed\n  (otherA,   otherB)   -&gt; Plus otherA otherB -- other values form a Plus with collapsed parts\neval x              = x\n</code></pre>\n"}], "owner": {"reputation": 2173, "user_id": 3794544, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/94226e756a1e68dd797037f11dc2102a?s=128&d=identicon&r=PG&f=1", "display_name": "user47376", "link": "https://stackoverflow.com/users/3794544/user47376"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 42563151, "answer_count": 2, "score": 1, "last_activity_date": 1488480046, "creation_date": 1488477814, "last_edit_date": 1488479245, "question_id": 42562695, "link": "https://stackoverflow.com/questions/42562695/why-is-this-pattern-irrefulable", "title": "Why is this pattern irrefulable?", "body": "<p>I'm new to Haskell and trying to create a function that evaluates an arithmetic expression:</p>\n\n<pre><code>data Expr = Number Rational | Variable String | Plus Expr Expr deriving (Eq, Show , Read)\n\neval (Plus lhs rhs) = Number (a + b)\n  where Number a = eval lhs\n    Number b = eval rhs\neval x = x\n\nmain = putStrLn . show $ eval (Plus (Number 1) (Variable \"x\"))\n</code></pre>\n\n<p>I want the <code>eval</code> function to evaluate the expression until it hits a <code>Variable</code>, meaning whenever the two expressions within <code>Plus</code> evaluate to a <code>Number</code> you can collapse it to a new <code>Number</code>, otherwise you cannot collapse the <code>Plus</code> but maybe you can collapse only one side of the <code>Plus</code>. eg: eval (Plus (Number a) (Number b)) == Number (a + b) eval (Plus (Var \"a\") b) == Plus (Var \"a\") (eval b) </p>\n\n<p>I expected the pattern <code>Number b</code> to fail and to move on to <code>eval x = x</code>\nand just return the expression as is, but instead it produces an error:\n<code>main: main.hs:5:9-27: Irrefutable pattern failed for pattern Main.Number b</code></p>\n\n<p>Why is this happening and how can I solve it ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 1, "creation_date": 1488477823, "post_id": 42562678, "comment_id": 72259419, "body": "You want <code>isatty</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "edited": false, "score": 0, "creation_date": 1488490629, "post_id": 42562765, "comment_id": 72266854, "body": "I actually need to send different strings to be displayed on the terminal and to the pipe at the same time. I edited my question to make it clearer."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "edited": false, "score": 0, "creation_date": 1488491890, "post_id": 42562765, "comment_id": 72267490, "body": "@GuillaumeCh&#233;rel: in that case they usually send to the stderr, and other outputs..."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1488478017, "creation_date": 1488478017, "answer_id": 42562765, "question_id": 42562678, "link": "https://stackoverflow.com/questions/42562678/how-to-output-to-terminal-but-not-pipe-or-vice-versa/42562765#42562765", "title": "How to output to terminal but not pipe (or vice versa)", "body": "<p>Yes, if you make some assumptions. You can check if it is the console by using the <a href=\"https://hackage.haskell.org/package/terminal-size-0.3.2.1/docs/System-Console-Terminal-Size.html#v:size\" rel=\"nofollow noreferrer\"><code>System.Console.Terminal.Size</code></a> module:</p>\n\n<pre><code>import System.Console.Terminal.Size(size)\n\nisConsole :: IO Bool\nisConsole = liftM isJust size\n</code></pre>\n\n<p>basically what happens is it checks if the terminal has defined a size (so it is <code>Just x</code>). If so we assume it is a terminal, if not we make the assumption that it is a pipe (which has no size). Of course it is up to a console to specify its size properly.</p>\n"}, {"tags": [], "owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "is_accepted": true, "score": 2, "last_activity_date": 1488536964, "creation_date": 1488536964, "answer_id": 42576452, "question_id": 42562678, "link": "https://stackoverflow.com/questions/42562678/how-to-output-to-terminal-but-not-pipe-or-vice-versa/42576452#42576452", "title": "How to output to terminal but not pipe (or vice versa)", "body": "<p>The following seems to be working: send the data that is meant to be piped to the standard output (with <code>putStrLn</code> for example), and the data to be displayed to the file <code>/dev/tty</code>. For example, the following send \"a\" to both:</p>\n\n<pre><code>import qualified System.IO as SIO\n\nmain = do\n    SIO.withFile \"/dev/tty\" SIO.WriteMode (\\h -&gt; SIO.hPutStrLn h \"a\")\n    putStrLn \"a\"\n</code></pre>\n\n<p>That way, running the shell command</p>\n\n<pre><code>$ myProg | sed 's/a/A/'\n</code></pre>\n\n<p>in a terminal displays:</p>\n\n<pre><code>a\nA\n</code></pre>\n\n<p>Only the second A was replaced, i.e. the one send to sed through the pipe with <code>putStrLn</code>, and not the one directly written to <code>/dev/tty</code>.</p>\n"}], "owner": {"reputation": 1354, "user_id": 589192, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e8f99f185a95f016a4a8ac4eaa708167?s=128&d=identicon&r=PG", "display_name": "Guillaume Ch&#233;rel", "link": "https://stackoverflow.com/users/589192/guillaume-ch%c3%a9rel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 42576452, "answer_count": 2, "score": 1, "last_activity_date": 1488536964, "creation_date": 1488477767, "last_edit_date": 1488490466, "question_id": 42562678, "link": "https://stackoverflow.com/questions/42562678/how-to-output-to-terminal-but-not-pipe-or-vice-versa", "title": "How to output to terminal but not pipe (or vice versa)", "body": "<p>I'd like to display some text to the terminal but not send this text to a piped process. The purpose is to format differently the data that is being displayed (for pretty printing) and that which is being sent to subsequent processes.</p>\n\n<p>For example, I would like, once the executable is called like this:</p>\n\n<pre><code>$ execname | otherproc\n</code></pre>\n\n<p>to both output something that will be displayed on the terminal and send some string through the pipe to <code>otherproc</code>. Is there something, maybe like a <code>System.IO.Handle</code> such as <code>stdout</code>, that I could use to send data either to be displayed in terminal or to the pipe?</p>\n"}, {"tags": ["haskell", "yaml", "aeson"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1488470267, "post_id": 42559557, "comment_id": 72254399, "body": "The first issue I see is that you have to capitalize your types and constructor, so <code>data Item = Item ...</code> and <code>instance FromJSON Item where ...</code>.  I think your question is really about how to access nested elements, is that what you really want to ask?  This problem doesn&#39;t seem to really be about getting timestamps out, but rather about how to work with nested structures in YAML."}, {"owner": {"reputation": 3, "user_id": 7648251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7164803e31c498987ac14797f62e8444?s=128&d=identicon&r=PG&f=1", "display_name": "QuickQuestionGuy", "link": "https://stackoverflow.com/users/7648251/quickquestionguy"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1488472523, "post_id": 42559557, "comment_id": 72255963, "body": "@bheklilr Thank you for your reponse, yes you are right. The question should indeed be: &quot;how to access nested elements?&quot;"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488473503, "post_id": 42559557, "comment_id": 72256680, "body": "Are you using <a href=\"https://hackage.haskell.org/package/yaml-0.8.9/docs/Data-Yaml.html\" rel=\"nofollow noreferrer\">the <i>yaml</i> package</a>? If so, you should mention it in the question. (By the way, you can <a href=\"https://stackoverflow.com/posts/42559557/edit\">edit</a> it to add clarifications.)"}, {"owner": {"reputation": 3, "user_id": 7648251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7164803e31c498987ac14797f62e8444?s=128&d=identicon&r=PG&f=1", "display_name": "QuickQuestionGuy", "link": "https://stackoverflow.com/users/7648251/quickquestionguy"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488474155, "post_id": 42559557, "comment_id": 72257105, "body": "@duplode yes i am using the yaml package. I have added this to the question."}, {"owner": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1488475343, "post_id": 42559557, "comment_id": 72257912, "body": "@QuickQuestionGuy Welcome to <a href=\"https://stackoverflow.com\">Stack Overflow</a>, we have edit history. There is no need to make your post less readable for future users by including &quot;Edit&quot; in the post itself when you change something."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488476447, "post_id": 42559557, "comment_id": 72258574, "body": "Tangential note: consider not using <code>id</code> for the first field of <code>Item</code>, but rather <code>id_</code> or something like that. I see how changing that can be somewhat annoying, but <code>id</code> is a very common Prelude function, and calling your field that is likely to make readers of your code do a double take. (Note I&#39;m only talking about the Haskell data type definition -- the YAML can of course remain unchanged.)"}, {"owner": {"reputation": 3, "user_id": 7648251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7164803e31c498987ac14797f62e8444?s=128&d=identicon&r=PG&f=1", "display_name": "QuickQuestionGuy", "link": "https://stackoverflow.com/users/7648251/quickquestionguy"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488478157, "post_id": 42559557, "comment_id": 72259617, "body": "@duplode  ah that makes sense, i will keep that in mind. Thank you for your help!"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1488476079, "post_id": 42561826, "comment_id": 72258357, "body": "It is worth noting that <a href=\"https://hackage.haskell.org/package/aeson-1.1.0.0/docs/Data-Aeson.html#t:FromJSON\" rel=\"nofollow noreferrer\"><code>UTCTime</code> has a <code>FromJSON</code> instance</a>, and so replacing <code>String</code> with <code>UTCTime</code> in the definition of <code>Time</code> will just work, with no further changes being required."}], "tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": true, "score": 2, "last_activity_date": 1488493954, "last_edit_date": 1488493954, "creation_date": 1488475013, "answer_id": 42561826, "question_id": 42559557, "link": "https://stackoverflow.com/questions/42559557/haskell-read-nested-timestamp-from-yaml-file/42561826#42561826", "title": "Haskell read nested timestamp from YAML file", "body": "<p>The easiest way is to create a <code>newtype</code> that implements <code>FromJSON</code>.</p>\n\n<pre><code>import Data.Time\nimport Data.Yaml\n\ndata Item = Item \n  { id :: Int\n  , kind :: String\n  , createdAt :: UTCTime\n  } deriving (Show)\n\ninstance FromJSON Item where\n  parseJSON (Object v) = \n    Item &lt;$&gt; v .: \"id\" &lt;*&gt; v .: \"kind\" &lt;*&gt; v .: \"created_at\"\n\nnewtype Time = Time String deriving (Show, Eq)\n\ninstance FromJSON Time where\n  parseJSON (Object v) = Time &lt;$&gt; v .: \"utc\"\n</code></pre>\n\n<p>Hope that helps.</p>\n"}], "owner": {"reputation": 3, "user_id": 7648251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7164803e31c498987ac14797f62e8444?s=128&d=identicon&r=PG&f=1", "display_name": "QuickQuestionGuy", "link": "https://stackoverflow.com/users/7648251/quickquestionguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 42561826, "answer_count": 1, "score": 0, "last_activity_date": 1488493954, "creation_date": 1488468789, "last_edit_date": 1488475272, "question_id": 42559557, "link": "https://stackoverflow.com/questions/42559557/haskell-read-nested-timestamp-from-yaml-file", "title": "Haskell read nested timestamp from YAML file", "body": "<p>I recently started playing around with Haskell and can't seem to figure this one out.</p>\n\n<p>I am trying to read from a YAML file that has this format:</p>\n\n<pre><code>id: 1\nkind: good\ncreated_at: !ruby/object:ActiveSupport::TimeWithZone\n    utc: &amp;1 2017-01-01 10:34:12.533704000 Z\n    zone: &amp;2 !ruby/object:ActiveSupport::TimeZone\n    time: *2\n</code></pre>\n\n<p>So far I can read the id and kind perfectly fine by doing this:</p>\n\n<pre><code>data Item= Item{\n    id :: Integer,\n    kind::String\n    }\n</code></pre>\n\n<p>And</p>\n\n<pre><code>instance FromJSON Item where\n    parseJSON(Object v) = Item &lt;$&gt;\n        v .: \"id\" &lt;*&gt;\n        v .: \"kind\"\n</code></pre>\n\n<p>I am using the package \"Data.Yaml\" and this function:<br>\n    <code>let items = Data.Yaml.decode ymlData :: Maybe[Item]</code></p>\n\n<p>But I can't seem to figure out how to get the timestamp.</p>\n\n<p>What would be the proper way of getting the timestamp, only the \"utc\" is needed.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488468628, "post_id": 42559364, "comment_id": 72253229, "body": "Do you know how to reverse a <code>String</code>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1741222"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1488468756, "post_id": 42559364, "comment_id": 72253312, "body": "@duplode: yes, <code>reverse s</code>"}], "answers": [{"tags": [], "owner": {"reputation": 507, "user_id": 4966887, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2b2d9b78341809c8b9b01ac9ae3f3c72?s=128&d=identicon&r=PG&f=1", "display_name": "Chirs", "link": "https://stackoverflow.com/users/4966887/chirs"}, "is_accepted": true, "score": 2, "last_activity_date": 1488468884, "last_edit_date": 1488468884, "creation_date": 1488468843, "answer_id": 42559570, "question_id": 42559364, "link": "https://stackoverflow.com/questions/42559364/haskell-function-to-reverse-an-io-string/42559570#42559570", "title": "Haskell function to reverse an IO String", "body": "<p>This is going to be a short answer:</p>\n\n<pre><code>fmap reverse\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1741222"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 612, "favorite_count": 0, "accepted_answer_id": 42559570, "answer_count": 1, "score": -3, "last_activity_date": 1488468884, "creation_date": 1488468283, "last_edit_date": 1488468735, "question_id": 42559364, "link": "https://stackoverflow.com/questions/42559364/haskell-function-to-reverse-an-io-string", "title": "Haskell function to reverse an IO String", "body": "<p>How can a function be written in Haskell that takes an IO String and returns the string reversed.</p>\n\n<pre><code>rev :: IO String -&gt; IO String\nrev s = ...\n</code></pre>\n"}, {"tags": ["json", "haskell", "elasticsearch", "aeson", "http.client"], "answers": [{"tags": [], "owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "is_accepted": true, "score": 2, "last_activity_date": 1488472015, "creation_date": 1488472015, "answer_id": 42560724, "question_id": 42559287, "link": "https://stackoverflow.com/questions/42559287/query-request-from-haskell-with-two-times-the-same-data/42560724#42560724", "title": "Query Request from Haskell with two times the &quot;same data&quot;", "body": "<p>I fixed it. I had to redeclare the <code>toJSON</code> instance from <code>aeson</code></p>\n\n<pre><code>instance ToJSON FunctionScore where\n  toJSON (FunctionScore q f)   = object [\"query\" .= q, \"functions\" .= f]\n</code></pre>\n\n<p>and it works nicely. </p>\n"}], "owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 1, "accepted_answer_id": 42560724, "answer_count": 1, "score": 2, "last_activity_date": 1488472015, "creation_date": 1488468096, "question_id": 42559287, "link": "https://stackoverflow.com/questions/42559287/query-request-from-haskell-with-two-times-the-same-data", "title": "Query Request from Haskell with two times the &quot;same data&quot;", "body": "<p>I'm try to make a Http request with Haskell (Aeson) to Elasticsearch. </p>\n\n<p>The Elasticsearch body looks so:</p>\n\n<pre><code>{   \n    \"query\": {\n        \"function_score\": {\n            \"query\": {\n                \"bool\": {\n                    \"should\": [\n                        {\"term\": {\"word_n_gram\": \"str\"}},\n                        {\"term\": {\"word_n_gram\": \"not\"}}                        \n                    ]\n                }\n            },\n            \"functions\": [\n                {\n                    \"script_score\": {\n                        \"script\": {\n                            \"lang\": \"groovy\",\n                            \"file\": \"test-score\",\n                            \"params\": {\n                                \"boostBy\": {\n                                    \"str\": 1,\n                                    \"not\": 1\n                                }\n                            }\n                        }\n                    }\n                }\n            ]\n        }\n    }\n}\n</code></pre>\n\n<p>And it works properly. </p>\n\n<p>So, I made the \"equivalent\" in Haskell:</p>\n\n<pre><code>data QueryRequest = QueryRequest {\n    query :: Query\n} deriving (Eq, Generic, Show)\n\ninstance ToJSON QueryRequest\n\ndata Query = Query {\n    function_score :: FunctionScore\n} deriving (Eq, Generic, Show)\n\ninstance ToJSON Query\n\ndata FunctionScore = FunctionScore {\n    queryIn   :: QueryIn\n  , functions :: [Functions]\n} deriving (Eq, Generic, Show)\n\ninstance ToJSON FunctionScore\n\ndata QueryIn = QueryIn {\n    bool :: BoolQuery\n} deriving (Eq, Generic, Show)\n\ninstance ToJSON QueryIn\n\ndata BoolQuery = BoolQuery {\n    should :: [ShouldQuery]\n} deriving (Eq, Generic, Show)\n</code></pre>\n\n<p>and so on...</p>\n\n<p>the point is, in haskell, I can't have two times the \"query\" declaration that's why I wrote <code>queryIn</code> but, since I'm making a request, and Elasticsearch is waiting for <code>query</code> two times, I get this error:</p>\n\n<blockquote>\n  <p>FailureResponse {responseStatus = Status {statusCode = 400, statusMessage = \"Bad Request\"}, responseContentType = application/json;charset=UTF-8, responseBody = \"{\\\"error\\\":{\\\"root_cause\\\":[{\\\"type\\\":\\\"parsing_exception\\\",\\\"reason\\\":\\\"no [query] registered for [queryIn]\\\",\\\"line\\\":1,\\\"col\\\":39}],\\\"type\\\":\\\"parsing_exception\\\",\\\"reason\\\":\\\"no [query] registered for [queryIn]\\\",\\\"line\\\":1,\\\"col\\\":39},\\\"status\\\":400}\"}</p>\n</blockquote>\n\n<p>which is a logic error. But I don't know how I could fix it....</p>\n\n<p>I make the \"RequestQuery\" in this way:</p>\n\n<pre><code>toElasticSearchQuery :: T.Text -&gt; RW.QueryRequest\ntoElasticSearchQuery word =\n  RW.QueryRequest {\n    RW.query = RW.Query {\n      RW.function_score = RW.FunctionScore {\n        RW.queryIn = RW.QueryIn {\n          RW.bool = RW.BoolQuery {\n            RW.should = toShouldQueryList (splitInNGrams word)\n          }\n        },\n        RW.functions = [\n          RW.Functions {\n            RW.scriptScore = RW.ScriptScore {\n              RW.script = RW.Script {\n                RW.lang = scriptLang,\n                RW.file = scriptFile,\n                RW.params = RW.Params {\n                  RW.boostBy = fixGramConter (splitInNGrams word)\n                }\n              }\n            }\n          }\n        ]\n      }\n    }\n  }\n</code></pre>\n\n<p>And of course, I can't write RW.query inside the RW.FunctionScore. \nI don't know how I can fix it, for a Response would be no problem, but for a Request, it's a problem. </p>\n\n<p>Maybe someone tried something like that before. </p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 120, "user_id": 5024654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e89d965af1f328a0967ab861656a2d48?s=128&d=identicon&r=PG", "display_name": "ForemanBob", "link": "https://stackoverflow.com/users/5024654/foremanbob"}, "edited": false, "score": 1, "creation_date": 1488473436, "post_id": 42556013, "comment_id": 72256631, "body": "What about <code>:main abc xyz</code>?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 120, "user_id": 5024654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e89d965af1f328a0967ab861656a2d48?s=128&d=identicon&r=PG", "display_name": "ForemanBob", "link": "https://stackoverflow.com/users/5024654/foremanbob"}, "edited": false, "score": 0, "creation_date": 1488545273, "post_id": 42556013, "comment_id": 72291060, "body": "Wouldn&#39;t <code>main</code> have to then be modified to accept those parameters?"}], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": true, "score": 2, "last_activity_date": 1488459444, "creation_date": 1488459444, "answer_id": 42556157, "question_id": 42556013, "link": "https://stackoverflow.com/questions/42556013/how-can-i-pass-command-line-arguments-to-ghci/42556157#42556157", "title": "How can I pass command line arguments to GHCi", "body": "<p>You can create a <code>.ghci</code> file with</p>\n\n<pre><code>:set args abc xyz\n</code></pre>\n\n<p>Which will be executed when executing <code>ghci Main.hs</code>.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 499, "favorite_count": 1, "accepted_answer_id": 42556157, "answer_count": 1, "score": 5, "last_activity_date": 1488459444, "creation_date": 1488459032, "question_id": 42556013, "link": "https://stackoverflow.com/questions/42556013/how-can-i-pass-command-line-arguments-to-ghci", "title": "How can I pass command line arguments to GHCi", "body": "<p>How can I pass command line arguments to <code>ghci</code> in the same way as doing the below (within the GHCi prompt):</p>\n\n<pre><code>:set args abc xyz\n</code></pre>\n\n<p>So something like <code>ghci Main.hs -- abc xyz</code>?</p>\n"}, {"tags": ["windows", "haskell", "cabal", "haskell-platform"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488463019, "post_id": 42555250, "comment_id": 72249066, "body": "&quot;What should I do&quot; isn&#39;t really a question - only you can know what your environment looks like, if it is appropriate to keep one or the other, or both paths (<code>extra-prog-path</code> can be a list of paths separated by commas). What doesn&#39;t work if you replace the existing paths, or don&#39;t replace them, or include both? Two asides; having spaces in the path will probably lead to issues down the line; and why aren&#39;t you using stack (it is the 2nd option on the downloads page)?"}, {"owner": {"reputation": 25603, "user_id": 45843, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/55f76441107f14055f95e08bb7bd01df?s=128&d=identicon&r=PG&f=1", "display_name": "rwallace", "link": "https://stackoverflow.com/users/45843/rwallace"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488463321, "post_id": 42555250, "comment_id": 72249277, "body": "@user2407038 I don&#39;t know what&#39;s appropriate here because I&#39;m not familiar with the Haskell environment. I&#39;ve left it alone for the moment and I&#39;m making an attempt to use Stack (it seems to have been automatically installed) since Google search said it was better (is that true?) <code>stack install hfmt</code> has been updating package index for twenty minutes now; is that supposed to happen?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1488463966, "post_id": 42555250, "comment_id": 72249750, "body": "But neither is SO familiar with your environment - I don&#39;t know the contents of the <code>C:\\Users\\w\\AppData\\Roaming\\cabal\\bin</code> directory, nor if it even exists. Yes, it takes a long time (it&#39;s never taken me 20 minutes, but of course this depends on the speed of your internet connection) to fetch the package index the first time, but this is no different for plain <code>cabal</code> without <code>stack</code>. To be sure all is going well, you can run <code>stack</code> with <code>-v</code> (verbosity) - it will print the progress of the downloads."}, {"owner": {"reputation": 25603, "user_id": 45843, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/55f76441107f14055f95e08bb7bd01df?s=128&d=identicon&r=PG&f=1", "display_name": "rwallace", "link": "https://stackoverflow.com/users/45843/rwallace"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488464087, "post_id": 42555250, "comment_id": 72249833, "body": "@user2407038 Well, this is starting with a clean install of Haskell, so whatever a clean install would produce. Okay, if Stack is supposed to be taking a long time to fetch the package index the first time, that&#39;s no problem, just want to make sure it wasn&#39;t hung or anything. Thanks!"}, {"owner": {"reputation": 10244, "user_id": 2157640, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/aoymS.png?s=128&g=1", "display_name": "Palec", "link": "https://stackoverflow.com/users/2157640/palec"}, "edited": false, "score": 0, "creation_date": 1493375202, "post_id": 42555250, "comment_id": 74401664, "body": "Related Q: <a href=\"https://stackoverflow.com/q/42725607/2157640\">stackoverflow.com/q/42725607/2157640</a>"}, {"owner": {"reputation": 10244, "user_id": 2157640, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/aoymS.png?s=128&g=1", "display_name": "Palec", "link": "https://stackoverflow.com/users/2157640/palec"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1493376090, "post_id": 42555250, "comment_id": 74402259, "body": "This question is about the Haskell Platform installation procedure. Clean install, no modifications -- the environment is sufficiently defined by the installer. I am pretty sure the original <code>extra-prog-path</code> should be used and the new <code>extra-prog-path</code> should be added, @user2407038. For newbies, <a href=\"https://www.haskell.org/platform/#windows\" rel=\"nofollow noreferrer\">Haskell Platform installation instructions for WIndows</a> are hard to follow because of unfamiliarity of Cabal&#39;s user config syntax."}], "answers": [{"tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": false, "score": 1, "last_activity_date": 1503287171, "creation_date": 1503287171, "answer_id": 45789032, "question_id": 42555250, "link": "https://stackoverflow.com/questions/42555250/installing-haskell-on-windows-cabal-config/45789032#45789032", "title": "Installing Haskell on Windows, cabal config", "body": "<p>You don't need to overwrite existing lines. You can have multiple <code>extra-prog-path</code> entries and they all get used.</p>\n"}, {"tags": [], "owner": {"reputation": 26, "user_id": 5589882, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tdkH0.png?s=128&g=1", "display_name": "stacchioflo", "link": "https://stackoverflow.com/users/5589882/stacchioflo"}, "is_accepted": true, "score": 1, "last_activity_date": 1582193562, "creation_date": 1582193562, "answer_id": 60317511, "question_id": 42555250, "link": "https://stackoverflow.com/questions/42555250/installing-haskell-on-windows-cabal-config/60317511#60317511", "title": "Installing Haskell on Windows, cabal config", "body": "<p>I have cabal-install version 2.4.1.0. As proposed in <a href=\"https://www.haskell.org/cabal/users-guide/nix-local-build.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/cabal/users-guide/nix-local-build.html</a> and contrary to the installing instructions at <a href=\"https://www.haskell.org/platform/windows.html\" rel=\"nofollow noreferrer\">https://www.haskell.org/platform/windows.html</a>, I'm using one single <code>extra-prog-path</code> line containing a comma separated list of paths:</p>\n\n<p><code>extra-prog-path: C:\\Users\\...\\AppData\\Roaming\\cabal\\bin,C:\\Program Files\\Haskell Platform\\8.6.5\\msys\\usr\\bin</code></p>\n\n<p>Reason: Like this, at least the command <code>cabal user-config diff</code> gives reasonable results.</p>\n\n<pre><code>C:\\&gt;cabal user-config diff\n+ extra-include-dirs: C:\\Program Files\\Haskell Platform\\8.6.5\\mingw\\include\n+ extra-lib-dirs: C:\\Program Files\\Haskell Platform\\8.6.5\\mingw\\lib\n- extra-prog-path: C:\\Users\\...\\AppData\\Roaming\\cabal\\bin\n+ extra-prog-path: C:\\Users\\...\\Roaming\\cabal\\bin,C:\\Program Files\\Haskell Platform\\8.6.5\\msys\\usr\\bin\n+ logs-dir: C:\\Users\\...\\AppData\\Roaming\\cabal\\logs\n</code></pre>\n\n<p>If I'd follow the installing instructions and use two <code>extra-prog-path</code> lines, then  <code>cabal user-config diff</code> would ignore the second one. I'm not sure however if this matters.</p>\n"}], "owner": {"reputation": 25603, "user_id": 45843, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/55f76441107f14055f95e08bb7bd01df?s=128&d=identicon&r=PG&f=1", "display_name": "rwallace", "link": "https://stackoverflow.com/users/45843/rwallace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2079, "favorite_count": 0, "accepted_answer_id": 60317511, "answer_count": 2, "score": 3, "last_activity_date": 1582193562, "creation_date": 1488456853, "question_id": 42555250, "link": "https://stackoverflow.com/questions/42555250/installing-haskell-on-windows-cabal-config", "title": "Installing Haskell on Windows, cabal config", "body": "<p>I'm installing Haskell on Windows based on the instructions at <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\">https://www.haskell.org/platform/</a> and looking at step 3, it says, Modify your cabal config file (you can verify the location by running \"cabal user-config init\") to contain the following lines:</p>\n\n<pre><code>extra-prog-path: C:\\Program Files\\Haskell Platform\\8.0.2\\msys\\usr\\bin\nextra-lib-dirs: C:\\Program Files\\Haskell Platform\\8.0.2\\mingw\\lib\nextra-include-dirs: C:\\Program Files\\Haskell Platform\\8.0.2\\mingw\\include\n</code></pre>\n\n<p>But the auto generated config file contains e.g.</p>\n\n<pre><code>extra-prog-path: C:\\Users\\w\\AppData\\Roaming\\cabal\\bin\n</code></pre>\n\n<p>So that's a different value for one of the suggested variables.</p>\n\n<p>Is this intentional?</p>\n\n<p>What should I do, paste the lines from step 3 at the start of the file, the end of the file, overwrite the existing lines or skip step 3 altogether?</p>\n"}, {"tags": ["haskell", "functional-programming", "monads", "maybe", "either"], "comments": [{"owner": {"reputation": 14830, "user_id": 3757232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/kLzML.jpg?s=128&g=1", "display_name": "Jared Smith", "link": "https://stackoverflow.com/users/3757232/jared-smith"}, "edited": false, "score": 1, "creation_date": 1488467214, "post_id": 42554353, "comment_id": 72252151, "body": "I&#39;m stunned this isn&#39;t a dupe. Great question."}], "answers": [{"tags": [], "owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "is_accepted": true, "score": 21, "last_activity_date": 1488464559, "creation_date": 1488464559, "answer_id": 42557963, "question_id": 42554353, "link": "https://stackoverflow.com/questions/42554353/why-do-we-need-maybe-monad-over-either-monad/42557963#42557963", "title": "Why Do We Need Maybe Monad Over Either Monad", "body": "<p>You are of course right that <code>Maybe a</code> is isomorphic to <code>Either Unit a</code>. The thing is that they are often semantically used to denote different things, a bit like the difference between returning <code>null</code> and throwing a <code>NoSuchElementException</code>: </p>\n\n<ul>\n<li><code>Nothing</code>/<code>None</code> denotes the \"expected\" missing of something, while</li>\n<li><code>Left e</code> denotes an error in getting it, for whatever reason.</li>\n</ul>\n\n<p>That said, we might even combine the two to something like:</p>\n\n<pre><code>query :: Either DBError (Maybe String)\n</code></pre>\n\n<p>where we express both the possibility of a missing value (a DB <code>NULL</code>) and an error in the connection, the DBMS, or whatever (not saying that there aren't better designs, but you get the point).</p>\n\n<p>Sometimes, the border is fluid; for <code>saveHead :: [a] -&gt; Maybe a</code>, we could say that the expected possibility of the error is encoded in the intent of the function, while something like <code>saveDivide</code> might be encoded as <code>Float -&gt; Float -&gt; Either FPError Float</code> or <code>Float -&gt; Float -&gt; Maybe Float</code>, depending on the use case (again, just some stupid examples...). </p>\n\n<p>If in doubt, the best option is probably to use a custom result ADT with semantic encoding (like <code>data QueryResult = Success String | Null | Failure DBError</code>), and to prefer <code>Maybe</code> to simple cases where it is \"traditionally expected\" (a subjective point, which however will be mostly OK if you gain experience).</p>\n"}, {"comments": [{"owner": {"reputation": 14830, "user_id": 3757232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/kLzML.jpg?s=128&g=1", "display_name": "Jared Smith", "link": "https://stackoverflow.com/users/3757232/jared-smith"}, "edited": false, "score": 1, "creation_date": 1488467315, "post_id": 42558527, "comment_id": 72252221, "body": "For mentioning logical disjunction you get the + 1. This is <i>very</i> approachable answer for someone new to FP."}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "reply_to_user": {"reputation": 14830, "user_id": 3757232, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/kLzML.jpg?s=128&g=1", "display_name": "Jared Smith", "link": "https://stackoverflow.com/users/3757232/jared-smith"}, "edited": false, "score": 0, "creation_date": 1488470839, "post_id": 42558527, "comment_id": 72254789, "body": "Thanks Jared. Your feedback means a lot to me ^_^"}], "tags": [], "owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "is_accepted": false, "score": 15, "last_activity_date": 1488470943, "last_edit_date": 1488470943, "creation_date": 1488466114, "answer_id": 42558527, "question_id": 42554353, "link": "https://stackoverflow.com/questions/42554353/why-do-we-need-maybe-monad-over-either-monad/42558527#42558527", "title": "Why Do We Need Maybe Monad Over Either Monad", "body": "<p>@phg's answer is great. I will chime in with something that helped clear it up for me when I was learning them:</p>\n\n<ul>\n<li><code>Maybe</code> is one (value) or none \u2013 ie, you have a value or you have nothing</li>\n<li><code>Either</code> is a logical disjunction, but you always have at least one (value) - ie, you have one <em>or</em> the other, but not both. </li>\n</ul>\n\n<p><code>Maybe</code> is great for things like where you may or may not have a value - for example looking for an item in a list. if the list contains it, we get <code>(Maybe x)</code> otherwise we get <code>Nothing</code></p>\n\n<p><code>Either</code> is the perfect representation of a branch in your code - it's going to go one way or the other; <code>Left</code> or <code>Right</code>. We use a mnemonic to remember it: <code>Right</code> is the <em>right</em> (<em>correct</em>) way; <code>Left</code> is the <em>wrong</em> way (Error). This is not it's only use of course, but definitely the most common.</p>\n\n<p>I know the differences might seem subtle at first, but really they're suitable for very different things.</p>\n"}, {"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 1, "last_activity_date": 1488559841, "last_edit_date": 1488559841, "creation_date": 1488553660, "answer_id": 42582304, "question_id": 42554353, "link": "https://stackoverflow.com/questions/42554353/why-do-we-need-maybe-monad-over-either-monad/42582304#42582304", "title": "Why Do We Need Maybe Monad Over Either Monad", "body": "<p>Well, you see, we can put this to the extreme by saying that all product types can be represented by just 2-tuples and all non-recursive sum types by <code>Either</code>. To additionally represent recursive types, we need a fixpoint type.</p>\n\n<p>For example, why have 4-tuples <code>(a,b,c,d)</code> when we could as well write <code>(a, (b, (c,d)))</code> or <code>(((a,b), c), d)</code> ?</p>\n\n<p>Or why have lists, when the following works as well?</p>\n\n<pre><code>data Y f = Y (f (Y f))\n\ntype List a = Y ((,) (Either () a))\n\n\nnil = Y (Left (), undefined)\n\ncons a as = Y (Right a, as)\n\ninfixr 4 cons\n\nnumbers = 1 `cons` 2 `cons` 3 `cons` nil\n\n-- this is like foldl\n\nreduce f z (Y (Left (), _)) = z\nreduce f z (Y (Right x, xs)) = reduce f (f z x) xs\n\n\ntotal = reduce (+) 0 numbers\n</code></pre>\n"}], "owner": {"reputation": 675, "user_id": 3694556, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65cd43fd325cd82664a702c7692dd241?s=128&d=identicon&r=PG&f=1", "display_name": "altayseyhan", "link": "https://stackoverflow.com/users/3694556/altayseyhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1828, "favorite_count": 5, "accepted_answer_id": 42557963, "answer_count": 3, "score": 23, "last_activity_date": 1488800341, "creation_date": 1488454459, "last_edit_date": 1488800341, "question_id": 42554353, "link": "https://stackoverflow.com/questions/42554353/why-do-we-need-maybe-monad-over-either-monad", "title": "Why Do We Need Maybe Monad Over Either Monad", "body": "<p>I was playing around Maybe and Either monad types (Chaining, applying conditional functions according to returned value, also returning error message which chained function has failed etc.). So it seemes to me like we can achieve same and more things that Maybe does by using Either monad. So my question is where the practical or conceptual difference between those ?</p>\n"}, {"tags": ["multithreading", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 2, "last_activity_date": 1488448537, "creation_date": 1488448537, "answer_id": 42552112, "question_id": 42551496, "link": "https://stackoverflow.com/questions/42551496/basic-threading-interleaving-threads-confusion/42552112#42552112", "title": "Basic threading, interleaving threads confusion?", "body": "<p>You are partially right. The code</p>\n\n<pre><code>next1 &lt;- atm m1\n</code></pre>\n\n<p>takes the atomic action that the first thread starts with and inserts it into the merged/interleaved thread. What's returned from the call to <code>atm</code> is the continuation <code>next1</code> of that first thread.</p>\n\n<p>But next, we are taking an action from the second thread, by saying</p>\n\n<pre><code>next2 &lt;- atm m2\n</code></pre>\n\n<p>So the merged thread ends up executing an action from the first thread, and then one from the second thread. Hence \"interleaving\". We then continue by calling <code>interleave</code> recursively on the two continuations via</p>\n\n<pre><code>interleave next1 next2\n</code></pre>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "accepted_answer_id": 42552112, "answer_count": 1, "score": 3, "last_activity_date": 1488448537, "creation_date": 1488446997, "last_edit_date": 1488448059, "question_id": 42551496, "link": "https://stackoverflow.com/questions/42551496/basic-threading-interleaving-threads-confusion", "title": "Basic threading, interleaving threads confusion?", "body": "<p>I am slightly confused by the interleave function given in <a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\" rel=\"nofollow noreferrer\">this</a> guide.</p>\n\n<p>I have the following data type: </p>\n\n<pre><code>data M m r = Atomic (m (M m r)) | Done r\n</code></pre>\n\n<p>I've created a lifting function to take a <code>m a</code>, inserts the <code>a</code> inside <code>Done</code>, and then re-inserts <code>Done a</code> back into <code>m ()</code>. This forms the <code>Atomic</code> structure:</p>\n\n<pre><code>atm :: Monad m =&gt; m a -&gt; M m a\natm m = Atomic $ liftM Done m\n</code></pre>\n\n<p>I've made <code>M m</code> an instance of the <code>Monad</code> class (which pattern matches based on data constructor):</p>\n\n<pre><code>instance (Monad m) =&gt; Monad (M m) where\n   return = Done\n   (Atomic m) &gt;&gt;= f = Atomic liftM (&gt;&gt;= f) m\n   (Done r) &gt;&gt;= f = f v\n</code></pre>\n\n<p>There's a simple implementation function which accesses nested values within the <code>Atomic wrapper</code>:</p>\n\n<pre><code>runThread :: Monad m =&gt; M m a -&gt; m a\nrunThread (Atomic m) = m &gt;&gt;= runThread --Extract m and recursively pass to runThread\nrunThread (Done r) = return r --Return Done\n</code></pre>\n\n<p>Then, there is the following interleave function: </p>\n\n<pre><code>interleave :: Monad m =&gt; M m r -&gt; M m r -&gt; M m r\ninterleave (Atomic m1) (Atomic m2) = do\n   next1 &lt;- atm m1 --? \n   next2 &lt;- atm m2 --? \ninterleave next1 next2\ninterleave (Done _) t2 = interleave t2\ninterleave t1 (Done _) = interleave t1\n</code></pre>\n\n<p>My points of confusion are at <code>next1 &lt;- atm m1</code> and <code>next2 &lt;- atm m2</code>. </p>\n\n<p><strong>As I understand it, all this is doing is taking <code>m1</code> from the <code>(Atomic m1)</code> wrapper and reinserting it back into an <code>Atomic</code> wrapper? How is this operation interleaving?</strong></p>\n\n<p>Am I missing something basic here? The code works fine, so I'm sure it's due to my confusion.</p>\n\n<p>The rest of the code: </p>\n\n<pre><code>threadOne :: M IO ()\nthreadOne = do \n  atm $ print 1\n\nthreadTwo :: M IO ()\nthreadTwo = do\n  atm $ print 2\n\nmain = do\n  runThread (interleave threadOne threadTwo)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 4, "creation_date": 1488448098, "post_id": 42551417, "comment_id": 72238874, "body": "If I understand you correctly, you want to pattern match on the type. This is impossible, because there is no run-time type information. For normal sum types, the information about the constructor having been used is retained at  run-time. For existentials, there is nothing. If you want something like that, you can use a GADT as a witness, or use <code>Typeable</code>."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1488450235, "post_id": 42551417, "comment_id": 72240363, "body": "@kosmikus Yes, I want to pattern match on the type. I understand it is impossible the way GHC was implemented, I&#39;m asking why GHC was implemented like this. Can you give an example of an infinite sum type with pattern matching using GADTs ? It&#39;s not clear to me how to do it."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1488450864, "post_id": 42551417, "comment_id": 72240785, "body": "Why would GHC be implemented any other way? Pattern matching on types just leads to bad practises; the set of available types being unlimited, you can never really have full coverage without catch-all cases; and having the type information at runtime would generally be a significant performance overhead."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 0, "creation_date": 1488465649, "post_id": 42551417, "comment_id": 72250994, "body": "Shouldn&#39;t the iso be <code>(forall a. (C a =&gt; a) -&gt; b)  ~  ((exists a. C a =&gt; a) -&gt; b)</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 0, "creation_date": 1488454674, "post_id": 42553604, "comment_id": 72243268, "body": "The patterns are exhaustive if they end with a wild match <code>_</code>. By Curry-Howard, a type <code>exists x. C x</code> corresponds in logic to an existential quantification, where <code>C</code> becomes a predicate. Then a pattern match of <code>x</code> on a type <code>D</code> corresponds to the law of excluded middle, used a lot in mathematical reasoning : either <code>x</code> has property <code>D</code> or it doesn&#39;t. Strictly speaking, <code>D</code> is a type subclass of <code>C</code>, but a single type would be a good start."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "edited": false, "score": 2, "creation_date": 1488463623, "post_id": 42553604, "comment_id": 72249497, "body": "@V.Semeria &quot;Then a pattern match of x on a type D corresponds to the law of excluded middle, used a lot in mathematical reasoning&quot; - you&#39;ve hit the nail right on the head. Try to write a function of type <code>forall a . Either a (Not a)</code> (hint - you can&#39;t). The law of excluded middle does not hold in constructive mathematics, i.e. intuitionistic type systems (logics). If this displeases you, sorry, you are simply looking for a different logic (programming language), not Haskell."}, {"owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1488473217, "post_id": 42553604, "comment_id": 72256493, "body": "@user2407038 Indeed ! Now I remember reading that logics in Curry-Howard must be intuitionistic. At the time I didn&#39;t think it would actually matter and forgot it shortly after. What&#39;s type <code>Not a</code> by the way ? <code>a -&gt; bottom</code> ?"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1488452511, "creation_date": 1488452511, "answer_id": 42553604, "question_id": 42551417, "link": "https://stackoverflow.com/questions/42551417/why-dont-existential-types-have-pattern-matching/42553604#42553604", "title": "Why don&#39;t existential types have pattern matching?", "body": "<p>If you want to pattern match on types, that is impossible, because</p>\n\n<ol>\n<li><p>There are an infinite number of types to match against, so your patterns can never be exhaustive.</p></li>\n<li><p>As an implementation detail, GHC erases all type information at compile-time, so there's no way to <em>implement</em> this anyway. (Which is probably due to point #1.)</p></li>\n</ol>\n\n<p>You mention that OO languages typically have something like an <code>instanceof</code> operator. You can do this in Haskell with the <code>Typeable</code> class. If a type is an instance of <code>Typeable</code>, you can \"cast\" it to the <code>Dynamic</code> type using <code>toDyn</code>. You can then later <em>try</em> to cast it back using <code>fromDynamic</code>, which returns a <code>Maybe</code>. (Or <code>fromDyn</code>, which returns a default value.) So the <code>Dynamic</code> type is similar to Java's <code>Object</code>; it can be <em>anything</em>. Typically that's not really restrictive enough, and generally you tend not to see this kind of programming in Haskell.</p>\n\n<p>You can also use GADTs to represent a <em>finite</em> set of types which you can then pattern match against just fine. Or regular data structures, for that matter.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1488481315, "last_edit_date": 1488481315, "creation_date": 1488462409, "answer_id": 42557180, "question_id": 42551417, "link": "https://stackoverflow.com/questions/42551417/why-dont-existential-types-have-pattern-matching/42557180#42557180", "title": "Why don&#39;t existential types have pattern matching?", "body": "<p>Haskell was designed so to allow a type-erasing implementation. We can still run Haskell without carrying all the type-level information at runtime. This allows implementations to reduce the memory footprint.</p>\n\n<p>Note that the programmer can still choose to keep type information around at runtime by adding <code>Typeable a</code> constraints. <code>cast</code> can then be used to pattern match on types.</p>\n\n<p>Further, the inability of performing pattern matching on types at runtime is important to guarantee <a href=\"http://homepages.inf.ed.ac.uk/wadler/topics/parametricity.html\" rel=\"nofollow noreferrer\">parametricity / free theorems</a>. For instance, if we have a polymorphic function</p>\n\n<pre><code>f :: forall a. a -&gt; a\n</code></pre>\n\n<p>we are guaranteed that <code>f</code> is the identity (or fails to terminate). This is because any such <code>f</code> must be a natural transformation, and no other options but the identity are available. That would not be true if we could write</p>\n\n<pre><code>f x = if a==Int then x+1 else x\n</code></pre>\n\n<p>Something like that can indeed be written if we add <code>Typeable a</code>.</p>\n\n<p>Similarly, <code>g :: a-&gt;a-&gt;a</code> must be a projection, and <code>h :: [a]-&gt;[a]</code> can not send <code>[True]</code> to <code>[False,True]</code>. Further, if <code>h [1,2]=[2,2,1]</code> then necessarily <code>h \"ab\" = \"bba\"</code>. By naturality, these function must work \"uniformly\" over all the types <code>a</code>.</p>\n"}], "owner": {"reputation": 2585, "user_id": 6701918, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fBOp9.jpg?s=128&g=1", "display_name": "V. Semeria", "link": "https://stackoverflow.com/users/6701918/v-semeria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 0, "accepted_answer_id": 42557180, "answer_count": 2, "score": 1, "last_activity_date": 1488481315, "creation_date": 1488446786, "question_id": 42551417, "link": "https://stackoverflow.com/questions/42551417/why-dont-existential-types-have-pattern-matching", "title": "Why don&#39;t existential types have pattern matching?", "body": "<p>Even without extension <code>ExistentialQuantification</code>, Haskell supports some existential types, via the type isomorphism, for any typeclass <code>C</code>,</p>\n\n<pre><code>(forall a. C a =&gt; (a -&gt; b))  ~  ((exists a. C a =&gt; a) -&gt; b)\n</code></pre>\n\n<p>So a function <code>f :: C a =&gt; a -&gt; b</code> expects an argument <code>x</code> of type <code>exists a. C a</code>. But Haskell doesn't allow to pattern match <code>x</code> against some types of <code>C</code> (finishing by a wild match <code>_</code>, because type classes are usually infinite).</p>\n\n<p>This is strange, because existential types are generalized sum types. Haskell does support finite sum types with the <code>data</code> keyword and allows pattern matching for them. In languages such as C++, Java and C#, existential types are interfaces and they support pattern matching with keywords such as <code>dynamic_cast</code> or <code>instanceof</code>.</p>\n\n<p>Is there a reason why Haskell didn't implement pattern matching for functions such as <code>f</code> above ?</p>\n"}, {"tags": ["haskell", "type-constraints"], "answers": [{"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": false, "score": 2, "last_activity_date": 1488442520, "creation_date": 1488442520, "answer_id": 42550030, "question_id": 42549277, "link": "https://stackoverflow.com/questions/42549277/constraint-manipulation-package/42550030#42550030", "title": "Constraint manipulation package", "body": "<p>In <a href=\"https://hackage.haskell.org/package/generics-sop\" rel=\"nofollow noreferrer\">generics-sop</a>, this kind of constraint manipulation is often needed, because a considerable number of its functions are parameterized over constraints.</p>\n\n<p>The library therefore contains a module <a href=\"https://hackage.haskell.org/package/generics-sop-0.2.4.0/docs/Generics-SOP-Constraint.html\" rel=\"nofollow noreferrer\"><code>Generics.SOP.Constraint</code></a> with a number of these helper classes, in particular your <code>And</code>. More could in principle be added if they turn out to be generally useful.</p>\n\n<p>As far as I know, the constraints library is primarily concerned with a slightly different problem, namely giving you an explicit representation of dictionaries and entailment, providing you with utilities to prove things about type classes that GHC cannot automatically prove. It is certainly possible to combine constraints with this library as well, for example via <a href=\"https://hackage.haskell.org/package/constraints-0.9/docs/Data-Constraint.html#v:-38--38--38-\" rel=\"nofollow noreferrer\"><code>(&amp;&amp;&amp;)</code></a>. Again, generics-sop has similar functionality as well (although it has far fewer functions, and aims to do less), in <a href=\"https://hackage.haskell.org/package/generics-sop-0.2.4.0/docs/Generics-SOP-Dict.html\" rel=\"nofollow noreferrer\"><code>Generics.SOP.Dict</code></a>.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1488442520, "creation_date": 1488439902, "question_id": 42549277, "link": "https://stackoverflow.com/questions/42549277/constraint-manipulation-package", "title": "Constraint manipulation package", "body": "<p>Lets say I have</p>\n\n<pre><code>class C1 t\n</code></pre>\n\n<p>and </p>\n\n<pre><code>class C2 t\n</code></pre>\n\n<p>note here that:</p>\n\n<pre><code>C1 :: * -&gt; Constraint \nC2 :: * -&gt; Constraint\n</code></pre>\n\n<p>I can make</p>\n\n<pre><code>class (C1 t, C2 t) =&gt; C3 t\ninstance (C1 t, C2 t) =&gt; C3 t\n</code></pre>\n\n<p>So we have</p>\n\n<pre><code>C3 :: * -&gt; Constraint\n</code></pre>\n\n<p>noting that <code>C3 t</code> is only valid if <code>C1 t</code> and <code>C2 t</code> is.  </p>\n\n<p>Furthermore, if we add a bunch of extensions:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE UndecidableSuperClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE TypeOperators #-}\n</code></pre>\n\n<p>We can even do something more general like this:</p>\n\n<pre><code>class (c1 a, c2 a) =&gt; And c1 c2 a\ninstance (c1 a, c2 a) =&gt; And c1 c2 a\n\ntype C3 = C1 `And` C2\n</code></pre>\n\n<p>And this works as expected.</p>\n\n<p>This is not the only combination of constraints I want to be able to do, for example, I'd like to be able to combine constraints of two variables, say <code>And2</code>:</p>\n\n<pre><code>class (c1 a b, c2 a b) =&gt; And2 c1 c2 a b\ninstance (c1 a b, c2 a b) =&gt; And2 c1 c2 a b\n</code></pre>\n\n<p>Or add an extra constraint to the first variable:</p>\n\n<pre><code>class (c1 a, c2 a b) =&gt; AddFirst c1 c2 a b\ninstance (c1 a, c2 a b) =&gt; AddFirst c1 c2 a b\n</code></pre>\n\n<p>There's lots of possibilities of course. </p>\n\n<p>Now not wanting to reinvent the wheel, I was looking at the <a href=\"https://hackage.haskell.org/package/constraints\" rel=\"nofollow noreferrer\">constraints</a> package, from which I quote:</p>\n\n<blockquote>\n  <p>ConstraintKinds made type classes into types of a new kind, Constraint.</p>\n</blockquote>\n\n<pre><code>Eq :: * -&gt; Constraint\nOrd :: * -&gt; Constraint \nMonad :: (* -&gt; *) -&gt; Constraint\n</code></pre>\n\n<blockquote>\n  <p>With ConstraintKinds we can put into code a lot of tools for\n  manipulating these new types without such awkward workarounds.</p>\n</blockquote>\n\n<p>This seems like it fits the bill but I kind got lost in the documentation.</p>\n\n<p>Does the <code>constraints</code> package do what I've set out in this post? If so, could you provide an example? If not, is there any other package for constraint manipulation, or should I fill this out into a library myself? </p>\n"}, {"tags": ["haskell", "dictionary", "indexing"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1488416153, "post_id": 42544932, "comment_id": 72225588, "body": "is this <a href=\"https://stackoverflow.com/questions/42492989/haskell-change-all-indices-from-a-list-to-some-value/42493836#42493836\" title=\"haskell change all indices from a list to some value\">stackoverflow.com/questions/42492989/&hellip;</a> question useful to you - I think reading its answers carefully might guide you in the right direction; another hint - read up on <code>zip [1..]</code>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 2, "creation_date": 1488416536, "post_id": 42544932, "comment_id": 72225692, "body": "Have you read and thought about the error message? Rhetorical questions: what is the type of <code>indices</code>? What is the type of <code>(!!)</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 343, "user_id": 3413510, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a4bb04e8e539c57a6b5e1d43e3478579?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/3413510/omar"}, "edited": false, "score": 0, "creation_date": 1488417827, "post_id": 42545044, "comment_id": 72226017, "body": "Thanks a lot, especially for your explanatory notes."}, {"owner": {"reputation": 343, "user_id": 3413510, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a4bb04e8e539c57a6b5e1d43e3478579?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/3413510/omar"}, "edited": false, "score": 0, "creation_date": 1488418116, "post_id": 42545044, "comment_id": 72226082, "body": "If I may ask a follow-up question so that I understand fully what&#39;s going on: so when the compiler complains : Couldn&#39;t match expected type \u2018Int\u2019 with actual type \u2018[Integer]\u2019 : actual type [Integer] here refers to my indices?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 343, "user_id": 3413510, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a4bb04e8e539c57a6b5e1d43e3478579?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/3413510/omar"}, "edited": false, "score": 0, "creation_date": 1488468734, "post_id": 42545044, "comment_id": 72253295, "body": "@omar Yes: &quot;In the second argument of \u2018(!!)\u2019, namely \u2018[x | x &lt;- indices]\u2019...&quot; The second argument of <code>!!</code> expects an <code>Int</code> but you&#39;ve given it a <code>[Integer]</code>"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 5, "last_activity_date": 1488490972, "last_edit_date": 1488490972, "creation_date": 1488416597, "answer_id": 42545044, "question_id": 42544932, "link": "https://stackoverflow.com/questions/42544932/haskell-map-a-list-of-indices-to-a-string/42545044#42545044", "title": "Haskell: map a list of indices to a string", "body": "<p>you are almost there there is just one parenthesis wrong in your example\nchange:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sentence !! [x | x &lt;- indices] -- (1)\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>[sentence !! x | x &lt;- indices] -- (2)\n</code></pre>\n\n<p>but why - well in the \"list comprehension (1)\" you try to apply the indexing operator <code>!!</code> to a list of indices, and the compiler tells you that it expects <code>Int</code> (i.e. an index) but you supply a list.</p>\n\n<p>the latter (2) works because for each index - I fetch the element of that index from the list <code>sentence</code>.</p>\n\n<p><em>Side note</em>: as a beginner this is ok - but if your list is long and your indices are at the end - this takes some time, lists are not the data structure best suited for indexing - <code>Array</code>s, <code>IntMap</code>s, and <code>Seq</code> are way better suited</p>\n\n<h2>Edit2:</h2>\n\n<p>If you like to get your brain going - think what could</p>\n\n<pre><code>zipWith (!!) (repeat sentence) indices\n</code></pre>\n\n<p>do</p>\n"}, {"comments": [{"owner": {"reputation": 343, "user_id": 3413510, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a4bb04e8e539c57a6b5e1d43e3478579?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/3413510/omar"}, "edited": false, "score": 0, "creation_date": 1488486704, "post_id": 42545098, "comment_id": 72264686, "body": "sorry if I didn&#39;t upvote earlier. I am fairly new to SO. I assume to upvote I need to use the up arrow next to your answer, right?"}], "tags": [], "owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "is_accepted": false, "score": 4, "last_activity_date": 1488416984, "creation_date": 1488416984, "answer_id": 42545098, "question_id": 42544932, "link": "https://stackoverflow.com/questions/42544932/haskell-map-a-list-of-indices-to-a-string/42545098#42545098", "title": "Haskell: map a list of indices to a string", "body": "<p>This may seem a little weird, but <code>(sentence !!)</code> is actually a (partially applied) <a href=\"https://wiki.haskell.org/Partial_application\" rel=\"nofollow noreferrer\">function</a>, with type <code>:: Int -&gt; [Char]</code>. You can <code>map</code> it to your list of indexes to obtain the result you want:</p>\n\n<pre><code>&gt; map ([\"this\", \"is\", \"a\", \"simple\", \"sentence\"] !!) [0, 2, 4]\n&gt; [\"this\",\"a\",\"sentence\"]\n</code></pre>\n"}], "owner": {"reputation": 343, "user_id": 3413510, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a4bb04e8e539c57a6b5e1d43e3478579?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/3413510/omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1049, "favorite_count": 1, "accepted_answer_id": 42545044, "answer_count": 2, "score": 1, "last_activity_date": 1488490972, "creation_date": 1488415788, "last_edit_date": 1488416236, "question_id": 42544932, "link": "https://stackoverflow.com/questions/42544932/haskell-map-a-list-of-indices-to-a-string", "title": "Haskell: map a list of indices to a string", "body": "<p>Hello: I have a sentence broken down in to separate words: </p>\n\n<pre><code>[\"this\", \"is\", \"a\", \"simple\", \"sentence\"]\n</code></pre>\n\n<p>And I have a list of <code>indices = [0, 2, 4]</code></p>\n\n<p>I am trying to map the list of indices onto the sentence to return the words at the appropriate index, like this:\nif we apply <code>indices [0, 2, 4]</code> to the sentence we get: </p>\n\n<pre><code>[\"this\", \"a\", \"sentence\"]\n</code></pre>\n\n<p>Here's my code:</p>\n\n<pre><code>sentence !! [x | x &lt;- indices]\n</code></pre>\n\n<p>this is the error message:</p>\n\n<pre><code>  &lt;interactive&gt;:215:7: error:\n\u2022 Couldn't match expected type \u2018Int\u2019 with actual type \u2018[Integer]\u2019\n\u2022 In the second argument of \u2018(!!)\u2019, namely \u2018[x | x &lt;- indices]\u2019\n  In the expression: tex !! [x | x &lt;- indices]\n  In an equation for \u2018it\u2019: it = sentence !! [x | x &lt;- indices\n</code></pre>\n\n<p>I am especially interested in an answer that uses <code>(!!)</code> and/or list comprehensions.</p>\n\n<p>Thank you</p>\n"}]