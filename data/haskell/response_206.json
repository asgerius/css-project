[{"tags": ["haskell", "filtering", "pointfree", "tacit-programming"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1545245457, "post_id": 53857447, "comment_id": 94562699, "body": "Every function can be written in point-free form; the question is, does the point-free form read better than a pointed equivalent?"}], "answers": [{"comments": [{"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 0, "creation_date": 1545246095, "post_id": 53857559, "comment_id": 94562997, "body": "Yes, this is not too bad, I prefer point-free version and vote it up. Does exist more readable answer?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 0, "creation_date": 1545246399, "post_id": 53857559, "comment_id": 94563169, "body": "@JoeChoi I don&#39;t think there&#39;s anything much better since you have two occurrences of <code>xs</code>, so one needs something like <code>&gt;&gt;=</code> or <code>&lt;*&gt;</code> to &quot;duplicate&quot; the implicit argument. Using <code>&lt;*&gt;</code> seems to lead to worse code, IMO."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 1, "creation_date": 1545297748, "post_id": 53857559, "comment_id": 94578708, "body": "@JoeChoi maybe just use the optional parens, <code>filter =&lt;&lt; ((. fst) . (==) . minimum . map fst)</code>, to make the grouping more visually apparent."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1545245691, "creation_date": 1545245691, "answer_id": 53857559, "question_id": 53857447, "link": "https://stackoverflow.com/questions/53857447/point-free-for-filter-function/53857559#53857559", "title": "Point-free for filter function", "body": "<p><a href=\"http://pointfree.io\" rel=\"noreferrer\">pointfree.io</a> outputs this, which is not too bad. I still prefer the original code, though.</p>\n\n<pre><code>findMinimum = filter =&lt;&lt; (. fst) . (==) . minimum . map fst\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1545253607, "post_id": 53858873, "comment_id": 94566111, "body": "Of course, this replaces a pair of O(n) traversals with an O(n lg n) sort."}, {"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 1, "creation_date": 1545279201, "post_id": 53858873, "comment_id": 94572552, "body": "Great answer, thank you. I modify it a little bit for my need to handle empty list: <code>concat . take 1 . groupBy ((==) </code>on` fst) . sortOn fst`. It desired as accepted answer."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1545367119, "post_id": 53858873, "comment_id": 94605472, "body": "I don\u2019t think it\u2019s O(n log n) (using O informally)."}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 4, "last_activity_date": 1545252208, "creation_date": 1545252208, "answer_id": 53858873, "question_id": 53857447, "link": "https://stackoverflow.com/questions/53857447/point-free-for-filter-function/53858873#53858873", "title": "Point-free for filter function", "body": "<p>a different implementation</p>\n\n<pre><code>head . groupBy ((==) `on` fst) . sortOn fst\n</code></pre>\n\n<p>sort and group by first, pick the first sub list.  Perhaps you may want to handle empty list explicitly.</p>\n"}, {"comments": [{"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 0, "creation_date": 1545286225, "post_id": 53862366, "comment_id": 94574211, "body": "Thank you. I vote up for <code>comparing (uncurry Arg)</code> to provide another way to do that as <code>comparing fst</code>. But <code>findMinimum</code> return list of pair as <code>[(a,b)]</code> rather than <code>(a, b)</code>."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1545279754, "creation_date": 1545279754, "answer_id": 53862366, "question_id": 53857447, "link": "https://stackoverflow.com/questions/53857447/point-free-for-filter-function/53862366#53862366", "title": "Point-free for filter function", "body": "<p>Putting the pair in <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Semigroup.html#t:Arg\" rel=\"nofollow noreferrer\"><code>Arg</code></a>, you get ordering on the first element, that you can exploit as follows:</p>\n\n<pre><code>import Data.Semigroup (Arg(..))\nimport Data.Ord (comparing)\n\nfindMinimum :: Ord a =&gt; [(a, b)] -&gt; (a, b)\nfindMinimum = minimumBy (comparing (uncurry Arg))\n</code></pre>\n"}], "owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "accepted_answer_id": 53858873, "answer_count": 3, "score": 4, "last_activity_date": 1545298396, "creation_date": 1545245205, "last_edit_date": 1545298396, "question_id": 53857447, "link": "https://stackoverflow.com/questions/53857447/point-free-for-filter-function", "title": "Point-free for filter function", "body": "<p>Does there exist a point-free function for <code>filter</code> function to find minimum of first element of pair in a list? for example:</p>\n\n<pre><code>findMinimum xs =  filter ((== minimum (map fst xs)) . fst ) xs\n\n-- example:\nfindMinimum [(0, 0), (0, 1), (2, 2), (3, 2), (1, 4)] = [(0, 0), (0, 1)]\n</code></pre>\n\n<p>How to convert <code>findMinimum</code> function to point-free:</p>\n\n<pre><code>findMinimum = ??\n</code></pre>\n"}, {"tags": ["haskell", "input", "output"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1545246199, "post_id": 53857224, "comment_id": 94563055, "body": "What is <code>chain</code>? What does <code>numLongChains</code> have to do with calculating the length of a list outputted from your collatz function? It seems like you are describing two different questions. Which one do you want answered?"}, {"owner": {"reputation": 97, "user_id": 6392671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3aae406e02d04e57b6ba2f9d77ea18c?s=128&d=identicon&r=PG&f=1", "display_name": "Memo", "link": "https://stackoverflow.com/users/6392671/memo"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1545246385, "post_id": 53857224, "comment_id": 94563154, "body": "Ach sorry it is a mistake my chain  is my collatz function. I corrected ready. First I want to calculate length of output form a collanz function."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1545250204, "post_id": 53857224, "comment_id": 94564732, "body": "I don&#39;t understand. What don&#39;t you like about the code you already have?"}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 6392671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3aae406e02d04e57b6ba2f9d77ea18c?s=128&d=identicon&r=PG&f=1", "display_name": "Memo", "link": "https://stackoverflow.com/users/6392671/memo"}, "edited": false, "score": 0, "creation_date": 1545247267, "post_id": 53857773, "comment_id": 94563526, "body": "composed and combined are the same yes?  I wrot step by step because I want write my own filter function too. and not use prelude function to understand it."}, {"owner": {"reputation": 97, "user_id": 6392671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3aae406e02d04e57b6ba2f9d77ea18c?s=128&d=identicon&r=PG&f=1", "display_name": "Memo", "link": "https://stackoverflow.com/users/6392671/memo"}, "edited": false, "score": 0, "creation_date": 1545247554, "post_id": 53857773, "comment_id": 94563657, "body": "How it call in winGHCi this?  combined = length&#39; . collatz"}, {"owner": {"reputation": 525, "user_id": 1651361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1b933ade78a3db95c560fdf309daf56?s=128&d=identicon&r=PG", "display_name": "GreenhouseVeg", "link": "https://stackoverflow.com/users/1651361/greenhouseveg"}, "reply_to_user": {"reputation": 97, "user_id": 6392671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3aae406e02d04e57b6ba2f9d77ea18c?s=128&d=identicon&r=PG&f=1", "display_name": "Memo", "link": "https://stackoverflow.com/users/6392671/memo"}, "edited": false, "score": 0, "creation_date": 1545248670, "post_id": 53857773, "comment_id": 94564083, "body": "Yes, they are the same, I fixed this typo. In GHCi, you can first define the function as written above and then apply it, e.g. <code>composed 5</code>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1545248732, "post_id": 53857773, "comment_id": 94564118, "body": "FYI the parenthesis here are optional and removing them makes the line a bit easier to read imo."}, {"owner": {"reputation": 525, "user_id": 1651361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1b933ade78a3db95c560fdf309daf56?s=128&d=identicon&r=PG", "display_name": "GreenhouseVeg", "link": "https://stackoverflow.com/users/1651361/greenhouseveg"}, "reply_to_user": {"reputation": 97, "user_id": 6392671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3aae406e02d04e57b6ba2f9d77ea18c?s=128&d=identicon&r=PG&f=1", "display_name": "Memo", "link": "https://stackoverflow.com/users/6392671/memo"}, "edited": false, "score": 0, "creation_date": 1545255640, "post_id": 53857773, "comment_id": 94566946, "body": "@Memo, I omitted type signature contexts in my answer at first, but if you have <code>(Integral a)</code> in <code>collatz</code> then you need it even in <code>composed</code>. I have now added contexts to my answer."}], "tags": [], "owner": {"reputation": 525, "user_id": 1651361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1b933ade78a3db95c560fdf309daf56?s=128&d=identicon&r=PG", "display_name": "GreenhouseVeg", "link": "https://stackoverflow.com/users/1651361/greenhouseveg"}, "is_accepted": true, "score": 6, "last_activity_date": 1545255588, "last_edit_date": 1545255588, "creation_date": 1545246727, "answer_id": 53857773, "question_id": 53857224, "link": "https://stackoverflow.com/questions/53857224/pass-output-from-a-function-as-input-in-another-function-in-haskell/53857773#53857773", "title": "Pass output from a function as input in another function in Haskell", "body": "<p>You are talking about <a href=\"https://wiki.haskell.org/Function_composition\" rel=\"nofollow noreferrer\">function composition</a>:</p>\n\n<pre><code>-- assuming signature length' :: [a] -&gt; Int   \ncomposed :: (Integral a) =&gt; a -&gt; Int\ncomposed = length' . collatz\n</code></pre>\n\n<p>I am not sure what you mean by 'step by step', but for your second question, it would be:</p>\n\n<pre><code>numLongChains :: (Integral a) =&gt; [a] -&gt; Int\nnumLongChains = length' . (filter isLong) . (map collatz)\n    where isLong xs = length' xs &gt; 15 \n</code></pre>\n\n<p>I made it a unary function so it can work with any list, not just <code>[1..100]</code>.    </p>\n"}, {"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 2, "last_activity_date": 1545250121, "creation_date": 1545250121, "answer_id": 53858479, "question_id": 53857224, "link": "https://stackoverflow.com/questions/53857224/pass-output-from-a-function-as-input-in-another-function-in-haskell/53858479#53858479", "title": "Pass output from a function as input in another function in Haskell", "body": "<p>The <code>length'</code> of the <code>collatz</code> sequence for <code>n</code> is <code>\\n -&gt; length' (collatz n)</code>. This pattern is so common that we gave it a name: <code>f . g = \\x -&gt; f (g x)</code>. We call this \"function composition\". Replacing <code>f</code>, <code>g</code>, and <code>x</code> above with <code>length'</code>, <code>collatz</code>, and <code>n</code>, we get <code>length' . collatz = \\n -&gt; length' (collatz n)</code>. So:</p>\n\n<pre><code>collatzLength = length' . collatz\n</code></pre>\n\n<p>As an aside, instead of writing <code>isLong</code> as you do, we can use function composition here too, albeit in a slightly less obvious way:</p>\n\n<pre><code>isLong xs = length' xs &gt; 15\nisLong = \\xs -&gt; length' xs &gt; 15\nisLong = \\xs -&gt; (&gt;) (length' xs) 15\nisLong = \\xs -&gt; (&gt; 15) (length' xs) -- this is the less obvious bit\nisLong = (&gt; 15) . length'\n</code></pre>\n\n<p>So the question \"is the collatz sequence for the number n longer than 15?\" can now be written as:</p>\n\n<pre><code>isLongSequence = isLong . collatz\n</code></pre>\n\n<p>So the long sequences for the numbers <code>[1..100]</code> are</p>\n\n<pre><code>filter isLongSequence [1..100]\n</code></pre>\n\n<p>or with</p>\n\n<pre><code>longSequences = filter isLongSequence\n</code></pre>\n\n<p>it's</p>\n\n<pre><code>longSequences [1..100]\n</code></pre>\n\n<p>now, we can write <code>numLongChains</code> as</p>\n\n<pre><code>numLongChains = length' . longSequences\n</code></pre>\n\n<p>The number of long chains is the number (length) of (the list of) long sequences.</p>\n\n<p>Now, to show that this is equivalent to your definition, you need to know a rule (theorem) about map and filter:</p>\n\n<pre><code>filter p . map f = filter (p . f)\n</code></pre>\n\n<p>So </p>\n\n<pre><code>\\xs -&gt; filter isLong (map collatz xs)\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>filter isLong . map collatz\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>filter (isLong . collatz)\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>filter isLongSequence\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>longSequences\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 6392671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3aae406e02d04e57b6ba2f9d77ea18c?s=128&d=identicon&r=PG&f=1", "display_name": "Memo", "link": "https://stackoverflow.com/users/6392671/memo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 864, "favorite_count": 0, "accepted_answer_id": 53857773, "answer_count": 2, "score": 3, "last_activity_date": 1545333396, "creation_date": 1545244103, "last_edit_date": 1545333396, "question_id": 53857224, "link": "https://stackoverflow.com/questions/53857224/pass-output-from-a-function-as-input-in-another-function-in-haskell", "title": "Pass output from a function as input in another function in Haskell", "body": "<p>How can one pass output from a function as an input in another function.</p>\n\n<p>For example I have those two functions</p>\n\n<pre><code>collatz :: (Integral a) =&gt; a -&gt; [a]\ncollatz 1 = [1]  \ncollatz n  \n    |even n = n:collatz (n `div` 2)  \n    |odd n = n:collatz (n*3 + 1) \n</code></pre>\n\n<p>And my another function</p>\n\n<pre><code>length' [] = 0\nlength' (x:xs) = 1 + length' xs\n</code></pre>\n\n<p>I want to calculate the length of a list, which was output from my collatz function.</p>\n\n<p>finally I want calculate completely this </p>\n\n<pre><code>numLongChains :: Int  \nnumLongChains = length (filter isLong (map collatz [1..100]))  \n    where isLong xs = length xs &gt; 15  \n</code></pre>\n\n<p>But step by step.</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 15, "last_activity_date": 1545243105, "creation_date": 1545243105, "answer_id": 53856995, "question_id": 53856606, "link": "https://stackoverflow.com/questions/53856606/why-is-this-unsafecoerce-not-unsafe/53856995#53856995", "title": "Why is this unsafeCoerce not unsafe?", "body": "<p>No official document guarantees it. Ed Kmett is relying on what he knows about the inner workings of GHC. What he knows:</p>\n\n<ol>\n<li>In GHC Core, <code>-&gt;</code> and <code>=&gt;</code> actually mean the same thing.</li>\n<li>Dictionaries for instances of single-method classes without superclasses are erased like newtypes&mdash;the dictionary <em>is</em> the method.</li>\n</ol>\n\n<p>I've actually written a <a href=\"https://github.com/ghc-proposals/ghc-proposals/pull/69\" rel=\"noreferrer\">proposal</a> to try to do this legitimately, but it's tricky to accommodate all the use cases properly.</p>\n"}], "owner": {"reputation": 738, "user_id": 8075159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8709365a90d8a840b976b0f132f912e5?s=128&d=identicon&r=PG&f=1", "display_name": "Hogeyama", "link": "https://stackoverflow.com/users/8075159/hogeyama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 2, "accepted_answer_id": 53856995, "answer_count": 1, "score": 15, "last_activity_date": 1545243105, "creation_date": 1545241363, "question_id": 53856606, "link": "https://stackoverflow.com/questions/53856606/why-is-this-unsafecoerce-not-unsafe", "title": "Why is this unsafeCoerce not unsafe?", "body": "<p>Some library use <code>unsafeCoerce</code> to temporarily satisfy constraint:</p>\n\n<pre><code>class Given a where given :: a\n\nnewtype Gift a r = Gift (Given a =&gt; r)\n\ngive :: forall a r. a -&gt; (Given a =&gt; r) -&gt; r\ngive a k = unsafeCoerce (Gift k :: Gift a r) a\n</code></pre>\n\n<p>(This example is from <a href=\"http://hackage.haskell.org/package/reflection-2.1.4/docs/src/Data.Reflection.html#Given\" rel=\"noreferrer\">reflection</a> package.\n<a href=\"http://hackage.haskell.org/package/singletons-2.5.1/docs/src/Data.Singletons.Internal.html#singInstance\" rel=\"noreferrer\">singletons</a> package also uses this trick.)</p>\n\n<p>Why is this <code>unsafeCoerce</code> safe?\nIs there any official document which guarantee that <code>Given a =&gt; r</code> and <code>a -&gt; r</code> have the same runtime representation in GHC?</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1545235723, "post_id": 53854907, "comment_id": 94557899, "body": "Isn&#39;t this something that can be addressed with the standard <code>DeriveGeneric</code> mechanism of Aeson?"}, {"owner": {"reputation": 1887, "user_id": 4948732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-ZnN3lJjklJg/AAAAAAAAAAI/AAAAAAAAAWE/zqGtDAyXfjo/photo.jpg?sz=128", "display_name": "thesecretmaster", "link": "https://stackoverflow.com/users/4948732/thesecretmaster"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1545235894, "post_id": 53854907, "comment_id": 94557990, "body": "@MarkSeemann I&#39;m not sure what that means and google isn&#39;t spitting out anything useful for &quot;DeriveGeneric Aeson&quot;. Would you mind explaining or linking me somewhere?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1545235969, "post_id": 53854907, "comment_id": 94558028, "body": "<a href=\"http://hackage.haskell.org/package/aeson/docs/Data-Aeson.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/aeson/docs/Data-Aeson.html</a>"}, {"owner": {"reputation": 1887, "user_id": 4948732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-ZnN3lJjklJg/AAAAAAAAAAI/AAAAAAAAAWE/zqGtDAyXfjo/photo.jpg?sz=128", "display_name": "thesecretmaster", "link": "https://stackoverflow.com/users/4948732/thesecretmaster"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1545236371, "post_id": 53854907, "comment_id": 94558261, "body": "@MarkSeemann I don&#39;t think this solves my issue. It still gives a &quot;got String expected EmbeddedType&quot; error."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1545237133, "post_id": 53854907, "comment_id": 94558740, "body": "That&#39;s not something that is addressed by aeson&#39;s deriving stuff."}], "answers": [{"comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1545237395, "post_id": 53855435, "comment_id": 94558871, "body": "you could do <code>baz_ &lt;- o .: &quot;baz&quot;</code> and give <code>baz_</code> type <code>Text</code> (aeson does decoding anyway). That would save the <code>case HM.lookup ....</code>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1545237568, "post_id": 53855435, "comment_id": 94558969, "body": "I think you&#39;ll have to make an explicit call to <code>decode</code> in any case. (<code>parseJSON</code> still requires you to get a <code>Value</code> from somewhere)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1545237667, "post_id": 53855435, "comment_id": 94559029, "body": "@Li-yaoXia <code>withEmbeddedJSON</code> calls <code>decode</code> for you (well, <code>eitherDecode</code>, anyway)."}, {"owner": {"reputation": 1887, "user_id": 4948732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-ZnN3lJjklJg/AAAAAAAAAAI/AAAAAAAAAWE/zqGtDAyXfjo/photo.jpg?sz=128", "display_name": "thesecretmaster", "link": "https://stackoverflow.com/users/4948732/thesecretmaster"}, "edited": false, "score": 0, "creation_date": 1545237941, "post_id": 53855435, "comment_id": 94559183, "body": "Thank you for your help, and the code works, but would you mind helping me out a bit by explaining a couple things? I&#39;m kinda new to Haskell, and I don&#39;t understand 1) how you&#39;re composing <code>withEmbeddedJSON</code> with <code>withObject</code>, 2) Your use of the <code>String</code> type constructor, and 3) How passing <code>parseJSON</code> into <code>withEmbeddedJSON</code> does what we want it to."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 1887, "user_id": 4948732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-ZnN3lJjklJg/AAAAAAAAAAI/AAAAAAAAAWE/zqGtDAyXfjo/photo.jpg?sz=128", "display_name": "thesecretmaster", "link": "https://stackoverflow.com/users/4948732/thesecretmaster"}, "edited": false, "score": 0, "creation_date": 1545238160, "post_id": 53855435, "comment_id": 94559313, "body": "@thesecretmaster For (1) you might like <a href=\"https://stackoverflow.com/q/53725329/791604\">this question</a>; for (2) I looked at the source of <code>withEmbeddedJSON</code> to see what it expected as input; for (3) type inference selects <code>parseJSON :: Value -&gt; Parser EmbeddedType</code>, so it dispatches to your other instance for parsing the embedded JSON."}, {"owner": {"reputation": 1887, "user_id": 4948732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-ZnN3lJjklJg/AAAAAAAAAAI/AAAAAAAAAWE/zqGtDAyXfjo/photo.jpg?sz=128", "display_name": "thesecretmaster", "link": "https://stackoverflow.com/users/4948732/thesecretmaster"}, "edited": false, "score": 0, "creation_date": 1545238457, "post_id": 53855435, "comment_id": 94559485, "body": "@DanielWagner Thank you very much!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1545237597, "last_edit_date": 1545237597, "creation_date": 1545237095, "answer_id": 53855435, "question_id": 53854907, "link": "https://stackoverflow.com/questions/53854907/parsing-embedded-json-with-aeson/53855435#53855435", "title": "Parsing embedded JSON with Aeson", "body": "<p>I guess it would be something like this (untested):</p>\n\n<pre><code>instance FromJSON BaseType where\n  parseJSON = withObject \"BaseType\" $ \\o -&gt; do\n    foo &lt;- o .: \"foo\"\n    bazText &lt;- o .: \"baz\"\n    baz &lt;- withEmbeddedJSON \"EmbeddedType\" parseJSON (String bazText)\n    return $ BaseType { foo=foo, baz=baz }\n</code></pre>\n\n<p>Or you could consider moving the call to <code>withEmbeddedJSON</code> into the <code>EmbeddedType</code> instance; then <code>o .: \"baz\"</code> should Just Work in the <code>BaseType</code> instance, at the cost of no longer having a handle onto a parser that just does <code>EmbeddedType</code> parsing without de-stringifying:</p>\n\n<pre><code>instance FromJSON BaseType where\n  parseJSON = withObject \"BaseType\" $ \\o -&gt; do\n    foo &lt;- o .: \"foo\"\n    baz &lt;- o .: \"baz\"\n    return $ BaseType { foo=foo, baz=baz }\n\ninstance FromJSON EmbeddedType where\n  parseJSON = withEmbeddedJSON \"EmbeddedType\" . withObject \"EmbeddedType\" $ \\o -&gt; do\n    somekey &lt;- o .: \"somekey\"\n    return $ EmbeddedType {somekey=somekey}\n</code></pre>\n"}], "owner": {"reputation": 1887, "user_id": 4948732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-ZnN3lJjklJg/AAAAAAAAAAI/AAAAAAAAAWE/zqGtDAyXfjo/photo.jpg?sz=128", "display_name": "thesecretmaster", "link": "https://stackoverflow.com/users/4948732/thesecretmaster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "accepted_answer_id": 53855435, "answer_count": 1, "score": 0, "last_activity_date": 1545237597, "creation_date": 1545235062, "question_id": 53854907, "link": "https://stackoverflow.com/questions/53854907/parsing-embedded-json-with-aeson", "title": "Parsing embedded JSON with Aeson", "body": "<p>I'm trying to parse embedded JSON of the form</p>\n\n<pre><code>{\n  \"foo\":\"bar\",\n  \"baz\":\"\\{\\\"somekey\\\":\\\"someval\\\"\\}\"\n}\n</code></pre>\n\n<p>with Aeson in Haskell. Here are my types:</p>\n\n<pre><code>data BaseType = BaseType { foo :: String, baz :: EmbeddedType } deriving(Show)\n\ninstance FromJSON BaseType where\n  parseJSON = withObject \"BaseType\" $ \\o -&gt; do\n    foo &lt;- o .: \"foo\"\n    baz &lt;- o .: \"baz\"\n    return $ BaseType { foo=foo, baz=baz }\n\ndata EmbeddedType = EmbeddedType { somekey :: String }\n\ninstance FromJSON EmbeddedType where\n  parseJSON = withObject \"EmbeddedType\" $ \\o -&gt; do\n    somekey &lt;- o .: \"somekey\"\n    return $ EmbeddedType {somekey=somekey}\n</code></pre>\n\n<p>Obviously, the <code>FromJSON</code> instance for <code>BaseType</code> doesn't work, since it sees it as a <code>Value String</code> instead of as more JSON for it to parse. I tried to find a way to use <code>decodeEither</code> in my <code>FromJSON BaseType</code> instance, but that required that I do some black magic to convert from <code>String</code> to <code>ByteString</code>, and I feel like there must be a neater way, possibly related to <code>withEmbeddedJSON</code>.</p>\n\n<p>How can I make this work correctly?</p>\n"}, {"tags": ["haskell", "terminology", "functor", "category-theory"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1545235020, "post_id": 53854853, "comment_id": 94557442, "body": "It&#39;s been a long time since I studied category theory (it was never an area I specialised in, anyway), but I think it&#39;s safe to say it&#39;s not true that &quot;there&#39;s no difference&quot; between covariant and contravariant functors. It&#39;s just that one can be defined in terms of the other, so in mathematical terms the difference is trivial. (Which is not to say that it can&#39;t have non-trivial effects in applications to other areas of mathematics.) Now I&#39;m relatively new to Haskell and not familiar with the Contravariant class, but I imagine it faithfully reproduces the mathematical definition."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1545235326, "post_id": 53854853, "comment_id": 94557659, "body": "so having thought a little more, the reason that <code>Functor</code> and <code>Contravariant</code> are not &quot;the same&quot; in Haskell is probably just because the opposite category to Hask (one in which a morphism from <code>a</code> to <code>b</code> is represented by a function of type <code>b -&gt; a</code>) is just not something that&#39;s particularly natural to think about. This is because Haskell is really all about just <i>one</i> category, and functors are endofunctors on Hask, whereas mathematical category theory is about the relationships (ie. functors between) all sorts of different categories (which are individually important in their own right)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1545235788, "post_id": 53854853, "comment_id": 94557932, "body": "You could easily get by without the <i>concept</i> of contravariant functors, because any such functor is just a covariant functor given the appropriate source category. It&#39;s easier to define a <code>Contravariant</code> typeclass, though, than it is to define <b>Haskell&lt;sup&gt;OP&lt;/sup&gt;</b>."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1545236245, "post_id": 53855163, "comment_id": 94558189, "body": "There <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Functor-Contravariant.html#t:Op\" rel=\"nofollow noreferrer\">is a relatively convenient way to represent Hask^op directly</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1545250809, "post_id": 53855163, "comment_id": 94564979, "body": "@DanielWagner, For most purposes, I would much rather have <code>newtype Op c a b = Op {getOp :: c b a}</code> in <code>Control.Category</code>. How did we get stuck with a <code>(-&gt;)</code>-specialized version in <code>Data.Functor.Contravariant</code> instead? I suppose the more general version could be called <code>Flip</code>, but the current situation is a bit weird."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 6, "last_activity_date": 1545238703, "last_edit_date": 1545238703, "creation_date": 1545236073, "answer_id": 53855163, "question_id": 53854853, "link": "https://stackoverflow.com/questions/53854853/why-is-there-a-distinction-between-co-and-contravariant-functors-in-haskell-but/53855163#53855163", "title": "Why is there a distinction between co and contravariant functors in Haskell but not Category Theory?", "body": "<p>Mathematically, considering contravariant functors as a distinct <em>class</em> of functors is just a notational convenience; the contravariant functor <code>F : C -&gt; D</code> can always be defined as a covariant functor <code>F' : C^{op} -&gt; D</code>, so getting rid of the idea of contravariant functors would just force you to talk about the opposite category explicitly.</p>\n\n<p>In Haskell, the <code>Functor</code> class represents an endofunctor on the (assumed) category <strong>Hask</strong>. There is no convenient way to represent <strong>HASK<sup>OP</sup></strong> directly (or at least, not in a form that helps us define functors from that category), nor is there a typeclass that defines exofunctor*, so instead we define the <code>Contrafunctor</code> class whose <code>contramap</code> function can reverse the arrow from <strong>Hask</strong> \"on demand\", so to speak.</p>\n\n<hr>\n\n<p>* Is \"exofunctor\" a real term? I just made it up to indicate a functor that is not an endofunctor.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 10, "last_activity_date": 1545237369, "last_edit_date": 1545237369, "creation_date": 1545236197, "answer_id": 53855198, "question_id": 53854853, "link": "https://stackoverflow.com/questions/53854853/why-is-there-a-distinction-between-co-and-contravariant-functors-in-haskell-but/53855198#53855198", "title": "Why is there a distinction between co and contravariant functors in Haskell but not Category Theory?", "body": "<p>It's for convenience.</p>\n\n<p>One could get by with a <a href=\"http://hackage.haskell.org/package/categories-1.0.7/docs/Control-Categorical-Functor.html\" rel=\"noreferrer\">more general <code>Functor</code></a> class, and define instances for endofunctors on Hask (corresponding to our existing <code>Functor</code>) and functors from Hask^op to Hask (corresponding to our existing <code>Contravariant</code>). But this comes at a figurative cognitive cost and a quite literal syntactical cost: one must then rely on type inference or type annotations to select an instance, and there are explicit conversions (named <code>Op</code> and <code>getOp</code> in the standard library) into and out of Hask^op.</p>\n\n<p>Using the names <code>fmap</code> and <code>contramap</code> relaxes both costs: readers do not need to run Hindley-Milner in their head to decide which instance is being selected when it is unambiguous, and writers do not need to give explicit conversions or type annotations to select an instance in cases where it is ambiguous.</p>\n\n<p>(I am actually rewriting history a little bit here. The <em>real</em> reason is because the language designers thought the specialized <code>Functor</code> would be useful and hadn't imagined or didn't see a need for a more general <code>Functor</code>. People came along later and noticed it would be useful, sometimes. But experience with the generalized <code>Functor</code> class shows that can be tedious, and that specialized classes for the most common cases turns out to be a surprisingly good fit after all, for the reasons described above.)</p>\n"}, {"tags": [], "owner": {"reputation": 4763, "user_id": 1065586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYTQe.jpg?s=128&g=1", "display_name": "tomferon", "link": "https://stackoverflow.com/users/1065586/tomferon"}, "is_accepted": false, "score": 7, "last_activity_date": 1545236520, "creation_date": 1545236520, "answer_id": 53855282, "question_id": 53854853, "link": "https://stackoverflow.com/questions/53854853/why-is-there-a-distinction-between-co-and-contravariant-functors-in-haskell-but/53855282#53855282", "title": "Why is there a distinction between co and contravariant functors in Haskell but not Category Theory?", "body": "<p>Imagine for a minute we had something like the following.</p>\n\n<pre><code>class MoreAccurateFunctor c d f where\n  fmap :: c a b -&gt; d (f a) (f b)\n</code></pre>\n\n<p>Since <code>(-&gt;)</code> is an instance of <code>Category</code> (this is <em>Hask</em>), we would have that <code>Functor ~ MoreAccurateFunctor (-&gt;) (-&gt;)</code>.</p>\n\n<p>Now, imagine we have <code>Dual (-&gt;)</code>, the dual category of <code>(-&gt;)</code> (this would be <em>Hask<sup>Op</sup></em> and we would have <code>Dual (-&gt;) a b ~ (b -&gt; a)</code>), we would have that <code>Contravariant ~ MoreAccurateFunctor (Dual (-&gt;)) (-&gt;)</code>.</p>\n\n<p>I don't know if this helps but the idea is to point out the fact that <code>Functor</code> and <code>Contravariant</code> are two specialisations of <code>MoreAccurateFunctor</code> while this latter class is closer to the definition of functor in category theory.</p>\n"}], "owner": {"reputation": 3055, "user_id": 1404637, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/27c64d06188fca40d38ecfe3c5b49ff1?s=128&d=identicon&r=PG", "display_name": "alx9r", "link": "https://stackoverflow.com/users/1404637/alx9r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 507, "favorite_count": 3, "answer_count": 3, "score": 7, "last_activity_date": 1545250432, "creation_date": 1545234836, "last_edit_date": 1545250432, "question_id": 53854853, "link": "https://stackoverflow.com/questions/53854853/why-is-there-a-distinction-between-co-and-contravariant-functors-in-haskell-but", "title": "Why is there a distinction between co and contravariant functors in Haskell but not Category Theory?", "body": "<p><a href=\"https://math.stackexchange.com/a/661989/72174\">This answer from a Category Theory perspective</a> includes the following statement:</p>\n\n<blockquote>\n  <p>...the truth is that there's no real distinction between co and contravariant functor, because every functor is just a covariant functor.</p>\n  \n  <p>...</p>\n  \n  <p>More in details a contravariant functor F from a category C to a category D is nothing more than a (covariant) functor of type F&thinsp;:&thinsp;C<sup>op</sup>\u2192D, from the opposite category of C to the category D.</p>\n</blockquote>\n\n<p>On the other hand, Haskell's <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Functor.html\" rel=\"nofollow noreferrer\"><code>Functor</code></a> and <a href=\"https://hackage.haskell.org/package/contravariant-1.5/docs/Data-Functor-Contravariant.html\" rel=\"nofollow noreferrer\"><code>Contravariant</code></a> merely require <code>fmap</code> and <code>contramap</code>, respectively, to be defined for an instance.  This suggests that, from the perspective of Haskell, there exists objects that are <code>Contravariant</code> but are not <code>Functor</code>s (and vice versa).</p>\n\n<p>So it seems that in Category Theory \"there's no real distinction between co and contravariant functors\" while in Haskell there is a distinction between <code>Contravariant</code> and <code>Functor</code>.</p>\n\n<p>I suspect that this difference has something to with all implementation in Haskell happening in Hask, but I'm not sure.  </p>\n\n<p>I think I understand each of the Category Theory and Haskell perspectives on their own, but I'm struggling to find an intuition that connects the two.</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "answers": [{"comments": [{"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1545236780, "post_id": 53854710, "comment_id": 94558527, "body": "<code>simpleHttp</code> actually has the type <code>String -&gt; IO ByteString</code> so I don&#39;t know if <code>apiLinks &gt;&gt;= (process . simpleHttp)</code> would work. EDIT: Just checked. Getting this error <code>\u2022 Couldn&#39;t match type \u2018m0 ByteString\u2019 with \u2018ByteString\u2019</code>"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1545237505, "post_id": 53854710, "comment_id": 94558934, "body": "<code>pPrint</code> is just pretty print. <code>(pPrint) :: (Control.Monad.IO.Class.MonadIO m, Show a) =&gt; a -&gt; m ()</code>"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 0, "last_activity_date": 1545237779, "last_edit_date": 1545237779, "creation_date": 1545234428, "answer_id": 53854710, "question_id": 53854147, "link": "https://stackoverflow.com/questions/53854147/haskell-inserting-a-thread-dealy-between-the-results-of-prelude-sequence-funct/53854710#53854710", "title": "Haskell - Inserting a thread dealy between the results of Prelude.sequence function", "body": "<p>I don't quite follow all the types in your pipeline, so consider this a rough sketch that can be fleshed out. First, you don't want to call <code>sequence</code> too early. Keep your list of <code>IO Bytestring</code> values for now.</p>\n\n<p>Next, you want some function (defined in terms of <code>filteredTitles . onlyElems . parseXML</code>) that takes a <em>single</em> <code>Bytestring</code> and returns an <code>IO ()</code>. If <code>pPrint</code> is the write type, this might simply be</p>\n\n<pre><code>process :: IO ByteString -&gt; IO ()\nprocess ibs = do\n    bs &lt;- ibs\n    pPrint (filteredTitles . onlyElems . parseXML $ bs)\n</code></pre>\n\n<p><code>map process (apiLinks &gt;&gt;= simpleHttp)</code> should result in a list of type <code>[IO ()]</code>.  That could probably be rewrittn in a less clunky fashion, but <em>now</em> we can get to the heart of the answer, which is using <code>intersperse</code> to insert your thread delays before finally sequencing the <code>[IO ()]</code> to get <code>IO [()]</code>.</p>\n\n<pre><code>import Data.List\nlet results = map process (apiLinks &gt;&gt;= simpleHttp)\n    actions = intersperse (threadDelay 1) results \nin sequence actions\n</code></pre>\n\n<p><code>intersperse :: a -&gt; [a] -&gt; [a]</code> works by inserting its first argument between each element of its second. A simple example using strings:</p>\n\n<pre><code>&gt; intersperse '-' \"abc\"\n\"a-b-c\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1545238539, "post_id": 53854788, "comment_id": 94559530, "body": "That works! Just <code>pPrint $ filteredTitles . onlyElems . parseXML &lt;$&gt; content</code> needs to be <code>pPrint $ (filteredTitles . onlyElems . parseXML) content</code>. No need to map it over <code>content</code> since <code>content</code> isn&#39;t a list but an element of it."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "reply_to_user": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1545239558, "post_id": 53854788, "comment_id": 94560049, "body": "@atis yes, you are right, I overlook the type signature of <code>parseXML :: ByteString -&gt; [Content]</code> just pass <code>ByteString</code> as argument, I shall correct it."}], "tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 3, "last_activity_date": 1545239591, "last_edit_date": 1545239591, "creation_date": 1545234651, "answer_id": 53854788, "question_id": 53854147, "link": "https://stackoverflow.com/questions/53854147/haskell-inserting-a-thread-dealy-between-the-results-of-prelude-sequence-funct/53854788#53854788", "title": "Haskell - Inserting a thread dealy between the results of Prelude.sequence function", "body": "<p>One of way to do that is using <code>forM_</code> as</p>\n\n<pre><code>...\ndo listOfContent &lt;- z\n   forM_ listOfContent $\n         \\content -&gt; do pPrint $ (filteredTitles . onlyElems . parseXML) content\n                        threadDelay 1000000\n</code></pre>\n"}], "owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 53854788, "answer_count": 2, "score": -1, "last_activity_date": 1545322388, "creation_date": 1545232582, "last_edit_date": 1545322388, "question_id": 53854147, "link": "https://stackoverflow.com/questions/53854147/haskell-inserting-a-thread-dealy-between-the-results-of-prelude-sequence-funct", "title": "Haskell - Inserting a thread dealy between the results of Prelude.sequence function", "body": "<p>I have some code that looks like this</p>\n\n<pre><code>  listOfIOByteStrings = simpleHttp &lt;$&gt; apiLinks :: [IO ByteString]\n</code></pre>\n\n<p>where <code>apiLinks</code> is a list of links which calls some API function.</p>\n\n<p>I also have this function</p>\n\n<pre><code>  z = sequence listOfIOByteStrings\n</code></pre>\n\n<p><code>sequence</code> has this type <a href=\"https://www.stackage.org/haddock/lts-12.24/base-4.11.1.0/Prelude.html#v:sequence\" rel=\"nofollow noreferrer\">sequence :: Monad m => t (m a) -> m (t a)</a> </p>\n\n<p>What I want to do is add a thread delay between each <code>ByteString</code>'s evaluation.</p>\n\n<p>I'm thinking of using <code>threadDelay</code> <a href=\"https://www.stackage.org/haddock/lts-12.24/base-4.11.1.0/Control-Concurrent.html#v:threadDelay\" rel=\"nofollow noreferrer\">threadDelay :: Int -> IO ()</a> </p>\n\n<p>This is what I'm doing ultimately</p>\n\n<pre><code>listOfContent &lt;- z\npPrint $ filteredTitles . onlyElems . parseXML &lt;$&gt; listOfContent\n</code></pre>\n\n<p>where</p>\n\n<p><a href=\"https://www.stackage.org/haddock/lts-12.24/xml-1.3.14/Text-XML-Light-Input.html#v:parseXML\" rel=\"nofollow noreferrer\">parseXML :: ByteString -> [Content]</a></p>\n\n<p><a href=\"https://www.stackage.org/haddock/lts-12.24/xml/Text-XML-Light-Proc.html#v:onlyElems\" rel=\"nofollow noreferrer\">onlyElems :: [Content] -> [Element]</a></p>\n\n<p>and</p>\n\n<pre><code>filteredTitles :: [Element] -&gt; [String]\n</code></pre>\n\n<hr>\n\n<p>Applying thread-delay between result of sequence would be something like this</p>\n\n<pre><code>printing (filteredTitles . onlyElems . parseXML (bytestring of link1))... \ndelay of 1 sec...\nprinting (filteredTitles . onlyElems . parseXML (bytestring of link2))... \ndelay of 1 sec...\nprinting (filteredTitles . onlyElems . parseXML (bytestring of link3))... \ndelay of 1 sec...\n</code></pre>\n\n<p>I'm not sure how I should go about doing that. </p>\n"}, {"tags": ["haskell", "types", "pattern-matching", "either"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 4, "creation_date": 1545210652, "post_id": 53847520, "comment_id": 94543256, "body": "Can&#39;t reproduce. That code loads fine in GHCi on my system."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 1, "creation_date": 1545210702, "post_id": 53847520, "comment_id": 94543274, "body": "What do you try in GHCi?"}, {"owner": {"reputation": 494, "user_id": 5447207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d96199ece7ba3bc4f3c1d97d645f5fad?s=128&d=identicon&r=PG", "display_name": "Bargros", "link": "https://stackoverflow.com/users/5447207/bargros"}, "edited": false, "score": 3, "creation_date": 1545215900, "post_id": 53847520, "comment_id": 94546342, "body": "what part of the script does GHC complain about?, post the full error"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1545222660, "post_id": 53847520, "comment_id": 94549891, "body": "It sounds like you are trying to create a card with something like <code>Card Hearts Jack</code> instead of <code>Card Hearts (Right Jack)</code>. (Similarly, <code>Card Hearts (Left 3)</code>.)"}, {"owner": {"reputation": 3, "user_id": 10809986, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-wjD1snRJWz0/AAAAAAAAAAI/AAAAAAAAABw/2BcdIDFr0WU/photo.jpg?sz=128", "display_name": "Escutche0n", "link": "https://stackoverflow.com/users/10809986/escutche0n"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1545549801, "post_id": 53847520, "comment_id": 94648831, "body": "@chepner I think I misunderstood the meaning of either which failed to match the data type, especially when type is so important in such a language:)"}, {"owner": {"reputation": 3, "user_id": 10809986, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-wjD1snRJWz0/AAAAAAAAAAI/AAAAAAAAABw/2BcdIDFr0WU/photo.jpg?sz=128", "display_name": "Escutche0n", "link": "https://stackoverflow.com/users/10809986/escutche0n"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1545549852, "post_id": 53847520, "comment_id": 94648841, "body": "@assembly.jc I tried the the card type but forgot Left / Right in Either type. :)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1545573280, "post_id": 53847520, "comment_id": 94652949, "body": "@Escutche0n Another way to think of it is to remember that every value belongs to exactly one type. <code>Jack</code> belongs to <code>Court</code>, so it can&#39;t belong to <code>Either Pip Court</code>, but <code>Right Jack</code> can. (This applies to polymorphic values as well; <code>3</code> is not a single value, but a general name that can be inferred to be <code>3::Int, </code>3::Float`, etc as necessary.)"}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1545228601, "creation_date": 1545228601, "answer_id": 53853005, "question_id": 53847520, "link": "https://stackoverflow.com/questions/53847520/couldnt-match-type-synonym-with-either/53853005#53853005", "title": "Couldn&#39;t match type Synonym with Either", "body": "<p><code>Either</code> isn't simply a union of types; it's a <em>tagged</em> union, which means every value has to explicitly specify which \"side\" of the type the wrapped value occurs on. Here's an example, (with a <code>Show</code> instance derived for your <code>Card</code> type):</p>\n\n<pre><code>*Main&gt; Card Hearts Jack\n\n&lt;interactive&gt;:3:13: error:\n    \u2022 Couldn't match type \u2018Court\u2019 with \u2018Either Pip Court\u2019\n      Expected type: Rank\n        Actual type: Court\n    \u2022 In the second argument of \u2018Card\u2019, namely \u2018Jack\u2019\n      In the expression: Card Hearts Jack\n      In an equation for \u2018it\u2019: it = Card Hearts Jack\n</code></pre>\n\n<p><code>Card</code> expects an argument of type <code>Either Pip Court</code>, but you gave it a plain <code>Court</code> value. With an explicit wrap:</p>\n\n<pre><code>*Main&gt; Card Hearts (Right Jack)\nCard Hearts (Right Jack)\n</code></pre>\n\n<p>The same applies to creating a numbered card:</p>\n\n<pre><code>*Main&gt; Card Hearts 3\n\n&lt;interactive&gt;:5:13: error:\n    \u2022 No instance for (Num Rank) arising from the literal \u20183\u2019\n    \u2022 In the second argument of \u2018Card\u2019, namely \u20183\u2019\n      In the expression: Card Hearts 3\n      In an equation for \u2018it\u2019: it = Card Hearts 3\n*Main&gt; Card Hearts (Left 3)\nCard Hearts (Left 3)\n</code></pre>\n\n<p>You don't need to change the definition of <code>snap</code>, because there is already an <code>Eq</code> instance for <code>Either</code> as long as both wrapped types have <code>Eq</code> instances themselves; it considers any <code>Right</code> value unequal to any <code>Left</code> value, and matching <code>Right</code> or <code>Left</code> values are equal if the wrapped values are equal.</p>\n\n<pre><code>*Main&gt; snap (Card Hearts (Right Jack)) (Card Hearts (Left 3))\n\"...\"\n*Main&gt; snap (Card Hearts (Right Jack)) (Card Spades (Right Jack))\n\"SNAP\"\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 10809986, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-wjD1snRJWz0/AAAAAAAAAAI/AAAAAAAAABw/2BcdIDFr0WU/photo.jpg?sz=128", "display_name": "Escutche0n", "link": "https://stackoverflow.com/users/10809986/escutche0n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 53853005, "answer_count": 1, "score": -5, "last_activity_date": 1545228601, "creation_date": 1545209267, "question_id": 53847520, "link": "https://stackoverflow.com/questions/53847520/couldnt-match-type-synonym-with-either", "title": "Couldn&#39;t match type Synonym with Either", "body": "<p>I'm a beginner learning Haskell. But not so sure how <code>Either</code> works in pattern matching.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>type Rank = Either Pip Court\ntype Pip = Int\ntype Deck = [Card]\ndata Card = Joker | Card Suit Rank\ndata Court = Ace | Jack | Queen | King deriving (Show, Eq, Ord)\ndata Suit = Hearts | Diamonds | Clubs | Spades deriving (Show, Ord, Eq)\n\nsnap :: Card -&gt; Card -&gt; String\nsnap Joker Joker = \"SNAP\"\nsnap (Card s1 r1) (Card s2 r2)\n    | r1 == r2 = \"SNAP\"\nsnap _ _ = \"...\"\n</code></pre>\n\n<p>GHCi told me that <code>Couldn't match type \u2018Court\u2019 with \u2018Either Pip Court\u2019</code>, can anyone help me with it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1545194201, "post_id": 53844239, "comment_id": 94537014, "body": "As an aside, this does not look very memoized to me. Each recursive call to <code>fib</code> makes its own independent copy of the cache, resulting in only sharing the 2 calls in that scope. So instead of 2^n you get n^2 runtime. Better, but still bad."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1545196272, "post_id": 53844239, "comment_id": 94537478, "body": "Funny thing...  How <code>tell</code> works in this case is &quot;very badly&quot;.  It leaks space because <code>Writer</code> is just broken with any <code>Monoid</code> instance where <code>mappend</code> is strict. And <code>mappend</code> for <code>Sum Integer</code> is strict."}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1545197641, "post_id": 53844239, "comment_id": 94537844, "body": "@amalloy i have fixed it"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1545197696, "post_id": 53844239, "comment_id": 94537862, "body": "@Carl any recommendation of what to do instead. and perhaps on explanation of <code>tell</code> because you seem to know it very well??"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1545243991, "post_id": 53847170, "comment_id": 94562074, "body": "I think you are confusing computation-level and type-level objects in this answer; e.g. you write <code>WriterT . return $ ((), Sum 2) = WriterT (m ((), Sum 2))</code>, but there&#39;s no <code>m</code> in scope at the computation level. This mistake is replicated several times. I also find your equations connecting <code>do</code>-syntax bindings to tuples imprecise, even flat-out incorrect."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1545248434, "post_id": 53847170, "comment_id": 94563983, "body": "@DanielWagner Thank for your opinion. for <code>WriterT . return $ ((), Sum 2) = WriterT (m ((), Sum 2))</code>, Do you mean here cannot determine what the type of <code>return</code>? Actually, in this example, it is <code>Identity</code>, may be replace <code>m</code> by <code>Identity</code> will be more clear."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1545249606, "post_id": 53847170, "comment_id": 94564505, "body": "No, I mean I think you are imagining <code>m</code> to be the monad; but in that case <code>m</code> is a <i>type</i> and so not suitable for application to the computation <code>((), Sum 2)</code>. Types are never applied to computations in Haskell. Your example of <code>Identity</code> is especially confusing here, because we have a type-level name <code>Identity</code> and a computation-level name <code>Identity</code> that <i>are different</i>. So when you write <code>Identity ((), Sum 2)</code> instead of <code>m ((), Sum 2)</code>, you make the term more correct, but <i>not</i> because you replace type <code>m</code> with type <code>Identity</code> -- it is because you replace type <code>m</code> with <i>a computation</i>."}], "tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 4, "last_activity_date": 1545252413, "last_edit_date": 1545252413, "creation_date": 1545207814, "answer_id": 53847170, "question_id": 53844239, "link": "https://stackoverflow.com/questions/53844239/haskell-explanation-of-how-tell-works/53847170#53847170", "title": "Haskell - explanation of how `tell` works", "body": "<blockquote>\n  <p>A walk through of how tell works would be really helpful</p>\n</blockquote>\n\n<p>I try to use the two lines of code as below to show how <code>tell</code> function works:</p>\n\n<pre><code>...\ntell (Sum 2)\nreturn (a + b)\n..\n</code></pre>\n\n<p>It is helpful to learn it from <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/src/Control.Monad.Trans.Writer.Lazy.html#tell\" rel=\"nofollow noreferrer\">source</a>:</p>\n\n<pre><code>tell :: (Monad m) =&gt; w -&gt; WriterT w m ()\ntell w = writer ((), w)\n</code></pre>\n\n<p>and </p>\n\n<pre><code>writer :: (Monad m) =&gt; (a, w) -&gt; WriterT w m a\nwriter = WriterT . return\n</code></pre>\n\n<p>so</p>\n\n<pre><code>tell (Sum 2) \n= writer ((), Sum 2) \n= WriterT . return ((), Sum 2)\n= WriterT (Identity ((), Sum 2)) \n</code></pre>\n\n<p>to create a value <code>WriterT (Identity ((), Sum 2))</code> of type <code>WriterT (Sum a) Identity ()</code>.</p>\n\n<p>As <code>WriterT</code> is an instance of <code>Monad</code>, the expressions at the beginning of this answer can be translated as:</p>\n\n<pre><code>tell (Sum 2) &gt;&gt;= \\_ -&gt; return (a + b)\n</code></pre>\n\n<p>Now, we need to see how <code>&gt;&gt;=</code> work of <code>Writer Monad</code> from <a href=\"http://hackage.haskell.org/package/transformers-0.5.5.0/docs/src/Control.Monad.Trans.Writer.Lazy.html#line-194\" rel=\"nofollow noreferrer\">source</a> as below:</p>\n\n<pre><code>m &gt;&gt;= k  = WriterT $ do\n    ~(x, w)  &lt;- runWriterT m\n    ~(y, w') &lt;- runWriterT (k x)\n    return (y, w `mappend` w')\n</code></pre>\n\n<p>To evaluate expression <code>tell (Sum 2) &gt;&gt;= \\_ -&gt; return (a + b)</code> step by step as below:</p>\n\n<pre><code>~(x, w)  &lt;- runWriterT m\n= ~(x, w)  &lt;- runWriterT (tell (Sum 2))\n= ~(x, w)  &lt;- runWriterT (WriterT (Identity ((), Sum 2)))\n= ((), Sum 2)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>~(y, w') &lt;- runWriterT (k a)\n= ~(y, w') &lt;- runWriterT ((\\_ -&gt; return (a + b)) ())\n= ~(y, w') &lt;- runWriterT (return (a + b))\n= ~(y, w') &lt;- runWriterT ( WriterT (Identity ((a + b), mempty))\n= ((a + b), mempty)\n</code></pre>\n\n<p>And</p>\n\n<pre><code>return (y, w `mappend` w')\n= return ((a + b), (Sum 2 `mappend` mempty))\n= Identity ((a + b), Sum 2)\n</code></pre>\n\n<p>Note that <code>return</code> is overloaded the by inner Monad of <code>WriterT</code> not the <code>Writer Monad</code> itself.</p>\n\n<p>Finally:</p>\n\n<pre><code>tell (Sum 2) &gt;&gt;= \\_ -&gt; return (a + b) = WriterT (Identity ((a + b), Sum 2))\n</code></pre>\n\n<p>And</p>\n\n<pre><code>f n = WriterT (Identity ((a + b), Sum 2))\n</code></pre>\n\n<p>Therefore, <code>tell</code> function just \"insert\" <code>Sum 2</code> to <code>Writer</code>.</p>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 2, "answer_count": 1, "score": 2, "last_activity_date": 1545252413, "creation_date": 1545190655, "last_edit_date": 1545197607, "question_id": 53844239, "link": "https://stackoverflow.com/questions/53844239/haskell-explanation-of-how-tell-works", "title": "Haskell - explanation of how `tell` works", "body": "<p>I came across some code to log the recursive calls in a Fibonacci function. I have amended it so that is memoized. In any case I am struggling to understand how the <code>tell</code> function works... and how else I could track the calls in this function</p>\n\n<pre><code>import Debug.Trace\nimport Control.Monad.Trans.Writer\nimport Data.Monoid\nimoort qualified Data.Vector as V\n\nfib :: Int -&gt; Writer (Sum Integer) Integer\nfib x = f x\n  where\n    fibs = f &lt;$&gt; (V.fromList [0..x])\n    f 0 = return 0\n    f 1 = return 1\n    f n =  do a &lt;- fibs V.! (n-1)\n              b &lt;- fibs V.! (n-2)\n              tell (Sum 2)\n              return (a + b)\n</code></pre>\n\n<p>A walk through of how <code>tell</code> works would be really helpful</p>\n"}, {"tags": ["haskell", "higher-order-functions"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1545182746, "post_id": 53843313, "comment_id": 94534762, "body": "Is it possible that you&#39;re expected to use hugs instead of GHC? GHC differs from Haskell 98 (and maybe Haskell 2010?) in that it doesn&#39;t make <code>Eq</code> a superclass of <code>Num</code>, so it is slightly non-standard in this and a couple other ways."}, {"owner": {"reputation": 85, "user_id": 10798044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb3c99e9a747b70a74fe84c089c2685?s=128&d=identicon&r=PG&f=1", "display_name": "DeltaX Gamer PT", "link": "https://stackoverflow.com/users/10798044/deltax-gamer-pt"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1545183028, "post_id": 53843313, "comment_id": 94534813, "body": "Thanks for the reply, but no, I am certainly expected to use GHC..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1545183150, "post_id": 53843313, "comment_id": 94534844, "body": "Then you will either need to use a very old GHC or chat with your teacher. What you ask can&#39;t be done in modern Haskell."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1545183311, "post_id": 53843313, "comment_id": 94534872, "body": "Is there a different method of checking for this property which doesn&#39;t involve <code>Eq</code>? (I thought of adding up the first 0,1,...,<i>n</i> values and seeing if the sum is 0, but that obviously fails if you have any negative numbers...)"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1545183458, "post_id": 53843313, "comment_id": 94534902, "body": "How would you &quot;see&quot; if the sum is 0 without using <code>==</code>, which is defined in <code>Eq</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1545183472, "post_id": 53843313, "comment_id": 94534907, "body": "There is no nontrivial function of type <code>Num a =&gt; a -&gt; Bool</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1545183578, "post_id": 53843313, "comment_id": 94534927, "body": "It may help to keep in mind that the type <code>a</code> in <code>Num a</code> can be a function type such as <code>e -&gt; Integer</code>. You can&#39;t directly compare functions."}, {"owner": {"reputation": 85, "user_id": 10798044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb3c99e9a747b70a74fe84c089c2685?s=128&d=identicon&r=PG&f=1", "display_name": "DeltaX Gamer PT", "link": "https://stackoverflow.com/users/10798044/deltax-gamer-pt"}, "edited": false, "score": 0, "creation_date": 1545184774, "post_id": 53843313, "comment_id": 94535151, "body": "I am not aware of any other methods that may not need to go through this problem. But I certainly cannot say that they do not exist. Nonetheless, we has to do this exercise with higher order functions, so this was automatically what I chose to do."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1545185017, "post_id": 53843313, "comment_id": 94535198, "body": "I don&#39;t see how this exercise involves higher-order functions."}, {"owner": {"reputation": 85, "user_id": 10798044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb3c99e9a747b70a74fe84c089c2685?s=128&d=identicon&r=PG&f=1", "display_name": "DeltaX Gamer PT", "link": "https://stackoverflow.com/users/10798044/deltax-gamer-pt"}, "edited": false, "score": 0, "creation_date": 1545185805, "post_id": 53843313, "comment_id": 94535350, "body": "zipWith and all are the Higher order functions that allow me not to have to write the function with explicit recursion"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1545186063, "post_id": 53843313, "comment_id": 94535404, "body": "Ah - I was wondering why you didn&#39;t use explicit recursion, which would have been simpler. By the way, you can also use <code>f &lt;*&gt; x</code>, which does the same thing as <code>zipWith ($) f x</code>."}, {"owner": {"reputation": 85, "user_id": 10798044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb3c99e9a747b70a74fe84c089c2685?s=128&d=identicon&r=PG&f=1", "display_name": "DeltaX Gamer PT", "link": "https://stackoverflow.com/users/10798044/deltax-gamer-pt"}, "edited": false, "score": 0, "creation_date": 1545186232, "post_id": 53843313, "comment_id": 94535434, "body": "Omg, that help a hell of a lot ! Thank you !"}, {"owner": {"reputation": 85, "user_id": 10798044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb3c99e9a747b70a74fe84c089c2685?s=128&d=identicon&r=PG&f=1", "display_name": "DeltaX Gamer PT", "link": "https://stackoverflow.com/users/10798044/deltax-gamer-pt"}, "edited": false, "score": 6, "creation_date": 1545219588, "post_id": 53843313, "comment_id": 94548280, "body": "I just e-mailed my teacher and yes, it really was a mistake in the making of the exercise"}], "owner": {"reputation": 85, "user_id": 10798044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb3c99e9a747b70a74fe84c089c2685?s=128&d=identicon&r=PG&f=1", "display_name": "DeltaX Gamer PT", "link": "https://stackoverflow.com/users/10798044/deltax-gamer-pt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 159, "favorite_count": 0, "closed_date": 1548374015, "answer_count": 0, "score": 5, "last_activity_date": 1548367462, "creation_date": 1545182190, "last_edit_date": 1545183148, "question_id": 53843313, "link": "https://stackoverflow.com/questions/53843313/num-a-vs-eq-a", "closed_reason": "Not suitable for this site", "title": "(Num a) vs (Eq a)", "body": "<p>As an exercise for college, I was asked to create a program to test if a matrix is higher triangular.\nThe type of the function was predefined in the question. It had to be</p>\n\n<pre><code>triSup :: Num a =&gt; Mat a -&gt; Bool\n</code></pre>\n\n<p>So I made this chunk of code, right here:</p>\n\n<pre><code>type Mat a = [[a]]\n\ntriSup :: Num a =&gt; Mat a -&gt; Bool  \ntriSup m = all (==0) (zero m)\n\nzero :: Num a =&gt; Mat a -&gt; [a]  \nzero m = concat (zipWith ($) (zipWith ($) (replicate (length m) take) [0..((length m)-1)]) m)\n</code></pre>\n\n<p>Problem is, ghci says he can't compare my Numeric a's with 0 (which I do not understand why btw). It says I need Eq a, even though I cannot alter the function's type. I need help.</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 6, "last_activity_date": 1545172534, "creation_date": 1545172534, "answer_id": 53842128, "question_id": 53841764, "link": "https://stackoverflow.com/questions/53841764/do-inner-bang-patterns-always-force-outer-constructors-in-haskell/53842128#53842128", "title": "Do inner bang patterns always force outer constructors in Haskell?", "body": "<p>Indeed this is correct. We can see what is evaluated using <code>:sprint</code> in <code>GHCi</code>, which shows us what thunks have been evaluated.</p>\n\n<p>With no bang patterns:</p>\n\n<pre><code>\u03bb data D = D Int\n\u03bb d1 = D 1\n\u03bb :sprint d1\nd1 = _\n\u03bb f1 (D _) = 0\n\u03bb f1 d1\n0\n\u03bb :sprint d1\nd1 = &lt;D&gt; _ -- Only D evaluated\n</code></pre>\n\n<p>With an inner bang pattern:</p>\n\n<pre><code>\u03bb d2 = D 2\n\u03bb :sprint d2\nd2 = _\n\u03bb f2 (D !_) = 0\n\u03bb f2 d2\n0\n\u03bb :sprint d2\nd2 = &lt;D&gt; 2 -- Everything evaluated\n</code></pre>\n\n<p>With an outer bang pattern:</p>\n\n<pre><code>\u03bb d3 = D 3\n\u03bb :sprint d3\nd3 = _\n\u03bb f3 !(D _) = 0\n\u03bb f3 d3\n0\n\u03bb :sprint d3\nd3 = &lt;D&gt; _ -- Only D evaluated\n</code></pre>\n\n<p>With an inner and outer bang patterns:</p>\n\n<pre><code>\u03bb d4 = D 4\n\u03bb :sprint d4\nd4 = _\n\u03bb f4 !(D !_) = 0\n\u03bb f4 d4\n0\n\u03bb :sprint d4\nd4 = &lt;D&gt; 4 -- Everything evaluated\n</code></pre>\n\n<p>From this we can easily see that the patterns <code>!(D !_)</code> and <code>(D !_)</code> are equivalent, and moreover that patterns of the form <code>!(D ...)</code> are redundant.</p>\n"}], "owner": {"reputation": 21995, "user_id": 263061, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/7c724c96f7ec19f73245499b6169e329?s=128&d=identicon&r=PG", "display_name": "nh2", "link": "https://stackoverflow.com/users/263061/nh2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 3, "accepted_answer_id": 53842128, "answer_count": 1, "score": 9, "last_activity_date": 1545172534, "creation_date": 1545170610, "question_id": 53841764, "link": "https://stackoverflow.com/questions/53841764/do-inner-bang-patterns-always-force-outer-constructors-in-haskell", "title": "Do inner bang patterns always force outer constructors in Haskell?", "body": "<p>In Haskell, is there ever a situation where for a data type</p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\nimport Control.DeepSeq\n\ndata D = D Int\n</code></pre>\n\n<p>the instance</p>\n\n<pre><code>instance NFData D where\n  rnf (D !_) = ()\n</code></pre>\n\n<p>can have a different effect than the instance with another outer <code>!</code>:</p>\n\n<pre><code>instance NFData D where\n  rnf !(D !_) = ()\n</code></pre>\n\n<p>My research:</p>\n\n<ul>\n<li><a href=\"https://downloads.haskell.org/~ghc/8.6.3/docs/html/users_guide/glasgow_exts.html#bang-patterns-informal\" rel=\"noreferrer\">https://downloads.haskell.org/~ghc/8.6.3/docs/html/users_guide/glasgow_exts.html#bang-patterns-informal</a> only talks about <code>let</code> bindings (like <a href=\"https://stackoverflow.com/questions/6509399/tuple-bang-patterns\">this</a> answer), which I think doesn't apply for function pattern matches like this.</li>\n<li><p><a href=\"https://prime.haskell.org/wiki/BangPatterns#Thebasicidea\" rel=\"noreferrer\">https://prime.haskell.org/wiki/BangPatterns#Thebasicidea</a> says</p>\n\n<blockquote>\n  <p>A bang only really has an effect if it precedes a variable or wild-card pattern</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>putting a bang before a pattern that forces evaluation anyway does nothing</p>\n</blockquote>\n\n<p>and I think</p>\n\n<ul>\n<li><code>rnf (D _)</code> already forces evaluation anyway\n\n<ul>\n<li>because it's like <code>rnf x = case x of D _ -&gt; ...</code></li>\n</ul></li>\n<li>so <code>rnf !(D _)</code> would have the same effect as <code>rnf (D _)</code></li>\n<li>and thus by substitution <code>rnf !(D !_)</code> must have the same effect as <code>rnf (D !_)</code></li>\n</ul></li>\n</ul>\n\n<p>So I think <em>no, these two are always equivalent</em>, but I'm asking anyway to have one super clear answer to refer people to.</p>\n"}, {"tags": ["macos", "haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1545160231, "post_id": 53839144, "comment_id": 94527417, "body": "Does anything happen if you hover over <code>++</code>? From a video it looks like that triggers some information to be shown."}, {"owner": {"reputation": 1658, "user_id": 1411869, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cd64b633df80262c37b51189fd1648ec?s=128&d=identicon&r=PG", "display_name": "Bob Ueland", "link": "https://stackoverflow.com/users/1411869/bob-ueland"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1545162133, "post_id": 53839144, "comment_id": 94528246, "body": "what video? If I hover over ++ in Playground of Haskell for Mac nothing happens"}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1545165532, "post_id": 53839144, "comment_id": 94529766, "body": "not on a mac, but do tooltips as illustrated in <a href=\"http://haskellformac.com/images/functions-and-types-squashed-800-1.jpg\" rel=\"nofollow noreferrer\">this image from haskellformac.com</a> not appear?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1545169950, "post_id": 53839144, "comment_id": 94531435, "body": "I was checking <a href=\"http://haskellformac.com/haskell-for-mac-learning-haskell.html\" rel=\"nofollow noreferrer\">this</a> which shows some tooltips appearing. I&#39;m not sure about how that works."}], "answers": [{"tags": [], "owner": {"reputation": 1658, "user_id": 1411869, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cd64b633df80262c37b51189fd1648ec?s=128&d=identicon&r=PG", "display_name": "Bob Ueland", "link": "https://stackoverflow.com/users/1411869/bob-ueland"}, "is_accepted": false, "score": 2, "last_activity_date": 1545191690, "creation_date": 1545191690, "answer_id": 53844356, "question_id": 53839144, "link": "https://stackoverflow.com/questions/53839144/is-there-a-way-to-get-info-about-a-built-in-function-in-haskell-for-mac/53844356#53844356", "title": "Is there a way to get info about a built in function in Haskell for Mac", "body": "<p>Just select and hit Cmd+I. </p>\n\n<p>If I took the time to read the badges appearing I would have spotted it :$ </p>\n\n<p><a href=\"https://i.stack.imgur.com/rhGxC.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/rhGxC.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 1658, "user_id": 1411869, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cd64b633df80262c37b51189fd1648ec?s=128&d=identicon&r=PG", "display_name": "Bob Ueland", "link": "https://stackoverflow.com/users/1411869/bob-ueland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1545299780, "creation_date": 1545158006, "last_edit_date": 1545299780, "question_id": 53839144, "link": "https://stackoverflow.com/questions/53839144/is-there-a-way-to-get-info-about-a-built-in-function-in-haskell-for-mac", "title": "Is there a way to get info about a built in function in Haskell for Mac", "body": "<p>I am trying out Haskell for Mac as an alternative to bash and ghci (for learning Haskell). With ghci I can get info about things I see in other people's code. For instance if I wonder about ++ I can write :i followed by ++ and ghci tells me that I can find info in GHC.Base.</p>\n\n<p><a href=\"https://i.stack.imgur.com/zrPv7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zrPv7.png\" alt=\"enter image description here\"></a></p>\n\n<p>Is there some way to do that in Haskell for Mac?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1545154361, "post_id": 53838258, "comment_id": 94524669, "body": "Well it is quite similar, except that you first consider the &quot;row index&quot;, and do more or less the same, except that the <code>[x]</code> part should be changed with an <code>insert</code> like the one you did here."}, {"owner": {"reputation": 1, "user_id": 10806009, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210642934787989/picture?type=large", "display_name": "Toni \u0160losel", "link": "https://stackoverflow.com/users/10806009/toni-%c5%a0losel"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1545154532, "post_id": 53838258, "comment_id": 94524753, "body": "insert x n xs = take n xs ++ [x] ++ drop (n + 1) xs                                                                      insert2D x n xs xss =take  xss ++ insert x n xs ++ drop (xs + 1) xss                        I tried something like this, but it doesn&#39;t work."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1545154598, "post_id": 53838258, "comment_id": 94524789, "body": "No... You need to obtain the row at the given row index, furthermore <code>take</code> is missing an argument."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1545156124, "post_id": 53838258, "comment_id": 94525577, "body": "That is not an array."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 0, "last_activity_date": 1545157246, "last_edit_date": 1545157246, "creation_date": 1545155824, "answer_id": 53838631, "question_id": 53838258, "link": "https://stackoverflow.com/questions/53838258/haskell-insert-an-element-into-nth-position-in-an-2d-array/53838631#53838631", "title": "Haskell - insert an element into nth position in an 2D array", "body": "<p>If you write the recursion explicitly, rather than using <code>take</code> and <code>drop</code>, the pattern is easier to see.</p>\n\n<pre><code>-- Either replace the old first element with the new first element,\n-- or insert the new element into the tail of the list and prepend\n-- the old first element.\ninsert1D :: a -&gt; Int -&gt; [a] -&gt; [a]\ninsert1D x' 0 (_:xs) = x':xs\ninsert1D x' p (x:xs) = x : insert1D x' (p - 1) xs\n\n-- Likewise, either replace the old first row with a new first row\n-- (which you get using insert1D), or insert the new element into\n-- the tail of the array and prepend the old first row.\ninsert2D :: a -&gt; Int -&gt; Int -&gt; [[a]] -&gt; [[a]]\ninsert2D x'  0 py (r:rs) = insert1D x' py r : rs\ninsert2D x' px py (r:rs) = r : insert2D x' (px - 1) py rs\n</code></pre>\n\n<p>Comparing base case to base case:</p>\n\n<pre><code>insert1D x' 0    (_:xs) = x'               : xs\ninsert2D x' 0 py (r:rs) = insert1D x' py r : rs\n</code></pre>\n\n<p>and inductive case to inductive case:</p>\n\n<pre><code>insert1D x' p     (x:xs) = x : insert1D x' (p - 1)     xs\ninsert2D x' px py (r:rs) = r : insert2D x' (px - 1) py rs\n</code></pre>\n\n<p>(The two are even more similar if you imagine a function like</p>\n\n<pre><code>-- A zero-dimensional array is just a single element. To\n-- \"insert\" a new element, we just ignore the old one and\n-- return the new one.\ninsert0D :: a -&gt; a -&gt; a\ninsert0D = flip const\n</code></pre>\n\n<p>being used in the definition of <code>insert1D</code> instead of using <code>x'</code> directly:</p>\n\n<pre><code>insert1D x' 0    (_:xs) = insert0D x'    x : xs\ninsert2D x' 0 py (r:rs) = insert1D x' py r : rs\n</code></pre>\n\n<p>)</p>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1545156299, "creation_date": 1545156299, "answer_id": 53838753, "question_id": 53838258, "link": "https://stackoverflow.com/questions/53838258/haskell-insert-an-element-into-nth-position-in-an-2d-array/53838753#53838753", "title": "Haskell - insert an element into nth position in an 2D array", "body": "<p>If you use an array, and not a list like your question shows, then:</p>\n\n<pre><code>writeArray arr (x,y) val\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10806009, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210642934787989/picture?type=large", "display_name": "Toni \u0160losel", "link": "https://stackoverflow.com/users/10806009/toni-%c5%a0losel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 436, "favorite_count": 0, "accepted_answer_id": 53838631, "answer_count": 2, "score": -1, "last_activity_date": 1563080304, "creation_date": 1545154255, "last_edit_date": 1563080304, "question_id": 53838258, "link": "https://stackoverflow.com/questions/53838258/haskell-insert-an-element-into-nth-position-in-an-2d-array", "title": "Haskell - insert an element into nth position in an 2D array", "body": "<p>How do I insert an element into a 2D array?\nHere is an example:</p>\n\n<pre><code>insert2D 732 2 1 [[1..3],[4..6],[7..9]] = [[1, 2, 3], \n                [4, 5, 732],[7, 8, 9]]\n</code></pre>\n\n<p>I managed to do it with list:</p>\n\n<pre><code>insert :: a -&gt; Int -&gt; [a] -&gt; [a]\ninsert x n xs = take n xs ++ [x] ++ drop (n + 1) xs\n</code></pre>\n"}, {"tags": ["xml", "parsing", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 818, "user_id": 1542000, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/lK7QR.jpg?s=128&g=1", "display_name": "cronburg", "link": "https://stackoverflow.com/users/1542000/cronburg"}, "is_accepted": true, "score": 1, "last_activity_date": 1545159390, "creation_date": 1545159390, "answer_id": 53839447, "question_id": 53838068, "link": "https://stackoverflow.com/questions/53838068/haskell-how-to-parse-xml-response-into-haskell-datatypes/53839447#53839447", "title": "Haskell - How to parse XML response into Haskell datatypes?", "body": "<p>It looks like the most pertinent types that you'll want to pattern match on <a href=\"https://hackage.haskell.org/package/xml-1.3.14/docs/Text-XML-Light-Types.html\" rel=\"nofollow noreferrer\">can be found here.</a> Namely you'll want to take the <code>[Content]</code> results that the <code>parseXML</code> function from <code>Text.XML.Light.Input</code> returns and pattern match on each individual <code>Content</code> instance, mostly ignoring the <code>CRef</code> data constructor and instead focusing on <code>Elem</code>s because those are the XML tags that you care about (in addition to the <code>Text</code> constructors, which contain the non-XML strings found inside an XML tag).</p>\n\n<p>For example you'll want to do something like the following:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-12.24 --install-ghc runghc --package xml\nimport Text.XML.Light\nimport Data.Maybe\n\ndata MyXML =\n    MyXML String [MyXML] -- Nested XML elements\n  | Leaf  String         -- Leaves in the XML doc\n  | Unit\n  deriving (Show)\n\nc2type :: Content -&gt; Maybe MyXML\nc2type (Text s) = Just $ Leaf $ cdData s\nc2type (CRef _) = Nothing\nc2type (Elem e) = Just $ MyXML (qName $ elName e) (mapMaybe c2type (elContent e))\n\nmain :: IO ()\nmain = do\n  dat &lt;- readFile \"input.xml\"\n  let xml = parseXML dat\n--  print xml\n  print $ mapMaybe c2type xml\n</code></pre>\n\n<p>For the above code snippet, say <code>input.xml</code> contains the following XML:</p>\n\n<pre><code>&lt;work&gt;\n  &lt;a&gt;1&lt;/a&gt;\n  &lt;b&gt;2&lt;/b&gt;\n&lt;/work&gt;\n</code></pre>\n\n<p>Then running the example produces:</p>\n\n<pre><code>$ ./xml.hs \n[MyXML \"work\" [Leaf \"\\n  \",MyXML \"a\" [Leaf \"1\"],Leaf \"\\n  \",MyXML \"b\" [Leaf \"2\"],Leaf \"\\n\"],Leaf \"\\n\"]\n</code></pre>\n\n<p>The functions you'll probably find most interesting for your more extensive use case will probably include:</p>\n\n<pre><code>(qName . elName) -- Get the name of a tag in String format from an Elem\nelContent -- Recursively extract the XML tag contents of an Elem\nelAttribs -- Can check those 'type' attributes on some of your tags\n</code></pre>\n\n<p>In order to take a look at the general structure of the data types that the XML parser returns for your code, I strongly recommend e.g. uncommenting the <code>print xml</code> line in the code example above and inspecting the list of Contents it spits out on the command line. That alone should tell you exactly which fields you care about. For example this is what you get for my more minimal XML input example:</p>\n\n<pre><code>[Elem (Element {elName = QName {qName = \"work\", qURI = Nothing, qPrefix = Nothing}, elAttribs = [], elContent = [Text (CData {cdVerbatim = CDataText, cdData = \"\\n  \", cdLine = Just 1}),Elem (Element {elName = QName {qName = \"a\", qURI = Nothing, qPrefix = Nothing}, elAttribs = [], elContent = [Text (CData {cdVerbatim = CDataText, cdData = \"1\", cdLine = Just 2})], elLine = Just 2}),Text (CData {cdVerbatim = CDataText, cdData = \"\\n  \", cdLine = Just 2}),Elem (Element {elName = QName {qName = \"b\", qURI = Nothing, qPrefix = Nothing}, elAttribs = [], elContent = [Text (CData {cdVerbatim = CDataText, cdData = \"2\", cdLine = Just 3})], elLine = Just 3}),Text (CData {cdVerbatim = CDataText, cdData = \"\\n\", cdLine = Just 3})], elLine = Just 1}),Text (CData {cdVerbatim = CDataText, cdData = \"\\n\", cdLine = Just 4})]\n</code></pre>\n"}], "owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "accepted_answer_id": 53839447, "answer_count": 1, "score": 0, "last_activity_date": 1545159390, "creation_date": 1545153428, "question_id": 53838068, "link": "https://stackoverflow.com/questions/53838068/haskell-how-to-parse-xml-response-into-haskell-datatypes", "title": "Haskell - How to parse XML response into Haskell datatypes?", "body": "<p>I'm a beginner trying to learn Haskell by doing some simple parsing problems. I have this XML files. It's a Goodreads' API response.</p>\n\n<pre><code>&lt;GoodreadsResponse&gt;\n    &lt;Request&gt;\n        &lt;authentication&gt;true&lt;/authentication&gt;\n        &lt;key&gt;API_KEY&lt;/key&gt;\n        &lt;method&gt;search_search&lt;/method&gt;\n    &lt;/Request&gt;\n    &lt;search&gt;\n        &lt;query&gt;fantasy&lt;/query&gt;\n        &lt;results-start&gt;1&lt;/results-start&gt;\n        &lt;results-end&gt;20&lt;/results-end&gt;\n        &lt;total-results&gt;53297&lt;/total-results&gt;\n        &lt;source&gt;Goodreads&lt;/source&gt;\n        &lt;query-time-seconds&gt;0.15&lt;/query-time-seconds&gt;\n        &lt;results&gt;\n            &lt;work&gt;\n                &lt;id type=\"integer\"&gt;4640799&lt;/id&gt;\n                &lt;books_count type=\"integer\"&gt;640&lt;/books_count&gt;\n                &lt;ratings_count type=\"integer\"&gt;5640935&lt;/ratings_count&gt;\n                &lt;text_reviews_count type=\"integer\"&gt;90100&lt;/text_reviews_count&gt;\n                &lt;original_publication_year type=\"integer\"&gt;1997&lt;/original_publication_year&gt;\n                &lt;original_publication_month type=\"integer\"&gt;6&lt;/original_publication_month&gt;\n                &lt;original_publication_day type=\"integer\"&gt;26&lt;/original_publication_day&gt;\n                &lt;average_rating&gt;4.46&lt;/average_rating&gt;\n                &lt;best_book type=\"Book\"&gt;\n                    &lt;id type=\"integer\"&gt;3&lt;/id&gt;\n                    &lt;title&gt;Harry Potter and the Sorcerer's Stone (Harry Potter, #1)&lt;/title&gt;\n                    &lt;author&gt;\n                        &lt;id type=\"integer\"&gt;1077326&lt;/id&gt;\n                        &lt;name&gt;J.K. Rowling&lt;/name&gt;\n                    &lt;/author&gt;\n                    &lt;image_url&gt;https://images.gr-assets.com/books/1474154022m/3.jpg&lt;/image_url&gt;\n                    &lt;small_image_url&gt;https://images.gr-assets.com/books/1474154022s/3.jpg&lt;/small_image_url&gt;\n                &lt;/best_book&gt;\n            &lt;/work&gt;\n              ...\n              ...\n              ...\n              ...\n</code></pre>\n\n<p>This is what I've got so far</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n\nmodule Lib where\n\nimport           Data.ByteString.Lazy (ByteString)\nimport           Data.Text            (Text)\nimport           GHC.Generics         (Generic)\nimport           Network.HTTP.Conduit (simpleHttp)\nimport           Text.Pretty.Simple   (pPrint)\nimport           Text.XML.Light\n\ndata GRequest = GRequest { authentication :: Text\n                         , key            :: Text\n                         , method         :: Text\n                         }\n              deriving (Generic, Show)\n\ndata GSearch = GSearch { query              :: Text\n                       , results_start      :: Int\n                       , results_end        :: Int\n                       , total_results      :: Int\n                       , source             :: Text\n                       , query_time_seconds :: Float\n                       , search_results     :: GResults\n                       }\n             deriving (Generic, Show)\n\ndata GResults = GResults { results :: [Work] }\n              deriving (Generic, Show)\n\n\ndata Work = Work { id                       :: Int\n                 , booksCount               :: Int\n                 , ratingsCount             :: Int\n                 , text_reviewsCount        :: Int\n                 , originalPublicationYear  :: Int\n                 , originalPublicationMonth :: Int\n                 , originalPublicationDay   :: Int\n                 , averageRating            :: Float\n                 , bestBook                 :: Book\n                 }\n            deriving (Generic, Show)\n\ndata Book = Book { bID            :: Int\n                 , bTitle         :: Text\n                 , bAuthor        :: Author\n                 , bImageURL      :: Maybe Text\n                 , bSmallImageURL :: Maybe Text\n                 }\n            deriving (Generic, Show)\n\n\ndata Author = Author { authorID   :: Int\n                     , authorName :: Text\n                     }\n              deriving (Generic, Show)\n\n\ndata GoodreadsResponse = GoodreadsResponse { request :: GRequest\n                                           , search  :: GSearch\n                                           }\n                         deriving (Generic, Show)\n\n\n\nmain :: IO ()\nmain = do\n  x &lt;- simpleHttp apiString :: IO ByteString -- apiString is the API URL\n  let listOfElements = onlyElems $ parseXML x\n      filteredElements = concatMap (findElements (simpleName \"work\")) listOfElements\n      simpleName s = QName s Nothing Nothing\n  pPrint $ filteredElements\n</code></pre>\n\n<p>Ultimately what I want to do is put every aspect of <code>&lt;work&gt;&lt;/work&gt;</code> (from <code>&lt;results&gt; .. &lt;/results&gt;</code>) into haskell workable types.</p>\n\n<p>But I'm not sure how to go about doing that. I'm using the <a href=\"http://hackage.haskell.org/package/xml\" rel=\"nofollow noreferrer\">xml</a> package to parse it into default types. But don't know how to put that into my custom types.</p>\n"}, {"tags": ["haskell", "ghci", "fltk", "stackage"], "answers": [{"tags": [], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "is_accepted": false, "score": -1, "last_activity_date": 1545153460, "creation_date": 1545153460, "answer_id": 53838076, "question_id": 53837823, "link": "https://stackoverflow.com/questions/53837823/haskell-stack-build-fltkhs-after-changes/53838076#53838076", "title": "Haskell stack build FLTKHS after changes", "body": "<p>Found out that future builds are way quicker. Not as fast as GHCi though... </p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1545153460, "creation_date": 1545152415, "question_id": 53837823, "link": "https://stackoverflow.com/questions/53837823/haskell-stack-build-fltkhs-after-changes", "title": "Haskell stack build FLTKHS after changes", "body": "<p>Busy discovering Haskell libs. Found FLTKHS for GUI building. Its example <code>fltks-hello-world</code> works great as a skeleton for discovering the all the lib has to offer. However: when changing anything in the source file (<code>fltkhs-hello-world.hs</code>), does one need to <code>stack build</code> it all over? GHCi doesn't seem to grasp the FLTKHS imports, so the REPL is IMO no viable option. Interested in your way of working to learn....</p>\n"}, {"tags": ["haskell", "polymorphism", "overloading", "typeclass"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1545152750, "post_id": 53837669, "comment_id": 94523886, "body": "A sum type, such as <code>SuperX</code>, is the most common but not always the &quot;best&quot; solution.  What is best depends a lot on how you are consuming these values as well as personal style.  For example, you could tail call the remainder of your computation such as <code>createAndApply :: (A -&gt; x) -&gt; (B -&gt; x) -&gt; (C -&gt; x) -&gt; String -&gt; x</code>.  You could also use some dynamic typing, but that is rarely considered &quot;best&quot;."}, {"owner": {"reputation": 1504, "user_id": 1173521, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e53bbfee240b8cbd7af6e5629968a48b?s=128&d=identicon&r=PG", "display_name": "samvv", "link": "https://stackoverflow.com/users/1173521/samvv"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1545153227, "post_id": 53837669, "comment_id": 94524129, "body": "Thanks for the comment! I didn&#39;t know about dynamic typing, but that seems indeed like overkill. Seems like it&#39;s going to become <code>SuperX</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1545157391, "post_id": 53837669, "comment_id": 94526162, "body": "I think we need more details. E.g., are the three types actually three (and not, say, ten)? How many methods, roughly, in class <code>X</code>? Are you accessing the returned value only through methods of such class? There is a way to return &quot;some instance of a typeclass&quot;, using an existential type, but this is often regarded as an <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">antipattern</a>, so we should be careful here."}, {"owner": {"reputation": 1504, "user_id": 1173521, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e53bbfee240b8cbd7af6e5629968a48b?s=128&d=identicon&r=PG", "display_name": "samvv", "link": "https://stackoverflow.com/users/1173521/samvv"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1545159630, "post_id": 53837669, "comment_id": 94527159, "body": "@chi Thanks for commenting. The source can be found <a href=\"https://github.com/samvv/haskell-typed-command\" rel=\"nofollow noreferrer\">here</a> if you&#39;re interested. I&#39;ve almost finished using the <code>SuperX</code>-approach, but I am open to changes."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1545160306, "post_id": 53837669, "comment_id": 94527457, "body": "I gave it a quick glance, but it&#39;s hard to tell. The <code>SuperX</code> approach is probably the less risky."}], "answers": [{"comments": [{"owner": {"reputation": 1504, "user_id": 1173521, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e53bbfee240b8cbd7af6e5629968a48b?s=128&d=identicon&r=PG", "display_name": "samvv", "link": "https://stackoverflow.com/users/1173521/samvv"}, "edited": false, "score": 1, "creation_date": 1545295882, "post_id": 53841578, "comment_id": 94577724, "body": "Thanks for the extensive answer! I&#39;m going to play with the different kind of solutions you suggested; will let you know how it goes."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 2, "last_activity_date": 1545169656, "creation_date": 1545169656, "answer_id": 53841578, "question_id": 53837669, "link": "https://stackoverflow.com/questions/53837669/how-do-i-get-unpredictable-overloading-on-a-return-type-working-in-haskell/53841578#53841578", "title": "How do I get &#39;unpredictable&#39; overloading on a return type working in Haskell?", "body": "<p>It depends what you need to do with it.</p>\n\n<p>If your later processing doesn't <em>care</em> if it gets an <code>A</code>, a <code>B</code>, or <code>C</code>, just that it gets something that implements <code>X</code>...</p>\n\n<pre><code>restOfProgram :: X a =&gt; a -&gt; ThingIWantToCompute\n</code></pre>\n\n<p>Then you could use continuation passing:</p>\n\n<pre><code>parseABC :: (X a =&gt; a -&gt; r) -&gt; String -&gt; Maybe r\nparseABC f \"A\" = Just (f A)\nparseABC f ('B':xs) = Just (f (B xs))\nparseABC f ('C':xs) = Just (f (C (read xs)))\nparseABC _ _ = Nothing\n</code></pre>\n\n<p>Or an existential data wrapper:</p>\n\n<pre><code>data SomeX where\n  SomeX :: X t =&gt; t -&gt; SomeX\n\nparseABC :: String -&gt; Maybe SomeX\nparseABC \"A\" = Just (SomeX A)\nparseABC ('B':xs) = Just (SomeX (B xs))\nparseABC ('C':xs) = Just (SomeX (C (read xs)))\nparseABC _ _ = Nothing\n\nrestOfProgram' :: SomeX -&gt; ThingIWantToCompute\nrestOfProgram' (SomeX t) = restOfProgram t\n</code></pre>\n\n<p>If the later processing has different paths for <code>A</code>, <code>B</code> or <code>C</code>, you probably want to return a sum type like <code>SuperX</code>.</p>\n"}], "owner": {"reputation": 1504, "user_id": 1173521, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e53bbfee240b8cbd7af6e5629968a48b?s=128&d=identicon&r=PG", "display_name": "samvv", "link": "https://stackoverflow.com/users/1173521/samvv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 53841578, "answer_count": 1, "score": 6, "last_activity_date": 1545169656, "creation_date": 1545151870, "question_id": 53837669, "link": "https://stackoverflow.com/questions/53837669/how-do-i-get-unpredictable-overloading-on-a-return-type-working-in-haskell", "title": "How do I get &#39;unpredictable&#39; overloading on a return type working in Haskell?", "body": "<p>I have some type instances. Let's call them A, B, and C. They all are instances of typeclass X. Now I would like to create a seperate function <code>create</code> that creates an instance of A, B or C given some input (let's say a string). The type system cannot know what input is going to give what type. That's the thing Haskell doesn't like, and I think I know the answer, but I want to be sure. The current error I'm getting is:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018c\u2019 with actual type \u2018GCCCommand\u2019\n  \u2018c\u2019 is a rigid type variable bound by\n    the type signature for:\n      compiler :: forall c. CompilerCommand c =&gt; String -&gt; c\n    at src/System/Command/Typed/CC.hs:29:1-44\n\u2022 In the expression: gcc path\n  In an equation for \u2018compiler\u2019:\n      compiler path\n        | exe == \"g++\" || exe == \"gcc\" || exe == \"cc\" || exe == \"cpp\"\n        = gcc path\n        where\n            exe = takeFileName path\n\u2022 Relevant bindings include\n    compiler :: String -&gt; c\n      (bound at src/System/Command/Typed/CC.hs:31:1)\n</code></pre>\n\n<p>Does that mean, as I suspect, that it is not possible to overload on return type in this particular case because the compiler can't know upfront how the data will look in memory? How would you go to implement this function? I was thinking about creating something like the following:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data SuperX = SuperA A | SuperB B | SuperC C\n\ncreate :: String -&gt; SuperX\n-- create can now be implemented\n\ninstance X SuperX where\n  -- a lot of boilerplate code ...\n</code></pre>\n\n<p>However, the boilerplate code suggests that it can be done better. Is this really the best way for doing it?</p>\n"}, {"tags": ["haskell", "data-structures", "haskell-lens", "lenses"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 2, "creation_date": 1545140258, "post_id": 53833825, "comment_id": 94516549, "body": "Maybe you could tell us a bit more about your use-case. The <code>xml</code> package is very lightweight, but also very bare-bones. Maybe it&#39;s a good fit for you together with lenses, but maybe you would also better use another xml parsing library."}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1545141353, "post_id": 53833825, "comment_id": 94517270, "body": "I&#39;m trying to parse XML response from Goodreads API. The request URL gives user a list of books with its title, author, book id, etc. Books from a specific genre. The response can be 10 fields per page. This is the request URL <code>https:&#47;&#47;www.goodreads.com&#47;search.xml?key=YOUR_API_KEY_HERE&amp;q&zwnj;&#8203;=fiction</code>"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "reply_to_user": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1545142017, "post_id": 53833825, "comment_id": 94517643, "body": "@mb21 I&#39;ve added a sample of the xml file I&#39;m trying to parse."}], "answers": [{"comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 2, "creation_date": 1545142431, "post_id": 53834923, "comment_id": 94517863, "body": "There is <code>lens-xml</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1545143109, "post_id": 53834923, "comment_id": 94518239, "body": "@Li-yaoXia Thanks!"}, {"owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "edited": false, "score": 0, "creation_date": 1545144463, "post_id": 53834923, "comment_id": 94519034, "body": "@Alec Thanks for the answer and the suggestion! Parsing XML into Haskell datatypes was my first idea but looking around I didn&#39;t see any concrete examples or tutorials going over it. Many were using <code>Arrows</code>, others combinators which I felt were too complex for me at the moment. Although if it&#39;s indeed possible to convert XML into Haskell data types easily (which can be understood by a beginner), something like how <code>aeson</code> parses <code>JSON</code> files, I can post another question."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 2, "last_activity_date": 1545143104, "last_edit_date": 1545143104, "creation_date": 1545142358, "answer_id": 53834923, "question_id": 53833825, "link": "https://stackoverflow.com/questions/53833825/haskell-how-to-obtain-a-value-from-a-deeply-nested-data-structure/53834923#53834923", "title": "Haskell | How to obtain a value from a deeply nested data structure?", "body": "<p>Since <code>xml</code> doesn't defined any optics itself, you'll need another package which does. @Li-yaoXia found one: <a href=\"https://hackage.haskell.org/package/lens-xml\" rel=\"nofollow noreferrer\"><code>lens-xml</code></a>.</p>\n\n<pre><code> #!/usr/bin/env cabal\n {- cabal:\n build-depends: base\n              , xml\n              , lens\n              , lens-xml\n -}\n {-# LANGUAGE OverloadedStrings #-}\n\n import Control.Lens\n import Text.XML.Light.Types\n import Text.XML.Light.Lens\n\n x = [ Element\n         { elName = QName\n             { qName = \"title\"\n             , qURI = Nothing\n             , qPrefix = Nothing\n             }\n         , elAttribs = []\n         , elContent =\n             [ Text\n                 ( CData\n                     { cdVerbatim = CDataText\n                     , cdData = \"This string is what I want to obtain\" -- string to view.\n                     , cdLine = Just 27\n                     }\n                 )\n             ]\n         , elLine = Just 27\n         }\n     ]\n\n main :: IO ()\n main = print (x ^? ix 0 . elContentL . ix 0 . _Text . cdDataL)\n</code></pre>\n\n<p>You can run this with a recent version of <code>cabal</code>:</p>\n\n<pre><code>$ cabal new-run Main.hs\n&lt;&lt;lots of build output snipped&gt;&gt;\nJust \"This string is what I want to obtain\"\n</code></pre>\n\n<p><strong>Disclaimer</strong>: I'm not sure I would agree with the idea of using <code>lens</code> for this task. Personally, I'd lean towards first converting the XML into a data type (with error messages when the XML doesn't fit the expected schema), then working over that data type. However, you did ask for a <code>lens</code> based solution...</p>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 1, "last_activity_date": 1545167205, "last_edit_date": 1545167205, "creation_date": 1545166618, "answer_id": 53840939, "question_id": 53833825, "link": "https://stackoverflow.com/questions/53833825/haskell-how-to-obtain-a-value-from-a-deeply-nested-data-structure/53840939#53840939", "title": "Haskell | How to obtain a value from a deeply nested data structure?", "body": "<p>Using list comprehensions and record accessors is fairly clear:</p>\n\n<pre><code>get :: [Element] -&gt; [String]\nget es = [cdData c | e &lt;- es, Text c &lt;- elContent e ]\n</code></pre>\n\n<p>The <code>Text c</code> pattern will automatically filter out any <code>Elem e</code> or <code>CRef s</code> values in <code>elContent e</code>.</p>\n\n<p>Once you learn that, for lists, <code>=&lt;&lt;</code> means <code>concatMap</code>, you can save a few characters with</p>\n\n<pre><code>get :: [Element] -&gt; [String]\nget es = [cdData c | Text c &lt;- elContent =&lt;&lt; es]\n</code></pre>\n\n<p>Additionaly, if you only wanted the <code>cdData</code> when the <code>cdVerbatim</code> was <code>CDataText</code>, you can add that condition.</p>\n\n<pre><code>get :: [Element] -&gt; [String]\nget es = [cdData c | Text c &lt;- elContent =&lt;&lt; es, cdVerbatim c == CDataText ]\n</code></pre>\n"}], "owner": {"reputation": 798, "user_id": 9235239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579e6ebaa62c34792078b38f18e2866?s=128&d=identicon&r=PG&f=1", "display_name": "atis", "link": "https://stackoverflow.com/users/9235239/atis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 283, "favorite_count": 0, "accepted_answer_id": 53840939, "answer_count": 2, "score": 2, "last_activity_date": 1545167205, "creation_date": 1545138787, "last_edit_date": 1545141993, "question_id": 53833825, "link": "https://stackoverflow.com/questions/53833825/haskell-how-to-obtain-a-value-from-a-deeply-nested-data-structure", "title": "Haskell | How to obtain a value from a deeply nested data structure?", "body": "<p>I am a beginner in haskell and I'm trying to learn more about the language by doing some basic parsing.</p>\n\n<p>I have some code that parses an XML file and produces this</p>\n\n<pre><code>[ Element\n    { elName = QName\n        { qName = \"title\"\n        , qURI = Nothing\n        , qPrefix = Nothing\n        }\n    , elAttribs = []\n    , elContent =\n        [ Text\n            ( CData\n                { cdVerbatim = CDataText\n                , cdData = \"This string is what I want to obtain\" -- string to view.\n                , cdLine = Just 27\n                }\n            )\n        ]\n    , elLine = Just 27\n    }\n]\n</code></pre>\n\n<p>Where <code>Element</code> is just a <a href=\"http://hackage.haskell.org/package/xml-1.3.14/docs/Text-XML-Light-Types.html#t:Element\" rel=\"nofollow noreferrer\">XML library's</a> data type</p>\n\n<p>What I want to do is get the string <code>\"This string is what I want to obtain\"</code></p>\n\n<p>I'm not sure how to do it without unwrapping the entire data structure. I found that way really messy and error prone.</p>\n\n<p>I did some general research and found the <a href=\"http://hackage.haskell.org/package/lens\" rel=\"nofollow noreferrer\">Lens</a> library, and although there were some tutorials, I'm still struggling to parse a nested data structure.</p>\n\n<p>This is the XML file I'm trying to parse looks</p>\n\n<pre><code>&lt;GoodreadsResponse&gt;\n    &lt;Request&gt;\n        &lt;authentication&gt;true&lt;/authentication&gt;\n        &lt;key&gt;HOKCk4yYS8UjyducqmgRw&lt;/key&gt;\n        &lt;method&gt;search_search&lt;/method&gt;\n    &lt;/Request&gt;\n    &lt;search&gt;\n        &lt;query&gt;fantasy&lt;/query&gt;\n        &lt;results-start&gt;1&lt;/results-start&gt;\n        &lt;results-end&gt;20&lt;/results-end&gt;\n        &lt;total-results&gt;35221&lt;/total-results&gt;\n        &lt;source&gt;Goodreads&lt;/source&gt;\n        &lt;query-time-seconds&gt;0.21&lt;/query-time-seconds&gt;\n        &lt;results&gt;\n            &lt;work&gt;\n                &lt;id type=\"integer\"&gt;2384&lt;/id&gt;\n                &lt;books_count type=\"integer\"&gt;51&lt;/books_count&gt;\n                &lt;ratings_count type=\"integer\"&gt;78825&lt;/ratings_count&gt;\n                &lt;text_reviews_count type=\"integer\"&gt;3357&lt;/text_reviews_count&gt;\n                &lt;original_publication_year type=\"integer\"&gt;2002&lt;/original_publication_year&gt;\n                &lt;original_publication_month type=\"integer\"&gt;2&lt;/original_publication_month&gt;\n                &lt;original_publication_day type=\"integer\"&gt;18&lt;/original_publication_day&gt;\n                &lt;average_rating&gt;4.17&lt;/average_rating&gt;\n                &lt;best_book type=\"Book\"&gt;\n                    &lt;id type=\"integer\"&gt;84136&lt;/id&gt;\n                    &lt;title&gt;Fantasy Lover (Hunter Legends Series #1)&lt;/title&gt;\n                    &lt;author&gt;\n                        &lt;id type=\"integer\"&gt;4430&lt;/id&gt;\n                        &lt;name&gt;Sherrilyn Kenyon&lt;/name&gt;\n                    &lt;/author&gt;\n                    &lt;image_url&gt;https://images.gr-assets.com/books/1348332807m/84136.jpg&lt;/image_url&gt;\n                    &lt;small_image_url&gt;https://images.gr-assets.com/books/1348332807s/84136.jpg&lt;/small_image_url&gt;\n                &lt;/best_book&gt;\n            &lt;/work&gt;\n            &lt;work&gt;\n                &lt;id type=\"integer\"&gt;6734901&lt;/id&gt;\n                &lt;books_count type=\"integer\"&gt;42&lt;/books_count&gt;\n                &lt;ratings_count type=\"integer\"&gt;18358&lt;/ratings_count&gt;\n                &lt;text_reviews_count type=\"integer\"&gt;985&lt;/text_reviews_count&gt;\n                &lt;original_publication_year type=\"integer\"&gt;2010&lt;/original_publication_year&gt;\n                &lt;original_publication_month type=\"integer\" nil=\"true\"/&gt;\n                &lt;original_publication_day type=\"integer\" nil=\"true\"/&gt;\n                &lt;average_rating&gt;4.26&lt;/average_rating&gt;\n                &lt;best_book type=\"Book\"&gt;\n                    &lt;id type=\"integer\"&gt;6542645&lt;/id&gt;\n                    &lt;title&gt;Fantasy in Death (In Death, #30)&lt;/title&gt;\n                    &lt;author&gt;\n                        &lt;id type=\"integer\"&gt;17065&lt;/id&gt;\n                        &lt;name&gt;J.D. Robb&lt;/name&gt;\n                    &lt;/author&gt;\n                    &lt;image_url&gt;https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png&lt;/image_url&gt;\n                    &lt;small_image_url&gt;https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png&lt;/small_image_url&gt;\n                &lt;/best_book&gt;\n            &lt;/work&gt;\n       ...\n       ...\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1545134495, "post_id": 53831352, "comment_id": 94513292, "body": "Perhaps you should mention which one of the several DB access packages you are using. I&#39;m not familiar with any of those, but it could be useful to others, I think."}, {"owner": {"reputation": 91, "user_id": 3182021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYFvK.png?s=128&g=1", "display_name": "Damien Mattei", "link": "https://stackoverflow.com/users/3182021/damien-mattei"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1545143507, "post_id": 53831352, "comment_id": 94518479, "body": "it is mysql-simple"}], "answers": [{"comments": [{"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 0, "creation_date": 1545145565, "post_id": 53835235, "comment_id": 94519683, "body": "Alternatively, <code>putStrLn $ &quot;x =&quot; ++ maybe &quot;NULL&quot; Text.unpack x</code>. The key is that <code>x</code> is a <code>Maybe Text</code> in this case, while your earler code forced it to <code>Text</code> due to the <code>Text.unpack</code> call."}], "tags": [], "owner": {"reputation": 91, "user_id": 3182021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYFvK.png?s=128&g=1", "display_name": "Damien Mattei", "link": "https://stackoverflow.com/users/3182021/damien-mattei"}, "is_accepted": false, "score": 1, "last_activity_date": 1545302556, "last_edit_date": 1545302556, "creation_date": 1545143439, "answer_id": 53835235, "question_id": 53831352, "link": "https://stackoverflow.com/questions/53831352/haskell-handling-null-value-in-database-query-with-maybe-or-other/53835235#53835235", "title": "HASKELL : handling NULL value in database query with Maybe (or other ...)", "body": "<p>this solution came first from the Haskell-cafe mailing list:</p>\n\n<pre><code>forM_ bd_rows_WDS $ \\(Only x) -&gt;\n  case x of\n    Nothing -&gt; putStrLn (\"x =\" ++ \"NULL\")\n    Just x -&gt; putStrLn (\"x =\" ++ Text.unpack x)\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 3182021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYFvK.png?s=128&g=1", "display_name": "Damien Mattei", "link": "https://stackoverflow.com/users/3182021/damien-mattei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1545302556, "creation_date": 1545130065, "last_edit_date": 1545131840, "question_id": 53831352, "link": "https://stackoverflow.com/questions/53831352/haskell-handling-null-value-in-database-query-with-maybe-or-other", "title": "HASKELL : handling NULL value in database query with Maybe (or other ...)", "body": "<p>I have this query in SQL used by my Haskell code:</p>\n\n<pre><code>let name = \"A    20\"\nlet qry_head_WDS = \"select DNUM from WDS where DISC = ?\" :: Query\nputStrLn \"before query WDS\"\nbd_rows_WDS &lt;- query conn qry_head_WDS (Only (name::String))\nputStrLn \"after query WDS\"\n\nforM_ bd_rows_WDS $ \\(Only a) -&gt;\n  putStrLn $  Text.unpack a\n</code></pre>\n\n<p>works well if there is no NULL values in a database, but if NULL value\nfor field N\u00b0BD i got this exception at runtime:</p>\n\n<pre><code>before query WDS\n*** Exception: UnexpectedNull {errSQLType = \"String\", errHaskellType =\n\"Text\", errFieldName = \"DNUM\", errMessage = \"unexpected null in table\nWDS of database sidonie\"}\n*Main&gt;\n</code></pre>\n\n<p>Can you help me to handle NULL values in the\nfield N\u00b0BD</p>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1545125231, "post_id": 53829829, "comment_id": 94508113, "body": "Seems like a simple use case for <code>map</code>, combined with a function which counts the number of times the word appears in the text. But note that because Haskell is &quot;referentially transparent&quot;, the text you&#39;re checking against also needs to be passed in to the function as a parameter."}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 7761743, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/0a7131530f8562230e332e4fa6d3d25c?s=128&d=identicon&r=PG&f=1", "display_name": "badprogramming99", "link": "https://stackoverflow.com/users/7761743/badprogramming99"}, "edited": false, "score": 0, "creation_date": 1545126685, "post_id": 53830184, "comment_id": 94508893, "body": "Wow. Thank you for your explanation!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1545126166, "creation_date": 1545126166, "answer_id": 53830184, "question_id": 53829829, "link": "https://stackoverflow.com/questions/53829829/looping-through-list-and-adding-to-tuple/53830184#53830184", "title": "Looping through List and Adding to Tuple", "body": "<p>A pretty direct translation of what you seem to be saying you'd do in OO would be to \u201cloop\u201d for each word through the list recursively and either update the entry that has it already, or append it as a new one:</p>\n\n<pre><code>registerWord :: String -&gt; [(String, Int)] -&gt; [(String, Int)]\nregisterWord w ((w',c):ws)\n    | w==w'       = (w,c+1) : ws\n    | otherwise   = (w',c) : registerWord w ws\nregisterWord w [] = [(w,1)]\n</code></pre>\n\n<p>Then do that for every given word, each time updating the register. This is easily done with a fold:</p>\n\n<pre><code>countWords :: [String] -&gt; [(String, Int)]\ncountWords = foldr registerWord []\n</code></pre>\n\n<p>This list-inserting is awkward though, and inefficient (both in FP and OO), namely <em>O</em>(<em>n</em><sup>2</sup>). A much nicer approach is to think functional-modularly: you effectively want to group equal words together. For this, you need to first <em>sort</em> them, so equal words are actually adjacent. Then you need to replace each group of duplicates with a single example, and the count. Nice functional pipeline:</p>\n\n<pre><code>countWords :: [String] -&gt; [(String, Int)]\ncountWords = map (\\gp@(w:_) -&gt; (w, length gp)) . group . sort\n</code></pre>\n\n<p>Incidentally, there's nothing in this function that requires the keys to be \u201cwords\u201d / strings, so you might as well generalise the signature to</p>\n\n<pre><code>countWords :: Ord a =&gt; [a] -&gt; [(a, Int)]\n</code></pre>\n\n<p>(The other, inefficient approach would be even more general, requiring only <code>Eq</code>.)</p>\n"}], "owner": {"reputation": 45, "user_id": 7761743, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/0a7131530f8562230e332e4fa6d3d25c?s=128&d=identicon&r=PG&f=1", "display_name": "badprogramming99", "link": "https://stackoverflow.com/users/7761743/badprogramming99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 53830184, "answer_count": 1, "score": 0, "last_activity_date": 1545126166, "creation_date": 1545124994, "question_id": 53829829, "link": "https://stackoverflow.com/questions/53829829/looping-through-list-and-adding-to-tuple", "title": "Looping through List and Adding to Tuple", "body": "<p>I'm trying to create a function that loops through an array of Strings, adds the word to a new tuple which counts how many times a word occurs in a block of text. In an OO language, this is simple- create a KV pair for each word and the number of times it occurs. I'm trying to translate that code into Haskell, but I don't think its that straightforward. </p>\n\n<p><code>countWords:: [String] -&gt; [(String, Int)]</code></p>\n\n<p>I know I need to create a list of tuples but I'm not sure how to loop through the list passed to the function using recursion.</p>\n"}, {"tags": ["haskell", "functional-programming", "palindrome"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1545094506, "post_id": 53824868, "comment_id": 94499030, "body": "One way is to normalize the case, for example, make all the characters uppercase before checking palindrome.  As a first step, can you figure out how to tell whether a character is lowercase using <code>ord</code>?  Play around with the function in <code>ghci</code> and see if you can notice a pattern."}, {"owner": {"reputation": 57, "user_id": 7983341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a26c5e68aefa5636d1e29166f370cf5d?s=128&d=identicon&r=PG&f=1", "display_name": "Intellects", "link": "https://stackoverflow.com/users/7983341/intellects"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1545096249, "post_id": 53824868, "comment_id": 94499382, "body": "normalizeCase::String-&gt;String normalizeCase h | h == [] = [] normalizeCase [h] = if ord h &gt; 64 &amp;&amp; ord h &lt; 123 then map (chr $ (ord h + 32)) [h] else h Gives me errors and not quite sure how to fix."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1545098180, "post_id": 53824868, "comment_id": 94499760, "body": "<i>Either</i> use <code>map</code> to \u201cloop\u201d over the list, or manual-recursive pattern-match deconstruction. (Preferrably <code>map</code>.) You seem to be trying to do both simultaneously..."}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 7983341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a26c5e68aefa5636d1e29166f370cf5d?s=128&d=identicon&r=PG&f=1", "display_name": "Intellects", "link": "https://stackoverflow.com/users/7983341/intellects"}, "edited": false, "score": 1, "creation_date": 1545100357, "post_id": 53825402, "comment_id": 94500200, "body": "Thanks so much, was able to figure out the rest after examining this, really appreciate the help!"}], "tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 3, "last_activity_date": 1545098402, "creation_date": 1545098402, "answer_id": 53825402, "question_id": 53824868, "link": "https://stackoverflow.com/questions/53824868/palindrome-checker-that-ignores-non-alphanumeric-characters-and-case-haskell/53825402#53825402", "title": "Palindrome checker that ignores non-alphanumeric characters and case Haskell", "body": "<p>In this code:</p>\n\n<pre><code>normalizeCase::String-&gt;String\nnormalizeCase h | h == [] = []\nnormalizeCase (h) = if ord h &gt; 64 &amp;&amp; ord h &lt; 123\n    then map (chr $ (ord h + 32)) [h]\n    else h\n</code></pre>\n\n<p>Your second pattern <code>(h)</code> (equivalent to just <code>h</code>) matches <em>any</em> list (as long as it wasn\u2019t already matched by the first pattern, <code>h | h == []</code>); so <code>h</code> is a list here and <code>ord h</code> doesn\u2019t make sense, since <code>ord</code> expects a <code>Char</code>, not a <code>[Char]</code>.</p>\n\n<p>Assuming <code>h</code> was a character, then <code>chr $ ord h + 32</code> would also be a character, but <code>map</code> expects a <em>function</em> as its first argument; this is the source of the error that <code>Char -&gt; Char</code> was expected but you gave <code>Char</code>. For the second argument to <code>map</code>, you pass <code>[h]</code>, which is a list of a single element <code>h</code> (which in your code is also a list, so you are providing <code>[[Char]]</code> when you want <code>[Char]</code>).</p>\n\n<p>Also assuming <code>h</code> was a character, your condition <code>ord h &gt; 64 &amp;&amp; ord h &lt; 123</code> matches any character between <em>uppercase</em> <code>A</code> and <em>lowercase</em> <code>z</code>, including a few characters you don\u2019t want (<code>[]^_`</code>). The fact that <code>h</code> is a <em>list</em> of characters is the source of the error that <code>Char</code> was expected but you gave <code>[Char]</code>.</p>\n\n<p>You also seem to be mixing recursive style with <code>map</code>\u2014in this case you should <em>either</em> use <code>map</code> <em>or</em> define the function by cases.</p>\n\n<p>Here\u2019s how your code could look with these errors fixed. First, using recursion:</p>\n\n<pre><code>normalizeCase :: String -&gt; String\n\n-- Given an empty list, return an empty list.\n-- This happens if the original input was empty,\n-- or when we reach the end of the recursion.\nnormalizeCase [] = []\n\n-- Given a non-empty list,\n-- test the first character \u2018c\u2019.\nnormalizeCase (c : cs) = if c &gt;= 'A' &amp;&amp; c &lt;= 'Z'\n\n  -- If it\u2019s uppercase, lowercase it and\n  -- prepend it to the result of normalizing\n  -- the remainder of the string \u2018cs\u2019.\n  then chr (ord c + 32) : normalizeCase cs\n\n  -- Otherwise, don\u2019t change it, but still\n  -- prepend it to the result of normalizing\n  -- the remainder of the string \u2018cs\u2019.\n  else c : normalizeCase cs\n</code></pre>\n\n<p>Or, using <code>map</code>:</p>\n\n<pre><code>normalizeCase :: String -&gt; String\n\n-- Given any string:\nnormalizeCase s\n\n  -- For each character:\n  = map\n\n    -- If it\u2019s uppercase, lowercase it.\n    (\\ c -&gt; if c &gt;= 'A' &amp;&amp; c &lt;= 'Z'\n      then chr (ord c + 32)\n      else c)\n\n    -- Over the whole string.\n    s\n</code></pre>\n\n<p><code>Char</code> can be compared directly (<code>c &gt;= 'A'</code>), which is more readable, but if you\u2019re expected to use <code>ord</code> for the comparison as well, that would be <code>ord c &gt;= 65</code>.</p>\n\n<p>I know you\u2019re not supposed to use any other standard functions for this task, but for future reference, this can also be implemented very straightforwardly using <code>toLower</code> from <code>Data.Char</code>:</p>\n\n<pre><code>import Data.Char (toLower)\n\nnormalizeCase :: String -&gt; String\nnormalizeCase s = map toLower s\n\n-- Alternatively, a point-free/eta-reduced version:\nnormalizeCase = map toLower\n</code></pre>\n\n<p>For the additional task of removing non-alphanumeric characters, you can use <code>filter</code>, a list comprehension with a guard condition, or write a direct recursive version yourself.</p>\n"}], "owner": {"reputation": 57, "user_id": 7983341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a26c5e68aefa5636d1e29166f370cf5d?s=128&d=identicon&r=PG&f=1", "display_name": "Intellects", "link": "https://stackoverflow.com/users/7983341/intellects"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "accepted_answer_id": 53825402, "answer_count": 1, "score": 3, "last_activity_date": 1545098402, "creation_date": 1545093496, "last_edit_date": 1545096590, "question_id": 53824868, "link": "https://stackoverflow.com/questions/53824868/palindrome-checker-that-ignores-non-alphanumeric-characters-and-case-haskell", "title": "Palindrome checker that ignores non-alphanumeric characters and case Haskell", "body": "<p>Need to make a program that checks if a given string is a palindrome, it should work whether the case is different, and should ignore non-alphanumeric characters, only using the ord and chr functions in Data.char and regular functions, nothing else. I was able to create the regular palindrome checker: </p>\n\n<pre><code>reverseStr::String-&gt;String\nreverStr s | s == [] = []\nreverseStr (h:t) = reverseStr t ++ [h]\n\nisPalindrome :: String -&gt; Bool\nisPalindrome s = s == reverseStr s\n</code></pre>\n\n<p>I've started work on a function to normalize case:</p>\n\n<pre><code>normalizeCase::String-&gt;String\nnormalizeCase h | h == [] = []\nnormalizeCase (h) = if ord h &gt; 64 &amp;&amp; ord h &lt; 123\n    then map (chr $ (ord h + 32)) [h]\n    else h\n</code></pre>\n\n<p>But I get these errors:</p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Char -&gt; Char\u2019\n              with actual type \u2018Char\u2019\n\u2022 In the first argument of \u2018map\u2019, namely \u2018(chr $ (ord h + 32))\u2019\n  In the expression: map (chr $ (ord h + 32)) [h]\n  In the expression:\n    if ord h &gt; 64 &amp;&amp; ord h &lt; 123 then\n        map (chr $ (ord h + 32)) [h]\n    else\n        h\n\n  |\n6 |   then map (chr $ (ord h + 32)) [h]   |             ^^^^^^^^^^^^^^^^^^\n\n\n    \u2022 Couldn't match type \u2018Char\u2019 with \u2018[Char]\u2019\n  Expected type: String\n    Actual type: Char\n\u2022 In the expression: h\n  In the expression:\n    if ord h &gt; 64 &amp;&amp; ord h &lt; 123 then\n        map (chr $ (ord h + 32)) [h]\n    else\n        h\n  In an equation for \u2018normalizeCase\u2019:\n      normalizeCase [h]\n        = if ord h &gt; 64 &amp;&amp; ord h &lt; 123 then\n              map (chr $ (ord h + 32)) [h]\n          else\n              h\n  |\n7 |   else h   |        ^\n</code></pre>\n\n<p>I'm still very new to Haskell and have no idea how to implement ord or chr properly so that it works with this checker, so any help would be appreciated!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 5, "creation_date": 1545083860, "post_id": 53823447, "comment_id": 94495914, "body": "Exporting instances does not imply exporting function definitions or class methods. In fact the error message is saying Variable not in scope (i.e. you have not imported <code>fromNumber</code> as a function), it is not saying that it cannot find an instance. What happens if you <code>import SDL.Internal.Numbered</code> (which I believe is the module defining <code>fromNumber</code>)?"}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1545084373, "post_id": 53823447, "comment_id": 94496140, "body": "Ahhh ok, I was trying to add qualifiers in a different way, which didn&#39;t really make sense.... this makes more sense, and it works! Now I will have to test out the runtime issue i was having later, but this answers my question!"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1545089037, "post_id": 53823447, "comment_id": 94497816, "body": "@Bakuriu mind making your comment an answer?"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1545116966, "post_id": 53823447, "comment_id": 94504313, "body": "@luqui I think Daniel answer provides all the information. @bbarker Obviously importing a package with <code>Internal</code> in its name shouldn&#39;t be done. But I believe some other module reexports <code>FromNumber</code> publicly, so you&#39;ll have to look for that."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1545089053, "creation_date": 1545089053, "answer_id": 53824399, "question_id": 53823447, "link": "https://stackoverflow.com/questions/53823447/how-does-one-use-an-instance-function-in-haskell-when-ghc-complains-it-is-not-in/53824399#53824399", "title": "How does one use an instance function in Haskell when ghc complains it is not in scope, despite imports?", "body": "<p>Instances are global, but the class itself and its methods are not. So if you have</p>\n\n<pre><code>module X () where\ninstance Foo Bar where fooBar = undefined\n</code></pre>\n\n<p>and import <code>X</code>, then you will be able to pass <code>Bar</code>s into functions which demand their arguments be instance of <code>Foo</code> (or get <code>Bar</code>s back from things that promise to produce an instance of <code>Foo</code>) -- but will not be able to name <code>Foo</code>, <code>Bar</code>, or <code>fooBar</code> yourself unless you've imported those from elsewhere!</p>\n\n<p>The fix in your case is to find a module which exports <code>fromNumber</code>, e.g. by exporting <code>FromNumber(..)</code>, and import it from there.</p>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 53824399, "answer_count": 1, "score": 1, "last_activity_date": 1545089053, "creation_date": 1545083255, "question_id": 53823447, "link": "https://stackoverflow.com/questions/53823447/how-does-one-use-an-instance-function-in-haskell-when-ghc-complains-it-is-not-in", "title": "How does one use an instance function in Haskell when ghc complains it is not in scope, despite imports?", "body": "<p>In <em>A Gentle Introduction to Haskell, Version 98</em>, it <a href=\"https://www.haskell.org/tutorial/modules.html\" rel=\"nofollow noreferrer\">is said</a>:</p>\n\n<blockquote>\n  <p>Instance declarations are not explicitly named in import or export\n  lists. Every module exports all of its instance declarations and every\n  import brings all instance declarations into scope.</p>\n</blockquote>\n\n<p>This seems like good sense to me. Anyhow, when I try this for <a href=\"https://github.com/haskell-game/sdl2/blob/b33aafce0d4a10a007466871267d5abe68b20415/src/SDL/Video/Renderer.hs#L945\" rel=\"nofollow noreferrer\">fromNumber</a> from the <code>FromNumber PixelFormat Word32</code> instance, I'm met with the error:</p>\n\n<pre><code>/home/brandon/workspace/hico/src/Hico/Game.hs:269:50: error:\n    Variable not in scope:\n      fromNumber :: Word32 -&gt; SDL.Video.Renderer.PixelFormat\n    |\n269 |   let pixFmt :: SDL.Video.Renderer.PixelFormat = fromNumber rawPixFmt\n    |      \n</code></pre>\n\n<p>The type in the error message looks correct to me. My relevant imports are:</p>\n\n<pre><code>import qualified SDL                    as SDL \nimport qualified SDL.Font\nimport qualified SDL.Image\nimport qualified SDL.Internal.Types     (Window(..))\nimport qualified SDL.Raw\nimport           SDL.Raw.Video          (getWindowPixelFormat)\nimport qualified SDL.Video.Renderer     \n</code></pre>\n\n<p>(especially the last line with <code>import qualified SDL.Video.Renderer</code>).</p>\n\n<p>Out of a sense of paranoia, and since I had already a local copy of sdl2 handy, I modified the code in SDL2's <code>Renderer.hs</code> and added the below changes, which happily compiled, but shows that is not where the problem is:</p>\n\n<pre><code>{-# LANGUAGE InstanceSigs #-}\n-- omitted ...\n  fromNumber :: Word32 -&gt; PixelFormat\n  fromNumber n' = case n' of -- ommited ...\n</code></pre>\n\n<p>I have a feeling I'm once again doing something stupid with imports, though I'm not sure. </p>\n"}, {"tags": ["dictionary", "haskell", "reflection", "typeclass", "singleton-type"], "answers": [{"comments": [{"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "edited": false, "score": 0, "creation_date": 1545089153, "post_id": 53823727, "comment_id": 94497840, "body": "It needs to be a class because I&#39;m using it as a constraint for an instance of another class which is defined elsewhere and I can&#39;t make changes to."}, {"owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "edited": false, "score": 0, "creation_date": 1545089251, "post_id": 53823727, "comment_id": 94497861, "body": "It&#39;s the same reason <code>reflection</code> exists in the first place. Because sometimes we need to feed arguments into classes rather than into methods."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "edited": false, "score": 0, "creation_date": 1545160612, "post_id": 53823727, "comment_id": 94527586, "body": "@dspyz Perhaps you could convert a term-level string to <code>SomeSymbol</code> with <code>someSymbolVal</code> and then pattern-match on the result <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-TypeLits.html#v:someSymbolVal\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/&hellip;</a>"}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1545148014, "last_edit_date": 1545148014, "creation_date": 1545084702, "answer_id": 53823727, "question_id": 53822949, "link": "https://stackoverflow.com/questions/53822949/how-to-unsafely-reflect-a-map-as-a-constraint/53823727#53823727", "title": "How to (unsafely) reflect a map as a constraint?", "body": "<p>Why does it have to be a class <code>IsMember</code>? How about a simple type:</p>\n\n<pre><code>newtype Member x s v = Member v\n\ncheckMember :: ... =&gt; proxy x -&gt; Maybe (Member x s v)\n</code></pre>\n\n<p>Keeping <code>Member</code> abstract allows to preserve the invariant that a value of type <code>Member x s v</code> belongs to the dictionary associated with <code>s</code>. No <code>unsafeCoerce</code> on your part are needed.</p>\n\n<p>From there, there might also be some way to use reflection to lift <code>Member</code> back to the type level but that sounds overengineered.</p>\n\n<hr>\n\n<p><strong>EDIT:</strong> from the discussion, it seems the requirement is external and there isn't much to do about it. Here is a way to implement <code>checkMember</code>.</p>\n\n<p>(<code>reflection</code> implements its own machinery like this too.)</p>\n\n<p>We can abuse the fact that GHC desugars classes with a single method and no superclasses <code>class C a where m :: v</code> directly to the unwrapped method <code>m :: v</code>, and constrained values <code>C a =&gt; b</code> to functions <code>v -&gt; b</code>.</p>\n\n<ul>\n<li>we need a version of <code>IsMember</code> without superclasses (<code>IsMember0</code>)</li>\n<li>we wrap <code>IsMember0 x s v =&gt; r</code> in a newtype so it can be coerced to <code>IsMember0 x s v -&gt; r</code> (<code>UnsafeMember</code>)</li>\n</ul>\n\n<hr>\n\n<pre><code>{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE FunctionalDependencies #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nimport Data.Constraint(Dict(..))\nimport Data.Map (Map)\nimport qualified Data.Map as Map\nimport Data.Proxy (Proxy(..))\nimport Data.Reflection (Reifies, reflect, reify)\nimport GHC.TypeLits (KnownSymbol, Symbol, symbolVal)\nimport Unsafe.Coerce (unsafeCoerce)\n\ntype Text = String\n\nclass IsMember0 (x :: Symbol) s v | s -&gt; v where\n  value0 :: Proxy s -&gt; Proxy x -&gt; v\n\nclass (Reifies s (Map Text v), IsMember0 x s v) =&gt; IsMember (x :: Symbol) s v | s -&gt; v\ninstance (Reifies s (Map Text v), IsMember0 x s v) =&gt; IsMember (x :: Symbol) s v\n\nvalue :: IsMember x s v =&gt; Proxy s -&gt; Proxy x -&gt; v\nvalue = value0\n\nnewtype UnsafeMember x s v = UnsafeMember (IsMember0 x s v =&gt; Dict (IsMember x s v))\n\nunsafeMember :: forall x s v. Reifies s (Map Text v) =&gt; v -&gt; Dict (IsMember x s v)\nunsafeMember v = unsafeCoerce (UnsafeMember @x @s @v Dict) (\\ _ _ -&gt; v)\n\ncheckMember :: forall s x v proxys proxyx. (KnownSymbol x, Reifies s (Map Text v))\n  =&gt; proxys s -&gt; proxyx x -&gt; Maybe (Dict (IsMember x s v))\ncheckMember _ sx =\n  let m = reflect (Proxy @s)\n  in  unsafeMember &lt;$&gt; Map.lookup (symbolVal sx) m\n\n-- Executable example\nmain :: IO ()\nmain = do\n  let d = Map.fromList [(\"foo\", 33 :: Int)]\n      foo = Proxy :: Proxy \"foo\"\n  reify d (\\p -&gt;\n    case checkMember p foo of\n      Nothing -&gt; fail \"Not found\"\n      Just Dict -&gt; print (value0 p foo))\n</code></pre>\n"}], "owner": {"reputation": 4870, "user_id": 403875, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/439b8283080e4e2255205993da9de9ca?s=128&d=identicon&r=PG", "display_name": "dspyz", "link": "https://stackoverflow.com/users/403875/dspyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1545148014, "creation_date": 1545080627, "last_edit_date": 1545081512, "question_id": 53822949, "link": "https://stackoverflow.com/questions/53822949/how-to-unsafely-reflect-a-map-as-a-constraint", "title": "How to (unsafely) reflect a map as a constraint?", "body": "<p>I want a typeclass that represents membership in a <em>reified</em> <code>Data.Map.Map</code>. So something like:</p>\n\n<pre><code>class Reifies s (Map Text v) =&gt; IsMember (x :: Symbol) s where\n  value :: Proxy s -&gt; Proxy x -&gt; v\n</code></pre>\n\n<p>And then I would like to implement a function which returns a <code>Dict</code> instance of this class whenever a symbol is present:</p>\n\n<pre><code>checkMember :: forall s x v. (KnownSymbol x, Reifies s (Map Text v))\n  =&gt; proxy x -&gt; Maybe (Dict (IsMember x s))\ncheckMember sx =\n  let m = reflect (Proxy @s)\n  in  (_ :: v -&gt; Dict (IsMember x s)) &lt;$&gt; Map.lookup (symbolVal sx) m\n</code></pre>\n\n<p>I don't mind using <code>unsafeCoerce</code> to implement <code>checkMember</code>, but even so I'm having trouble figuring out how to do this (fill in the type hole).</p>\n\n<hr>\n\n<p>Approximate preamble:</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE UndecidableInstances #-}\n\nimport Data.Constraint(Dict(..))\nimport Data.Map (Map)\nimport qualified Data.Map as Map\nimport Data.Proxy (Proxy(..))\nimport Data.Reflection (Reifies, reflect)\nimport GHC.TypeLits (KnownSymbol, Symbol, symbolVal)\n</code></pre>\n"}, {"tags": ["list", "haskell", "filter"], "comments": [{"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 5, "creation_date": 1545071440, "post_id": 53821100, "comment_id": 94490665, "body": "<code>map</code> <code>f</code> over your list of list, where <code>f</code> is a function that removes the last element of a list."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1545071479, "post_id": 53821100, "comment_id": 94490679, "body": "This is typically not a use-case for a filter: this is a &quot;mapping&quot; (since you apply a function on each item of the list). I think instead of first tackling the list of lists problem, it might be better to first make an attempt on removing the last item of a <i>single</i> list."}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 1, "creation_date": 1545076228, "post_id": 53821100, "comment_id": 94492814, "body": "what should happen if the sublist is empty?"}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 2, "creation_date": 1545084026, "post_id": 53821798, "comment_id": 94495991, "body": "The usual idiom for dropping a given number of elements from the end of a list, automatically handling empty lists, is <code>zipWith const xs (drop n xs)</code> (<code>n</code> being 1 here), e.g. <code>map (\\xs -&gt; zipWith const xs (drop 1 xs))</code>. This can also be written point-free rather conveniently as <code>map (zipWith const &lt;*&gt; drop 1)</code>, but I appreciate not everyone finds the <code>(-&gt;)</code> applicative pleasant to read."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1545089766, "post_id": 53821798, "comment_id": 94497971, "body": "@JonPurdy I am not sure which way is better, both are O(n) and able to handle infinite list. I choose <code>if null xs...</code> version since it is easy to understand for newbie of Haskell."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1545095423, "post_id": 53821798, "comment_id": 94499205, "body": "Yeah, I think your method is a more appropriate answer to this particular question. I just wanted to mention the alternative because it\u2019s an idiom that\u2019s not necessarily intuitive at first, but someone may encounter it in the wild."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1545117834, "post_id": 53821798, "comment_id": 94504684, "body": "@JonPurdy Yes, you are right and your supplementary explanation in comment is useful, so I voted it up. In practical, your method is preferred and general to remove arbirary  number of elements at the end of the list, but  the method in my answer is not suitable to remove more than 1 element from the end of the list."}], "tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 5, "last_activity_date": 1545074726, "creation_date": 1545074726, "answer_id": 53821798, "question_id": 53821100, "link": "https://stackoverflow.com/questions/53821100/i-am-trying-to-remove-the-last-item-of-each-list-in-a-list-of-lists/53821798#53821798", "title": "I am trying to remove the last item of each list in a list of lists", "body": "<p>Here is an example show how to do it:</p>\n\n<pre><code>map (\\xs-&gt;if null xs then xs else init xs) [[], [1..3], [4..6]]\n</code></pre>\n\n<p>and the result is:</p>\n\n<pre><code>[[],[1,2],[4,5]]\n</code></pre>\n\n<p>Note that it need to check each list in list whether is empty before remove the last item of the list, since <code>init</code> cannot apply to empty list.</p>\n"}], "owner": {"reputation": 1, "user_id": 10802713, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-HAad31m6l8M/AAAAAAAAAAI/AAAAAAAAAWI/eGMxjgX83kw/photo.jpg?sz=128", "display_name": "Ben Greenhill", "link": "https://stackoverflow.com/users/10802713/ben-greenhill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1545075906, "creation_date": 1545071265, "question_id": 53821100, "link": "https://stackoverflow.com/questions/53821100/i-am-trying-to-remove-the-last-item-of-each-list-in-a-list-of-lists", "title": "I am trying to remove the last item of each list in a list of lists", "body": "<p>I have a data structure which is a list of lists. I want to remove the last item of each list, preferably using a filter. How would i go about doing this?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1545072534, "post_id": 53821215, "comment_id": 94491136, "body": "I strongly recommend either exporting/importing <i>all</i> constructors (using <code>(..)</code> syntax), or <i>none</i> of them, except under very unusual circumstances. Limiting to only some of them invites partial functions, and listing them explicitly is just extra work up front and when changing the type. The only time I might consider exporting just some constructors would be if others are used only transiently for internal purposes, as in some formulations of red-black trees."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1545073732, "post_id": 53821215, "comment_id": 94491700, "body": "@dfeuer Indeed. I&#39;ve edited the question to point out that it&#39;s pretty weird to import a subset of constructors."}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 4, "last_activity_date": 1545073725, "last_edit_date": 1545073725, "creation_date": 1545071874, "answer_id": 53821215, "question_id": 53821074, "link": "https://stackoverflow.com/questions/53821074/what-is-wrong-with-my-data-constructor-import-use-when-ghc-suggestion-is-to-add/53821215#53821215", "title": "What is wrong with my data constructor import/use, when ghc suggestion is to add constructor to import list?", "body": "<p>By writing</p>\n\n<pre><code>import qualified SDL.Internal.Types     (Window)\n</code></pre>\n\n<p>you are importing only the type Window, and none of its constructors. To import a data type and some limited subset of its constructors, one writes (using Maybe as an example because I don't know SDL's types):</p>\n\n<pre><code>import Prelude (Maybe(Just))\n</code></pre>\n\n<p>This import would allow you to use Maybe in type annotations, and use the Just constructor to pattern-match or to create new values of type Maybe a, but you would not be able to use Nothing in either of those circumstances. </p>\n\n<p>Note that the above would be a very unusual thing to do: normally you want either all of a type's constructors (so that you can build and consume any value of that type), or none of them (so that your functions can receive or return values of that type, constructed and consumed by other functions).</p>\n\n<p>If you want all of a type's constructors, you can use the exact syntax used in the module export definition you listed: <code>(..)</code> means \"all of the constructors of this type\":</p>\n\n<pre><code>import qualified SDL.Internal.Types     (Window(..))\n</code></pre>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 53821215, "answer_count": 1, "score": 1, "last_activity_date": 1545073725, "creation_date": 1545071152, "question_id": 53821074, "link": "https://stackoverflow.com/questions/53821074/what-is-wrong-with-my-data-constructor-import-use-when-ghc-suggestion-is-to-add", "title": "What is wrong with my data constructor import/use, when ghc suggestion is to add constructor to import list?", "body": "<p>I have the following line of code where I'm trying to extract the internal raw type so I  can work with it directly:</p>\n\n<pre><code>SDL.Internal.Types.Window (rawWindow) = window\n</code></pre>\n\n<p>My import looks like:</p>\n\n<pre><code>import qualified SDL.Internal.Types     (Window)\n</code></pre>\n\n<p>The error I get is below; it seems I'm already doing what it suggests.</p>\n\n<pre><code>%    /home/brandon/workspace/hico/src/Hico/Game.hs:273:5: error:\n        Not in scope: data constructor `SDL.Internal.Types.Window'\n        Perhaps you want to add `Window' to the import list\n        in the import of `SDL.Internal.Types' (src/Hico/Game.hs:34:1-48).\n        |\n    273 |     SDL.Internal.Types.Window (rawWindow) = window\n        |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>The content of the <code>Types.hs</code> file is very short, and doesn't seem to offer any clues to me:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n{-# LANGUAGE DeriveGeneric #-}\nmodule SDL.Internal.Types\n  ( Joystick(..)\n  , Window(..)\n  , Renderer(..)\n  ) where\n\nimport Data.Data (Data)\nimport Data.Typeable\nimport GHC.Generics (Generic)\n\nimport qualified SDL.Raw as Raw\n\nnewtype Joystick = Joystick { joystickPtr :: Raw.Joystick }\n  deriving (Data, Eq, Generic, Ord, Show, Typeable)\n\nnewtype Window = Window (Raw.Window)\n  deriving (Data, Eq, Generic, Ord, Show, Typeable)\n\n-- | An SDL rendering device. This can be created with 'SDL.Video.createRenderer'.\nnewtype Renderer = Renderer Raw.Renderer\n  deriving (Data, Eq, Generic, Ord, Show, Typeable)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1545071031, "post_id": 53821003, "comment_id": 94490505, "body": "Then you should construct a new typeclass <code>DotProductable</code> (or something similar) with that function."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1545071087, "post_id": 53821003, "comment_id": 94490523, "body": "Why overload anything? Why not just make <code>*:</code> a normal function?"}, {"owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "edited": false, "score": 0, "creation_date": 1545071788, "post_id": 53821003, "comment_id": 94490806, "body": "overload in typeclass so that I can use the same operator (*:) on Matrix typeclass or other typeclasses again, If you have normal function *: then you can not reuse it again,  e.g. on  Matrix typeclass"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1545087760, "post_id": 53821003, "comment_id": 94497374, "body": "Please don&#39;t define <code>Num</code> instances for vector types, this doesn&#39;t make sense mathematically. <a href=\"http://hackage.haskell.org/package/vector-space-0.15/docs/Data-VectorSpace.html\" rel=\"nofollow noreferrer\"><code>VectorSpace</code></a> is the correct class to use (and <a href=\"http://hackage.haskell.org/package/vector-space-0.15/docs/Data-VectorSpace.html#t:InnerSpace\" rel=\"nofollow noreferrer\"><code>InnerSpace</code></a> from the same package for dot products)."}], "answers": [{"comments": [{"owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "edited": false, "score": 0, "creation_date": 1545081374, "post_id": 53821441, "comment_id": 94494897, "body": "data Vectorx a = Vectorx a a a  class Num a =&gt; (VectorOp a) where     (<i>:)::Num b=&gt; a -&gt; a -&gt; b  instance (Num a) =&gt; Num(Vectorx a) where     (+) _ _ = undefined  instance VectorOp (Vectorx a) where     (</i>:) (Vectorx x0 y0 z0) (Vectorx x1 y1 z1) = x0*x1 + y0*y1 + z0*z1"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "reply_to_user": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "edited": false, "score": 0, "creation_date": 1545089019, "post_id": 53821441, "comment_id": 94497806, "body": "@AronLee sorry for misunderstanding your question before, I has modified the answer for your case."}], "tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 4, "last_activity_date": 1545088892, "last_edit_date": 1545088892, "creation_date": 1545072975, "answer_id": 53821441, "question_id": 53821003, "link": "https://stackoverflow.com/questions/53821003/instantiate-num-class-in-haskell/53821441#53821441", "title": "instantiate Num class in Haskell", "body": "<p>For your case, It is not suitable to subclass <code>Num</code> class for calculating <code>dot product</code> of vector. it just need to constraint the elements of vector is number as:</p>\n\n<pre><code>class DotProduct v where\n    (*:)::Num a=&gt;v a -&gt;v a -&gt; a\n</code></pre>\n\n<p>and instance it as:</p>\n\n<pre><code>data Vectorx a = Vectorx a a a\n\ninstance DotProduct Vectorx where\n    (*:) (Vectorx x0 y0 z0) (Vectorx x1 y1 z1) = x0*x1 + y0*y1 + z0*z1\n</code></pre>\n\n<p>You still able to instance <code>Num</code> to define <code>(+), (*)</code> or etc operations for <code>Vectorx</code>, but that is Irrelevant to above <code>DotPoduct</code> class. </p>\n"}], "owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 53821441, "answer_count": 1, "score": 0, "last_activity_date": 1545088892, "creation_date": 1545070863, "last_edit_date": 1545081485, "question_id": 53821003, "link": "https://stackoverflow.com/questions/53821003/instantiate-num-class-in-haskell", "title": "instantiate Num class in Haskell", "body": "<p>I have Vectorx class and I want to overload <code>\"dot product\"</code>\nwith operator <code>(*:)</code> in Num class</p>\n\n<pre><code>data Vectorx a = Vectorx a a a \n\ninstance (Num a)=&gt;Num(Vectorx a) where\n    (+) ...\n    (-) ...\n    etc ...\n    (*:) (Vectorx x0 y0 z0) (Vectorx x1 y1 z1) = x0*x1 + y0*y1 + z0*z1 \n</code></pre>\n\n<p>It seems to me I can NOT add <code>(*:)</code> operator in the instance of <code>Num</code></p>\n\n<p>In Java, I can add whatever method that I want when I implement interface or extend abstract class.</p>\n\n<p>Any help would be appreciated.</p>\n\n<p>Here is my updated code from suggestion, but I still get \"type error\"</p>\n\n<pre><code>data Vectorx a = Vectorx a a a\n\nclass Num a =&gt; (VectorOp a) where\n    (*:)::Num b=&gt; a -&gt; a -&gt; b\n\ninstance (Num a) =&gt; Num(Vectorx a) where\n    (+) _ _ = undefined\n\ninstance VectorOp (Vectorx a) where\n    (*:) (Vectorx x0 y0 z0) (Vectorx x1 y1 z1) = x0*x1 + y0*y1 + z0*z1\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1531971"}, "edited": false, "score": 2, "creation_date": 1545068872, "post_id": 53820471, "comment_id": 94489527, "body": "Stick to a single question at a time, please. (Though, this looks almost exactly like the scenario discussed here: <a href=\"https://wiki.haskell.org/Stack_overflow\" rel=\"nofollow noreferrer\">wiki.haskell.org/Stack_overflow</a>)"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1545069027, "post_id": 53820471, "comment_id": 94489587, "body": "&quot;I want to write code that resemble Math, and don&#39;t want to spend time thinking about memory limits, stack overflows and stuff like that.&quot; Programming doesn&#39;t work this way. Unless you are happy to get your answer in one of the coming millennia, that is."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1545069531, "post_id": 53820471, "comment_id": 94489820, "body": "<a href=\"https://ideone.com/2DOVTf\" rel=\"nofollow noreferrer\">Doesn&#39;t reproduce</a>. Try compiling your code rather than loading the source to GHCi."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1545070809, "post_id": 53820471, "comment_id": 94490389, "body": "The question asks specifically about GHCi. And I think it&#39;s reasonable for op to want their code here to Just Work, after all that&#39;s what your suggestion to compile with optimizations is essentially."}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 10802473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/090a85574f38876e18f9a16450a6f40e?s=128&d=identicon&r=PG&f=1", "display_name": "makkiato", "link": "https://stackoverflow.com/users/10802473/makkiato"}, "edited": false, "score": 0, "creation_date": 1545078513, "post_id": 53822134, "comment_id": 94493748, "body": "thanks, I now understand why lazyness &#39;creates&#39; a huge expression in this case, and how Seq can solve this. Thansk man! very useful answer!"}, {"owner": {"reputation": 39, "user_id": 10802473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/090a85574f38876e18f9a16450a6f40e?s=128&d=identicon&r=PG&f=1", "display_name": "makkiato", "link": "https://stackoverflow.com/users/10802473/makkiato"}, "edited": false, "score": 0, "creation_date": 1545146164, "post_id": 53822134, "comment_id": 94520047, "body": "thanks again for your previous answer. However I have a doubt now.  Running GHCi with the flag &quot;:set +s&quot; to see execution time and memory usage, I see that the program newsum&#39; is still using a linear (in n) amount of memory: try 10000, 100000 and 1000000. How is this possible? How can I really get a constant-space function ?  Thanks!"}, {"owner": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "reply_to_user": {"reputation": 39, "user_id": 10802473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/090a85574f38876e18f9a16450a6f40e?s=128&d=identicon&r=PG&f=1", "display_name": "makkiato", "link": "https://stackoverflow.com/users/10802473/makkiato"}, "edited": false, "score": 1, "creation_date": 1545160297, "post_id": 53822134, "comment_id": 94527452, "body": "@makkiato <code>:set +s</code> outputs total allocations over the whole evaluation, not peak memory usage (I use <code>top</code> or <code>htop</code> in another terminal to visualize that)"}, {"owner": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "reply_to_user": {"reputation": 39, "user_id": 10802473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/090a85574f38876e18f9a16450a6f40e?s=128&d=identicon&r=PG&f=1", "display_name": "makkiato", "link": "https://stackoverflow.com/users/10802473/makkiato"}, "edited": false, "score": 1, "creation_date": 1545160409, "post_id": 53822134, "comment_id": 94527497, "body": "@makkiato the difference between the versions, is that the strict one can garbage collect the allocations as it goes along, instead of only at the very end"}], "tags": [], "owner": {"reputation": 934, "user_id": 7459445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GBpx1.png?s=128&g=1", "display_name": "Claude", "link": "https://stackoverflow.com/users/7459445/claude"}, "is_accepted": false, "score": 4, "last_activity_date": 1545076440, "creation_date": 1545076440, "answer_id": 53822134, "question_id": 53820471, "link": "https://stackoverflow.com/questions/53820471/exception-stack-overflow-stack-overflow/53822134#53822134", "title": "*** Exception: stack overflow : Stack overflow", "body": "<p>The problem is that <code>(!!)</code> is lazy: it doesn't force earlier values in the list to be evaluated, so <code>ghci</code> ends up with a huge expression for the nth item, which overflows its stack.</p>\n\n<p>You can increase the stack size with run time options, eg for a 16GB stack:</p>\n\n<pre><code>$ ghci +RTS -K16G\n&gt; newsum 0.5 0.5 10000000\n0.9999999000001789\n</code></pre>\n\n<p>But if you exceed the memory available to your system (which can include virtual memory / swap pages), you will have problems (here the Linux OOM killer struck me down):</p>\n\n<pre><code>&gt; newsum 0.5 0.5 100000000\nKilled\n$\n</code></pre>\n\n<p>This can be fixed in practice by writing a function that forces each head of the list to be evaluated before its tail can be accessed:</p>\n\n<pre><code>strict :: [a] -&gt; [a]\nstrict [] = []\nstrict (x:xs) = seq x (x : strict xs)\n</code></pre>\n\n<p><code>seq x y</code> forces <code>x</code> to be evaluated (to WHNF, which for <code>Double</code> means fully-evaluated) when the value of <code>y</code> is demanded.\nUse <code>strict</code> like this:</p>\n\n<pre><code>newsum' :: Reals -&gt; Reals -&gt; Int -&gt; Reals\nnewsum' a b n =\n    strict approxA!!n\n    where\n      approxA = a : zipWith coprod approxA approxB\n      approxB = b : zipWith prod approxA approxB\n</code></pre>\n\n<p>Now it runs in small constant memory.</p>\n\n<p>An alternative is to use a stricter data structure (the <code>!a</code> is a strict <code>a</code>):</p>\n\n<pre><code>data List' a = !a :! List' a\n</code></pre>\n\n<p>but then you need to reimplement <code>(!!)</code> and <code>zipWith</code> for this type.</p>\n"}], "owner": {"reputation": 39, "user_id": 10802473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/090a85574f38876e18f9a16450a6f40e?s=128&d=identicon&r=PG&f=1", "display_name": "makkiato", "link": "https://stackoverflow.com/users/10802473/makkiato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1545076440, "creation_date": 1545068591, "question_id": 53820471, "link": "https://stackoverflow.com/questions/53820471/exception-stack-overflow-stack-overflow", "title": "*** Exception: stack overflow : Stack overflow", "body": "<p>I am learning Haskell and I am getting an exception \"stack overflow\" I was not expecting. </p>\n\n<p>The code is fairly simple: </p>\n\n<pre><code>type Reals = Double\n\nprod :: Reals -&gt; Reals -&gt; Reals\nprod a b = a*b\n\ncoprod :: Reals -&gt; Reals -&gt; Reals\ncoprod a b = a + b - (prod a b)\n\nnewsum :: Reals -&gt; Reals -&gt; Int -&gt; Reals\nnewsum a b n =   \n    approxA!!n \n    where\n      approxA = a : zipWith coprod approxA approxB \n      approxB = b : zipWith prod approxA approxB \n</code></pre>\n\n<p>The functions prod, coprod are intended to be evalated on reals in [0,1]. The function </p>\n\n<blockquote>\n  <p>newsum a b n</p>\n</blockquote>\n\n<p>for n going to infinity, computes the function (a,b) -> min(1, a+b). </p>\n\n<p>You can try</p>\n\n<blockquote>\n  <p>newsum 0.5 0.5 10</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>newsum 0.5 0.5 10000</p>\n</blockquote>\n\n<p>to see this. However, by calling </p>\n\n<blockquote>\n  <p>newsum 0.5 0.5 10000000</p>\n</blockquote>\n\n<p>I get a stack overflow. The newsum function is simple and makes a linear (in n) number of operations of Double type. In other words, the construction n-th element of the(infinite) lists of type [Reals]</p>\n\n<blockquote>\n  <p>approxA </p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>approxB</p>\n</blockquote>\n\n<p>takes linear time. </p>\n\n<p>QUESTION 1: Why am I getting the stack overflow? |\nWhat are the limits of Haskell (or GHCi) and how can I estimate them (in advance) in a simple program like the one above?</p>\n\n<p>QUESTION 2: Is there a flag/command in Haskell to instruct the interpreter to page the memory automatically, if needed? I want to write code that resemble Math, and don't want to spend time thinking about memory limits, stack overflows and stuff like that.</p>\n\n<p>thanks!</p>\n"}, {"tags": ["haskell", "cabal", "ghci"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1545063264, "post_id": 53818910, "comment_id": 94486490, "body": "Are you using a stack &quot;LTS&quot; resolver?"}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1545067135, "post_id": 53818910, "comment_id": 94488684, "body": "Sometimes, but not all the time. Would that make a world of difference? Haskell remains very complex IMO compared to eg. C++, Swift, Ruby etc."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1545068750, "post_id": 53818910, "comment_id": 94489463, "body": "Well, Stack LTS snapshots are guaranteed to use a compatible set of package-versions (that has already been tested to work together). \u2014 I prefer Cabal, and yes, I occasionally fix issues in other people&#39;s packages and send them a pull request. But for the most part, everything actually works out of the box. \u2014 Eh, now... what exactly is your question? As it stands, this seems both <i>too broad</i> and <i>opinion-based</i>."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1545069412, "post_id": 53818910, "comment_id": 94489753, "body": "One way to improve your question would be to list the exact commands you&#39;re using to install your dependencies, as that would give answers a chance to suggest specific improvements."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1545131519, "post_id": 53818910, "comment_id": 94511773, "body": "We might close this one since it is too broad I realize. Would say I need more experience with Stack or Cabal."}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1545062834, "creation_date": 1545062834, "question_id": 53818910, "link": "https://stackoverflow.com/questions/53818910/haskell-libraries-fail-to-build-or-have-issues", "title": "Haskell libraries fail to build or have issues", "body": "<p>Abstract question, sorry. Now finished most popular Haskell books and trying out libraries. Very many provide me with challenges in build problems with dependencies, deprecation and what not. Example: </p>\n\n<pre><code>Main.hs:5:1: warning: [-Wdeprecations]\n    Module \u2018Data.Attoparsec.Char8\u2019 is deprecated:\n      This module will be removed in the next major release.\n  |\n5 | import Data.Attoparsec.Char8\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nOk, one module loaded.\n</code></pre>\n\n<p>Trying to use <code>Spock</code> one of the dependencies was imported with the wrong name (camelcase). <code>Blaze</code> could not find all dependencies and so on. \nIs it common among real Haskellers (consider myself in Haskell kindergarten) to tackle these issues themselves, or am I just not getting the big picture in building it all wrong. Note I have most issues with Stack, less with Cabal and even less with a global install and GHCI (except for anything Gtk+ related).</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1545063487, "post_id": 53818534, "comment_id": 94486600, "body": "It looks as if the last sample was taken at ~80s, and then a &quot;zero&quot; point was added at the very end. I would not trust that tail."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1545066638, "post_id": 53818534, "comment_id": 94488448, "body": "@chi Yeah, I don&#39;t. But why is this happening in the first place?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1545066754, "post_id": 53818534, "comment_id": 94488498, "body": "No real idea. Is the process just sitting idle for a very long time? Maybe if no memory is allocated the RTS won&#39;t generate new samples (?)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1545073628, "post_id": 53818534, "comment_id": 94491633, "body": "If I take off <code>-h</code> and just look at the <code>.prof</code> file, looks like runtime really is ~80s. This is definitely a bit confusing."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1545074930, "post_id": 53818534, "comment_id": 94492262, "body": "Seems to be a glitch in plotting."}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1545061520, "creation_date": 1545061520, "question_id": 53818534, "link": "https://stackoverflow.com/questions/53818534/heap-profile-graph-has-perfectly-linear-tail", "title": "Heap profile graph has perfectly linear tail", "body": "<p>I'm struggling to understand heap graphs that look like the following:</p>\n\n<p><a href=\"https://i.stack.imgur.com/RxfEt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RxfEt.png\" alt=\"heap graph\"></a></p>\n\n<p>In particular, I'm a bit baffled by the very regular looking tail of the graph (from 100.0s to the end). Am I to understand that the heap size decreased perfectly linearly? Is this a known issue with <code>+RTS -h -RTS</code>?</p>\n\n<p>This graph was generated with</p>\n\n<pre><code>$ cabal new-build --enable-profiling --ghc-options \"-rtsopts -O2\"\n$ $(find dist-newstyle -type f -name haddock) +RTS -h -p -RTS ...\n$ hp2ps -c haddock.hp\n</code></pre>\n"}, {"tags": ["haskell", "expression"], "comments": [{"owner": {"reputation": 5335, "user_id": 6920962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e62cd73355fc90d37429f9443df38da?s=128&d=identicon&r=PG&f=1", "display_name": "user28434", "link": "https://stackoverflow.com/users/6920962/user28434"}, "edited": false, "score": 3, "creation_date": 1545059593, "post_id": 53817848, "comment_id": 94484292, "body": "First one is equivalent to <code>(\\x -&gt; x * 30) 4</code>, second one is calling <code>*</code> as if it&#39;s non-infix operator but a function, which is not valid, <code>(*) 30 40</code> should be used instead."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1545066202, "post_id": 53817848, "comment_id": 94488198, "body": "You&#39;re asking how Haskell parses that code, not about evaluation"}], "answers": [{"tags": [], "owner": {"reputation": 1519, "user_id": 1486848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KNtLf.jpg?s=128&g=1", "display_name": "ShamPooSham", "link": "https://stackoverflow.com/users/1486848/shampoosham"}, "is_accepted": false, "score": 2, "last_activity_date": 1545059564, "creation_date": 1545059564, "answer_id": 53817999, "question_id": 53817848, "link": "https://stackoverflow.com/questions/53817848/how-does-haskell-evaluate-expression/53817999#53817999", "title": "How does Haskell evaluate expression", "body": "<p>Haskell uses a special syntax for partial application of infix operators (<code>*</code>, <code>+</code>, <code>^</code> etc). It will only work inside brackets from what I understand. <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Section_of_an_infix_operator</a></p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 6, "last_activity_date": 1545059570, "creation_date": 1545059570, "answer_id": 53818001, "question_id": 53817848, "link": "https://stackoverflow.com/questions/53817848/how-does-haskell-evaluate-expression/53818001#53818001", "title": "How does Haskell evaluate expression", "body": "<p><code>(* 30)</code> is a <em>section</em>, which still treats <code>*</code> as a binary (infix) operator, just one that's missing an argument, short for <code>(\\x -&gt; x * 30)</code>. The parentheses themselves are part of the syntax, rather than being the explicit (but redundant) parentheses you can wrap around an arbitrary expression.</p>\n\n<p>You can think of <code>(*)</code> as a degenerate section that is missing <em>both</em> arguments. You cannot otherwise use an infix operator in the prefix position without using parentheses.</p>\n"}], "owner": {"reputation": 1658, "user_id": 1411869, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cd64b633df80262c37b51189fd1648ec?s=128&d=identicon&r=PG", "display_name": "Bob Ueland", "link": "https://stackoverflow.com/users/1411869/bob-ueland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 53818001, "answer_count": 2, "score": 1, "last_activity_date": 1545059570, "creation_date": 1545059018, "question_id": 53817848, "link": "https://stackoverflow.com/questions/53817848/how-does-haskell-evaluate-expression", "title": "How does Haskell evaluate expression", "body": "<p>How come that this works</p>\n\n<pre><code>&gt; (* 30) 4\n120\n</code></pre>\n\n<p>but this doesn't</p>\n\n<pre><code>&gt; * 30 40\nerror: parse error on input \u2018*\u2019\n</code></pre>\n"}, {"tags": ["haskell", "indentation", "curly-braces"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1545062918, "post_id": 53817145, "comment_id": 94486293, "body": "Intuitively, in such case one should use the line <code>L (t : ts) (m : ms) = }  :  (L (t : ts) ms) if m &#47;= 0 and parse-error(t)</code> to close the implicit brace, but I can&#39;t find any justification about why this equation should be applied at this point."}], "owner": {"reputation": 369, "user_id": 3577289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f1787220565591f5ecb6aba686abb6?s=128&d=identicon&r=PG&f=1", "display_name": "gksato", "link": "https://stackoverflow.com/users/3577289/gksato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1545056891, "creation_date": 1545056447, "last_edit_date": 1545056891, "question_id": 53817145, "link": "https://stackoverflow.com/questions/53817145/ghc-seems-to-break-haskell-2010-layout-rule", "title": "GHC seems to break Haskell 2010 layout rule", "body": "<p>Think of the following code in Haskell:</p>\n\n<pre><code>f = y\n  where { y = t where t = 2 }\n</code></pre>\n\n<p>Its intended meaning is</p>\n\n<pre><code>f = y\n  where\n    y = t\n      where\n        t = 2\n</code></pre>\n\n<p>and it <strong>compiles as intended</strong> with GHC 8.4.4. However it does not look like an appropriate behavior according to <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-17800010.3\" rel=\"nofollow noreferrer\">Section 10.3 of Haskell 2010 Language Report</a>. Let me explain. The preprocess described there turns the above snippet to:</p>\n\n<pre><code>{1} f = y &lt;3&gt; where { y = t where {23} t = 2 }\n</code></pre>\n\n<p>Applying this to the function <code>L</code> in the Report yields parse-error at the last close-brace <code>}</code>! Explicitly, the symbol <code>{23}</code>, which is inserted since the second <code>where</code> is not followed by <code>{</code>, is interpreted as an implicit open-brace of level 23, and L reports parse-error for us closing this implicit open-brace with the explicit close-brace <code>}</code>!</p>\n\n<p>I do hope I am making some mistake, but if I am not, is there any document on this conflict of behavior and specification? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "edited": false, "score": 0, "creation_date": 1545055899, "post_id": 53816967, "comment_id": 94482156, "body": "Thanks. I&#39;ve just managed to do it with ByteString. I will try your suggestions too"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1545055805, "creation_date": 1545055805, "answer_id": 53816967, "question_id": 53816503, "link": "https://stackoverflow.com/questions/53816503/haskell-win32-lpctstr-isstring-typeclass/53816967#53816967", "title": "Haskell Win32 LPCTSTR IsString Typeclass", "body": "<p>This instance can't be sensibly defined, for the same reason it can't be done with <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Foreign-C-String.html\" rel=\"nofollow noreferrer\">CString</a>: <em>pointers to char can't do memory management</em>. Thus, generating C-strings at runtime would be either unsafe from dangling memory, or incur memory leaks.</p>\n\n<p>What <em>should</em> in principle be possible is to nevertheless get access to <em>string literals</em>, the same way this is also possible in C itself: by just allocating a static memory location once an <em>compile time</em>. But the <code>IsString</code> class doesn't support this.</p>\n\n<p>In summary: C-strings are a pain to work with in Haskell, so better only use them directly at the interface to the C code. I.e. if you write even a low-level wrapper around a C function taking a C [w]string, then this should take a <code>String</code> or <code>Text</code> as the argument. Convert it to the suitable C-string in the IO block right around the C call, and \u201cpurify\u201d them together with <code>unsafePerformIO</code>.</p>\n"}], "owner": {"reputation": 639, "user_id": 10654293, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N3y4b1ilweA/AAAAAAAAAAI/AAAAAAAAAAQ/nO5VTzQiUu0/photo.jpg?sz=128", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/10654293/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 53816967, "answer_count": 1, "score": 0, "last_activity_date": 1545055949, "creation_date": 1545054260, "last_edit_date": 1545055949, "question_id": 53816503, "link": "https://stackoverflow.com/questions/53816503/haskell-win32-lpctstr-isstring-typeclass", "title": "Haskell Win32 LPCTSTR IsString Typeclass", "body": "<p>I'm testing <code>incline-c</code> for win32 api.\nI realized that <code>LPCTSTR</code> doesn't have a <code>IsString</code> instance.\nBut I don't know how to write it.\nAny hint?</p>\n\n<p>For information:</p>\n\n<pre><code>type LPTSTR = Ptr TCHAR\ntype TCHAR = CWchar\n</code></pre>\n\n<p>defined in <code>System.Win32.Types</code></p>\n\n<p>and</p>\n\n<pre><code>newtype CWchar\n\nHaskell type representing the C wchar_t type.\n\nConstructors\nCWchar Int32    \n</code></pre>\n\n<p>Here's my code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE TypeSynonymInstances #-}\n{-# LANGUAGE FlexibleInstances #-}\n\nimport Data.String\nimport qualified Language.C.Inline.Win32 as CW\nimport qualified Language.C.Inline as C\nimport System.Win32.Types\n\ninstance IsString LPCTSTR where\n\n\nC.context CW.win32Ctx\n\nC.include \"&lt;windows.h&gt;\"\n\nshowMsg :: LPCTSTR -&gt; IO INT\nshowMsg s = do\n  [C.exp| INT{ MessageBox( NULL, $(LPCTSTR s), \"Haskell Rocks\", MB_OK )} |]\n\nmain = showMsg \"Hello Haskell\"\n</code></pre>\n\n<p>Edit:\nI've managed to achieve this with ByteString</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\n\nimport qualified Data.ByteString as BS\nimport qualified Language.C.Inline.Win32 as CW\nimport qualified Language.C.Inline as C\nimport System.Win32.Types\n\nC.context (CW.win32Ctx &lt;&gt; C.bsCtx)\n\nC.include \"&lt;windows.h&gt;\"\n\nshowMsg :: BS.ByteString -&gt; IO INT\nshowMsg s = do\n  [C.exp| INT{ MessageBox( NULL, $bs-ptr:s, \"Haskell Rocks\", MB_OK )} |]\n\nmain = showMsg \"Hello Haskell\"\n</code></pre>\n"}, {"tags": ["haskell", "types", "data-kinds"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1545045729, "post_id": 53813016, "comment_id": 94476534, "body": "The clash is also particularly evident in <code>(a,b) :: *</code> vs <code>&#39;(a,b) :: (*, *)</code>. Ditto for <code>[a] :: *</code> vs <code>&#39;[a] :: [*]</code> (even if these are special syntactic cases)."}, {"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 0, "creation_date": 1545047006, "post_id": 53813016, "comment_id": 94477197, "body": "@leftaroundabout Thank for your answer, Does it mean that when the context need <code>Nat</code> as a type then <code>Nat</code> is a type and <code>Zero</code> and <code>Succ</code> are constructor. And when the context need <code>Nat</code> as a kind, <code>Nat</code> become a kind, and <code>Zero</code> and <code>Succ</code> become a type? Otherwise, I still don&#39;t understand why we need <code>&#39;Zero</code>. In what situation the clashes you mentioned in the answer will occur?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 1, "creation_date": 1545049434, "post_id": 53813016, "comment_id": 94478478, "body": "@JoeChoi Yes, everything you asserted is correct. But your question puzzles me; doesn&#39;t the answer already give an explicit example where name clashes can occur?"}, {"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1545049688, "post_id": 53813016, "comment_id": 94478622, "body": "@DanielWagner I don&#39;t understand the example in answer why the name clashes."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 2, "creation_date": 1545049880, "post_id": 53813016, "comment_id": 94478728, "body": "@JoeChoi it clashes because I defined both a data type called <code>Zero</code> and a value constructor called <code>Zero</code>. In normal Haskell2010, these wouldn&#39;t clash because type-level language and value-level language are completely separate, but <code>-XDataKinds</code> \u201ccopies\u201d the value-level <code>Zero</code> into the type-level language, so <code>Zero</code> in a type-level context is now ambiguous. To prevent <code>DataKinds</code> from breaking any existing code, they made it default to the Haskell2010 meaning, i.e. <code>Zero :: *</code>. Thus to also get access to the new meaning of <i>promoted-to-type value-level constructor</i>, we need the <code>&#39;</code> syntax."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 0, "creation_date": 1545051967, "post_id": 53813016, "comment_id": 94479863, "body": "@JoeChoi I started writing up an explanation of the name clashes, but it turned out to be a bit long for a comment. So I&#39;ve made an answer with my attempt at a careful explanation of what&#39;s going on here."}, {"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 0, "creation_date": 1545068460, "post_id": 53813016, "comment_id": 94489330, "body": "@leftaroundabout Thank for your further explanation, I still unable to comprehend it, maybe I need spend much time to study it."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 5, "last_activity_date": 1545041610, "creation_date": 1545041610, "answer_id": 53813016, "question_id": 53812685, "link": "https://stackoverflow.com/questions/53812685/confused-on-datakinds-extension/53813016#53813016", "title": "Confused on DataKinds extension", "body": "<p><code>{-# LANGUAGE DataKinds #-}</code> does not change what the <code>data</code> keyword usually does: it still creates a type <code>Nat</code> and two value constructors <code>Zero</code> and <code>Succ</code>. What this extension does do is, it allows you to use such types as if they were kinds, and values as if they were types.</p>\n\n<p>Thus, if you use <code>Nat</code> in a type-level expressions, it'll just use it as a boring Haskell98 type. Only if you use it in an unabiguously <em>kind</em>-level expression, do you get the kind version.</p>\n\n<p>This automatic lifting could sometimes cause name clashes, which is, I think, the reason for the <code>'</code> syntax: </p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\ndata Nat = Zero | Succ Nat\ndata Zero\n</code></pre>\n\n<p>Now, <code>Zero</code> by itself is the plain (empty) data type <code>Zero :: *</code>, so</p>\n\n<pre><code>*Main&gt; :k Zero\nZero :: *\n</code></pre>\n\n<p>In principle, thanks to <code>DataKinds</code>, <code>Zero</code> is now also a type lifted from the value constructor <code>Zero :: Nat</code>, but this is shadowed by the <code>data Zero</code>. Thus the quoting-syntax, which always refers to lifted types, never to directly defined ones:</p>\n\n<pre><code>*Main&gt; :k 'Zero\n'Zero :: Nat\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 1, "creation_date": 1545071754, "post_id": 53815871, "comment_id": 94490794, "body": "Thanks for you answer, Does the tricky here is that compiler tries <code>:kind &#39;Zero</code> instead of <code>:kind Zero</code> in type-level? Anytime the name <code>Zero</code> appear in type-level, compiler replace it with <code>&#39;Zero</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 0, "creation_date": 1545073568, "post_id": 53815871, "comment_id": 94491601, "body": "@JoeChoi No, not <i>any time</i>, as explained in my answer: the compiler first checks if <code>Zero</code> exists, and only if it does not exist will it check whether <code>&#39;Zero</code> exists instead."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 0, "creation_date": 1545074364, "post_id": 53815871, "comment_id": 94492001, "body": "@JoeChoi I have added some precision about this question, distinguishing between the back end, where names are always unambiguous, and the surface syntax that we use to communicate with the compiler. See especially the new ASCII-art table that begins &quot;Surface syntax Level Back end&quot;. In this terminology, the surface syntax <code>Zero</code> may correspond to the back end <code>Zero</code> or <code>&#39;Zero</code>, depending on what declarations are in scope."}, {"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "edited": false, "score": 0, "creation_date": 1545075878, "post_id": 53815871, "comment_id": 94492670, "body": "Thank you very much! it is clear and now I eventually understand why add <code>data Zero</code> declaration in leftaroundabout&#39;s answer will cause name clashes if doesn&#39;t use <code>&#39;Zeor</code> instead of <code>Zero</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 13, "last_activity_date": 1545074256, "last_edit_date": 1545074256, "creation_date": 1545051933, "answer_id": 53815871, "question_id": 53812685, "link": "https://stackoverflow.com/questions/53812685/confused-on-datakinds-extension/53815871#53815871", "title": "Confused on DataKinds extension", "body": "<p>In unextended Haskell, the declaration</p>\n\n<pre><code>data A = B\n</code></pre>\n\n<p>defines two new entities, one each at the computation and type level:</p>\n\n<ol>\n<li>At the type level, a new base type named <code>A</code> (of kind <code>*</code>), and</li>\n<li>At the computation level, a new base computation named <code>B</code> (of type <code>A</code>).</li>\n</ol>\n\n<p>When you turn on <code>DataKinds</code>, the declaration</p>\n\n<pre><code>data A = B\n</code></pre>\n\n<p>now defines four new entities, one at the computation level, two at the type level, and one at the kind level:</p>\n\n<ol>\n<li>At the kind level, a new base kind <code>A</code>,</li>\n<li>At the type level, a new base type <code>'B</code> (of kind <code>A</code>),</li>\n<li>At the type level, a new base type <code>A</code> (of kind <code>*</code>), and</li>\n<li>At the computation level, a new base computation <code>B</code> (of type <code>A</code>).</li>\n</ol>\n\n<p>This is a strict superset of what we had before: the old (1) is now (3), and the old (2) is now (4).</p>\n\n<p>These new entities explain the following interactions you described:</p>\n\n<pre><code>:type Zero\nZero :: Nat\n:kind 'Zero\n'Zero :: Nat\n:type 'Zero\nSyntax error on 'Zero\n</code></pre>\n\n<p>I think it's clear how it explains the first two. The last one it explains because <code>'Zero</code> is a type-level thing -- you can't ask for the type of a type, only the type of a computation!</p>\n\n<p>Now, in Haskell, every place where a name occurs, it is clear from the surrounding syntax whether that name is intended to be a computation-level name, a type-level name, or a kind-level name. For this reason, it is somewhat annoying to have to include the tick mark in <code>'B</code> at the type level -- after all, the compiler <em>knows</em> we're at the type level and therefore can't be referring to the unlifted computation-level <code>B</code>. So for convenience, you are permitted to leave off the tick mark when that is unambiguous.</p>\n\n<p>From now on, I will distinguish between the \"back end\" -- where there are only the four entities described above and which are always unambiguous -- and the \"surface syntax\", which is the stuff you type into a file and pass off to GHC that includes ambiguity but is more convenient. Using this terminology, in the surface syntax, one may write the following things, with the following meanings:</p>\n\n<pre><code>Surface syntax    Level           Back end\nName              computation     Name\nName              type            Name if that exists; 'Name otherwise\n'Name             type            'Name\nName              kind            Name\n---- all other combinations ----  error\n</code></pre>\n\n<p>This explains the first interaction you had (and the only one left unexplained above):</p>\n\n<pre><code>:kind Zero\nZero :: Nat\n</code></pre>\n\n<p>Because <code>:kind</code> must be applied to a type-level thing, the compiler knows the surface syntax name <code>Zero</code> must be a type-level thing. Since there is no type-level back end name <code>Zero</code>, it tries <code>'Zero</code> instead, and gets a hit.</p>\n\n<p>How can it be ambiguous? Well, notice above that we defined <em>two</em> new entities at the type level with one declaration. For simplicity of introduction, I named the new entities on the left- and right-hand side of the equation different things. But let's see what happens if we just tweak the declaration slightly:</p>\n\n<pre><code>data A = A\n</code></pre>\n\n<p>We still introduce four new back end entities:</p>\n\n<ol>\n<li>Kind <code>A</code>,</li>\n<li>Type <code>'A</code> (of kind <code>A</code>),</li>\n<li>Type <code>A</code> (of kind <code>*</code>), and</li>\n<li>Computation <code>A</code> (of type <code>A</code>).</li>\n</ol>\n\n<p>Whoops! There is now both an <code>'A</code> and an <code>A</code> at the type level. If you leave off the tick mark in the surface syntax, it will use (3), and not (2) -- and you can explicitly choose (2) with the surface syntax <code>'A</code>.</p>\n\n<p>What's more, this doesn't have to happen all from a single declaration. One declaration may produce the ticked version and another the non-ticked version; for example</p>\n\n<pre><code>data A = B\ndata C = A\n</code></pre>\n\n<p>will introduce a type-level back end name <code>A</code> from the first declaration and a type-level back end name <code>'A</code> from the second declaration.</p>\n"}], "owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 476, "favorite_count": 1, "accepted_answer_id": 53815871, "answer_count": 2, "score": 8, "last_activity_date": 1562339519, "creation_date": 1545040368, "last_edit_date": 1562339519, "question_id": 53812685, "link": "https://stackoverflow.com/questions/53812685/confused-on-datakinds-extension", "title": "Confused on DataKinds extension", "body": "<p>I learn type programming of Haskell from <a href=\"https://www.parsonsmatt.org/2017/04/26/basic_type_level_programming_in_haskell.html\" rel=\"noreferrer\">Basic Type Level Programming in Haskell</a> but when it introduce <code>DataKinds</code> extension, there are something seems confusing from the example:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\ndata Nat = Zero | Succ Nat\n</code></pre>\n\n<p>Now, <code>Nat</code> is promoted to <code>Kind</code>, it is okay. But how about <code>Zero</code> and <code>Succ</code>?</p>\n\n<p>I try to get some information from GHCi, so I type:</p>\n\n<pre><code>:kind Zero\n</code></pre>\n\n<p>it gives</p>\n\n<pre><code>Zero :: Nat\n</code></pre>\n\n<p>that is okay, <code>Zero</code> is a type has kind <code>Nat</code>, right? and I try:</p>\n\n<pre><code>:type Zero\n</code></pre>\n\n<p>it still gives:</p>\n\n<pre><code>Zero :: Nat\n</code></pre>\n\n<p>that means <code>Zero</code> has type <code>Nat</code>, that is impossible, since <code>Nat</code> is a kind not type, right? Does <code>Nat</code> is both a type and a kind ??</p>\n\n<p>And other confusing thing is, above blog also mentioned that, when create <code>Nat</code> kind, there are two new types: <code>'Zero</code> and <code>'Succ</code> are created automatically. When I try it from GHCi again:</p>\n\n<pre><code>:kind 'Zero\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>'Zero :: Nat\n</code></pre>\n\n<p>and </p>\n\n<pre><code>:type 'Zero\n</code></pre>\n\n<p>gives</p>\n\n<pre><code> Syntax error on 'Zero\n</code></pre>\n\n<p>Okay, it proves that <code>'Zero</code> is a type. but what is the purpose of creating <code>'Zero</code> and '<code>Succ'</code>??</p>\n"}, {"tags": ["haskell", "type-conversion", "typeclass"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1545039669, "post_id": 53812444, "comment_id": 94473191, "body": "Why don&#39;t you just use a <code>Rational</code> (or even a <code>Double</code>, though that can lose precision)? Both contain integers as well."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1545039922, "post_id": 53812444, "comment_id": 94473357, "body": "To find out to which typeclass some method/function belongs, just look up its documentation. This is easiest found <a href=\"https://hayoo.fh-wedel.de/?query=%2B\" rel=\"nofollow noreferrer\">on Hayoo</a>.  It turns out <code>+</code>, <code>-</code> and <code>*</code> are methods of the <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Num\" rel=\"nofollow noreferrer\"><code>Num</code> class</a>, whereas <code>&#47;</code> is a method of <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#t:Fractional\" rel=\"nofollow noreferrer\"><code>Fractional</code></a>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1545055711, "post_id": 53812444, "comment_id": 94482042, "body": "You post a lot of questions about this sum type; are you <i>sure</i> you don&#39;t simply want to add a <code>Num</code> constraint to whatever function uses this type instead of being so specific? <code>fun :: Num a =&gt; a -&gt; a</code> instead of <code>fun :: Numeric -&gt; Numeric</code> for instance."}], "answers": [{"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": true, "score": 4, "last_activity_date": 1545041279, "last_edit_date": 1545041279, "creation_date": 1545040305, "answer_id": 53812669, "question_id": 53812444, "link": "https://stackoverflow.com/questions/53812444/how-to-use-conversion-typeclasses/53812669#53812669", "title": "How to use conversion typeclasses", "body": "<p>You need to make your class instance of <code>Num</code> to have <code>+</code>, <code>-</code>, <code>*</code> and most important <code>fromInteger</code> and instance of <code>Fractional</code> to have <code>/</code> and <code>fromRational</code>.</p>\n\n<p>Here is small stub for simplified version:</p>\n\n<pre><code>data Numeric = N Double\n   deriving Show\n\ninstance Num Numeric where\n   (*) (N a) (N b) = N (a * b) \n   (+) (N a) (N b) = N (a + b) \n   (-) (N a) (N b) = N (a - b) \n   abs (N a) = N $ abs a\n   signum (N a) = N $ signum a\n   fromInteger a = N $ fromInteger a\n\ninstance Fractional Numeric where\n   fromRational d = N $ fromRational d\n   (/) (N a) (N b) = N (a / b) \n</code></pre>\n"}], "owner": {"reputation": 6267, "user_id": 1913744, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5bAQS.jpg?s=128&g=1", "display_name": "Bercovici Adrian", "link": "https://stackoverflow.com/users/1913744/bercovici-adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 53812669, "answer_count": 1, "score": 0, "last_activity_date": 1545041279, "creation_date": 1545039514, "question_id": 53812444, "link": "https://stackoverflow.com/questions/53812444/how-to-use-conversion-typeclasses", "title": "How to use conversion typeclasses", "body": "<p>Hello i have  trouble understanding what <code>typeclass</code> i need to implement for doing mathematical operations with <code>Int</code>'s and <code>Double</code>'s (for now).</p>\n\n<pre><code>data Numeric=I Int | D Double deriving (Show)\n</code></pre>\n\n<p>I want to be able to perform: <code>+</code>,<code>-</code>,<code>*</code>,<code>/</code> on <code>I</code>'s with <code>D</code>'s , compare them and order them .Which typeclass do i need to implement ? <code>Num</code>,<code>Integral</code>,<code>Ord</code> ? </p>\n"}, {"tags": ["haskell", "lambda"], "answers": [{"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 5, "last_activity_date": 1545090536, "last_edit_date": 1545090536, "creation_date": 1545041021, "answer_id": 53812868, "question_id": 53812438, "link": "https://stackoverflow.com/questions/53812438/arguments-in-lambda-expressions/53812868#53812868", "title": "Arguments in lambda expressions", "body": "<blockquote>\n  <p>Are there two arguments or are there three arguments?</p>\n</blockquote>\n\n<p><strong>Three arguments</strong></p>\n\n<p>If don't explicit add parentheses to <code>zz</code> as <code>(zz)</code>, the application associate to the left as below:</p>\n\n<pre><code>( ( (\u03bbabc.cba) z) z) (\u03bbwv.w)\n</code></pre>\n\n<p>It is equivalent to take three arguments.</p>\n"}], "owner": {"reputation": 1658, "user_id": 1411869, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cd64b633df80262c37b51189fd1648ec?s=128&d=identicon&r=PG", "display_name": "Bob Ueland", "link": "https://stackoverflow.com/users/1411869/bob-ueland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 53812868, "answer_count": 1, "score": 1, "last_activity_date": 1545090536, "creation_date": 1545039494, "last_edit_date": 1545040305, "question_id": 53812438, "link": "https://stackoverflow.com/questions/53812438/arguments-in-lambda-expressions", "title": "Arguments in lambda expressions", "body": "<p>In a book I encountered the following lambda expression</p>\n\n<pre><code>(\u03bbabc.cba)zz(\u03bbwv.w)\n</code></pre>\n\n<p>How should I interpret the arguments of (\u03bbabc.cba)? Are there two arguments</p>\n\n<pre><code>(zz)(\u03bbwv.w)\n</code></pre>\n\n<p>or are there three arguments</p>\n\n<pre><code>(z)(z)(\u03bbwv.w)\n</code></pre>\n\n<p>I suspect three arguments since normally one letter is used in Mathematics to denote a variable (unlike from in programming).</p>\n"}, {"tags": ["haskell", "computation"], "answers": [{"comments": [{"owner": {"reputation": 541, "user_id": 1765638, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EkRAz.jpg?s=128&g=1", "display_name": "Pasha", "link": "https://stackoverflow.com/users/1765638/pasha"}, "edited": false, "score": 0, "creation_date": 1545060941, "post_id": 53811228, "comment_id": 94485127, "body": "You are right, thank you. But why did it show correct output during the debug process after &quot;:continue&quot; command?"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "reply_to_user": {"reputation": 541, "user_id": 1765638, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EkRAz.jpg?s=128&g=1", "display_name": "Pasha", "link": "https://stackoverflow.com/users/1765638/pasha"}, "edited": false, "score": 2, "creation_date": 1545066529, "post_id": 53811228, "comment_id": 94488384, "body": "@Pavel  I am not sure how <code>:continue</code> to work, but it seems print out the <code>_result</code> variable which is bounded to specific break point and not the final result of the function. If you try to set break point to the line <code>in f []</code> instead, and try <code>:countinue</code> command, it will print <code>aaaabcabcaabcadeabcadeabcadeabcade&quot;</code> instead of <code>abcade&quot;</code>"}], "tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 5, "last_activity_date": 1545046056, "last_edit_date": 1545046056, "creation_date": 1545034731, "answer_id": 53811228, "question_id": 53810887, "link": "https://stackoverflow.com/questions/53810887/haskell-strange-to-me-behavior/53811228#53811228", "title": "Haskell strange (to me) behavior", "body": "<p>The problem comes from the expression below:</p>\n\n<pre><code>x == last acc = acc ++ f acc xs\n</code></pre>\n\n<p>It doesn't need to append the <code>acc</code> string at the beginning of the result, so the correction should be:</p>\n\n<pre><code>x == last acc = f acc xs\n</code></pre>\n\n<p>Note that <code>acc</code> contains the correct result you want, i.e. the string without consecutive duplicates, hence you can see the correct result <code>acc :: [Char] = \"abcade\"</code> at the break point when the input list is <code>[]</code>. But when it returns, it combines the previous result as <code>acc ++ \"abcade\"</code>, from which the \"abcade\" at the end of <code>\"aaaabcabcaabcadeabcadeabcadeabcade\"</code></p>\n"}], "owner": {"reputation": 541, "user_id": 1765638, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EkRAz.jpg?s=128&g=1", "display_name": "Pasha", "link": "https://stackoverflow.com/users/1765638/pasha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 53811228, "answer_count": 1, "score": 1, "last_activity_date": 1545046056, "creation_date": 1545033088, "last_edit_date": 1545033392, "question_id": 53810887, "link": "https://stackoverflow.com/questions/53810887/haskell-strange-to-me-behavior", "title": "Haskell strange (to me) behavior", "body": "<p>I am working on 99 problems of Haskell (<a href=\"https://wiki.haskell.org/99_questions/1_to_10\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/99_questions/1_to_10</a>)\n, I have a question regarding to problem # 8. </p>\n\n<pre><code>8 Problem 8\n(**) Eliminate consecutive duplicates of list elements.\n\nIf a list contains repeated elements they should be replaced with a single copy of the element. The order of the elements should not be changed.\n</code></pre>\n\n<p>I've solved this problem with foldr function successfully. </p>\n\n<pre><code>compress :: Eq e =&gt; [e] -&gt; [e]\ncompress =  let f v [] = [v]\n                f v acc \n                        | head acc == v = acc\n                        | otherwise = v:acc\n            in foldr f []\n</code></pre>\n\n<p>But when I try to solve the same problem with recursion like this:</p>\n\n<pre><code>compress' :: Eq e =&gt; [e] -&gt; [e]\ncompress' = let f acc [] = acc\n                f [] (x:xs) = f [x] xs\n                f acc (x:xs) | x == last acc = acc ++ f acc xs\n                             | otherwise = f (acc ++ [x]) xs \n            in f []\n</code></pre>\n\n<p>I see really strange behavior. I see this result of this function:</p>\n\n<pre><code>compress' \"aaaabccaadeeee\"\n\"aaaabcabcaabcadeabcadeabcadeabcade\"\n</code></pre>\n\n<p>But if I add break point at line </p>\n\n<pre><code>compress' = let f acc [] = acc\n</code></pre>\n\n<p>it gives me correct result:</p>\n\n<pre><code>ghci&gt; compress' \"aaaabccaadeeee\"\n\"aaaabcabcaabcadeabcadeabcadeabcade\"\nghci&gt; :break 304\nBreakpoint 7 activated at haskell-tut.hs:304:28-30\nghci&gt; compress' \"aaaabccaadeeee\"\n\"aaaabcabcaabcadeabcadeabcadeStopped in Main.compress'.f, haskell-tut.hs:304:28-30\n_result :: [Char] = _\nacc :: [Char] = \"abcade\"\n[haskell-tut.hs:304:28-30] ghci&gt; :con\nabcade\"\nghci&gt;\n</code></pre>\n\n<p>I feel like it is some thing about Haskell laziness.... It is my best assumption. \nCan any one explain why do I get this odd result during execution and correct result during execution with breakpoint?</p>\n"}, {"tags": ["haskell", "lambda"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1545026267, "post_id": 53809592, "comment_id": 94467570, "body": "I don&#39;t have a copy of this book, but could it be a typo? (If the period mysteriously reappears in the next step, then this would seem to be most likely.)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1545035665, "post_id": 53809592, "comment_id": 94471081, "body": "The lambda notation with periods is really fiddly and prone to this kind of typo. I don&#39;t understand why people don&#39;t write (\u03bbx\u27fc\u03bby\u27fc\u03bbz\u27fcxz(yz))(\u03bbm\u27fc\u03bbn\u27fcm)(\u03bbp\u27fcp), or just use Haskell notation (\\x-&gt;\\y-&gt;\\z-&gt;xz(yz))(\\m-&gt;\\n-&gt;m)(\\p-&gt;p)."}, {"owner": {"reputation": 1658, "user_id": 1411869, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cd64b633df80262c37b51189fd1648ec?s=128&d=identicon&r=PG", "display_name": "Bob Ueland", "link": "https://stackoverflow.com/users/1411869/bob-ueland"}, "edited": false, "score": 0, "creation_date": 1545038644, "post_id": 53809592, "comment_id": 94472649, "body": "As I understand it Alonzo Church wrote \u03bbx(something) instead of \u03bbx.something. The advantage of using Church notation is that you see where the body begins and where it ends."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1545041991, "post_id": 53809592, "comment_id": 94474494, "body": "@BobUeland The usual convention is that the scope extends to the right as much as possible. So, a \u03bbx binds x until the first closed parentheses or the end of the term. IMO, it&#39;s nice to be able to write e.g. \u03bbxyz.xz(yz) without additional parentheses. For some reason, I prefer the dot to the more noisy <code>-&gt;</code>. Church introduced the terms using the notation <code>\u03bbx[M]</code> and <code>{F}[M]</code>, but then immediately wrote &quot;a formula <code>\u03bbx1[\u03bbx2[...\u03bbxn[M]...]]</code> may be abbreviated as <code>\u03bbx1x2...xn.M</code> or as <code>\u03bbx1x2...xnM</code>&quot; [Church36]. The latter is a little ambiguous. At that time he did not abbreviate <code>a(b)</code> as <code>ab</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1658, "user_id": 1411869, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cd64b633df80262c37b51189fd1648ec?s=128&d=identicon&r=PG", "display_name": "Bob Ueland", "link": "https://stackoverflow.com/users/1411869/bob-ueland"}, "edited": false, "score": 0, "creation_date": 1545026928, "post_id": 53809693, "comment_id": 94467770, "body": "If it is a typo then what does the expression reduce to. The answer in the book is \u03bbz.z. Is that correct?"}, {"owner": {"reputation": 4222, "user_id": 2072269, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/xNPjb.png?s=128&g=1", "display_name": "muru", "link": "https://stackoverflow.com/users/2072269/muru"}, "reply_to_user": {"reputation": 1658, "user_id": 1411869, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cd64b633df80262c37b51189fd1648ec?s=128&d=identicon&r=PG", "display_name": "Bob Ueland", "link": "https://stackoverflow.com/users/1411869/bob-ueland"}, "edited": false, "score": 1, "creation_date": 1545027786, "post_id": 53809693, "comment_id": 94468071, "body": "@BobUeland testing it quickly on GHCi, seems so. <code>let f = (\\x y z -&gt; x z (y z))(\\m n -&gt; m)(\\p -&gt; p)</code>, <code>:info f</code> =&gt; <code>f :: t -&gt; t</code>. (That&#39;s only the type information, but given the expressions involved, I&#39;d think it could only be  <code>\\x -&gt; x</code>)."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1545026509, "creation_date": 1545026509, "answer_id": 53809693, "question_id": 53809592, "link": "https://stackoverflow.com/questions/53809592/how-to-reduce-lambda-expression/53809693#53809693", "title": "How to reduce lambda expression", "body": "<p>That's positively, definitely, surely a typo.</p>\n"}], "owner": {"reputation": 1658, "user_id": 1411869, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cd64b633df80262c37b51189fd1648ec?s=128&d=identicon&r=PG", "display_name": "Bob Ueland", "link": "https://stackoverflow.com/users/1411869/bob-ueland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 53809693, "answer_count": 1, "score": 1, "last_activity_date": 1545035255, "creation_date": 1545025749, "last_edit_date": 1592644375, "question_id": 53809592, "link": "https://stackoverflow.com/questions/53809592/how-to-reduce-lambda-expression", "title": "How to reduce lambda expression", "body": "<p>I am reading the book &quot;Haskell from first principles&quot;. On page 12 we are learning how to reduce lambda expressions.</p>\n<p><a href=\"https://i.stack.imgur.com/6hXWO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6hXWO.png\" alt=\"enter image description here\" /></a></p>\n<p>What I do not understand is why the period character between \u03bbz and (\u03bbm.\u03bbn.m) disappeared in step 3. When I substitute x with (\u03bbm.\u03bbn.m) in step 3, I thought that only x should be substituted and not the period in front of it. So I would have expected\n(\u03bby.\u03bbz.(\u03bbm.\u03bbn.m)z(yz))(\u03bbp.p)\ninstead of\n(\u03bby.\u03bbz(\u03bbm.\u03bbn.m)z(yz))(\u03bbp.p)</p>\n<p>Here is my analysis</p>\n<hr />\n<ol>\n<li><p>(\u03bbxyz.xz(yz)) (\u03bbm.\u03bbn.m) (\u03bbp.p)</p>\n<p>Make currying explicit.</p>\n</li>\n<li><p>(\u03bbx.\u03bby.\u03bbz.xz(yz)) (\u03bbm.\u03bbn.m) (\u03bbp.p)</p>\n<p>Substitute x=(\u03bbm.\u03bbn.m)</p>\n</li>\n<li><p>(\u03bby.\u03bbz.(\u03bbm.\u03bbn.m)z(yz)) (\u03bbp.p)</p>\n<p>Substitute y=(\u03bbp.p)</p>\n</li>\n<li><p>(\u03bbz.(\u03bbm.\u03bbn.m)z((\u03bbp.p)z))</p>\n<p>We now observe that \u03bbz has no arguments. So what remains is to reduce (\u03bbm.\u03bbn.m)z((\u03bbp.p)z)</p>\n</li>\n<li><p>(\u03bbm.\u03bbn.m) z ((\u03bbp.p)z)</p>\n<p>Substitute m=z</p>\n</li>\n<li><p>(\u03bbn.z) ((\u03bbp.p)z)</p>\n<p>Here we have \u03bbn.z (something). But \u03bbn.z of anything is just z. (Since the body of \u03bbn.z is just z which does not contain n)</p>\n</li>\n<li><p>z</p>\n<p>Remembering \u03bbz in front from step 4, we end up with</p>\n</li>\n<li><p>\u03bbz.z</p>\n<p>So we end up with the same answer as the book.</p>\n</li>\n</ol>\n"}, {"tags": ["haskell", "recursion", "types", "pattern-matching"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1545011539, "post_id": 53808058, "comment_id": 94464750, "body": "What exactly is your question?  The closest you came was &quot;I am a bit unsure how I can optimize my code&quot;.  Do you want to make it faster?  If so we&#39;d need a benchmark.  Do you want less boilerplate?  A lambda case would help some for cheap.  Do you want style pointers? Hlint can tell you about things like those unneeded parenthesis.  Perhaps you mean something else by &quot;optimize&quot;, let us know."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7023126"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1545011777, "post_id": 53808058, "comment_id": 94464790, "body": "@ThomasM.DuBuisson It needs to be a bit faster as well as be less boiler plate."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 2, "creation_date": 1545018094, "post_id": 53808058, "comment_id": 94465796, "body": "There&#39;s an infinite loop with <code>simplify (Or (Var &quot;x&quot;) (Var &quot;y&quot;))</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1545020249, "post_id": 53808058, "comment_id": 94466183, "body": "It looks like the <code>Proposition</code> data constructor might be there by mistake. You never mention it in <code>simplify</code> and it smells like a duplicate of <code>Const</code>."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1545022231, "creation_date": 1545022231, "answer_id": 53809123, "question_id": 53808058, "link": "https://stackoverflow.com/questions/53808058/haskell-pattern-matching-optimization/53809123#53809123", "title": "Haskell Pattern Matching Optimization", "body": "<p>It looks like you generally want to follow the pattern</p>\n\n<ol>\n<li>Simplify all sub-expressions.</li>\n<li>Simplify the expression.</li>\n</ol>\n\n<p>To me, this suggests the <code>recursion-schemes</code> package.</p>\n\n<pre><code>{-# language TemplateHaskell, TypeFamilies, DeriveTraversable #-}\nimport Data.Functor.Foldable\nimport Data.Functor.Foldable.TH\n\ndata Proposition\n  = Const Bool\n  | Var String\n  | And Proposition Proposition\n  | Or Proposition Proposition\n  | Not Proposition\n  deriving (Show, Eq)\n\nmakeBaseFunctor ''Proposition\n</code></pre>\n\n<p>This magically generates a type</p>\n\n<pre><code>data PropositionF x\n  = ConstF Bool\n  | VarF String\n  | AndF x x\n  | OrF x x\n  | NotF x\n  deriving (Functor, Foldable, Traversable)\n</code></pre>\n\n<p>along with some related instances. Note that <code>PropositionF</code> replaces each occurrence of <code>Proposition</code> with a copy of its type parameter. Now you can write</p>\n\n<pre><code>simplify :: Proposition -&gt; Proposition\nsimplify = cata go\n  where\n    go :: PropositionF Proposition -&gt; Proposition\n\n    go (AndF (Const True) x) = x\n    go (AndF f@(Const False) _) = f\n    go (AndF x (Const True)) = x\n    go (AndF _ f@(Const False)) = f\n\n    go (OrF t@(Const True) _) = t\n    go (OrF (Const False) x) = x\n    go (OrF _ t@(Const True)) = t\n    go (OrF x (Const False)) = x\n\n    go (NotF (Const x)) = Const (not x)\n\n    go x = embed x -- Catch-all: no rules apply\n</code></pre>\n\n<p>All the recursive simplification is handled \"automatically\", and all the \"nothing exciting here\" cases are handled in one line.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7023126"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1545022231, "creation_date": 1545010854, "question_id": 53808058, "link": "https://stackoverflow.com/questions/53808058/haskell-pattern-matching-optimization", "title": "Haskell Pattern Matching Optimization", "body": "<p>I've started learning Haskell for a university course, and I've written a function with pattern matching (Called <code>Simplify</code>). But I am a bit unsure how I can optimize my code, since I feel like it's a bit too hard coded. </p>\n\n<p>Anyway, this is the code I've written:</p>\n\n<pre><code>data Proposition = Proposition Bool\n                | Const Bool\n                | Var String\n                | And Proposition Proposition\n                | Or Proposition Proposition\n                | Not Proposition deriving (Show, Eq)\n\n\nsimplify :: Proposition -&gt; Proposition\n\nsimplify (And _ (Const False)) = (Const False)\nsimplify (And (Const False) _) = (Const False)\nsimplify (And p (Const True)) = simplify p\nsimplify (And (Const True) p) = simplify p\nsimplify (Or _ (Const True)) = (Const True)\nsimplify (Or (Const True) _) = (Const True)\nsimplify (Or a b) = simplify (Or (simplify a) (simplify b))\nsimplify (Const b) = (Const b)\nsimplify (Var v) = (Var v)\nsimplify (Not (Const True)) = (Const False)\nsimplify (Not (Const False)) = (Const True)\nsimplify (Not p) = simplify (Not (simplify p))\n</code></pre>\n"}, {"tags": ["haskell", "error-handling", "ghc"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1545009584, "post_id": 53807621, "comment_id": 94464374, "body": "Can you say what it is you want to do at a higher level?  Do you 1. want a pure function, such as <code>func</code> that can return successfully or an error (doable with different types)?  or 2. want to catch an exception in a pure function (not possible)? or 3. Something else?  As it stands, your question exposes a few misunderstands but conceals your overall goal."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1545010323, "post_id": 53807621, "comment_id": 94464509, "body": "<code>error</code> has type <code>String -&gt; a</code>, and has nothing to do with the <code>Maybe</code> type constructor. This means instead of <code>func :: Int -&gt; Int</code>, you probably want <code>func :: Int -&gt; Maybe Int</code>, with <code>func i = if i == 1 then Just 1 else Nothing</code>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1545087295, "post_id": 53807621, "comment_id": 94497204, "body": "You cannot catch errors made with <code>error &quot;...&quot;</code> or <code>undefined</code>. This is by design \u2013 Haskell provides things like <code>Maybe</code> and <code>Either</code>, as well as <code>IOException</code>, to remove the need for that."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1545055447, "creation_date": 1545055447, "answer_id": 53816854, "question_id": 53807621, "link": "https://stackoverflow.com/questions/53807621/how-to-catch-an-error-in-haskell-and-ignore-it/53816854#53816854", "title": "How to catch an error in Haskell and ignore it?", "body": "<p>Try to avoid error where possible. Change <code>func</code> to</p>\n\n<pre><code>func :: Int -&gt; Maybe Int\nfunc 1 = Just 1\nfunc _ = Nothing\n</code></pre>\n\n<p>then you can write <code>check</code> as you have (or similarly, anyway):</p>\n\n<pre><code>check = case func 2 of\n          Just z -&gt; ...  -- z matches whatever is wrapped by Just\n          Nothing -&gt; ...\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 6788067, "user_type": "registered", "profile_image": "https://graph.facebook.com/1086238421472421/picture?type=large", "display_name": "Omar Sawara", "link": "https://stackoverflow.com/users/6788067/omar-sawara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1545055447, "creation_date": 1545005370, "question_id": 53807621, "link": "https://stackoverflow.com/questions/53807621/how-to-catch-an-error-in-haskell-and-ignore-it", "title": "How to catch an error in Haskell and ignore it?", "body": "<p>I have a function that takes an integer, checks if it's equal to <strong>1</strong> if yes returns <strong>1</strong> else <strong>error \"SomeError\"</strong>.</p>\n\n<pre><code>func i = if i == 1 then 1  else error \"SomeError\"\n</code></pre>\n\n<p>Now i have another function that calls this function and check the result of it</p>\n\n<pre><code>check = let z = (func 2) in \n  case (Just z) of\n    Nothing -&gt; do Something\n    _ -&gt; do Something else\n</code></pre>\n\n<p>I tried <code>z = (func 1)</code> and <code>z = (func 2)</code> for both z in <code>case (Just z) of</code>\nit goes to do Something else so what i understand here is error is not <strong>Nothing</strong></p>\n\n<p>So what is <strong>error \"SomeError\"</strong>? how can I know that <code>(Just z)</code> is an error using <code>case (Just z) of</code> </p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1544998399, "post_id": 53806605, "comment_id": 94462536, "body": "I could sort of see the downvotes coming, so I probably deserve that. Not the best place to ask for this sort of thing."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1545084480, "post_id": 53806605, "comment_id": 94496178, "body": "@bergey&#39;s solution looks helpful; someone else helped me find another solution that is somewhat similar using the local filesystem, which i&#39;ll be happy to share if this is reopened."}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 1, "last_activity_date": 1545000759, "creation_date": 1545000759, "answer_id": 53807169, "question_id": 53806605, "link": "https://stackoverflow.com/questions/53806605/whats-a-workflow-for-upstream-development-multi-project-development-with-stac/53807169#53807169", "title": "What&#39;s a workflow for upstream development (multi-project development) with stack?", "body": "<ol>\n<li>clone the upstream project</li>\n<li>in the downstream, add the local checkout from (1) to <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#packages-and-extra-deps\" rel=\"nofollow noreferrer\"><code>extra-deps</code></a> in <code>stack.yaml</code></li>\n<li>hack on both projects until I have something I want to share</li>\n<li>push upstream to github / wherever</li>\n<li>edit <code>stack.yaml</code> in the downstream to point to github by commit ID, rather than local path.  This lets other people build it with the same patched upstream that I'm using.</li>\n<li>open a PR with the upstream project to merge my changes</li>\n<li>After PR is accepted, point <code>stack.yaml</code> at the merged result or published version on Hackage</li>\n</ol>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "closed_date": 1545017204, "answer_count": 1, "score": -3, "last_activity_date": 1545084088, "creation_date": 1544995519, "last_edit_date": 1545084088, "question_id": 53806605, "link": "https://stackoverflow.com/questions/53806605/whats-a-workflow-for-upstream-development-multi-project-development-with-stac", "closed_reason": "Needs more focus", "title": "What&#39;s a workflow for upstream development (multi-project development) with stack?", "body": "<h1>High Level Overview</h1>\n\n<p>I'm looking for simple workflow to allow me to edit source code for library dependencies in stack projects, and then test them out on some other dependent project. More explicitly, the situation is where I'm working on one Haskell app/library (A) that depends on some other Haskell library (B), and I want to experiment with adding features/bug-fixes to (B) while testing out (A) on the newly modified (B).</p>\n\n<h1>Details</h1>\n\n<p>I have a <code>stack.yaml</code> file with contents:</p>\n\n<pre><code>resolver: lts-12.22\npackages:\n- .\nnix:\n  packages: [gmp, pkgconfig, SDL2, SDL2_image, SDL2_ttf]\n</code></pre>\n\n<p>My <code>hico.cabal</code> has more in it than is worth posting, but the relevant bit is basically this, I think:</p>\n\n<pre><code>library\n  hs-source-dirs:      src\n  exposed-modules:     Hico\n  other-modules:       Hico.Game\n                     , Hico.Config.Cli\n                     , Hico.Internal.Types\n                     , Hico.Internal.InputHandling\n                     , Hico.Types\n  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                     , sdl2\n                     , sdl2-image\n                     , sdl2-ttf\n  default-language:    Haskell2010\n</code></pre>\n\n<p>I would like to have a local copy of <code>sdl2</code> available in my filesystem, so that I can test out some changes on it in my <code>hico</code> project.</p>\n"}, {"tags": ["haskell", "types", "type-families", "type-kinds"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1545157367, "post_id": 53805615, "comment_id": 94526151, "body": "Valid types are finite. They may be self-referential though. In order to create an self-referential kind, you need a way to reference a kind, presumably by name. I suspect DataKinds would be helpful here."}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1545213703, "post_id": 53805615, "comment_id": 94545031, "body": "@n.m.: Yes this is now the accepted answer"}], "answers": [{"comments": [{"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 0, "creation_date": 1544990084, "post_id": 53805702, "comment_id": 94460394, "body": "Unfortunately <code>Fix</code> is not what I&#39;m looking for. I&#39;m attempting to make something more general than <code>recursion-schemes</code> (at least in some ways) and I really need a type to get something of its own kind (or a representative of it) rather than itself recursively applied."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 3, "creation_date": 1544991032, "post_id": 53805702, "comment_id": 94460648, "body": "@yairchu Are you sure that <code>Fix</code> + <code>DataKinds</code> is not what you want? In particular, try <code>:k &#39;Fix</code> in ghci and see <code>&#39;Fix :: forall (f :: * -&gt; *). f (Fix f) -&gt; Fix f</code> -- you get a new kind, not <code>*</code>."}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1544994715, "post_id": 53805702, "comment_id": 94461665, "body": "@DanielWagner: Like <code>recursion-schemes</code>, I want a way to construct ASTs, except I want my ASTs to be able to refer to each other - that is a term can contain a type (for a lambda parameter), a type can contain a row-type in it and vice-versa. I&#39;d like the ASTs to be defined with an external fix-point (so one can have &quot;pure&quot; expressions or ones annotated with types after type inference), but I also want these fix-points to be able to contain other types of fix-points (just like terms can contain terms of different types). I don&#39;t see how <code>Fix</code> helps me there"}], "tags": [], "owner": {"reputation": 767, "user_id": 814796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZQemO.jpg?s=128&g=1", "display_name": "madgen", "link": "https://stackoverflow.com/users/814796/madgen"}, "is_accepted": false, "score": 1, "last_activity_date": 1544988337, "creation_date": 1544988337, "answer_id": 53805702, "question_id": 53805615, "link": "https://stackoverflow.com/questions/53805615/expressing-infinite-kinds/53805702#53805702", "title": "Expressing infinite kinds", "body": "<p>I think you're looking for <code>Fix</code> which is defined as</p>\n\n<pre><code>data Fix f = Fix (f (Fix f))\n</code></pre>\n\n<p><code>Fix</code> gives you the fixpoint of the type <code>f</code>. I'm not sure what you're trying to do but such infinite types are generally used when you use recursion scehemes (patterns of recursion that you can use) see <code>recursion-schemes</code> package by Edward Kmett or with free monads which among other things allow you to construct ASTs in a monadic style.</p>\n"}, {"comments": [{"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 2, "creation_date": 1544997777, "post_id": 53806694, "comment_id": 94462390, "body": "Yeah this is probably exactly what I&#39;m looking for! For re-writing Lamdu&#39;s type inference and working on its language, I&#39;m in the progress of making an <a href=\"https://github.com/lamdu/syntax-tree\" rel=\"nofollow noreferrer\">AST library</a>, and I found out I need the same flexibility for the fix-points (currently called &quot;Knots&quot; in the library) as I want for the ASTs, as evident in the non-ideal interfaces in <code>AST.Class.ZipMatch</code>, for example. I&#39;ve started experiments based on type-families but if this approach works it indeed looks a lot cleaner! I&#39;ll update here :)"}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 2, "creation_date": 1545004119, "post_id": 53806694, "comment_id": 94463564, "body": "Looks like your use of GADTs replaces my use of type-families, and the <code>Label</code>s I want seem to be <code>data Label = Label (Label -&gt; Type)</code>. I&#39;ll give it a try and update."}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 0, "creation_date": 1545069245, "post_id": 53806694, "comment_id": 94489687, "body": "Updating that I used data kinds like you suggested, combined with a type-family rather than GADTs, and this now exists in <a href=\"https://github.com/lamdu/syntax-tree\" rel=\"nofollow noreferrer\">github.com/lamdu/syntax-tree</a> . In my formulation ASTs (<code>Expr</code>, <code>DefN</code>) are &quot;Knots&quot; just like <code>Annotated</code> and the same &quot;Children&quot; type-class applies for both. I&#39;m quite satisfied with this solution. For example it really simplified my <code>ZipMatch</code> class, and it should also enable the type-inference to share resolved unification terms (which I couldn&#39;t do when the <code>UTerm</code> knot couldn&#39;t have pure trees as children)."}, {"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 0, "creation_date": 1545069335, "post_id": 53806694, "comment_id": 94489721, "body": "Would you like me to edit your answer to add the gist of it on top (that the solution is data kinds combined with either GADTs or type families) and then accept it, or do you prefer to edit it yourself, or do you prefer that I add a new answer?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 1, "creation_date": 1545088772, "post_id": 53806694, "comment_id": 94497727, "body": "@yairchu in this case it seems like a new answer is appropriate, but do what you think is best.  I&#39;m glad it&#39;s working well for you."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 6, "last_activity_date": 1544998218, "last_edit_date": 1544998218, "creation_date": 1544996214, "answer_id": 53806694, "question_id": 53805615, "link": "https://stackoverflow.com/questions/53805615/expressing-infinite-kinds/53806694#53806694", "title": "Expressing infinite kinds", "body": "<p>Responding to:</p>\n\n<blockquote>\n  <p>Like recursion-schemes, I want a way to construct ASTs, except I want my ASTs to be able to refer to each other - that is a term can contain a type (for a lambda parameter), a type can contain a row-type in it and vice-versa. I'd like the ASTs to be defined with an external fix-point (so one can have \"pure\" expressions or ones annotated with types after type inference), but I also want these fix-points to be able to contain other types of fix-points (just like terms can contain terms of different types). I don't see how Fix helps me there</p>\n</blockquote>\n\n<p>I have a method, which maybe is near what you are asking for, that I have been <a href=\"https://github.com/luqui/manifesto\" rel=\"noreferrer\">experimenting with</a>.  It seems to be quite powerful, though the abstractions around this construction need some development.  The key is that there is a kind <code>Label</code> which indicates from where the recursion will continue.  </p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n\nimport Data.Kind (Type)\n\ndata Label = Label ((Label -&gt; Type) -&gt; Type)\ntype L = 'Label\n</code></pre>\n\n<p><code>L</code> is just a shortcut to construct labels.</p>\n\n<p>Open-fixed-point definitions are of kind <code>(Label -&gt; Type) -&gt; Type</code>, that is, they take a \"label interpretation (type) function\" and give back a type.  I called these \"shape functors\", and abstractly refer to them with the letter <code>h</code>.  The simplest shape functor is one that does not recurse:</p>\n\n<pre><code>newtype LiteralF a f = Literal a  -- does not depend on the interpretation f\ntype Literal a = L (LiteralF a)\n</code></pre>\n\n<p>Now we can make a little expression grammar as an example:</p>\n\n<pre><code>data Expr f\n    = Lit (f (Literal Integer))\n    | Let (f (L Defn)) (f (L Expr))\n    | Var (f (L String))\n    | Add (f (L Expr)) (f (L Expr))\n\ndata Defn f\n    = Defn (f (Literal String)) (f (L Expr))\n</code></pre>\n\n<p>Notice how we pass <em>labels</em> to <code>f</code>, which is in turn responsible for closing off the recursion.  If we just want a normal expression tree, we can use <code>Tree</code>:</p>\n\n<pre><code>data Tree :: Label -&gt; Type where\n    Tree :: h Tree -&gt; Tree (L h)\n</code></pre>\n\n<p>Then a <code>Tree (L Expr)</code> is isomorphic to the normal expression tree you would expect.   But this also allows us to, e.g., annotate the tree with a label-dependent annotation at each level of the tree:</p>\n\n<pre><code>data Annotated :: (Label -&gt; Type) -&gt; Label -&gt; Type where\n    Annotated :: ann (L h) -&gt; h (Annotated ann) -&gt; Annotated ann (L h)\n</code></pre>\n\n<p>In the repo <code>ann</code> is indexed by a shape functor rather than a label, but this seems cleaner to me now.  There are a lot of little decisions like this to be made, and I have yet to find the most convenient pattern.  The best abstractions to use around shape functors still needs exploration and development.</p>\n\n<p>There are many other possibilities, many of which I have not explored.  If you end up using it I would love to hear about your use case.</p>\n"}, {"tags": [], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "is_accepted": true, "score": 2, "last_activity_date": 1545155103, "last_edit_date": 1545155103, "creation_date": 1545119382, "answer_id": 53828463, "question_id": 53805615, "link": "https://stackoverflow.com/questions/53805615/expressing-infinite-kinds/53828463#53828463", "title": "Expressing infinite kinds", "body": "<p>With data-kinds, we can use a regular newtype:</p>\n\n<pre><code>import Data.Kind (Type)\n\nnewtype Inf = Inf (Inf -&gt; Type)\n</code></pre>\n\n<p>And promote it (with <code>'</code>) to create new kinds to represent loops:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n\ntype F x = x ('Inf x)\n</code></pre>\n\n<p>For a type to unpack its <code>'Inf</code> argument we need a type-family:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\ntype family RunInf (x :: Inf) :: Inf -&gt; Type\ntype instance RunInf ('Inf x) = x\n</code></pre>\n\n<p>Now we can express infinite kinds with a new kind for them, so no kind-safety is lost.</p>\n\n<ul>\n<li>Thanks to @luqui for pointing out the <code>DataKinds</code> part in his answer!</li>\n</ul>\n"}], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 3, "accepted_answer_id": 53828463, "answer_count": 3, "score": 9, "last_activity_date": 1545155103, "creation_date": 1544987741, "question_id": 53805615, "link": "https://stackoverflow.com/questions/53805615/expressing-infinite-kinds", "title": "Expressing infinite kinds", "body": "<p>When expressing infinite types in Haskell:</p>\n\n<pre><code>f x = x x -- This doesn't type check\n</code></pre>\n\n<p>One can use a <code>newtype</code> to do it:</p>\n\n<pre><code>newtype Inf = Inf { runInf :: Inf -&gt; * }\n\nf x = x (Inf x)\n</code></pre>\n\n<p>Is there a <code>newtype</code> equivalent for kinds that allows one to express infinite kinds?</p>\n\n<p>I already found that I can use type families to get something similar:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\ndata Inf (x :: * -&gt; *) = Inf\ntype family RunInf x :: * -&gt; *\ntype instance RunInf (Inf x) = x\n</code></pre>\n\n<p>But I'm not satisfied with this solution - unlike the types equivalent, <code>Inf</code> doesn't create a new kind (<code>Inf x</code> has the kind <code>*</code>), so there's less kind safety.</p>\n\n<p>Is there a more elegant solution to this problem?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "edited": false, "score": 0, "creation_date": 1545003910, "post_id": 53805452, "comment_id": 94463533, "body": "@AronLee: I would use as-patterns, but you could also use pattern-matching, with code similar to what you wrote in your question: <code>fun p0 p1 = \u2026 where { Vertex3 x0 y0 z0 = p0; Vertex3 x1 y1 z1 = p1; p = p0 + p1 }</code>. You just had the expression <code>pN</code> and the <code>Vertex3 \u2026</code> pattern swapped. This is an <i>irrefutable</i> pattern, and is safe if <code>Vertex3</code> is the only constructor, so the match can\u2019t fail."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1544986543, "creation_date": 1544986543, "answer_id": 53805452, "question_id": 53805418, "link": "https://stackoverflow.com/questions/53805418/make-better-haskell-function/53805452#53805452", "title": "Make better Haskell function", "body": "<p>Yes, you can use an <a href=\"https://www.haskell.org/tutorial/patterns.html\" rel=\"noreferrer\"><em>as-pattern</em> [AGItH'98]</a>:</p>\n\n<pre><code>fun::Vertex3 GLfloat -&gt; Vertex3 GLfloat -&gt; Vertex3 GLfloat\nfun <b>p0@</b>(Vertex3 x0 y0 z0) <b>p1@</b>(Vertex3 x1 y1 z1) = do sth here\n        where p = p0 + p1</code></pre>\n\n<p>Here we thus have a reference to both the argument <code>p0</code>, as well as elements in the data constructor (<code>x0</code>, <code>y0</code>, <code>z0</code>).</p>\n\n<p>These <em>as-patterns</em> can be used at different levels in the pattern.</p>\n"}], "owner": {"reputation": 483, "user_id": 8953741, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/118643528911159/picture?type=large", "display_name": "Aron Lee", "link": "https://stackoverflow.com/users/8953741/aron-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 53805452, "answer_count": 1, "score": 3, "last_activity_date": 1544986571, "creation_date": 1544986297, "last_edit_date": 1544986571, "question_id": 53805418, "link": "https://stackoverflow.com/questions/53805418/make-better-haskell-function", "title": "Make better Haskell function", "body": "<p>I have following Haskell function</p>\n\n<pre><code>fun::Vertex3 GLfloat -&gt; Vertex3 GLfloat -&gt;  Vertex3 GLfloat\nfun (Vertex3 x0 y0 z0) (Vertex3 x1 y1 z1) = do sth here\n        where\n            p0 = (Vertex3 x0 y0 z0)\n            p1 = (Vertex3 x1 y1 z1)\n            p = p0 + p1\n</code></pre>\n\n<p>I'm wondering whether there is a way to <strong>not repeat</strong>\n<code>(Vertex3 x0 y0 z0) (Vertex3 x1 y1 z1)</code> inside the code</p>\n\n<p>I'm looking for some thing like:</p>\n\n<pre><code>fun::Vertex3 GLfloat -&gt; Vertex3 GLfloat -&gt;  Vertex3 GLfloat\nfun p0 p1 = do sth here\n    where \n        p0 = (Vertex3 x0 y0 z0)\n        p1 = (Vertex3 x1 y1 z1)\n        p = p0 + p1\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 10798044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb3c99e9a747b70a74fe84c089c2685?s=128&d=identicon&r=PG&f=1", "display_name": "DeltaX Gamer PT", "link": "https://stackoverflow.com/users/10798044/deltax-gamer-pt"}, "edited": false, "score": 0, "creation_date": 1544979128, "post_id": 53804353, "comment_id": 94457164, "body": "But now I tried doing it with show, and this error popped up:     \u2022 Could not deduce (Show a) arising from a use of \u2018show\u2019       from the context: Num a         bound by the instance declaration at Ficha8.hs:51:10-30       Possible fix:         add (Show a) to the context of the instance declaration     \u2022 In the expression: show a       In an equation for \u2018show\u2019: show (Const a) = show a       In the instance declaration for \u2018Show (Exp a)\u2019"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 85, "user_id": 10798044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb3c99e9a747b70a74fe84c089c2685?s=128&d=identicon&r=PG&f=1", "display_name": "DeltaX Gamer PT", "link": "https://stackoverflow.com/users/10798044/deltax-gamer-pt"}, "edited": false, "score": 3, "creation_date": 1544980332, "post_id": 53804353, "comment_id": 94457493, "body": "@DeltaXGamerPT: you can add extra type constraints like <code>instance (Show a, Num a) =&gt; Eq (Exp a) where ...</code>. But a <code>show</code> in an <code>Eq</code> instance is rather weird."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 85, "user_id": 10798044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb3c99e9a747b70a74fe84c089c2685?s=128&d=identicon&r=PG&f=1", "display_name": "DeltaX Gamer PT", "link": "https://stackoverflow.com/users/10798044/deltax-gamer-pt"}, "edited": false, "score": 1, "creation_date": 1544980365, "post_id": 53804353, "comment_id": 94457503, "body": "For the <code>Show (Exp a) where</code> you probably also should add a type constraint, so <code>instance Show a =&gt; Show (Exp a) where ...</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1544978817, "creation_date": 1544978817, "answer_id": 53804353, "question_id": 53804334, "link": "https://stackoverflow.com/questions/53804334/defining-an-instance-to-a-restricted-a-type-in-haskell/53804353#53804353", "title": "Defining an instance to a restricted a type in Haskell", "body": "<p>You add a type constraint to the <code>instance</code> clause:</p>\n\n<pre><code>instance <b>Num a =&gt;</b> Eq (Exp a) where\n         a == b | ... = True\n                | otherwise = False</code></pre>\n\n<p>So now you can assume (in the scope of the <code>instance</code>) that <code>a</code> is an instance of the <code>Num</code> typeclass.</p>\n"}], "owner": {"reputation": 85, "user_id": 10798044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb3c99e9a747b70a74fe84c089c2685?s=128&d=identicon&r=PG&f=1", "display_name": "DeltaX Gamer PT", "link": "https://stackoverflow.com/users/10798044/deltax-gamer-pt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 53804353, "answer_count": 1, "score": 3, "last_activity_date": 1544978817, "creation_date": 1544978713, "last_edit_date": 1544978764, "question_id": 53804334, "link": "https://stackoverflow.com/questions/53804334/defining-an-instance-to-a-restricted-a-type-in-haskell", "title": "Defining an instance to a restricted a type in Haskell", "body": "<p>I am working with the following Data Type:</p>\n\n<pre><code>data Exp a =\n|Const a\n|Simetrico (Exp a)\n|Mais (Exp a) (Exp a)\n|Menos (Exp a) (Exp a)\n|Mult (Exp a) (Exp a)\n</code></pre>\n\n<p>but <code>a</code> is supposed to be a Numeric type.\nI would define <code>Eq</code> like this:</p>\n\n<pre><code>instance Eq (Exp a) where\n         a == b | ... = True\n                | otherwise = False\n</code></pre>\n\n<p>but I am saying nowhere that my <code>a</code> is a numeric type, so ghci complains, how do I solve this ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1544976871, "post_id": 53804027, "comment_id": 94456514, "body": "What is your question? It seems a lot like &quot;do my homework for me&quot; at the moment."}, {"owner": {"reputation": 181, "user_id": 10797686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f4fcc30a85928245f15302b39dc31b9?s=128&d=identicon&r=PG&f=1", "display_name": "Kai", "link": "https://stackoverflow.com/users/10797686/kai"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1544977182, "post_id": 53804027, "comment_id": 94456602, "body": "I dont know how to define the mapProp function.. I&#39;ve tried using map and helper function but just dont work so I&#39;m asking for any tipps ??"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1544978087, "post_id": 53804027, "comment_id": 94456885, "body": "Use pattern matching."}], "answers": [{"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 3, "last_activity_date": 1544978071, "creation_date": 1544978071, "answer_id": 53804234, "question_id": 53804027, "link": "https://stackoverflow.com/questions/53804027/haskell-mapprop-function/53804234#53804234", "title": "Haskell mapProp function", "body": "<p><code>map</code> is not your friend here.</p>\n\n<p>You want to define <code>mapProp</code> with <em>pattern matching</em>. Pattern matching in its simplest and easiest form means writing a separate formula for each alternative of your data type. The syntax looks like this:</p>\n\n<pre><code>mapProp f (Const a) = ... \nmapProp f (Var a)   = ... \nmapProp f (And a b) = ... \n... -- continue for the rest of your alternatives\n</code></pre>\n"}], "owner": {"reputation": 181, "user_id": 10797686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f4fcc30a85928245f15302b39dc31b9?s=128&d=identicon&r=PG&f=1", "display_name": "Kai", "link": "https://stackoverflow.com/users/10797686/kai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 53804234, "answer_count": 1, "score": -3, "last_activity_date": 1544978071, "creation_date": 1544976746, "last_edit_date": 1544976828, "question_id": 53804027, "link": "https://stackoverflow.com/questions/53804027/haskell-mapprop-function", "title": "Haskell mapProp function", "body": "<p>I'm new in learning Haskell and have same problems with the definning of functions. I have to write a definition for the function mapProp \nwhich has the ability to map an f to every proposition in a function ( have to look like this)</p>\n\n<pre><code>prop = (True \u2227 False)\nmapProp f prop = f(f(True) \u2227 f(False))\n</code></pre>\n\n<p>In other words, whenever mapProposition finds a constructor with a Propositionfield, for example And a b, it first maps f over a and b, then constructs the\nAnd connective from the results and applies f. Whenever it finds a constructor\nwith no Proposition field, it applies f.</p>\n\n<p>and this is what i have till now :</p>\n\n<pre><code>module PropLog where\n\nimport Data.List\n\ndata Proposition = Const Bool\n                  | Var String\n                  | And Proposition Proposition\n                  | Or Proposition Proposition\n                  | Not Proposition\n\n-- CONTRACT\none :: Proposition\n\n-- DEFINITION\none = Or (Const True)(Const False)\n\n-- CONTRACT\ntwo :: Proposition\n\n-- DEFINITION\ntwo = And(Var \"test\")(Not(Var \"test\"))\n\n-- CONTRACT\nthree :: Proposition\n\n-- DEFINITION\nthree = Or (And(Not(Var\"a\"))(Var \"b\"))(And(Var \"a\")(Not(Var \"b\")))\n\n\n-- CONTRACT\nmapProp :: (Proposition -&gt; Proposition) -&gt; Proposition -&gt; Proposition\n\n-- DEFINITION \nmapProp f = map f Proposition\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "edited": false, "score": 0, "creation_date": 1544974804, "post_id": 53803469, "comment_id": 94455957, "body": "I don\u2019t completely follow, you want to use Text, because it has <code>find</code>? Because <code>find</code> is also in Data.List"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7084228"}, "reply_to_user": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "edited": false, "score": 0, "creation_date": 1544974957, "post_id": 53803469, "comment_id": 94456001, "body": "I didn&#39;t know that, how can I then use find to do that?"}, {"owner": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "edited": false, "score": 0, "creation_date": 1544975400, "post_id": 53803469, "comment_id": 94456133, "body": "you just need to drop the <code>contents !!</code> part"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7084228"}, "reply_to_user": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "edited": false, "score": 0, "creation_date": 1544975589, "post_id": 53803469, "comment_id": 94456194, "body": "Why? Funciton f is what I want to acheive, not finding an index but getting the whole line."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1544975857, "post_id": 53803469, "comment_id": 94456251, "body": "You achieve what you want in an awkward and roundabout way. <code>findIndex</code> returns an index, then you go and traverse the list again to find the element that corresponds to the index. <code>find (name `isInfixOf`) contents</code> returns what you want directly, no need for <code>!!</code>. By the way what happens if the line is not found? Are you OK with your program crashing?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7084228"}, "edited": false, "score": 0, "creation_date": 1544976008, "post_id": 53803469, "comment_id": 94456284, "body": "Yes I am fine with the program crushing. I know that it is roundabout which is why I asked here, thanks for showing me how to use find!"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1544976282, "post_id": 53803469, "comment_id": 94456359, "body": "By the way again, are you sure <code>contents &lt;- lines all</code> works?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7084228"}, "edited": false, "score": 0, "creation_date": 1544976308, "post_id": 53803469, "comment_id": 94456366, "body": "Yes it works, it is in a do block and I tested it."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1544987570, "post_id": 53803469, "comment_id": 94459675, "body": "Yeah If it&#39;s not in the same <code>do</code> block with the line above it, then it could work. It&#39;s a bit confusing the way you express it."}], "answers": [{"tags": [], "owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "is_accepted": true, "score": 0, "last_activity_date": 1545498624, "creation_date": 1545498624, "answer_id": 53897719, "question_id": 53803469, "link": "https://stackoverflow.com/questions/53803469/haskell-finding-a-string-in-a-list-by-a-prefix/53897719#53897719", "title": "Haskell - finding a string in a list by a prefix", "body": "<p>Why don't you filter lines on the prefix?</p>\n\n<pre><code>Prelude&gt; contents = lines \"ccc 1 1\\nbbb 2 2\\naaa 3 3\"\nPrelude&gt; import Data.List\nPrelude Data.List&gt; f prefix = head $ filter (isInfixOf prefix) contents\nPrelude Data.List&gt; f \"aaa\"\n\"aaa 3 3\"\nPrelude Data.List&gt; f \"abc\"\n\"*** Exception: Prelude.head: empty list\n</code></pre>\n\n<p>You can remove the <code>head</code> if you want all the matching lines (possibly an empty list).</p>\n\n<p>If you want to use f many times, a map will have a better peformance, but only if you look for a line <em>given the first word of the line</em> (and not any prefix):</p>\n\n<pre><code>Prelude&gt; contents = lines \"ccc 1 1\\nbbb 2 2\\naaa 3 3\"\nPrelude&gt; import Data.Map (fromList, (!))\nPrelude Data.Map&gt; m = fromList $ zip =&lt;&lt; (map $ head.words) $ contents\nPrelude Data.Map&gt; m!\"aaa\"\n\"aaa 3 3\"\nPrelude Data.Map&gt; m!\"abc\"\n\"*** Exception: Map.!: given key is not an element in the map\nCallStack (from HasCallStack):\n  error, called at libraries/containers/Data/Map/Base.hs:489:16 in containers-0.5.7.1:Data.Map.Base\n</code></pre>\n\n<p>Operator <code>(!)</code> will find the value in <em>O(log n)</em> vs <em>O(n)</em> in the list version.</p>\n\n<p>Some explanation:</p>\n\n<ul>\n<li><code>fromList</code> creates a map given a list of <code>(key, value)</code></li>\n<li><code>map $ head.words</code> takes the first word of every element in the list</li>\n<li><code>(zip =&lt;&lt; g) contents</code> is equivalent to <code>zip (g contents) contents</code> (here: zip the first words with the lines)</li>\n</ul>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7084228"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 536, "favorite_count": 0, "accepted_answer_id": 53897719, "answer_count": 1, "score": 0, "last_activity_date": 1545498624, "creation_date": 1544972943, "last_edit_date": 1544975897, "question_id": 53803469, "link": "https://stackoverflow.com/questions/53803469/haskell-finding-a-string-in-a-list-by-a-prefix", "title": "Haskell - finding a string in a list by a prefix", "body": "<p>I have a text file that looks like this:</p>\n\n<pre><code>ccc 1 1\nbbb 2 2\naaa 3 3\n</code></pre>\n\n<p>I want to create a function that get an entire line by the first word like that:</p>\n\n<pre><code>f bbb = \"bbb 2 2\"\nf aaa = \"aaa 3 3\"\n</code></pre>\n\n<p>I have written the following code:</p>\n\n<pre><code>    contents !! (fromJust (findIndex (name `isInfixOf`) contents))\n</code></pre>\n\n<p>Where <code>contents</code> is a list of strings containing the above text.\nAfter reading the file and using these functions:</p>\n\n<pre><code>all &lt;- readFile file\ncontents &lt;- lines all\n</code></pre>\n\n<p><strong>It works</strong> but it doesn't look so good.</p>\n\n<p>Is there a more direct way to do function <code>f</code> (from above)?</p>\n\n<p>I thought maybe <code>Data.List.find</code> or <code>Data.Text.find</code> could help but they don't seem to match.</p>\n"}, {"tags": ["haskell", "optimization"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1544963389, "post_id": 53802071, "comment_id": 94452969, "body": "If you need a lot of random access, like <code>list !! n</code>, or appending <code>list ++ something</code>, the basic list is not an appropriate data structure. It&#39;s hard to suggest what to use, without understanding the general picture. Perhaps an array suffices, or <code>Seq</code> / <code>Vector</code> are needed. Maybe you can do without random access, and then lists are fine."}, {"owner": {"reputation": 2299, "user_id": 1596308, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/JxwHy.png?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/1596308/adam"}, "edited": false, "score": 0, "creation_date": 1544963571, "post_id": 53802071, "comment_id": 94453005, "body": "Hmm ok, <a href=\"https://adventofcode.com/2018/day/14\" rel=\"nofollow noreferrer\">adventofcode.com/2018/day/14</a> there is the puzzle if interested... But that might be helpful, I will investigate the <code>!!</code>, maybe I can remove it somehow"}, {"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 0, "creation_date": 1544967917, "post_id": 53802071, "comment_id": 94454121, "body": "After I finished this problem I realised that all the work is done at the end of the sequence, and so you could probably get away with using just a list if you keep it in reverse order.  (And keep track of the length.)  But it would be easy to get wrong and using <code>Seq</code> will be a lot simpler."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "reply_to_user": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 0, "creation_date": 1544968535, "post_id": 53802071, "comment_id": 94454273, "body": "Just to expand on @DavidFletcher&#39;s comment, <code>Seq</code> refers to <a href=\"http://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/containers-0.6.0.1/docs/&hellip;</a>"}, {"owner": {"reputation": 2299, "user_id": 1596308, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/JxwHy.png?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/1596308/adam"}, "edited": false, "score": 0, "creation_date": 1544981085, "post_id": 53802071, "comment_id": 94457719, "body": "It worked with Seq! 1h -&gt; 2 sec. Thanks, I do however get : &quot;getMBlocks: VirtualAlloc MEM_COMMIT failed: The paging file is too small for this operation to complete.&quot;  on my recursion endCondition: <code>Seq.take 6 (Seq.reverse seq) == part2Input = Seq.length seq - 5</code>. I&#39;ll self answer, but if you have pointers on that last hurdle I&#39;ll take em! :)"}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1544986007, "post_id": 53805225, "comment_id": 94459172, "body": "You could write <code>(Seq.&gt;&lt;) seq (Seq.fromList (digits newVal))</code> as <code>seq Seq.&gt;&lt; Seq.fromList (digits newVal)</code>."}], "tags": [], "owner": {"reputation": 2299, "user_id": 1596308, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/JxwHy.png?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/1596308/adam"}, "is_accepted": true, "score": 1, "last_activity_date": 1544984796, "creation_date": 1544984796, "answer_id": 53805225, "question_id": 53802071, "link": "https://stackoverflow.com/questions/53802071/haskell-recursion-slow-whats-the-pitfall/53805225#53805225", "title": "Haskell recursion slow, what&#39;s the pitfall?", "body": "<p>I followed the advice posted in the comments; Do not use a the list data structure when you make a lot of random accesses. So I replaced the list with with Sequence <a href=\"http://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Sequence.html</a></p>\n\n<pre><code>import qualified Data.Sequence as Seq\n\ndata Recipes = Recipes Int Int Int (Seq.Seq Int) deriving(Show) \n\naddRecipes :: Recipes -&gt; Recipes\naddRecipes (Recipes t e1 e2 seq) = \nlet (e1c, e2c) = (Seq.index seq e1, Seq.index seq e2)\n    newVal = e1c + e2c\n    newSeq = (Seq.&gt;&lt;) seq (Seq.fromList (digits newVal))\n    e1n = calcNewPos e1 e1c newSeq\n    e2n = calcNewPos e2 e2c newSeq\nin Recipes t e1n e2n newSeq\n\ncalcNewPos :: Int -&gt; Int -&gt; (Seq.Seq Int) -&gt; Int    \ncalcNewPos i i2 seq = (i + i2 + 1) `mod` (Seq.length seq)\n</code></pre>\n\n<p>It worked and the run time is now reasonable (from 1 hour to seconds). Thanks commenters!</p>\n"}], "owner": {"reputation": 2299, "user_id": 1596308, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/JxwHy.png?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/1596308/adam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 53805225, "answer_count": 1, "score": 1, "last_activity_date": 1544984796, "creation_date": 1544962979, "last_edit_date": 1544963451, "question_id": 53802071, "link": "https://stackoverflow.com/questions/53802071/haskell-recursion-slow-whats-the-pitfall", "title": "Haskell recursion slow, what&#39;s the pitfall?", "body": "<p>I'm very much a beginner in Haskell</p>\n\n<pre><code>data Recipes = Recipes Int Int Int [Int] deriving(Show) \n\naddRecipes :: Recipes -&gt; Recipes\naddRecipes (Recipes t e1 e2 list) = \n    let (e1c, e2c) = (list !! e1, list !! e2)\n        newVal = e1c + e2c\n        newList = list ++ (digits $ newVal)\n        e1n = calcNewPos e1 e1c newList\n        e2n = calcNewPos e2 e2c newList\n    in Recipes t e1n e2n newList\n\ncalcNewPos :: Int -&gt; Int -&gt; [Int] -&gt; Int    \ncalcNewPos i i2 list = (i + i2 + 1) `mod` (length list)\n\n-- Borrowed:\n-- https://stackoverflow.com/questions/3963269/split-a-number-into-its-digits-with-haskell\ndigits :: Int -&gt; [Int]\ndigits = map (read . (:[])) . show\n</code></pre>\n\n<p>The above piece of code is part of a recursion which I omitted. The <code>addRecipes</code> is called again and again in a recursive call. This is a solution to an advent of code problem (AoC 2018 day 14). The code produces the correct result but is cripplingly slow.</p>\n\n<p>I'm just trying to learn where the problem lies, what is horribly inefficient in the code above?</p>\n\n<p>I've tried optimizing away the <code>++</code>-operator and replace it with a <code>:</code> and combining things with the digits call. I know the <code>++</code> is slower than the <code>:</code> but is that really it? (Remember, i'm learning Haskell so I want to fix this code if possible and know why I can't write it like this)</p>\n\n<p>Edit: The list in Recipes grows and becomes large</p>\n"}, {"tags": ["haskell", "type-level-computation"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544962898, "post_id": 53801780, "comment_id": 94452839, "body": "It looks as if your <code>Proxy</code> is not poly-kinded. Are you using the one from <code>Data.Proxy</code>? That one should work, I think."}, {"owner": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544963907, "post_id": 53801780, "comment_id": 94453099, "body": "Yes i\u2019m using the one from Data.Proxy"}], "answers": [{"comments": [{"owner": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "edited": false, "score": 0, "creation_date": 1544964020, "post_id": 53801860, "comment_id": 94453133, "body": "I don\u2019t understand your answer. I surely didn\u2019t define KnownSymbol myself. And the signature of your symbolVal is not the same as that from GHC.TypeLits"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "edited": false, "score": 0, "creation_date": 1544964369, "post_id": 53801860, "comment_id": 94453230, "body": "I didn&#39;t know that. You didn&#39;t provide a <a href=\"https://stackoverflow.com/help/mcve\">minimal, complete, and verifiable example</a> so I was kind of winging it from what I had."}, {"owner": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "edited": false, "score": 0, "creation_date": 1544973343, "post_id": 53801860, "comment_id": 94455560, "body": "I\u2019m sorry for that, but KnownSymbol is something really tied to GHC and type-level computation, it was clear I was not talking about a generic class called \u201cKnownSymbol\u201d, I think. It\u2019s as if I had a problem with printf in a C program."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "edited": false, "score": 0, "creation_date": 1544998731, "post_id": 53801860, "comment_id": 94462610, "body": "It&#39;s fine, doesn&#39;t matter. <code>KnownSymbol</code> was, well, unknown to me :) complete examples are just pretty useful though, note the how first question also asked whether you used your own proxy.  You could have some extension missing, etc"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "edited": false, "score": 0, "creation_date": 1544998993, "post_id": 53801860, "comment_id": 94462657, "body": "Regarding the solution by the way, I like chi&#39;s more with the <code>forall</code>. The way I used it here comes pretty handy when working with GADTs though (which is why I&#39;m used to using it)."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 1, "last_activity_date": 1544983225, "last_edit_date": 1544983225, "creation_date": 1544961245, "answer_id": 53801860, "question_id": 53801780, "link": "https://stackoverflow.com/questions/53801780/wrong-kind-in-symbolval-to-get-a-type-level-string-at-runtime/53801860#53801860", "title": "Wrong kind in `symbolVal` to get a type-level string at runtime", "body": "<p>The solution by chi above is the proper way to do it. In any case, this arguably less elegant alternative without the <code>forall</code> should work too. </p>\n\n<pre><code>func :: KnownSymbol s =&gt; MyType s t -&gt; String\nfunc (_ :: MyType s t)  = symbolVal (Proxy :: Proxy s)\n</code></pre>\n\n<p>I was forgetting it and worked around it like that. I think it's equivalent. </p>\n\n<p><em>never mind the answer below, it's way off...</em> </p>\n\n<hr>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE EmptyDataDecls #-}\n\nimport Data.Proxy\ndata Symbol \ndata MyType (s :: Symbol) t = MyType t\n\nclass KnownSymbol (s :: Symbol) where\n\nsymbolVal :: Proxy s -&gt; String\nsymbolVal = undefined\n\nfunc :: KnownSymbol s =&gt; MyType s t -&gt; String\nfunc _ = symbolVal (Proxy :: Proxy s)\n</code></pre>\n\n<p>This type checks here. Perhaps it's your <code>class</code> definition not specifying kind?</p>\n"}, {"comments": [{"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544966751, "post_id": 53802331, "comment_id": 94453837, "body": "Ah the <code>forall</code>! I had given <code>ScopedTypeVariables</code> a go and it failed, so I worked around it like this, which seems to work: <code>func (_ :: MyType s t)  = symbolVal (Proxy :: Proxy s)</code>. Are the semantics equivalent?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544969027, "post_id": 53802331, "comment_id": 94454394, "body": "@JorgeAdriano I think so."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1544964921, "creation_date": 1544964921, "answer_id": 53802331, "question_id": 53801780, "link": "https://stackoverflow.com/questions/53801780/wrong-kind-in-symbolval-to-get-a-type-level-string-at-runtime/53802331#53802331", "title": "Wrong kind in `symbolVal` to get a type-level string at runtime", "body": "<p>You need to turn on <code>ScopedTypeVariables</code> and use an explicit <code>forall</code>, otherwise you are not referring to the same <code>s</code>:</p>\n\n<pre><code>func :: forall s t . KnownSymbol s =&gt; MyType s t -&gt; String\nfunc _ = symbolVal (Proxy :: Proxy s)\n</code></pre>\n"}], "owner": {"reputation": 2424, "user_id": 3206471, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/fdc1f4bd9f3118fff33a160e9efdb61e?s=128&d=identicon&r=PG", "display_name": "gigabytes", "link": "https://stackoverflow.com/users/3206471/gigabytes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 53802331, "answer_count": 2, "score": 0, "last_activity_date": 1544983225, "creation_date": 1544960603, "question_id": 53801780, "link": "https://stackoverflow.com/questions/53801780/wrong-kind-in-symbolval-to-get-a-type-level-string-at-runtime", "title": "Wrong kind in `symbolVal` to get a type-level string at runtime", "body": "<p>I'm trying to understand how to work with type-level strings in Haskell. I have a data type declared as follows:</p>\n\n<pre><code>data MyType (s :: Symbol) t = MyType t\n</code></pre>\n\n<p>Think of it as a value of type <code>t</code> tagged in some way.</p>\n\n<p>Now, when trying to use <code>symbolVal</code>, I get an error that I don't understand. Consider this code:</p>\n\n<pre><code>func :: KnownSymbol s =&gt; MyType s t -&gt; String\nfunc _ = symbolVal (Proxy :: Proxy s)\n</code></pre>\n\n<p>The code triggers the following compile error:</p>\n\n<pre><code>file.hs:63:21: error:\n    \u2022 Couldn't match kind \u2018*\u2019 with \u2018Symbol\u2019\n      When matching types\n        proxy0 :: Symbol -&gt; *\n        Proxy :: * -&gt; *\n      Expected type: proxy0 n0\n        Actual type: Proxy s0\n    \u2022 In the first argument of \u2018symbolVal\u2019, namely \u2018(Proxy :: Proxy s)\u2019\n      In the expression: symbolVal (Proxy :: Proxy s)\n      In an equation for \u2018func\u2019: func _ = symbolVal (Proxy :: Proxy s)\n   |\n63 | func _ = symbolVal (Proxy :: Proxy s)\n   |\n</code></pre>\n\n<p>I have no idea of what I'm doing wrong here. If I write <code>Proxy \"hello\"</code> instead of <code>Proxy s</code> the code compiles and the function actually returns \"hello\", so at least it seems that I'm getting <em>something</em> right.</p>\n\n<p>So how do I get back a runtime representation of the type-level Symbol?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1544953812, "post_id": 53801073, "comment_id": 94450844, "body": "You need to install the corresponding package, for example with <code>cabal install raw-strings-qq</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544953835, "post_id": 53801073, "comment_id": 94450851, "body": "This package <a href=\"http://hackage.haskell.org/package/raw-strings-qq-1.1/docs/Text-RawString-QQ.html\" rel=\"nofollow noreferrer\">contains the <code>Data.RawString.QQ</code></a> module."}, {"owner": {"reputation": 3533, "user_id": 630261, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/184bbb7a73f54f6494871693f2d388ce?s=128&d=identicon&r=PG", "display_name": "Assen Kolov", "link": "https://stackoverflow.com/users/630261/assen-kolov"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544954785, "post_id": 53801073, "comment_id": 94451050, "body": "Thank you, now I notice <code>raw-strings-qq-1.1</code> in top left corner of <a href=\"http://hackage.haskell.org/package/raw-strings-qq-1.1/docs/Text-RawString-QQ.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/raw-strings-qq-1.1/docs/&hellip;</a>."}], "owner": {"reputation": 3533, "user_id": 630261, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/184bbb7a73f54f6494871693f2d388ce?s=128&d=identicon&r=PG", "display_name": "Assen Kolov", "link": "https://stackoverflow.com/users/630261/assen-kolov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 148, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1544953747, "creation_date": 1544953747, "question_id": 53801073, "link": "https://stackoverflow.com/questions/53801073/why-is-import-text-rawstring-qq-failing", "title": "Why is import Text.RawString.QQ failing?", "body": "<p>Following both Haskell documentation and SO answers, I try to </p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\nimport Data.RawString.QQ \n</code></pre>\n\n<p>I can't get further than <code>Could not find module \u2018Text.RawString.QQ\u2019</code> Do I need a dependency - how to I look up which one?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1545781821, "post_id": 53800697, "comment_id": 94694226, "body": "What version are you on?"}, {"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "reply_to_user": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "edited": false, "score": 0, "creation_date": 1545788405, "post_id": 53800697, "comment_id": 94694922, "body": "@MarkNeu The old-time version is 1.1.0.3 and GHC version is 8.4.2 on window 7"}, {"owner": {"reputation": 515, "user_id": 10595994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0442471ab0bd587ffd6313daa5d9b690?s=128&d=identicon&r=PG&f=1", "display_name": "BlackLotus", "link": "https://stackoverflow.com/users/10595994/blacklotus"}, "edited": false, "score": 0, "creation_date": 1545906645, "post_id": 53800697, "comment_id": 94725675, "body": "Can you show us your Cabal config?"}, {"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "reply_to_user": {"reputation": 515, "user_id": 10595994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0442471ab0bd587ffd6313daa5d9b690?s=128&d=identicon&r=PG&f=1", "display_name": "BlackLotus", "link": "https://stackoverflow.com/users/10595994/blacklotus"}, "edited": false, "score": 0, "creation_date": 1546069360, "post_id": 53800697, "comment_id": 94772965, "body": "@Glazbee Sure, the config file of Cabal has been posted, please see the &quot;EDIT&quot; part."}, {"owner": {"reputation": 32100, "user_id": 1033581, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/e8891617e36b8d1254eb3ce1a5662da4?s=128&d=identicon&r=PG", "display_name": "C\u0153ur", "link": "https://stackoverflow.com/users/1033581/c%c5%93ur"}, "edited": false, "score": 0, "creation_date": 1546403802, "post_id": 53800697, "comment_id": 94839329, "body": "typo: <code>intall</code> -&gt; <code>install</code>"}, {"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 0, "creation_date": 1546421462, "post_id": 53800697, "comment_id": 94844578, "body": "Don&#39;t have a windows here, but looks like you&#39;re trying to execute a bash script (<code>.&#47;configure</code>) with something that isn&#39;t bash. Try running the build manually via autoconf etc and see if you can control how <code>.&#47;configure</code> is executed."}, {"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "reply_to_user": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 0, "creation_date": 1546588961, "post_id": 53800697, "comment_id": 94905498, "body": "@Reactormonk I tried to build it manually (don&#39;t use cabal), but some dependencies are broken."}, {"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 0, "creation_date": 1546598556, "post_id": 53800697, "comment_id": 94909907, "body": "It&#39;s a start. Which dependencies?"}, {"owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "reply_to_user": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 0, "creation_date": 1546671472, "post_id": 53800697, "comment_id": 94934285, "body": "@Reactormonk It show that <code>base &gt;=4.7 &amp;&amp; &lt;4.9, old-locale ==1.0.*</code> dependencies is missing. please refers the &quot;EDIT2&quot; in the question."}], "owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 184, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1546671303, "creation_date": 1544949918, "last_edit_date": 1546671303, "question_id": 53800697, "link": "https://stackoverflow.com/questions/53800697/how-to-install-old-time-1-1-0-3-in-windows-7", "title": "How to install old-time-1.1.0.3 in Windows 7", "body": "<p>I try to install <a href=\"http://hackage.haskell.org/package/old-time-1.1.0.3\" rel=\"nofollow noreferrer\">old-time-1.1.0.3</a> in windows 7 (GHC version: 8.4.2) using <code>cabal intall old-time</code> but not success, here is the error message:</p>\n\n<pre><code>Configuring old-time-1.1.0.3...\n..\\old-time-1.1.0.3\\configure: line 1038: $'with_compiler\\r=ghc': command not found\nconfigure: WARNING: unrecognized options: --with-compiler\nchecking for gcc... ../mingw/bin\\gcc.exe\nchecking whether the C compiler works... yes\nchecking for C compiler default output file name... a.exe\nchecking for suffix of executables... .exe\nchecking whether we are cross compiling... no\nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether ../mingw/bin\\gcc.exe accepts -g... yes\nchecking for ../mingw/bin\\gcc.exe option to accept ISO C89... none needed\nchecking how to run the C preprocessor... ../mingw/bin\\gcc.exe -E\nchecking for grep that handles long lines and -e... /cygdrive/c/app/gnu/win32/bin/grep\nchecking for egrep... /cygdrive/c/app/gnu/win32/bin/grep -E\nchecking for ANSI C header files... yes\nchecking for sys/types.h... ..\\old-time-1.1.0.3\\configure: line 1606: ${ac_cv_header_sys_types_h\n+:}: bad substitution\n..\\old-time-1.1.0.3\\configure: line 23: $'IFS\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `IFS\n': not a valid identifier\n..\\old-time-1.1.0.3\\configure: line 23: $'PATH\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `PATH\n': not a valid identifier\n..\\old-time-1.1.0.3\\configure: line 23: $'ac_includes_default\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `ac_includes_default\n': not a valid identifier\n..\\old-time-1.1.0.3\\configure: line 23: $'ac_ls_di\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `ac_ls_di\n': not a valid identifier\n..\\old-time-1.1.0.3\\configure: line 23: $'ac_precious_vars\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `ac_precious_vars\n': not a valid identifier\n..\\old-time-1.1.0.3\\configure: line 23: $'ac_pwd_ls_di\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `ac_pwd_ls_di\n': not a valid identifier\n..\\old-time-1.1.0.3\\configure: line 23: $'ac_subst_vars\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `ac_subst_vars\n': not a valid identifier\n..\\old-time-1.1.0.3\\configure: line 23: $'ac_user_opts\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `ac_user_opts\n': not a valid identifier\n..\\old-time-1.1.0.3\\configure: line 23: $'as_bourne_compatible\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `as_bourne_compatible\n': not a valid identifier\n..\\old-time-1.1.0.3\\configure: line 23: $'as_nl\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `as_nl\n': not a valid identifier\n..\\old-time-1.1.0.3\\configure: line 23: $'as_required\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `as_required\n': not a valid identifier\n..\\old-time-1.1.0.3\\configure: line 23: $'as_save_IFS\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `as_save_IFS\n': not a valid identifier\n..\\old-time-1.1.0.3\\configure: line 23: $'as_suggested\\r=': command not found\n..\\old-time-1.1.0.3\\configure: line 23: unset: `as_suggested\n': not a valid identifier\ncabal: Leaving directory '..\\old-time-1.1.0.3'\n</code></pre>\n\n<p>I found a similar post: <a href=\"https://stackoverflow.com/questions/39434709/when-i-try-to-install-hlint-i-get-errors-surrounding-old-time-1-1-0-3\">When I try to install hlint I get errors surrounding old-time-1.1.0.3</a>, but the solution of above post does not work for me.</p>\n\n<p>EDIT:\nHere is my cabal config file, the remarked line has been removed:</p>\n\n<pre><code>repository hackage.haskell.org\n  url: http://hackage.haskell.org/\n\nremote-repo-cache: C:\\Users\\user\\AppData\\Roaming\\cabal\\packages\n\nworld-file: C:\\Users\\user\\AppData\\Roaming\\cabal\\world\n\nextra-include-dirs: C:\\programs\\haskell\\8.4.2\\mingw\\include\n\nextra-lib-dirs: C:\\programs\\haskell\\8.4.2\\mingw\\lib\n\nextra-prog-path: C:\\programs\\haskell\\8.4.2\\msys\\usr\\bin,\n                 C:\\Users\\user\\AppData\\Roaming\\cabal\\bin\n\nsymlink-bindir: C:\\Users\\user\\AppData\\Roaming\\cabal\\bin\n\nbuild-summary: C:\\Users\\user\\AppData\\Roaming\\cabal\\logs\\build.log\n\nremote-build-reporting: anonymous\n\njobs: $ncpus\n</code></pre>\n\n<p>EDIT2:</p>\n\n<p>I try to build it manually, but some dependencies missing. Here is the error message:</p>\n\n<pre><code>&gt;runhaskell Setup.hs configure --ghc\n\nConfiguring old-time-1.1.0.3...\nSetup.hs: Encountered missing dependencies:\nbase &gt;=4.7 &amp;&amp; &lt;4.9, old-locale ==1.0.*\n</code></pre>\n"}, {"tags": ["haskell", "elm"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1544928039, "post_id": 53797407, "comment_id": 94447538, "body": "Maybe the ffi / foreignfunctioninterface extension is somehow set by <code>stack ghci</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1544933496, "post_id": 53797407, "comment_id": 94448085, "body": "What version of GHC are you using? 8.4/8.6 don&#39;t let me have variables named <code>foreign</code> at all."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1544938293, "post_id": 53797407, "comment_id": 94448611, "body": "@Alec 8.4.3 last time I checked."}], "answers": [{"tags": [], "owner": {"reputation": 144, "user_id": 6844896, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mmQx5QYVBG0/AAAAAAAAAAI/AAAAAAAACPI/XmWi8zLqUQw/photo.jpg?sz=128", "display_name": "rlefevre", "link": "https://stackoverflow.com/users/6844896/rlefevre"}, "is_accepted": false, "score": 0, "last_activity_date": 1569231534, "creation_date": 1569231534, "answer_id": 58059599, "question_id": 53797407, "link": "https://stackoverflow.com/questions/53797407/inconsistent-behaviour-while-using-foreign-as-a-variable-binding-name/58059599#58059599", "title": "Inconsistent behaviour while using &quot;foreign&quot; as a variable / binding name", "body": "<p><code>foreign</code> is not used anymore in Elm source code, see <a href=\"https://github.com/elm/compiler/pull/1961\" rel=\"nofollow noreferrer\">https://github.com/elm/compiler/pull/1961</a>.</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 160, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1569231534, "creation_date": 1544909227, "question_id": 53797407, "link": "https://stackoverflow.com/questions/53797407/inconsistent-behaviour-while-using-foreign-as-a-variable-binding-name", "title": "Inconsistent behaviour while using &quot;foreign&quot; as a variable / binding name", "body": "<p>I'm trying to compile the Elm compiler from source and have run into a strange problem. I've managed to make it build via <code>stack build</code> successfully. However, when I try <code>stack ghci</code> it fails at a number of places where <code>foreign</code> has been used as a variable/binding name. For example:</p>\n\n<pre><code>/Users/saurabhnanda/projects/compiler/builder/src/File/Compile.hs:142:50: error:\n    parse error on input \u2018foreign\u2019\n    |\n142 | makeImports project (Plan.Info _ _ _ clean dirty foreign) =\n    |                                                  ^^^^^^^\nFailed, 141 modules loaded.\n</code></pre>\n\n<p>It seems that <code>foreign</code> is indeed a <a href=\"https://wiki.haskell.org/Keywords#foreign\" rel=\"noreferrer\">reserved keyword</a>. What explains this behaviour, i.e. working in <code>stack build</code> but throwing a parse-error in <code>stack ghci</code>?</p>\n"}, {"tags": ["haskell", "int"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1544898980, "post_id": 53795930, "comment_id": 94441887, "body": "@FrownyFrog That should have been an answer. Either way, the question has been asked already."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": true, "score": 2, "last_activity_date": 1544898859, "creation_date": 1544898859, "answer_id": 53796113, "question_id": 53795930, "link": "https://stackoverflow.com/questions/53795930/get-the-square-root-of-an-integer-in-haskell/53796113#53796113", "title": "Get the square root of an integer in Haskell", "body": "<p>Without outright stating the solution, here are some functions you may find handy:</p>\n\n<ul>\n<li><a href=\"https://www.haskell.org/hoogle/?hoogle=fromIntegral\" rel=\"nofollow noreferrer\"><code>fromIntegral :: (Integral a, Num b) =&gt; a -&gt; b</code></a>;</li>\n<li><a href=\"https://www.haskell.org/hoogle/?hoogle=sqrt\" rel=\"nofollow noreferrer\"><code>sqrt :: (Floating a) =&gt; a -&gt; a</code></a>;</li>\n<li><a href=\"https://www.haskell.org/hoogle/?hoogle=%28Floating+a%2C+Integral+b%29+%3D%3E+a+-%3E+b\" rel=\"nofollow noreferrer\"><code>floor, ceiling :: (RealFrac a, Integral b) =&gt; a -&gt; b</code></a>.</li>\n</ul>\n\n<p>The details of your <code>hypotenuse</code> function are up to you, so I will leave the implementation to your discretion.</p>\n"}], "owner": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 904, "favorite_count": 0, "closed_date": 1544898908, "accepted_answer_id": 53796113, "answer_count": 1, "score": -1, "last_activity_date": 1545050055, "creation_date": 1544897588, "last_edit_date": 1545050055, "question_id": 53795930, "link": "https://stackoverflow.com/questions/53795930/get-the-square-root-of-an-integer-in-haskell", "closed_reason": "Duplicate", "title": "Get the square root of an integer in Haskell", "body": "<p>I have a simple function, which is to get the \nhypotenuse of a pythagorean triangle, but for the type of Int.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>hypotenuse :: Int -&gt; Int -&gt; Int\nhypotenuse a b = sqrt(a*a + b*b)\n</code></pre>\n\n<p>I need to round up the result. </p>\n\n<p>For example: <code>hypotenuse 500 0   --result:500 :: Int</code>\n<code>hypotenuse 500 30   --result:501 :: Int</code></p>\n"}, {"tags": ["haskell", "types", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 8801428, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/msowN.png?s=128&g=1", "display_name": "simre", "link": "https://stackoverflow.com/users/8801428/simre"}, "edited": false, "score": 0, "creation_date": 1544916945, "post_id": 53795585, "comment_id": 94446042, "body": "Thanks for answering! However I can&#39;t quite get this to fit my use-case. The way I see it, <i>Renderable a HTML =&gt; Renderable (ListLayout a)</i> cannot really work since it should be possible to add different types of elements to a layout (eg. ListLayout [SomeElement1, SomeElement2] will obviously not work).  I also tried your second suggestion, but I couldn&#39;t figure out how to solve my problem with that approach either.   PS for clarification: The b in <i>data SomeElement b = SomeElement</i> is only used to help the compiler and not actually for creating a polymorphic value."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 13, "user_id": 8801428, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/msowN.png?s=128&g=1", "display_name": "simre", "link": "https://stackoverflow.com/users/8801428/simre"}, "edited": false, "score": 0, "creation_date": 1544917308, "post_id": 53795585, "comment_id": 94446092, "body": "You can make heterogeneous lists by making <code>data Renderable a where R : Renderable b a =&gt; b -&gt; Renderable a</code>. Then <code>instance Renderable (Renderable a) a where render (R x) = render x</code>"}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": true, "score": 0, "last_activity_date": 1544900009, "last_edit_date": 1544900009, "creation_date": 1544895048, "answer_id": 53795585, "question_id": 53795251, "link": "https://stackoverflow.com/questions/53795251/a-polymorphic-render-system-in-haskell/53795585#53795585", "title": "A polymorphic render system in Haskell", "body": "<p>Your types have the type of thing that is to be rendered depend on the rendering context. So e.g. you might have a <code>Button GTK</code> which would be different from a <code>Button HTML</code>, for example. I think that is in most cases wrong. Here is an alternative way to do the typeclasses:</p>\n\n<pre><code>class Renderable a b where\n  render :: a -&gt; b -&gt; b\n</code></pre>\n\n<p>Now you can still do things your old way if you like (e.g <code>instance Renderable (Button GTK) GTK</code>) although this requires language extensions.</p>\n\n<p>Here is how one might now use this:</p>\n\n<pre><code>data HTML = HTML String\n\ninstance Renderable Label HTML where\n  render (L text) (HTML pre) = HTML (pre ++ \"&lt;span&gt;\" ++ text ++ \"&lt;/span&gt;\")\n\ninstance Renderable a HTML =&gt; Renderable (ListLayout a) HTML where\n  render xs (HTML pre) = HTML (pre ++ \"&lt;div class=...&gt;\" ++ ((\\(HTML x) -&gt; x) &lt;$&gt; (\\x -&gt; render x (HTML \"\")) &lt;$&gt; xs) ++ \"&lt;/div&gt;\")\n</code></pre>\n\n<p>Maybe a better class would be:</p>\n\n<pre><code>class Gui a where\n  type Config a\n  empty :: Config a -&gt; a\n\nclass Gui b =&gt; Renderable a b where\n  render :: a -&gt; Config b -&gt; b\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1544958387, "post_id": 53801516, "comment_id": 94451828, "body": "I think your types are still wrong. But you should try <code>let savedLayout :: forall a. R a = testLayout</code> and see if that works."}, {"owner": {"reputation": 13, "user_id": 8801428, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/msowN.png?s=128&g=1", "display_name": "simre", "link": "https://stackoverflow.com/users/8801428/simre"}, "reply_to_user": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1544958829, "post_id": 53801516, "comment_id": 94451917, "body": "<code>let savedLayout :: forall a. R a = testLayout</code> results in a compiler error: <i>Couldn&#39;t match expected type \u2018forall a. R a\u2019 with actual type \u2018R b0\u2019</i> `"}], "tags": [], "owner": {"reputation": 13, "user_id": 8801428, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/msowN.png?s=128&g=1", "display_name": "simre", "link": "https://stackoverflow.com/users/8801428/simre"}, "is_accepted": false, "score": 0, "last_activity_date": 1544958604, "last_edit_date": 1544958604, "creation_date": 1544957951, "answer_id": 53801516, "question_id": 53795251, "link": "https://stackoverflow.com/questions/53795251/a-polymorphic-render-system-in-haskell/53801516#53801516", "title": "A polymorphic render system in Haskell", "body": "<p>While I now can do something like this,</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let a = render \"\" (testLayout :: R String) ++ \"a\"\n      b = render (0 :: Int) (testLayout :: R Int) + 2\n  return ()\n</code></pre>\n\n<p>i still cannot so the following, which was why I asked this question:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let savedLayout = testLayout\n  let a = render \"\" (savedLayout :: R String) ++ \"a\"\n      b = render (0 :: Int) (savedLayout :: R Int) + 2\n  return ()\n</code></pre>\n\n<p>I feel like achieving this will be much more difficult than anticipated. Furthermore, this is not a problem right now, but just a potential issue that could come up later. That's why I will close this question now and deal with this problem only when it is really necessary.</p>\n\n<p><sub>Edit: Rendering to String and Int is just for testing purposes and not what it is actually used for.</sub></p>\n"}], "owner": {"reputation": 13, "user_id": 8801428, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/msowN.png?s=128&g=1", "display_name": "simre", "link": "https://stackoverflow.com/users/8801428/simre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 53795585, "answer_count": 2, "score": 0, "last_activity_date": 1544958604, "creation_date": 1544892746, "question_id": 53795251, "link": "https://stackoverflow.com/questions/53795251/a-polymorphic-render-system-in-haskell", "title": "A polymorphic render system in Haskell", "body": "<p>I am trying to write a Markup language for my Haskell app which supports plugins. Plugin writers should not only be able to use it quickly but also be able to extends its functionality and create renderers themselves. That's why I created the class Renderable.</p>\n\n<pre><code>class Renderable a b where\n  render :: a b -&gt; b\n</code></pre>\n\n<p>To render an element you could do:</p>\n\n<pre><code>data SomeElement b = SomeElement ...\n\ninstance SomeElement SomeGUI where\n  render = ...\n</code></pre>\n\n<p>You can also create elements which hold other elements:</p>\n\n<pre><code>data ListLayout b = ListLayout [b]\n\ninstance ListLayout SomeGUI where\n  render = ...\n</code></pre>\n\n<p>In the end, you can render any (a b) to b as long as instances of Renderable a b exist:</p>\n\n<pre><code>let (myGUI :: b) = render (myLayout :: a b)\n</code></pre>\n\n<p>The problem arises when there are multiple instances of Renderable and I want to render the same value to multiple render outputs:</p>\n\n<pre><code>data SomeElement b = SomeElement\n\ninstance Renderable SomeElement GuiA\ninstance Renderable SomeElement GuiB\n\nrenderGuiA :: GuiA -&gt; IO ()\nrenderGuiB :: GuiB -&gt; IO ()\n\nrenderGuis layout = do\n  renderGuiA (render layout)\n  renderGuiB (render layout)\n\nmain :: IO ()\nmain = do\n  let layout = SomeElement\n  renderGuis layout\n</code></pre>\n\n<p>The compile infers the type of layout to be (a GuiA), since GuiA is the type renderGuiA expects. As a result, renderGuiB obviously won't compile since the types don't match. Similarly, trying to give renderGuis a type annotation does not work at all.</p>\n\n<pre><code>renderGuis :: (Renderable a GuiA, Renderable a GuiB) =&gt; a (GuiA or GuiB) -&gt; IO ()\n</code></pre>\n\n<p>I was thinking of doing something like this:</p>\n\n<pre><code>renderGuis :: (Renderable a GuiA, Renderable a GuiB) =&gt; a ['GuiA, 'GuiB] -&gt; IO ()\n</code></pre>\n\n<p>However, I do not really have the know-how and feel like I could run into a lot of other problems going down this road.</p>\n\n<p>Can anyone think of a way to make this work without compromising functionality or extensibility?\nAny help would be greatly appreciated!</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 2, "last_activity_date": 1544892264, "creation_date": 1544892264, "answer_id": 53795187, "question_id": 53794920, "link": "https://stackoverflow.com/questions/53794920/how-does-list-generation-with-fractionals-work/53795187#53795187", "title": "How does list generation with Fractionals work?", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Float.html#line-677\" rel=\"nofollow noreferrer\">Well, this is <code>instance Enum Double</code></a></p>\n\n<pre><code>instance Enum Double where\n  enumFromThenTo = numericEnumThenFromTo\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Real.html#line-252\" rel=\"nofollow noreferrer\">The implementation is here</a></p>\n\n<pre><code>numericEnumFromThenTo   :: (Ord a, Fractional a) =&gt; a -&gt; a -&gt; a -&gt; [a]\nnumericEnumFromThenTo e1 e2 e3\n    = takeWhile predicate (numericEnumFromThen e1 e2)\n                                where\n                                 mid = (e2 - e1) / 2\n                                 predicate | e2 &gt;= e1  = (&lt;= e3 + mid)\n                                           | otherwise = (&gt;= e3 + mid)\n</code></pre>\n\n<p>More important than the implementation is the note above it:</p>\n\n<pre><code>-- These 'numeric' enumerations come straight from the Report\n</code></pre>\n\n<p>Which refers to <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch6.html#x13-1310006.3.4\" rel=\"nofollow noreferrer\">this passage in the (2010) Report</a>:</p>\n\n<blockquote>\n  <p>For <code>Float</code> and <code>Double</code>, the semantics of the <code>enumFrom</code> family is given by the rules for <code>Int</code> above, except that the list terminates when the elements become greater than e<sub>3</sub> + i\u22152 for positive increment i, or when they become less than e<sub>3</sub> + i\u22152 for negative i.</p>\n</blockquote>\n\n<p>(Where e<sub>3</sub> refers to the upper bound, and i the increment.)</p>\n\n<p>The comment you found on <code>Enum</code> and the implementation in <code>class Enum</code> are both irrelevant. The comment is just example code detailing how an instance <em>might</em> be implemented, and the implementation given is inside a class, and thus may be overridden with anything.</p>\n"}], "owner": {"reputation": 13, "user_id": 10794922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/447996a75d978f0bc1ca593c6ab152a4?s=128&d=identicon&r=PG&f=1", "display_name": "DiLe", "link": "https://stackoverflow.com/users/10794922/dile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "closed_date": 1544951630, "accepted_answer_id": 53795187, "answer_count": 1, "score": 1, "last_activity_date": 1544893767, "creation_date": 1544890182, "last_edit_date": 1544893767, "question_id": 53794920, "link": "https://stackoverflow.com/questions/53794920/how-does-list-generation-with-fractionals-work", "closed_reason": "Duplicate", "title": "How does list generation with Fractionals work?", "body": "<p>If i want to generate a list with the input: </p>\n\n<pre><code>[3.1,5.1..8.1]\n</code></pre>\n\n<p>GHC 8.6.3 returns: </p>\n\n<pre><code>[3.1,5.1,7.1,9.099999999999998]\n</code></pre>\n\n<p><em>My problem here isn't the approximation of <code>9.1</code>, but why the list made by GHC has one element more than the following solution.</em>\n In the documentation I found in <code>GHC.Enum</code>, that <code>enumFromThenTo</code> translates this to something similar to the following:</p>\n\n<pre><code>    -- | Used in Haskell's translation of @[n,n'..m]@ with\n    --   @[n,n'..m] = enumFromThenTo n n' m@, a possible implementation\n    --   being @enumFromThenTo n n' m = worker (f x) (c x) n m@,\n    --   @x = fromEnum n' - fromEnum n@, @c x = bool (&gt;=) (&lt;=) (x &gt; 0)@\n    --   @f n y\n    --      | n &gt; 0 = f (n - 1) (succ y)\n    --      | n &lt; 0 = f (n + 1) (pred y)\n    --      | otherwise = y@ and\n    --   @worker s c v m\n    --      | c v m = v : worker s c (s v) m\n    --      | otherwise = []@\n</code></pre>\n\n<p>So the following code:</p>\n\n<pre><code>import Data.Bool\neftt n s m = worker (f x) (c x) n m\n     where x = (fromEnum s) - (fromEnum n)\nc x = bool (&gt;=) (&lt;=) (x &gt; 0)\nf n y \n    | n &gt; 0 = f (n-1) (succ y)\n    | n &lt; 0 = f (n+1) (pred y)\n    | otherwise = y\nworker s c v m\n    | c v m = v: worker s c (s v) m\n    | otherwise = []\n</code></pre>\n\n<p>On the same input as before, this however returns this list:</p>\n\n<pre><code>[3.1,5.1,7.1]\n</code></pre>\n\n<p>The  real implementation defined in <code>GHC.Enum</code> is the following:</p>\n\n<pre><code>enumFromThenTo x1 x2 y = map toEnum [fromEnum x1, fromEnum x2 .. fromEnum y]\n</code></pre>\n\n<p>But there is no instantiation of <code>Enum Double</code> or <code>Enum Float</code> in <code>GHC.Enum</code></p>\n\n<p>So when I tried to reproduce this with the following code:</p>\n\n<pre><code>import Prelude(putStrLn,show)\nimport GHC.Enum(toEnum,fromEnum,Enum,enumFromThenTo)\nimport GHC.Base(map)\n\nmain = putStrLn (show (_enumFromThenTo 3.1 5.1 8.1))\n\n_enumFromThenTo :: (Enum a) =&gt; a -&gt; a -&gt; a -&gt; [a]\n_enumFromThenTo x1 x2 y = map toEnum [fromEnum x1, fromEnum x2 .. fromEnum y]\n</code></pre>\n\n<p>I compiled with: </p>\n\n<pre><code>$ ghc -package ghc -package base &lt;file.hs&gt;\n</code></pre>\n\n<p>The result was again:</p>\n\n<pre><code>[3.0,5.0,7.0]\n</code></pre>\n\n<p>What is happening here, such that the output becomes:</p>\n\n<pre><code>[3.1,5.1,7.1,9.099999999999998]\n</code></pre>\n\n<p>?</p>\n"}, {"tags": ["list", "haskell", "filter"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544872512, "post_id": 53791798, "comment_id": 94434565, "body": "Two or more <i>consecutive</i> equal elements? Or can the identical elements be placed anywhere?"}, {"owner": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544872671, "post_id": 53791798, "comment_id": 94434595, "body": "The second, it does not matter if it is consecutive or not."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544872680, "post_id": 53791798, "comment_id": 94434596, "body": "Hint: what is <code>n</code> here? A list <code>[Int]</code>? or a length <code>Int</code>? Given you filter this, what will the result be?"}, {"owner": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1544873238, "post_id": 53791798, "comment_id": 94434722, "body": "Maybe a length Int? I tried to <code>[n]</code> but it didn&#39;t work either."}], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "edited": false, "score": 0, "creation_date": 1544873574, "post_id": 53791878, "comment_id": 94434811, "body": "This works, but I don&#39;t understand what does <code>not . null . tail</code> do."}, {"owner": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "reply_to_user": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "edited": false, "score": 0, "creation_date": 1544873938, "post_id": 53791878, "comment_id": 94434894, "body": "<code>null</code> returns True if a list is empty, we check if the list still has elements after the first one. The equivalent would be  <code>(\\x -&gt; (tail x) &#47;= [])</code>"}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 1, "creation_date": 1544875871, "post_id": 53791878, "comment_id": 94435300, "body": "I would probably have gone for <code>(not . null . drop 1)</code> because <code>drop 1</code> is total unlike <code>tail</code>. however due to the semantics of <code>group</code> (it never produces empty lists), it doesn&#39;t really matter in this case."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544887762, "post_id": 53791878, "comment_id": 94438893, "body": "This is a neat readable and simple way to go about it. It&#39;s good to keep in mind though requiring the list to be sorted is rather inefficient. This could be a  simple linear algorithm and it could work even in infinite lists (not the case with sorting). To make things worst, some sorting algorithms only let you access elements once the list is fully sorted, which is the case with merge sort which GHC implements."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1544888324, "post_id": 53791878, "comment_id": 94439036, "body": "I find <code>not . null . tail</code> not very clear. Might be worth defining a function <code>longerThan :: Int -&gt; [a] -&gt; Bool</code>, then it becomes very clear: <code>any (longerThan 1) . group . sort</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 1, "creation_date": 1544888574, "post_id": 53791878, "comment_id": 94439099, "body": "@JorgeAdriano Sorting is no less efficient than repeated <code>Set</code> insertions (which are O(lg n), not O(1), using the <code>Set</code> type from the <code>containers</code> library, anyway)."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544889557, "post_id": 53791878, "comment_id": 94439355, "body": "@chepner True, you&#39;re right. Still, the point holds that one doesn&#39;t have to sort the whole list beforehand to find a duplicate."}], "tags": [], "owner": {"reputation": 475, "user_id": 3993379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac1027ad3128505e2ef6222c4e306e73?s=128&d=identicon&r=PG&f=1", "display_name": "FrownyFrog", "link": "https://stackoverflow.com/users/3993379/frownyfrog"}, "is_accepted": true, "score": 6, "last_activity_date": 1544872867, "creation_date": 1544872867, "answer_id": 53791878, "question_id": 53791798, "link": "https://stackoverflow.com/questions/53791798/check-if-a-list-of-lists-has-two-or-more-identical-elements/53791878#53791878", "title": "Check if a list of lists has two or more identical elements", "body": "<p>Use <code>any</code> to get a Bool result.</p>\n\n<pre><code>any ( . . . ) ( group x )\n</code></pre>\n\n<p>Don\u2019t forget to sort the list, <code>group</code> works on consecutive elements.</p>\n\n<pre><code>any ( . . . ) ( group ( sort x ) )\n</code></pre>\n\n<p>You can use (not . null . tail) for a predicate, as one of the options.</p>\n"}, {"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 1, "last_activity_date": 1544891183, "last_edit_date": 1544891183, "creation_date": 1544887246, "answer_id": 53794538, "question_id": 53791798, "link": "https://stackoverflow.com/questions/53791798/check-if-a-list-of-lists-has-two-or-more-identical-elements/53794538#53794538", "title": "Check if a list of lists has two or more identical elements", "body": "<p>Just yesterday I posted a similar algorithm <a href=\"https://stackoverflow.com/a/53772617/1442575\">here</a>. A possible way to go about it is, </p>\n\n<ul>\n<li>generate the sequence of cumulative sets of elements<br>\n<code>{}, {x0}, {x0,x1}, {x0,x1,x2} ...</code></li>\n<li>pair the original sequence of elements with the cumulative sets<br>\n<code>x0, x1  , x2     , x3         ...</code><br>\n<code>{}, {x0}, {x0,x1}, {x0,x1,x2} ...</code></li>\n<li>check repeated insertions, i.e.<br>\n<code>xi</code> such that <code>xi \u2208 {x0..xi-1}</code> </li>\n</ul>\n\n<p>This can be implemented for instance, via the functions below. \nFirst we use <code>scanl</code> to iteratively add the elements of the list to a set, producing the cumulative sequence of these iterations. </p>\n\n<pre><code>sets  :: [Int] -&gt; [Set Int]\nsets  = scanl (\\s x -&gt; insert x s) empty\n</code></pre>\n\n<p>Then we zip the original list with this sequence, so each <code>xi</code> is paired with <code>{x0...xi-1}</code>.</p>\n\n<pre><code>elsets :: [Int] -&gt; [(Int, Set Int)] \nelsets xs  = zip xs (sets xs)\n</code></pre>\n\n<p>Finally we use <code>find</code> to search for an element that is \"about to be inserted\" in a set which already contains it. The function find returns the pair element / set, and we pattern match to keep only the element, and return it. </p>\n\n<pre><code>result ::  [Int] -&gt; Maybe Int\nresult xs = do (x,_) &lt;- find(\\(y,s)-&gt;y `elem` s) (elsets xs)\n               return x\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 1, "last_activity_date": 1544893410, "creation_date": 1544893410, "answer_id": 53795347, "question_id": 53791798, "link": "https://stackoverflow.com/questions/53791798/check-if-a-list-of-lists-has-two-or-more-identical-elements/53795347#53795347", "title": "Check if a list of lists has two or more identical elements", "body": "<p>The another way to do that using <code>Data.Map</code> as below is not efficient than <code>..group . sort..</code> solution, it is still <code>O(n log n)</code> but able to work with infinite list.</p>\n\n<pre><code>import Data.Map.Lazy as Map (empty, lookup, insert)\n\nidentical :: [Int] -&gt; Bool\nidentical = loop Map.empty\n    where loop _ []     = False\n          loop m (x:xs) = if Map.lookup x m == Nothing\n                          then loop (insert x 0 m) xs\n                          else True\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 0, "last_activity_date": 1544979231, "last_edit_date": 1544979231, "creation_date": 1544899964, "answer_id": 53796263, "question_id": 53791798, "link": "https://stackoverflow.com/questions/53791798/check-if-a-list-of-lists-has-two-or-more-identical-elements/53796263#53796263", "title": "Check if a list of lists has two or more identical elements", "body": "<p>OK basically this is one of the rare cases where you really need <code>sort</code> for efficiency. In fact <code>Data.List.Unique</code> package has a <a href=\"http://hackage.haskell.org/package/Unique-0.4.7.5/docs/Data-List-Unique.html#v:repeated\" rel=\"nofollow noreferrer\"><code>repeated</code></a> function just for this job and if the source is checked one can see that <code>sort</code> and <code>group</code> strategy is chosen. I guess this is not the most efficient algorithm. I will come to how we can make <code>sort</code> even more efficient but for the time being let's enjoy a little since this is a nice question.</p>\n\n<p>So we have the <code>tails :: [a] -&gt; [[a]]</code> functions in <code>Data.List</code> package. Accordingly;</p>\n\n<pre><code>*Main&gt; tails [3,3,6,1]\n[[3,3,6,1],[3,6,1],[6,1],[1],[]]\n</code></pre>\n\n<p>As you may quickly notice we can <code>zipWith</code> the <code>tail</code> of <code>tails</code> list which is <code>[[3,6,1],[6,1],[1],[]</code>], with the given original list by applying a function to check if <code>all</code> item are different. This function could be a list comprehension or simply the <code>all :: Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool</code> function. The thing is, I would like to short circuit <code>zipWith</code> so that once i meet the first dupe let's just stop <code>zipWith</code> doing wasteful work by checking the rest. For this purpose i can use the monadic version of <code>zipWith</code>, namely <code>zipWithM :: Applicative m =&gt; (a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]</code> which lives in <code>Control.Monad</code> package. The reason being, from it's type signature we understand that it shall stop calculating any further when it accounts for a <code>Nothing</code> or <code>Left whatever</code> in the middle if my monad happens to be <code>Maybe</code> or <code>Either</code>.</p>\n\n<p>Oh..! In Haskell I also love to use the <code>bool :: a -&gt; a -&gt; Bool -&gt; a</code> function instead of <code>if</code> and <code>then</code>. <code>bool</code> is the ternary operation of Haskell which goes like</p>\n\n<pre><code>bool \"work time\" \"coffee break\" isCoffeeTime\n</code></pre>\n\n<p>The negative choice is on the left and the positive one is on the right where <code>isCoffeeTime :: Bool</code> is a function to return <code>True</code> if it is coffee time. Very composable as well.. so cool..!</p>\n\n<p>So since we now have all the background knowledge we may proceed with the code</p>\n\n<pre><code>import Control.Monad (zipWithM)\nimport Data.List (tails)\nimport Data.Bool (bool)\n\nanyDupe :: Eq a =&gt; [a] -&gt; Either a [a]\nanyDupe xs = zipWithM f xs ts\n             where ts = tail $ tails xs\n                   f  = \\x t -&gt; bool (Left x) (Right x) $ all (x /=) t\n\n*Main&gt; anyDupe [1,2,3,4,5]\nRight [1,2,3,4,5] -- no dupes so we get the `Right` with the original list\n*Main&gt; anyDupe [3,3,6,1]\nLeft 3 -- here we have the first duplicate since zipWithM short circuits.\n*Main&gt; anyDupe $ 10^7:[1..10^7]\nLeft 10000000 -- wow zipWithM worked and returned reasonably fast.\n</code></pre>\n\n<p>But again.. as i said, this is still a naive approach because theoretically we are doing <code>n(n+1)/2</code> operations. Yes <code>zipWithM</code> cuts redundancy down greatly if the first met dupe is close to the head but still this algorithm is O(n^2).</p>\n\n<p>I believe it would be best to use the heavenly <code>sort</code> algorithm of Haskell (which is not merge sort as we know it by the way) in this particular case.</p>\n\n<p>Now the algorithm award goes to -> <em>drum roll here</em> -> <code>sort</code> and <code>fold</code> -> <em>applause</em>. Sorry no grouping.</p>\n\n<p>So now... once again we will use a monadic trick to utilize short circuits. We will use <code>foldM :: (Foldable t, Monad m) =&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b</code>. This, when used with <code>Either</code> monad also allows us to return a more meaningful result. OK lets do it. Any <code>Left n</code> means <code>n</code> is the first dupe and no more calculations while any <code>Right _</code> means there are no dupes.</p>\n\n<pre><code>import Control.Monad (foldM)\nimport Data.List (sort)\nimport Data.Bool (bool)\n\nanyDupe' :: (Eq a, Ord a, Enum a) =&gt; [a] -&gt; Either a a\nanyDupe' xs = foldM f i $ sort xs\n              where i = succ $ head xs -- prevent the initial value to be equal with the value at the head\n                    f = \\b a -&gt; bool (Left a) (Right a) (a /= b)\n\n*Main&gt; anyDupe' [1,2,3,4,5]\nRight 5\n*Main&gt; anyDupe' [3,3,6,1]\nLeft 3\n*Main&gt; anyDupe' $ 1:[10^7,(10^7-1)..1]\nLeft 1\n(2.97 secs, 1,040,110,448 bytes)\n*Main&gt; anyDupe $ 1:[10^7,(10^7-1)..1]\nLeft 1\n(2.94 secs, 1,440,112,888 bytes)\n*Main&gt; anyDupe' $ [1..10^7]++[10^7]\nLeft 10000000\n(5.71 secs, 3,600,116,808 bytes)   -- winner by far\n*Main&gt; anyDupe $ [1..10^7]++[10^7] -- don't try at home, it's waste of energy\n</code></pre>\n\n<p>In real world scenarios <code>anyDupe'</code> should always be the winner.</p>\n"}], "owner": {"reputation": 153, "user_id": 10576445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b94a92f173bb81e959362daf0424d3?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Joe", "link": "https://stackoverflow.com/users/10576445/tyler-joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1020, "favorite_count": 0, "accepted_answer_id": 53791878, "answer_count": 4, "score": 4, "last_activity_date": 1544979231, "creation_date": 1544872192, "question_id": 53791798, "link": "https://stackoverflow.com/questions/53791798/check-if-a-list-of-lists-has-two-or-more-identical-elements", "title": "Check if a list of lists has two or more identical elements", "body": "<p>I need to write a function which checks if a list has two or more same elements and  returns true or false.</p>\n\n<p>For example <code>[3,3,6,1]</code> should return true, but <code>[3,8]</code> should return false. </p>\n\n<p>Here is my code:</p>\n\n<pre><code>identical :: [Int] -&gt; Bool\nidentical x = (\\n-&gt; filter (&gt;= 2) n )( group x )\n</code></pre>\n\n<p>I know this is bad, and it does not work.\nI wanted to group the list into list of lists, and if the length of a list is >= 2, then it is should return with true otherwise false. </p>\n"}, {"tags": ["haskell", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 4, "creation_date": 1544833769, "post_id": 53788502, "comment_id": 94428543, "body": "This is why monad transformers exist! (In this case, <code>StateT</code>.)"}, {"owner": {"reputation": 656, "user_id": 6739197, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/596ca15ff00c5f201050c7b3194d9fd2?s=128&d=identicon&r=PG&f=1", "display_name": "victor.ja", "link": "https://stackoverflow.com/users/6739197/victor-ja"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1544834962, "post_id": 53788502, "comment_id": 94428734, "body": "could you please give me an example @ReinHenrichs"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1544838801, "post_id": 53788502, "comment_id": 94429306, "body": "If you want to do <code>IO</code>, your monad will have to mention it; e.g. <code>newtype StateErrorIO a = StateErrorIO { runStateErrorIO :: Env -&gt; IO (Maybe (a, Env)) }</code>."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1544839945, "post_id": 53788502, "comment_id": 94429485, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/18339274/monad-transformers-io-and-state\">Monad transformers: IO and state</a> . maybe a better dupe out there"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1544841277, "post_id": 53788502, "comment_id": 94429657, "body": "Do you want to learn how to <i>write</i> a monad transformer or how to <i>use</i> a monad transformer to accomplish your goal?"}, {"owner": {"reputation": 656, "user_id": 6739197, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/596ca15ff00c5f201050c7b3194d9fd2?s=128&d=identicon&r=PG&f=1", "display_name": "victor.ja", "link": "https://stackoverflow.com/users/6739197/victor-ja"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1544841596, "post_id": 53788502, "comment_id": 94429696, "body": "@ThomasM.DuBuisson I want to use it to accomplish my goal (write a throw function for my parser evaluator)"}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 6, "last_activity_date": 1544855433, "creation_date": 1544855433, "answer_id": 53790134, "question_id": 53788502, "link": "https://stackoverflow.com/questions/53788502/print-to-console-and-update-monad-state-in-same-function/53790134#53790134", "title": "Print to console and update Monad state in same function", "body": "<p><strong>No</strong></p>\n\n<p>A function in the state monad, such as <code>a -&gt; State s b</code>, is a pure function (no IO) that happens to have an extra function argument <code>s</code> hidden though some handy plumbing.</p>\n\n<p>You can't print to the console from the state monad.</p>\n\n<p><strong>However, Yes!</strong></p>\n\n<p>However! You can use a monad <em>transformer</em> to get both State and some underlying monad such as IO.</p>\n\n<p>I'll provide an example using <code>transformers</code> instead of a custom monad and <code>mtl</code> as it appears you were using.  With <code>mtl</code> you can use classes like <code>MonadError</code> to leverage a <code>throw</code> that works well with other libraries that use the mtl classes.  On the other hand, if you are the end consumer of this transformer it is less important.</p>\n\n<p>First we'll import the modules that give us MonadIO, StateT, MaybeT, and use newtype deriving so we don't have to type out the monad instance boilerplate:</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\nimport qualified Control.Monad.Trans.State as S\nimport Control.Monad.IO.Class\nimport Control.Monad.Trans.Maybe\nimport Control.Monad.Trans\n</code></pre>\n\n<p>Just to be complete we'll spell out the types useful to your abstraction:</p>\n\n<pre><code>type Variable = String\ntype Env = [(Variable,Int)]\n</code></pre>\n\n<p>Now we can get to the interesting part - a Monad definition and functions for plumbing.   The monad stack is StateT MaybeT IO:</p>\n\n<pre><code>newtype StateError a = StateError { unStateError :: S.StateT Env (MaybeT IO) a }\n    deriving (Monad, Applicative, Functor)\n</code></pre>\n\n<p>And we can run it by first unwrapping the newtype, then running the state, and finally the MaybeT:</p>\n\n<pre><code>run :: StateError a -&gt; IO (Maybe (a, Env))\nrun = runMaybeT . flip S.runStateT [] . unStateError\n</code></pre>\n\n<p>Usually you'll write an army of functions that provide your monad abstraction.  For this question it's just \"update the state\" and \"print to stdout\":</p>\n\n<pre><code>modify :: (Env -&gt; Env) -&gt; StateError ()\nmodify = StateError . S.modify\n\nemit :: Show a =&gt; a -&gt; StateError ()\nemit = StateError . liftIO . print . show\n</code></pre>\n\n<p>Armed with our Monad of Power, we can do fancy things like update state <em>and</em> emit IO messages <em>and</em> track failure or success:</p>\n\n<pre><code>updateAndPrint :: Variable -&gt; Int -&gt; StateError ()\nupdateAndPrint v i =\n  do emit (v,i)\n     modify ((v,i):)\n</code></pre>\n\n<p>Oh, and failure is pretty simple - just fail in our <code>MaybeT</code> monad:</p>\n\n<pre><code>throw :: a -&gt; StateError b\nthrow _ = fail \"\"  -- same as 'MaybeT (pure Nothing)'\n</code></pre>\n\n<p>We can use this monad as expected:</p>\n\n<pre><code>&gt; run $ updateAndPrint \"var\" 1\n\"(\\\"var\\\",1)\"\nJust (()             -- ^ return value of `updateAndPrint`\n     ,[(\"var\",1)])   -- ^ resulting state\n</code></pre>\n"}], "owner": {"reputation": 656, "user_id": 6739197, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/596ca15ff00c5f201050c7b3194d9fd2?s=128&d=identicon&r=PG&f=1", "display_name": "victor.ja", "link": "https://stackoverflow.com/users/6739197/victor-ja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 2, "accepted_answer_id": 53790134, "answer_count": 1, "score": -1, "last_activity_date": 1544855433, "creation_date": 1544833621, "question_id": 53788502, "link": "https://stackoverflow.com/questions/53788502/print-to-console-and-update-monad-state-in-same-function", "title": "Print to console and update Monad state in same function", "body": "<p>I want to define a function that expects an <code>Int</code>, prints an error in the console depending on the number (<strong>x</strong>) and then updates the <code>State</code> with <code>Nothing</code>.</p>\n\n<p>How can I join those commands in one function?</p>\n\n<p>Here's what I got:</p>\n\n<pre><code>  type Env = [(Variable,Int)]\n  newtype StateError a = StateError { runStateError :: Env -&gt; Maybe (a, Env) }\n  class Monad m =&gt; MonadError m where\n    throw :: Monad m =&gt; a -&gt; m a\n\n  instance MonadError StateError where\n    throw x = StateError (\\s -&gt; Nothing)\n</code></pre>\n\n<p>But I can't figure out how to perform the <code>IO</code> side-effect and <strong>then</strong> the State update in the same function definition</p>\n"}, {"tags": ["haskell", "idris", "type-systems", "liquid-haskell"], "comments": [{"owner": {"reputation": 3465, "user_id": 5786950, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ottS5.png?s=128&g=1", "display_name": "xash", "link": "https://stackoverflow.com/users/5786950/xash"}, "edited": false, "score": 2, "creation_date": 1544870091, "post_id": 53788064, "comment_id": 94434083, "body": "Note that in Idris you can <a href=\"http://docs.idris-lang.org/en/latest/reference/erasure.html#changes-to-the-language\" rel=\"nofollow noreferrer\">annotate argument to erasure</a>, so at least the compiler will inform you if the to-erased argument cannot be erased. Also, in Idris&#39; successor <a href=\"https://github.com/edwinb/Blodwen\" rel=\"nofollow noreferrer\">Bloodwen</a>: &quot;Unbound implicit arguments are always erased, so it is a type error to attempt to pattern match on one.&quot; will be a easier to understand approach to erasure."}], "answers": [{"comments": [{"owner": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "edited": false, "score": 0, "creation_date": 1544834490, "post_id": 53788386, "comment_id": 94428663, "body": "Yes, i am aware of the second part of the answer. Type classes are Haskells method of choice for dynamic dispatch. But i think this is different in three major points. 1) It is always clear when this can potentially happen (every time one uses a type class method). 2) Often it can be optimized away (when the final type is known and specialization/inlining kicks in, the dynamic dispatch is gone). 3) This is more of a language thing in general and less of a type system thing. Even some dynamically typed languages feature dynamic dispatch..."}, {"owner": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "edited": false, "score": 0, "creation_date": 1544834759, "post_id": 53788386, "comment_id": 94428701, "body": "One thing i have to add here, is that 2) in my comment above is probably more often applicable in Haskell, then in other languages. When do we have a type where we only know that it implements &#39;show&#39; but do not know the exact type. It can and does happen, but far less often than in languages like e.g. Java. But maybe i am wrong here..."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 3, "last_activity_date": 1544832331, "creation_date": 1544832331, "answer_id": 53788386, "question_id": 53788064, "link": "https://stackoverflow.com/questions/53788064/runtime-type-terms-in-liquidhaskell-vs-idris/53788386#53788386", "title": "Runtime &quot;type terms&quot; in LiquidHaskell vs. Idris", "body": "<p>To answer your question as asked: Liquid Haskell allows you to provide annotations that a separate tool from the compiler verifies. Code is still compiled exactly the same way.</p>\n\n<p>However, I have quibbles with your question as asked. It can be argued that there are cases in which some residue of the type must survive at run time in Haskell - especially when polymorphic recursion is involved. Consider this function:</p>\n\n<pre><code>lots :: Show a =&gt; Int -&gt; a -&gt; String\nlots 0 x = show x\nlots n x = lots (n-1) (x,x)\n</code></pre>\n\n<p>There is no way to statically determine the exact type involved in the use of <code>show</code>. <em>Something</em> derived from the types must survive to runtime. In practice, this is easy to do by using type class dictionaries. The theoretically important detail is that there's still type-directed behavior being chosen at runtime. </p>\n"}], "owner": {"reputation": 938, "user_id": 4163506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/57e96b2432b47a690aecb5f532739f8c?s=128&d=identicon&r=PG&f=1", "display_name": "Lazarus535", "link": "https://stackoverflow.com/users/4163506/lazarus535"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 2, "accepted_answer_id": 53788386, "answer_count": 1, "score": 6, "last_activity_date": 1544832331, "creation_date": 1544829293, "question_id": 53788064, "link": "https://stackoverflow.com/questions/53788064/runtime-type-terms-in-liquidhaskell-vs-idris", "title": "Runtime &quot;type terms&quot; in LiquidHaskell vs. Idris", "body": "<p>I have been playing around with LiquidHaskell and Idris lately and i got a pretty specific question, that i could not find a definitive answer anywhere.</p>\n\n<p>Idris is a dependently typed language which is great for the most part. However i read that some type terms during type checking can \"leak\" from compile-time to run-time, even tough Idris does its best to eliminate those terms (this is a special feature even..). However, this elimination is not perfect and sometimes it does happen. If, why and when this happens is not immediately clear from the code and sometimes has an effect on run-time performance.</p>\n\n<p>I have seen people prefering Haskells' type system, because it cannot happen there. When type checking is done, it is done. Types are \"thrown away\" and not used during run-time.</p>\n\n<p>What is the story for LiquidHaskell? It enhances the type system capabilities quite a bit over traditional Haskell. Does LiquidHaskell also inject run-time bits for certain type \"constellations\" or (as i suspect) just adds another layer of \"better\" types over Haskell that do not affect run-time in any shape or form. </p>\n\n<p>Meaning, if one removes the special LiquidHaskell type annotations and compiles it with standard GHC, is the code produced always the same? In other words: Is the LiquidHaskell extension compile-time only?</p>\n\n<p>If yes, this seems like the best of both worlds, or is LiquidHaskell just not as expressive in the type system as Idris and therefore manages without run-time terms?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1544829658, "post_id": 53788045, "comment_id": 94427795, "body": "I find these type signatures a bit too pseudo-codeish to understand what you&#39;re asking about. Please avoid using lowercase letters for placeholders that aren&#39;t type variables."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1544831266, "post_id": 53788045, "comment_id": 94428126, "body": "Is there any such type which couldn&#39;t be made into a Functor if you wanted? This looks sort of like a yoneda embedding to me."}], "owner": {"reputation": 2244, "user_id": 29408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f7af9c8034d5070fb2e8565c79c604b7?s=128&d=identicon&r=PG", "display_name": "Julian Birch", "link": "https://stackoverflow.com/users/29408/julian-birch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1544832147, "creation_date": 1544829102, "last_edit_date": 1544832147, "question_id": 53788045, "link": "https://stackoverflow.com/questions/53788045/using-a-lens-over-something-that-isnt-a-functor", "title": "Using a lens over something that isn&#39;t a functor", "body": "<p>I have a lens(')</p>\n\n<pre><code>myLens' :: (Functor f) =&gt; (a -&gt; f a) -&gt; (s -&gt; f s)\n</code></pre>\n\n<p>And I need a function</p>\n\n<pre><code>lensWithoutFunctor' :: ((a -&gt; b) -&gt; (f a -&gt; f b)) -&gt; (a -&gt; f a) -&gt; (s -&gt; f s)\n</code></pre>\n\n<p>(The particular type I'm interested in is </p>\n\n<pre><code>type PopType x a = x -&gt; Maybe (a, x)\n</code></pre>\n\n<p>which could be made into a Functor if I wanted)</p>\n\n<p>Is there a better way to do this other than create a Functor-implementing newtype and then doing something involving \"ala\"?</p>\n"}, {"tags": ["haskell", "haskell-stack", "haskell-platform"], "comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1544825356, "post_id": 53787455, "comment_id": 94426640, "body": "What do you want to do with the output of <code>juke image copy ...</code>?"}, {"owner": {"reputation": 91, "user_id": 1858059, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/322db5cce34043e8a36ccfb7bc9ac776?s=128&d=identicon&r=PG", "display_name": "user1858059", "link": "https://stackoverflow.com/users/1858059/user1858059"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1544825650, "post_id": 53787455, "comment_id": 94426734, "body": "Nothing really. This is a shell command that should be executed prior to the second command. The output in this case wont be used"}], "answers": [{"comments": [{"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544825984, "post_id": 53787599, "comment_id": 94426825, "body": "we don&#39;t know if he wants to ignore the intermediate result though"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544826030, "post_id": 53787599, "comment_id": 94426835, "body": "@JorgeAdriano Sure we do. In the comments, they say &quot;The output [of <code>juke image copy ...</code>] in this case wont be used&quot;."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "edited": false, "score": 0, "creation_date": 1544826096, "post_id": 53787599, "comment_id": 94426861, "body": "@DanielWagner oh I hadn&#39;t seen his answer yet, my bad!"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1544826434, "post_id": 53787599, "comment_id": 94426948, "body": "@user1858059 you should follow the suggestion in the warning (or use the <code>void</code> function if you prefer)"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1544826113, "last_edit_date": 1544826113, "creation_date": 1544825856, "answer_id": 53787599, "question_id": 53787455, "link": "https://stackoverflow.com/questions/53787455/basic-question-on-executing-multiple-commands-in-haskell/53787599#53787599", "title": "Basic question on executing multiple commands in Haskell", "body": "<p>You can combine monadic actions with <code>(&gt;&gt;)</code>:</p>\n\n<pre><code>(&gt;&gt;) :: Monad m =&gt; m a -&gt; m b -&gt; m b\n</code></pre>\n\n<p>Or with <code>do</code> syntax, which desugars to <code>(&gt;&gt;)</code>:</p>\n\n<pre><code>\\act1 act2 -&gt; do {act1; act2} :: Monad m =&gt; m a -&gt; m b -&gt; m b\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>launch :: MonadIO m =&gt; m (Maybe Text)\nlaunch = do\n    preLaunchLine\n    line &lt;- launchLine\n    return $ lineToText &lt;$&gt; line\n\npreLaunchLine :: MonadIO m =&gt; m (Maybe Line)\npreLaunchLine = fold (inproc \"juke\" [\"image\", \"copy\", \"jukebox:\" &lt;&gt; pack baseImage, \"local:\", \"--copy-aliases\"] mempty) $\n    Fold selectLaunchName Nothing id\n\nlaunchLine :: MonadIO m =&gt; m (Maybe Line)\nlaunchLine = fold (inproc \"juke\" [\"launch\", \"--profile\", \"jukeplay\", pack baseImage] mempty) $\n    Fold selectLaunchName Nothing id\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 1858059, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/322db5cce34043e8a36ccfb7bc9ac776?s=128&d=identicon&r=PG", "display_name": "user1858059", "link": "https://stackoverflow.com/users/1858059/user1858059"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 53787599, "answer_count": 1, "score": -1, "last_activity_date": 1544826113, "creation_date": 1544824862, "last_edit_date": 1544825152, "question_id": 53787455, "link": "https://stackoverflow.com/questions/53787455/basic-question-on-executing-multiple-commands-in-haskell", "title": "Basic question on executing multiple commands in Haskell", "body": "<p>I have the following on my code:</p>\n\n<pre><code>  where\n    launch :: MonadIO m =&gt; m (Maybe Text)\n    launch = do\n        line &lt;- launchLine\n        return $ lineToText &lt;$&gt; line\n\n    launchLine :: MonadIO m =&gt; m (Maybe Line)\n    launchLine = fold (inproc \"juke\" [\"launch\", \"--profile\", \"jukeplay\", pack baseImage] mempty) $\n        Fold selectLaunchName Nothing id\n</code></pre>\n\n<p>The lines above work fine. My problem (and question) is that I want to execute another command before this launch line, so it could be something like:</p>\n\n<pre><code>  where\n    launch :: MonadIO m =&gt; m (Maybe Text)\n    launch = do\n        line &lt;- launchLine\n        return $ lineToText &lt;$&gt; line\n\n    launchLine :: MonadIO m =&gt; m (Maybe Line)\n    launchLine = fold (inproc \"juke\" [\"image\", \"copy\", \"jukebox:\" &lt;&gt; pack baseImage, \"local:\", \"--copy-aliases\"] mempty) $\n        Fold selectLaunchName Nothing id\n\n    launchLine :: MonadIO m =&gt; m (Maybe Line)\n    launchLine = fold (inproc \"juke\" [\"launch\", \"--profile\", \"jukeplay\", pack baseImage] mempty) $\n        Fold selectLaunchName Nothing id\n</code></pre>\n\n<p>This obviously does not work. How could I accomplish this?</p>\n\n<p>I need to have this \"juke image copy\" done before the \"juke launch..\" is executed</p>\n\n<p>Thanks in advance for the help</p>\n"}, {"tags": ["json", "sqlite", "haskell"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 2, "creation_date": 1544823320, "post_id": 53787039, "comment_id": 94425975, "body": "You&#39;d do it the same way you insert anything into a database. Source doesn&#39;t matter once you have the values you need."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1544824777, "post_id": 53787039, "comment_id": 94426466, "body": "Can you scope your problem a little more narrowly and with more complete details?  From my reading you already have values of type <code>Person</code> and wish to create a database entry into some unspecified database library, perhaps <code>sqlite-simple</code>, perhaps <code>sqlite</code>, or <code>sqlite-direct</code>, or perhaps something else.  It seems the talk about JSON is all superfluous."}, {"owner": {"reputation": 81, "user_id": 7699565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7441d320bd61b6dae3aa995dc3fd59f?s=128&d=identicon&r=PG&f=1", "display_name": "Szymon", "link": "https://stackoverflow.com/users/7699565/szymon"}, "edited": false, "score": 0, "creation_date": 1544875901, "post_id": 53787039, "comment_id": 94435303, "body": "Thank you very much for the response. The thing is, I need to assign the values from json to variables so I can insert the values stored in these variables into the database, right? And my problem is that whenever I try to convert json to the object, I end up with IO() format and I have no idea what I am supposed to do next in order (and it would make it accessible. ) to feed my db with the data. I am a beginner when it comes to Haskell, so I might be missing something."}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "edited": false, "score": 0, "creation_date": 1544877884, "post_id": 53787039, "comment_id": 94435771, "body": "If your problem is with IO, please edit the question and include the code where you are doing IO.  If you have code that can write a Person to the database, include that also."}, {"owner": {"reputation": 81, "user_id": 7699565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7441d320bd61b6dae3aa995dc3fd59f?s=128&d=identicon&r=PG&f=1", "display_name": "Szymon", "link": "https://stackoverflow.com/users/7699565/szymon"}, "edited": false, "score": 0, "creation_date": 1544887809, "post_id": 53787039, "comment_id": 94438904, "body": "It is not the IO problem though. IO is the last thing I got to, but it still does not change the fact that the thing I want to understand is how can I extract the data from a JSON so it can be assigned to variables and then inserted into the database. Thanks."}, {"owner": {"reputation": 81, "user_id": 7699565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7441d320bd61b6dae3aa995dc3fd59f?s=128&d=identicon&r=PG&f=1", "display_name": "Szymon", "link": "https://stackoverflow.com/users/7699565/szymon"}, "edited": false, "score": 0, "creation_date": 1544889708, "post_id": 53787039, "comment_id": 94439394, "body": "I followed <a href=\"https://www.schoolofhaskell.com/school/starting-with-haskell/libraries-and-frameworks/text-manipulation/json\" rel=\"nofollow noreferrer\">this tutorial</a> - first example, but there is nothing about what should happen next once the JSON file is decoded."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 7699565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7441d320bd61b6dae3aa995dc3fd59f?s=128&d=identicon&r=PG&f=1", "display_name": "Szymon", "link": "https://stackoverflow.com/users/7699565/szymon"}, "edited": false, "score": 0, "creation_date": 1545024810, "post_id": 53807340, "comment_id": 94467181, "body": "Thank you very much Thomas. That&#39;s exactly what I was interested in!"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1545003215, "last_edit_date": 1545003215, "creation_date": 1545002349, "answer_id": 53807340, "question_id": 53787039, "link": "https://stackoverflow.com/questions/53787039/haskell-sqlite3-json/53807340#53807340", "title": "Haskell sqlite3 json", "body": "<blockquote>\n  <p>the issue I face at the moment is how to extract these data out of JSON and insert it into the database.</p>\n</blockquote>\n\n<p>Those are two separate issues.</p>\n\n<ol>\n<li><p>You have a <code>FromJSON</code> instance for your type so all you need to do is <code>decode</code> or <code>eitherDecode</code> to parse your JSON into the <code>Person</code> type:</p>\n\n<pre><code> case eitherDecode person_json of\n    Left err     -&gt; error err\n    Right person -&gt; insertPersonIntoDB person\n</code></pre></li>\n<li><p>You haven't selected an sqlite library.  Select one and read how to use it.  I've picked sqlite-simple which can be used as such:</p>\n\n<pre><code> do\n conn &lt;- open \"test.db\"\n execute_ conn \"CREATE TABLE IF NOT EXISTS people\\\n               \\ (name TEXT, surname TEXT, workPlace TEXT,\\\n               \\ accountBalance INTEGER, age INTEGER)\"\n execute conn \"INSERT INTO people \\\n              \\(name,surname,workPlace,accountBalance,age)\\\n              \\ VALUES (?,?,?,?,?)\"\n         (name,surname,workPlace,accountBalance,age)\n close conn\n</code></pre></li>\n</ol>\n\n<p>Later, in a comment you said:</p>\n\n<blockquote>\n  <p>I need to assign the values from json to variables</p>\n</blockquote>\n\n<p>That is what the decode does, it parses the JSON into the Person value and by pattern matching on Person we can get variables for each JSON field.  For example:</p>\n\n<pre><code>printPersonTuple (Person nm sur wk acct years) =\n    print (nm,sur,wk,acct,years)\n</code></pre>\n\n<blockquote>\n  <p>so I can insert the values stored in these variables into the database</p>\n</blockquote>\n\n<p>Yes, once you have variable names, or just a <code>ToRow</code> instance (read the sqlite-simple docs) then you can insert the value into the database.</p>\n\n<blockquote>\n  <p>And my problem is that whenever I try to convert json to the object, I end up with IO() format</p>\n</blockquote>\n\n<p>Well that is a very separate problem from anything in your question.  Post that as another question if you are stumped.</p>\n\n<p><strong>Conclusion</strong></p>\n\n<p>It appears you have several problems such as understanding IO, decomposing the problem into subcomponents, using a value after parsing, selecting and groking a database library.  Please see below for a complete example but it probably won't be completely illuminating given this list of things to learn - please do ask follow up questions not as comments to this answer but as fresh questions separate from this one.</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric     #-}\n{-# LANGUAGE DeriveAnyClass    #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE RecordWildCards   #-}\nimport GHC.Generics                     -- So you can derive 'Generic'\nimport Data.Aeson                       -- JSON\nimport Database.SQLite.Simple           -- Databse ops\nimport Data.Text (Text,unpack)\nimport qualified Data.ByteString.Lazy.Char8 as BC -- Just for prettier debugging\n\n-- The type you are receiving from JSON\ndata Person = Person\n           { name           :: Text\n           , surname        :: Text\n           , workPlace      :: Text\n           , accountBalance :: Integer\n           , age            :: Integer\n           }\n           deriving (Eq, Show, Read, Generic, FromJSON, ToJSON )\n          -- To/FromJSON are autogenerated JSON encode/decode instances\n\n-- Auto-convert database rows into Person types for queries\ninstance FromRow Person where\n    fromRow = Person &lt;$&gt; field &lt;*&gt; field &lt;*&gt; field &lt;*&gt; field &lt;*&gt; field\n\n-- An expensive \"insert\" operation\n-- Open a DB connection, create a table (maybe), insert the value, close the\n-- connection\ninsertPersonIntoDB :: Person -&gt; IO ()\ninsertPersonIntoDB (Person {..}) =\n do conn &lt;- open \"test.db\"\n    execute_ conn \"CREATE TABLE IF NOT EXISTS people (name TEXT, surname TEXT, workPlace TEXT, accountBalance INTEGER, age INTEGER)\"\n    execute conn \"INSERT INTO people (name,surname,workPlace,accountBalance,age) VALUES (?,?,?,?,?)\" (name,surname,workPlace,accountBalance,age)\n    close conn\n\n-- A simple test to print out the whole table\nprintDB :: IO ()\nprintDB =\n do conn &lt;- open \"test.db\"\n    res &lt;- query_ conn \"SELECT * FROM people\" :: IO [Person]\n    putStrLn (unlines (map show res))\n    close conn\n\n-- Glue it all together by\n-- 1. Make the json 2. parse the json 3. insert to DB 4. print entire DB\nmain :: IO ()\nmain =\n  do let person_json = encode (Person \"Tom\" \"MD\" \"Galois\" (floor 1e9) 4)\n     putStrLn $ \"JSON: \" ++ BC.unpack person_json\n     case eitherDecode person_json of\n        Left err     -&gt; error err\n        Right person -&gt; insertPersonIntoDB person\n     putStrLn \"----- Database -----\"\n     printDB\n</code></pre>\n\n<p>And the result looks like:</p>\n\n<pre><code>% ghc so.hs\n% ./so\nJSON: {\"accountBalance\":1000000000,\"age\":4,\"name\":\"Tom\",\"workPlace\":\"Galois\",\"surname\":\"MD\"}\n----- Database -----\nPerson {name = \"Tom\", surname = \"MD\", workPlace = \"Galois\", accountBalance = 1000000000, age = 4}\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 7699565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7441d320bd61b6dae3aa995dc3fd59f?s=128&d=identicon&r=PG&f=1", "display_name": "Szymon", "link": "https://stackoverflow.com/users/7699565/szymon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 53807340, "answer_count": 1, "score": -2, "last_activity_date": 1545003215, "creation_date": 1544822522, "question_id": 53787039, "link": "https://stackoverflow.com/questions/53787039/haskell-sqlite3-json", "title": "Haskell sqlite3 json", "body": "<p>I am trying to to create a simple Haskell app that gets the data from the API and then inserts them into the database (sqlite3). I have managed to sucessfully get the data from my API and create the database.  However, the issue I face at the moment is how to extract these data out of JSON and insert it into the database. I cannot share all the details that's why I modified the types (data) structure. Sample API response:</p>\n\n<pre><code>[{\"name\":\"John\",\"surname\":\"Terry\",\"workPlace\":\"Bank\",\"accountBalance\":124344.08,\"age\":44}]\n</code></pre>\n\n<p>Person Data Type and its instance (for extraction) :</p>\n\n<pre><code>    data Person = Person\n               {\n\n                  name :: Text, \n                  surname :: Text,\n                  workPlace :: Text, \n                  accountBalance :: Rational, \n                  age :: Integer \n               }\n               deriving (Eq, Show, Read, Generic, ToJSON )\n\n\n\ninstance FromJSON Person where\n   parseJSON (Object v) = p &lt;$&gt; n &lt;*&gt; s &lt;*&gt; w &lt;*&gt; acc &lt;*&gt; a\n       where p = Person             \n             n = v .: \"name\"\n             s = v .: \"surname\"\n             w = v .: \"workPlace\"\n             acc = v .: \"accountBalance\"\n             a = v .: \"age\"\n   -- A non-Object value is of the wrong type, so fail.\n   parseJSON _ = mzero\n</code></pre>\n\n<p>Thanks in advance. </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 4, "last_activity_date": 1544822198, "last_edit_date": 1544822198, "creation_date": 1544821776, "answer_id": 53786904, "question_id": 53786788, "link": "https://stackoverflow.com/questions/53786788/mapm-on-io-produces-infinite-output/53786904#53786904", "title": "mapM on IO produces infinite output", "body": "<p>Well according to the <a href=\"http://hackage.haskell.org/package/filepath-1.4.2.1/docs/System-FilePath-Posix.html#t:FilePath\" rel=\"nofollow noreferrer\">documentation</a>, </p>\n\n<pre><code>type FilePath = String \n</code></pre>\n\n<p>That is, </p>\n\n<pre><code>type FilePath = [Char]\n</code></pre>\n\n<p>So in this line, </p>\n\n<pre><code>let files = mapM (dir &lt;/&gt;) lsfiles\n</code></pre>\n\n<p>you have that the argument of <code>mapM</code>, which is <code>(dir &lt;/&gt;)</code>, is of type <code>FilePath -&gt; FilePath</code>. Now look at the type of <code>mapM</code>, </p>\n\n<pre><code>mapM :: (Traversable t, Monad m) =&gt; (a -&gt; m b) -&gt; t a -&gt; m (t b)\n                                         ^^^^^\n</code></pre>\n\n<p>So the  type <code>a -&gt; m b</code> is instantiated to <code>FilePath -&gt; FilePath</code>, which is <code>FilePath -&gt; [Char]</code>. So you're performing a monadic mapping using the list monad,  which is the \"nondeterminism\" monad in this case for values of type <code>Char</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1544822693, "last_edit_date": 1544822693, "creation_date": 1544822365, "answer_id": 53787015, "question_id": 53786788, "link": "https://stackoverflow.com/questions/53786788/mapm-on-io-produces-infinite-output/53787015#53787015", "title": "mapM on IO produces infinite output", "body": "<blockquote>\n  <p>What is the output of the first <code>mapM</code>? It looks like an infinite loop on reading some files.</p>\n</blockquote>\n\n<p>It is not an infinite loop -- merely a very, very long one.</p>\n\n<p>You are not using <code>mapM</code> for <code>IO</code>; you are using <code>mapM</code> in the nondeterminism monad. Here is the type of <code>mapM</code>, specialized to that monad:</p>\n\n<pre><code>Traversable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [t b]\n</code></pre>\n\n<p>Read this in the following way:</p>\n\n<ul>\n<li>First, give me a way to turn an element of a container (type <code>a</code>) into a nondeterministic choice between many possible replacement elements (type <code>[b]</code>).</li>\n<li>Then give me a containerful of elements (type <code>t a</code>).</li>\n<li>I will give you a nondeterministic choice between containers with replacement elements in them (type <code>[t b]</code>). (And, this part is not in the type, but: the way I will do this is by taking all possible combinations; for each position in the container, I'll try each possible <code>b</code>, and give you every which way of making one choice for each position in the container.)</li>\n</ul>\n\n<p>For example, if we were to define the function <code>f :: Int -&gt; [Char]</code> for which <code>f n</code> chose nondeterministically between the first <code>n</code> letters of the alphabet, then we could see this kind of interaction:</p>\n\n<pre><code>&gt; f 3\n\"abc\"\n&gt; f 5\n\"abcde\"\n&gt; f 2\n\"ab\"\n&gt; mapM f [3,5,2]\n[\"aaa\",\"aab\",\"aba\",\"abb\",\"aca\",\"acb\",\"ada\",\"adb\",\"aea\",\"aeb\",\"baa\",\"bab\",\"bba\",\"bbb\",\"bca\",\"bcb\",\"bda\",\"bdb\",\"bea\",\"beb\",\"caa\",\"cab\",\"cba\",\"cbb\",\"cca\",\"ccb\",\"cda\",\"cdb\",\"cea\",\"ceb\"]\n</code></pre>\n\n<p>In each result, the first letter is one of the first three in the alphabet (a, b, or c); the second is from the first five, and the third from the first two. What's more, we get every list which has this property.</p>\n\n<p>Now let's think about what that means for your code. You have written</p>\n\n<pre><code>mapM (dir &lt;/&gt;) lsfiles\n</code></pre>\n\n<p>and so what you will get back is a collection of lists. Each list in the collection will be exactly as long as <code>lsfiles</code> is. Let's focus on one of the lists in the collection; call it <code>cs</code>.</p>\n\n<p>The first element of <code>cs</code> will be drawn from <code>dir &lt;/&gt; filename</code>, where <code>filename</code> is the first element of <code>lsfiles</code>; that is, it will be one of the characters in <code>dir</code>, or a slash, or one of the characters in <code>filename</code>. The second element of <code>cs</code> will be similar: one of the characters of <code>dir</code>, or a slash, or one of the characters from the second filename in <code>lsfiles</code>. I guess you can see where this is going... there's an awful lot of possibilities here. =)</p>\n\n<blockquote>\n  <p>Also is it possible to compose the <code>listDirectory</code> do-arrow line with the <code>map (dir &lt;/&gt;)</code> that prepends the path, in one-line?</p>\n</blockquote>\n\n<p>Yes:</p>\n\n<pre><code>loadCtx dir = do\n    files &lt;- map (dir &lt;/&gt;) &lt;$&gt; listDirectory dir\n    putStrLn $ \"Files \" ++ show files\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1544822593, "creation_date": 1544822593, "answer_id": 53787053, "question_id": 53786788, "link": "https://stackoverflow.com/questions/53786788/mapm-on-io-produces-infinite-output/53787053#53787053", "title": "mapM on IO produces infinite output", "body": "<p>To complement Jorge's answer, here's an exponential blowup, demonstrated:</p>\n\n<pre><code>&gt; map (\"XY\" &lt;/&gt;) [\"a\",\"b\",\"c\"]\n[\"XY\\\\a\",\"XY\\\\b\",\"XY\\\\c\"]\n&gt; mapM (\"XY\" &lt;/&gt;) [\"a\",\"b\",\"c\"]\n[\"XXX\",\"XXY\",\"XX\\\\\",\"XXc\",\"XYX\",\"XYY\",\"XY\\\\\",\"XYc\",\"X\\\\X\",\"X\\\\Y\",\"X\\\\\\\\\",\n \"X\\\\c\",\"XbX\",\"XbY\",\"Xb\\\\\",\"Xbc\",\"YXX\",\"YXY\",\"YX\\\\\",\"YXc\",\"YYX\",\"YYY\",\"YY\\\\\",\"YYc\",\n \"Y\\\\X\",\"Y\\\\Y\",\"Y\\\\\\\\\",\"Y\\\\c\",\"YbX\",\"YbY\",\"Yb\\\\\",\"Ybc\",\"\\\\XX\",\"\\\\XY\",\"\\\\X\\\\\",\n \"\\\\Xc\",\"\\\\YX\",\"\\\\YY\",\"\\\\Y\\\\\",\"\\\\Yc\",\"\\\\\\\\X\",\"\\\\\\\\Y\",\"\\\\\\\\\\\\\",\"\\\\\\\\c\",\"\\\\bX\",\n \"\\\\bY\",\"\\\\b\\\\\",\"\\\\bc\",\"aXX\",\"aXY\",\"aX\\\\\",\"aXc\",\"aYX\",\"aYY\",\"aY\\\\\",\"aYc\",\"a\\\\X\",\n \"a\\\\Y\",\"a\\\\\\\\\",\"a\\\\c\",\"abX\",\"abY\",\"ab\\\\\",\"abc\"]\n</code></pre>\n\n<p>Indeed, <code>mapM = sequence . map</code>, and <code>sequence</code> in the list monad performs the cartesian product of a list-of-lists, <code>[\"XY\\\\a\",\"XY\\\\b\",\"XY\\\\c\"]</code> in this case, so we get 4*4*4 combinations. (Ouch!)</p>\n"}], "owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 53787015, "answer_count": 3, "score": 3, "last_activity_date": 1544822693, "creation_date": 1544821046, "question_id": 53786788, "link": "https://stackoverflow.com/questions/53786788/mapm-on-io-produces-infinite-output", "title": "mapM on IO produces infinite output", "body": "<p>This is a bizzare behavior, even for Haskell. Look at the code segments below:</p>\n\n<pre><code>import System.Directory\nimport System.FilePath\n\n-- This spins infinitely\nloadCtx :: FilePath -&gt; IO ()\nloadCtx dir = do\n    lsfiles &lt;- listDirectory dir\n    let files = mapM (dir &lt;/&gt;) lsfiles\n    putStrLn $ \"Files \" ++ show files\n\n-- This does what I'd expect, prepending the dir path to each file\nloadCtx dir = do\n    lsfiles &lt;- listDirectory dir\n    let files = map (dir &lt;/&gt;) lsfiles\n    putStrLn $ \"Files \" ++ show files\n</code></pre>\n\n<p>Both definitions are accepted from the typechecker but give completely\ndifferent behavior. What is the output of the first <code>mapM</code>? It looks like an infinite loop on reading some files. Also is it possible to compose the <code>listDirectory</code> do-arrow line with the <code>map (dir &lt;/&gt;)</code> that prepends the path, in one-line? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1544818847, "post_id": 53786339, "comment_id": 94424321, "body": "Looks like there&#39;s some help here: <a href=\"https://stackoverflow.com/q/9136421\">stackoverflow.com/q/9136421</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 4, "creation_date": 1544819271, "post_id": 53786339, "comment_id": 94424475, "body": "<code>(-&gt;)</code> isn&#39;t a value, so you can&#39;t ask for its type. However, you <i>can</i> ask for its kind <code>:k (-&gt;)</code> or just information about it <code>:i (-&gt;)</code>. <code>((-&gt;) Int)</code> means any function <i>from</i> the <code>Int</code> type - think about the analogous difference between <code>((&#47;) 2.0)</code> and <code>(&#47; 2.0)</code>."}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1544820675, "post_id": 53786339, "comment_id": 94424978, "body": "@Alec, indeed, thanks."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544821182, "post_id": 53786780, "comment_id": 94425178, "body": "It seems both <code>-&gt;</code> and <code>&lt;-</code> are reserved and cannot be (re)defined."}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1544821521, "post_id": 53786780, "comment_id": 94425310, "body": "Since <code>((-&gt;) Int) String</code> is a valid function <b>type</b>, <code>:t ((-&gt;) Int) String</code> should reply with something like <code>(Int -&gt; String)</code>, however it keeps failing. While <code>:k ((-&gt;) Int) String</code> spits out something unexpected: <code>*</code> - is it a placeholder meaning literally &quot;whatever might be&quot;?.."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 1, "creation_date": 1544821947, "post_id": 53786780, "comment_id": 94425471, "body": "@SerejaBogolubov You can only ask for the type of values, not of types. Types don&#39;t have types, they have kinds."}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1544822154, "post_id": 53786780, "comment_id": 94425547, "body": "@melpomene, oh, I got it now."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1544822784, "post_id": 53786780, "comment_id": 94425786, "body": "@SerejaBogolubov <code>*</code> is just the kind of regular types. <code>:k Int</code> is <code>*</code>, <code>:k Maybe</code> is <code>* -&gt; *</code>, <code>:k Either</code> is <code>* -&gt; * -&gt; *</code>. Note that <code>(-&gt;)</code> is both a type constructor and a kind constructor: <code>:k (-&gt;)</code> is <code>* -&gt; * -&gt; *</code>."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 6, "last_activity_date": 1544821285, "last_edit_date": 1544821285, "creation_date": 1544820989, "answer_id": 53786780, "question_id": 53786339, "link": "https://stackoverflow.com/questions/53786339/understanding-haskells/53786780#53786780", "title": "Understanding Haskell&#39;s (-&gt;)?", "body": "<p><code>-&gt;</code> is the type constructor for the types of functions. <code>f :: A -&gt; B</code> means \"<code>f</code> is a function from some type <code>A</code> to some type <code>B</code>\".</p>\n\n<p><code>:t (-&gt;)</code> is an error because <code>-&gt;</code> is not a value and does not have a type; it is a type (or rather type constructor). Similarly, <code>:t Maybe</code> and <code>:t Int</code> are errors.</p>\n\n<p>As with normal operators, infix application is syntactic sugar for (curried) prefix application; i.e. just as <code>x + y</code> can be written <code>(+) x y</code> or <code>((+) x) y</code>, so can <code>A -&gt; B</code> be written <code>(-&gt;) A B</code> or <code>((-&gt;) A) B</code>.</p>\n\n<p><code>((-&gt;) Int)</code> does not mean \"any function to the <code>Int</code> type\"; it's a type constructor for functions <em>from</em> <code>Int</code>. By itself it is not a valid type, but you can apply it to a type to get a valid function type; e.g. <code>((-&gt;) Int) String</code> is the type of functions from <code>Int</code> to <code>String</code>.</p>\n\n<p><code>(Int (-&gt;))</code> is a kind error; it tries to apply <code>Int</code> to <code>(-&gt;)</code>, but <code>Int</code> does not take any arguments.</p>\n\n<p><code>(-&gt;) e</code> is indeed a <code>Functor</code> for any type <code>e</code> (with <code>fmap = (.)</code>, i.e. function composition). It's also an <code>Applicative</code> and a <code>Monad</code> (it's equivalent to <a href=\"http://hackage.haskell.org/package/mtl-2.2.2/docs/Control-Monad-Reader.html#g:2\" rel=\"noreferrer\"><code>Reader</code></a>).</p>\n\n<p>All of this is standard Haskell syntax. No language extension is needed.</p>\n\n<p><code>&lt;-</code> does not exist at the type level. It is reserved syntax that can be used in expressions, e.g. in list comprehensions (<code>[ x * 2 | x &lt;- [0 ..] ]</code>) or <code>do</code> blocks (<code>do { x &lt;- p; return (x * 2) }</code>); it's also used in some other contexts, but not in types.</p>\n"}], "owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 53786780, "answer_count": 1, "score": 1, "last_activity_date": 1544821285, "creation_date": 1544818419, "question_id": 53786339, "link": "https://stackoverflow.com/questions/53786339/understanding-haskells", "title": "Understanding Haskell&#39;s (-&gt;)?", "body": "<p>Few times I saw <code>(-&gt;)</code> while learning \"advanced\" Haskell.\n<code>ghci</code> fails when I try to run <code>:t (-&gt;)</code>, thought sometimes even official documentation uses this notation.</p>\n\n<p>As far as I can <strong>guess</strong>, <code>(-&gt;)</code> is an <strong>any</strong> morphism in the <strong>Hask</strong> - basically, any Haskell function. I assume that the idea is to fix either source or target endpoint: for example, <code>((-&gt;) Int)</code> might mean any function to the <code>Int</code> type; obviously, <code>(Int (-&gt;))</code> means any function from the <code>Int</code>. </p>\n\n<p>Next assumption is that <code>(-&gt;)</code> might be an endofunctor. <code>fmap</code> implementation seems pretty trivial: having a fixed endpoint of type <code>a</code> and morphism <code>f :: a -&gt; b</code> one can produce an instance of the <code>((-&gt;) b)</code>. It preserves <code>id</code>and yet does not tear existing compositions: i.e. <code>fmap(g . f) = fmap(g) . fmap(f)</code>.</p>\n\n<p>So my <strong>first question</strong> is: am I right? </p>\n\n<p>My <strong>second question</strong> is why then <code>:t (-&gt;)</code> fails in the <code>ghci</code>?</p>\n\n<p>My <strong>thrid question</strong> is there a way I can use <code>(-&gt;)</code> in a real Haskell code? Do I need to enable some <code>{{ #Pragma ...</code> extension? Or it is just a theoretical notion used to explain concept and nothing more?</p>\n\n<p>And, finally, <strong>last question</strong>. Does dual notion <code>(&lt;-)</code> exist? </p>\n"}, {"tags": ["haskell", "linked-list", "monads", "writer"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 3, "creation_date": 1544816279, "post_id": 53785921, "comment_id": 94423309, "body": "Knock up a quick example and test it."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1544860242, "post_id": 53785921, "comment_id": 94432180, "body": "See also: <a href=\"https://stackoverflow.com/questions/39368619/what-is-complexity-of-control-monad-writer-for-w-a\" title=\"what is complexity of control monad writer for w a\">stackoverflow.com/questions/39368619/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1544825450, "last_edit_date": 1544825450, "creation_date": 1544824494, "answer_id": 53787383, "question_id": 53785921, "link": "https://stackoverflow.com/questions/53785921/how-efficient-is-the-writer-monad-for-lists/53787383#53787383", "title": "How efficient is the writer monad for lists?", "body": "<p>Left-associated <code>(++)</code>s are inefficient, because the left-most lists are traversed multiple times, once for each enclosing <code>(++)</code>. Right-associated <code>(++)</code> are fine (at least, they can't be made more efficient by using <code>(:)</code> directly).</p>\n\n<p>The standard <code>WriterT</code> transformer (and <code>(,)</code> writer) associate their calls to <code>(++)</code> in the same way their bindings are associated. So by extension of the previous discussion, left-associated <code>(&gt;&gt;=)</code>s will be problematic, while right-associated ones are fine. In particular, this means there is an <em>abstraction cost</em>. If, in a refactoring, one were to pull out the first two lines  of the do block below:</p>\n\n<pre><code>x = do\n    tell a\n    tell b\n    tell c\n</code></pre>\n\n<p>into a separate definition, perhaps because they happen often:</p>\n\n<pre><code>y = do\n    tell a\n    tell b\n\nx = do\n    y\n    tell c\n</code></pre>\n\n<p>This refactoring re-associates one binding to the left, and so costs slightly more.</p>\n\n<p>In case this worries you, you can choose a slightly different tradeoff by using the standard difference-list trick as your monoid. So:</p>\n\n<pre><code>do\n    tell (Endo ([a,b,c]++))\n    tell (Endo ([d]++))\n</code></pre>\n\n<p>This will magically re-associate your <code>(++)</code>s to the right (wow! blows my mind every time I re-figure out how that works). The cost is that each observation of the difference list (that is, conversion from difference list to standard list) is expensive (whereas with the previous choice of bare lists, multiple observations cost no more than one observation). If you have just one consumer -- say, a top-level call to <code>runWriterT</code> that flattens the list once and for all -- this is no problem asymptotically, but if you find yourself calling <code>listen</code> or <code>pass</code> and inspecting the difference list often, you may not want to choose this.</p>\n\n<p>If neither of these tradeoffs sounds good to you, a third choice would be to use finger-trees, e.g. <code>Seq</code>, for which observation is free (unlike difference lists) and concatenation on either end is log-time in the shorter argument (unlike standard lists, where it is linear in the first argument), but for which the constants are enough higher that you can notice it in many cases.</p>\n"}], "owner": {"reputation": 2197, "user_id": 1568890, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e1743a48fc43aeab957da6d5d53e36c5?s=128&d=identicon&r=PG", "display_name": "Calebmer", "link": "https://stackoverflow.com/users/1568890/calebmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 53787383, "answer_count": 1, "score": 3, "last_activity_date": 1544825450, "creation_date": 1544816223, "last_edit_date": 1544817292, "question_id": 53785921, "link": "https://stackoverflow.com/questions/53785921/how-efficient-is-the-writer-monad-for-lists", "title": "How efficient is the writer monad for lists?", "body": "<p>The implementation of the Haskell writer monad on lists (<code>Writer [w] a</code>) will use <code>++</code> to add items. So if I write this code in a list writer monad:</p>\n\n<pre><code>do\n  tell [a, b, c]\n  tell [d]\n</code></pre>\n\n<p>The lists will be appended with <code>[a, b, c] ++ [d]</code>. After working in OCaml, I\u2019ve internalized that lists should be built with a cons operator (<code>:</code>) instead of a concatenation operator (<code>++</code>) as the latter is O(n) in its first argument.</p>\n\n<p>My workload adds one \u201cmessage\u201d to the writer monad at a time so the second argument to <code>++</code> will usually be a singleton list.</p>\n\n<p>In Haskell will laziness make a list writer monad more efficient than in an eager language like OCaml? If not what would an efficient alternative be for my workload?</p>\n"}, {"tags": ["haskell", "monads", "do-notation"], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 3, "last_activity_date": 1544816765, "creation_date": 1544816765, "answer_id": 53786027, "question_id": 53785844, "link": "https://stackoverflow.com/questions/53785844/do-notation-and-bind-signature/53786027#53786027", "title": "do notation and bind signature", "body": "<p>I think the reason it's confusing is because you're working on this inside-out, by trying to think of the inner bind as producing a list of partially applied functions. It doesn't: <code>a</code> and <code>b</code> are closed over, not arguments waiting to be applied. Instead, start from the outside of the expression and work inwards:</p>\n\n<pre><code>[1, 2, 3] &gt;&gt;= \\a -&gt; (...)\n</code></pre>\n\n<p>For each item in the list, produce a list somehow, with access to <code>a</code> as a name for an item in the original list</p>\n\n<pre><code>... [4, 5, 6] &gt;&gt;= \\b -&gt; (...)\n</code></pre>\n\n<p>To produce the list needed by the previous step, produce a new list with access to both <code>a</code> and <code>b</code>, one from each of the two numbered lists.</p>\n\n<pre><code>... return $ b * 10 + a\n</code></pre>\n\n<p>To produce the list needed by the previous step, create a list of a single item, whose value is <code>b * 10 + a</code>.</p>\n\n<p>You ask why the type of <code>return $ b * 10 + a</code> is different from the type of <code>[40 + a, 50 + a, 60 + a]</code>, but they're not: both are of type <code>[Int]</code>. Neither involves any functions. Rather, they both are lists of numbers, constructed by referring to already-closed-over variables. And indeed <code>(&gt;&gt;=)</code> has exactly the type that it should: it takes a list of int, and a function for producing a list of int from a single int, and gives back a different list of int:</p>\n\n<pre><code>(&gt;&gt;=) :: [Int] -&gt; (Int -&gt; [Int]) -&gt; [Int]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1544816812, "creation_date": 1544816812, "answer_id": 53786038, "question_id": 53785844, "link": "https://stackoverflow.com/questions/53785844/do-notation-and-bind-signature/53786038#53786038", "title": "do notation and bind signature", "body": "<p>Keep in mind that <code>return x = [x]</code> and <code>xs &gt;&gt;= f = concatMap f xs</code> in the list monad. Thus</p>\n\n<pre><code>[1, 2, 3] &gt;&gt;= \\a -&gt; \n      ([4, 5, 6] &gt;&gt;= \\b -&gt; \n                 return $ b * 10 + a)\n</code></pre>\n\n<p>turns into</p>\n\n<pre><code>concatMap (\\a -&gt; (concatMap (\\b -&gt; [b*10+a]) [4,5,6])) [1,2,3]\n</code></pre>\n\n<p>which becomes (with <code>a</code> as a free variable in the function of <code>b</code>)</p>\n\n<pre><code>concatMap (\\a -&gt; [4*10+a, 5*10+a, 6*10+a]) [1,2,3]\n</code></pre>\n\n<p>There are no partially applied functions, just a single function that returns a list value using its argument 3 different times. This then reduces to</p>\n\n<pre><code>[4*10+1, 5*10+1, 6*10+1, 4*10+2, 5*10+2, 6*10+2, 4*10+3, 5*10+3, 6*10+3]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>[41,51,61,42,52,62,43,53,63]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 2, "last_activity_date": 1544858433, "creation_date": 1544858433, "answer_id": 53790405, "question_id": 53785844, "link": "https://stackoverflow.com/questions/53785844/do-notation-and-bind-signature/53790405#53790405", "title": "do notation and bind signature", "body": "<p>Here\u2019s how it desugars and works operationally. You\u2019re right that this:</p>\n\n<pre><code>do\n  a &lt;- [1, 2, 3]\n  b &lt;- [4, 5, 6]\n  return $ a * 10 + b\n</code></pre>\n\n<p>Desugars to this:</p>\n\n<pre><code>[1, 2, 3] &gt;&gt;= \\a -&gt; \n  [4, 5, 6] &gt;&gt;= \\b -&gt; \n    return $ b * 10 + a\n</code></pre>\n\n<p>Which in turn is using the list instance of <code>Monad</code>, whose definitions of <code>&gt;&gt;=</code> and <code>return</code> (or <code>pure</code>) we can inline:</p>\n\n<pre><code>concatMap\n  (\\a -&gt; concatMap\n    (\\b -&gt; [b * 10 + a])\n    [4, 5, 6])\n  [1, 2, 3]\n</code></pre>\n\n<p>We can break apart <code>concatMap</code> into <code>concat</code> and <code>map</code>:</p>\n\n<pre><code>concat\n  (map\n    (\\a -&gt; concat\n      (map\n        (\\b -&gt; [b * 10 + a])\n        [4, 5, 6]))\n    [1, 2, 3])\n</code></pre>\n\n<p>Now we can reduce this, and here I think is where you were encountering difficulty: reduction happens from the outside in, and doesn\u2019t produce partially applied functions in this case; rather, it <em>captures</em> <code>a</code> in the closure of the inner lambda <code>(\\b -&gt; \u2026)</code>. First, we map <code>(\\a -&gt; \u2026)</code> over <code>[1, 2, 3]</code>:</p>\n\n<pre><code>concat\n  [ (\\a -&gt; concat\n      (map\n        (\\b -&gt; [b * 10 + a])\n        [4, 5, 6])) 1\n  , (\\a -&gt; concat\n      (map\n        (\\b -&gt; [b * 10 + a])\n        [4, 5, 6])) 2\n  , (\\a -&gt; concat\n      (map\n        (\\b -&gt; [b * 10 + a])\n        [4, 5, 6])) 3\n  ]\n\n==\n\nconcat\n  [ let a = 1\n    in concat\n      (map\n        (\\b -&gt; [b * 10 + a])\n        [4, 5, 6])\n  , let a = 2\n    in concat\n      (map\n        (\\b -&gt; [b * 10 + a])\n        [4, 5, 6])\n  , let a = 3\n    in concat\n      (map\n        (\\b -&gt; [b * 10 + a])\n        [4, 5, 6])\n  ]\n</code></pre>\n\n<p>Then we can reduce the inner <code>map</code>s:</p>\n\n<pre><code>concat\n  [ let a = 1\n    in concat\n      [ (\\b -&gt; [b * 10 + a]) 4\n      , (\\b -&gt; [b * 10 + a]) 5\n      , (\\b -&gt; [b * 10 + a]) 6\n      ]\n  , let a = 2\n    in concat\n      [ (\\b -&gt; [b * 10 + a]) 4\n      , (\\b -&gt; [b * 10 + a]) 5\n      , (\\b -&gt; [b * 10 + a]) 6\n      ]\n  , let a = 3\n    in concat\n      [ (\\b -&gt; [b * 10 + a]) 4\n      , (\\b -&gt; [b * 10 + a]) 5\n      , (\\b -&gt; [b * 10 + a]) 6\n      ]\n  ]\n\n==\n\nconcat\n  [ let a = 1\n    in concat\n      [ let b = 4 in [b * 10 + a]\n      , let b = 5 in [b * 10 + a]\n      , let b = 6 in [b * 10 + a]\n      ]\n  , let a = 2\n    in concat\n      [ let b = 4 in [b * 10 + a]\n      , let b = 5 in [b * 10 + a]\n      , let b = 6 in [b * 10 + a]\n      ]\n  , let a = 3\n    in concat\n      [ let b = 4 in [b * 10 + a]\n      , let b = 5 in [b * 10 + a]\n      , let b = 6 in [b * 10 + a]\n      ]\n  ]\n</code></pre>\n\n<p>Which we can then simplify by replacing variables with their values:</p>\n\n<pre><code>concat\n  [ concat\n    [ [4 * 10 + 1]\n    , [5 * 10 + 1]\n    , [6 * 10 + 1]\n    ]\n  , concat\n    [ [4 * 10 + 2]\n    , [5 * 10 + 2]\n    , [6 * 10 + 2]\n    ]\n  , concat\n    [ [4 * 10 + 3]\n    , [5 * 10 + 3]\n    , [6 * 10 + 3]\n    ]\n  ]\n</code></pre>\n\n<p>And reducing the calls to <code>concat</code>:</p>\n\n<pre><code>concat\n  [ [ 4 * 10 + 1\n    , 5 * 10 + 1\n    , 6 * 10 + 1\n    ]\n  , [ 4 * 10 + 2\n    , 5 * 10 + 2\n    , 6 * 10 + 2\n    ]\n  , [ 4 * 10 + 3\n    , 5 * 10 + 3\n    , 6 * 10 + 3\n    ]\n  ]\n\n==\n\n[ 4 * 10 + 1\n, 5 * 10 + 1\n, 6 * 10 + 1\n, 4 * 10 + 2\n, 5 * 10 + 2\n, 6 * 10 + 2\n, 4 * 10 + 3\n, 5 * 10 + 3\n, 6 * 10 + 3\n]\n</code></pre>\n\n<p>And of course the individual expressions:</p>\n\n<pre><code>[ 41, 51, 61\n, 42, 52, 62\n, 43, 53, 63\n]\n</code></pre>\n\n<p>A case where you <em>will</em> see a list of partially applied functions is when using the <code>Applicative</code> instance of lists, for example, the equivalent to your code:</p>\n\n<pre><code>(\\a b -&gt; b * 10 + a) &lt;$&gt; [1, 2, 3] &lt;*&gt; [4, 5, 6]\n</code></pre>\n\n<p>The definition of <code>&lt;$&gt;</code>/<code>fmap</code> for lists is just <code>map</code>, so we partially apply the first argument of the lambda, producing a list of type <code>[Int -&gt; Int]</code>, then <code>(&lt;*&gt;) :: (Applicative f) =&gt; f (a -&gt; b) -&gt; f a -&gt; f b</code>, here at type <code>[Int -&gt; Int] -&gt; [Int] -&gt; [Int]</code>, applies each function in its left operand to each value in its right operand.</p>\n"}], "owner": {"reputation": 479, "user_id": 9903901, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "jack malkovick", "link": "https://stackoverflow.com/users/9903901/jack-malkovick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 53790405, "answer_count": 3, "score": 6, "last_activity_date": 1550588120, "creation_date": 1544815812, "last_edit_date": 1550588120, "question_id": 53785844, "link": "https://stackoverflow.com/questions/53785844/do-notation-and-bind-signature", "title": "do notation and bind signature", "body": "<p>I'm new to Haskell and functional programming and I was wondering why an example like this (the \"nested loop\") works:</p>\n\n<pre><code>do\n  a &lt;- [1, 2, 3]\n  b &lt;- [4, 5, 6]\n  return $ a * 10 + b\n</code></pre>\n\n<p>Some of the stuff below is kind of pseudo-Haskell syntax, but I hope it illustrates my understanding.</p>\n\n<p><strong>It's my understanding that it's turned into something like this</strong></p>\n\n<pre><code>[1, 2, 3] &gt;&gt;= \\a -&gt; \n          ([4, 5, 6] &gt;&gt;= \\b -&gt; \n                     return $ b * 10 + a)\n</code></pre>\n\n<p><strong>I think this expression</strong></p>\n\n<pre><code>[4, 5, 6] &gt;&gt;= \\b -&gt; return $ b * 10 + a\n</code></pre>\n\n<p><strong>Produces a list of partially applied functions</strong></p>\n\n<pre><code>[[40 + a], [50 + a], [60 + a]]\n</code></pre>\n\n<p><strong>Concatenated to</strong></p>\n\n<pre><code>[40 + a, 50 + a, 60 + a]\n</code></pre>\n\n<p><strong>For the last step, something looks like this</strong></p>\n\n<pre><code>[1, 2, 3] &gt;&gt;= \\a -&gt; [40 + a, 50 + a, 60 + a]\n</code></pre>\n\n<p><strong>Becomes</strong></p>\n\n<pre><code>[41, 51, 61, 42, 52, ... ]\n</code></pre>\n\n<p>My dilemma is because the type of <code>return $ b * 10 + a</code> seems to be different from the type of <code>[40 + a, 50 + a, 60 + a]</code>.</p>\n\n<p><strong>Shouldn't the bind signature be like this?</strong></p>\n\n<pre><code> (&gt;&gt;=)  :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p><strong>In this example seems to be like</strong> </p>\n\n<pre><code>[int] -&gt; (int -&gt; [int -&gt; int -&gt; int]) -&gt; [int -&gt; int]\n</code></pre>\n\n<p><strong>And</strong> </p>\n\n<pre><code>[int] -&gt; (int -&gt; [int -&gt; int]) -&gt; [int]\n</code></pre>\n"}, {"tags": ["haskell", "text", "lazy-sequences"], "comments": [{"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "edited": false, "score": 2, "creation_date": 1544810380, "post_id": 53784627, "comment_id": 94420956, "body": "I suppose, with <code>Data.Text.Lazy</code> I can&#39;t ever be sure how input is chunked and it may succeed for some streams and fail for others depending entirely on how it&#39;s chunked and regardless of the individual characters in the stream. So perhaps, as far as generalised tests go, it isn&#39;t a very good test after all."}, {"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 1, "creation_date": 1544812614, "post_id": 53784627, "comment_id": 94421846, "body": "The way that you&#39;ve described the test, you are actually testing <code>fromString</code> rather than your predicate. Your original signature is <code>p :: IsString s =&gt; s -&gt; Bool</code>, but you have separate implementations for <code>String</code> and <code>Text</code>?"}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "reply_to_user": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1544814044, "post_id": 53784627, "comment_id": 94422430, "body": "@BobDalgleish: Thank you for pointing that out. I have separate implementations and one test suite, yes. I suppose I&#39;ll just have to succumb to the fact that I can&#39;t have a polymorphic test suite that lets me control how any particular <code>IsString s =&gt; s</code> is chunked. So I&#39;ll have to test each implementation separately."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544816179, "post_id": 53784627, "comment_id": 94423271, "body": "I don&#39;t know if this is relevant, but note that <code>length (&quot;foo&quot; ++ [undefined]) == 4</code> while <code>length (&quot;foo&quot; ++ undefined) == undefined</code>. The <code>(T.fromChunks [ &quot;foo&quot;, undefined ])</code> seems more similar to the latter than to the former."}, {"owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544818696, "post_id": 53784627, "comment_id": 94424259, "body": "@chi: Thanks; I meant to go with <code>T.fromChunks [ &quot;foo&quot;, undefined ]</code>, but somehow tried both in the process."}], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1544810472, "creation_date": 1544809885, "last_edit_date": 1544810472, "question_id": 53784627, "link": "https://stackoverflow.com/questions/53784627/testing-laziness-of-isstring-s-s-bool-function", "title": "Testing laziness of IsString s =&gt; s -&gt; Bool function", "body": "<p>Is there any way I can test that a function <code>p :: IsString s =&gt; s -&gt; Bool</code> evaluates its input lazily? That is, it only consumes a part of its input when determining its result. And is it possible in such a way that it's compatible with both <code>String</code> and <code>Data.Text.Lazy</code>?</p>\n\n<p>I've looked at the Q&amp;A <a href=\"https://stackoverflow.com/questions/41151927/unit-testing-the-undefined-evaluated-in-lazy-expression-in-haskell\">Unit-testing the undefined evaluated in lazy expression in Haskell</a>, which doesn't cover <code>IsString</code> specifically, and I've found the <a href=\"http://hackage.haskell.org/package/StrictCheck\" rel=\"nofollow noreferrer\">StrictCheck</a> package on Hackage that I'm not really sure how works. Does it apply here?</p>\n\n<h2>Problem</h2>\n\n<p>I've got a predicate,</p>\n\n<pre><code>p :: IsString s =&gt; s -&gt; Bool\n</code></pre>\n\n<p>and an Hspec test,</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\n...\nimport Data.String (fromString)\n\nspec_p :: Spec\nspec_p =\n  describe \"p\" $\n    it \"is lazy\" $ p (fromString x) `shouldBe` y\n      where\n        x = \"foo\" ++ [undefined]\n        y = True\n</code></pre>\n\n<p>that fails if <code>p (\"foo\" ++ [undefined])</code> tries to consume any more than <code>\"foo\"</code>.</p>\n\n<p>This works fine for my <code>String</code> implementation,</p>\n\n<pre><code>import qualified Data.List as L\n\np :: String -&gt; Bool\np = (\"foo\" `L.isPrefixOf`)\n</code></pre>\n\n<p>But it does not work so fine on my <code>Data.Text.Lazy</code> implementation,</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport qualified Data.Text.Lazy as T\nimport           Data.Text.Lazy (Text)\n\np :: Text -&gt; Bool\np = (\"foo\" `T.isPrefixOf`)\n</code></pre>\n\n<p>because <code>fromString</code> does not convert the lazy <code>String</code> into a lazy <code>Text</code> in a way that preserves the <code>undefined</code> unevaluated. I can test that the lazy version does work by writing a specialized test,</p>\n\n<pre><code>pTest :: Bool\npTest = p (T.fromChunks [ \"foo\", undefined ]) -- True\n</code></pre>\n\n<p>but I can't control how <code>fromString</code> chunks.</p>\n\n<hr>\n\n<h2>Attempted solution:</h2>\n\n<p>I tried to write my own wrapper to control the chunking of <code>fromString</code>,</p>\n\n<pre><code>import qualified Data.Text      as T\nimport qualified Data.Text.Lazy as LT\n\nnewtype LazyChunkyText = LazyChunkyText LT.Text deriving (Show)\ninstance IsString LazyChunkyText where\n  fromString = LazyChunkyText . LT.fromChunks . map (T.pack . return)\n</code></pre>\n\n<p>But because <code>fromChunks</code> takes a <code>[T.Text]</code>, I need to <code>T.pack</code>.</p>\n\n<p>Meaning my <code>[undefined]</code> gets evaluated.</p>\n"}, {"tags": ["haskell", "type-families", "forall"], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 3, "last_activity_date": 1544808244, "creation_date": 1544808244, "answer_id": 53784307, "question_id": 53782842, "link": "https://stackoverflow.com/questions/53782842/why-does-forall-a-j-b-k-work-differently-than-forall-p-j-k/53784307#53784307", "title": "Why does `forall (a :: j) (b:: k)` work differently than `forall (p :: (j,k))`?", "body": "<p>The reason is simply that there is no eta-conversion checking on the type-level. To begin with, there is no mechanism for distinguishing <code>data</code> definitions from single-constructor records/products which possibly have eta laws. I don't think <code>p</code> possibly being <code>\u22a5</code> is a valid reason for this. Even in partial lazy languages, eta equality for pairs holds (w.r.t. observational equivalence).</p>\n"}, {"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1544808600, "post_id": 53784331, "comment_id": 94420192, "body": "<code>Any</code> should not be an issue. If GHC translated matching on type-level records to primitive projections, as in Agda/Coq, then <code>Any</code> would be indistinguishable from <code>(Fst Any, Snd Any)</code>, validating an eta rule."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1544809146, "post_id": 53784331, "comment_id": 94420419, "body": "@Andr&#225;sKov&#225;cs, ah I see what you mean. I think <code>Any</code> is still relevant as it poses a problem for coproducts -- or e.g. if <code>(,)</code> were defined as a <code>data</code> type in Agda instead of a <code>record</code>."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1544809434, "post_id": 53784331, "comment_id": 94420529, "body": "yeah, I meant it&#39;s not a problem in this case, but I think it&#39;s also not really a problem for coproducts, because although <code>Any</code> invalidates coproduct eta, type checkers pretty much never check for coproduct eta anyway. (But I also think getting rid of Any would be good)."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1544810224, "post_id": 53784331, "comment_id": 94420887, "body": "@Andr&#225;sKov&#225;cs, yes but in Agda, with no type-level bottoms (or any bottoms) there is at least the possibility of pattern matching so that you can convince your definition to pass.  Not so in Haskell.  But the more we talk the less relevant to this precise question my comment seems, and it&#39;s just a general grievance of mine.  :-p"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 3, "last_activity_date": 1544808364, "creation_date": 1544808364, "answer_id": 53784331, "question_id": 53782842, "link": "https://stackoverflow.com/questions/53782842/why-does-forall-a-j-b-k-work-differently-than-forall-p-j-k/53784331#53784331", "title": "Why does `forall (a :: j) (b:: k)` work differently than `forall (p :: (j,k))`?", "body": "<blockquote>\n  <p>Is the problem that <code>p</code> might be <code>\u22a5</code>?</p>\n</blockquote>\n\n<p>More or less.  Unfortunately, all kinds are inhabited by the empty type family.</p>\n\n<pre><code>type family Any :: k\n</code></pre>\n\n<p>Which frustrates any theory which would allow what you are trying to do.  I think it really needs to be fixed; I'm not sure if there are any plans to do so, however.</p>\n"}], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 4, "answer_count": 2, "score": 12, "last_activity_date": 1544808364, "creation_date": 1544802201, "last_edit_date": 1544803177, "question_id": 53782842, "link": "https://stackoverflow.com/questions/53782842/why-does-forall-a-j-b-k-work-differently-than-forall-p-j-k", "title": "Why does `forall (a :: j) (b:: k)` work differently than `forall (p :: (j,k))`?", "body": "<p>I'm trying to understand the difference between using <code>forall</code> to quantify two type variables and using <code>forall</code> to quantify a single type variable of tuple kind.</p>\n\n<p>For example, given the following type families:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE DataKinds #-}\n\ntype family Fst (p :: (a,b)) :: a where\n  Fst '(a,_) = a\ntype family Snd (p :: (a,b)) :: b where\n  Snd '(_,b) = b\ntype family Pair (p :: (Type,Type)) :: Type where\n  Pair '(a,b) = (a,b)\n</code></pre>\n\n<p>I can define an identity on pairs using two type variables, and get it to compile on GHC 8.0.1:</p>\n\n<pre><code>ex0 :: forall (a :: Type) (b :: Type). Pair '(a,b) -&gt; (Fst '(a,b), Snd '(a,b))\nex0 = id\n</code></pre>\n\n<p>The same definition doesn't compile if I use a single type variable of tuple kind, however:</p>\n\n<pre><code>ex1 :: forall (p :: (Type,Type)). Pair p -&gt; (Fst p, Snd p)\nex1 = id\n-- Ex.hs:20:7: error:\n--     \u2022 Couldn't match type \u2018Pair p\u2019 with \u2018(Fst p, Snd p)\u2019\n--       Expected type: Pair p -&gt; (Fst p, Snd p)\n--         Actual type: (Fst p, Snd p) -&gt; (Fst p, Snd p)\n--     \u2022 In the expression: id\n--       In an equation for \u2018ex1\u2019: ex1 = id\n--     \u2022 Relevant bindings include\n--         ex1 :: Pair p -&gt; (Fst p, Snd p) (bound at Ex.hs:20:1)\n</code></pre>\n\n<p>Is the problem that <code>p</code> might be <code>\u22a5</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "edited": false, "score": 4, "creation_date": 1544800820, "post_id": 53782278, "comment_id": 94416312, "body": "From looking at the tasty-hunit documentation, <code>Assertion</code> is a type synonym for <code>IO ()</code>. Meaning you should not have any problem performing impure actions inside of your test. Have you actually tried doing it?"}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "edited": false, "score": 0, "creation_date": 1544800891, "post_id": 53782278, "comment_id": 94416341, "body": "Oh, true! Yes, passed. That&#39;s right answer"}, {"owner": {"reputation": 60, "user_id": 9558665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12207c900feea196895fb476e2160bfd?s=128&d=identicon&r=PG&f=1", "display_name": "RecurringError", "link": "https://stackoverflow.com/users/9558665/recurringerror"}, "edited": false, "score": 0, "creation_date": 1545429400, "post_id": 53782278, "comment_id": 94629283, "body": "close question OR Erik should make his answer a real answer and mark it as the correct answer."}, {"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "reply_to_user": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "edited": false, "score": 0, "creation_date": 1545459823, "post_id": 53782278, "comment_id": 94633354, "body": "@Erik ? (your comment was right)"}], "answers": [{"tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": true, "score": 1, "last_activity_date": 1545605665, "creation_date": 1545605665, "answer_id": 53907770, "question_id": 53782278, "link": "https://stackoverflow.com/questions/53782278/how-to-do-io-in-tasty-test/53907770#53907770", "title": "How to do IO in tasty test?", "body": "<p>According to the <a href=\"http://hackage.haskell.org/package/tasty-hunit-0.10.0.1/docs/Test-Tasty-HUnit.html\" rel=\"nofollow noreferrer\">tasty-hunit documentation</a>, <code>Assertion</code> is a type synonym for <code>IO ()</code>. </p>\n\n<pre><code>type Assertion = IO ()\n</code></pre>\n\n<p>This means that you can make your API call inside the test without issue.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 53907770, "answer_count": 1, "score": -1, "last_activity_date": 1545605665, "creation_date": 1544800118, "question_id": 53782278, "link": "https://stackoverflow.com/questions/53782278/how-to-do-io-in-tasty-test", "title": "How to do IO in tasty test?", "body": "<p><a href=\"https://hackage.haskell.org/package/tasty-0.5.1\" rel=\"nofollow noreferrer\">Tasty</a> supports resources, so I can acquire resource, test some data related to this resource (purely) and to release the resource. But how to do some IO actions in my test function?</p>\n\n<p>This is the example from the documentation:</p>\n\n<pre><code>import Test.Tasty\nimport Test.Tasty.HUnit\n\n-- assumed defintions\ndata Foo\nacquire :: IO Foo\nrelease :: Foo -&gt; IO ()\ntestWithFoo :: Foo -&gt; Assertion\n(acquire, release, testWithFoo) = undefined\n\nmain = do\n  defaultMain $\n    withResource acquire release tests\n\ntests :: IO Foo -&gt; TestTree\ntests getResource =\n  testGroup \"Tests\"\n    [ testCase \"x\" $ getResource &gt;&gt;= testWithFoo\n    ]\n</code></pre>\n\n<p>So my resource is some connection (like socket). And I need to make API call in the <code>testWithFoo</code>, so it can not return just <code>Assertion</code> but it must be in <code>IO</code>. How to do it? Or tasty support only pure tests?</p>\n"}, {"tags": ["haskell", "tree"], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 6838782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356f31873735c15aaa2421c68c5a2df1?s=128&d=identicon&r=PG", "display_name": "Dortmunder", "link": "https://stackoverflow.com/users/6838782/dortmunder"}, "edited": false, "score": 0, "creation_date": 1544790381, "post_id": 53779183, "comment_id": 94410585, "body": "Oh yes, of course. Got a little confused about  size and sum `:-) . Thank you very much! I think i understood it!"}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 2, "last_activity_date": 1544788447, "last_edit_date": 1544788447, "creation_date": 1544788075, "answer_id": 53779183, "question_id": 53778957, "link": "https://stackoverflow.com/questions/53778957/haskell-binarytree-signatur-termalalgebra-calculate-size/53779183#53779183", "title": "haskell BinaryTree signatur termalalgebra calculate size", "body": "<p>You want your <code>fork</code> to be this:</p>\n\n<pre><code>fork = \\a left right -&gt; 1 + left + right\n</code></pre>\n\n<p>There were two problems with your version. First you are calculating size, not adding up the elements of the tree. So you do not want to add that <code>a</code>, it might not even be something you can add at all. </p>\n\n<pre><code> fork = \\a left right -&gt; a+sizeBintree left+sizeBintree right\n                         ^\n</code></pre>\n\n<p>Secondly look at the type of fork, </p>\n\n<pre><code> fork :: a -&gt; val -&gt; val -&gt; val\n</code></pre>\n\n<p>it takes an element of the tree, then two values (not trees!) and returns another value. Those two values are going to be the results for the folding of the left and right subtrees.</p>\n\n<pre><code> fork = \\a left right -&gt; a+sizeBintree left+sizeBintree right\n                           ^^^^^^^^^^^^^^^    ^^^^^^^^^^^^^\n</code></pre>\n\n<p>Note fork isn't supposed to perform any recursion. The recursion scheme is defined by <code>foldBin</code>.</p>\n"}], "owner": {"reputation": 147, "user_id": 6838782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356f31873735c15aaa2421c68c5a2df1?s=128&d=identicon&r=PG", "display_name": "Dortmunder", "link": "https://stackoverflow.com/users/6838782/dortmunder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 53779183, "answer_count": 1, "score": 3, "last_activity_date": 1544788447, "creation_date": 1544787202, "question_id": 53778957, "link": "https://stackoverflow.com/questions/53778957/haskell-binarytree-signatur-termalalgebra-calculate-size", "title": "haskell BinaryTree signatur termalalgebra calculate size", "body": "<p>I need to write a function in haskell that calculates the size of the binary Tree. I have an attemp, but don't get what the error message tells me or whats wrong.</p>\n\n<p>My attemp:</p>\n\n<pre><code>sizeBintree :: Bintree a -&gt; Int \nsizeBintree  = foldBin $ BinSig {empty_ = 0, \n                              fork = \\a left right -&gt; a+sizeBintree left+sizeBintree right}\n</code></pre>\n\n<p>the relevant definitions:</p>\n\n<pre><code>data Bintree a = Empty | Fork a (Bintree a) (Bintree a)\n\ndata BinSig a val = BinSig {empty_ :: val,\n                            fork :: a -&gt; val -&gt; val -&gt; val}\nfoldBin:: BinSig a val -&gt; Bintree a -&gt; val\nfoldBin alg Empty = empty_ alg\nfoldBin alg (Fork a left right) = fork alg a (foldBin alg left)\n                                             (foldBin alg right)\n</code></pre>\n\n<p>the error message:</p>\n\n<pre><code>Couldn't match expected type 'Bintree a0' with actual type 'Int' \nIn the expression: a+sizeBintree left+sizeBintree right \nIn the 'fork'    field of a record \nIn the second argument of '($)', namely 'BinSig {empty_ = 0,fork = \\a left right -&gt; a+sizeBintree left+sizeBintree right}' \nrelevant bindings include \nright::Bintree a0 \nleft:: Bintree a0\n</code></pre>\n"}, {"tags": ["haskell", "category-abstractions", "profunctor"], "answers": [{"comments": [{"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 0, "creation_date": 1562118193, "post_id": 53779654, "comment_id": 100273218, "body": "If <code>f</code>, <code>g</code> and <code>a</code> are linear, isn&#39;t <code>dimap f g a</code> also linear?"}, {"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 0, "creation_date": 1562118559, "post_id": 53779654, "comment_id": 100273279, "body": "To put this another way, isn&#39;t <code>LinearMap</code> a functor from the product category of finite dimensional vector spaces with its own opposite to <code>Set</code> (i.e. a profunctor)?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 0, "creation_date": 1562143608, "post_id": 53779654, "comment_id": 100281373, "body": "@AsadSaeeduddin \u201c<code>f</code>, <code>g</code>, <code>a</code> linear \u21d2 <code>dimap f g a</code> linear\u201d \u2013 sure, that works for any category but it doesn&#39;t give you anything new: this is just composition <code>f . a . g</code>. You <i>can</i> see every category as a profunctor from... the category itself, but that feels silly and frankly rather like circular reasoning. But maybe I&#39;m missing your point; what do you think is the advantage of this point of view?"}, {"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 0, "creation_date": 1562167570, "post_id": 53779654, "comment_id": 100295461, "body": "I don&#39;t think this is true for all categories, only ones where the hom classes are sets; i.e. locally small categories. It may seem like circular reasoning, but the hom functor really is a profunctor in such categories. As far as the utility goes, i think the ubiquity of this concept (and similar &quot;trivial&quot; concepts like the joker and clown profunctors) is good news for us, because it allows us to exploit abstractions like profunctor optics in other categories."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1544789974, "creation_date": 1544789974, "answer_id": 53779654, "question_id": 53777851, "link": "https://stackoverflow.com/questions/53777851/examples-of-cartesian-profunctor/53779654#53779654", "title": "Examples of Cartesian (Profunctor)?", "body": "<p><em>Attention, Opinions Ahead!</em></p>\n\n<p>Profunctors are a bit of an over-buzzed abstraction. IMO we should foremostly be talking about <em>categories</em>; in practice most profunctors are categories, but not vice versa. The profunctor class may have valid uses, but it's actually much more limited and tied to the <strong>Hask</strong> category. I prefer making that explicit, by talking about categories whose arrow constructors are <strong>Hask</strong>-functors in the last argument and contravariant <strong>Hask</strong>-functors in the p\u00e6nultimate argument. Yup, that's a mouthful, but that's the point: this is actually a pretty specific situation, and often it turns out you really need only a less specific category.<br>\n Concretely, <code>Cartesian</code> is more naturally considered as a class of categories, not of profunctors:</p>\n\n<pre><code>class Category k =&gt; Cartesian k where\n  swap :: k (a,b) (b,a)\n  (***) :: k a b -&gt; k a' b' -&gt; k (a,a') (b,b')\n</code></pre>\n\n<p>Which permits</p>\n\n<pre><code>first :: Cartesian k =&gt; k a b -&gt; k (a,c) (b,c)\nfirst f = f *** id\nsecond :: Cartesian k =&gt; k a b -&gt; k (c,a) (c,b)\nsecond f = id *** f\n</code></pre>\n\n<p>this being the <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Control-Category.html#v:id\" rel=\"noreferrer\">category-agnostic <code>id</code></a>. (You can also define <code>***</code> and <code>second</code> in terms of <code>first</code>, with <code>second f=swap.first f.swap</code> and <code>f***g=first f.second g</code>, but that's inelegantly entangled IMO.)</p>\n\n<p>To see why I prefer going this way, rather than with profunctors, I like to give a simple example that is <em>not</em> a profunctor: linear mappings.</p>\n\n<pre><code>newtype LinearMap v w = LinearMap {\n  runLinearMap :: v-&gt;w  -- must be linear, i.e. if v and w are finite-dimensional\n                        -- vector spaces, the function can be written as matrix application.\n }\n</code></pre>\n\n<p>This is <strong>not</strong> a profunctor: although you could, with this particular implementation, write <code>dimag f g (LinearMap a) = LinearMap $ dimap f g a</code>, this would not preserve linearity. It is however a cartesian category:</p>\n\n<pre><code>instance Category LinearMap where\n  id = LinearMap id\n  LinearMap f . LinearMap g = LinearMap $ f . g\ninstance Cartesian LinearMap where\n  swap = LinearMap swap\n  LinearMap f *** LinearMap g = LinearMap $ f *** g\n</code></pre>\n\n<p>Ok, that looks pretty trivial. Why is this interesting? Well, linear mappings can be efficiently stored as matrices, but conceptually, they are foremostly <em>functions</em>. As such it makes sense to handle them similarly to functions; in this case, <code>.</code> effectively implements matrix multiplication and <code>***</code> puts together a <a href=\"https://en.wikipedia.org/wiki/Block_matrix#Block_diagonal_matrices\" rel=\"noreferrer\">block diagonal matrix</a>, all in a type-safe manner.</p>\n\n<p>Obviously, you can do all of that with unrestricted functions as well, so <code>instance Cartesian (-&gt;)</code> really is trivial. But I gave the linear-map example to motivate that the <code>Cartesian</code> class can do stuff that isn't necessary trivial to do without it.</p>\n\n<p><code>Star</code> is where it gets really interesting.</p>\n\n<pre><code>newtype Star f d c = Star{runStar :: d-&gt;f c}\ninstance Monad f =&gt; Category (Star f) where\n  id = Star pure\n  Star f . Star g = Star $ \\x -&gt; f =&lt;&lt; g x\ninstance Monad f =&gt; Cartesian (Star f) where\n  swap = Star $ pure . swap\n  Star f *** Star g = Star $ \\(a,b) -&gt; liftA2 (,) (f a) (g b)\n</code></pre>\n\n<p><code>Star</code> is the precursor to the <a href=\"https://en.wikipedia.org/wiki/Kleisli_category\" rel=\"noreferrer\">kleisli category</a>, which as you may have heard is one way to use chaining of monadic computations. So let's go right to an <code>IO</code> example:</p>\n\n<pre><code>readFile' :: Star IO FilePath String\nreadFile' = Star readFile\n\nwriteFile' :: Star IO (FilePath,String) ()\nwriteFile' = Star $ uncurry writeFile\n</code></pre>\n\n<p>Now I can do something like</p>\n\n<pre><code>copyTo :: Star IO (FilePath, FilePath) ()\ncopyTo = writeFile' . second readFile'\n</code></pre>\n\n<p>Why would I do it this way? The point is that I've chained together IO actions without using an interface that has any way to peek/modify the <em>data</em> that's passed around. This could be interesting for security applications. (I just made up this example; I'm sure less contrived ones could be found.)</p>\n\n<p>Anyways I haven't really answered the question so far, because you're not asking about cartesian categories but about <a href=\"https://hackage.haskell.org/package/profunctors-5.3/docs/Data-Profunctor.html#t:Strong\" rel=\"noreferrer\">strong profunctors</a>. Those do offer almost the same interface though:</p>\n\n<pre><code>class Profunctor p =&gt; Strong p where\n  first' :: p a b -&gt; p (a, c) (b, c)\n  second' :: p a b -&gt; p (c, a) (c, b)\n</code></pre>\n\n<p>and thus I could as well make the minute change</p>\n\n<pre><code>copyTo :: Star IO (FilePath, FilePath) ()\ncopyTo = writeFile' . second' readFile'\n</code></pre>\n\n<p>to retain essentially the same example but with <code>Strong</code> instead of <code>Cartesian</code>. I'm still using the <code>Category</code> composition though. And I believe we won't be able to build up very complex examples without any composition.</p>\n\n<p>The big question becomes: why <strong>would</strong> you use the profunctor interface, instead of a category-based one? What are problems that <em>must</em> be done without composition? The answer lies pretty much in the <code>Category</code> instance of <code>Star</code>: there I had to make the heavy requirement of <code>Monad f</code>. That is not necessary for the profunctor instances: these only need <code>Functor f</code>. So for most focused examples of <code>Star</code> as a strong profunctor, you'll want to look at base functors which are <em>not</em> applicatives/monads. An important applications where such functors are relevant is in Van Laarhoven <a href=\"http://hackage.haskell.org/package/lens\" rel=\"noreferrer\">lenses</a>, and the internal implementation of those give indeed probably the most insightful examples for strong profunctors. I keep getting dizzy whenever I go through the source of the lens library, but I think one instance that is quite impactful is <a href=\"https://hackage.haskell.org/package/lens-4.17/docs/src/Control.Lens.Internal.Indexed.html#line-201\" rel=\"noreferrer\">Strong Indexed</a>.</p>\n"}], "owner": {"reputation": 225, "user_id": 9494377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Don Klein", "link": "https://stackoverflow.com/users/9494377/don-klein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 1, "accepted_answer_id": 53779654, "answer_count": 1, "score": 3, "last_activity_date": 1559519137, "creation_date": 1544783233, "last_edit_date": 1559519137, "question_id": 53777851, "link": "https://stackoverflow.com/questions/53777851/examples-of-cartesian-profunctor", "title": "Examples of Cartesian (Profunctor)?", "body": "<p>I'm going through following code sample and found it hard to figure out how to use (->) and (Star f) once they implemented 'first' and became a member of Cartisian.</p>\n\n<p>Could anyone provide some easy to understand examples for those? Thanks.</p>\n\n<pre><code>-- Intuitively a profunctor is cartesian if it can pass around additional\n-- context in the form of a pair.\n\nclass Profunctor p =&gt; Cartesian p where\n  first  :: p a b -&gt; p (a, c) (b, c)\n  first = dimap swapP swapP . second\n\n  second :: p a b -&gt; p (c, a) (c, b)\n  second = dimap swapP swapP . first\n\ninstance Cartesian (-&gt;) where\n  first :: (a -&gt; b) -&gt; (a, c) -&gt; (b, c)\n  first f = f `cross` id\n\ninstance Functor f =&gt; Cartesian (Star f) where\n  first :: Star f a b -&gt; Star f (a, c) (b, c)\n  first (Star f) = Star $ (\\(fx, y) -&gt; (, y) &lt;$&gt; fx) . (f `cross` id)\n</code></pre>\n"}, {"tags": ["c", "haskell", "struct", "ffi", "c2hs"], "answers": [{"tags": [], "owner": {"reputation": 58, "user_id": 7634517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b8a118e60f400e942aaba8c65dfdc64?s=128&d=identicon&r=PG", "display_name": "Sam May", "link": "https://stackoverflow.com/users/7634517/sam-may"}, "is_accepted": false, "score": 1, "last_activity_date": 1562721210, "creation_date": 1562721210, "answer_id": 56962213, "question_id": 53777758, "link": "https://stackoverflow.com/questions/53777758/haskell-ffi-with-c2hs-better-out-marshalling-of-structs/56962213#56962213", "title": "Haskell FFi with c2hs: Better out-marshalling of structs", "body": "<p>Are you using <code>{#pointer ...#}</code> hooks?  Since you're not treating A like an opaque pointer (i.e. <code>i</code> and <code>f</code> are accessible normally and the <code>Storable</code> instance is written explicitly), you'll want to use the arrow form:</p>\n\n<pre><code>{#pointer *A as APtr -&gt; A#}\n</code></pre>\n\n<p>At that point, you still have to use the <code>alloca</code>/<code>peek</code> functions to marshal <code>A</code>, but your first, ideal <code>{#fun ...#}</code> hook should work as written.  (You wind up ignoring the <code>APtr</code> type; it shows up in the generated code, but it's not necessary in the <code>*.chs</code> file.)</p>\n\n<p>Also note that you need to add that pointer definition to every file <code>A</code> is used in; even if you export <code>APtr</code> from one primary file, you still need to add <code>{#pointer *A as APtr -&gt; A nocode#}</code> everywhere you use it.</p>\n"}], "owner": {"reputation": 1750, "user_id": 3929481, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/3ZrH1.jpg?s=128&g=1", "display_name": "mcmayer", "link": "https://stackoverflow.com/users/3929481/mcmayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1562721210, "creation_date": 1544782888, "last_edit_date": 1544793941, "question_id": 53777758, "link": "https://stackoverflow.com/questions/53777758/haskell-ffi-with-c2hs-better-out-marshalling-of-structs", "title": "Haskell FFi with c2hs: Better out-marshalling of structs", "body": "<p>Suppose you have a C API provides that provides a C struct</p>\n\n<pre><code>typedef struct A {\n    int i;\n    float f;\n} A;\n</code></pre>\n\n<p>and a function that populates it:</p>\n\n<pre><code>void getA(A* a);\n</code></pre>\n\n<p>For example, this could be a getter for some information from the innards of the C API.</p>\n\n<p>In Haskell the C struct would be mirrored by</p>\n\n<pre><code>data A = A {\n    i :: Int,\n    f :: Float\n}\n</code></pre>\n\n<p>The <code>Storable</code> instance is</p>\n\n<pre><code>instance Storable A where\n    sizeOf    _ = {#sizeof  A #}\n    alignment _ = {#alignof A #}\n    peek p = ...\n    poke p x = ...\n</code></pre>\n\n<p>Peek and poke are business as usual with the <code>{#get...#}</code> and <code>{#set #}</code> pragmas processed by c2hs.</p>\n\n<p>The Haskell function <code>getA :: IO A</code> should be something like</p>\n\n<pre><code>{#fun unsafe getA as getA {alloca- `A' peek*} -&gt; `()'#}\n</code></pre>\n\n<p>except this doesn't work because c2hs creates this binding:</p>\n\n<pre><code>foreign import ccall unsafe \"include/A.h getA\"\n    _getA'_ :: Ptr () -&gt; IO ()\n</code></pre>\n\n<p>It has <code>Ptr ()</code> as first argument. This can be sorted out by</p>\n\n<pre><code>{#fun unsafe getA as getA {allocaA- `A' peekA*} -&gt; `()'#}\n\npeekA :: Ptr () -&gt; IO A\npeekA = peek . castPtr\n\nallocaA :: (Ptr () -&gt; IO a) -&gt; IO a\nallocaA f = alloca $ \\(p :: Ptr A) -&gt; f (castPtr p)\n</code></pre>\n\n<p>The <code>allocaA</code> is important because it ensures that memory for an <code>A</code> is allocated instead of memory for just a <code>()</code> if <code>alloca</code> were used.</p>\n\n<p>Although this works it is somewhat tedious and you have guaranteed segfaults if you ever forget to write <code>allocaXYZ</code> instead of just <code>alloca</code>. (I just saw a good amount of time being spent on tracking down one such error.)</p>\n\n<p>I expected to find a <code>{#fun...#}</code> incantation that produces </p>\n\n<pre><code>foreign import ccall unsafe \"include/A.h getA\"\n    _getA'_ :: Ptr A -&gt; IO ()\n</code></pre>\n\n<p>from which all else would follow naturally (note the <code>Ptr A</code> instead of <code>Ptr ()</code>). But as far as I can tell there's only the <code>{allocXYZ- 'XYZ' peekXYZ*}</code> route.</p>\n\n<p>So the question is: <strong>Can this be done in a better way using <code>c2hs</code>?</strong></p>\n"}, {"tags": ["haskell", "pandoc"], "comments": [{"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 0, "creation_date": 1544789731, "post_id": 53773487, "comment_id": 94410264, "body": "also have a look at <a href=\"https://pandoc.org/using-the-pandoc-api.html\" rel=\"nofollow noreferrer\">pandoc.org/using-the-pandoc-api.html</a> and specifically <a href=\"https://www.stackage.org/haddock/lts-12.22/pandoc-2.2.1/Text-Pandoc-Error.html#v:handleError\" rel=\"nofollow noreferrer\">stackage.org/haddock/lts-12.22/pandoc-2.2.1/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2306, "user_id": 318976, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/125d810d710271326abfa1a2e3d640e3?s=128&d=identicon&r=PG", "display_name": "stevejb", "link": "https://stackoverflow.com/users/318976/stevejb"}, "edited": false, "score": 1, "creation_date": 1545088784, "post_id": 53776223, "comment_id": 94497730, "body": "Thank you, I appreciate that. I ended up using <code>Ext_grid_tables</code> and that did what I wanted."}], "tags": [], "owner": {"reputation": 12250, "user_id": 2425163, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/05f4000597865eeaf51c32ed5694479c?s=128&d=identicon&r=PG", "display_name": "tarleb", "link": "https://stackoverflow.com/users/2425163/tarleb"}, "is_accepted": true, "score": 2, "last_activity_date": 1544777325, "creation_date": 1544777325, "answer_id": 53776223, "question_id": 53773487, "link": "https://stackoverflow.com/questions/53773487/generating-markdown-tables-in-haskell-with-pandoc/53776223#53776223", "title": "Generating markdown tables in Haskell with Pandoc", "body": "<p>Markdown, by default, does not support tables. Pandoc implements multiple ways to output tables, but this has to be enabled.  The easiest way is to use the set of extensions that make up pandoc flavored Markdown.</p>\n\n<p>Instead of <code>writeMarkdown def thing</code>, you can write</p>\n\n<pre><code>writeMarkdown (def{writerExtensions = pandocExtensions}) thing\n</code></pre>\n\n<p>Now your program produces tables using one of pandoc's table extensions.</p>\n"}], "owner": {"reputation": 2306, "user_id": 318976, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/125d810d710271326abfa1a2e3d640e3?s=128&d=identicon&r=PG", "display_name": "stevejb", "link": "https://stackoverflow.com/users/318976/stevejb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 53776223, "answer_count": 1, "score": 0, "last_activity_date": 1544777325, "creation_date": 1544761412, "question_id": 53773487, "link": "https://stackoverflow.com/questions/53773487/generating-markdown-tables-in-haskell-with-pandoc", "title": "Generating markdown tables in Haskell with Pandoc", "body": "<p>I am trying to create tables directly using the Pandoc AST. I am trying a couple of approaches. However, nothing seems to be working. Rather than getting a table output, I just get <code>[TABLE]</code>. I have tried both the Pandoc builder monad, as well as directly creating a Table using the primitive constructors. I am not sure what I am getting wrong here.</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DuplicateRecordFields #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\n\nmodule Main where\n\nimport Lib\n\nimport Data.Text (Text)\nimport qualified Data.Text as T\n\n----------------------------------------\n-- Pandoc imports\n\nimport Text.Pandoc\nimport Text.Pandoc.Builder\nimport Text.Pandoc.Options\nimport Text.Pandoc.Writers.Markdown\n\n\ntestTable :: IO ()\ntestTable = do\n  let my_tab = simpleTable [plain \"Column 1\"] [[plain \"hello there\"], [plain \"hello there 2\"], [plain \"hello there 2\"]]\n  let tab2 = Table [] [AlignDefault] [0.0] [[Plain [Str \"Column\",Space,Str \"1\"]]] [[[Plain [Str \"Hello\",Space,Str \"there\"]]] ,[[Plain [Str \"Hello\",Space,Str \"there\",Space,Str \"2\"]]] ,[[Plain [Str \"Hello\",Space,Str \"there\",Space,Str \"3\"]]]]\n\n  let other_tab = simpleTable colHeaders [testRow, testRow]\n  let thing = setTitle \"Test report\" $ doc $ para \"Hey there\" &lt;&gt; my_tab &lt;&gt; para \"paragraph after table\" &lt;&gt; singleton tab2 &lt;&gt; other_tab\n  md' &lt;- runIO (writeMarkdown def thing)\n  case md' of\n    Left _ -&gt; print \"Damn\"\n    Right md -&gt; writeFile \"my.md\" (T.unpack md)\n\n\n\n-- https://www.gwern.net/haskell/goodreadsToMarkdown.hs\ncolHeaders :: [Blocks]\ncolHeaders = map singleton [ Plain [Str \"Title\"]\n                           , Plain [Str \"Author\"]\n                           ]\n\n\ntestRow = map singleton [ Plain [Str \"Col 1\"]\n                        , Plain [Str \"Col 2\"]\n                        ]\n\n\nmain :: IO ()\nmain = do\n  print \"hello\"\n  testTable\n  let headers = map (plain . text) [\"foo\", \"bar\"]\n  let rows = map (map (plain . text)) [[\"1\", \"2\"], [\"3\", \"4\"]]\n--  md' &lt;- runIO (writeMarkdown def (doc (simpleTable headers rows)))\n  let caption' = text \"Hello\"\n  md' &lt;- runIO (writeMarkdown def (doc (table caption' [(AlignLeft, 1.0), (AlignLeft, 1.0)] headers rows)))\n  case md' of\n    Left _ -&gt; print \"Damn\"\n    Right md -&gt; print md\n</code></pre>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1544747260, "post_id": 53771818, "comment_id": 94395783, "body": "<a href=\"https://en.wikichip.org/wiki/schlemiel_the_painter%27s_algorithm\" rel=\"nofollow noreferrer\">en.wikichip.org/wiki/schlemiel_the_painter%27s_algorithm</a>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1544748561, "post_id": 53771818, "comment_id": 94396034, "body": "It is possible that no frequency is ever reached twice. For example <code>[11,-1]</code> will just go off to infinity.  You might want to <code>Debug.Trace</code> in <code>part2helper</code> to see if this is happening, or if it&#39;s a performance thing as <code>melpomene</code> suggests (though your algorithm could be improved, I have my doubts that it&#39;s a performance problem)"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 1, "creation_date": 1544748886, "post_id": 53771818, "comment_id": 94396095, "body": "The function <code>go</code> is partial. <code>go [] [] == undefined</code>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1544749315, "post_id": 53771818, "comment_id": 94396180, "body": "Actually it might be.  I thought a solution would always be found within 2 cycles, but I was mistaken--it might take up to n cycles, which would make your algorithm O(n^4). That could easily get slow."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1544749476, "post_id": 53771818, "comment_id": 94396211, "body": "@FyodorSoikin, but it&#39;s only ever given an infinite list."}, {"owner": {"reputation": 125, "user_id": 5594534, "user_type": "registered", "profile_image": "https://graph.facebook.com/957702314318004/picture?type=large", "display_name": "koalag", "link": "https://stackoverflow.com/users/5594534/koalag"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1544752262, "post_id": 53771818, "comment_id": 94396773, "body": "@luqui is correct; I was working on my laptop, I just ran it on my desktop, and it produces the correct result after some time. So it is simply a very ineffective algorithm that runs criminally slow."}], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 5594534, "user_type": "registered", "profile_image": "https://graph.facebook.com/957702314318004/picture?type=large", "display_name": "koalag", "link": "https://stackoverflow.com/users/5594534/koalag"}, "edited": false, "score": 0, "creation_date": 1544755755, "post_id": 53772617, "comment_id": 94397464, "body": "Very thorough answer and analysis! I was thinking along these lines a bit, but went for &quot;slow and dirty&quot;. But such math analysis are almost the most fun about such stuff."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 125, "user_id": 5594534, "user_type": "registered", "profile_image": "https://graph.facebook.com/957702314318004/picture?type=large", "display_name": "koalag", "link": "https://stackoverflow.com/users/5594534/koalag"}, "edited": false, "score": 0, "creation_date": 1544817269, "post_id": 53772617, "comment_id": 94423676, "body": "@georgjz Added a shortened version by the way. Also note that while it is indeed fun, it&#39;s also a matter of  practicality. It makes it easier to understand, to reason about, to test, to adapt, etc. Even if you optimise things latter, it&#39;s good to have a simple and easy to read version around, that you can use to test the correctness of  your changes."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": true, "score": 5, "last_activity_date": 1544817030, "last_edit_date": 1544817030, "creation_date": 1544753239, "answer_id": 53772617, "question_id": 53771818, "link": "https://stackoverflow.com/questions/53771818/recursive-haskell-function-seemingly-doesnt-terminate/53772617#53772617", "title": "Recursive Haskell function seemingly doesn&#39;t terminate", "body": "<p>You're trying to put everything together in a single function. It's much better if you work in a modular fashion, breaking the problem into smaller ones. </p>\n\n<p>Here's an idea, </p>\n\n<ul>\n<li>generate the sequence of frequencies,<br>\n<code>f0, f1, f2...</code> </li>\n<li>generate the sequence of cumulative sets of frequencies<br>\n<code>{}, {f0}, {f0,f1}, {f0,f1,f2}...</code></li>\n<li>check repeated insertions, i.e.<br>\n<code>fi</code> such that <code>fi \u2208 {f0..fi-1}</code> </li>\n</ul>\n\n<p>To make things clearer regarding the last point consider, </p>\n\n<pre><code> f0, f1,   f2,      f3...\n {}, {f0}, {f0,f1}, {f0,f1,f2}...`\n</code></pre>\n\n<p>if <code>f3</code> were a repetition then <code>f3 \u2208 {f0,f1,f2}</code> </p>\n\n<p>This may seem terribly inefficient but because Haskell is lazy, these lists will be generated as needed. </p>\n\n<p>We'll need to import modules to work with sets and maybes,  </p>\n\n<pre><code>import Data.Set\nimport Data.Maybe\n</code></pre>\n\n<p>Generating the frequencies from the first frequency and a list of frequency changes can be done via <code>scanl (+)</code>. The function <code>scanl (+) x xs</code> operates the elements of <code>xs</code> with the operator <code>+</code> , starting at <code>x</code>, generating the cumulative list of sums.  </p>\n\n<pre><code>freqs :: Int -&gt; [Int] -&gt; [Int]\nfreqs = scanl (+)  \n</code></pre>\n\n<p>Now we can generate the list of sets. Here too we use a <code>scanl</code>. In each step we insert a new frequency, and we start with the empty set.</p>\n\n<pre><code>sets  :: [Int] -&gt; [Set Int]\nsets  = scanl (\\s x -&gt; insert x s) (empty) \n</code></pre>\n\n<p>Once we have the frequencies and the sets we are pretty much done.The main function just puts everything together. It combines both lists and finds the first pair <code>(fi , {f0,...,fi-1})</code> such that <code>fi \u2208 {f0,...,fi-1}</code>, and returns the corresponding <code>fi</code></p>\n\n<pre><code>result :: Int -&gt; [Int] -&gt; Maybe Int\nresult x xs = let fs = freqs x xs\n                  ss = sets fs                  \n                  r  = find (\\(y,s) -&gt; y `elem` s) (zip fs ss)\n              in fmap fst r\n</code></pre>\n\n<p>Note <code>find</code> returns a <code>Maybe (Int, Set Int)</code>. It may find <code>Nothing</code> or return <code>Just (x,s)</code> for some frequency <code>x</code> that was already in <code>s</code>. We use <code>fmap fst</code> to turn <code>Just (x,s)</code> into <code>Just x</code>.</p>\n\n<hr>\n\n<p><strong>EDIT</strong></p>\n\n<p>Once you've got things working if you wish to, may optimize a few things, or play around with your style. The following is a more succinct, and possibly a little bit more efficient version. </p>\n\n<p>The list of frequencies and sets can be built together in one go. </p>\n\n<pre><code>freqsets :: Int -&gt; [Int] -&gt; [(Int, Set Int)]\nfreqsets f0 = scanl (\\(f,s) x -&gt; (f+x,insert f s)) (f0,empty) \n</code></pre>\n\n<p>And so it's ready to use for the result function. Also we can take advantage of <code>Maybe</code> being a monad to make things a bit more readable. </p>\n\n<pre><code>result :: Int -&gt; [Int] -&gt; Maybe Int\nresult f0 xs = do (f,_) &lt;- find(\\(y,s)-&gt;y `elem` s) (freqsets f0 xs)\n                  return f \n</code></pre>\n\n<p>And there you have it, a rather short solution. I like the change in the result function. I like the <code>do</code> notation, as well as not having it calculate the zipping of the two previous lists. I'm not so sure if \"fusing\" the building of both lists is worth it. It's a bit less readable. Using three functions, one for frequencies, one for sets, and one for zipping, might be best. </p>\n"}], "owner": {"reputation": 125, "user_id": 5594534, "user_type": "registered", "profile_image": "https://graph.facebook.com/957702314318004/picture?type=large", "display_name": "koalag", "link": "https://stackoverflow.com/users/5594534/koalag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 1, "accepted_answer_id": 53772617, "answer_count": 1, "score": 3, "last_activity_date": 1544817030, "creation_date": 1544745900, "question_id": 53771818, "link": "https://stackoverflow.com/questions/53771818/recursive-haskell-function-seemingly-doesnt-terminate", "title": "Recursive Haskell function seemingly doesn&#39;t terminate", "body": "<p>To improve my Haskell skills, I'm trying to solve the <a href=\"https://adventofcode.com/\" rel=\"nofollow noreferrer\">Advent of Code 2018</a>. As expected, I am already stuck on day 1, specifically on part 2:</p>\n\n<blockquote>\n  <p>--- Part Two ---</p>\n  \n  <p>You notice that the device repeats the same frequency change list over\n  and over. </p>\n  \n  <p>To calibrate the device, you need to find the first frequency it\n  reaches twice.</p>\n  \n  <p>For example, using the same list of changes above, the device would\n  loop as follows:</p>\n  \n  <p>Current frequency  0, change of +1; resulting frequency  1.</p>\n  \n  <p>Current frequency  1, change of -2; resulting frequency -1.</p>\n  \n  <p>Current frequency -1, change of +3; resulting frequency  2.</p>\n  \n  <p>Current frequency  2, change of +1; resulting frequency  3.</p>\n  \n  <p>(At this point, the device continues from the start of the list.)</p>\n  \n  <p>Current frequency  3, change of +1; resulting frequency  4.</p>\n  \n  <p>Current frequency  4, change of -2; resulting frequency  2, which has\n  already been seen.</p>\n  \n  <p>In this example, the first frequency reached twice is <code>2</code>. Note that\n  your device might need to repeat its list of frequency changes many\n  times before a duplicate frequency is found, and that duplicates might\n  be found while in the middle of processing the list.</p>\n  \n  <p>Here are other examples:</p>\n  \n  <p>+1, -1 first reaches 0 twice.</p>\n  \n  <p>+3, +3, +4, -2, -4 first reaches 10 twice.</p>\n  \n  <p>-6, +3, +8, +5, -6 first reaches 5 twice.</p>\n  \n  <p>+7, +7, -2, -7, -4 first reaches 14 twice.</p>\n  \n  <p>What is the first frequency your device reaches twice?</p>\n</blockquote>\n\n<p>Basically, I have a very large list <code>vals::[Int]</code> that includes all the frequency changes mentioned above.</p>\n\n<p>Here is the function I wrote for solving this problem:</p>\n\n<pre><code>-- [1] The list of frequency changes\n-- [2] The first repeat frequency\n--             [1]      [2]\npart2helper :: [Int] -&gt; Int\npart2helper ds = go ds []\n    where go ds [] = go ds [0]\n          go (d:ds) [f] = go ds $ (f+d):[f]\n          go (d:ds) (f:fs) =\n              if f `elem` fs then f\n              else go ds $ (d+f):f:fs\n</code></pre>\n\n<p>I test this function with the values provided in the description in <code>ghci</code>:</p>\n\n<pre><code>*Main&gt; part2helper (cycle [1, -2, 3, 1])\n2\n*Main&gt; part2helper (cycle [1, -1])\n0\n*Main&gt; part2helper (cycle [3, 3, 4, -2, -4])\n10\n*Main&gt; part2helper (cycle [7, 7, -2, -7, -4])\n14\n*Main&gt; \n</code></pre>\n\n<p>All result are correct, so I assume my function works correctly. The problem now is, when I compile this into a program that reads the input list from a file, the program never terminates. Here's the code:</p>\n\n<pre><code>module Main where\n\nimport System.Environment\n\nmain = do \n    [input] &lt;- getArgs\n    s       &lt;- readFile input\n    let n    = lines $ s\n        vals = map (read::String-&gt;Int) $ fmap (filter (/='+')) n\n        sol  = part2helper (cycle vals)\n    print sol\n\n-- [1] The list of frequency changes\n-- [2] The first repeat frequency\n--             [1]      [2]\npart2helper :: [Int] -&gt; Int\npart2helper ds = go ds []\n    where go ds     []     = go ds [0]\n          go (d:ds) [f]    = go ds $ (f+d):[f]\n          go (d:ds) (f:fs) =\n              if f `elem` fs then f\n              else go ds $ (d+f):f:fs\n</code></pre>\n\n<p>This builds with GHC correctly, but as I said, never terminates and prints no result. What am I missing? The input file can be found <a href=\"https://adventofcode.com/2018/day/1/input\" rel=\"nofollow noreferrer\">here</a>. </p>\n"}, {"tags": ["haskell", "some-and-many", "alternative-functor"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544741272, "post_id": 53771038, "comment_id": 94394137, "body": "I guess that&#39;s the Osmium of all Haskell books."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 4, "creation_date": 1544741510, "post_id": 53771038, "comment_id": 94394221, "body": "see <a href=\"https://stackoverflow.com/questions/18108608/what-are-alternatives-some-and-many-useful-for\" title=\"what are alternatives some and many useful for\">stackoverflow.com/questions/18108608/&hellip;</a> and its many links. (possible duplicate). <a href=\"https://stackoverflow.com/a/7681283/849891\">Here&#39;s</a> a very good answer."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544776253, "post_id": 53771038, "comment_id": 94403032, "body": "Have the linked entries answered our question or is there something still unclear?"}, {"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "edited": false, "score": 0, "creation_date": 1544819048, "post_id": 53771038, "comment_id": 94424402, "body": "It is clear, thank you"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 1, "creation_date": 1547771563, "post_id": 53771038, "comment_id": 95316972, "body": "For <code>[]</code> and <code>Maybe</code> those two functions aren&#39;t really useful: but they are really useful for types like <code>StateT String []</code>"}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1592250558, "post_id": 62388118, "comment_id": 110353199, "body": "btw <code>some [2] = x where { x = (:) &lt;$&gt; [2] &lt;*&gt; (x &lt;|&gt; pure []) = [ (2:) ] &lt;*&gt; (x &lt;|&gt; pure []) = fmap (2:) (x &lt;|&gt; pure []) = fmap (2:) x &lt;|&gt; pure [2] = map (2:) x ++ [[2]] }</code>"}], "tags": [], "owner": {"reputation": 2540, "user_id": 1803897, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/921ed2f776bd064b49d8aadb378dd15a?s=128&d=identicon&r=PG", "display_name": "Roland Puntaier", "link": "https://stackoverflow.com/users/1803897/roland-puntaier"}, "is_accepted": true, "score": 0, "last_activity_date": 1592255494, "last_edit_date": 1592255494, "creation_date": 1592223648, "answer_id": 62388118, "question_id": 53771038, "link": "https://stackoverflow.com/questions/53771038/haskell-some-many-implementation/62388118#62388118", "title": "Haskell - some, many implementation", "body": "<p>From <code>ghc/libraries/base/GHC/Base.hs</code> there is this recursive declaration:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>    ... :: f a -&gt; f [a]\n    ...\n        many_v = some_v &lt;|&gt; pure []\n        some_v = liftA2 (:) v many_v  -- (:) &lt;$&gt; v &lt;*&gt; many_v\n</code></pre>\n\n<p>The argument <code>v</code> must be a value of a type that is instance of\n<code>Alternative</code> (and <code>Applicative</code> and <code>Functor</code>).\n<code>v</code> is <em>lifted</em> already and just needs to be applied (<code>&lt;*&gt;</code>).\nThe application results in a lifted list.</p>\n\n<p><code>some</code> and <code>many</code> make recursive applications of the constructor of <code>v</code>,\nand put the constructed values into a list.</p>\n\n<ul>\n<li><code>some</code> stops application, when the first <code>empty</code> is constructed</li>\n<li><code>many</code> continues application beyond that</li>\n</ul>\n\n<p><code>[]</code> is instance of <code>Alternative</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Alternative [] where\n    empty = []\n    (&lt;|&gt;) = (++)\n</code></pre>\n\n<p><code>some</code> tries with list:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>  av = [[2], [2,3], [], [2,3,5]]\n  some av                      -- no error, but never stops\n  do {v &lt;- some av; return v;} -- no error, but never stops\n</code></pre>\n\n<p>Comparing to <code>letter</code> in\n<a href=\"https://stackoverflow.com/questions/18108608/what-are-alternatives-some-and-many-useful-for\">What are Alternative&#39;s &quot;some&quot; and &quot;many&quot; useful for?</a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>  import Control.Monad(Functor(..))\n  import Control.Applicative\n  import Data.Char\n  newtype P a = P { runP :: String -&gt; [(a,String)] }\n  instance Functor P where\n    fmap f (P q) = P (\\s -&gt; [ (f y,ys) | (y,ys) &lt;- q s])\n  instance Applicative P where\n    pure x = P (\\s -&gt; [(x,s)])\n    P p &lt;*&gt; P q = P (\\s -&gt; [(x y, ys) | (x,xs) &lt;- p s, (y,ys) &lt;- q xs])\n  letter = P p where\n    p (x:xs) | isAlpha x = [(x,xs)]\n    p _ = []\n  instance Alternative P where\n    P p &lt;|&gt; P q = P (\\s-&gt; p s ++ q s)\n    empty = P (\\s-&gt; [])\n</code></pre>\n\n<p>with usage:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>  runP (many letter) \"ab123\"\n</code></pre>\n\n<p><code>letter</code> is a smart constructor, that\nconstructs a value of <code>P</code> with field <code>runP</code> using local variable <code>p</code>.\n(The result of the accessor) <code>runP</code> is a function.\n<code>P</code> is a type implementing <code>Alternative</code> as well as a constructor.\n<code>P</code> stands for parser.</p>\n\n<p><code>fmap</code> is not used in <code>some</code> and <code>many</code>.\n<code>&lt;*&gt;</code> leads to an application of the function <code>runP</code>,\nwhose argument is not yet here.\nBasically <code>some</code> and <code>many</code> construct a program that will eat from its argument.\nThe argument must be a list.\nDue to laziness the recursion stops at the first constructor.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>  p = some letter -- constructs a program accessed via @runP@\n  runP p \"a1\" -- [(\"a\",\"1\")]\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>  q = some [2] -- basically also a program\n  q -- never stops\n</code></pre>\n\n<p>Recursive application is not <code>empty</code> (<code>[]</code> for list),\nbecause there is no source of criteria to stop, i.e. no input.</p>\n\n<p>These stop:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>  some [] -- []\n  many [] -- [[]]\n  some Nothing -- Nothing\n  many Nothing -- Just []\n</code></pre>\n\n<p>There are more requirements on the argument of <code>some</code> and <code>many</code> (<code>v</code>).</p>\n\n<ul>\n<li><code>v</code> is value of a type that is instance of <code>Alternative</code>.</li>\n<li>The recursive application of the constructor of the <code>v</code> type must stop with <code>empty</code>.</li>\n<li><code>v</code> must contain a function applied during construction with <code>&lt;*&gt;</code> to have stop criteria.</li>\n</ul>\n\n<p>Conclusion:\n<code>some</code> and <code>many</code> cannot be applied to list values,\neven though list implements <code>Alternative</code>.</p>\n\n<p>Why does list implement <code>Alternative</code>?\nI think, it is to add the <code>Monoid</code> interface <code>&lt;|&gt;</code> and <code>empty</code> on top of <code>Applicative</code>,\nnot because of <code>some</code> and <code>many</code>.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>  foldr (&lt;|&gt;) [] [[2],[],[3,4]] -- [2,3,4]\n</code></pre>\n\n<p><code>some</code> and <code>many</code> seem to be just for parser construction\nor more generally construction of a program consuming input\nand producing more outputs, of which some can be <code>empty</code>.\nThat is quite general already.\nBut the place in <code>Alternative</code> is only justified,\nif most of <code>Alternative</code> instances have a sensible usage for it.\nThat is not the case.</p>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 408, "favorite_count": 0, "accepted_answer_id": 62388118, "answer_count": 1, "score": 3, "last_activity_date": 1613785140, "creation_date": 1544740522, "last_edit_date": 1613785140, "question_id": 53771038, "link": "https://stackoverflow.com/questions/53771038/haskell-some-many-implementation", "title": "Haskell - some, many implementation", "body": "<p>In the article: \"<a href=\"http://dev.stephendiehl.com/fun/WYAH.pdf\" rel=\"nofollow noreferrer\">Write you a Haskell</a>\" (page 34) the following interpretation of \"<code>some</code>\" and \"<code>many</code>\" is given:</p>\n\n<blockquote>\n  <p>Derived automatically from the <code>Alternative</code> typeclass definition are\n  the <code>many</code> and <code>some</code> functions. <code>many</code> takes a single function argument and\n  repeatedly applies it until the function <em>fails</em>, and then yields the\n  collected results up to that point. The <code>some</code> function behaves similar\n  except that it will fail itself if there is not <em>at least</em> <em>a single</em>\n  match.</p>\n</blockquote>\n\n<pre><code>-- | One or more.\nsome :: f a -&gt; f [a]\nsome v = some_v\n  where\n    many_v = some_v &lt;|&gt; pure []\n    some_v = (:) &lt;$&gt; v &lt;*&gt; many_v\n\n-- | Zero or more.\nmany :: f a -&gt; f [a]\nmany v = many_v\n  where\n    many_v = some_v &lt;|&gt; pure []\n    some_v = (:) &lt;$&gt; v &lt;*&gt; many_v\n</code></pre>\n\n<p>I have been trying to understand this implementation for a while.</p>\n\n<p>I dont understand how \"<code>many</code>\" and \"<code>some</code>\" could be applied to \"lists\" or \"<code>Maybe</code>\".</p>\n\n<p>Also I am not sure about <code>(:) &lt;$&gt; v &lt;*&gt; many_v</code>.</p>\n\n<p>How does one derive this?</p>\n"}, {"tags": ["arrays", "haskell", "vector", "primitive", "massiv"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544738195, "post_id": 53770035, "comment_id": 94393161, "body": "Maybe I am not completely understanding your goals, but have you considered using, say, <code>ST s</code> or any other <code>PrimMonad</code>? I would attempt to achieve the same performance through known-safe methods before resorting to low-level primitives."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1544738332, "post_id": 53770035, "comment_id": 94393208, "body": "@chi That&#39;s a good question. It&#39;s not totally obvious, but it is impossible to use either <code>PrimMonad</code> or <code>ST</code> in order to achieve the desired function."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1548284916, "post_id": 53770035, "comment_id": 95491325, "body": "@chi, I stand corrected, <code>primitive</code> does indeed has a function I was looking for. :) See my answer."}], "answers": [{"tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 0, "last_activity_date": 1548285476, "last_edit_date": 1548285476, "creation_date": 1548284849, "answer_id": 54337087, "question_id": 53770035, "link": "https://stackoverflow.com/questions/53770035/is-it-safe-to-interleave-manual-realworld-state-passing-with-an-arbitrary-monad/54337087#54337087", "title": "Is it safe to interleave manual realWorld# state passing with an arbitrary Monad", "body": "<p><strong>TLDR;</strong> From what I gathered so far, it does seem to be a safe way to generate a primitive <code>Vector</code> in a way I originally proposed. Moreover, the use of <code>noDuplicate#</code> is not really necessary, since all of the operations are idempotent and order of operations will not have an affect on the resulted array(s).</p>\n\n<p><em>Disclosure</em>: It's been over a year since I first thought about that problem. It was only last month that I tried to get back to it. Reason why I am saying this is because checking out <a href=\"https://www.stackage.org/package/primitive\" rel=\"nofollow noreferrer\">primitive</a> package now I noticed a new module <code>Data.Primitive.PrimArray</code> to me. As @chi mentioned in the comments, there isn't really a need to drop down to the low-level primitives in order to get a solution, since it might already exist. Which contains exactly the function <a href=\"https://www.stackage.org/haddock/lts-13.4/primitive-0.6.4.0/Data-Primitive-PrimArray.html#v:generatePrimArrayA\" rel=\"nofollow noreferrer\">generatePrimArrayA</a>, which was exactly what I was looking for (a bit simplified copy of the source code):</p>\n\n<pre><code>newtype STA a = STA {_runSTA :: forall s. MutableByteArray# s -&gt; ST s (PrimArray a)}\n\nrunSTA :: forall a. Prim a =&gt; Int -&gt; STA a -&gt; PrimArray a\nrunSTA !sz =\n  \\(STA m) -&gt; runST $ newPrimArray sz &gt;&gt;= \\(ar :: MutablePrimArray s a) -&gt; m (unMutablePrimArray ar)\n\ngeneratePrimArrayA :: (Applicative f, Prim a) =&gt; Int -&gt; (Int -&gt; f a) -&gt; f (PrimArray a)\ngeneratePrimArrayA len f =\n  let go !i\n        | i == len = pure $ STA $ \\mary -&gt; unsafeFreezePrimArray (MutablePrimArray mary)\n        | otherwise =\n          liftA2\n            (\\b (STA m) -&gt; STA $ \\mary -&gt; writePrimArray (MutablePrimArray mary) i b &gt;&gt; m mary)\n            (f i)\n            (go (i + 1))\n   in runSTA len &lt;$&gt; go 0\n</code></pre>\n\n<p>Just as a fun exercise if we go through the basic simplification with usual reduction rules we get a very similar thing to what I had in the first place:</p>\n\n<pre><code>generatePrimArrayA :: forall f a. (Applicative f, Prim a) =&gt; Int -&gt; (Int -&gt; f a) -&gt; f (PrimArray a)\ngeneratePrimArrayA !(I# n#) f =\n  let go i# = case i# &lt;# n# of\n                0# -&gt; pure $ \\mary s# -&gt;\n                        case unsafeFreezeByteArray# mary s# of\n                          (# s'#, arr'# #) -&gt; (# s'#, PrimArray arr'# #)\n                _ -&gt; liftA2\n                     (\\b m -&gt;\n                        \\mary s -&gt;\n                          case writeByteArray# mary i# b s of\n                            s'# -&gt; m mary s'#)\n                     (f (I# i#))\n                     (go (i# +# 1#))\n   in (\\m -&gt; runRW# $ \\s0# -&gt;\n                case newByteArray# (n# *# sizeOf# (undefined :: a)) s0# of\n                  (# s'#, arr# #) -&gt; case m arr# s'# of\n                                       (# _, a #) -&gt; a)\n      &lt;$&gt; go 0#\n</code></pre>\n\n<p>Here is my version adjusted for an <code>Applicative</code> instead of a <code>Monad</code>:</p>\n\n<pre><code>generatePrimM :: forall m a . (Prim a, Applicative m) =&gt; Int -&gt; (Int -&gt; m a) -&gt; m (PrimArray a)\ngeneratePrimM (I# sz#) f =\n  let go i# = case i# &lt;# sz# of\n                0# -&gt; runRW# $ \\s0# -&gt;\n                      case newByteArray# (sz# *# sizeOf# (undefined :: a)) s0# of\n                        (# s1#, mba# #) -&gt; pure (MutableByteArrayState s1# mba#)\n                _  -&gt; liftA2\n                      (\\b (MutableByteArrayState si# mba#) -&gt;\n                         MutableByteArrayState (writeByteArray# mba# i# b si#) mba#)\n                      (f (I# i#))\n                      (go (i# +# 1#))\n   in (\\(MutableByteArrayState s# mba#) -&gt;\n         case unsafeFreezeByteArray# mba# s# of\n           (# _, ba# #) -&gt; PrimArray ba#) &lt;$&gt;\n      (go 0#)\n</code></pre>\n\n<p>Functionally and performance wise they are very close to each other, and in the end they will both produce exactly the same answer. The difference is what the inner loop <code>go</code> produces in the end. The latter one will return an applicative containing the closure that can construct the <code>MutableByteArray#</code>s, which will later be frozen. While the former has a loop that returns an applicative containing an action that will create a frozen <code>ByteArray#</code>s, once an action that can create a <code>MutableByteArray#</code> is supplied to it.</p>\n\n<p>Nevertheless, the reason what makes both approaches safe is that each element of every produced array within the loop gets written to exactly once, and each <code>MutableByteArray#</code> created does get frozen prior to getting returned by the generating function, but not before it finished writing to them.</p>\n"}], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 2, "accepted_answer_id": 54337087, "answer_count": 1, "score": 7, "last_activity_date": 1548285476, "creation_date": 1544735044, "last_edit_date": 1544945164, "question_id": 53770035, "link": "https://stackoverflow.com/questions/53770035/is-it-safe-to-interleave-manual-realworld-state-passing-with-an-arbitrary-monad", "title": "Is it safe to interleave manual realWorld# state passing with an arbitrary Monad", "body": "<p>Consider this function that generates a list for an arbitrary <code>Monad</code>:</p>\n\n<pre><code>generateListM :: Monad m =&gt; Int -&gt; (Int -&gt; m a) -&gt; m [a]\ngenerateListM sz f = go 0\n  where go i | i &lt; sz = do x &lt;- f i\n                           xs &lt;- go (i + 1)\n                           return (x:xs)\n             | otherwise = pure []\n</code></pre>\n\n<p>Implementation maybe isn't perfect, but it is presented here solely for demonstration of the desired effect, which is pretty straightforward. For example if a monad is a list well get list of lists:</p>\n\n<pre><code>\u03bb&gt; generateListM 3 (\\i -&gt; [0 :: Int64 .. fromIntegral i])\n[[0,0,0],[0,0,1],[0,0,2],[0,1,0],[0,1,1],[0,1,2]]\n</code></pre>\n\n<p>What I'd like to do is to achieve the same affect, but for <code>ByteArray</code> instead of a List. As it turns out, this is much trickier than I thought when I first stumbled upon this problem. The end goal is to use that generator to implement <code>mapM</code> in <a href=\"https://github.com/lehins/massiv/issues/24\" rel=\"nofollow noreferrer\">massiv</a>, but that is besides the point. </p>\n\n<p>The approach that requires the least effort is to use a function <code>generateM</code> from <a href=\"https://www.stackage.org/haddock/lts-12.22/vector-0.12.0.2/Data-Vector-Primitive.html#v:generateM\" rel=\"nofollow noreferrer\">vector</a> package while doing a bit of manual conversion. But as it turns out there is a way to achieve at least a factor of x2 performance gain with this neat little trick of handling the state token manually and interleaving it with the monad:</p>\n\n<pre><code>{-# LANGUAGE MagicHash           #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE UnboxedTuples       #-}\nimport           Data.Primitive.ByteArray\nimport           Data.Primitive.Types\nimport qualified Data.Vector.Primitive    as VP\nimport           GHC.Int\nimport           GHC.Magic\nimport           GHC.Prim\n\n-- | Can't `return` unlifted types, so we need a wrapper for the state and MutableByteArray\ndata MutableByteArrayState s = MutableByteArrayState !(State# s) !(MutableByteArray# s)\n\ngeneratePrimM :: forall m a . (Prim a, Monad m) =&gt; Int -&gt; (Int -&gt; m a) -&gt; m (VP.Vector a)\ngeneratePrimM (I# sz#) f =\n  runRW# $ \\s0# -&gt; do\n    let go i# = do\n          case i# &lt;# sz# of\n            0# -&gt;\n              case newByteArray# (sz# *# sizeOf# (undefined :: a)) (noDuplicate# s0#) of\n                (# s1#, mba# #) -&gt; return (MutableByteArrayState s1# mba#)\n            _ -&gt; do\n              res &lt;- f (I# i#)\n              MutableByteArrayState si# mba# &lt;- go (i# +# 1#)\n              return (MutableByteArrayState (writeByteArray# mba# i# res si#) mba#)\n    MutableByteArrayState s# mba# &lt;- go 0#\n    case unsafeFreezeByteArray# mba# s# of\n      (# _, ba# #) -&gt; return (VP.Vector 0 (I# sz#) (ByteArray ba#))\n</code></pre>\n\n<p>We can use it in the same fashion as before, except now we'll get a primitive <code>Vector</code>, which is backed by <code>ByteArray</code>, which is what I really need:</p>\n\n<pre><code>\u03bb&gt; generatePrimM 3 (\\i -&gt; [0 :: Int64 .. fromIntegral i])\n[[0,0,0],[0,0,1],[0,0,2],[0,1,0],[0,1,1],[0,1,2]]\n</code></pre>\n\n<p>This seems to work great, performs well for ghc version 8.0 and 8.2, except that there is a regression in 8.4 and 8.6, but that issue is orthogonal.</p>\n\n<p>Finally I get to the actual question. Is this approach really safe? Is there some edge case that I am not aware of that could bite me later? Any other suggestions or opinions are welcome as well with regard to the above function. </p>\n\n<p>PS. <code>m</code> doesn't have to be restricted to a <code>Monad</code>, an <code>Applicative</code> would work just fine, but the example is a bit clearer when it is presented with <code>do</code> syntax.</p>\n"}, {"tags": ["haskell", "command-line-interface", "optparse-applicative"], "answers": [{"comments": [{"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1545343193, "post_id": 53875384, "comment_id": 94600570, "body": "Ugh, so it looks like this isn&#39;t really possible. It&#39;s odd since the the package as provided (in the linked example) is inconsistent. The global <code>--help</code> option behaves in the way I&#39;m looking for, but the global <code>--version</code> can&#39;t really be made to work the same way."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1545343343, "post_id": 53875384, "comment_id": 94600635, "body": "Even worse, the help for the subcommands doesn&#39;t list <code>--version</code> as a legal (global) option, even though it is."}, {"owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1545343585, "post_id": 53875384, "comment_id": 94600703, "body": "@orome - <code>--help</code> is implemented the way that I have shown (the <code>h</code> in <code>hsubparser</code> is because it adds <code>--help</code>). <code>--help</code> is treated a bit different from other global options since it really has command-specific meaning. I did not show it in the example at the end, but if you use the <code>mysubparser</code> I have provide, <code>--version</code> will indeed appear in the subcommand help."}, {"owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 0, "creation_date": 1545516003, "post_id": 53875384, "comment_id": 94644661, "body": "So it sounds like, without a lot of customizing work (which you&#39;ve don here), it&#39;s not really possible."}, {"owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "reply_to_user": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "edited": false, "score": 1, "creation_date": 1545518422, "post_id": 53875384, "comment_id": 94645139, "body": "I think that that&#39;s probably true. That said, the <code>mysubparser</code> here should be fairly re-usable (and isn&#39;t incredibly complex/hard-to-adapt), so if you really need this functionality for something, it may be useful/a possible avenue."}], "tags": [], "owner": {"reputation": 1435, "user_id": 6676199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f60cb3880bf43a7c74ffeecbf996e1?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Amidon", "link": "https://stackoverflow.com/users/6676199/peter-amidon"}, "is_accepted": true, "score": 5, "last_activity_date": 1545336674, "creation_date": 1545336674, "answer_id": 53875384, "question_id": 53769310, "link": "https://stackoverflow.com/questions/53769310/how-do-i-create-and-distinguish-global-options-using-optparse-applicative/53875384#53875384", "title": "How do I create, and distinguish, global options using &#39;optparse-applicative&#39;?", "body": "<p>As far as I know, this (in particular, the categorized help text) isn't really easy to do with <code>optparse-applicative</code>, since it isn't quite the pattern that they were planning for with global arguments.  If you are okay with using <code>program --global-options command --local-options</code> (which is a fairly standard pattern) instead of <code>program command --global-and-local-options</code>, then you can use the approach shown in the linked example:</p>\n\n<pre><code>$ ./optparse-sub-example\noptparse-sub-example - a small example program for optparse-applicative with\nsubcommands\n\nUsage: optparse [--version] [--global-flag] COMMAND\n  optparse subcommands example\n\nAvailable options:\n  -h,--help                Show this help text\n  --version                Show version\n  --global-flag            Set a global flag\n\nAvailable commands:\n  create                   Create a thing\n  delete                   Delete the thing\n\n$ ./optparse-sub-example --version create\n0.0\n$ ./optparse-sub-example --version delete\n0.0\n$ ./optparse-sub-example --global-flag create HI\nCreated the thing named HI\nglobal flag: True\n$ ./optparse-sub-example --global-flag delete\nDeleted the thing!\nglobal flag: True\n</code></pre>\n\n<p>(Note: I would advise going with this approach, since \"global options before the command\" is fairly standard).</p>\n\n<p>If you also want the global options to be available in every subcommand, you will have a few issues.</p>\n\n<ol>\n<li>As far as I know, there is no way to affect the help text output in order to group them separately inside the individual command help texts.</li>\n<li>You will need some custom <code>subparser</code>-like function that adds your global options &amp; merges them with any global options before the command.</li>\n</ol>\n\n<p>For #2, one way to restructure the example to support this might be something along these lines:</p>\n\n<p>To start with, standard boilerplate and imports:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TupleSections #-}\n{-# LANGUAGE ApplicativeDo #-}\n\nimport Data.Monoid\nimport Data.Semigroup ((&lt;&gt;))\nimport Options.Applicative\nimport Options.Applicative.Types\n</code></pre>\n\n<p><code>Opts</code> are explicitly split into <code>optGlobals</code> and <code>optCommand</code>, making it easy to deal with all of the global options at once if more are available:</p>\n\n<pre><code>data Opts = Opts\n    { optGlobals :: !GlobalOpts \n    , optCommand :: !Command\n    }\ndata GlobalOpts = GlobalOpts { optGlobalFlag :: Bool }\n</code></pre>\n\n<p><code>GlobalOpts</code> should be a <code>Semigroup</code> and a <code>Monoid</code>, since we need to merge options seen at various different points (before the command, after the command, etc.). It should also be possible, with suitable alterations to <code>mysubparser</code> below, to require global options to be given only after commands and omit this requirement.</p>\n\n<pre><code>instance Semigroup GlobalOpts where\n  -- Code for merging option parser results from the multiple parsers run\n  -- at various different places. Note that this may be run with the default\n  -- values returned by one parser (from a location with no options present)\n  -- and the true option values from another, so it may be important\n  -- to distinguish between \"the default value\" and \"no option\" (since \"no\n  -- option\" shouldn't override another value provided earlier, while\n  -- \"user-supplied value that happens to match the default\" probably should).\n  --\n  -- In this case this doesn't matter, since the flag being provided anywhere\n  -- should be enough for it to be considered true.\n  (GlobalOpts f1) &lt;&gt; (GlobalOpts f2) = GlobalOpts (f1 || f2)\ninstance Monoid GlobalOpts where\n  -- Default values for the various options. These should probably match the\n  -- defaults used in the option declarations.\n  mempty = GlobalOpts False\n</code></pre>\n\n<p>As before, a <code>Command</code> type to represent the different possible commands:</p>\n\n<pre><code>data Command\n    = Create String\n    | Delete\n</code></pre>\n\n<p>The real magic: <code>mysubparser</code> wraps <code>hsubparser</code> to add global options and deal with merging them. It takes the parser for global options as an argument:</p>\n\n<pre><code>mysubparser :: forall a b. Monoid a\n            =&gt; Parser a\n            -&gt; Mod CommandFields b\n            -&gt; Parser (a, b)\nmysubparser globals cmds = do\n</code></pre>\n\n<p>To start with, it runs the global parser (to catch any globals given before a command): </p>\n\n<pre><code>  g1 &lt;- globals\n</code></pre>\n\n<p>It then uses <code>hsubparser</code> to get a command parser, and modifies it to also parse global options:</p>\n\n<pre><code>  (g2, r) &lt;- addGlobals $ hsubparser cmds\n</code></pre>\n\n<p>Finally, it merges the two global option sets, and returns the parsed global options and the command parser result:</p>\n\n<pre><code>  pure (g1 &lt;&gt; g2, r)\n  where \n</code></pre>\n\n<p>The <code>addGlobals</code> helper function:</p>\n\n<pre><code>        addGlobals :: forall c. Parser c -&gt; Parser (a, c)\n</code></pre>\n\n<p>If <code>NilP</code> was given, we just use <code>mempty</code> to get the default option set:</p>\n\n<pre><code>        addGlobals (NilP x) = NilP $ (mempty,) &lt;$&gt; x\n</code></pre>\n\n<p>The important case: if we have an <code>OptP</code> around an <code>Option</code> that uses a <code>CommandReader</code>, the <code>globals</code> parser is added to every command parser:</p>\n\n<pre><code>        addGlobals (OptP (Option (CmdReader n cs g) ps)) =\n          OptP (Option (CmdReader n cs $ fmap go . g) ps)\n          where go pi = pi { infoParser = (,) &lt;$&gt; globals &lt;*&gt; infoParser pi }\n</code></pre>\n\n<p>In all other cases, either just use the default option set, or merge option sets from recursive <code>Parser</code>s as appropriate:</p>\n\n<pre><code>        addGlobals (OptP o) = OptP ((mempty,) &lt;$&gt; o)\n        addGlobals (AltP p1 p2) = AltP (addGlobals p1) (addGlobals p2)\n        addGlobals (MultP p1 p2) =\n          MultP ((\\(g2, f) -&gt; \\(g1, x) -&gt; (g1 &lt;&gt; g2, f x)) &lt;$&gt; addGlobals p1)\n                (addGlobals p2)\n        addGlobals (BindP p k) = BindP (addGlobals p) $ \\(g1, x) -&gt;\n                                   BindP (addGlobals $ k x) $ \\(g2, x') -&gt;\n                                     pure (g1 &lt;&gt; g2, x')\n</code></pre>\n\n<p>Modifications to the <code>main</code> function are fairly minimal, and mostly related to using the new <code>GlobalOpts</code>.  Once a parser for <code>GlobalOpts</code> is available, passing it to <code>mysubparser</code> is quite easy:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    (opts :: Opts) &lt;- execParser optsParser\n    case optCommand opts of\n        Create name -&gt; putStrLn (\"Created the thing named \" ++ name)\n        Delete -&gt; putStrLn \"Deleted the thing!\"\n    putStrLn (\"global flag: \" ++ show (optGlobalFlag (optGlobals opts)))\n  where\n    optsParser :: ParserInfo Opts\n    optsParser =\n        info\n            (helper &lt;*&gt; programOptions)\n            (fullDesc &lt;&gt; progDesc \"optparse subcommands example\" &lt;&gt;\n             header\n                 \"optparse-sub-example - a small example program for optparse-applicative with subcommands\")\n    versionOption :: Parser (a -&gt; a)\n    versionOption = infoOption \"0.0\" (long \"version\" &lt;&gt; help \"Show version\")\n    globalOpts :: Parser GlobalOpts\n    globalOpts = versionOption &lt;*&gt;\n      (GlobalOpts &lt;$&gt; switch (long \"global-flag\" &lt;&gt; help \"Set a global flag\"))\n    programOptions :: Parser Opts\n    programOptions =\n      uncurry Opts &lt;$&gt; mysubparser globalOpts (createCommand &lt;&gt; deleteCommand)\n    createCommand :: Mod CommandFields Command\n    createCommand =\n        command\n            \"create\"\n            (info createOptions (progDesc \"Create a thing\"))\n    createOptions :: Parser Command\n    createOptions =\n        Create &lt;$&gt;\n        strArgument (metavar \"NAME\" &lt;&gt; help \"Name of the thing to create\")\n    deleteCommand :: Mod CommandFields Command\n    deleteCommand =\n        command\n            \"delete\"\n            (info (pure Delete) (progDesc \"Delete the thing\"))\n</code></pre>\n\n<p>Notice that <code>mysubparser</code> should be a quite generic/reusable component.</p>\n\n<p>This exhibits behavior closer to what you wanted:</p>\n\n<pre><code>$ ./optparse-sub-example create --global-flag HI\nCreated the thing named HI\nglobal flag: True\n$ ./optparse-sub-example --global-flag create HI\nCreated the thing named HI\nglobal flag: True\n$ ./optparse-sub-example --global-flag delete\nDeleted the thing!\nglobal flag: True\n$ ./optparse-sub-example delete --global-flag\nDeleted the thing!\nglobal flag: True\n$ ./optparse-sub-example delete\nDeleted the thing!\nglobal flag: False\n$ ./optparse-sub-example delete --version\n0.0\n$ ./optparse-sub-example create --version\n0.0\n</code></pre>\n"}], "owner": {"reputation": 35444, "user_id": 656912, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce95c01cbd4f90f014d988ae5c8a422d?s=128&d=identicon&r=PG", "display_name": "orome", "link": "https://stackoverflow.com/users/656912/orome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 1, "accepted_answer_id": 53875384, "answer_count": 1, "score": 7, "last_activity_date": 1545342904, "creation_date": 1544731535, "last_edit_date": 1545342904, "question_id": 53769310, "link": "https://stackoverflow.com/questions/53769310/how-do-i-create-and-distinguish-global-options-using-optparse-applicative", "title": "How do I create, and distinguish, global options using &#39;optparse-applicative&#39;?", "body": "<p>In my Haskell executable, created using <code>optparse-applicative</code>, I would like to have a global option for <code>--version</code> alongside the global <code>--help</code> option that is available from all subcommands. However the <a href=\"https://github.com/haskell-lang/haskell-lang/blob/master/static/tutorial/package-optparse-applicative.md#sub-commands-example\" rel=\"nofollow noreferrer\">example provided</a> (see below) for adding a <code>--version</code> option to to a CLI with subcommands results in a <code>--version</code> option that is inconsistently available</p>\n\n<pre><code>$ cli create --version\nInvalid option `--version'\n\nUsage: cli create NAME\n  Create a thing\n\n$ cli delete --version\n0.0\n</code></pre>\n\n<p>and never shows up in help for subcommands</p>\n\n<pre><code>$ cli create -h\nUsage: cli create NAME\n  Create a thing\n\nAvailable options:\n  NAME                     Name of the thing to create\n  -h,--help                Show this help text\n\n$ cli delete -h\nUsage: cli delete \n  Delete the thing\n\nAvailable options:\n  -h,--help                Show this help text\n</code></pre>\n\n<p>The behavior I would like is for <code>--version</code> to be available globally and to all subcommands:</p>\n\n<pre><code>$ cli create -h\nUsage: cli create NAME\n  Create a thing\n\nAvailable options:\n  NAME                     Name of the thing to create\n  --version                Show version\n  -h,--help                Show this help text\n\n$ cli delete -h\nUsage: cli delete \n  Delete the thing\n\nAvailable options:\n  --version                Show version\n  -h,--help                Show this help text\n\n$ cli create --version\n0.0\n\n$ cli delete --version\n0.0\n</code></pre>\n\n<p>It's not clear from the documentation how to achieve this.</p>\n\n<p>In fact, I'd ideally like to be able to clearly group options in the help output:</p>\n\n<pre><code>$ cli create -h\nUsage: cli create NAME\n  Create a thing\n\nArguments:\n  NAME                     Name of the thing to create\n\nGlobal options:\n  --version                Show version\n  -h,--help                Show this help text\n\n$ cli delete -h\nUsage: cli delete \n  Delete the thing\n\nGlobal options:\n  --version                Show version\n  -h,--help                Show this help text\n</code></pre>\n\n<p>Is there a way to achieve this using <code>optparse-applicative</code>?</p>\n\n<hr>\n\n<pre><code>{-#LANGUAGE ScopedTypeVariables#-}\n\nimport Data.Semigroup ((&lt;&gt;))\nimport Options.Applicative\n\ndata Opts = Opts\n    { optGlobalFlag :: !Bool\n    , optCommand :: !Command\n    }\n\ndata Command\n    = Create String\n    | Delete\n\nmain :: IO ()\nmain = do\n    (opts :: Opts) &lt;- execParser optsParser\n    case optCommand opts of\n        Create name -&gt; putStrLn (\"Created the thing named \" ++ name)\n        Delete -&gt; putStrLn \"Deleted the thing!\"\n    putStrLn (\"global flag: \" ++ show (optGlobalFlag opts))\n  where\n    optsParser :: ParserInfo Opts\n    optsParser =\n        info\n            (helper &lt;*&gt; versionOption &lt;*&gt; programOptions)\n            (fullDesc &lt;&gt; progDesc \"optparse subcommands example\" &lt;&gt;\n             header\n                 \"optparse-sub-example - a small example program for optparse-applicative with subcommands\")\n    versionOption :: Parser (a -&gt; a)\n    versionOption = infoOption \"0.0\" (long \"version\" &lt;&gt; help \"Show version\")\n    programOptions :: Parser Opts\n    programOptions =\n        Opts &lt;$&gt; switch (long \"global-flag\" &lt;&gt; help \"Set a global flag\") &lt;*&gt;\n        hsubparser (createCommand &lt;&gt; deleteCommand)\n    createCommand :: Mod CommandFields Command\n    createCommand =\n        command\n            \"create\"\n            (info createOptions (progDesc \"Create a thing\"))\n    createOptions :: Parser Command\n    createOptions =\n        Create &lt;$&gt;\n        strArgument (metavar \"NAME\" &lt;&gt; help \"Name of the thing to create\")\n    deleteCommand :: Mod CommandFields Command\n    deleteCommand =\n        command\n            \"delete\"\n            (info (pure Delete) (progDesc \"Delete the thing\"))\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 4, "creation_date": 1544731939, "post_id": 53769154, "comment_id": 94390578, "body": "Remember that variables are immutable in Haskell, so no matter what you do, that global <code>xs</code> will always be an empty list. Instead of trying to mutate a global, you need to recursively define the list as the return value of the function."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10787831, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Bg5R5GKmvjU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ib8uQTg9UkgHu0fDE4L04r4QZE9w/mo/photo.jpg?sz=128", "display_name": "Joe Walsh", "link": "https://stackoverflow.com/users/10787831/joe-walsh"}, "edited": false, "score": 0, "creation_date": 1544732474, "post_id": 53769233, "comment_id": 94390817, "body": "to follow up then, why does this return an error? it says the equals is unexpected.  <code>arrange_in_pairs :: Point -&gt; Point -&gt; [Point] -&gt; [(Point, Point)]</code> <code>arrange_in_pairs (x, y) (xi, yi) points</code> `\tlist1 = [(x, y)] ++ points` `\tlist2 = points ++ [(xi, yi)]`"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "reply_to_user": {"reputation": 1, "user_id": 10787831, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Bg5R5GKmvjU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ib8uQTg9UkgHu0fDE4L04r4QZE9w/mo/photo.jpg?sz=128", "display_name": "Joe Walsh", "link": "https://stackoverflow.com/users/10787831/joe-walsh"}, "edited": false, "score": 1, "creation_date": 1544733221, "post_id": 53769233, "comment_id": 94391120, "body": "@JoeWalsh The equals is unexpected because you can&#39;t just define variables like that in the middle of your function. You need to use a <code>let</code> or <code>where</code>."}, {"owner": {"reputation": 1, "user_id": 10787831, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Bg5R5GKmvjU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ib8uQTg9UkgHu0fDE4L04r4QZE9w/mo/photo.jpg?sz=128", "display_name": "Joe Walsh", "link": "https://stackoverflow.com/users/10787831/joe-walsh"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1544733428, "post_id": 53769233, "comment_id": 94391209, "body": "@DarthFennec both let and where come up as unexpected as well. im not enjoying haskell very much"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 1, "user_id": 10787831, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Bg5R5GKmvjU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ib8uQTg9UkgHu0fDE4L04r4QZE9w/mo/photo.jpg?sz=128", "display_name": "Joe Walsh", "link": "https://stackoverflow.com/users/10787831/joe-walsh"}, "edited": false, "score": 0, "creation_date": 1544733576, "post_id": 53769233, "comment_id": 94391267, "body": "@JoeWalsh I  gave you  piece for you to build your program. You can build what you asked for in the quoted text using <code>zip</code> and <code>[(x, y)] ++ points</code> and <code>points ++ [(xi,yi)]</code>. You don&#39;t have to define the auxiliary lists, but if you want to then you need to know the basics of how to use <code>let</code> or <code>where</code>."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "reply_to_user": {"reputation": 1, "user_id": 10787831, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Bg5R5GKmvjU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ib8uQTg9UkgHu0fDE4L04r4QZE9w/mo/photo.jpg?sz=128", "display_name": "Joe Walsh", "link": "https://stackoverflow.com/users/10787831/joe-walsh"}, "edited": false, "score": 0, "creation_date": 1544733812, "post_id": 53769233, "comment_id": 94391373, "body": "@JoeWalsh Perhaps you need to read a tutorial (for example, <a href=\"http://learnyouahaskell.com/syntax-in-functions#where\" rel=\"nofollow noreferrer\">this one</a>). You can&#39;t just toss code in willy-nilly and expect the language to know what you mean, you need to follow some basic syntactic structure. This is true for every programming language, not just Haskell."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 1, "user_id": 10787831, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Bg5R5GKmvjU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ib8uQTg9UkgHu0fDE4L04r4QZE9w/mo/photo.jpg?sz=128", "display_name": "Joe Walsh", "link": "https://stackoverflow.com/users/10787831/joe-walsh"}, "edited": false, "score": 0, "creation_date": 1544734188, "post_id": 53769233, "comment_id": 94391526, "body": "@Joe Walsh in any case if you want to try it out, the solution I was leading you towards is <code>zip ([(x, y)] ++ points) (points ++ [(xi,yi)])</code>."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 1, "last_activity_date": 1544731109, "creation_date": 1544731109, "answer_id": 53769233, "question_id": 53769154, "link": "https://stackoverflow.com/questions/53769154/type-error-with-function-using-tuples-and-lists/53769233#53769233", "title": "Type error with function using tuples and lists", "body": "<p><strong>Hint:</strong></p>\n\n<blockquote>\n  <p>so the first tuple is (x, y) and the first point in \"points\". the second tuple is the first point in \"points\" and the second point in \"points\" and so on until the last tuple in the list is the last point in \"points\" and (xi, yi).</p>\n</blockquote>\n\n<p>There is a function <code>zip</code> with type, </p>\n\n<pre><code>zip :: [a] -&gt; [b] -&gt; [(a, b)]\n</code></pre>\n\n<p>which pairs the elements of two lists position-wise. Also you can build lists, </p>\n\n<pre><code>list1 = [(x, y)] ++ points  \nlist2 = points ++ [(xi,yi)]\n</code></pre>\n\n<p>once you have that, you're really close.</p>\n"}, {"tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": false, "score": 2, "last_activity_date": 1544737106, "last_edit_date": 1544737106, "creation_date": 1544736746, "answer_id": 53770390, "question_id": 53769154, "link": "https://stackoverflow.com/questions/53769154/type-error-with-function-using-tuples-and-lists/53770390#53770390", "title": "Type error with function using tuples and lists", "body": "<p>The error you're getting is because of this line:</p>\n\n<pre><code>[((points !! (length xs - 1)), (points !! length xs))] arrange_in_pairs (x, y) (xi, yi) points\n</code></pre>\n\n<p>When you put spaces between things in Haskell, it means you're calling a function. In this case, the first part of the line:</p>\n\n<pre><code>[((points !! (length xs - 1)), (points !! length xs))]\n</code></pre>\n\n<p>is being interpreted as a function, being called with four arguments:</p>\n\n<pre><code>arrange_in_pairs\n(x, y)\n(xi, yi)\npoints\n</code></pre>\n\n<p>This is why it says <code>Does not match : a -&gt; b -&gt; c -&gt; d -&gt; e</code>. It's expecting a function that takes four arguments and returns a value, but instead it sees a value of type <code>[((Float,Float),(Float,Float))]</code>.</p>\n\n<hr>\n\n<p>I think what you're trying to do here is use <code>xs ++ [...]</code> to update the value of <code>xs</code>, and then return a value <code>arrange_in_pairs (x, y) (xi, yi) points</code>, perhaps? There are a number of things wrong with this:</p>\n\n<ul>\n<li>As stated, just putting a space between the two pieces of code doesn't work. Haskell interprets that as function application.</li>\n<li>The <code>++</code> operator does not update values, it simply concatenates two lists and returns the result. <code>xs</code> does not change if you do this.</li>\n<li>Indeed, in Haskell all variables are immutable, so if you define an <code>xs = []</code> in the global scope it will never have any value other than <code>[]</code>. You need to use a different approach, such as recursion.</li>\n<li>The value you're returning is a recursive call with unaltered arguments. This is equivalent to a loop that never increments its counter: it will loop forever and never get any work done.</li>\n</ul>\n\n<hr>\n\n<p>@JorgeAdriano mentioned a more concise solution, but I don't think it really helps much with understanding the principles. If I were to do this problem, my approach would be to try a recursive function. To do this, you need two things:</p>\n\n<ul>\n<li>A base case: What do we return if <code>points</code> is empty?</li>\n<li>A recursive case: We can use the first element of <code>points</code> to decide what the first element of the result should be, and we can also call the function again with different arguments so that it gives us the rest of the output.</li>\n</ul>\n\n<p>Recursive functions over lists depend on the cons (<code>:</code>) constructor. I bring this up because I notice you don't use it in your code, but it's quite important:</p>\n\n<ul>\n<li><code>x:xs</code> returns a list where the first element is <code>x</code>, and the rest of the elements are the elements in the list <code>xs</code>.</li>\n<li>When used as an argument (in a pattern match), <code>x:xs</code> binds the first element of the list argument to <code>x</code>, and the rest of the elements to the list <code>xs</code>. If the list is empty, <code>x:xs</code> does not match.</li>\n<li>When used as an argument (in a pattern match), <code>[]</code> matches only if the list is empty.</li>\n</ul>\n\n<hr>\n\n<p>The base case (<code>points</code> is empty) is that a single segment from the starting to the ending point is returned. This can be written:</p>\n\n<pre><code>arrange_in_pairs start end [] = [(start, end)]\n</code></pre>\n\n<p>The recursive case is more complicated. We know the first element needs to be a segment from the starting point to the first element in <code>points</code>, so we can begin with this:</p>\n\n<pre><code>arrange_in_pairs start end (x:xs) = (start, x) : ???\n</code></pre>\n\n<p>Instead of binding the third argument to <code>points</code>, we're binding its first element to <code>x</code> and the rest to the list <code>xs</code>. The return value is the first element (a segment from <code>start</code> to <code>x</code>), consed to the rest of the elements (a list we haven't defined yet).</p>\n\n<p>So far, so good. The <code>???</code> should be a recursive call to <code>arrange_in_pairs</code>, and it should be called in such a way that the first segment it returns is the next segment we need. The next segment we need is from <code>x</code> to the first element of <code>xs</code>, so we need to pass <code>x</code> in place of <code>start</code> and <code>xs</code> in place of <code>points</code>:</p>\n\n<pre><code>arrange_in_pairs start end (x:xs) = (start, x) : arrange_in_pairs x end xs\n</code></pre>\n\n<p>The full function looks like this:</p>\n\n<pre><code>arrange_in_pairs :: Point -&gt; Point -&gt; [Point] -&gt; [(Point, Point)]\narrange_in_pairs start end [] = [(start, end)]\narrange_in_pairs start end (x:xs) = (start, x) : arrange_in_pairs x end xs\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10787831, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Bg5R5GKmvjU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ib8uQTg9UkgHu0fDE4L04r4QZE9w/mo/photo.jpg?sz=128", "display_name": "Joe Walsh", "link": "https://stackoverflow.com/users/10787831/joe-walsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1544796338, "creation_date": 1544730770, "last_edit_date": 1544796338, "question_id": 53769154, "link": "https://stackoverflow.com/questions/53769154/type-error-with-function-using-tuples-and-lists", "title": "Type error with function using tuples and lists", "body": "<p>The problem code follows below.</p>\n\n<pre><code>type Point = (Float, Float)\nxs = []\narrange_in_pairs :: Point -&gt; Point -&gt; [Point] -&gt; [(Point, Point)]\narrange_in_pairs (x, y) (xi, yi) points \n    | length xs == 0 = xs ++ [((x, y), (points !! 0))]\n    | (length xs - 1) /= length points = xs ++ [((points !! (length xs - 1)), (points !! length xs))] arrange_in_pairs (x, y) (xi, yi) points\n    | otherwise = xs ++ [((points !! length xs), (xi, yi))] xs\n</code></pre>\n\n<p>The idea is a point is a co-ordinate like on a graph. (x, y) is the starting point, (xi, yi) is the end point and \"points\" is a list of points in between them. The function is supposed to take each pair of points as a tuple and store them in a list. so the first tuple is (x, y) and the first point in \"points\". the second tuple is the first point in \"points\" and the second point in \"points\" and so on until the last tuple in the list is the last point in \"points\" and (xi, yi). Any help really appreciated.</p>\n\n<p>the error im getting is:</p>\n\n<pre><code>*** Expression     : [(points !! (length xs - 1),points !! length xs)] arrange_in_pairs (x,y) (xi,yi) points\n*** Term           : [(points !! (length xs - 1),points !! length xs)]\n*** Type           : [((Float,Float),(Float,Float))]\n*** Does not match : a -&gt; b -&gt; c -&gt; d -&gt; e\n</code></pre>\n"}, {"tags": ["haskell", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1544741413, "post_id": 53769720, "comment_id": 94394186, "body": "Great ! thank you for the reference, let&#39;s hope that make it through"}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 3, "last_activity_date": 1544733557, "creation_date": 1544733557, "answer_id": 53769720, "question_id": 53769147, "link": "https://stackoverflow.com/questions/53769147/binding-a-type-with-proxy-s-vs-binding-a-type-with-forall/53769720#53769720", "title": "Binding a type with `Proxy s` vs binding a type with forall", "body": "<p>This is a known limitation of GHC\u2019s implementation of visible type application. Specifically, <code>Proxy</code> is sometimes still necessary in order to allow the argument to a higher-rank function (such as your <code>toto</code> function) to access a type variable.</p>\n\n<p>There is a GHC proposal to add a solution to this problem, in the form of <a href=\"https://github.com/ghc-proposals/ghc-proposals/pull/155\" rel=\"nofollow noreferrer\">type variable bindings in lambda-expressions</a>. Using the syntax from the proposal, your <code>toto</code> function could be written as</p>\n\n<pre><code>toto k = toto (\\@s -&gt; k @s)\n</code></pre>\n\n<p>to locally bind the <code>s</code> variable. Sadly, this proposal has not yet been implemented.</p>\n\n<p>In the meantime, for higher-rank functions like these, I think you just have to use <code>Proxy</code>. Sorry.</p>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 2, "accepted_answer_id": 53769720, "answer_count": 1, "score": 2, "last_activity_date": 1544741442, "creation_date": 1544730740, "last_edit_date": 1544741442, "question_id": 53769147, "link": "https://stackoverflow.com/questions/53769147/binding-a-type-with-proxy-s-vs-binding-a-type-with-forall", "title": "Binding a type with `Proxy s` vs binding a type with forall", "body": "<p>in the following example, it is not clear to me why <code>toto</code> would fail, while <code>tata</code> would work.</p>\n\n<p>Are there any explanation to this ?</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes  #-}\n{-# LANGUAGE  TypeFamilies, KindSignatures, FlexibleContexts #-}\n{-# LANGUAGE TypeApplications, FunctionalDependencies, MultiParamTypeClasses #-}\n{-# LANGUAGE ScopedTypeVariables , GADTs, MultiParamTypeClasses, RankNTypes                #-}\n{-# LANGUAGE TypeOperators, UnicodeSyntax, DataKinds              #-}\n\nimport Data.Proxy\n\ndata KNat where\nclass ReflectNum (s :: KNat) where\n\ntoto \u2237 (\u2200 (s :: KNat). ReflectNum s \u21d2 Int) \u2192 Int\ntoto k = toto k\n\ntata \u2237 (\u2200 (s :: KNat). ReflectNum s \u21d2 Proxy s -&gt; Int) \u2192 Int\ntata k = tata (\\(p :: Proxy s) -&gt; k p)\n</code></pre>\n\n<p>The error being</p>\n\n<pre><code>SO.hs:14:15: error:\n    \u2022 Could not deduce (ReflectNum s0) arising from a use of \u2018k\u2019\n      from the context: ReflectNum s\n        bound by a type expected by the context:\n                   forall (s :: KNat). ReflectNum s =&gt; Int\n        at SO.hs:14:10-15\n      The type variable \u2018s0\u2019 is ambiguous\n    \u2022 In the first argument of \u2018toto\u2019, namely \u2018k\u2019\n      In the expression: toto k\n      In an equation for \u2018toto\u2019: toto k = toto k\n   |\n14 | toto k = toto k\n   |               ^\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1544727856, "post_id": 53768506, "comment_id": 94388798, "body": "Your function looks fine to me, so I don\u2019t have any idea what could be going wrong. Could you possibly post the full error message, along with the command you ran that produced it?"}, {"owner": {"reputation": 97, "user_id": 6392671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3aae406e02d04e57b6ba2f9d77ea18c?s=128&d=identicon&r=PG&f=1", "display_name": "Memo", "link": "https://stackoverflow.com/users/6392671/memo"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1544728307, "post_id": 53768506, "comment_id": 94388985, "body": "I&#39;m sorry surprisingly it works now. Do you know an answer on my second question?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1544728382, "post_id": 53768506, "comment_id": 94389015, "body": "This smells rather strongly like homework, so I\u2019m reluctant to just give you an answer, but I can tell you that you probably want to use <i>guards</i>."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1544728398, "post_id": 53768506, "comment_id": 94389021, "body": "&quot;how to rewrite this function in Pattern matching&quot; You&#39;re already using pattern matching. The only change I&#39;d make is using guards instead of an <code>if&#47;then&#47;else</code>."}, {"owner": {"reputation": 97, "user_id": 6392671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3aae406e02d04e57b6ba2f9d77ea18c?s=128&d=identicon&r=PG&f=1", "display_name": "Memo", "link": "https://stackoverflow.com/users/6392671/memo"}, "edited": false, "score": 0, "creation_date": 1544728785, "post_id": 53768506, "comment_id": 94389192, "body": "Ok thanks, It is not a Homework but it is my own exercise."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1544735515, "post_id": 53768506, "comment_id": 94392085, "body": "Did you accidentally use <code>myeven</code> or something similar, instead of <code>myEven</code>, at some point?"}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1544728645, "creation_date": 1544728645, "answer_id": 53768669, "question_id": 53768506, "link": "https://stackoverflow.com/questions/53768506/haskell-error-variable-not-in-scope-myeven/53768669#53768669", "title": "Haskell error: Variable not in scope: myEven", "body": "<blockquote>\n  <p>Why is my variable not in scope?</p>\n</blockquote>\n\n<p>Perhaps you failed to load the file or perhaps something else, hard to say without seeing the error and your invocation.  Either way, glad it's working.</p>\n\n<blockquote>\n  <p>Another question, how to rewrite this function in Pattern matching</p>\n</blockquote>\n\n<p>You are already using pattern matching on the list.  Do you want to pattern match on the <code>Int</code>? You can't, for example, match on bits but I can see how that would be neat <code>(highBits # 0b0) : xs = x : myEven xs</code>.</p>\n\n<p>Instead you can use guards:</p>\n\n<pre><code>myEven ::[Int] -&gt; [Int]\nmyEven [] = []\nmyEven (x:xs) | x `mod` 2 == 0 = x : myEven xs\n              | otherwise      = myEven xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 1, "last_activity_date": 1544739957, "creation_date": 1544739957, "answer_id": 53770955, "question_id": 53768506, "link": "https://stackoverflow.com/questions/53768506/haskell-error-variable-not-in-scope-myeven/53770955#53770955", "title": "Haskell error: Variable not in scope: myEven", "body": "<blockquote>\n  <p>Another question, how to rewrite this function in Pattern matching</p>\n</blockquote>\n\n<p>You're already pattern matching on what's available for pattern matching. In any case, just for fun (I don't recommend this) you can turn those guards into patterns using ghc extensions. </p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\n{-# LANGUAGE ViewPatterns #-}\n\npattern Even n &lt;- (\\x -&gt; x &lt;$ guard (x `mod` 2 == 0) -&gt; Just n) where Even n = n\npattern Odd  n &lt;- (\\x -&gt; x &lt;$ guard (x `mod` 2 == 1) -&gt; Just n) where Odd  n = n \n\nmyEven ::[Int] -&gt; [Int]\nmyEven [] = []\nmyEven (Even x :xs) = x : myEven xs\nmyEven (Odd  x :xs) = myEven xs\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 6392671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3aae406e02d04e57b6ba2f9d77ea18c?s=128&d=identicon&r=PG&f=1", "display_name": "Memo", "link": "https://stackoverflow.com/users/6392671/memo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 53768669, "answer_count": 2, "score": 1, "last_activity_date": 1544739957, "creation_date": 1544727757, "last_edit_date": 1544727769, "question_id": 53768506, "link": "https://stackoverflow.com/questions/53768506/haskell-error-variable-not-in-scope-myeven", "title": "Haskell error: Variable not in scope: myEven", "body": "<p>Why is my variable not in scope? \nIt seems everything is ok, but it does not work</p>\n\n<pre><code>myEven::[Int] -&gt; [Int]\nmyEven [] = []\nmyEven (x:xs) = if x `mod` 2 == 0 then x:myEven xs \n                else myEven xs\n</code></pre>\n\n<p>I am testing now and it's working but without first line. \nWhere is my mistake?</p>\n\n<p>Another question, how to rewrite this function in Pattern matching</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1544727489, "post_id": 53768273, "comment_id": 94388633, "body": "You might want to read this (not yet complete, just started yesterday) series of blog posts, starting with <a href=\"https://harry.garrood.me/blog/down-with-show-part-1/\" rel=\"nofollow noreferrer\">harry.garrood.me/blog/down-with-show-part-1</a>. It specifically mentions the goal of having one &quot;obvious&quot; instance per type."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1544727740, "post_id": 53768273, "comment_id": 94388735, "body": "Have you considered using backpack to solve this problem?"}], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 1, "last_activity_date": 1544729392, "creation_date": 1544729392, "answer_id": 53768839, "question_id": 53768273, "link": "https://stackoverflow.com/questions/53768273/when-designing-a-rpc-library-how-can-i-allow-users-change-serialization-format/53768839#53768839", "title": "When designing a RPC library, how can I allow users change serialization format?", "body": "<p>How likely is it that the external service provider changes their JSON format without changing the semantics?  If I need to write a new Haskell type because there are more / fewer fields, then I have a new type, and can add new JSON instances.</p>\n\n<p>If such changes are rare, it might still be worth the convenience of instance-directed resolution most of the time.  I can vendor your library or make a newtype during the occasional weeks when I must have a new feature and you haven't yet updated the library.</p>\n\n<p>If you don't want to bless the JSON instances as canonical, but still want the convenient Template Haskell derived functions, I believe <a href=\"https://hackage.haskell.org/package/aeson-1.4.2.0/docs/Data-Aeson-TH.html#v:mkToJSON\" rel=\"nofollow noreferrer\">mkJSON</a> and <code>mkParseJSON</code> generate the implementation, which you can export as ordinary functions.</p>\n\n<p>I always appreciate libraries that provide both type-class directed versions of their interface, and versions with explicit function parameters.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1544729392, "creation_date": 1544726690, "last_edit_date": 1544727088, "question_id": 53768273, "link": "https://stackoverflow.com/questions/53768273/when-designing-a-rpc-library-how-can-i-allow-users-change-serialization-format", "title": "When designing a RPC library, how can I allow users change serialization format?", "body": "<p>I feel that type class instances should be defined only when there is a single valid implementation for them and serialization isn't one of these cases. </p>\n\n<p>Primarily because serialization is a gateway to IO and things happen on the other side.</p>\n\n<p>So, suppose I want to create a convenience library that parses JSON input that comes from some external service provider. How can I allow users to adapt the format if the provider makes an syntactic change out of the blue?</p>\n\n<p>I feel that general answer is to let user \"pass record of functions around\"...\nbut derived <code>FromJSON</code> instances are so convenient to provide!</p>\n\n<p>Is having <code>FromJSON</code> instance a good thing? Should my library use it? I'm worried about instance \"leaking\" since instances are global. Can I not export it but still offer default serialization for users?</p>\n"}, {"tags": ["haskell", "types", "type-level-computation"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1544726484, "post_id": 53768153, "comment_id": 94388215, "body": "Can you provide a concrete example of something you would like to rewrite using <code>TypeApplications</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1544730058, "post_id": 53768406, "comment_id": 94389726, "body": "I guess that&#39;s another problem, even though it stands in the way of getting rid of those <code>Proxy</code>"}], "tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 3, "last_activity_date": 1544727357, "creation_date": 1544727357, "answer_id": 53768406, "question_id": 53768153, "link": "https://stackoverflow.com/questions/53768153/visible-type-application-in-haskell-how-to-bind-the-type/53768406#53768406", "title": "Visible type application in Haskell : how to bind the type", "body": "<blockquote>\n  <p>But if we are <em>building</em> a polymorphic value, is there a way to bind the type at which we are called, apart with an argument of type <code>Proxy s</code>?</p>\n</blockquote>\n\n<p>If I understand correctly, what you mean by this is that you wish to define a polymorphic binding that <em>accepts</em> a type argument, which is intended to be supplied using visible type application. The answer to that question is to use <code>forall</code>.</p>\n\n<p>If you have some function <code>f</code> written using <code>Proxy s</code>, such as</p>\n\n<pre><code>f :: Proxy s -&gt; X -&gt; Y\n</code></pre>\n\n<p>then you can eliminate the <code>Proxy</code> argument by enabling <code>AllowAmbiguousTypes</code> and <code>ScopedTypeVariables</code> and using an explicit <code>forall</code> instead:</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes, ScopedTypeVariables #-}\nf :: forall s. X -&gt; Y\n</code></pre>\n\n<p>The <code>s</code> type variable will be bound within the body of <code>f</code>.</p>\n"}], "owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 53768406, "answer_count": 1, "score": 2, "last_activity_date": 1544728962, "creation_date": 1544726121, "last_edit_date": 1544728962, "question_id": 53768153, "link": "https://stackoverflow.com/questions/53768153/visible-type-application-in-haskell-how-to-bind-the-type", "title": "Visible type application in Haskell : how to bind the type", "body": "<p>With visible type application, one can specify at which type we \"call\" a polymorphic value.</p>\n\n<p>This allow to remove values like <code>Proxy :: Proxy s</code> just to bind the type <code>s</code> when we are a user, we just write <code>myPolyValue @ s</code></p>\n\n<p>But if we are <em>building</em> a polymorphic value, is there a way to bind the type at which we are called, apart with an argument of type  <code>Proxy s</code> ?</p>\n\n<p><strong>Example</strong>  I use <code>VisibleTypeApplication</code> to force a polymorphic type, but I have no idea on how to bind the type I was binded to, except via a <code>Proxy s</code> argument :</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver nightly-2018-12-12 script --package base-unicode-symbols --package unicode-prelude --package constraints\n{-# LANGUAGE AllowAmbiguousTypes,GeneralizedNewtypeDeriving  #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE TypeFamilies, KindSignatures #-}\n{-# LANGUAGE FlexibleContexts , TypeApplications #-}\n{-# LANGUAGE InstanceSigs , FunctionalDependencies #-}\n{-# LANGUAGE MultiParamTypeClasses , ScopedTypeVariables #-}\n{-# LANGUAGE GADTs , MultiParamTypeClasses     #-}\n{-# LANGUAGE RankNTypes , TypeOperators             #-}\n{-# LANGUAGE UnicodeSyntax,DataKinds              #-}\n\nmodule ImplicitConfigurationFirstPart where\n\nimport Data.Proxy\n\ndata KNat where\n  Zero :: KNat\n  Twice :: KNat -&gt; KNat\n  Succ :: KNat -&gt; KNat\n  Pred :: KNat -&gt; KNat\n\nclass ReflectNum (s :: KNat) where reflectNum \u2237 Num a \u21d2 Proxy s -&gt; a\ninstance                ReflectNum  'Zero      where reflectNum _ = 0\ninstance ReflectNum s \u21d2 ReflectNum ('Pred  s) where reflectNum _ = (reflectNum (Proxy @ s)) - 1\ninstance ReflectNum s \u21d2 ReflectNum ('Succ  s) where reflectNum _ = (reflectNum (Proxy @ s)) + 1\ninstance ReflectNum s \u21d2 ReflectNum ('Twice s) where reflectNum _ = (reflectNum (Proxy @ s)) * 2\n\nreifyIntegral \u2237 (Integral a) \u21d2 a \u2192 (\u2200 (s :: KNat). ReflectNum s \u21d2 Proxy s -&gt; w) \u2192 w\nreifyIntegral i k = case quotRem i 2 of\n  (0,0)  \u2192 k $ Proxy @ 'Zero\n  (j,0)  \u2192 reifyIntegral j (\\(p :: Proxy s) -&gt; let n = reflectNum p in\n                                               k $ Proxy @ ('Twice s) )\n  (j,1)  \u2192 reifyIntegral j (\\(_ :: Proxy s) -&gt; k $ Proxy @ ('Succ('Twice s)))\n  (j,-1) \u2192 reifyIntegral j (\\(_ :: Proxy s) -&gt; k $ Proxy @ ('Pred('Twice s)))\n</code></pre>\n\n<p><strong>Attempt1</strong> \nIn this example, the the first case at the <code>Zero</code> index works fine.</p>\n\n<p>But the second one can't prove that <code>'Twice s</code> is part of <code>ReflectNum</code>. It should though, as <code>s</code> at which k1 will be applied at, verifies <code>ReflectNum</code>, so that <code>'Twice s</code> verifies it, and <code>k</code>, being polymorphic in <code>s</code> provided we have a proof of <code>ReflectNum s</code>, can be called.</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes,GeneralizedNewtypeDeriving  #-}\n{-# LANGUAGE  TypeFamilies, KindSignatures, FlexibleContexts #-}\n{-# LANGUAGE TypeApplications, FunctionalDependencies, MultiParamTypeClasses #-}\n{-# LANGUAGE ScopedTypeVariables , GADTs, MultiParamTypeClasses, RankNTypes                #-}\n{-# LANGUAGE TypeOperators, UnicodeSyntax, DataKinds              #-}\n{-# LANGUAGE UndecidableSuperClasses    #-}\nmodule ImplicitConfigurationFirstPart where\n\nimport Data.Proxy\n\ndata KNat where\n  Zero :: KNat\n  Twice :: KNat -&gt; KNat\n\nclass ReflectNum (s :: KNat) where reflectNum \u2237 Num a \u21d2 Proxy s -&gt; a\ninstance                ReflectNum  'Zero      where reflectNum _ = 0\ninstance ReflectNum s \u21d2 ReflectNum ('Twice s)  where reflectNum _ = (reflectNum (Proxy @ s)) * 2\n\nreifyIntegral2 \u2237 forall a w. (Integral a) \u21d2 a \u2192 (\u2200 (s :: KNat). ReflectNum s \u21d2 w) \u2192 w\nreifyIntegral2 i k = case quotRem i 2 of\n  (0,0)  \u2192 k @ 'Zero\n  (j,0)  \u2192 reifyIntegral2 j k1\n\n  where k1 :: forall (s :: KNat). ReflectNum s \u21d2 w\n        k1 = k @ ('Twice s)\n</code></pre>\n"}, {"tags": ["haskell", "servant"], "answers": [{"comments": [{"owner": {"reputation": 1044, "user_id": 193424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba6dfa8271fb1cd0c475a2c0626853?s=128&d=identicon&r=PG", "display_name": "Alp Mestanogullari", "link": "https://stackoverflow.com/users/193424/alp-mestanogullari"}, "edited": false, "score": 0, "creation_date": 1544783214, "post_id": 53765488, "comment_id": 94406876, "body": "Perhaps reading the cookbook recipe will help make sense of those haddocks (and the corresponding ones in -server, -client, ...): <a href=\"https://haskell-servant.readthedocs.io/en/stable/cookbook/generic/Generic.html\" rel=\"nofollow noreferrer\">haskell-servant.readthedocs.io/en/stable/cookbook/generic/&hellip;</a>"}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": false, "score": 1, "last_activity_date": 1544716458, "last_edit_date": 1544716458, "creation_date": 1544716105, "answer_id": 53765488, "question_id": 53765021, "link": "https://stackoverflow.com/questions/53765021/add-a-common-root-path-before-an-inner-api-with-servant/53765488#53765488", "title": "add a common root path before an inner Api with Servant", "body": "<p>Yes, you can add the prefix to both branches after combining them:</p>\n\n<pre><code>type GSDMonitoringApi = \n    \"gsd\" :&gt; \"monitoring\" :&gt; \n    ( FetchWorkspaceIdsCreated :&lt;|&gt; FetchGsdCommandsByWorkspaceId )\n\ntype FetchWorkspaceIdsCreated = \"workspaceIds\" :&gt; Get '[JSON] [Persisted WorkspaceId]\ntype FetchGsdCommandsByWorkspaceId = \"commands\" :&gt; Capture \"workspaceId\" WorkspaceId :&gt; Get '[JSON] [Persisted GsdCommand]\n</code></pre>\n\n<p>As a semi-related point, I recommend that you check out <a href=\"https://www.stackage.org/haddock/lts-12.22/servant-0.14.1/Servant-API-Generic.html\" rel=\"nofollow noreferrer\"><code>Servant.API.Generic</code></a>. Combining APIs with <code>:&lt;|&gt;</code> like that becomes very ugly very quickly. <code>Servant.API.Generic</code> solves that to some extent.</p>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1544716458, "creation_date": 1544714520, "question_id": 53765021, "link": "https://stackoverflow.com/questions/53765021/add-a-common-root-path-before-an-inner-api-with-servant", "title": "add a common root path before an inner Api with Servant", "body": "<p>I have the following API :</p>\n\n<pre><code>type GSDMonitoringApi =   FetchWorkspaceIdsCreated\n                    :&lt;|&gt;  FetchGsdCommandsByWorkspaceId\n\ntype FetchWorkspaceIdsCreated =      \"gsd\" :&gt; \"monitoring\" :&gt; \"workspaceIds\" :&gt; Get '[JSON] [Persisted WorkspaceId]\ntype FetchGsdCommandsByWorkspaceId = \"gsd\" :&gt; \"monitoring\" :&gt; \"commands\" :&gt; Capture \"workspaceId\" WorkspaceId :&gt; Get '[JSON] [Persisted GsdCommand]\n</code></pre>\n\n<p>is it possible to factor out <code>\"gsd\" :&gt; \"monitoring\" :&gt;</code> and put it into GSDMonitoringApi only once ?</p>\n\n<p>P.S : Servant is amazingly well done !</p>\n"}, {"tags": ["haskell", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1544778553, "post_id": 53763870, "comment_id": 94404137, "body": "Seems like there is a typo in your type-deduction: when you state that <code>(&lt;*&gt;) fmap h x  :: f c</code> (just beyond the &#39;Edit&#39; section), you probably mean that <code>(&lt;*&gt;) fmap h x :: (f b -&gt; f c)</code>?"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1544788888, "post_id": 53763870, "comment_id": 94409847, "body": "@SerejaBogolubov ops! fixed. Thank you!"}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1544793448, "post_id": 53763870, "comment_id": 94412186, "body": "bth, nice consistency proof. is it all by your own or it comes from some science paper? in case it does, can you please share that one too?"}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 1, "creation_date": 1544793831, "post_id": 53763870, "comment_id": 94412384, "body": "thanks! nah I just wrote it down. For the first part, search for &quot;type inference&quot; and &quot;unification&quot;, for the second you need to know the <a href=\"https://en.wikibooks.org/wiki/Haskell/Applicative_functors#Applicative_functor_laws\" rel=\"nofollow noreferrer\">applicative laws</a> and then it&#39;s a bit of algebraic manipulation."}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 5, "last_activity_date": 1545236777, "last_edit_date": 1545236777, "creation_date": 1544710623, "answer_id": 53763870, "question_id": 53763376, "link": "https://stackoverflow.com/questions/53763376/definition-for-the-applicative-functor/53763870#53763870", "title": "`(&lt;*&gt;)` definition for the Applicative functor?", "body": "<blockquote>\n  <p>1) <code>(&lt;*&gt;)</code> is defined in terms of <code>liftA2</code>, where <code>liftA2</code> is defined in terms of <code>(&lt;*&gt;)</code>. How does it work? I see no obvious \"recursion-break\" case...</p>\n</blockquote>\n\n<p>It's not recursion. In your instance of <code>Applicative</code> you can either define both of them or just one. If you define just <code>(&lt;*&gt;)</code> then <code>liftA2</code> is defined from <code>(&lt;*&gt;)</code>, and vice versa.</p>\n\n<blockquote>\n  <p>2) <code>id</code> is an <code>a -&gt; a</code> function. Why is it passed into <code>liftA2</code> as an <code>(a -&gt; b -&gt; c)</code> function? </p>\n</blockquote>\n\n<p>Unification works as follows, </p>\n\n<blockquote>\n<pre><code>(&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n(&lt;*&gt;) = liftA2 id\n\nliftA2 :: (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\n</code></pre>\n</blockquote>\n\n<pre><code>id     :  u -&gt; u \nliftA2 : (a -&gt; (b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\n------------------------------------------------------\nu = a\nu = b-&gt;c\n\nid     :  (b-&gt;c) -&gt; (b-&gt;c)\nliftA2 : ((b-&gt;c) -&gt; (b-&gt;c)) -&gt; f (b-&gt;c) -&gt; f b -&gt; f c\n------------------------------------------------------\n\nliftA2 id : f (b-&gt;c) -&gt; f b -&gt; f c\n</code></pre>\n\n<blockquote>\n  <p>3.</p>\n\n<pre><code>liftA2 :: (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\nliftA2 h x = (&lt;*&gt;) (fmap h x)\n</code></pre>\n</blockquote>\n\n<p>Renamed the first argument from <code>f</code> to <code>h</code>, to prevent confusion since <code>f</code> also shows in the type </p>\n\n<pre><code>h    :: a -&gt; (b -&gt; c)\nx    :: f a\nfmap :: (a -&gt; d) -&gt; f a -&gt; f d\n------------------------------\nd  = b -&gt; c\nh    :: a -&gt; (b-&gt;c)\nx    :: f a\nfmap :: (a -&gt; (b-&gt;c)) -&gt; f a -&gt; f (b-&gt;c)\n----------------------------------------\nfmap h x :: f (b -&gt; c)\n\n\nfmap h x :: f (b -&gt; c)\n(&lt;*&gt;)    :: f (b -&gt; c) -&gt; f b -&gt; f c\n-------------------------------------\n(&lt;*&gt;) fmap h x  :: f b -&gt; f c\n</code></pre>\n\n<hr>\n\n<p><strong>Edit:</strong></p>\n\n<p><strong>Consistency</strong> </p>\n\n<p>To show the consistency of both formulas, first lets first rewrite <code>liftA2</code> into something simpler. We can use the formula below to get rid of <code>fmap</code> and use only <code>pure</code> and <code>&lt;*&gt;</code></p>\n\n<pre><code>fmap h x = pure h &lt;*&gt; x\n</code></pre>\n\n<p>and it's best to put all points in the definition. So we get, </p>\n\n<pre><code>  liftA2 h u v  \n= (&lt;*&gt;) (fmap h u) v\n= fmap h u &lt;*&gt; v\n= pure h &lt;*&gt; u &lt;*&gt; v\n</code></pre>\n\n<p>So we want to check the consistency of, </p>\n\n<pre><code>u &lt;*&gt; v      = liftA2 id u v \nliftA2 h u v = pure h &lt;*&gt; u &lt;*&gt; v\n</code></pre>\n\n<p>For the first we need the property that <code>pure id &lt;*&gt; u = u</code></p>\n\n<pre><code>  u &lt;*&gt; v \n= liftA2 id u v \n= pure id &lt;*&gt; u &lt;*&gt; v\n= u &lt;*&gt; v\n</code></pre>\n\n<p>For the second we need a property of <code>liftA2</code>. Properties of applicative are usually given in terms of <code>pure</code> and <code>&lt;*&gt;</code> so we need to derive it first. The required formula is derived from <code>pure h &lt;*&gt; pure x = pure (h x)</code>.</p>\n\n<pre><code>  liftA2 h (pure x) v \n= pure h &lt;*&gt; pure x &lt;*&gt; v \n= pure (h x) &lt;*&gt; v\n= liftA2 (h x) v   \n</code></pre>\n\n<p>This requires <code>h : t -&gt; a -&gt; b -&gt; c</code>. The proof of consistency becomes, </p>\n\n<pre><code>  liftA2 h u v \n= pure h &lt;*&gt; u &lt;*&gt; v\n= pure h `liftA2 id` u `liftA2 id` v   \n= liftA2 id (liftA2 id (pure h) u) v \n= liftA2 id (liftA2 h u) v \n= liftA2 h u v \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1544712783, "post_id": 53764050, "comment_id": 94380709, "body": "Apparently <code>($)</code> is not used in that particular place due to GHC-specific shenanigans -- see the comment <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html\" rel=\"nofollow noreferrer\">at the beginning of <code>GHC.Base</code></a>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1544716712, "last_edit_date": 1544716712, "creation_date": 1544711188, "answer_id": 53764050, "question_id": 53763376, "link": "https://stackoverflow.com/questions/53763376/definition-for-the-applicative-functor/53764050#53764050", "title": "`(&lt;*&gt;)` definition for the Applicative functor?", "body": "<p>Here I have to disagree with the GHC devs on their coding style :)</p>\n\n<p>I would like to argue that one should never write</p>\n\n<pre><code>ap = liftA2 id\n</code></pre>\n\n<p>but, instead, use the equivalent</p>\n\n<pre><code>ap = liftA2 ($)\n</code></pre>\n\n<p>since the latter makes it clear that we are lifting the application operation.</p>\n\n<p>(Actually, for very technical reasons GHC devs can not use <code>$</code> here in this internal module, as pointed out below in the comments. So, at least they have a very good reason for their choice.)</p>\n\n<p>Now, you might wonder why <code>id</code> can be used instead of <code>$</code>. Formally, we have</p>\n\n<pre><code>($) f x\n= f x\n= (id f) x\n= id f x\n</code></pre>\n\n<p>hence, eta-contracting <code>x</code> then <code>f</code>, we get <code>($) = id</code>.</p>\n\n<p>Indeed, <code>($)</code> is a \"special case\" of <code>id</code>.</p>\n\n<pre><code>id :: a -&gt; a\n-- choose a = (b -&gt; c) as a special case\nid :: (b -&gt; c) -&gt; (b -&gt; c)\nid :: (b -&gt; c) -&gt; b -&gt; c\n($):: (b -&gt; c) -&gt; b -&gt; c\n</code></pre>\n\n<p>Hence, the main difference is: <code>id</code> is the identity on any type <code>a</code>, while <code>($)</code> is the \"identity\" on any functional type <code>b -&gt; c</code>. The latter is best visualized as a binary function (application), but it can equivalently be considered a unary function (identity) on a function type.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1544711228, "creation_date": 1544711228, "answer_id": 53764062, "question_id": 53763376, "link": "https://stackoverflow.com/questions/53763376/definition-for-the-applicative-functor/53764062#53764062", "title": "`(&lt;*&gt;)` definition for the Applicative functor?", "body": "<blockquote>\n  <p>1) <code>(&lt;*&gt;)</code> is defined in terms of <code>liftA2</code>, where <code>liftA2</code> is defined in terms of <code>(&lt;*&gt;)</code>. How does it work? I see no obvious \"recursion-break\" case...</p>\n</blockquote>\n\n<p>Each instance is responsible for overriding at least one of the two. This is documented in a machine-readable way in the pragma at the top of the class:</p>\n\n<pre><code>{-# MINIMAL pure, ((&lt;*&gt;) | liftA2) #-}\n</code></pre>\n\n<p>This pragma announces that instance writers must define at least the <code>pure</code> function and at least one of the other two.</p>\n\n<blockquote>\n  <p><code>id</code> is an <code>a -&gt; a</code> function. Why is it passed into <code>liftA2</code> as an <code>(a -&gt; b -&gt; c)</code> function?</p>\n</blockquote>\n\n<p>If <code>id :: a -&gt; a</code>, we can choose <code>a ~ d -&gt; e</code> to get <code>id :: (d -&gt; e) -&gt; d -&gt; e</code>. Traditionally, this particular specialization of <code>id</code> is spelled <code>($)</code> -- maybe you've seen that one before!</p>\n\n<blockquote>\n  <p>3) ...</p>\n</blockquote>\n\n<p>I don't... actually see any contradiction set up in the facts you state. So I'm not sure how to explain away the contradiction for you. However, you have a few infelicities in your notation that might be related to mistakes in your thinking, so let's talk about them briefly.</p>\n\n<p>You write</p>\n\n<blockquote>\n  <p>Thus <code>(&lt;*&gt;) (fmap id x)</code> = <code>(&lt;*&gt;) (x)</code> where <code>x</code> = <code>f a</code>.</p>\n</blockquote>\n\n<p>This is not quite right; the <em>type</em> of <code>x</code> is <code>f a</code> for some <code>Functor f</code>, but it is not necessarily <em>equal to</em> <code>f a</code>.</p>\n\n<blockquote>\n  <p>by the way, how can <code>a</code>-typifying of the functor can be explained from the pure category theory's point of view? functor is just a mapping between categories, it has no further \"typification\"... seems like it is better to say - \"a container of type a with an (endo)functor defined for each instance of assumed category Hask of well-defined Haskell types</p>\n</blockquote>\n\n<p>A functor constitutes two things: a mapping from objects to objects, and a mapping from arrows to arrows that is compatible with the object mapping. In a Haskell <code>Functor</code> instance declaration like</p>\n\n<pre><code>instance Functor F where fmap = fmapForF\n</code></pre>\n\n<p>the <code>F</code> is the mapping from objects to objects (objects in both the source and target categories are types, and <code>F</code> is a thing which takes a type and produces a type) and the <code>fmapForF</code> is the mapping from arrows to arrows.</p>\n\n<blockquote>\n  <p>I run <code>:t \\x -&gt; (&lt;*&gt;) (fmap id x)</code> in the gchi, it spits out something mind-blowing: <code>f (a -&gt; b) -&gt; f a -&gt; f b</code> - which I fail to explain.</p>\n</blockquote>\n\n<p>Well, you already observed that <code>fmap id x = x</code>, which means <code>\\x -&gt; (&lt;*&gt;) (fmap id x) = \\x -&gt; (&lt;*&gt;) x</code>. And for any function <code>f</code>, <code>f = \\x -&gt; f x</code> (up to some niggles that aren't important right now), so in particular <code>\\x -&gt; (&lt;*&gt;) (fmap id x) = (&lt;*&gt;)</code>. So ghci gives you the type of <code>(&lt;*&gt;)</code>, as it should.</p>\n"}, {"comments": [{"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1544777105, "post_id": 53764071, "comment_id": 94403418, "body": "Regarding the second one. So <code>a -&gt; (b -&gt; c)</code> has a special case - when <code>a</code> is actually <code>(b -&gt; c)</code>, right? Then it will look like: <code>a = (b -&gt; c) -&gt; (b -&gt; c)</code>."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "edited": false, "score": 0, "creation_date": 1544777223, "post_id": 53764071, "comment_id": 94403473, "body": "@SerejaBogolubov It&#39;s the other way around: <code>a -&gt; a</code> can be unified with another type such that <code>a</code> = <code>b -&gt; c</code>, making <code>a -&gt; a</code> = <code>(b -&gt; c) -&gt; (b -&gt; c)</code>."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 8, "last_activity_date": 1544711266, "creation_date": 1544711266, "answer_id": 53764071, "question_id": 53763376, "link": "https://stackoverflow.com/questions/53763376/definition-for-the-applicative-functor/53764071#53764071", "title": "`(&lt;*&gt;)` definition for the Applicative functor?", "body": "<p>For question 1, you left out a very important piece of context. </p>\n\n<pre><code>class Functor f =&gt; Applicative f where\n    {-# MINIMAL pure, ((&lt;*&gt;) | liftA2) #-}\n</code></pre>\n\n<p>Those definitions you quoted belong to a class. That means instances can override them. Furthermore, the MINIMAL pragma says that in order to work, at least one of them must be overridden in the instance. So the breaking of the recursion happens whenever one is overridden in a particular instance. This is just like how the <code>Eq</code> class defines <code>(==)</code> and <code>(/=)</code> in terms of each other so that you only need to provide a definition for one in a hand-written instance.</p>\n\n<p>For question two, <code>a -&gt; b -&gt; c</code> is shorthand for <code>a -&gt; (b -&gt; c)</code>. So it unifies with (let's rename variables to avoid collision) <code>d -&gt; d</code> as <code>(b -&gt; c) -&gt; (b -&gt;c)</code>. (tangentially, that's also the type of <code>($)</code>.)</p>\n\n<p>For three - you're absolutely right. Keep simplifying!</p>\n\n<pre><code>\\x -&gt; (&lt;*&gt;) (fmap id x)\n\\x -&gt; (&lt;*&gt;) x\n(&lt;*&gt;)\n</code></pre>\n\n<p>So it shouldn't really be a surprise ghci gave you the type of <code>(&lt;*&gt;)</code> back, should it? </p>\n"}], "owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 417, "favorite_count": 1, "accepted_answer_id": 53764071, "answer_count": 4, "score": 6, "last_activity_date": 1545236777, "creation_date": 1544709062, "question_id": 53763376, "link": "https://stackoverflow.com/questions/53763376/definition-for-the-applicative-functor", "title": "`(&lt;*&gt;)` definition for the Applicative functor?", "body": "<p>Some Haskell source code (see <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.Base.html#Applicative\" rel=\"noreferrer\">ref</a>):</p>\n\n<pre><code>-- | Sequential application.\n--\n-- A few functors support an implementation of '&lt;*&gt;' that is more\n-- efficient than the default one.\n(&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n(&lt;*&gt;) = liftA2 id\n\n-- | Lift a binary function to actions.\n--\n-- Some functors support an implementation of 'liftA2' that is more\n-- efficient than the default one. In particular, if 'fmap' is an\n-- expensive operation, it is likely better to use 'liftA2' than to\n-- 'fmap' over the structure and then use '&lt;*&gt;'.\nliftA2 :: (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\nliftA2 f x = (&lt;*&gt;) (fmap f x)\n</code></pre>\n\n<p>Three things seem to be quite confusing to me:</p>\n\n<p>1) <code>(&lt;*&gt;)</code> is defined in terms of <code>liftA2</code>, where <code>liftA2</code> is defined in terms of <code>(&lt;*&gt;)</code>. How does it work? I see no obvious \"recursion-break\" case...</p>\n\n<p>2) <code>id</code> is an <code>a -&gt; a</code> function. Why is it passed into <code>liftA2</code> as an <code>(a -&gt; b -&gt; c)</code> function? </p>\n\n<p>3) <code>fmap id x</code> always equals <code>x</code>, since functors must preserve appropriate identities. Thus <code>(&lt;*&gt;) (fmap id x)</code> = <code>(&lt;*&gt;) (x)</code> where <code>x</code> = <code>f a</code> - an <code>a</code>-typed functor itself (by the way, how can <code>a</code>-typifying of the functor can be explained from the pure category theory's point of view? functor is just a mapping between categories, it has no further \"typification\"... seems like it is better to say - \"a container of type <code>a</code> with an (endo)functor defined for each instance of asummed category <code>Hask</code> of well-defined Haskell types). So <code>(&lt;*&gt;) (f a)</code> while by definition <code>(&lt;*&gt;)</code> expects <code>f(a' -&gt; b')</code>: thus, the only way to make it work is to deliberately bound <code>a</code> to be an <code>(a' -&gt; b')</code>. However when I run <code>:t \\x -&gt; (&lt;*&gt;) (fmap id x)</code> in the <code>gchi</code>, it spits out something mind-blowing: <code>f (a -&gt; b) -&gt; f a -&gt; f b</code> - which I fail to explain.</p>\n\n<hr>\n\n<p>Can someone step by step explain how does that work and why it even compiles? \nP.S. Category theory terms, if needed, are welcome.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 110, "user_id": 2004272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a270aea6c6335a5ffe3d4b5adfdae55f?s=128&d=identicon&r=PG", "display_name": "Johannes", "link": "https://stackoverflow.com/users/2004272/johannes"}, "edited": false, "score": 0, "creation_date": 1544784605, "post_id": 53764200, "comment_id": 94407639, "body": "Thanks, that explains a lot. The problem is a bit harder still: in my example <code>_1</code> and <code>_2</code> will have different types, so the fold is never going to work the way it is written now. Each iteration of the fold would have a different type of tuple. I&#39;ll accept your answer anyway ;)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 1, "last_activity_date": 1544711684, "creation_date": 1544711684, "answer_id": 53764200, "question_id": 53762325, "link": "https://stackoverflow.com/questions/53762325/using-lenses-to-update-randomgen-inside-state-struct-in-haskell/53764200#53764200", "title": "Using lenses to update RandomGen inside state struct in Haskell", "body": "<p>As a general rule, avoid taking <code>Lens</code> / <code>Getter</code> / <code>Setter</code> etc.. as arguments to functions, take <code>ALens</code> / <code>Getting</code> / <code>ASetter</code> instead. These are basically the \u201cspecialised to one use scenario\u201d versions, which doesn't require pesky Rank-N polymorphism etc.. Rank-N by itself is merely tricky for the type checker, but if you also have these types <em>in a list</em>, it breaks down completely (this would be impredicative polymorphism, which GHC has never supported properly).</p>\n\n<p>So in this case, it is <code>ALens</code>. The only slight problem is, <code>.~</code> actually wants <code>ASetter</code>, which is a strictly more special, but (in Haskell) distinct type. Likewise for <code>^.</code>. There are two solutions:</p>\n\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/lens-4.17/docs/Control-Lens-Lens.html#v:cloneLens\" rel=\"nofollow noreferrer\">\u201cClone\u201d the lens</a>, to get in the function a polymorphic version again.</li>\n<li>Use the \u201clensy\u201d getter and setter operators, i.e. <a href=\"http://hackage.haskell.org/package/lens-4.17/docs/Control-Lens-Lens.html#v:-35--126-\" rel=\"nofollow noreferrer\"><code>#~</code></a> for <code>.~</code>.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1544959489, "last_edit_date": 1544959489, "creation_date": 1544957822, "answer_id": 53801500, "question_id": 53762325, "link": "https://stackoverflow.com/questions/53762325/using-lenses-to-update-randomgen-inside-state-struct-in-haskell/53801500#53801500", "title": "Using lenses to update RandomGen inside state struct in Haskell", "body": "<p>One possible problem with your definition of <code>reinsert</code> is that it ties the structure of the final result to the structure of the transformed field.</p>\n\n<p>How about this alternative definition of <code>reinsert</code>?</p>\n\n<pre><code>-- Pry apart a field from a value,\n-- returning a pair of the value and a function to reconstruct the original value.\npry :: Lens' r x -&gt; Iso' r (x -&gt; r,x)\npry l = iso (\\r -&gt; (\\x -&gt; set l x r, view l r)) (uncurry ($))\n\n-- Given\n-- a lens into a field\n-- a transformation of the field\n-- a function that takes a reconstructor and the transformed field, and returns other thing\n-- a starting value\n-- return the other thing\nreinsert :: Lens' a b -&gt; (b -&gt; b') -&gt; ((b -&gt; a) -&gt; b' -&gt; c) -&gt; a -&gt; c\nreinsert l transform packer = \n    view $ pry l . alongside id (to transform) . to (uncurry packer)\n</code></pre>\n\n<p>It uses the <a href=\"http://hackage.haskell.org/package/lens-4.17/docs/Control-Lens-Lens.html#v:alongside\" rel=\"nofollow noreferrer\"><code>alongside</code></a> combinator. (The <code>pry</code> isn't strictly needed, you could simply <code>view</code> and <code>set</code> in <code>reinsert</code>.)</p>\n\n<p>With it, we could define the <code>RandomGen</code> instance like this:</p>\n\n<pre><code>instance RandomGen StateData where\n    next  = reinsert randomGen next fmap\n    split = reinsert randomGen split (\\f (s1,s2) -&gt; (f s1, f s2))\n</code></pre>\n"}], "owner": {"reputation": 110, "user_id": 2004272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a270aea6c6335a5ffe3d4b5adfdae55f?s=128&d=identicon&r=PG", "display_name": "Johannes", "link": "https://stackoverflow.com/users/2004272/johannes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 53764200, "answer_count": 2, "score": 2, "last_activity_date": 1544959489, "creation_date": 1544705599, "last_edit_date": 1544708415, "question_id": 53762325, "link": "https://stackoverflow.com/questions/53762325/using-lenses-to-update-randomgen-inside-state-struct-in-haskell", "title": "Using lenses to update RandomGen inside state struct in Haskell", "body": "<p>I'm using a <code>StdGen</code> inside a larger state struct and want to implement the <code>RandomGen</code> class on the state struct. Using lenses I came up with the following implementation:</p>\n\n<pre><code>module Test\n    ( StateData(..)\n    , randomGen\n    ) where\n\nimport Lens.Micro.Platform\nimport System.Random\n\ndata StateData = StateData\n    { _randomGen :: StdGen\n    } deriving (Show)\n\nrandomGen :: Lens' StateData StdGen\nrandomGen = lens _randomGen (\\ s x -&gt; s { _randomGen = x })\n\ninstance RandomGen StateData where\n    next s = r &amp; _2 .~ (s &amp; randomGen .~ (r ^. _2))\n        where r = (s ^. randomGen ^. to next)\n    split s = r &amp; _1 .~ (s &amp; randomGen .~ (r ^. _1))\n                &amp; _2 .~ (s &amp; randomGen .~ (r ^. _2))\n        where r = (s ^. randomGen ^. to split)\n</code></pre>\n\n<p>To simplify this definition (and future definitions like it) I would like to generalise the pattern as follows:</p>\n\n<pre><code>reinsert :: (a -&gt; b) -&gt; Lens' s a -&gt; [Lens b b' a s] -&gt; a -&gt; b'\nreinsert f a bs s\n     = foldr (&amp;) r [b .~ (s &amp; a .~ (r ^. b)) | b &lt;- bs]\n     where r = (s ^. a ^. to f)\n\ninstance RandomGen StateData where\n    next = reinsert next randomGen [_2]\n    split = reinsert split randomGen [_1, _2]\n</code></pre>\n\n<p>There is a problem with this approach though. The type declaration of <code>reinsert</code> is an \"Illegal polymorphic type\". I understand this as the type being to complex for Haskell to deal with. If I remove the type declaration the first use of the <code>a</code> lens turns it into a class <code>Getting</code>, making the second use as <code>ASetter</code> illegal; the same happens to <code>b</code> inside the list comprehension.</p>\n\n<p>Is there a way to fix this? Or alternatively, is there a better way to implement the <code>RandomGen</code> instance on <code>StateData</code>?</p>\n\n<p>Cheers, Johan</p>\n\n<p>Edit: a bit simpler, but not solving the core issue:</p>\n\n<pre><code>instance RandomGen StateData where\n    next s  = (s ^. randomGen ^. to next) \n            &amp; _2 %~ (\\ x -&gt; s &amp; randomGen .~ x)\n    split s = (s ^. randomGen ^. to split)\n            &amp; _1 %~ (\\ x -&gt; s &amp; randomGen .~ x)\n            &amp; _2 %~ (\\ x -&gt; s &amp; randomGen .~ x)\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "is_accepted": false, "score": 1, "last_activity_date": 1544705499, "creation_date": 1544705499, "answer_id": 53762294, "question_id": 53761960, "link": "https://stackoverflow.com/questions/53761960/two-executables-in-one-cabal-file-stack-build-does-not-recognize-them/53762294#53762294", "title": "Two executables in one cabal file; stack build does not recognize them", "body": "<p>AFAIK, <code>stack build</code> always builds all your targets. But if you want to be run just one executable, you'll need the full name including the <code>-exe</code>. So, <code>stack exec api-tests-exe</code> and <code>stack exec e2e-tests-exe</code>. </p>\n\n<p>But what you really want to do is make these test targets: <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#test-suites\" rel=\"nofollow noreferrer\">https://www.haskell.org/cabal/users-guide/developing-packages.html#test-suites</a> </p>\n"}, {"tags": [], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "is_accepted": false, "score": 0, "last_activity_date": 1544705743, "creation_date": 1544705743, "answer_id": 53762373, "question_id": 53761960, "link": "https://stackoverflow.com/questions/53761960/two-executables-in-one-cabal-file-stack-build-does-not-recognize-them/53762373#53762373", "title": "Two executables in one cabal file; stack build does not recognize them", "body": "<p>Problem was in stack.yaml file, I had to add '.' folder to \"packages:\" section.</p>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1544705743, "creation_date": 1544704403, "question_id": 53761960, "link": "https://stackoverflow.com/questions/53761960/two-executables-in-one-cabal-file-stack-build-does-not-recognize-them", "title": "Two executables in one cabal file; stack build does not recognize them", "body": "<p>I'm trying to make 2 executables \"project\". All duplicates of this question did not help me - their answers don't fix my problem. I have .cabal file like this:</p>\n\n<pre><code>name:                int-tests\nversion:             0.1.0.0\nsynopsis:            Integration Tests Suite\ndescription:         Integration Tests Suite\nlicense:             AllRightsReserved\nauthor:              Author name here\nmaintainer:          example@example.com\ncopyright:           2018 Author name here\nbuild-type:          Custom\nextra-source-files:  README.md\ncabal-version:       &gt;=1.10\n\nlibrary\n  hs-source-dirs:      common\n  exposed-modules:     Common\n  build-depends:       base\n                     , text\n                     , aeson\n                     , network-uri\n  default-language:    Haskell2010\n  ghc-options:         -Wall -Werror\n\nexecutable api-tests-exe\n  hs-source-dirs:      api\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N -Wall -Werror\n  build-depends:       base\n                     , hspec\n                     , QuickCheck\n  default-language:    Haskell2010\n\nexecutable e2e-tests-exe\n  hs-source-dirs:      e2e\n  main-is:             Main.hs\n  ghc-options:         -threaded -rtsopts -with-rtsopts=-N -Wall -Werror\n  build-depends:       base\n                     , hspec\n                     , QuickCheck\n  default-language:    Haskell2010\n</code></pre>\n\n<p>and when I call <code>stack ide targets</code> I don't see these 2 targets. So, <code>stack build api-tests</code> and <code>stack build e2e-tests</code> don't work too.</p>\n\n<p>How can I create 2 targets' project for stack? I tried also package.yaml but result is the same. Stack version is 1.9.1. I have folders tree like:</p>\n\n<pre><code>api/\n...\ne2e/\n...\n</code></pre>\n\n<p>where are Main.hs files with content like:</p>\n\n<pre><code>module Main (main) where\nmain :: IO ()\nmain = print \"Hello\"\n</code></pre>\n\n<p>Also I tried option <code>-main-is Main</code> but without success.\nError looks like:</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were encountered:\n\nUnknown package: api-tests\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "cabal-install", "ghc-mod"], "owner": {"reputation": 41, "user_id": 10785271, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96074edea4088660126587c705f3a18?s=128&d=identicon&r=PG&f=1", "display_name": "Schluhm", "link": "https://stackoverflow.com/users/10785271/schluhm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 369, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1544697210, "creation_date": 1544697210, "question_id": 53759850, "link": "https://stackoverflow.com/questions/53759850/how-to-install-ghc-mod-using-cabal", "title": "How to install ghc-mod using cabal", "body": "<p>I am trying to install ghc-mod. Running MacOS Mojave 10.14.1. Right now, when running <code>cabal install ghc-mod</code> I get:</p>\n\n<pre><code>clang: warning: argument unused during compilation: '- nopie' [-Wunused-command-line-argument]\nResolving dependencies...\ncabal: Could not resolve dependencies:\n[__0] trying: ghc-mod-5.8.0.0 (user goal)\n[__1] trying: syb-0.7 (dependency of ghc-mod)\n[__2] next goal: base (dependency of ghc-mod)\n[__2] rejecting: base-4.11.1.0/installed-4.1... (conflict: ghc-mod =&gt;\n   base&lt;4.10 &amp;&amp; &gt;=4.6.0.1)\n[__2] rejecting: base-4.12.0.0, base-4.11.1.0, base-4.11.0.0, base-4.10.1.0,\nbase-4.10.0.0, base-4.9.1.0, base-4.9.0.0, base-4.8.2.0, base-4.8.1.0,\nbase-4.8.0.0, base-4.7.0.2, base-4.7.0.1, base-4.7.0.0, base-4.6.0.1,\nbase-4.6.0.0, base-4.5.1.0, base-4.5.0.0, base-4.4.1.0, base-4.4.0.0,\nbase-4.3.1.0, base-4.3.0.0, base-4.2.0.2, base-4.2.0.1, base-4.2.0.0,\nbase-4.1.0.0, base-4.0.0.0, base-3.0.3.2, base-3.0.3.1 (constraint from\nnon-upgradeable package requires installed instance)\n[__2] fail (backjumping, conflict set: base, ghc-mod)\nAfter searching the rest of the dependency tree exhaustively, these were the\ngoals I've had most trouble fulfilling: base, ghc-mod, syb\n</code></pre>\n\n<p>I haven't found anything on this particular failure. So I tried installing happy which \"may be needed for installing\" according to <a href=\"https://github.com/DanielG/ghc-mod/wiki/Installing\" rel=\"nofollow noreferrer\">this</a>.</p>\n\n<p>But doing so I got the following warning:</p>\n\n<pre><code>Warning: could not create a symlink in /Users/myname/.cabal/bin for\nhappy because the file exists there already but is not managed by cabal. You\ncan create a symlink for this executable manually if you wish. The executable\nfile has been installed at /Users/myname/.cabal/bin/happy\n</code></pre>\n\n<p>How could I do so? Would this even resolve my prior issue?</p>\n\n<p>I also tried using <code>stack install ghc-mod</code> but I'm getting <code>Plan construction failed.</code></p>\n\n<p>GHC, Cabal and Stack are all updated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1544688733, "post_id": 53756916, "comment_id": 94367127, "body": "It seems need to try all the permutations of elements of the list. And what happen if the list of pair say, <code>[[1,3], [3,1], [2,2]]</code> cannot be merged?"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1544696176, "post_id": 53756916, "comment_id": 94371021, "body": "This resembles box stacking problem and it&#39;s not a simple thing since you get different results when you start with chaining up like <code>[1,3] -&gt; [3,2] -&gt; ..</code> or <code>[2,1] -&gt; [1,3] -&gt; ..</code>. Assuming that you want the least amount of sublists in the result, it can be solved efficiently by dynamical programming approaches. I think permutations will yield wasteful code here."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 0, "creation_date": 1544698386, "post_id": 53756916, "comment_id": 94372291, "body": "Could you define your problem better?. f.e. if the input is <code>[[1,3], [3, 1]]</code> up to your example the output should be <code>[[1,3,1]]</code> but up to your description, the output should be <code>[[1,3,1], [3,1,3]]</code>. Also if there are duplicates who do we proceed?  ex. if the input is <code>[[1,3],[3,1],[3,1]]</code> shouldn&#39;t the ouput be <code>[[1,3,1][1,3,1]]</code> instead of <code>[[1,3,1]]</code>?"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1544700281, "post_id": 53756916, "comment_id": 94373346, "body": "@assembly.jc my original solution was to use <code>permutations</code> but this is obviously inefficient to the point of being impractical even in this small case"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "reply_to_user": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 1, "creation_date": 1544700360, "post_id": 53756916, "comment_id": 94373397, "body": "@LuisMorillo i have added more examples and my initial solutions. Duplicates are removed and <code>[[1,3],[3,1],[3,1]]</code>  should yield <code>[[3,1,3,1]]</code> since the sublists can be further combined"}], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1544701037, "post_id": 53757887, "comment_id": 94373774, "body": "Your solution seems to work perfectly. I will try and understand it before I vote it up etc. Thanks"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1544701369, "post_id": 53757887, "comment_id": 94373957, "body": "any chance you could add a little description to what you did?"}, {"owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1544757369, "post_id": 53757887, "comment_id": 94397750, "body": "@matthias added some comments."}], "tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": true, "score": 1, "last_activity_date": 1544757296, "last_edit_date": 1544757296, "creation_date": 1544690261, "answer_id": 53757887, "question_id": 53756916, "link": "https://stackoverflow.com/questions/53756916/haskell-merging-list-of-lists/53757887#53757887", "title": "Haskell: merging list of lists", "body": "<p>I ended with this solution, but it contains duplicates (you can use <code>Data.List(nub)</code> to get rid of them).</p>\n\n<pre><code>import Data.List(partition)\n\nmain :: IO ()\nmain =  do\n        print $ show tmp\n\ninput = [[1,3],[1,3],[1,3],[1,3],[2,1],[2,1],[2,1],[2,2],[3,2],[3,2],[3,2]]        \n\ntmp = combinations input\n\n-- this function turns list into list of pair, first element is element of the\n-- input list, second element is rest of the list\neach :: [a] -&gt; [a] -&gt; [(a, [a])]\neach h [] = [] \neach h (x:xs) = (x, h++xs) : each (x:h) xs  \n\ncombinations :: (Eq a) =&gt; [[a]] -&gt; [[a]]\ncombinations l = concat $ map combine $ each [] l\n   where\n      -- take pair (\"prefix list\", \"unused lists\")\n      combine :: (Eq a) =&gt; ([a], [[a]]) -&gt; [[a]]\n      combine (x, []) = [x]\n      combine (x, xs) = let\n                           l = last x\n                           -- split unused element to good and bad\n                           (g, b) = partition (\\e -&gt; l == head e) xs\n                           s = each [] g\n                           -- add on element to prefix and pass rest (bad + good except used element) to recursion. so it eat one element in each recursive call.\n                           combine' (y, ys) = combine (x ++ tail y, ys ++ b) \n                        -- try to append each good element, concat result\n                        in concat $ map combine' s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544707746, "post_id": 53761397, "comment_id": 94377526, "body": "given a list of  two-element lists they want to link them <i>all</i> up at matching edges, and return all the possible ways of doing so. e.g. <code>linkUp [[1,2],[1,2]] ==&gt; []</code>."}, {"owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1544709913, "post_id": 53761397, "comment_id": 94378851, "body": "right, he wants to link them all, it was that bit I had missed"}], "tags": [], "owner": {"reputation": 2280, "user_id": 1442575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd9a74eef0b1c8e998edf3891cb6ed2e?s=128&d=identicon&r=PG", "display_name": "Jorge Adriano", "link": "https://stackoverflow.com/users/1442575/jorge-adriano"}, "is_accepted": false, "score": 0, "last_activity_date": 1544706881, "last_edit_date": 1592644375, "creation_date": 1544702407, "answer_id": 53761397, "question_id": 53756916, "link": "https://stackoverflow.com/questions/53756916/haskell-merging-list-of-lists/53761397#53761397", "title": "Haskell: merging list of lists", "body": "<p>I'm not sure if I fully understand what you want to do, so here are just a few notes and hints.</p>\n<blockquote>\n<p>given a list of list pairs <code>::[a,a]</code></p>\n<p>(...) for example</p>\n<p><code>\u03bb= merge [1,2] [2,3]</code></p>\n</blockquote>\n<p>Firstly those are not lists of pairs, each element of the list is an integer not a pair. They just happen to be lists with two elements. So you can say they are of type <code>[Int]</code> or an instance of type <code>[a]</code>.</p>\n<blockquote>\n<p>the sublists have been merged on the last of one sublit matching head of the next.</p>\n</blockquote>\n<p>This suggests that the size of the lists will grow, and that you  will constantly need to inspect their first and last elements. Inspecting the last element of a list implies traversing it each time. You want to avoid that.</p>\n<p>This suggests a representation of lists with extra information for easy access. You only need the last element, but I'll put first and last for symmetry.</p>\n<pre><code>-- lists together with their last element\ndata CL a = CL [a] a a \n\ncl :: [a] -&gt; CL a \ncl [] = error &quot;CL from empty list&quot;\ncl xs = CL xs (head xs) (last xs)\n\nclSafe :: [a] -&gt; Maybe (CL a)\nclSafe [] = Nothing\nclSafe xs = Just (cl xs)\n \nclFirst (CL _ x _) = x\nclLast  (CL _ _ x) = x\n\ncompatible cs ds = clLast cs == clFirst ds\n</code></pre>\n<p>Perhaps better, maybe you should have</p>\n<pre><code>data CL a = CL [a] a a | Nil \n</code></pre>\n<p>And to include an empty list that is compatible with all others.</p>\n<p>Another point to take into account is that if e.g., you have a list <code>xs</code> and want to find lists <code>ys</code> to combine as <code>ys++xs</code>, then you want it to be very easy to access all <code>ys</code> with a given last element. That suggests you should store them in a  suitable structure. Maybe a hash table.</p>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1248, "favorite_count": 1, "accepted_answer_id": 53757887, "answer_count": 2, "score": 2, "last_activity_date": 1544757296, "creation_date": 1544686040, "last_edit_date": 1544700225, "question_id": 53756916, "link": "https://stackoverflow.com/questions/53756916/haskell-merging-list-of-lists", "title": "Haskell: merging list of lists", "body": "<p>given a list of list pairs <code>::[a,a]</code>, I would like to return the possible combinations of lists, where the sublists have been merged on the last of one sublit matching head of the next.</p>\n\n<p>for example \n    -- combine two lists if they front and back match</p>\n\n<pre><code>merge :: Eq a =&gt; [[a]] -&gt; [[a]]\nmerge (x:y:ys) | last x == head y = merge $ (x ++ (drop 1 y)) : ys\n               | otherwise    = []\nmerge xs       = xs\n\ncombinations :: Eq a =&gt; [[a]] -&gt; [[a]]\ncombinations = nub . concatMap merge . permutations\n\n\u03bb= merge [1,2] [2,3]\n[1,2,3]\n\n\n-- there should be no duplicate results\n\u03bb= combinations [[1,3],[1,3],[1,3],[1,3],[2,1],[2,1],[2,1],[2,2],[3,2],[3,2],[3,2]]\n[[1,3,2,2,1,3,2,1,3,2,1,3],[1,3,2,1,3,2,2,1,3,2,1,3],1,3,2,1,3,2,1,3,2,2,1,3]]\n\n-- the result must be a completely merged list or an empty list\n\u03bb= combinations [[1,3], [3,1], [2,2]]\n[]\n\n\u03bb= combinations [[1,3], [3, 1]]\n[[1,3,1],[3,1,3]]\n\n\u03bb= combinations [[1,3],[3,1],[3,1]]\n[[3,1,3,1]]\n</code></pre>\n\n<p>I can't quite wrap my head around the recursion needed to do this efficiently.</p>\n"}]